{
  "metadata": {
    "title": "Developing Microservices with Node.js",
    "author": "Unknown",
    "publisher": "Unknown Publisher",
    "edition": "1st Edition",
    "isbn": "",
    "total_pages": 347,
    "conversion_date": "2025-12-19T17:26:44.999705",
    "conversion_method": "PyMuPDF + OCR fallback",
    "source_pdf": "Developing Microservices with Node.js.pdf",
    "extraction_method": "Unstructured"
  },
  "chapters": [
    {
      "number": 1,
      "title": "Microservices Architecture",
      "start_page": 25,
      "end_page": 54,
      "detection_method": "regex_chapter_title",
      "content": "The\tnatural\ttrend\tfor\tnew\thigh-tech\tcompanies\tsuch\tas\tAmazon\tor Netflix\tis\tbuilding\ttheir\tnew\tsoftware\tusing\tmicroservices,\twhich\tis\tthe ideal\tscenario:\tthey\tget\ta\thuge\tadvantage\tof\tmicroservices-oriented software\t(through\tout\tthis\tbook,\tyou\twill\tlearn\thow)\tin\torder\tto\tscale\tup their\tnew\tproducts\twithout\ta\tbig\teffort.\tThe\tproblem\tis\tthat\tnot\tall companies\tcan\tplan\ttheir\tsoftware\tupfront.\tInstead\tof\tplanning,\tthese companies\tbuild\tsoftware\tbased\ton\tthe\torganic\tgrowth\texperienced:\tfew software\tcomponents\tgroup\tbusiness\tflows\tby\taffinity.\tIt\tis\tnot\trare\tto\tsee companies\twith\ttwo\tbig\tsoftware\tcomponents:\tthe\tuser-facing\twebsite and\tthe\tinternal\tadministration\ttools.\tThis\tis\tusually\tknown\tas\ta monolithic\tsoftware\tarchitecture.\n\nSome\tof\tthese\tcompanies\tface\tbig\tproblems\twhen\ttrying\tto\tscale\tthe engineering\tteams.\tIt\tis\thard\tto\tcoordinate\tteams\tthat\tbuild,\tdeploy,\tand maintain\ta\tsingle\tsoftware\tcomponent.\tClashes\ton\treleases\tand reintroduction\tof\tbugs\tare\ta\tcommon\tproblem\tthat\tdrains\ta\tlarge\tchunk\tof energy\tfrom\tthe\tteams.\tOne\tof\tthe\tsolution\tto\tthis\tproblem\t(it\tcomes\twith benefits)\tis\tto\tsplit\tthe\tmonolithic\tsoftware\tinto\tmicroservices\tso\tthat\tthe teams\tare\table\tto\tspecialize\tin\ta\tfew\tsmaller\tmodules\tand\tautonomous and\tisolated\tsoftware\tcomponents\tthat\tcan\tbe\tversioned,\tupdated,\tand deployed\twithout\tinterfering\twith\tthe\trest\tof\tthe\tsystems\tof\tthe\tcompany.\n\nSplitting\tthe\tmonolith\tinto\tmicroservices\tenables\tthe\tengineering\tteam\tto create\tisolated\tand\tautonomous\tunits\tof\twork\tthat\tare\thighly\tspecialized in\ta\tgiven\ttask\tsuch\tas\tsending\te-mails,\tprocessing\tcard\tpayments,\tand so\ton.\n\nMicroservices\tin\tthe\treal\tworld\n\nMicroservices\tare\tsmall\tsoftware\tcomponents\tthat\tare\tspecialized\tin\tone task\tand\twork\ttogether\tto\tachieve\ta\thigher-level\ttask.\tForget\tabout software\tfor\ta\tsecond\tand\tthink\tabout\thow\ta\tcompany\tworks.\tWhen someone\tapplies\tfor\ta\tjob\tin\ta\tcompany,\the\tapplies\tfor\ta\tgiven\tposition: software\tengineer,\tsystem\tadministrator,\toffice\tmanager.\tThe\treason\tfor this\tcan\tbe\tsummarized\tin\tone\tword:\tspecialization.\tIf\tyou\tare\tused\tto work\tas\ta\tsoftware\tengineer,\tyou\twill\tget\tbetter\twith\tthe\texperience\tand add\tmore\tvalue\tto\tthe\tcompany.\tThe\tfact\tthat\tyou\tdon't\tknow\thow\tto\tdeal with\ta\tcustomer,\twon't\taffect\tyour\tperformance\tas\tthat\tis\tnot\tyour\tarea\tof\n\nexpertise\tand\twill\thardly\tadd\tany\tvalue\tto\tyour\tday-to-day\twork.\n\nTip\n\nSpecialization\tis\toften\tthe\tkey\tto\timprove\tthe\tefficiency.\tDoing\tone thing\tand\tdoing\tit\tright\tis\tone\tof\tthe\tmantras\tof\tsoftware\tdevelopment.\n\nA\tmicroservice\tis\tan\tautonomous\tunit\tof\twork\tthat\tcan\texecute\tone\ttask without\tinterfering\twith\tother\tparts\tof\tthe\tsystem,\tsimilar\tto\twhat\ta\tjob position\tis\tto\ta\tcompany.\tThis\thas\ta\tnumber\tof\tbenefits\tthat\tcan\tbe\tused in\tfavor\tof\tthe\tengineering\tteam\tin\torder\tto\thelp\tscale\tthe\tsystems\tof\ta company.\n\nNowadays,\thundreds\tof\tsystems\tare\tbuilt\tusing\tmicroservices-oriented architectures,\tas\tfollows:\n\nNetflix:\tThis\tis\tone\tof\tthe\tmost\tpopular\tstreaming\tservices,\tit\thas built\tan\tentire\tecosystem\tof\tapplications\tthat\tcollaborate\tin\torder\tto provide\ta\treliable\tand\tscalable\tstreaming\tsystem\tused\tacross\tthe globe. Spotify:\tThis\tis\tone\tof\tthe\tleading\tmusic\tstreaming\tservices\tin\tthe world,\tit\thas\tbuilt\tthis\tapplication\tusing\tmicroservices.\tEvery\tsingle widget\tof\tthe\tapplication\t(which\tis\ta\twebsite\texposed\tas\ta\tdesktop app\tusing\tChromium\tEmbedded\tFramework)\tis\ta\tdifferent microservice\tthat\tcan\tbe\tupdated\tindividually.\n\nMicroservice-oriented\tarchitectures\n\nMicroservices-oriented\tarchitectures\thave\tsome\tparticularities\tthat makes\tthem\tdesirable\tfor\tany\tmid/large-sized\tcompany\tthat\twants\tto keep\ttheir\tIT\tsystems\tresilient\tand\tin\tscale\tup/down-ready\tstatus.\n\nHow\tis\tit\tbetter?\n\nThey\tare\tnot\tthe\tholy\tgrail\tof\tsoftware\tengineering,\tbut,\twhen\thandled with\tcare,\tthey\tbecome\tthe\tperfect\tapproach\tto\tsolve\tmost\tof\tthe\tbig\n\nproblems\tfaced\tby\ttech-dependent\tcompanies.\n\nIt\tis\timportant\tto\tkeep\tthe\tkey\tprinciples\tof\tthe\tmicroservices-oriented architecture's\tdesign\tin\tmind,\tsuch\tas\tresilience,\tcomposability,\telasticity, and\tso\ton;\totherwise,\tyou\tcould\tend\tup\twith\ta\tmonolithic\tapplication\tsplit across\tdifferent\tmachines\tthat\tproduces\tproblems\trather\tthan\tan\telegant solution.\n\nShortcomings\n\nThere\tis\talso\tsome\tcriticism\taround\tmicroservices-oriented\tarchitectures, as\tthey\tintroduce\tsome\tproblems\tto\tdeal\twith,\tsuch\tas\tlatency, traceability,\tand\tconfiguration\tmanagement\tthat\tare\tnot\tpresent\twith monolithic-based\tsoftware.\tSome\tof\tthe\tproblems\tare\tdescribed\tas follows:\n\nNetwork\tlatency:\tMicroservices\thave\ta\tdistributed\tnature\tso\tthat network\tlatency\thas\tto\tbe\taccounted\tfor Operations\toverhead:\tMore\tservers\tindicate\tmore\tmaintenance Eventual\tconsistency:\tOn\thighly\ttransactional\tsystems,\twe\tneed\tto factor\tinto\timplementation\tthe\tfact\tthat\tthe\tdata\tcould\tbe\tinconsistent during\ta\tperiod\tof\ttime\t(we\twill\ttalk\tabout\tit\tlater\tin\tthis\tchapter)\n\nIn\tgeneral,\tengineers\tshould\ttry\tto\tevaluate\tthe\tpros\tand\tcons\tof\tthis approach\tand\tmake\ta\tdecision\ton\twhether\tto\tuse\tmicroservices\tor\tnot\tin order\tto\tfit\tthe\tbusiness\tneeds.\n\nMicroservices-oriented\tarchitectures\thave\tsome\tparticularities\tthat\tneed to\tbe\ttaken\tinto\tconsideration.\tWhen\ta\tsoftware\tengineer\tis\twriting monolithic\tsoftware,\tthere\tare\tsome\tproblems\tthat\tare\tcompletely overlooked\tdue\tto\tthe\tnature\tof\tthe\tsoftware\tbeing\tbuilt.\n\nFor\texample,\timagine\tthat\tour\tsoftware\tneeds\tto\tsend\te-mails.\tIn\ta monolithic\tsoftware,\twe\twould\tjust\tadd\tthe\tfunctionality\tto\tthe\tcore\tof\tthe application.\tWe\tmight\teven\tchoose\tto\tcreate\ta\tdedicated\tmodule\tto\tdeal with\te-mails\t(which\tseems\tlike\ta\tgood\tidea).\tNow,\timagine\tthat\twe\tare creating\ta\tmicroservice\tand,\tinstead\tof\tadding\ta\tfunctionality\tto\ta\tbig software\tartifact,\twe\tcreate\ta\tdedicated\tservice\tthat\tcan\tbe\tdeployed\tand versioned\tindependently.\tIn\tthis\tcase,\twe\twill\thave\tan\textra\tstep\tthat\twe\n\ndidn't\thave\tto\ttake\tinto\tconsideration,\tthe\tnetwork\tlatency,\tto\treach\tthe new\tmicroservice.\n\nIn\tthe\tpreceding\texample,\tno\tmatter\twhat\tapproach\t(monolithic\tor microservices)\tyou\tare\ttaking\tto\tbuild\tthe\tsoftware,\tis\tnot\ta\tbig\tdeal;\tfor example,\tif\tan\te-mail\tis\tlost,\tit\tis\tnot\tthe\tend\tof\tthe\tworld.\tAs\tper definition,\tthe\te-mail\tdelivery\tis\tnot\tguaranteed,\tso\tour\tapplication\twill\tstill work,\talthough\twe\tmight\treceive\ta\tfew\tcomplaints\tfrom\tour\tcustomers.\n\nKey\tdesign\tprinciples\n\nThere\tare\ta\tfew\tkey\tdesign\tprinciples\tthat\tneed\tto\tbe\ttaken\tinto consideration\twhen\tbuilding\tmicroservices.\tThere\tis\tno\tgolden\trule\tand, as\tmicroservices\tare\ta\trecent\tconcept,\tsometimes\tthere\tis\teven\ta\tlack\tof consensus\ton\twhat\tpractices\tto\tfollow.\tIn\tgeneral,\twe\tcan\tassume\tthe following\tdesign\tprinciples:\n\nMicroservices\tare\tbusiness\tunits\tthat\tmodel\tthe\tcompany\tprocesses. They\tare\tsmart\tendpoints\tthat\tcontain\tthe\tbusiness\tlogic\tand communicate\tusing\tsimple\tchannels\tand\tprotocols. Microservices-oriented\tarchitectures\tare\tdecentralized\tby\tdefinition. This\thelps\tto\tbuild\trobust\tand\tresilient\tsoftware.\n\nBusiness\tunits,\tno\tcomponents\n\nOne\tof\tthe\tmost\tenjoyable\tsides\tof\tsoftware\tengineering\tis\tcreating\ta new\tproject.\tThis\tis\twhere\tyou\tcan\tapply\tall\tyour\tcreativity,\ttry\tnew architectural\tconcepts,\tframeworks,\tor\tmethodologies.\tUnfortunately,\tit\tis not\ta\tcommon\tsituation\tin\ta\tmature\tcompany.\tUsually,\twhat\twe\tdo\tis create\tnew\tcomponents\tinside\tthe\texisting\tsoftware.\tOne\tof\tthe\tbest design\tprinciples\tthat\tyou\tcan\tfollow\twhen\tcreating\tnew\tcomponents\tis keeping\tthe\tcoupling\tas\tlow\tas\tpossible\twith\tthe\trest\tof\tthe\tsoftware,\tso that\tit\tworks\tas\tan\tindependent\tunit.\n\nTip\n\nKeeping\ta\tlow\tlevel\tof\tcoupling\tallows\ta\tsoftware\tcomponent\tto\tbe converted\tinto\ta\tmicroservice\twith\tlittle\tto\tno\teffort.\n\nConsider\ta\treal-world\texample:\tthe\tapplication\tof\tyour\tcompany\tnow needs\tto\tbe\table\tto\tprocess\tpayments.\n\nThe\tlogical\tdecision\there\twould\tbe\tcreating\ta\tnew\tmodule\tthat\tknows how\tto\tdeal\twith\tthe\tchosen\tpayment\tprovider\t(credit\tcards,\tPayPal,\tand\n\nso\ton)\tand\tallows\tus\tto\tkeep\tall\tthe\tpayment-related\tbusiness\tlogic inside\tof\tit.\tLet's\tdefine\tthe\tinterface\tin\tthe\tfollowing\tcode:\n\npublic\tinterface\tPaymentService\t{ \t\tPaymentResponse\tprocessPayment(PaymentRequest\t request)\tthrows\tMyBusinessException; }\n\nThis\tsimple\tinterface\tcan\tbe\tunderstood\tby\teveryone,\tbut\tit\tis\tthe\tkey when\tmoving\ttowards\tmicroservices.\tWe\thave\tencapsulated\tall\tthe business\tknowledge\tbehind\tan\tinterface\tso\tthat\twe\tcould\ttheoretically switch\tthe\tpayment\tprovider\twithout\taffecting\tthe\trest\tof\tthe\tapplication— the\timplementation\tdetails\tare\thidden\tfrom\tthe\touter\tworld.\n\nThe\tfollowing\tis\twhat\twe\tknow\tuntil\tnow:\n\nWe\tknow\tthe\tmethod\tname,\ttherefore,\twe\tknow\thow\tto\tinvoke\tthe service The\tmethod\tcould\tthrow\tan\texception\tof\tthe\tMyBusinessException type,\tforcing\tthe\tcalling\tcode\tto\tdeal\twith\tit We\tknow\tthat\tthe\tinput\tparameter\tis\ta\tPaymentRequest\tinstance The\tresponse\tis\ta\tknown\tobject\n\nWe\thave\tcreated\ta\thighly\tcohesive\tand\tloosely\tcoupled\tbusiness\tunit. Let's\tjustify\tthis\taffirmation\tin\tthe\tfollowing:\n\nHighly\tcohesive:\tAll\tthe\tcode\tinside\tthe\tpayments\tmodule\twill\tdo only\tone\tthing,\tthat\tis,\tdeal\twith\tpayments\tand\tall\tthe\taspects\tof calling\ta\tthird-party\tservice\t(connection\thandling,\tresponse\tcodes, and\tso\ton),\tsuch\tas\ta\tdebit\tcard\tprocessor. Loosely\tcoupled:\tWhat\thappens\tif,\tfor\tsome\treason,\twe\tneed\tto switch\tto\ta\tnew\tpayment\tprocessor?\tIs\tthere\tany\tinformation bleeding\tout\tof\tthe\tinterface?\tWould\twe\tneed\tto\tchange\tthe\tcalling code\tdue\tto\tchanges\tin\tthe\tcontract?\tThe\tanswer\tis\tno.\tThe implementation\tof\tthe\tpayment\tservice\tinterface\twill\talways\tbe\ta modular\tunit\tof\twork.\n\nThe\tfollowing\tdiagram\tshows\thow\ta\tsystem\tcomposed\tof\tmany components\tgets\tone\tof\tthem\t(payment\tservice)\tstripped\tout\tinto\ta microservice:\n\nOnce\tthis\tmodule\tis\timplemented,\twe\twill\tbe\table\tto\tprocess\tthe payments\tand\tour\tmonolithic\tapplication\twill\thave\tanother\tfunctionality that\tcould\tbe\ta\tgood\tcandidate\tto\textract\tinto\ta\tmicroservice.\n\nNow,\twe\tcan\trollout\tnew\tversions\tof\tthe\tpayment\tservice,\tas\tlong\tas\tthe interface\tdoes\tnot\tchange,\tas\twell\tas\tthe\tcontract\twith\tthe\trest\tof\tthe world\t(our\tsystem\tor\tthird\tparties),\thasn't\tchanged.\tThat\tis\twhy\tit\tis\tso important\tto\tkeep\tthe\timplementation\tindependent\tfrom\tinterfacing,\teven though\tthe\tlanguage\tdoes\tnot\tprovide\tsupport\tfor\tinterfaces.\n\nWe\tcan\talso\tscale\tup\tand\tdeploy\tas\tmany\tpayment\tservices\tas\twe require\tso\tthat\twe\tcan\tsatisfy\tthe\tbusiness\tneeds\twithout\tunnecessarily scaling\tthe\trest\tof\tthe\tapplication\tthat\tmight\tnot\tbe\tunder\tpressure.\n\nTip\n\nDownloading\tthe\texample\tcode\n\nYou\tcan\tdownload\tthe\texample\tcode\tfiles\tfor\tthis\tbook\tfrom\tyour account\tat\thttp://www.packtpub.com.\tIf\tyou\tpurchased\tthis\tbook elsewhere,\tyou\tcan\tvisit\thttp://www.packtpub.com/support\tand register\tto\thave\tthe\tfiles\te-mailed\tdirectly\tto\tyou.\n\nYou\tcan\tdownload\tthe\tcode\tfiles\tby\tfollowing\tthese\tsteps:\n\nLog\tin\tor\tregister\tto\tour\twebsite\tusing\tyour\te-mail\taddress\tand password. Hover\tthe\tmouse\tpointer\ton\tthe\tSUPPORT\ttab\tat\tthe\ttop. Click\ton\tCode\tDownloads\t&\tErrata. Enter\tthe\tname\tof\tthe\tbook\tin\tthe\tSearch\tbox. Select\tthe\tbook\tfor\twhich\tyou're\tlooking\tto\tdownload\tthe\tcode\tfiles. Choose\tfrom\tthe\tdrop-down\tmenu\twhere\tyou\tpurchased\tthis\tbook from. Click\ton\tCode\tDownload.\n\nYou\tcan\talso\tdownload\tthe\tcode\tfiles\tby\tclicking\ton\tthe\tCode\tFiles button\ton\tthe\tbook's\twebpage\tat\tthe\tPackt\tPublishing\twebsite.\tThis page\tcan\tbe\taccessed\tby\tentering\tthe\tbook's\tname\tin\tthe\tSearch box.\tPlease\tnote\tthat\tyou\tneed\tto\tbe\tlogged\tin\tto\tyour\tPackt\taccount.\n\nOnce\tthe\tfile\tis\tdownloaded,\tplease\tmake\tsure\tthat\tyou\tunzip\tor extract\tthe\tfolder\tusing\tthe\tlatest\tversion\tof:\n\nWinRAR\t/\t7-Zip\tfor\tWindows Zipeg\t/\tiZip\t/\tUnRarX\tfor\tMac 7-Zip\t/\tPeaZip\tfor\tLinux\n\nSmart\tservices,\tdumb\tcommunication pipes\n\nHyper\tText\tTransfer\tProtocol\t(HTTP)\tis\tone\tof\tthe\tbest\tthings\tto\thave ever\thappened\tto\tthe\tInternet.\tImagine\ta\tprotocol\tthat\twas\tdesigned\tto be\tstate-less,\tbut\twas\thacked\tthrough\tthe\tuse\tof\tcookies\tin\torder\tto\thold the\tstatus\tof\tthe\tclient.\tThis\twas\tduring\tthe\tage\tof\tWeb\t1.0,\twhen\tno\tone was\ttalking\tabout\tREST\tAPIs\tor\tmobile\tapps.\tLet's\tsee\tan\texample\tof\tan HTTP\trequest:\n\nAs\tyou\tcan\tsee,\tit\tis\ta\thuman\treadable\tprotocol\tthat\tdoes\tnot\tneed\tto\tbe explained\tin\torder\tto\tbe\tunderstood.\n\nNowadays,\tit\tis\tbroadly\tunderstood\tthat\tHTTP\tis\tnot\tconfined\tto\tbe\tused in\tthe\tWeb,\tand\tas\tit\twas\tdesigned,\tit\tis\tnow\tused\tas\ta\tgeneral\tpurpose protocol\tto\ttransfer\tdata\tfrom\tone\tendpoint\tto\tanother.\tHTTP\tis\tall\tyou need\tfor\tthe\tcommunication\tbetween\tmicroservices:\ta\tprotocol\tto\ttransfer data\tand\trecover\tfrom\ttransmission\terrors\t(when\tpossible).\n\nIn\tthe\tpast\tfew\tyears,\tespecially\twithin\tthe\tenterprise\tworld,\tthere\thas been\tan\teffort\tto\tcreate\tsmart\tcommunication\tmechanisms\tsuch\tas BPEL.\tBPEL\tstands\tfor\tBusiness\tProcess\tExecution\tLanguage,\tand instead\tof\tfocusing\ton\tcommunication\tactions,\tit\tfocuses\ton\tactions around\tbusiness\tsteps.\n\nThis\tintroduces\tsome\tlevel\tof\tcomplexity\tin\tthe\tcommunication\tprotocol and\tmakes\tthe\tbusiness\tlogic\tof\tthe\tapplication\tbleed\tinto\tit\tfrom\tthe endpoints,\tcausing\tsome\tlevel\tof\tcoupling\tbetween\tthe\tendpoints.\n\nThe\tbusiness\tlogic\tshould\tstay\twithin\tthe\tendpoints\tand\tnot\tbleed\tinto the\tcommunication\tchannel\tso\tthat\tthe\tsystem\tcan\tbe\teasily\ttested\tand\n\nscaled.\tThe\tlesson\tlearned\tthrough\tthe\tyears\tis\tthat\tthe\tcommunication layer\tmust\tbe\ta\tplain\tand\tsimple\tprotocol\tthat\tensures\tthe\ttransmission of\tthe\tdata\tand\tthe\tendpoints\t(microservices).These\tendpoints\tshould embed\tinto\ttheir\timplementation\tthe\tfact\tthat\ta\tservice\tcould\tbe\tdown\tfor a\tperiod\tof\ttime\t(this\tis\tcalled\tresilience,\twe\twill\ttalk\tabout\tthis\tlater\tin\tthis chapter)\tor\tthe\tnetwork\tcould\tcause\tcommunication\tissues.\n\nHTTP\tusually\tis\tthe\tmost\tused\tprotocol\twhen\tbuilding\tmicroservices- oriented\tsoftware\tbut\tanother\tinteresting\toption\tthat\tneeds\tto\tbe\texplored is\tthe\tuse\tof\tqueues,\tsuch\tas\tRabbit\tMQ\tand\tKafka,\tto\tfacilitate\tthe communication\tbetween\tendpoints.\n\nThe\tqueueing\ttechnology\tprovides\ta\tclean\tapproach\tto\tmanage\tthe communication\tin\ta\tbuffered\tway,\tencapsulating\tthe\tcomplexities\tof acknowledging\tmessages\ton\thighly\ttransactional\tsystems.\n\nDecentralization\n\nOne\tof\tthe\tmajor\tcons\tof\tmonolithic\tapplications\tis\tthe\tcentralization\tof everything\ton\ta\tsingle\t(or\tfew)\tsoftware\tcomponents\tand\tdatabases. This,\tmore\toften\tthan\tnot,\tleads\tto\thuge\tdata\tstores\tthat\tneeds\tto\tbe replicated\tand\tscaled\taccording\tto\tthe\tneeds\tof\tthe\tcompany\tand centralized\tgovernance\tof\tthe\tflows.\n\nMicroservices\taim\tfor\tdecentralization.\tInstead\tof\thaving\ta\thuge database,\twhy\tnot\tsplit\tthe\tdata\taccording\tto\tthe\tbusiness\tunits explained\tearlier?\n\nSome\tof\tthe\treaders\tcould\tuse\tthe\ttransactionality\tas\tone\tof\tthe\tmain reasons\tfor\tnot\tdoing\tit.\tConsider\tthe\tfollowing\tscenario:\n\n1.\t A\tcustomer\tbuys\tan\titem\tin\tour\tmicroservices-oriented\tonline\tshop. 2.\t When\tpaying\tfor\tthe\titem,\tthe\tsystem\tissues\tthe\tfollowing\tcalls:\n\n1.\t A\tcall\tto\tthe\tfinancial\tsystem\tof\tthe\tcompany\tto\tcreate\ta transaction\twith\tthe\tpayment.\n\n2.\t A\tcall\tto\tthe\twarehouse\tsystem\tto\tdispatch\tthe\tbook. 3.\t A\tcall\tto\tthe\tmailing\tsystem\tto\tsubscribe\tthe\tcustomer\tto\tthe newsletter.\n\nIn\ta\tmonolithic\tsoftware,\tall\tthe\tcalls\twould\tbe\twrapped\tin\ta\ttransaction, so\tif,\tfor\tsome\treason,\tany\tof\tthe\tcalls\tfails,\tthe\tdata\ton\tthe\tother\tcalls won't\tbe\tpersisted\tin\tthe\tdatabase.\n\nWhen\tyou\tlearn\tabout\tdesigning\tdatabases,\tone\tof\tthe\tfirst\tand\tthe\tmost important\tprinciples\tare\tsummarized\tby\tthe\tACID\tacronym:\n\nAtomicity:\tEach\ttransaction\twill\tbe\tall\tor\tnothing.\tIf\tone\tpart\tfails,\tno changes\tare\tpersisted\ton\tthe\tdatabase. Consistency:\tChanges\tto\tthe\tdata\tthrough\ttransactions\tneed\tto guarantee\tits\tconsistency. Isolation:\tThe\tresult\tof\tconcurrent\texecution\tof\ttransactions\tresults in\ta\tsystem\tstate\tthat\twould\tbe\tobtained\tif\tthe\ttransactions\twere executed\tserially. Durability:\tOnce\tthe\ttransaction\tis\tcommitted,\tthe\tdata\tpersists.\n\nOn\ta\tmicroservices-oriented\tsoftware,\tthe\tACID\tprinciple\tis\tnot guaranteed\tglobally.\tMicroservices\twill\tcommit\tthe\ttransaction\tlocally,\tbut there\tare\tno\tmechanisms\tthat\tcan\tguarantee\ta\t100%\tintegrity\tof\tthe global\ttransaction.\tIt\twould\tbe\tpossible\tto\tdispatch\tthe\tbook\twithout processing\tthe\tpayment,\tunless\twe\tfactor\tin\tspecific\trules\tto\tprevent\tit.\n\nOn\ta\tmicroservices-oriented\tarchitecture,\tthe\ttransactionality\tof\tthe\tdata is\tnot\tguaranteed,\tso\twe\tneed\tto\tfactor\tthe\tfailure\tinto\tthe implementation.\tA\tway\tto\tsolve\t(although,\tworkaround\tis\ta\tmore appropriate\tword)\tthis\tproblem\tis\tdecentralizing\tthe\tgovernance\tand\tdata storage.\n\nWhen\tbuilding\tmicroservices,\twe\tneed\tto\tembed\tin\tthe\tdesign,\tthe\tfact that\tone\tor\tmore\tcomponents\tcould\tfail\tand\tdegrade\tthe\tfunctionality according\tto\tthe\tavailability\tof\tthe\tsoftware.\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\tdiagram:\n\nThis\tdiagram\trepresents\tthe\tsequence\tof\texecution\ton\ta\tmonolithic software.\tA\tsequential\tlist\tof\tcalls\tthat,\tno\tmatter\twhat,\tare\tgoing\tto\tbe executed\tfollowing\tthe\tACID\tprinciple:\teither\tall\tthe\tcalls\t(transactions) succeed\tor\tnone\tof\tthem\tdo.\n\nThis\tis\tonly\tpossible\tas\tthe\tframework\tand\tdatabase\tengine\tdesigners have\tdeveloped\tthe\tconcept\tof\ttransactions\tto\tguarantee\tthe transactionality\tof\tthe\tdata.\n\nWhen\tworking\twith\tmicroservices,\twe\tneed\tto\taccount\tfor\twhat\tthe engineers\tcall\teventual\tconsistency.\tAfter\ta\tpartial\tfail\ton\ta\ttransaction, each\tmicroservice\tinstance\tshould\tstore\tthe\tinformation\trequired\tto recover\tthe\ttransaction\tso\tthat\tthe\tinformation\twill\tbe\teventually consistent.\tFollowing\tthe\tprevious\texample,\tif\twe\tsend\tthe\tbook\twithout processing\tthe\tpayment,\tthe\tpayment\tgateway\twill\thave\ta\tfailed transaction\tthat\tsomeone\twill\tprocess\tlater\ton,\tmaking\tthe\tdata consistent\tagain.\n\nThe\tbest\tway\tto\tsolve\tthis\tproblem\tis\tdecentralizing\tthe\tgovernance. Every\tendpoint\tshould\tbe\table\tto\ttake\ta\tlocal\tdecision\tthat\taffects\tthe global\tscope\tof\tthe\ttransaction.\tWe\twill\ttalk\tmore\tabout\tthis\tsubject\tin\n\nChapter\t3,\tFrom\tthe\tMonolith\tto\tMicroservices.\n\nTechnology\talignment\n\nWhen\tbuilding\ta\tnew\tsoftware,\tthere\tis\talways\ta\tconcept\tthat\tevery developer\tshould\tkeep\tin\tmind:\tstandards.\n\nStandards\tguarantee\tthat\tyour\tservice\twill\tbe\ttechnologically independent\tso\tthat\tit\twill\tbe\teasy\tto\tbuild\tthe\tintegrations\tusing\ta different\tprogramming\tlanguage\tor\ttechnologies.\n\nOne\tof\tthe\tadvantages\tof\tmodeling\ta\tsystem\twith\tmicroservices\tis\tthat we\tcan\tchoose\tthe\tright\ttechnology\tfor\tthe\tright\tjob\tso\tthat\twe\tcan\tbe quite\tefficient\twhen\ttackling\tproblems.\tWhen\tbuilding\tmonolithic software,\tit\tis\tfairly\thard\tto\tcombine\ttechnologies\tlike\twe\tcan\tdo\twith microservices.\tUsually,\tin\ta\tmonolithic\tsoftware,\twe\tare\ttied\tto\tthe technology\tthat\twe\tchoose\tin\tthe\tbeginning.\n\nJava\tRemote\tMethod\tInvocation\t(RMI)\tis\tone\texample\tof\tthe\tnon- standard\tprotocols\tthat\tshould\tbe\tavoided\tif\tyou\twant\tyour\tsystem\tto\tbe open\tto\tnew\ttechnologies.\tIt\tis\ta\tgreat\tway\tof\tconnecting\tsoftware components\twritten\tin\tJava,\tbut\tthe\tdevelopers\twill\tstruggle\t(if\tnot\tfail)\tto invoke\tan\tRMI\tmethod\tusing\tNode.js.\tThis\twill\ttie\tour\tarchitecture\tto\ta given\tlanguage,\twhich\tfrom\tthe\tmicroservices\tpoint\tof\tview,\twill\tkill\tone\tof the\tmost\tinteresting\tadvantages:\ttechnology\theterogeneity.\n\nHow\tsmall\tis\ttoo\tsmall?\n\nOnce\twe\thave\tdecided\tto\tmodel\tour\tsystem\tas\ta\tset\tof\tmicroservices, there\tis\talways\tone\tquestion\tthat\tneeds\tan\tanswer:\thow\tsmall\tis\ttoo small?\n\nThe\tanswer\tis\talways\ttricky\tand\tprobably\tdisappointing:\tit\tdepends.\n\nThe\tright\tsize\tof\tthe\tmicroservices\tin\ta\tgiven\tsystem\tdepends\ton\tthe structure\tof\tthe\tcompany\tas\twell\tas\tthe\tability\tto\tcreate\tsoftware components\tthat\tare\teasily\tmanageable\tby\ta\tsmall\tteam\tof\tdevelopers.\tIt also\tdepends\ton\tthe\ttechnical\tneeds.\n\nImagine\ta\tsystem\tthat\treceives\tand\tprocesses\tbanking\tfiles;\tas\tyou\tare probably\taware,\tall\tthe\tpayments\tbetween\tbanks\tare\tsent\tin\tfiles\twith\ta specific\tknown\tformat\t(such\tas\tSingle\tEuro\tPayments\tArea\t(SEPA)\tfor Euro\tpayments).\tOne\tof\tthe\tparticularities\tof\tthis\ttype\tof\tsystems\tis\tthe large\tnumber\tof\tdifferent\tfiles\tthat\tthe\tsystem\tneeds\tto\tknow\thow\tto process.\n\nThe\tfirst\tapproach\tfor\tthis\tproblem\tis\ttackling\tit\tfrom\tthe\tmicroservices point\tof\tview,\tseparating\tit\tfrom\tany\tother\tservice\tcreating\ta\tunit\tof\twork, and\tcreating\tone\tmicroservice\tfor\teach\ttype\tof\tfile.\tIt\twill\tenable\tus\tto\tbe able\tto\trollout\tmodifications\tfor\tthe\texisting\tfile\tprocessors\twithout interfering\twith\tthe\trest\tof\tthe\tsystem.\tIt\twill\talso\tenable\tus\tto\tkeep processing\tfiles\teven\tthough\tone\tof\tthe\tservices\tis\texperiencing problems.\n\nThe\tmicroservices\tshould\tbe\tas\tsmall\tas\tneeded,\tbut\tkeep\tin\tmind\tthat every\tmicroservice\tadds\tan\toverhead\tto\tthe\toperations\tteam\tthat\tneeds to\tmanage\ta\tnew\tservice.\tTry\tto\tanswer\tthe\tquestion\thow\tsmall\tis\ttoo small?\tin\tterms\tof\tmanageability,\tscalability,\tand\tspecialization.\tThe microservice\tshould\tbe\tsmall\tenough\tto\tbe\tmanaged\tand\tscaled\tup\t(or down)\tquickly\twithout\taffecting\tthe\trest\tof\tthe\tsystem,\tby\ta\tsingle\tperson; and\tit\tshould\tdo\tonly\tone\tthing.\n\nTip\n\nAs\ta\tgeneral\trule,\ta\tmicroservice\tshould\tbe\tsmall\tenough\tto\tbe completely\trewritten\tin\ta\tsprint.\n\nKey\tbenefits\n\nIn\tthe\tprevious\ttopic,\twe\ttalked\tabout\twhat\ta\tmicroservices-oriented architecture\tis.\tI\talso\texposed\tthe\tdesign\tprinciples\tthat\tI\thave\tlearned from\texperience,\tas\twell\tas\tshowed\ta\tfew\tbenefits\tof\tthis\ttype\tof architecture.\n\nNow,\tit\tis\ttime\tto\toutline\tthese\tkey\tbenefits\tand\tshow\thow\tthey\twill\thelp us\tto\timprove\tthe\tquality\tof\tour\tsoftware,\tas\twell\tas\tbe\table\tto\tquickly accommodate\tthe\tnew\tbusiness\trequirements.\n\nResilience\n\nResilience\tis\tdefined\tin\tWikipedia\tas\tthe\tability\tof\ta\tsystem\tto\tcope\twith change.\tI\tlike\tto\tthink\tabout\tresilience\tas\tthe\tability\tof\ta\tsystem\tto gracefully\trecover\tfrom\tan\texception\t(transitory\thardware\tfailure, unexpectedly\thigh\tnetwork\tlatency,\tand\tso\ton)\tor\ta\tstress\tperiod\twithout affecting\tthe\tperformance\tof\tthe\tsystem\tonce\tthe\tsituation\thas\tbeen resolved.\n\nAlthough\tit\tsounds\tsimple,\twhen\tbuilding\tmicroservices-oriented software,\tthe\tsource\tof\tproblems\tbroadens\tdue\tto\tthe\tdistributed\tnature of\tthe\tsystem,\tsometimes\tmaking\tit\thard\t(or\teven\timpossible)\tto\tprevent all\tabnormal\tsituations.\n\nResilience\tis\tthe\tability\tto\tgracefully\trecover\tfrom\terrors.\tIt\talso\tadds another\tlevel\tof\tcomplexity:\tif\tone\tmicroservice\tis\texperiencing\tproblems, can\twe\tprevent\ta\tgeneral\tfailure?\tIdeally,\twe\tshould\tbuild\tour\tsystem\tin\ta way\tthat\tthe\tservice\tresponse\tis\tdegraded\tinstead\tof\tresulting\tin\ta general\tfailure,\talthough\tthis\tis\tnot\talways\teasy.\n\nScalability\n\nNowadays,\tone\tof\tthe\tcommon\tproblems\tin\tcompanies\tis\tthe\tscalability of\tthe\tsystems.\tIf\tyou\thave\tworked\ton\ta\tmonolithic\tsoftware\tbefore,\tI\tam sure\tthat\tyou\thave\texperienced\tcapacity\tproblems\tat\tsome\tpoint, alongside\tthe\tgrowth\tof\tthe\tcompany.\n\nUsually,\tthese\tproblems\tare\tnot\tacross\tall\tthe\tlayers\tor\tsubsystems\tof the\tapplication.\tThere\tis\talways\ta\tsubsystem\tor\tservice\tthat\tperforms significantly\tslower\tthan\tthe\trest,\tcausing\tthe\tentire\tapplication\tto\tfail\tif\tit is\tnot\table\tto\tcope\twith\tthe\tdemand.\n\nThe\tfollowing\tdiagram\tdescribes\thow\ta\tmicroservice\tcan\tbe\tscaled\tup (two\tmailing\tservices)\twithout\tinterfering\twith\tthe\trest\tof\tthe\tsystem:\n\nTip\n\nAn\texample\tof\tthese\tweak\tpoints\tin\tthe\tworld\tof\tcar\tinsurance\tis\tthe service\tthat\tcalculates\tthe\tquote\tfor\ta\tgiven\tlist\tof\trisk\tfactors.\tWould it\tmake\tsense\tto\tscale\tthe\tfull\tapplication\tjust\tto\tsatisfy\tthe\tdemand\n\nfor\tthis\tparticular\tpart?\tIf\tthe\tanswer\tthat\tyou\thave\tin\tmind\tis\tno,\tyou are\tone\tstep\tcloser\tto\tembracing\tmicroservices.\tMicroservices\tenable you\tto\tscale\tparts\tof\tthe\tsystem\tas\tthe\tdemand\tramps\tup\tfor\ta particular\tarea\tof\tit.\n\nIf\tour\tinsurance\tsystem\twas\ta\tmicroservice-oriented\tsoftware,\tthe\tonly thing\tneeded\tto\tresolve\tthe\thigh\tdemand\tfor\tquote\tcalculations\twould've been\tto\tspawn\tmore\tinstances\tof\tthe\tmicroservice\t(or\tmicroservices) responsible\tfor\ttheir\tcalculation.\tPlease\tbear\tin\tmind\tthat\tscaling\tup services\tcould\tadd\tan\toverhead\tfor\toperating\tthem.\n\nTechnology\theterogeneity\n\nThe\tworld\tof\tsoftware\tis\tchanging\tevery\tfew\tmonths.\tNew\tlanguages\tare coming\tto\tthe\tindustry\tas\ta\tde\tfacto\tstandard\tfor\ta\tcertain\ttype\tof systems.\tA\tfew\tyears\tago,\tRuby\ton\tRails\tappeared\tat\tthe\tscene\tand\trose as\tone\tof\tthe\tmost\tused\tweb\tframeworks\tfor\tnew\tprojects\tin\t2013. Golang\t(a\tlanguage\tcreated\tby\tGoogle)\tis\tbecoming\ta\ttrend\tnowadays as\tit\tcombines\thuge\tperformance\twith\tan\telegant\tand\tsimple\tsyntax\tthat can\tbe\tlearned\tby\tanyone\twith\tsome\texperience\tin\tanother\tprogramming language\tin\ta\tmatter\tof\tdays.\n\nIn\tthe\tpast,\tI\thave\tused\tPython\tand\tJava\tas\tsuccessful\talternatives\tto write\tmicroservices.\n\nJava\tespecially,\tsince\tSpring\tBoot\twas\treleased,\tis\tan\tattractive technology\tstack\tto\twrite\tagile\t(to\twrite\tand\toperate)\tmicroservices.\n\nDjango,\tis\talso\ta\tpowerful\tframework\ton\tPython\tto\twrite\tmicroservices. Being\tvery\tsimilar\tto\tRuby\ton\tRails,\tit\tautomates\tdatabase\tmigrations and\tmakes\tthe\tcreation\tof\tCRUD\t(Create\tRead\tUpdate\tDelete)\tservices an\tincredibly\teasy\ttask.\n\nNode.js\ttook\tthe\tadvantage\tof\ta\twell-known\tlanguage,\tJavaScript,\tto create\ta\tnew\tserver-side\tstack\tthat\tis\tchanging\tthe\tway\tengineers\tcreate new\tsoftware.\n\nSo,\twhat\tis\twrong\tin\tcombining\tall\tof\tthem?\tIn\tall\tfairness,\tit\tis\tan\n\nadvantage:\twe\tcan\tchoose\tthe\tright\ttool\tfor\tthe\tright\tjob.\n\nMicroservices-oriented\tarchitectures\tenable\tyou\tto\tdo\tit,\tas\tlong\tas\tthe integration\ttechnologies\tare\tstandard.\tAs\tyou\tlearned\tbefore,\ta microservice\tis\ta\tsmall\tand\tindependent\tpiece\tof\tsoftware\tthat\tcan operate\tby\titself.\n\nThe\tfollowing\tdiagram\tshows\thow\tthe\tmicroservices\thide\tdata storage/gathering,\thaving\tonly\tthe\tcommunication\tpoints\tin\tcommon— making\tthem\ta\tgood\texample\tof\tlow\tcoupling\t(one\tservice implementation\tchange\twon't\tinterfere\twith\tany\tother\tservice):\n\nWe\thave\ttalked\tabout\tperformance\tearlier.\tThere\tare\talways\tparts\tof\tour systems\tthat\tare\tunder\tmore\tpressure\tthan\tothers.\tWith\tmodern multicore\tCPUs,\tparallel\t(concurrent)\tprogramming\tcould\tsolve\tsome\tof these\tperformance\tissues,\thowever,\tNode.js\tis\tnot\ta\tgood\tlanguage\tto parallelize\ttasks.\tWe\tcould\tchoose\tto\trewrite\tthe\tmicroservice\tunder pressure\tusing\ta\tmore\tappropriate\tlanguage,\tsuch\tas\tErlang,\tto\tmanage concurrency\tin\ta\tmore\telegant\tway.\tIt\tshould\ttake\tno\tmore\tthan\ttwo weeks\tto\tdo\tit.\n\nThere\tis\ta\tdownside\tto\tusing\tmultiple\ttechnologies\ton\tthe\tsame\tsystem: the\tdevelopers\tand\tsystem\tadministrators\tneed\tto\tknow\tall\t(or\ta\tfew)\tof them.\tCompanies\tthat\tembraced\tmicroservices\tusually\ttry\tto\tstick\twith one\tcore\ttechnology\t(in\tthis\tbook,\twe\twill\tbe\tusing\tNode.js)\tand\tsome auxiliary\ttechnologies\t(although\twe\twill\tbe\tusing\tDocker\tto\tmanage\tthe deployments,\twe\tcould\tuse\tCapistrano\tor\tFabricator\tto\tmanage\tthe releases).\n\nReplaceability\n\nReplaceability\tis\tthe\tability\tto\tchange\tone\tcomponent\tof\ta\tsystem\twithout interfering\twith\thow\tthe\tsystem\tbehaves.\n\nWhen\ttalking\tabout\tsoftware,\treplaceability\tcomes\talong\twith\tlow coupling.\tWe\tshould\tbe\twriting\tour\tmicroservices\tin\ta\tway\tthat\tthe internal\tlogic\twill\tnot\tbe\texposed\tto\tthe\tcalling\tservices\tso\tthat\tthe\tclients of\ta\tgiven\tservice\tdo\tnot\tneed\tto\tknow\tabout\thow\tit\tis\timplemented,\tjust the\tinterface.\tLet's\ttake\ta\tlook\tat\tthe\tfollowing\texample.\tIt\tis\twritten\tin Java\tas\twe\tonly\tneed\tto\tsee\tthe\tinterface\tto\tidentify\tthe\tpitfalls:\n\npublic\tinterface\tGeoIpService\t{ \t\t/** \t\t\t\tChecks\tif\tan\tIP\tis\tin\tthe\tcountry\tgiven\tby\tan\tISO\t code. \t\t\t*/ \t\tboolean\tisIn(String\tip,\tString\tisoCode)\tthrows\t SOAPFaultException; }\n\nThis\tinterface,\tat\tfirst\tlook,\tis\tself\texplanatory.\tIt\tchecks\twhether\ta\tgiven IP\tis\tin\ta\tgiven\tcountry\tand\tthrows\ta\tSOAPFaultException,\twhich\tis\ta\tbig\n\nproblem.\n\nIf\twe\tbuild\tthe\tclient\tthat\tconsumes\tthis\tservice,\tfactoring\tinto\ttheir\tlogic, capture,\tand\tprocessing\tof\tthe\tSoapFaultException,\twe\tare\texposing internal\timplementation\tdetails\tto\tthe\touter\tworld\tand\tmaking\tit\thard\tto replace\tthe\tGeoIpService\tinterface.\tAlso,\tthe\tfact\tthat\twe\tare\tcreating\ta service\trelated\tto\ta\tpart\tof\tour\tapplication\tlogic\tis\tan\tindication\tof\tthe creation\tof\ta\tbounded\tcontext:\ta\thighly\tcohesive\tservice\tor\tset\tof services\tthat\twork\ttogether\tto\tachieve\tone\tpurpose.\n\nIndependence\n\nNo\tmatter\thow\thard\twe\ttry,\tthe\thuman\tbrain\tis\tnot\tdesigned\tto\tsolve complex\tproblems.\tThe\tmost\tefficient\tmode\tof\tfunctioning\tfor\tthe\thuman brain\tis\tone\tthing\tat\tthe\ttime\tso\tthat\twe\tbreak\tdown\tcomplex\tproblems into\tsmaller\tones.\tMicroservices-oriented\tarchitectures\tshould\tfollow\tthis approach:\tall\tthe\tservices\tshould\tbe\tindependent\tand\tinteract\tthrough the\tinterface\tup\tto\ta\tpoint\tthat\tthey\tcan\tbe\tdeveloped\tby\tdifferent\tgroups of\tengineers\twithout\tany\tinteraction,\taside\tfrom\tagreeing\tthe\tinterfaces. This\twill\tenable\ta\tcompany\tadopting\tmicroservices\tto\tscale\tup,\tor\tdown, the\tengineering\tteams,\tdepending\ton\tthe\tbusiness\tneeds,\tmaking\tthe business\tagile\tin\tresponding\tto\tpeaks\tof\tdemand\tor\tperiods\tof\tquietness.\n\nWhy\tis\treplaceability\timportant?\n\nIn\ta\tprevious\tsection,\twe\ttalked\tabout\tthe\tright\tsize\tof\ta\tmicroservice.\tAs a\tgeneral\trule\tof\tthumb,\ta\tteam\tshould\tbe\table\tto\trewrite\tand\tdeploy\ta microservice\tin\ta\tsprint.\tThe\treason\tbehind\tit\tis\tthe\ttechnical\tdebt.\n\nI\twould\tdefine\ttechnical\tdebt\tas\tthe\tdeviation\tfrom\tthe\toriginal\ttechnical design\tto\tdeliver\tthe\texpected\tfunctionality\twithin\ta\tplanned\tdeadline. Some\tof\tthese\tsacrifices\tor\twrong\tassumptions\toften\tlead\tto\tpoorly written\tsoftware\tthat\tneeds\tto\tbe\tcompletely\trefactored\tor\trewritten.\n\nIn\tthe\tpreceding\texample,\tthe\tinterface\tis\texposing\tto\tthe\touter\tworld\tthe fact\tthat\twe\tare\tusing\tSOAP\tto\tcall\ta\tweb\tservice,\tbut\twe\twill\tneed\tto change\tthe\tcode\ton\tthe\tclient\tside\tas\ta\tREST\tclient\thas\tcertainly\tnothing to\tdo\twith\tSOAP\texceptions.\n\nEasy\tto\tdeploy\n\nMicroservices\tshould\tbe\teasy\tto\tdeploy.\n\nBeing\tsoftware\tdevelopers,\twe\tare\twell\taware\tthat\ta\tlot\tof\tthings\tcould go\twrong,\tpreventing\ta\tsoftware\tfrom\tbeing\tdeployed.\n\nMicroservices,\tas\tstated\tbefore,\tshould\tbe\teasy\tto\tdeploy\tfor\ta\tnumber\tof reasons,\tas\tstated\tin\tthe\tfollowing\tlist:\n\nSmall\tamount\tof\tbusiness\tlogic\t(remember\tthe\ttwo\tweeks\trewrite from\tscratch\trule\tof\tthumb)\tleading\tinto\tsimpler\tdeployments. Microservices\tare\tautonomous\tunits\tof\twork,\tso\tupgrading\ta\tservice is\ta\tcontained\tproblem\ton\ta\tcomplex\tsystem.\tNo\tneed\tto\tre-deploy the\tentire\tsystem. Infrastructure\tand\tconfiguration\ton\tmicroservices\tarchitectures should\tbe\tautomated\tas\tmuch\tas\tpossible.\tLater\tin\tthe\tbook,\twe\twill learn\thow\tto\tuse\tDocker\tto\tdeploy\tmicroservices\tand\twhat\tare\tthe benefits\tover\tthe\ttraditional\tdeployment\ttechniques\tare.\n\nSOA\tversus\tmicroservices\n\nService-Oriented\tArchitectures\t(SOA)\thas\tbeen\taround\tfor\ta\tnumber of\tyears.\tSOA\tis\ta\tgreat\tprinciple\tto\tdesign\tsoftware.\tThey\tare\tself- contained\tcomponents\tproviding\tservices\tto\tother\tcomponents.\tAs\twe agreed\tbefore,\tit\tis\tall\tabout\tmaintaining\tlow\tcoupling\ton\tthe\tdifferent modules\tof\tthe\tsystem\tas\tif\tit\twas\ta\tpuzzle\tso\tthat\twe\tcan\treplace\tthe pieces\twithout\tcausing\ta\tbig\timpact\ton\tthe\toverall\tsystem.\n\nIn\tprinciple,\tSOA\tlooks\tvery\tsimilar\tto\tmicroservices\tarchitectures.\tSo what\tis\tthe\tdifference?\n\nMicroservices\tare\tfine-grained\tSOA\tcomponents.\tIn\tother\twords,\ta\tsingle SOA\tcomponent\tcan\tbe\tdecomposed\tin\ta\tnumber\tof\tmicroservices\tthat can\twork\ttogether\tin\torder\tto\tprovide\tthe\tsame\tlevel\tof\tfunctionality:\n\nTip\n\nMicroservices\tare\tfine-grained\tSOA\tcomponents.\tThey\tare lightweight\tservices\twith\ta\tnarrow\tfocus.\n\nAnother\tdifference\tbetween\tmicroservices\tand\tSOA\tis\tthe\ttechnologies used\tfor\tinterconnecting\tand\twriting\tthe\tservices.\n\nJ2EE\tis\ta\ttechnology\tstack\tthat\twas\tdesigned\tto\twrite\tSOA\tarchitectures as\tit\tenforced\tenterprise\tstandards.\tJava\tNaming\tand\tDirectory\tInterface, Enterprise\tJava\tBeans,\tand\tEnterprise\tService\tBus\t(ESB)\twere\tthe ecosystems\twhere\tSOA\tapplications\twere\tbuilt\tand\tmaintained.\tAlthough ESB\tis\ta\tstandard,\tvery\tfew\tengineers\twho\tgraduated\tafter\t2005\thave heard\tabout\tESB,\teven\tfewer\thave\tused\tit,\tand\tnowadays\tthe\tmodern frameworks\tsuch\tas\tRuby\ton\tRails\tdo\tnot\teven\tconsider\tsuch\tcomplex pieces\tof\tsoftware.\n\nOn\tthe\tother\thand,\tmicroservices\tenforce\tthe\tuse\tof\tstandards\t(such\tas HTTP)\tthat\tare\tbroadly\tknown\tand\tbroadly\tinteroperable.\tWe\tcan\tchoose the\tright\tlanguage\tor\ttool\tto\tbuild\ta\tcomponent\t(microservice)\tfollowing one\tof\tthe\tkey\tbenefits\texplained\tearlier\tin\tthis\tchapter,\tin\tthe\tTechnology heterogeneity\tsection.\n\nAside\tfrom\tthe\ttechnology\tstack\tand\tthe\tsize\tof\tthe\tservices,\tthere\tis\tan even\tbigger\tdifference\tbetween\tSOA\tand\tmicroservices:\tthe\tdomain model.\tEarlier\tin\tthis\tchapter,\twe\thave\ttalked\tabout\tdecentralization. Decentralization\tof\tthe\tgovernance,\tbut,\tmoreover,\tdecentralization\tof\tthe data.\tIn\ta\tmicroservices-based\tsoftware,\tevery\tmicroservice\tshould\tstore its\town\tdata\tlocally,\tisolating\tthe\tdomain\tmodels\tto\ta\tsingle\tservice; whereas,\ton\tan\tSOA\toriented-software,\tthe\tdata\tis\tusually\tstored\tin\ta\tfew big\tdatabases\tand\tthe\tservices\tshare\tthe\tdomain\tmodels.\n\nWhy\tNode.js?\n\nA\tfew\tyears\tago,\tI\tdidn't\tbelieve\tin\tNode.js.\tTo\tme,\tit\twas\ta\ttrend\tmore than\ta\treal\ttool\tto\tsolve\tproblems…\tJavaScript\tin\tthe\tserver?\tThat\tdidn't look\tright.\tIn\tall\tfairness,\tI\tdidn't\teven\tlike\tJavaScript.\tThen,\tthe\tmodern frameworks\tsuch\tas\tjQuery\tor\tAngular.js\tcame\tto\tthe\trescue.\tThey solved\tone\tof\tthe\tproblems,\twhich\twas\tthe\tcross-browser\tcompatibility. Where\tbefore\twe\tneeded\tto\tfactor\tin\tat\tleast\tthree\tdifferent\tbrowsers, after\tjQuery\tall\tthis\tlogic\twas\tnicely\tencapsulated\tin\ta\tlibrary\tso\tthat\twe didn't\tneed\tto\tworry\tabout\tcompatibility\tas\tlong\tas\twe\tfollowed\tthe\tjQuery documentation.\n\nThen,\tJavaScript\tbecame\tmore\tpopular.\tSuddenly,\tall\tthe\tinternal\ttools were\twritten\twith\tSingle-Page\tApplication\t(SPA)\tframeworks\twith\ta heavy\tusage\tof\tJavaScript,\ttherefore,\tthe\tmajority\tof\tdevelopers nowadays,\tone\tway\tor\tanother,\tare\tproficient\tin\tJavaScript.\n\nThen,\tsomeone\tdecided\tto\ttake\tJavaScript\tout\tof\tthe\tbrowser,\twhich\twas a\tgreat\tidea.\tRhino,\tNode.js,\tand\tNashorn\tare\texamples\tof\truntimes\tthat can\texecute\tstandalone\tJavaScript.\tSome\tof\tthem\tcan\teven\tinteract\twith the\tJava\tcode,\tenabling\tthe\tdeveloper\tto\timport\tJava\tclasses\tinto\ta JavaScript\tprogram,\twhich\tgives\tyou\tthe\taccess\tto\tan\tendless\tset\tof frameworks\talready\twritten\tin\tJava.\n\nLet's\tfocus\ton\tNode.js.\tNode.js\tis\tthe\tperfect\tcandidate\tfor microservices-oriented\tarchitectures\tfor\ta\tnumber\tof\treasons,\tas\tstated in\tthe\tfollowing\tlist:\n\nEasy\tto\tlearn\t(although\tit\tcan\tbe\thard\tto\tmaster) Easy\tto\tscale Highly\ttestable Easy\tto\tdeploy Dependency\tmanagement\tthrough\tnpm There\tare\thundreds\tof\tlibraries\tto\tintegrate\twith\tthe\tmajority\tof standard\tprotocols\n\nThese\treasons,\talong\twith\tothers\tthat\twe\twill\tdevelop\tin\tthe\tfollowing chapters,\tmake\tNode.js\tthe\tperfect\tcandidate\tfor\tbuilding\tsolid\n\nmicroservices.\n\nAPI\taggregation\n\nSeneca\tis\tthe\tframework\tthat\tI\thave\tchosen\tfor\tdevelopment\tin\tthe following\tchapters.\tOne\tof\tthe\tmost\tattractive\tcharacteristics\tof\tSeneca\tis API\taggregation.\n\nAPI\taggregation\tis\tan\tadvanced\ttechnique\tto\tcompose\tan\tinterface\tby aggregating\tdifferent\tfunctionalities\t(plugins,\tmethods,\tand\tso\ton)\tto\tit.\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\texample:\n\nvar\texpress\t=\trequire('express'); var\tapp\t=\texpress();\n\napp.get('sayhello',\tfunction\t(req,\tres)\t{ \t\tres.send('Hello\tWorld!'); }); app.get('saygoodbye',\tfunction(req,\tres)\t{ \t\tres.send('Bye\tbye!'); });\n\nvar\tserver\t=\tapp.listen(3000,\tfunction\t()\t{ \t\tvar\thost\t=\tserver.address().address; \t\tvar\tport\t=\tserver.address().port; \t\tconsole.log('App\tlistening\tat\thttp://%s:%s',\thost,\t port); });\n\nThe\tpreceding\texample\tuses\tExpress,\ta\tvery\tpopular\tweb\tframework\tfor Node.js.\tThis\tframework\tis\talso\tbuilt\taround\tthe\tAPI\taggregation technique.\tLet's\ttake\ta\tlook\tat\tthe\tfourth\tand\tseventh\tlines.\tIn\tthese\tlines, the\tdeveloper\tregisters\ttwo\tmethods\tthat\tare\tto\tbe\texecuted\twhen someone\thits\tthe\tURLs\t/sayhello\tand\t/saygoodbye\twith\ta\tGET\trequest. In\tother\twords,\tthe\tapplication\tis\tcomposed\tof\tdifferent\tsmaller\tand independent\timplementations\tthat\tare\texposed\tto\tthe\touter\tworld\ton\ta single\tinterface,\tin\tthis\tcase,\tan\tapp\tlistening\ton\tthe\t3000\tport.\n\nIn\tthe\tfollowing\tchapters,\tI\twill\texplain\twhy\tthis\tproperty\tis\timportant\tand how\tto\ttake\tadvantage\tof\tit\twhen\tbuilding\t(and\tscaling)\tmicroservices.\n\nThe\tfuture\tof\tNode.js\n\nJavaScript\twas\tfirst\tdesigned\tto\tbe\ta\tlanguage\texecuted\tin\tthe\tweb browser.\tFor\tthose\twho\tworked\tor\tstudied,\tusing\tC/C++\twas\tvery\tfamiliar and\tthat\twas\tthe\tkey\tfor\tits\tadoption\tas\ta\tstandard\tfor\tthe\tdynamic manipulation\tof\tdocuments\tin\tWeb\t2.0.\tAsynchronous\tJavaScript\tand XML\t(AJAX)\twas\tthe\tdetonator\tfor\tJavaScript\tgrowth.\tDifferent\tbrowsers had\tdifferent\timplementations\tof\tthe\trequest\tobjects\tso\tthat\tthe developers\thad\ta\thard\ttime\tto\twrite\ta\tcross-browser\tcode.\n\nThe\tlack\tof\tstandards\tled\tto\tthe\tcreation\tof\tmany\tframeworks\tthat encapsulated\tthe\tlogic\tbehind\tAJAX,\tmaking\teasy-to-write\tcross-browser scripts.\n\nJavaScript\tis\ta\tscript\tlanguage.\tIt\twas\tnot\tdesigned\tto\tbe\tobject\toriented, neither\twas\tit\tdesigned\tto\tbe\tthe\tlanguage\tof\tchoice\tfor\tlarge applications\tas\tthe\tcode\ttends\tto\tget\tchaotic\tand\tit\tis\thard\tto\tenforce standards\tacross\tdifferent\tcompanies\ton\thow\tthe\tcode\tshould\tbe\tlaid out.\tEvery\tsingle\tcompany\twhere\tI\tworked\thas\tdifferent\tbest\tpractices and\tsome\tof\tthem\tare\teven\tcontradictory.\n\nEuropean\tComputer\tManufacturers\tAssociation\t(ECMA)\tcame\tto\tthe rescue.\tECMAScript\t6,\tthe\tnext\tstandard\tfor\tECMA\tlanguages (JavaScript,\tActionScript,\tRhino,\tand\tso\ton)\tintroduces\tthe\tconcept\tof classes,\tinheritance,\tcollections,\tand\ta\tnumber\tof\tinteresting\tfeatures that\twill\tmake\tthe\tdevelopment\tof\tJavaScript\tsoftware\teasier\tand\tmore standard\tthan\tthe\tactual\tV8\tspecification.\n\nOne\tof\tthese\tfeatures\tthat\tI\tconsider\tmore\tinteresting\tis\tthe\tintroduction of\tthe\tclass\tkeyword\tthat\tallows\tus\tto\tmodel\tour\tJavaScript\tsoftware\twith objects.\n\nAt\tthe\tmoment,\tthe\tmajority\tof\tbrowsers\tsupport\ta\tlarge\tnumber\tof\tthese features,\tbut\twhen\tit\tcomes\tto\tNode.js,\tonly\ta\tfew\tof\tthem\tare implemented\tby\tdefault\tand\tsome\tof\tthem\tare\timplemented\tby\tpassing special\tflags\tto\tthe\tinterpreter\t(harmony\tflags).\n\nIn\tthis\tbook,\tI\twill\ttry\tto\tavoid\tthe\tECMAScript\t6\tfeatures,\tsticking\tto\tthe V8\tspecification\tas\tit\tis\twidely\tknown\tby\tthe\tmajority\tof\tdevelopers\tand,\n\nonce\tsomeone\tknows\tJavaScript\tV8,\tit\tis\tfairly\teasy\tto\tramp\tup\ton ECMAScript\t6.\n\nSummary\n\nIn\tthis\tchapter,\twe\tstudied\tthe\tkey\tconcepts\taround\tmicroservices,\tas well\tas\tthe\tbest\tpractices\tto\tbe\tfollowed\twhen\tdesigning\thigh-quality software\tcomponents\ttowards\tbuilding\trobust\tand\tresilient\tsoftware architectures\tthat\tenable\tus\tto\trespond\tquickly\tto\tthe\tbusiness\tneeds.\n\nYou\thave\talso\tlearned\tthe\tkey\tbenefits\tsuch\tas\tthe\tpossibility\tof\tusing the\tright\tlanguage\tfor\tthe\tright\tservice\t(technology\theterogeneity)\ton\tthe microservices-oriented\tarchitectures\tas\twell\tas\tsome\tof\tthe\tpitfalls\tthat could\tmake\tour\tlife\tharder,\tsuch\tas\tthe\toverhead\ton\tthe\toperational\tside caused\tby\tthe\tdistributed\tnature\tof\tthe\tmicroservices-oriented architectures.\n\nFinally,\twe\tdiscussed\twhy\tNode.js\tis\ta\tgreat\ttool\tfor\tbuilding microservices,\tas\twell\tas\thow\twe\tcould\tbenefit\tfrom\tJavaScript\tto\tbuild high-quality\tsoftware\tcomponents\tthrough\ttechniques\tlike\tAPI aggregation.\n\nIn\tthe\tfollowing\tchapters,\twe\twill\tbe\tdeveloping\tthe\tconcepts\tdiscussed\tin this\tchapter,\twith\tcode\texamples\tand\tfurther\texplanation\tabout\tthe\ttopics I\thave\tlearned\tover\tthe\tyears.\n\nAs\texplained\tbefore,\twe\twill\tfocus\ton\tthe\tV8\tversion\tof\tJavaScript,\tbut\tI will\tprovide\tsome\thints\ton\thow\tto\teasily\twrite\tupgradeable\tcomponents to\tembrace\tECMAScript\t6.\n\nChapter\t2.\tMicroservices\tin Node.js\t–\tSeneca\tand\tPM2 Alternatives\n\nIn\tthis\tchapter,\tyou\twill\tmainly\tlearn\tabout\ttwo\tframeworks,\tSeneca\tand PM2,\tand\twhy\tthey\tare\timportant\tfor\tbuilding\tmicroservices.\tWe\twill\talso get\tto\tknow\tthe\talternatives\tto\tthese\tframeworks\tin\torder\tto\tget\ta\tgeneral understanding\tof\twhat\tis\tgoing\ton\tin\tthe\tNode.js\tecosystem.\tIn\tthis chapter,\twe\tare\tgoing\tto\tfocus\ton\tthe\tfollowing\ttopics:\n\nNeed\tfor\tNode.js:\tIn\tthis\tsection,\twe\tare\tgoing\tto\tjustify\tthe\tchoice of\tNode.js\tas\ta\tframework\tto\tbuild\tour\tmicroservices-oriented software.\tWe\twill\twalk\tthrough\tthe\tsoftware\tstack\trequired\tto\tuse this\tawesome\ttechnology. Seneca\t–\ta\tmicroservices\tframework:\tIn\tthis\tsection,\tyou\twill\tlearn the\tbasics\tof\tSeneca\tand\twhy\tit\tis\tthe\tright\tchoice\tif\twe\twant\tto\tkeep our\tsoftware\tmanageable.\tWe\twill\texplain\thow\tto\tintegrate\tSeneca with\tExpress\t(the\tmost\tpopular\tweb\tserver\tin\tNode.js)\tin\torder\tto follow\tthe\tindustry\tstandards. PM2:\tPM2\tis\tthe\tbest\tchoice\tto\trun\tNode.js\tapplications.\tNo\tmatter what\tyour\tproblem\tin\tdeploying\tyour\tecosystem\tof\tapps\tis,\tPM2\twill always\thave\ta\tsolution\tfor\tit.\n\nNeed\tfor\tNode.js\n\nIn\tthe\tprevious\tchapter,\tI\tmentioned\tthat\tI\twasn't\ta\tbig\tfan\tof\tNode.js\tin the\tpast.\tThe\treason\tfor\tthis\twas\tthat\tI\twasn't\tprepared\tto\tcope\twith\tthe level\tof\tstandardization\tthat\tJavaScript\twas\tundergoing.\n\nJavaScript\tin\tthe\tbrowser\twas\tpainful.\tCross-browser\tcompatibility\twas always\ta\tproblem\tand\tthe\tlack\tof\tstandardization\tdidn't\thelp\tto\tease\tthe pain.\n\nThen\tNode.js\tcame\tand\tit\twas\teasy\tto\tcreate\thighly\tscalable\tapplications due\tto\tits\tnon-blocking\tnature\t(we\twill\ttalk\tabout\tit\tlater\tin\tthis\tchapter)",
      "page_number": 25
    },
    {
      "number": 2,
      "title": "Microservices\tin Node.js\t–\tSeneca\tand\tPM2 Alternatives",
      "start_page": 55,
      "end_page": 93,
      "detection_method": "regex_chapter_title",
      "content": "and\tit\twas\talso\tvery\teasy\tto\tlearn\tas\tit\twas\tbased\ton\tJavaScript,\ta\twell- known\tlanguage.\n\nNowadays,\tNode.js\tis\tthe\tpreferred\tchoice\tfor\ta\tlarge\tnumber\tof companies\tacross\tthe\tworld,\tas\twell\tas\tthe\tnumber\tone\tchoice\tfor aspects\tthat\trequire\ta\tnon-blocking\tnature\tin\tthe\tserver,\tsuch\tas\tweb sockets.\n\nIn\tthis\tbook,\twe\twill\tprimarily\t(but\tnot\tonly)\tuse\tSeneca\tand\tPM2\tas\tthe frameworks\tfor\tbuilding\tand\trunning\tmicroservices,\tbut\tit\tdoes\tnot\tmean that\tthe\talternatives\tare\tnot\tgood.\n\nThere\tare\tfew\talternatives\tin\tthe\tmarket\tsuch\tas\trestify\tor\tExpress\tfor building\tapplications\tand\tforever\tor\tnodemon\tto\trun\tthem.\tHowever,\tI find\tSeneca\tand\tPM2\tto\tbe\tthe\tmost\tappropriate\tcombination\tfor\tbuilding microservices\tfor\tthe\tfollowing\treasons:\n\nPM2\tis\textremely\tpowerful\tregarding\tapplication\tdeployments Seneca\tis\tnot\tonly\ta\tframework\tto\tbuild\tmicroservices,\tbut\tit\tis\talso\ta paradigm\tthat\treshapes\twhat\twe\tknow\tabout\tobject-oriented software\n\nWe\twill\tbe\tusing\tExpress\tin\ta\tfew\texamples\tin\tthe\tchapters\tof\tthis\tbook and\twe\twill\talso\tdiscuss\thow\tto\tintegrate\tSeneca\tin\tExpress\tas\ta middleware.\n\nHowever,\tbefore\tthat,\tlet's\tdiscuss\tsome\tconcepts\taround\tNode.js\tthat will\thelp\tus\tto\tunderstand\tthose\tframeworks.\n\nInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2\n\nNode.js\tis\tfairly\teasy\tto\tinstall.\tDepending\ton\tyour\tsystem,\tthere\tis\tan installer\tavailable\tthat\tmakes\tthe\tinstallation\tof\tNode.js\tand\tnpm\t(Node Package\tManager)\ta\tfairly\tsimple\ttask.\tSimply\tdouble-click\ton\tit\tand follow\tthe\tinstructions.\tAt\tthe\ttime\tof\twriting\tthis\tbook,\tthere\tare\tinstallers available\tfor\tWindows\tand\tOSX.\n\nHowever,\tthe\tadvanced\tusers,\tespecially\tDevOps\tengineers,\twill\tneed\tto install\tNode.js\tand\tnpm\tfrom\tthe\tsources\tor\tbinaries.\n\nNote\n\nBoth\tNode.js\tand\tnpm\tprograms\tcome\tbundled\ttogether\tin\ta\tsingle package\tthat\twe\tcan\tdownload\tfor\tvarious\tplatforms\tfrom\tthe\tNode.js website\t(either\tsources\tor\tbinaries):\n\nhttps://nodejs.org/en/download/\n\nFor\tthe\tChef\tusers,\ta\tpopular\tconfiguration\tmanagement\tsoftware\tto build\tservers,\tthere\tare\tfew\toptions\tavailable,\tbut\tthe\tmost\tpopular\tis\tthe following\trecipe\t(for\tthose\tunfamiliar\twith\tChef,\ta\trecipe\tis\tbasically\ta script\tto\tinstall\tor\tconfigure\tsoftware\tin\ta\tserver\tthrough\tChef):\n\nhttps://github.com/redguide/nodejs\n\nAt\tthe\ttime\tof\twriting\tthis\tbook,\tthere\tare\tbinaries\tavailable\tfor\tLinux.\n\nLearning\tnpm\n\nnpm\tis\ta\tsoftware\tthat\tcomes\twith\tNode.js\tand\tenables\tyou\tto\tpull dependencies\tfrom\tthe\tInternet\twithout\tworrying\tabout\ttheir management.\tIt\tcan\talso\tbe\tused\tto\tmaintain\tand\tupdate\tdependencies, as\twell\tas\tcreate\tprojects\tfrom\tscratch.\n\nAs\tyou\tprobably\tknow,\tevery\tnode\tapp\tcomes\twith\ta\tpackage.json\tfile. This\tfile\tdescribes\tthe\tconfiguration\tof\tthe\tproject\t(dependencies, versions,\tcommon\tcommands,\tand\tso\ton).\tLet's\tsee\tthe\tfollowing example:\n\n{ \t\t\"name\":\t\"test-project\", \t\t\"version\":\t\"1.0.0\", \t\t\"description\":\t\"test\tproject\", \t\t\"main\":\t\"index.js\", \t\t\"scripts\":\t{ \t\t\"test\":\t\"grunt\tvalidate\t--verbose\" \t\t}, \t\t\"author\":\t\"David\tGonzalez\", \t\t\"license\":\t\"ISC\"\n\n}\n\nThe\tfile\titself\tis\tself-explanatory.\tThere\tis\tan\tinteresting\tsection\tin\tthe\tfile —scripts.\n\nIn\tthis\tsection,\twe\tcan\tspecify\tthe\tcommand\tthat\tis\tused\tto\trun\tfor different\tactions.\tIn\tthis\tcase,\tif\twe\trun\tnpm\ttest\tfrom\tthe\tterminal,\tnpm will\texecute\tgrunt\tvalidate\t--verbose.\n\nNode\tapplications\tare\tusually\tas\teasy\tto\trun\tas\texecuting\tthe\tfollowing command:\n\nnode\tindex.js\n\nIn\tthe\troot\tof\tyour\tproject,\tconsider\tthat\tthe\tbootstrapping\tfile\tis\tindex.js. If\tthis\tis\tnot\tthe\tcase,\tthe\tbest\tthing\tyou\tcan\tdo\tis\tadd\ta\tsubsection\tin\tthe scripts\tsection\tin\tpackage.json,\tas\tfollows:\n\n\"scripts\":\t{ \t\t\"test\":\t\"grunt\tvalidate\t--verbose\" \t\t\"start\":\t\"node\tindex.js\" },\n\nAs\tyou\tcan\tsee,\tnow\twe\thave\ttwo\tcommands\texecuting\tthe\tsame program:\n\nnode\tindex.js npm\tstart\n\nThe\tbenefits\tof\tusing\tnpm\tstart\tare\tquite\tobvious—uniformity.\tNo\tmatter how\tcomplex\tyour\tapplication\tis,\tnpm\tstart\twill\talways\trun\tit\t(if\tyou\thave configured\tthe\tscripts\tsection\tcorrectly).\n\nLet's\tinstall\tSeneca\tand\tPM2\ton\ta\tclean\tproject.\n\nFirst,\texecute\tnpm\tinit\tin\ta\tnew\tfolder\tfrom\tthe\tterminal\tafter\tinstalling Node.js.\tYou\tshould\tget\ta\tprompt\tsimilar\tto\tthe\tfollowing\timage:\n\nnpm\twill\task\tyou\tfor\ta\tfew\tparameters\tto\tconfigure\tyour\tproject,\tand\tonce you\tare\tdone,\tit\twrites\ta\tpackage.json\tfile\twith\tcontent\tsimilar\tto\tthe preceding\tcode.\n\nNow\twe\tneed\tto\tinstall\tthe\tdependencies;\tnpm\twill\tdo\tthat\tfor\tus.\tJust run\tthe\tfollowing\tcommand:\n\nnpm\tinstall\t--save\tseneca\n\nNow,\tif\tyou\tinspect\tpackage.json\tagain,\tyou\tcan\tsee\tthat\tthere\tis\ta\tnew section\tcalled\tdependencies\tthat\tcontains\tan\tentry\tfor\tSeneca:\n\n\"dependencies\":\t{ \t\t\"seneca\":\t\"^0.7.1\" }\n\nThis\tmeans\tthat\tfrom\tnow\ton,\tour\tapp\tcan\trequire\tthe\tSeneca\tmodule and\tthe\trequire()\tfunction\twill\tbe\table\tto\tfind\tit.\tThere\tare\ta\tfew variations\tof\tthe\tsave\tflag,\tas\tfollows:\n\nsave:\tThis\tsaves\tthe\tdependency\tin\tthe\tdependencies\tsection.\tIt\tis available\tthrough\tall\tthe\tdevelopment\tlife\tcycle. save-dev:\tThis\tsaves\tthe\tdependency\tin\tthe\tdevDependencies\tsection. It\tis\tonly\tavailable\tin\tdevelopment\tand\tdoes\tnot\tget\tdeployed\tinto production. save-optional:\tThis\tadds\ta\tdependency\t(such\tas\tsave),\tbut\tlets\tnpm continue\tif\tthe\tdependency\tcan't\tbe\tfound.\tIt\tis\tup\tto\tthe\tapp\tto handle\tthe\tlack\tof\tthis\tdependency.\n\nLet's\tcontinue\twith\tPM2.\tAlthough\tit\tcan\tbe\tused\tas\ta\tlibrary,\tPM2\tis\n\nmainly\ta\tcommand\ttool,\tlike\tls\tor\tgrep\tin\tany\tUnix\tsystem.\tnpm\tdoes\ta great\tjob\tinstalling\tcommand-line\ttools:\n\nnpm\tinstall\t–g\tpm2\n\nThe\t–g\tflags\tinstruct\tnpm\tto\tglobally\tinstall\tPM2,\tso\tit\tis\tavailable\tin\tthe system,\tnot\tin\tthe\tapp.\tThis\tmeans\tthat\twhen\tthe\tprevious\tcommand finishes,\tpm2\tis\tavailable\tas\ta\tcommand\tin\tthe\tconsole.\tIf\tyou\trun\tpm2 help\tin\ta\tterminal,\tyou\tcan\tsee\tthe\thelp\tof\tPM2.\n\nOur\tfirst\tprogram\t–\tHello\tWorld\n\nOne\tof\tthe\tmost\tinteresting\tconcepts\taround\tNode.js\tis\tsimplicity.\tYou can\tlearn\tNode.js\tin\tfew\tdays\tand\tmaster\tit\tin\ta\tfew\tweeks,\tas\tlong\tas you\tare\tfamiliar\twith\tJavaScript.\tCode\tin\tNode.js\ttends\tto\tbe\tshorter\tand clearer\tthan\tin\tother\tlanguages:\n\nvar\thttp\t=\trequire('http');\n\nvar\tserver\t=\thttp.createServer(function\t(request,\t response)\t{ \t\tresponse.writeHead(200,\t{\"Content-Type\":\t \"text/plain\"}); \t\tresponse.end(\"Hello\tWorld\\n\"); });\n\nserver.listen(8000);\n\nThe\tpreceding\tcode\tcreates\ta\tserver\tthat\tlistens\ton\tthe\t8000\tport\tfor requests.\tIf\tyou\tdon't\tbelieve\tit,\topen\ta\tbrowser\tand\ttype http://127.0.0.1:8000\tin\tthe\tnavigation\tbar,\tas\tshown\tin\tthe\tfollowing screenshot:\n\nLet's\texplain\tthe\tcode:\n\nThe\tfirst\tline\tloads\tthe\thttp\tmodule.\tThrough\tthe\trequire() instruction,\twe\task\tthe\tnode\tto\tload\tthe\thttp\tmodule\tand\tassign\tthe export\tof\tthis\tmodule\tto\tthe\thttp\tvariable.\tExporting\tlanguage elements\tis\tthe\tway\tthat\tNode.js\thas\tto\texpose\tfunctions\tand variables\tto\tthe\touter\tworld\tfrom\tinside\ta\tmodule. The\tsecond\tconstruction\tin\tthe\tscript\tcreates\tthe\tHTTP\tserver.\tThe http\tmodule\tcreates\tand\texposes\ta\tmethod\tcalled\tcreateServer() that\treceives\ta\tfunction\t(remember\tJavaScript\ttreats\tfunctions\tas first-level\tobjects\tso\tthat\tthey\tcan\tbe\tpassed\tas\tother\tfunctions arguments)\tas\ta\tparameter\tthat,\tin\tthe\tNode.js\tworld,\tis\tcalled callback.\tA\tcallback\tis\tan\taction\tto\tbe\texecuted\tas\ta\tresponse\tto\tan event.\tIn\tthis\tcase,\tthe\tevent\tis\tthat\tthe\tscript\treceives\tan\tHTTP request.\tNode.js\thas\ta\theavy\tusage\tof\tcallbacks\tdue\tto\tits\tthread model.\tYour\tapplication\twill\talways\tbe\texecuted\ton\ta\tsingle\tthread so\tthat\tnot\tblocking\tthe\tapplication\tthread\twhile\twaiting\tfor operations\tto\tcomplete\tand\tprevents\tour\tapplication\tfrom\tlooking stalled\tor\thanged.\tOtherwise,\tyour\tprogram\twon't\tbe\tresponsive. We'll\tcome\tback\tto\tthis\tin\tChapter\t4,\tWriting\tYour\tFirst\tMicroservice in\tNode.js. In\tthe\tnext\tline,\tserver.listen(8000)\tstarts\tthe\tserver.\tFrom\tnow\ton, every\ttime\tour\tserver\treceives\ta\trequest,\tthe\tcallback\ton\tthe\n\nhttp.createServer()\tfunction\twill\tbe\texecuted.\n\nThis\tis\tit.\tSimplicity\tis\tthe\tkey\tto\tNode.js\tprograms.\tThe\tcode\tallows\tyou to\tgo\tto\tthe\tpoint\twithout\twriting\ttons\tof\tclasses,\tmethods,\tand\tconfig objects\tthat\tcomplicate\twhat,\tin\tthe\tfirst\tinstance,\tcan\tbe\tdone\tmuch more\tsimply:\twrite\ta\tscript\tthat\tserves\trequests.\n\nNode.js\tthreading\tmodel\n\nPrograms\twritten\tin\tNode.js\tare\tsingle-threaded.\tThe\timpact\tof\tthis\tis quite\tsignificant;\tin\tthe\tprevious\texample,\tif\twe\thave\tten\tthousand concurrent\trequests,\tthey\twill\tbe\tqueued\tand\tsatisfied\tby\tthe\tNode.js event\tloop\t(it\twill\tbe\tfurther\texplained\tin\tChapter\t4,\tWriting\tYour\tFirst Microservice\tin\tNode.js\tand\tChapter\t6,\tTesting\tand\tDocumenting\tNode.js Microservices)\tone\tby\tone.\n\nAt\tfirst\tglance,\tthis\tsounds\twrong.\tI\tmean,\tthe\tmodern\tCPUs\tcan\thandle multiple\tparallel\trequests\tdue\tto\ttheir\tmulticore\tnature.\tSo,\twhat\tis\tthe benefit\tof\texecuting\tthem\tin\tone\tthread?\n\nThe\tanswer\tto\tthis\tquestion\tis\tthat\tNode.js\twas\tdesigned\tto\thandle asynchronous\tprocessing.\tThis\tmeans\tthat\tin\tthe\tevent\tof\ta\tslow operation\tsuch\tas\treading\ta\tfile,\tinstead\tof\tblocking\tthe\tthread,\tNode.js allows\tthe\tthread\tto\tcontinue\tsatisfying\tother\tevents,\tand\tthen\tthe\tcontrol process\tof\tthe\tnode\twill\texecute\tthe\tmethod\tassociated\twith\tthe\tevent, processing\tthe\tresponse.\n\nSticking\tto\tthe\tprevious\texample,\tthe\tcreateServer()\tmethod\taccepts\ta callback\tthat\twill\tbe\texecuted\tin\tthe\tevent\tof\tan\tHTTP\trequest,\tbut meanwhile,\tthe\tthread\tis\tfree\tto\tkeep\texecuting\tother\tactions.\n\nThe\tcatch\tin\tthis\tmodel\tis\twhat\tNode.js\tdevelopers\tcall\tthe\tcallback\thell. The\tcode\tgets\tcomplicated\tas\tevery\tsingle\taction\tthat\tis\ta\tresponse\tto\ta blocking\taction\thas\tto\tbe\tprocessed\ton\ta\tcallback,\tlike\tin\tthe\tprevious example;\tthe\tfunction\tused\tas\ta\tparameter\tto\tthe\tcreateServer()\tmethod is\ta\tgood\texample.\n\nModular\torganization\tbest\tpractices\n\nThe\tsource\tcode\torganization\tfor\tbig\tprojects\tis\talways\tcontroversial. Different\tdevelopers\thave\tdifferent\tapproaches\tto\thow\tto\torder\tthe source\tcode\tin\torder\tto\tkeep\tthe\tchaos\taway.\n\nSome\tlanguages\tsuch\tas\tJava\tor\tC#\torganize\tthe\tcode\tin\tpackages\tso that\twe\tcan\tfind\tsource\tcode\tfiles\tthat\tare\trelated\tinside\ta\tpackage.\tAs an\texample,\tif\twe\tare\twriting\ta\ttask\tmanager\tsoftware,\tinside\tthe com.taskmanager.dao\tpackage\twe\tcan\texpect\tto\tfind\tclasses\tthat implement\tthe\tdata\taccess\tobject\t(DAO)\tpattern\tin\torder\tto\taccess\tthe database.\tIn\tthe\tsame\tway,\tin\tthe\tcom.taskmanager.dao.domain.model package,\twe\tcan\tfind\tall\tthe\tclasses\tthat\trepresent\tmodel\tobjects (usually\ttables)\tin\tour\tapplication.\n\nThis\tis\ta\tconvention\tin\tJava\tand\tC#.\tIf\tyou\tare\ta\tC#\tdeveloper,\tand\tyou start\tworking\ton\tan\texisting\tproject,\tit\tonly\ttakes\tyou\ta\tfew\tdays\tto\tget used\tto\thow\tthe\tcode\tis\tstructured\tas\tthe\tlanguage\tenforces\tthe organization\tof\tthe\tsource.\n\nJavascript\n\nJavaScript\twas\tfirst\tdesigned\tto\tbe\trun\tinside\tthe\tbrowser.\tThe\tcode\twas supposed\tto\tbe\tembedded\tin\tHTML\tdocuments\tso\tthat\tthe\tDocument Object\tModel\t(DOM)\tcould\tbe\tmanipulated\tto\tcreate\tdynamic\teffects. Take\ta\tlook\tat\tthe\tfollowing\texample:\n\n<!DOCTYPE\thtml> <html> <head> \t\t<meta\tcharset=\"UTF-8\"> \t\t<title>Title\tof\tthe\tdocument</title> </head> <body> \t\tHello\t<span\tid=\"world\">Mundo</span> \t\t<script\ttype=\"text/javascript\"> \t\tdocument.getElementById(\"world\").innerText\t=\t 'World'; \t\t</script> </body> </html>\n\nAs\tyou\tcan\tsee,\tif\tyou\tload\tthis\tHTML\ton\ta\tbrowser,\tthe\ttext\tinside\tthe\n\nspan\ttag\twith\tthe\tid\tas\tworld\tis\treplaced\twhen\tthe\tpage\tloads.\n\nIn\tJavaScript,\tthere\tis\tno\tconcept\tof\tdependency\tmanagement. JavaScript\tcan\tbe\tsegregated\tfrom\tthe\tHTML\tinto\tits\town\tfile,\tbut\tthere\tis no\tway\t(for\tnow)\tto\tinclude\ta\tJavaScript\tfile\tinto\tanother\tJavaScript\tfile.\n\nThis\tleads\tto\ta\tbig\tproblem.\tWhen\tthe\tproject\tcontains\tdozens\tof JavaScript\tfiles,\tthe\tassets\tmanagement\tbecome\tmore\tof\tan\tart\tthan\tan engineering\teffort.\n\nThe\torder\tin\twhich\tyou\timport\tthe\tJavaScript\tfiles\tbecomes\timportant\tas the\tbrowser\texecutes\tthe\tJavaScript\tfiles\tas\tit\tfinds\tthem.\tLet's\treorder the\tcode\tin\tthe\tprevious\texample\tto\tdemonstrate\tit,\tas\tfollows:\n\n<!DOCTYPE\thtml> <html> <head> \t\t<meta\tcharset=\"UTF-8\"> \t\t<title>Title\tof\tthe\tdocument</title> \t\t<script\ttype=\"text/javascript\"> \t\t\t\tdocument.getElementById(\"world\").innerText\t=\t 'World'; \t\t</script> </head> <body> \t\tHello\t<span\tid=\"world\">Mundo</span>\n\n</body> </html>\n\nNow,\tsave\tthis\tHTML\tin\tan\tindex.html\tfile\tand\ttry\tto\tload\tit\tin\tany browser,\tas\tshown\tin\tthe\tfollowing\timage:\n\nIn\tthis\tcase,\tI\thave\tused\tChrome\tand\tthe\tconsole\tshows\tan\tUncaught TypeError:\tCannot\tset\tproperty\t'innerText'\tof\tnull\terror\tin\tline\t7.\n\nWhy\tis\tthat\thappening?\n\nAs\twe\texplained\tearlier,\tthe\tbrowser\texecutes\tthe\tcode\tas\tit\tis\tfound, and\tit\tturns\tout\tthat\twhen\tthe\tbrowser\texecutes\tthe\tJavaScript,\tthe\tworld element\tdoes\tnot\texist\tyet.\n\nFortunately,\tNode.js\thas\tsolved\tthe\tdependency-loading\tproblem\tusing\ta very\telegant\tand\tstandard\tapproach.\n\nSOLID\tdesign\tprinciples\n\nWhen\ttalking\tabout\tmicroservices,\twe\talways\ttalk\tabout\tmodularity,\tand modularity\talways\tboils\tdown\tto\tthe\tfollowing\t(SOLID)\tdesign\tprinciples:\n\nSingle\tresponsibility\tprinciple Open\tfor\textension,\tclosed\tfor\tmodification Liskov\tsubstitution Interface\tsegregation Dependency\tinversion\t(inversion\tof\tcontrol\tand\tdependency injection)\n\nYou\twant\tyour\tcode\tto\tbe\torganized\tin\tmodules.\tA\tmodule\tis\tan aggregation\tof\tcode\tthat\tdoes\tsomething\tsimple,\tsuch\tas\tmanipulating strings,\tand\tit\tdoes\tit\twell.\tThe\tmore\tfunctions\t(or\tclasses,\tutilities,\tand so\ton)\tyour\tmodule\tcontains,\tthe\tless\tcohesive\tit\tis,\tand\twe\tare\ttrying\tto avoid\tthat.\n\nIn\tNode.js,\tevery\tJavaScript\tfile\tis\ta\tmodule\tby\tdefault.\tWe\tcan\talso\tuse folders\tas\tmodules,\tbut\tlet's\tfocus\ton\tfiles:\n\nfunction\tcontains(a,\tb)\t{ \t\treturn\ta.indexOf(b)\t>\t-1; }\n\nfunction\tstringToOrdinal(str)\t{ \t\tvar\tresult\t=\t\"\" \t\tfor\t(var\ti\t=\t0,\tlen\t=\tstr.length;\ti\t<\tlen;\ti++)\t{ \t\t\t\tresult\t+=\tcharToNumber(str[i]);\n\n} \t\treturn\tresult; }\n\nfunction\tcharToNumber(char)\t{ \t\treturn\tchar.charCodeAt(0)\t-\t96; }\n\nmodule.exports\t=\t{ \t\tcontains:\tcontains, \t\tstringToOrdinal:\tstringToOrdinal }\n\nThe\tpreceding\tcode\trepresents\ta\tvalid\tmodule\tin\tNode.js.\tIn\tthis\tcase, the\tmodule\tcontains\tthree\tfunctions,\twhere\ttwo\tof\tthem\tare\texposed\tto the\toutside\tof\tthe\tmodule.\n\nIn\tNode.js,\tthis\tis\tdone\tthrough\tthe\tmodule.exports\tvariable.\tWhatever you\tassign\tto\tthis\tvariable\tis\tgoing\tto\tbe\tvisible\tby\tthe\tcalling\tcode\tso that\twe\tcan\tsimulate\tprivate\tcontent\ton\ta\tmodule,\tsuch\tas\tthe charToNumber()\tfunction\tin\tthis\tcase.\n\nSo,\tif\twe\twant\tto\tuse\tthis\tmodule,\twe\tjust\tneed\tto\trequire()\tit,\tas\tfollows:\n\nvar\tstringManipulation\t=\trequire(\"./string- manipulation\"); console.log(stringManipulation.stringToOrdinal(\"aabb\") );\n\nThis\tshould\toutput\t1122.\n\nLet's\tgo\tback\tto\tthe\tSOLID\tprinciples\tand\tsee\thow\tour\tmodule\tlooks:\n\nSingle\tresponsibility\tprinciple:\tOur\tmodule\tonly\tdeals\twith\tstrings Open\tfor\textension,\tclosed\tfor\tmodification:\tWe\tcan\tadd\tmore functions,\tbut\tthe\tones\tthat\twe\thave\tare\tcorrect\tand\tthey\tcan\tbe used\tto\tbuild\tnew\tfunctions\tin\tthe\tmodule Liskov\tsubstitution:\tWe\twill\tskip\tthis\tone,\tas\tthe\tstructure\tof\tthe module\tis\tirrelevant\tto\tfulfil\tthis\tprinciple Interface\tsegregation:\tJavaScript\tis\tnot\ta\tlanguage\tthat\tcounts\twith an\tinterface\telement\tsuch\tas\tJava\tor\tC#,\tbut\tin\tthis\tmodule,\twe exposed\tthe\tinterface,\tand\tthe\tmodule.exports\tvariable\twill\tact\tas\ta\n\ncontract\tfor\tthe\tcalling\tcode\tand\tthe\tchange\tin\tour\timplementation won't\taffect\thow\tthe\tmodule\tis\tbeing\tcalled Dependency\tinversion:\tHere\tis\twhere\twe\tfail,\tnot\tfully,\tbut\tenough to\treconsider\tour\tapproach\n\nIn\tthis\tcase,\twe\trequire\tthe\tmodule,\tand\tthe\tonly\tway\tto\tinteract\twith\tit\tis through\tthe\tglobal\tscope.\tIf,\tinside\tthe\tmodule,\twe\twant\tto\tinteract\twith data\tfrom\toutside,\tthe\tonly\tpossible\toption\tis\tto\tcreate\ta\tglobal\tvariable (or\tfunction)\tprior\tto\trequiring\tthe\tmodule,\tand\tthen\tassume\tthat\tit\tis always\tgoing\tto\tbe\tin\tthere.\n\nGlobal\tvariables\tare\ta\tbig\tproblem\tin\tNode.js.\tAs\tyou\tare\tprobably aware,\tin\tJavaScript,\tif\tyou\tomit\tthe\tvar\tkeyword\twhen\tdeclaring\ta variable,\tit\tis\tautomatically\tglobal.\n\nThis,\tcoupled\twith\tthe\tfact\tthat\tintentional\tglobal\tvariables\tcreate\ta\tdata coupling\tbetween\tmodules\t(coupling\tis\twhat\twe\twant\tto\tavoid\tat\tany cost),\tis\tthe\treason\tto\tfind\ta\tbetter\tapproach\tto\thow\tto\tdefine\tthe modules\tfor\tour\tmicroservices\t(or\tin\tgeneral).\n\nLet's\trestructure\tthe\tcode\tas\tfollows:\n\nfunction\tinit(options)\t{\n\nfunction\tcharToNumber(char)\t{ \t\t\t\treturn\tchar.charCodeAt(0)\t-\t96; \t\t}\n\nfunction\tStringManipulation()\t{ \t\t}\n\nvar\tstringManipulation\t=\tnew\tStringManipulation();\n\nstringManipulation.contains\t=\tfunction(a,\tb)\t{ \t\t\t\treturn\ta.indexOf(b)\t>\t-1; \t\t};\n\nstringManipulation.stringToOrdinal\t=\tfunction(str)\t{ \t\t\t\tvar\tresult\t=\t\"\" \t\t\t\tfor\t(var\ti\t=\t0,\tlen\t=\tstr.length;\ti\t<\tlen;\ti++)\t{ \t\t\t\t\t\tresult\t+=\tcharToNumber(str[i]); \t\t\t\t} \t\t\t\treturn\tresult; \t\t}\n\nreturn\tstringManipulation; }\n\nmodule.exports\t=\tinit;\n\nThis\tlooks\ta\tbit\tmore\tcomplicated,\tbut\tonce\tyou\tget\tused\tto\tit,\tthe benefits\tare\tenormous:\n\nWe\tcan\tpass\tconfiguration\tparameters\tto\tthe\tmodule\t(such\tas debugging\tinformation) Avoids\tthe\tpollution\tof\tglobal\tscope\tas\tif\teverything\tis\twrapped inside\ta\tfunction,\tand\twe\tenforce\tthe\tuse\tstrict\tconfiguration\t(this avoids\tdeclarations\twithout\tvar\twith\ta\tcompilation\terror) Parameterizing\ta\tmodule\tmakes\tit\teasy\tto\tmock\tbehaviors\tand\tdata for\ttesting\n\nIn\tthis\tbook,\twe\tare\tgoing\tto\tbe\twriting\ta\tgood\tamount\tof\tcode\tto\tmodel systems\tfrom\tthe\tmicroservices\tprospective.\tWe\twill\ttry\tto\tkeep\tthis pattern\tas\tmuch\tas\twe\tcan\tso\tthat\twe\tcan\tsee\tthe\tbenefits.\n\nOne\tof\tthe\tlibrary\tthat\twe\tare\tgoing\tto\tbe\tusing\tto\tbuild\tmicroservices, Seneca,\tfollows\tthis\tpattern,\tas\twell\tas\ta\tlarge\tnumber\tof\tlibraries\tthat can\tbe\tfound\ton\tInternet.\n\nSeneca\t–\ta\tmicroservices framework\n\nSeneca\tis\ta\tframework\tfor\tbuilding\tmicroservices\twritten\tby\tRichard Rodger,\tthe\tfounder\tand\tCTO\tof\tnearForm,\ta\tconsultancy\tthat\thelps other\tcompanies\tdesign\tand\timplement\tsoftware\tusing\tNode.js.\tSeneca is\tabout\tsimplicity,\tit\tconnects\tservices\tthrough\ta\tsophisticated\tpattern- matching\tinterface\tthat\tabstracts\tthe\ttransport\tfrom\tthe\tcode\tso\tthat\tit\tis fairly\teasy\tto\twrite\thighly\tscalable\tsoftware.\n\nLet's\tstop\ttalking\tand\tsee\tsome\texamples:\n\nvar\tseneca\t=\trequire(\t'seneca'\t)()\n\nseneca.add({role:\t'math',\tcmd:\t'sum'},\tfunction\t(msg,\t respond)\t{ \t\tvar\tsum\t=\tmsg.left\t+\tmsg.right \t\trespond(null,\t{answer:\tsum}) })\n\nseneca.add({role:\t'math',\tcmd:\t'product'},\tfunction\t (msg,\trespond)\t{ \t\tvar\tproduct\t=\tmsg.left\t*\tmsg.right \t\trespond(\tnull,\t{\tanswer:\tproduct\t}\t) })\n\nseneca.act({role:\t'math',\tcmd:\t'sum',\tleft:\t1,\tright:\t 2},\tconsole.log) \t\t\t\tseneca.act({role:\t'math',\tcmd:\t'product',\tleft:\t3,\t right:\t4},\tconsole.log)\n\nAs\tyou\tcan\tsee,\tthe\tcode\tis\tself-explanatory:\n\nSeneca\tcomes\tas\ta\tmodule,\tso\tthe\tfirst\tthing\tthat\tneeds\tto\tbe\tdone is\tto\trequire()\tit.\tSeneca\tpackage\tis\twrapped\tin\ta\tfunction,\tso invoking\tthe\tfunction\tinitializes\tthe\tlibrary. Next\ttwo\tinstructions\tare\trelated\tto\ta\tconcept\texplained\tin\tChapter 1,\tMicroservices\tArchitecture:\tAPI\tcomposition.\tThe\tseneca.add() method\tinstructs\tSeneca\tto\tadd\ta\tfunction\tthat\twill\tbe\tinvoked\twith\ta set\tof\tpatterns.\tFor\tthe\tfirst\tone,\twe\tspecify\tan\taction\tthat\twill\ttake\n\nplace\twhen\tSeneca\treceives\tthe\t{role:\tmath,\tcmd:\tsum}\tcommand. For\tthe\tsecond\tone,\tthe\tpattern\tis\t{role:\tmath,\tcmd:\tproduct}. The\tlast\tline\tsends\ta\tcommand\tto\tSeneca\tthat\twill\tbe\texecuted\tby the\tservice\tthat\tmatches\tthe\tpattern\tpassed\tas\tthe\tfirst\tparameter.\tIn this\tcase,\tit\twill\tmatch\tthe\tfirst\tservice\tas\trole\tand\tcmd\tmatch.\tThe second\tcall\tto\tact\twill\tmatch\tthe\tsecond\tservice.\n\nWrite\tthe\tcode\tin\ta\tfile\tcalled\tindex.js\tin\tthe\tproject\tthat\twe\tcreated earlier\tin\tthis\tchapter\t(remember\tthat\twe\tinstalled\tSeneca\tand\tPM2),\tand run\tthe\tfollowing\tcommand:\n\nnode\tindex.js\n\nThe\toutput\twill\tbe\tsomething\tsimilar\tto\tthe\tfollowing\timage:\n\nWe\twill\ttalk\tabout\tthis\toutput\tlater\tin\torder\tto\texplain\texactly\twhat\tit means,\tbut\tif\tyou\tare\tused\tto\tenterprise\tapplications,\tyou\tcan\talmost guess\twhat\tis\tgoing\ton.\n\nThe\tlast\ttwo\tlines\tare\tthe\tresponses\tfrom\tthe\ttwo\tservices:\tthe\tfirst\tone executes\t1+2\tand\tthe\tsecond\tone\texecutes\t3*4.\n\nThe\tnull\toutput\tthat\tshows\tup\tas\tthe\tfirst\tword\tin\tthe\tlast\ttwo\tlines corresponds\tto\ta\tpattern\tthat\tis\twidely\tused\tin\tJavaScript:\tthe\terror\tfirst callback.\n\nLet's\texplain\tit\twith\ta\tcode\texample:\n\nvar\tseneca\t=\trequire(\t'seneca'\t)()\n\nseneca.add({role:\t'math',\tcmd:\t'sum'},\tfunction\t(msg,\t respond)\t{ \t\tvar\tsum\t=\tmsg.left\t+\tmsg.right \t\trespond(null,\t{answer:\tsum}) })\n\nseneca.add({role:\t'math',\tcmd:\t'product'},\tfunction\t (msg,\trespond)\t{\n\nvar\tproduct\t=\tmsg.left\t*\tmsg.right \t\trespond(\tnull,\t{\tanswer:\tproduct\t}\t) })\n\nseneca.act({role:\t'math',\tcmd:\t'sum',\tleft:\t1,\tright:\t 2},\tfunction(err,\tdata)\t{ \t\tif\t(err)\t{ \t\t\t\treturn\tconsole.error(err); \t\t} \t\tconsole.log(data); }); seneca.act({role:\t'math',\tcmd:\t'product',\tleft:\t3,\t right:\t4},\tconsole.log);\n\nThe\tprevious\tcode\trewrites\tthe\tfirst\tinvocation\tto\tSeneca\twith\ta\tmore appropriate\tapproach.\tInstead\tof\tdumping\teverything\tinto\tthe\tconsole, process\tthe\tresponse\tfrom\tSeneca,\twhich\tis\ta\tcallback\twhere\tthe\tfirst parameter\tis\tthe\terror,\tif\tone\thappened\t(null\totherwise),\tand\tthe\tsecond parameter\tis\tthe\tdata\tcoming\tback\tfrom\tthe\tmicroservice.\tThis\tis\twhy,\tin the\tfirst\texample,\tnull\twas\tthe\tfirst\toutput\tinto\tthe\tconsole.\n\nIn\tthe\tworld\tof\tNode.js,\tit\tis\tvery\tcommon\tto\tuse\tcallbacks.\tCallbacks\tare a\tway\tof\tindicating\tto\tthe\tprogram\tthat\tsomething\thas\thappened,\twithout being\tblocked\tuntil\tthe\tresult\tis\tready\tto\tbe\tprocessed.\tSeneca\tis\tnot\tan exception\tto\tthis.\tIt\trelies\theavily\ton\tcallbacks\tto\tprocess\tthe\tresponse\tto service\tcalls,\twhich\tmakes\tmore\tsense\twhen\tyou\tthink\tabout microservices\tbeing\tdeployed\tin\tdifferent\tmachines\t(in\tthe\tprevious example,\teverything\truns\tin\tthe\tsame\tmachine),\tespecially\tbecause\tthe network\tlatency\tcan\tbe\tsomething\tto\tfactor\tinto\tthe\tdesign\tof\tyour software.\n\nInversion\tof\tcontrol\tdone\tright\n\nInversion\tof\tcontrol\tis\ta\tmust\tin\tmodern\tsoftware.\tIt\tcomes\ttogether\twith the\tdependency\tinjection.\n\nInversion\tof\tcontrol\tcan\tbe\tdefined\tas\ta\ttechnique\tto\tdelegate\tthe creation\tor\tcall\tof\tcomponents\tand\tmethods\tso\tthat\tyour\tmodule\tdoes not\tneed\tto\tknow\thow\tto\tbuild\tthe\tdependencies,\twhich\tusually,\tare obtained\tthrough\tthe\tdependency\tinjection.\n\nSeneca\tdoes\tnot\treally\tmake\tuse\tof\tthe\tdependency\tinjection,\tbut\tit\tis the\tperfect\texample\tof\tinversion\tof\tcontrol.\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\tcode:\n\nvar\tseneca\t=\trequire('seneca')(); seneca.add({component:\t'greeter'},\tfunction(msg,\t respond)\t{ \t\trespond(null,\t{message:\t'Hello\t'\t+\tmsg.name}); }); seneca.act({component:\t'greeter',\tname:\t'David'},\t function(error,\tresponse)\t{ \t\tif(error)\treturn\tconsole.log(error); \t\tconsole.log(response.message); });\n\nThis\tis\tthe\tmost\tbasic\tSeneca\texample.\tFrom\tenterprise\tsoftware's\tpoint of\tview,\twe\tcan\tdifferentiate\ttwo\tcomponents\there:\ta\tproducer (Seneca.add())\tand\ta\tconsumer\t(Seneca.act()).\tAs\tmentioned\tearlier, Seneca\tdoes\tnot\thave\ta\tdependency\tinjection\tsystem\tas\tis,\tbut\tSeneca is\tgracefully\tbuilt\taround\tthe\tinversion\tof\tcontrol\tprinciple.\n\nIn\tthe\tSeneca.act()\tfunction,\twe\tdon't\texplicitly\tcall\tthe\tcomponent\tthat holds\tthe\tbusiness\tlogic;\tinstead\tof\tthat,\twe\task\tSeneca\tto\tresolve\tthe component\tfor\tus\tthrough\tthe\tuse\tof\tan\tinterface,\tin\tthis\tcase,\ta\tJSON message.\tThis\tis\tinversion\tof\tcontrol.\n\nSeneca\tis\tquite\tflexible\taround\tit:\tno\tkeywords\t(except\tfor\tintegrations) and\tno\tmandatory\tfields.\tIt\tjust\thas\ta\tcombination\tof\tkeywords\tand values\tthat\tare\tused\tby\ta\tpattern\tmatching\tengine\tcalled\tPatrun.\n\nPattern\tmatching\tin\tSeneca\n\nPattern\tmatching\tis\tone\tof\tthe\tmost\tflexible\tsoftware\tpatterns\tthat\tyou can\tuse\tfor\tmicroservices.\n\nAs\topposed\tto\tnetwork\taddresses\tor\tmessages,\tpatterns\tare\tfairly\teasy to\textend.\tLet's\texplain\tit\twith\tthe\thelp\tof\tthe\tfollowing\texample:\n\nvar\tseneca\t=\trequire('seneca')(); seneca.add({cmd:\t'wordcount'},\tfunction(msg,\trespond)\n\n{ \t\tvar\tlength\t=\tmsg.phrase.split('\t').length; \t\trespond(null,\t{words:\tlength}); });\n\nseneca.act({cmd:\t'wordcount',\tphrase:\t'Hello\tworld\t this\tis\tSeneca'},\tfunction(err,\tresponse)\t{ \t\tconsole.log(response); });\n\nIt\tis\ta\tservice\tthat\tcounts\tthe\tnumber\tof\twords\tin\ta\tsentence.\tAs\twe\thave seen\tbefore,\tin\tthe\tfirst\tline,\twe\tadd\tthe\thandler\tfor\tthe\twordcount command,\tand\tin\tthe\tsecond\tone,\twe\tsend\ta\trequest\tto\tSeneca\tto\tcount the\tnumber\tof\twords\tin\ta\tphrase.\n\nIf\tyou\texecute\tit,\tyou\tshould\tget\tsomething\tsimilar\tto\tthe\tfollowing\timage:\n\nBy\tnow,\tyou\tshould\tbe\table\tto\tunderstand\thow\tit\tworks\tand\teven\tmake some\tmodifications\tto\tit.\n\nLet's\textend\tthe\tpattern.\tNow,\twe\twant\tto\tskip\tthe\tshort\twords,\tas follows:\n\nvar\tseneca\t=\trequire('seneca')();\n\nseneca.add({cmd:\t'wordcount'},\tfunction(msg,\trespond)\t { \t\tvar\tlength\t=\tmsg.phrase.split('\t').length; \t\trespond(null,\t{words:\tlength}); });\n\nseneca.add({cmd:\t'wordcount',\tskipShort:\ttrue},\t function(msg,\trespond)\t{ \t\tvar\twords\t=\tmsg.phrase.split('\t'); \t\tvar\tvalidWords\t=\t0; \t\tfor\t(var\ti\t=\t0;\ti\t<\twords.length;\ti++)\t{ \t\t\t\tif\t(words[i].length\t>\t3)\t{ \t\t\t\t\t\tvalidWords++; \t\t\t\t} \t\t} \t\trespond(null,\t{words:\tvalidWords}); });\n\nseneca.act({cmd:\t'wordcount',\tphrase:\t'Hello\tworld\t this\tis\tSeneca'},\tfunction(err,\tresponse)\t{ \t\tconsole.log(response); });\n\nseneca.act({cmd:\t'wordcount',\tskipShort:\ttrue,\tphrase:\t 'Hello\tworld\tthis\tis\tSeneca'},\tfunction(err,\tresponse)\t { \t\tconsole.log(response); });\n\nAs\tyou\tcan\tsee,\twe\thave\tadded\tanother\thandler\tfor\tthe\twordcount command\twith\tan\textra\tskipShort\tparameter.\n\nThis\thandler\tnow\tskips\tall\tthe\twords\twith\tthree\tor\tfewer\tcharacters.\tIf\tyou execute\tthe\tpreceding\tcode,\tthe\toutput\tis\tsimilar\tto\tthe\tfollowing\timage:\n\nThe\tfirst\tline,\t{words:\t5},\tcorresponds\tto\tthe\tfirst\tact\tcall.\tThe\tsecond line,\t{words:\t4},\tcorresponds\tto\tthe\tsecond\tcall.\n\nPatrun\t–\ta\tpattern-matching\tlibrary\n\nPatrun\tis\talso\twritten\tby\tRichard\tRodger.\tIt\tis\tused\tby\tSeneca\tin\torder\tto execute\tthe\tpattern\tmatching\tand\tdecide\twhich\tservice\tshould\trespond to\tthe\tcall.\n\nPatrun\tuses\ta\tclosest\tmatch\tapproach\tto\tresolve\tthe\tcalls.\tLet's\tsee\tthe following\texample:\n\nIn\tthe\tpreceding\timage,\twe\tcan\tsee\tthree\tpatterns.\tThese\tare\tequivalent to\tseneca.add()\tfrom\tthe\texample\tin\tthe\tprevious\tsection.\n\nIn\tthis\tcase,\twe\tare\tregistering\tthree\tdifferent\tcombinations\tof\tx\tand\ty\n\nvariables.\tNow,\tlet's\tsee\thow\tPatrun\tdoes\tthe\tmatching:\n\n{x:\t1}\t->A:\tThis\tmatches\t100%\twith\tA {x:\t2}\t->:\tNo\tmatch {x:1,\ty:1}\t->\tB:\t100%\tmatch\twith\tB;\tit\talso\tmatches\twith\tA,\tbut\tB is\ta\tbetter\tmatch—two\tout\tof\ttwo\tvs\tone\tout\tof\tone {x:1,\ty:2}\t->\tC:\t100%\tmatch\twith\tC;\tagain,\tit\talso\tmatches\twith\tA, but\tC\tis\tmore\tconcrete {y:\t1}\t->:\tNo\tmatch\n\nAs\tyou\tcan\tsee,\tPatrun\t(and\tSeneca)\twill\talways\tget\tthe\tlongest\tmatch. In\tthis\tway,\twe\tcan\teasily\textend\tthe\tfunctionality\tof\tthe\tmore\tabstract patterns\tby\tconcreting\tthe\tmatching.\n\nReusing\tpatterns\n\nIn\tthe\tpreceding\texample,\tin\torder\tto\tskip\tthe\twords\twith\tfewer\tthan\tthree characters,\twe\tdon't\treuse\tthe\tword\tcount\tfunction.\n\nIn\tthis\tcase,\tit\tis\tquite\thard\tto\treuse\tthe\tfunction\tas\tis;\talthough\tthe problem\tsounds\tvery\tsimilar,\tthe\tsolution\tbarely\toverlaps.\n\nHowever,\tlet's\tgo\tback\tto\tthe\texample\twhere\twe\tadd\ttwo\tnumbers:\n\nvar\tseneca\t=\trequire(\t'seneca'\t)()\n\nseneca.add({role:\t'math',\tcmd:\t'sum'},\tfunction\t(msg,\t respond)\t{ \t\tvar\tsum\t=\tmsg.left\t+\tmsg.right \t\trespond(null,\t{answer:\tsum}) });\n\nseneca.add({role:\t'math',\tcmd:\t'sum',\tinteger:\ttrue},\t function\t(msg,\trespond)\t{ \t\tthis.act({role:\t'math',\tcmd:\t'sum',\tleft:\t Math.floor(msg.left),\tright:\t Math.floor(msg.right)},respond); });\n\nseneca.act({role:\t'math',\tcmd:\t'sum',\tleft:\t1.5,\t right:\t2.5},\tconsole.log)\n\nseneca.act({role:\t'math',\tcmd:\t'sum',\tleft:\t1.5,\n\nright:\t2.5,\tinteger:\ttrue},\tconsole.log)\n\nAs\tyou\tcan\tsee,\tthe\tcode\thas\tchanged\ta\tbit.\tNow,\tthe\tpattern\tthat accepts\tan\tinteger\trelies\ton\tthe\tbase\tpattern\tto\tcalculate\tthe\tsum\tof\tthe numbers.\n\nPatrun\talways\ttries\tto\tmatch\tthe\tclosest\tand\tmost\tconcrete\tpattern\tthat\tit can\tfind\twith\tthe\tfollowing\ttwo\tdimensions:\n\nThe\tlongest\tchain\tof\tmatches The\torder\tof\tthe\tpatterns\n\nIt\twill\talways\ttry\tto\tfind\tthe\tbest\tfit,\tand\tif\tthere\tis\tan\tambiguity,\tit\twill match\tthe\tfirst\tpattern\tfound.\n\nIn\tthis\tway,\twe\tcan\trely\ton\talready-existing\tpatterns\tto\tbuild\tnew services.\n\nWriting\tplugins\n\nPlugins\tare\tan\timportant\tpart\tof\tapplications\tbased\ton\tSeneca.\tAs\twe discussed\tin\tChapter\t1,\tMicroservices\tArchitecture,\tthe\tAPI\taggregation is\tthe\tperfect\tway\tof\tbuilding\tapplications.\n\nNode.js'\tmost\tpopular\tframeworks\tare\tbuilt\taround\tthis\tconcept:\tsmall pieces\tof\tsoftware\tthat\tare\tcombined\tto\tcreate\ta\tbigger\tsystem.\n\nSeneca\tis\talso\tbuilt\taround\tthis;\tSeneca.add()\tprinciple\tadds\ta\tnew\tpiece to\tthe\tpuzzle\tso\tthat\tthe\tfinal\tAPI\tis\ta\tmixture\tof\tdifferent\tsmall\tsoftware pieces.\n\nSeneca\tgoes\tone\tstep\tfurther\tand\timplements\tan\tinteresting\tplugin system\tso\tthat\tthe\tcommon\tfunctionality\tcan\tbe\tmodularized\tand abstracted\tinto\treusable\tcomponents.\n\nThe\tfollowing\texample\tis\tthe\tminimal\tSeneca\tplugin:\n\nfunction\tminimal_plugin(\toptions\t)\t{ \t\tconsole.log(options) }\n\nrequire(\t'seneca'\t)() \t\t.use(\tminimal_plugin,\t{foo:'bar'}\t)\n\nWrite\tthe\tcode\tinto\ta\tminimal-plugin.js\tfile\tand\texecute\tit:\n\nnode\tminimal-plugin.js\n\nThe\toutput\tof\tthis\texecution\tshould\tbe\tsomething\tsimilar\tto\tthe\tfollowing image:\n\nIn\tSeneca,\ta\tplugin\tis\tloaded\tat\tthe\tstartup,\tbut\twe\tdon't\tsee\tit\tas\tthe default\tlog\tlevel\tis\tINFO.\tThis\tmeans\tthat\tSeneca\twon't\tshow\tany DEBUG\tlevel\tinfo.\tIn\torder\tto\tsee\twhat\tSeneca\tis\tdoing,\twe\tneed\tto\tget more\tinformation,\tas\tfollows:\n\nnode\tminimal-plugin.js\t–seneca.log.all\n\nThis\tproduces\ta\thuge\toutput.\tThis\tis\tpretty\tmuch\teverything\tthat\tis happening\tinside\tSeneca,\twhich\tcan\tbe\tvery\tuseful\tto\tdebug\tcomplicated situations,\tbut\tin\tthis\tcase,\twhat\twe\twant\tto\tdo\tis\tshow\ta\tlist\tof\tplugins:\n\nnode\tminimal-plugin.js\t--seneca.log.all\t|\tgrep\tplugin\t |\tgrep\tDEFINE\n\nIt\twill\tproduce\tsomething\tsimilar\tto\tthe\tfollowing\timage:\n\nLet's\tanalyze\tthe\tpreceding\toutput:\n\nbasic:\tThis\tplugin\tis\tincluded\twith\tthe\tmain\tSeneca\tmodule\tand provides\ta\tsmall\tset\tof\tbasic\tutility\taction\tpatterns.\n\ntransport:\tThis\tis\tthe\ttransport\tplugin.\tUp\tuntil\tnow,\twe\thave\tonly executed\tdifferent\tservices\t(quite\tsmall\tand\tconcise)\ton\tthe\tsame machine,\tbut\twhat\tif\twe\twant\tto\tdistribute\tthem?\tThis\tplugin\twill\thelp us\twith\tthat,\tand\twe\twill\tsee\thow\tto\tdo\tso\tin\tthe\tfollowing\tsections. web:\tIn\tChapter\t1,\tMicroservices\tArchitecture,\twe\tmentioned\tthat\tthe microservices\tshould\tadvocate\tto\tkeep\tthe\tpipes\tthat\tconnect\tthem under\ta\tstandard\tthat\tis\twidely\tused.\tSeneca\tuses\tTCP\tby\tdefault, but\tcreating\ta\tRESTful\tAPI\tcan\tbe\ttricky.\tThis\tplugin\thelps\tto\tdo\tit, and\twe\twill\tsee\thow\tto\tdo\tthis\tin\tthe\tfollowing\tsection. mem-store:\tSeneca\tcomes\twith\ta\tdata\tabstraction\tlayer\tso\tthat\twe can\thandle\tthe\tdata\tstorage\tin\tdifferent\tplaces:\tMongo,\tSQL databases,\tand\tso\ton.\tOut\tof\tthe\tbox,\tSeneca\tprovides\tan\tin- memory\tstorage\tso\tthat\tit\tjust\tworks. minimal_plugin:\tThis\tis\tour\tplugin.\tSo,\tnow\twe\tknow\tthat\tSeneca\tis able\tto\tload\tit.\n\nThe\tplugin\twe\twrote\tdoes\tnothing.\tNow,\tit\tis\ttime\tto\twrite\tsomething useful:\n\nfunction\tmath(\toptions\t)\t{\n\nthis.add({role:'math',\tcmd:\t'sum'},\tfunction(\tmsg,\t respond\t)\t{ \t\t\t\trespond(\tnull,\t{\tanswer:\tmsg.left\t+\tmsg.right\t}\t) \t\t})\n\nthis.add({role:'math',\tcmd:\t'product'},\tfunction(\t msg,\trespond\t)\t{ \t\t\t\trespond(\tnull,\t{\tanswer:\tmsg.left\t*\tmsg.right\t}\t) \t\t})\n\n}\n\nrequire(\t'seneca'\t)() \t\t.use(\tmath\t) \t\t.act(\t'role:math,cmd:sum,left:1,right:2',\t console.log\t)\n\nFirst\tof\tall,\tnotice\tthat\tin\tthe\tlast\tinstruction,\tact()\tfollows\ta\tdifferent format.\tInstead\tof\tpassing\ta\tdictionary,\twe\tpass\ta\tstring\twith\tthe\tsame key\tvalues\tas\tthe\tfirst\targument,\tas\twe\tdid\twith\ta\tdictionary.\tThere\tis nothing\twrong\twith\tit,\tbut\tmy\tpreferred\tapproach\tis\tto\tuse\tthe\tJSON\n\nobjects\t(dictionaries),\tas\tit\tis\ta\tway\tof\tstructuring\tthe\tdata\twithout\thaving syntax\tproblems.\n\nIn\tthe\tprevious\texample,\twe\tcan\tsee\thow\tthe\tcode\tgot\tstructured\tas\ta plugin.\tIf\twe\texecute\tit,\twe\tcan\tsee\tthat\tthe\toutput\tis\tsimilar\tto\tthe following\tone:\n\nOne\tof\tthe\tthings\tyou\tneed\tto\tbe\tcareful\tabout\tin\tSeneca\tis\thow\tto initialize\tyour\tplugins.\tThe\tfunction\tthat\twraps\tthe\tplugin\t(in\tthe\tpreceding example,\tthe\tmath()\tfunction)\tis\texecuted\tsynchronously\tby\tdesign\tand\tit is\tcalled\tthe\tdefinition\tfunction.\tIf\tyou\tremember\tfrom\tthe\tprevious chapter,\tNode.js\tapps\tare\tsingle-threaded.\n\nTo\tinitialize\ta\tplugin,\tyou\tadd\ta\tspecial\tinit()\taction\tpattern.\tThis\taction pattern\tis\tcalled\tin\tsequence\tfor\teach\tplugin.\tThe\tinit()\tfunction\tmust call\tits\trespond\tcallback\twithout\terrors.\tIf\tthe\tplugin\tinitialization\tfails, then\tSeneca\texits\tthe\tNode.js\tprocess.\tYou\twant\tyour\tmicroservices\tto fail\tfast\t(and\tscream\tloudly)\twhen\tthere's\ta\tproblem.\tAll\tplugins\tmust complete\tinitialization\tbefore\tany\tactions\tare\texecuted.\n\nLet's\tsee\tan\texample\tof\thow\tto\tinitialize\ta\tplugin\tin\tthe\tfollowing\tway:\n\nfunction\tinit(msg,\trespond)\t{ \t\tconsole.log(\"plugin\tinitialized!\"); \t\tconsole.log(\"expensive\toperation\ttaking\tplace\tnow...\t DONE!\"); \t\trespond(); }\n\nfunction\tmath(\toptions\t)\t{\n\nthis.add({role:'math',\tcmd:\t'sum'},\tfunction(\tmsg,\t respond\t)\t{ \t\t\t\trespond(\tnull,\t{\tanswer:\tmsg.left\t+\tmsg.right\t}\t) \t\t})\n\nthis.add({role:'math',\tcmd:\t'product'},\tfunction(\t msg,\trespond\t)\t{ \t\t\t\trespond(\tnull,\t{\tanswer:\tmsg.left\t*\tmsg.right\t}\t) \t\t})\n\nthis.add({init:\t\"math\"},\tinit); } require(\t'seneca'\t)() \t\t.use(\tmath\t) \t\t.act(\t'role:math,cmd:sum,left:1,right:2',\t console.log\t)\n\nThen,\tafter\texecuting\tthis\tfile,\tthe\toutput\tshould\tlook\tvery\tsimilar\tto\tthe following\timage:\n\nAs\tyou\tcan\tread\tfrom\tthe\toutput,\tthe\tfunction\tthat\tinitializes\tthe\tplugin was\tcalled.\n\nTip\n\nThe\tgeneral\trule\tin\tNode.js\tapps\tis\tto\tnever\tblock\tthe\tthread.\tIf\tyou find\tyourself\tblocking\tthe\tthread,\tyou\tmight\tneed\tto\trethink\thow\tto avoid\tit.\n\nWeb\tserver\tintegration\n\nIn\tChapter\t1,\tMicroservices\tArchitecture,\twe\tput\ta\tspecial\temphasis\ton using\tstandard\ttechnologies\tto\tcommunicate\twith\tyour\tmicroservices.\n\nSeneca,\tby\tdefault,\tuses\ta\tTCP\ttransport\tlayer\tthat,\talthough\tit\tuses TCP,\tis\tnot\teasy\tto\tinteract\twith,\tas\tthe\tcriteria\tto\tdecide\tthe\tmethod\tthat gets\texecuted\tis\tbased\ton\ta\tpayload\tsent\tfrom\tthe\tclient.\n\nLet's\tdive\tinto\tthe\tmost\tcommon\tuse\tcase:\tyour\tservice\tis\tcalled\tby JavaScript\ton\ta\tbrowser.\tAlthough\tit\tcan\tbe\tdone,\tit\twould\tbe\tmuch easier\tif\tSeneca\texposed\ta\tREST\tAPI\tinstead\tof\tthe\tJSON\tdialog,\twhich is\tperfect\tfor\tcommunication\tbetween\tmicroservices\t(unless\tyou\thave ultra-low\tlatency\trequirements).\n\nSeneca\tis\tnot\ta\tweb\tframework.\tIt\tcan\tbe\tdefined\tas\ta\tgeneral\tpurpose microservices\tframework,\tso\tit\twould\tnot\tmake\ttoo\tmuch\tsense\tto\tbuild\tit around\ta\tconcrete\tcase\tlike\tthe\tone\texposed\tbefore.\n\nInstead\tof\tthat,\tSeneca\twas\tbuilt\tin\ta\tway\tthat\tmakes\tthe\tintegration\twith other\tframeworks\tfairly\teasy.\n\nExpress\tis\tthe\tfirst\toption\twhen\tbuilding\tweb\tapplications\ton\tNode.js. The\tamount\tof\texamples\tand\tdocumentation\tthat\tcan\tbe\tfound\ton Internet\tabout\tExpress\tmakes\tthe\ttask\tof\tlearning\tit\tfairly\teasy.\n\nSeneca\tas\tExpress\tmiddleware\n\nExpress\twas\talso\tbuilt\tunder\tthe\tprinciple\tof\tAPI\tcomposition.\tEvery piece\tof\tsoftware\tin\tExpress\tis\tcalled\tmiddleware,\tand\tthey\tare\tchained in\tthe\tcode\tin\torder\tto\tprocess\tevery\trequest.\n\nIn\tthis\tcase,\twe\tare\tgoing\tto\tuse\tseneca-web\tas\ta\tmiddleware\tfor Express\tso\tthat\tonce\twe\tspecify\tthe\tconfiguration,\tall\tthe\tURLs\twill\tfollow a\tnaming\tconvention.\n\nLet's\tconsider\tthe\tfollowing\texample:\n\nvar\tseneca\t=\trequire('seneca')()\n\nseneca.add('role:api,cmd:bazinga',function(args,done){ \t\tdone(null,{bar:\"Bazinga!\"}); }); seneca.act('role:web',{use:{ \t\tprefix:\t'/my-api', \t\tpin:\t{role:'api',cmd:'*'},\n\nmap:{ \t\t\t\tbazinga:\t{GET:\ttrue} \t\t} }}) var\texpress\t=\trequire('express') var\tapp\t=\texpress() app.use(\tseneca.export('web')\t) app.listen(3000)\n\nThis\tcode\tis\tnot\tas\teasy\tto\tunderstand\tas\tthe\tprevious\texamples,\tbut\tI'll do\tmy\tbest\tto\texplain\tit:\n\nThe\tsecond\tline\tadds\ta\tpattern\tto\tSeneca.\tWe\tare\tpretty\tfamiliar with\tit\tas\tall\tthe\texamples\ton\tthis\tbook\tdo\tthat. The\tthird\tinstruction,\tseneca.act(),\tis\twhere\tthe\tmagic\thappens.\tWe are\tmounting\tthe\tpatterns\twith\tthe\trole:api\tpattern\tand\tany\tcmd pattern\t(cmd:*)\tto\treact\tto\tURLs\tunder\t/my-api.\tIn\tthis\texample,\tthe first\tseneca.add()\twill\treply\tto\tthe\tURL\tmy-apibazinga,\tas\tmy-api\tis specified\tby\tthe\tprefix\tvariable\tand\tbazinga\tby\tthe\tcmd\tpart\tof\tthe seneca.add()\tcommand. app.use(seneca.export('web'))\tinstructs\tExpress\tto\tuse\tseneca-web as\tmiddleware\tto\texecute\tactions\tbased\ton\tthe\tconfiguration\trules. app.listen(3000)\tbinds\tthe\tport\t3000\tto\tExpress.\n\nIf\tyou\tremember\tfrom\tan\tearlier\tsection\tin\tthis\tchapter,\tseneca.act() takes\ta\tfunction\tas\ta\tsecond\tparameter.\tIn\tthis\tcase,\twe\tare\texposing configuration\tto\tbe\tused\tby\tExpress\ton\thow\tto\tmap\tthe\tincoming requests\tto\tSeneca\tactions.\n\nLet's\ttest\tit:\n\nThe\tpreceding\tcode\tis\tpretty\tdense,\tso\tlet's\texplain\tit\tdown\tto\tthe\tcode from\tthe\tbrowser:\n\nExpress\treceives\ta\trequest\tthat\tis\thandled\tby\tseneca-web. The\tseneca-web\tplugin\twas\tconfigured\tto\tuse\tmy-api\tas\ta\tprefix, which\tis\tbeing\tbound\twith\tthe\tkeyword\tpin\t(refer\tto\tseneca.act() from\tthe\tpreceding\tcode)\tto\tSeneca\tactions\t(seneca.add())\tthat\n\ncontain\tthe\trole:api\tpattern,\tplus\tany\tcmd\tpattern\t(cmd:*).\tIn\tthis case,\tmy-apibazinga\tcorresponds\tto\tthe\tfirst\t(and\tonly)\tseneca.add() command\twith\tthe\t{role:\t'api',\tcmd:\t'bazinga'}\tpattern.\n\nIt\ttakes\ta\twhile\tto\tfully\tunderstand\tthe\tintegration\tbetween\tSeneca\tand Express,\tbut\tonce\tit\tis\tclear,\tthe\tflexibility\toffered\tby\tthe\tAPI composability\tpattern\tis\tlimitless.\n\nExpress\titself\tis\tbig\tenough\tto\tbe\tout\tof\tthe\tscope\tof\tthis\tbook,\tbut\tit\tis worth\ttaking\ta\tlook\tas\tit\tis\ta\tvery\tpopular\tframework.\n\nData\tstorage\n\nSeneca\tcomes\twith\ta\tdata-abstraction\tlayer\tthat\tallows\tyou\tto\tinteract with\tthe\tdata\tof\tyour\tapplication\tin\ta\tgeneric\tway.\n\nBy\tdefault,\tSeneca\tcomes\twith\tan\tin-memory\tplugin\t(as\texplained\tin\tthe previous\tsection),\ttherefore,\tit\tworks\tout\tof\tthe\tbox.\n\nWe\tare\tgoing\tto\tbe\tusing\tit\tfor\tthe\tmajority\tof\tthis\tbook,\tas\tthe\tdifferent storage\tsystems\tare\tcompletely\tout\tof\tscope\tand\tSeneca\tabstracts\tus from\tthem.\n\nSeneca\tprovides\ta\tsimple\tdata\tabstraction\tlayer\t(Object-relational mapping\t(ORM))\tbased\ton\tthe\tfollowing\toperations:\n\nload:\tThis\tloads\tan\tentity\tby\tidentifier save:\tThis\tcreates\tor\tupdates\t(if\tyou\tprovide\tan\tidentifier)\tan\tentity list:\tThis\tlists\tentities\tmatching\ta\tsimple\tquery remove:\tThis\tdeletes\tan\tentity\tby\tan\tidentifier\n\nLet's\tbuild\ta\tplugin\tthat\tmanages\temployees\tin\tthe\tdatabase:\n\nmodule.exports\t=\tfunction(options)\t{ \t\tthis.add({role:\t'employee',\tcmd:\t'add'},\t function(msg,\trespond){\n\nthis.make('employee').data$(msg.data).save$(respond); \t\t});\n\nthis.find({role:\t'employee',\tcmd:\t'get'},\t function(msg,\trespond)\t{\n\nthis.make('employee').load$(msg.id,\trespond); \t\t}); }\n\nRemember\tthat\tthe\tdatabase\tis,\tby\tdefault,\tin\tmemory,\tso\twe\tdon't\tneed to\tworry\tabout\tthe\ttable\tstructure\tfor\tnow.\n\nThe\tfirst\tcommand\tadds\tan\temployee\tto\tthe\tdatabase.\tThe\tsecond command\trecovers\tan\temployee\tfrom\tthe\tdatabase\tby\tid.\n\nNote\tthat\tall\tthe\tORM\tprimitives\tin\tSeneca\tend\tup\twith\tthe\tdollar\tsymbol ($).\n\nAs\tyou\tcan\tsee\tnow,\twe\thave\tbeen\tabstracted\tfrom\tthe\tdata\tstorage details.\tIf\tthe\tapplication\tchanges\tin\tthe\tfuture\tand\twe\tdecide\tto\tuse MongoDB\tas\ta\tdata\tstorage\tinstead\tof\tan\tin-memory\tstorage,\tthe\tonly thing\twe\tneed\tto\ttake\tcare\tof\tis\tthe\tplugin\tthat\tdeals\twith\tMongoDB.\n\nLet's\tuse\tour\temployee\tmanagement\tplugin,\tas\tshown\tin\tthe\tfollowing code:\n\nvar\tseneca\t=\trequire('seneca')().use('employees- storage') var\temployee\t=\t\t{ \t\tname:\t\"David\", \t\tsurname:\t\"Gonzalez\", \t\tposition:\t\"Software\tDeveloper\" }\n\nfunction\tadd_employee()\t{ \t\tseneca.act({role:\t'employee',\tcmd:\t'add',\tdata:\t employee},\tfunction\t(err,\tmsg)\t{ \t\t\t\tconsole.log(msg); \t\t}); } add_employee();\n\nIn\tthe\tpreceding\texample,\twe\tadd\tan\temployee\tto\tthe\tin-memory database\tby\tinvoking\tthe\tpattern\texposed\tin\tthe\tplugin.\n\nAlong\tthe\tbook,\twe\twill\tsee\tdifferent\texamples\tabout\thow\tto\tuse\tthe\tdata abstraction\tlayer,\tbut\tthe\tmain\tfocus\twill\tbe\ton\thow\tto\tbuild\tmicroservices and\tnot\thow\tto\tdeal\twith\tthe\tdifferent\tdata\tstorages.\n\nPM2\t–\ta\ttask\trunner\tfor\tNode.js\n\nPM2\tis\ta\tproduction-process\tmanager\tthat\thelps\tto\tscale\tthe\tNode.js\tup or\tdown,\tas\twell\tas\tload\tbalance\tthe\tinstances\tof\tthe\tserver.\tIt\talso ensures\tthat\tthe\tprocesses\tare\trunning\tconstantly,\ttackling\tdown\tone\tof the\tside\teffects\tof\tthe\tthread\tmodel\tof\tNode.js:\tan\tuncaught\texception kills\tthe\tthread,\twhich\tin\tturn\tkills\tyour\tapplication.\n\nSingle-threaded\tapplications\tand exceptions\n\nAs\tyou\tlearned\tbefore,\tNode.js\tapplications\tare\trun\tin\ta\tsingle\tthread. This\tdoesn't\tmean\tthat\tNode.js\tis\tnot\tconcurrent,\tit\tonly\tmeans\tthat\tyour application\truns\ton\ta\tsingle\tthread,\tbut\teverything\telse\truns\tparallel.\n\nThis\thas\tan\timplication:\tif\tan\texception\tbubbles\tout\twithout\tbeing handled,\tyour\tapplication\tdies.\n\nThe\tsolution\tfor\tthis\tis\tmaking\tan\tintensive\tuse\tof\tpromises\tlibraries\tsuch as\tbluebird;\tit\tadds\thandlers\tfor\tsuccess\tand\tfailures\tso\tthat\tif\tthere\tis an\terror,\tthe\texception\tdoes\tnot\tbubble\tout,\tkilling\tyour\tapp.\n\nHowever,\tthere\tare\tsome\tsituations\tthat\twe\tcan't\tcontrol,\twe\tcall\tthem unrecoverable\terrors\tor\tbugs.\tEventually,\tyour\tapplication\twill\tdie\tdue\tto a\tbadly\thandled\terror.\tIn\tlanguages\tsuch\tas\tJava,\tan\texception\tis\tnot\ta huge\tdeal:\tthe\tthread\tdies,\tbut\tthe\tapplication\tcontinues\tworking.\n\nIn\tNode.js,\tit\tis\ta\tbig\tproblem.\tThis\tproblem\twas\tsolved\tin\tthe\tfirst instance\tusing\ttask\trunners\tsuch\tas\tforever.\n\nBoth\tof\tthem\tare\ttask\trunners\tthat,\twhen\tyour\tapplication\texits\tfor\tsome reason,\trerun\tit\tagain\tso\tit\tensures\tthe\tuptime.\n\nConsider\tthe\tfollowing\texample:\n\nThe\thelloWorld.js\tapplication\tis\tnow\thandled\tby\tforever,\twhich\twill\trerun it\tif\tthe\tapplication\tdies.\tLet's\tkill\tit,\tas\tshown\tin\tthe\tfollowing\timage:\n\nAs\tyou\tcan\tsee,\tforever\thas\tspawned\ta\tdifferent\tprocess\twith\tthe\t4903 PID.\tNow,\twe\tissue\ta\tkill\tcommand\t(kill\t-9\t4093)\tand\tthat\tis\tthe\toutput from\tforever,\tas\tfollows:\n\nAlthough\twe\thave\tkilled\tit,\tour\tapplication\twas\trespawned\tby\tforever without\tany\tdowntime\t(at\tleast,\tnoticeable\tdowntime).\n\nAs\tyou\tcan\tsee,\tforever\tis\tpretty\tbasic:\tit\treruns\tthe\tapplication\tas\tmany times\tas\tit\tgets\tkilled.\n\nThere\tis\tanother\tpackage\tcalled\tnodemon,\twhich\tis\tone\tof\tthe\tmost useful\ttools\tfor\tdeveloping\tNode.js\tapplications.\tIt\treloads\tthe\tapplication if\tit\tdetects\tchanges\tin\tthe\tfiles\tthat\tit\tmonitors\t(by\tdefault,\t.):\n\nNow,\tif\twe\tmodify\tthe\thelloWorld.js\tfile,\twe\tcan\tsee\thow\tnodemon reloads\tthe\tapplication.\tThis\tis\tvery\tinteresting\tin\torder\tto\tavoid\tthe edit/reload\tcycle\tand\tspeed\tup\tthe\tdevelopment.\n\nUsing\tPM2\t–\tthe\tindustry-standard\ttask runner\n\nAlthough,\tforever\tlooks\tvery\tinteresting,\tPM2\tis\ta\tmore\tadvanced\ttask runner\tthan\tforever.\tWith\tPM2,\tyou\tcan\tcompletely\tmanage\tyour application\tlife\tcycle\twithout\tany\tdowntime,\tas\twell\tas\tscale\tyour application\tup\tor\tdown\twith\ta\tsimple\tcommand.\n\nPM2\talso\tacts\tas\ta\tload\tbalancer.\n\nLet's\tconsider\tthe\tfollowing\texample:\n\nvar\thttp\t=\trequire('http');\n\nvar\tserver\t=\thttp.createServer(function\t(request,\t response)\t{ \t\tconsole.log('called!'); \t\tresponse.writeHead(200,\t{\"Content-Type\":\t \"text/plain\"}); \t\tresponse.end(\"Hello\tWorld\\n\"); }); server.listen(8000); console.log(\"Server\trunning\tat\t http://127.0.0.1:8000/\");\n\nThis\tis\ta\tfairly\tsimple\tapplication.\tLet's\trun\tit\tusing\tPM2:\n\npm2\tstart\thelloWorld.js\n\nThis\tproduces\tan\toutput\tsimilar\tto\tthe\tfollowing\timage:\n\nPM2\thas\tregistered\tan\tapp\tnamed\thelloWorld.\tThis\tapp\tis\trunning\tin\tthe fork\tmode\t(that\tmeans,\tPM2\tis\tnot\tacting\tas\ta\tload\tbalancer,\tit\thas\tjust\n\nforked\tthe\tapp)\tand\tthe\tPID\tof\tthe\toperating\tsystem\tis\t6858.\n\nNow,\tas\tthe\tfollowing\tscreen\tsuggests,\twe\twill\trun\tpm2\tshow\t0,\twhich shows\tthe\tinformation\trelevant\tto\tthe\tapp\twith\tid\t0,\tas\tshown\tin\tthe following\timage:\n\nWith\ttwo\tcommands,\twe\thave\tmanaged\tto\trun\ta\tsimple\tapplication\tin\ta very\tsophisticated\tway.\n\nFrom\tnow\ton,\tPM2\twill\tensure\tthat\tyour\tapp\tis\talways\trunning\tso\tthat\tif your\tapplication\tdies,\tPM2\twill\trestart\tit\tagain.\n\nWe\tcan\talso\tmonitor\tthe\tnumber\tof\tapps\tPM2\tis\trunning:\n\npm2\tmonit\n\nThis\tshows\tthe\tfollowing\toutput:\n\nThis\tis\tthe\tPM2\tmonitor.\tIn\tthis\tcase,\tit\tis\ta\tcomplete\toverkill\tas\tour system\tis\tonly\tcomposed\tof\tone\tapplication,\twhich\truns\tin\tthe\tfork\tmode.\n\nWe\tcan\talso\tsee\tthe\tlogs\texecuting\tpm2\tlogs\tas\tshown\tin\tthe\tfollowing image:\n\nAs\tyou\tcan\tsee,\tPM2\tfeels\tsolid.\tWith\tfew\tcommands,\twe\thave\tcovered 90%\tof\tthe\tmonitoring\tnecessities\tof\tour\tapplication.\tHowever,\tthis\tis\tnot everything.\n\nPM2\talso\tcomes\twith\tan\teasy\tway\tto\treload\tyour\tapplications\twithout\n\ndowntime:\n\npm2\treload\tall\n\nThis\tcommand\tensures\tthat\tyour\tapps\tare\trestarted\twith\tzero\tdowntime. PM2\twill\tqueue\tthe\tincoming\trequests\tfor\tyou\tand\treprocess\tthem\tonce your\tapp\tis\tresponsive\tagain.\tThere\tis\ta\tmore\tfine-grained\toption\twhere you\tcan\tspecify\treloading\tonly\tcertain\tapps\tby\tspecifying\tthe\tapp\tname:\n\npm2\treload\thelloWorld\n\nFor\tthose\twho\thave\tbeen\tfighting\tfor\tyears\twith\tApache,\tNGINX,\tPHP- FPM,\tand\tso\ton,\tthis\twill\tsound\tvery\tfamiliar.\n\nAnother\tinteresting\tfeature\tin\tPM2\tis\trunning\tyour\tapplication\tin\tthe cluster\tmode.\tIn\tthis\tmode,\tPM2\tspawns\ta\tcontroller\tprocess\tand\tas many\tworkers\t(your\tapp)\tas\tyou\tspecify\tso\tthat\tyou\tcan\ttake\tthe\tbenefit of\tmulticore\tCPUs\twith\ta\tsingle-thread\ttechnology\tsuch\tas\tNode.js.\n\nBefore\tdoing\tthis,\twe\tneed\tto\tstop\tour\trunning\tapplication:\n\npm2\tstop\tall\n\nThis\twill\tresult\tin\tthe\tfollowing\toutput:\n\nPM2\tremembers\tthe\tapps\tthat\twere\trunning,\tso\tbefore\trerunning\tthe\tapp in\tthe\tcluster\tmode,\twe\tneed\tto\tinform\tPM2\tto\tforget\tabout\tyour\tapp,\tas follows:\n\npm2\tdelete\tall\n\nWe\tare\tready\tto\trun\tour\tapp\tin\tthe\tcluster\tmode:\n\npm2\tstart\thelloWorld.js\t-i\t3\n\nPM2\tis\tacting\tas\ta\tround-robin\tbetween\tthe\tmain\tprocess\tand\tthe\tthree workers\tso\tthat\tthey\tcan\tcope\twith\tthree\trequests\tat\tthe\tsame\ttime.\tWe can\talso\tscale\tdown\tor\tup\tour\tnumber\tof\tworkers:\n\npm2\tscale\thelloWorld\t2\n\nThis\twill\tresult\tin\ttwo\tprocesses\tbeing\trun\tfor\tthe\tsame\tapp\tinstead\tof three:\n\nAs\tyou\tcan\tsee,\twith\tvery\tlittle\teffort,\twe\thave\tmanaged\tto\tconfigure\tour app\tin\torder\tto\tbe\tproduction\tready.\n\nNow,\twe\tcan\tsave\tthe\tstatus\tof\tPM2\tso\tthat\tif\twe\trestart\tthe\tserver,\tand\n\nPM2\tis\trunning\tas\ta\tdaemon,\tthe\tapps\twill\tautomatically\tstart.\n\nPM2\thas\ta\tcode\tAPI\tso\tthat\twe\tcan\twrite\ta\tNode.js\tprogram\tto\tmanage all\tthe\tsteps\tthat\twe\thave\tbeen\tmanually\tdoing.\tIt\talso\thas\ta\tway\tof configuring\tyour\tservices\twith\ta\tJSON\tfile.\tWe\twill\tdiscuss\tthis\tin\tmore depth\tin\tChapter\t6,\tTesting\tand\tDocumenting\tNode.js\tMicroservices, when\twe\tstudy\thow\tto\tuse\tPM2\tand\tDocker\tto\tdeploy\tNode.js applications.\n\nSummary\n\nIn\tthis\tchapter,\tyou\tlearned\tthe\tbasics\tof\tSeneca\tand\tPM2\tso\tthat\twe\twill be\table\tto\tbuild\tand\trun\ta\tmicroservices-oriented\tsystem\tin\tChapter\t4, Writing\tYour\tFirst\tMicroservice\tin\tNode.js,\tof\tthis\tbook.\n\nWe\thave\talso\tdemonstrated\tthat\ta\tfew\tof\tthe\tconcepts\texposed\tin\tthe previous\tchapter\tare\tactually\thelpful\tin\tsolving\treal-world\tproblems\tas well\tas\tmaking\tour\tlife\tvery\teasy.\n\nIn\tthe\tnext\tchapter,\twe\twill\ttalk\tabout\thow\tto\tsplit\ta\tmonolithic application,\ta\ttask\tfor\twhich\twe\twill\tneed\tto\tknow\ta\tfew\tof\tthe\tconcepts developed\tduring\tthis\tchapter.\n\nChapter\t3.\tFrom\tthe\tMonolith\tto Microservices\n\nIn\tmy\tprofessional\tlife,\tI\thave\tworked\tin\tquite\ta\tfew\tdifferent\tcompanies, mainly\tin\tfinancial\tservices,\tand\tall\tof\tthe\tcompanies\tthat\tI\thave\tworked for\tfollow\tthe\tsame\tpattern\tas\tshown\tin\tthe\tfollowing:\n\n1.\t A\tcompany\tis\tset\tup\tby\ta\tcouple\tof\tpeople\twith\tgood\tdomain knowledge:\tinsurance,\tpayments,\tcredit\tcards,\tand\tso\ton.\n\n2.\t The\tcompany\tgrows,\tdemanding\tnew\tbusiness\trequirements\tthat need\tto\tbe\tsatisfied\tquickly\t(regulation,\tbig\tcustomers\tdemanding silly\tthings,\tand\tso\ton),\twhich\tare\tbuilt\tin\ta\thurry\twith\tlittle\tto\tno planning.\n\n3.\t The\tcompany\texperiences\tanother\tphase\tof\tgrowing,\twhere\tthe business\ttransactions\tare\tclearly\tdefined\tand\tpoorly\tmodelled\tby\ta hard-to-maintain\tmonolithic\tsoftware.\n\n4.\t The\tcompany\tincreases\tthe\theadcount\tthat\tdrives\tinto\tgrowing\tpains and\tloss\tof\tefficiency\tdue\tto\trestrictions\timposed\ton\thow\tthe software\twas\tbuilt\tin\tthe\tfirst\tinstance.\n\nThis\tchapter\tis\tnot\tonly\tabout\thow\tto\tavoid\tthe\tprevious\tflow (uncontrolled\torganic\tgrowth),\tbut\tit\tis\talso\tabout\thow\tto\tmodel\ta\tnew system\tusing\tmicroservices.\tThis\tchapter\tis\tthe\tsoul\tof\tthis\tbook,\tas\tI\twill try\tto\tsynthetize\tmy\texperience\tin\ta\tfew\tpages,\tsetting\tup\tthe\tprinciples to\tbe\tfollowed\tin\tChapter\t4,\tWriting\tYour\tFirst\tMicroservice\tin\tNode.js, where\twe\twill\tbe\tbuilding\ta\tfull\tsystem\tbased\ton\tmicroservices\tusing\tthe lessons\tlearned\tin\tthe\tprevious\tchapters.\n\nFirst,\tthere\twas\tthe\tmonolith\n\nA\thuge\tpercentage\t(my\testimate\tis\taround\t90%)\tof\tthe\tmodern enterprise\tsoftware\tis\tbuilt\tfollowing\ta\tmonolithic\tapproach.\n\nLarge\tsoftware\tcomponents\tthat\trun\tin\ta\tsingle\tcontainer\tand\thave\ta well-defined\tdevelopment\tlife\tcycle,\twhich\tgoes\tcompletely\tagainst\tthe agile\tprinciples,\tdeliver\tearly\tand\tdeliver\toften",
      "page_number": 55
    },
    {
      "number": 3,
      "title": "From\tthe\tMonolith\tto Microservices",
      "start_page": 94,
      "end_page": 114,
      "detection_method": "regex_chapter_title",
      "content": "(https://en.wikipedia.org/wiki/Release_early,_release_often),\tas\tfollows:\n\nDeliver\tearly:\tThe\tsooner\tyou\tfail,\tthe\teasier\tit\tis\tto\trecover.\tIf\tyou are\tworking\tfor\ttwo\tyears\ton\ta\tsoftware\tcomponent\tand\tthen\tit\tis released,\tthere\tis\ta\thuge\trisk\tof\tdeviation\tfrom\tthe\toriginal requirements,\twhich\tare\tusually\twrong\tand\tchange\tevery\tfew\tdays. Deliver\toften:\tDelivering\toften,\tthe\tstakeholders\tare\taware\tof\tthe progress\tand\tcan\tsee\tthe\tchanges\treflected\tquickly\tin\tthe\tsoftware. Errors\tcan\tbe\tfixed\tin\ta\tfew\tdays\tand\timprovements\tare\tidentified easily.\n\nCompanies\tbuild\tbig\tsoftware\tcomponents\tinstead\tof\tsmaller\tones\tthat work\ttogether\tas\tit\tis\tthe\tnatural\tthing\tto\tdo,\tas\tshown\tin\tthe\tfollowing:\n\n1.\t The\tdeveloper\thas\ta\tnew\trequirement. 2.\t He\tbuilds\ta\tnew\tmethod\ton\tan\texisting\tclass\ton\tthe\tservice\tlayer. 3.\t The\tmethod\tis\texposed\ton\tthe\tAPI\tvia\tHTTP,\tSOAP,\tor\tany\tother protocol.\n\nNow,\tmultiply\tit\tby\tthe\tnumber\tof\tdevelopers\tin\tyour\tcompany,\tand\tyou will\tobtain\tsomething\tcalled\torganic\tgrowth.\tOrganic\tgrowth\tis\ta\ttype\tof uncontrolled\tand\tunplanned\tgrowth\ton\tsoftware\tsystems\tunder\tbusiness pressure\twithout\tan\tadequate\tlong-term\tplanning,\tand\tit\tis\tbad.\n\nHow\tto\ttackle\torganic\tgrowth?\n\nThe\tfirst\tthing\trequired\tto\ttackle\torganic\tgrowth\tis\tto\tmake\tsure\tthat\tthe business\tand\tIT\tare\taligned\tin\tthe\tcompany.\tUsually,\tin\tbig\tcompanies,\tIT is\tnot\tseen\tas\ta\tcore\tpart\tof\tthe\tbusiness.\n\nOrganizations\toutsource\ttheir\tIT\tsystems,\tkeeping\tthe\tprice\tin\tmind,\tbut not\tthe\tquality\tso\tthat\tthe\tpartners\tbuilding\tthese\tsoftware\tcomponents are\tfocused\ton\tone\tthing:\tdeliver\ton\ttime\tand\taccording\tto\tthe specifications\teven\tif\tthey\tare\tincorrect.\n\nThis\tproduces\ta\tless-than-ideal\tecosystem\tto\trespond\tto\tthe\tbusiness needs\twith\ta\tworking\tsolution\tfor\tan\texisting\tproblem.\tIT\tis\tlead\tby people\twho\tbarely\tunderstand\thow\tthe\tsystems\tare\tbuilt,\tand\tusually overlook\tthe\tcomplexity\tof\tsoftware\tdevelopment.\n\nFortunately,\tthis\tis\ta\tchanging\ttendency\tas\tIT\tsystems\tbecome\tthe\tdriver of\t99%\tof\tthe\tbusinesses\taround\tthe\tworld,\tbut\twe\tneed\tto\tget\tsmarter about\thow\twe\tbuild\tthem.\n\nThe\tfirst\tmeasure\tto\ttackle\torganic\tgrowth\tis\taligning\tIT\tand\tbusiness stakeholders\tto\twork\ttogether:\teducating\tthe\tnontechnical\tstakeholders\tis the\tkey\tto\tsuccess.\n\nIf\twe\tgo\tback\tto\tthe\tfew\tbig\treleases\tschema.\tCan\twe\tdo\tit\tbetter?\n\nOf\tcourse\twe\tcan.\tDivide\tthe\twork\tinto\tmanageable\tsoftware\tartifacts that\tmodel\ta\tsingle,\twell-defined\tbusiness\tactivity\tand\tgive\tit\tan\tentity.\n\nIt\tdoes\tnot\tneed\tto\tbe\ta\tmicroservice\tat\tthis\tstage,\tbut\tkeeping\tthe\tlogic inside\tof\ta\tseparated,\twell-defined,\teasily\ttestable,\tand\tdecoupled module\twill\tgive\tus\ta\thuge\tadvantage\tfor\tfuture\tchanges\tin\tthe application.\n\nLet's\tconsider\tthe\tfollowing\texample:\n\nIn\tthis\tinsurance\tsystem,\tyou\tcan\tsee\tthat\tsomeone\twas\tin\ta\thurry.\tSMS and\te-mail\tsender,\talthough\tboth\tare\tcommunication\tchannels,\tthey\thave a\tvery\tdifferent\tnature\tand\tyou\tprobably\twant\tthem\tto\tact\tin\tdifferent ways.\n\nThe\tcalling\tservices\tare\tgrouped\tinto\tthe\tfollowing\ttwo\thigh-level\tentities:\n\nNew\tBusiness:\tThe\tnew\tcustomers\tthat\treceive\tan\te-mail\twhen they\tsign\tup Renewals:\tThe\texisting\tcustomers\tthat\treceive\tan\tSMS\twhen\tthe insurance\tpolicy\tis\tready\tto\tbe\trenewed\n\nAt\tsome\tpoint,\tthe\tsystem\tneeded\tto\tsend\tSMSs\tand\te-mails\tand someone\tcreated\tthe\tcommunication\tservice\tentity\tthat\thandles\tall\tthe third-party\tcommunications.\n\nIt\tlooks\tlike\ta\tgood\tidea\tin\tthe\tbeginning.\tSMS\tor\te-mail,\tat\tthe\tend\tof\tthe day,\tis\tonly\ta\tchannel,\tthe\tcommunication\tmechanism\twill\tbe\t90%\tsame and\twe\tcan\treuse\tplenty\tof\tfunctionality.\n\nWhat\thappens\tif\twe\tsuddenly\twant\tto\tintegrate\ta\tthird-party\tservice\tthat handles\tall\tthe\tphysical\tpost?\n\nWhat\thappens\tif\twe\twant\tto\tadd\ta\tnewsletter\tthat\tgoes\tout\tto\tthe customers\tonce\ta\tweek\twith\tinformation\tthat\twe\tconsider\tinteresting\tfor our\tcustomers?\n\nThe\tservice\twill\tgrow\tout\tof\tcontrol\tand\tit\twill\tbecome\tmore\tdifficult\tto test,\trelease,\tand\tensure\tthat\tthe\tchanges\tin\tthe\tSMS\tcode\twon't\taffect sending\tthe\te-mail\tin\tany\tform.\n\nThis\tis\torganic\tgrowth\tand,\tin\tthis\tcase,\tit\tis\trelated\tto\ta\tlaw\tcalled Conway's\tLaw,\twhich\tstates\tthe\tfollowing:\n\nAny\torganization\tthat\tdesigns\ta\tsystem\t(defined\tmore\tbroadly\there\tthan just\tinformation\tsystems)\twill\tinevitably\tproduce\ta\tdesign\twhose\tstructure is\ta\tcopy\tof\tthe\torganization's\tcommunication\tstructure.\n\nIn\tthis\tcase,\twe\tare\tfalling\tinto\ta\ttrap.\tWe\tare\ttrying\tto\tmodel\tthe communication\ton\ta\tsingle\tsoftware\tcomponent\tthat\tis\tprobably\ttoo\tbig and\tcomplex\tto\treact\tquickly\tto\tnew\tbusiness\tneeds.\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\tdiagram:\n\nNow,\twe\thave\tencapsulated\tevery\tcommunication\tchannel\ton\tits\town service\t(which,\tlater\ton,\twill\tbe\tdeployed\tas\ta\tmicroservice)\tand\twe\twill do\tthe\tsame\tfor\tfuture\tcommunication\tchannels.\n\nThis\tis\tthe\tfirst\tstep\tto\tbeat\torganic\tgrowth:\tcreate\tfine-grained\tservices with\twell-defined\tboundaries\tand\ta\tsingle\tresponsibility—do\tsomething small,\tbut\tdo\tit\twell.\n\nHow\tabstract\tis\ttoo\tabstract?\n\nOur\tbrain\tcan't\thandle\tcomplicated\tmechanisms.\tThe\tabstraction capacity\tis\tone\tof\tthe\tmost\trecent\thuman\tintelligence\tacquisitions.\n\nIn\tthe\texample\tfrom\tthe\tprevious\tsection,\tI've\tgiven\tsomething\tfor\tgood, which\twill\tupset\thalf\tof\tthe\tprogrammers\tin\tthe\tworld:\teradicating\tthe abstraction\tof\tour\tsystem.\n\nThe\tabstraction\tcapacity\tis\tsomething\tthat\twe\tlearn\talong\tthe\tyears\tand, unlike\tintelligence,\tit\tcan\tbe\ttrained.\tNot\teveryone\tcan\treach\tthe\tsame level\tof\tabstraction,\tand\tif\twe\tmix\tthe\tspecific\tand\tcomplex\tdomain knowledge\trequired\tby\tsome\tindustries\twith\ta\thigh-level\tof\tabstraction, we\thave\tthe\tperfect\trecipe\tfor\ta\tdisaster.\n\nWhen\tbuilding\tsoftware,\tone\tof\tthe\tgolden\trules\tthat\tI\talways\ttried\tto follow\t(and\ttry\tis\tthe\tcorrect\tword,\tas\tI\talways\tfind\thuge\topposition\tto\tit) is\tto\tavoid\tpremature\tabstraction.\n\nHow\tmany\ttimes\tdid\tyou\tfind\tyourself\tin\ta\tcorner\twith\ta\tsimple\tset\tof requirements:\tbuild\ta\tprogram\tto\tsolve\tX.\tHowever,\tyour\tteam\tgoes\toff and\tanticipates\tall\tthe\tpossible\tvariations\tof\tX,\twithout\teven\tknowing\tif they\tare\tplausible.\tThen,\tonce\tthe\tsoftware\tis\tin\tproduction,\tone\tof\tthe stakeholders\tcomes\twith\ta\tvariation\tof\tX\tthat\tyou\tcould\thave\tnever imagined\t(as\tthe\trequirements\twere\tnot\teven\tcorrect)\tand\tnow,\tgetting this\tvariation\tto\twork\twill\tcost\tyou\ta\tfew\tdays\tand\ta\tmassive\trefactor.\n\nThe\tway\tto\tavoid\tthis\tproblem\tis\tsimple:\tavoid\tabstraction\twithout\tat\tleast three\tuse\tcases.\n\nDo\tnot\tfactor\tin\tthe\tpossibility\tof\tsending\tthe\tdata\tthrough\tdifferent\ttypes of\tchannels\tas\tit\tmight\tnot\thappen\tand\tyou\tare\tcompromising\tthe\tcurrent feature\twith\tunnecessary\tabstractions.\tOnce\tyou\thave\tat\tleast\tone\tother communication\tchannel,\tit\tis\ttime\tto\tstart\tthinking\tabout\thow\tthese\ttwo software\tcomponents\tcan\tbe\tdesigned\tbetter,\tand\twhen\tthe\tthird\tuse case\tshows\tup,\trefactor.\n\nRemember\tthat\twhen\tbuilding\tmicroservices,\tthey\tshould\tbe\tsmall enough\tto\tbe\trewritten\ton\ta\tsingle\tsprint\t(around\ttwo\tweeks),\tso\tthe benefits\tof\thaving\ta\tworking\tprototype\tin\tsuch\ta\tshort\tperiod\tof\ttime\tis worth\tthe\trisk\tof\thaving\tto\trewrite\tit\tonce\tthe\trequirements\tare\tmore concrete:\tsomething\tto\tshow\tto\tthe\tstakeholders\tis\tthe\tquickest\tway\tto nail\tdown\tthe\trequirements.\n\nSeneca\tis\tgreat\tin\tthis\tregard\tas,\tthrough\tpattern\tmatching,\twe\tcan\n\nextend\tthe\tAPI\tof\ta\tgiven\tmicroservice\twithout\taffecting\tthe\texisting calling\tcode:\tour\tservice\tis\topen\tfor\textension,\tbut\tclosed\tfor\tmodification (the\tSOLID\tprinciples)\tas\twe\tare\tadding\tfunctionality\twithout\taffecting\tthe existing\tone.\tWe\twill\tsee\tmore\tcomplete\texamples\tof\tthis\tbehavior\tin Chapter\t4,\tWriting\tYour\tFirst\tMicroservice\tin\tNode.js.\n\nThen\tthe\tmicroservices\tappeared\n\nMicroservices\tare\there\tto\tstay.\tNowadays,\tthe\tcompanies\tgive\tmore importance\tto\tthe\tquality\tof\tthe\tsoftware.\tAs\tstated\tin\tthe\tprevious section,\tdeliver\tearly\tand\tdeliver\toften\tare\tthe\tkey\tto\tsucceed\tin\tsoftware development.\n\nMicroservices\tare\thelping\tus\tto\tsatisfy\tbusiness\tneeds\tas\tquickly\tas possible\tthrough\tmodularity\tand\tspecialization.\tSmall\tpieces\tof\tsoftware that\tcan\teasily\tbe\tversioned\tand\tupgraded\twithin\ta\tfew\tdays\tand\tthey are\teasy\tto\ttest\tas\tthey\thave\ta\tclear\tand\tsmall\tpurpose\t(specialization) and\tare\twritten\tin\tsuch\ta\tway\tthat\tthey\tare\tisolated\tfrom\tthe\trest\tof\tthe system\t(modularization).\n\nUnfortunately,\tit\tis\tnot\tcommon\tto\tfind\tthe\tsituation\tas\tdescribed previously.\tUsually,\tbig\tsoftware\tsystems\tare\tnot\tbuilt\tin\ta\tway\tthat modularization\tor\tspecialization\tare\teasy\tto\tidentify.\tThe\tgeneral\trule\tis\tto build\ta\tbig\tsoftware\tcomponent\tthat\tdoes\teverything\tand\tthe modularization\tis\tpoor,\tso\twe\tneed\tto\tstart\tfrom\tthe\tvery\tbasics.\n\nLet's\tstart\tby\twriting\tsome\tcode,\tas\tshown\tin\tthe\tfollowing:\n\nmodule.exports\t=\tfunction(options)\t{\n\nvar\tinit\t=\t{}\n\n/** \t\t\t\tSends\tone\tSMS \t\t\t/ \t\tinit.sendSMS\t=\tfunction(destination,\tcontent)\t{ \t\t\t\t//\tCode\tto\tsend\tSMS \t\t}\n\n/** \t\t\t\tReads\tthe\tpending\tlist\tof\tSMS. \t\t\t/ \t\tinit.readPendingSMS\t=\tfunction()\t{ \t\t\t\t//\tcode\tto\treceive\tSMS \t\t\t\treturn\tlistOfSms; \t\t}\n\n/**\n\nSends\tan\temail. \t\t\t/ \t\tinit.sendEmail\t=\tfunction(subject,\tcontent)\t{ \t\t\t\t//\tcode\tto\tsend\temails \t\t}\n\n/** \t\t\t\tGets\ta\tlist\tof\tpending\temails. \t\t\t/ \t\tinit.readPendingEmails\t=\tfunction()\t{ \t\t\t\t//\tcode\tto\tread\tthe\tpending\temails \t\t\t\treturn\tlistOfEmails; \t\t}\n\n/** \t\t\t\tThis\tcode\tmarks\tan\temail\tas\tread\tso\tit\tdoes\tnot\t get \t\t\t\tfetch\tagain\tby\tthe\treadPendingEmails\tfunction. \t\t\t/ \t\tinit.markEmailAsRead\t=\tfunction(messageId)\t{ \t\t\t\t//\tcode\tto\tmark\ta\tmessage\tas\tread. \t\t}\n\n/* \t\t\t\tThis\tfunction\tqueues\ta\tdocument\tto\tbe\tprinted\tand \t\t\t\tsent\tby\tpost. \t\t\t*/ \t\tinit.queuePost\t=\tfunction(document)\t{ \t\t\t\t//\tcode\tto\tqueue\tpost \t\t}\n\nreturn\tinit; }\n\nAs\tyou\tcan\tsee,\tthis\tmodule\tcan\tbe\teasily\tcalled\tcommunications service\tand\tit\twill\tbe\tfairly\teasy\tto\tguess\twhat\tit\tis\tdoing.\tIt\tmanages\tthe e-mail,\tSMS,\tand\tpost\tcommunications.\n\nThis\tis\tprobably\ttoo\tmuch.\tThis\tservice\tis\tdeemed\tto\tgrow\tout\tof\tcontrol, as\tpeople\twill\tkeep\tadding\tmethods\trelated\tto\tcommunications.\tThis\tis the\tkey\tproblem\tof\tmonolithic\tsoftware:\tthe\tbounded\tcontext\tspans across\tdifferent\tareas,\taffecting\tthe\tquality\tof\tour\tsoftware\tfrom\tboth functional\tand\tmaintenance\tpoint\tof\tview.\n\nIf\tyou\tare\ta\tsoftware\tdeveloper,\ta\tred\tflag\twill\tbe\traised\tstraightaway:\tthe cohesion\tof\tthis\tmodule\tis\tquite\tpoor.\n\nAlthough\tit\tcould\thave\tworked\tfor\ta\twhile,\twe\tare\tnow\tchanging\tour mindset.\tWe\tare\tbuilding\tsmall,\tscalable,\tand\tautonomous\tcomponents that\tcan\tbe\tisolated.\tThe\tcohesion\tin\tthis\tcase\tis\tbad\tas\tthe\tmodule\tis doing\ttoo\tmany\tdifferent\tthings:\te-mail,\tSMS,\tand\tpost.\n\nWhat\thappens\tif\twe\tadd\tanother\tcommunication\tchannel\tsuch\tas\tTwitter and\tFacebook\tnotifications?\n\nThe\tservice\tgrows\tout\tof\tcontrol.\tInstead\tof\thaving\tsmall\tfunctional software\tcomponents,\tyou\tend\tup\twith\ta\tgigantic\tmodule\tthat\twill\tbe difficult\tto\trefactor,\ttest,\tand\tmodify.\tLet's\ttake\ta\tlook\tat\tthe\tfollowing SOLID\tdesign\tprinciples,\texplained\tin\tChapter\t2,\tMicroservices\tin Node.js\t–\tSeneca\tand\tPM2\tAlternatives:\n\nSingle-responsibility\tprinciple:\tThe\tmodule\tdoes\ttoo\tmany\tthings. Open\tfor\textension,\tclosed\tfor\tmodification:\tThe\tmodule\twill need\tto\tbe\tmodified\tto\tadd\tnew\tfunctionalities\tand\tprobably\tchange the\tcommon\tcode. Liskov\tSubstitution:\tWe\twill\tskip\tthis\tone\tagain. Interface\tsegregation:\tWe\tdon't\thave\tany\tinterface\tspecified\tin\tthe module,\tjust\tthe\timplementation\tof\tan\tarbitrary\tset\tof\tfunctions. Dependency\tinjection:\tThere\tis\tno\tdependency\tinjection.\tThe module\tneeds\tto\tbe\tbuilt\tby\tthe\tcalling\tcode.\n\nThings\tget\tmore\tcomplicated\tif\twe\tdon't\thave\ttests.\n\nTherefore,\tlet's\tsplit\tit\tinto\tvarious\tsmall\tmodules\tusing\tSeneca.\n\nFirst,\tthe\te-mail\tmodule\t(email.js)\twill\tbe\tas\tfollows:\n\nmodule.exports\t=\tfunction\t(options)\t{\n\n/** \t\t\t\tSends\tan\temail. \t\t\t/ \t\tthis.add({channel:\t'email',\taction:\t'send'},\t function(msg,\trespond)\t{ \t\t\t\t//\tCode\tto\tsend\tan\temail. \t\t\t\trespond(null,\t{...}); \t\t});\n\n/**\n\nGets\ta\tlist\tof\tpending\temails. \t\t\t/ \t\tthis.add({channel:\t'email',\taction:\t'pending'},\t function(msg,\trespond)\t{ \t\t\t\t//\tCode\tto\tread\tpending\temail. \t\t\t\trespond(null,\t{...}); \t\t});\n\n/** \t\t\t\tMarks\ta\tmessage\tas\tread. \t\t\t/ \t\tthis.add({channel:\t'email',\taction:\t'read'},\t function(msg,\trespond)\t{ \t\t\t\t//\tCode\tto\tmark\ta\tmessage\tas\tread. \t\t\t\trespond(null,\t{...}); \t\t}); }\n\nThe\tSMS\tmodule\t(sms.js)\twill\tbe\tas\tfollows:\n\nmodule.exports\t=\tfunction\t(options)\t{\n\n/** \t\t\t\tSends\tan\temail. \t\t\t/ \t\tthis.add({channel:\t'sms',\taction:\t'send'},\t function(msg,\trespond)\t{ \t\t\t\t//\tCode\tto\tsend\ta\tsms. \t\t\t\trespond(null,\t{...}); \t\t});\n\n/** \t\t\t\tReceives\tthe\tpending\tSMS. \t\t\t/ \t\tthis.add({channel:\t'sms',\taction:\t'pending'},\t function(msg,\trespond)\t{ \t\t\t\t//\tCode\tto\tread\tpending\tsms. \t\t\t\trespond(null,\t{...}); \t\t}); }\n\nFinally,\tthe\tpost\tmodule\t(post.js)\twill\tbe\tas\tfollows:\n\nmodule.exports\t=\tfunction\t(options)\t{\n\n/** \t\t\t\tQueues\ta\tpost\tmessage\tfor\tprinting\tand\tsending.\n\n/ \t\tthis.add({channel:\t'post',\taction:\t'queue'},\t function(msg,\trespond)\t{ \t\t\t\t//\tCode\tto\tqueue\ta\tpost\tmessage. \t\t\t\trespond(null,\t{...}); \t\t}); }\n\nThe\tfollowing\tdiagram\tshows\tthe\tnew\tstructure\tof\tmodules:\n\nNow,\twe\thave\tthree\tmodules.\tEach\tone\tof\tthese\tmodules\tdoes\tone specific\tthing\twithout\tinterfering\twith\teach\tother;\twe\thave\tcreated\thigh- cohesion\tmodules.\n\nLet's\trun\tthe\tpreceding\tcode,\tas\tfollows:\n\nvar\tseneca\t=\trequire(\"seneca\")() \t\t\t\t\t\t.use(\"email\") \t\t\t\t\t\t.use(\"sms\") \t\t\t\t\t\t.use(\"post\");\n\nseneca.listen({port:\t1932,\thost:\t\"10.0.0.7\"});\n\nAs\tsimple\tas\tthat,\twe\thave\tcreated\ta\tserver\twith\tthe\tIP\t10.0.0.7\tbound that\tlistens\ton\tthe\t1932\tport\tfor\tincoming\trequests.\tAs\tyou\tcan\tsee,\twe haven't\treferenced\tany\tfile,\twe\tjust\treferenced\tthe\tmodule\tby\tname; Seneca\twill\tdo\tthe\trest.\n\nLet's\trun\tit\tand\tverify\tthat\tSeneca\thas\tloaded\tthe\tplugins:\n\nnode\tindex.js\t--seneca.log.all\t|\tgrep\tDEFINE\n\nThis\tcommand\twill\toutput\tsomething\tsimilar\tto\tthe\tfollowing\tlines:\n\nIf\tyou\tremember\tfrom\tChapter\t2,\tMicroservices\tin\tNode.js\t–\tSeneca\tand PM2\tAlternatives,\tSeneca\tloads\ta\tfew\tplugins\tby\tdefault:\tbasic, transport,\tweb,\tand\tmem-store,\twhich\tallow\tSeneca\tto\twork\tout\tof\tthe\tbox without\tbeing\thassled\twith\tthe\tconfiguration.\tObviously,\tas\twe\twill\tsee\tin Chapter\t4,\tWriting\tYour\tFirst\tMicroservice\tin\tNode.js,\tthat\tthe configuration\tis\tnecessary\tas,\tfor\texample,\tmem-store\twill\tonly\tstore\tdata in\tthe\tmemory\twithout\tpersisting\tit\tbetween\texecutions.\n\nAside\tfrom\tthe\tstandard\tplugins,\twe\tcan\tsee\tthat\tSeneca\thas\tloaded three\textra\tplugins:\temail,\tsms,\tand\tpost,\twhich\tare\tthe\tplugins\tthat\twe have\tcreated.\n\nAs\tyou\tcan\tsee,\tthe\tservices\twritten\tin\tSeneca\tare\tquite\teasy\tto understand\tonce\tyou\tknow\thow\tthe\tframework\tworks.\tIn\tthis\tcase,\tI\thave\n\nwritten\tthe\tcode\tin\tthe\tform\tof\ta\tplugin\tso\tthat\tit\tcan\tbe\tused\tby\tdifferent instances\tof\tSeneca\ton\tdifferent\tmachines,\tas\tSeneca\thas\ta\ttransparent transport\tmechanism\tthat\tallows\tus\tto\tquickly\tredeploy\tand\tscale\tparts\tof our\tmonolithic\tapp\tas\tmicroservices,\tas\tfollows:\n\nThe\tnew\tversion\tcan\tbe\teasily\ttested,\tas\tchanges\ton\tthe\te-mail functionality\twill\tonly\taffect\tsending\tthe\te-mail. It\tis\teasy\tto\tscale.\tAs\twe\twill\tsee\tin\tthe\tnext\tchapter,\treplicating\ta service\tis\tas\teasy\tas\tconfiguring\ta\tnew\tserver\tand\tpointing\tour Seneca\tclient\tto\tit. It\tis\talso\teasy\tto\tmaintain,\tas\tthe\tsoftware\tis\teasier\tto\tunderstand and\tmodify.\n\nDisadvantages\n\nWith\tmicroservices,\twe\tsolve\tthe\tbiggest\tproblems\tin\tmodern\tenterprise, but\tthat\tdoes\tnot\tmean\tthat\tthey\tare\tproblem\tfree.\tMicroservices\toften lead\tto\tdifferent\ttypes\tof\tproblems\tthat\tare\tnot\teasy\tto\tforesee.\n\nThe\tfirst\tand\tmost\tconcerning\tone\tis\tthe\toperational\toverhead\tthat\tcould chew\tup\tthe\tbenefits\tobtained\tfrom\tusing\tmicroservices.\tWhen\tyou\tare designing\ta\tsystem,\tyou\tshould\talways\thave\tone\tquestion\tin\tmind:\thow to\tautomate\tthis?\tAutomation\tis\tthe\tkey\tto\ttackling\tthis\tproblem.\n\nThe\tsecond\tdisadvantage\twith\tmicroservices\tis\tnonuniformity\ton\tthe applications.\tA\tteam\tmight\tconsider\tsomething\ta\tgood\tpractice\tthat\tcould be\tbanned\tin\tanother\tteam\t(especially\taround\texception\thandling),\twhich adds\tan\textra\tlayer\tof\tisolation\tbetween\tteams\tthat\tprobably\tdoes\tnot\tdo well\tfor\tthe\tcommunication\tof\tyour\tengineers\twithin\tthe\tteam.\n\nLastly,\tbut\tnot\tless\timportant,\tmicroservices\tintroduce\ta\tbigger communication\tcomplexity\tthat\tcould\tlead\tto\tsecurity\tproblems.\tInstead of\thaving\tto\tcontrol\ta\tsingle\tapplication\tand\tits\tcommunication\twith\tthe outer\tworld,\twe\tare\tnow\tfacing\ta\tnumber\tof\tservers\tthat\tcommunicate with\teach\tother.\n\nSplitting\tthe\tmonolith\n\nConsider\tthat\tthe\tmarketing\tdepartment\tof\tyour\tcompany\thas\tdecided\tto run\tan\taggressive\te-mail\tcampaign\tthat\tis\tgoing\tto\trequire\tpeaks\tof capacity\tthat\tcould\tharm\tthe\tnormal\tday-to-day\tprocess\tof\tsending\te- mail.\tUnder\tstress,\tthe\te-mails\twill\tbe\tdelayed\tand\tthat\tcould\tcause\tus problems.\n\nLuckily,\twe\thave\tbuilt\tour\tsystem\tas\texplained\tin\tthe\tprevious\tsection. Small\tSeneca\tmodules\tin\tthe\tform\tof\ta\thigh-cohesion\tand\tlow-coupled plugins.\n\nThen,\tthe\tsolution\tto\tachieve\tit\tis\tsimple:\tdeploy\tthe\te-mail\tservice (email.js)\ton\tmore\tthan\tone\tmachine:\n\nvar\tseneca\t=\trequire(\"seneca\")().use(\"email\"); seneca.listen({port:\t1932,\thost:\t\"new-email-service- ip\"});\n\nAlso,\tcreate\ta\tSeneca\tclient\tpointing\tto\tit,\tas\tfollows:\n\nvar\tseneca\t=\trequire(\"seneca\")() \t\t\t\t\t\t.use(\"email\") \t\t\t\t\t\t.use(\"sms\") \t\t\t\t\t\t.use(\"post\"); seneca.listen({port:\t1932,\thost:\t\"10.0.0.7\"});\n\n//\tinteract\twith\tthe\texisting\temail\tservice\tusing\t \"seneca\"\n\nvar\tsenecaEmail\t=\trequire(\"seneca\").client({host:\t \"new-email-service-ip\",\tport:\t1932});\n\n//\tinteract\twith\tthe\tnew\temail\tservice\tusing\t \"senecaEmail\"\n\nFrom\tnow\ton,\tthe\tsenecaEmail\tvariable\twill\tcontact\tthe\tremote\tservice when\tcalling\tact\tand\twe\twould\thave\tachieved\tour\tgoal:\tscale\tup\tour\tfirst microservice.\n\nProblems\tsplitting\tthe\tmonolith\t–\tit\tis\tall about\tthe\tdata\n\nData\tstorage\tcould\tbe\tproblematic.\tIf\tyour\tapplication\thas\tgrown\tout\tof control\tfor\ta\tnumber\tof\tyears,\tthe\tdatabase\twould\thave\tdone\tthe\tsame, and\tby\tnow,\tthe\torganic\tgrowth\twill\tmake\tit\thard\tto\tdeal\twith\tsignificant changes\tin\tthe\tdatabase.\n\nMicroservices\tshould\tlook\tafter\ttheir\town\tdata.\tKeeping\tthe\tdata\tlocal\tto the\tservice\tis\tone\tof\tthe\tkeys\tto\tensure\tthat\tthe\tsystem\tremains\tflexible as\tit\tevolves,\tbut\tit\tmight\tnot\tbe\talways\tpossible.\tAs\tan\texample, financial\tservices\tsuffer\tespecially\tfrom\tone\tof\tthe\tmain\tweak\tpoints\tof microservices-oriented\tarchitectures:\tthe\tlack\tof\ttransactionality.\tWhen\ta software\tcomponent\tdeals\twith\tmoney,\tit\tneeds\tto\tensure\tthat\tthe\tdata remains\tconsistent\tand\tnot\teventually\tconsistent\tafter\tevery\tsingle operation.\tIf\ta\tcustomer\tdeposits\tmoney\tin\ta\tfinancial\tcompany,\tthe software\tthat\tholds\tthe\taccount\tbalance\tneeds\tto\tbe\tconsistent\twith\tthe money\theld\tin\tthe\tbank,\totherwise,\tthe\treconciliation\tof\tthe\taccounts\twill fail.\tNot\tonly\tthat,\tif\tyour\tcompany\tis\ta\tregulated\tentity,\tit\tcould\tcause serious\tproblems\tfor\tthe\tcontinuity\tof\tthe\tbusiness.\n\nThe\tgeneral\trule\tof\tthumb,\twhen\tworking\twith\tmicroservices\tand\tfinancial systems,\tis\tto\tkeep\ta\tnot-so-microservice\tthat\tdeals\twith\tall\tthe\tmoney and\tcreates\tmicroservices\tfor\tthe\tauxiliary\tmodules\tof\tthe\tsystem\tsuch as\temailing,\tSMS,\tuser\tregistration,\tand\tso\ton,\tas\tshown\tin\tthe\tfollowing image:\n\nAs\tyou\tcan\tsee\tin\tthe\tpreceding\tpicture,\tthe\tfact\tthat\tpayments\twill\tbe\ta big\tmicroservice\tinstead\tof\tsmaller\tservices,\tit\tonly\thas\timplications\tin\n\nthe\toperational\tside,\tthere\tis\tnothing\tpreventing\tus\tfrom\tmodularizing\tthe application\tas\tseen\tbefore.\tThe\tfact\tthat\twithdrawing\tmoney\tfrom\tan ATM\thas\tto\tbe\tan\tatomic\toperation\t(either\tsucceed\tor\tfail\twithout intermediate\tstatus)\tshould\tnot\tdictate\thow\twe\torganize\tthe\tcode\tin\tour application,\tallowing\tus\tto\tmodularize\tthe\tservices,\tbut\tspanning\tthe transaction\tscope\tacross\tall\tof\tthem.\n\nOrganizational\talignment\n\nIn\ta\tcompany\twhere\tthe\tsoftware\tis\tbuilt\tbased\ton\tmicroservices,\tevery single\tstakeholder\tneeds\tto\tbe\tinvolved\tin\tdecision\tmaking.\n\nMicroservices\tare\ta\thuge\tparadigm\tshift.\tUsually,\tlarge\torganizations tend\tto\tbuild\tsoftware\tin\ta\tvery\told\tfashioned\tmanner.\tBig\treleases\tevery few\tmonths\tthat\trequire\tdays\tto\tcomplete\tthe\tquality\tassurance\t(QA) phase\tand\tfew\thours\tto\tdeploy.\n\nWhen\ta\tcompany\tchooses\tto\timplement\ta\tmicroservices-oriented architecture,\tthe\tmethodology\tchanges\tcompletely:\tsmall\tteams\twork\ton small\tfeatures\tthat\tare\tbuilt,\ttested,\tand\tdeployed\ton\ttheir\town.\tThe teams\tdo\tone\tthing\t(one\tmicroservice,\tor\tmore\trealistic,\ta\tfew\tof\tthem) and\tthey\tdo\tit\twell\t(they\tmaster\tthe\tdomain\tand\ttechnical\tknowledge required\tto\tbuild\tthe\tsoftware).\n\nThese\tare\twhat\tusually\tcalled\tcross-functional\tteams.\tA\tunit\tof\twork\tof few\tpeople\tthat\thave\tthe\trequired\tknowledge\tto\tbuild\thigh-quality software\tcomponents.\n\nIt\tis\talso\timportant\tto\tflag\tthat\tthe\tteam\thas\tto\tmaster\tthe\tdomain knowledge\tneeded\tto\tunderstand\tthe\tbusiness\trequirements.\n\nHere\tis\twhere\tthe\tmajority\tof\tthe\tcompanies\twhere\tI\thave\tworked\tin\tmy professional\tlife\tfail\t(in\tmy\topinion).\tDevelopers\tare\tconsidered\tbrick stackers\tthat\tmagically\tunderstand\tthe\tbusiness\tflows\twithout\tbeing exposed\tto\tthem\tbefore.\tIf\tone\tdeveloper\tdelivers\tX\tamount\tof\twork\tin one\tweek,\tten\tdevelopers\twill\tdeliver\t10X.\tThis\tis\twrong.\n\nPeople\tin\tcross-functional\tteams\tthat\tbuild\tthe\tmicroservices\thave\tto master\t(not\tonly\tknow)\tthe\tdomain-specific\tknowledge\tin\torder\tto\tbe efficient\tand\tfactor\tthe\tConway's\tLaw\tand\tits\timplications\tinto\tthe\tsystem for\tchanging\thow\tthe\tbusiness\tprocesses\twork.\n\nWhen\ttalking\tabout\torganizational\talignment\tin\tmicroservices,\tautonomy is\tthe\tkey.\tThe\tteams\tneed\tto\tbe\tautonomous\tin\torder\tto\tbe\tagile\twhile building\tthe\tmicroservices,\twhich\timplies\tkeeping\tthe\ttechnical\tauthority\n\nwithin\tthe\tteam,\tas\tfollows:\n\nLanguages\tused Code\tstandards Patterns\tused\tto\tsolve\tproblems Tools\tchosen\tto\tbuild,\ttest,\tdebug,\tand\tdeploy\tthe\tsoftware\n\nThis\tis\tan\timportant\tpart,\tas\tthis\tis\twhere\twe\tneed\tto\tdefine\thow\tthe company\tbuilds\tsoftware\tand\twhere\tthe\tengineering\tproblems\tmay\tbe introduced.\n\nAs\tan\texample,\twe\tcan\tlook\tinto\tthe\tcoding\tstandards,\tas\tshown\tin\tthe following\tlist:\n\nDo\twe\twant\tto\tkeep\tthe\tsame\tcoding\tstandards\tacross\tthe\tteams? Do\twe\twant\teach\tteam\tto\thave\ttheir\town\tcoding\tstandards?\n\nIn\tgeneral,\tI\tam\talways\tin\tfavor\tof\tthe\t80%\trule:\t80%\tof\tperfection\tis more\tthan\tenough\tfor\t100%\tof\tthe\tuse\tcases.\tIt\tmeans\tthat\tloosening\tup the\tcoding\tstandards\t(it\tcan\tbe\tapplied\tto\tother\tareas)\tand\tallowing\tsome level\tof\timperfection/personalization,\thelps\tto\treduce\tthe\tfriction\tbetween teams\tand\talso\tallows\tthe\tengineers\tto\tquickly\tcatch\tup\twith\tthe\tvery\tfew important\trules\tto\tfollow\tsuch\tas\tlogging\tstrategies\tor\texception\thandling.\n\nIf\tyour\tcoding\tstandards\tare\ttoo\tcomplicated,\tthere\twill\tbe\tfriction\twhen\ta team\ttries\tto\tpush\ta\tcode\tinto\ta\tmicroservice\tout\tof\ttheir\tusual\tscope (remember,\tteams\town\tthe\tservices,\tbut\tevery\tteam\tcan\tcontribute\tto them).\n\nSummary\n\nIn\tthis\tchapter,\twe\tdiscussed\tthe\tprinciples\tof\tbuilding\tmonolithic applications\toriented\tto\tbe\tsplit\tas\tmicroservices,\tdepending\ton\tthe business\tneeds.\tAs\tyou\thave\tlearned,\tthe\tAtomicity,\tConsistency, Isolation,\tDurability\t(ACID)\tdesign\tprinciples\tare\tconcepts\tthat\twe\tneed to\thave\tin\tmind\tin\torder\tto\tbuild\thigh\tquality\tsoftware.\n\nYou\thave\talso\tlearned\tthat\twe\tcannot\tassume\tthat\twe\tare\tgoing\tto\tbe able\tto\tdesign\ta\tsystem\tfrom\tscratch,\tso\twe\tneed\tto\tbe\tsmart\tabout\thow we\tbuild\tthe\tnew\tparts\tof\tthe\tsystem\tand\thow\twe\trefactor\tthe\texisting ones\tso\tthat\twe\tachieve\tthe\tlevel\tof\tflexibility\trequired\tto\tsatisfy\tthe business\tneeds\tand\tbe\tresilient.\n\nWe\talso\thave\tgiven\ta\tsmall\tintroduction\tabout\tmonolithic\tdesigned databases\tand\thow\tthey\tare\tthe\tbiggest\tpain\tpoints\twhen\tsplitting\ta monolithic\tsoftware\tinto\tmicroservices,\tas\tit\tis\tusually\trequired\tto\tshut down\tthe\tsystem\tfor\ta\tfew\thours\tin\torder\tto\tsplit\tthe\tdata\tinto\tlocal databases.\tThis\tsubject\tcould\twell\tbe\tan\tentire\tbook\tas\tnew\ttrends\twith NoSQL\tdatabases\tare\tchanging\tthe\tgame\tof\tdata\tstorage.\n\nFinally,\twe\tdiscussed\thow\tto\talign\tthe\tteams\tof\tengineers\tin\tour company\tin\torder\tto\tbe\tefficient\twhile\tkeeping\tthe\tflexibility\tand\tresilience needed\tto\tbe\table\tto\tbe\tagile,\tas\twell\tas\thow\tthe\tConway's\tLaw\timpacts the\tconversion\tof\tmonolithic\tsystems\tinto\tmicroservices-oriented architectures.\n\nIn\tthe\tnext\tchapter,\twe\twill\tapply\tall\tthe\tprinciples\tdiscussed\tin\tthe\tfirst three\tchapters,\tas\twell\tas\ta\tbig\tdose\tof\tcommon\tsense\tto\tbuild\ta\tfull working\tsystem\tbased\ton\tmicroservices.\n\nChapter\t4.\tWriting\tYour\tFirst Microservice\tin\tNode.js\n\nWe\thave\tbeen\tlearning\tabout\thow\tto\tbuild\trobust\tmicroservices-oriented software,\tand\tnow\tit\tis\ttime\tto\tput\tall\tthe\tconcepts\tto\tpractice.\tIn\tthis chapter,\twe\tare\tgoing\tto\tbuild\ta\tmicroservices-oriented\te-commerce using\tSeneca\tand\tsome\tother\tframeworks\tthat\tare\tgoing\tto\tallow\tus\tto write\ta\tsoftware\tthat\twill\tbenefit\tfrom\tthe\tparticularities\tof\tthe microservices.\n\nMicromerce\t–\tthe\tbig\tpicture\n\nIt\tcovers\tthe\tfollowing:\n\nWriting\tmicroservices Sizing\tmicroservices Creating\tAPIs Integrating\tSeneca\twith\tExpress Storing\tdata\tusing\tSeneca\n\nIn\tthis\tchapter,\twe\tare\tgoing\tto\twrite\ta\tfull\t(nearly)\tsimplistic\te-commerce solution\tbased\ton\tmicroservices.\tFull\tmeans\tfull\tfrom\tthe\tconceptual point\tof\tview,\tbut\tfor\tobvious\treasons,\tit\twon't\tbe\tfull\t(as\tproduction ready)\tas\tit\tcould\ttake\tus\ta\tfew\tbooks\tto\thandle\tall\tthe\tpossible\tflows.\n\nWe\twon't\tgo\tdeep\tin\tto\tthe\tUI,\tas\tit\tis\tnot\trelated\tto\tthe\tsubject\tof\tthis book.\tWhat\twe\twill\tdo\tinstead\tis\ta\tmicroservice\tthat\twill\taggregate\tall\tthe other\tmicroservices,\tcreating\ta\tfrontend\tAPI\tto\tbe\tconsumed\tby\ta Single-Page\tApplication\t(SPA),\tbuilt\twith\tany\tof\tthe\tmodern\tJavaScript frameworks.\n\nIn\tthis\tchapter,\twe\tare\tgoing\tto\tdevelop\tthe\tfollowing\tfour\tmicroservices:\n\nProduct\tManager:\tThis\tmicroservice\twill\tbe\tresponsible\tfor\tadding, editing,\tand\tremoving\tproducts\tfrom\tour\tdatabase,\tas\twell\tas\tserving products\tto\tthe\tcustomers.\tThis\tmicroservice\twill\tbe\tpartially\tpublic",
      "page_number": 94
    },
    {
      "number": 4,
      "title": "Writing\tYour\tFirst Microservice\tin\tNode.js",
      "start_page": 115,
      "end_page": 176,
      "detection_method": "regex_chapter_title",
      "content": "for\ta\tpotential\tadmin\tsite\tto\tadd/remove\tproducts. Order\tManager:\tThis\tmicroservice\twill\tbe\tresponsible\tfor\tmanaging the\torder\tand\tbilling. Emailer:\tThis\tmicroservice\twill\tbe\tresponsible\tfor\tdelivering\te-mails to\tthe\tcustomers. UI:\tThis\tmicroservice\twill\texpose\tthe\tfeature\tfrom\tthe\tother microservices\tto\ta\tpotential\tSPA,\tbut\twe\twill\tonly\tbuild\tthe\tJSON interface.\n\nBuilding\tthe\tfour\tpreceding\tmicroservices,\twe\twill\tdevelop\tthe\tconcepts discussed\tin\tthe\tprevious\tchapters\tso\tthat,\tby\tthe\tend\tof\tthis\tchapter,\twe will\tbe\table\tto\tidentify\tthe\tmost\tcommon\tpitfalls\tgoing\tforward.\tKeep\tin mind\tthat\tthe\tobjective\tof\tthis\tbook\tis\tnot\tconverting\tyou\tinto\ta microservices\tor\tNode.js\texpert,\tbut\tto\tgive\tyou\tthe\ttools\trequired\tto learn\tby\tyourself,\tas\twell\tas\tmake\tyou\taware\tof\tthe\tbest\tdesign principles\tand\tthe\tmost\tcommon\tpitfalls.\n\nLet's\ttake\ta\tlook\tat\tthe\tdeployment\tdiagram:\n\nThis\tdiagram\tshows\thow\tour\tcompany\t(the\tyellow\tsquare)\thides\tsome\tof our\tmicroservices\tfrom\tthe\treal\tworld\tand\texposes\tsome\tothers\tto different\tnetworks,\tas\tfollows:\n\nUI\twill\tbe\texposed\tto\tthe\tInternet.\tEverybody\twill\tbe\table\tto\thit\tthis endpoint. Product\tManagement\twill\tmanage\tthe\tproducts\tin\tour\te-commerce. It\twill\thave\tthe\tfollowing\ttwo\tinterfaces:\n\nA\tSeneca\tendpoint\tfrom\twhere\tthe\tUI\twill\textract\tdata A\tJSON\tAPI\tfrom\twhere\tthe\toffice\tof\tour\tcompany\twill\tbe\table to\tcreate,\tupdate,\tand\tdelete\tproducts\n\nEmailer\twill\tbe\tour\tcommunication\tchannel\twith\tour\tcustomers.\tWe will\tuse\tthis\tmicroservice\tto\texplain\tthe\tgood\tpoints\tof\tSeneca,\tand we\twill\talso\tgive\tan\texample\tof\tthe\teventual\tconsistency\tand\tsystem\n\ndegradation\twhen\ta\tmicroservice\tfails. Order\tManager:\tThis\tmicroservice\twill\tlet\tus\thandle\tthe\torders\tfor our\tcustomers.\tWith\tthis\tmicroservice,\twe\twill\tdiscuss\thow\tto\thandle the\tfact\tthat\tthe\tdata\tis\tlocal\tto\teach\tmicroservice,\tinstead\tof\tbeing global\tto\tthe\tsystem.\tYou\tcan't\tjust\tgo\tto\tthe\tdatabase\tto\trecover\tthe product\tname\tor\tprice,\tit\tneeds\tto\tbe\trecovered\tfrom\tother microservice.\n\nTip\n\nAs\tyou\tcan\tsee,\tthere\tis\tno\tuser\tor\tstaff\tmanagement,\tbut\twith\tthese four\tmicroservices,\twe\twill\tbe\table\tto\tdevelop\tthe\tcore\tconcepts\tof microservices\tarchitectures.\tSeneca\tcomes\twith\ta\tvery\tpowerful\tdata and\ttransport\tplugin\tsystem\tthat\tmakes\tit\teasy\tto\tuse\tSeneca\twith different\tdata\tstorages\tand\ttransport\tsystems.\n\nFor\tall\tour\tmicroservices,\twe\tare\tgoing\tto\tuse\tMongoDB\tas\tthe\tstorage. Seneca\tcomes\twith\tan\tout-of-the-box\tin-memory\tdatabase\tplugin\tthat allows\tyou\tto\tstart\tcoding\tstraightaway,\tbut\tthe\tstorage\tis\ttransient:\tit does\tnot\tpersist\tthe\tdata\tbetween\tcalls.\n\nProduct\tManager\t–\tthe\ttwo-faced core\n\nProduct\tManager\tis\tthe\tcore\tof\tour\tsystem.\tI\tknow\twhat\tyou\tare\tthinking: microservices\tshould\tbe\tsmall\t(micro)\tand\tdistributed\t(no\tcentral\tpoint), but\tyou\tneed\tto\tset\tthe\tconceptual\tcentre\tsomewhere,\totherwise\tyou\twill end\tup\twith\ta\tfragmented\tsystem\tand\ttraceability\tproblems\t(we\twill\ttalk about\tit\tlater).\n\nBuilding\ta\tdual\tAPI\twith\tSeneca\tis\tfairly\teasy,\tas\tit\tcomes\twith\ta\tquite straightforward\tintegration\twith\tExpress.\tExpress\tis\tgoing\tto\tbe\tused\tto expose\tsome\tcapabilities\tof\tthe\tUI\tsuch\tas\tediting\tproducts,\tadding products,\tdeleting\tproducts,\tand\tso\ton.\tIt\tis\ta\tvery\tconvenient\tframework, easy\tto\tlearn,\tand\tit\tintegrates\twell\twith\tSeneca.\tIt\tis\talso\ta\tde-facto standard\ton\tNode.js\tfor\tweb\tapps,\tso\tit\tmakes\tit\teasy\tto\tfind\tinformation about\tthe\tpossible\tproblems.\n\nIt\tis\tgoing\tto\talso\thave\ta\tprivate\tpart\texposed\tthrough\tSeneca\tTCP\t(the default\tplugin\tin\tSeneca)\tso\tthat\tour\tinternal\tnetwork\tof\tmicroservices (specifically,\tthe\tUI)\twill\tbe\table\tto\taccess\tthe\tlist\tof\tproducts\tin\tour catalogue.\n\nProduct\tManager\tis\tgoing\tto\tbe\tsmall\tand\tcohesioned\t(it\twill\tonly manage\tproducts),\tas\twell\tas\tscalable,\tbut\tit\twill\thold\tall\tthe\tknowledge required\tto\tdeal\twith\tproducts\tin\tour\te-commerce.\n\nFirst\tthing\twe\tneed\tto\tdo\tis\tto\tdefine\tour\tProduct\tManager\tmicroservice, as\tfollows:\n\nThis\tis\tgoing\tto\thave\ta\tfunction\tto\tretrieve\tall\tthe\tproducts\tin\tthe database.\tThis\tis\tprobably\ta\tbad\tidea\tin\ta\tproduction\tsystem\t(as\tit probably\twould\trequire\tpagination),\tbut\tit\tworks\tfor\tour\texample. This\tshould\thave\tone\tfunction\tthat\tfetches\tall\tthe\tproducts\tfor\ta given\tcategory.\tIt\tis\tsimilar\tto\tthe\tprevious\tone,\tit\twould\tneed pagination\tin\ta\tproduction-ready\tsystem. This\tshould\thave\ta\tfunction\tto\tretrieve\tproducts\tby\tidentifier\t(id). This\tshould\thave\tone\tfunction\tthat\tallows\tus\tto\tadd\tproducts\tto\tthe\n\ndatabase\t(in\tthis\tcase\tMongoDB).\tThis\tfunction\twill\tuse\tthe\tSeneca data\tabstraction\tto\tdecouple\tour\tmicroservice\tfrom\tthe\tstorage:\twe will\tbe\table\tto\t(in\ttheory)\tswitch\tMongo\tto\ta\tdifferent\tdatabase without\ttoo\tmuch\thassle\t(in\ttheory\tagain). This\tshould\thave\tone\tfunction\tto\tremove\tproducts.\tAgain,\tusing Seneca\tdata\tabstraction. This\tshould\thave\tone\tfunction\tto\tedit\tproducts.\n\nOur\tproduct\twill\tbe\ta\tdata\tstructure\thaving\tfour\tfields:\tname,\tcategory, description,\tand\tprice.\tAs\tyou\tcan\tsee,\tit\tis\ta\tbit\tsimplistic,\tbut\tit\twill help\tus\tto\tunderstand\tthe\tcomplicated\tworld\tof\tmicroservices.\n\nOur\tProduct\tManagement\tmicroservice\tis\tgoing\tto\tuse\tMongoDB (https://www.mongodb.org/).\tMongo\tis\ta\tdocument-oriented\tschema-less database\tthat\tallows\tan\tenormous\tflexibility\tto\tstore\tdata\tsuch\tas products\t(that,\tat\tthe\tend\tof\tthe\tday,\tare\tdocuments).\tIt\tis\talso\ta\tgood choice\tfor\tNode.js\tas\tit\tstores\tJSON\tobjects,\twhich\tis\ta\tstandard,\tcreated for\tJavaScript\t(JSON\tstands\tfor\tJavaScript\tObject\tNotation),\tso\tthat looks\tlike\tthe\tperfect\tpairing.\n\nThere\tis\ta\tlot\tof\tuseful\tinformation\ton\tthe\tMongoDB\twebsite\tif\tyou\twant to\tlearn\tmore\tabout\tit.\n\nLet's\tstart\tcoding\tour\tfunctions.\n\nFetching\tproducts\n\nTo\tfetch\tproducts,\twe\tgo\tto\tthe\tdatabase\tand\tdump\tthe\tfull\tlist\tof products\tstraight\tto\tthe\tinterface.\tIn\tthis\tcase,\twe\twon't\tcreate\tany pagination\tmechanism,\tbut\tin\tgeneral,\tpaginating\tdata\tis\ta\tgood\tpractice to\tavoid\tdatabase\t(or\tapplications,\tbut\tmainly\tdatabase)\tperformance problems.\n\nLet's\tsee\tthe\tfollowing\tcode:\n\n/** \t\tFetch\tthe\tlist\tof\tall\tthe\tproducts. \t/ seneca.add({area:\t\"product\",\taction:\t\"fetch\"},\t function(args,\tdone)\t{\n\nvar\tproducts\t=\tthis.make(\"products\"); \t\tproducts.list$({},\tdone); });\n\nWe\talready\thave\ta\tpattern\tin\tSeneca\tthat\treturns\tall\tthe\tdata\tin\tour database.\n\nThe\tproducts.list$()\tfunction\twill\treceive\tthe\tfollowing\ttwo\tparameters:\n\nThe\tquery\tcriteria A\tfunction\tthat\treceives\tan\terror\tand\tresult\tobject\t(remember\tthe error-first\tcallback\tapproach)\n\nSeneca\tuses\tthe\t$\tsymbol\tto\tidentify\tthe\tkey\tfunctions\tsuch\tas\tlist$, save$,\tand\tso\ton.\tRegarding\tthe\tnaming\tof\tthe\tproperties\tof\tyour\tobjects, as\tlong\tas\tyou\tuse\talphanumeric\tidentifiers,\tyour\tnaming\twill\tbe\tcollision free.\n\nWe\tare\tpassing\tthe\tdone\tfunction\tfrom\tthe\tseneca.add()\tmethod\tto\tthe list$\tmethod.\tThis\tworks\tas\tSeneca\tfollows\tthe\tcallback\twith\terror-first approach.\tIn\tother\twords,\twe\tare\tcreating\ta\tshortcut\tfor\tthe\tfollowing code:\n\nseneca.add({area:\t\"product\",\taction:\t\"fetch\"},\t function(args,\tdone)\t{ \t\tvar\tproducts\t=\tthis.make(\"products\"); \t\tproducts.list$({},\tfunction(err,\tresult)\t{ \t\t\t\tdone(err,\tresult); \t\t}); });\n\nFetching\tby\tcategory\n\nFetching\tby\tcategory\tis\tvery\tsimilar\tto\tfetching\tthe\tfull\tlist\tof\tproducts. The\tonly\tdifference\tis\tthat\tnow\tthe\tSeneca\taction\twill\ttake\ta\tparameter\tto filter\tthe\tproducts\tby\tcategory.\n\nLet's\tsee\tthe\tcode:\n\n/** \t\tFetch\tthe\tlist\tof\tproducts\tby\tcategory.\n\n/ seneca.add({area:\t\"product\",\taction:\t\"fetch\",\t criteria:\t\"byCategory\"},\tfunction(args,\tdone)\t{ \t\tvar\tproducts\t=\tthis.make(\"products\"); \t\tproducts.list$({category:\targs.category},\tdone); });\n\nOne\tof\tthe\tfirst\tquestions\tthat\tmost\tadvanced\tdevelopers\twill\tnow\thave in\ttheir\tmind\tis\tthat\tisn't\tthis\ta\tperfect\tscenario\tfor\tan\tinjection\tattack? Well,\tSeneca\tis\tsmart\tenough\tto\tprevent\tit,\tso\twe\tdon't\tneed\tto\tworry about\tit\tany\tmore\tthan\tavoid\tconcatenating\tstrings\twith\tuser\tinput.\n\nAs\tyou\tcan\tsee,\tthe\tonly\tsignificant\tdifference\tis\tthe\tparameter\tpassed called\tcategory,\twhich\tgets\tdelegated\tinto\tSeneca\tdata\tabstraction\tlayer that\twill\tgenerate\tthe\tappropriate\tquery,\tdepending\ton\tthe\tstorage\twe use.\tThis\tis\textremely\tpowerful\twhen\ttalking\tabout\tmicroservices.\tIf\tyou remember,\tin\tthe\tprevious\tchapters,\twe\talways\ttalked\tabout\tcoupling\tas if\tit\twas\tthe\troot\tof\tall\tevils,\tand\tnow\twe\tcan\tassure\tit\tis,\tand\tSeneca handles\tit\tin\ta\tvery\telegant\tway.\tIn\tthis\tcase,\tthe\tframework\tprovides\ta contract\tthat\tthe\tdifferent\tstorage\tplugins\thave\tto\tsatisfy\tin\torder\tto\twork. In\tthe\tpreceding\texample,\tlist$\tis\tpart\tof\tthis\tcontract.\tIf\tyou\tuse\tthe Seneca\tstorage\twisely,\tswitching\tyour\tmicroservice\tover\tto\ta\tnew database\tengine\t(have\tyou\tever\tbeen\ttempted\tto\tmove\ta\tpart\tof\tyour data\tover\tMongoDB?)\tis\ta\tmatter\tof\tconfiguration.\n\nFetching\tby\tID\n\nFetching\ta\tproduct\tby\tID\tis\tone\tof\tthe\tmost\tnecessary\tmethods,\tand\tit\tis also\ta\ttricky\tone.\tNot\ttricky\tfrom\tthe\tcoding\tpoint\tof\tview,\tas\tshown\tin\tthe following:\n\n/** \t\tFetch\ta\tproduct\tby\tid. \t/ seneca.add({area:\t\"product\",\taction:\t\"fetch\",\t criteria:\t\"byId\"},\tfunction(args,\tdone)\t{ \t\tvar\tproduct\t=\tthis.make(\"products\"); \t\tproduct.load$(args.id,\tdone); });\n\nThe\ttricky\tpart\tis\thow\tid\tis\tgenerated.\tThe\tgeneration\tof\tid\tis\tone\tof\tthe\n\ncontact\tpoints\twith\tthe\tdatabase.\tMongo\tcreates\ta\thash\tto\trepresent\ta synthetic\tID;\twhereas,\tMySQL\tusually\tcreates\tan\tinteger\tthat\tauto- increments\tto\tuniquely\tidentify\teach\trecord.\tGiven\tthat,\tif\twe\twant\tto switch\tMongoDB\tto\tMySQL\tin\tone\tof\tour\tapps,\tthe\tfirst\tproblem\tthat\twe need\tto\tsolve\tis\thow\tto\tmap\ta\thash\tthat\tlooks\tsomething\tsimilar\tto\tthe following\tinto\tan\tordinal\tnumber:\n\ne777d434a849760a1303b7f9f989e33a\n\nIn\t99%\tof\tthe\tcases,\tthis\tis\tfine,\tbut\twe\tneed\tto\tbe\tcareful,\tespecially when\tstoring\tIDs\tas,\tif\tyou\trecall\tfrom\tthe\tprevious\tchapters,\tthe\tdata should\tbe\tlocal\tto\teach\tmicroservice,\twhich\tcould\timply\tthat\tchanging\tthe data\ttype\tof\tthe\tID\tof\tone\tentity,\trequires\tchanging\tthe\treferenced\tID\tin all\tthe\tother\tdatabases.\n\nAdding\ta\tproduct\n\nAdding\ta\tproduct\tis\ttrivial.\tWe\tjust\tneed\tto\tcreate\tthe\tdata\tand\tsave\tit\tin the\tdatabase:\n\n/** \t\tAdds\ta\tproduct. \t/ seneca.add({area:\t\"product\",\taction:\t\"add\"},\t function(args,\tdone)\t{ \t\tvar\tproducts\t=\tthis.make(\"products\"); \t\tproducts.category\t=\targs.category; \t\tproducts.name\t=\targs.name; \t\tproducts.description\t=\targs.description; \t\tproducts.category\t=\targs.category; \t\tproducts.price\t=\targs.price \t\tproducts.save$(function(err,\tproduct)\t{ \t\t\t\tdone(err,\tproducts.data$(false)); \t\t}); });\n\nIn\tthis\tmethod,\twe\tare\tusing\ta\thelper\tfrom\tSeneca, products.data$(false).\tThis\thelper\twill\tallow\tus\tto\tretrieve\tthe\tdata\tof the\tentity\twithout\tall\tthe\tmetadata\tabout\tnamespace\t(zone),\tentity\tname, and\tbase\tname\tthat\twe\tare\tnot\tinterested\tin\twhen\tthe\tdata\tis\treturned\tto the\tcalling\tmethod.\n\nRemoving\ta\tproduct\n\nThe\tremoval\tof\ta\tproduct\tis\tusually\tdone\tby\tid:\tWe\ttarget\tthe\tspecific data\tthat\twe\twant\tto\tremove\tby\tthe\tprimary\tkey\tand\tthen\tremove\tit,\tas follows:\n\n/** \t\tRemoves\ta\tproduct\tby\tid. \t/ seneca.add({area:\t\"product\",\taction:\t\"remove\"},\t function(args,\tdone)\t{ \t\tvar\tproduct\t=\tthis.make(\"products\"); \t\tproduct.remove$(args.id,\tfunction(err)\t{ \t\tdone(err,\tnull); \t\t}); });\n\nIn\tthis\tcase,\twe\tdon't\treturn\tanything\taside\tfrom\tan\terror\tif\tsomething goes\twrong,\tso\tthe\tendpoint\tthat\tcalls\tthis\taction\tcan\tassume\tthat\ta\tnon- errored\tresponse\tis\ta\tsuccess.\n\nEditing\ta\tproduct\n\nWe\tneed\tto\tprovide\tan\taction\tto\tedit\tproducts.\tThe\tcode\tfor\tdoing\tthat\tis as\tfollows:\n\n/** \t\tEdits\ta\tproduct\tfetching\tit\tby\tid\tfirst. \t/ seneca.edit({area:\t\"product\",\taction:\t\"edit\"},\t function(args,\tdone)\t{ \t\tseneca.act({area:\t\"product\",\taction:\t\"fetch\",\t criteria:\t\"byId\",\tid:\targs.id},\tfunction(err,\tresult)\t { \t\tresult.data$( \t\t{ \t\t\t\tname:\targs.name,\t \t\t\t\tcategory:\targs.category,\t \t\t\t\tdescription:\targs.description, \t\t\t\tprice:\targs.price\t \t\t} \t\t); \t\tresult.save$(function(err,\tproduct){\n\ndone(product.data$(false)); \t\t\t\t}); \t\t}); });\n\nHere\tis\tan\tinteresting\tscenario.\tBefore\tediting\ta\tproduct,\twe\tneed\tto fetch\tit\tby\tID,\tand\twe\thave\talready\tdone\tthat.\tSo,\twhat\twe\tare\tdoing\there is\trelying\ton\tthe\talready\texisting\taction\tto\tretrieve\ta\tproduct\tby\tID, copying\tthe\tdata\tacross,\tand\tsaving\tit.\n\nThis\tis\ta\tnice\tway\tfor\tcode\treuse\tintroduced\tby\tSeneca,\twhere\tyou\tcan delegate\ta\tcall\tfrom\tone\taction\tto\tanother\tand\twork\tin\tthe\twrapper\taction with\tthe\tresult.\n\nWiring\teverything\tup\n\nAs\twe\tagreed\tearlier,\tthe\tproduct\tmanager\tis\tgoing\tto\thave\ttwo\tfaces: one\tthat\twill\tbe\texposed\tto\tother\tmicroservices\tusing\tthe\tSeneca transport\tover\tTCP\tand\ta\tsecond\tone\texposed\tthrough\tExpress\t(a Node.js\tlibrary\tto\tcreate\tweb\tapps)\tin\tthe\tREST\tway.\n\nLet's\twire\teverything\ttogether:\n\nvar\tplugin\t=\tfunction(options)\t{ \t\tvar\tseneca\t=\tthis;\n\n/** \t\t\t*\tFetch\tthe\tlist\tof\tall\tthe\tproducts.\n\nseneca.add({area:\t\"product\",\taction:\t\"fetch\"},\t function(args,\tdone)\t{ \t\t\t\tvar\tproducts\t=\tthis.make(\"products\"); \t\t\t\tproducts.list$({},\tdone); \t\t});\n\n*\tFetch\tthe\tlist\tof\tproducts\tby\tcategory.\n\nseneca.add({area:\t\"product\",\taction:\t\"fetch\",\t criteria:\t\"byCategory\"},\tfunction(args,\tdone)\t{ \t\t\t\tvar\tproducts\t=\tthis.make(\"products\"); \t\t\t\tproducts.list$({category:\targs.category},\tdone); \t\t});\n\n*\tFetch\ta\tproduct\tby\tid.\n\nseneca.add({area:\t\"product\",\taction:\t\"fetch\",\t criteria:\t\"byId\"},\tfunction(args,\tdone)\t{ \t\t\t\tvar\tproduct\t=\tthis.make(\"products\"); \t\t\t\tproduct.load$(args.id,\tdone); \t\t});\n\n*\tAdds\ta\tproduct.\n\nseneca.add({area:\t\"product\",\taction:\t\"add\"},\t function(args,\tdone)\t{ \t\t\t\tvar\tproducts\t=\tthis.make(\"products\"); \t\t\t\tproducts.category\t=\targs.category; \t\t\t\tproducts.name\t=\targs.name; \t\t\t\tproducts.description\t=\targs.description; \t\t\t\tproducts.category\t=\targs.category; \t\t\t\tproducts.price\t=\targs.price \t\t\t\tproducts.save$(function(err,\tproduct)\t{ \t\t\t\t\t\tdone(err,\tproducts.data$(false)); \t\t\t\t}); \t\t});\n\n*\tRemoves\ta\tproduct\tby\tid.\n\nseneca.add({area:\t\"product\",\taction:\t\"remove\"},\t function(args,\tdone)\t{ \t\t\t\tvar\tproduct\t=\tthis.make(\"products\"); \t\t\t\tproduct.remove$(args.id,\tfunction(err)\t{ \t\t\t\t\t\tdone(err,\tnull); \t\t\t\t}); \t\t});\n\nEdits\ta\tproduct\tfetching\tit\tby\tid\tfirst. \t\t\t/ \t\tseneca.add({area:\t\"product\",\taction:\t\"edit\"},\t function(args,\tdone)\t{ \t\t\t\tseneca.act({area:\t\"product\",\taction:\t\"fetch\",\t criteria:\t\"byId\",\tid:\targs.id},\tfunction(err,\tresult)\t { \t\t\t\t\t\tresult.data$( \t\t\t\t\t\t\t\t{ \t\t\t\t\t\t\t\t\t\tname:\targs.name,\t \t\t\t\t\t\t\t\t\t\tcategory:\targs.category,\t \t\t\t\t\t\t\t\t\t\tdescription:\targs.description,\n\nprice:\targs.price\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t\t\t\t\t} \t\t\t\t\t\t); \t\t\t\t\t\tresult.save$(function(err,\tproduct){ \t\t\t\t\t\t\t\tdone(err,\tproduct.data$(false)); \t\t\t\t\t\t}); \t\t\t\t}); \t\t}); } module.exports\t=\tplugin;\n\nvar\tseneca\t=\trequire(\"seneca\")(); seneca.use(plugin); seneca.use(\"mongo-store\",\t{ \t\tname:\t\"seneca\", \t\thost:\t\"127.0.0.1\", \t\tport:\t\"27017\" });\n\nseneca.ready(function(err){\n\nseneca.act('role:web',{use:{ \t\t\t\tprefix:\t'/products', \t\t\t\tpin:\t{area:'product',action:'*'}, \t\t\t\tmap:{ \t\t\t\tfetch:\t{GET:true}, \t\t\t\tedit:\t{GET:false,POST:true}, \t\t\t\tdelete:\t{GET:\tfalse,\tDELETE:\ttrue} \t\t\t\t} \t\t}}); \t\tvar\texpress\t=\trequire('express'); \t\tvar\tapp\t=\texpress(); \t\tapp.use(require(\"body-parser\").json());\n\n//\tThis\tis\thow\tyou\tintegrate\tSeneca\twith\tExpress \t\tapp.use(\tseneca.export('web')\t);\n\napp.listen(3000);\n\n});\n\nNow\tlet's\texplain\tthe\tcode:\n\nWe\thave\tcreated\ta\tSeneca\tplugin.\tThis\tplugin\tcan\tbe\treused\tacross different\tmicroservices.\tThis\tplugin\tcontains\tall\tthe\tdefinitions\tof\tmethods needed\tby\tour\tmicroservice\tthat\twe\thave\tpreviously\tdescribed.\n\nThe\tpreceding\tcode\tdescribes\tthe\tfollowing\ttwo\tsections:\n\nThe\tfirst\tfew\tlines\tconnect\tto\tMongo.\tIn\tthis\tcase,\twe\tare\tspecifying that\tMongo\tis\ta\tlocal\tdatabase.\tWe\tare\tdoing\tthat\tthrough\tthe\tuse\tof a\tplugin\tcalled\tmongo-store—https://github.com/rjrodger/seneca- mongo-store,\twritten\tby\tRichard\tRodger,\tthe\tauthor\tof\tSeneca. The\tsecond\tpart\tis\tnew\tto\tus.\tIt\tmight\tsound\tfamiliar\tif\tyou\thave used\tJQuery\tbefore,\tbut\tbasically\twhat\tthe\tseneca.ready()\tcallback is\tdoing\tis\ttaking\tcare\tof\tthe\tfact\tthat\tSeneca\tmight\tnot\thave connected\tto\tMongo\tbefore\tthe\tcalls\tstart\tflowing\tinto\tits\tAPI.\tThe seneca.ready()\tcallback\tis\twhere\tthe\tcode\tfor\tintegrating\tExpress with\tSeneca\tlives.\n\nThe\tfollowing\tis\tthe\tpackage.json\tconfiguration\tof\tour\tapp:\n\n{ \t\t\"name\":\t\"Product\tManager\", \t\t\"version\":\t\"1.0.0\", \t\t\"description\":\t\"Product\tManagement\tsub-system\", \t\t\"main\":\t\"index.js\", \t\t\"keywords\":\t[ \t\t\t\t\"microservices\", \t\t\t\t\"products\" \t\t], \t\t\"author\":\t\"David\tGonzalez\", \t\t\"license\":\t\"ISC\", \t\t\"dependencies\":\t{ \t\t\"body-parser\":\t\"^1.14.1\", \t\t\"debug\":\t\"^2.2.0\", \t\t\"express\":\t\"^4.13.3\", \t\t\"seneca\":\t\"^0.8.0\", \t\t\"seneca-mongo-store\":\t\"^0.2.0\", \t\t\"type-is\":\t\"^1.6.10\" \t\t} }\n\nHere\twe\tcontrol\tall\tthe\tlibraries\tneeded\tfor\tour\tmicroservice\tto\trun,\tas well\tas\tthe\tconfiguration.\n\nIntegrating\twith\tExpress\t–\thow\tto\tcreate a\tREST\tAPI\n\nIntegrating\twith\tExpress\tis\tquite\tstraightforward.\tLet's\ttake\ta\tlook\tat\tthe code:\n\nseneca.act('role:web',{use:{ \t\t\t\tprefix:\t'/products', \t\t\t\tpin:\t{area:'product',action:'*'}, \t\t\t\tmap:{ \t\t\t\tfetch:\t{GET:true},\t\t\t\t\t\t \t\t\t\tedit:\t{PUT:true}, \t\t\t\tdelete:\t{GET:\tfalse,\tDELETE:\ttrue} \t\t\t\t} \t\t}}); \t\tvar\texpress\t=\trequire('express'); \t\tvar\tapp\t=\texpress(); \t\tapp.use(require(\"body-parser\").json());\n\n//\tThis\tis\thow\tyou\tintegrate\tSeneca\twith\tExpress \t\tapp.use(\tseneca.export('web')\t);\n\napp.listen(3000);\n\nThis\tcode\tsnippet,\tas\twe've\tseen\tin\tthe\tpreceding\tsection,\tprovides\tthe following\tthree\tREST\tendpoints:\n\nproductsfetch\n\nproductsedit\n\nproductsdelete\n\nLet's\texplain\thow.\n\nFirst,\twhat\twe\tdo\tis\ttell\tSeneca\tto\texecute\tthe\trole:web\taction,\tindicating the\tconfiguration.\tThis\tconfiguration\tspecifies\tto\tuse\ta\t/products\tprefix for\tall\tthe\tURLs,\tand\tit\tpins\tthe\taction\twith\ta\tmatching\t{area:\t\"product\", action:\t\"*\"}\tpattern.\tThis\tis\talso\tnew\tfor\tus,\tbut\tit\tis\ta\tnice\tway\tto specify\tto\tSeneca\tthat\twhatever\taction\tit\texecutes\tin\tthe\tURL,\tit\twill\thave implicit\tarea:\t\"product\"\tof\tthe\thandler.\tThis\tmeans\tthat\tproductsfetch endpoint\twill\tcorrespond\tto\tthe\t{area:\t'products',\taction:\t'fetch'} pattern.\tThis\tcould\tbe\ta\tbit\tdifficult,\tbut\tonce\tyou\tget\tused\tto\tit,\tit\tis actually\treally\tpowerful.\tIt\tdoes\tnot\tforce\tuse\tto\tfully\tcouple\tour\tactions with\tour\tURLs\tby\tconventions.\n\nIn\tthe\tconfiguration,\tthe\tattribute\tmap\tspecifies\tthe\tHTTP\tactions\tthat can\tbe\texecuted\tover\tan\tendpoint:\tfetch\twill\tallow\tGET,\tedit\twill\tallow\tPUT, and\tdelete\twill\tonly\tallow\tDELETE.\tThis\tway,\twe\tcan\tcontrol\tthe\tsemantics of\tthe\tapplication.\n\nEverything\telse\tis\tprobably\tfamiliar\tto\tyou.\tCreate\tan\tExpress\tapp\tand specify\tusing\tthe\tfollowing\ttwo\tplugins:\n\nThe\tJSON\tbody\tparser The\tSeneca\tweb\tplugin\n\nThis\tis\tall.\tNow,\tif\twe\tadd\ta\tnew\taction\tto\tour\tSeneca\tlist\tof\tactions\tin order\tto\texpose\tit\tthrough\tthe\tAPI,\tthe\tonly\tthing\tthat\tneeds\tto\tbe\tdone\tis to\tmodify\tthe\tmap\tattribute\tto\tallow\tHTTP\tmethods.\n\nAlthough\twe\thave\tbuilt\ta\tvery\tsimplistic\tmicroservice,\tit\tcaptures\ta\tbig portion\tof\tthe\tcommon\tpatterns\tthat\tyou\tfind\twhen\tcreating\ta\tCRUD (Create\tRead\tUpdate\tDelete)\tapplication.\tWe\thave\talso\tcreated\ta\tsmall REST\tAPI\tout\tof\ta\tSeneca\tapplication\twith\tlittle\tto\tno\teffort.\tAll\twe\tneed to\tdo\tnow\tis\tconfigure\tthe\tinfrastructure\t(MongoDB)\tand\twe\tare\tready\tto deploy\tour\tmicroservice.\n\nThe\temailer\t–\ta\tcommon\tproblem\n\nEmailing\tis\tsomething\tthat\tevery\tcompany\tneeds\tto\tdo.\tWe\tneed\tto communicate\twith\tour\tcustomers\tin\torder\tto\tsend\tnotifications,\tbills,\tor registration\te-mails.\n\nIn\tthe\tcompanies\twhere\tI've\tworked\tbefore,\temailing\talways\tpresented\ta problem\tsuch\tas\te-mails\tnot\tbeing\tdelivered,\tor\tbeing\tdelivered\ttwice, with\tthe\twrong\tcontent\tto\tthe\twrong\tcustomer,\tand\tso\ton.\tIt\tlooks terrifying\tthat\tsomething\tas\tsimple\tas\tsending\tan\te-mail\tcould\tbe\tthis complicated\tto\tmanage.\n\nIn\tgeneral,\te-mail\tcommunication\tis\tthe\tfirst\tcandidate\tto\twrite\ta microservice.\tThink\tabout\tit:\n\nE-mail\tdoes\tone\tthing E-mail\tdoes\tit\twell E-mail\tkeeps\tits\town\tdata\n\nIt\tis\talso\ta\tgood\texample\tof\thow\tthe\tConway's\tlaw\tkicks\tinto\tour\tsystems without\tbeing\tnoticed.\tWe\tdesign\tour\tsystems\tmodeling\tthe\texisting communication\tin\tour\tcompany\tas\twe\tare\tconstrained\tby\tit.\n\nHow\tto\tsend\te-mails\n\nBack\tto\tthe\tbasics.\tHow\tdo\twe\tsend\te-mails?\tI\tam\tnot\ttalking\tabout which\tnetwork\tprotocol\twe\tuse\tfor\tsending\tthe\te-mail\tor\twhat\tare\tthe minimum\tacceptable\theaders?\n\nI\tam\ttalking\tabout\twhat\twe\tneed\tto\tsend\tan\te-mail\tfrom\tthe\tbusiness point\tof\tview:\n\nA\ttitle The\tcontent A\tdestination\taddress\n\nThat\tis\teverything.\tWe\tcould\thave\tgone\tfar,\ttalking\tabout acknowledgements,\tsecure\te-mail,\tBCCs,\tand\tso\ton.\tHowever,\twe\tare\n\nfollowing\tthe\tlean\tmethodology:\tstart\twith\tthe\tminimum\tviable\tproduct and\tbuild\tup\tfrom\tit\tuntil\tyou\tachieve\tthe\tdesired\tresult.\n\nI\tcan't\tremember\ta\tproject\twhere\tthe\te-mail\tsending\twasn't\ta controversial\tpart.\tThe\tproduct\tchosen\tto\tdeliver\te-mails\tends\tup\ttightly coupled\tto\tthe\tsystem\tand\tit\tis\treally\thard\tto\treplace\tit\tseamlessly. However,\tmicroservices\tare\there\tto\trescue\tus.\n\nDefining\tthe\tinterface\n\nAs\tI\tmentioned\tbefore,\talthough\tit\tsounds\teasy,\tsending\tcorporate\te- mails\tcould\tend\tup\tbeing\ta\tmess.\tTherefore,\tthe\tfirst\tthing\twe\tneed\tto clear\tis\tour\tminimum\trequirements:\n\nHow\tdo\twe\trender\tthe\te-mail?\n\nDoes\trendering\tthe\temail\tbelongs\tto\tthe\tbound\tcontext\tof\tthe email\tmanipulation? Do\twe\tcreate\tanother\tmicroservice\tto\trender\te-mails? Do\twe\tuse\ta\tthird\tparty\tto\tmanage\tthe\te-mails?\n\nDo\twe\tstore\tthe\talready\tsent\te-mails\tfor\tauditing\tpurposes?\n\nFor\tthis\tmicroservice,\twe\tare\tgoing\tto\tuse\tMandrill.\tMandrill\tis\ta\tcompany that\tallows\tus\tto\tsend\tcorporate\te-mails,\ttrack\tthe\talready\tsent\te-mails, and\tcreate\te-mail\ttemplates\tthat\tcan\tbe\tedited\tonline.\n\nOur\tmicroservice\tis\tgoing\tto\tlook\tas\tshown\tin\tthe\tfollowing\tcode:\n\nvar\tplugin\t=\tfunction(options)\t{ \t\tvar\tseneca\t=\tthis; \t\t/** \t\t\t\tSends\tan\temail\tusing\ta\ttemplate\temail. \t\t\t/ \t\tseneca.add({area:\t\"email\",\taction:\t\"send\",\ttemplate:\t \"\"},\tfunction(args,\tdone)\t{ //\tTODO:\tMore\tcode\tto\tcome. \t\t});\n\n/* \t\t\t\tSends\tan\temail\tincluding\tthe\tcontent. \t\t\t/\n\nseneca.add({area:\t\"email\",\taction:\t\"send\"},\t function(args,\tdone)\t{ //\tTODO:\tMore\tcode\tto\tcome. \t\t}); };\n\nWe\thave\ttwo\tpatterns:\tone\tthat\tmakes\tuse\tof\ttemplates\tand\tthe\tother that\tsends\tthe\tcontent\tcontained\tin\tthe\trequest.\n\nAs\tyou\tcan\tsee,\teverything\tthat\twe\thave\tdefined\there\tis\tinformation related\tto\temailing.\tThere\tis\tno\tbleeding\tfrom\tthe\tMandrill\tterminology into\twhat\tthe\tother\tmicroservices\tsee\tin\tour\te-mail\tsending.\tThe\tonly compromise\tthat\twe\tare\tmaking\tis\tthe\ttemplating.\tWe\tare\tdelegating\tthe template\trendering\tto\tthe\te-mail\tsender,\tbut\tit\tis\tnot\ta\tbig\tdeal,\tas\teven\tif we\twalk\taway\tfrom\tMandrill,\twe\twill\tneed\tto\trender\tthe\tcontent\tsomehow.\n\nWe\twill\tcome\tback\tto\tthe\tcode\tlater.\n\nSetting\tup\tMandrill\n\nMandrill\tis\tfairly\teasy\tto\tuse\tand\tshouldn't\tbe\ta\tproblem\tto\tset\tup. However,\twe\tare\tgoing\tto\tuse\tthe\ttest\tmode\tso\tthat\twe\tcan\tassure\tthat the\te-mails\tare\tnot\tgoing\tto\tbe\tdelivered\tand\twe\tcan\taccess\tthe\tAPI\tfor all\tour\tneeds.\n\nThe\tfirst\tthing\twe\tneed\tto\tdo\tis\tcreate\tan\taccount\ton\tMandrill.\tJust register\twith\tyour\te-mail\tat\thttps://mandrillapp.com,\tand\tyou\tshould\tbe able\tto\taccess\tto\tit,\tas\tshown\tin\tthe\tfollowing\tscreenshot:\n\nNow\twe\thave\tcreated\tan\taccount\tthat\twe\tneed\tto\tenter\tinto\tthe\ttest mode.\tIn\torder\tto\tdo\tit,\tjust\tclick\ton\tyour\te-mail\tat\tthe\ttop-right\tcorner\tand select\tthe\tTurn\ton\tthe\ttest\tmode\toption\tfrom\tthe\tmenu.\tThe\tMandrill menu\ton\tthe\tleft\twill\tturn\torange\tnow.\n\nNext,\twe\tneed\tto\tcreate\tan\tAPI\tkey.\tThis\tkey\tis\tthe\tlogin\tinformation\tto be\tused\tby\tthe\tMandrill\tAPI.\tJust\tclick\ton\tSettings\tand\tSMTP\t&\tAPI\tInfo and\tadd\ta\tnew\tkey\t(don't\tforget\tthe\tcheckbox\tto\tmark\tthe\tkey\tas\ttest key).\tIt\tshould\tlook\tlike\tthe\tfollowing\tscreenshot\tnow:\n\nThe\tkey\tis\teverything\tyou\tneed\tfor\tnow.\tLet's\ttest\tthe\tAPI:\n\nvar\tmandrill\t=\trequire(\"mandrill-api/mandrill\"); var\tmandrillClient\t=\tnew\tmandrill.Mandrill(\"<YOUR-KEY- HERE>\");\n\nmandrillClient.users.info({},\tfunction(result){ \t\tconsole.log(result); },\tfunction(e){ \t\tconsole.log(e); });\n\nWith\tthese\tfew\tlines,\twe\thave\tmanaged\tto\ttest\tthat\tMandrill\tis\tup\tand running\tand\twe\thave\ta\tvalid\tkey.\tThe\toutput\tof\tthis\tprogram\tshould\tbe something\tvery\tsimilar\tto\tthe\tfollowing\tJSON:\n\nHands\ton\t–\tintegrating\tMandrill\tin\tyour microservice\n\nEverything\tis\tready\tnow.\tWe\thave\ta\tworking\tkey\tand\tour\tinterface.\tThe only\tthing\tleft\tis\tto\tcreate\tthe\tcode.\tWe\tare\tgoing\tto\tuse\ta\tsmall\tpart\tof the\tMandrill\tAPI,\tbut\tif\tyou\twant\tto\tmake\tuse\tof\tother\tfeatures,\tyou\tcan find\ta\tbetter\tdescription\there:\thttps://mandrillapp.com/api/docs/\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\tcode:\n\n/** \t\t\t\tSends\tan\temail\tincluding\tthe\tcontent.\n\n/ \t\tseneca.add({area:\t\"email\",\taction:\t\"send\"},\t function(args,\tdone)\t{ \t\t\t\tconsole.log(args); \t\t\t\tvar\tmessage\t=\t{ \t\t\t\t\t\t\"html\":\targs.content, \t\t\t\t\t\t\"subject\":\targs.subject, \t\t\t\t\t\t\"to\":\t[{ \t\t\t\t\t\t\t\t\"email\":\targs.to, \t\t\t\t\t\t\t\t\"name\":\targs.toName, \t\t\t\t\t\t\t\t\"type\":\t\"to\" \t\t\t\t\t\t}], \t\t\t\t\t\t\"from_email\":\t\"info@micromerce.com\", \t\t\t\t\t\t\"from_name\":\t\"Micromerce\" \t\t\t\t} \t\t\t\tmandrillClient.messages.send({\"message\":\tmessage},\t function(result)\t{ \t\t\t\t\t\tdone(null,\t{status:\tresult.status}); \t\t\t\t},\tfunction(e)\t{ \t\t\t\t\t\tdone({code:\te.name},\tnull); \t\t\t\t}); \t\t});\n\nThis\tfirst\tmethod\tsends\tmessages\twithout\tusing\ta\ttemplate.\tWe\tjust\tget the\tHTML\tcontent\t(and\ta\tfew\tother\tparameters)\tfrom\tour\tapplication\tand deliver\tit\tthrough\tMandrill.\n\nAs\tyou\tcan\tsee,\twe\tonly\thave\ttwo\tcontact\tpoints\twith\tthe\touter\tworld:\tthe parameters\tpassed\tin\tand\tthe\treturn\tof\tour\tactions.\tBoth\tof\tthem\thave\ta clear\tcontract\tthat\thas\tnothing\tto\tdo\twith\tMandrill,\tbut\twhat\tabout\tthe data?\n\nAt\tthe\terror,\twe\tare\treturning\te.name,\tassuming\tthat\tit\tis\ta\tcode.\tAt\tsome point,\tsomeone\twill\tend\tup\tbranching\tthe\tflow\tdepending\ton\tthis\terror code.\tHere,\twe\thave\tsomething\tcalled\tdata\tcoupling;\tour\tsoftware components\tdon't\tdepend\ton\tthe\tcontract,\tbut\tthey\tdo\tdepend\ton\tthe content\tsent\tacross.\n\nNow,\tthe\tquestion\tis:\thow\tdo\twe\tfix\tit?\tWe\tcan't.\tAt\tleast\tnot\tin\tan\teasy way.\tWe\tneed\tto\tassume\tthat\tour\tmicroservice\tis\tnot\tperfect,\tit\thas\ta flaw.\tIf\twe\tswitch\tprovider\tfor\temailing,\twe\tare\tgoing\tto\tneed\tto\trevisit\tthe calling\tcode\tto\tcheck\tpotential\tcouplings.\n\nIn\tthe\tworld\tof\tsoftware,\tin\tevery\tsingle\tproject\tthat\tI've\tworked\ton\n\nbefore,\tthere\twas\talways\ta\tbig\tpush\ttrying\tto\tmake\tthe\tcode\tas\tgeneric as\tpossible,\ttrying\tto\tguess\tthe\tfuture,\twhich\tusually\tcould\tbe\tas\tbad\tas assuming\tthat\tyour\tmicroservice\twon't\tbe\tperfect.\tThere\tis\tsomething that\talways\tattracted\tmy\tattention:\twe\tput\ta\tlarge\tamount\tof\teffort\tin\tto perfection,\tbut\twe\tpretty\tmuch\tignore\tthe\tfact\tthat\twe\tare\tgoing\tto\tfail and\twe\tdo\tcan\tnothing\tabout\tit.\tSoftware\tfails\toften\tand\twe\tneed\tto\tbe prepared\tfor\tthat.\n\nLater,\twe\twill\tsee\ta\tpattern\tto\tfactor\thuman\tnature\tinto\tthe\tmicroservices: the\tcircuit\tbreaker.\n\nDon't\tbe\tsurprised\tif\tMandrill\trejects\tthe\te-mails\tdue\tto\tthe\tunsigned reason.\tThis\tis\tdue\tto\tthe\tfact\tthat\tthey\tcouldn't\tvalidate\tthe\tdomain\tfrom where\twe\tare\tsending\tthe\te-mail\t(in\tthis\tcase,\ta\tdummy\tdomain\tthat does\tnot\texist).\tIf\twe\twant\tMandrill\tto\tactually\tprocess\tthe\te-mails\t(even though\twe\tare\tin\ttest\tmode),\twe\tjust\tneed\tto\tverify\tour\tdomain\tby\tadding some\tconfiguration\tto\tit.\n\nNote\n\nMore\tinformation\tcan\tbe\tfound\tin\tthe\tMandrill\tdocumentation\there:\n\nhttps://mandrillapp.com/api/docs/\n\nThe\tsecond\tmethod\tto\tsend\te-mails\tis\tsend\tan\te-mail\tfrom\ta\ttemplate.\tIn this\tcase,\tMandrill\tprovides\ta\tflexible\tAPI:\n\nIt\tprovides\tper-recipient\tvariables\tin\tcase\twe\tsend\tthe\te-mail\tto\ta\tlist of\tcustomers It\thas\tglobal\tvariables It\tallows\tcontent\treplacement\t(we\tcan\treplace\ta\tfull\tsection)\n\nFor\tconvenience,\twe\tare\tgoing\tto\tjust\tuse\tglobal\tvariables\tas\twe\tare limited\ton\tspace\tin\tthis\tbook.\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\tcode:\n\n/**\n\nSends\tan\temail\tusing\ta\ttemplate\temail. \t\t\t/ \t\tseneca.add({area:\t\"email\",\taction:\t\"send\",\ttemplate:\t \"*\"},\tfunction(args,\tdone)\t{ \t\t\t\tconsole.log(\"sending\"); \t\t\t\tvar\tmessage\t=\t{ \t\t\t\t\t\t\"subject\":\targs.subject, \t\t\t\t\t\t\"to\":\t[{ \t\t\t\t\t\t\t\t\"email\":\targs.to, \t\t\t\t\t\t\t\t\"name\":\targs.toName, \t\t\t\t\t\t\t\t\"type\":\t\"to\" \t\t\t\t\t\t}], \t\t\t\t\t\t\"from_email\":\t\"info@micromerce.com\", \t\t\t\t\t\t\"from_name\":\t\"Micromerce\", \t\t\t\t\t\t\"global_merge_vars\":\targs.vars, \t\t\t\t} \t\t\t\tmandrillClient.messages.sendTemplate( \t\t\t\t\t\t{\"template_name\":\targs.template,\t \"template_content\":\t{},\t\"message\":\tmessage},\t \t\t\t\tfunction(result)\t{ \t\t\t\t\t\tdone(null,\t{status:\tresult.status}); \t\t\t\t},\tfunction(e)\t{ \t\t\t\t\t\tdone({code:\te.name},\tnull); \t\t\t\t}); \t\t});\n\nNow\twe\tcan\tcreate\tour\ttemplates\tin\tMandrill\t(and\tlet\tsomeone\telse\tto manage\tthem)\tand\twe\tare\table\tto\tuse\tthem\tto\tsend\te-mails.\tAgain,\twe are\tspecializing.\tOur\tsystem\tspecializes\tin\tsending\te-mails\tand\tyou leave\tthe\tcreation\tof\tthe\te-mails\tto\tsomeone\telse\t(maybe\tsomeone\tfrom the\tmarketing\tteam\twho\tknows\thow\tto\ttalk\tto\tcustomers).\n\nLet's\tanalyze\tthis\tmicroservice:\n\nData\tis\tstored\tlocally:\tNot\treally\t(it\tis\tstored\tin\tMandrill),\tbut\tfrom the\tdesign\tpoint\tof\tview,\tit\tis Our\tmicroservice\tis\twell\tcohesioned:\tIt\tsends\tonly\te-mails;\tit\tdoes one\tthing,\tand\tdoes\tit\twell The\tsize\tof\tthe\tmicroservice\tis\tcorrect:\tIt\tcan\tbe\tunderstood\tin\ta few\tminutes,\tit\tdoes\tnot\thave\tunnecessary\tabstractions\tand\tcan\tbe rewritten\tfairly\teasily\n\nWhen\twe\ttalked\tabout\tthe\tSOLID\tdesign\tprinciples\tearlier,\twe\talways skipped\tL,\twhich\tstands\tfor\tLiskov\tSubstitution.\tBasically,\tthis\tmeans\n\nthat\tthe\tsoftware\thas\tto\tbe\tsemantically\tcorrect.\tFor\texample,\tif\twe\twrite an\tobject-oriented\tprogram\tthat\thandles\tone\tabstract\tclass,\tthe\tprogram has\tto\tbe\table\tto\thandle\tall\tthe\tsubclasses.\n\nComing\tback\tto\tNode.js,\tif\tour\tservice\tis\table\tto\thandle\tsending\ta\tplain e-mail,\tit\tshould\tbe\teasy\tto\textend\tand\tadd\tcapabilities\twithout\tmodifying the\texisting\tones.\n\nThink\tabout\tit\tfrom\tthe\tday-to-day\tproduction\toperations\tpoint\tof\tview;\tif a\tnew\tfeature\tis\tadded\tto\tyour\tsystem,\tthe\tlast\tthing\tyou\twant\tto\tdo\tis retest\tthe\texisting\tfunctionalities\tor\teven\tworse,\tdeliver\tthe\tfeature\tto production,\tintroducing\ta\tbug\tthat\tno\tone\twas\taware\tof.\n\nLet's\tcreate\ta\tuse\tcase.\tWe\twant\tto\tsend\tthe\tsame\te-mail\tto\ttwo recipients.\tAlthough\tMandrill\tAPI\tallows\tthe\tcalling\tcode\tto\tdo\tit,\twe haven't\tfactored\tin\ta\tpotential\tCC.\n\nTherefore,\twe\tare\tgoing\tto\tadd\ta\tnew\taction\tin\tSeneca\tthat\tallows\tus\tto do\tit,\tas\tfollows:\n\n/** \t\t\t\tSends\tan\temail\tincluding\tthe\tcontent. \t\t\t/ \t\tseneca.add({area:\t\"email\",\taction:\t\"send\",\tcc:\t\"*\"},\t function(args,\tdone)\t{ \t\t\t\tvar\tmessage\t=\t{ \t\t\t\t\t\t\"html\":\targs.content, \t\t\t\t\t\t\"subject\":\targs.subject, \t\t\t\t\t\t\"to\":\t[{ \t\t\t\t\t\t\t\t\"email\":\targs.to, \t\t\t\t\t\t\t\t\"name\":\targs.toName, \t\t\t\t\t\t\t\t\"type\":\t\"to\" \t\t\t\t\t\t},{ \t\t\t\t\t\t\t\t\"email\":\targs.cc, \t\t\t\t\t\t\t\t\"name\":\targs.ccName, \t\t\t\t\t\t\t\t\"type\":\t\"cc\" \t\t\t\t\t\t}], \t\t\t\t\t\t\"from_email\":\t\"info@micromerce.com\", \t\t\t\t\t\t\"from_name\":\t\"Micromerce\" \t\t\t\t} \t\t\t\tmandrillClient.messages.send({\"message\":\tmessage},\t function(result)\t{ \t\t\t\t\t\tdone(null,\t{status:\tresult.status}); \t\t\t\t},\tfunction(e)\t{\n\ndone({code:\te.name},\tnull); \t\t\t\t}); \t\t});\n\nWe\thave\tinstructed\tSeneca\tto\ttake\tthe\tcalls\tthat\tinclude\tcc\tin\tthe\tlist\tof parameters\tand\tsend\tthem\tusing\ta\tMandrill\tCC\tin\tthe\tsend\tAPI.\tIf\twe want\tto\tuse\tit,\tthe\tfollowing\tsignature\tof\tthe\tcalling\tcode\twill\tchange:\n\nseneca.act({area:\t\"email\",\taction:\t\"send\",\tsubject:\t \"The\tSubject\",\tto:\t\"test@test.com\",\ttoName:\t\"Test\t Testingtong\"},\tfunction(err,\tresult){ //\tMore\tcode\there });\n\nThe\tsignature\twill\tchange\tto\tthe\tfollowing\tcode:\n\nseneca.act({area:\t\"email\",\taction:\t\"send\",\tsubject:\t \"The\tSubject\",\tto:\t\"test@test.com\",\ttoName:\t\"Test\t Testingtong\",\tcc:\t\"test2@test.com\",\tccName:\t\"Test\t2\"},\t function(err,\tresult){ //\tMore\tcode\there });\n\nIf\tyou\tremember\tcorrectly,\tthe\tpattern\tmatching\ttries\tto\tmatch\tthe\tmost concrete\tinput\tso\tthat\tif\tan\taction\tmatches\twith\tmore\tparameters\tthan another\tone,\tthe\tcall\twill\tbe\tdirected\tto\tit.\n\nHere\tis\twhere\tSeneca\tshines:\tWe\tcan\tcall\tit\tpolymorphism\tof\tactions, as\twe\tcan\tdefine\tdifferent\tversions\tof\tthe\tsame\taction\twith\tdifferent parameters\tthat\tend\tup\tdoing\tslightly\tdifferent\tthings\tand\tenabling\tus\tto reutilize\tthe\tcode\tif\twe\tare\t100%\tsure\tthat\tthis\tis\tthe\tright\tthing\tto\tdo (remember,\tmicroservices\tenforce\tthe\tshare-nothing\tapproach:\trepeating the\tcode\tmight\tnot\tbe\tas\tbad\tas\tcoupling\ttwo\tactions).\n\nHere\tis\tthe\tpackage.json\tfor\tthe\temailer\tmicroservice:\n\n{ \t\t\"name\":\t\"emailing\", \t\t\"version\":\t\"1.0.0\", \t\t\"description\":\t\"Emailing\tsub-system\", \t\t\"main\":\t\"index.js\", \t\t\"keywords\":\t[\n\n\"microservices\", \t\t\"emailing\" \t\t], \t\t\"author\":\t\"David\tGonzalez\", \t\t\"license\":\t\"ISC\", \t\t\"dependencies\":\t{ \t\t\"mandrill-api\":\t\"^1.0.45\", \t\t\"seneca\":\t\"^0.8.0\" \t\t} }\n\nThe\tfallback\tstrategy\n\nWhen\tyou\tdesign\ta\tsystem,\tusually\twe\tthink\tabout\treplaceability\tof\tthe existing\tcomponents;\tfor\texample,\twhen\tusing\ta\tpersistence\ttechnology in\tJava,\twe\ttend\tto\tlean\ttowards\tstandards\t(JPA)\tso\tthat\twe\tcan\treplace the\tunderlying\timplementation\twithout\ttoo\tmuch\teffort.\n\nMicroservices\ttake\tthe\tsame\tapproach,\tbut\tthey\tisolate\tthe\tproblem instead\tof\tworking\ttowards\tan\teasy\treplaceability.\tIf\tyou\tread\tthe preceding\tcode,\tinside\tthe\tSeneca\tactions,\twe\thave\tdone\tnothing\tto\thide the\tfact\tthat\twe\tare\tusing\tMandrill\tto\tsend\tthe\te-mails.\n\nAs\tI\tmentioned\tbefore,\temailing\tis\tsomething\tthat,\talthough\tseems simple,\talways\tends\tup\tgiving\tproblems.\n\nImagine\tthat\twe\twant\tto\treplace\tMandrill\tfor\ta\tplain\tSMTP\tserver\tsuch\tas Gmail.\tWe\tdon't\tneed\tto\tdo\tanything\tspecial,\twe\tjust\tchange\tthe implementation\tand\troll\tout\tthe\tnew\tversion\tof\tour\tmicroservice.\n\nThe\tprocess\tis\tas\tsimple\tas\tapplying\tthe\tfollowing\tcode:\n\nvar\tnodemailer\t=\trequire('nodemailer'); var\tseneca\t=\trequire(\"seneca\")(); var\ttransporter\t=\tnodemailer.createTransport({ \t\tservice:\t'Gmail', \t\tauth:\t{ \t\t\t\tuser:\t'info@micromerce.com', \t\t\t\tpass:\t'verysecurepassword' \t\t} });\n\n/**\n\nSends\tan\temail\tincluding\tthe\tcontent. \t/ seneca.add({area:\t\"email\",\taction:\t\"send\"},\t function(args,\tdone)\t{ \t\tvar\tmailOptions\t=\t{ \t\t\t\tfrom:\t'Micromerce\tInfo\t<info@micromerce.com>', \t\t\t\tto:\targs.to,\t \t\t\t\tsubject:\targs.subject, \t\t\t\thtml:\targs.body \t\t}; \t\ttransporter.sendMail(mailOptions,\tfunction(error,\t info){ \t\t\t\tif(error){ \t\t\t\t\t\tdone({code:\te},\tnull); \t\t\t\t} \t\t\t\tdone(null,\t{status:\t\"sent\"}); \t\t}); });\n\nFor\tthe\touter\tworld,\tour\tsimplest\tversion\tof\tthe\te-mail\tsender\tis\tnow using\tSMTP\tthrough\tGmail\tto\tdeliver\tour\te-mails.\n\nAs\twe\twill\tsee\tlater\tin\tthe\tbook,\tdelivering\ta\tnew\tversion\tof\tthe\tsame interface\tin\ta\tmicroservice\tnetwork\tis\tfairly\teasy;\tas\tlong\tas\twe\trespect the\tinterface,\tthe\timplementation\tshould\tbe\tirrelevant.\n\nWe\tcould\teven\troll\tout\tone\tserver\twith\tthis\tnew\tversion\tand\tsend\tsome traffic\tto\tit\tin\torder\tto\tvalidate\tour\timplementation\twithout\taffecting\tall\tthe customers\t(in\tother\twords,\tcontain\tthe\tfailure).\n\nWe\thave\tseen\thow\tto\twrite\tan\te-mail\tsender\tin\tthis\tsection.\tWe\thave worked\tthrough\ta\tfew\texamples\ton\thow\tour\tmicroservice\tcan\tbe\tadapted quickly\tfor\tnew\trequirements\tas\tsoon\tas\tthe\tbusiness\trequires\tnew capabilities\tor\twe\tdecide\tthat\tour\tvendor\tis\tnot\tgood\tenough\tto\tcope\twith our\ttechnical\trequirements.\n\nThe\torder\tmanager\n\nThe\torder\tmanager\tis\ta\tmicroservice\tthat\tprocesses\tthe\torders\tthat\tthe customer\tplaces\tthrough\tthe\tUI.\tAs\tyou\tprobably\tremember,\twe\tare\tnot going\tto\tcreate\ta\tsophisticated\tsingle-page\tapplication\twith\ta\tmodern visual\tframework,\tas\tit\tis\tout\tof\tthe\tscope\tof\tthis\tbook,\tbut\twe\tare\tgoing to\tprovide\tthe\tJSON\tinterface\tin\torder\tto\tbe\table\tto\tbuild\tthe\tfront\tend later.\n\nOrder\tmanager\tintroduces\tan\tinteresting\tproblem:\tthis\tmicroservice needs\taccess\tto\tthe\tinformation\tabout\tproducts,\tsuch\tas\tname,\tprice, availability,\tand\tso\ton.\tHowever,\tit\tis\tstored\tin\tthe\tproduct\tmanager microservice,\tso\thow\tdo\twe\tdo\tthat?\n\nWell,\tthe\tanswer\tfor\tthis\tquestion\tmight\tlook\tsimple,\tbut\trequires\ta\tbit\tof thinking.\n\nDefining\tthe\tmicroservice\t–\thow\tto gather\tnon-local\tdata\n\nOur\tmicroservice\twill\tneed\tto\tdo\tthe\tfollowing\tthree\tthings:\n\nRecover\torders Create\torders Delete\texisting\torders\n\nWhen\trecovering\tan\torder,\tthe\toption\tis\tgoing\tto\tbe\tsimple.\tRecover\tthe order\tby\tthe\tprimary\tkey.\tWe\tcould\textend\tit\tto\trecover\torders\tby\tdifferent criteria,\tsuch\tas\tprice,\tdate,\tand\tso\ton,\tbut\twe\tare\tgoing\tto\tkeep\tit\tsimple as\twe\twant\tto\tfocus\ton\tmicroservices.\n\nWhen\tdeleting\texisting\torders,\tthe\toption\tis\talso\tclear:\tuse\tthe\tID\tto delete\torders.\tAgain,\twe\tcould\tchoose\ta\tmore\tadvanced\tdeletion\tcriteria, but\twe\twant\tto\tkeep\tit\tsimple.\n\nThe\tproblem\tarises\twhen\twe\tare\ttrying\tto\tcreate\torders.\tCreating\tan order\tin\tour\tsmall\tmicroservice\tarchitecture\tmeans\tsending\tan\te-mail\tto\n\nthe\tcustomer,\tspecifying\tthat\twe\tare\tprocessing\ttheir\torder,\talong\twith the\tdetails\tof\tthe\torder,\tas\tfollows:\n\nNumber\tof\tproducts Price\tper\tproduct Total\tprice Order\tID\t(in\tcase\tthe\tcustomer\tneeds\tto\ttroubleshoot\tproblems\twith the\torder)\n\nHow\tdo\twe\trecover\tthe\tproduct\tdetails?\n\nIf\tyou\tsee\tour\tdiagram\tshown\tin\tthe\tMicromerce\t–\tthe\tbig\tpicture\tsection of\tthis\tchapter,\torder\tmanager\twill\tonly\tbe\tcalled\tfrom\tthe\tUI,\twhich\twill be\tresponsible\tto\trecover\tthe\tproduct\tname,\tits\tprice,\tand\tso\ton.\tWe could\tadopt\tthe\tfollowing\ttwo\tstrategies\there:\n\nOrder\tmanager\tcalls\tproduct\tmanager\tand\tgets\tthe\tdetails UI\tcalls\tproduct\tmanager\tand\tdelegates\tthe\tdata\tto\tthe\torder manager\n\nBoth\toptions\tare\ttotally\tvalid,\tbut\tin\tthis\tcase,\twe\tare\tgoing\tfor\tthe second:\tUI\twill\tgather\tthe\tinformation\tneeded\tto\tgenerate\tan\torder\tand\tit will\tonly\tcall\tthe\torder\tmanager\twhen\tall\tthe\tdata\trequired\tis\tavailable.\n\nNow\tto\tanswer\tthe\tquestion:\twhy?\n\nA\tsimple\treason:\tfailure\ttolerance.\tLet's\ttake\ta\tlook\tat\tthe\tfollowing sequence\tdiagram\tof\tthe\ttwo\toptions:\n\nThe\tdiagram\tfor\tthe\tsecond\toption\tis\tshown\tas\tfollows:\n\nIn\tthe\tfirst\tview,\tthere\tis\ta\tbig\tdifference:\tthe\tdepth\tof\tthe\tcall;\twhereas\tin the\tfirst\texample,\twe\thave\ttwo\tlevels\tof\tdepth\t(UI\tcalls\tthe\torder manager,\twhich\tcalls\tthe\tproduct\tmanager).\tIn\tthe\tsecond\texample,\twe have\tonly\tone\tlevel\tof\tdepth.\tThere\tare\ta\tfew\timmediate\teffects\tin\tour architecture,\tas\tfollows:\n\nWhen\tsomething\tgoes\twrong,\tif\twe\tonly\thave\tone\tlevel\tof\tdepth,\twe don't\tneed\tto\tcheck\tin\ttoo\tmany\tplaces. We\tare\tmore\tresilient.\tIf\tsomething\tgoes\twrong,\tit\tis\tthe\tUI\tof\tthe microservice\tthat\tnotices\tit,\treturning\tthe\tappropriate\tHTTP\tcode,\tin this\tcase,\twithout\thaving\tto\ttranslate\tthe\terrors\tthat\toccurred\ta\tfew levels\tabove\tthe\tclient-facing\tmicroservice. It\tis\teasier\tto\tdeploy\tand\ttest.\tNot\tmuch\teasier,\tbut\twe\tdon't\tneed\tto juggle\taround,\twe\tcan\tsee\tstraight\taway\tif\tthe\tproduct\tmanager\tis reached\tfrom\tthe\tUI,\tinstead\tof\thaving\tto\tgo\tthrough\tthe\torder manager.\n\nThe\tfact\tthat\twe\tare\tusing\tthis\tarchitecture\tinstead\tof\tthe\ttwo-level\tdepth\n\ndoes\tnot\tmean\tthat\tit\tisn't\tappropriate\tfor\tanother\tsituation:\tthe\tnetwork topology\tis\tsomething\tthat\tyou\tneed\tto\tplan\tahead\tif\tyou\tare\tcreating\ta microservices-oriented\tarchitecture,\tas\tit\tis\tone\tof\tthe\thardest\taspects\tto change.\n\nIn\tsome\tcases,\tif\twe\twant\tto\tbe\textremely\tflexible,\twe\tcan\tuse\ta messaging\tqueue\twith\tpublisher/subscriber\ttechnology\twhere\tour microservices\tcan\tsubscribe\tto\tdifferent\ttypes\tof\tmessages\tand\temit others\tto\tbe\tconsumed\tby\ta\tdifferent\tservice,\tbut\tit\tcould\tcomplicate\tthe infrastructure\tthat\twe\tneed\tto\tput\tin\tplace\tto\tavoid\tsingle\tpoint\tof\tfailures.\n\nThe\torder\tmanager\t–\tthe\tcode\n\nLet's\ttake\ta\tlook\tat\tthe\tcode\tfor\tthe\torder\tmanager:\n\nvar\tplugin\t=\tfunction(options)\t{ \t\tvar\tseneca\t=\tthis;\n\nseneca.add({area:\t\"orders\",\taction:\t\"fetch\"},\t function(args,\tdone)\t{ \t\t\t\tvar\torders\t=\tthis.make(\"orders\"); \t\t\t\torders.list$({id:\targs.id},\tdone); \t\t});\n\nseneca.add({area:\t\"orders\",\taction:\t\"delete\"},\t function(args,\tdone)\t{ \t\t\t\tvar\torders\t=\tthis.make(\"orders\"); \t\t\t\torders.remove$({id:\targs.id},\tfunction(err)\t{ \t\t\t\t\t\t\t\tdone(err,\tnull); \t\t\t\t}); \t\t}); } module.exports\t=\tplugin;\n\nAs\tyou\tcan\tsee,\tthere\tis\tnothing\tcomplicated\tabout\tthe\tcode.\tThe\tonly interesting\tpoint\tis\tthe\tmissing\tcode\tfrom\tthe\tcreate\taction.\n\nCalling\tremote\tservices\n\nUntil\tnow,\twe\thave\tassumed\tthat\tall\tour\tmicroservices\trun\tin\tthe\tsame machine,\tbut\tthat\tis\tfar\tfrom\tideal.\tIn\tthe\treal\tworld,\tmicroservices\tare distributed\tand\twe\tneed\tto\tuse\tsome\tsort\tof\ttransport\tprotocol\tto\tcarry\n\nthe\tmessage\tfrom\tone\tservice\tto\tanother.\n\nSeneca,\tas\twell\tas\tnearForm,\tthe\tcompany\tbehind\tSeneca,\thas\tsorted this\tproblem\tfor\tus\tand\tthe\topen\tsource\tcommunity\taround\tit.\n\nAs\ta\tmodular\tsystem,\tSeneca\thas\tembedded\tthe\tconcept\tof\tplugin.\tBy default,\tSeneca\tcomes\twith\ta\tbundled\tplugin\tto\tuse\tTCP\tas\tthe\tprotocol, but\tit\tis\tnot\thard\tto\tcreate\ta\tnew\ttransport\tplugin.\n\nNote\n\nWhile\twriting\tthis\tbook,\tI\tcreated\tone\tby\tmyself: https://github.com/dgonzalez/seneca-nservicebus-transport/\n\nWith\tthis\tplugin,\twe\tcould\troute\tthe\tSeneca\tmessages\tthrough NServiceBus\t(a\t.NET-based\tEnterprise\tBus),\tchanging\tthe\tconfiguration of\tour\tclient\tand\tserver.\n\nLet's\tsee\thow\tto\tconfigure\tSeneca\tto\tpoint\tto\ta\tdifferent\tmachine:\n\nvar\tsenecaEmailer\t=\trequire(\"seneca\")().client({host:\t \"192.168.0.2\",\tport:\t8080});\n\nBy\tdefault,\tSeneca\twill\tuse\tthe\tdefault\tplugin\tfor\ttransport,\twhich\tas we've\tseen\tin\tChapter\t2,\tMicroservices\tin\tNode.js\t–\tSeneca\tand\tPM2 Alternatives,\tis\ttcp,\tand\twe\thave\tspecified\tit\tto\tpoint\tto\tthe\t192.168.0.2 host\ton\tthe\t8080\tport.\n\nAs\tsimple\tas\tthat,\tfrom\tnow\ton,\twhen\twe\texecute\tan\tact\tcommand\ton senecaEmailer,\tthe\ttransport\twill\tsend\tthe\tmessage\tacross\tto\tthe\temailer and\treceives\tthe\tresponse.\n\nLet's\tsee\tthe\trest\tof\tthe\tcode:\n\nseneca.add({area:\t\"orders\",\taction:\t\"create\"},\t function(args,\tdone)\t{ \t\t\t\tvar\tproducts\t=\targs.products; \t\t\t\tvar\ttotal\t=\t0.0; \t\t\t\tproducts.forEach(function(product){\n\ntotal\t+=\tproduct.price; \t\t\t\t}); \t\t\t\tvar\torders\t=\tthis.make(\"orders\"); \t\t\t\torders.total\t=\ttotal; \t\t\t\torders.customer_email\t=\targs.email; \t\t\t\torders.customer_name\t=\targs.name; \t\t\t\torders.save$(function(err,\torder)\t{ \t\t\t\t\t\tvar\tpattern\t=\t{ \t\t\t\t\t\t\t\tarea:\t\"email\",\t \t\t\t\t\t\t\t\taction:\t\"send\",\t \t\t\t\t\t\t\t\ttemplate:\t\"new_order\",\t \t\t\t\t\t\t\t\tto:\targs.email, \t\t\t\t\t\t\t\ttoName:\targs.name, \t\t\t\t\t\t\t\tvars:\t{ \t\t\t\t\t\t\t\t\t\t//\t...\tvars\tfor\trendering\tthe\ttemplate\t including\tthe\tproducts\t... \t\t\t\t\t\t\t\t} \t\t\t\t\t\t} \t\t\t\t\t\tsenecaEmailer.act(pattern,\tdone); \t\t\t\t}); \t\t});\n\nAs\tyou\tcan\tsee,\twe\tare\treceiving\ta\tlist\tof\tproducts\twith\tall\tthe\tdata needed\tand\tpassing\tthem\tto\tthe\temailer\tto\trender\tthe\te-mail.\n\nIf\twe\tchange\tthe\thost\twhere\tthe\temailer\tlives,\tthe\tonly\tchange\tthat\twe need\tto\tdo\there\tis\tthe\tconfiguration\tof\tthe\tsenecaEmailer\tvariable.\n\nEven\tif\twe\tchange\tthe\tnature\tof\tthe\tchannel\t(we\tcould\tpotentially\teven write\ta\tplugin\tto\tsend\tthe\tdata\tover\tTwitter,\tfor\texample),\tthe\tplugin should\tlook\tafter\tthe\tparticularities\tof\tit\tand\tbe\ttransparent\tfor\tthe application.\n\nResilience\tover\tperfection\n\nIn\tthe\texample\tfrom\tthe\tpreceding\tsection,\twe\tbuilt\ta\tmicroservice\tthat calls\tanother\tmicroservice\tin\torder\tto\tresolve\tthe\tcall\tthat\tit\treceives. However,\tthe\tfollowing\tpoints\tneed\tto\tbe\tkept\tin\tmind:\n\nWhat\thappens\tif\tthe\temailer\tis\tdown? What\thappens\tif\tthe\tconfiguration\tis\twrong\tand\tthe\temailer\tis\tnot working\ton\tthe\tcorrect\tport?\n\nWe\tcould\tbe\tthrowing\twhat\tifs\tfor\tfew\tpages.\n\nHumans\tare\timperfect\tand\tso\tare\tthe\tthings\tthat\tthey\tbuild,\tand\tsoftware is\tnot\tan\texception.\tHumans\tare\talso\tbad\tat\trecognizing\tthe\tpotential problems\tin\tlogical\tflows,\tand\tsoftware\ttends\tto\tbe\ta\tcomplex\tsystem.\n\nIn\tother\tlanguages,\tplaying\twith\texceptions\tis\talmost\tsomething\tnormal, but\tin\tJavaScript,\texceptions\tare\ta\tbig\tdeal:\n\nIf\tan\texception\tbubbles\tout\tin\ta\tweb\tapp\tin\tJava,\tit\tkills\tthe\tcurrent stack\tof\tcalls\tand\tTomcat\t(or\tthe\tcontainer\tthat\tyou\tuse)\treturns\tan error\tto\tthe\tclient If\tan\texception\tbubbles\tout\tin\ta\tNode.js\tapp,\tthe\tapplication\tis\tkilled as\twe\tonly\thave\tone\tthread\texecuting\tthe\tapp\n\nAs\tyou\tcan\tsee,\tpretty\tmuch\tevery\tsingle\tcallback\tin\tNode.js\thas\ta\tfirst parameter\tthat\tis\tan\terror.\n\nWhen\ttalking\tabout\tmicroservices,\tthis\terror\tis\tespecially\timportant.\tYou want\tto\tbe\tresilient.\tThe\tfact\tthat\tan\te-mail\thas\tfailed\tsending\tdoes\tnot mean\tthat\tthe\torder\tcannot\tbe\tprocessed,\tbut\tthe\te-mail\tcould\tbe manually\tsent\tlater\tby\tsomeone\treprocessing\tthe\tdata.\tThis\tis\twhat\twe call\teventual\tconsistency;\twe\tfactor\tinto\tour\tsystem\tthe\tfact\tthat\tat\tsome point\tour\tsystem\tis\tgoing\tto\tcrash.\n\nIn\tthis\tcase,\tif\tthere\tis\ta\tproblem\tsending\tthe\te-mail,\tbut\twe\tcould\tstore the\torder\tin\tthe\tdatabase,\tthe\tcalling\tcode,\tin\tthis\tcase\tthe\tUI,\tshould have\tenough\tinformation\tto\tdecide\twhether\tthe\tcustomer\tgets\ta\tfatal message\tor\tjust\ta\twarning:\n\nYour\torder\tis\tready\tto\tbe\tprocessed,\thowever\tit\tmight\ttake\tus\ttwo\tdays\tto send\tyou\tthe\te-mail\twith\tthe\torder\tdetails.\tThanks\tfor\tyour\tpatience.\n\nUsually,\tthe\tfact\tthat\tour\tapplication\twill\tkeep\tworking\teven\tif\twe\tcannot complete\ta\trequest,\tit\tis\tusually\tmore\tbusiness\tthan\ttechnical\tdecision. This\tis\tan\timportant\tdetail,\tas\twhen\tbuilding\tmicroservices,\tConway's\tlaw is\tpushing\tus,\tthe\ttechnical\tpeople,\tto\tmodel\tthe\texisting\tbusiness process\tand\tpartial\tsuccess\tmaps\tperfectly\tto\tthe\thuman\tnature.\tIf\tyou can't\tcomplete\ta\ttask,\tcreate\ta\treminder\tin\tEvernote\t(or\ta\tsimilar\ttool) and\tcome\tback\tto\tit\tonce\tthe\tblocker\tis\tresolved.\n\nThis\treads\tmuch\tbetter\tthan\tthe\tfollowing:\n\nSomething\thappened\tabout\tsomething,\tbut\twe\tcan't\ttell\tyou\tmore\t(which is\twhat\tmy\tmind\treads\tsometimes\twhen\tI\tget\ta\tgeneral\tfailure\tin\tsome websites).\n\nWe\tcall\tthis\tway\tof\thandling\terrors\tsystem\tdegradation:\tit\tmight\tnot\tbe 100%\tfunctional,\tbut\tit\twill\tstill\twork\teven\tthough\tits\tfew\tfeatures\tare\tnot available,\tinstead\tof\ta\tgeneral\tfailure.\n\nIf\tyou\tthink\tfor\ta\tsecond,\thow\tmany\ttimes\ta\tweb\tservice\tcall\thas\trolled back\ta\tfull\ttransaction\tin\tyour\tbig\tcorporate\tsystem\tonly\tbecause\tit couldn't\treach\ta\tthird-party\tservice\tthat\tmight\tnot\teven\tbe\timportant?\n\nIn\tthis\tsection,\twe\tbuilt\ta\tmicroservice\tthat\tuses\tanother\tmicroservice\tto resolve\ta\trequest\tfrom\ta\tcustomer:\torder\tmanager\tuses\temailer\tto complete\tthe\trequest.\tWe\thave\talso\ttalked\tabout\tresilience\tand\thow important\tit\tis\tin\tour\tarchitecture\tin\torder\tto\tprovide\tthe\tbest\tservice.\n\nThe\tUI\t–\tAPI\taggregation\n\nUntil\tnow,\twe\thave\tbuilt\tindependent\tmicroservices.\tThey\thad\ta\tspecific purpose\tand\tdealt\twith\tone\tspecific\tpart\tof\tour\tsystem:\te-mail\tsending, product\tmanagement,\tand\torder\tprocessing,\tbut\tnow\twe\tare\tbuilding\ta microservice\twhose\tonly\tpurpose\tis\tto\tfacilitate\tthe\tcommunication between\tmicroservices.\n\nNow\twe\tare\tgoing\tto\tbuild\ta\tmicroservice\tthat\tinteracts\twith\tothers\tand\tis the\tfront-facing\tfaçade\tto\tthe\tcustomer.\n\nWhen\tI\twas\tplanning\tthe\tcontents\tof\tthis\tchapter,\ta\tservice\tlike\tthis\tone wasn't\tin\tit.\tHowever,\tafter\tthinking\tabout\tit,\tthis\tchapter\twouldn't\thave been\tthe\tsame\twithout\tshowing\ta\tfew\tconcepts\taround\tAPI\taggregation that\tare\tfairly\teasy\tto\tshow\tin\ta\tfrontend\tmicroservice.\n\nNeed\tfor\tfrontend\tmicroservice\n\nThink\tabout\tscalability.\tWhen\tdealing\twith\tHTTP\ttraffic,\tthere\tis\ta pyramid\tof\ttraffic.\tThere\tare\tmore\thits\tin\tthe\tfrontend\tthan\tin\tthe backend.\tUsually,\tin\torder\tto\treach\tthe\tbackend,\tthe\tfrontend\tneeds\tto process\tthe\tfollowing\tfew\trequests\tfrom\tthe\tfrontend:\n\nRead\ta\tform Validate\tit Manage\tthe\tPRG\tpattern (https://en.wikipedia.org/wiki/Post/Redirect/Get)\n\nAs\tyou\tcan\tsee,\tthere\tis\ta\tlot\tof\tlogic\tthat\tneeds\tto\tbe\tprocessed\tby\tthe frontend,\tso\tthat\tit\tis\tnot\thard\tto\tsee\tcapacity\tproblems\tif\tthe\tsoftware\tis busy.\tIf\twe\tare\tusing\ta\tmicroservice,\tand\twe\tare\tusing\tit\tin\tthe\tright\tway, scaling\tup\tor\tdown\tshould\tbe\tan\tautomatic\tprocess\tthat\tcan\tbe\ttriggered with\ta\tcouple\tof\tclicks\t(or\tcommands).\n\nThe\tcode\n\nUntil\tnow,\twe\thave\tpretty\tmuch\talways\ttested\tthe\tcode\tin\ta\tsingle\tserver.\n\nThis\tis\tfine\tfor\ttesting,\tbut\twhen\twe\tare\tbuilding\tmicroservices,\twe\twant them\tto\tbe\tdistributed.\tTherefore,\tin\torder\tto\tachieve\tit,\twe\tneed\tto indicate\tto\tSeneca\thow\tto\treach\tthe\tservices:\n\nvar\tsenecaEmailer\t=\trequire(\"seneca\")().client({ \t\thost:\t\"192.168.0.2\",\t \t\tport:\t8080 }); var\tsenecaProductManager\t=\trequire(\"seneca\") ().client({ \t\thost:\t\"192.168.0.3\",\t \t\tport:\t8080 }); var\tsenecaOrderProcessor\t=\trequire(\"seneca\") ().client({ \t\thost:\t\"192.168.0.4\",\t \t\tport:\t8080 });\n\nWhat\twe\thave\tdone\tis\tcreate\tthree\tSeneca\tinstances.\tThey\tare\tlike communication\tpipes\tbetween\tservers.\n\nLet's\texplain\tthe\tcode:\n\nSeneca,\tby\tdefault,\tuses\tthe\ttransport\tplugin\tTCP.\tIt\tmeans\tthat\tSeneca will\tbe\tlistening\tto\tthe\t/act\tURL\ton\tthe\tserver.\tAs\tan\texample,\twhen\twe create\tsenecaEmailer,\tthe\tURL\twhere\tSeneca\twill\tbe\tpointing\tto\tis http://192.168.0.2:8080/act.\n\nWe\tcan\tactually\tverify\tit\twith\tcurl.\tIf\twe\texecute\tthe\tfollowing\tcommand line,\treplacing\t<valid\tSeneca\tpattern>\tby\ta\tvalid\tSeneca\tcommand,\twe should\tget\ta\tresponse\tfrom\tthe\tserver\tin\tthe\tJSON\tformat,\twhich\twould be\tthe\tsecond\tparameter\tin\tthe\tdone\tfunction\tfor\tthe\taction:\n\ncurl\t-d\t'<valid\tSeneca\tpattern>'\t-v\t http://192.168.0.2:8080/act\n\nTip\n\nSeneca's\tdefault\ttransport\tplugin\tis\tTCP.\tIf\twe\tdon't\tspecify\tany\tother, Seneca\twill\tuse\tit\tto\treach\tother\tservers\tand\tlisten\tto\tcalls.\n\nLet's\tsee\tan\teasy\texample:\n\nvar\tseneca\t=\trequire(\"seneca\")(); seneca.add({cmd:\t\"test\"},\tfunction(args,\tdone)\t{ \t\tdone(null,\t{response:\t\"Hello\tWorld!\"}); });\n\nseneca.listen({port:\t3000});\n\nIf\twe\trun\tthis\tprogram,\twe\tcan\tsee\tthe\tfollowing\toutput\tfrom\tthe\tterminal:\n\nIt\tmeans\tthat\tSeneca\tis\tlistening\tto\tthe\tport\t3000.\tLet's\ttest\tit:\n\ncurl\t-d\t'{\"cmd\":\t\"test\"}'\t-v\thttp://127.0.0.1:3000/act\n\nThis\tshould\tprint\tsomething\tvery\tsimilar\tto\tthe\tfollowing\tcode\tin\tthe terminal:\n\nThe\tpreceding\tcode\tis\tthe\tTCP/IP\tdialog\tbetween\tour\tterminal\tand Seneca\tserver\twith\tthe\tresult\tof\tthe\tresponse\tin\tthe\tlast\tline.\n\nSo,\twhat\twe\tachieved\tearlier\ton\thaving\tthree\tdifferent\tinstances\tof Seneca\tis\tconfiguring\tour\tnetwork\tof\tmicroservices;\tSeneca\twill\ttransport the\tmessages\tacross\tthe\tnetwork\tfor\tus.\n\nThe\tfollowing\tflow\tdiagram\tdescribes\thow\ta\tsingle\tAPI\tcan\thide\tmultiple Seneca\tservers\tin\tthe\tbackend\twith\tdifferent\tmicroservices\t(different Seneca\tinstances,\tbasically):\n\nNow,\tlet's\ttake\ta\tlook\tat\tthe\tskeleton\tof\tthe\tmicroservice:\n\nvar\texpress\t=\trequire(\"express\"); var\tbodyParser\t=\trequire('body-parser'); var\tsenecaEmailer\t=\trequire(\"seneca\")().client({ \t\thost:\t\"192.168.0.2\",\t \t\tport:\t8080 }); var\tsenecaProductManager\t=\trequire(\"seneca\") ().client({ \t\thost:\t\"192.168.0.3\",\t \t\tport:\t8080 }); var\tsenecaOrderProcessor\t=\trequire(\"seneca\") ().client({ \t\thost:\t\"192.168.0.4\",\t \t\tport:\t8080 });\n\nfunction\tapi(options)\t{ \t\tvar\tseneca\t=\tthis;\n\n/** \t\t\t\tGets\tthe\tfull\tlist\tof\tproducts \t\t\t/ \t\tseneca.add({area:\t\"ui\",\taction:\t\"products\"},\t function(args,\tdone)\t{ \t\t\t\t//\tMore\tcode\tto\tcome \t\t}); \t\t/** \t\t\t\tGet\ta\tproduct\tby\tid\n\n/ \t\tseneca.add({area:\t\"ui\",\taction:\t\"productbyid\"},\t function(args,\tdone)\t{ \t\t\t\t//\tMore\tcode\tto\tcome \t\t});\n\n/** \t\t\t\tCreates\tan\torder \t\t\t/ \t\tseneca.add({area:\t\"ui\",\taction:\t\"createorder\"},\t function(args,\tdone)\t{ \t\t\t\t//\tMore\tcode\tto\tcome \t\t});\n\nthis.add(\"init:api\",\tfunction(msg,\trespond){ \t\t\t\tseneca.act('role:web',{\tuse:\t{ \t\t\t\t\t\tprefix:\t'/api', \t\t\t\t\t\tpin:\t\t'area:ui,action:*', \t\t\t\t\t\tmap:\t{ \t\t\t\t\t\t\t\tproducts:\t\t{GET:true}\t\t \t\t\t\t\t\t\t\tproductbyid:\t{GET:true,\tsuffix:'/:id'} \t\t\t\t\t\t\t\tcreateorder:\t{POST:true} \t\t\t\t\t\t} \t\t\t\t}},\trespond) \t\t}); } module.exports\t=\tapi; var\tseneca\t=\trequire(\"seneca\")(); seneca.use(api);\n\nvar\tapp\t=\trequire(\"express\")(); app.use(\trequire(\"body-parser\").json()); app.use(seneca.export(\"web\")); app.listen(3000);\n\nWe\thave\tactually\tleft\tthe\tfunctionality\tthat\tcalls\tother\tmicroservices\tfor later\tdiscussion.\tNow\twe\tare\tgoing\tto\tfocus\ton\thow\tthe\tcode\tis articulated:\n\nWe\tare\tcreating\ta\tnew\tplugin.\tThe\tplugin\tis\tcalled\tapi\t(the\tname\tof the\tfunction\tfor\twrapping\tthe\tplugin\tis\tapi). The\tplugin\thas\tto\tperform\tthe\tfollowing\tthree\tactions:\n\nList\tall\tthe\tproducts Get\ta\tproduct\tby\tID Create\tan\torder\n\nThese\tthree\tactions\twill\tcall\tto\ttwo\tdifferent\tmicroservices:\tProduct Manager\tand\tOrder\tManager.\tWe\twill\tcome\tback\tto\tthis\ttopic\tlater.\n\nTip\n\nSeneca\tcan\tbe\tseamlessly\tintegrated\twith\tExpress\tin\torder\tto\tprovide web\tcapabilities\tto\tSeneca\tmicroservices.\n\nUntil\there,\teverything\tis\twell\tknown,\tbut\twhat\tabout\tthe\tinitialization function\tof\tthe\tplugin?\n\nAt\tfirst\tlook,\tit\tlooks\tlike\tdark\tmagic:\n\nthis.add(\"init:api\",\tfunction(msg,\trespond){ \t\t\t\tseneca.act('role:web',{\tuse:\t{ \t\t\t\t\t\tprefix:\t'/api', \t\t\t\t\t\tpin:\t\t'area:ui,action:*', \t\t\t\t\t\tmap:\t{ \t\t\t\t\t\t\t\tproducts:\t\t{GET:true}\t\t \t\t\t\t\t\t\t\tproductbyid:\t{GET:true,\tsuffix:'/:id'} \t\t\t\t\t\t\t\tcreateorder:\t{POST:true} \t\t\t\t\t\t} \t\t\t\t}},\trespond) \t\t});\n\nLet's\texplain\tit:\n\n1.\t Seneca\twill\tcall\tthe\tinit:\t<plugin-name>\taction\tin\torder\tto\tinitialize the\tplugin.\n\n2.\t Through\tthe\tprefix\targument,\twe\tare\tlistening\tto\tURLs\tunder\tthe /api\tpath.\n\n3.\t We\tare\tinstructing\tSeneca\tto\tmap\tthe\tURLs\tto\taction\tby\tpinning\ta base\tcommon\targument.\tIn\tthis\tcase,\tall\tour\tseneca.add(..) contains\tan\targument\tcalled\tarea\twith\tthe\tui\tvalue.\tWe\tare\talso asking\tSeneca\tto\troute\tcalls\tthat\tcontain\tthe\taction\targument\t(no matter\tthe\tvalue,\tthat\tis\twhy\twe\tuse\tthe\t*)\tso\tthat\tit\twould\tignore calls\tthat\tdon't\tspecify\tthe\taction\targument.\n\nThe\tfollowing\targument\t(map)\tspecifies\tthe\tmethods\tallowed\tin\tthe\n\nmatching.\n\nHow\tis\tthe\targument\tmatching\tdone?\n\nThe\tarea\targument\tis\timplicit\tas\twe\thave\tpinned\tit\twith\tthe\tui\tvalue.\n\nThe\taction\targument\tneeds\tto\tbe\tpresent.\n\nThe\tURL\tmust\tstart\twith\t/api\tas\twe\tspecified\ta\tprefix.\n\nSo,\twith\tthis\tinformation,\tapiproducts\twill\tcorrespond\tto\tthe\t{area:\t\"ui\", action:\t\"products\"}\taction.\tIn\tthe\tsame\tway,\tapicreateorder\twill correspond\tto\tthe\t{area:\t\"ui\",\taction:\"createorder\"}\taction.\n\nThe\tProductbyid\targument\tis\ta\tbit\tspecial.\n\nTip\n\nThe\tSeneca\tpin\tkeyword\tis\tused\tto\tassume\tthat\tthe\tcalling\tcode\thas a\tpair\tof\targument-value\tso\tthat\tit\tmakes\tthe\tcode\teasier\tto understand,\tbut\tbe\tcareful,\timplicit\tvalues\tcan\thave\tbad\teffects\tto\tthe readability.\n\nNow,\talthough\tit\tis\tnot\tsimple,\tthis\tlooks\tmuch\teasier.\n\nLet's\tgo\tback\tto\tthe\tSeneca\tactions\tthat\tare\tgoing\tto\tprovide\tthe functionality:\n\n/** \t\t\t*\tGets\tthe\tfull\tlist\tof\tproducts.\n\nseneca.add({area:\t\"ui\",\taction:\t\"products\"},\t function(args,\tdone)\t{ \t\t\t\tsenecaProductManager.act({area:\t\"product\",\taction:\t \"fetch\"},\tfunction(err,\tresult)\t{ \t\t\t\t\t\tdone(err,\tresult); \t\t\t\t}); \t\t});\n\n*\tGet\ta\tproduct\tby\tid.\n\nseneca.add({area:\t\"ui\",\taction:\t\"productbyid\"},\t function(args,\tdone)\t{ \t\t\t\tsenecaProductManager.act({area:\t\"product\",\taction:\t \"fetch\",\tcriteria:\t\"byId\",\tid:\targs.id},\tfunction(err,\t result)\t{ \t\t\t\t\t\tdone(err,\tresult); \t\t\t\t}); \t\t});\n\nCreates\tan\torder\tto\tbuy\ta\tsingle\tprodct. \t\t\t/ \t\tseneca.add({area:\t\"ui\",\taction:\t\"createorder\"},\t function(args,\tdone)\t{ \t\t\t\tsenecaProductManager.act({area:\t\"product\",\taction:\t \"fetch\",\tcriteria:\t\"byId\",\tid:\targs.id},\tfunction(err,\t product)\t{ \t\t\t\t\t\tif(err)\tdone(err,\tnull); \t\t\t\t\t\tsenecaOrderProcessor.act(area:\t\"orders\",\taction:\t \"create\",\tproducts:\t[product],\temail:\targs.email,\t name:\targs.name,\tfunction(err,\torder)\t{ \t\t\t\t\t\t\t\tdone(err,\torder); \t\t\t\t\t\t}); \t\t\t\t}); \t\t});\n\nNote\n\nWarning!\tIn\tthe\tservices\twritten\tin\tthis\tchapter,\tthere\tis\tno\tdata validation\tperformed\tin\torder\tto\tmake\tthe\tconcepts\taround\tthe\tdesign of\tmicroservices\tclear.\tYou\tshould\talways\tvalidate\tthe\tincoming\tdata from\tuntrusted\tsystems\t(such\tas\tcustomers\tinput).\n\nWe\tare\tactually\tusing\teverything\tthat\twe've\tdiscussed\tin\tthe\tprevious chapters,\tbut\twe\tare\ttaking\ta\tstep\tforward\tin\tthe\tSeneca\tsemantics.\n\nWe\thave\tcreated\tan\tAPI\twith\ta\tvery\tlimited\tset\tof\tfunctionalities,\tbut through\tthem,\twe\tare\taggregating\tthe\tfunctionality\tof\tdifferent microservices\tinto\tone.\n\nA\tdetail\tto\ttake\tinto\taccount\tis\tthe\tamount\tof\tnested\tcalls\tin\tthe\tcreate order\taction\t(the\tlast\tone).\tIn\tthis\tcase,\twe\tare\tcreating\torders\tout\tof\tonly\n\na\tproduct\tto\tsimplify\tthe\tcode,\tbut\tif\twe\tare\tnesting\ttoo\tmany\tcalls\tfor non-blocking\tactions\twaiting\tfor\tthe\tresponse\tin\ta\tcallback,\twe\twill\tend up\thaving\ta\tpyramid\tof\tcode\tthat\tmakes\tyour\tprogram\tdifficult\tto\tread.\n\nThe\tsolution\tfor\tit\twould\tbe\tto\trefactor\thow\tthe\tdata\tis\tfetched\tand/or reorganize\tthe\tanonymous\tfunctions,\tavoiding\tinlining.\n\nAnother\tsolution\tis\tthe\tusage\tof\tpromises\tlibraries\tsuch\tas\tQ\tor\tBluebird (http://bluebirdjs.com/)\tthat\tallow\tus\tto\tchain\tthe\tflow\tof\tthe\tmethods through\tpromises:\n\nmyFunction().then(function()\t{ //\tCode\there }).then(function(){ //\tMore\tcode\there }).catch(function(error){ //\tHandle\tthe\terror. });\n\nIn\tthis\tway,\tinstead\tof\tbuilding\ta\tsea\tof\tcallbacks,\twe\tare\tnicely\tchaining the\tcalls\tto\tthe\tmethods\tand\tadding\terror\thandlers\tto\tavoid\tthe exceptions\tfrom\tbubbling\tup.\n\nAs\tyou\tcan\tsee,\twe\tare\tusing\tthe\tUI\tas\ta\tcentral\tpoint\tof\tcommunication for\tall\tthe\tmicroservices,\texcept\tfor\tthe\tmailer,\tand\twe\thave\ta\treally\tgood reason\tfor\tit.\n\nService\tdegradation\t–\twhen\tthe\tfailure\tis not\ta\tdisaster\n\nMicroservices\tare\tgreat,\tand\twe\thave\tdemonstrated\tthat\tby\twriting\ta small\tsystem\tin\ta\tfew\thundred\tlines\tof\tcode\tthat\tis\tfairly\teasy\tto understand.\n\nThey\tare\talso\tgreat\tas\tthey\tallow\tus\tto\treact\tin\tthe\tevent\tof\ta\tfailure:\n\nWhat\thappens\tif\tthe\temailer\tmicroservice\tstops\tworking? What\thappens\tif\tthe\torder\tprocessor\tstops\tworking? Can\twe\trecover\tfrom\tthe\tsituation?\n\nWhat\tdoes\tthe\tcustomer\tsee?\n\nThese\tquestions,\ton\ta\tmonolithic\tsystem,\tare\tnonsense.\tThe\temailer probably\twould\tbe\ta\tpart\tof\tthe\tapplication.\tThe\tfailure\ton\tsending\tan\te- mail\timplies\ta\tgeneral\terror,\tunless\tit\tis\tspecifically\thandled.\tSame\twith the\torder\tprocessor.\n\nHowever,\twhat\tabout\tour\tmicroservices-oriented\tarchitecture?\n\nThe\tfact\tthat\tthe\temailer\thas\tfailed\tto\tdeliver\ta\tfew\te-mails\tdoes\tnot prevent\tthe\torders\tfrom\tbeing\tprocessed,\teven\tthough\tthe\tcustomers aren't\tgetting\tthe\te-mails.\tThis\tis\twhat\twe\tcall\tperformance\tor\tservice degradation;\tthe\tsystem\tmight\tbe\tslower,\tbut\tsome\tfunctionalities\twill\tstill work.\n\nTip\n\nService\tdegradation\tis\tthe\tability\tof\ta\tsystem\tto\tlose\ta\tfeature\twithout suffering\ta\tgeneral\tfailure.\n\nWhat\tabout\tthe\torder\tmanager?\tWell...we\tcan\tstill\tmake\tthe\tproducts- related\tcalls\twork,\tbut\twe\twon't\tbe\table\tto\tprocess\tany\torder…which might\tstill\tbe\ta\tgood\tthing.\n\nThe\tfact\tthat\tthe\torder\tmanager\tis\tresponsible\tfor\tsending\tthe\te-mail instead\tof\tthe\tUI\tmicroservice\tis\tnot\tcoincidental;\twe\tonly\twant\tto\tsend the\te-mail\twith\tthe\tacknowledgement\tof\ta\tsale\ton\tthe\tsuccess\tevent,\tand we\tdon't\twant\tto\tsend\tthe\tsuccess\te-mail\tin\tany\tother\tcase.\n\nCircuit\tbreakers\n\nIn\tthe\tprevious\tsection,\twe\ttalked\tabout\tsystem\tdegradation\tin\tthe\tevent of\ta\tfailure,\tbut\teverybody\twho\thas\tworked\tin\tIT\tfor\ta\tnumber\tof\tyears knows\tthat\ta\tsystem\tdoes\tnot\tfail\tsuddenly\tin\tmost\tcases\tof\tfailures.\n\nThe\tmost\tcommon\tevent\tis\ta\ttimeout;\tthe\tserver\tis\tbusy\tfor\ta\tperiod\tof time,\twhich\tmakes\tthe\trequest\tto\tfail,\tgiving\tour\tcustomers\ta\tterrible\tuser\n\nexperience.\n\nHow\tcan\twe\tsolve\tthis\tparticular\tproblem?\n\nWe\tcan\tsolve\tthis\tproblem\twith\ta\tcircuit\tbreaker,\tas\tshown\tin\tthe following\timage:\n\nA\tcircuit\tbreaker\tis\ta\tmechanism\tto\tprevent\trequests\tfrom\treaching\tan unstable\tserver\tthat\tcould\tcause\tour\tapplication\tto\tmisbehave.\n\nAs\tyou\tcan\tsee\tin\tthe\tpreceding\tschema,\tthe\tcircuit\tbreaker\thas\tthe following\tthree\tstatuses:\n\nClosed:\tThe\tcircuit\tis\tclosed;\tthe\trequests\treach\ttheir\tdestination. Open:\tThe\tcircuit\tis\topen;\tthe\trequests\tdon't\tget\tpast\tthe\tcircuit breaker\tand\tthe\tclient\tgets\tan\terror.\tThe\tsystem\twill\tretry\tthe communication\tafter\ta\ttime\tperiod. HalfOpen:\tThe\tcircuit\ttests\tthe\tservice\tagain,\tand\tif\tthere\tis\tno\terror reaching\tit,\tthe\trequests\tcan\tflow\tagain\tand\tthe\tcircuit\tbreaker\tis Closed.\n\nWith\tthis\tsimple\tmechanism,\twe\tcan\tprevent\tthe\terrors\tto\tcascade through\tour\tsystem,\tavoiding\tcatastrophic\tfailures.\n\nIdeally,\tthe\tcircuit\tbreaker\tshould\tbe\tasynchronous.\tThis\tmeans\tthat\n\neven\tif\tthere\tare\tno\trequests,\tevery\tfew\tseconds/milliseconds,\tthe system\tshould\tbe\ttrying\tto\tre-establish\tthe\tconnection\tto\tthe\tfaulty service\tin\torder\tto\tcontinue\tthe\tnormal\toperation.\n\nTip\n\nFailure\tis\ta\tcommon\tdenominator\tin\tthe\thuman\tnature:\tbetter\tbe prepared\tfor\tit.\n\nCircuit\tbreakers\tare\talso\tan\tideal\tplace\tto\talert\tthe\tsupport\tengineers. Depending\ton\tthe\tnature\tof\tour\tsystem,\tthe\tfact\tthat\ta\tgiven\tservice cannot\tbe\treached\tcould\tmean\ta\tserious\tissue.\tCan\tyou\timagine\ta\tbank that\tis\tunable\tto\treach\tthe\tSMS\tservice\tto\tsend\ttwo-factor\tauthentication codes?\tNo\tmatter\thow\thard\twe\ttry,\tit\twill\talways\thappen\tat\tsome\tpoint. So,\tbe\tprepared\tfor\tit.\n\nNote\n\nThere\tis\ta\tvery\tinspiring\tarticle\tfrom\tMartin\tFowler\t(one\tof\tthe\tbig names\tin\tmicroservices)\tabout\tcircuit\tbreakers\tat http://martinfowler.com/bliki/CircuitBreaker.html.\n\nSeneca\t–\ta\tsimple\tpuzzle\tthat\tmakes\tour lives\teasier\n\nSeneca\tis\tgreat.\tIt\tenables\tthe\tdevelopers\tto\ttake\ta\tsimple\tand\tsmall idea\tand\ttranslate\tit\tinto\ta\tpiece\tof\tcode\twith\ta\tconnection\tpoint\tthat\tdoes not\tmake\tany\tassumption,\tjust\tfacts.\tAn\taction\thas\ta\tclear\tinput\tand provides\tyou\tthe\tinterface\tto\tgive\tan\tanswer\tfor\tit\tthrough\ta\tcallback.\n\nHow\tmany\ttimes\thave\tyou\tfound\tyour\tteam\tstruggling\twith\tthe\tclass structure\tof\tan\tapplication\tjust\tto\treuse\tcode\tin\ta\tnice\tway?\n\nSeneca\tfocuses\ton\tsimplicity.\tThe\tfact\tthat\twe\tare\tnot\tmodeling\tobjects,\n\nbut\tjust\tparts\tof\tsystems\tusing\tsmall\tportions\tof\tcode\tthat\tare\textremely cohesive\tand\tidempotent\tto\tobjects\tmakes\tour\tlife\tmuch\teasier.\n\nAnother\tway\thow\tSeneca\tmakes\tour\tlife\teasy\tis\tthrough\tthe\tplugability.\n\nIf\tyou\treview\tthe\tcode\tthat\twe\thave\tbeen\twriting\tin\tthis\tbook,\tthe\tfirst thing\tthat\twill\tbe\tspotted\tis\thow\tconvenient\tthe\tplugins\tare.\n\nThey\tprovide\tthe\tright\tlevel\tof\tencapsulation\tfor\ta\tbunch\tof\tactions\t(Does it\tlook\tsimilar\tto\ta\tclass?)\tthat\tare\tsomehow\trelated\tto\teach\tother.\n\nI\talways\ttry\tnot\tto\tover-engineer\tsolutions.\tIt\tis\treally\teasy\tto\tfall\tinto premature\tabstraction,\tpreparing\tthe\tcode\tfor\ta\tfuture\tthat\twe\tdon't\tknow whether\tit\tit\tis\tgoing\tto\thappen\tin\tthe\tmajority\tof\tthe\tcases.\n\nWe\tdon't\trealize\thow\tlong\twe\tspend\tmaintaining\tfeatures\tthat\thave\tbeen overdesigned\tand\tneed\tto\tbe\ttested\tevery\ttime\tsomeone\tchanges\tthe code\taround\tthem.\n\nSeneca\tavoids\t(or\tat\tleast\tdiscourages)\tthis\ttype\tof\tdesigns.\tThink\tabout Seneca\tactions\tas\ta\tsmall\tpiece\tof\tpaper\t(like\ta\tpost-it),\twhere\tyou\tneed to\twrite\twhat\thappened\tlast\tweek.\tYou\tneed\tto\tbe\tsmart\tabout\twhat\tto\tfit in\tthere,\tand\tpossibly,\tsplit\tit\tinto\tanother\tpost-it\tif\tthe\tcontent\tgets\tto dense.\n\nAnother\tpoint\twhere\tSeneca\tis\tgood\tis\tin\tconfigurability.\tAs\twe\thave seen\tbefore,\tSeneca\tcomes\twith\ta\tnumber\tof\tintegrations\tfor\tdata storage\tand\ttransport.\n\nAn\timportant\tside\tof\tSeneca\tis\tthe\ttransport\tprotocol.\tAs\twe\tknow\tby now,\tthe\tdefault\ttransport\tis\tcarried\tover\tTCP,\tbut\tcan\twe\tuse\ta\tmessage queue\tto\tdo\tit?\tThe\tstructure\tis\tshown\tas\tfollows:\n\nYes,\twe\tcan.\tIt\tis\talready\tdone\tand\tmaintained.\n\nNote\n\nThe\tfollowing\tURL\tis\ta\tplugin\tfor\tSeneca\tthat\tallows\tit\tto\tsend messages\tover\tRabbitMQ\tinstead\tof\tHTTP:\n\nhttps://github.com/senecajs/seneca-rabbitmq-transport\n\nIf\tyou\tlook\tinto\tthe\tcode\tof\tthe\tplugin\t(it\tlooks\treally\tcomplex,\tbut\tit\tis not),\tyou\tcan\tspot\twhere\tthe\tmagic\thappens\tin\tfew\tseconds:\n\nseneca.add({role:\t'transport',\thook:\t'listen',\ttype:\t 'rabbitmq'},\thook_listen_rabbitmq) \t\tseneca.add({role:\t'transport',\thook:\t'client',\ttype:\t 'rabbitmq'},\thook_client_rabbitmq)\n\nSeneca\tis\tusing\tSeneca\tactions\tto\tdelegate\tthe\ttransport\tof\tthe message.\tAlthough\tit\tlooks\ta\tbit\trecursive,\tit\tis\tbrilliant!\n\nOnce\tyou\tunderstand\thow\tSeneca\tand\tthe\ttransport\tprotocol\tchosen work,\tyou\tare\timmediately\tqualified\tto\twrite\ta\ttransport\tplugin\tfor\tSeneca.\n\nNote\n\nWhen\tI\tstarted\tlearning\tabout\tSeneca\tin\torder\tto\twrite\tthis\tbook,\tI also\twrote\ta\ttransport\tplugin\tto\tuse\tNServiceBus (http://particular.net/).\n\nNServiceBus\tis\tan\tinteresting\tidea,\tit\tallows\tyou\tto\tconnect\ta\tnumber\tof storages\tand\tAMPQ-compliant\tsystems\tand\tuse\tthem\tas\tclients.\tFor example,\twe\tcould\tbe\twriting\tmessages\tin\ta\tSQL\tServer\ttable\tand consuming\tthem\tfrom\ta\tqueue\tonce\tthey\tget\trouted\tthrough NServiceBus,\thaving\timmediate\tauditing\tcapabilities\ton\tthe\thistory\tof\tthe messages.\n\nWith\tsuch\tflexibility,\twe\tcould\tpotentially\twrite\ta\tplugin\tthat\tuses\tpretty much\tanything\tas\ta\ttransport\tprotocol.\n\nSeneca\tand\tpromises\n\nAll\tour\tcode\tfrom\tthe\tprevious\tchapters\tis\trelying\ton\tcallbacks.\tCallbacks are\tgood\tas\tfar\tas\tyour\tcode\tdoes\tnot\tnest\tthem\ton\tmore\tthan\tthree levels.\n\nHowever,\tthere\tis\tan\teven\tbetter\tway\tof\tmanaging\tthe\tasynchronous nature\tof\tJavaScript:\tpromises.\n\nTake\ta\tlook\tat\tthe\tfollowing\tcode:\n\n<!doctype\thtml> <html\tlang=\"en\"> <head> \t\t<meta\tcharset=\"utf-8\"> \t\t<title>promise\tdemo</title> <script\tsrc=\"https://code.jquery.com/jquery- 1.10.2.js\"></script> </head> <body>\n\n<button>Go</button> <p>Ready...</p> <div></div> <div></div> <div></div> <div></div>\n\n<script> var\teffect\t=\tfunction()\t{ \t\treturn\t$(\t\"div\"\t).fadeIn(\t800\t).delay(\t1200\t ).fadeOut(); };\n\n$(\t\"button\"\t).on(\t\"click\",\tfunction()\t{ \t\t$(\t\"p\"\t).append(\t\"\tStarted...\t\"\t);\n\n$.when(\teffect()\t).done(function()\t{ \t\t$(\t\"p\"\t).append(\t\"\tFinished!\t\"\t); \t\t}); }); </script>\n\n</body> </html>\n\nThe\tpreceding\tcode\tis\tan\texample\tof\tthe\tJQuery\tfragment\tusing promises.\n\nA\tpromise,\tby\tits\tdefinition\tis:\n\nA\tdeclaration\tor\tassurance\tthat\tone\twill\tdo\tsomething\tor\tthat\ta\tparticular thing\twill\thappen.\n\nThat\tis\texactly\tit.\tIf\tyou\tsee\tthe\tpreceding\tcode,\t$.when,\treturns\ta promise.\tWe\tdon't\tknow\thow\tlong\tthe\teffect\tfunction\twill\ttake,\tbut\twe\tcan guarantee\tthat\tonce\tit\tis\tready,\tthe\tfunction\tinside\tof\tdone\twill\tbe executed.\tIt\tlooks\tvery\tsimilar\tto\tcallbacks,\tbut\ttake\ta\tlook\tat\tthe following\tcode:\n\ncallhttp(url1,\tdata1).then(function(result1)\t{ \t\t\t//\tresult1\tis\tavailable\there \t\t\treturn\tcallhttp(url2,\tdata2); }).then(function(result2)\t{ \t\t\t//\tonly\tresult2\tis\tavailable\there \t\t\treturn\tcallhttp(url3,\tdata3); }).then(function(result3)\t{ \t\t\t//\tall\tthree\tare\tdone\tnow,\tfinal\tresult\tis\tin\t result3 });\n\nDon't\ttry\tto\texecute\tit,\tit\tis\tjust\ta\thypothetical\texample,\tbut\twhat\twe\tare doing\tin\tthere\tis\tchain\tpromises;\tand\tthat\tmakes\tthe\tcode\tvertical\tinstead of\tending\tup\tin\ta\tpyramid-shaped\tprogram,\twhich\tis\ta\tlot\tharder\tto\tread, as\tshown\tin\tthe\tfollowing\tdiagram:\n\nSeneca,\tby\tdefault,\tis\tnot\ta\tpromise-oriented\tframework,\tbut\t(there\tis always\ta\tbut)\tusing\tBluebird,\tone\tof\tthe\tmost\tfamous\tpromises\tlibraries in\tJavaScript,\twe\tcan\tpromisify\tSeneca,\tas\tfollows:\n\nvar\tPromise\t=\trequire('bluebird'); var\tseneca\t=\trequire('seneca')();\n\n//\tPromisify\tthe\t.act()\tmethod;\tto\tlearn\tmore\tabout\t this\ttechnique\tsee: //\t http://bluebirdjs.com/docs/features.html#promisificati on-on-steroids var\tact\t=\tPromise.promisify(seneca.act,\tseneca);\n\n//\tReturn\tno\terror\tand\ta\tsuccess\tmessage\tto\tillustrate\t a\tresolved\tpromise seneca.add({cmd:\t'resolve'},\tfunction\t(args,\tdone)\t{ \t\tdone(null,\t{message:\t\"Yay,\tI've\tbeen\tresolved!\"}); });\n\n//\tReturn\tan\terror\tto\tforce\ta\trejected\tpromise seneca.add({cmd:\t'reject'},\tfunction\t(args,\tdone)\t{ \t\tdone(new\tError(\"D'oh!\tI've\tbeen\trejected.\")); });\n\n//\tUse\tthe\tnew\tpromisified\tact()\twith\tno\tcallback act({cmd:\t'resolve'}) \t\t.then(function\t(result)\t{ \t\t//\tresult\twill\tbe\t{message:\t\"Yay,\tI've\tbeen\t resolved!\"}\tsince\t \t\t//\tits\tguaranteed\tto\tresolve \t\t}) \t\t.catch(function\t(err)\t{ \t\t//\tCatch\tany\terror\tas\tusual\tif\tit\twas\trejected \t\t});\n\nact({cmd:\t'reject'}) \t\t.then(function\t(result)\t{ \t\t//\tNever\treaches\there\tsince\twe\tthrow\tan\terror\ton\t purpose \t\t}) \t\t.catch(function\t(err)\t{ \t\t//\terr\twill\tbe\tset\twith\tmessage\t\"D'oh!\tI've\tbeen\t rejected.\" \t\t});\n\nThere\tare\ttwo\timportant\tdetails\tin\tthe\tpreceding\tcode:\n\nvar\tact\t=\tPromise.promisify(seneca.act,\tseneca);\n\nThis\tcreates\ta\tpromisified\tversion\tof\tthe\tact\tfunction\tand\tits\tuse,\tas follows:\n\nact({cmd:\t'reject'}) \t\t.then(function\t(result)\t{ \t\t//\tNever\treaches\there\tsince\twe\tthrow\tan\terror\ton\t purpose \t\t}) \t\t.catch(function\t(err)\t{ \t\t//\terr\twill\tbe\tset\twith\tmessage\t\"D'oh!\tI've\tbeen\t rejected.\" \t\t});\n\nAn\timportant\tdetail\tin\tthis\tlast\tfragment;\tinstead\tof\treceiving\ta\tcallback with\tthe\tfollowing\ttwo\tparameters:\n\nAn\terror The\tresults\n\nWe\tare\tchaining\tthe\tfollowing\ttwo\tmethods:\n\nThen:\tThis\tis\texecuted\twhen\tthe\tpromise\tis\tresolved Catch:\tThis\tis\texecuted\tif\tthere\tis\tan\terror\twhile\tresolving\tthe promise\n\nThis\ttype\tof\tconstructions\tallows\tus\tto\twrite\tthe\tfollowing\tcode:\n\nact({cmd:\t'timeout'}) \t\t.then(function\t(result)\t{ \t\t//\tNever\treaches\there\tsince\tthe\tgate\texecuter\ttimes\t out \t\t}) \t\t.catch(function\t(err)\t{ \t\t//\terr\twill\tbe\tset\twith\ta\ttimeout\terror\tthrown\tby\t the\tgate\texecuter \t\t});\n\nThis\tcode\tis\thandling\tsomething\tthat\twe\thave\tnever\ttalked\tabout\tbefore: the\tgate\texecutor\ttimeouts.\tIt\thappens\twhen\tSeneca\tcannot\treach\tthe destination\tin\tsome\tsituations,\tand\tit\tcan\tbe\teasily\thandled\twith\ta\n\npromise\tas\tshown\tearlier.\tThe\tthen\tpart\twould\tnever\tbe\texecuted\tas\tthe function\twill\tonly\tbe\tcalled\twhen\tthere\tis\tan\terror.\n\nThere\tare\ta\tfew\twell-consolidated\toptions\tin\tthe\tmarket\tnow\tfor\tpromises in\tJavaScript.\tNowadays,\tmy\tpreferred\tchoice\twould\tbe\tBluebird (https://github.com/petkaantonov/bluebird)\tbecause\tof\tits\tsimplicity.\tQ\tis another\toption\tused\tby\tAngularJS\t(one\tof\tthe\tmost\tpopular\tSPA frameworks),\tbut\tfor\tday-to-day\tuse,\tit\tlooks\tmore\tcomplicated\tthan Bluebird.\n\nDebugging\n\nDebugging\ta\tNode.js\tapplication\tis\tvery\tsimilar\tto\tdebugging\tany\tother application.\tIDEs\tlike\tWebStorm\tor\tIntelliJ\tprovide\ta\ttraditional debugger\twhere\tyou\tcan\tinstall\tbreakpoints\tand\tstop\tthe\texecution whenever\tthe\tapplication\thits\tthe\tgiven\tline.\n\nThis\tis\tperfect\tif\tyou\tbuy\ta\tlicense\tfor\tone\tof\tthe\tIDEs,\tbut\tthere\tis\ta\tfree alternative\tthat\twill\thave\ta\tvery\tsimiliar\tresult\tfor\tthe\tusers\tof\tGoogle Chrome,\tnode-inspector.\n\nNode-inspector\tis\tan\tnpm\tpackage\tthat\tpretty\tmuch\tenables\tthe\tChrome debugger\tto\tdebug\tNode.js\tapplications.\n\nLet's\tsee\thow\tit\tworks:\n\n1.\t First\tof\tall,\twe\tneed\tto\tinstall\tnode-inspector:\n\nnpm\tinstall\t–g\tnode-inspector\n\nThis\tshould\tadd\ta\tcommand\tto\tour\tsystem\tcalled\tnode-inspector.\tIf we\texecute\tit,\twe\tget\tthe\tfollowing\toutput:\n\nThat\tmeans\tour\tdebug\tserver\thas\tstarted.\n\n2.\t Now\twe\tneed\tto\trun\ta\tnode\tapplication\twith\ta\tspecial\tflag\tto\tindicate that\tit\tneeds\tto\tbe\tdebugged.\n\nLet's\ttake\ta\tsimple\tSeneca\tact\tas\tan\texample:\n\nvar\tseneca\t=\trequire(\t'seneca'\t)() seneca.add({role:\t'math',\tcmd:\t'sum'},\tfunction\t (msg,\trespond)\t{ \t\tvar\tsum\t=\tmsg.left\t+\tmsg.right \t\trespond(null,\t{answer:\tsum}) })\n\nseneca.add({role:\t'math',\tcmd:\t'product'},\t function\t(msg,\trespond)\t{ \t\tvar\tproduct\t=\tmsg.left\t*\tmsg.right \t\trespond(\tnull,\t{\tanswer:\tproduct\t}\t) })\n\nseneca.act({role:\t'math',\tcmd:\t'sum',\tleft:\t1,\t right:\t2},\tconsole.log) seneca.act({role:\t'math',\tcmd:\t'product',\tleft:\t3,\t right:\t4},\tconsole.log)\n\n3.\t Now,\tin\torder\tto\trun\tit\ton\tthe\tdebug\tmode,\texecute\tthe\tfollowing command:\n\nnode\tindex.js\t--debug-brk\n\nThe\tway\tto\taccess\tthe\tdebugger\tis\tthrough\tthe\tURL http://127.0.0.1:8080/?port=5858:\n\nI\tam\tsure\tthis\timage\tis\tvery\tfamiliar\tto\tevery\tdeveloper\tin\tthe\tworld:\tit\tis the\tChrome\tdebugger\tshowing\tour\tcode.\tAs\tyou\tcan\tsee\tin\tthe\tfirst\tline, the\tone\thighlighted\tin\tblue,\tthe\tapplication\tstopped\tin\tthe\tfirst\tinstruction so\tthat\twe\tcan\tplace\tthe\tbreakpoints\tby\tclicking\tthe\tline\tnumbers,\tas shown\tin\tthe\tfollowing\timage:\n\nAs\tyou\tcan\tsee\tin\tthe\tpreceding\timage,\twe\thave\tinstalled\ta\tbreakpoint\tin line\t9.\tNow\twe\tcan\tuse\tthe\tcontrol\tpanel\tto\tnavigate\tthrough\tthe\tcode and\tvalues\tof\tour\tvariables:\n\nThe\tcontrols\ton\tthe\ttop\tspeak\tfor\tthemselves\tif\tyou\tever\tdebugged\tan application:\n\nThe\tfirst\tbutton\tis\tcalled\tplay\tand\tit\tallows\tthe\tapplication\tto\trun\tto the\tnext\tbreakpoint Step\tover\texecutes\tthe\tnext\tline\tin\tthe\tcurrent\tfile Step\tinto\tgoes\tinto\tthe\tnext\tline,\tgetting\tdeeper\tin\tthe\tcall\tstack\tso that\twe\tcan\tsee\tthe\tcall\thierarchy Step\tout\tis\tthe\treverse\tof\tstep\tinto\n\nDisable\tbreakpoints\twill\tprevent\tthe\tprogram\tfrom\tstopping\tat\tthe breakpoints Pause\ton\texceptions,\tas\tits\tname\tindicates,\twill\tcause\tthe\tprogram to\tstop\ton\texceptions\t(it\tis\tvery\tuseful\twhen\ttrying\tto\tcatch\terrors)\n\nIf\twe\tclick\ton\tplay,\twe\tcan\tsee\thow\tthe\tscript\twill\tstop\tin\tline\t9\tin\tthe following\timage:\n\nAs\ta\tgood\tdebugger,\tit\twill\tlet\tus\tinspect\tthe\tvalue\tof\tour\tvariables\tby hovering\tthe\tcursor\tover\tthe\tvariable\tname.\n\nSummary\n\nThis\tchapter\thas\tbeen\tpretty\tintense.\tWe\thave\tgone\tthrough\ta\tlot\tof content\tthat\thelped\tus\tin\tbuilding\ta\tsmall\tmicroservices\tecosystem\tthat, when\torchestrated\ttogether,\twould\tfairly\twork\twell.\tWe\thave\tbeen\ta\tbit simplistic\tsome\ttimes,\tbut\tthe\tidea\tof\tthe\tbook\tis\tto\tindicate\tthe\tpower\tof the\tmicroservices-oriented\tsoftware.\tAt\tthis\tstage,\tI\twould\trecommend the\treader\tto\tstart\tperforming\tsome\ttesting\taround\tSeneca.\n\nThe\tdocumentation\ton\tthe\twebsite\tis\tquite\thelpful,\tand\tthere\tare\ta\tlot\tof examples\tto\tfollow.\n\nThere\tare\ta\tfew\tplugins\tfor\tstorage\tand\ttransport,\tas\twell\tas\tother\ttype\tof plugins\t(such\tas\tuser\tauthentication),\tthat\twould\tallow\tyou\tto\texperiment with\tdifferent\tfeatures\tof\tSeneca.\n\nWe\twill\tbe\ttalking\tmore\tabout\tsome\tof\tthem\tin\tthe\tfollowing\tchapters.\n\nChapter\t5.\tSecurity\tand Traceability\n\nSecurity\tis\tone\tof\tthe\tbiggest\tconcerns\tin\tsystems\tnowadays.\tThe amount\tof\tinformation\tleaked\tfrom\tbig\tcompanies\tis\tworrying,\tespecially because\t90%\tof\tthe\tinformation\tleaks\tcould\tbe\tmended\twith\tvery\tsmall actions\tby\tthe\tsoftware\tdevelopers.\tSomething\tsimilar\thappens\twith\tthe logging\tof\tevents\tand\tthe\ttraceability\tof\terrors.\tNo\tone\treally\tpays\ttoo much\tattention\tuntil\tsomeone\trequests\tthe\tlogs\tthat\tyou\tdon't\thave\tin order\tto\taudit\ta\tfailure.\tIn\tthis\tchapter,\twe\twill\tdiscuss\thow\tto\tmanage security\tand\tlogging\tso\tthat\tour\tsystem\tis\tsafe\tand\ttraceable,\twith\tthe help\tof\tthe\tfollowing\ttopics:\n\nInfrastructure\tlogical\tsecurity:\tWe\twill\tdiscuss\thow\tto\tsecure\tour software\tinfrastructure\tin\torder\tto\tprovide\tthe\tindustry\tstandard security\tlayer\tin\tour\tcommunications. Application\tsecurity:\tWe\twill\tintroduce\tthe\tcommon\ttechniques\tto secure\tour\tapplications.\tPractices\tsuch\tas\toutput\tencoding\tor\tinput validation\tare\tthe\tindustry\tstandard\tand\tthey\tcould\tsave\tus\tfrom\ta catastrophe. Traceability:\tBeing\table\tto\tfollow\tthe\trequests\taround\tour\tsystem\tis a\tmust\tin\tmicroservices\tarchitectures.\tWe\twill\tleverage\tthis\ttask\tto Seneca\tand\tlearn\thow\tto\tget\tthe\tinformation\tfrom\tthis\tfantastic framework. Auditing:\tEven\tthough\twe\tput\tour\tbest\tefforts\tin\tbuilding\ta\tsoftware, accidents\thappen.\tThe\tability\tto\trebuild\tthe\tsequence\tof\tcalls\tand see\texactly\twhat\thappened\tis\timportant.\tWe\twill\tdiscuss\thow\tto enable\tour\tsystem\tin\torder\tto\tbe\table\tto\trecover\tthe\trequired information.\n\nInfrastructure\tlogical\tsecurity\n\nInfrastructure\tsecurity\tis\tusually\tignored\tby\tsoftware\tengineers\tas\tit\tis completely\tdifferent\tfrom\ttheir\tarea\tof\texpertise.\tHowever,\tnowadays, and\tespecially\tif\tyour\tcareer\tis\tleaning\ttowards\tDevOps,\tit\tis\ta\tsubject",
      "page_number": 115
    },
    {
      "number": 5,
      "title": "Security\tand Traceability",
      "start_page": 177,
      "end_page": 203,
      "detection_method": "regex_chapter_title",
      "content": "that\tshould\tnot\tbe\tignored.\n\nIn\tthis\tbook,\twe\tare\tnot\tgoing\tto\tgo\tvery\tdeep\tinto\tthe\tinfrastructure security\tmore\tthan\tfew\trules\tof\tthumb\tto\tkeep\tyour\tmicroservices\tsafe.\n\nIt\tis\tstrongly\trecommended\tfor\tthe\treaders\tto\tread\tand\tlearn\tabout cryptography\tand\tall\tthe\timplications\taround\tthe\tusage\tof\tSSH,\twhich\tis one\tof\tthe\tmain\tresources\tfor\tkeeping\tcommunications\tsecure nowadays.\n\nSSH\t–\tencrypting\tthe\tcommunications\n\nIn\tany\torganization,\tthere\tis\ta\tstrict\tlist\tof\tpeople\twho\tcan\taccess\tcertain services.\tIn\tgeneral,\tthis\tauthentication\tfor\tthese\tservices\tis\tdone\tvia username\tand\tpassword,\tbut\tit\tcan\talso\tbe\tdone\tusing\ta\tkey\tto\tverify\tthe identity\tof\tthe\tuser.\n\nNo\tmatter\twhat\tauthentication\tmethod\tis\tused,\tthe\tcommunication\tshould always\tbe\tdone\tover\ta\tsecure\tchannel\tsuch\tas\tSSH.\n\nSSH\tstands\tfor\tSecure\tShell\tand\tit\tis\ta\tsoftware\tused\tto\taccess\tshells\tin remote\tmachines,\tbut\tit\tcan\talso\tbe\ta\tvery\thelpful\ttool\tto\tcreate\tproxies and\ttunnels\tto\taccess\tremote\tservers.\n\nLet's\texplain\thow\tit\tworks\tusing\tthe\tfollowing\tcommand:\n\nhomedavid:(develop)\tx\tssh\tdavid@192.168.0.1 The\tauthenticity\tof\thost\t'192.168.0.1\t(192.168.0.1)'\t can't\tbe\testablished. RSA\tkey\tfingerprint\tis\t SHA256:S22/A2/eqxSqkS4VfR1BrcDxNX1rmfM1JkZaGhrjMbk. Are\tyou\tsure\tyou\twant\tto\tcontinue\tconnecting\t(yes/no)?\t yes Warning:\tPermanently\tadded\t'192.168.0.1'\t(RSA)\tto\tthe\t list\tof\tknown\thosts. vagrant@192.168.0.1's\tpassword: Last\tlogin:\tMon\tJan\t25\t02:30:21\t2016\tfrom\t10.0.2.2 Welcome\tto\tyour\tvirtual\tmachine.\n\nIn\tthis\tcase,\tI\tam\tusing\tVagrant\tto\tfacilitate\tthe\tbuilding\tof\tvirtual machines.\tVagrant\tis\ta\tvery\tpopular\ttool\tto\tautomate\tdevelopment\n\nenvironments\tand\ttheir\twebsite\t(https://www.vagrantup.com/)\tconsists\tof useful\tinformation.\n\nIn\tthe\tfirst\tline,\twe\texecute\tthe\tssh\tdavid@192.168.0.1\tcommand.\tThis command\ttries\tto\topen\ta\tterminal\tas\tthe\tuser\tdavid\tin\tthe\t192.168.0.1 host.\n\nAs\tit\tis\tthe\tfirst\ttime\tthat\tthis\tcommand\tis\texecuted\tagainst\tthe\tmachine in\tthe\tIP\t192.168.0.1,\tour\tcomputer\twill\tnot\ttrust\tthe\tremote\tserver.\n\nThis\tis\tdone\tby\tmaintaining\ta\tfile\tcalled\tknown_hosts,\tunder\tthe homedavid/.ssh/known_hosts\tfolder\tin\tthis\tcase\t(it\twill\tdepend\ton\tthe user).\n\nThis\tfile\tis\ta\tlist\tof\thosts\twith\tthe\tcorresponding\tkey.\tAs\tyou\tcan\tsee,\tthe following\ttwo\tlines\texplain\tthat\tthe\thost\tcannot\tbe\ttrusted\tand\tpresent\tthe fingerprint\tof\tthe\tkey\theld\tby\tthe\tremote\tserver\tin\torder\tto\tverify\tit:\n\nThe\tauthenticity\tof\thost\t'192.168.0.1\t(192.168.0.1)'\t can't\tbe\testablished. RSA\tkey\tfingerprint\tis\t SHA256:S22/A2/eqxSqkS4VfR1BrcDxNX1rmfM1JkZaGhrjMbk.\n\nAt\tthis\tpoint,\tthe\tuser\tis\tsupposed\tto\tverify\tthe\tidentity\tof\tthe\tserver\tby checking\tthe\tkey.\tOnce\tthis\tis\tdone,\twe\tcan\tinstruct\tSSH\tto\tconnect\tto the\tserver,\twhich\twill\tresult\tin\tthe\tfollowing\tlog\tbeing\tprinted:\n\nWarning:\tPermanently\tadded\t'192.168.0.1'\t(RSA)\tto\tthe\t list\tof\tknown\thosts.\n\nNow,\tif\twe\tcheck\tour\tknown_hosts\tfile,\twe\tcan\tsee\tthat\tthe\tkey\thas\tbeen added\tto\tthe\tlist,\tas\tfollows:\n\nThis\tkey\tstored\tin\tthe\tknown_hosts\tfile\tis\tthe\tpublic\tkey\tof\tthe\tremote server.\n\nSSH\tuses\ta\tcryptography\talgorithm\tcalled\tRSA.\tThis\talgorithm\tis\tbuilt around\tthe\tconcept\tof\tasymmetric\tcryptography,\twhich\tis\tshown\tin\tthe following\timage:\n\nThe\tasymmetric\tcryptography\trelies\ton\ta\tset\tof\tkeys:\tone\tpublic\tand\tone private.\tAs\tthe\tname\tstates,\tthe\tpublic\tkey\tcan\tbe\tshared\twith\teveryone; whereas,\tthe\tprivate\tkey\thas\tto\tbe\tkept\tsecret.\n\nThe\tmessages\tencrypted\twith\tthe\tprivate\tkey\tcan\tonly\tbe\tdecrypted\twith the\tpublic\tkey\tand\tthe\tother\tway\taround\tso\tthat\tit\tis\talmost\timpossible (unless\tsomeone\tgets\tthe\tother\thalf\tof\tthe\tkey)\tto\tintercept\tand\tdecrypt\ta message.\n\nAt\tthis\tpoint,\tour\tcomputer\tknows\tthe\tpublic\tkey\tof\tthe\tserver\tand\twe\tare in\ta\tposition\tto\tstart\tan\tencrypted\tsession\twith\tthe\tserver.\tOnce\twe\tget the\tterminal,\tall\tthe\tcommands\tand\tresults\tof\tthese\tcommands\twill\tbe encrypted\tand\tsent\tover\tthe\twire.\n\nThis\tkey\tcan\talso\tbe\tused\tto\tconnect\tto\ta\tremote\tserver\twithout password.\tThe\tonly\tthing\twe\tneed\tto\tdo\tis\tgenerate\tan\tSSH\tkey\tin\tour machine\tand\tinstall\tit\tin\tthe\tserver\tin\ta\tfile\tcalled\tauthorized_keys\tunder the\t.ssh\tfolder,\twhere\tthe\tknown_hosts\tfile\tis.\n\nWhen\tworking\twith\tmicroservices,\tyou\tcan\tbe\tremotely\tlogged\tin\tto\tquite a\tfew\tdifferent\tmachines\tso\tthat\tthis\tapproach\tbecomes\tmore\tattractive. However,\twe\tneed\tto\tbe\tvery\tcareful\tabout\thow\twe\thandle\tthe\tprivate keys\tbecause\tif\ta\tuser\tleaks\tthat\tprivate\tkey,\tour\tinfrastructure\tcould\tbe compromised.\n\nApplication\tsecurity\n\nApplication\tsecurity\tis\tbecoming\tmore\tand\tmore\timportant.\tAs\tthe\tcloud is\tbecoming\tthe\tde-facto\tstandard\tfor\tinfrastructure\tin\tlarge\tcompanies, we\tcan't\trely\ton\tthe\tfact\tthat\tthe\tdata\tis\tconfined\tin\ta\tsingle\tdata\tcentre.\n\nUsually,\twhen\tsomeone\tstarts\ta\tnew\tbusiness,\tthe\tmain\tfocus\tis\tto\tbuild the\tproduct\tfrom\tthe\tfunctional\tpoint\tof\tview.\tSecurity\tis\tnot\tthe\tmain focus\tand\tusually\tgets\toverlooked.\n\nThis\tis\ta\tvery\tdangerous\tpractice\tand\twe\tare\tgoing\tto\tamend\tthat\tby letting\tthe\treader\tknow\tthe\tmain\tsecurity\tthreats\tthat\tcould\tcompromise our\tapplication.\n\nThe\tmain\tfour\tbig\tsecurity\tpoints\tto\tdevelop\tapplications\tin\ta\tsecure manner\tare\tas\tfollows:\n\nInjection Cross-site\tscripting Cross-site\trequest\tforgery\ttoken\tprotection Open\tredirects\n\nAt\tthe\tend\tof\tthis\tsection,\twe\twill\tbe\table\tto\tidentify\tthe\tmain vulnerabilities,\tbut\twe\twon't\tbe\tarmored\tagainst\ta\tmalicious\tattacker.\tIn general,\ta\tsoftware\tengineer\tshould\tbe\tup\tto\tdate\twith\tthe\tsecurity\tas much\tas\tthey\tare\tup\tto\tdate\twith\tnew\ttechnologies.\tNo\tmatter\thow\tgood the\tproduct\tyou\tbuild\tis,\tif\tit\tis\tnot\tsecure,\tsomeone\twill\tfind\tout\tand\ttake the\tadvantage\tof\tit.\n\nCommon\tthreats\t–\thow\tto\tbe\tup\tto\tdate\n\nAs\twe\tstated\tbefore,\tsecurity\tis\tan\tongoing\tsubject\tin\tapplication development.\tNo\tmatter\twhat\ttype\tof\tsoftware\tyou\tare\tbuilding,\tthere\twill always\tbe\tsecurity\timplications\taround\tit.\n\nThe\tbest\tway\tI've\tfound\tduring\tmy\tprofessional\tcareer\tto\tbe\tup\tto\tdate with\tsecurity\taround\tweb\tdevelopment\twithout\tbeing\ta\tfull-time\tdedicated security\tengineer\tis\tto\tfollow\tthe\tOWASP\tproject.\tOWASP\tstands\tfor\n\nOpen\tWeb\tApplication\tSecurity\tProject\tand\tthey\tproduce\tquite\tan interesting\tdocument\t(among\tothers)\ton\ta\tyearly\tbasis\tcalled\tOWASP Top\t10.\n\nNote\n\nOWASP\tTop\t10\twas\tfirst\tpublished\tin\t2003\tand\tits\tgoal\tis\tto\traise awareness\tin\tthe\tdevelopment\tcommunity\tabout\tthe\tmost\tcommon threats\tin\tapplication\tdevelopment.\n\nIn\tthe\tprevious\tsection,\twe\tidentified\tthe\tfour\tmain\tsecurity\tissues\tthat\ta software\tdeveloper\tcan\tface\tand\tall\tof\tthem\tare\tmentioned\tin\tthe following\tsections.\n\nInjection\n\nInjection\tis,\tby\tfar,\tthe\tmost\tdangerous\tattack\tthat\twe\tcould\tbe\texposed to.\tSpecifically,\ta\tSQL\tinjection\tis\tthe\tmost\tcommon\tform\tof\tinjection\tthat affects\tapplications\tand\tit\tconsists\tof\tan\tattacker\tforcing\ta\tSQL\tcode\tin one\tof\tour\tapplication\tqueries,\tleading\tto\ta\tdifferent\tquery\tthat\tcould compromise\tthe\tdata\tof\tour\tcompany.\n\nThere\tare\tother\ttypes\tof\tinjections,\tbut\twe\tare\tgoing\tto\tfocus\ton\tSQL injection,\tas\tpretty\tmuch\tevery\tapplication\tin\tthe\tmodern\tworld\tuses\ta relational\tdatabase.\n\nSQL\tinjection\tconsists\tof\tthe\tinjection\tor\tmanipulation\tof\tSQL\tqueries\tin our\tapplication\tthrough\tthe\tinput\tfrom\tnon-validated\tsources,\tsuch\tas\ta web\tform\tor\tany\tother\tdata\tsource\twith\tarbitrary\tinput\tof\ttext.\n\nLet's\tconsider\tthe\tfollowing\texample:\n\nSELECT\t*\tFROM\tusers\tWHERE\tusername\t=\t'username'\tAND\t password\t=\t'password'\n\nTip\n\nNever\tstore\tpasswords\tin\tplain\tin\tthe\tdatabase.\tAlways\thash\tand\tsalt them\tto\tavoid\trainbow-table\tattacks.\tThis\tis\tjust\tan\texample.\n\nThis\tquery\twill\tgive\tus\tthe\tuser\tthat\tcorresponds\tto\ta\tgiven\tname\tand password.\tIn\torder\tto\tbuild\tthe\tquery\tfrom\tthe\tclient's\tinput,\twe\tcan consider\tdoing\tsomething\tsimilar\tto\tthe\tfollowing\tcode\tas\ta\tgood\tidea:\n\nvar\texpress\t=\trequire('express'); var\tapp\t=\texpress(); var\tmysql\t\t\t\t\t\t=\trequire('mysql');\n\nvar\tconnection\t=\tmysql.createConnection({ \t\thost\t\t\t\t\t:\t'localhost', \t\tuser\t\t\t\t\t:\t'me', \t\tpassword\t:\t'secret', \t\tdatabase\t:\t'test_db' });\n\napp.get('/login',\tfunction(req,\tres)\t{ \t\tvar\tusername\t=\treq.param(\"username\"); \t\tvar\tpassword\t=\treq.param(\"password\");\n\nconnection.connect(); \t\tvar\tquery\t=\t\"SELECT\t*\tFROM\tusers\tWHERE\tusername\t=\t'\"\t +\tusername\t+\t\"'\tAND\tpassword\t=\t'\"\t+\tpassword\t+\t\"'\"; \t\tconnection.query(query,\tfunction(err,\trows,\tfields)\t { \t\t\t\tif\t(err)\tthrow\terr; \t\t\t\tres.send(rows); \t\t}); \t\tconnection.end(); });\n\napp.listen(3000,\tfunction()\t{ \t\tconsole.log(\"Application\trunning\tin\tport\t3000.\"); });\n\nAt\tfirst\tsight,\tit\tlooks\tlike\tan\teasy\tprogram\tthat\taccesses\tthe\tdatabase called\ttest_db\tand\tissues\ta\tquery\tto\tcheck\twhether\tthere\tis\ta\tuser\tthat matches\tthe\tusername\tand\tpassword\tand\trenders\tit\tback\tto\tthe\tclient\tso that\tif\twe\topen\tthe\tbrowser\tand\ttry\tto\tbrowse\tto\tthe http://localhost:3000/login?username=david&password=mypassword\tURL, the\tbrowser\twill\trender\ta\tJSON\tobject\twith\tthe\tresult\tof\tthe\tfollowing query:\n\nSELECT\t*\tFROM\tusers\tWHERE\tusername\t=\t'david'\tAND\t password\t=\t'mypassword'\n\nNothing\tstrange\tyet,\tbut\twhat\thappens\tif\tthe\tcustomer\ttries\tto\thack\tus?\n\nTake\ta\tlook\tat\tthe\tfollowing\tinput:\n\nhttp://localhost:3000/login?username='\tOR\t1=1\t-- &password=mypassword\n\nAs\tyou\tcan\tsee,\tthe\tquery\tgenerated\tby\tit\tis\tthe\tfollowing\tcode:\n\nSELECT\t*\tFROM\tusers\tWHERE\tusername\t=\t''\tOR\t1=1\t--\tAND\t password\t=\t'mypassword'\n\nIn\tSQL,\tthe\t--\tcharacter\tsequence\tis\tused\tto\tcomment\tthe\trest\tof\tthe\tline so\tthat\tthe\teffective\tquery\twould\tbe\tas\tfollows:\n\nSELECT\t*\tFROM\tusers\tWHERE\tusername=''\tOR\t1=1\n\nThis\tquery\treturns\tthe\tfull\tlist\tof\tusers,\tand\tif\tour\tsoftware\tis\tusing\tthe result\tof\tthis\tquery\tto\tresolve\twhether\tthe\tuser\tshould\tbe\tlogged\tin\tor not,\twe\tare\tin\tsome\tserious\tproblems.\tWe\thave\tjust\tgranted\taccess\tto our\tsystem\tto\tsomeone\twho\tdoes\tnot\teven\tknow\ta\tvalid\tusername.\n\nThis\tis\tone\tof\tthe\tmany\texamples\ton\thow\tSQL\tinjection\tcan\taffect\tus.\n\nIn\tthis\tcase,\tit\tis\tpretty\tobvious\tthat\twe\tare\tconcatenating\tuntrusted\tdata (coming\tfrom\tthe\tuser)\tinto\tour\tquery,\tbut\tbelieve\tme,\twhen\tthe\tsoftware gets\tmore\tcomplicated,\tit\tis\tnot\talways\teasy\tto\tidentify.\n\nA\tway\tto\tavoid\tSQL\tinjection\tis\tthrough\tthe\tusage\tof\tprepared statements.\n\nInput\tvalidation\n\nApplications\tinteract\twith\tusers\tmainly\tthrough\tforms.\tThese\tforms usually\tcontain\tfree\ttext\tinput\tfields\tthat\tcould\tlead\tto\tan\tattack.\n\nThe\teasiest\tway\tto\tprevent\tcorrupted\tdata\tfrom\tgetting\tinto\tour\tserver\tis\n\nthrough\tinput\tvalidation,\twhich\tas\tthe\tname\tsuggests,\tconsists\tof validating\tthe\tinput\tfrom\tthe\tuser\tto\tavoid\tthe\tsituation\tdescribed\tearlier.\n\nThere\tare\ttwo\ttypes\tof\tinput\tvalidation,\tas\tfollows:\n\nWhite\tlisting Black\tlisting\n\nBlack\tlisting\tis\ta\tdangerous\ttechnique.\tIn\tmajority\tof\tcases,\ttrying\tto define\twhat\tis\tincorrect\tin\tthe\tinput\ttakes\ta\tlot\tmore\teffort\tthan\tsimply defining\twhat\twe\texpect.\n\nThe\trecommended\tapproach\tis\t(and\twill\talways\tbe)\tto\twhite\tlist\tthe\tdata coming\tfrom\tthe\tuser,\tvalidating\tit\tthrough\tthe\tuse\tof\ta\tregular expression:\twe\tknow\thow\ta\tphone\tnumber\tlooks\tlike,\twe\talso\tknow\thow a\tusername\tshould\tlook\tlike,\tand\tso\ton.\n\nInput\tvalidation\tis\tnot\talways\teasy.\tIf\tyou\thave\tever\tcome\tacross\tthe validation\tof\tan\te-mail,\tyou\twill\tknow\twhat\tI\tam\ttalking\tabout:\tthe\tregular expression\tto\tvalidate\tan\te-mail\tis\tanything\tbut\tsimple.\n\nThe\tfact\tthat\tthere\tis\tnot\tan\teasy\tway\tto\tvalidate\tsome\tdata\tshould\tnot restrict\tus\tfrom\tdoing\tit\tas\tthe\tomission\tof\tinput\tvalidation\tcould\tlead\tto\ta serious\tsecurity\tflaw.\n\nInput\tvalidation\tis\tnot\tthe\tsilver\tbullet\tfor\tSQL\tinjections,\tbut\tit\talso\thelps with\tother\tsecurity\tthreats\tsuch\tas\tcross-site\tscripting.\n\nIn\tthe\tquery\tfrom\tthe\tprevious\tsection,\twe\tdo\tsomething\tquite dangerous:\tconcatenate\tuser\tinput\tinto\tour\tquery.\n\nOne\tof\tthe\tsolutions\tcould\tbe\tto\tuse\tsome\tsort\tof\tescaping\tlibrary\tthat will\tsanitize\tthe\tinput\tfrom\tthe\tuser,\tas\tfollows:\n\napp.get('/login',\tfunction(req,\tres)\t{ \t\tvar\tusername\t=\treq.param(\"username\"); \t\tvar\tpassword\t=\treq.param(\"password\");\n\nconnection.connect(); \t\tvar\tquery\t=\t\"SELECT\t*\tFROM\tusers\tWHERE\tusername\t=\t'\"\t +\tconnection.escape(username)\t+\t\"'\tAND\tpassword\t=\t'\"\t+\n\nconnection.escape(password)\t+\t\"'\"; \t\tconnection.query(query,\tfunction(err,\trows,\tfields)\t { \t\t\t\tif\t(err)\tthrow\terr; \t\t\t\tres.send(rows); \t\t}); \t\tconnection.end(); });\n\nIn\tthis\tcase,\tthe\tmysql\tlibrary\tused\tprovides\ta\tsuite\tof\tmethods\tto\tescape strings.\tLet's\tsee\thow\tit\tworks:\n\nvar\tmysql\t=\trequire('mysql'); var\tconnection\t=\tmysql.createConnection({ \t\thost:\t'localhost', \t\tusername:\t'root', \t\tpassword:\t'root' });\n\nconsole.log(connection.escape(\"'\tOR\t1=1\t--\"))\n\nThe\tsmall\tscript\tfrom\tearlier\tescapes\tthe\tstring\tprovided\tas\tusername\tin the\tprevious\texample,\tthe\tresult\tis\t\\'\tOR\t1=1\t--.\n\nAs\tyou\tcan\tsee,\tthe\tescape()\tmethod\thas\treplaced\tthe\tdangerous characters,\tsanitizing\tthe\tinput\tfrom\tthe\tuser.\n\nCross-site\tscripting\n\nCross-site\tscripting,\talso\tknown\tas\tXSS,\tis\ta\tsecurity\tvulnerability\tthat mainly\taffects\tweb\tapplications.\tIt\tis\tone\tof\tthe\tmost\tcommon\tsecurity issues\tand\tthe\timplications\tcan\tbe\thuge\tfor\tthe\tcustomer\tas\tpotentially, someone\tcould\tsteal\tthe\tuser\tidentity\twith\tthis\tattack.\n\nThe\tattack\tis\tan\tinjection\tcode\tput\tinto\ta\tthird-party\twebsite\tthat\tcould steal\tdata\tfrom\tthe\tclient's\tbrowser.\tThere\tare\ta\tfew\tways\tof\tdoing\tit,\tbut by\tfar,\tthe\tmost\tcommon\tis\tby\tunescaped\tinput\tfrom\tthe\tclient.\n\nIn\tfew\twebsites\ton\tthe\tInternet,\tusers\tcan\tadd\tcomments\tcontaining arbitrary\tinput.\tThis\tarbitrary\tinput\tcan\tcontain\tscript\ttags\tthat\tload\ta JavaScript\tfrom\ta\tremote\tserver\tthat\tcan\tsteal\tthe\tsession\tcookie\t(or other\ttypes\tof\tvaluable\tinformation),\tletting\tthe\tattacker\treplicate\tthe\tuser\n\nsession\ton\ta\tremote\tmachine.\n\nThere\tare\ttwo\tmain\ttypes\tof\tXSS\tattacks:\tpersistent\tand\tnon- persistent.\n\nThe\tpersistent\ttype\tof\tXSS\tconsists\tof\tstoring\tthe\tXSS\tattack\tby\tcrafting a\tparticular\tstring\tof\ttext\tthat\tresolves\tinto\tthe\tattack\tonce\tit\tis\tdisplayed to\tthe\tuser\tin\tthe\twebsite.\tThis\tcode\tcould\tbe\tinjected\tvia\tan\tarbitrary input\ttext\tthat\tis\tstored\tin\tthe\tdatabase\t(such\tas\ta\tcomment\tin\ta\tforum).\n\nThe\tnon-persistent\ttype\tof\tXSS\tis\twhen\tthe\tattack\tis\tinserted\tinto\ta non-persistent\tpart\tof\tthe\tapplication\tdue\tto\tbad\tdata\thandling.\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\tscreenshot:\n\nAs\tyou\tcan\tsee,\twe\thave\tsearched\tfor\ta\tbook\t(this\tbook)\tin http://www.amazon.co.uk/.\tIt\tdoes\tnot\tproduce\tany\toutput\t(as\tthe\tbook\tis not\tpublished\tyet),\tbut\tit\tspecifies\tthat\tYour\tsearch\t\"microservices nodejs\"\tdid\tnot\tmatch\tany\tproducts,\twhich\tis\tsomehow\tusing\tthe input\tfrom\tthe\tweb\tbrowser\tas\toutput.\tEven\tmore,\twhen\tI\tclicked\ton search,\tAmazon\tredirected\tme\tto\tthe\tfollowing\tURL:\n\nhttp://www.amazon.co.uk/s/ref=nb_sb_noss?url=search- alias%3Daps&field-keywords=microservices+nodejs\n\nWe\tknow\tAmazon\tis\tsecure,\tbut\tif\tit\twas\tsensible\tto\tXSS\tattacks,\twe could\thave\tmodified\tthe\tvalue\tof\tthe\tfield-keywords\tparameter\tto\tcraft\ta request\tthat\tinjected\ta\tscript\ttag\tin\tthe\tcontent,\tleading\tto\tthe\tattacker being\table\tto\tsteal\tthe\tsession\tcookie\tthat\tcould\tresult\tin\tsome\tserious problems\tfor\tthe\twebsite.\n\nOutput\tencoding\n\nA\tway\tto\tprotect\tagainst\tthis\tattack\tis\toutput\tencoding.\tWe\thave\tdone\tit before,\twhen\twe\tused\tconnection.escape()\tin\tthe\tInput\tvalidation\tsection of\tthis\tchapter.\tIn\tfairness,\twe\tshould\tbe\tvalidating\tall\tthe\tdata\tentered from\tthe\tuser\tand\tencoding\tall\tthe\toutputs\tthat\tcome\tfrom\tthird\tparties. This\tincludes\tthe\tinput\tentered\tby\tthe\tuser,\tas\twell\tas\tsources\tof information\tcoming\tfrom\toutside\tof\tthe\tsystem.\n\nWhen\tnarrowing\tthe\tproblem\tto\tweb\tdevelopment,\twe\thave\tto\tbe\taware of\tthe\tthree\tdifferent\tareas\twhere\toutput\tencoding\tis\tneeded:\n\nCSS JavaScript HTML\n\nThe\tmost\tproblematic\ttwo\tare\tJavaScript\tand\tHTML,\twhere\tan\tattacker could\teasily\tsteal\tinformation\twithout\ttoo\tmuch\teffort.\n\nGenerally,\tno\tmatter\twhich\tframework\twe\tuse\tfor\tbuilding\tour\tapp,\tit always\thas\tfunctions\tto\tencode\tthe\toutput.\n\nCross-site\trequest\tforgery\n\nCross-site\trequest\tforgery\t(CSRF)\tis\tthe\treverse\tof\tcross-site\trequest scripting.\tIn\tcross-site\trequest\tscripting,\tthe\tproblem\tis\tin\tthe\tclient trusting\tthe\tdata\tcoming\tfrom\tthe\tserver.\tWith\tcross-site\trequest\tforgery, the\tproblem\tis\tthat\tthe\tserver\ttrusts\tthe\tdata\tcoming\tfrom\tthe\tclient.\n\nAfter\tstealing\tthe\tsession\tcookie,\tthe\tattacker\tcan\tnot\tonly\tsteal information\tfrom\tthe\tuser,\tbut\tcan\talso\tmodify\tthe\tinformation\tof\tthe\n\naccount\tassociated\twith\tthe\tcookie.\n\nThis\tis\tdone\tby\tposting\tthe\tdata\tto\tthe\tserver\tvia\tHTTP\trequests.\n\nHTTP\tclassifies\tits\trequests\tin\tmethods.\tA\tmethod\tis\tbasically\tused\tto specify\twhat\tis\tthe\toperation\tto\tbe\tcarried\tby\tthe\trequest.\tThe\tmost interesting\tfour\tmethods\tare\tthe\tfollowing\tones:\n\nGET:\tThis\tgets\tthe\tdata\tfrom\tthe\tserver.\tIt\tshould\tnot\tmodify\tany persistent\tdata. POST:\tThis\tcreates\ta\tresource\tin\tthe\tserver. PUT:\tThis\tupdates\ta\tresource\tin\tthe\tserver. DELETE:\tThis\tdeletes\ta\tresource\tfrom\tthe\tserver.\n\nThere\tare\tmore\tmethods\t(such\tas\tPATCH\tor\tCONNECT),\tbut\tlet's\tfocus\ton these\tfour.\tAs\tyou\tcan\tsee,\tthree\tof\tthese\tfour\tmethods\tmodify\tdata\tfrom the\tserver,\tand\ta\tuser\twith\ta\tvalid\tsession\tcould\tpotentially\tsteal\tdata, create\tpayments,\torder\tgoods,\tand\tso\ton.\n\nA\tway\tto\tavoid\tthe\tcross-site\trequest\tforgery\tattack\tis\tby\tprotecting\tthe POST,\tPUT\tand\tDELETE\tendpoints\twith\ta\tcross-site\trequest\ttoken.\n\nTake\ta\tlook\tat\tthe\tfollowing\tHTML\tform:\n\n<form\taction=\"register\"\tmethod=\"post\"> \t\t<input\tname=\"email\"\ttype=\"text\"\t> \t\t<input\tname=\"password\"\ttype=\"password\"\t> <form>\n\nThis\tform\tdescribes\ta\tperfectly\tvalid\tsituation:\ta\tuser\tregistering\ton\tour website;\tvery\tsimple,\tbut\tstill\tvalid\tand\tflawed.\n\nWe\tare\tspecifying\ta\tURL\tand\tthe\tlist\tof\texpected\tparameters\tso\tthat\tan attacker\tcan\tregister\thundreds\tor\tthousands\tof\taccounts\twithin\ta\tspan\tof minutes,\twith\ta\tsmall\tscript\tthat\tissues\ta\tPOST\trequest\twith\tthe\ttwo parameters\t(email\tand\tpassword)\tin\tthe\tbody.\n\nNow,\tlook\tat\tthe\tfollowing\tform:\n\n<form\taction=\"register\"\tmethod=\"post\">\n\n<input\tname=\"email\"\ttype=\"text\"\t> \t\t<input\tname=\"password\"\ttype=\"password\"\t/> \t\t<input\tname=\"csrftoken\"\ttype=\"hidden\"\t value=\"as7d6fasd678f5a5sf5asf\"\t> <form>\n\nYou\tcan\tsee\tthe\tdifference:\tthere\tis\tan\textra\thidden\tparameter\tcalled csrftoken.\n\nThis\tparameter\tis\ta\trandom\tstring\tthat\tis\tgenerated\tevery\ttime\ta\tform\tis rendered\tso\tthat\twe\tcan\tadd\tthis\textra\tparameter\tto\tevery\tform.\n\nOnce\tthe\tform\tis\tsubmitted,\tthe\tcsrftoken\tparameter\tis\tvalidated\tto\tonly let\tgo\tthrough\tthe\trequests\twith\ta\tvalid\ttoken\tand\tgenerate\ta\tnew\ttoken to\tbe\trendered\ton\tthe\tpage\tagain.\n\nOpen\tredirects\n\nSometimes,\tour\tapplication\tmight\tneed\tto\tredirect\tthe\tuser\tto\ta\tcertain URL.\tFor\texample,\twhen\thitting\ta\tprivate\tURL\twithout\ta\tvalid authentication,\tthe\tuser\twill\tusually\tbe\tredirected\tto\tthe\tlogin\tpage:\n\nhttp://www.mysite.com/my-private-page\n\nThis\tcould\tresult\tinto\ta\tredirect\tto\tthe\tfollowing:\n\nhttp://www.mysite.com/login?redirect=/my-private-page\n\nThis\tsounds\tlegit.\tThe\tuser\tis\tsent\tto\tthe\tlogin\tpage,\tand\tonce\the provides\ta\tvalid\tset\tof\tcredentials,\tit\tis\tredirected\tto\t/my-private-page.\n\nWhat\thappens\tif\tsomeone\ttries\tto\tsteal\tthe\taccount\tof\tour\tuser?\n\nLook\tat\tthe\tfollowing\trequest:\n\nhttp://www.mysite.com/login?redirect=http://myslte.com\n\nThis\tis\ta\tcrafted\trequest\tthat\twill\tredirect\tthe\tuser\tto\tmyslte.com\tinstead of\tmysite.com\t(note\tthe\tl\tinstead\tof\ti).\n\nSomeone\tcould\tmake\tmyslte.com\tlook\tlike\tthe\tlogin\tpage\tof\tmysite.com\n\nand\tsteal\tyour\tuser's\tpassword\tand\tusername\tby\tdistributing\tthe preceding\tURL\tin\tthe\tsocial\tmedia\tas\tthe\tusers\twill\tbe\tredirected\tto\ta malicious\tpage.\n\nThe\tsolution\tfor\tthe\tpreceding\tproblem\tis\tquite\tsimple:\tdon't\tredirect\tthe user\tto\tuntrusted\tthird-party\twebsites.\n\nAgain,\tthe\tbest\tway\tof\tdoing\tsuch\ttask\tis\twhite\tlisting\tthe\ttarget\thosts\tfor redirects.\tBasically,\twe\tdon't\tlet\tour\tsoftware\tredirect\tour\tcustomers\tto unknown\twebsites.\n\nEffective\tcode\treviews\n\nOne\tof\tthe\tmost\teffective\tways\tto\treduce\tsecurity\tflaws\tin\tour applications\tis\tthrough\ta\tsystematic\tand\tinformed\tcode\treview\tprocess. The\tproblem\twith\tcode\treviews\tis\tthat\tthey\talways\tend\tup\tbeing\ta\tdump area\tfor\topinions\tand\tpersonal\tpreferences\tthat\tusually\tnot\tonly\twon't improve\tthe\tquality\tof\tthe\tcode,\tbut\twill\talso\tlead\tto\tlast\tminute\tchanges that\tcould\texpose\tvulnerabilities\tin\tour\tapplication.\n\nA\tdedicated\tstage\tin\tthe\tproduct\tdevelopment\tlife\tcycle\tfor\ta\tsecurity code\treview\thelps\tto\tdrastically\treduce\tthe\tamount\tof\tbugs\tdelivered\tto production.\n\nThe\tproblem\tthat\tthe\tsoftware\tengineers\thave\tis\tthat\ttheir\tmind\tis\ttrained to\tbuild\tthings\tthat\twork\twell,\tbut\tthey\tdon't\thave\tthe\tmindset\tto\tfind defects,\tespecially\taround\tthe\tthings\tthat\tthey\tbuild.\tThis\tis\twhy\tyou should\tnot\tbe\ttesting\tyour\town\tcode\t(any\tfurther\tthan\tthe\ttest\tcarried\ton when\tdeveloping),\tand\teven\tless,\tsecurity\ttesting\tyour\tapplication.\n\nHowever,\twe\tusually\twork\tin\tteams\tand\tthat\tenables\tus\tto\treview someone\telse's\tcode,\tbut\twe\thave\tto\tdo\tit\tin\tan\teffective\tmanner.\n\nCode\treviews\trequire\tas\tmuch\tbrain\tpower\tas\tneeded\tto\twrite\tsoftware, especially\tif\tyou\tare\treviewing\ta\tcomplex\tcode.\tYou\tshould\tnever\tspend more\tthan\ttwo\thours\treviewing\tthe\tsame\tfunctionality,\totherwise important\tflaws\twill\tbe\tmissed\tand\tattention\tto\tdetail\twill\tdecrease\tto\ta worrying\tlevel.\n\nThis\tis\tnot\ta\tbig\tproblem\tin\tmicroservices-based\tarchitectures\tas\tthe functionality\tshould\tbe\tsmall\tenough\tto\tbe\tread\tin\ta\treasonable\tperiod\tof time,\tespecially\tif\tyou\ttalked\tto\tthe\tauthor\tabout\twhat\the\twas\ttrying\tto build.\n\nYou\tshould\talways\tfollow\ta\ttwo\tphase\treview,\tas\tfollows:\n\nReview\tthe\tcode\tquickly\tto\tget\tthe\tbig\tpicture:\thow\tit\tworks,\twhat technology\tit\tuses\tthat\tyou\tare\tnot\tfamiliar\twith,\tdoes\tit\tdo\twhat\tit\tis supposed\tto\tdo,\tand\tso\ton Review\tthe\tcode\tfollowing\ta\tchecklist\tof\titems\tto\tlook\tfor\n\nThis\tlist\tof\titems\thas\tto\tbe\tdecided\tupfront\tand\tdepends\ton\tthe\tnature\tof the\tsoftware\tthat\tyour\tcompany\tis\tbuilding.\n\nUsually,\tthe\tlist\tof\titems\tto\tcheck\taround\tthe\tcode\tsecurity\tconcerns during\ta\tcode\treview\tis\tquite\tbig,\tbut\twe\tcan\tnarrow\tit\tdown\tto\tthe following\tcomponents:\n\nIs\tall\tthe\tinput\tvalidated/encoded\twhen\tapplicable? Is\tall\tthe\toutput\tencoded,\tincluding\tlogs? Do\twe\tprotect\tendpoints\twith\tcross-site\trequest\tforgery\ttokens? Are\tall\tthe\tuser\tcredentials\tencrypted\tor\thashed\tin\tthe\tdatabase?\n\nIf\twe\tcheck\tthis\tlist,\twe\twill\tbe\table\tto\tidentify\tthe\tbiggest\tissues\taround security\tin\tour\tapps.\n\nTraceability\n\nTraceability\tis\textremely\timportant\tin\tthe\tmodern\tinformation\tsystems.\tIt is\ta\tdelicate\tmatter\tin\tmicroservices\tthat\tis\tgracefully\tsolved\tin\tSeneca, making\tthe\trequests\teasy\tto\tfollow\taround\tour\tsystem\tso\tthat\twe\tcan audit\tthe\tfailure.\n\nLogging\n\nSeneca\tis\tpretty\tgood\twith\tthe\tlogging.\tThere\tare\tso\tmany\toptions\tthat can\tbe\tconfigured\tin\tSeneca\tin\torder\tto\tget\tthe\trequired\tinformation about\thow\teverything\tis\tworking\t(if\tit\tis\tworking).\n\nLet's\tsee\thow\tlogging\tworks\twith\ta\tsmall\tapplication:\n\nvar\tseneca\t=\trequire(\"seneca\")();\n\nseneca.add({cmd:\t\"greeter\"},\tfunction(args,\tcallback){ \t\tcallback(null,\t{message:\t\"Hello\t\"\t+\targs.name}); });\n\nseneca.act({cmd:\t\"greeter\",\tname:\t\"David\"},\t function(err,\tresult)\t{ \t\tconsole.log(result); });\n\nThis\tis\tthe\tsimplest\tSeneca\tapplication\tthat\tcan\tbe\twritten.\tLet's\trun\tit\tas follows:\n\nseneca\t\tnode\tindex.js 2016-02-01T09:55:40.962Z\t 3rhomq69cbe0/1454579740947/84217/-\tINFO\thello\t Seneca/1.0.0/3rhomq69cbe0/1454579740947/84217/- {\tmessage:\t'Hello\tDavid'\t}\n\nThis\tis\tthe\tresult\tof\trunning\tthe\tapp\twith\tthe\tdefault\tlogging\tconfiguration. Aside\tfrom\tthe\tconsole.log()\tmethod\tthat\twe\thave\tused\tin\tthe\tcode, there\tis\tsome\tinternal\tinformation\tabout\tSeneca\tbeing\tlogged. Sometimes,\tyou\tmight\twant\tto\tonly\tlog\twhat\tyour\tapplication\tis\tproducing\n\nso\tthat\tyou\tcan\tdebug\tthe\tapplication\twithout\tall\tthe\tnoise.\tIn\tthis\tcase, just\trun\tthe\tfollowing\tcommand:\n\nseneca\t\tnode\tindex.js\t--seneca.log.quiet {\tmessage:\t'Hello\tDavid'\t}\n\nHowever,\tsometimes,\tthere\tare\tweird\tbehaviors\tin\tthe\tsystem\t(or\teven\ta bug\tin\tthe\tframeworks\tused)\tand\tyou\twant\tto\tget\tall\tthe\tinformation about\twhat\tis\thappening.\tSeneca\tsupports\tthat\tas\twell,\tas\tshown\tin\tthe following\tcommand:\n\nseneca\t\tnode\tindex.js\t--seneca.log.print\n\nThe\tpreceding\tcommand\twill\tprint\tan\tendless\tamount\tof\tinformation\tthat might\tnot\tbe\thelpful.\n\nIn\torder\tto\treduce\tthe\tamount\tof\tlogging\tproduced\tby\tSeneca,\tthere\tis\ta fine-grain\tcontrol\tin\twhat\tgets\tlogged\tinto\tthe\toutput.\tLet's\ttake\ta\tlook\tat the\tfollowing\tlines:\n\n2016-02-01T10:00:07.191Z\t dyy9ixcavqu4/1454580006885/85010/-\tDEBUG\tregister\t install\ttransport\t{exports:[transport/utils]}\tseneca- 8t1dup 2016-02-01T10:00:07.305Z\t dyy9ixcavqu4/1454580006885/85010/-\tDEBUG\tregister\tinit\t seneca-y9os9j 2016-02-01T10:00:07.305Z\t dyy9ixcavqu4/1454580006885/85010/-\tDEBUG\tplugin\t seneca-y9os9j\tDEFINE\t{} 2016-02-01T10:00:07.330Z\t dyy9ixcavqu4/1454580006885/85010/-\tDEBUG\tact\troot$\t\t\t\t\t\t\t IN\to5onzziv9i7a/b7dtf6v1u9sq\tcmd:greeter\t {cmd:greeter,name:David}\tENTRY\t(mnb89)\t-\t-\t-\n\nThey\tare\trandom\tlines\tfrom\ta\tlog\toutput\ton\tthe\tpreceding\tcode\texample, but\tit\twill\tgive\tus\tuseful\tinformation:\tthese\tentries\tare\tdebug-level\tlog lines\tfor\tdifferent\tactions\t(such\tas\tplugin,\tregister,\tand\tact)\ton\tthe Seneca\tframework.\tIn\torder\tto\tfilter\tthem,\tSeneca\tprovides\ta\tcontrol\tover what\tlevels\tor\tactions\tdo\twe\twant\tto\tsee.\tConsider\tthe\tfollowing\tfor example:\n\nnode\tindex.js\t--seneca.log=level:INFO\n\nThis\twill\tonly\toutput\tthe\tlogs\trelated\tto\tthe\tINFO\tlevel:\n\nseneca\t\tnode\tindex.js\t--seneca.log=level:INFO 2016-02-04T10:39:04.685Z\t q6wnh8qmm1l3/1454582344670/91823/-\tINFO\thello\t Seneca/1.0.0/q6wnh8qmm1l3/1454582344670/91823/- {\tmessage:\t'Hello\tDavid'\t}\n\nYou\tcan\talso\tfilter\tby\taction\ttype,\twhich\tis\tquite\tinteresting.\tWhen\tyou are\tworking\twith\tmicroservices,\tknowing\tthe\tchain\tof\tevents\tthat happened\tin\ta\tflow\tis\tone\tof\tthe\tfirst\tthings\tthat\tyou\tneed\tto\tlook\tinto\tin order\tto\taudit\ta\tfailure.\tWith\tthis\tcontrol\tover\tthe\tlogging\tthat\tSeneca gives\tus,\tit\tis\tas\teasy\tas\texecuting\tthe\tfollowing\tcommand:\n\nnode\tindex.js\t--seneca.log=type:act\n\nThis\twill\tproduce\tthe\tfollowing\toutput:\n\nAs\tyou\tcan\tsee,\tall\tthe\tpreceding\tlines\tcorrespond\tto\tthe\tact\ttype,\tand even\tmore,\tif\twe\tfollow\tthe\toutput\tof\tthe\tcommand\tfrom\ttop\tto\tbottom, we\texactly\tknow\tthe\tsequence\tof\tevents\tto\twhich\tSeneca\treacted\tand their\torder.\n\nTracing\trequests\n\nTracing\trequests\tis\talso\ta\tvery\timportant\tactivity,\tand\tsometimes,\tit\tis even\ta\tlegal\trequirement,\tespecially\tif\tyou\twork\tin\tthe\tworld\tof\tfinance. Again,\tSeneca\tis\tfantastic\tat\ttracing\trequests.\tFor\tevery\tcall,\tSeneca generates\ta\tunique\tidentifier.\tThis\tidentifier\tcan\tbe\ttraced\tacross\tall\tthe paths\tto\twhere\tthe\tcall\tis\tgoing\tto,\tas\tfollows:\n\nvar\tseneca\t=\trequire(\"seneca\")();\n\nseneca.add({cmd:\t\"greeter\"},\tfunction(args,\tcallback){ \t\tconsole.log(this.fixedargs['tx$']); \t\tcallback(null,\t{message:\t\"Hello\t\"\t+\targs.name}); }); seneca.act({cmd:\t\"greeter\",\tname:\t\"David\"},\t function(err,\tresult)\t{ \t\tconsole.log(this.fixedargs['tx$']); });\n\nHere,\twe\tare\tlogging\ta\tdictionary\tthat\tcontains\tthe\ttransaction\tID\tin Seneca\tto\tthe\tterminal.\tSo,\tif\twe\texecute\tit,\twe\twill\tget\tthe\tfollowing output:\n\n2016-02-04T10:58:07.570Z\t zl0u7hj3hbeg/1454583487555/95159/-\tINFO\thello\t Seneca/1.0.0/zl0u7hj3hbeg/1454583487555/95159/- 3jlroj2n91da 3jlroj2n91da\n\nYou\tcan\tsee\thow\tall\tthe\trequests\tin\tSeneca\tare\ttraced:\tthe\tframework assigns\tan\tID\tand\tit\tgets\tpropagated\tacross\tendpoints.\tIn\tthis\tcase,\tall our\tendpoints\tare\tin\tthe\tlocal\tmachine,\tbut\tif\twe\tdistribute\tthem\tin different\tmachines,\tthe\tID\twill\tstill\tbe\tthe\tsame.\n\nWith\tthis\tunique\tID,\twe\twill\tbe\table\tto\treconstruct\tthe\tjourney\tof\tthe customer\tdata\tin\tour\tsystem,\tand\tordering\tthe\trequests\twith\tthe associated\ttimestamp,\twe\tcan\tget\tan\taccurate\tpicture\tof\twhat\tthe\tuser was\tdoing,\thow\tmuch\ttime\tdid\tevery\taction\ttake,\twhat\tare\tthe\tpossible problems\tassociated\twith\tdelays,\tand\tso\ton.\tUsually,\tthe\tlogging combined\twith\tcircuit\tbreakers\toutput\tinformation\tallows\tthe\tengineers\tto solve\tissues\twithin\ta\tvery\treduced\ttime\tframe.\n\nAuditing\n\nUp\ttill\tnow,\twe\thave\tbeen\tusing\tconsole.log()\tto\toutput\tthe\tdata\tinto\tthe logs.\tThis\tis\ta\tbad\tpractice.\tIt\tbreaks\tthe\tformat\tof\tthe\tlogs\tand\tthrows the\tcontent\tto\tthe\tstandard\toutput.\n\nAgain,\tSeneca\tcomes\tto\tthe\trescue:\n\nvar\tseneca\t=\trequire(\"seneca\")();\n\nseneca.add({cmd:\t\"greeter\"},\tfunction(args,\tcallback){ \t\tthis.log.warn(this.fixedargs['tx$']); \t\tcallback(null,\t{message:\t\"Hello\t\"\t+\targs.name}); });\n\nseneca.act({cmd:\t\"greeter\",\tname:\t\"David\"},\t function(err,\tresult)\t{ \t\tthis.log.warn(this.fixedargs['tx$']); });\n\nLet's\tsee\twhat\tSeneca\tproduces\tas\toutput:\n\nseneca\t\tnode\tindex.js 2016-02-04T11:17:28.772Z\t wo10oa299tub/1454584648758/98550/-\tINFO\thello\t Seneca/1.0.0/wo10oa299tub/1454584648758/98550/- 2016-02-04T11:17:29.156Z\t wo10oa299tub/1454584648758/98550/-\tWARN\t-\t-\tACT\t 02jlpyiux70s/9ca086d19x7n\tcmd:greeter\t9ca086d19x7n 2016-02-04T11:17:29.157Z\t wo10oa299tub/1454584648758/98550/-\tWARN\t-\t-\tACT\t 02jlpyiux70s/9ca086d19x7n\tcmd:greeter\t9ca086d19x7n\n\nAs\tyou\tcan\tsee,\twe\tare\tnow\toutputting\tthe\ttransaction\tID\tusing\tthe logger.\tWe\thave\tproduced\ta\tWARN\tmessage\tinstead\tof\ta\tsimple\tconsole dump.\tFrom\tnow\ton,\twe\tcan\tuse\tSeneca\tlog\tfilters\tto\thide\tthe\toutput\tof our\tactions\tin\torder\tto\tfocus\ton\twhat\twe\tare\ttrying\tto\tfind.\n\nSeneca\tprovides\tthe\tfollowing\tfive\tlevels\tof\tlogging:\n\nDEBUG:\tThis\tis\tused\tto\tdebug\tapplications\twhen\tyou\tare developing\tthem\tand\talso\ttrace\tproblems\tin\tproduction\tsystems. INFO:\tThis\tlog\tlevel\tis\tused\tto\tproduce\timportant\tmessages\tabout events\tsuch\tas\ta\ttransaction\thas\tstarted\tor\tcompleted. WARN:\tThis\tis\tthe\twarning\tlevel.\tWe\tuse\tit\twhen\tsomething\tbad happens\tin\tthe\tsystem,\tbut\tit\tis\tnot\tcritical,\tthe\tuser\tusually\tdoes\tnot get\taffected;\thowever,\tit\tis\tan\tindication\tthat\tsomething\tis\tgoing\tin the\twrong\tway. ERROR:\tThis\tis\tused\tto\tlog\terrors.\tGenerally,\tthe\tuser\tgets\taffected by\tit\tand\tit\talso\tinterrupts\tthe\tflow.\n\nFATAL:\tThis\tis\tthe\tmost\tcatastrophic\tlevel.\tIt\tis\tonly\tused\twhen\ta non-recoverable\terror\thas\toccurred\tand\tthe\tsystem\twon't\tbe\table\tto function\tnormally.\n\nA\tway\tto\tproduce\tlogs\tin\tdifferent\tlevels\tis\tto\tuse\tthe\tassociated functions.\tAs\twe\thave\tseen\tearlier,\twe\tcalled\tthis.log.warn()\tto\tlog\ta warning.\tIf\twe\tcall\tthe\tthis.log.fatal()\tmethod,\twe\twill\tbe\tlogging\ta fatal\terror,\tand\tsame\twith\tthe\tother\tlevels.\n\nTip\n\nTry\tto\tadjust\tthe\tlogs\tin\tyour\tapplication\tas\ta\tpart\tof\tthe\tdevelopment process\tor\tyou\twill\tregret\tthe\tlack\tof\tinformation\twhen\tsomething\tbad occurs\tin\tproduction.\n\nIn\tgeneral,\tINFO,\tDEBUG,\tand\tWARN\twill\tbe\tthe\tmost\tused\tlog\tlevels.\n\nHTTP\tcodes\n\nHTTP\tcodes\tare\toften\tignored,\tbut\tthey\tare\ta\treally\timportant mechanism\tto\tstandardize\tresponses\tfrom\tremote\tservers.\n\nWhen\ta\tprogram\t(or\tuser)\tissues\ta\trequest\tto\ta\tserver,\tthere\tare\ta\tfew things\tthat\tcould\thappen,\tas\tfollows:\n\nIt\tcould\tbe\tsuccessful It\tcould\tfail\tvalidation It\tcould\tproduce\ta\tserver\terror\n\nAs\tyou\tcan\tsee,\tthe\tpossibilities\tare\tendless.\tThe\tproblem\tthat\twe\tnow have\tis\tthat\tHTTP\twas\tcreated\tfor\tthe\tcommunication\tbetween machines.\tHow\tdo\twe\thandle\tthe\tfact\tthat\tmachines\twill\tbe\treading\tthese codes?\n\nHTTP\tsolved\tthis\tproblem\tin\ta\tvery\telegant\tway:\tevery\tsingle\trequest has\tto\tbe\tresolved\twith\tan\tHTTP\tcode\tand\tthese\tcodes\thave\tranges\tthat indicate\tthe\tnature\tof\tthe\tcode.\n\n1xx\t–\tinformational\n\nThe\tcodes\tin\tthe\t100-199\trange\tare\tpurely\tinformational.\tThe\tmost interesting\tcode\tin\tthis\trange\tis\tthe\t102\tcode.\tThis\tcode\tis\tused\tto specify\tthat\tan\toperation\tis\thappening\tin\tthe\tbackground\tand\tmight\ttake some\ttime\tto\tcomplete.\n\n2xx\t–\tsuccess\tcodes\n\nSuccess\tcodes\tare\tused\tto\tindicate\ta\tcertain\tlevel\tof\tsuccess\tin\tthe HTTP\trequest.\tIt\tis\tthe\tmost\tcommon\t(and\tdesired)\tcodes.\n\nThe\tmost\tcommon\tcodes\tin\tthis\trange\tare\tas\tfollows:\n\n200:\tSuccess:\tThis\tcode\tindicates\ta\tfull\tsuccess.\tNothing\twent wrong\teven\tremotely. 201:\tCreated:\tThis\tcode\tis\tused\tmainly\tfor\tREST\tAPIs\twhen\tthe client\trequests\tto\tcreate\ta\tnew\tentity\tin\tthe\tserver. 203:\tNon-authoritative\tinformation:\tThis\tcode\tis\tintended\tto\tbe used\twhen,\twhile\trouting\tthe\trequest\tthrough\ta\ttransforming\tproxy, the\torigin\tresponds\twith\ta\t200. 204:\tNo\tContent:\tThis\tis\ta\tsuccessful\tcode,\tbut\tthere\tis\tno\tcontent coming\tback\tfrom\tthe\tserver.\tSometimes,\tAPIs\treturns\t200,\teven\tif there\tis\tno\tcontent. 206:\tPartial\tContent:\tThis\tcode\tis\tused\tfor\tpaginated\tresponses.\tA header\tis\tsent,\tspecifying\ta\trange\t(and\tan\toffset)\tthat\tthe\tclient\twill accept.\tIf\tthe\tresponse\tis\tbigger\tthan\tthe\trange,\tthe\tserver\twill\treply with\t206,\tindicating\tthat\tthere\tis\tmore\tdata\tto\tfollow.\n\n3xx\t–\tredirection\n\nThe\tcodes\tin\tthe\t300\tto\t399\trange\tindicate\tthat\tthe\tclient\tmust\ttake\tsome additional\tactions\tto\tcomplete\tthe\trequest.\n\nThe\tmost\tcommon\tcodes\tin\tthis\trange\tare\tdescribed\tas\tfollows:\n\n301:\tMoved\tpermanently:\tThis\tstatus\tcode\tis\tindicating\tthat\tthe resource\tthat\tthe\tclient\twas\ttrying\tto\tget\thas\tbeen\tmoved permanently\tto\tanother\tlocation.\n\n302:\tFound:\tThis\tcode\tindicates\tthat\tthe\tuser\tis\trequired\tto\tperform\ta temporary\tredirect\tfor\tsome\treason,\tbut\tthe\tbrowsers\tstarted implementing\tthis\tcode\tas\t303\tSee\tOther.\tThis\tlead\tto\tthe introduction\tof\tthe\t303\tand\t307\tTemporary\tredirect\tcodes\tto disambiguate\tthe\toverlap\tof\tbehavior. 308\tPermanent\tRedirect:\tThis\tcode,\tas\tthe\tname\tindicates,\tis\tused to\tspecify\ta\tpermanent\tredirect\tfor\ta\tresource.\tIt\tcould\tbe\tconfused with\t301,\tbut\tthere\tis\ta\tsmall\tdifference,\tthe\t308\tcode\tdoes\tnot\tallow the\tHTTP\tmethod\tto\tchange.\n\n4xx\t–\tclient\terrors\n\nThe\tcodes\tin\tthe\t400\tto\t499\trange\trepresent\terrors\tgenerated\tby\tthe client.\tThey\tindicate\tthat\tthere\tis\ta\tproblem\twith\tthe\trequest.\tThis\trange is\tparticularly\timportant\tas\tit\tis\tthe\tway\tthat\tHTTP\tservers\thave\tto indicate\tthe\tclients\tthat\tsomething\tis\twrong\twith\ttheir\trequest.\n\nThe\tcommon\tcodes\tin\tthis\trange\tare\tas\tfollows:\n\n400\tBad\tRequest:\tThis\tcode\tindicates\tthat\tthe\trequest\tfrom\tthe\tuser is\tsyntactically\tincorrect.\tThere\tcould\tbe\tparameters\tmissing\tor some\tof\tthe\tvalues\tdidn't\tpass\tvalidation. 401\tUnauthorized:\tThis\tcode\trepresents\ta\tlack\tof\tauthentication\tof the\tclient.\tUsually,\ta\tvalid\tlogin\twill\tfix\tthis\tproblem. 403\tForbidden:\tThis\tis\tsimilar\tto\t401,\tbut\tin\tthis\tcase,\tit\tis\tindicating that\tthe\tuser\tdoes\tnot\thave\tenough\tprivileges. 404\tNot\tFound:\tThis\tmeans\tthat\tthe\tresource\tis\tnot\tfound\tin\tthe server.\tThis\tis\tthe\terror\tthat\tyou\tget\twhen\tyou\tnavigate\tto\ta\tpage that\tdoes\tnot\texist.\n\n5xx\t–\tserver\terrors\n\nThis\trange\tindicates\tthat\tthere\thas\tbeen\ta\tprocessing\terror\tin\tthe\tserver. When\ta\t5xx\tcode\tis\tissued,\tit\tmeans\tthat\tthere\twas\tsome\tsort\tof\tproblem in\tthe\tserver\tand\tit\tcannot\tbe\tfixed\tfrom\tthe\tclient.\n\nSome\tof\tthe\tcodes\tin\tthis\trange\tare\tas\tfollows:\n\n500\tInternal\tServer\tError:\tThis\tmeans\tthat\tan\terror\thas\toccurred\n\nin\tthe\tsoftware\tin\tthe\tserver.\tThere\tis\tno\tmore\tinformation\tdisclosed. 501\tNot\tImplemented:\tThis\terror\toccurs\twhen\ta\tclient\thits\tan endpoint\tthat\thas\tnot\tbeen\timplemented\tyet. 503\tService\tunavailable:\tThis\tcode\tis\tissued\twhen\tthe\tserver\tis\tnot available\tfor\tsome\treason,\teither\tan\texcess\tof\tthe\tload\tor\tthe\tserver is\tdown.\n\nWhy\tHTTP\tcodes\tmatter\tin\tmicroservices\n\nThe\tpopular\tsaying\tdon't\treinvent\tthe\twheel\tis\tone\tof\tmy\tfavorite principles\twhen\tbuilding\tsoftware.\tHTTP\tcodes\tare\ta\tstandard,\tso everybody\tunderstands\tthe\tconsequences\tof\tthe\tdifferent\tcodes.\n\nWhen\tbuilding\tmicroservices,\tyou\talways\tneed\tto\tkeep\tin\tmind\tthat\tyour system\twill\tbe\tinteracting\twith\tproxies,\tcaches,\tand\tother\tservices\tthat already\tspeak\tHTTP\tso\tthat\tthey\tcan\treact\taccording\tto\tthe\tresponse from\tthe\tservers.\n\nThe\tbest\texample\tof\tthis\tis\tthe\tcircuit-breaker\tpattern.\tNo\tmatter\thow\tyou implement\tit\tand\twhat\tsoftware\tyou\tuse,\ta\tcircuit\tbreaker\thas\tto understand\tthat\tan\tHTTP\trequest\twith\t500\tcode\tis\tan\terror,\tso\tit\tcan open\tthe\tcircuit\taccordingly.\n\nIn\tgeneral,\tit\tis\tgood\tpractice\tto\tkeep\tthe\tcodes\tof\tyour\tapplication\tas accurate\tas\tpossible\tas\tit\twill\tbenefit\tyour\tsystem\tin\tthe\tlong\trun.\n\nSummary\n\nIn\tthis\tchapter,\tyou\thave\tlearned\thow\tto\tbuild\tsecure\tsoftware\t(and\tnot only\tmicroservices),\talthough\tit\tis\ta\tsubject\tbig\tenough\tto\twrite\ta\tfull book\ton\tit.\tThe\tproblem\twith\tsecurity\tis\tthat\tcompanies\tusually\tsee investing\tin\tsecurity\tas\tburning\tmoney,\tbut\tthat\tis\tfar\tfrom\treality.\tI\tam\ta big\tfan\tof\tthe\t80-20\trule:\t20%\tof\ttime\twill\tgive\tyou\t80%\tof\tfeatures\tand the\t20%\tof\tmissing\tfeatures\twill\trequire\t80%\tof\tthe\ttime.\n\nIn\tsecurity,\twe\treally\tshould\tbe\taiming\tfor\t100%\tcoverage;\thowever,\tthe 80%\tshown\tin\tthis\tchapter\twill\tcover\tmajority\tof\tthe\tcases.\tAnyway,\tas\tI mentioned\tbefore,\ta\tsoftware\tengineer\tshould\tbe\tup\tto\tdate\twith\tsecurity as\ta\tflaw\tin\tthe\tsecurity\tof\tan\tapplication\tis\tthe\teasiest\tway\tto\tkill\ta company.\n\nWe\thave\talso\tbeen\ttalking\tabout\ttraceability\tand\tlogging,\tone\tof\tthe\tmost ignored\tsubjects\tin\tthe\tmodern\tsoftware\tengineering\tthat\tare\tbecoming more\tand\tmore\timportant,\tespecially\tif\tyour\tsoftware\tis\tbuilt\tusing\ta microservices\tapproach.\n\nChapter\t6.\tTesting\tand Documenting\tNode.js Microservices\n\nUntil\tnow,\tall\tthat\twe\thave\tdone\tis\tdevelop\tmicroservices\tand\tdiscuss\tthe frameworks\taround\tthe\tprocess\tof\tbuilding\tsoftware\tcomponents.\tNow\tit is\ttime\tto\ttest\tall\tof\tthem.\tTesting\tis\tthe\tactivity\tof\tvalidating\tthe\tsoftware that\thas\tbeen\tbuilt.\tValidating\tis\ta\tvery\tbroad\tterm.\tIn\tthis\tchapter,\twe\tare going\tto\tlearn\thow\tto\ttest\tmicroservices,\tnot\tonly\tfrom\tthe\tfunctional point\tof\tview,\tbut\twe\twill\talso\tlearn\thow\tto\ttest\tthe\tperformance\tof\tour applications,\tas\twell\tas\tother\taspects\tsuch\tas\tintegration\twith\tdifferent modules.\tWe\twill\talso\tbuild\ta\tproxy\tusing\tNode.js\tto\thelp\tus\tto\tinspect the\tinputs\tand\toutputs\tof\tour\tservices\tso\tthat\twe\tcan\tvalidate\tthat\twhat we\thave\tdesigned\tis\tactually\thappening\tand,\tonce\tagain,\treassure\tthe versatility\tof\ta\tlanguage,\tsuch\tas\tJavaScript,\tto\tquickly\tprototype features.\n\nIt\tis\talso\tnowadays\ta\ttrend\tto\trelease\tfeatures\twith\tan\tA/B\ttest,\twhere\twe only\tenable\tthe\tfeatures\tfor\tcertain\ttype\tof\tusers,\tand\tthen\twe\tcollect metrics\tto\tsee\thow\tthe\tchanges\tto\tour\tsystem\tare\tperforming.\tIn\tthis chapter,\twe\twill\tbuild\ta\tmicroservice\tthat\tis\tgoing\tto\tgive\tus\tthe\tcapability of\trolling\tout\tfeatures\tin\ta\tcontrolled\tway.\n\nOn\tthe\tother\thand,\twe\tare\tgoing\tto\tdocument\tour\tapplication,\twhich unfortunately,\tis\ta\tforgotten\tactivity\tin\ttraditional\tsoftware\tdevelopment:\tI haven't\tfound\ta\tsingle\tcompany\twhere\tthe\tdocumentation\tcaptures\t100% the\tinformation\tneeded\tby\tnew\tdevelopers.\n\nWe\twill\tcover\tthe\tfollowing\ttopics\tin\tthis\tchapter:\n\nFunctional\ttesting:\tIn\tthis\tsection,\twe\twill\tlearn\thow\tto\ttest microservices\tand\twhat\ta\tgood\ttesting\tstrategy\tis.\tWe\twill\talso\tget\tto study\ta\ttool\tcalled\tPostman\tto\tmanually\ttest\tour\tAPIs,\tas\twell\tas build\ta\tproxy\twith\tNode.js\tto\tspy\tour\tconnections. Documenting\tmicroservices:\tWe\twill\tlearn\thow\tto\tuse\tSwagger\tto document\tour\tmicroservices\tusing\tthe\topen\tAPI\tstandard.\tWe\twill",
      "page_number": 177
    },
    {
      "number": 6,
      "title": "Testing\tand Documenting\tNode.js Microservices",
      "start_page": 204,
      "end_page": 254,
      "detection_method": "regex_chapter_title",
      "content": "also\tgenerate\tthe\tcode\tfrom\tthe\tYAML\tdefinition\tusing\tan\topen source\ttool.\n\nFunctional\ttesting\n\nTesting\tis\tusually\ta\ttime-consuming\tactivity\tthat\tdoes\tnot\tget\tall\tthe required\tattention\twhile\tbuilding\ta\tsoftware.\n\nThink\tabout\thow\ta\tcompany\tevolves:\n\n1.\t Someone\tcomes\tup\twith\tan\tidea. 2.\t A\tfew\tengineers/product\tpeople\tbuild\tthe\tsystem. 3.\t The\tcompany\tgoes\tto\tmarket.\n\nThere\tis\tno\ttime\tto\ttest\tmore\tthan\tthe\tminimal\trequired\tmanual\ttesting. Especially,\twhen\tsomeone\treads\ton\tthe\tInternet\tthat\ttesting\tdone\tright could\ttake\tup\tto\t40%\tof\tyour\tdevelopment\ttime,\tand\tonce\tagain,\tthe common\tsense\tfails.\n\nAutomation\tis\tgood\tand\tunit,\tintegration,\tand\tend-to-end\ttests\tare\ta\tform of\tautomation.\tBy\tletting\ta\tcomputer\ttest\tour\tsoftware,\twe\tare\tdrastically cutting\tdown\tthe\thuman\teffort\trequired\tto\tvalidate\tour\tsoftware.\n\nThink\tabout\thow\tthe\tsoftware\tis\tdeveloped.\tEven\tthough\tour\tcompany likes\tto\tclaim\tthat\twe\tare\tagile,\tthe\ttruth\tis\tthat\tevery\tsingle\tsoftware project\thas\tsome\tlevel\tof\titerative\tdevelopment,\tand\ttesting\tis\ta\tpart\tof every\tcycle,\tbut\tgenerally,\tit\tis\toverlooked\tin\tfavour\tof\tdelivering\tnew features.\n\nBy\tautomating\tthe\tmajority\t(or\ta\tbig\tchunk)\tof\tthe\ttesting,\twe\tare\tsaving money,\tas\tshown\tin\tthe\tfollowing\tdiagram:\n\nCosts\tand\tIterations\n\nTesting\tis\tactually\ta\tcost\tsaver\tif\tis\tdone\tright,\tand\tthe\tkey\tis\tdoing\tit right,\twhich\tis\tnot\talways\teasy.\tHow\tmuch\ttesting\tis\ttoo\tmuch\ttesting? Should\twe\tcover\tevery\tsingle\tcorner\tof\tour\tapplication?\tDo\twe\treally need\tdeep\tperformance\ttesting?\n\nThese\tquestions\tusually\tlead\tto\ta\tdifferent\tstream\tof\topinions,\tand\tthe interesting\tthing\tis\tthat\tthere\tis\tnot\ta\tsingle\tsource\tof\ttruth.\tIt\tdepends\ton the\tnature\tof\tyour\tsystem.\n\nIn\tthis\tchapter,\twe\tare\tgoing\tto\tlearn\ta\tset\tof\textensive\ttesting techniques,\twhich\tdoes\tnot\tmean\tthat\twe\tshould\tbe\tincluding\tall\tof\tthem in\tour\ttest\tplan,\tbut\tat\tleast\twe\twill\tbe\taware\tof\tthe\ttesting methodologies.\n\nIn\tthe\tpast\tseven\tyears,\tRuby\ton\tRails\thas\tcreated\ta\tmassive\ttrend towards\ta\tnew\tparadigm,\tcalled\tTest-driven\tdevelopment\t(TDD),\tup\tto a\tpoint\tthat,\tnowadays,\tmajority\tof\tthe\tnew\tdevelopment\tplatforms\tare built\twith\tTDD\tin\tmind.\n\nPersonally,\tI\tam\tnot\ta\tfierce\tadopter\tof\tTDD,\tbut\tI\tlike\tto\ttake\tthe\tgood parts.\tPlanning\tthe\ttest\tbefore\tthe\tdevelopment\thelps\tto\tcreate\tmodules with\tthe\tright\tlevel\tof\tcohesion\tand\tdefine\ta\tclear\tand\teasy-to-test\n\ninterface.\tIn\tthis\tchapter,\twe\twon't\tcover\tthe\tTDD\tin\tdepth,\tbut\twe\twill mention\tit\ta\tfew\ttimes\tand\texplain\thow\tto\tapply\tthe\texposed\ttechniques to\ta\tTDD\ttest\tplan.\n\nThe\tpyramid\tof\tautomated\ttesting\n\nHow\tto\tlay\tdown\tyour\ttesting\tplan\tis\ta\ttricky\tquestion.\tNo\tmatter\twhat you\tdo,\tyou\twill\talways\tend\tup\twith\tthe\tsensation\tthat\tthis\tis\tcompletely wrong.\n\nBefore\tdiving\tinto\tthe\tdeep,\tlet's\tdefine\tthe\tdifferent\ttype\tof\ttests\tthat\twe are\tgoing\tto\tbe\tdealing\twith\tfrom\tthe\tfunctional\tpoint\tof\tview,\tand\twhat should\tthey\tbe\tdesigned\tfor.\n\nUnit\ttests\n\nA\tunit\ttest\tis\ta\ttest\tthat\tcovers\tindividual\tparts\tof\tthe\tapplication\twithout taking\tinto\taccount\tthe\tintegration\twith\tdifferent\tmodules.\tIt\tis\talso\tcalled white\tbox\ttesting\tas\tthe\taim\tis\tto\tcover\tand\tverify\tas\tmany\tbranches\tas possible.\n\nGenerally,\tthe\tway\tto\tmeasure\tthe\tquality\tof\tour\ttests\tis\tthe\ttest\tcoverage and\tit\tis\tmeasured\tin\tpercentage.\tIf\tour\tcode\tspans\tover\tten\tbranches and\tour\ttests\tcover\tseven\tbranches,\tour\tcode\tcoverage\tis\t70%.\tThis\tis\ta good\tindication\tof\thow\treliable\tour\ttest\tcoverage\tis.\tHowever,\tit\tcould\tbe misleading\tas\tthe\ttests\tcould\tbe\tflawed,\tor\teven\tthough\tall\tthe\tbranches are\ttested,\ta\tdifferent\tinput\twould\tcause\ta\tdifferent\toutput\tthat\twasn't captured\tby\ta\ttest.\n\nIn\tunit\ttests,\tas\twe\tdon't\tinteract\twith\tother\tmodules,\twe\twill\tbe\tmaking\ta heavy\tuse\tof\tmocks\tand\tstubs\tin\torder\tto\tsimulate\tresponses\tfrom\tthird- party\tsystems\tand\tcontrol\tthe\tflow\tto\thit\tthe\tdesired\tbranch.\n\nIntegration\ttests\n\nIntegration\ttests,\tas\tthe\tname\tsuggests,\tare\tthe\ttests\tdesigned\tto\tverify the\tintegration\tof\tour\tmodule\tin\tthe\tapplication\tenvironment.\tThey\tare\tnot designed\tto\ttest\tthe\tbranches\tof\tour\tcode,\tbut\tbusiness\tunits,\twhere\twe\n\nwill\tbe\tsaving\tthe\tdata\tinto\tdatabases,\tcalling\tthird-party\tweb\tservices\tor other\tmicroservices\tof\tour\tarchitecture.\n\nThese\ttests\tare\tthe\tperfect\ttool\tfor\tchecking\twhether\tour\tservice\tis behaving\tas\texpected,\tand\tsometimes,\tcould\tbe\thard\tto\tmaintain\t(more often\tthan\tnot).\n\nDuring\tmy\tyears\tof\texperience,\tI\thaven't\tfound\ta\tcompany\twhere\tthe integration\ttesting\tis\tdone\tright\tand\tthere\tare\ta\tnumber\tof\treasons\tfor this,\tas\tstated\tin\tthe\tfollowing\tlist:\n\nSome\tcompanies\tthink\tthat\tintegration\ttesting\tis\texpensive\t(and\tit\tis true)\tas\tit\trequires\textra\tresources\t(such\tas\tdatabases\tand\textra machines) Some\tother\tcompanies\ttry\tto\tcover\tall\tthe\tbusiness\tcases\tjust\twith unit\ttesting,\twhich\tdepending\ton\tthe\tbusiness\tcases,\tcould\twork,\tbut it\tis\tfar\tfrom\tideal\tas\tunit\ttests\tmake\tassumptions\t(mocks)\tthat\tcould give\tus\ta\tfalse\tconfidence\tin\tour\ttest\tsuite Sometimes,\tintegration\ttests\tare\tused\tto\tverify\tthe\tcode\tbranches\tas if\tthey\twere\tunit\ttests,\twhich\tis\ttime\tconsuming\tas\tyou\tneed\tto\twork out\tthe\tenvironment\tto\tmake\tthe\tintegration\ttest\tto\thit\tthe\trequired branch\n\nNo\tmatter\thow\tsmart\tyou\twant\tto\tbe,\tintegration\ttesting\tis\tsomething\tthat you\twant\tto\tdo\tright,\tas\tit\tis\tthe\tfirst\treal\tbarrier\tin\tour\tsoftware\tto\tprevent integration\tbugs\tfrom\tbeing\treleased\tinto\tproduction.\n\nEnd-to-end\ttests\n\nHere,\twe\twill\tdemonstrate\tthat\tour\tapplication\tactually\tworks.\tIn\tan integration\ttest,\twe\tare\tinvoking\tthe\tservices\tat\tcode\tlevel.\tThis\tmeans that\twe\tneed\tto\tbuild\tthe\tcontext\tof\tthe\tservice\tand\tthen\tissue\tthe\tcall.\n\nThe\tdifference\twith\tend-to-end\ttesting\tis\tthat,\tin\tend-to-end\ttesting,\twe actually\tfully\tdeploy\tour\tapplication\tand\tissue\tthe\trequired\tcalls\tto execute\tthe\ttarget\tcode.\tHowever,\tmany\ttimes,\tthe\tengineers\tcan\tdecide to\tbundle\tboth\ttype\tof\ttests\t(integration\tand\tend-to-end\ttests)\ttogether, as\tthe\tmodern\tframeworks\tallow\tus\tto\tquickly\trun\tE2E\ttests\tas\tif\tthey were\tintegration\ttests.\n\nAs\tthe\tintegration\ttests,\tthe\ttarget\tof\tthe\tend-to-end\ttests\tis\tnot\tto\ttest\tall the\tpaths\tof\tthe\tapplication\tbut\ttest\tthe\tuse\tcases.\n\nIn\tend-to-end\ttests,\twe\tcan\tfind\ta\tfew\tdifferent\tmodalities\t(paradigms)\tof testing,\tas\tfollows:\n\nWe\tcan\ttest\tour\tAPI\tissuing\tJSON\trequests\t(or\tother\ttype\tof requests) We\tcan\ttest\tour\tUI\tusing\tSelenium\tto\temulate\tclicks\ton\tthe\tDOM We\tcan\tuse\ta\tnew\tparadigm\tcalled\tbehavior-driven\tdevelopment (BDD)\ttesting,\twhere\tthe\tuse\tcases\tare\tmapped\tinto\tactions\tin\tour application\t(clicks\ton\tthe\tUI,\trequests\tin\tthe\tAPI,\tand\tso\ton)\tand execute\tthe\tuse\tcases\tfor\twhich\tthe\tapplication\twas\tbuilt\n\nEnd-to-end\ttests\tare\tusually\tvery\tfragile\tand\tthey\tget\tbroken\tfairly\teasy. Depending\ton\tour\tapplication,\twe\tmight\tget\trelaxed\tabout\tthese\ttests\tas the\tcost-value\tratio\tis\tpretty\tlow,\tbut\tstill,\tI\twould\trecommend\thaving some\tof\tthem\tcovering\tat\tleast\tthe\tmost\tbasic\tand\tessential\tflows.\n\nHow\tmuch\ttesting\tis\ttoo\tmuch?\n\nQuestions\tsuch\tas\tthe\tfollowing\tare\tnot\teasy\tto\tanswer,\tespecially\tin\tfast paced\tbusinesses,\tlike\tstartups:\n\nDo\twe\thave\ttoo\tmany\tintegration\ttests? Should\twe\taim\tfor\t100%\tunit\ttest\tcoverage? Why\tbother\twith\tSelenium\ttests\tif\tthey\tbreak\tevery\tsecond\tday\tfor no\treason?\n\nThere\tis\talways\ta\tcompromise.\tTest\tcoverage\tversus\ttime\tconsumed, and\talso,\tthere\tis\tno\tsimple\tand\tsingle\tanswer\tto\tthese\tquestions.\n\nThe\tonly\tuseful\tguideline\tthat\tI've\tfound\talong\tthe\tyears\tis\twhat\tthe testing\tworld\tcalls\tthe\tpyramid\tof\ttesting,\twhich\tis\tshown\tin\tthe following\tfigure.\tIf\tyou\tthink\tfor\ta\tmoment,\tin\tthe\tprojects\twhere\tyou worked\tbefore,\thow\tmany\ttests\tdid\tyou\thave\tin\ttotal?\tWhat\tpercentage of\tthese\twere\tintegration\ttests\tand\tunit\ttests?\tWhat\tabout\tend-to-end tests?:\n\nThe\tpyramid\tof\ttesting\n\nThe\tpreceding\tpyramid\tshows\tthe\tanswers\tfor\tthese\tquestions.\tIn\ta healthy\ttest\tplan,\twe\tshould\thave\ta\tlot\tof\tunit\ttests:\tsome\tintegration tests\tand\tvery\tfew\tE2E\ttests.\n\nThe\treason\tfor\tthis\tis\tvery\tsimple,\tmajority\tof\tthe\tproblems\tcan\tbe\tcaught within\tunit\ttesting.\tHitting\tthe\tdifferent\tbranches\tof\tour\tcode\twill\tverify\tthe functionality\tof\tpretty\tmuch\tevery\tfunctional\tcase\tin\tour\tapplication,\tso\tit makes\tsense\tto\thave\tplenty\tof\tthem\tin\tour\ttest\tplan.\tBased\ton\tmy experience,\tin\ta\tbalanced\ttest\tplan,\taround\t70%\tof\tour\ttests\tshould\tbe unit\ttests.\tHowever,\tin\ta\tmicroservices-oriented\tarchitecture,\tespecially with\ta\tdynamic\tlanguage\tsuch\tas\tNode.js,\tthis\tfigure\tcan\teasily\tgo\tdown and\tstill\tbe\teffective\twith\tour\ttesting.\tThe\treasoning\tbehind\tit\tis\tthat Node.js\tallows\tyou\tto\twrite\tintegration\ttests\tvery\tquickly\tso\tthat\twe\tcan replace\tsome\tunit\ttests\tby\tintegration\ttests.\n\nTip\n\nTesting\tis\ta\tvery\twell-documented,\tcomplex\tprocess.\tTrying\tto\n\noutsmart\tthe\texisting\tmethodologies\tcould\tresult\tin\ta\thard-to-maintain and\tdifficult-to-trust\ttest\tsuite.\n\nIntegration\ttests\tare\tresponsible\tfor\tcatching\tintegration\tproblems,\tas shown\tin\tthe\tfollowing:\n\nCan\tour\tcode\tcall\tthe\tSMS\tgateway? Would\tthe\tconnection\tto\tthe\tdatabase\tbe\tOK? Are\tthe\tHTTP\theaders\tbeing\tsent\tfrom\tour\tservice?\n\nAgain,\taround\t20%\tof\tour\ttests,\tbased\ton\tmy\texperience,\tshould\tbe integration\ttests;\tfocus\ton\tthe\tpositive\tflows\tand\tsome\tof\tthe\tnegative that\tdepend\ton\tthird-party\tmodules.\n\nWhen\tit\tcomes\tdown\tto\tE2E\ttests,\tthey\tshould\tbe\tvery\tlimited\tand\tonly test\tthe\tmain\tflows\tof\tthe\tapplications\twithout\tgoing\tinto\ttoo\tmuch\tdetail. These\tdetails\tshould\tbe\talready\tcaptured\tby\tthe\tunit\tand\tintegration\ttests that\tare\teasy\tto\tfix\tin\tan\tevent\tof\tfailure.\tHowever,\tthere\tis\ta\tcatch\there: when\ttesting\tmicroservices\tin\tNode.js,\t90%\tof\tthe\ttime,\tintegration\tand E2E\ttests\tcan\tbe\tthe\tsame\tthing.\tDue\tto\tthe\tdynamic\tnature\tof\tNode.js, we\tcan\ttest\tthe\trest\tAPI\tfrom\tthe\tintegration\tpoint\tof\tview\t(the\tfull\tserver running),\tbut\tin\treality,\twe\twill\talso\tbe\ttesting\thow\tour\tcode\tbehaves when\tintegrated\twith\tother\tmodules.\tWe\twill\tsee\tan\texample\tlater\tin\tthis chapter.\n\nTesting\tmicroservices\tin\tNode.js\n\nNode.js\tis\tan\timpressive\tlanguage.\tThe\tamount\tof\tlibraries\taround\tany single\taspect\tof\tthe\tdevelopment\tis\tamazing.\tNo\tmatter\thow\tbizarre\tthe task\tthat\tyou\twant\tto\tachieve\tin\tNode.js\tis,\tthere\twill\tbe\talways\tan\tnpm module.\n\nRegarding\tthe\ttesting,\tNode.js\thas\ta\tvery\tpowerful\tset\tof\tlibraries,\tbut two\tof\tthem\tare\tespecially\tpopular:\tMocha\tand\tChai.\n\nThey\tare\tpretty\tmuch\tthe\tindustry\tstandard\tfor\tapp\ttesting\tand\tare\tvery well\tmaintained\tand\tupgraded.\n\nAnother\tinteresting\tlibrary\tis\tcalled\tSinon.JS,\tand\tit\tis\tused\tfor\tmocking, spying\tand\tstubbing\tmethods.\tWe\twill\tcome\tback\tto\tthese\tconcepts\tin the\tfollowing\tsections,\tbut\tthis\tlibrary\tis\tbasically\tused\tto\tsimulate integrations\twith\tthird\tparties\twithout\tinteracting\twith\tthem.\n\nChai\n\nThis\tlibrary\tis\ta\tBDD/TDD\tassertions\tlibrary\tthat\tcan\tbe\tused\tin conjunction\twith\tany\tother\tlibrary\tto\tcreate\thigh\tquality\ttests.\n\nAn\tassertion\tis\ta\tcode\tstatement\tthat\twill\teither\tbe\tfulfilled\tor\tthrow\tan error,\tstopping\tthe\ttest\tand\tmarking\tit\tas\ta\tfailure:\n\n5\tshould\tbe\tequal\tto\tA\n\nThe\tpreceding\tstatement\twill\tbe\tcorrect\twhen\tthe\tvariable\tA\tcontains\tthe value\t5.\tThis\tis\ta\tvery\tpowerful\ttool\tto\twrite\teasy-to-understand\ttests, and\tespecially\twith\tChai,\twe\thave\taccess\tto\tassertions\tmaking\tuse\tof\tthe following\tthree\tdifferent\tinterfaces:\n\nshould expect assert\n\nAt\tthe\tend\tof\tthe\tday,\tevery\tsingle\tcondition\tcan\tbe\tchecked\tusing\ta single\tinterface,\tbut\tthe\tfact\tthat\tthe\tlibrary\tprovides\tus\twith\tsuch\ta\trich interface\tfacilitates\tthe\tverbosity\tof\tthe\ttests\tin\torder\tto\twrite\tclean,\teasy, and\tmaintainable\ttests.\n\nLet's\tinstall\tthe\tlibrary:\n\nnpm\tinstall\tchai\n\nThis\twill\tproduce\tthe\tfollowing\toutput:\n\nThis\tmeans\tthat\tChai\tdepends\ton\tassertion-error,\ttype-detect,\tand deep-eql.\tAs\tyou\tcan\tsee,\tthis\tis\ta\tgood\tindication\tthat\twe\twill\tbe\table\tto check,\twith\tsimple\tinstructions,\tcomplex\tstatements\tsuch\tas\tdeep equality\tin\tobjects\tor\ttype\tmatching.\n\nTesting\tlibraries\tsuch\tas\tChai\tare\tnot\ta\tdirect\tdependency\tof\tour application,\tbut\ta\tdevelopment\tdependency.\tWe\tneed\tthem\tto\tdevelop applications,\tbut\tthey\tshould\tnot\tbe\tshipped\tto\tproduction.\tThis\tis\ta\tgood reason\tto\trestructure\tour\tpackage.json\tand\tadd\tChai\tin\tthe devDependencies\tdependency\ttag,\tas\tfollows:\n\n{ \t\t\"name\":\t\"chai-test\", \t\t\"version\":\t\"1.0.0\", \t\t\"description\":\t\"A\ttest\tscript\", \t\t\"main\":\t\"chai.js\", \t\t\"dependencies\":\t{ \t\t}, \t\t\"devDependencies\":\t{ \t\t\t\t\"chai\":\t\"*\" \t\t}, \t\t\"author\":\t\"David\tGonzalez\", \t\t\"license\":\t\"ISC\" }\n\nThis\twill\tprevent\tour\tsoftware\tto\tship\tinto\tproduction\tlibraries\tsuch\tas Chai,\twhich\thas\tnothing\tto\tdo\twith\tthe\toperation\tof\tour\tapplication.\n\nOnce\twe\thave\tinstalled\tChai,\twe\tcan\tstart\tplaying\taround\twith\tthe interfaces.\n\nBDD-style\tinterfaces\n\nChai\tcomes\twith\ttwo\tflavors\tof\tBDD\tinterfaces.\tIt\tis\ta\tmatter\tof preference\twhich\tone\tto\tuse,\tbut\tmy\tpersonal\trecommendation\tis\tto\tuse the\tone\tthat\tmakes\tyou\tfeel\tmore\tcomfortable\tin\tany\tsituation.\n\nLet's\tstart\twith\tthe\tshould\tInterface.\tThis\tone\tis\ta\tBDD-style\tinterface, using\tsomething\tsimilar\tto\tthe\tnatural\tlanguage,\twe\tcan\tcreate assertions\tthat\twill\tdecide\twhether\tour\ttest\tsucceeds\tor\tfails:\n\nmyVar.should.be.a('string')\n\nIn\torder\tto\tbe\table\tto\tbuild\tsentences\tlike\tthe\tone\tbefore,\twe\tneed\tto import\tthe\tshould\tmodule\tin\tour\tprogram:\n\nvar\tchai\t=\trequire('chai');\n\nchai.should();\n\nvar\tfoo\t=\t\"Hello\tworld\"; console.log(foo);\n\nfoo.should.equal('Hello\tworld');\n\nAlthough\tit\tlooks\tlike\ta\tbit\tof\tdark\tmagic,\tit\tis\treally\tconvenient\twhen testing\tour\tcode\tas\twe\tuse\tsomething\tsimilar\tto\tthe\tnatural\tlanguage\tto ensure\tthat\tour\tcode\tis\tmeeting\tsome\tcriteria:\tfoo\tshould\tbe\tequal\tto 'Hello\tworld'\thas\ta\tdirect\ttranslation\tto\tour\ttest.\n\nThe\tsecond\tBDD-style\tinterface\tprovided\tby\tChai\tis\texpect.\tAlthough\tit\tis very\tsimilar\tto\tshould,\tit\tchanges\ta\tbit\tof\tsyntax\tin\torder\tto\tset expectations\tthat\tthe\tresults\thave\tto\tmeet.\n\nLet's\tsee\tthe\tfollowing\texample:\n\nvar\texpect\t=\trequire('chai').expect;\n\nvar\tfoo\t=\t\"Hello\tworld\";\n\nexpect(foo).to.equal(\"Hello\tworld\");\n\nAs\tyou\tcan\tsee,\tthe\tstyle\tis\tvery\tsimilar:\ta\tfluent\tinterface\tthat\tallows\tus to\tcheck\twhether\tthe\tconditions\tfor\tthe\ttest\tto\tsucceed\tare\tmet,\tbut\twhat happens\tif\tthe\tconditions\tare\tnot\tmet?\n\nLet's\texecute\ta\tsimple\tNode.js\tprogram\tthat\tfails\tin\tone\tof\tthe\tconditions:\n\nvar\texpect\t=\trequire('chai').expect; var\tanimals\t=\t['cat',\t'dog',\t'parrot']; expect(animals).to.have.length(4);\n\nNow,\tlet's\texecute\tthe\tprevious\tscript,\tassuming\tthat\tyou\thave\talready\n\ninstalled\tChai:\n\ncode/node_modules/chai/lib/chai/assertion.js:107 \t\t\t\t\t\tthrow\tnew\tAssertionError(msg,\t{ \t\t\t\t\t\t\t\t\t\t\t\t^ AssertionError:\texpected\t[\t'cat',\t'dog',\t'parrot'\t]\tto\t have\ta\tlength\tof\t4\tbut\tgot\t3 \t\t\t\tat\tObject.<anonymous>\t (/Users/dgonzalez/Dropbox/Microservices\twith\t Node/Writing\tBundle/Chapter\t6/code/chai.js:24:25) \t\t\t\tat\tModule._compile\t(module.js:460:26) \t\t\t\tat\tObject.Module._extensions..js\t (module.js:478:10) \t\t\t\tat\tModule.load\t(module.js:355:32) \t\t\t\tat\tFunction.Module._load\t(module.js:310:12) \t\t\t\tat\tFunction.Module.runMain\t(module.js:501:10) \t\t\t\tat\tstartup\t(node.js:129:16) \t\t\t\tat\tnode.js:814:3\n\nAn\texception\tis\tthrown\tand\tthe\ttest\tfails.\tIf\tall\tthe\tconditions\twere validated,\tno\texception\twould\thave\tbeen\traised\tand\tthe\ttest\twould\thave succeeded.\n\nAs\tyou\tcan\tsee,\tthere\tare\ta\tnumber\tof\tnatural\tlanguage\twords\tthat\twe can\tuse\tfor\tour\ttests\tusing\tboth\texpect\tand\tshould\tinterfaces.\tThe\tfull\tlist can\tbe\tfound\tin\tthe\tChai\tdocumentation\t(http://chaijs.com/api/bdd/#- include-value-),\tbut\tlet's\texplain\tsome\tof\tthe\tmost\tinteresting\tones\tin\tthe following\tlist:\n\nnot:\tThis\tword\tis\tused\tto\tnegate\tthe\tassertions\tfollowing\tin\tthe chain.\tFor\texample,\texpect(\"some\tstring\").to.not.equal(\"Other String\")\twill\tpass. deep:\tThis\tword\tis\tone\tof\tthe\tmost\tinteresting\tof\tall\tthe\tcollection.\tIt\tis used\tto\tdeep-compare\tobjects,\twhich\tis\tthe\tquickest\tway\tto\tcarry\ton a\tfull\tequal\tcomparison.\tFor\texample, expect(foo).to.deep.equal({name:\t\"David\"})\twill\tsucceed\tif\tfoo\tis\ta JavaScript\tobject\twith\tone\tproperty\tcalled\tname\twith\tthe\t\"David\" string\tvalue. any/all:\tThis\tis\tused\tto\tcheck\twhether\tthe\tdictionary\tor\tobject contains\tany\tof\tthe\tkeys\tin\tthe\tgiven\tlist\tso\tthat expect(foo).to.have.any.keys(\"name\",\t\"surname\")\twill\tsucceed\tif foo\tcontains\tany\tof\tthe\tgiven\tkeys,\tand\n\nexpect(foo).to.have.all.keys(\"name\",\t\"surname\")\twill\tonly\tsucceed if\tit\thas\tall\tof\tthe\tkeys. ok:\tThis\tis\tan\tinteresting\tone.\tAs\tyou\tprobably\tknow,\tJavaScript\thas a\tfew\tpitfalls,\tand\tone\tof\tthem\tis\tthe\ttrue/false\tevaluation\tof expressions.\tWith\tok,\twe\tcan\tabstract\tall\tthe\tmess\tand\tdo\tsomething similar\tto\tthe\tfollowing\tlist\tof\texpressions:\n\nexpect('everything').to.be.ok:\t'everything'\tis\ta\tstring\tand\tit will\tbe\tevaluated\tto\tok expect(undefined).to.not.be.ok:\tUndefined\tis\tnot\tok\tin\tthe JavaScript\tworld,\tso\tthis\tassertion\twill\tsucceed\n\nabove:\tThis\tis\ta\tvery\tuseful\tword\tto\tcheck\twhether\tan\tarray\tor collection\tcontains\ta\tnumber\tof\telements\tabove\ta\tcertain\tthreshold, as\tfollows:\texpect([1,2,3]).to.have.length.above(2)\n\nAs\tyou\tcan\tsee,\tthe\tChai\tAPI\tfor\tfluent\tassertions\tis\tquite\trich\tand enables\tus\tto\twrite\tvery\tdescriptive\ttests\tthat\tare\teasy\tto\tmaintain.\n\nNow,\tyou\tmay\tbe\tasking\tyourself,\twhy\thave\ttwo\tflavors\tof\tthe\tsame interface\tthat\tpretty\tmuch\twork\tthe\tsame?\tWell,\tthey\tfunctionally\tdo\tthe same,\thowever,\ttake\ta\tlook\tat\tthe\tdetail:\n\nexpect\tprovides\ta\tstarting\tpoint\tin\tyour\tchainable\tlanguage should\textends\tthe\tObject.prototype\tsignature\tto\tadd\tthe\tchainable language\tto\tevery\tsingle\tobject\tin\tJavaScript\n\nFrom\tNode.js'\tpoint\tof\tview,\tboth\tof\tthem\tare\tfine,\talthough\tthe\tfact\tthat should\tis\tinstrumenting\tthe\tprototype\tof\tObject\tcould\tbe\ta\treason\tto\tbe\ta bit\tparanoid\tabout\tusing\tit\tas\tit\tis\tintrusive.\n\nAssertions\tinterface\n\nThe\tassertions\tinterface\tmatches\tthe\tmost\tcommon\told-fashioned\ttests assertion\tlibrary.\tIn\tthis\tflavor,\twe\tneed\tto\tbe\tspecific\tabout\twhat\twe\twant to\ttest,\tand\tthere\tis\tno\tsuch\tthing\tas\tfluent\tchaining\tof\texpressions:\n\nvar\tassert\t=\trequire('chai').assert; var\tmyStringVar\t=\t'Here\tis\tmy\tstring'; //\tNo\tmessage:\n\nassert.typeOf(myStringVar,\t'string'); //\tWith\tmessage: assert.typeOf(myStringVar,\t'string',\t'myStringVar\tis\t not\tstring\ttype.'); //\tAsserting\ton\tlength: assert.lengthOf(myStringVar,\t17);\n\nThere\tis\treally\tnothing\tmore\tto\tgo\tin\tdepth\tif\tyou\thave\talready\tused\tany of\tthe\texisting\ttest\tlibraries\tin\tany\tlanguage.\n\nMocha\n\nMocha\tis,\tin\tmy\topinion,\tone\tof\tthe\tmost\tconvenient\ttesting\tframeworks that\tI\thave\tever\tused\tin\tmy\tprofessional\tlife.\tIt\tfollows\tthe\tprinciples\tof behavior-driven\tdevelopment\ttesting\t(BDDT),\twhere\tthe\ttest describes\ta\tuse\tcase\tof\tthe\tapplication\tand\tuses\tthe\tassertions\tfrom another\tlibrary\tto\tverify\tthe\toutcome\tof\tthe\texecuted\tcode.\n\nAlthough\tit\tsounds\ta\tbit\tcomplicated,\tit\tis\treally\tconvenient\tto\tensure\tthat our\tcode\tis\tcovered\tfrom\tthe\tfunctional\tand\ttechnical\tpoint\tof\tview,\tas\twe will\tbe\tmirroring\tthe\trequirements\tused\tto\tbuild\tthe\tapplication\tinto automated\ttests\tthat\tverifies\tthem.\n\nLet's\tstart\twith\ta\tsimple\texample.\tMocha\tis\ta\tbit\tdifferent\tfrom\tany\tother library,\tas\tit\tdefines\tits\town\tdomain-specific\tlanguage\t(DSL)\tthat\tneeds to\tbe\texecuted\twith\tMocha\tinstead\tof\tNode.js.\tIt\tis\tan\textension\tof\tthe language.\n\nFirst\twe\tneed\tto\tinstall\tMocha\tin\tthe\tsystem:\n\nnpm\tinstall\tmocha\t-g\n\nThis\twill\tproduce\tan\toutput\tsimilar\tto\tthe\tfollowing\timage:\n\nFrom\tnow\ton,\twe\thave\ta\tnew\tcommand\tin\tour\tsystem:\tmocha.\n\nThe\tnext\tstep\tis\tto\twrite\ta\ttest\tusing\tMocha:\n\nfunction\trollDice()\t{ \t\treturn\tMath.floor(Math.random()\t*\t6)\t+\t1; }\n\nrequire('chai').should(); var\texpect\t=\trequire('chai').expect;\n\ndescribe('When\ta\tcustomer\trolls\ta\tdice',\tfunction(){\n\nit('should\treturn\tan\tinteger\tnumber',\tfunction()\t{ \t\t\t\texpect(rollDice()).to.be.an('number'); \t\t});\n\nit('should\tget\ta\tnumber\tbelow\t7',\tfunction(){ \t\t\t\trollDice().should.be.below(7); \t\t});\n\nit('should\tget\ta\tnumber\tbigger\tthan\t0',\tfunction(){ \t\t\t\trollDice().should.be.above(0); \t\t});\n\nit('should\tnot\tbe\tnull',\tfunction()\t{ \t\t\t\texpect(rollDice()).to.not.be.null; \t\t});\n\nit('should\tnot\tbe\tundefined',\tfunction()\t{ \t\t\t\texpect(rollDice()).to.not.be.undefined; \t\t}); });\n\nThe\tpreceding\texample\tis\tsimple.\tA\tfunction\tthat\trolls\ta\tdice\tand\treturns\n\nan\tinteger\tnumber\tfrom\t1\tto\t6.\tNow\twe\tneed\tto\tthink\ta\tbit\tabout\tthe\tuse cases\tand\tthe\trequirements:\n\nThe\tnumber\thas\tto\tbe\tan\tinteger This\tinteger\thas\tto\tbe\tbelow\t7 It\thas\tto\tbe\tabove\t0,\tdice\tdon't\thave\tnegative\tnumbers The\tfunction\tcannot\treturn\tnull The\tfunction\tcannot\treturn\tundefined\n\nThis\tcovers\tpretty\tmuch\tevery\tcorner\tcase\tabout\trolling\ta\tdice\tin\tNode.js. What\twe\tare\tdoing\tis\tdescribing\tsituations\tthat\twe\tcertainly\twant\tto\ttest, in\torder\tto\tsafely\tmake\tchanges\tto\tthe\tsoftware\twithout\tbreaking\tthe existing\tfunctionality.\n\nThese\tfive\tuse\tcases\tare\tan\texact\tmap\tto\tthe\ttests\twritten\tearlier:\n\nWe\tdescribe\tthe\tsituation:\tWhen\ta\tcustomer\trolls\ta\tdice Conditions\tget\tverified:\tIt\tshould\treturn\tan\tinteger\tnumber\n\nLet's\trun\tthe\tprevious\ttest\tand\tcheck\tthe\tresults:\n\nmocha\ttests.js\n\nThis\tshould\treturn\tsomething\tsimilar\tto\tthe\tfollowing\tscreenshot:\n\nAs\tyou\tcan\tsee,\tMocha\treturns\ta\tcomprehensive\treport\ton\twhat\tis\tgoing on\tin\tthe\ttests.\tIn\tthis\tcase,\tall\tof\tthem\tpass,\tso\twe\tdon't\tneed\tto\tbe worried\tabout\tproblems.\n\nLet's\tforce\tsome\tof\tthe\ttests\tto\tfail:\n\nfunction\trollDice()\t{ \t\treturn\t-1\t\tMath.floor(Math.random()\t\t6)\t+\t1; }\n\nrequire('chai').should(); var\texpect\t=\trequire('chai').expect;\n\ndescribe('When\ta\tcustomer\trolls\ta\tdice',\tfunction(){\n\nit('should\treturn\tan\tinteger\tnumber',\tfunction()\t{ \t\t\t\texpect(rollDice()).to.be.an('number'); \t\t});\n\nit('should\tget\ta\tnumber\tbelow\t7',\tfunction(){ \t\t\t\trollDice().should.be.below(7); \t\t});\n\nit('should\tget\ta\tnumber\tbigger\tthan\t0',\tfunction(){ \t\t\t\trollDice().should.be.above(0); \t\t});\n\nit('should\tnot\tbe\tnull',\tfunction()\t{ \t\t\t\texpect(rollDice()).to.not.be.null; \t\t});\n\nit('should\tnot\tbe\tundefined',\tfunction()\t{ \t\t\t\texpect(rollDice()).to.not.be.undefined; \t\t}); });\n\nAccidentally,\tsomeone\thas\tbumped\ta\tcode\tfragment\tinto\tthe\trollDice() function,\twhich\tmakes\tthe\tfunction\treturn\ta\tnumber\tthat\tdoes\tnot\tmeet some\tof\tthe\trequirements.\tLet's\trun\tMocha\tagain,\tas\tshown\tin\tthe following\timage:\n\nNow,\twe\tcan\tsee\tthe\treport\treturning\tone\terror:\tthe\tmethod\tis\treturning -4,\twhere\tit\tshould\talways\treturn\ta\tnumber\tbigger\tthan\t0.\n\nAlso,\tone\tof\tthe\tbenefits\tof\tthis\ttype\tof\ttesting\tin\tNode.js\tusing\tMocha and\tChai\tis\tthe\ttime.\tTests\trun\tvery\tfast\tso\tthat\tit\tis\teasy\tto\treceive feedback\tif\twe\thave\tbroken\tsomething.\tThe\tpreceding\tsuite\tran\tin\t10ms.\n\nSinon.JS\t–\ta\tmocking\tframework\n\nThe\tprevious\ttwo\tchapters\thave\tbeen\tfocused\ton\tasserting\tconditions\ton return\tvalues\tof\tfunctions,\tbut\twhat\thappens\twhen\tour\tfunction\tdoes\tnot return\tany\tvalue?\tThe\tonly\tcorrect\tmeasurement\tis\tto\tcheck\twhether\tthe method\twas\tcalled\tor\tnot.\tAlso,\twhat\tif\tone\tof\tour\tmodules\tis\tcalling\ta third-party\tweb\tservice,\tbut\twe\tdon't\twant\tour\ttests\tto\tcall\tthe\tremote server?\n\nFor\tanswering\tthese\tquestions,\twe\thave\ttwo\tconceptual\ttools\tcalled mocks\tand\tspies,\tand\tNode.js\thas\tthe\tperfect\tlibrary\tto\timplement\tthem: Sinon.JS.\n\nFirst\tinstall\tit,\tas\tfollows:\n\nnpm\tinstall\tsinon\n\nThe\tpreceding\tcommand\tshould\tproduce\tthe\tfollowing\toutput:\n\nNow\tlet's\texplain\thow\tit\tworks\tthrough\tan\texample:\n\nfunction\tcalculateHypotenuse(x,\ty,\tcallback)\t{ \t\tcallback(null,\tMath.sqrt(x*x\t+\ty*x)); }\n\ncalculateHypotenuse(3,\t3,\tfunction(err,\tresult){ \t\tconsole.log(result); });\n\nThis\tsimple\tscript\tcalculates\tthe\thypotenuse\tof\ta\ttriangle,\tgiven\tthe length\tof\tthe\tother\ttwo\tsides\tof\tthe\ttriangle.\tOne\tof\tthe\ttests\tthat\twe\twant to\tcarry\ton\tis\tthe\tfact\tthat\tthe\tcallback\tis\texecuted\twith\tthe\tright\tlist\tof arguments\tsupplied.\tWhat\twe\tneed\tto\taccomplish\tsuch\ttask\tis\twhat Sinon.JS\tcalls\ta\tspy:\n\nvar\tsinon\t=\trequire('sinon');\n\nrequire('chai').should();\n\nfunction\tcalculateHypotenuse(x,\ty,\tcallback)\t{ \t\tcallback(null,\tMath.sqrt(x*x\t+\ty*x)); }\n\ndescribe(\"When\tthe\tuser\tcalculates\tthe\thypotenuse\",\t function(){ \t\tit(\"should\texecute\tthe\tcallback\tpassed\tas\targument\",\t function()\t{ \t\t\t\tvar\tcallback\t=\tsinon.spy(); \t\t\t\tcalculateHypotenuse(3,\t3,\tcallback); \t\t\t\tcallback.called.should.be.true; \t\t}); });\n\nOnce\tagain,\twe\tare\tusing\tMocha\tto\trun\tthe\tscript\tand\tChai\tto\tverify\tthe results\tin\tthe\ttest\tthrough\tthe\tshould\tinterface,\tas\tshown\tin\tthe\tfollowing image:\n\nThe\timportant\tline\tin\tthe\tpreceding\tscript\tis:\n\nvar\tcallback\t=\tsinon.spy();\n\nHere,\twe\tare\tcreating\tthe\tspy\tand\tinjecting\tit\tinto\tthe\tfunction\tas\ta callback.\tThis\tfunction\tcreated\tby\tSinon.JS\tis\tactually\tnot\tonly\ta\tfunction, but\ta\tfull\tobject\twith\ta\tfew\tinteresting\tpoints\tof\tinformation.\tSinon.JS does\tthat,\ttaking\tadvantage\tof\tthe\tdynamic\tnature\tof\tJavaScript.\tYou\tcan actually\tsee\twhat\tis\tin\tthis\tobject\tby\tdumping\tit\tinto\tthe\tconsole\twith console.log().\n\nAnother\tvery\tpowerful\ttool\tin\tSinon.JS\tare\tthe\tstubs.\tStubs\tare\tvery similar\tto\tmocks\t(identical\tat\tpractical\teffects\tin\tJavaScript)\tand\tallow\tus to\tfake\tfunctions\tto\tsimulate\tthe\trequired\treturn:\n\nvar\tsinon\t=\trequire('sinon'); var\texpect\t=\trequire('chai').expect;\n\nfunction\trollDice()\t{ \t\treturn\t-1\t\tMath.floor(Math.random()\t\t6)\t+\t1; } describe(\"When\trollDice\tgets\tcalled\",\tfunction()\t{ \t\tit(\"Math#random\tshould\tbe\tcalled\twith\tno\targuments\",\t function()\t{ \t\t\t\tsinon.stub(Math,\t\"random\"); \t\t\t\trollDice(); \t\t\t\tconsole.log(Math.random.calledWith()); \t\t}); })\n\nIn\tthis\tcase,\twe\thave\tstubbed\tthe\tMath#random\tmethod,\twhich\tcauses\tthe method\tto\tbe\tsome\tsort\tof\toverloaded\tempty\tfunction\t(it\tdoes\tnot\tissue the\tget\tcall)\tthat\trecords\tstats\ton\twhat\tor\thow\tit\twas\tcalled.\n\nThere\tis\tone\tcatch\tin\tthe\tpreceding\tcode:\twe\tnever\trestored\tthe\trandom() method\tback\tand\tthis\tis\tquite\tdangerous.\tIt\thas\ta\tmassive\tside\teffect,\tas other\ttests\twill\tsee\tthe\tMath#random\tmethod\tas\ta\tstub,\tnot\tas\tthe\toriginal one,\tand\tit\tcan\tlead\tto\tus\tcoding\tour\ttests\taccording\tto\tinvalid information.\n\nIn\torder\tto\tprevent\tthis,\twe\tneed\tto\tmake\tuse\tof\tthe\tbefore()\tand after()\tmethods\tfrom\tMocha:\n\nvar\tsinon\t=\trequire('sinon'); var\texpect\t=\trequire('chai').expect;\n\nvar\tsinon\t=\trequire('sinon'); var\texpect\t=\trequire('chai').expect;\n\nfunction\trollDice()\t{ \t\treturn\t-1\t\tMath.floor(Math.random()\t\t6)\t+\t1; } describe(\"When\trollDice\tgets\tcalled\",\tfunction()\t{\n\nit(\"Math#random\tshould\tbe\tcalled\twith\tno\targuments\",\t function()\t{ \t\t\t\tsinon.stub(Math,\t\"random\"); \t\t\t\trollDice(); \t\t\t\tconsole.log(Math.random.calledWith()); \t\t}); after(function(){ \t\t\t\tMath.random.restore(); \t\t}); });\n\nIf\tyou\tpay\tattention\tto\tthe\thighlighted\tcode,\twe\tare\ttelling\tSinon.JS\tto restore\tthe\toriginal\tmethod\tthat\twas\tstubbed\tinside\tone\tof\tthe\tit\tblocks, so\tthat\tif\tanother\tdescribe\tblock\tmakes\tuse\tof\thttp.get,\twe\twon't\tsee\tthe stub,\tbut\tthe\toriginal\tmethod.\n\nTip\n\nThe\tbefore()\tand\tafter()\tmethods\tare\tvery\thelpful\tto\tset\tup\tand wind\tdown\tthe\tcontext\tfor\tthe\ttests.\tHowever,\tyou\tneed\tto\tbe\tcareful with\tthe\tscope\twhere\tthey\tare\texecuted\tas\tit\tcould\tlead\tto\ttest interactions.\n\nMocha\thas\ta\tfew\tflavors\tof\tbefore\tand\tafter:\n\nbefore(callback):\tThis\tis\texecuted\tbefore\tthe\tcurrent\tscope\t(at\tthe beginning\tof\tthe\tdescribe\tblock\tin\tthe\tpreceding\tcode) after(callback):\tThis\tis\texecuted\tafter\tthe\tcurrent\tscope\t(at\tthe\tend of\tthe\tdescribe\tblock\tin\tthe\tpreceding\tcode) beforeEach(callback):\tThis\tis\texecuted\tat\tthe\tbeginning\tof\tevery element\tin\tthe\tcurrent\tscope\t(before\teach\tit\tin\tthe\tpreceding example) afterEach(callback):\tThis\tis\texecuted\tat\tthe\tend\tof\tevery\telement\tin the\tcurrent\tscope\t(after\tevery\tit\tin\tthe\tpreceding\texample)\n\nAnother\tinteresting\tfeature\tin\tSinon.JS\tis\tthe\ttime\tmanipulation.\tSome\tof the\ttests\tneed\tto\texecute\tperiodic\ttasks\tor\trespond\tafter\ta\tcertain\ttime\tof an\tevent's\toccurrence.\tWith\tSinon.JS,\twe\tcan\tdictate\ttime\tas\tone\tof\tthe parameters\tof\tour\ttests:\n\nvar\tsinon\t=\trequire('sinon'); var\texpect\t=\trequire('chai').expect\n\nfunction\tareWeThereYet(callback)\t{\n\nsetTimeout(function()\t{ \t\t\t\tcallback.apply(this); \t\t},\t10);\n\n}\n\nvar\tclock;\n\nbefore(function(){ \t\tclock\t=\tsinon.useFakeTimers(); });\n\nit(\"callback\tgets\tcalled\tafter\t10ms\",\tfunction\t()\t{ \t\tvar\tcallback\t=\tsinon.spy(); \t\tvar\tthrottled\t=\tareWeThereYet(callback);\n\nareWeThereYet(callback);\n\nclock.tick(9); \t\texpect(callback.notCalled).to.be.true;\n\nclock.tick(1); \t\texpect(callback.notCalled).to.be.false; });\n\nafter(function(){ \t\tclock.restore(); });\n\nAs\tyou\tcan\tsee,\twe\tcan\tnow\tcontrol\tthe\ttime\tin\tour\ttests.\n\nTesting\ta\treal\tmicroservice\n\nNow,\tit\tis\ttime\tto\ttest\ta\treal\tmicroservice\tin\torder\tto\tget\ta\tgeneral\tpicture of\tthe\tfull\ttest\tsuite.\n\nOur\tmicroservice\tis\tgoing\tto\tuse\tExpress,\tand\tit\twill\tfilter\tan\tinput\ttext\tto remove\twhat\tthe\tsearch\tengines\tcall\tstop\twords:\twords\twith\tless\tthan three\tcharacters\tand\twords\tthat\tare\tbanned.\n\nLet's\tsee\tthe\tcode:\n\nvar\t\t=\trequire('lodash'); var\texpress\t=\trequire('express');\n\nvar\tbannedWords\t=\t[\"kitten\",\t\"puppy\",\t\"parrot\"];\n\nfunction\tremoveStopWords\t(text,\tcallback)\t{ \t\tvar\twords\t=\ttext.split('\t'); \t\tvar\tvalidWords\t=\t[]; \t\t(words).forEach(function(word,\tindex)\t{ \t\t\t\tvar\taddWord\t=\ttrue;\n\nif\t(word.length\t<\t3)\t{ \t\t\t\t\t\taddWord\t=\tfalse; \t\t\t\t}\n\nif(addWord\t&&\tbannedWords.indexOf(word)\t>\t-1)\t{ \t\t\t\t\t\taddWord\t=\tfalse; \t\t\t\t}\n\nif\t(addWord)\t{ \t\t\t\t\t\tvalidWords.push(word);\t \t\t\t\t}\n\n//\tLast\titeration:\n\nif\t(index\t==\t(words.length\t-\t1))\t{ \t\t\t\t\t\tcallback(null,\tvalidWords.join(\"\t\")); \t\t\t\t} \t\t}); } var\tapp\t=\texpress();\n\napp.get('/filter',\tfunction(req,\tres)\t{ \t\tremoveStopWords(req.query.text,\tfunction(err,\t response){ \t\t\t\tres.send(response); \t\t}); });\n\napp.listen(3000,\tfunction()\t{ \t\tconsole.log(\"app\tstarted\tin\tport\t3000\"); });\n\nAs\tyou\tcan\tsee,\tthe\tservice\tis\tpretty\tsmall,\tso\tit\tis\tthe\tperfect\texample\tfor explaining\thow\tto\twrite\tunit,\tintegration,\tand\tE2E\ttests.\tIn\tthis\tcase,\tas we\tstated\tbefore,\tE2E\tand\tintegration\ttests\tare\tgoing\tto\tbe\tthe\texact same\tas\ttesting\tthe\tservice\tthrough\tthe\tREST\tAPI\twill\tbe\tequivalent\tto testing\tthe\tsystem\tfrom\tthe\tend-to-end\tpoint\tof\tview,\tbut\talso\thow\tour component\tis\tintegrated\twithin\tthe\tsystem.\tGiven\tthat,\tif\twe\twere\tto\tadd a\tUI,\twe\twould\thave\tto\tsplit\tintegration\ttests\tfrom\tE2E\tin\torder\tto\tensure the\tquality.\n\nTDD\t–\tTest-driven\tdevelopment\n\nOur\tservice\tis\tdone\tand\tworking.\tHowever,\tnow\twe\twant\tto\tunit\ttest\tit, but\twe\tfind\tsome\tproblems:\n\nThe\tfunction\tthat\twe\twant\tto\tunit\ttest\tis\tnot\tvisible\toutside\tthe\tmain .js\tfile The\tserver\tcode\tis\ttightly\tcoupled\tto\tthe\tfunctional\tcode\tand\thas\tbad cohesion\n\nHere\tTDD\tcomes\tto\tthe\trescue;\twe\tshould\talways\task\tourselves\t\"how am\tI\tgoing\tto\ttest\tthis\tfunction\twhen\twriting\tsoftware?\"\tIt\tdoes\tnot\tmean that\twe\tshould\tmodify\tour\tsoftware\twith\tthe\tspecific\tpurpose\tof\ttesting, but\tif\tyou\tare\thaving\tproblems\twhile\ttesting\ta\tpart\tof\tyour\tprogram,\tmore than\tlikely,\tyou\tshould\tlook\tinto\tcohesion\tand\tcoupling,\tas\tit\tis\ta\tgood indication\tof\tproblems.\tLet's\ttake\ta\tlook\tat\tthe\tfollowing\tfile:\n\nvar\t\t=\trequire('lodash'); var\texpress\t=\trequire('express');\n\nmodule.exports\t=\tfunction(options)\t{ \t\tbannedWords\t=\t[]; \t\tif\t(typeof\toptions\t!==\t'undefined')\t{ \t\t\t\tconsole.log(options); \t\t\t\tbannedWords\t=\toptions.bannedWords\t||\t[]; \t\t}\n\nreturn\tfunction\tbannedWords(text,\tcallback)\t{ \t\t\t\tvar\twords\t=\ttext.split('\t'); \t\t\t\tvar\tvalidWords\t=\t[]; \t\t\t\t(words).forEach(function(word,\tindex)\t{ \t\t\t\t\t\tvar\taddWord\t=\ttrue;\n\nif\t(word.length\t<\t3)\t{ \t\t\t\t\t\t\t\taddWord\t=\tfalse; \t\t\t\t\t\t}\n\nif(addWord\t&&\tbannedWords.indexOf(word)\t>\t-1)\t{ \t\t\t\t\t\t\t\taddWord\t=\tfalse; \t\t\t\t\t\t}\n\nif\t(addWord)\t{ \t\t\t\t\t\t\t\tvalidWords.push(word);\t \t\t\t\t\t\t}\n\n//\tLast\titeration: \t\t\t\t\t\tif\t(index\t==\t(words.length\t-\t1))\t{ \t\t\t\t\t\t\t\tcallback(null,\tvalidWords.join(\"\t\")); \t\t\t\t\t\t} \t\t\t\t}); \t\t} }\n\nThis\tfile\tis\ta\tmodule\tthat,\tin\tmy\topinion,\tis\thighly\treusable\tand\thas\tgood cohesion:\n\nWe\tcan\timport\tit\teverywhere\t(even\tin\ta\tbrowser) The\tbanned\twords\tcan\tbe\tinjected\twhen\tcreating\tthe\tmodule\t(very useful\tfor\ttesting) It\tis\tnot\ttangled\twith\tthe\tapplication\tcode\n\nLaying\tdown\tthe\tcode\tthis\tway,\tour\tapplication\tmodule\twill\tlook\tsimilar\tto the\tfollowing:\n\nvar\t_\t=\trequire('lodash'); var\texpress\t=\trequire('express');\n\nvar\tremoveStopWords\t=\trequire('./remove-stop-words') ({bannedWords:\t[\"kitten\",\t\"puppy\",\t\"parrot\"]});\n\nvar\tapp\t=\texpress();\n\napp.get('filter',\tfunction(req,\tres)\t{ \t\tres.send(removeStopWords(req.query.text)); });\n\napp.listen(3000,\tfunction()\t{ \t\tconsole.log(\"app\tstarted\tin\tport\t3000\"); });\n\nAs\tyou\tcan\tsee,\twe\thave\tclearly\tseparated\tthe\tbusiness\tunit\t(the function\tthat\tcaptures\tthe\tbusiness\tlogic)\tfrom\tthe\toperational\tunit\t(the setup\tof\tthe\tserver).\n\nAs\tI\tmentioned\tbefore,\tI\tam\tnot\ta\tbig\tfan\tof\twriting\tthe\ttests\tprior\tto\tthe code,\tbut\tthey\tshould\tbe\twritten\t(in\tmy\topinion)\talongside\tthe\tcode,\tbut always\thaving\tin\tmind\tthe\tquestion\tmentioned\tbefore.\n\nThere\tseem\tto\tbe\ta\tpush\tin\tcompanies\tto\tadopt\ta\tTDD\tmethodology,\tbut it\tcould\tlead\tto\ta\tsignificant\tinefficiency,\tespecially\tif\tthe\tbusiness requirements\tare\tunclear\t(as\tthey\tare\t90%\tof\tthe\ttime)\tand\twe\tface changes\talong\tthe\tdevelopment\tprocess.\n\nUnit\ttesting\n\nNow\tthat\tour\tcode\tis\tin\ta\tbetter\tshape,\twe\tare\tgoing\tto\tunit\ttest\tour function.\tWe\twill\tuse\tMocha\tand\tChai\tto\taccomplish\tsuch\ttask:\n\nvar\tremoveStopWords\t=\trequire('./remove-stop-words') ({bannedWords:\t[\"kitten\",\t\"parrot\"]});\n\nvar\tchai\t=\trequire('chai'); var\tassert\t=\tchai.assert; chai.should(); var\texpect\t=\tchai.expect;\n\ndescribe('When\texecuting\t\"removeStopWords\"',\t function()\t{\n\nit('should\tremove\twords\twith\tless\tthan\t3\tchars\tof\t length',\tfunction()\t{ \t\t\t\tremoveStopWords('my\tsmall\tlist\tof\twords',\t function(err,\tresponse)\t{ \t\t\t\t\t\texpect(response).to.equal(\"small\tlist\twords\"); \t\t\t\t}); \t\t});\n\nit('should\tremove\textra\twhite\tspaces',\tfunction()\t{ \t\t\t\tremoveStopWords('my\tsmall\t\t\t\t\t\t\tlist\tof\twords',\t function(err,\tresponse)\t{ \t\t\t\t\t\texpect(response).to.equal(\"small\tlist\twords\"); \t\t\t\t}); \t\t});\n\nit('should\tremove\tbanned\twords',\tfunction()\t{ \t\t\t\tremoveStopWords('My\tkitten\tis\tsleeping',\t function(err,\tresponse)\t{ \t\t\t\t\t\texpect(response).to.equal(\"sleeping\"); \t\t\t\t}); \t\t});\n\nit('should\tnot\tfail\twith\tnull\tas\tinput',\tfunction()\t { \t\t\t\tremoveStopWords(null,\tfunction(err,\tresponse)\t{ \t\t\t\t\t\texpect(response).to.equal(\"small\tlist\twords\"); \t\t\t\t}); \t\t});\n\nit('should\tfail\tif\tthe\tinput\tis\tnot\ta\tstring',\t function()\t{ \t\t\t\ttry\t{ \t\t\t\t\t\tremoveStopWords(5,\tfunction(err,\tresponse)\t{}); \t\t\t\t\t\tassert.fail(); \t\t\t\t} \t\t\t\tcatch(err)\t{ \t\t\t\t} \t\t}); });\n\nAs\tyou\tcan\tsee,\twe\thave\tcovered\tpretty\tmuch\tevery\tsingle\tcase\tand branch\tinside\tour\tapplication,\tbut\thow\tis\tour\tcode\tcoverage\tlooking?\n\nUntil\tnow,\twe\thave\tmentioned\tit,\tbut\tnever\tactually\tmeasured\tit.\tWe\tare going\tto\tuse\tone\ttool,\tcalled\tIstanbul,\tto\tmeasure\tthe\ttest\tcoverage:\n\nnpm\tinstall\t-g\tistanbul\n\nThis\tshould\tinstall\tIstanbul.\tNow\twe\tneed\tto\trun\tthe\tcoverage\treport:\n\nistanbul\tcover\t_mocha\tmy-tests.js\n\nThis\twill\tproduce\tan\toutput\tsimilar\tto\tthe\tone\tshown\tin\tthe\tfollowing image:\n\nThis\twill\talso\tgenerate\ta\tcoverage\treport\tin\tHTML,\tpointing\tout\twhich lines,\tfunctions,\tbranches,\tand\tstatements\tare\tnot\tbeing\tcovered,\tas shown\tin\tthe\tfollowing\tscreenshot:\n\nAs\tyou\tcan\tsee,\twe\tare\tlooking\tpretty\twell.\tOur\tcode\t(not\tthe\ttests)\tis actually\twell\tcovered,\tespecially\tif\twe\tlook\tinto\tthe\tdetailed\treport\tfor\tour code\tfile,\tas\tshown\tin\tthe\tfollowing\timage:\n\nWe\tcan\tsee\tthat\tonly\tone\tbranch\t(the\tor\toperator\tin\tline\t7)\tis\tnot\tcovered and\tthe\tif\toperator\tin\tline\t6\tnever\tdiverted\tto\tthe\telse\toperator.\n\nWe\talso\tgot\tinformation\tabout\tthe\tnumber\tof\ttimes\ta\tline\tis\texecuted:\tit\tis showing\tin\tthe\tvertical\tbar\tbeside\tthe\tline\tnumber.\tThis\tinformation\tis also\tvery\tuseful\tto\tspot\tthe\thot\tareas\tof\tour\tapplication\twhere\tan optimization\twill\tbenefit\tthe\tmost.\n\nRegarding\tthe\tright\tlevel\tof\tcoverage,\tin\tthis\texample,\tit\tis\tfairly\teasy\tto go\tup\tto\t90%+,\tbut\tunfortunately,\tit\tis\tnot\tthat\teasy\tin\tproduction\n\nsystems:\n\nCode\tis\ta\tlot\tmore\tcomplex Time\tis\talways\ta\tconstraint Testing\tmight\tnot\tbe\tseen\tas\tproductive\ttime\n\nHowever,\tyou\tshould\texercise\tcaution\twhen\tworking\twith\ta\tdynamic language.\tIn\tJava\tor\tC#,\tcalling\ta\tfunction\tthat\tdoes\tnot\texist\tresults\tin\ta compilation\ttime\terror;\twhereas\tin\tJavaScript,\tit\twill\tresult\tin\ta\truntime error.\tThe\tonly\treal\tbarrier\tis\tthe\ttesting\t(manual\tor\tautomated),\tso\tit\tis\ta good\tpractice\tto\tensure\tthat\tat\tleast\tevery\tline\tis\texecuted\tonce.\tIn general\tcode\tcoverage,\tover\t75%\tshould\tbe\tgood\tenough\tfor\tthe majority\tof\tcases.\n\nEnd-to-end\ttesting\n\nIn\torder\tto\ttest\tour\tapplication\tend\tto\tend,\twe\tare\tgoing\tto\tneed\ta\tserver running\tit.\tUsually,\tend-to-end\ttests\tare\texecuted\tagainst\ta\tcontrolled environment,\tsuch\tas\ta\tQA\tbox\tor\ta\tpre-production\tmachine,\tto\tverify that\tour\tabout-to-be-deployed\tsoftware\tis\tbehaving\tas\texpected.\n\nIn\tthis\tcase,\tour\tapplication\tis\tan\tAPI,\tso\twe\tare\tgoing\tto\tcreate\tthe\tend- to-end\ttests,\twhich\tat\tthe\tsame\ttime,\tare\tgoing\tto\tbe\tused\tas\tintegration tests.\n\nHowever,\tin\ta\tfull\tapplication,\twe\tmight\twant\tto\thave\ta\tclear\tseparation between\tthe\tintegration\tand\tend-to-end\ttests\tand\tuse\tsomething\tlike Selenium\tto\ttest\tour\tapplication\tfrom\tthe\tUI\tpoint\tof\tview.\n\nSelenium\tis\ta\tframework\tthat\tallows\tour\tcode\tto\tsend\tinstructions\tto\tthe browser,\tas\tfollows:\n\nClick\tthe\tbutton\twith\tthe\tbutton1\tID Hover\tover\tthe\tdiv\telement\twith\tthe\tCSS\tclass\thighlighted\n\nIn\tthis\tway,\twe\tcan\tensure\tthat\tour\tapp\tflows\twork\tas\texpected,\tend\tto end,\tand\tour\tnext\trelease\tis\tnot\tgoing\tto\tbreak\tthe\tkey\tflows\tof\tour\tapp.\n\nLet's\tfocus\ton\tthe\tend-to-end\ttests\tfor\tour\tmicroservice.\tWe\thave\tbeen using\tChai\tand\tMocha\twith\ttheir\tcorresponding\tassertion\tinterfaces\tto\n\nunit\ttest\tour\tsoftware,\tand\tSinon.JS\tto\tmock\tservices\tfunctions\tand\tother elements\tto\tavoid\tthe\tcalls\tbeing\tpropagated\tto\tthird-party\tweb\tservices or\tget\ta\tcontrolled\tresponse\tfrom\tone\tmethod.\n\nNow,\tin\tour\tend-to-end\ttest\tplan,\twe\tactually\twant\tto\tissue\tthe\tcalls\tto our\tservice\tand\tget\tthe\tresponse\tto\tvalidate\tthe\tresults.\n\nThe\tfirst\tthing\twe\tneed\tto\tdo\tis\trun\tour\tmicroservice\tsomewhere.\tWe\tare going\tto\tuse\tour\tlocal\tmachine\tjust\tfor\tconvenience,\tbut\twe\tcan\texecute these\ttests\tin\ta\tcontinuous\tdevelopment\tenvironment\tagainst\ta\tQA machine.\n\nSo,\tlet's\tstart\tthe\tserver:\n\nnode\tstop-words.js\n\nI\tcall\tmy\tscript\tstop-words.js\tfor\tconvenience.\tOnce\tthe\tserver\tis running,\twe\tare\tready\tto\tstart\ttesting.\tIn\tsome\tsituations,\twe\tmight\twant our\ttest\tto\tstart\tand\tstop\tthe\tserver\tso\tthat\teverything\tis\tself-contained. Let's\tsee\ta\tsmall\texample\tabout\thow\tto\tdo\tit:\n\nvar\texpress\t=\trequire('express');\n\nvar\tmyServer\t=\texpress();\n\nvar\tchai\t=\trequire('chai');\n\nmyServer.get('endpoint',\tfunction(req,\tres){ \t\tres.send('endpoint\treached'); });\n\nvar\tserverHandler;\n\nbefore(function(){ \t\tserverHandler\t=\tmyServer.listen(3000); });\n\ndescribe(\"When\texecuting\t'GET'\tinto\tendpoint\",\t function(){ \t\tit(\"should\treturn\t'endpoint\treached'\",\tfunction(){ \t\t\t\t//\tYour\ttest\tlogic\there.\thttp://localhost:3000\tis\t your\tserver. \t\t}); });\n\nafter(function(){ \t\tserverHandler.close(); });\n\nAs\tyou\tcan\tsee,\tExpress\tprovides\ta\thandler\tto\toperate\tthe\tserver programmatically,\tso\tit\tis\tas\tsimple\tas\tmaking\tuse\tof\tthe\tbefore()\tand after()\tfunctions\tto\tdo\tthe\ttrick.\n\nIn\tour\texample,\twe\tare\tgoing\tto\tassume\tthat\tthe\tserver\tis\trunning.\tIn order\tto\tissue\tthe\trequests,\twe\tare\tgoing\tto\tuse\ta\tlibrary\tcalled\trequest to\tissue\tthe\tcalls\tto\tthe\tserver.\n\nThe\tway\tto\tinstall\tit,\tas\tusual,\tis\tto\texecute\tnpm\tinstall\trequest.\tOnce\tit is\tfinished,\twe\tcan\tmake\tuse\tof\tthis\tamazing\tlibrary:\n\nvar\tchai\t=\trequire('chai'); var\tchaiHttp\t=\trequire('chai-http'); var\texpect\t=\tchai.expect; chai.use(chaiHttp);\n\ndescribe(\"when\twe\tissue\ta\t'GET'\tto\tfilter\twith\t text='aaaa\tbbbb\tcccc'\",\tfunction(){ \t\tit(\"should\treturn\tHTTP\t200\",\tfunction(done)\t{ \t\t\t\tchai.request('http:/localhost:3000') \t\t\t\t\t\t.get('filter') \t\t\t\t\t\t.query({text:\t'aa\tbb\tccccc'}).end(function(req,\t res){ \t\t\t\t\t\t\t\texpect(res.status).to.equal(200); \t\t\t\t\t\t\t\tdone(); \t\t\t\t\t\t}); \t\t}); });\n\ndescribe(\"when\twe\tissue\ta\t'GET'\tto\tfilter\twith\t text='aa\tbb\tccccc'\",\tfunction(){ \t\tit(\"should\treturn\t'ccccc'\",\tfunction(done)\t{ \t\t\t\tchai.request('http://localhost:3000') \t\t\t\t\t\t.get('filter') \t\t\t\t\t\t.query({text:\t'aa\tbb\tccccc'}).end(function(req,\t res){ \t\t\t\t\t\t\t\texpect(res.text).to.equal('ccccc'); \t\t\t\t\t\t\t\tdone(); \t\t\t\t\t\t}); \t\t}); });\n\ndescribe(\"when\twe\tissue\ta\t'GET'\tto\tfilter\twith\t text='aa\tbb\tcc'\",\tfunction(){ \t\tit(\"should\treturn\t''\",\tfunction(done)\t{ \t\t\t\tchai.request('http://localhost:3000') \t\t\t\t\t\t.get('/filter') \t\t\t\t\t\t.query({text:\t'aa\tbb\tcc'}).end(function(req,\t res){ \t\t\t\t\t\t\t\texpect(res.text).to.equal(''); \t\t\t\t\t\t\t\tdone(); \t\t\t\t\t\t}); \t\t}); });\n\nWith\tthe\tsimple\ttest\tfrom\tearlier,\twe\tmanaged\tto\ttest\tour\tserver\tin\ta\tway that\tensures\tthat\tevery\tsingle\tmobile\tpart\tof\tthe\tapplication\thas\tbeen executed.\n\nThere\tis\ta\tparticularity\there\tthat\twe\tdidn't\thave\tbefore:\n\nit(\"should\treturn\t'ccccc'\",\tfunction(done)\t{ \t\t\t\tchai.request('http://localhost:3000') \t\t\t\t\t\t.get('/filter') \t\t\t\t\t\t.query({text:\t'aa\tbb\tccccc'}).end(function(req,\t res){ \t\t\t\t\t\t\t\texpect(res.text).to.equal('ccccc'); \t\t\t\t\t\t\t\tdone(); \t\t\t\t\t\t}); \t\t});\n\nIf\tyou\ttake\ta\tlook\tat\tthe\thighlighted\tcode,\tyou\tcan\tsee\ta\tnew\tcallback called\tdone.\tThis\tcallback\thas\tone\tmission:\tprevent\tthe\ttest\tfrom\tfinishing until\tit\tis\tcalled,\tso\tthat\tthe\tHTTP\trequest\thas\ttime\tto\tbe\texecuted\tand return\tthe\tappropriated\tvalue.\tRemember,\tNode.js\tis\tasynchronous, there\tis\tno\tsuch\tthing\tas\ta\tthread\tbeing\tblocked\tuntil\tone\toperation finishes.\n\nOther\tthan\tthat,\twe\tare\tusing\ta\tnew\tDSL\tintroduced\tby\tchai-http\tto\tbuild get\trequests.\n\nThis\tlanguage\tallows\tus\tto\tbuild\ta\tlarge\trange\tof\tcombinations,\tconsider the\tfollowing,\tfor\texample:\n\nchai.request('http://mydomain.com') \t\t.post('/myform') \t\t.field('_method',\t'put') \t\t.field('username',\t'dgonzalez') \t\t.field('password',\t'123456').end(...)\n\nIn\tthe\tpreceding\trequest,\twe\tare\tsubmitting\ta\tform\tthat\tlooks\tlike\ta\tlogin, so\tthat\tin\tthe\tend()\tfunction,\twe\tcan\tassert\tthe\treturn\tfrom\tthe\tserver.\n\nThere\tare\tan\tendless\tnumber\tof\tcombinations\tto\ttest\tour\tAPIs\twith\tchai- http.\n\nManual\ttesting\t–\tthe\tnecessary\tevil\n\nNo\tmatter\thow\tmuch\teffort\twe\tput\tin\tto\tour\tautomated\ttesting,\tthere\twill always\tbe\ta\tnumber\tof\tmanual\ttests\texecuted.\n\nSometimes,\twe\tneed\tto\tdo\tit\tjust\twhen\twe\tare\tdeveloping\tour\tAPI,\tas\twe want\tto\tsee\tthe\tmessages\tgoing\tfrom\tour\tclient\tto\tthe\tserver,\tbut\tsome other\ttimes,\twe\tjust\twant\tto\thit\tour\tendpoints\twith\ta\tpre-forged\trequest\tto cause\tthe\tsoftware\tto\texecute\tas\twe\texpect.\n\nIn\tthe\tfirst\tcase,\twe\tare\tgoing\tto\ttake\tthe\tadvantage\tof\tNode.js\tand\tits dynamic\tnature\tto\tbuild\ta\tproxy\tthat\twill\tsniff\tall\tthe\trequests\tand\tlog them\tto\ta\tterminal\tso\tthat\twe\tcan\tdebug\twhat\tis\tgoing\ton.\tThis\ttechnique can\tbe\tused\tto\tleverage\tthe\tcommunication\tbetween\ttwo\tmicroservices and\tsee\twhat\tis\tgoing\ton\twithout\tinterrupting\tthe\tflow.\n\nIn\tthe\tsecond\tcase,\twe\tare\tgoing\tto\tuse\tsoftware\tcalled\tPostman\tto issue\trequests\tagainst\tour\tserver\tin\ta\tcontrolled\tway.\n\nBuilding\ta\tproxy\tto\tdebug\tour\tmicroservices\n\nMy\tfirst\tcontact\twith\tNode.js\twas\texactly\tdue\tto\tthis\tproblem:\ttwo\tservers sending\tmessages\tto\teach\tother,\tcausing\tmisbehavior\twithout\tan apparent\tcause.\n\nIt\tis\ta\tvery\tcommon\tproblem\tthat\thas\tmany\talready-working\tsolutions (man-in-the-middle\tproxies\tbasically),\tbut\twe\tare\tgoing\tto\tdemonstrate how\tpowerful\tNode.js\tis:\n\nvar\thttp\t=\trequire('http'); var\thttpProxy\t=\trequire('http-proxy'); var\tproxy\t=\thttpProxy.createProxyServer({});\n\nhttp.createServer(function(req,\tres)\t{ \t\tconsole.log(req.rawHeaders); \t\tproxy.web(req,\tres,\t{\ttarget:\t 'http://localhost:3000'\t}); }).listen(4000);\n\nIf\tyou\tremember\tfrom\tthe\tprevious\tsection,\tour\tstop-words.js\tprogram was\trunning\ton\tthe\tport\t3000.\tWhat\twe\thave\tdone\twith\tthis\tcode\tis\tcreate a\tproxy\tusing\thttp-proxy,\tthat\ttunnels\tall\tthe\trequests\tmade\ton\tthe\tport 4000\tinto\tthe\tport\t3000\tafter\tlogging\tthe\theaders\tinto\tthe\tconsole.\n\nIf\twe\trun\tthe\tprogram\tafter\tinstalling\tall\tthe\tdependencies\twith\tthe\tnpm install\tcommand\tin\tthe\troot\tof\tthe\tproject,\twe\tcan\tsee\thow\teffectively the\tproxy\tis\tlogging\tthe\trequests\tand\ttunneling\tthem\tinto\tthe\ttarget\thost:\n\ncurl\thttp://localhost:4000/filter?text=aaa\n\nThis\twill\tproduce\tthe\tfollowing\toutput:\n\nThis\texample\tis\tvery\tsimplistic,\tbut\tthis\tsmall\tproxy\tcould\tvirtually\tbe deployed\tanywhere\tin\tbetween\tour\tmicroservices\tand\tgive\tus\tvery valuable\tinformation\tabout\twhat\tis\tgoing\ton\tin\tthe\tnetwork.\n\nPostman\n\nOut\tof\tall\tthe\tsoftware\tthat\twe\tcan\tfind\ton\tthe\tInternet\tfor\ttesting\tAPIs, Postman\tis\tmy\tfavorite.\tIt\tstarted\tas\ta\textension\tfor\tGoogle\tChrome,\tbut nowadays,\thas\ttaken\tthe\tform\tof\ta\tstandalone\tapp\tbuilt\ton\tthe\tChrome runtime.\n\nIt\tcan\tbe\tfound\tin\tthe\tChrome\tweb\tstore,\tand\tit\tis\tfree\t(so\tyou\tdon't\tneed to\tpay\tfor\tit),\talthough\tit\thas\ta\tversion\tfor\tteams\twith\tmore\tadvanced features\tthat\tis\tpaid.\n\nThe\tinterface\tis\tvery\tconcise\tand\tsimple,\tas\tshown\tin\tthe\tfollowing screenshot:\n\nOn\tthe\tleft-hand\tside,\twe\tcan\tsee\tthe\tHistory\tof\trequests,\tas\twell\tas\tthe Collections\tof\trequests,\twhich\twill\tbe\tvery\thandy\tfor\twhen\twe\tare working\ton\ta\tlong-term\tproject\tand\twe\thave\tsome\tcomplicated\trequests to\tbe\tbuilt.\n\nWe\tare\tgoing\tto\tuse\tagain\tour\tstop-words.js\tmicroservice\tto\tshow\thow powerful\tPostman\tcan\tbe.\n\nTherefore,\tthe\tfirst\tthing\tis\tto\tmake\tsure\tthat\tour\tmicroservice\tis\trunning. Once\tit\tis,\tlet's\tissue\ta\trequest\tfrom\tPostman,\tas\tshown\tin\tthe\tfollowing screenshot:\n\nAs\tsimple\tas\tthat,\twe\thave\tissued\tthe\trequest\tfor\tour\tservice\t(using\tthe GET\tverb)\tand\tit\thas\treplied\twith\tthe\ttext\tfiltered:\tvery\tsimple\tand effective.\n\nNow\timagine\tthat\twe\twant\tto\texecute\tthat\tcall\tover\tNode.js.\tPostman comes\twith\ta\tvery\tinteresting\tfeature,\twhich\tis\tgenerating\tthe\tcode\tfor the\trequests\tthat\twe\tissue\tfrom\tthe\tinterface.\tIf\tyou\tclick\ton\tthe\ticon under\tthe\tsave\tbutton\ton\tthe\tright-hand\tside\tof\tthe\twindow,\tthe appearing\tscreen\twill\tdo\tthe\tmagic:\n\nLet's\ttake\ta\tlook\tat\tthe\tgenerated\tcode:\n\nvar\thttp\t=\trequire(\"http\");\n\nvar\toptions\t=\t{ \t\t\"method\":\t\"GET\", \t\t\"hostname\":\t\"localhost\", \t\t\"port\":\t\"3000\", \t\t\"path\":\t\"/filter?text=aaa%20bb%20cc\", \t\t\"headers\":\t{ \t\t\t\t\"cache-control\":\t\"no-cache\", \t\t\t\t\"postman-token\":\t\"912cacd8-bcc0-213f-f6ff- f0bcd98579c0\" \t\t} };\n\nvar\treq\t=\thttp.request(options,\tfunction\t(res)\t{ \t\tvar\tchunks\t=\t[];\n\nres.on(\"data\",\tfunction\t(chunk)\t{ \t\t\t\tchunks.push(chunk); \t\t});\n\nres.on(\"end\",\tfunction\t()\t{\n\nvar\tbody\t=\tBuffer.concat(chunks); \t\t\t\tconsole.log(body.toString()); \t\t}); });\n\nreq.end();\n\nIt\tis\tquite\tan\teasy\tcode\tto\tunderstand,\tespecially\tif\tyou\tare\tfamiliar\twith the\tHTTP\tlibrary.\n\nWith\tPostman,\twe\tcan\talso\tsend\tcookies,\theaders,\tand\tforms\tto\tthe servers\tin\torder\tto\tmimic\tthe\tauthentication\tthat\tan\tapplication\twill\tfulfill by\tsending\tthe\tauthentication\ttoken\tor\tcookie\tacross.\n\nLet's\tredirect\tour\trequest\tto\tthe\tproxy\tthat\twe\tcreated\tin\tthe\tpreceding section,\tas\tshown\tin\tthe\tfollowing\tscreenshot:\n\nIf\tyou\thave\tthe\tproxy\tand\tthe\tstop-words.js\tmicroservice\trunning,\tyou should\tsee\tsomething\tsimilar\tto\tthe\tfollowing\toutput\tin\tthe\tproxy:\n\nThe\theader\tthat\twe\tsent\tover\twith\tPostman,\tmy-awesome-header,\twill show\tup\tin\tthe\tlist\tof\traw\theaders.\n\nDocumenting\tmicroservices\n\nIn\tthis\tsection,\twe\tare\tgoing\tto\tlearn\thow\tto\tuse\tSwagger\tto\tdocument APIs.\tSwagger\tis\tan\tAPI\tmanager\tthat\tfollows\tthe\tOpen\tAPI\tstandard, so\tthat\tit\tis\ta\tcommon\tlanguage\tfor\tall\tthe\tAPI\tcreators.\tWe\twill\tdiscuss how\tto\twrite\tdefinitions\tand\twhy\tit\tis\tso\timportant\tto\tagree\ton\thow\tto describe\tresources.\n\nDocumenting\tAPIs\twith\tSwagger\n\nDocumentation\tis\talways\ta\tproblem.\tNo\tmatter\thow\thard\tyou\ttry,\tit\twill always\teventually\tgo\tout\tof\tdate.\tLuckily,\tin\tthe\tpast\tfew\tyears,\tthere\thas been\ta\tpush\tinto\tproducing\ta\thigh\tquality\tdocumentation\tfor\tREST\tAPIs.\n\nAPI\tmanagers\thave\tplayed\ta\tkey\trole\tin\tit,\tand\tSwagger\tis\tparticularly\tan interesting\tplatform\tto\tlook\tat.\tMore\tthan\ta\tmodule\tfor\tdocumentation, Swagger\tmanages\tyour\tAPI\tin\ta\tsuch\tway\tthat\tgives\tyou\ta\tholistic\tview of\tyour\twork.\n\nLet's\tstart\tinstalling\tit:\n\nnpm\tinstall\t-g\tswagger\n\nThis\twill\tinstall\tSwagger\tsystem-wide,\tso\tit\twill\tbe\tanother\tcommand\tin our\tsystem.\tNow,\twe\tneed\tto\tcreate\ta\tproject\tusing\tit:\n\nswagger\tproject\tcreate\tmy-project\n\nThis\tcommand\twill\tallow\tyou\tto\tchoose\tdifferent\tweb\tframeworks.\tWe\tare going\tto\tchoose\tExpress,\tas\tit\tis\tthe\tone\tthat\twe\thave\talready\tbeen using.\tThe\toutput\tof\tthe\tpreceding\tcommand\tis\tshown\tin\tthe\tfollowing screenshot:\n\nThis\tscreenshot\tis\tshowing\thow\tto\tstart\ta\tproject\twith\tSwagger\n\nNow\twe\tcan\tfind\ta\tnew\tfolder,\tcalled\tmy-project,\tthat\tlooks\tlike\tthe following\timage:\n\nThe\tstructure\tis\tself-explanatory\tand\tit\tis\tthe\tcommon\tlayout\tof\ta\tNode.js application:\n\napi:\tHere,\tour\tAPI\tcode\twill\tlay\tdown config:\tAll\tthe\tconfiguration\tsits\tin\there node_modules:\tThis\tis\ta\tfolder\twith\tall\tthe\tdependencies\trequired\tto run\tour\tapplication test:\tThis\tis\twhere\tSwagger\thas\tgenerated\tsome\tdummy\ttests\tand where\twe\tcould\tadd\tour\town\ttests\n\nSwagger\tcomes\twith\tan\timpressive\tfeature:\tan\tembedded\teditor\tthat allows\tyou\tto\tmodel\tthe\tendpoints\tof\tyour\tAPI.\tIn\torder\tto\trun\tit,\tfrom within\tthe\tgenerated\tfolder,\texecute\tthe\tfollowing\tcommand:\n\nSwagger\tproject\tedit\n\nIt\twill\topen\tSwagger\tEditor\tin\tthe\tdefault\tbrowser,\twith\ta\twindow\tsimilar to\tthe\tfollowing\timage:\n\nSwagger\tmakes\tuse\tof\tYet\tAnother\tMarkup\tLanguage\t(YAML).\tIt\tis\ta language\tthat\tis\tvery\tsimilar\tto\tJSON,\tbut\twith\ta\tdifferent\tsyntax.\n\nIn\tthis\tdocument,\twe\tcan\tcustomize\ta\tnumber\tof\tthings,\tsuch\tas\tpaths (routes\tin\tour\tapplication).\tLet's\ttake\ta\tlook\tat\tthe\tpath\tgenerated\tby Swagger:\n\nhello: \t\t#\tbinds\ta127\tapp\tlogic\tto\ta\troute \t\tx-swagger-router-controller:\thello_world \t\tget: \t\t\t\tdescription:\tReturns\t'Hello'\tto\tthe\tcaller \t\t\t\t#\tused\tas\tthe\tmethod\tname\tof\tthe\tcontroller \t\t\t\toperationId:\thello \t\t\t\tparameters: \t\t\t\t\t\t-\tname:\tname \t\t\t\t\t\t\t\tin:\tquery \t\t\t\t\t\t\t\tdescription:\tThe\tname\tof\tthe\tperson\tto\twhom\tto\t say\thello \t\t\t\t\t\t\t\trequired:\tfalse \t\t\t\t\t\t\t\ttype:\tstring \t\t\t\tresponses: \t\t\t\t\t\t\"200\": \t\t\t\t\t\t\t\tdescription:\tSuccess \t\t\t\t\t\t\t\tschema: \t\t\t\t\t\t\t\t\t\t#\ta\tpointer\tto\ta\tdefinition \t\t\t\t\t\t\t\t\t\t$ref:\t\"#definitions/HelloWorldResponse\" \t\t\t\t\t\t#\tresponses\tmay\tfall\tthrough\tto\terrors \t\t\t\t\t\tdefault: \t\t\t\t\t\t\t\tdescription:\tError \t\t\t\t\t\t\t\tschema: \t\t\t\t\t\t\t\t\t\t$ref:\t\"#/definitions/ErrorResponse\"\n\nThe\tdefinition\tis\tself-documented.\tBasically,\twe\twill\tconfigure\tthe parameters\tused\tby\tour\tendpoint,\tbut\tin\ta\tdeclarative\tway.\tThis\tendpoint is\tmapping\tthe\tincoming\tactions\tinto\tthe\thello_world\tcontroller,\tand specifically\tinto\tthe\thello\tmethod,\twhich\tis\tdefined\tby\tthe\tid\toperation. Let's\tsee\twhat\tSwagger\thas\tgenerated\tfor\tus\tin\tthis\tcontroller:\n\n'use\tstrict';\n\nvar\tutil\t=\trequire('util');\n\nmodule.exports\t=\t{ \t\thello:\thello };\n\nfunction\thello(req,\tres)\t{ \t\tvar\tname\t=\treq.swagger.params.name.value\t||\n\n'stranger'; \t\tvar\thello\t=\tutil.format('Hello,\t%s!',\tname); \t\tres.json(hello); }\n\nThis\tcode\tcan\tbe\tfound\tin\tthe\tapi/controllers\tfolder\tof\tthe\tproject.\tAs you\tcan\tsee,\tit\tis\ta\tpretty\tstandard\tExpress\tcontroller\tpacked\tas\ta module\t(well-cohesioned).\tThe\tonly\tstrange\tline\tis\tthe\tfirst\tone\tin\tthe hello\tfunction,\twhere\twe\tpick\tup\tthe\tparameters\tfrom\tSwagger.\tWe\twill come\tback\tto\tthis\tlater,\tonce\twe\trun\tthe\tproject.\n\nThe\tsecond\tpart\tof\tthe\tendpoint\tis\tthe\tresponses.\tAs\twe\tcan\tsee,\twe\tare referencing\ttwo\tdefinitions:\tHelloWorldResponse\tfor\thttp\tcode\t200\tand ErrorResponse\tfor\tthe\trest\tof\tthe\tcodes.\tThese\tobjects\tare\tdefined\tin\tthe following\tcode:\n\ndefinitions: \t\tHelloWorldResponse: \t\t\t\trequired: \t\t\t\t\t\t-\tmessage \t\t\t\tproperties: \t\t\t\t\t\tmessage: \t\t\t\t\t\t\t\ttype:\tstring \t\tErrorResponse: \t\t\t\trequired: \t\t\t\t\t\t-\tmessage \t\t\t\tproperties: \t\t\t\t\t\tmessage: \t\t\t\t\t\t\t\ttype:\tstring\n\nThis\tis\tsomething\treally\tinteresting,\talthough\twe\tare\tusing\ta\tdynamic language,\tthe\tcontract\tis\tbeing\tdefined\tby\tSwagger\tso\tthat\twe\thave\ta language-agnostic\tdefinition\tthat\tcan\tbe\tconsumed\tby\ta\tnumber\tof different\ttechnologies,\trespecting\tthe\tprinciple\tof\ttechnology heterogeneity\tthat\twe\twere\ttalking\tabout\tearlier\tin\tChapter\t1, Microservices\tArchitecture,\tand\tChapter\t2,\tMicroservices\tin\tNode.js\t– Seneca\tand\tPM2\tAlternatives.\n\nAfter\texplaining\thow\tthe\tdefinition\tworks,\tit\tis\ttime\tto\tstart\tthe\tserver:\n\nswagger\tproject\tstart\n\nThis\tshould\tproduce\tan\toutput\tthat\tis\tvery\tsimilar\tto\tthe\tfollowing\tcode:\n\nStarting:\tC:\\my-project\\app.js... \t\tproject\tstarted\there:\thttp://localhost:10010/ \t\tproject\twill\trestart\ton\tchanges. \t\tto\trestart\tat\tany\ttime,\tenter\t`rs` try\tthis: curl\thttp://127.0.0.1:10010/hello?name=Scott\n\nNow,\tif\twe\tfollow\tthe\tinstructions\tof\tthe\toutput\tand\texecute\tthe\tcurl command,\twe\tget\tthe\tfollowing\toutput:\n\ncurl\thttp://127.0.0.1:10010/hello?name=David \"Hello\tDavid!\"\n\nSwagger\tis\tbinding\tthe\tname\tquery\tparameter\tto\tthe\tSwagger\tparameter specified\tin\tthe\tYAML\tdefinition.\tThis\tmay\tsound\tbad,\tas\twe\tare\tcoupling our\tsoftware\tto\tSwagger,\tbut\tit\tgives\tyou\tan\timmense\tbenefit:\tSwagger allows\tyou\tto\ttest\tthe\tendpoint\tthrough\tthe\teditor.\tLet's\tsee\thow\tit\tworks.\n\nOn\tthe\tright-hand\tside\tof\tthe\teditor,\tyou\tcan\tsee\ta\tbutton\twith\tthe\tTry this\toperation\tlabel,\tas\tshown\tin\tthe\tfollowing\tscreenshot:\n\nOnce\tyou\tclick\tit,\tit\twill\tpresent\tyou\ta\tform\tthat\tallows\tyou\tto\ttest\tthe endpoint,\tas\tshown\tin\tthe\tfollowing\tscreenshot:\n\nThere\tis\ta\twarning\tmessage\ton\tthis\tform\tabout\tcross-origin\trequests.\tWe don't\tneed\tto\tworry\tabout\tit\twhen\tdeveloping\tin\tour\tlocal\tmachine; however,\twe\tcould\thave\tproblems\twhen\ttesting\tother\thosts\tusing\tthe Swagger\tEditor.\n\nNote\n\nFor\tmore\tinformation,\tvisit\tthe\tfollowing\tURL:\n\nhttps://en.wikipedia.org/wiki/Cross-origin_resource_sharing\n\nEnter\ta\tvalue\tfor\tthe\tname\tparameter,\tand\tafter\tthat,\tclick\ton\tSend Request,\tas\tshown\tin\tthe\tfollowing\timage:\n\nThis\tis\ta\tresponse\texample\tusing\tSwagger\tEditor\tto\ttest\tthe\tendpoint\n\nBe\taware\tthat,\tfor\tthis\ttest\tto\twork,\tour\tapp\tserver\thas\tto\tbe\tup\tand running.\n\nGenerating\ta\tproject\tfrom\tthe\tSwagger definition\n\nUntil\tnow,\twe\thave\tbeen\tplaying\twith\tSwagger\tand\tthe\tgenerated\tproject, but\twe\tare\tnow\tgoing\tto\tgenerate\tthe\tproject\tfrom\tthe\tswagger.yaml\tfile. We\twill\tuse\tthe\talready\tgenerated\tproject\tas\ta\tstarting\tpoint,\tbut\twe\twill add\ta\tnew\tendpoint:\n\nswagger:\t\"2.0\" info: \t\tversion:\t\"0.0.1\" \t\ttitle:\tStop\tWords\tFiltering\tApp host:\tlocalhost:8000 basePath:\t schemes: \t\t-\thttp \t\t-\thttps\n\nconsumes: \t\t-\tapplicationjson produces: \t\t-\tapplication/json paths: \t\tstopwords: \t\t\t\tx-swagger-router-controller:\tstop_words \t\t\t\tget: \t\t\t\t\t\tdescription:\tRemoves\tthe\tstop\twords\tfrom\tan\t arbitrary\tinput\ttext. \t\t\t\t\t\toperationId:\tstopwords \t\t\t\t\t\tparameters: \t\t\t\t\t\t\t\t-\tname:\ttext \t\t\t\t\t\t\t\t\t\tin:\tquery \t\t\t\t\t\t\t\t\t\tdescription:\tThe\ttext\tto\tbe\tsanitized \t\t\t\t\t\t\t\t\t\trequired:\tfalse \t\t\t\t\t\t\t\t\t\ttype:\tstring \t\t\t\t\t\tresponses: \t\t\t\t\t\t\t\t\"200\": \t\t\t\t\t\t\t\t\t\tdescription:\tSuccess \t\t\t\t\t\t\t\t\t\tschema: \t\t\t\t\t\t\t\t\t\t\t\t$ref:\t\"#definitions/StopWordsResponse\" \t\t/swagger: \t\t\t\tx-swagger-pipe:\tswagger_raw definitions: \t\tStopWordsResponse: \t\t\t\trequired: \t\t\t\t\t\t-\tmessage \t\t\t\tproperties: \t\t\t\t\t\tmessage: \t\t\t\t\t\t\t\ttype:\tstring\n\nThis\tendpoint\tmight\tsound\tvery\tfamiliar\tto\tyou,\tas\twe\tunit\ttested\tit\tearlier in\tthis\tchapter.\tAs\tyou\tprobably\tknow\tby\tnow,\tthe\tSwagger\tEditor\tis\tquite cool:\tit\tprovides\tfeedback\tas\tyou\ttype\ton,\tabout\twhat\tis\tgoing\ton\tin\tthe YAML\tfile,\tas\twell\tas\tsaves\tthe\tchanges.\n\nThe\tnext\tstep\tis\tto\tdownload\tthe\tSwagger\tcode\tgenerator\tfrom https://github.com/swagger-api/swagger-codegen.\tIt\tis\ta\tJava\tproject,\tso we\tare\tgoing\tto\tneed\tthe\tJava\tSDK\tand\tMaven\tto\tbuild\tit,\tas\tfollows:\n\nmvn\tpackage\n\nCodegen\tis\ta\ttool\tthat\tallow\tus\tto\tread\tthe\tAPI\tdefinition\tfrom\tthe Swagger\tYAML\tand\tbuild\tthe\tbasic\tstructure\tfor\ta\tproject\tin\ta\tlanguage\n\nof\tour\tchoice,\tin\tthis\tcase,\tNode.js.\n\nThe\tpreceding\tcommand\tin\tthe\troot\tof\tthe\tproject\tshould\tbuild\tall\tthe submodules.\tNow,\tit\tis\tas\teasy\tas\texecuting\tthe\tfollowing\tcommand\tin the\troot\tof\tthe\tswagger-codegen\tfolder:\n\njava\t-jar\tmodules/swagger-codegen-cli/target/swagger- codegen-cli.jar\tgenerate\t-i\tmy-project.yaml\t-l\tnodejs\t -o\tmy-project\n\nThe\tSwagger\tcode\tgenerator\tsupports\ta\tnumber\tof\tlanguages.\tHere,\tthe trick\tis\tthat\twhen\tusing\tit\tfor\tmicroservices,\twe\tcan\tdefine\tthe\tinterface and\tthen\tuse\tthe\tmost\tappropriate\ttechnology\tto\tbuild\tour\tservice.\n\nIf\tyou\tgo\tto\tthe\tmy-project\tfolder,\tyou\tshould\tfind\tthe\tfull\tstructure\tof\tthe project\tin\tthere,\tready\tto\tstart\tcoding.\n\nSummary\n\nIn\tthis\tchapter,\tyou\tlearned\thow\tto\ttest\tand\tdocument\tmicroservices.\tIt\tis usually\tthe\tforgotten\tactivity\tin\tsoftware\tdevelopment,\tdue\tto\tthe pressures\tto\tdeliver\tnew\tfunctionalities,\tbut\tin\tmy\topinion,\tit\tis\ta\trisky decision.\tWe\thave\tto\tfind\tthe\tbalance\tbetween\ttoo\tmuch\tand\tvery\tlittle testing.\tIn\tgeneral,\twe\twill\talways\ttry\tto\tfind\tthe\tright\tproportion\tfor\tunit, integration\tand\tend-to-end\ttests.\n\nYou\talso\tlearned\tabout\tmanual\ttesting\tand\tthe\ttools\tto\tefficiently\ttest\tour software\tmanually\t(there\tis\talways\ta\tcomponent\tof\tmanual\ttesting).\n\nAnother\tinteresting\tpoint\tis\tthe\tdocumentation\tand\tAPI\tmanagement.\tIn this\tcase,\twe\tgot\tto\tknow\tSwagger,\twhich\tis\tprobably\tthe\tmost\tpopular API\tmanager\tthat\tled\tto\tthe\tcreation\tof\tthe\tOpen\tAPI\tstandard.\n\nIf\tyou\twant\tto\tgo\tdeeper\tin\tto\tthe\tAPI\tworld\t(there\tis\ta\tlot\tto\tlearn\tin\torder to\tbuild\ta\tpractical\tand\tefficient\tAPI),\tyou\tshould\tprobably\tbrowse http://apigee.com.\tApigee\tare\ta\tcompany\texpert\ton\tbuilding\tAPIs\tand providing\ttools\tfor\tdevelopers\tand\tenterprises\tthat\tcould\thelp\tyou\tto\tbuild a\tbetter\tAPI.\n\nChapter\t7.\tMonitoring Microservices\n\nMonitoring\tservers\tis\talways\ta\tcontroversial\tsubject.\tIt\tusually\tfalls\tunder system\tadministration,\tand\tsoftware\tengineers\tdon't\teven\tgo\tnear\tit,\tbut we\tare\tlosing\tone\tof\tthe\thuge\tbenefits\tof\tmonitoring:\tthe\tability\tto\treact quickly\tto\tfailures.\tBy\tmonitoring\tour\tsystem\tvery\tclosely,\twe\tcan\tbe aware\tof\tproblems\talmost\timmediately\tso\tthat\tthe\tactions\tto\tcorrect\tthe problem\tmay\teven\tsave\tus\tfrom\timpacting\tthe\tcustomers.\tAlong\twith monitoring,\tthere\tis\tthe\tconcept\tof\tperformance.\tBy\tknowing\thow\tour system\tbehaves\tduring\tload\tperiods,\twe\twill\tbe\table\tto\tanticipate\tthe necessity\tof\tscaling\tthe\tsystem.\tIn\tthis\tchapter,\twe\twill\tdiscuss\thow\tto monitor\tservers,\tand\tspecifically\tmicroservices,\tin\torder\tto\tmaintain\tthe stability\tof\tour\tsystem.\n\nIn\tthis\tchapter,\twe\twill\tcover\tthe\tfollowing\ttopics:\n\nMonitoring\tservices Monitoring\tusing\tPM2\tand\tKeymetrics Monitoring\tmetrics Simian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify Throughput\tand\tperformance\tdegradation\n\nMonitoring\tservices\n\nWhen\tmonitoring\ta\tmicroservice,\twe\tare\tinterested\tin\ta\tfew\tdifferent types\tof\tmetrics.\tThe\tfirst\tbig\tgroup\tof\tmetrics\tis\tthe\thardware\tresources, which\tare\tdescribed\tas\tfollows:\n\nMemory\tmetrics:\tThis\tindicates\thow\tmuch\tmemory\tis\tleft\tin\tour system\tor\tconsumed\tby\tour\tapplication CPU\tutilization:\tAs\tthe\tname\tsuggests,\tthis\tindicates\thow\tmuch CPU\tare\twe\tusing\tat\ta\tgiven\ttime Disk\tutilization:\tThis\tindicates\tthe\tI/O\tpressure\tin\tthe\tphysical\thard drives",
      "page_number": 204
    },
    {
      "number": 7,
      "title": "Monitoring Microservices",
      "start_page": 255,
      "end_page": 281,
      "detection_method": "regex_chapter_title",
      "content": "The\tsecond\tbig\tgroup\tis\tthe\tapplication\tmetrics,\tas\tfollows:\n\nNumber\tof\terrors\tper\ttime\tunit Number\tof\tcalls\tper\ttime\tunit Response\ttime\n\nEven\tthough\tboth\tgroups\tare\tconnected\tand\ta\tproblem\tin\tthe\thardware will\timpact\tthe\tapplication\tperformance\t(and\tthe\tother\tway\taround), knowing\tall\tof\tthem\tis\ta\tmust.\n\nHardware\tmetrics\tare\teasy\tto\tquery\tif\tour\tserver\tis\ta\tLinux\tmachine.\tOn Linux,\tall\tthe\tmagic\tof\thardware\tresources\thappens\tin\tthe\t/proc\tfolder. This\tfolder\tis\tmaintained\tby\tthe\tkernel\tof\tthe\tsystem\tand\tcontains\tfiles about\thow\tthe\tsystem\tbehaves\tregarding\ta\tnumber\tof\taspects\tin\tthe system.\n\nSoftware\tmetrics\tare\tharder\tto\tcollect\tand\twe\tare\tgoing\tto\tuse Keymetrics\tfrom\tthe\tcreators\tof\tPM2\tto\tmonitor\tour\tNode.js applications.\n\nMonitoring\tusing\tPM2\tand\tKeymetrics\n\nPM2,\tas\twe've\tseen\tbefore,\tis\ta\tvery\tpowerful\tinstrument\tto\trun\tNode applications,\tbut\tit\tis\talso\tvery\tgood\tat\tmonitoring\tstandalone applications\tin\tproduction\tservers.\tHowever,\tdepending\ton\tyour\tbusiness case,\tit\tis\tnot\talways\teasy\tto\tget\taccess\tto\tthe\tproduction.\n\nThe\tcreators\tof\tPM2\thave\tsolved\tthis\tproblem\tby\tcreating\tKeymetrics. Keymetrics\tis\ta\tSoftware\tas\ta\tservice\t(SaaS)\tcomponent\tthat\tallows PM2\tto\tsend\tmonitoring\tdata\tacross\tthe\tnetwork\tto\tits\twebsite,\tas\tshown in\tthe\tfollowing\timage\t(as\tfound\tat\thttps://keymetrics.io/):\n\nEven\tthough\tKeymetrics\tis\tnot\tfree,\tit\tprovides\ta\tfree\ttier\tto\tdemonstrate how\tit\tworks.\tWe\tare\tgoing\tto\tuse\tit\tin\tthis\tchapter.\n\nThe\tvery\tfirst\tthing\tthat\twe\tneed\tto\tdo\tis\tregister\ta\tuser.\tOnce\twe\tget access\tto\tour\taccount,\twe\tshould\tsee\tsomething\tsimilar\tto\tthe\tfollowing screen:\n\nThis\tscreen\tis\tasking\tus\tto\tcreate\ta\tbucket.\tKeymetrics\tuses\tthe\tbucket concept\tto\tdefine\ta\tcontext.\tFor\texample,\tif\tour\torganization\thas\tdifferent areas\t(payments,\tcustomer\tservice,\tand\tso\ton)\twith\tdifferent\tservers\ton each\tarea,\twe\tcould\tmonitor\tall\tthe\tservers\tin\tone\tbucket.\tThere\tare\tno restrictions\ton\thow\tmany\tservers\tyou\tcan\thave\tin\tone\tbucket.\tIt\tis\teven\n\npossible\tto\thave\tall\tthe\torganization\tin\tthe\tsame\tbucket\tso\tthat everything\tis\teasy\tto\taccess.\n\nLet's\tcreate\ta\tbucket\tcalled\tMonitoring\tTest,\tas\tshown\tin\tthe\tfollowing image:\n\nEasy,\tonce\twe\ttap\ton\tCreate\tBucket,\tKeymetrics\twill\tshow\tus\ta\tscreen with\tthe\tinformation\tneeded\tto\tstart\tmonitoring\tour\tapp,\tas\tshown\tin\tthe following\timage:\n\nAs\tyou\tcan\tsee,\tthe\tscreen\tdisplays\tinformation\tabout\tthe\tprivate\tkey used\tby\tKeymetrics.\tUsually,\tit\tis\ta\tvery\tbad\tidea\tto\tshare\tthis\tkey\twith anyone.\n\nAs\tshown\ton\tthe\tscreen,\tthe\tnext\tstep\tis\tto\tconfigure\tPM2\tto\tpush\tdata into\tKeymetrics.\tThere\tis\talso\tuseful\tinformation\tabout\tthe\tnetworking needed\tto\tmake\tKeymetrics\twork:\n\nPM2\twill\tbe\tpushing\tdata\tto\tthe\tport\t80\ton\tKeymetrics Keymetrics\twill\tbe\tpushing\tdata\tback\tto\tus\ton\tthe\tport\t43554\n\nUsually,\tin\tlarge\torganizations,\tthere\tare\trestrictions\tabout\tthe networking,\tbut\tif\tyou\tare\ttesting\tthis\tfrom\thome,\teverything\tshould\twork straightaway.\n\nIn\torder\tto\tmake\tPM2\table\tto\tsend\tmetrics\tto\tKeymetrics,\twe\tneed\tto install\tone\tPM2\tmodule\tcalled\tpm2-server-monit.\tThis\tis\ta\tfairly\teasy task:\n\npm2\tinstall\tpm2-server-monit\n\nThis\twill\tresult\tin\tan\toutput\tsimilar\tto\tthe\tfollowing:\n\nLet's\trun\tthe\tadvised\tcommand:\n\npm2\tlink\tfan7p32fnysuuw8\tznlz25frrcwakg6\tmy-server\n\nIn\tthis\tcase,\tI\thave\treplaced\t[server\tname]\twith\tmy-server.\tThere\tare\tno restrictions\ton\tthe\tserver\tname;\thowever,\twhen\trolling\tout\tKeymetrics into\ta\treal\tsystem,\tit\tis\trecommended\tto\tchoose\ta\tdescriptive\tname\tin order\tto\teasily\tidentify\tthe\tserver\tin\tthe\tdashboard.\n\nThe\tpreceding\tcommand\twill\tproduce\tan\toutput\tsimilar\tto\tthe\tfollowing image:\n\nThis\tis\tan\tindication\tthat\teverything\twent\twell\tand\tour\tapplication\tis\tready to\tbe\tmonitored\tfrom\tKeymetrics\tthat\tcan\tbe\tchecked\ton https://app.keymetrics.io/,\tas\tfollows:\n\nNow,\tour\tserver\tis\tshowing\tup\tin\tthe\tinterface.\tAs\twe\tpreviously\tstated, this\tbucket\tcould\tmonitor\tdifferent\tservers.\tA\tsimple\tvirtual\tmachine\tis created,\tand\tas\tyou\tcan\tsee\tat\tthe\tbottom\tof\tthe\tscreen,\tKeymetrics provides\tus\twith\tthe\tcommand\tto\tbe\texecuted\tin\torder\tto\tadd\tanother server.\tIn\tthis\tcase,\tas\twe\tare\tusing\tthe\tfree\taccess\tto\tKeymetrics,\tso\twe can\tonly\tmonitor\tone\tserver.\n\nLet's\tsee\twhat\tKeymetrics\tcan\toffer\tus.\tAt\tfirst\tsight,\twe\tcan\tsee interesting\tmetrics\tsuch\tas\tCPU\tusage,\tmemory\tavailable,\tdisk\tavailable, and\tso\ton.\n\nAll\tthese\tare\thardware\tmetrics\tthat\tindicate\thow\tour\tsystem\tis\tbehaving. Under\tpressure,\tthey\tare\tthe\tperfect\tindicator\tto\tpoint\tout\tthe\tneed\tfor more\thardware\tresources.\n\nUsually,\tthe\thardware\tresources\tare\tthe\tmain\tindicator\tof\tfailure\tin\tan application.\tNow,\twe\tare\tgoing\tto\tsee\thow\tto\tuse\tKeymetrics\tto\tdiagnose the\tproblem.\n\nDiagnosing\tproblems\n\nA\tmemory\tleak\tis\tusually\ta\tdifficult\tproblem\tto\tsolve\tdue\tto\tthe\tnature\tof the\tflaw.\tTake\ta\tlook\tat\tthe\tfollowing\tcode.\n\nLet's\trun\tthe\tprogram\tusing\ta\tsimple\tseneca.act()\taction:\n\nvar\tseneca\t=\trequire('seneca')();\n\nvar\tnames\t=\t[];\n\nseneca.add({cmd:\t'memory-leak'},\tfunction(args,\tdone){ \t\tnames.push(args.name); \t\tgreetings\t=\t\"Hello\t\"\t+\targs.name; \t\tdone(null\t,{result:\tgreetings}); });\n\nseneca.act({cmd:\t'memory-leak',\tname:\t'David'},\t function(err,\tresponse)\t{ \t\tconsole.log(response); });\n\nThis\tprogram\thas\ta\tvery\tobvious\tmemory\tleak,\tand\tby\tobvious,\tI\tmean that\tit\tis\twritten\tto\tbe\tobvious.\tThe\tnames\tarray\twill\tkeep\tgrowing indefinitely.\tIn\tthe\tpreceding\texample,\tit\tis\tnot\ta\tbig\tdeal\tdue\tto\tthe\tfact that\tour\tapplication\tis\ta\tscript\tthat\twill\tstart\tand\tfinish\twithout\tkeeping\tthe state\tin\tmemory.\n\nTip\n\nRemember\tthat\tJavaScript\tallocates\tvariables\tin\tthe\tglobal\tscope\tif the\tvar\tkeyword\tis\tnot\tused.\n\nThe\tproblem\tcomes\twhen\tsomeone\telse\treutilizes\tour\tcode\tin\ta\tdifferent part\tof\tthe\tapplication.\n\nLet's\tassume\tthat\tour\tsystem\tgrows\tto\ta\tpoint\tthat\twe\tneed\ta microservice\tto\tgreet\tnew\tcustomers\t(or\tdeliver\tthe\tinitial\tpayload\tof personal\tinformation\tsuch\tas\tname,\tpreferences,\tconfiguration,\tand\tso on).\tThe\tfollowing\tcode\tcould\tbe\ta\tgood\texample\ton\thow\tto\tbuild\tit:\n\nvar\tseneca\t=\trequire('seneca')();\n\nvar\tnames\t=\t[];\n\nseneca.add({cmd:\t'memory-leak'},\tfunction(args,\tdone){ \t\tnames.push(args.name); \t\tgreetings\t=\t\"Hello\t\"\t+\targs.name;\n\ndone(null\t,{result:\tgreetings}); });\n\nseneca.listen(null,\t{port:\t8080});\n\nIn\tthis\texample,\tSeneca\twill\tbe\tlistening\tover\tHTTP\tfor\trequests\tfrom Seneca\tclients\tor\tother\ttypes\tof\tsystems\tsuch\tas\tcurl.\tWhen\twe\trun\tthe application:\n\nnode\tindex.js 2016-02-14T13:30:26.748Z\t szwj2mazorea/1455456626740/40489/-\tINFO\thello\t Seneca/1.1.0/szwj2mazorea/1455456626740/40489/- 2016-02-14T13:30:27.003Z\t szwj2mazorea/1455456626740/40489/-\tINFO\tlisten\t {port:8080}\n\nThen\tfrom\tanother\tterminal,\twe\tuse\tcurl\tto\tact\tas\ta\tclient\tof\tour microservice,\teverything\twill\twork\tsmoothly\tand\tour\tmemory\tleak\twill\tgo unnoticed:\n\ncurl\t-d\t'{\"cmd\":\t\"memory-leak\",\t\"name\":\"David\"}'\t http://127.0.0.1:8080/act {\"result\":\"Hello\tDavid\"}%\n\nHowever,\twe\tare\tgoing\tto\tuse\tKeymetrics\tto\tfind\tthe\tproblem.\tThe\tfirst thing\twe\tneed\tto\tdo\tis\trun\tour\tprogram\tusing\tPM2.\tIn\torder\tto\tdo\tit\tso, we\trun\tthe\tfollowing\tcommand:\n\npm2\tstart\tindex.js\n\nThis\tcommand\twill\tproduce\tthe\tfollowing\toutput:\n\nLet's\texplain\tthe\toutput\tin\tthe\tfollowing:\n\nThe\tfirst\tline\tgives\tus\tinformation\tabout\tthe\tintegration\twith Keymetrics.\tData\tsuch\tas\tpublic\tkey,\tserver\tname,\tand\tthe\tURL\tto access\tKeymetrics. In\tthe\tfirst\ttable,\twe\tcan\tsee\tthe\tname\tof\tthe\tapplication\trunning,\tas well\tas\tfew\tstatistics\ton\tmemory,\tuptime,\tCPU,\tand\tso\ton. In\tthe\tsecond\ttable,\twe\tcan\tsee\tthe\tinformation\trelevant\tto\tthe\tpm2- server-monit\tPM2\tmodule.\n\nNow,\tlet's\tgo\tto\tKeymetrics\tand\tsee\twhat\thas\thappened:\n\nThe\tapplication\tis\tnow\tregistered\tin\tKeymetrics\tas\tit\tcan\tbe\tseen\tin\tthe\tcontrol\tpanel\n\nAs\tyou\tcan\tsee,\tnow\tour\tapplication\tis\tshowing\tup\tin\tKeymetrics.\n\nStraightaway,\twe\tcan\tsee\tthe\tvery\tuseful\tthings\tabout\tour\tapp.\tOne\tof these\tis\tthe\tmemory\tused.\tThis\tis\tthe\tmetric\tthat\twill\tindicate\ta\tmemory leak,\tas\tit\twill\tkeep\tgrowing.\n\nNow,\twe\tare\tgoing\tto\tforce\tthe\tmemory\tleak\tto\tcause\ta\tproblem\tin\tour application.\tIn\tthis\tcase,\tthe\tonly\tthing\tthat\twe\tneed\tto\tdo\tis\tstart\tour server\t(the\tsmall\tapplication\tthat\twe\twrote\tbefore)\tand\tissue\ta\tsignificant number\tof\trequests:\n\nfor\ti\tin\t{0..100000} do \t\tcurl\t-d\t'{\"cmd\":\t\"memory-leak\",\t\"name\":\"David\"}'\t http://127.0.0.1:8080/act done\n\nAs\tsimple\tas\tthe\tsmall\tbash\tscript,\tthis\tis\tall\tit\ttakes\tto\topen\tPandora's Box\tin\tour\tapplication:\n\nThe\tapplication\tis\tnow\tshowing\ta\thigh\tload\t(36%\tof\tCPU\tand\tan\tincreased\tuse\tof\tmemory\tup\tto 167\tMB)\n\nThe\tpreceding\timage\tshows\tthe\timpact\tof\trunning\tthe\tloop\tof\trequests\tin our\tsystem.\tLet's\texplain\tit\tin\tthe\tfollowing:\n\nThe\tCPU\tin\tour\tapplication\thas\tgone\tto\t11%\twith\tan\taverage\tloop delay\tof\t1.82\tmilliseconds.\tRegarding\tour\tsystem,\tthe\toverall\tCPU utilization\thas\tgone\tup\tto\t36.11%\tdue\tto\tthe\tfact\tthat\tboth\tthe application\tand\tbash\tscript\tuse\ta\tsignificant\tamount\tof\tresources. The\tmemory\tconsumption\thas\tsoared\tfrom\t81.9\tMB\tto\t167.6\tMB. As\tyou\tcan\tsee,\tthe\tline\ton\tthe\tgraph\tof\tmemory\tallocation\tis\tnot going\tstraight\tup,\tand\tthat\tis\tdue\tto\tgarbage\tcollections.\tA\tgarbage collection\tis\tan\tactivity\twithin\tthe\tNode.js\tframework\twhere unreferenced\tobjects\tare\tfreed\tfrom\tthe\tmemory,\tallowing\tour system\tto\treuse\tthe\thardware\tresources.\n\nRegarding\tthe\terrors,\tour\tapplication\thas\tbeen\tstable\twith\t0\terrors (we'll\tcome\tback\tto\tthis\tsection\tlater).\n\nNow,\tonce\tour\tbash\tscript\tis\tfinished\t(I\tstopped\tit\tmanually,\tas\tit\tcan\ttake a\tsignificant\tamount\tof\tresources\tand\ttime\tto\tfinish),\twe\tcan\tagain\tsee what\thappened\tto\tour\tsystem\tin\tthe\tfollowing\tscreenshot:\n\nWe\tcan\tsee\tthat\tthe\tCPU\thas\tgone\tback\tto\tnormal,\tbut\twhat\tabout\tthe memory?\tThe\tmemory\tconsumed\tby\tour\tapplication\thasn't\tbeen\tfreed due\tto\tthe\tfact\tthat\tour\tprogram\thas\ta\tmemory\tleak,\tand\tas\tlong\tas\tour variable\tis\treferencing\tthe\tmemory\tconsumed\t(remember\tthe\tnames\tarray is\taccumulating\tmore\tand\tmore\tnames),\tit\twon't\tbe\tfreed.\n\nIn\tthis\tcase,\twe\thave\ta\tvery\tsimple\texample\tthat\tclearly\tshows\twhere\tthe memory\tleak\tis,\tbut\tin\tcomplex\tapplications,\tit\tis\tnot\talways\tobvious.\tThis\n\nerror,\tin\tparticular,\tcould\tnever\tshow\tup\tas\ta\tproblem\tdue\tto\tthe\tfact\tthat we\tprobably\tdeploy\tnew\tversions\tof\tour\tapp\toften\tenough\tto\tnot\trealize it.\n\nMonitoring\tapplication\texceptions\n\nApplication\terrors\tare\tevents\tthat\toccur\twhen\tour\tapplication\tcan't\thandle an\tunexpected\tsituation.\tThings\tsuch\tas\tdividing\ta\tnumber\tby\tzero\tor trying\tto\taccess\tan\tundefined\tproperty\tof\tour\tapplication\tusually\tleads\tto these\ttype\tof\tproblems.\n\nWhen\tworking\ton\ta\tmultithreaded\tframework\t(language)\tsuch\tas\tTomcat, the\tfact\tthat\tone\tof\tour\tthreads\tdies\tdue\tto\tan\texception\tusually\tonly affects\tto\tone\tcustomer\t(the\tone\tholding\tthe\tthread).\tHowever,\tin Node.js,\ta\tbubbled\texception\tcould\tbe\ta\tsignificant\tproblem\tas\tour application\tdies.\n\nPM2\tand\tSeneca\tdo\ta\tvery\tgood\tjob\tat\tkeeping\tit\talive\tas\tPM2\twill restart\tour\tapp\tif\tsomething\tmakes\tit\tstop,\tand\tSeneca\twon't\tlet\tthe application\tdie\tif\tan\texception\toccurs\tin\tone\tof\tthe\tactions.\n\nKeymetrics\thas\tdeveloped\ta\tmodule\tcalled\tpmx\tthat\twe\tcan\tuse\tto programmatically\tget\talerts\ton\terrors:\n\nvar\tseneca\t=\trequire('seneca')();\n\nvar\tpmx\t=\trequire('pmx');\n\nvar\tnames\t=\t[];\n\nseneca.add({cmd:\t'exception'},\tfunction(args,\tdone){ \t\tpmx.notify(new\tError(\"Unexpected\tException!\"));\n\ndone(null\t,{result:\t100/args.number});\t });\n\nseneca.listen({port:\t8085});\n\nIt\tis\teasy\tand\tself-descriptive:\tan\taction\tthat\tsends\tan\texception\tto Keymetrics\tif\tthe\tnumber\tsent\tas\ta\tparameter\tis\tzero.\tIf\twe\trun\tit,\twe\twill get\tthe\tfollowing\toutput:\n\nNow\twe\tneed\tto\thit\tthe\tserver\tin\torder\tto\tcause\tthe\terror.\tAs\twe\tdid earlier,\twe\twill\tdo\tthis\tusing\tcurl:\n\ncurl\t-d\t'{\"cmd\":\t\"exception\",\t\"number\":\t\"0\"}'\t http://localhost:8085/act {\"result\":null}%\n\nNow,\twhen\twe\tgo\tto\tKeymetrics,\twe\tcan\tsee\tthat\tthere\tis\tan\terror logged,\tas\tshown\tin\tthe\tfollowing\timage:\n\nAnother\tinteresting\tpoint\tof\tKeymetrics\tis\tthe\tconfiguration\tof\talerts.\tAs PM2\tsends\tdata\tabout\tpretty\tmuch\tevery\tmetric\tin\tour\tsystem,\twe\thave the\tability\tto\tconfigure\tKeymetrics\ton\tthe\tthresholds\tthat\twe\tconsider healthy\tfor\tour\tapplication.\n\nThis\tis\tvery\thandy\tas\twe\tcould\tget\tthe\tnotifications\tintegrated\tin\tour corporate\tchat\t(something\tsimilar\tto\tSlack)\tand\tbe\talerted\treal\ttime\n\nwhen\tsomething\tis\tnot\tgoing\tcorrectly\tin\tour\tapplication.\n\nCustom\tmetrics\n\nKeymetrics\talso\tallows\tus\tto\tuse\tprobes.\tA\tprobe\tis\ta\tcustom\tmetric\tthat is\tsent\tprogrammatically\tby\tthe\tapplication\tto\tKeymetrics.\n\nThere\tare\tdifferent\ttypes\tof\tvalues\tthat\tthe\tnative\tlibrary\tfrom\tKeymetrics allows\tus\tto\tpush\tdirectly.\tWe\tare\tgoing\tto\tsee\tthe\tmost\tuseful\tones.\n\nSimple\tmetric\n\nA\tsimple\tmetric\tis,\tas\tits\tname\tindicates,\ta\tvery\tbasic\tmetric\twhere\tthe developer\tcan\tset\tthe\tvalue\tto\tthe\tdata\tsent\tto\tKeymetrics:\n\nvar\tseneca\t=\trequire('seneca')(); var\tpmx\t=\trequire(\"pmx\").init({ \t\thttp:\ttrue, \t\terrors:\ttrue, \t\tcustom_probes:\ttrue, \t\tnetwork:\ttrue, \t\tports:\ttrue }); var\tnames\t=\t[]; var\tprobe\t=\tpmx.probe();\n\nvar\tmeter\t=\tprobe.metric({ \t\tname\t\t\t\t\t\t:\t'Last\tcall' });\n\nseneca.add({cmd:\t'last-call'},\tfunction(args,\tdone){ \t\tconsole.log(meter); \t\tmeter.set(new\tDate().toISOString()); \t\tdone(null,\t{result:\t\"done!\"}); });\n\nseneca.listen({port:\t8085});\n\nIn\tthis\tcase,\tthe\tmetric\twill\tsend\tthe\ttime\twhen\tthe\taction\twas\tcalled\tfor the\tlast\ttime\tto\tthe\tKeymetrics:\n\nThe\tconfiguration\tfor\tthis\tmetric\tis\tnon-existent:\n\nvar\tprobe\t=\tpmx.probe();\n\nvar\tmeter\t=\tprobe.metric({ \t\tname\t\t\t\t\t\t:\t'Last\tcall' });\n\nThere\tis\tno\tcomplexity\tin\tthis\tmetric.\n\nCounter\n\nThis\tmetric\tis\tvery\tuseful\tto\tcount\thow\tmany\ttimes\tan\tevent\toccurred:\n\nvar\tseneca\t=\trequire('seneca')(); var\tpmx\t=\trequire(\"pmx\").init({ \t\thttp:\ttrue, \t\terrors:\ttrue, \t\tcustom_probes:\ttrue, \t\tnetwork:\ttrue, \t\tports:\ttrue }); var\tnames\t=\t[]; var\tprobe\t=\tpmx.probe();\n\nvar\tcounter\t=\tprobe.counter({ \t\tname\t:\t'Number\tof\tcalls' });\n\nseneca.add({cmd:\t'counter'},\tfunction(args,\tdone){ \t\tcounter.inc(); \t\tdone(null,\t{result:\t\"done!\"}); });\n\nseneca.listen({port:\t8085});\n\nIn\tthe\tpreceding\tcode,\twe\tcan\tsee\thow\tthe\tcounter\tis\tincremented\tfor every\tsingle\tcall\tto\tthe\taction\tcounter.\n\nThis\tmetric\twill\talso\tallow\tus\tto\tdecrement\tthe\tvalue\tcalling\tthe\tdec() method\ton\tthe\tcounter:\n\ncounter.dec();\n\nAverage\tcalculated\tvalues\n\nThis\tmetric\tallows\tus\tto\trecord\twhen\tan\tevent\toccurs,\tand\tit\twill automatically\tcalculate\tthe\tnumber\tof\tevents\tper\ttime\tunit.\tIt\tis\tquite useful\tto\tcalculate\taverages\tand\tis\ta\tgood\ttool\tto\tmeasure\tthe\tload\tin\tthe system.\tLet's\tsee\ta\tsimple\texample,\tas\tfollows:\n\nvar\tseneca\t=\trequire('seneca')(); var\tpmx\t=\trequire(\"pmx\").init({ \t\thttp:\ttrue, \t\terrors:\ttrue, \t\tcustom_probes:\ttrue, \t\tnetwork:\ttrue, \t\tports:\ttrue }); var\tnames\t=\t[]; var\tprobe\t=\tpmx.probe();\n\nvar\tmeter\t=\tprobe.meter({ \t\tname\t\t\t\t\t\t:\t'Calls\tper\tminute', \t\tsamples\t\t\t:\t60, \t\ttimeframe\t:\t3600 });\n\nseneca.add({cmd:\t'calls-minute'},\tfunction(args,\tdone) { \t\tmeter.mark(); \t\tdone(null,\t{result:\t\"done!\"}); });\n\nseneca.listen({port:\t8085});\n\nThe\tpreceding\tcode\tcreates\ta\tprobe\tand\tsends\ta\tnew\tmetric\tcalled\tCalls per\tminute\tto\tKeymetrics.\n\nNow,\tif\twe\trun\tthe\tapplication\tand\tthe\tfollowing\tcommand\ta\tfew\ttimes,\n\nthe\tmetric\tis\tshown\tin\tthe\tfollowing\tKeymetrics\tinterface:\n\ncurl\t-d\t'{\"cmd\":\t\"calls-minute\"}'\t http://localhost:8085/act\n\nAs\tyou\tcan\tsee,\tthere\tis\ta\tnew\tmetric\tcalled\tCalls\tper\tminute\tin\tthe\tUI. The\tkey\tto\tconfigure\tthis\tmetric\tis\tin\tthe\tfollowing\tinitialization:\n\nvar\tmeter\t=\tprobe.meter({ \t\tname\t\t\t\t\t\t:\t'Calls\tper\tminute', \t\tsamples\t\t\t:\t60, \t\ttimeframe\t:\t3600 });\n\nAs\tyou\tcan\tsee,\tthe\tname\tof\tthe\tmetric\tis\tin\tthe\tconfiguration\tdictionary as\twell\tas\tin\ttwo\tparameters:\tsamples\tand\ttimeframe.\n\nThe\tsamples\tparameter\tcorrespond\tto\tthe\tinterval\twhere\twe\twant\tto\trate the\tmetric;\tin\tthis\tcase,\tit\tis\tthe\tnumber\tof\tcalls\tper\tminute\tso\tthat\trate\tis 60\tseconds.\n\nThe\ttimeframe\tparameter,\ton\tthe\tother\thand,\tis\tfor\thow\tlong\twe\twant Keymetrics\tto\thold\tthe\tdata\tfor,\tor\tto\texpress\tin\tsimpler\twords,\tit\tis\tthe timeframe\tover\twhich\tthe\tmetric\twill\tbe\tanalyzed.\n\nSimian\tArmy\t–\tthe\tactive monitoring\tfrom\tSpotify\n\nSpotify\tis\tone\tof\tthe\tcompanies\tof\treference\twhen\tbuilding microservices-oriented\tapplications.\tThey\tare\textremely\tcreative\tand talented\twhen\tit\tboils\tdown\tto\tcoming\tup\twith\tnew\tideas.\n\nOne\tof\tmy\tfavourite\tideas\tamong\tthem\tis\twhat\tthey\tcall\tthe\tSimian Army.\tI\tlike\tto\tcall\tit\tactive\tmonitoring.\n\nIn\tthis\tbook,\tI\thave\ttalked\ta\tlot\ttimes\tabout\thow\thumans\tfail\tat performing\tdifferent\ttasks.\tNo\tmatter\thow\tmuch\teffort\tyou\tput\tin\tto creating\tyour\tsoftware,\tthere\tare\tgoing\tto\tbe\tbugs\tthat\twill\tcompromise the\tstability\tof\tthe\tsystem.\n\nThis\tis\ta\tbig\tproblem,\tbut\tit\tbecomes\ta\thuge\tdeal\twhen,\twith\tthe\tmodern cloud\tproviders,\tyour\tinfrastructure\tis\tautomated\twith\ta\tscript.\n\nThink\tabout\tit,\twhat\thappens\tif\tin\ta\tpool\tof\tthousand\tservers,\tthree\tof them\thave\tthe\ttime\tzone\tout\tof\tsync\twith\tthe\trest\tof\tthe\tservers?\tWell, depending\ton\tthe\tnature\tof\tyour\tsystem,\tit\tcould\tbe\tfine\tor\tit\tcould\tbe\ta big\tdeal.\tCan\tyou\timagine\tyour\tbank\tgiving\tyou\ta\tstatement\twith disordered\ttransactions?\n\nSpotify\thas\tsolved\t(or\tmitigated)\tthe\tpreceding\tproblem\tby\tcreating\ta number\tof\tsoftware\tagents\t(a\tprogram\tthat\tmoves\twithin\tthe\tdifferent machines\tof\tour\tsystem),\tnaming\tthem\tafter\tdifferent\tspecies\tof\tmonkeys with\tdifferent\tpurposes\tto\tensure\tthe\trobustness\tof\ttheir\tinfrastructure. Let's\texplain\tit\ta\tbit\tfurther.\n\nAs\tyou\tare\tprobably\taware,\tif\tyou\thave\tworked\tbefore\twith\tAmazon\tWeb Services,\tthe\tmachines\tand\tcomputational\telements\tare\tdivided\tin\tto regions\t(EU,\tAustralia,\tUSA,\tand\tso\ton)\tand\tinside\tevery\tregion,\tthere are\tavailability\tzones,\tas\tshown\tin\tthe\tfollowing\tdiagram:\n\nThis\tenables\tus,\tthe\tengineers,\tto\tcreate\tsoftware\tand\tinfrastructure without\thitting\twhat\twe\tcall\ta\tsingle\tpoint\tof\tfailure.\n\nNote\n\nA\tsingle\tpoint\tof\tfailure\tis\ta\tcondition\tin\ta\tsystem\twhere\tthe\tfailure of\ta\tsingle\telement\twill\tcause\tthe\tsystem\tto\tmisbehave.\n\nThis\tconfiguration\traised\ta\tnumber\tof\tquestions\tto\tthe\tengineers\tin Spotify,\tas\tfollows:\n\nWhat\thappens\tif\twe\tblindly\ttrust\tour\tdesign\twithout\ttesting\twhether we\tactually\thave\tany\tpoint\tof\tfailures\tor\tnot? What\thappens\tif\ta\tfull\tavailability\tzone\tor\tregion\tgoes\tdown? How\tis\tour\tapplication\tgoing\tto\tbehave\tif\tthere\tis\tan\tabnormal latency\tfor\tsome\treason?\n\nTo\tanswer\tall\tthese\tquestions,\tNetflix\thas\tcreated\tvarious\tagents.\tAn agent\tis\ta\tsoftware\tthat\truns\ton\ta\tsystem\t(in\tthis\tcase,\tour\tmicroservices system)\tand\tcarries\ton\tdifferent\toperations\tsuch\tas\tchecking\tthe hardware,\tmeasuring\tthe\tnetwork\tlatency,\tand\tso\ton.\tThe\tidea\tof\tagent\tis not\tnew,\tbut\tuntil\tnow,\tits\tapplication\twas\tnearly\ta\tfuturistic\tsubject.\tLet's take\ta\tlook\tat\tthe\tfollowing\tagents\tcreated\tby\tNetflix:\n\nChaos\tMonkey:\tThis\tagent\tdisconnects\thealthy\tmachines\tfrom\tthe network\tin\ta\tgiven\tavailability\tzone.\tThis\tensures\tthat\tthere\tare\tno single\tpoints\tof\tfailures\twithin\tan\tavailability\tzone.\tSo\tthat\tif\tour application\tis\tbalanced\tacross\tfour\tnodes,\twhen\tthe\tChaos\tMonkey kicks\tin,\tit\twill\tdisconnect\tone\tof\tthese\tfour\tmachines. Chaos\tGorilla:\tThis\tis\tsimilar\tto\tChaos\tMonkey,\tChaos\tGorilla\twill disconnect\ta\tfull\tavailability\tzone\tin\torder\tto\tverify\tthat\tNetflix services\trebalance\tto\tthe\tother\tavailable\tzones.\tIn\tother\twords, Chaos\tGorilla\tis\tthe\tbig\tbrother\tof\tChaos\tMonkey;\tinstead\tof operating\tat\tthe\tserver\tlevel,\tit\toperates\tat\tthe\tpartition\tlevel. Latency\tMonkey:\tThis\tagent\tis\tresponsible\tfor\tintroducing\tartificial latencies\tin\tthe\tconnections.\tLatency\tis\tusually\tsomething\tthat\tis hardly\tconsidered\twhen\tdeveloping\ta\tsystem,\tbut\tit\tis\ta\tvery\tdelicate subject\twhen\tbuilding\ta\tmicroservices\tarchitecture:\tlatency\tin\tone node\tcould\tcompromise\tthe\tquality\tof\tthe\tfull\tsystem.\tWhen\ta service\tis\trunning\tout\tof\tresources,\tusually\tthe\tfirst\tindication\tis\tthe latency\tin\tthe\tresponses;\ttherefore,\tLatency\tMonkey\tis\ta\tgood\tway to\tfind\tout\thow\tour\tsystem\twill\tbehave\tunder\tpressure. Doctor\tMonkey:\tA\thealth\tcheck\tis\tan\tendpoint\tin\tour\tapplication that\treturns\tan\tHTTP\t200\tif\teverything\tis\tcorrect\tand\t500\terror\tcode if\tthere\tis\ta\tproblem\twithin\tthe\tapplication.\tDoctor\tMonkey\tis\tan agent\tthat\twill\trandomly\texecute\tthe\thealth\tcheck\tof\tnodes\tin\tour application\tand\treport\tthe\tfaulty\tones\tin\torder\tto\treplace\tthem.\n\n10-18\tMonkey:\tOrganizations\tsuch\tas\tNetflix\tare\tglobal,\tso\tthey need\tto\tbe\tlanguage-aware\t(certainly,\tyou\tdon't\twant\tto\tget\ta website\tin\tGerman\twhen\tyour\tmother\ttongue\tis\tSpanish).\tThe\t10-18 Monkey\treports\ton\tinstances\tthat\tare\tmisconfigured.\n\nThere\tare\ta\tfew\tother\tagents,\tbut\tI\tjust\twant\tto\texplain\tactive\tmonitoring to\tyou.\tOf\tcourse,\tthis\ttype\tof\tmonitoring\tis\tout\tof\treach\tof\tsmall organizations,\tbut\tit\tis\tgood\tto\tknow\tabout\ttheir\texistence\tso\tthat\twe\tcan get\tinspired\tto\tset\tup\tour\tmonitoring\tprocedures.\n\nNote\n\nThe\tcode\tis\tavailable\tunder\tApache\tLicense\tin\tthe\tfollowing repository:\n\nhttps://github.com/Netflix/SimianArmy.\n\nIn\tgeneral,\tthis\tactive\tmonitoring\tfollows\tthe\tphilosophy\tof\tfail\tearly,\tof which,\tI\tam\ta\tbig\tadept.\tNo\tmatter\thow\tbig\tthe\tflaw\tin\tyour\tsystem\tis\tor how\tcritical\tit\tis,\tyou\twant\tto\tfind\tit\tsooner\tthan\tlater,\tand\tideally,\twithout impacting\tany\tcustomer.\n\nThroughput\tand\tperformance degradation\n\nThroughput\tis\tto\tour\tapplication\twhat\tthe\tmonthly\tproduction\tis\tto\ta factory.\tIt\tis\ta\tunit\tof\tmeasurement\tthat\tgives\tus\tan\tindication\tabout\thow our\tapplication\tis\tperforming\tand\tanswers\tthe\thow\tmany\tquestion\tof\ta system.\n\nVery\tclose\tto\tthroughput,\tthere\tis\tanother\tunit\tthat\twe\tcan\tmeasure: latency.\n\nLatency\tis\tthe\tperformance\tunit\tthat\tanswers\tthe\tquestion\tof\thow\tlong.\n\nLet's\tconsider\tthe\tfollowing\texample:\n\nOur\tapplication\tis\ta\tmicroservices-based\tarchitecture\tthat\tis\tresponsible for\tcalculating\tcredit\tratings\tof\tapplicants\tto\twithdraw\ta\tmortgage.\tAs\twe have\ta\tlarge\tvolume\tof\tcustomers\t(a\tnice\tproblem\tto\thave),\twe\thave decided\tto\tprocess\tthe\tapplications\tin\tbatches.\tLet's\tdraw\ta\tsmall algorithm\taround\tit:\n\nvar\tseneca\t=\trequire('seneca')(); var\tsenecaPendingApplications\t=\t require('seneca').client({type:\t'tcp',\t \t\tport:\t8002,\t \t\thost:\t\"192.168.1.2\"}); \t\tvar\tsenecaCreditRatingCalculator\t=\t require('seneca').client({type:\t'tcp',\t \t\tport:\t8002,\t \t\thost:\t\"192.168.1.3\"});\n\nseneca.add({cmd:\t'mortgages',\taction:\t'calculate'},\t function(args,\tcallback)\t{ \t\tsenecaPendingApplications.act({ \t\t\t\tcmd:\t'applications',\t \t\t\t\tsection:\t'mortgages',\t \t\t\t\tcustmers:\targs.customers},\tfunction(err,\t responseApplications)\t{ \t\t\t\t\t\tsenecaCreditRatingCalculator.act({cmd:\t'rating',\t customers:\targs.customers},\tfunction(err,\tresponse)\t{\n\nprocessApplications(response.ratings,\t \t\t\t\t\t\t\t\tresponseApplications.applications, \t\t\t\t\t\t\t\targs.customers \t\t\t\t\t\t); \t\t\t\t}); \t\t}); });\n\nThis\tis\ta\tsmall\tand\tsimple\tSeneca\tapplication\t(this\tis\tonly\ttheoretical, don't\ttry\tto\trun\tit\tas\tthere\tis\ta\tlot\tof\tcode\tmissing!)\tthat\tacts\tas\ta\tclient\tfor two\tother\tmicroservices,\tas\tfollows:\n\nThe\tfirst\tone\tgets\tthe\tlist\tof\tpending\tapplications\tfor\tmortgages The\tsecond\tone\tgets\tthe\tlist\tof\tcredit\trating\tfor\tthe\tcustomers\tthat we\thave\trequested\n\nThis\tcould\tbe\ta\treal\tsituation\tfor\tprocessing\tmortgage\tapplications.\tIn\tall fairness,\tI\tworked\ton\ta\tvery\tsimilar\tsystem\tin\tthe\tpast,\tand\teven\tthough\tit\n\nwas\ta\tlot\tmore\tcomplex,\tthe\tworkflow\twas\tvery\tsimilar.\n\nLet's\ttalk\tabout\tthroughput\tand\tlatency.\tImagine\tthat\twe\thave\ta\tfairly\tbig batch\tof\tmortgages\tto\tprocess\tand\tthe\tsystem\tis\tmisbehaving:\tthe network\tis\tnot\tbeing\tas\tfast\tas\tit\tshould\tand\tis\texperiencing\tsome dropouts.\n\nSome\tof\tthese\tapplications\twill\tbe\tlost\tand\twill\tneed\tto\tbe\tretried.\tIn\tideal conditions,\tour\tsystem\tis\tproducing\ta\tthroughput\tof\t500\tapplications\tper hour\tand\ttakes\tan\taverage\tof\t7.2\tseconds\ton\tlatency\tto\tprocess\tevery single\tapplication.\tHowever,\ttoday,\tas\twe\tstated\tbefore,\tthe\tsystem\tis\tnot at\tits\tbest;\twe\tare\tprocessing\tonly\t270\tapplications\tper\thour\tand\ttakes on\taverage\t13.3\tseconds\tto\tprocess\ta\tsingle\tmortgage\tapplication.\n\nAs\tyou\tcan\tsee,\twith\tlatency\tand\tthroughput,\twe\tcan\tmeasure\thow\tour business\ttransactions\tare\tbehaving\twith\trespect\tto\tthe\tprevious experiences;\twe\tare\toperating\tat\t54%\tof\tour\tnormal\tcapacity.\n\nThis\tcould\tbe\ta\tserious\tissue.\tIn\tall\tfairness,\ta\tdrop\toff\tlike\tthis\tshould ring\tall\tthe\talarms\tin\tour\tsystems\tas\tsomething\treally\tserious\tis\tgoing\ton in\tour\tinfrastructure;\thowever,\tif\twe\thave\tbeen\tsmart\tenough\twhile building\tour\tsystem,\tthe\tperformance\twill\tbe\tdegraded,\tbut\tour\tsystem won't\tstop\tworking.\tThis\tcan\tbe\teasily\tachieved\tby\tthe\tusage\tof\tcircuit breakers\tand\tqueueing\ttechnologies\tsuch\tas\tRabbitMQ.\n\nQueueing\tis\tone\tof\tthe\tbest\texamples\tto\tshow\thow\tto\tapply\thuman behavior\tto\tan\tIT\tsystem.\tSeriously,\tthe\tfact\tthat\twe\tcan\teasily\tdecouple our\tsoftware\tcomponents\thaving\ta\tsimple\tmessage\tas\ta\tjoint\tpoint, which\tour\tservices\teither\tproduce\tor\tconsume,\tgives\tus\ta\tbig\tadvantage when\twriting\tcomplex\tsoftware.\n\nOther\tadvantage\tof\tqueuing\tover\tHTTP\tis\tthat\tan\tHTTP\tmessage\tis\tlost if\tthere\tis\ta\tnetwork\tdrop\tout.\n\nWe\tneed\tto\tbuild\tour\tapplication\taround\tthe\tfact\tthat\tit\tis\teither\tfull success\tor\terror.\tWith\tqueueing\ttechnologies\tsuch\tas\tRabbitMQ,\tour messaging\tdelivery\tis\tasynchronous\tso\tthat\twe\tdon't\tneed\tto\tworry\tabout intermittent\tfailures:\tas\tsoon\tas\twe\tcan\tdeliver\tthe\tmessage\tto\tthe appropriate\tqueue,\tit\twill\tget\tpersisted\tuntil\tthe\tclient\tis\table\tto\tconsume it\t(or\tthe\tmessage\ttimeout\toccurs).\n\nThis\tenables\tus\tto\taccount\tfor\tintermittent\terrors\tin\tthe\tinfrastructure\tand build\teven\tmore\trobust\tapplications\tbased\ton\tthe\tcommunication\taround queues.\n\nAgain,\tSeneca\tmakes\tour\tlife\tvery\teasy:\tthe\tplugin\tsystem\ton\twhich\tthe Seneca\tframework\tis\tbuilt\tmakes\twriting\ta\ttransport\tplugin\ta\tfairly\tsimple task.\n\nNote\n\nRabbitMQ\ttransport\tplugin\tcan\tbe\tfound\tin\tthe\tfollowing\tGitHub repository:\n\nhttps://github.com/senecajs/seneca-rabbitmq-transport\n\nThere\tare\tquite\tfew\ttransport\tplugins\tand\twe\tcan\talso\tcreate\tour\town ones\t(or\tmodify\tthe\texisting\tones!)\tto\tsatisfy\tour\tneeds.\n\nIf\tyou\ttake\ta\tquick\tlook\tat\tthe\tRabbitMQ\tplugin\t(just\tas\tan\texample),\tthe only\tthing\tthat\twe\tneed\tto\tdo\tto\twrite\ta\ttransport\tplugin\tis\toverriding\tthe following\ttwo\tSeneca\tactions:\n\nseneca.add({role:\t'transport',\thook:\t'listen',\ttype: 'rabbitmq'},\t...) seneca.add({role:\t'transport',\thook:\t'client',\ttype: 'rabbitmq'},\t...)\n\nUsing\tqueueing\ttechnologies,\tour\tsystem\twill\tbe\tmore\tresilient\tagainst intermittent\tfailures\tand\twe\twould\tbe\table\tto\tdegrade\tthe\tperformance instead\tof\theading\tinto\ta\tcatastrophic\tfailure\tdue\tto\tmissing\tmessages.\n\nSummary\n\nIn\tthis\tchapter,\twe\tdeep\tdived\tinto\tPM2\tmonitoring\tthrough\tKeymetrics. We\tlearned\thow\tto\tput\ttight\tmonitoring\tin\tplace\tso\tthat\twe\tare\tquickly informed\tabout\tthe\tfailures\tin\tour\tapplication.\n\nIn\tthe\tsoftware\tdevelopment\tlife\tcycle,\tthe\tQA\tphase\tis,\tin\tmy\topinion, one\tof\tthe\tmost\timportant\tone:\tno\tmatter\thow\tgood\tyour\tcode\tlooks,\tif\tit does\tnot\twork,\tit\tis\tuseless.\tHowever,\tif\tI\thave\tto\tchoose\tanother\tphase where\tengineers\tshould\tput\tmore\temphasis,\tit\twould\tbe\tthe\tdeployment, and\tmore\tspecifically,\tthe\tmonitoring\tthat\tis\tcarried\tout\tafter\tevery deployment.\tIf\tyou\treceive\terror\treports\timmediately,\tchances\tare\tthat the\treaction\tcan\tbe\tquick\tenough\tto\tavoid\tbigger\tproblems\tsuch\tas corrupted\tdata\tor\tcustomers\tcomplaining.\n\nWe\talso\tsaw\tan\texample\tof\tactive\tmonitoring\tcarried\tout\tby\tNetflix\ton their\tsystems,\twhich\teven\tthough\tmight\tbe\tout\tof\tthe\treach\tof\tyour company,\tit\tcan\tspark\tgood\tideas\tand\tpractices\tin\torder\tto\tmonitor\tyour software.\n\nKeymetrics\tis\tjust\tan\texample\tthat\tfits\tthe\tbill\tfor\tNode.js\tas\tit\tis extremely\twell\tintegrated\twith\tPM2,\tbut\tthere\tare\talso\tother\tgood monitoring\tsystems\tsuch\tas\tAppDynamics,\tor\tif\tyou\twant\tto\tgo\tfor\tan\tin- house\tsoftware,\tyou\tcould\tuse\tNagios.\tThe\tkey\tis\tbeing\tclear\tabout\twhat you\tneed\tto\tmonitor\tin\tthe\tapplication,\tand\tthen,\tfind\tthe\tbest\tprovider.\n\nAnother\ttwo\tgood\toptions\tfor\tmonitoring\tNode.js\tapps\tare\tStrongLoop and\tNew\tRelic.\tThey\tare\tboth\ton\tthe\tsame\tline\twith\tKeymetrics,\tbut\tthey work\tbetter\tfor\tlarge-scale\tsystems,\tespecially\tStrongLoop,\twhich\tis oriented\tto\tapplications\twritten\tin\tNode.js\tand\toriented\tto\tmicroservices.\n\nChapter\t8.\tDeploying Microservices\n\nIn\tthis\tchapter,\twe\tare\tgoing\tto\tdeploy\tmicroservices.\tWe\twill\tuse different\ttechnologies\tin\torder\tto\tprovide\tthe\treader\twith\tthe\tknowledge required\tto\tchoose\tthe\tright\ttool\tfor\tevery\tjob.\tFirst,\twe\twill\tuse\tPM2\tand its\tdeployment\tcapabilities\tto\trun\tapplications\tin\tremote\tservers.\tThen, we\twill\tplay\taround\tDocker,\twhich\tis\tone\tof\tthe\tmost\tadvanced deployment\tplatforms,\tand\tthe\tentire\tecosystem\taround\tcontainers.\tIn this\tchapter,\twe\twill\tshow\thow\tto\tautomate\tall\tthe\tdeployments\tas\thighly as\tpossible.\n\nConcepts\tin\tsoftware\tdeployment\n\nDeployments\tare\tusually\tthe\tugly\tfriend\tof\tthe\tSoftware\tDevelopment Life\tCycle\t(SDLC)\tparty.\tThere\tis\ta\tmissing\tcontact\tpoint\tbetween development\tand\tsystems\tadministration\tthat\tDevOps\tis\tgoing\tto\tsolve\tin the\tnext\tfew\tyears.\tThe\tcost\tof\tfixing\tbugs\tat\tdifferent\tstages\tof\tSDLC\tis shown\tin\tthe\tfollowing\tfigure:\n\nThis\tdiagram\tshows\tthe\tcost\tof\tfixing\ta\tbug,\tdepending\ton\tthe\tstage\tof\tthe\tSDLC\n\nFail\tearly\tis\tone\tof\tmy\tfavorite\tconcepts\tin\tthe\tlean\tmethodology.\tIn\tthe",
      "page_number": 255
    },
    {
      "number": 8,
      "title": "Deploying Microservices",
      "start_page": 282,
      "end_page": 347,
      "detection_method": "regex_chapter_title",
      "content": "change\tmanagement\tworld,\tthe\tcost\tof\tfixing\ta\tbug\tin\tthe\tdifferent\tstages of\tthe\tsoftware\tlife\tcycle\tis\tcalled\tthe\tcost\tof\tchange\tcurve.\n\nRoughly,\tfixing\ta\tbug\tin\tproduction\tis\testimated\tto\tcost\t150\ttimes\tthe resources\tas\tcompared\tto\tthe\tcosts\tto\tfix\tit\twhen\ttaking\trequirements.\n\nNo\tmatter\twhat\tthe\tfigure\tis,\twhich\tdepends\ta\tlot\ton\tthe\tmethodology and\ttechnology\tthat\twe\tuse,\tthe\tlesson\tlearned\tis\tthat\twe\tcan\tsave\ta\tlot of\ttime\tby\tcatching\tbugs\tearly.\n\nFrom\tthe\tcontinuous\tintegration\tup\tto\tcontinuous\tdelivery,\tthe\tprocess should\tbe\tautomated\tas\tmuch\tas\tpossible,\twhere\tas\tmuch\tas\tpossible means\t100%.\tRemember,\thumans\tare\timperfect\tand\tmore\tprone\tto errors\twhile\tcarrying\tout\tmanual\trepetitive\ttasks.\n\nContinuous\tintegration\n\nContinuous\tintegration\t(CI)\tis\tthe\tpractice\tof\tintegrating\tthe\twork\tfrom different\tbranches\ton\tdaily\tbasis\t(or\tmore\tthan\tonce\ta\tday)\tand validating\tthat\tthe\tchanges\tdo\tnot\tbreak\texisting\tfeatures\tby\trunning integration\tand\tunit\ttests.\n\nCI\tshould\tbe\tautomated\tusing\tthe\tsame\tinfrastructure\tconfiguration\tas we\twill\tbe\tusing\tlater\tin\tpre-production\tand\tproduction,\tso\tif\tthere\tis\tany flaw,\tit\tcan\tbe\tcaught\tearly.\n\nContinuous\tdelivery\n\nContinuous\tdelivery\t(CD)\tis\ta\tsoftware\tengineering\tapproach\tthat\taims to\tbuild\tsmall,\ttestable,\tand\teasily\tdeployable\tpieces\tof\tfunctionality\tthat can\tbe\tdelivered\tseamlessly\tat\tany\ttime.\n\nThis\tis\twhat\twe\tare\taiming\tfor\twith\tthe\tmicroservices.\tAgain,\twe\tshould be\tpushing\tto\tautomate\tthe\tdelivery\tprocess\tas,\tif\twe\tare\tdoing\tit manually,\twe\tare\tonly\tlooking\tfor\tproblems.\n\nWhen\ttalking\tfrom\tthe\tmicroservices'\tperspective,\tautomation\ton deployments\tis\tthe\tkey.\tWe\tneed\tto\ttackle\tthe\toverhead\tof\thaving\ta\tfew\n\ndozen\tof\tservices\tinstead\tof\ta\tfew\tmachines,\tor\twe\tcan\tfind\tourselves maintaining\ta\tcloud\tof\tservices\tinstead\tof\tadding\tvalue\tto\tour\tcompany.\n\nDocker\tis\tour\tbest\tally\there.\tWith\tDocker,\twe\tare\treducing\tthe\thassle\tof deploying\ta\tnew\tsoftware\tto\tpretty\tmuch\tmoving\ta\tfile\t(a\tcontainer) around\tin\tdifferent\tenvironments,\tas\twe\twill\tsee\tlater\tin\tthis\tchapter.\n\nDeployments\twith\tPM2\n\nPM2\tis\tan\textremely\tpowerful\ttool.\tNo\tmatter\twhat\tstage\tof\tdevelopment we\tare\tin,\tPM2\talways\thas\tsomething\tto\toffer.\n\nIn\tthis\tphase\tof\tsoftware\tdevelopment,\tthe\tdeployment\tis\twhere\tPM2 really\tshines.\tThrough\ta\tJSON\tconfiguration\tfile,\tPM2\twill\tmanage\ta cluster\tof\tapplications\tso\tthat\twe\tcan\teasily\tdeploy,\tredeploy,\tand manage\tapplications\ton\tremote\tservers.\n\nPM2\t–\tecosystems\n\nPM2\tcalls\ta\tgroup\tof\tapplications\tecosystem.\tEvery\tecosystem\tis described\tby\ta\tJSON\tfile,\tand\tthe\teasiest\tway\tto\tgenerate\tit\tis\texecuting the\tfollowing\tcommand:\n\npm2\tecosystem\n\nThis\tshould\toutput\tsomething\tsimilar\tto\tthe\tfollowing\tcode:\n\n[PM2]\tSpawning\tPM2\tdaemon [PM2]\tPM2\tSuccessfully\tdaemonized File\tpathto/your/app/ecosystem.json\tgenerated\n\nThe\tcontent\tof\tthe\tecosystem.json\tfile\tvaries,\tdepending\ton\tthe\tversion\tof PM2,\tbut\twhat\tthis\tfile\tcontains\tis\tthe\tskeleton\tof\ta\tPM2\tcluster:\n\n{ \t\tapps\t:\t[\n\n{ \t\t\t\t\t\tname\t\t\t\t\t\t:\t\"My\tApplication\", \t\t\t\t\t\tscript\t\t\t\t:\t\"app.js\" \t\t\t\t},\n\n{ \t\t\t\t\t\tname\t\t\t\t\t\t:\t\"Test\tWeb\tServer\", \t\t\t\t\t\tscript\t\t\t\t:\t\"proxy-server.js\" \t\t\t\t} \t\t],\n\n/ \t\tdeploy\t:\t{ \t\t\t\tproduction\t:\t{ \t\t\t\t\t\tuser\t:\t\"admin\", \t\t\t\t\t\thost\t:\t\"10.0.0.1\", \t\t\t\t\t\tref\t\t:\t\"remotes/origin/master\", \t\t\t\t\t\trepo\t:\t\"git@github.com:the-repository.git\", \t\t\t\t\t\tpath\t:\t\"appsrepository\", \t\t\t\t\t\t\"post-deploy\"\t:\t\"pm2\tstartOrRestart\t ecosystem.json\t--env\tproduction\" \t\t\t\t}, \t\t\t\tdev\t:\t{ \t\t\t\t\t\tuser\t:\t\"devadmin\", \t\t\t\t\t\thost\t:\t\"10.0.0.1\", \t\t\t\t\t\tref\t\t:\t\"remotes/origin/master\", \t\t\t\t\t\trepo\t:\t\"git@github.com:the-repository.git\", \t\t\t\t\t\tpath\t:\t\"homedavid/development/test-app/\", \t\t\t\t\t\t\"post-deploy\"\t:\t\"pm2\tstartOrRestart\t ecosystem.json\t--env\tdev\", \t\t\t\t} \t\t} }\n\nThis\tfile\tcontains\ttwo\tapplications\tconfigured\tfor\ttwo\tenvironments.\tWe are\tgoing\tto\tmodify\tthis\tskeleton\tto\tadapt\tit\tto\tour\tneeds,\tmodeling\tour entire\tecosystem\twritten\tin\tChapter\t4,\tWriting\tYour\tFirst\tMicroservice\tin Node.js.\n\nHowever,\tfor\tnow,\tlet's\texplain\ta\tbit\tfor\tthe\tconfiguration:\n\nWe\thave\tan\tarray\tof\tapplications\t(apps)\tdefining\ttwo\tapps:\tAPI\tand WEB As\tyou\tcan\tsee,\twe\thave\ta\tfew\tconfiguration\tparameters\tfor\teach app:\n\nname:\tThis\tis\tthe\tname\tof\tthe\tapplication script:\tThis\tis\tthe\tstartup\tscript\tof\tthe\tapp env:\tThese\tare\tthe\tenvironment\tvariables\tto\tbe\tinjected\tinto\tthe system\tby\tPM2 env_<environment>:\tThis\tis\tsame\tas\tenv,\tbut\tit\tis\ttailored\tper environment\n\nThere\tare\ttwo\tenvironments\tdefined\tin\tthe\tdefault\tecosystem\tunder\n\nthe\tdeploy\tkey,\tas\tfollows:\n\nproduction dev\n\nAs\tyou\tcan\tsee,\tbetween\tthese\ttwo\tenvironments,\tthere\tare\tno significant\tchanges\texcept\tfor\tthe\tfact\tthat\twe\tare\tconfiguring\tone environment\tvariable\tin\tdevelopment\tand\tthe\tfolder\twhere\twe\tdeploy\tour application.\n\nDeploying\tmicroservices\twith\tPM2\n\nIn\tChapter\t4,\tWriting\tYour\tFirst\tMicroservice\tin\tNode.js,\twe\twrote\ta simple\te-commerce\tin\torder\tto\tshow\tthe\tdifferent\tconcepts\tand\tcommon catches\tin\tmicroservices.\n\nNow,\twe\tare\tgoing\tto\tlearn\thow\tto\tdeploy\tthem\tusing\tPM2.\n\nConfiguring\tthe\tserver\n\nFirst\tthing\twe\tneed\tto\tdo\tin\torder\tto\tdeploy\tsoftware\twith\tPM2\tis\tto configure\tthe\tremote\tmachine\tand\tlocal\tmachine\tto\tbe\table\tto\ttalk\tusing SSH,\twith\ta\tpublic/private\tkey\tschema.\n\nThe\tway\tof\tdoing\tit\tis\teasy,\tas\tfollows:\n\nGenerate\tone\tRSA\tkey Install\tit\tinto\tthe\tremote\tserver\n\nLet's\tdo\tit:\n\nssh-keygen\t-t\trsa\n\nThat\tshould\tproduce\tsomething\tsimilar\tto\tthe\tfollowing\toutput:\n\nGenerating\tpublic/private\trsa\tkey\tpair. Enter\tfile\tin\twhich\tto\tsave\tthe\tkey\t (Usersyouruser/.ssh/id_rsa):\t Usersyouruser/.ssh/pm2_rsa\n\nEnter\tpassphrase\t(empty\tfor\tno\tpassphrase): Enter\tsame\tpassphrase\tagain: Your\tidentification\thas\tbeen\tsaved\tin\tpm2_rsa. Your\tpublic\tkey\thas\tbeen\tsaved\tin\tpm2_rsa.pub. The\tkey\tfingerprint\tis: eb:bc:24:fe:23:b2:6e:2d:58:e4:5f:ab:7b:b7:ee:38\t dgonzalez@yourmachine.local The\tkey's\trandomart\timage\tis: +--[\tRSA\t2048]----+ |\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| |\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| |\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| |\t\t\t\t.\t\t\t\t\t\t\t\t\t\t\t\t| |\t\t\to\t\t\t\tS\t\t\t\t\t\t\t\t| |\t\t\t\to\t\t\t..\t\t\t\t\t\t\t| |\t\t\to\to..o.\t\t\t\t\t\t\t| |\t\t.\t+.+=E..\t\t\t\t\t\t| |\t\t\too++**B+.\t\t\t\t\t| +-----------------+\n\nNow,\tif\twe\tgo\tto\tthe\tfolder\tindicated\tin\tthe\tpreceding\toutput,\twe\tcan\tfind the\tfollowing\ttwo\tfiles:\n\npm2_rsa:\tThe\tfirst\tone,\tpm2_rsa,\tis\tyour\tprivate\tkey.\tAs\tyou\tcan\tread from\tthe\tname,\tno\tone\tshould\thave\taccess\tto\tthis\tkey\tas\tthey\tmay steal\tyour\tidentity\tin\tthe\tservers\tthat\ttrust\tthis\tkey. pm2_rsa.pub:\tThe\tpm2_rsa.pub\tis\tyour\tpublic\tkey.\tThis\tkey\tcan\tbe handed\tover\tto\tanyone\tso\tthat\tusing\tasymmetric\tcryptography techniques,\tthey\tcan\tverify\tyour\tidentity\t(or\twho\tyou\tsay\tyou\tare).\n\nWhat\twe\tare\tgoing\tto\tdo\tnow\tis\tcopy\tthe\tpublic\tkey\tto\tthe\tremote\tserver so\tthat\twhen\tour\tlocal\tmachine\tPM2\ttries\tto\ttalk\tto\tthe\tserver,\tit\tknows who\twe\tare\tand\tlet's\tget\tinto\tthe\tshell\twithout\tpassword:\n\ncat\tpm2_rsa.pub\t|\tssh\tyouruser@yourremoteserver\t'cat\t >>\t.ssh/authorized_keys'\n\nThe\tlast\tstep\tis\tto\tregister\tyour\tprivate\tkey\tas\ta\tknown\tidentity\tin\tyour local\tmachine:\n\nssh-add\tpm2_rsa\n\nThat's\tabout\tit.\n\nFrom\tnow\ton,\twhenever\tyou\tSSH\tinto\tthe\tremote\tserver\tusing\tas\ta\tuser youruser,\tyou\twon't\tneed\tto\tenter\tthe\tpassword\tin\torder\tto\tget\tinto\tthe shell.\n\nOnce\tthis\tconfiguration\tis\tdone,\tthere\tis\tvery\tlittle\tto\tdo\tin\torder\tto\tdeploy any\tapplication\tinto\tthis\tserver:\n\npm2\tdeploy\tecosystem.json\tproduction\tsetup pm2\tdeploy\tecosystem.json\tproduction\n\nThe\tfirst\tcommand\twill\tconfigure\teverything\tneeded\tto\taccommodate\tthe app.\tThe\tsecond\tcommand\twill\tactually\tdeploy\tthe\tapplication\titself\tas we\tconfigured\tearlier.\n\nDocker\t–\ta\tcontainer\tfor\tsoftware delivery\n\nVirtualization\thas\tbeen\tone\tof\tthe\tbiggest\ttrends\tin\tthe\tpast\tfew\tyears. Virtualization\tenables\tthe\tengineer\tto\tshare\tthe\thardware\tacross\tdifferent software\tinstances.\tDocker\tis\tnot\treally\ta\tvirtualization\tsoftware,\tbut\tit\tis conceptually\tthe\tsame.\n\nWith\ta\tpure\tvirtualization\tsolution,\ta\tnew\tOS\truns\ton\ttop\tof\ta\thypervisor sitting\ton\ttop\tof\tan\texisting\toperating\tsystem\t(host\tOS).\tRunning\tthe\tfull OS\tmeans\tthat\twe\tcan\tbe\tconsuming\ta\tfew\tgigabytes\tof\thard\tdrive\tin order\tto\treplicate\tthe\tfull\tstack\tfrom\tthe\tkernel\tto\tthe\tfilesystem,\twhich usually\tconsumes\ta\tgood\tchunk\tof\tresources.\tThe\tstructure\tof\ta virtualization\tsolution\tis\tshown\tin\tthe\tfollowing\timage:\n\nLayers\tdiagram\tfor\ta\tvirtual\tmachine\tenvironment\n\nWith\tDocker,\twe\tonly\treplicate\tthe\tfilesystem\tand\tbinaries\tso\tthat\tthere\tis no\tneed\tto\trun\tthe\tfull\tstack\tof\tthe\tOS\twhere\twe\tdon't\tneed\tit.\tDocker images\tare\tusually\ta\tfew\thundreds\tof\tmegabytes,\tinstead\tof\tgigabytes, and\tthey\tare\tquite\tlightweight,\ttherefore,\twe\tcan\trun\tsome\tcontainers\ton the\tsame\tmachine.\tThe\tprevious\tstructure\tusing\tDocker\tis\tshown\tas follows:\n\nLayers\tdiagram\tfor\tDocker\n\nWith\tDocker,\twe\talso\teliminate\tone\tof\tthe\tbiggest\tproblems\tof\tsoftware deployment,\tthat\tis,\tthe\tconfiguration\tmanagement.\n\nWe\tare\tswitching\ta\tcomplicated\tper-environment\tconfiguration management,\twhere\twe\tneed\tto\tworry\tabout\thow\tthe\tapplication\tis deployed/configured\tinto\ta\tcontainer\tthat\tis\tbasically\tlike\ta\tsoftware package\tthat\tcan\tbe\tinstalled\tin\tany\tDocker-ready\tmachine.\n\nThe\tonly\tDocker-ready\tOS\tnowadays\tis\tLinux,\tas\tDocker\tneeds\tto\tmake use\tof\tthe\tadvanced\tkernel\tfeatures,\tforcing\tWindows\tand\tMac\tusers\tto run\ta\tvirtual\tmachine\twith\tLinux\tin\torder\tto\tprovide\tsupport\tto\trun\tDocker containers.\n\nSetting\tup\tthe\tcontainer\n\nDocker\tcomes\twith\ta\tvery\tpowerful\tand\tfamiliar\tway\t(for\tdevelopers)\tof configuring\tthe\tcontainers.\n\nYou\tcan\tcreate\tcontainers\tbased\ton\tan\texisting\timage\t(there\tare thousands\tof\timages\ton\tthe\tInternet)\tand\tthen\tmodify\tthe\timage\tto\tfulfil your\tneeds\tby\tadding\tnew\tsoftware\tpackages\tor\taltering\tthe\tfilesystem.\n\nOnce\twe\tare\tsatisfied\twith\tit,\twe\tcan\tuse\tthe\tnew\tversion\tof\tthe\timage\tto create\tour\tcontainers\tusing\ta\tversion\tcontrol\tsystem\tsimilar\tto\tGit.\n\nHowever,\twe\tneed\tto\tunderstand\thow\tDocker\tworks\tfirst.\n\nInstalling\tDocker\n\nAs\tit\twas\tmentioned\tbefore,\tDocker\tneeds\ta\tvirtual\tmachine\tto\tprovide support\ton\tMac\tand\tWindows,\ttherefore,\tthe\tinstallation\ton\tthese systems\tmay\tvary.\tThe\tbest\tway\tto\tinstall\tDocker\ton\tyour\tsystem\tis\tto\tgo to\tthe\tofficial\twebsite\tand\tfollow\tthe\tsteps:\n\nhttps://docs.docker.com/engine/installation/\n\nAt\tthe\tmoment,\tit\tis\ta\tvery\tactive\tproject,\tso\tyou\tcan\texpect\tchanges every\tfew\tweeks.\n\nChoosing\tthe\timage\n\nBy\tdefault,\tDocker\tcomes\twith\tno\timages.\tWe\tcan\tverify\tthis\tby\trunning docker\timages\ton\tthe\tterminal,\twhich\twill\tproduce\tan\toutput\tvery\tsimilar to\tthe\tfollowing\tscreenshot:\n\nIt\tis\tan\tempty\tlist.\tThere\tare\tno\timages\tstored\tin\tthe\tlocal\tmachine.\tThe first\tthing\twe\tneed\tto\tdo\tis\tsearch\tfor\tan\timage.\tIn\tthis\tcase,\twe\tare going\tto\tuse\tCentOS\tas\tour\tbase\tfor\tcreating\tthe\timages.\tCentOS\tis very\tclose\tto\tRed\tHat\tEnterprise\tLinux,\twhich\tseems\tto\tbe\tone\tof\tthe\n\nmost\textended\tdistributions\tof\tLinux\tin\tthe\tindustry.\tThey\tprovide\tgreat support\tand\tthere\tis\tplenty\tof\tinformation\tavailable\ton\tthe\tInternet\tto troubleshoot\tproblems.\n\nLet's\tsearch\tfor\ta\tCentOS\timage\tas\tfollows:\n\nAs\tyou\tcan\tsee,\tthere\tis\ta\tlong\tlist\tof\timages\tbased\ton\tCentOS,\tbut\tonly the\tfirst\tone\tis\tofficial.\n\nThis\tlist\tof\timages\tis\tcoming\tfrom\tsomething\tcalled\tthe\tRegistry\tin\tthe Docker\tworld.\tA\tDocker\tRegistry\tis\ta\tsimple\trepository\tof\timages available\tto\tthe\tgeneral\tpublic.\tYou\tcan\talso\trun\tyour\town\tRegistry\tin order\tto\tprevent\tyour\timages\tfrom\tgoing\tto\tthe\tgeneral\tone.\n\nNote\n\nMore\tinformation\tcan\tbe\tfound\tat\tthe\tfollowing\tlink:\n\nhttps://docs.docker.com/registry/\n\nThere\tis\tone\tcolumn\tin\tthe\ttable\tin\tthe\tpreceding\tscreenshot\tthat\tshould\n\nhave\tcaught\tyour\tattention\talmost\timmediately,\tthe\tcolumn\tcalled STARS.\tThis\tcolumn\trepresents\tthe\trating\tgiven\tby\tthe\tusers\tfor\ta\tgiven image.\tWe\tcan\tnarrow\tthe\tsearch\tbased\ton\tthe\tnumber\tof\tstars\tthat\tthe users\thave\tgiven\tto\tan\timage\tby\tusing\tthe\t-s\tflag.\n\nIf\tyou\trun\tthe\tfollowing\tcommand,\tyou\twill\tsee\ta\tlist\tof\timages\trated\twith 1000\tor\tmore\tstars:\n\ndocker\tsearch\t-s\t1000\tcentos\n\nTip\n\nBe\tcareful\twith\tthe\timages\tyou\tchoose,\tthere\tis\tnothing\tpreventing\ta user\tto\tcreate\tan\timage\twith\tmalicious\tsoftware.\n\nIn\torder\tto\tfetch\tthe\tCentOS\timage\tto\tthe\tlocal\tmachine,\twe\tneed\tto\trun the\tfollowing\tcommand:\n\ndocker\tpull\tcentos\n\nThe\toutput\tproduced\twill\tbe\tvery\tsimilar\tto\tthe\tfollowing\timage:\n\nOnce\tthe\tcommand\tfinishes,\tif\twe\trun\tDocker\timages\tagain,\twe\tcan\tsee that\tcentos\tis\tnow\tappearing\tin\tthe\tfollowing\tlist:\n\nAs\twe\tspecified\tearlier,\tDocker\tdoes\tnot\tuse\tthe\tfull\timage,\tbut\tit\tuses\ta reduced\tversion\tof\tit,\tonly\tvirtualizing\tthe\tlast\tfew\tlayers\tof\tthe\tOS.\tYou\n\ncan\tclearly\tsee\tit,\tas\tthe\tsize\tof\tthe\timage\tis\tnot\teven\t200\tMB,\twhich\tfor a\tfull\tversion\tof\tCentOS,\tcan\tgo\tup\tto\ta\tfew\tGB.\n\nRunning\tthe\tcontainer\n\nNow\tthat\twe\thave\ta\tcopy\tof\tthe\timage\tin\tour\tlocal\tmachine,\tit\tis\ttime\tto run\tit:\n\ndocker\trun\t-i\t-t\tcentos\tbinbash\n\nThis\twill\tproduce\tthe\tfollowing\toutput:\n\nAs\tyou\tcan\tsee,\tthe\tprompt\tof\tthe\tterminal\thas\tchanged\tto\tsomething like\troot@debd09c7aa3b,\twhich\tmeans\tthat\twe\tare\tinside\tthe\tcontainer.\n\nFrom\tnow\ton,\tevery\tsingle\tcommand\tthat\twe\trun\twill\tbe\texecuted\tinside a\tcontained\tversion\tof\tCentOS\tLinux.\n\nThere\tis\tanother\tinteresting\tcommand\tin\tDocker:\n\ndocker\tps\n\nIf\twe\trun\tthis\tcommand\tin\ta\tnew\tterminal\t(without\texiting\tfrom\tthe running\tcontainer),\twe\twill\tget\tthe\tfollowing\toutput:\n\nThis\toutput\tis\tself\texplanatory;\tit\tis\tan\teasy\tway\tto\tsee\twhat\tis\tgoing\ton in\tour\tDocker\tcontainers.\n\nInstalling\tthe\trequired\tsoftware\n\nLet's\tinstall\tNode.js\tin\tthe\tcontainer:\n\ncurl\t--silent\t--location\t https://rpm.nodesource.com/setup_4.x\t|\tbash\t-\n\nThis\tcommand\twill\tpull\tand\texecute\tthe\tsetup\tscript\tfor\tNode.js.\n\nThis\twill\tproduce\tan\toutput\tvery\tsimilar\tto\tthe\tfollowing\timage:\n\nFollow\tthe\tinstructions,\tas\tthis\twill\tinstall\tnode:\n\nyum\tinstall\t-y\tnodejs\n\nIt\tis\thighly\trecommended\tto\tinstall\tthe\tdevelopment\ttools,\tas\tthe installation\tprocess\tof\ta\tfew\tmodules\trequires\ta\tcompilation\tstep.\tLet's do\tit:\n\nyum\tinstall\t-y\tgcc-c++\tmake\n\nOnce\tthe\tcommand\tfinishes,\twe\tare\tready\tto\trun\tthe\tnode\tapplications inside\tour\tcontainer.\n\nSaving\tthe\tchanges\n\nIn\tthe\tDocker\tworld,\tan\timage\tis\tthe\tconfiguration\tfor\ta\tgiven\tcontainer. We\tcan\tuse\tthe\timage\tas\ta\ttemplate\tto\trun\tas\tmany\tcontainers\tas\twe want,\thowever\tfirst,\twe\tneed\tto\tsave\tthe\tchanges\tmade\tin\tthe\tprevious section.\n\nIf\tyou\tare\ta\tsoftware\tdeveloper,\tyou\tprobably\tare\tfamiliar\twith\tcontrol version\tsystems\tsuch\tas\tCVS,\tSubversion,\tor\tGit.\tDocker\twas\tbuilt\twith their\tphilosophy\tin\tmind—a\tcontainer\tcan\tbe\ttreated\tlike\ta\tversionable software\tcomponent\tand\tthen\tchanges\tcan\tbe\tcommitted.\n\nIn\torder\tto\tdo\tit,\trun\tthe\tfollowing\tcommand:\n\ndocker\tps\t-a\n\nThis\tcommand\twill\tshow\ta\tlist\tof\tcontainers\tthat\thave\trun\tin\tthe\tpast,\tas shown\tin\tthe\tfollowing\timage:\n\nIn\tmy\tcase,\tthere\tare\tfew\tcontainers,\tbut\tthe\tinteresting\tone\tin\tthis\tcase is\tthe\tsecond;\tthis\tis\twhere\tNode.js\tis\tinstalled.\n\nNow,\twe\tneed\tto\tcommit\tthe\tstatus\tof\tthe\tcontainer\tin\torder\tto\tcreate\ta new\timage\twith\tour\tchanges.\tWe\tdo\tit\tby\trunning\tthe\tfollowing command:\n\ndocker\tcommit\t-a\tdgonzalez\t62e7336a4627\tcentos- microservices:1.0\n\nLet's\texplain\tthe\tcommand:\n\nThe\t-a\tflag\tindicates\tthe\tauthor.\tIn\tthis\tcase,\tdgonzalez. The\tfollowing\tparameter\tis\tcontainer\tid.\tAs\twe\tindicated\tearlier,\tthe second\tcontainer\thas\tthe\tcorresponding\tID\t62e7336a4627. The\tthird\tparameter\tis\ta\tcombination\tof\tthe\tname\tgiven\tto\tthe\tnew image\tand\tthe\ttag\tof\tthe\timage.\tThe\ttagging\tsystem\tcan\tbe\tvery\n\npowerful\twhen\twe\tare\tdealing\twith\tquite\ta\tfew\timages,\tas\tit\tcan\tget really\tcomplicated\tto\tidentify\tsmall\tvariations\tbetween\tthem.\n\nIt\tmight\ttake\ta\tfew\tseconds,\tbut\tafter\tfinishing,\tthe\toutput\tof\tthe command\tmust\tbe\tvery\tsimilar\tto\tthe\tfollowing\timage:\n\nThis\tis\tthe\tindication\tthat\twe\thave\ta\tnew\timage\tin\tour\tlist\twith\tour software\tinstalled.\tRun\tdocker\timages\tagain\tand\tthe\toutput\twill\tconfirm\tit, as\tshown\tin\tthe\tfollowing\timage:\n\nIn\torder\tto\trun\ta\tcontainer\tbased\ton\tthe\tnew\timage,\twe\tcan\trun\tthe following\tcommand:\n\ndocker\trun\t-i\t-t\tcentos-microservices:1.0\tbinbash\n\nThis\twill\tgive\tus\taccess\tto\tthe\tshell\tin\tthe\tcontainer,\tand\twe\tcan\tconfirm that\tNode.js\tis\tinstalled\tby\trunning\tnode\t-v,\twhich\tshould\toutput\tthe version\tof\tNode,\tin\tthis\tcase,\t4.2.4.\n\nDeploying\tNode.js\tapplications\n\nNow,\tit\tis\ttime\tto\tdeploy\tNode.js\tapplications\tinside\tthe\tcontainer.\tIn order\tto\tdo\tit,\twe\tare\tgoing\tto\tneed\tto\texpose\tthe\tcode\tfrom\tour\tlocal machine\tto\tthe\tDocker\tcontainer.\n\nThe\tcorrect\tway\tof\tdoing\tit\tis\tby\tmounting\ta\tlocal\tfolder\tin\tthe\tDocker machine,\tbut\tfirst,\twe\tneed\tto\tcreate\tthe\tsmall\tapplication\tto\tbe\trun inside\tthe\tcontainer,\tas\tfollows:\n\nvar\texpress\t=\trequire('express'); var\tmyApplication\t=\texpress();\n\napp.get('/hello',\tfunction\t(req,\tres)\t{\n\nres.send('Hello\tEarth!'); });\n\nvar\tport\t=\t80;\n\napp.listen(port,\tfunction\t()\t{ \t\tconsole.log('Listeningistening\ton\tport\t'+\tport); });\n\nIt\tis\ta\tsimple\tapplication,\tusing\tExpress\tthat\tbasically\trenders\tHello Earth!\tinto\ta\tbrowser.\tIf\twe\trun\tit\tfrom\ta\tterminal\tand\twe\taccess http://localhost:80/hello,\twe\tcan\tsee\tthe\tresults.\n\nNow,\twe\tare\tgoing\tto\trun\tit\tinside\tthe\tcontainer.\tIn\torder\tto\tdo\tit,\twe\tare going\tto\tmount\ta\tlocal\tfolder\tas\ta\tvolume\tin\tthe\tDocker\tcontainer\tand\trun it.\n\nDocker\tcomes\tfrom\tthe\texperience\tof\tsysadmins\tand\tdevelopers\tthat have\tlately\tmelted\tinto\ta\trole\tcalled\tDevOps,\twhich\tis\tsomewhere\tin between\tthem.\tBefore\tDocker,\tevery\tsingle\tcompany\thad\tits\town\tway\tof deploying\tapps\tand\tmanaging\tconfigurations,\tso\tthere\twas\tno\tconsensus on\thow\tto\tdo\tthings\tthe\tright\tway.\n\nNow\twith\tDocker,\tthe\tcompanies\thave\ta\tway\tto\tprovide\tuniformity\tto deployments.\tNo\tmatter\twhat\tyour\tbusiness\tis,\teverything\tis\treduced\tto build\tthe\tcontainer,\tdeploy\tthe\tapplication,\tand\trun\tthe\tcontainer\tin\tthe appropriate\tmachine.\n\nLet's\tassume\tthat\tthe\tapplication\tis\tin\tthe\tappstest/\tfolder.\tNow,\tin\torder to\texpose\tit\tto\tthe\tcontainer,\twe\trun\tthe\tfollowing\tcommand:\n\ndocker\trun\t-i\t-t\t-v\tapptest:/test_app\t-p\t8000:3000\t centos-microservices:1.0\tbinbash\n\nAs\tyou\tcan\tsee,\tDocker\tcan\tget\tvery\tverbose\twith\tparameters,\tbut\tlet's explain\tthem,\tas\tfollows:\n\nThe\t-i\tand\t-t\tflags\tare\tfamiliar\tto\tus.\tThey\tcapture\tthe\tinput\tand send\tthe\toutput\tto\ta\tterminal. The\t-v\tflag\tis\tnew.\tIt\tspecifies\ta\tvolume\tfrom\tthe\tlocal\tmachine\tand where\tto\tmount\tit\tin\tthe\tcontainer.\tIn\tthis\tcase,\twe\tare\tmounting\n\nappstest\tfrom\tthe\tlocal\tmachine\tinto\t/test_app.\tPlease\tnote\tthe colon\tsymbol\tto\tseparate\tthe\tlocal\tand\tthe\tremote\tpath. The\t-p\tflag\tspecifies\tthe\tport\ton\tthe\tlocal\tmachine\tthat\twill\texpose the\tremote\tport\tin\tthe\tcontainer.\tIn\tthis\tcase,\twe\texpose\tthe\tport 3000\tin\tthe\tcontainer\tthrough\tthe\tport\t8000\tin\tthe\tDocker\tmachine,\tso accessing\tdocker-machine:8000\tfrom\tthe\thost\tmachine\twill\tend\tup accessing\tthe\tport\t3000\tin\tthe\tcontainer. The\tcentos-microservices:1.0\tis\tthe\tname\tand\ttag\tof\tthe\timage\tthat we\thave\tcreated\tin\tthe\tpreceding\tsection. The\tbinbash\tis\tthe\tcommand\tthat\twe\twant\tto\texecute\tinside\tthe container.\tThe\tbinbash\tis\tgoing\tto\tgive\tus\taccess\tto\tthe\tprompt\tof the\tsystem.\n\nIf\teverything\tworked\twell,\twe\tshould\thave\tgotten\taccess\tto\tthe\tsystem prompt\tinside\tthe\tcontainer,\tas\tshown\tin\tthe\tfollowing\timage:\n\nAs\tyou\tcan\tsee\tin\tthe\timage,\tthere\tis\ta\tfolder\tcalled\t/test_app\tthat contains\tour\tprevious\tapplication,\tcalled\tsmall-script.js.\n\nNow,\tit\tis\ttime\tto\taccess\tto\tthe\tapp,\tbut\tfirst,\tlet's\texplain\thow\tDocker works.\n\nDocker\tis\twritten\tin\tGo,\twhich\tis\ta\tmodern\tlanguage\tcreated\tby\tGoogle, grouping\tall\tthe\tbenefits\tfrom\ta\tcompiled\tlanguage\tsuch\tas\tC++\twith\tall the\thigh-level\tfeatures\tfrom\ta\tmodern\tlanguage\tsuch\tas\tJava.\n\nIt\tis\tfairly\teasy\tto\tlearn\tand\tnot\thard\tto\tmaster.\tThe\tphilosophy\tof\tGo\tis\tto bring\tall\tthe\tbenefits\tof\tan\tinterpreted\tlanguage,\tsuch\tas\treducing\tthe compilation\ttimes\t(the\tcomplete\tlanguage\tcan\tbe\tcompiled\tin\tunder\ta minute)\tto\ta\tcompiled\tlanguage.\n\nDocker\tuses\tvery\tspecific\tfeatures\tfrom\tthe\tLinux\tkernel\tthat\tforces Windows\tand\tMac\tusers\tto\tuse\ta\tvirtual\tmachine\tto\trun\tDocker containers.\tThis\tmachine\tused\tto\tbe\tcalled\tboot2docker,\tbut\tthe\tnew version\tis\tcalled\tDocker\tMachine,\twhich\tcontains\tmore\tadvanced\n\nfeatures\tsuch\tas\tdeploying\tcontainers\tin\tremote\tvirtual\tmachines.\tFor this\texample,\twe\twill\tonly\tuse\tthe\tlocal\tcapabilities.\n\nGiven\tthat,\tif\tyou\trun\tthe\tapp\tfrom\twithin\tthe\tcontainer\tlocated\tin\tthe /test_app/\tfolder,\tand\tyou\tare\tin\tLinux,\taccessing http://localhost:8000/,\tit\twould\tbe\tenough\tto\tget\tinto\tthe\tapplication.\n\nWhen\tyou\tare\tusing\tMac\tor\tWindows,\tDocker\tis\trunning\teither\tin\tthe Docker\tMachine\tor\tboot2docker\tso\tthat\tthe\tIP\tis\tgiven\tby\tthis\tvirtual machine,\twhich\tis\tshown\twhen\tthe\tDocker\tterminal\tstarts,\tas\tshown\tin the\tfollowing\timage:\n\nAs\tyou\tcan\tsee,\tthe\tIP\tis\t192.168.99.100,\tso\tin\torder\tto\taccess\tour application,\twe\tneed\tto\tvisit\tthe\thttp://192.168.99.100:9000/\tURL.\n\nAutomating\tDocker\tcontainer\tcreation\n\nIf\tyou\tremember,\tin\tthe\tprevious\tchapters,\tone\tof\tthe\tmost\timportant concepts\twas\tautomation.\tAutomation\tis\tthe\tkey\twhen\tworking\twith microservices.\tInstead\tof\toperating\tone\tserver,\tyou\tprobably\twill\tneed\tto operate\tfew\tdozens,\treaching\ta\tpoint\twhere\tyou\tare\talmost\tfully\tbooked on\tday-to-day\ttasks.\n\nDocker\tdesigners\thad\tthat\tin\tmind\twhen\tallowing\tthe\tusers\tto\tcreate containers\tfrom\ta\tscript\twritten\tin\ta\tfile\tcalled\tDockerfile.\n\nIf\tyou\thave\tever\tworked\ton\tcoding\tC\tor\tC++,\teven\tin\tcollege,\tyou\tare probably\tfamiliar\twith\tMakefiles.\tA\tMakefile\tfile\tis\ta\tscript\twhere\tthe\n\ndeveloper\tspecifies\tthe\tsteps\tto\tautomatically\tbuild\ta\tsoftware component.\tHere\tis\tan\texample:\n\nall:\tmy-awesome-app\n\nmy-awesome-app:\tmain.o\texternal-module.o\tapp-core.o \t\tg++\tmain.o\texternal-module.o\tapp-core.o\t-o\tmy- awesome-app\n\nmain.o:\tmain.cc \t\tg++\t-c\tmain.cc\n\nexternal-module.o:\texternal-module.cc \t\tg++\t-c\texternal-module.cc\n\napp-core.o:\tapp-core.cc \t\tg++\t-c\thello.cc\n\nclean: \t\trm\t*.o\tmy-awesome-app\n\nThe\tpreceding\tMakefile\tcontains\ta\tlist\tof\ttasks\tand\tdependencies\tto\tbe executed.\tFor\texample,\tif\twe\texecute\tmake\tclean\ton\tthe\tsame\tfolder where\tthe\tMakefile\tfile\tis\tcontained,\tit\twill\tremove\tthe\texecutable\tand\tall the\tfiles\tending\twith\to.\n\nDockerfile,\tunlike\tMakefile,\tis\tnot\ta\tlist\tof\ttasks\tand\tdependencies\t(even though\tthe\tconcept\tis\tthe\tsame),\tit\tis\ta\tlist\tof\tinstructions\tto\tbuild\ta container\tfrom\tscratch\tto\ta\tready\tstatus.\n\nLet's\tsee\tan\texample:\n\nFROM\tcentos MAINTAINER\tDavid\tGonzalez RUN\tcurl\t--silent\t--location\t https://rpm.nodesource.com/setup_4.x\t|\tbash\t- RUN\tyum\t-y\tinstall\tnodejs\n\nThese\tsmall\tfew\tpreceding\tlines\tare\tenough\tto\tbuild\ta\tcontainer\thaving Node.js\tinstalled.\n\nLet's\texplain\tit\tin\tthe\tfollowing:\n\nFirst,\twe\tchoose\tthe\tbase\timage.\tIn\tthis\tcase,\tit\tis\tcentos\tas\twe used\tbefore.\tFor\tdoing\tthis,\twe\tuse\tthe\tFROM\tcommand\tand\tthen\tthe name\tof\tthe\timage. MAINTAINER\tspecifies\tthe\tname\tof\tthe\tperson\twho\tcreated\tthe container.\tIn\tthis\tcase,\tit\tis\tDavid\tGonzalez. RUN,\tas\tits\tname\tindicates,\truns\ta\tcommand.\tIn\tthis\tcase,\twe\tuse\tit twice:\tonce\tto\tadd\tthe\trepository\tto\tyum,\tand\tthen\tto\tinstall\tNode.js.\n\nDockerfiles\tcan\tcontain\ta\tnumber\tof\tdifferent\tcommands.\tThe documentation\tfor\tthem\tis\tpretty\tclear,\tbut\tlet's\ttake\ta\tlook\tat\tthe\tmost common\t(aside\tfrom\tthe\tones\tseen\tbefore):\n\nCMD:\tThis\tis\tsimilar\tto\trun,\tbut\tit\tactually\tgets\texecuted\tafter\tbuilding the\tcommand.\tCMD\tis\tthe\tcommand\tto\tbe\tused\tto\tstart\tan\tapplication once\tthe\tcontainer\tis\tinstantiated. WORKDIR:\tThis\tis\tto\tbe\tused\tin\tconjunction\twith\tCMD,\tit\tis\tthe\tcommand used\tto\tspecify\tthe\twork\tdirectory\tfor\tthe\tnext\tCMD\tcommand. ADD:\tThis\tcommand\tis\tused\tto\tcopy\tfiles\tfrom\tthe\tlocal\tfilesystem\tto the\tcontainer\tinstance\tfilesystem.\tIn\tthe\tprevious\texample,\twe\tcan use\tADD\tto\tcopy\tthe\tapplication\tfrom\tthe\thost\tmachine\tinto\tthe container,\trun\tnpm\tinstall\twith\tthe\tCMD\tcommand,\tand\tthen\trun\tthe app\tonce\tagain\twith\tthe\tCMD\tcommand.\tIt\tcan\talso\tbe\tused\tto\tcopy the\tcontent\tfrom\ta\tURL\tto\ta\tdestination\tfolder\tinside\tthe\tcontainer. ENV:\tThis\tis\tused\tto\tset\tenvironment\tvariables.\tFor\texample,\tyou could\tspecify\ta\tfolder\tto\tstore\tfiles\tuploaded\tby\tpassing\tan environment\tvariable\tto\tthe\tcontainer,\tas\tfollows:\n\nENV\tUPLOAD_PATH=/tmp/\n\nEXPOSE:\tThis\tis\tused\tto\texpose\tports\tto\tthe\trest\tof\tthe\tcontainers\tin your\tcluster.\n\nAs\tyou\tcan\tsee,\tthe\tdomain-specific\tlanguage\t(DSL)\tof\tDockerfiles\tis quite\trich\tand\tyou\tcan\tpretty\tmuch\tbuild\tevery\tsystem\trequired.\tThere are\thundreds\tof\texamples\ton\tthe\tInternet\tto\tbuild\tpretty\tmuch\teverything: MySQL,\tMongoDB,\tApache\tservers,\tand\tso\ton.\n\nIt\tis\tstrongly\trecommended\tto\tcreate\tcontainers\tthrough\tDockerfiles,\tas\n\nit\tcan\tbe\tused\tas\ta\tscript\tto\treplicate\tand\tmake\tchanges\tto\tthe containers\tin\tthe\tfuture,\tas\twell\tas\tbeing\table\tto\tautomatically\tdeploy\tour software\twithout\tmuch\tmanual\tintervention.\n\nNode.js\tevent\tloop\t–\teasy\tto\tlearn and\thard\tto\tmaster\n\nWe\tall\tknow\tthat\tNode.js\tis\ta\tplatform\tthat\truns\tapplications\tin\ta\tsingle- threaded\tway;\tso,\twhy\tdon't\twe\tuse\tmultiple\tthreads\tto\trun\tapplications so\tthat\twe\tcan\tget\tthe\tbenefit\tof\tmulticore\tprocessors?\n\nNode.js\tis\tbuilt\tupon\ta\tlibrary\tcalled\tlibuv.\tThis\tlibrary\tabstracts\tthe system\tcalls,\tproviding\tan\tasynchronous\tinterface\tto\tthe\tprogram\tthat uses\tit.\n\nI\tcome\tfrom\ta\tvery\theavy\tJava\tbackground,\tand\tthere,\teverything\tis synchronous\t(unless\tyou\tare\tcoding\twith\tsome\tsort\tof\tnon-blocking libraries),\tand\tif\tyou\tissue\ta\trequest\tto\tthe\tdatabase,\tthe\tthread\tis blocked\tand\tresumed\tonce\tthe\tdatabase\treplies\twith\tthe\tdata.\n\nThis\tusually\tworks\tfine,\tbut\tit\tpresents\tan\tinteresting\tproblem:\ta\tblocked thread\tis\tconsuming\tresources\tthat\tcould\tbe\tused\tto\tserve\tother requests.\tThe\tevent\tloop\tof\tNode.js\tis\tshown\tin\tthe\tfollowing\tfigure:\n\nThis\tis\tthe\tNode.js\tevent\tloop\tdiagram\n\nJavaScript\tis,\tby\tdefault,\tan\tevent-driven\tlanguage.\tIt\texecutes\tthe program\tthat\tconfigures\ta\tlist\tof\tevent\thandlers\tthat\twill\treact\tto\tgiven events,\tand\tafter\tthat,\tit\tjust\twaits\tfor\tthe\taction\tto\ttake\tplace.\n\nLet's\ttake\ta\tlook\tat\ta\tvery\tfamiliar\texample:\n\n<div\tid=\"target\"> \t\tClick\there </div> <div\tid=\"other\"> \t\tTrigger\tthe\thandler </div>\n\nThen\tthe\tJavaScript\tcode\tis\tas\tfollows:\n\n$(\t\"#target\"\t).click(function()\t{ \t\talert(\t\"Handler\tfor\t.click()\tcalled.\"\t); });\n\nAs\tyou\tcan\tsee,\tthis\tis\ta\tvery\tsimple\texample.\tHTML\tthat\tshows\ta\tbutton and\tsnippet\tof\tJavaScript\tcode\tthat,\tusing\tJQuery,\tshows\tan\talert\tbox when\tthe\tbutton\tis\tclicked.\n\nThis\tis\tthe\tkey:\twhen\tthe\tbutton\tis\tclicked.\n\nClicking\ta\tbutton\tis\tan\tevent,\tand\tthe\tevent\tis\tprocessed\tthrough\tthe event\tloop\tof\tJavaScript\tusing\ta\thandler\tspecified\tin\tthe\tJavaScript.\n\nAt\tthe\tend\tof\tthe\tday,\twe\tonly\thave\tone\tthread\texecuting\tthe\tevents,\tand we\tnever\ttalk\tabout\tparallelism\tin\tJavaScript,\tthe\tcorrect\tword\tis concurrency.\tSo,\tbeing\tmore\tconcise,\twe\tcan\tsay\tthat\tNode.js\tprograms are\thighly\tconcurrent.\n\nYour\tapplication\twill\talways\tbe\texecuted\tin\tonly\tone\tthread,\tand\twe\tneed to\tkeep\tthat\tin\tmind\twhile\tcoding.\n\nIf\tyou\thave\tbeen\tworking\tin\tJava\tor\t.NET\tor\tany\tother language/frameworks\tdesigned\tand\timplemented\twith\tthread-blocking techniques,\tyou\tmight\thave\tobserved\tthat\tTomcat,\twhen\trunning\tan application,\tspawns\ta\tnumber\tof\tthreads\tlistening\tto\tthe\trequests.\n\nIn\tthe\tJava\tworld,\teach\tof\tthese\tthreads\tare\tcalled\tworkers,\tand\tthey are\tresponsible\tto\thandle\tthe\trequest\tfrom\ta\tgiven\tuser\tfrom\tthe beginning\tto\tthe\tend.\tThere\tis\tone\ttype\tof\tdata\tstructure\tin\tJava\tthat takes\tthe\tbenefit\tof\tit.\tIt\tis\tcalled\tThreadLocal\tand\tit\tstores\tthe\tdata\tin the\tlocal\tthread\tso\tthat\tit\tcan\tbe\trecovered\tlater\ton.\tThis\ttype\tof\tstorage\n\nis\tpossible\tbecause\tthe\tthread\tthat\tstarts\tthe\trequest\tis\talso\tresponsible to\tfinish\tit,\tand\tif\tthe\tthread\tis\texecuting\tany\tblocking\toperation\t(such\tas reading\ta\tfile\tor\taccessing\ta\tdatabase),\tit\twill\twait\tuntil\tit\tis\tcompleted.\n\nThis\tis\tusually\tnot\ta\tbig\tdeal,\tbut\twhen\tyour\tsoftware\trelies\theavily\ton I/O,\tthe\tproblems\tcan\tbecome\tserious.\n\nAnother\tbig\tpoint\tin\tfavor\tof\tthe\tnon-blocking\tmodel\tof\tNode.js\tis\tthe\tlack of\tcontext\tswitch.\n\nWhen\tthe\tCPU\tswitches\tone\tthread\twith\tanother,\twhat\thappens\tis\tthat\tall the\tdata\tin\tthe\tregisters,\tand\tother\tareas\tof\tthe\tmemory,\tis\tstacked\tand allows\tthe\tCPU\tto\tswitch\tthe\tcontext\twith\ta\tnew\tprocess\tthat\thas\tits\town data\tto\tbe\tplaced\tin\tthere,\tas\tshown\tin\tthe\tfollowing\timage:\n\nThis\tis\ta\tdiagram\tshowing\tcontext\tswitching\tin\tthreads\tfrom\tthe\ttheoretical\tpoint\tof\tview.\n\nThis\toperation\ttakes\ttime,\tand\tthis\ttime\tis\tnot\tused\tby\tthe\tapplication.\tIt simply\tgets\tlost.\tIn\tNode.js,\tyour\tapplication\truns\tin\tonly\tone\tthread,\tso there\tis\tno\tsuch\tcontext\tswitching\twhile\trunning\t(it\tis\tstill\tpresent\tin\tthe background,\tbut\thidden\tto\tyour\tprogram).\tIn\tthe\tfollowing\timage,\twe\tcan see\twhat\thappens\tin\tthe\treal\tworld\twhen\ta\tCPU\tswitches\ta\tthread:\n\nThis\tis\ta\tdiagram\tshowing\tcontext\tswitching\tin\tthreads\tfrom\tthe\tpractical\t(shows\tthe\tdead\ttimes) point\tof\tview.\n\nClustering\tNode.js\tapplications\n\nBy\tnow,\tyou\tknow\thow\tNode.js\tapplications\twork,\tand\tcertainly,\tsome\tof the\treaders\tmay\thave\ta\tquestion\tthat\tif\tthe\tapp\truns\ton\ta\tsingle\tthread, then\twhat\thappens\twith\tthe\tmodern\tmulticore\tprocessors?\n\nBefore\tanswering\tthis\tquestion,\tlet's\ttake\ta\tlook\tat\tthe\tfollowing\tscenario.\n\nWhen\tI\twas\tin\thigh\tschool,\tthere\twas\ta\tbig\ttechnology\tleap\tin\tCPUs:\tthe segmentation.\n\nIt\twas\tthe\tfirst\tattempt\tto\tintroduce\tparallelism\tat\tthe\tinstruction\tlevel.\tAs you\tprobably\tare\taware,\tthe\tCPU\tinterprets\tassembler\tinstructions\tand each\tof\tthese\tinstructions\tare\tcomposed\tof\ta\tnumber\tof\tphases,\tas shown\tin\tthe\tfollowing\tdiagram:\n\nBefore\tthe\tIntel\t4x86,\tthe\tCPUs\twere\texecuting\tone\tinstruction\tat\tthe time,\tso\ttaking\tthe\tinstruction\tmodel\tfrom\tthe\tpreceding\tdiagram,\tany CPU\tcould\tonly\texecute\tone\tinstruction\tevery\tsix\tCPU\tcycles.\n\nThen,\tthe\tsegmentation\tcame\tinto\tplay.\tWith\ta\tset\tof\tintermediate registers,\tthe\tCPU\tengineers\tmanaged\tto\tparallelize\tthe\tindividual phases\tof\tinstructions\tso\tthat\tin\tthe\tbest-case\tscenario,\tthe\tCPUs\tare able\tto\texecute\tone\tinstruction\tper\tcycle\t(or\tnearly),\tas\tshown\tin\tthe following\tdiagram:\n\nThe\timage\tdescribes\tthe\texecution\tof\tinstructions\tin\ta\tCPU\twith\ta\tsegmented\tpipeline\n\nThis\ttechnical\timprovement\tled\tto\tfaster\tCPUs\tand\topened\tthe\tdoor\tto native\thardware\tmultithreading,\twhich\tled\tto\tthe\tmodern\tn-core processors\tthat\tcan\texecute\ta\tlarge\tnumber\tof\tparallel\ttasks,\tbut\twhen we\tare\trunning\tNode.js\tapplications,\twe\tonly\tuse\tone\tcore.\n\nIf\twe\tdon't\tcluster\tour\tapp,\twe\tare\tgoing\tto\thave\ta\tserious\tperformance degradation\twhen\tcompared\tto\tother\tplatforms\tthat\ttake\tthe\tbenefit\tof the\tmultiple\tcores\tof\ta\tCPU.\n\nHowever,\tthis\ttime\twe\tare\tlucky,\tPM2\talready\tallows\tyou\tto\tcluster Node.js\tapps\tto\tmaximize\tthe\tusage\tof\tyour\tCPUs.\n\nAlso,\tone\tof\tthe\timportant\taspects\tof\tPM2\tis\tthat\tit\tallows\tyou\tto\tscale applications\twithout\tany\tdowntime.\n\nLet's\trun\ta\tsimple\tapp\tin\tthe\tcluster\tmode:\n\nvar\thttp\t=\trequire(\"http\"); http.createServer(function\t(request,\tresponse)\t{ \t\tresponse.writeHead(200,\t{ \t\t\t\t'Content-Type':\t'text/plain'\n\n}); \t\tresponse.write('Here\twe\tare!') \t\tresponse.end(); }).listen(3000);\n\nThis\ttime\twe\thave\tused\tthe\tnative\tHTTP\tlibrary\tfor\tNode.js\tin\torder\tto handle\tthe\tincoming\tHTTP\trequests.\n\nNow\twe\tcan\trun\tthe\tapplication\tfrom\tthe\tterminal\tand\tsee\thow\tit\tworks:\n\nnode\tapp.js\n\nAlthough\tit\tdoes\tnot\toutput\tanything,\twe\tcan\tcurl\tto\tthe http://localhost:3000/\tURL\tin\torder\tto\tsee\thow\tthe\tserver\tresponds,\tas shown\tin\tthe\tfollowing\tscreenshot:\n\nAs\tyou\tcan\tsee,\tNode.js\thas\tmanaged\tall\tthe\tHTTP\tnegotiation\tand\tit has\talso\tmanaged\tto\treply\twith\tthe\tHere\twe\tare!\tphrase\tas\tit\twas specified\tin\tthe\tcode.\n\nThis\tservice\tis\tquite\ttrivial,\tbut\tit\tis\tthe\tprinciple\ton\twhich\tmore\tcomplex\n\nweb\tservices\twork,\tso\twe\tneed\tto\tcluster\tthe\tweb\tservice\tto\tavoid bottlenecks.\n\nNode.js\thas\tone\tlibrary\tcalled\tcluster\tthat\tallows\tus\tto\tprogrammatically cluster\tour\tapplication,\tas\tfollows:\n\nvar\tcluster\t=\trequire('cluster'); var\thttp\t=\trequire('http'); var\tcpus\t=\trequire('os').cpus().length;\n\n//\tHere\twe\tverify\tif\tthe\twe\tare\tthe\tmaster\tof\tthe\t cluster:\tThis\tis\tthe\troot\tprocess //\tand\tneeds\tto\tfork\tal\tthe\tchilds\tthat\twill\tbe\t executing\tthe\tweb\tserver. if\t(cluster.isMaster)\t{ \t\tfor\t(var\ti\t=\t0;\ti\t<\tcpus;\ti++)\t{ \t\t\t\tcluster.fork(); \t\t}\n\ncluster.on('exit',\tfunction\t(worker,\tcode,\tsignal)\t{ \t\t\t\tconsole.log(\"Worker\t\"\t+\tworker.proces.pid\t+\t\"\thas\t finished.\"); \t\t}); }\telse\t{ \t\t//\tHere\twe\tare\ton\tthe\tchild\tprocess.\tThey\twill\tbe\t executing\tthe\tweb\tserver. \t\thttp.createServer(function\t(request,\tresponse)\t{ \t\t\t\tresponse.writeHead(200); \t\t\t\tresponse.end('Here\twe\tare!d\\n'); \t\t}).listen(80); }\n\nPersonally,\tI\tfind\tit\tmuch\teasier\tto\tuse\tspecific\tsoftware\tsuch\tas\tPM2\tto accomplish\teffective\tclustering,\tas\tthe\tcode\tcan\tget\treally\tcomplicated while\ttrying\tto\thandle\tthe\tclustered\tinstances\tof\tour\tapp.\n\nGiven\tthis,\twe\tcan\trun\tthe\tapplication\tthrough\tPM2\tas\tfollows:\n\npm2\tstart\tapp.js\t-i\t1\n\nThe\t-i\tflag\tin\tPM2,\tas\tyou\tcan\tsee\tin\tthe\toutput\tof\tthe\tcommand,\tis\tused to\tspecify\tthe\tnumber\tof\tcores\tthat\twe\twant\tto\tuse\tfor\tour\tapplication.\n\nIf\twe\trun\tpstree,\twe\tcan\tsee\tthe\tprocess\ttree\tin\tour\tsystem\tand\tcheck whether\tPM2\tis\trunning\tonly\tone\tprocess\tfor\tour\tapp,\tas\tshown\tin\tthe following\timage:\n\nIn\tthis\tcase,\twe\tare\trunning\tthe\tapp\tin\tonly\tone\tprocess,\tso\tit\twill\tbe allocated\tin\tone\tcore\tof\tthe\tCPU.\n\nIn\tthis\tcase,\twe\tare\tnot\ttaking\tadvantage\tof\tthe\tmulticore\tcapabilities\tof the\tCPU\tthat\tis\trunning\tthe\tapp,\tbut\twe\tstill\tget\tthe\tbenefit\tof\trestarting the\tapp\tautomatically\tif\tone\texception\tbubbles\tup\tfrom\tour\talgorithm.\n\nNow,\twe\tare\tgoing\tto\trun\tour\tapplication\tusing\tall\tthe\tcores\tavailable\tin our\tCPU\tso\tthat\twe\tmaximize\tthe\tusage\tof\tit,\tbut\tfirst,\twe\tneed\tto\tstop the\tcluster:\n\npm2\tstop\tall\n\nPM2,\tafter\tstopping\tall\tthe\tservices\n\npm2\tdelete\tall\n\nNow,\twe\tare\tin\ta\tposition\tto\trerun\tthe\tapplication\tusing\tall\tthe\tcores\tof our\tCPU:\n\npm2\tstart\tapp.js\t-i\t0\n\nPM2\tshowing\tfour\tservices\trunning\tin\ta\tcluster\tmode\n\nPM2\thas\tmanaged\tto\tguess\tthe\tnumber\tof\tCPUs\tin\tour\tcomputer,\tin\tmy case,\tthis\tis\tan\tiMac\twith\tfour\tcores,\tas\tshown\tin\tthe\tfollowing screenshot:\n\nAs\tyou\tcan\tsee\tin\tpstree,\tPM2\tstarted\tfour\tthreads\tat\tthe\tOS\tlevel,\tas shown\tin\tthe\tfollowing\timage:\n\nWhen\tclustering\tan\tapplication,\tthere\tis\tan\tunwritten\trule\tabout\tthe number\tof\tcores\tthat\tan\tapplication\tshould\tbe\tusing\tand\tthis\tnumber\tis the\tnumber\tof\tcores\tminus\tone.\n\nThe\treason\tbehind\tthis\tnumber\tis\tthe\tfact\tthat\tthe\tOS\tneeds\tsome\tCPU power\tso\tthat\tif\twe\tuse\tall\tthe\tCPUs\tin\tour\tapplication,\tonce\tthe\tOS starts\tcarrying\ton\twith\tsome\tother\ttasks,\tit\twill\tforce\tcontext\tswitching\tas all\tthe\tcores\twill\tbe\tbusy\tand\tthis\twill\tslow\tdown\tthe\tapplication.\n\nLoad\tbalancing\tour\tapplication\n\nSometimes,\tclustering\tour\tapp\tis\tnot\tenough\tand\twe\tneed\tto\tscale\tour application\thorizontally.\n\nThere\tare\ta\tnumber\tof\tways\tto\thorizontally\tscale\tan\tapp.\tNowadays,\twith cloud\tproviders\tsuch\tas\tAmazon,\tevery\tsingle\tprovider\thas\timplemented their\town\tsolution\twith\ta\tnumber\tof\tfeatures.\n\nOne\tof\tmy\tpreferred\tways\tof\timplementing\tthe\tload\tbalancing\tis\tusing NGINX.\n\nNGINX\tis\ta\tweb\tserver\twith\ta\tstrong\tfocus\ton\tthe\tconcurrency\tand\tlow memory\tusage.\tIt\tis\talso\tthe\tperfect\tfit\tfor\tNode.js\tapplications\tas\tit\tis highly\tdiscouraged\tto\tserve\tstatic\tresources\tfrom\twithin\ta\tNode.js application.\tThe\tmain\treason\tis\tto\tavoid\tthe\tapplication\tfrom\tbeing\tunder stress\tdue\tto\ta\ttask\tthat\tcould\tbe\tdone\tbetter\twith\tanother\tsoftware,\tsuch as\tNGINX\t(which\tis\tanother\texample\tof\tspecialization).\n\nHowever,\tlet's\tfocus\ton\tload\tbalancing.\tThe\tfollowing\tfigure\tshows\thow NGINX\tworks\tas\ta\tload\tbalancer:\n\nAs\tyou\tcan\tsee\tin\tthe\tpreceding\tdiagram,\twe\thave\ttwo\tPM2\tclusters\tload balanced\tby\tan\tinstance\tof\tNGINX.\n\nThe\tfirst\tthing\twe\tneed\tto\tdo\tis\tknow\thow\tNGINX\tmanages\tthe configuration.\n\nOn\tLinux,\tNGINX\tcan\tbe\tinstalled\tvia\tyum,\tapt-get,\tor\tany\tother\tpackage manager.\tIt\tcan\talso\tbe\tbuilt\tfrom\tthe\tsource,\tbut\tthe\trecommended method,\tunless\tyou\thave\tvery\tspecific\trequirements,\tis\tto\tuse\ta\tpackage manager.\n\nBy\tdefault,\tthe\tmain\tconfiguration\tfile\tis\tetcnginx/nginx.conf,\tas\tfollows:\n\nuser\t\tnginx;\n\nworker_processes\t\t1;\n\nerror_log\t\tvarlog/nginx/error.log\twarn; pid\t\t\t\t\t\t\t\tvarrun/nginx.pid;\n\nevents\t{ \t\tworker_connections\t\t1024; }\n\nhttp\t{ \t\tinclude\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tetcnginx/mime.types; \t\tdefault_type\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tapplication/octet- stream;\n\nlog_format\t\t\t\t\t\t\t\t\t\tmain\t'$remote_addr\t-\t $remote_user\t[$time_local]\t\"$request\"\t' \t\t\t\t\t'$status\t$body_bytes_sent\t\"$http_referer\"\t' \t\t\t\t\t'\"$http_user_agent\"\t\"$http_x_forwarded_for\"\t' \t\t\t\t\t'$request_time';\n\naccess_log\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvarlog/nginx/access.log\t\t main; \t\tserver_tokens\t\t\t\t\t\t\t\t\t\t\t\t\t\t\toff; \t\tsendfile\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton; \t\t#tcp_nopush\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton; \t\tkeepalive_timeout\t\t\t\t\t\t\t\t\t\t\t65s; \t\tsend_timeout\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t15s; \t\tclient_header_timeout\t\t\t\t\t\t\t15s; \t\tclient_body_timeout\t\t\t\t\t\t\t\t\t15s; \t\tclient_max_body_size\t\t\t\t\t\t\t\t5m; \t\tignore_invalid_headers\t\t\t\t\t\ton; \t\tfastcgi_buffers\t\t\t\t\t\t\t\t\t\t\t\t\t16\t4k; \t\t#gzip\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton; \t\tinclude\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tetcnginx/sites- enabled/*.conf; }\n\nThis\tfile\tis\tpretty\tstraightforward,\tit\tspecifies\tthe\tnumber\tof\tworkers (remember,\tprocesses\tto\tserve\trequests),\tthe\tlocation\tof\terror\tlogs, number\tconnections\tthat\ta\tworker\tcan\thave\tactive\tat\tthe\ttime,\tand\tfinally, the\tHTTP\tconfiguration.\n\nThe\tlast\tline\tis\tthe\tmost\tinteresting\tone:\twe\tare\tinforming\tNGINX\tto\tuse etcnginx/sites-enabled/*.conf\tas\tpotential\tconfiguration\tfiles.\n\nWith\tthis\tconfiguration,\tevery\tfile\tending\tin\t.conf\tunder\tthe\tspecified folder\tis\tgoing\tto\tbe\tpart\tof\tthe\tNGINX\tconfiguration.\n\nAs\tyou\tcan\tsee,\tthere\tis\ta\tdefault\tfile\talready\texisting\tthere.\tModify\tit\tto look\tas\tfollows:\n\nhttp\t{ \t\tupstream\tapp\t{ \t\t\t\tserver\t10.0.0.1:3000; \t\t\t\tserver\t10.0.0.2:3000; \t\t} \t\tserver\t{ \t\t\t\tlisten\t80; \t\t\t\tlocation\t\t{ \t\t\t\t\t\tproxy_pass\thttp:/app; \t\t\t\t} \t\t} }\n\nThis\tis\tall\tthe\tconfiguration\twe\tneed\tto\tbuild\ta\tload\tbalancer.\tLet's explain\tit\tin\tthe\tfollowing:\n\nThe\tupstream\tapp\tdirective\tis\tcreating\ta\tgroup\tof\tservices\tcalled\tapp. Inside\tthis\tdirective,\twe\tspecify\ttwo\tservers\tas\twe've\tseen\tin\tthe previous\timage. The\tserver\tdirective\tspecifies\tto\tNGINX\tthat\tit\tshould\tbe\tlistening\tto all\tthe\trequests\tfrom\tport\t80\tand\tpassing\tthem\tto\tthe\tgroup\tof upstream\tcalled\tapp.\n\nNow,\thow\tdoes\tNGINX\tdecide\tto\tsend\tthe\trequest\tto\twhich\tcomputer?\n\nIn\tthis\tcase,\twe\tcould\tspecify\tthe\tstrategy\tused\tto\tspread\tthe\tload.\n\nBy\tdefault,\tNGINX,\twhen\tthere\tis\tnot\ta\tbalancing\tmethod\tspecifically configured,\tuses\tRound\tRobin.\n\nOne\tthing\tto\tbear\tin\tmind\tis\tthat\tif\twe\tuse\tround\trobin,\tour\tapplication should\tbe\tstateless\tas\twe\twon't\tbe\talways\thitting\tthe\tsame\tmachine,\tso if\twe\tsave\tthe\tstatus\tin\tthe\tserver,\tit\tmight\tnot\tbe\tthere\tin\tthe\tfollowing call.\n\nRound\tRobin\tis\tthe\tmost\telementary\tway\tof\tdistributing\tload\tfrom\ta queue\tof\twork\tinto\ta\tnumber\tof\tworkers;\tit\trotates\tthem\tso\tthat\tevery node\tgets\tthe\tsame\tamount\tof\trequests.\n\nThere\tare\tother\tmechanisms\tto\tspread\tthe\tload,\tas\tfollows:\n\nupstream\tapp\t{ \t\t\t\tleast_conn; \t\t\t\tserver\t10.0.0.1:3000; \t\t\t\tserver\t10.0.0.2:3000; \t\t}\n\nLeast\tconnected,\tas\tits\tname\tindicates,\tsends\tthe\trequest\tto\tthe\tleast connected\tnode,\tequally\tdistributing\tthe\tload\tbetween\tall\tthe\tnodes:\n\nupstream\tapp\t{ \t\t\t\tip_hash; \t\t\t\tserver\t10.0.0.1:3000; \t\t\t\tserver\t10.0.0.2:3000; \t\t}\n\nIP\thashing\tis\tan\tinteresting\tway\tof\tdistributing\tthe\tload.\tIf\tyou\thave\tever worked\twith\tany\tweb\tapplication,\tthe\tconcept\tof\tsessions\tis\tsomething present\tin\talmost\tany\tapplication.\tIn\torder\tto\tremember\twho\tthe\tuser\tis, the\tbrowser\tsends\ta\tcookie\tto\tthe\tserver,\twhich\thas\tstored\twho\tthe\tuser is\tin\tmemory\tand\twhat\tdata\the/she\tneeds/can\tbe\taccessed\tby\tthat\tgiven user.\tThe\tproblem\twith\tthe\tother\ttype\tof\tload\tbalancing\tis\tthat\twe\tare\tnot guaranteed\tto\talways\thit\tthe\tsame\tserver.\n\nFor\texample,\tif\twe\tare\tusing\tLeast\tconnected\tas\ta\tpolicy\tfor\tbalancing, we\tcould\thit\tthe\tserver\tone\tin\tthe\tfirst\tload,\tbut\tthen\thit\ta\tdifferent\tserver on\tsubsequent\tredirections\tthat\twill\tresult\tin\tthe\tuser\tnot\tbeing\tdisplayed with\tthe\tright\tinformation\tas\tthe\tsecond\tserver\twon't\tknow\twho\tthe\tuser is.\n\nWith\tIP\thashing,\tthe\tload\tbalancer\twill\tcalculate\ta\thash\tfor\ta\tgiven\tIP. This\thash\twill\tsomehow\tresult\tin\ta\tnumber\tfrom\t1\tto\tN,\twhere\tN\tis\tthe number\tof\tservers,\tand\tthen,\tthe\tuser\twill\talways\tbe\tredirected\tto\tthe same\tmachine\tas\tlong\tas\tthey\tkeep\tthe\tsame\tIP.\n\nWe\tcan\talso\tapply\ta\tweight\tto\tthe\tload\tbalancing,\tas\tfollows:\n\nupstream\tapp\t{ \t\t\t\tserver\t10.0.0.1:3000\tweight=5; \t\t\t\tserver\t10.0.0.2:3000;\n\n}\n\nThis\twill\tdistribute\tthe\tload\tin\tsuch\tway\tthat,\tfor\tevery\tsix\trequests,\tfive will\tbe\tdirected\tto\tthe\tfirst\tmachine\tand\tone\twill\tbe\tdirected\tto\tthe\tsecond machine.\n\nOnce\twe\thave\tchosen\tour\tpreferred\tload\tbalancing\tmethod,\twe\tcan restart\tNGINX\tfor\tthe\tchanges\tto\ttake\teffect,\tbut\tfirst,\twe\twant\tto\tvalidate them\tas\tshown\tin\tthe\tfollowing\timage:\n\nAs\tyou\tcan\tsee,\tthe\tconfiguration\ttest\tcan\tbe\treally\thelpful\tin\torder\tto avoid\tconfiguration\tdisasters.\n\nOnce\tNGINX\thas\tpassed\tconfigtest,\tit\tis\tguaranteed\tthat\tNGINX\twill\tbe able\tto\trestart/start/reload\twithout\tany\tsyntax\tproblem,\tas\tfollows:\n\nsudo\tetcinit.d/nginx\treload\n\nReload\twill\tgracefully\twait\tuntil\tthe\told\tthreads\tare\tdone,\tand\tthen,\treload the\tconfiguration\tand\troute\tthe\tnew\trequests\twith\tthe\tnew\tconfiguration.\n\nIf\tyou\tare\tinterested\tin\tlearning\tabout\tNGINX,\tI\tfound\tthe\tfollowing\tofficial documentation\tof\tNGINX\tquite\thelpful:\n\nhttp://nginx.org/en/docs/\n\nHealth\tcheck\ton\tNGINX\n\nHealth\tchecking\tis\tone\tof\tthe\timportant\tactivities\ton\ta\tload\tbalancer. What\thappens\tif\tone\tof\tthe\tnodes\tsuffers\ta\tcritical\thardware\tfailure\tand is\tunable\tto\tserve\tmore\trequests?\n\nIn\tthis\tcase,\tNGINX\tcomes\twith\ttwo\ttypes\tof\thealth\tchecks:\tpassive\tand active.\n\nPassive\thealth\tcheck\n\nHere,\tNGINX\tis\tconfigured\tas\ta\treverse\tproxy\t(as\twe\tdid\tin\tthe preceding\tsection).\tIt\treacts\tto\ta\tcertain\ttype\tof\tresponse\tfrom\tthe upstream\tservers.\n\nIf\tthere\tis\tan\terror\tcoming\tback,\tNGINX\twill\tmark\tthe\tnode\tas\tfaulty, removing\tit\tfrom\tthe\tload\tbalancing\tfor\ta\tcertain\tperiod\tof\ttime\tbefore reintroducing\tit.\tWith\tthis\tstrategy,\tthe\tnumber\tof\tfailures\twill\tbe drastically\treduced\tas\tNGINX\twill\tbe\tconstantly\tremoving\tthe\tnode\tfrom the\tload\tbalancer.\n\nThere\tare\ta\tfew\tconfigurable\tparameters,\tsuch\tas\tmax_fails\tor fail_timeout,\twhere\twe\tcan\tconfigure\tthe\tamount\tof\tfailures\trequired\tto mark\ta\tnode\tas\tinvalid\tor\tthe\ttime\tout\tfor\trequests.\n\nActive\thealth\tcheck\n\nActive\thealth\tchecks,\tunlike\tpassive\thealth\tchecks,\tactively\tissue connections\tto\tthe\tupstream\tservers\tto\tcheck\twhether\tthey\tare responding\tcorrectly\tto\tthe\texperiencing\tproblems.\n\nThe\tmost\tsimplistic\tconfiguration\tfor\tactive\thealth\tchecks\tin\tNGINX\tis\tthe following\tone:\n\nhttp\t{ \t\tupstream\tapp\t{ \t\t\t\tzone\tapp\ttest; \t\t\t\tserver\t10.0.0.1:3000; \t\t\t\tserver\t10.0.0.2:3000; \t\t} \t\tserver\t{ \t\t\t\tlisten\t80; \t\t\t\tlocation\t\t{ \t\t\t\t\t\tproxy_pass\thttp:/app; \t\t\t\t\t\thealth_check; \t\t\t\t} \t\t} }\n\nThere\tare\ttwo\tnew\tlines\tin\tthis\tconfig\tfile,\tas\tfollows:\n\nhealth_check:\tThis\tenables\tthe\tactive\thealth\tcheck.\tThe\tdefault configuration\tis\tto\tissue\ta\tconnection\tevery\tfive\tseconds\tto\tthe\thost and\tport\tspecified\tin\tthe\tupstream\tsection. zone\tapp\ttest:\tThis\tis\trequired\tby\tthe\tNGINX\tconfiguration\twhen enabling\tthe\thealth\tcheck.\n\nThere\tis\ta\twide\trange\tof\toptions\tto\tconfigure\tmore\tspecific\thealth checks,\tand\tall\tof\tthem\tare\tavailable\tin\tNGINX\tconfiguration\tthat\tcan\tbe combined\tto\tsatisfy\tthe\tneeds\tof\tdifferent\tusers.\n\nSummary\n\nIn\tthis\tchapter,\tyou\tlearned\ta\twide\trange\tof\ttechnologies\tthat\twe\tcan\tuse to\tdeploy\tmicroservices.\tBy\tnow\tyou\tknow\thow\tto\tbuild,\tdeploy,\tand configure\tsoftware\tcomponents\tin\tsuch\ta\tway\tthat\twe\tare\table\tto homogenize\ta\tvery\tdiverse\trange\tof\ttechnologies.\tThe\tobjective\tof\tthis book\tis\tto\tprovide\tyou\tthe\tconcepts\trequired\tto\tstart\tworking\twith microservices\tand\tenable\tthe\treader\tto\tknow\thow\tto\tlook\tfor\tthe\tneeded information.\n\nPersonally,\tI\thave\tstruggled\tto\tfind\ta\tbook\tthat\tprovides\ta\tsummary\tof\tall the\taspects\tof\tthe\tlife\tcycle\tof\tmicroservices\tand\tI\treally\thope\tthat\tthis book\tcovers\tthis\tempty\tspace.\n\nIndex\n\nA\n\nACID\n\natomicity\t/\tDecentralization consistency\t/\tDecentralization isolation\t/\tDecentralization durability\t/\tDecentralization\n\nactive\thealth\tcheck\n\nabout\t/\tActive\thealth\tcheck\n\nactive\tmonitoring\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nADD\tcommand\n\nabout\t/\tAutomating\tDocker\tcontainer\tcreation\n\nAPI\taggregation\n\nabout\t/\tAPI\taggregation\n\napplication\texceptions\n\nmonitoring,\tKeymetrics\tused\t/\tMonitoring\tapplication\texceptions\n\napplication\tmetrics\n\nabout\t/\tMonitoring\tservices\n\napplication\tsecurity\n\nabout\t/\tApplication\tsecurity\n\nB\n\nasymmetric\tcryptography\t/\tSSH\t–\tencrypting\tthe\tcommunications Asynchronous\tJavaScript\tand\tXML\t(AJAX)\n\nabout\t/\tThe\tfuture\tof\tNode.js\n\nauditing\n\nabout\t/\tAuditing\n\nautomated\ttesting\n\nabout\t/\tThe\tpyramid\tof\tautomated\ttesting unit\ttests\t/\tUnit\ttests integration\ttests\t/\tIntegration\ttests end-to-end\ttests\t/\tEnd-to-end\ttests need\tfor\t/\tHow\tmuch\ttesting\tis\ttoo\tmuch?\n\naverage\tcalculated\tvalues\tmetric\n\nabout\t/\tAverage\tcalculated\tvalues\n\nbehavior-driven\tdevelopment\t(BDD)\t/\tEnd-to-end\ttests behavior-driven\tdevelopment\ttesting\t(BDDT)\t/\tMocha black\tlisting\n\nabout\t/\tInput\tvalidation\n\nbluebird\t/\tSingle-threaded\tapplications\tand\texceptions Bluebird\n\nURL\t/\tThe\tcode,\tSeneca\tand\tpromises\n\nboot2docker\n\nabout\t/\tDeploying\tNode.js\tapplications\n\nbounded\tcontext\n\nC\n\nabout\t/\tReplaceability\n\nBusiness\tProcess\tExecution\tLanguage\t(BPEL)\n\nabout\t/\tSmart\tservices,\tdumb\tcommunication\tpipes\n\nbusiness\tunits\n\nabout\t/\tBusiness\tunits,\tno\tcomponents\n\ncallback\t/\tOur\tfirst\tprogram\t–\tHello\tWorld calling\tservices\n\nNew\tBusiness\t/\tHow\tto\ttackle\torganic\tgrowth? Renewals\t/\tHow\tto\ttackle\torganic\tgrowth?\n\nChai\t/\tTesting\tmicroservices\tin\tNode.js,\tChai\n\nBDD-style\tinterfaces\t/\tBDD-style\tinterfaces assertions\tinterface\t/\tAssertions\tinterface\n\nChaos\tGorilla\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nChaos\tMonkey\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nChef\n\nURL\t/\tInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2\n\ncircuit\tbreakers\n\nURL\t/\tCircuit\tbreakers\n\nCMD\tcommand\n\nabout\t/\tAutomating\tDocker\tcontainer\tcreation\n\ncode\treviews\n\neffective\tways\t/\tEffective\tcode\treviews\n\ncommunications\tservice\n\nabout\t/\tThen\tthe\tmicroservices\tappeared\n\nconfiguration\tmanagement\n\nabout\t/\tDocker\t–\ta\tcontainer\tfor\tsoftware\tdelivery\n\ncontainer\n\nsetting\tup\t/\tSetting\tup\tthe\tcontainer executing\t/\tRunning\tthe\tcontainer creation,\tautomating\t/\tAutomating\tDocker\tcontainer\tcreation\n\ncontinuous\tdelivery\t(CD)\n\nabout\t/\tContinuous\tdelivery\n\ncontinuous\tintegration\t(CI)\n\nabout\t/\tContinuous\tintegration\n\nConway's\tLaw\n\nabout\t/\tHow\tto\ttackle\torganic\tgrowth?\n\ncost\tof\tchange\tcurve\n\nabout\t/\tConcepts\tin\tsoftware\tdeployment\n\ncounter\tmetric\n\nabout\t/\tCounter\n\nCross-site\trequest\tforgery\t(CSRF)\n\nD\n\nabout\t/\tCross-site\trequest\tforgery\n\ncross-site\tscripting\n\nabout\t/\tCross-site\tscripting output\tencoding\t/\tOutput\tencoding\n\nCRUD\t(Create\tRead\tUpdate\tDelete)\n\nabout\t/\tTechnology\theterogeneity\n\ncryptography\talgorithm\t/\tSSH\t–\tencrypting\tthe\tcommunications curl\n\nabout\t/\tDiagnosing\tproblems\n\ncustom\tmetrics\n\nabout\t/\tCustom\tmetrics simple\tmetric\t/\tSimple\tmetric counter\tmetric\t/\tCounter average\tcalculated\tvalues\tmetric\t/\tAverage\tcalculated\tvalues\n\ndata\taccess\tobject\t(DAO)\tpattern\t/\tModular\torganization\tbest practices debugging\n\nabout\t/\tDebugging\n\ndecentralization\n\nabout\t/\tDecentralization\n\ndefinition\tfunction\t/\tWriting\tplugins deliver\tearly\n\nreference\tlink\t/\tFirst,\tthere\twas\tthe\tmonolith about\t/\tFirst,\tthere\twas\tthe\tmonolith\n\nE\n\ndeliver\toften\n\nreference\tlink\t/\tFirst,\tthere\twas\tthe\tmonolith about\t/\tFirst,\tthere\twas\tthe\tmonolith\n\nDocker\n\nabout\t/\tContinuous\tdelivery,\tDocker\t–\ta\tcontainer\tfor\tsoftware delivery container,\tsetting\tup\t/\tSetting\tup\tthe\tcontainer installing\t/\tInstalling\tDocker URL\t/\tInstalling\tDocker image,\tselecting\t/\tChoosing\tthe\timage container,\texecuting\t/\tRunning\tthe\tcontainer Node.js,\tinstalling\t/\tInstalling\tthe\trequired\tsoftware modifications,\tsaving\t/\tSaving\tthe\tchanges Node.js\tapplications,\tdeploying\t/\tDeploying\tNode.js\tapplications container\tcreation,\tautomating\t/\tAutomating\tDocker\tcontainer creation\n\nDocker\tMachine\n\nabout\t/\tDeploying\tNode.js\tapplications\n\nDoctor\tMonkey\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nDocument\tObject\tModel\t(DOM)\t/\tJavascript domain-specific\tlanguage\t(DSL)\t/\tMocha\n\nabout\t/\tAutomating\tDocker\tcontainer\tcreation\n\nemailer\n\nabout\t/\tThe\temailer\t–\ta\tcommon\tproblem e-mails,\tsending\t/\tHow\tto\tsend\te-mails\n\ninterface,\tdefining\t/\tDefining\tthe\tinterface Mandrill,\tsetting\tup\t/\tSetting\tup\tMandrill Mandrill,\tintegrating\tin\tmicroservice\t/\tHands\ton\t–\tintegrating Mandrill\tin\tyour\tmicroservice fallback\tstrategy\t/\tThe\tfallback\tstrategy\n\nECMAScript\t6\n\nabout\t/\tThe\tfuture\tof\tNode.js\n\nemailer\n\nabout\t/\tMicromerce\t–\tthe\tbig\tpicture\n\nend-to-end\ttesting\n\nabout\t/\tEnd-to-end\ttesting\n\nend-to-end\ttests\t/\tEnd-to-end\ttests Enterprise\tService\tBus\t(ESB)\n\nabout\t/\tSOA\tversus\tmicroservices\n\nENV\tcommand\n\nabout\t/\tAutomating\tDocker\tcontainer\tcreation\n\nEuropean\tComputer\tManufacturers\tAssociation\t(ECMA)\n\nabout\t/\tThe\tfuture\tof\tNode.js\n\nevent\tloop,\tNode.js\n\nabout\t/\tNode.js\tevent\tloop\t–\teasy\tto\tlearn\tand\thard\tto\tmaster\n\nexceptions\t/\tSingle-threaded\tapplications\tand\texceptions EXPOSE\tcommand\n\nabout\t/\tAutomating\tDocker\tcontainer\tcreation\n\nExpress\t/\tNeed\tfor\tNode.js,\tWeb\tserver\tintegration\n\nF\n\nH\n\nintegrating\twith\t/\tIntegrating\twith\tExpress\t–\thow\tto\tcreate\ta REST\tAPI\n\nforever\t/\tNeed\tfor\tNode.js,\tSingle-threaded\tapplications\tand exceptions functional\ttesting\n\nabout\t/\tFunctional\ttesting automated\ttesting\t/\tThe\tpyramid\tof\tautomated\ttesting\n\nhardware\tresource\tmetrics\n\nmemory\tmetrics\t/\tMonitoring\tservices CPU\tutilization\t/\tMonitoring\tservices disk\tutilization\t/\tMonitoring\tservices\n\nhealth\tcheck\n\nabout\t/\tHealth\tcheck\ton\tNGINX passive\thealth\tcheck\t/\tPassive\thealth\tcheck active\thealth\tcheck\t/\tActive\thealth\tcheck\n\nHello\tWorld\tprogram\t/\tOur\tfirst\tprogram\t–\tHello\tWorld highly\tcohesive\tbusiness\tunit\n\nabout\t/\tBusiness\tunits,\tno\tcomponents\n\nHTTP\tcodes\n\nabout\t/\tHTTP\tcodes 1xx\t-\tinformational\t/\t1xx\t–\tinformational 2xx\t-\tsuccess\tcodes\t/\t2xx\t–\tsuccess\tcodes 3xx\t-\tredirection\t/\t3xx\t–\tredirection 4xx\t-\tclient\terrors\t/\t4xx\t–\tclient\terrors 5xx\t-\tserver\terrors\t/\t5xx\t–\tserver\terrors\n\nI\n\nJ\n\nin\tmicroservices,\timportance\t/\tWhy\tHTTP\tcodes\tmatter\tin microservices\n\nHyper\tText\tTransfer\tProtocol\t(HTTP)\n\nabout\t/\tSmart\tservices,\tdumb\tcommunication\tpipes\n\nindependence\n\nabout\t/\tIndependence\n\ninfrastructure\tlogical\tsecurity\n\nabout\t/\tInfrastructure\tlogical\tsecurity\n\ninjection\n\nabout\t/\tInjection input\tvalidation\t/\tInput\tvalidation\n\ninput\tvalidation\n\nabout\t/\tInput\tvalidation\n\nintegration\ttests\t/\tIntegration\ttests IP\thashing\n\nabout\t/\tLoad\tbalancing\tour\tapplication\n\nJava\tRemote\tMethod\tInvocation\t(RMI)\n\nabout\t/\tTechnology\talignment\n\nJavaScript\t/\tJavascript JavaScript\tObject\tNotation\t(JSON)\n\nK\n\nL\n\nabout\t/\tProduct\tManager\t–\tthe\ttwo-faced\tcore\n\nJSON\t/\tDocumenting\tAPIs\twith\tSwagger\n\nkey\tbenefits\n\nresilience\t/\tResilience scalability\t/\tScalability technology\theterogeneity\t/\tTechnology\theterogeneity replaceability\t/\tReplaceability independence\t/\tIndependence easy\tto\tdeploy\t/\tEasy\tto\tdeploy\n\nkey\tdesign\tprinciples\n\nabout\t/\tKey\tdesign\tprinciples business\tunits\t/\tBusiness\tunits,\tno\tcomponents smart\tservices\t/\tSmart\tservices,\tdumb\tcommunication\tpipes decentralization\t/\tDecentralization technology\talignment\t/\tTechnology\talignment small\tsize\t/\tHow\tsmall\tis\ttoo\tsmall?\n\nKeymetrics\n\nused,\tfor\tmonitoring\tservices\t/\tMonitoring\tusing\tPM2\tand Keymetrics about\t/\tMonitoring\tusing\tPM2\tand\tKeymetrics URL\t/\tMonitoring\tusing\tPM2\tand\tKeymetrics used,\tfor\tdiagnosing\tproblems\t/\tDiagnosing\tproblems used,\tfor\tmonitoring\tapplication\texceptions\t/\tMonitoring application\texceptions custom\tmetrics\t/\tCustom\tmetrics\n\nlatency\n\nM\n\nabout\t/\tThroughput\tand\tperformance\tdegradation\n\nLatency\tMonkey\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nleast\tconnected\tnode\n\nabout\t/\tLoad\tbalancing\tour\tapplication\n\nlibuv\tlibrary\n\nabout\t/\tNode.js\tevent\tloop\t–\teasy\tto\tlearn\tand\thard\tto\tmaster\n\nload\tbalancing\n\nof\tNode.js\tapplications\t/\tLoad\tbalancing\tour\tapplication\n\nlogging\n\nabout\t/\tLogging\n\nlogging,\tlevels\t/\tAuditing\n\nDEBUG\t/\tAuditing INFO\t/\tAuditing WAR\t/\tAuditing FATAL\t/\tAuditing\n\nloosely\tcoupled\tbusiness\tunit\n\nabout\t/\tBusiness\tunits,\tno\tcomponents\n\n10-18\tMonkey\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nMandrill\n\nsetting\tup\t/\tSetting\tup\tMandrill URL\t/\tSetting\tup\tMandrill,\tHands\ton\t–\tintegrating\tMandrill\tin your\tmicroservice integrating,\tin\tmicroservice\t/\tHands\ton\t–\tintegrating\tMandrill\tin your\tmicroservice\n\nmanual\ttesting\n\nabout\t/\tManual\ttesting\t–\tthe\tnecessary\tevil proxy,\tbuilding\tto\tdebug\tmicroservices\t/\tBuilding\ta\tproxy\tto debug\tour\tmicroservices Postman\t/\tPostman\n\nmemory\tleak\n\nabout\t/\tDiagnosing\tproblems\n\nmicromerce\n\nabout\t/\tMicromerce\t–\tthe\tbig\tpicture deploying,\tPM2\tused\t/\tDeploying\tmicroservices\twith\tPM2\n\nmicroservice\n\ntesting\t/\tTesting\ta\treal\tmicroservice\n\nmicroservices\n\nneed\tfor\t/\tNeed\tfor\tmicroservices in\treal\tworld\t/\tMicroservices\tin\tthe\treal\tworld versus\tService-Oriented\tArchitectures\t(SOA)\t/\tSOA\tversus microservices evolution\t/\tThen\tthe\tmicroservices\tappeared disadvantages\t/\tDisadvantages monolith,\tsplitting\t/\tSplitting\tthe\tmonolith testing,\tin\tNode.js\t/\tTesting\tmicroservices\tin\tNode.js documenting\t/\tDocumenting\tmicroservices APIs,\tdocumenting\twith\tSwagger\t/\tDocumenting\tAPIs\twith Swagger project,\tgenerating\tfrom\tSwagger\tdefinition\t/\tGenerating\ta\n\nN\n\nproject\tfrom\tthe\tSwagger\tdefinition\n\nmicroservices-oriented\tarchitectures\n\nabout\t/\tMicroservice-oriented\tarchitectures benefits\t/\tHow\tis\tit\tbetter? shortcomings\t/\tShortcomings\n\nMocha\t/\tTesting\tmicroservices\tin\tNode.js\n\nabout\t/\tMocha\n\nmongo-store\n\nURL\t/\tWiring\teverything\tup\n\nMongoDB\n\nURL\t/\tProduct\tManager\t–\tthe\ttwo-faced\tcore\n\nmonolith\n\nabout\t/\tFirst,\tthere\twas\tthe\tmonolith organic\tgrowth,\ttackling\t/\tHow\tto\ttackle\torganic\tgrowth? abstraction\tcapacity\t/\tHow\tabstract\tis\ttoo\tabstract? splitting\t/\tSplitting\tthe\tmonolith problems,\tin\tsplitting\t/\tProblems\tsplitting\tthe\tmonolith\t–\tit\tis\tall about\tthe\tdata\n\nmonolithic\tsoftware\n\nabout\t/\tMonolithic\tsoftware\n\nmonolithic\tsoftware\tarchitecture\n\nabout\t/\tMonolithic\tsoftware\n\nNetflix\n\nabout\t/\tMicroservices\tin\tthe\treal\tworld\n\nnetwork\tlatency\n\nabout\t/\tShortcomings\n\nNGINX\n\nabout\t/\tLoad\tbalancing\tour\tapplication using\t/\tLoad\tbalancing\tour\tapplication URL\t/\tLoad\tbalancing\tour\tapplication health\tcheck\t/\tHealth\tcheck\ton\tNGINX\n\nNode.js\n\nneed\tfor\t/\tWhy\tNode.js?,\tNeed\tfor\tNode.js API\taggregation\t/\tAPI\taggregation future\t/\tThe\tfuture\tof\tNode.js installing\t/\tInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2,\tInstalling the\trequired\tsoftware URL\t/\tInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2 threading\tmodel\t/\tNode.js\tthreading\tmodel modular\torganization\tbest\tpractices\t/\tModular\torganization\tbest practices JavaScript\t/\tJavascript SOLID\t/\tSOLID\tdesign\tprinciples microservices,\ttesting\t/\tTesting\tmicroservices\tin\tNode.js Chai\t/\tChai BDD-style\tinterfaces\t/\tBDD-style\tinterfaces assertions\tinterface\t/\tAssertions\tinterface Mocha\t/\tMocha Sinon\t/\tSinon.JS\t–\ta\tmocking\tframework real\tmicroservice,\ttesting\t/\tTesting\ta\treal\tmicroservice Test-driven\tdevelopment\t(TDD)\t/\tTDD\t–\tTest-driven development event\tloop\t/\tNode.js\tevent\tloop\t–\teasy\tto\tlearn\tand\thard\tto master\n\nNode.js\tapplications\n\nO\n\ndeploying\t/\tDeploying\tNode.js\tapplications clustering\t/\tClustering\tNode.js\tapplications load\tbalancing\t/\tLoad\tbalancing\tour\tapplication\n\nnodemon\t/\tNeed\tfor\tNode.js,\tSingle-threaded\tapplications\tand exceptions Node\tPackage\tManager\t(npm)\t/\tInstalling\tNode.js,\tnpm,\tSeneca, and\tPM2 non-persistent\tXSS\tattacks\t/\tCross-site\tscripting npm\n\nabout\t/\tWhy\tNode.js? installing\t/\tInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2 learning\t/\tLearning\tnpm\n\nNServiceBus\n\nURL\t/\tSeneca\t–\ta\tsimple\tpuzzle\tthat\tmakes\tour\tlives\teasier\n\nObject-relational\tmapping\t(ORM)\t/\tData\tstorage open\tredirects\n\nabout\t/\tOpen\tredirects\n\nOpen\tWeb\tApplication\tSecurity\t(OWASP)\t/\tCommon\tthreats\t–\thow to\tbe\tup\tto\tdate order\tmanager\n\nabout\t/\tMicromerce\t–\tthe\tbig\tpicture,\tThe\torder\tmanager microservice,\tdefining\t/\tDefining\tthe\tmicroservice\t–\thow\tto gather\tnon-local\tdata code\t/\tThe\torder\tmanager\t–\tthe\tcode remote\tservices,\tcalling\t/\tCalling\tremote\tservices resilience,\tover\tperfection\t/\tResilience\tover\tperfection\n\norganic\tgrowth\n\nP\n\nabout\t/\tNeed\tfor\tmicroservices,\tFirst,\tthere\twas\tthe\tmonolith tackling\t/\tHow\tto\ttackle\torganic\tgrowth?\n\norganizational\talignment\n\nabout\t/\tOrganizational\talignment\n\npassive\thealth\tcheck\n\nabout\t/\tPassive\thealth\tcheck\n\nPatrun\n\nabout\t/\tInversion\tof\tcontrol\tdone\tright,\tPatrun\t–\ta\tpattern- matching\tlibrary Pclosest\tmatch\t/\tPatrun\t–\ta\tpattern-matching\tlibrary patterns,\treusing\t/\tReusing\tpatterns\n\npersistent\tXSS\tattacks\t/\tCross-site\tscripting PM2\n\ninstalling\t/\tInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2 about\t/\tPM2\t–\ta\ttask\trunner\tfor\tNode.js,\tMonitoring\tusing\tPM2 and\tKeymetrics single-threaded\tapplications\tand\texceptions\t/\tSingle-threaded applications\tand\texceptions using\t/\tUsing\tPM2\t–\tthe\tindustry-standard\ttask\trunner used,\tfor\tmonitoring\tservices\t/\tMonitoring\tusing\tPM2\tand Keymetrics used,\tfor\tsoftware\tdeployment\t/\tDeployments\twith\tPM2 ecosystems\t/\tPM2\t–\tecosystems used,\tfor\tdeploying\tmicromerce\t/\tDeploying\tmicroservices\twith PM2 server,\tconfiguring\t/\tConfiguring\tthe\tserver\n\npmx\n\nQ\n\nR\n\nabout\t/\tMonitoring\tapplication\texceptions\n\npolymorphism\tof\tactions\t/\tHands\ton\t–\tintegrating\tMandrill\tin\tyour microservice Postman\t/\tPostman PRG\tpattern\n\nURL\t/\tNeed\tfor\tfrontend\tmicroservice\n\nprobes\n\nabout\t/\tCustom\tmetrics\n\nProduct\tManager\n\nabout\t/\tMicromerce\t–\tthe\tbig\tpicture,\tProduct\tManager\t–\tthe two-faced\tcore products,\tfetching\t/\tFetching\tproducts fetching,\tby\tcategory\t/\tFetching\tby\tcategory fetching,\tby\tID\t/\tFetching\tby\tID product,\tadding\t/\tAdding\ta\tproduct product,\tremoving\t/\tRemoving\ta\tproduct product,\tediting\t/\tEditing\ta\tproduct wiring\t/\tWiring\teverything\tup REST\tAPI,\tcreating\t/\tIntegrating\twith\tExpress\t–\thow\tto\tcreate\ta REST\tAPI Express,\tintegrating\twith\t/\tIntegrating\twith\tExpress\t–\thow\tto create\ta\tREST\tAPI\n\npyramid\tof\ttesting\t/\tHow\tmuch\ttesting\tis\ttoo\tmuch?\n\nqueueing\n\nabout\t/\tThroughput\tand\tperformance\tdegradation\n\nS\n\nRabbitMQ\n\nURL\t/\tSeneca\t–\ta\tsimple\tpuzzle\tthat\tmakes\tour\tlives\teasier about\t/\tThroughput\tand\tperformance\tdegradation\n\nRabbitMQ\ttransport\tplugin\n\nURL\t/\tThroughput\tand\tperformance\tdegradation\n\nRegistry\n\nabout\t/\tChoosing\tthe\timage URL\t/\tChoosing\tthe\timage\n\nreplaceability\n\nabout\t/\tReplaceability importance\t/\tWhy\tis\treplaceability\timportant?\n\nresilience\n\nabout\t/\tResilience\n\nrestify\t/\tNeed\tfor\tNode.js Round\tRobin\n\nabout\t/\tLoad\tbalancing\tour\tapplication\n\nRSA\t/\tSSH\t–\tencrypting\tthe\tcommunications run\tcommand,\tparameters\n\nt\tflag\t/\tDeploying\tNode.js\tapplications -i\tflag\t/\tDeploying\tNode.js\tapplications -v\tflag\t/\tDeploying\tNode.js\tapplications -p\tflag\t/\tDeploying\tNode.js\tapplications /bin/bash\tcommand\t/\tDeploying\tNode.js\tapplications\n\nscalability\n\nabout\t/\tScalability\n\nSecure\tShell\t(SSH)\n\nabout\t/\tSSH\t–\tencrypting\tthe\tcommunications\n\nsecurity\n\ninfrastructure\tlogical\tsecurity\t/\tInfrastructure\tlogical\tsecurity\n\nSeneca\n\nabout\t/\tAPI\taggregation,\tSeneca\t–\ta\tmicroservices\tframework, How\tabstract\tis\ttoo\tabstract?,\tSeneca\t–\ta\tsimple\tpuzzle\tthat makes\tour\tlives\teasier installing\t/\tInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2 Inversion\tof\tcontrol\t/\tInversion\tof\tcontrol\tdone\tright pattern\tmatching\t/\tPattern\tmatching\tin\tSeneca plugins,\twriting\t/\tWriting\tplugins web\tserver\tintegration\t/\tWeb\tserver\tintegration as\tExpress\tmiddleware\t/\tSeneca\tas\tExpress\tmiddleware data\tstorage\t/\tData\tstorage and\tpromises\t/\tSeneca\tand\tpromises\n\nseneca-web\t/\tSeneca\tas\tExpress\tmiddleware Service-Oriented\tArchitectures\t(SOA)\n\nabout\t/\tSOA\tversus\tmicroservices versus\tmicroservices\t/\tSOA\tversus\tmicroservices\n\nservices\n\nmonitoring\t/\tMonitoring\tservices monitoring,\tPM2\tused\t/\tMonitoring\tusing\tPM2\tand\tKeymetrics monitoring,\tKeymetrics\tused\t/\tMonitoring\tusing\tPM2\tand Keymetrics\n\nSimian\tArmy\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nURL\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify throughput\t/\tThroughput\tand\tperformance\tdegradation performance\tdegradation\t/\tThroughput\tand\tperformance degradation\n\nsimple\tmetric\n\nabout\t/\tSimple\tmetric\n\nSingle-Page\tApplication\t(SPA)\n\nabout\t/\tWhy\tNode.js?\n\n/\tMicromerce\t–\tthe\tbig\tpicture single-threaded\tapplications\t/\tSingle-threaded\tapplications\tand exceptions Single\tEuro\tPayments\tArea\t(SEPA)\n\nabout\t/\tHow\tsmall\tis\ttoo\tsmall?\n\nsingle\tpoint\tof\tfailure\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nSinon\t/\tSinon.JS\t–\ta\tmocking\tframework Sinon.JS\t/\tTesting\tmicroservices\tin\tNode.js Slack\n\nabout\t/\tMonitoring\tapplication\texceptions\n\nsmall\tsize\tmicroservices\n\nabout\t/\tHow\tsmall\tis\ttoo\tsmall?\n\nsmart\tservices\n\nabout\t/\tSmart\tservices,\tdumb\tcommunication\tpipes\n\nSOAP\n\nabout\t/\tWhy\tis\treplaceability\timportant?\n\nSoftware\tas\ta\tservice\t(SaaS)\n\nabout\t/\tMonitoring\tusing\tPM2\tand\tKeymetrics\n\nsoftware\tdeployment\n\nconcepts\t/\tConcepts\tin\tsoftware\tdeployment continuous\tintegration\t(CI)\t/\tContinuous\tintegration continuous\tdelivery\t(CD)\t/\tContinuous\tdelivery with\tPM2\t/\tDeployments\twith\tPM2\n\nSoftware\tDevelopment\tLife\tCycle\t(SDLC)\n\nabout\t/\tConcepts\tin\tsoftware\tdeployment\n\nSOLID\n\nabout\t/\tSOLID\tdesign\tprinciples principles\t/\tSOLID\tdesign\tprinciples\n\nSOLID\tdesign\tprinciples\n\nsingle-responsibility\tprinciple\t/\tThen\tthe\tmicroservices\tappeared open\tfor\textension,\tclosed\tfor\tmodification\t/\tThen\tthe microservices\tappeared Liskov\tsubstitution\t/\tThen\tthe\tmicroservices\tappeared interface\tsegregation\t/\tThen\tthe\tmicroservices\tappeared dependency\tinjection\t/\tThen\tthe\tmicroservices\tappeared\n\nSpotify\n\nabout\t/\tMicroservices\tin\tthe\treal\tworld,\tSimian\tArmy\t–\tthe\tactive monitoring\tfrom\tSpotify\n\nSTARS\n\nabout\t/\tChoosing\tthe\timage\n\nStubs\t/\tSinon.JS\t–\ta\tmocking\tframework Swagger\n\nT\n\nU\n\nAPIs,\tdocumenting\twith\t/\tDocumenting\tAPIs\twith\tSwagger\n\ntechnical\tdebt\n\nabout\t/\tWhy\tis\treplaceability\timportant?\n\ntechnology\talignment\n\nabout\t/\tTechnology\talignment\n\ntechnology\theterogeneity\n\nabout\t/\tTechnology\talignment,\tTechnology\theterogeneity\n\nTest-driven\tdevelopment\t(TDD)\t/\tFunctional\ttesting\n\nabout\t/\tTDD\t–\tTest-driven\tdevelopment\n\nThreadLocal\n\nabout\t/\tNode.js\tevent\tloop\t–\teasy\tto\tlearn\tand\thard\tto\tmaster\n\ntraceability\n\nabout\t/\tTraceability logging\t/\tLogging tracing\trequests\t/\tTracing\trequests auditing\t/\tAuditing HTTP\tcodes\t/\tHTTP\tcodes\n\ntracing\trequests\n\nabout\t/\tTracing\trequests\n\nUI\t-\tAPI\taggregation\n\nV\n\nW\n\nX\n\nabout\t/\tMicromerce\t–\tthe\tbig\tpicture,\tThe\tUI\t–\tAPI\taggregation frontend\tmicroservice,\tneed\tfor\t/\tNeed\tfor\tfrontend\tmicroservice code\t/\tThe\tcode service\tdegradation\t/\tService\tdegradation\t–\twhen\tthe\tfailure\tis not\ta\tdisaster circuit\tbreakers\t/\tCircuit\tbreakers Seneca\tpuzzle\t/\tSeneca\t–\ta\tsimple\tpuzzle\tthat\tmakes\tour\tlives easier Seneca,\tand\tpromises\t/\tSeneca\tand\tpromises\n\nunit\ttesting\n\nabout\t/\tUnit\ttesting\n\nunit\ttests\t/\tUnit\ttests\n\nVagrant\n\nURL\t/\tSSH\t–\tencrypting\tthe\tcommunications\n\nwhite\tbox\ttesting\t/\tUnit\ttests white\tlist\n\nabout\t/\tInput\tvalidation\n\nWORKDIR\tcommand\n\nabout\t/\tAutomating\tDocker\tcontainer\tcreation\n\nworkers\n\nabout\t/\tNode.js\tevent\tloop\t–\teasy\tto\tlearn\tand\thard\tto\tmaster\n\nY\n\nXSS\tattacks\n\npersistent\t/\tCross-site\tscripting non-persistent\t/\tCross-site\tscripting\n\nYet\tAnother\tMarkup\tLanguage\t(YAML)\t/\tDocumenting\tAPIs\twith Swagger",
      "page_number": 282
    }
  ],
  "pages": [
    {
      "page_number": 2,
      "content": "Table\tof\tContents\n\nDeveloping\tMicroservices\twith\tNode.js Credits About\tthe\tAuthor About\tthe\tReviewer www.PacktPub.com\n\neBooks,\tdiscount\toffers,\tand\tmore\n\nWhy\tsubscribe?\n\nPreface\n\nWhat\tthis\tbook\tcovers What\tyou\tneed\tfor\tthis\tbook Who\tthis\tbook\tis\tfor Conventions Reader\tfeedback Customer\tsupport\n\nDownloading\tthe\texample\tcode Errata Piracy Questions\n\n1.\tMicroservices\tArchitecture Need\tfor\tmicroservices Monolithic\tsoftware Microservices\tin\tthe\treal\tworld Microservice-oriented\tarchitectures How\tis\tit\tbetter? Shortcomings Key\tdesign\tprinciples\n\nBusiness\tunits,\tno\tcomponents Smart\tservices,\tdumb\tcommunication\tpipes Decentralization Technology\talignment How\tsmall\tis\ttoo\tsmall?\n\nKey\tbenefits Resilience Scalability Technology\theterogeneity",
      "content_length": 739,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 3,
      "content": "Replaceability Independence\n\nWhy\tis\treplaceability\timportant? Easy\tto\tdeploy SOA\tversus\tmicroservices Why\tNode.js?\n\nAPI\taggregation The\tfuture\tof\tNode.js\n\nSummary\n\n2.\tMicroservices\tin\tNode.js\t–\tSeneca\tand\tPM2\tAlternatives Need\tfor\tNode.js\n\nInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2\n\nLearning\tnpm\n\nOur\tfirst\tprogram\t–\tHello\tWorld Node.js\tthreading\tmodel Modular\torganization\tbest\tpractices\n\nJavascript SOLID\tdesign\tprinciples Seneca\t–\ta\tmicroservices\tframework Inversion\tof\tcontrol\tdone\tright Pattern\tmatching\tin\tSeneca\n\nPatrun\t–\ta\tpattern-matching\tlibrary Reusing\tpatterns Writing\tplugins Web\tserver\tintegration\n\nSeneca\tas\tExpress\tmiddleware Data\tstorage\n\nPM2\t–\ta\ttask\trunner\tfor\tNode.js\n\nSingle-threaded\tapplications\tand\texceptions Using\tPM2\t–\tthe\tindustry-standard\ttask\trunner\n\nSummary\n\n3.\tFrom\tthe\tMonolith\tto\tMicroservices First,\tthere\twas\tthe\tmonolith\n\nHow\tto\ttackle\torganic\tgrowth? How\tabstract\tis\ttoo\tabstract? Then\tthe\tmicroservices\tappeared\n\nDisadvantages Splitting\tthe\tmonolith Problems\tsplitting\tthe\tmonolith\t–\tit\tis\tall\tabout\tthe\tdata",
      "content_length": 1045,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 4,
      "content": "Organizational\talignment Summary\n\n4.\tWriting\tYour\tFirst\tMicroservice\tin\tNode.js Micromerce\t–\tthe\tbig\tpicture Product\tManager\t–\tthe\ttwo-faced\tcore\n\nFetching\tproducts Fetching\tby\tcategory Fetching\tby\tID Adding\ta\tproduct Removing\ta\tproduct Editing\ta\tproduct Wiring\teverything\tup Integrating\twith\tExpress\t–\thow\tto\tcreate\ta\tREST\tAPI\n\nThe\te-mailer\t–\ta\tcommon\tproblem\n\nHow\tto\tsend\te-mails Defining\tthe\tinterface Setting\tup\tMandrill Hands\ton\t–\tintegrating\tMandrill\tin\tyour\tmicroservice The\tfallback\tstrategy\n\nThe\torder\tmanager\n\nDefining\tthe\tmicroservice\t–\thow\tto\tgather\tnon-local\tdata The\torder\tmanager\t–\tthe\tcode Calling\tremote\tservices Resilience\tover\tperfection\n\nThe\tUI\t–\tAPI\taggregation\n\nNeed\tfor\tfrontend\tmicroservice The\tcode Service\tdegradation\t–\twhen\tthe\tfailure\tis\tnot\ta\tdisaster Circuit\tbreakers Seneca\t–\ta\tsimple\tpuzzle\tthat\tmakes\tour\tlives\teasier Seneca\tand\tpromises\n\nDebugging Summary\n\n5.\tSecurity\tand\tTraceability Infrastructure\tlogical\tsecurity\n\nSSH\t–\tencrypting\tthe\tcommunications\n\nApplication\tsecurity\n\nCommon\tthreats\t–\thow\tto\tbe\tup\tto\tdate\n\nInjection",
      "content_length": 1060,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 5,
      "content": "Input\tvalidation Cross-site\tscripting Output\tencoding\n\nCross-site\trequest\tforgery Open\tredirects\n\nEffective\tcode\treviews\n\nTraceability Logging Tracing\trequests Auditing HTTP\tcodes\n\n1xx\t–\tinformational 2xx\t–\tsuccess\tcodes 3xx\t–\tredirection 4xx\t–\tclient\terrors 5xx\t–\tserver\terrors Why\tHTTP\tcodes\tmatter\tin\tmicroservices\n\nSummary\n\n6.\tTesting\tand\tDocumenting\tNode.js\tMicroservices Functional\ttesting\n\nThe\tpyramid\tof\tautomated\ttesting\n\nUnit\ttests Integration\ttests End-to-end\ttests How\tmuch\ttesting\tis\ttoo\tmuch?\n\nTesting\tmicroservices\tin\tNode.js\n\nChai\n\nBDD-style\tinterfaces Assertions\tinterface\n\nMocha Sinon.JS\t–\ta\tmocking\tframework Testing\ta\treal\tmicroservice\n\nTDD\t–\tTest-driven\tdevelopment Unit\ttesting End-to-end\ttesting\n\nManual\ttesting\t–\tthe\tnecessary\tevil\n\nBuilding\ta\tproxy\tto\tdebug\tour\tmicroservices Postman\n\nDocumenting\tmicroservices",
      "content_length": 835,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 6,
      "content": "Documenting\tAPIs\twith\tSwagger Generating\ta\tproject\tfrom\tthe\tSwagger\tdefinition\n\nSummary\n\n7.\tMonitoring\tMicroservices Monitoring\tservices\n\nMonitoring\tusing\tPM2\tand\tKeymetrics\n\nDiagnosing\tproblems Monitoring\tapplication\texceptions Custom\tmetrics Simple\tmetric Counter Average\tcalculated\tvalues\n\nSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify Throughput\tand\tperformance\tdegradation\n\nSummary\n\n8.\tDeploying\tMicroservices\n\nConcepts\tin\tsoftware\tdeployment\n\nContinuous\tintegration Continuous\tdelivery Deployments\twith\tPM2 PM2\t–\tecosystems Deploying\tmicroservices\twith\tPM2\n\nConfiguring\tthe\tserver\n\nDocker\t–\ta\tcontainer\tfor\tsoftware\tdelivery\n\nSetting\tup\tthe\tcontainer Installing\tDocker Choosing\tthe\timage Running\tthe\tcontainer Installing\tthe\trequired\tsoftware Saving\tthe\tchanges\n\nDeploying\tNode.js\tapplications Automating\tDocker\tcontainer\tcreation\n\nNode.js\tevent\tloop\t–\teasy\tto\tlearn\tand\thard\tto\tmaster Clustering\tNode.js\tapplications Load\tbalancing\tour\tapplication Health\tcheck\ton\tNGINX Passive\thealth\tcheck Active\thealth\tcheck\n\nSummary",
      "content_length": 1029,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 7,
      "content": "Index",
      "content_length": 5,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 8,
      "content": "Developing\tMicroservices\twith Node.js",
      "content_length": 37,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 9,
      "content": "Developing\tMicroservices\twith Node.js\n\nCopyright\t©\t2016\tPackt\tPublishing\tAll\trights\treserved.\tNo\tpart\tof\tthis book\tmay\tbe\treproduced,\tstored\tin\ta\tretrieval\tsystem,\tor\ttransmitted\tin any\tform\tor\tby\tany\tmeans,\twithout\tthe\tprior\twritten\tpermission\tof\tthe publisher,\texcept\tin\tthe\tcase\tof\tbrief\tquotations\tembedded\tin\tcritical articles\tor\treviews.\n\nEvery\teffort\thas\tbeen\tmade\tin\tthe\tpreparation\tof\tthis\tbook\tto\tensure\tthe accuracy\tof\tthe\tinformation\tpresented.\tHowever,\tthe\tinformation contained\tin\tthis\tbook\tis\tsold\twithout\twarranty,\teither\texpress\tor\timplied. Neither\tthe\tauthor,\tnor\tPackt\tPublishing,\tand\tits\tdealers\tand\tdistributors will\tbe\theld\tliable\tfor\tany\tdamages\tcaused\tor\talleged\tto\tbe\tcaused directly\tor\tindirectly\tby\tthis\tbook.\n\nPackt\tPublishing\thas\tendeavored\tto\tprovide\ttrademark\tinformation\tabout all\tof\tthe\tcompanies\tand\tproducts\tmentioned\tin\tthis\tbook\tby\tthe appropriate\tuse\tof\tcapitals.\tHowever,\tPackt\tPublishing\tcannot\tguarantee the\taccuracy\tof\tthis\tinformation.\n\nFirst\tpublished:\tApril\t2016\n\nProduction\treference:\t1220416\n\nPublished\tby\tPackt\tPublishing\tLtd.\n\nLivery\tPlace\n\n35\tLivery\tStreet\n\nBirmingham\tB3\t2PB,\tUK.\n\nISBN\t978-1-78588-740-6\n\nwww.packtpub.com",
      "content_length": 1172,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 10,
      "content": "Credits\n\nAuthor\n\nDavid\tGonzalez\n\nReviewer\n\nKishore\tKumar\tYekkanti\n\nCommissioning\tEditor\n\nVeena\tPagare\n\nAcquisition\tEditor\n\nDivya\tPoojari\n\nContent\tDevelopment\tEditor\n\nAbhishek\tJadhav\n\nTechnical\tEditor\n\nPranil\tPathare\n\nCopy\tEditor\n\nVibha\tShukla\n\nProject\tCoordinator\n\nJudie\tJose\n\nProofreader\n\nSafis\tEditing\n\nIndexer",
      "content_length": 312,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 11,
      "content": "Monica\tAjmera\tMehta\n\nProduction\tCoordinator\n\nArvindkumar\tGupta\n\nCover\tWork\n\nArvindkumar\tGupta",
      "content_length": 93,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 12,
      "content": "About\tthe\tAuthor\n\nDavid\tGonzalez\tis\ta\tlanguage-agnostic\tsoftware\tengineer\tworking\tin financial\tservices\tfor\ta\tnumber\tof\tyears,\ttrying\tto\tfind\tsolutions\tfor\tthe right\tlevel\tof\tabstraction\tand\tlearning\thow\tto\tget\tthe\tright\tbalance between\ttoo\tconcrete\tand\ttoo\tabstract.\n\nHe\tstudied\tin\tSpain,\tbut\tsoon\tmoved\tto\tthe\twider\tand\tmore\tinteresting market\tof\tDublin,\twhere\the\thas\tbeen\tliving\tsince\t2011.\tDavid\tis\tcurrently working\tas\tan\tindependent\tconsultant\tin\tthe\tFinTech\tsector.\tThe\tURL\tto his\tLinkedin\taccount\tis\thttps://ie.linkedin.com/in/david-gonzalez- 737b7383.\n\nHe\tloves\texperimenting\twith\tnew\ttechnologies\tand\tparadigms\tin\torder\tto get\tthe\tbroader\tpicture\tof\tthe\tcomplex\tworld\tof\tsoftware\tdevelopment.\n\nTo\tmy\twife,\tEster,\tthanks\tfor\tyour\tunconditional\tsupport\tin\tevery single\taspect\tof\tmy\tlife.\n\nTo\tmy\tunborn\tdaughter,\tElena,\tmay\tthe\tlife\tgive\tyou\tall\tthe\thappiness that\tyou\tare\tbringing\tto\tyour\tparents.",
      "content_length": 905,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 13,
      "content": "About\tthe\tReviewer\n\nKishore\tKumar\tYekkanti\tis\tan\texperienced\tprofessional\twho\thas worked\tacross\tvarious\tdomains\tand\ttechnologies\tover\tthe\tpast\tten years.\tHe\tis\tpassionate\tabout\teliminating\tthe\twaste\tduring\tthe\tsoftware development.\tKishore\tis\ta\thuge\tcontributor\tto\tand\tfollower\tof\tagile principles.\tHe\tis\ta\tfull-stack\tdeveloper\twho\twants\tto\tbuild\tthe\tend-to-end systems,\tand\ta\tpolyglot\tprogrammer.\tHis\tcurrent\tfocus\tis\ton\tscaling microservices\tin\thighly\tdistributed\tapplications\tthat\tare\tdeployed\tusing container-based\tsystems\t(Docker)\ton\tcloud.\tHe\thas\tworked\tas\tthe lead/principal\tengineer\tfor\tmany\twell-known\tcompanies\tsuch\tas Thoughtworks,\tCurrencyFair,\tand\tothers,\twhere\the\tlead\tthe\tteams\tto attain\tnirvana\tthrough\tmicroservices.\n\nFor\tmy\tpartner\tand\tbest\tfriend\tJyothsna,\tand\tmy\tdaughter,\tDhruti, who\tcontinues\tto\thumour\tme\tdespite\tof\tmy\tcrazy\tschedules.",
      "content_length": 858,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 14,
      "content": "www.PacktPub.com\n\neBooks,\tdiscount\toffers,\tand\tmore\n\nDid\tyou\tknow\tthat\tPackt\toffers\teBook\tversions\tof\tevery\tbook\tpublished, with\tPDF\tand\tePub\tfiles\tavailable?\tYou\tcan\tupgrade\tto\tthe\teBook version\tat\twww.PacktPub.com\tand\tas\ta\tprint\tbook\tcustomer,\tyou\tare entitled\tto\ta\tdiscount\ton\tthe\teBook\tcopy.\tGet\tin\ttouch\twith\tus\tat <customercare@packtpub.com>\tfor\tmore\tdetails.\n\nAt\twww.PacktPub.com,\tyou\tcan\talso\tread\ta\tcollection\tof\tfree\ttechnical articles,\tsign\tup\tfor\ta\trange\tof\tfree\tnewsletters\tand\treceive\texclusive discounts\tand\toffers\ton\tPackt\tbooks\tand\teBooks.\n\nhttps://www2.packtpub.com/books/subscription/packtlib\n\nDo\tyou\tneed\tinstant\tsolutions\tto\tyour\tIT\tquestions?\tPacktLib\tis\tPackt's online\tdigital\tbook\tlibrary.\tHere,\tyou\tcan\tsearch,\taccess,\tand\tread Packt's\tentire\tlibrary\tof\tbooks.\n\nWhy\tsubscribe?\n\nFully\tsearchable\tacross\tevery\tbook\tpublished\tby\tPackt Copy\tand\tpaste,\tprint,\tand\tbookmark\tcontent On\tdemand\tand\taccessible\tvia\ta\tweb\tbrowser",
      "content_length": 943,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 15,
      "content": "Preface\n\nThis\tbook\tis\ta\thands-on\tguide\tto\tstart\twriting\tmicroservices\tusing Node.js\tand\tthe\tmost\tmodern\tframeworks,\tespecially\tSeneca\tand\tPM2. In\tthe\tchapters,\twe\twill\tdiscuss\thow\tto\tdesign,\tbuild,\ttest,\tand\tdeploy microservices\tusing\tthe\tbest\tpractices.\tWe\twill\talso\tdiscuss\ta\tvaluable lesson:\thow\tto\tmake\tthe\tright\tlevel\tof\tcompromise\tin\torder\tto\tavoid\tover- designing\tand\tget\tthe\tbusiness\trequirements\taligned\twith\tthe\ttechnical solutions.",
      "content_length": 442,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 16,
      "content": "What\tthis\tbook\tcovers\n\nChapter\t1,\tMicroservices\tArchitecture,\tdiscusses\tthe\tpros\tand\tcons\tof microservices-oriented\tarchitectures.\tIt\twill\tbe\tthe\tfoundation\tfor\tthe\trest of\tthe\tbook.\n\nChapter\t2,\tMicroservices\tin\tNode.js\t–\tSeneca\tand\tPM2\tAlternatives, introduces\tNode.js,\tSeneca,\tand\tPM2.\tIn\tit,\twe\twill\tdiscuss\tthe\tstructure of\ta\tNode.js\tapplication\tand\thow\tto\trun\tit\tusing\tPM2.\tWe\twill\talso\tdive into\ta\tfew\talternatives\tto\tSeneca\tand\tPM2.\n\nChapter\t3,\tFrom\tthe\tMonolith\tto\tMicroservices,\tcovers\thow\tto\ttackle\tthe organic\tgrowth\t(unplanned\tsoftware\tchanges)\tusing\tmicroservices.\tWe will\talso\ttalk\tabout\thow\tto\tsplit\ta\tmonolithic\tapplication\tinto microservices.\n\nChapter\t4,\tWriting\tYour\tFirst\tMicroservice\tin\tNode.js,\texplains\thow\tto write\tour\tfirst\tmicroservice.\n\nChapter\t5,\tSecurity\tand\tTraceability,\tcovers\thow\tsecurity\tand\ttraceability are\ttwo\timportant\tcharacteristics\tof\tmodern\tsystems.\tWe\tneed\tto\tkeep the\tinformation\tsecure\tand\tthe\tactions\ttraceable.\tIn\tthis\tchapter,\twe\twill discuss\thow\tto\tdo\tit\tusing\tSeneca.\n\nChapter\t6,\tTesting\tand\tDocumenting\tNode.js\tMicroservices,\tintroduces using\tthe\tmain\tframeworks\tfor\ttesting\ton\tNode.js:\tMocha\tand\tChai.\tWe will\talso\tmake\tuse\tof\tSinon\t(another\tframework)\tto\tmock\tservices. Swagger\twill\tbe\tour\tchoice\tfor\tdocumenting\tmicroservices.\n\nChapter\t7,\tMonitoring\tMicroservices,\tcovers\tusing\tPM2\tto\tmonitor\tour microservices.\tWe\twill\tuse\tit\talong\twith\tKeymetrics\tto\tget\tthe\tmaximum benefit\tof\tsuch\tan\tadvanced\ttool.\n\nChapter\t8,\tDeploying\tMicroservices,\texplains\thow,\tusing\tPM2,\twe\tare going\tto\tlearn\tto\tdeploy\tmicroservices\tin\tour\tdifferent\tenvironments, managing\tour\tecosystem\tof\tapplications\twith\ta\tsingle\tcommand\tand reducing\tthe\toverhead\tintroduced\tby\tthe\tmicroservices\tarchitecture.\tWe will\talso\tdiscuss\tDocker,\tone\tof\tthe\tmost\tadvanced\tsystems\tto\tdeploy",
      "content_length": 1798,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 17,
      "content": "applications\tnot\tonly\tin\tNode.js,\tbut\talso\tin\tgeneral\tapplications.",
      "content_length": 67,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 18,
      "content": "What\tyou\tneed\tfor\tthis\tbook\n\nIn\torder\tto\tfollow\tthe\tbook,\twe\tare\tgoing\tto\tneed\tto\tinstall\tNode.js,\tPM2 (it\tis\ta\tpackage\tthat\tis\tinstalled\tthrough\tnpm),\tand\tMongoDB.\n\nWe\twill\talso\tneed\tan\teditor.\tPersonally,\tI\tuse\tAtom,\tbut\tany\tgeneral purpose\teditor\tshould\tbe\tenough.",
      "content_length": 267,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 19,
      "content": "Who\tthis\tbook\tis\tfor\n\nThis\tbook\tis\tfor\tdevelopers\tthat\thave\tsome\texperience\twith\tNode.js\tbut want\tto\tlearn\tabout\tSeneca\tand\tmicroservices.\tIt\tis\t70%\tpractice- oriented\t(as\twe\twill\tbe\twriting\ta\tlot\tof\tcode),\tbut\tit\talso\tis\t30%\ttheory, based\ton\tthe\tcode\tcreated\tthat\twill\thelp\tthe\treader\tto\tapply\tthe\texposed patterns\tto\tnew\tsoftware.",
      "content_length": 332,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 20,
      "content": "Conventions\n\nIn\tthis\tbook,\tyou\twill\tfind\ta\tnumber\tof\ttext\tstyles\tthat\tdistinguish\tbetween different\tkinds\tof\tinformation.\tHere\tare\tsome\texamples\tof\tthese\tstyles and\tan\texplanation\tof\ttheir\tmeaning.\n\nCode\twords\tin\ttext,\tdatabase\ttable\tnames,\tfolder\tnames,\tfilenames,\tfile extensions,\tpathnames,\tdummy\tURLs,\tuser\tinput,\tand\tTwitter\thandles are\tshown\tas\tfollows:\t\"We\tknow\tthat\tthe\tinput\tparameter\tis\ta PaymentRequest\tinstance.\"\n\nA\tblock\tof\tcode\tis\tset\tas\tfollows:\n\npublic\tinterface\tPaymentService\t{ \t\tPaymentResponse\tprocessPayment(PaymentRequest\t request)\tthrows\tMyBusinessException; }\n\nWhen\twe\twish\tto\tdraw\tyour\tattention\tto\ta\tparticular\tpart\tof\ta\tcode\tblock, the\trelevant\tlines\tor\titems\tare\tset\tin\tbold:\n\nfunction()\t{ \t\tsinon.stub(Math,\t\"random\"); \t\trollDice(); \t\tconsole.log(Math.random.calledWith()); }); after(function(){ \t\tMath.random.restore(); });\n\nAny\tcommand-line\tinput\tor\toutput\tis\twritten\tas\tfollows:\n\nnode\tindex.js npm\tstart\n\nNew\tterms\tand\timportant\twords\tare\tshown\tin\tbold.\tWords\tthat\tyou\tsee on\tthe\tscreen,\tfor\texample,\tin\tmenus\tor\tdialog\tboxes,\tappear\tin\tthe\ttext like\tthis:\t\"In\tthis\tcase,\tI\thave\tused\tChrome\tand\tthe\tconsole\tshows\tan Uncaught\tTypeError:\tCannot\tset\tproperty\t'innerText'\tof\tnull\terror\tin",
      "content_length": 1216,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 21,
      "content": "line\t7.\"\n\nNote\n\nWarnings\tor\timportant\tnotes\tappear\tin\ta\tbox\tlike\tthis.\n\nTip\n\nTips\tand\ttricks\tappear\tlike\tthis.",
      "content_length": 110,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 22,
      "content": "Reader\tfeedback\n\nFeedback\tfrom\tour\treaders\tis\talways\twelcome.\tLet\tus\tknow\twhat\tyou think\tabout\tthis\tbook—what\tyou\tliked\tor\tdisliked.\tReader\tfeedback\tis important\tfor\tus\tas\tit\thelps\tus\tdevelop\ttitles\tthat\tyou\twill\treally\tget\tthe most\tout\tof.\n\nTo\tsend\tus\tgeneral\tfeedback,\tsimply\te-mail\t<feedback@packtpub.com>, and\tmention\tthe\tbook's\ttitle\tin\tthe\tsubject\tof\tyour\tmessage.\n\nIf\tthere\tis\ta\ttopic\tthat\tyou\thave\texpertise\tin\tand\tyou\tare\tinterested\tin either\twriting\tor\tcontributing\tto\ta\tbook,\tsee\tour\tauthor\tguide\tat www.packtpub.com/authors.",
      "content_length": 536,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 23,
      "content": "Customer\tsupport\n\nNow\tthat\tyou\tare\tthe\tproud\towner\tof\ta\tPackt\tbook,\twe\thave\ta\tnumber\tof things\tto\thelp\tyou\tto\tget\tthe\tmost\tfrom\tyour\tpurchase.\n\nDownloading\tthe\texample\tcode\n\nYou\tcan\tdownload\tthe\texample\tcode\tfiles\tfor\tthis\tbook\tfrom\tyour\taccount at\thttp://www.packtpub.com.\tIf\tyou\tpurchased\tthis\tbook\telsewhere,\tyou can\tvisit\thttp://www.packtpub.com/support\tand\tregister\tto\thave\tthe\tfiles emailed\tdirectly\tto\tyou.\n\nYou\tcan\tdownload\tthe\tcode\tfiles\tby\tfollowing\tthese\tsteps:\n\n1.\t Log\tin\tor\tregister\tto\tour\twebsite\tusing\tyour\te-mail\taddress\tand password.\n\n2.\t Hover\tthe\tmouse\tpointer\ton\tthe\tSUPPORT\ttab\tat\tthe\ttop. 3.\t Click\ton\tCode\tDownloads\t&\tErrata. 4.\t Enter\tthe\tname\tof\tthe\tbook\tin\tthe\tSearch\tbox. 5.\t Select\tthe\tbook\tfor\twhich\tyou're\tlooking\tto\tdownload\tthe\tcode\tfiles. 6.\t Choose\tfrom\tthe\tdrop-down\tmenu\twhere\tyou\tpurchased\tthis\tbook from.\n\n7.\t Click\ton\tCode\tDownload.\n\nYou\tcan\talso\tdownload\tthe\tcode\tfiles\tby\tclicking\ton\tthe\tCode\tFiles button\ton\tthe\tbook's\twebpage\tat\tthe\tPackt\tPublishing\twebsite.\tThis\tpage can\tbe\taccessed\tby\tentering\tthe\tbook's\tname\tin\tthe\tSearch\tbox.\tPlease note\tthat\tyou\tneed\tto\tbe\tlogged\tin\tto\tyour\tPackt\taccount.\n\nOnce\tthe\tfile\tis\tdownloaded,\tplease\tmake\tsure\tthat\tyou\tunzip\tor\textract the\tfolder\tusing\tthe\tlatest\tversion\tof:\n\nWinRAR\t/\t7-Zip\tfor\tWindows Zipeg\t/\tiZip\t/\tUnRarX\tfor\tMac 7-Zip\t/\tPeaZip\tfor\tLinux\n\nErrata",
      "content_length": 1344,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 24,
      "content": "Although\twe\thave\ttaken\tevery\tcare\tto\tensure\tthe\taccuracy\tof\tour content,\tmistakes\tdo\thappen.\tIf\tyou\tfind\ta\tmistake\tin\tone\tof\tour\tbooks— maybe\ta\tmistake\tin\tthe\ttext\tor\tthe\tcode—we\twould\tbe\tgrateful\tif\tyou could\treport\tthis\tto\tus.\tBy\tdoing\tso,\tyou\tcan\tsave\tother\treaders\tfrom frustration\tand\thelp\tus\timprove\tsubsequent\tversions\tof\tthis\tbook.\tIf\tyou find\tany\terrata,\tplease\treport\tthem\tby\tvisiting http://www.packtpub.com/submit-errata,\tselecting\tyour\tbook,\tclicking\ton the\tErrata\tSubmission\tForm\tlink,\tand\tentering\tthe\tdetails\tof\tyour\terrata. Once\tyour\terrata\tare\tverified,\tyour\tsubmission\twill\tbe\taccepted\tand\tthe errata\twill\tbe\tuploaded\tto\tour\twebsite\tor\tadded\tto\tany\tlist\tof\texisting errata\tunder\tthe\tErrata\tsection\tof\tthat\ttitle.\n\nTo\tview\tthe\tpreviously\tsubmitted\terrata,\tgo\tto https://www.packtpub.com/books/content/support\tand\tenter\tthe\tname\tof the\tbook\tin\tthe\tsearch\tfield.\tThe\trequired\tinformation\twill\tappear\tunder the\tErrata\tsection.\n\nPiracy\n\nPiracy\tof\tcopyrighted\tmaterial\ton\tthe\tInternet\tis\tan\tongoing\tproblem across\tall\tmedia.\tAt\tPackt,\twe\ttake\tthe\tprotection\tof\tour\tcopyright\tand licenses\tvery\tseriously.\tIf\tyou\tcome\tacross\tany\tillegal\tcopies\tof\tour\tworks in\tany\tform\ton\tthe\tInternet,\tplease\tprovide\tus\twith\tthe\tlocation\taddress\tor website\tname\timmediately\tso\tthat\twe\tcan\tpursue\ta\tremedy.\n\nPlease\tcontact\tus\tat\t<copyright@packtpub.com>\twith\ta\tlink\tto\tthe suspected\tpirated\tmaterial.\n\nWe\tappreciate\tyour\thelp\tin\tprotecting\tour\tauthors\tand\tour\tability\tto\tbring you\tvaluable\tcontent.\n\nQuestions\n\nIf\tyou\thave\ta\tproblem\twith\tany\taspect\tof\tthis\tbook,\tyou\tcan\tcontact\tus\tat <questions@packtpub.com>,\tand\twe\twill\tdo\tour\tbest\tto\taddress\tthe problem.",
      "content_length": 1652,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 25,
      "content": "Chapter\t1.\tMicroservices Architecture\n\nMicroservices\tare\tbecoming\tmore\tand\tmore\tpopular.\tNowadays,\tpretty much\tevery\tengineer\ton\ta\tgreen\tfield\tproject\tshould\tbe\tconsidering\tusing microservices\tin\torder\tto\timprove\tthe\tquality\tof\tthe\tsystems\tthey\tbuild. They\tshould\tknow\tthe\tarchitectural\tprinciples\tinvolving\tsuch\tsystems.\tWe will\texpose\tthe\tdifference\tbetween\tmicroservices\tand\tService-Oriented Architecture\t(SOA).\tWe\twill\talso\tintroduce\ta\tgreat\tplatform\tto\twrite microservices,\tNode.js,\twhich\twill\tallow\tus\tto\tcreate\thigh-performing microservices\twith\tvery\tlittle\teffort.\n\nIn\tthis\tchapter,\tyou\twill\tlearn\tabout\tmicroservices\tfrom\tthe\tarchitectural point\tof\tview:\n\nWhat\tare\tmicroservices? Microservice-oriented\tarchitectures Key\tbenefits SOA\tversus\tMicroservices Why\tNode.js?\n\nNeed\tfor\tmicroservices\n\nThe\tworld\tof\tsoftware\tdevelopment\thas\tevolved\tquickly\tin\tthe\tpast\t40 years.\tOne\tof\tthe\tkey\tpoints\tof\tthis\tevolution\thas\tbeen\tthe\tsize\tof\tthese systems.\tFrom\tthe\tdays\tof\tMS-DOS,\twe\thave\ttaken\ta\thundred-fold\tleap into\tour\tpresent\tsystems.\tThis\tgrowth\tin\tsize\tcreates\ta\tneed\tfor\tbetter ways\tof\torganizing\tcode\tand\tsoftware\tcomponents.\tUsually,\twhen\ta company\tgrows\tdue\tto\tbusiness\tneeds,\tknown\tas\torganic\tgrowth,\tthe software\tis\torganized\ton\ta\tmonolithic\tarchitecture\tas\tit\tis\tthe\teasiest\tand quickest\tway\tof\tbuilding\tsoftware.\tAfter\tfew\tyears\t(or\teven\tmonths), adding\tnew\tfeatures\tbecomes\tharder\tdue\tto\tthe\tcoupled\tnature\tof\tthe created\tsoftware.\n\nMonolithic\tsoftware",
      "content_length": 1466,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 26,
      "content": "The\tnatural\ttrend\tfor\tnew\thigh-tech\tcompanies\tsuch\tas\tAmazon\tor Netflix\tis\tbuilding\ttheir\tnew\tsoftware\tusing\tmicroservices,\twhich\tis\tthe ideal\tscenario:\tthey\tget\ta\thuge\tadvantage\tof\tmicroservices-oriented software\t(through\tout\tthis\tbook,\tyou\twill\tlearn\thow)\tin\torder\tto\tscale\tup their\tnew\tproducts\twithout\ta\tbig\teffort.\tThe\tproblem\tis\tthat\tnot\tall companies\tcan\tplan\ttheir\tsoftware\tupfront.\tInstead\tof\tplanning,\tthese companies\tbuild\tsoftware\tbased\ton\tthe\torganic\tgrowth\texperienced:\tfew software\tcomponents\tgroup\tbusiness\tflows\tby\taffinity.\tIt\tis\tnot\trare\tto\tsee companies\twith\ttwo\tbig\tsoftware\tcomponents:\tthe\tuser-facing\twebsite and\tthe\tinternal\tadministration\ttools.\tThis\tis\tusually\tknown\tas\ta monolithic\tsoftware\tarchitecture.\n\nSome\tof\tthese\tcompanies\tface\tbig\tproblems\twhen\ttrying\tto\tscale\tthe engineering\tteams.\tIt\tis\thard\tto\tcoordinate\tteams\tthat\tbuild,\tdeploy,\tand maintain\ta\tsingle\tsoftware\tcomponent.\tClashes\ton\treleases\tand reintroduction\tof\tbugs\tare\ta\tcommon\tproblem\tthat\tdrains\ta\tlarge\tchunk\tof energy\tfrom\tthe\tteams.\tOne\tof\tthe\tsolution\tto\tthis\tproblem\t(it\tcomes\twith benefits)\tis\tto\tsplit\tthe\tmonolithic\tsoftware\tinto\tmicroservices\tso\tthat\tthe teams\tare\table\tto\tspecialize\tin\ta\tfew\tsmaller\tmodules\tand\tautonomous and\tisolated\tsoftware\tcomponents\tthat\tcan\tbe\tversioned,\tupdated,\tand deployed\twithout\tinterfering\twith\tthe\trest\tof\tthe\tsystems\tof\tthe\tcompany.\n\nSplitting\tthe\tmonolith\tinto\tmicroservices\tenables\tthe\tengineering\tteam\tto create\tisolated\tand\tautonomous\tunits\tof\twork\tthat\tare\thighly\tspecialized in\ta\tgiven\ttask\tsuch\tas\tsending\te-mails,\tprocessing\tcard\tpayments,\tand so\ton.\n\nMicroservices\tin\tthe\treal\tworld\n\nMicroservices\tare\tsmall\tsoftware\tcomponents\tthat\tare\tspecialized\tin\tone task\tand\twork\ttogether\tto\tachieve\ta\thigher-level\ttask.\tForget\tabout software\tfor\ta\tsecond\tand\tthink\tabout\thow\ta\tcompany\tworks.\tWhen someone\tapplies\tfor\ta\tjob\tin\ta\tcompany,\the\tapplies\tfor\ta\tgiven\tposition: software\tengineer,\tsystem\tadministrator,\toffice\tmanager.\tThe\treason\tfor this\tcan\tbe\tsummarized\tin\tone\tword:\tspecialization.\tIf\tyou\tare\tused\tto work\tas\ta\tsoftware\tengineer,\tyou\twill\tget\tbetter\twith\tthe\texperience\tand add\tmore\tvalue\tto\tthe\tcompany.\tThe\tfact\tthat\tyou\tdon't\tknow\thow\tto\tdeal with\ta\tcustomer,\twon't\taffect\tyour\tperformance\tas\tthat\tis\tnot\tyour\tarea\tof",
      "content_length": 2271,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 27,
      "content": "expertise\tand\twill\thardly\tadd\tany\tvalue\tto\tyour\tday-to-day\twork.\n\nTip\n\nSpecialization\tis\toften\tthe\tkey\tto\timprove\tthe\tefficiency.\tDoing\tone thing\tand\tdoing\tit\tright\tis\tone\tof\tthe\tmantras\tof\tsoftware\tdevelopment.\n\nA\tmicroservice\tis\tan\tautonomous\tunit\tof\twork\tthat\tcan\texecute\tone\ttask without\tinterfering\twith\tother\tparts\tof\tthe\tsystem,\tsimilar\tto\twhat\ta\tjob position\tis\tto\ta\tcompany.\tThis\thas\ta\tnumber\tof\tbenefits\tthat\tcan\tbe\tused in\tfavor\tof\tthe\tengineering\tteam\tin\torder\tto\thelp\tscale\tthe\tsystems\tof\ta company.\n\nNowadays,\thundreds\tof\tsystems\tare\tbuilt\tusing\tmicroservices-oriented architectures,\tas\tfollows:\n\nNetflix:\tThis\tis\tone\tof\tthe\tmost\tpopular\tstreaming\tservices,\tit\thas built\tan\tentire\tecosystem\tof\tapplications\tthat\tcollaborate\tin\torder\tto provide\ta\treliable\tand\tscalable\tstreaming\tsystem\tused\tacross\tthe globe. Spotify:\tThis\tis\tone\tof\tthe\tleading\tmusic\tstreaming\tservices\tin\tthe world,\tit\thas\tbuilt\tthis\tapplication\tusing\tmicroservices.\tEvery\tsingle widget\tof\tthe\tapplication\t(which\tis\ta\twebsite\texposed\tas\ta\tdesktop app\tusing\tChromium\tEmbedded\tFramework)\tis\ta\tdifferent microservice\tthat\tcan\tbe\tupdated\tindividually.\n\nMicroservice-oriented\tarchitectures\n\nMicroservices-oriented\tarchitectures\thave\tsome\tparticularities\tthat makes\tthem\tdesirable\tfor\tany\tmid/large-sized\tcompany\tthat\twants\tto keep\ttheir\tIT\tsystems\tresilient\tand\tin\tscale\tup/down-ready\tstatus.\n\nHow\tis\tit\tbetter?\n\nThey\tare\tnot\tthe\tholy\tgrail\tof\tsoftware\tengineering,\tbut,\twhen\thandled with\tcare,\tthey\tbecome\tthe\tperfect\tapproach\tto\tsolve\tmost\tof\tthe\tbig",
      "content_length": 1528,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 28,
      "content": "problems\tfaced\tby\ttech-dependent\tcompanies.\n\nIt\tis\timportant\tto\tkeep\tthe\tkey\tprinciples\tof\tthe\tmicroservices-oriented architecture's\tdesign\tin\tmind,\tsuch\tas\tresilience,\tcomposability,\telasticity, and\tso\ton;\totherwise,\tyou\tcould\tend\tup\twith\ta\tmonolithic\tapplication\tsplit across\tdifferent\tmachines\tthat\tproduces\tproblems\trather\tthan\tan\telegant solution.\n\nShortcomings\n\nThere\tis\talso\tsome\tcriticism\taround\tmicroservices-oriented\tarchitectures, as\tthey\tintroduce\tsome\tproblems\tto\tdeal\twith,\tsuch\tas\tlatency, traceability,\tand\tconfiguration\tmanagement\tthat\tare\tnot\tpresent\twith monolithic-based\tsoftware.\tSome\tof\tthe\tproblems\tare\tdescribed\tas follows:\n\nNetwork\tlatency:\tMicroservices\thave\ta\tdistributed\tnature\tso\tthat network\tlatency\thas\tto\tbe\taccounted\tfor Operations\toverhead:\tMore\tservers\tindicate\tmore\tmaintenance Eventual\tconsistency:\tOn\thighly\ttransactional\tsystems,\twe\tneed\tto factor\tinto\timplementation\tthe\tfact\tthat\tthe\tdata\tcould\tbe\tinconsistent during\ta\tperiod\tof\ttime\t(we\twill\ttalk\tabout\tit\tlater\tin\tthis\tchapter)\n\nIn\tgeneral,\tengineers\tshould\ttry\tto\tevaluate\tthe\tpros\tand\tcons\tof\tthis approach\tand\tmake\ta\tdecision\ton\twhether\tto\tuse\tmicroservices\tor\tnot\tin order\tto\tfit\tthe\tbusiness\tneeds.\n\nMicroservices-oriented\tarchitectures\thave\tsome\tparticularities\tthat\tneed to\tbe\ttaken\tinto\tconsideration.\tWhen\ta\tsoftware\tengineer\tis\twriting monolithic\tsoftware,\tthere\tare\tsome\tproblems\tthat\tare\tcompletely overlooked\tdue\tto\tthe\tnature\tof\tthe\tsoftware\tbeing\tbuilt.\n\nFor\texample,\timagine\tthat\tour\tsoftware\tneeds\tto\tsend\te-mails.\tIn\ta monolithic\tsoftware,\twe\twould\tjust\tadd\tthe\tfunctionality\tto\tthe\tcore\tof\tthe application.\tWe\tmight\teven\tchoose\tto\tcreate\ta\tdedicated\tmodule\tto\tdeal with\te-mails\t(which\tseems\tlike\ta\tgood\tidea).\tNow,\timagine\tthat\twe\tare creating\ta\tmicroservice\tand,\tinstead\tof\tadding\ta\tfunctionality\tto\ta\tbig software\tartifact,\twe\tcreate\ta\tdedicated\tservice\tthat\tcan\tbe\tdeployed\tand versioned\tindependently.\tIn\tthis\tcase,\twe\twill\thave\tan\textra\tstep\tthat\twe",
      "content_length": 1967,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 29,
      "content": "didn't\thave\tto\ttake\tinto\tconsideration,\tthe\tnetwork\tlatency,\tto\treach\tthe new\tmicroservice.\n\nIn\tthe\tpreceding\texample,\tno\tmatter\twhat\tapproach\t(monolithic\tor microservices)\tyou\tare\ttaking\tto\tbuild\tthe\tsoftware,\tis\tnot\ta\tbig\tdeal;\tfor example,\tif\tan\te-mail\tis\tlost,\tit\tis\tnot\tthe\tend\tof\tthe\tworld.\tAs\tper definition,\tthe\te-mail\tdelivery\tis\tnot\tguaranteed,\tso\tour\tapplication\twill\tstill work,\talthough\twe\tmight\treceive\ta\tfew\tcomplaints\tfrom\tour\tcustomers.",
      "content_length": 453,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 30,
      "content": "Key\tdesign\tprinciples\n\nThere\tare\ta\tfew\tkey\tdesign\tprinciples\tthat\tneed\tto\tbe\ttaken\tinto consideration\twhen\tbuilding\tmicroservices.\tThere\tis\tno\tgolden\trule\tand, as\tmicroservices\tare\ta\trecent\tconcept,\tsometimes\tthere\tis\teven\ta\tlack\tof consensus\ton\twhat\tpractices\tto\tfollow.\tIn\tgeneral,\twe\tcan\tassume\tthe following\tdesign\tprinciples:\n\nMicroservices\tare\tbusiness\tunits\tthat\tmodel\tthe\tcompany\tprocesses. They\tare\tsmart\tendpoints\tthat\tcontain\tthe\tbusiness\tlogic\tand communicate\tusing\tsimple\tchannels\tand\tprotocols. Microservices-oriented\tarchitectures\tare\tdecentralized\tby\tdefinition. This\thelps\tto\tbuild\trobust\tand\tresilient\tsoftware.\n\nBusiness\tunits,\tno\tcomponents\n\nOne\tof\tthe\tmost\tenjoyable\tsides\tof\tsoftware\tengineering\tis\tcreating\ta new\tproject.\tThis\tis\twhere\tyou\tcan\tapply\tall\tyour\tcreativity,\ttry\tnew architectural\tconcepts,\tframeworks,\tor\tmethodologies.\tUnfortunately,\tit\tis not\ta\tcommon\tsituation\tin\ta\tmature\tcompany.\tUsually,\twhat\twe\tdo\tis create\tnew\tcomponents\tinside\tthe\texisting\tsoftware.\tOne\tof\tthe\tbest design\tprinciples\tthat\tyou\tcan\tfollow\twhen\tcreating\tnew\tcomponents\tis keeping\tthe\tcoupling\tas\tlow\tas\tpossible\twith\tthe\trest\tof\tthe\tsoftware,\tso that\tit\tworks\tas\tan\tindependent\tunit.\n\nTip\n\nKeeping\ta\tlow\tlevel\tof\tcoupling\tallows\ta\tsoftware\tcomponent\tto\tbe converted\tinto\ta\tmicroservice\twith\tlittle\tto\tno\teffort.\n\nConsider\ta\treal-world\texample:\tthe\tapplication\tof\tyour\tcompany\tnow needs\tto\tbe\table\tto\tprocess\tpayments.\n\nThe\tlogical\tdecision\there\twould\tbe\tcreating\ta\tnew\tmodule\tthat\tknows how\tto\tdeal\twith\tthe\tchosen\tpayment\tprovider\t(credit\tcards,\tPayPal,\tand",
      "content_length": 1568,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 31,
      "content": "so\ton)\tand\tallows\tus\tto\tkeep\tall\tthe\tpayment-related\tbusiness\tlogic inside\tof\tit.\tLet's\tdefine\tthe\tinterface\tin\tthe\tfollowing\tcode:\n\npublic\tinterface\tPaymentService\t{ \t\tPaymentResponse\tprocessPayment(PaymentRequest\t request)\tthrows\tMyBusinessException; }\n\nThis\tsimple\tinterface\tcan\tbe\tunderstood\tby\teveryone,\tbut\tit\tis\tthe\tkey when\tmoving\ttowards\tmicroservices.\tWe\thave\tencapsulated\tall\tthe business\tknowledge\tbehind\tan\tinterface\tso\tthat\twe\tcould\ttheoretically switch\tthe\tpayment\tprovider\twithout\taffecting\tthe\trest\tof\tthe\tapplication— the\timplementation\tdetails\tare\thidden\tfrom\tthe\touter\tworld.\n\nThe\tfollowing\tis\twhat\twe\tknow\tuntil\tnow:\n\nWe\tknow\tthe\tmethod\tname,\ttherefore,\twe\tknow\thow\tto\tinvoke\tthe service The\tmethod\tcould\tthrow\tan\texception\tof\tthe\tMyBusinessException type,\tforcing\tthe\tcalling\tcode\tto\tdeal\twith\tit We\tknow\tthat\tthe\tinput\tparameter\tis\ta\tPaymentRequest\tinstance The\tresponse\tis\ta\tknown\tobject\n\nWe\thave\tcreated\ta\thighly\tcohesive\tand\tloosely\tcoupled\tbusiness\tunit. Let's\tjustify\tthis\taffirmation\tin\tthe\tfollowing:\n\nHighly\tcohesive:\tAll\tthe\tcode\tinside\tthe\tpayments\tmodule\twill\tdo only\tone\tthing,\tthat\tis,\tdeal\twith\tpayments\tand\tall\tthe\taspects\tof calling\ta\tthird-party\tservice\t(connection\thandling,\tresponse\tcodes, and\tso\ton),\tsuch\tas\ta\tdebit\tcard\tprocessor. Loosely\tcoupled:\tWhat\thappens\tif,\tfor\tsome\treason,\twe\tneed\tto switch\tto\ta\tnew\tpayment\tprocessor?\tIs\tthere\tany\tinformation bleeding\tout\tof\tthe\tinterface?\tWould\twe\tneed\tto\tchange\tthe\tcalling code\tdue\tto\tchanges\tin\tthe\tcontract?\tThe\tanswer\tis\tno.\tThe implementation\tof\tthe\tpayment\tservice\tinterface\twill\talways\tbe\ta modular\tunit\tof\twork.\n\nThe\tfollowing\tdiagram\tshows\thow\ta\tsystem\tcomposed\tof\tmany components\tgets\tone\tof\tthem\t(payment\tservice)\tstripped\tout\tinto\ta microservice:",
      "content_length": 1749,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 32,
      "content": "Once\tthis\tmodule\tis\timplemented,\twe\twill\tbe\table\tto\tprocess\tthe payments\tand\tour\tmonolithic\tapplication\twill\thave\tanother\tfunctionality that\tcould\tbe\ta\tgood\tcandidate\tto\textract\tinto\ta\tmicroservice.\n\nNow,\twe\tcan\trollout\tnew\tversions\tof\tthe\tpayment\tservice,\tas\tlong\tas\tthe interface\tdoes\tnot\tchange,\tas\twell\tas\tthe\tcontract\twith\tthe\trest\tof\tthe world\t(our\tsystem\tor\tthird\tparties),\thasn't\tchanged.\tThat\tis\twhy\tit\tis\tso important\tto\tkeep\tthe\timplementation\tindependent\tfrom\tinterfacing,\teven though\tthe\tlanguage\tdoes\tnot\tprovide\tsupport\tfor\tinterfaces.\n\nWe\tcan\talso\tscale\tup\tand\tdeploy\tas\tmany\tpayment\tservices\tas\twe require\tso\tthat\twe\tcan\tsatisfy\tthe\tbusiness\tneeds\twithout\tunnecessarily scaling\tthe\trest\tof\tthe\tapplication\tthat\tmight\tnot\tbe\tunder\tpressure.",
      "content_length": 756,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 33,
      "content": "Tip\n\nDownloading\tthe\texample\tcode\n\nYou\tcan\tdownload\tthe\texample\tcode\tfiles\tfor\tthis\tbook\tfrom\tyour account\tat\thttp://www.packtpub.com.\tIf\tyou\tpurchased\tthis\tbook elsewhere,\tyou\tcan\tvisit\thttp://www.packtpub.com/support\tand register\tto\thave\tthe\tfiles\te-mailed\tdirectly\tto\tyou.\n\nYou\tcan\tdownload\tthe\tcode\tfiles\tby\tfollowing\tthese\tsteps:\n\nLog\tin\tor\tregister\tto\tour\twebsite\tusing\tyour\te-mail\taddress\tand password. Hover\tthe\tmouse\tpointer\ton\tthe\tSUPPORT\ttab\tat\tthe\ttop. Click\ton\tCode\tDownloads\t&\tErrata. Enter\tthe\tname\tof\tthe\tbook\tin\tthe\tSearch\tbox. Select\tthe\tbook\tfor\twhich\tyou're\tlooking\tto\tdownload\tthe\tcode\tfiles. Choose\tfrom\tthe\tdrop-down\tmenu\twhere\tyou\tpurchased\tthis\tbook from. Click\ton\tCode\tDownload.\n\nYou\tcan\talso\tdownload\tthe\tcode\tfiles\tby\tclicking\ton\tthe\tCode\tFiles button\ton\tthe\tbook's\twebpage\tat\tthe\tPackt\tPublishing\twebsite.\tThis page\tcan\tbe\taccessed\tby\tentering\tthe\tbook's\tname\tin\tthe\tSearch box.\tPlease\tnote\tthat\tyou\tneed\tto\tbe\tlogged\tin\tto\tyour\tPackt\taccount.\n\nOnce\tthe\tfile\tis\tdownloaded,\tplease\tmake\tsure\tthat\tyou\tunzip\tor extract\tthe\tfolder\tusing\tthe\tlatest\tversion\tof:\n\nWinRAR\t/\t7-Zip\tfor\tWindows Zipeg\t/\tiZip\t/\tUnRarX\tfor\tMac 7-Zip\t/\tPeaZip\tfor\tLinux\n\nSmart\tservices,\tdumb\tcommunication pipes",
      "content_length": 1210,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 34,
      "content": "Hyper\tText\tTransfer\tProtocol\t(HTTP)\tis\tone\tof\tthe\tbest\tthings\tto\thave ever\thappened\tto\tthe\tInternet.\tImagine\ta\tprotocol\tthat\twas\tdesigned\tto be\tstate-less,\tbut\twas\thacked\tthrough\tthe\tuse\tof\tcookies\tin\torder\tto\thold the\tstatus\tof\tthe\tclient.\tThis\twas\tduring\tthe\tage\tof\tWeb\t1.0,\twhen\tno\tone was\ttalking\tabout\tREST\tAPIs\tor\tmobile\tapps.\tLet's\tsee\tan\texample\tof\tan HTTP\trequest:\n\nAs\tyou\tcan\tsee,\tit\tis\ta\thuman\treadable\tprotocol\tthat\tdoes\tnot\tneed\tto\tbe explained\tin\torder\tto\tbe\tunderstood.\n\nNowadays,\tit\tis\tbroadly\tunderstood\tthat\tHTTP\tis\tnot\tconfined\tto\tbe\tused in\tthe\tWeb,\tand\tas\tit\twas\tdesigned,\tit\tis\tnow\tused\tas\ta\tgeneral\tpurpose protocol\tto\ttransfer\tdata\tfrom\tone\tendpoint\tto\tanother.\tHTTP\tis\tall\tyou need\tfor\tthe\tcommunication\tbetween\tmicroservices:\ta\tprotocol\tto\ttransfer data\tand\trecover\tfrom\ttransmission\terrors\t(when\tpossible).\n\nIn\tthe\tpast\tfew\tyears,\tespecially\twithin\tthe\tenterprise\tworld,\tthere\thas been\tan\teffort\tto\tcreate\tsmart\tcommunication\tmechanisms\tsuch\tas BPEL.\tBPEL\tstands\tfor\tBusiness\tProcess\tExecution\tLanguage,\tand instead\tof\tfocusing\ton\tcommunication\tactions,\tit\tfocuses\ton\tactions around\tbusiness\tsteps.\n\nThis\tintroduces\tsome\tlevel\tof\tcomplexity\tin\tthe\tcommunication\tprotocol and\tmakes\tthe\tbusiness\tlogic\tof\tthe\tapplication\tbleed\tinto\tit\tfrom\tthe endpoints,\tcausing\tsome\tlevel\tof\tcoupling\tbetween\tthe\tendpoints.\n\nThe\tbusiness\tlogic\tshould\tstay\twithin\tthe\tendpoints\tand\tnot\tbleed\tinto the\tcommunication\tchannel\tso\tthat\tthe\tsystem\tcan\tbe\teasily\ttested\tand",
      "content_length": 1475,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 35,
      "content": "scaled.\tThe\tlesson\tlearned\tthrough\tthe\tyears\tis\tthat\tthe\tcommunication layer\tmust\tbe\ta\tplain\tand\tsimple\tprotocol\tthat\tensures\tthe\ttransmission of\tthe\tdata\tand\tthe\tendpoints\t(microservices).These\tendpoints\tshould embed\tinto\ttheir\timplementation\tthe\tfact\tthat\ta\tservice\tcould\tbe\tdown\tfor a\tperiod\tof\ttime\t(this\tis\tcalled\tresilience,\twe\twill\ttalk\tabout\tthis\tlater\tin\tthis chapter)\tor\tthe\tnetwork\tcould\tcause\tcommunication\tissues.\n\nHTTP\tusually\tis\tthe\tmost\tused\tprotocol\twhen\tbuilding\tmicroservices- oriented\tsoftware\tbut\tanother\tinteresting\toption\tthat\tneeds\tto\tbe\texplored is\tthe\tuse\tof\tqueues,\tsuch\tas\tRabbit\tMQ\tand\tKafka,\tto\tfacilitate\tthe communication\tbetween\tendpoints.\n\nThe\tqueueing\ttechnology\tprovides\ta\tclean\tapproach\tto\tmanage\tthe communication\tin\ta\tbuffered\tway,\tencapsulating\tthe\tcomplexities\tof acknowledging\tmessages\ton\thighly\ttransactional\tsystems.\n\nDecentralization\n\nOne\tof\tthe\tmajor\tcons\tof\tmonolithic\tapplications\tis\tthe\tcentralization\tof everything\ton\ta\tsingle\t(or\tfew)\tsoftware\tcomponents\tand\tdatabases. This,\tmore\toften\tthan\tnot,\tleads\tto\thuge\tdata\tstores\tthat\tneeds\tto\tbe replicated\tand\tscaled\taccording\tto\tthe\tneeds\tof\tthe\tcompany\tand centralized\tgovernance\tof\tthe\tflows.\n\nMicroservices\taim\tfor\tdecentralization.\tInstead\tof\thaving\ta\thuge database,\twhy\tnot\tsplit\tthe\tdata\taccording\tto\tthe\tbusiness\tunits explained\tearlier?\n\nSome\tof\tthe\treaders\tcould\tuse\tthe\ttransactionality\tas\tone\tof\tthe\tmain reasons\tfor\tnot\tdoing\tit.\tConsider\tthe\tfollowing\tscenario:\n\n1.\t A\tcustomer\tbuys\tan\titem\tin\tour\tmicroservices-oriented\tonline\tshop. 2.\t When\tpaying\tfor\tthe\titem,\tthe\tsystem\tissues\tthe\tfollowing\tcalls:\n\n1.\t A\tcall\tto\tthe\tfinancial\tsystem\tof\tthe\tcompany\tto\tcreate\ta transaction\twith\tthe\tpayment.\n\n2.\t A\tcall\tto\tthe\twarehouse\tsystem\tto\tdispatch\tthe\tbook. 3.\t A\tcall\tto\tthe\tmailing\tsystem\tto\tsubscribe\tthe\tcustomer\tto\tthe newsletter.",
      "content_length": 1841,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 36,
      "content": "In\ta\tmonolithic\tsoftware,\tall\tthe\tcalls\twould\tbe\twrapped\tin\ta\ttransaction, so\tif,\tfor\tsome\treason,\tany\tof\tthe\tcalls\tfails,\tthe\tdata\ton\tthe\tother\tcalls won't\tbe\tpersisted\tin\tthe\tdatabase.\n\nWhen\tyou\tlearn\tabout\tdesigning\tdatabases,\tone\tof\tthe\tfirst\tand\tthe\tmost important\tprinciples\tare\tsummarized\tby\tthe\tACID\tacronym:\n\nAtomicity:\tEach\ttransaction\twill\tbe\tall\tor\tnothing.\tIf\tone\tpart\tfails,\tno changes\tare\tpersisted\ton\tthe\tdatabase. Consistency:\tChanges\tto\tthe\tdata\tthrough\ttransactions\tneed\tto guarantee\tits\tconsistency. Isolation:\tThe\tresult\tof\tconcurrent\texecution\tof\ttransactions\tresults in\ta\tsystem\tstate\tthat\twould\tbe\tobtained\tif\tthe\ttransactions\twere executed\tserially. Durability:\tOnce\tthe\ttransaction\tis\tcommitted,\tthe\tdata\tpersists.\n\nOn\ta\tmicroservices-oriented\tsoftware,\tthe\tACID\tprinciple\tis\tnot guaranteed\tglobally.\tMicroservices\twill\tcommit\tthe\ttransaction\tlocally,\tbut there\tare\tno\tmechanisms\tthat\tcan\tguarantee\ta\t100%\tintegrity\tof\tthe global\ttransaction.\tIt\twould\tbe\tpossible\tto\tdispatch\tthe\tbook\twithout processing\tthe\tpayment,\tunless\twe\tfactor\tin\tspecific\trules\tto\tprevent\tit.\n\nOn\ta\tmicroservices-oriented\tarchitecture,\tthe\ttransactionality\tof\tthe\tdata is\tnot\tguaranteed,\tso\twe\tneed\tto\tfactor\tthe\tfailure\tinto\tthe implementation.\tA\tway\tto\tsolve\t(although,\tworkaround\tis\ta\tmore appropriate\tword)\tthis\tproblem\tis\tdecentralizing\tthe\tgovernance\tand\tdata storage.\n\nWhen\tbuilding\tmicroservices,\twe\tneed\tto\tembed\tin\tthe\tdesign,\tthe\tfact that\tone\tor\tmore\tcomponents\tcould\tfail\tand\tdegrade\tthe\tfunctionality according\tto\tthe\tavailability\tof\tthe\tsoftware.\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\tdiagram:",
      "content_length": 1606,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 37,
      "content": "This\tdiagram\trepresents\tthe\tsequence\tof\texecution\ton\ta\tmonolithic software.\tA\tsequential\tlist\tof\tcalls\tthat,\tno\tmatter\twhat,\tare\tgoing\tto\tbe executed\tfollowing\tthe\tACID\tprinciple:\teither\tall\tthe\tcalls\t(transactions) succeed\tor\tnone\tof\tthem\tdo.\n\nThis\tis\tonly\tpossible\tas\tthe\tframework\tand\tdatabase\tengine\tdesigners have\tdeveloped\tthe\tconcept\tof\ttransactions\tto\tguarantee\tthe transactionality\tof\tthe\tdata.\n\nWhen\tworking\twith\tmicroservices,\twe\tneed\tto\taccount\tfor\twhat\tthe engineers\tcall\teventual\tconsistency.\tAfter\ta\tpartial\tfail\ton\ta\ttransaction, each\tmicroservice\tinstance\tshould\tstore\tthe\tinformation\trequired\tto recover\tthe\ttransaction\tso\tthat\tthe\tinformation\twill\tbe\teventually consistent.\tFollowing\tthe\tprevious\texample,\tif\twe\tsend\tthe\tbook\twithout processing\tthe\tpayment,\tthe\tpayment\tgateway\twill\thave\ta\tfailed transaction\tthat\tsomeone\twill\tprocess\tlater\ton,\tmaking\tthe\tdata consistent\tagain.\n\nThe\tbest\tway\tto\tsolve\tthis\tproblem\tis\tdecentralizing\tthe\tgovernance. Every\tendpoint\tshould\tbe\table\tto\ttake\ta\tlocal\tdecision\tthat\taffects\tthe global\tscope\tof\tthe\ttransaction.\tWe\twill\ttalk\tmore\tabout\tthis\tsubject\tin",
      "content_length": 1112,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 38,
      "content": "Chapter\t3,\tFrom\tthe\tMonolith\tto\tMicroservices.\n\nTechnology\talignment\n\nWhen\tbuilding\ta\tnew\tsoftware,\tthere\tis\talways\ta\tconcept\tthat\tevery developer\tshould\tkeep\tin\tmind:\tstandards.\n\nStandards\tguarantee\tthat\tyour\tservice\twill\tbe\ttechnologically independent\tso\tthat\tit\twill\tbe\teasy\tto\tbuild\tthe\tintegrations\tusing\ta different\tprogramming\tlanguage\tor\ttechnologies.\n\nOne\tof\tthe\tadvantages\tof\tmodeling\ta\tsystem\twith\tmicroservices\tis\tthat we\tcan\tchoose\tthe\tright\ttechnology\tfor\tthe\tright\tjob\tso\tthat\twe\tcan\tbe quite\tefficient\twhen\ttackling\tproblems.\tWhen\tbuilding\tmonolithic software,\tit\tis\tfairly\thard\tto\tcombine\ttechnologies\tlike\twe\tcan\tdo\twith microservices.\tUsually,\tin\ta\tmonolithic\tsoftware,\twe\tare\ttied\tto\tthe technology\tthat\twe\tchoose\tin\tthe\tbeginning.\n\nJava\tRemote\tMethod\tInvocation\t(RMI)\tis\tone\texample\tof\tthe\tnon- standard\tprotocols\tthat\tshould\tbe\tavoided\tif\tyou\twant\tyour\tsystem\tto\tbe open\tto\tnew\ttechnologies.\tIt\tis\ta\tgreat\tway\tof\tconnecting\tsoftware components\twritten\tin\tJava,\tbut\tthe\tdevelopers\twill\tstruggle\t(if\tnot\tfail)\tto invoke\tan\tRMI\tmethod\tusing\tNode.js.\tThis\twill\ttie\tour\tarchitecture\tto\ta given\tlanguage,\twhich\tfrom\tthe\tmicroservices\tpoint\tof\tview,\twill\tkill\tone\tof the\tmost\tinteresting\tadvantages:\ttechnology\theterogeneity.\n\nHow\tsmall\tis\ttoo\tsmall?\n\nOnce\twe\thave\tdecided\tto\tmodel\tour\tsystem\tas\ta\tset\tof\tmicroservices, there\tis\talways\tone\tquestion\tthat\tneeds\tan\tanswer:\thow\tsmall\tis\ttoo small?\n\nThe\tanswer\tis\talways\ttricky\tand\tprobably\tdisappointing:\tit\tdepends.\n\nThe\tright\tsize\tof\tthe\tmicroservices\tin\ta\tgiven\tsystem\tdepends\ton\tthe structure\tof\tthe\tcompany\tas\twell\tas\tthe\tability\tto\tcreate\tsoftware components\tthat\tare\teasily\tmanageable\tby\ta\tsmall\tteam\tof\tdevelopers.\tIt also\tdepends\ton\tthe\ttechnical\tneeds.",
      "content_length": 1724,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 39,
      "content": "Imagine\ta\tsystem\tthat\treceives\tand\tprocesses\tbanking\tfiles;\tas\tyou\tare probably\taware,\tall\tthe\tpayments\tbetween\tbanks\tare\tsent\tin\tfiles\twith\ta specific\tknown\tformat\t(such\tas\tSingle\tEuro\tPayments\tArea\t(SEPA)\tfor Euro\tpayments).\tOne\tof\tthe\tparticularities\tof\tthis\ttype\tof\tsystems\tis\tthe large\tnumber\tof\tdifferent\tfiles\tthat\tthe\tsystem\tneeds\tto\tknow\thow\tto process.\n\nThe\tfirst\tapproach\tfor\tthis\tproblem\tis\ttackling\tit\tfrom\tthe\tmicroservices point\tof\tview,\tseparating\tit\tfrom\tany\tother\tservice\tcreating\ta\tunit\tof\twork, and\tcreating\tone\tmicroservice\tfor\teach\ttype\tof\tfile.\tIt\twill\tenable\tus\tto\tbe able\tto\trollout\tmodifications\tfor\tthe\texisting\tfile\tprocessors\twithout interfering\twith\tthe\trest\tof\tthe\tsystem.\tIt\twill\talso\tenable\tus\tto\tkeep processing\tfiles\teven\tthough\tone\tof\tthe\tservices\tis\texperiencing problems.\n\nThe\tmicroservices\tshould\tbe\tas\tsmall\tas\tneeded,\tbut\tkeep\tin\tmind\tthat every\tmicroservice\tadds\tan\toverhead\tto\tthe\toperations\tteam\tthat\tneeds to\tmanage\ta\tnew\tservice.\tTry\tto\tanswer\tthe\tquestion\thow\tsmall\tis\ttoo small?\tin\tterms\tof\tmanageability,\tscalability,\tand\tspecialization.\tThe microservice\tshould\tbe\tsmall\tenough\tto\tbe\tmanaged\tand\tscaled\tup\t(or down)\tquickly\twithout\taffecting\tthe\trest\tof\tthe\tsystem,\tby\ta\tsingle\tperson; and\tit\tshould\tdo\tonly\tone\tthing.\n\nTip\n\nAs\ta\tgeneral\trule,\ta\tmicroservice\tshould\tbe\tsmall\tenough\tto\tbe completely\trewritten\tin\ta\tsprint.",
      "content_length": 1370,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 40,
      "content": "Key\tbenefits\n\nIn\tthe\tprevious\ttopic,\twe\ttalked\tabout\twhat\ta\tmicroservices-oriented architecture\tis.\tI\talso\texposed\tthe\tdesign\tprinciples\tthat\tI\thave\tlearned from\texperience,\tas\twell\tas\tshowed\ta\tfew\tbenefits\tof\tthis\ttype\tof architecture.\n\nNow,\tit\tis\ttime\tto\toutline\tthese\tkey\tbenefits\tand\tshow\thow\tthey\twill\thelp us\tto\timprove\tthe\tquality\tof\tour\tsoftware,\tas\twell\tas\tbe\table\tto\tquickly accommodate\tthe\tnew\tbusiness\trequirements.\n\nResilience\n\nResilience\tis\tdefined\tin\tWikipedia\tas\tthe\tability\tof\ta\tsystem\tto\tcope\twith change.\tI\tlike\tto\tthink\tabout\tresilience\tas\tthe\tability\tof\ta\tsystem\tto gracefully\trecover\tfrom\tan\texception\t(transitory\thardware\tfailure, unexpectedly\thigh\tnetwork\tlatency,\tand\tso\ton)\tor\ta\tstress\tperiod\twithout affecting\tthe\tperformance\tof\tthe\tsystem\tonce\tthe\tsituation\thas\tbeen resolved.\n\nAlthough\tit\tsounds\tsimple,\twhen\tbuilding\tmicroservices-oriented software,\tthe\tsource\tof\tproblems\tbroadens\tdue\tto\tthe\tdistributed\tnature of\tthe\tsystem,\tsometimes\tmaking\tit\thard\t(or\teven\timpossible)\tto\tprevent all\tabnormal\tsituations.\n\nResilience\tis\tthe\tability\tto\tgracefully\trecover\tfrom\terrors.\tIt\talso\tadds another\tlevel\tof\tcomplexity:\tif\tone\tmicroservice\tis\texperiencing\tproblems, can\twe\tprevent\ta\tgeneral\tfailure?\tIdeally,\twe\tshould\tbuild\tour\tsystem\tin\ta way\tthat\tthe\tservice\tresponse\tis\tdegraded\tinstead\tof\tresulting\tin\ta general\tfailure,\talthough\tthis\tis\tnot\talways\teasy.\n\nScalability\n\nNowadays,\tone\tof\tthe\tcommon\tproblems\tin\tcompanies\tis\tthe\tscalability of\tthe\tsystems.\tIf\tyou\thave\tworked\ton\ta\tmonolithic\tsoftware\tbefore,\tI\tam sure\tthat\tyou\thave\texperienced\tcapacity\tproblems\tat\tsome\tpoint, alongside\tthe\tgrowth\tof\tthe\tcompany.",
      "content_length": 1639,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 41,
      "content": "Usually,\tthese\tproblems\tare\tnot\tacross\tall\tthe\tlayers\tor\tsubsystems\tof the\tapplication.\tThere\tis\talways\ta\tsubsystem\tor\tservice\tthat\tperforms significantly\tslower\tthan\tthe\trest,\tcausing\tthe\tentire\tapplication\tto\tfail\tif\tit is\tnot\table\tto\tcope\twith\tthe\tdemand.\n\nThe\tfollowing\tdiagram\tdescribes\thow\ta\tmicroservice\tcan\tbe\tscaled\tup (two\tmailing\tservices)\twithout\tinterfering\twith\tthe\trest\tof\tthe\tsystem:",
      "content_length": 399,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 42,
      "content": "Tip\n\nAn\texample\tof\tthese\tweak\tpoints\tin\tthe\tworld\tof\tcar\tinsurance\tis\tthe service\tthat\tcalculates\tthe\tquote\tfor\ta\tgiven\tlist\tof\trisk\tfactors.\tWould it\tmake\tsense\tto\tscale\tthe\tfull\tapplication\tjust\tto\tsatisfy\tthe\tdemand",
      "content_length": 218,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 43,
      "content": "for\tthis\tparticular\tpart?\tIf\tthe\tanswer\tthat\tyou\thave\tin\tmind\tis\tno,\tyou are\tone\tstep\tcloser\tto\tembracing\tmicroservices.\tMicroservices\tenable you\tto\tscale\tparts\tof\tthe\tsystem\tas\tthe\tdemand\tramps\tup\tfor\ta particular\tarea\tof\tit.\n\nIf\tour\tinsurance\tsystem\twas\ta\tmicroservice-oriented\tsoftware,\tthe\tonly thing\tneeded\tto\tresolve\tthe\thigh\tdemand\tfor\tquote\tcalculations\twould've been\tto\tspawn\tmore\tinstances\tof\tthe\tmicroservice\t(or\tmicroservices) responsible\tfor\ttheir\tcalculation.\tPlease\tbear\tin\tmind\tthat\tscaling\tup services\tcould\tadd\tan\toverhead\tfor\toperating\tthem.\n\nTechnology\theterogeneity\n\nThe\tworld\tof\tsoftware\tis\tchanging\tevery\tfew\tmonths.\tNew\tlanguages\tare coming\tto\tthe\tindustry\tas\ta\tde\tfacto\tstandard\tfor\ta\tcertain\ttype\tof systems.\tA\tfew\tyears\tago,\tRuby\ton\tRails\tappeared\tat\tthe\tscene\tand\trose as\tone\tof\tthe\tmost\tused\tweb\tframeworks\tfor\tnew\tprojects\tin\t2013. Golang\t(a\tlanguage\tcreated\tby\tGoogle)\tis\tbecoming\ta\ttrend\tnowadays as\tit\tcombines\thuge\tperformance\twith\tan\telegant\tand\tsimple\tsyntax\tthat can\tbe\tlearned\tby\tanyone\twith\tsome\texperience\tin\tanother\tprogramming language\tin\ta\tmatter\tof\tdays.\n\nIn\tthe\tpast,\tI\thave\tused\tPython\tand\tJava\tas\tsuccessful\talternatives\tto write\tmicroservices.\n\nJava\tespecially,\tsince\tSpring\tBoot\twas\treleased,\tis\tan\tattractive technology\tstack\tto\twrite\tagile\t(to\twrite\tand\toperate)\tmicroservices.\n\nDjango,\tis\talso\ta\tpowerful\tframework\ton\tPython\tto\twrite\tmicroservices. Being\tvery\tsimilar\tto\tRuby\ton\tRails,\tit\tautomates\tdatabase\tmigrations and\tmakes\tthe\tcreation\tof\tCRUD\t(Create\tRead\tUpdate\tDelete)\tservices an\tincredibly\teasy\ttask.\n\nNode.js\ttook\tthe\tadvantage\tof\ta\twell-known\tlanguage,\tJavaScript,\tto create\ta\tnew\tserver-side\tstack\tthat\tis\tchanging\tthe\tway\tengineers\tcreate new\tsoftware.\n\nSo,\twhat\tis\twrong\tin\tcombining\tall\tof\tthem?\tIn\tall\tfairness,\tit\tis\tan",
      "content_length": 1790,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 44,
      "content": "advantage:\twe\tcan\tchoose\tthe\tright\ttool\tfor\tthe\tright\tjob.\n\nMicroservices-oriented\tarchitectures\tenable\tyou\tto\tdo\tit,\tas\tlong\tas\tthe integration\ttechnologies\tare\tstandard.\tAs\tyou\tlearned\tbefore,\ta microservice\tis\ta\tsmall\tand\tindependent\tpiece\tof\tsoftware\tthat\tcan operate\tby\titself.\n\nThe\tfollowing\tdiagram\tshows\thow\tthe\tmicroservices\thide\tdata storage/gathering,\thaving\tonly\tthe\tcommunication\tpoints\tin\tcommon— making\tthem\ta\tgood\texample\tof\tlow\tcoupling\t(one\tservice implementation\tchange\twon't\tinterfere\twith\tany\tother\tservice):",
      "content_length": 529,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 45,
      "content": "We\thave\ttalked\tabout\tperformance\tearlier.\tThere\tare\talways\tparts\tof\tour systems\tthat\tare\tunder\tmore\tpressure\tthan\tothers.\tWith\tmodern multicore\tCPUs,\tparallel\t(concurrent)\tprogramming\tcould\tsolve\tsome\tof these\tperformance\tissues,\thowever,\tNode.js\tis\tnot\ta\tgood\tlanguage\tto parallelize\ttasks.\tWe\tcould\tchoose\tto\trewrite\tthe\tmicroservice\tunder pressure\tusing\ta\tmore\tappropriate\tlanguage,\tsuch\tas\tErlang,\tto\tmanage concurrency\tin\ta\tmore\telegant\tway.\tIt\tshould\ttake\tno\tmore\tthan\ttwo weeks\tto\tdo\tit.\n\nThere\tis\ta\tdownside\tto\tusing\tmultiple\ttechnologies\ton\tthe\tsame\tsystem: the\tdevelopers\tand\tsystem\tadministrators\tneed\tto\tknow\tall\t(or\ta\tfew)\tof them.\tCompanies\tthat\tembraced\tmicroservices\tusually\ttry\tto\tstick\twith one\tcore\ttechnology\t(in\tthis\tbook,\twe\twill\tbe\tusing\tNode.js)\tand\tsome auxiliary\ttechnologies\t(although\twe\twill\tbe\tusing\tDocker\tto\tmanage\tthe deployments,\twe\tcould\tuse\tCapistrano\tor\tFabricator\tto\tmanage\tthe releases).\n\nReplaceability\n\nReplaceability\tis\tthe\tability\tto\tchange\tone\tcomponent\tof\ta\tsystem\twithout interfering\twith\thow\tthe\tsystem\tbehaves.\n\nWhen\ttalking\tabout\tsoftware,\treplaceability\tcomes\talong\twith\tlow coupling.\tWe\tshould\tbe\twriting\tour\tmicroservices\tin\ta\tway\tthat\tthe internal\tlogic\twill\tnot\tbe\texposed\tto\tthe\tcalling\tservices\tso\tthat\tthe\tclients of\ta\tgiven\tservice\tdo\tnot\tneed\tto\tknow\tabout\thow\tit\tis\timplemented,\tjust the\tinterface.\tLet's\ttake\ta\tlook\tat\tthe\tfollowing\texample.\tIt\tis\twritten\tin Java\tas\twe\tonly\tneed\tto\tsee\tthe\tinterface\tto\tidentify\tthe\tpitfalls:\n\npublic\tinterface\tGeoIpService\t{ \t\t/** \t\t\t\tChecks\tif\tan\tIP\tis\tin\tthe\tcountry\tgiven\tby\tan\tISO\t code. \t\t\t*/ \t\tboolean\tisIn(String\tip,\tString\tisoCode)\tthrows\t SOAPFaultException; }\n\nThis\tinterface,\tat\tfirst\tlook,\tis\tself\texplanatory.\tIt\tchecks\twhether\ta\tgiven IP\tis\tin\ta\tgiven\tcountry\tand\tthrows\ta\tSOAPFaultException,\twhich\tis\ta\tbig",
      "content_length": 1816,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 46,
      "content": "problem.\n\nIf\twe\tbuild\tthe\tclient\tthat\tconsumes\tthis\tservice,\tfactoring\tinto\ttheir\tlogic, capture,\tand\tprocessing\tof\tthe\tSoapFaultException,\twe\tare\texposing internal\timplementation\tdetails\tto\tthe\touter\tworld\tand\tmaking\tit\thard\tto replace\tthe\tGeoIpService\tinterface.\tAlso,\tthe\tfact\tthat\twe\tare\tcreating\ta service\trelated\tto\ta\tpart\tof\tour\tapplication\tlogic\tis\tan\tindication\tof\tthe creation\tof\ta\tbounded\tcontext:\ta\thighly\tcohesive\tservice\tor\tset\tof services\tthat\twork\ttogether\tto\tachieve\tone\tpurpose.\n\nIndependence\n\nNo\tmatter\thow\thard\twe\ttry,\tthe\thuman\tbrain\tis\tnot\tdesigned\tto\tsolve complex\tproblems.\tThe\tmost\tefficient\tmode\tof\tfunctioning\tfor\tthe\thuman brain\tis\tone\tthing\tat\tthe\ttime\tso\tthat\twe\tbreak\tdown\tcomplex\tproblems into\tsmaller\tones.\tMicroservices-oriented\tarchitectures\tshould\tfollow\tthis approach:\tall\tthe\tservices\tshould\tbe\tindependent\tand\tinteract\tthrough the\tinterface\tup\tto\ta\tpoint\tthat\tthey\tcan\tbe\tdeveloped\tby\tdifferent\tgroups of\tengineers\twithout\tany\tinteraction,\taside\tfrom\tagreeing\tthe\tinterfaces. This\twill\tenable\ta\tcompany\tadopting\tmicroservices\tto\tscale\tup,\tor\tdown, the\tengineering\tteams,\tdepending\ton\tthe\tbusiness\tneeds,\tmaking\tthe business\tagile\tin\tresponding\tto\tpeaks\tof\tdemand\tor\tperiods\tof\tquietness.\n\nWhy\tis\treplaceability\timportant?\n\nIn\ta\tprevious\tsection,\twe\ttalked\tabout\tthe\tright\tsize\tof\ta\tmicroservice.\tAs a\tgeneral\trule\tof\tthumb,\ta\tteam\tshould\tbe\table\tto\trewrite\tand\tdeploy\ta microservice\tin\ta\tsprint.\tThe\treason\tbehind\tit\tis\tthe\ttechnical\tdebt.\n\nI\twould\tdefine\ttechnical\tdebt\tas\tthe\tdeviation\tfrom\tthe\toriginal\ttechnical design\tto\tdeliver\tthe\texpected\tfunctionality\twithin\ta\tplanned\tdeadline. Some\tof\tthese\tsacrifices\tor\twrong\tassumptions\toften\tlead\tto\tpoorly written\tsoftware\tthat\tneeds\tto\tbe\tcompletely\trefactored\tor\trewritten.\n\nIn\tthe\tpreceding\texample,\tthe\tinterface\tis\texposing\tto\tthe\touter\tworld\tthe fact\tthat\twe\tare\tusing\tSOAP\tto\tcall\ta\tweb\tservice,\tbut\twe\twill\tneed\tto change\tthe\tcode\ton\tthe\tclient\tside\tas\ta\tREST\tclient\thas\tcertainly\tnothing to\tdo\twith\tSOAP\texceptions.",
      "content_length": 2012,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 47,
      "content": "Easy\tto\tdeploy\n\nMicroservices\tshould\tbe\teasy\tto\tdeploy.\n\nBeing\tsoftware\tdevelopers,\twe\tare\twell\taware\tthat\ta\tlot\tof\tthings\tcould go\twrong,\tpreventing\ta\tsoftware\tfrom\tbeing\tdeployed.\n\nMicroservices,\tas\tstated\tbefore,\tshould\tbe\teasy\tto\tdeploy\tfor\ta\tnumber\tof reasons,\tas\tstated\tin\tthe\tfollowing\tlist:\n\nSmall\tamount\tof\tbusiness\tlogic\t(remember\tthe\ttwo\tweeks\trewrite from\tscratch\trule\tof\tthumb)\tleading\tinto\tsimpler\tdeployments. Microservices\tare\tautonomous\tunits\tof\twork,\tso\tupgrading\ta\tservice is\ta\tcontained\tproblem\ton\ta\tcomplex\tsystem.\tNo\tneed\tto\tre-deploy the\tentire\tsystem. Infrastructure\tand\tconfiguration\ton\tmicroservices\tarchitectures should\tbe\tautomated\tas\tmuch\tas\tpossible.\tLater\tin\tthe\tbook,\twe\twill learn\thow\tto\tuse\tDocker\tto\tdeploy\tmicroservices\tand\twhat\tare\tthe benefits\tover\tthe\ttraditional\tdeployment\ttechniques\tare.",
      "content_length": 829,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 48,
      "content": "SOA\tversus\tmicroservices\n\nService-Oriented\tArchitectures\t(SOA)\thas\tbeen\taround\tfor\ta\tnumber of\tyears.\tSOA\tis\ta\tgreat\tprinciple\tto\tdesign\tsoftware.\tThey\tare\tself- contained\tcomponents\tproviding\tservices\tto\tother\tcomponents.\tAs\twe agreed\tbefore,\tit\tis\tall\tabout\tmaintaining\tlow\tcoupling\ton\tthe\tdifferent modules\tof\tthe\tsystem\tas\tif\tit\twas\ta\tpuzzle\tso\tthat\twe\tcan\treplace\tthe pieces\twithout\tcausing\ta\tbig\timpact\ton\tthe\toverall\tsystem.\n\nIn\tprinciple,\tSOA\tlooks\tvery\tsimilar\tto\tmicroservices\tarchitectures.\tSo what\tis\tthe\tdifference?\n\nMicroservices\tare\tfine-grained\tSOA\tcomponents.\tIn\tother\twords,\ta\tsingle SOA\tcomponent\tcan\tbe\tdecomposed\tin\ta\tnumber\tof\tmicroservices\tthat can\twork\ttogether\tin\torder\tto\tprovide\tthe\tsame\tlevel\tof\tfunctionality:\n\nTip\n\nMicroservices\tare\tfine-grained\tSOA\tcomponents.\tThey\tare lightweight\tservices\twith\ta\tnarrow\tfocus.",
      "content_length": 842,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 49,
      "content": "Another\tdifference\tbetween\tmicroservices\tand\tSOA\tis\tthe\ttechnologies used\tfor\tinterconnecting\tand\twriting\tthe\tservices.\n\nJ2EE\tis\ta\ttechnology\tstack\tthat\twas\tdesigned\tto\twrite\tSOA\tarchitectures as\tit\tenforced\tenterprise\tstandards.\tJava\tNaming\tand\tDirectory\tInterface, Enterprise\tJava\tBeans,\tand\tEnterprise\tService\tBus\t(ESB)\twere\tthe ecosystems\twhere\tSOA\tapplications\twere\tbuilt\tand\tmaintained.\tAlthough ESB\tis\ta\tstandard,\tvery\tfew\tengineers\twho\tgraduated\tafter\t2005\thave heard\tabout\tESB,\teven\tfewer\thave\tused\tit,\tand\tnowadays\tthe\tmodern frameworks\tsuch\tas\tRuby\ton\tRails\tdo\tnot\teven\tconsider\tsuch\tcomplex pieces\tof\tsoftware.\n\nOn\tthe\tother\thand,\tmicroservices\tenforce\tthe\tuse\tof\tstandards\t(such\tas HTTP)\tthat\tare\tbroadly\tknown\tand\tbroadly\tinteroperable.\tWe\tcan\tchoose the\tright\tlanguage\tor\ttool\tto\tbuild\ta\tcomponent\t(microservice)\tfollowing one\tof\tthe\tkey\tbenefits\texplained\tearlier\tin\tthis\tchapter,\tin\tthe\tTechnology heterogeneity\tsection.\n\nAside\tfrom\tthe\ttechnology\tstack\tand\tthe\tsize\tof\tthe\tservices,\tthere\tis\tan even\tbigger\tdifference\tbetween\tSOA\tand\tmicroservices:\tthe\tdomain model.\tEarlier\tin\tthis\tchapter,\twe\thave\ttalked\tabout\tdecentralization. Decentralization\tof\tthe\tgovernance,\tbut,\tmoreover,\tdecentralization\tof\tthe data.\tIn\ta\tmicroservices-based\tsoftware,\tevery\tmicroservice\tshould\tstore its\town\tdata\tlocally,\tisolating\tthe\tdomain\tmodels\tto\ta\tsingle\tservice; whereas,\ton\tan\tSOA\toriented-software,\tthe\tdata\tis\tusually\tstored\tin\ta\tfew big\tdatabases\tand\tthe\tservices\tshare\tthe\tdomain\tmodels.",
      "content_length": 1497,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 50,
      "content": "Why\tNode.js?\n\nA\tfew\tyears\tago,\tI\tdidn't\tbelieve\tin\tNode.js.\tTo\tme,\tit\twas\ta\ttrend\tmore than\ta\treal\ttool\tto\tsolve\tproblems…\tJavaScript\tin\tthe\tserver?\tThat\tdidn't look\tright.\tIn\tall\tfairness,\tI\tdidn't\teven\tlike\tJavaScript.\tThen,\tthe\tmodern frameworks\tsuch\tas\tjQuery\tor\tAngular.js\tcame\tto\tthe\trescue.\tThey solved\tone\tof\tthe\tproblems,\twhich\twas\tthe\tcross-browser\tcompatibility. Where\tbefore\twe\tneeded\tto\tfactor\tin\tat\tleast\tthree\tdifferent\tbrowsers, after\tjQuery\tall\tthis\tlogic\twas\tnicely\tencapsulated\tin\ta\tlibrary\tso\tthat\twe didn't\tneed\tto\tworry\tabout\tcompatibility\tas\tlong\tas\twe\tfollowed\tthe\tjQuery documentation.\n\nThen,\tJavaScript\tbecame\tmore\tpopular.\tSuddenly,\tall\tthe\tinternal\ttools were\twritten\twith\tSingle-Page\tApplication\t(SPA)\tframeworks\twith\ta heavy\tusage\tof\tJavaScript,\ttherefore,\tthe\tmajority\tof\tdevelopers nowadays,\tone\tway\tor\tanother,\tare\tproficient\tin\tJavaScript.\n\nThen,\tsomeone\tdecided\tto\ttake\tJavaScript\tout\tof\tthe\tbrowser,\twhich\twas a\tgreat\tidea.\tRhino,\tNode.js,\tand\tNashorn\tare\texamples\tof\truntimes\tthat can\texecute\tstandalone\tJavaScript.\tSome\tof\tthem\tcan\teven\tinteract\twith the\tJava\tcode,\tenabling\tthe\tdeveloper\tto\timport\tJava\tclasses\tinto\ta JavaScript\tprogram,\twhich\tgives\tyou\tthe\taccess\tto\tan\tendless\tset\tof frameworks\talready\twritten\tin\tJava.\n\nLet's\tfocus\ton\tNode.js.\tNode.js\tis\tthe\tperfect\tcandidate\tfor microservices-oriented\tarchitectures\tfor\ta\tnumber\tof\treasons,\tas\tstated in\tthe\tfollowing\tlist:\n\nEasy\tto\tlearn\t(although\tit\tcan\tbe\thard\tto\tmaster) Easy\tto\tscale Highly\ttestable Easy\tto\tdeploy Dependency\tmanagement\tthrough\tnpm There\tare\thundreds\tof\tlibraries\tto\tintegrate\twith\tthe\tmajority\tof standard\tprotocols\n\nThese\treasons,\talong\twith\tothers\tthat\twe\twill\tdevelop\tin\tthe\tfollowing chapters,\tmake\tNode.js\tthe\tperfect\tcandidate\tfor\tbuilding\tsolid",
      "content_length": 1768,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 51,
      "content": "microservices.\n\nAPI\taggregation\n\nSeneca\tis\tthe\tframework\tthat\tI\thave\tchosen\tfor\tdevelopment\tin\tthe following\tchapters.\tOne\tof\tthe\tmost\tattractive\tcharacteristics\tof\tSeneca\tis API\taggregation.\n\nAPI\taggregation\tis\tan\tadvanced\ttechnique\tto\tcompose\tan\tinterface\tby aggregating\tdifferent\tfunctionalities\t(plugins,\tmethods,\tand\tso\ton)\tto\tit.\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\texample:\n\nvar\texpress\t=\trequire('express'); var\tapp\t=\texpress();\n\napp.get('sayhello',\tfunction\t(req,\tres)\t{ \t\tres.send('Hello\tWorld!'); }); app.get('saygoodbye',\tfunction(req,\tres)\t{ \t\tres.send('Bye\tbye!'); });\n\nvar\tserver\t=\tapp.listen(3000,\tfunction\t()\t{ \t\tvar\thost\t=\tserver.address().address; \t\tvar\tport\t=\tserver.address().port; \t\tconsole.log('App\tlistening\tat\thttp://%s:%s',\thost,\t port); });\n\nThe\tpreceding\texample\tuses\tExpress,\ta\tvery\tpopular\tweb\tframework\tfor Node.js.\tThis\tframework\tis\talso\tbuilt\taround\tthe\tAPI\taggregation technique.\tLet's\ttake\ta\tlook\tat\tthe\tfourth\tand\tseventh\tlines.\tIn\tthese\tlines, the\tdeveloper\tregisters\ttwo\tmethods\tthat\tare\tto\tbe\texecuted\twhen someone\thits\tthe\tURLs\t/sayhello\tand\t/saygoodbye\twith\ta\tGET\trequest. In\tother\twords,\tthe\tapplication\tis\tcomposed\tof\tdifferent\tsmaller\tand independent\timplementations\tthat\tare\texposed\tto\tthe\touter\tworld\ton\ta single\tinterface,\tin\tthis\tcase,\tan\tapp\tlistening\ton\tthe\t3000\tport.\n\nIn\tthe\tfollowing\tchapters,\tI\twill\texplain\twhy\tthis\tproperty\tis\timportant\tand how\tto\ttake\tadvantage\tof\tit\twhen\tbuilding\t(and\tscaling)\tmicroservices.",
      "content_length": 1467,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 52,
      "content": "The\tfuture\tof\tNode.js\n\nJavaScript\twas\tfirst\tdesigned\tto\tbe\ta\tlanguage\texecuted\tin\tthe\tweb browser.\tFor\tthose\twho\tworked\tor\tstudied,\tusing\tC/C++\twas\tvery\tfamiliar and\tthat\twas\tthe\tkey\tfor\tits\tadoption\tas\ta\tstandard\tfor\tthe\tdynamic manipulation\tof\tdocuments\tin\tWeb\t2.0.\tAsynchronous\tJavaScript\tand XML\t(AJAX)\twas\tthe\tdetonator\tfor\tJavaScript\tgrowth.\tDifferent\tbrowsers had\tdifferent\timplementations\tof\tthe\trequest\tobjects\tso\tthat\tthe developers\thad\ta\thard\ttime\tto\twrite\ta\tcross-browser\tcode.\n\nThe\tlack\tof\tstandards\tled\tto\tthe\tcreation\tof\tmany\tframeworks\tthat encapsulated\tthe\tlogic\tbehind\tAJAX,\tmaking\teasy-to-write\tcross-browser scripts.\n\nJavaScript\tis\ta\tscript\tlanguage.\tIt\twas\tnot\tdesigned\tto\tbe\tobject\toriented, neither\twas\tit\tdesigned\tto\tbe\tthe\tlanguage\tof\tchoice\tfor\tlarge applications\tas\tthe\tcode\ttends\tto\tget\tchaotic\tand\tit\tis\thard\tto\tenforce standards\tacross\tdifferent\tcompanies\ton\thow\tthe\tcode\tshould\tbe\tlaid out.\tEvery\tsingle\tcompany\twhere\tI\tworked\thas\tdifferent\tbest\tpractices and\tsome\tof\tthem\tare\teven\tcontradictory.\n\nEuropean\tComputer\tManufacturers\tAssociation\t(ECMA)\tcame\tto\tthe rescue.\tECMAScript\t6,\tthe\tnext\tstandard\tfor\tECMA\tlanguages (JavaScript,\tActionScript,\tRhino,\tand\tso\ton)\tintroduces\tthe\tconcept\tof classes,\tinheritance,\tcollections,\tand\ta\tnumber\tof\tinteresting\tfeatures that\twill\tmake\tthe\tdevelopment\tof\tJavaScript\tsoftware\teasier\tand\tmore standard\tthan\tthe\tactual\tV8\tspecification.\n\nOne\tof\tthese\tfeatures\tthat\tI\tconsider\tmore\tinteresting\tis\tthe\tintroduction of\tthe\tclass\tkeyword\tthat\tallows\tus\tto\tmodel\tour\tJavaScript\tsoftware\twith objects.\n\nAt\tthe\tmoment,\tthe\tmajority\tof\tbrowsers\tsupport\ta\tlarge\tnumber\tof\tthese features,\tbut\twhen\tit\tcomes\tto\tNode.js,\tonly\ta\tfew\tof\tthem\tare implemented\tby\tdefault\tand\tsome\tof\tthem\tare\timplemented\tby\tpassing special\tflags\tto\tthe\tinterpreter\t(harmony\tflags).\n\nIn\tthis\tbook,\tI\twill\ttry\tto\tavoid\tthe\tECMAScript\t6\tfeatures,\tsticking\tto\tthe V8\tspecification\tas\tit\tis\twidely\tknown\tby\tthe\tmajority\tof\tdevelopers\tand,",
      "content_length": 1970,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 53,
      "content": "once\tsomeone\tknows\tJavaScript\tV8,\tit\tis\tfairly\teasy\tto\tramp\tup\ton ECMAScript\t6.",
      "content_length": 79,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 54,
      "content": "Summary\n\nIn\tthis\tchapter,\twe\tstudied\tthe\tkey\tconcepts\taround\tmicroservices,\tas well\tas\tthe\tbest\tpractices\tto\tbe\tfollowed\twhen\tdesigning\thigh-quality software\tcomponents\ttowards\tbuilding\trobust\tand\tresilient\tsoftware architectures\tthat\tenable\tus\tto\trespond\tquickly\tto\tthe\tbusiness\tneeds.\n\nYou\thave\talso\tlearned\tthe\tkey\tbenefits\tsuch\tas\tthe\tpossibility\tof\tusing the\tright\tlanguage\tfor\tthe\tright\tservice\t(technology\theterogeneity)\ton\tthe microservices-oriented\tarchitectures\tas\twell\tas\tsome\tof\tthe\tpitfalls\tthat could\tmake\tour\tlife\tharder,\tsuch\tas\tthe\toverhead\ton\tthe\toperational\tside caused\tby\tthe\tdistributed\tnature\tof\tthe\tmicroservices-oriented architectures.\n\nFinally,\twe\tdiscussed\twhy\tNode.js\tis\ta\tgreat\ttool\tfor\tbuilding microservices,\tas\twell\tas\thow\twe\tcould\tbenefit\tfrom\tJavaScript\tto\tbuild high-quality\tsoftware\tcomponents\tthrough\ttechniques\tlike\tAPI aggregation.\n\nIn\tthe\tfollowing\tchapters,\twe\twill\tbe\tdeveloping\tthe\tconcepts\tdiscussed\tin this\tchapter,\twith\tcode\texamples\tand\tfurther\texplanation\tabout\tthe\ttopics I\thave\tlearned\tover\tthe\tyears.\n\nAs\texplained\tbefore,\twe\twill\tfocus\ton\tthe\tV8\tversion\tof\tJavaScript,\tbut\tI will\tprovide\tsome\thints\ton\thow\tto\teasily\twrite\tupgradeable\tcomponents to\tembrace\tECMAScript\t6.",
      "content_length": 1220,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 55,
      "content": "Chapter\t2.\tMicroservices\tin Node.js\t–\tSeneca\tand\tPM2 Alternatives\n\nIn\tthis\tchapter,\tyou\twill\tmainly\tlearn\tabout\ttwo\tframeworks,\tSeneca\tand PM2,\tand\twhy\tthey\tare\timportant\tfor\tbuilding\tmicroservices.\tWe\twill\talso get\tto\tknow\tthe\talternatives\tto\tthese\tframeworks\tin\torder\tto\tget\ta\tgeneral understanding\tof\twhat\tis\tgoing\ton\tin\tthe\tNode.js\tecosystem.\tIn\tthis chapter,\twe\tare\tgoing\tto\tfocus\ton\tthe\tfollowing\ttopics:\n\nNeed\tfor\tNode.js:\tIn\tthis\tsection,\twe\tare\tgoing\tto\tjustify\tthe\tchoice of\tNode.js\tas\ta\tframework\tto\tbuild\tour\tmicroservices-oriented software.\tWe\twill\twalk\tthrough\tthe\tsoftware\tstack\trequired\tto\tuse this\tawesome\ttechnology. Seneca\t–\ta\tmicroservices\tframework:\tIn\tthis\tsection,\tyou\twill\tlearn the\tbasics\tof\tSeneca\tand\twhy\tit\tis\tthe\tright\tchoice\tif\twe\twant\tto\tkeep our\tsoftware\tmanageable.\tWe\twill\texplain\thow\tto\tintegrate\tSeneca with\tExpress\t(the\tmost\tpopular\tweb\tserver\tin\tNode.js)\tin\torder\tto follow\tthe\tindustry\tstandards. PM2:\tPM2\tis\tthe\tbest\tchoice\tto\trun\tNode.js\tapplications.\tNo\tmatter what\tyour\tproblem\tin\tdeploying\tyour\tecosystem\tof\tapps\tis,\tPM2\twill always\thave\ta\tsolution\tfor\tit.\n\nNeed\tfor\tNode.js\n\nIn\tthe\tprevious\tchapter,\tI\tmentioned\tthat\tI\twasn't\ta\tbig\tfan\tof\tNode.js\tin the\tpast.\tThe\treason\tfor\tthis\twas\tthat\tI\twasn't\tprepared\tto\tcope\twith\tthe level\tof\tstandardization\tthat\tJavaScript\twas\tundergoing.\n\nJavaScript\tin\tthe\tbrowser\twas\tpainful.\tCross-browser\tcompatibility\twas always\ta\tproblem\tand\tthe\tlack\tof\tstandardization\tdidn't\thelp\tto\tease\tthe pain.\n\nThen\tNode.js\tcame\tand\tit\twas\teasy\tto\tcreate\thighly\tscalable\tapplications due\tto\tits\tnon-blocking\tnature\t(we\twill\ttalk\tabout\tit\tlater\tin\tthis\tchapter)",
      "content_length": 1627,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 56,
      "content": "and\tit\twas\talso\tvery\teasy\tto\tlearn\tas\tit\twas\tbased\ton\tJavaScript,\ta\twell- known\tlanguage.\n\nNowadays,\tNode.js\tis\tthe\tpreferred\tchoice\tfor\ta\tlarge\tnumber\tof companies\tacross\tthe\tworld,\tas\twell\tas\tthe\tnumber\tone\tchoice\tfor aspects\tthat\trequire\ta\tnon-blocking\tnature\tin\tthe\tserver,\tsuch\tas\tweb sockets.\n\nIn\tthis\tbook,\twe\twill\tprimarily\t(but\tnot\tonly)\tuse\tSeneca\tand\tPM2\tas\tthe frameworks\tfor\tbuilding\tand\trunning\tmicroservices,\tbut\tit\tdoes\tnot\tmean that\tthe\talternatives\tare\tnot\tgood.\n\nThere\tare\tfew\talternatives\tin\tthe\tmarket\tsuch\tas\trestify\tor\tExpress\tfor building\tapplications\tand\tforever\tor\tnodemon\tto\trun\tthem.\tHowever,\tI find\tSeneca\tand\tPM2\tto\tbe\tthe\tmost\tappropriate\tcombination\tfor\tbuilding microservices\tfor\tthe\tfollowing\treasons:\n\nPM2\tis\textremely\tpowerful\tregarding\tapplication\tdeployments Seneca\tis\tnot\tonly\ta\tframework\tto\tbuild\tmicroservices,\tbut\tit\tis\talso\ta paradigm\tthat\treshapes\twhat\twe\tknow\tabout\tobject-oriented software\n\nWe\twill\tbe\tusing\tExpress\tin\ta\tfew\texamples\tin\tthe\tchapters\tof\tthis\tbook and\twe\twill\talso\tdiscuss\thow\tto\tintegrate\tSeneca\tin\tExpress\tas\ta middleware.\n\nHowever,\tbefore\tthat,\tlet's\tdiscuss\tsome\tconcepts\taround\tNode.js\tthat will\thelp\tus\tto\tunderstand\tthose\tframeworks.\n\nInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2\n\nNode.js\tis\tfairly\teasy\tto\tinstall.\tDepending\ton\tyour\tsystem,\tthere\tis\tan installer\tavailable\tthat\tmakes\tthe\tinstallation\tof\tNode.js\tand\tnpm\t(Node Package\tManager)\ta\tfairly\tsimple\ttask.\tSimply\tdouble-click\ton\tit\tand follow\tthe\tinstructions.\tAt\tthe\ttime\tof\twriting\tthis\tbook,\tthere\tare\tinstallers available\tfor\tWindows\tand\tOSX.\n\nHowever,\tthe\tadvanced\tusers,\tespecially\tDevOps\tengineers,\twill\tneed\tto install\tNode.js\tand\tnpm\tfrom\tthe\tsources\tor\tbinaries.",
      "content_length": 1696,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 57,
      "content": "Note\n\nBoth\tNode.js\tand\tnpm\tprograms\tcome\tbundled\ttogether\tin\ta\tsingle package\tthat\twe\tcan\tdownload\tfor\tvarious\tplatforms\tfrom\tthe\tNode.js website\t(either\tsources\tor\tbinaries):\n\nhttps://nodejs.org/en/download/\n\nFor\tthe\tChef\tusers,\ta\tpopular\tconfiguration\tmanagement\tsoftware\tto build\tservers,\tthere\tare\tfew\toptions\tavailable,\tbut\tthe\tmost\tpopular\tis\tthe following\trecipe\t(for\tthose\tunfamiliar\twith\tChef,\ta\trecipe\tis\tbasically\ta script\tto\tinstall\tor\tconfigure\tsoftware\tin\ta\tserver\tthrough\tChef):\n\nhttps://github.com/redguide/nodejs\n\nAt\tthe\ttime\tof\twriting\tthis\tbook,\tthere\tare\tbinaries\tavailable\tfor\tLinux.\n\nLearning\tnpm\n\nnpm\tis\ta\tsoftware\tthat\tcomes\twith\tNode.js\tand\tenables\tyou\tto\tpull dependencies\tfrom\tthe\tInternet\twithout\tworrying\tabout\ttheir management.\tIt\tcan\talso\tbe\tused\tto\tmaintain\tand\tupdate\tdependencies, as\twell\tas\tcreate\tprojects\tfrom\tscratch.\n\nAs\tyou\tprobably\tknow,\tevery\tnode\tapp\tcomes\twith\ta\tpackage.json\tfile. This\tfile\tdescribes\tthe\tconfiguration\tof\tthe\tproject\t(dependencies, versions,\tcommon\tcommands,\tand\tso\ton).\tLet's\tsee\tthe\tfollowing example:\n\n{ \t\t\"name\":\t\"test-project\", \t\t\"version\":\t\"1.0.0\", \t\t\"description\":\t\"test\tproject\", \t\t\"main\":\t\"index.js\", \t\t\"scripts\":\t{ \t\t\"test\":\t\"grunt\tvalidate\t--verbose\" \t\t}, \t\t\"author\":\t\"David\tGonzalez\", \t\t\"license\":\t\"ISC\"",
      "content_length": 1277,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 58,
      "content": "}\n\nThe\tfile\titself\tis\tself-explanatory.\tThere\tis\tan\tinteresting\tsection\tin\tthe\tfile —scripts.\n\nIn\tthis\tsection,\twe\tcan\tspecify\tthe\tcommand\tthat\tis\tused\tto\trun\tfor different\tactions.\tIn\tthis\tcase,\tif\twe\trun\tnpm\ttest\tfrom\tthe\tterminal,\tnpm will\texecute\tgrunt\tvalidate\t--verbose.\n\nNode\tapplications\tare\tusually\tas\teasy\tto\trun\tas\texecuting\tthe\tfollowing command:\n\nnode\tindex.js\n\nIn\tthe\troot\tof\tyour\tproject,\tconsider\tthat\tthe\tbootstrapping\tfile\tis\tindex.js. If\tthis\tis\tnot\tthe\tcase,\tthe\tbest\tthing\tyou\tcan\tdo\tis\tadd\ta\tsubsection\tin\tthe scripts\tsection\tin\tpackage.json,\tas\tfollows:\n\n\"scripts\":\t{ \t\t\"test\":\t\"grunt\tvalidate\t--verbose\" \t\t\"start\":\t\"node\tindex.js\" },\n\nAs\tyou\tcan\tsee,\tnow\twe\thave\ttwo\tcommands\texecuting\tthe\tsame program:\n\nnode\tindex.js npm\tstart\n\nThe\tbenefits\tof\tusing\tnpm\tstart\tare\tquite\tobvious—uniformity.\tNo\tmatter how\tcomplex\tyour\tapplication\tis,\tnpm\tstart\twill\talways\trun\tit\t(if\tyou\thave configured\tthe\tscripts\tsection\tcorrectly).\n\nLet's\tinstall\tSeneca\tand\tPM2\ton\ta\tclean\tproject.\n\nFirst,\texecute\tnpm\tinit\tin\ta\tnew\tfolder\tfrom\tthe\tterminal\tafter\tinstalling Node.js.\tYou\tshould\tget\ta\tprompt\tsimilar\tto\tthe\tfollowing\timage:",
      "content_length": 1134,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 59,
      "content": "npm\twill\task\tyou\tfor\ta\tfew\tparameters\tto\tconfigure\tyour\tproject,\tand\tonce you\tare\tdone,\tit\twrites\ta\tpackage.json\tfile\twith\tcontent\tsimilar\tto\tthe preceding\tcode.\n\nNow\twe\tneed\tto\tinstall\tthe\tdependencies;\tnpm\twill\tdo\tthat\tfor\tus.\tJust run\tthe\tfollowing\tcommand:\n\nnpm\tinstall\t--save\tseneca\n\nNow,\tif\tyou\tinspect\tpackage.json\tagain,\tyou\tcan\tsee\tthat\tthere\tis\ta\tnew section\tcalled\tdependencies\tthat\tcontains\tan\tentry\tfor\tSeneca:\n\n\"dependencies\":\t{ \t\t\"seneca\":\t\"^0.7.1\" }\n\nThis\tmeans\tthat\tfrom\tnow\ton,\tour\tapp\tcan\trequire\tthe\tSeneca\tmodule and\tthe\trequire()\tfunction\twill\tbe\table\tto\tfind\tit.\tThere\tare\ta\tfew variations\tof\tthe\tsave\tflag,\tas\tfollows:\n\nsave:\tThis\tsaves\tthe\tdependency\tin\tthe\tdependencies\tsection.\tIt\tis available\tthrough\tall\tthe\tdevelopment\tlife\tcycle. save-dev:\tThis\tsaves\tthe\tdependency\tin\tthe\tdevDependencies\tsection. It\tis\tonly\tavailable\tin\tdevelopment\tand\tdoes\tnot\tget\tdeployed\tinto production. save-optional:\tThis\tadds\ta\tdependency\t(such\tas\tsave),\tbut\tlets\tnpm continue\tif\tthe\tdependency\tcan't\tbe\tfound.\tIt\tis\tup\tto\tthe\tapp\tto handle\tthe\tlack\tof\tthis\tdependency.\n\nLet's\tcontinue\twith\tPM2.\tAlthough\tit\tcan\tbe\tused\tas\ta\tlibrary,\tPM2\tis",
      "content_length": 1147,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 60,
      "content": "mainly\ta\tcommand\ttool,\tlike\tls\tor\tgrep\tin\tany\tUnix\tsystem.\tnpm\tdoes\ta great\tjob\tinstalling\tcommand-line\ttools:\n\nnpm\tinstall\t–g\tpm2\n\nThe\t–g\tflags\tinstruct\tnpm\tto\tglobally\tinstall\tPM2,\tso\tit\tis\tavailable\tin\tthe system,\tnot\tin\tthe\tapp.\tThis\tmeans\tthat\twhen\tthe\tprevious\tcommand finishes,\tpm2\tis\tavailable\tas\ta\tcommand\tin\tthe\tconsole.\tIf\tyou\trun\tpm2 help\tin\ta\tterminal,\tyou\tcan\tsee\tthe\thelp\tof\tPM2.\n\nOur\tfirst\tprogram\t–\tHello\tWorld\n\nOne\tof\tthe\tmost\tinteresting\tconcepts\taround\tNode.js\tis\tsimplicity.\tYou can\tlearn\tNode.js\tin\tfew\tdays\tand\tmaster\tit\tin\ta\tfew\tweeks,\tas\tlong\tas you\tare\tfamiliar\twith\tJavaScript.\tCode\tin\tNode.js\ttends\tto\tbe\tshorter\tand clearer\tthan\tin\tother\tlanguages:\n\nvar\thttp\t=\trequire('http');\n\nvar\tserver\t=\thttp.createServer(function\t(request,\t response)\t{ \t\tresponse.writeHead(200,\t{\"Content-Type\":\t \"text/plain\"}); \t\tresponse.end(\"Hello\tWorld\\n\"); });\n\nserver.listen(8000);\n\nThe\tpreceding\tcode\tcreates\ta\tserver\tthat\tlistens\ton\tthe\t8000\tport\tfor requests.\tIf\tyou\tdon't\tbelieve\tit,\topen\ta\tbrowser\tand\ttype http://127.0.0.1:8000\tin\tthe\tnavigation\tbar,\tas\tshown\tin\tthe\tfollowing screenshot:",
      "content_length": 1102,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 61,
      "content": "Let's\texplain\tthe\tcode:\n\nThe\tfirst\tline\tloads\tthe\thttp\tmodule.\tThrough\tthe\trequire() instruction,\twe\task\tthe\tnode\tto\tload\tthe\thttp\tmodule\tand\tassign\tthe export\tof\tthis\tmodule\tto\tthe\thttp\tvariable.\tExporting\tlanguage elements\tis\tthe\tway\tthat\tNode.js\thas\tto\texpose\tfunctions\tand variables\tto\tthe\touter\tworld\tfrom\tinside\ta\tmodule. The\tsecond\tconstruction\tin\tthe\tscript\tcreates\tthe\tHTTP\tserver.\tThe http\tmodule\tcreates\tand\texposes\ta\tmethod\tcalled\tcreateServer() that\treceives\ta\tfunction\t(remember\tJavaScript\ttreats\tfunctions\tas first-level\tobjects\tso\tthat\tthey\tcan\tbe\tpassed\tas\tother\tfunctions arguments)\tas\ta\tparameter\tthat,\tin\tthe\tNode.js\tworld,\tis\tcalled callback.\tA\tcallback\tis\tan\taction\tto\tbe\texecuted\tas\ta\tresponse\tto\tan event.\tIn\tthis\tcase,\tthe\tevent\tis\tthat\tthe\tscript\treceives\tan\tHTTP request.\tNode.js\thas\ta\theavy\tusage\tof\tcallbacks\tdue\tto\tits\tthread model.\tYour\tapplication\twill\talways\tbe\texecuted\ton\ta\tsingle\tthread so\tthat\tnot\tblocking\tthe\tapplication\tthread\twhile\twaiting\tfor operations\tto\tcomplete\tand\tprevents\tour\tapplication\tfrom\tlooking stalled\tor\thanged.\tOtherwise,\tyour\tprogram\twon't\tbe\tresponsive. We'll\tcome\tback\tto\tthis\tin\tChapter\t4,\tWriting\tYour\tFirst\tMicroservice in\tNode.js. In\tthe\tnext\tline,\tserver.listen(8000)\tstarts\tthe\tserver.\tFrom\tnow\ton, every\ttime\tour\tserver\treceives\ta\trequest,\tthe\tcallback\ton\tthe",
      "content_length": 1327,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 62,
      "content": "http.createServer()\tfunction\twill\tbe\texecuted.\n\nThis\tis\tit.\tSimplicity\tis\tthe\tkey\tto\tNode.js\tprograms.\tThe\tcode\tallows\tyou to\tgo\tto\tthe\tpoint\twithout\twriting\ttons\tof\tclasses,\tmethods,\tand\tconfig objects\tthat\tcomplicate\twhat,\tin\tthe\tfirst\tinstance,\tcan\tbe\tdone\tmuch more\tsimply:\twrite\ta\tscript\tthat\tserves\trequests.\n\nNode.js\tthreading\tmodel\n\nPrograms\twritten\tin\tNode.js\tare\tsingle-threaded.\tThe\timpact\tof\tthis\tis quite\tsignificant;\tin\tthe\tprevious\texample,\tif\twe\thave\tten\tthousand concurrent\trequests,\tthey\twill\tbe\tqueued\tand\tsatisfied\tby\tthe\tNode.js event\tloop\t(it\twill\tbe\tfurther\texplained\tin\tChapter\t4,\tWriting\tYour\tFirst Microservice\tin\tNode.js\tand\tChapter\t6,\tTesting\tand\tDocumenting\tNode.js Microservices)\tone\tby\tone.\n\nAt\tfirst\tglance,\tthis\tsounds\twrong.\tI\tmean,\tthe\tmodern\tCPUs\tcan\thandle multiple\tparallel\trequests\tdue\tto\ttheir\tmulticore\tnature.\tSo,\twhat\tis\tthe benefit\tof\texecuting\tthem\tin\tone\tthread?\n\nThe\tanswer\tto\tthis\tquestion\tis\tthat\tNode.js\twas\tdesigned\tto\thandle asynchronous\tprocessing.\tThis\tmeans\tthat\tin\tthe\tevent\tof\ta\tslow operation\tsuch\tas\treading\ta\tfile,\tinstead\tof\tblocking\tthe\tthread,\tNode.js allows\tthe\tthread\tto\tcontinue\tsatisfying\tother\tevents,\tand\tthen\tthe\tcontrol process\tof\tthe\tnode\twill\texecute\tthe\tmethod\tassociated\twith\tthe\tevent, processing\tthe\tresponse.\n\nSticking\tto\tthe\tprevious\texample,\tthe\tcreateServer()\tmethod\taccepts\ta callback\tthat\twill\tbe\texecuted\tin\tthe\tevent\tof\tan\tHTTP\trequest,\tbut meanwhile,\tthe\tthread\tis\tfree\tto\tkeep\texecuting\tother\tactions.\n\nThe\tcatch\tin\tthis\tmodel\tis\twhat\tNode.js\tdevelopers\tcall\tthe\tcallback\thell. The\tcode\tgets\tcomplicated\tas\tevery\tsingle\taction\tthat\tis\ta\tresponse\tto\ta blocking\taction\thas\tto\tbe\tprocessed\ton\ta\tcallback,\tlike\tin\tthe\tprevious example;\tthe\tfunction\tused\tas\ta\tparameter\tto\tthe\tcreateServer()\tmethod is\ta\tgood\texample.\n\nModular\torganization\tbest\tpractices",
      "content_length": 1836,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 63,
      "content": "The\tsource\tcode\torganization\tfor\tbig\tprojects\tis\talways\tcontroversial. Different\tdevelopers\thave\tdifferent\tapproaches\tto\thow\tto\torder\tthe source\tcode\tin\torder\tto\tkeep\tthe\tchaos\taway.\n\nSome\tlanguages\tsuch\tas\tJava\tor\tC#\torganize\tthe\tcode\tin\tpackages\tso that\twe\tcan\tfind\tsource\tcode\tfiles\tthat\tare\trelated\tinside\ta\tpackage.\tAs an\texample,\tif\twe\tare\twriting\ta\ttask\tmanager\tsoftware,\tinside\tthe com.taskmanager.dao\tpackage\twe\tcan\texpect\tto\tfind\tclasses\tthat implement\tthe\tdata\taccess\tobject\t(DAO)\tpattern\tin\torder\tto\taccess\tthe database.\tIn\tthe\tsame\tway,\tin\tthe\tcom.taskmanager.dao.domain.model package,\twe\tcan\tfind\tall\tthe\tclasses\tthat\trepresent\tmodel\tobjects (usually\ttables)\tin\tour\tapplication.\n\nThis\tis\ta\tconvention\tin\tJava\tand\tC#.\tIf\tyou\tare\ta\tC#\tdeveloper,\tand\tyou start\tworking\ton\tan\texisting\tproject,\tit\tonly\ttakes\tyou\ta\tfew\tdays\tto\tget used\tto\thow\tthe\tcode\tis\tstructured\tas\tthe\tlanguage\tenforces\tthe organization\tof\tthe\tsource.\n\nJavascript\n\nJavaScript\twas\tfirst\tdesigned\tto\tbe\trun\tinside\tthe\tbrowser.\tThe\tcode\twas supposed\tto\tbe\tembedded\tin\tHTML\tdocuments\tso\tthat\tthe\tDocument Object\tModel\t(DOM)\tcould\tbe\tmanipulated\tto\tcreate\tdynamic\teffects. Take\ta\tlook\tat\tthe\tfollowing\texample:\n\n<!DOCTYPE\thtml> <html> <head> \t\t<meta\tcharset=\"UTF-8\"> \t\t<title>Title\tof\tthe\tdocument</title> </head> <body> \t\tHello\t<span\tid=\"world\">Mundo</span> \t\t<script\ttype=\"text/javascript\"> \t\tdocument.getElementById(\"world\").innerText\t=\t 'World'; \t\t</script> </body> </html>\n\nAs\tyou\tcan\tsee,\tif\tyou\tload\tthis\tHTML\ton\ta\tbrowser,\tthe\ttext\tinside\tthe",
      "content_length": 1525,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 64,
      "content": "span\ttag\twith\tthe\tid\tas\tworld\tis\treplaced\twhen\tthe\tpage\tloads.\n\nIn\tJavaScript,\tthere\tis\tno\tconcept\tof\tdependency\tmanagement. JavaScript\tcan\tbe\tsegregated\tfrom\tthe\tHTML\tinto\tits\town\tfile,\tbut\tthere\tis no\tway\t(for\tnow)\tto\tinclude\ta\tJavaScript\tfile\tinto\tanother\tJavaScript\tfile.\n\nThis\tleads\tto\ta\tbig\tproblem.\tWhen\tthe\tproject\tcontains\tdozens\tof JavaScript\tfiles,\tthe\tassets\tmanagement\tbecome\tmore\tof\tan\tart\tthan\tan engineering\teffort.\n\nThe\torder\tin\twhich\tyou\timport\tthe\tJavaScript\tfiles\tbecomes\timportant\tas the\tbrowser\texecutes\tthe\tJavaScript\tfiles\tas\tit\tfinds\tthem.\tLet's\treorder the\tcode\tin\tthe\tprevious\texample\tto\tdemonstrate\tit,\tas\tfollows:\n\n<!DOCTYPE\thtml> <html> <head> \t\t<meta\tcharset=\"UTF-8\"> \t\t<title>Title\tof\tthe\tdocument</title> \t\t<script\ttype=\"text/javascript\"> \t\t\t\tdocument.getElementById(\"world\").innerText\t=\t 'World'; \t\t</script> </head> <body> \t\tHello\t<span\tid=\"world\">Mundo</span>\n\n</body> </html>\n\nNow,\tsave\tthis\tHTML\tin\tan\tindex.html\tfile\tand\ttry\tto\tload\tit\tin\tany browser,\tas\tshown\tin\tthe\tfollowing\timage:",
      "content_length": 1023,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 65,
      "content": "In\tthis\tcase,\tI\thave\tused\tChrome\tand\tthe\tconsole\tshows\tan\tUncaught TypeError:\tCannot\tset\tproperty\t'innerText'\tof\tnull\terror\tin\tline\t7.\n\nWhy\tis\tthat\thappening?\n\nAs\twe\texplained\tearlier,\tthe\tbrowser\texecutes\tthe\tcode\tas\tit\tis\tfound, and\tit\tturns\tout\tthat\twhen\tthe\tbrowser\texecutes\tthe\tJavaScript,\tthe\tworld element\tdoes\tnot\texist\tyet.\n\nFortunately,\tNode.js\thas\tsolved\tthe\tdependency-loading\tproblem\tusing\ta very\telegant\tand\tstandard\tapproach.\n\nSOLID\tdesign\tprinciples\n\nWhen\ttalking\tabout\tmicroservices,\twe\talways\ttalk\tabout\tmodularity,\tand modularity\talways\tboils\tdown\tto\tthe\tfollowing\t(SOLID)\tdesign\tprinciples:\n\nSingle\tresponsibility\tprinciple Open\tfor\textension,\tclosed\tfor\tmodification Liskov\tsubstitution Interface\tsegregation Dependency\tinversion\t(inversion\tof\tcontrol\tand\tdependency injection)\n\nYou\twant\tyour\tcode\tto\tbe\torganized\tin\tmodules.\tA\tmodule\tis\tan aggregation\tof\tcode\tthat\tdoes\tsomething\tsimple,\tsuch\tas\tmanipulating strings,\tand\tit\tdoes\tit\twell.\tThe\tmore\tfunctions\t(or\tclasses,\tutilities,\tand so\ton)\tyour\tmodule\tcontains,\tthe\tless\tcohesive\tit\tis,\tand\twe\tare\ttrying\tto avoid\tthat.\n\nIn\tNode.js,\tevery\tJavaScript\tfile\tis\ta\tmodule\tby\tdefault.\tWe\tcan\talso\tuse folders\tas\tmodules,\tbut\tlet's\tfocus\ton\tfiles:\n\nfunction\tcontains(a,\tb)\t{ \t\treturn\ta.indexOf(b)\t>\t-1; }\n\nfunction\tstringToOrdinal(str)\t{ \t\tvar\tresult\t=\t\"\" \t\tfor\t(var\ti\t=\t0,\tlen\t=\tstr.length;\ti\t<\tlen;\ti++)\t{ \t\t\t\tresult\t+=\tcharToNumber(str[i]);",
      "content_length": 1411,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 66,
      "content": "} \t\treturn\tresult; }\n\nfunction\tcharToNumber(char)\t{ \t\treturn\tchar.charCodeAt(0)\t-\t96; }\n\nmodule.exports\t=\t{ \t\tcontains:\tcontains, \t\tstringToOrdinal:\tstringToOrdinal }\n\nThe\tpreceding\tcode\trepresents\ta\tvalid\tmodule\tin\tNode.js.\tIn\tthis\tcase, the\tmodule\tcontains\tthree\tfunctions,\twhere\ttwo\tof\tthem\tare\texposed\tto the\toutside\tof\tthe\tmodule.\n\nIn\tNode.js,\tthis\tis\tdone\tthrough\tthe\tmodule.exports\tvariable.\tWhatever you\tassign\tto\tthis\tvariable\tis\tgoing\tto\tbe\tvisible\tby\tthe\tcalling\tcode\tso that\twe\tcan\tsimulate\tprivate\tcontent\ton\ta\tmodule,\tsuch\tas\tthe charToNumber()\tfunction\tin\tthis\tcase.\n\nSo,\tif\twe\twant\tto\tuse\tthis\tmodule,\twe\tjust\tneed\tto\trequire()\tit,\tas\tfollows:\n\nvar\tstringManipulation\t=\trequire(\"./string- manipulation\"); console.log(stringManipulation.stringToOrdinal(\"aabb\") );\n\nThis\tshould\toutput\t1122.\n\nLet's\tgo\tback\tto\tthe\tSOLID\tprinciples\tand\tsee\thow\tour\tmodule\tlooks:\n\nSingle\tresponsibility\tprinciple:\tOur\tmodule\tonly\tdeals\twith\tstrings Open\tfor\textension,\tclosed\tfor\tmodification:\tWe\tcan\tadd\tmore functions,\tbut\tthe\tones\tthat\twe\thave\tare\tcorrect\tand\tthey\tcan\tbe used\tto\tbuild\tnew\tfunctions\tin\tthe\tmodule Liskov\tsubstitution:\tWe\twill\tskip\tthis\tone,\tas\tthe\tstructure\tof\tthe module\tis\tirrelevant\tto\tfulfil\tthis\tprinciple Interface\tsegregation:\tJavaScript\tis\tnot\ta\tlanguage\tthat\tcounts\twith an\tinterface\telement\tsuch\tas\tJava\tor\tC#,\tbut\tin\tthis\tmodule,\twe exposed\tthe\tinterface,\tand\tthe\tmodule.exports\tvariable\twill\tact\tas\ta",
      "content_length": 1426,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 67,
      "content": "contract\tfor\tthe\tcalling\tcode\tand\tthe\tchange\tin\tour\timplementation won't\taffect\thow\tthe\tmodule\tis\tbeing\tcalled Dependency\tinversion:\tHere\tis\twhere\twe\tfail,\tnot\tfully,\tbut\tenough to\treconsider\tour\tapproach\n\nIn\tthis\tcase,\twe\trequire\tthe\tmodule,\tand\tthe\tonly\tway\tto\tinteract\twith\tit\tis through\tthe\tglobal\tscope.\tIf,\tinside\tthe\tmodule,\twe\twant\tto\tinteract\twith data\tfrom\toutside,\tthe\tonly\tpossible\toption\tis\tto\tcreate\ta\tglobal\tvariable (or\tfunction)\tprior\tto\trequiring\tthe\tmodule,\tand\tthen\tassume\tthat\tit\tis always\tgoing\tto\tbe\tin\tthere.\n\nGlobal\tvariables\tare\ta\tbig\tproblem\tin\tNode.js.\tAs\tyou\tare\tprobably aware,\tin\tJavaScript,\tif\tyou\tomit\tthe\tvar\tkeyword\twhen\tdeclaring\ta variable,\tit\tis\tautomatically\tglobal.\n\nThis,\tcoupled\twith\tthe\tfact\tthat\tintentional\tglobal\tvariables\tcreate\ta\tdata coupling\tbetween\tmodules\t(coupling\tis\twhat\twe\twant\tto\tavoid\tat\tany cost),\tis\tthe\treason\tto\tfind\ta\tbetter\tapproach\tto\thow\tto\tdefine\tthe modules\tfor\tour\tmicroservices\t(or\tin\tgeneral).\n\nLet's\trestructure\tthe\tcode\tas\tfollows:\n\nfunction\tinit(options)\t{\n\nfunction\tcharToNumber(char)\t{ \t\t\t\treturn\tchar.charCodeAt(0)\t-\t96; \t\t}\n\nfunction\tStringManipulation()\t{ \t\t}\n\nvar\tstringManipulation\t=\tnew\tStringManipulation();\n\nstringManipulation.contains\t=\tfunction(a,\tb)\t{ \t\t\t\treturn\ta.indexOf(b)\t>\t-1; \t\t};\n\nstringManipulation.stringToOrdinal\t=\tfunction(str)\t{ \t\t\t\tvar\tresult\t=\t\"\" \t\t\t\tfor\t(var\ti\t=\t0,\tlen\t=\tstr.length;\ti\t<\tlen;\ti++)\t{ \t\t\t\t\t\tresult\t+=\tcharToNumber(str[i]); \t\t\t\t} \t\t\t\treturn\tresult; \t\t}",
      "content_length": 1468,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 68,
      "content": "return\tstringManipulation; }\n\nmodule.exports\t=\tinit;\n\nThis\tlooks\ta\tbit\tmore\tcomplicated,\tbut\tonce\tyou\tget\tused\tto\tit,\tthe benefits\tare\tenormous:\n\nWe\tcan\tpass\tconfiguration\tparameters\tto\tthe\tmodule\t(such\tas debugging\tinformation) Avoids\tthe\tpollution\tof\tglobal\tscope\tas\tif\teverything\tis\twrapped inside\ta\tfunction,\tand\twe\tenforce\tthe\tuse\tstrict\tconfiguration\t(this avoids\tdeclarations\twithout\tvar\twith\ta\tcompilation\terror) Parameterizing\ta\tmodule\tmakes\tit\teasy\tto\tmock\tbehaviors\tand\tdata for\ttesting\n\nIn\tthis\tbook,\twe\tare\tgoing\tto\tbe\twriting\ta\tgood\tamount\tof\tcode\tto\tmodel systems\tfrom\tthe\tmicroservices\tprospective.\tWe\twill\ttry\tto\tkeep\tthis pattern\tas\tmuch\tas\twe\tcan\tso\tthat\twe\tcan\tsee\tthe\tbenefits.\n\nOne\tof\tthe\tlibrary\tthat\twe\tare\tgoing\tto\tbe\tusing\tto\tbuild\tmicroservices, Seneca,\tfollows\tthis\tpattern,\tas\twell\tas\ta\tlarge\tnumber\tof\tlibraries\tthat can\tbe\tfound\ton\tInternet.",
      "content_length": 872,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 69,
      "content": "Seneca\t–\ta\tmicroservices framework\n\nSeneca\tis\ta\tframework\tfor\tbuilding\tmicroservices\twritten\tby\tRichard Rodger,\tthe\tfounder\tand\tCTO\tof\tnearForm,\ta\tconsultancy\tthat\thelps other\tcompanies\tdesign\tand\timplement\tsoftware\tusing\tNode.js.\tSeneca is\tabout\tsimplicity,\tit\tconnects\tservices\tthrough\ta\tsophisticated\tpattern- matching\tinterface\tthat\tabstracts\tthe\ttransport\tfrom\tthe\tcode\tso\tthat\tit\tis fairly\teasy\tto\twrite\thighly\tscalable\tsoftware.\n\nLet's\tstop\ttalking\tand\tsee\tsome\texamples:\n\nvar\tseneca\t=\trequire(\t'seneca'\t)()\n\nseneca.add({role:\t'math',\tcmd:\t'sum'},\tfunction\t(msg,\t respond)\t{ \t\tvar\tsum\t=\tmsg.left\t+\tmsg.right \t\trespond(null,\t{answer:\tsum}) })\n\nseneca.add({role:\t'math',\tcmd:\t'product'},\tfunction\t (msg,\trespond)\t{ \t\tvar\tproduct\t=\tmsg.left\t*\tmsg.right \t\trespond(\tnull,\t{\tanswer:\tproduct\t}\t) })\n\nseneca.act({role:\t'math',\tcmd:\t'sum',\tleft:\t1,\tright:\t 2},\tconsole.log) \t\t\t\tseneca.act({role:\t'math',\tcmd:\t'product',\tleft:\t3,\t right:\t4},\tconsole.log)\n\nAs\tyou\tcan\tsee,\tthe\tcode\tis\tself-explanatory:\n\nSeneca\tcomes\tas\ta\tmodule,\tso\tthe\tfirst\tthing\tthat\tneeds\tto\tbe\tdone is\tto\trequire()\tit.\tSeneca\tpackage\tis\twrapped\tin\ta\tfunction,\tso invoking\tthe\tfunction\tinitializes\tthe\tlibrary. Next\ttwo\tinstructions\tare\trelated\tto\ta\tconcept\texplained\tin\tChapter 1,\tMicroservices\tArchitecture:\tAPI\tcomposition.\tThe\tseneca.add() method\tinstructs\tSeneca\tto\tadd\ta\tfunction\tthat\twill\tbe\tinvoked\twith\ta set\tof\tpatterns.\tFor\tthe\tfirst\tone,\twe\tspecify\tan\taction\tthat\twill\ttake",
      "content_length": 1452,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 70,
      "content": "place\twhen\tSeneca\treceives\tthe\t{role:\tmath,\tcmd:\tsum}\tcommand. For\tthe\tsecond\tone,\tthe\tpattern\tis\t{role:\tmath,\tcmd:\tproduct}. The\tlast\tline\tsends\ta\tcommand\tto\tSeneca\tthat\twill\tbe\texecuted\tby the\tservice\tthat\tmatches\tthe\tpattern\tpassed\tas\tthe\tfirst\tparameter.\tIn this\tcase,\tit\twill\tmatch\tthe\tfirst\tservice\tas\trole\tand\tcmd\tmatch.\tThe second\tcall\tto\tact\twill\tmatch\tthe\tsecond\tservice.\n\nWrite\tthe\tcode\tin\ta\tfile\tcalled\tindex.js\tin\tthe\tproject\tthat\twe\tcreated earlier\tin\tthis\tchapter\t(remember\tthat\twe\tinstalled\tSeneca\tand\tPM2),\tand run\tthe\tfollowing\tcommand:\n\nnode\tindex.js\n\nThe\toutput\twill\tbe\tsomething\tsimilar\tto\tthe\tfollowing\timage:\n\nWe\twill\ttalk\tabout\tthis\toutput\tlater\tin\torder\tto\texplain\texactly\twhat\tit means,\tbut\tif\tyou\tare\tused\tto\tenterprise\tapplications,\tyou\tcan\talmost guess\twhat\tis\tgoing\ton.\n\nThe\tlast\ttwo\tlines\tare\tthe\tresponses\tfrom\tthe\ttwo\tservices:\tthe\tfirst\tone executes\t1+2\tand\tthe\tsecond\tone\texecutes\t3*4.\n\nThe\tnull\toutput\tthat\tshows\tup\tas\tthe\tfirst\tword\tin\tthe\tlast\ttwo\tlines corresponds\tto\ta\tpattern\tthat\tis\twidely\tused\tin\tJavaScript:\tthe\terror\tfirst callback.\n\nLet's\texplain\tit\twith\ta\tcode\texample:\n\nvar\tseneca\t=\trequire(\t'seneca'\t)()\n\nseneca.add({role:\t'math',\tcmd:\t'sum'},\tfunction\t(msg,\t respond)\t{ \t\tvar\tsum\t=\tmsg.left\t+\tmsg.right \t\trespond(null,\t{answer:\tsum}) })\n\nseneca.add({role:\t'math',\tcmd:\t'product'},\tfunction\t (msg,\trespond)\t{",
      "content_length": 1357,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 71,
      "content": "var\tproduct\t=\tmsg.left\t*\tmsg.right \t\trespond(\tnull,\t{\tanswer:\tproduct\t}\t) })\n\nseneca.act({role:\t'math',\tcmd:\t'sum',\tleft:\t1,\tright:\t 2},\tfunction(err,\tdata)\t{ \t\tif\t(err)\t{ \t\t\t\treturn\tconsole.error(err); \t\t} \t\tconsole.log(data); }); seneca.act({role:\t'math',\tcmd:\t'product',\tleft:\t3,\t right:\t4},\tconsole.log);\n\nThe\tprevious\tcode\trewrites\tthe\tfirst\tinvocation\tto\tSeneca\twith\ta\tmore appropriate\tapproach.\tInstead\tof\tdumping\teverything\tinto\tthe\tconsole, process\tthe\tresponse\tfrom\tSeneca,\twhich\tis\ta\tcallback\twhere\tthe\tfirst parameter\tis\tthe\terror,\tif\tone\thappened\t(null\totherwise),\tand\tthe\tsecond parameter\tis\tthe\tdata\tcoming\tback\tfrom\tthe\tmicroservice.\tThis\tis\twhy,\tin the\tfirst\texample,\tnull\twas\tthe\tfirst\toutput\tinto\tthe\tconsole.\n\nIn\tthe\tworld\tof\tNode.js,\tit\tis\tvery\tcommon\tto\tuse\tcallbacks.\tCallbacks\tare a\tway\tof\tindicating\tto\tthe\tprogram\tthat\tsomething\thas\thappened,\twithout being\tblocked\tuntil\tthe\tresult\tis\tready\tto\tbe\tprocessed.\tSeneca\tis\tnot\tan exception\tto\tthis.\tIt\trelies\theavily\ton\tcallbacks\tto\tprocess\tthe\tresponse\tto service\tcalls,\twhich\tmakes\tmore\tsense\twhen\tyou\tthink\tabout microservices\tbeing\tdeployed\tin\tdifferent\tmachines\t(in\tthe\tprevious example,\teverything\truns\tin\tthe\tsame\tmachine),\tespecially\tbecause\tthe network\tlatency\tcan\tbe\tsomething\tto\tfactor\tinto\tthe\tdesign\tof\tyour software.\n\nInversion\tof\tcontrol\tdone\tright\n\nInversion\tof\tcontrol\tis\ta\tmust\tin\tmodern\tsoftware.\tIt\tcomes\ttogether\twith the\tdependency\tinjection.\n\nInversion\tof\tcontrol\tcan\tbe\tdefined\tas\ta\ttechnique\tto\tdelegate\tthe creation\tor\tcall\tof\tcomponents\tand\tmethods\tso\tthat\tyour\tmodule\tdoes not\tneed\tto\tknow\thow\tto\tbuild\tthe\tdependencies,\twhich\tusually,\tare obtained\tthrough\tthe\tdependency\tinjection.",
      "content_length": 1681,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 72,
      "content": "Seneca\tdoes\tnot\treally\tmake\tuse\tof\tthe\tdependency\tinjection,\tbut\tit\tis the\tperfect\texample\tof\tinversion\tof\tcontrol.\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\tcode:\n\nvar\tseneca\t=\trequire('seneca')(); seneca.add({component:\t'greeter'},\tfunction(msg,\t respond)\t{ \t\trespond(null,\t{message:\t'Hello\t'\t+\tmsg.name}); }); seneca.act({component:\t'greeter',\tname:\t'David'},\t function(error,\tresponse)\t{ \t\tif(error)\treturn\tconsole.log(error); \t\tconsole.log(response.message); });\n\nThis\tis\tthe\tmost\tbasic\tSeneca\texample.\tFrom\tenterprise\tsoftware's\tpoint of\tview,\twe\tcan\tdifferentiate\ttwo\tcomponents\there:\ta\tproducer (Seneca.add())\tand\ta\tconsumer\t(Seneca.act()).\tAs\tmentioned\tearlier, Seneca\tdoes\tnot\thave\ta\tdependency\tinjection\tsystem\tas\tis,\tbut\tSeneca is\tgracefully\tbuilt\taround\tthe\tinversion\tof\tcontrol\tprinciple.\n\nIn\tthe\tSeneca.act()\tfunction,\twe\tdon't\texplicitly\tcall\tthe\tcomponent\tthat holds\tthe\tbusiness\tlogic;\tinstead\tof\tthat,\twe\task\tSeneca\tto\tresolve\tthe component\tfor\tus\tthrough\tthe\tuse\tof\tan\tinterface,\tin\tthis\tcase,\ta\tJSON message.\tThis\tis\tinversion\tof\tcontrol.\n\nSeneca\tis\tquite\tflexible\taround\tit:\tno\tkeywords\t(except\tfor\tintegrations) and\tno\tmandatory\tfields.\tIt\tjust\thas\ta\tcombination\tof\tkeywords\tand values\tthat\tare\tused\tby\ta\tpattern\tmatching\tengine\tcalled\tPatrun.\n\nPattern\tmatching\tin\tSeneca\n\nPattern\tmatching\tis\tone\tof\tthe\tmost\tflexible\tsoftware\tpatterns\tthat\tyou can\tuse\tfor\tmicroservices.\n\nAs\topposed\tto\tnetwork\taddresses\tor\tmessages,\tpatterns\tare\tfairly\teasy to\textend.\tLet's\texplain\tit\twith\tthe\thelp\tof\tthe\tfollowing\texample:\n\nvar\tseneca\t=\trequire('seneca')(); seneca.add({cmd:\t'wordcount'},\tfunction(msg,\trespond)",
      "content_length": 1616,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 73,
      "content": "{ \t\tvar\tlength\t=\tmsg.phrase.split('\t').length; \t\trespond(null,\t{words:\tlength}); });\n\nseneca.act({cmd:\t'wordcount',\tphrase:\t'Hello\tworld\t this\tis\tSeneca'},\tfunction(err,\tresponse)\t{ \t\tconsole.log(response); });\n\nIt\tis\ta\tservice\tthat\tcounts\tthe\tnumber\tof\twords\tin\ta\tsentence.\tAs\twe\thave seen\tbefore,\tin\tthe\tfirst\tline,\twe\tadd\tthe\thandler\tfor\tthe\twordcount command,\tand\tin\tthe\tsecond\tone,\twe\tsend\ta\trequest\tto\tSeneca\tto\tcount the\tnumber\tof\twords\tin\ta\tphrase.\n\nIf\tyou\texecute\tit,\tyou\tshould\tget\tsomething\tsimilar\tto\tthe\tfollowing\timage:\n\nBy\tnow,\tyou\tshould\tbe\table\tto\tunderstand\thow\tit\tworks\tand\teven\tmake some\tmodifications\tto\tit.\n\nLet's\textend\tthe\tpattern.\tNow,\twe\twant\tto\tskip\tthe\tshort\twords,\tas follows:\n\nvar\tseneca\t=\trequire('seneca')();\n\nseneca.add({cmd:\t'wordcount'},\tfunction(msg,\trespond)\t { \t\tvar\tlength\t=\tmsg.phrase.split('\t').length; \t\trespond(null,\t{words:\tlength}); });\n\nseneca.add({cmd:\t'wordcount',\tskipShort:\ttrue},\t function(msg,\trespond)\t{ \t\tvar\twords\t=\tmsg.phrase.split('\t'); \t\tvar\tvalidWords\t=\t0; \t\tfor\t(var\ti\t=\t0;\ti\t<\twords.length;\ti++)\t{ \t\t\t\tif\t(words[i].length\t>\t3)\t{ \t\t\t\t\t\tvalidWords++; \t\t\t\t} \t\t} \t\trespond(null,\t{words:\tvalidWords}); });",
      "content_length": 1161,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 74,
      "content": "seneca.act({cmd:\t'wordcount',\tphrase:\t'Hello\tworld\t this\tis\tSeneca'},\tfunction(err,\tresponse)\t{ \t\tconsole.log(response); });\n\nseneca.act({cmd:\t'wordcount',\tskipShort:\ttrue,\tphrase:\t 'Hello\tworld\tthis\tis\tSeneca'},\tfunction(err,\tresponse)\t { \t\tconsole.log(response); });\n\nAs\tyou\tcan\tsee,\twe\thave\tadded\tanother\thandler\tfor\tthe\twordcount command\twith\tan\textra\tskipShort\tparameter.\n\nThis\thandler\tnow\tskips\tall\tthe\twords\twith\tthree\tor\tfewer\tcharacters.\tIf\tyou execute\tthe\tpreceding\tcode,\tthe\toutput\tis\tsimilar\tto\tthe\tfollowing\timage:\n\nThe\tfirst\tline,\t{words:\t5},\tcorresponds\tto\tthe\tfirst\tact\tcall.\tThe\tsecond line,\t{words:\t4},\tcorresponds\tto\tthe\tsecond\tcall.\n\nPatrun\t–\ta\tpattern-matching\tlibrary\n\nPatrun\tis\talso\twritten\tby\tRichard\tRodger.\tIt\tis\tused\tby\tSeneca\tin\torder\tto execute\tthe\tpattern\tmatching\tand\tdecide\twhich\tservice\tshould\trespond to\tthe\tcall.\n\nPatrun\tuses\ta\tclosest\tmatch\tapproach\tto\tresolve\tthe\tcalls.\tLet's\tsee\tthe following\texample:\n\nIn\tthe\tpreceding\timage,\twe\tcan\tsee\tthree\tpatterns.\tThese\tare\tequivalent to\tseneca.add()\tfrom\tthe\texample\tin\tthe\tprevious\tsection.\n\nIn\tthis\tcase,\twe\tare\tregistering\tthree\tdifferent\tcombinations\tof\tx\tand\ty",
      "content_length": 1145,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 75,
      "content": "variables.\tNow,\tlet's\tsee\thow\tPatrun\tdoes\tthe\tmatching:\n\n{x:\t1}\t->A:\tThis\tmatches\t100%\twith\tA {x:\t2}\t->:\tNo\tmatch {x:1,\ty:1}\t->\tB:\t100%\tmatch\twith\tB;\tit\talso\tmatches\twith\tA,\tbut\tB is\ta\tbetter\tmatch—two\tout\tof\ttwo\tvs\tone\tout\tof\tone {x:1,\ty:2}\t->\tC:\t100%\tmatch\twith\tC;\tagain,\tit\talso\tmatches\twith\tA, but\tC\tis\tmore\tconcrete {y:\t1}\t->:\tNo\tmatch\n\nAs\tyou\tcan\tsee,\tPatrun\t(and\tSeneca)\twill\talways\tget\tthe\tlongest\tmatch. In\tthis\tway,\twe\tcan\teasily\textend\tthe\tfunctionality\tof\tthe\tmore\tabstract patterns\tby\tconcreting\tthe\tmatching.\n\nReusing\tpatterns\n\nIn\tthe\tpreceding\texample,\tin\torder\tto\tskip\tthe\twords\twith\tfewer\tthan\tthree characters,\twe\tdon't\treuse\tthe\tword\tcount\tfunction.\n\nIn\tthis\tcase,\tit\tis\tquite\thard\tto\treuse\tthe\tfunction\tas\tis;\talthough\tthe problem\tsounds\tvery\tsimilar,\tthe\tsolution\tbarely\toverlaps.\n\nHowever,\tlet's\tgo\tback\tto\tthe\texample\twhere\twe\tadd\ttwo\tnumbers:\n\nvar\tseneca\t=\trequire(\t'seneca'\t)()\n\nseneca.add({role:\t'math',\tcmd:\t'sum'},\tfunction\t(msg,\t respond)\t{ \t\tvar\tsum\t=\tmsg.left\t+\tmsg.right \t\trespond(null,\t{answer:\tsum}) });\n\nseneca.add({role:\t'math',\tcmd:\t'sum',\tinteger:\ttrue},\t function\t(msg,\trespond)\t{ \t\tthis.act({role:\t'math',\tcmd:\t'sum',\tleft:\t Math.floor(msg.left),\tright:\t Math.floor(msg.right)},respond); });\n\nseneca.act({role:\t'math',\tcmd:\t'sum',\tleft:\t1.5,\t right:\t2.5},\tconsole.log)\n\nseneca.act({role:\t'math',\tcmd:\t'sum',\tleft:\t1.5,",
      "content_length": 1358,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 76,
      "content": "right:\t2.5,\tinteger:\ttrue},\tconsole.log)\n\nAs\tyou\tcan\tsee,\tthe\tcode\thas\tchanged\ta\tbit.\tNow,\tthe\tpattern\tthat accepts\tan\tinteger\trelies\ton\tthe\tbase\tpattern\tto\tcalculate\tthe\tsum\tof\tthe numbers.\n\nPatrun\talways\ttries\tto\tmatch\tthe\tclosest\tand\tmost\tconcrete\tpattern\tthat\tit can\tfind\twith\tthe\tfollowing\ttwo\tdimensions:\n\nThe\tlongest\tchain\tof\tmatches The\torder\tof\tthe\tpatterns\n\nIt\twill\talways\ttry\tto\tfind\tthe\tbest\tfit,\tand\tif\tthere\tis\tan\tambiguity,\tit\twill match\tthe\tfirst\tpattern\tfound.\n\nIn\tthis\tway,\twe\tcan\trely\ton\talready-existing\tpatterns\tto\tbuild\tnew services.\n\nWriting\tplugins\n\nPlugins\tare\tan\timportant\tpart\tof\tapplications\tbased\ton\tSeneca.\tAs\twe discussed\tin\tChapter\t1,\tMicroservices\tArchitecture,\tthe\tAPI\taggregation is\tthe\tperfect\tway\tof\tbuilding\tapplications.\n\nNode.js'\tmost\tpopular\tframeworks\tare\tbuilt\taround\tthis\tconcept:\tsmall pieces\tof\tsoftware\tthat\tare\tcombined\tto\tcreate\ta\tbigger\tsystem.\n\nSeneca\tis\talso\tbuilt\taround\tthis;\tSeneca.add()\tprinciple\tadds\ta\tnew\tpiece to\tthe\tpuzzle\tso\tthat\tthe\tfinal\tAPI\tis\ta\tmixture\tof\tdifferent\tsmall\tsoftware pieces.\n\nSeneca\tgoes\tone\tstep\tfurther\tand\timplements\tan\tinteresting\tplugin system\tso\tthat\tthe\tcommon\tfunctionality\tcan\tbe\tmodularized\tand abstracted\tinto\treusable\tcomponents.\n\nThe\tfollowing\texample\tis\tthe\tminimal\tSeneca\tplugin:\n\nfunction\tminimal_plugin(\toptions\t)\t{ \t\tconsole.log(options) }",
      "content_length": 1337,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 77,
      "content": "require(\t'seneca'\t)() \t\t.use(\tminimal_plugin,\t{foo:'bar'}\t)\n\nWrite\tthe\tcode\tinto\ta\tminimal-plugin.js\tfile\tand\texecute\tit:\n\nnode\tminimal-plugin.js\n\nThe\toutput\tof\tthis\texecution\tshould\tbe\tsomething\tsimilar\tto\tthe\tfollowing image:\n\nIn\tSeneca,\ta\tplugin\tis\tloaded\tat\tthe\tstartup,\tbut\twe\tdon't\tsee\tit\tas\tthe default\tlog\tlevel\tis\tINFO.\tThis\tmeans\tthat\tSeneca\twon't\tshow\tany DEBUG\tlevel\tinfo.\tIn\torder\tto\tsee\twhat\tSeneca\tis\tdoing,\twe\tneed\tto\tget more\tinformation,\tas\tfollows:\n\nnode\tminimal-plugin.js\t–seneca.log.all\n\nThis\tproduces\ta\thuge\toutput.\tThis\tis\tpretty\tmuch\teverything\tthat\tis happening\tinside\tSeneca,\twhich\tcan\tbe\tvery\tuseful\tto\tdebug\tcomplicated situations,\tbut\tin\tthis\tcase,\twhat\twe\twant\tto\tdo\tis\tshow\ta\tlist\tof\tplugins:\n\nnode\tminimal-plugin.js\t--seneca.log.all\t|\tgrep\tplugin\t |\tgrep\tDEFINE\n\nIt\twill\tproduce\tsomething\tsimilar\tto\tthe\tfollowing\timage:\n\nLet's\tanalyze\tthe\tpreceding\toutput:\n\nbasic:\tThis\tplugin\tis\tincluded\twith\tthe\tmain\tSeneca\tmodule\tand provides\ta\tsmall\tset\tof\tbasic\tutility\taction\tpatterns.",
      "content_length": 1008,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 78,
      "content": "transport:\tThis\tis\tthe\ttransport\tplugin.\tUp\tuntil\tnow,\twe\thave\tonly executed\tdifferent\tservices\t(quite\tsmall\tand\tconcise)\ton\tthe\tsame machine,\tbut\twhat\tif\twe\twant\tto\tdistribute\tthem?\tThis\tplugin\twill\thelp us\twith\tthat,\tand\twe\twill\tsee\thow\tto\tdo\tso\tin\tthe\tfollowing\tsections. web:\tIn\tChapter\t1,\tMicroservices\tArchitecture,\twe\tmentioned\tthat\tthe microservices\tshould\tadvocate\tto\tkeep\tthe\tpipes\tthat\tconnect\tthem under\ta\tstandard\tthat\tis\twidely\tused.\tSeneca\tuses\tTCP\tby\tdefault, but\tcreating\ta\tRESTful\tAPI\tcan\tbe\ttricky.\tThis\tplugin\thelps\tto\tdo\tit, and\twe\twill\tsee\thow\tto\tdo\tthis\tin\tthe\tfollowing\tsection. mem-store:\tSeneca\tcomes\twith\ta\tdata\tabstraction\tlayer\tso\tthat\twe can\thandle\tthe\tdata\tstorage\tin\tdifferent\tplaces:\tMongo,\tSQL databases,\tand\tso\ton.\tOut\tof\tthe\tbox,\tSeneca\tprovides\tan\tin- memory\tstorage\tso\tthat\tit\tjust\tworks. minimal_plugin:\tThis\tis\tour\tplugin.\tSo,\tnow\twe\tknow\tthat\tSeneca\tis able\tto\tload\tit.\n\nThe\tplugin\twe\twrote\tdoes\tnothing.\tNow,\tit\tis\ttime\tto\twrite\tsomething useful:\n\nfunction\tmath(\toptions\t)\t{\n\nthis.add({role:'math',\tcmd:\t'sum'},\tfunction(\tmsg,\t respond\t)\t{ \t\t\t\trespond(\tnull,\t{\tanswer:\tmsg.left\t+\tmsg.right\t}\t) \t\t})\n\nthis.add({role:'math',\tcmd:\t'product'},\tfunction(\t msg,\trespond\t)\t{ \t\t\t\trespond(\tnull,\t{\tanswer:\tmsg.left\t*\tmsg.right\t}\t) \t\t})\n\n}\n\nrequire(\t'seneca'\t)() \t\t.use(\tmath\t) \t\t.act(\t'role:math,cmd:sum,left:1,right:2',\t console.log\t)\n\nFirst\tof\tall,\tnotice\tthat\tin\tthe\tlast\tinstruction,\tact()\tfollows\ta\tdifferent format.\tInstead\tof\tpassing\ta\tdictionary,\twe\tpass\ta\tstring\twith\tthe\tsame key\tvalues\tas\tthe\tfirst\targument,\tas\twe\tdid\twith\ta\tdictionary.\tThere\tis nothing\twrong\twith\tit,\tbut\tmy\tpreferred\tapproach\tis\tto\tuse\tthe\tJSON",
      "content_length": 1658,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 79,
      "content": "objects\t(dictionaries),\tas\tit\tis\ta\tway\tof\tstructuring\tthe\tdata\twithout\thaving syntax\tproblems.\n\nIn\tthe\tprevious\texample,\twe\tcan\tsee\thow\tthe\tcode\tgot\tstructured\tas\ta plugin.\tIf\twe\texecute\tit,\twe\tcan\tsee\tthat\tthe\toutput\tis\tsimilar\tto\tthe following\tone:\n\nOne\tof\tthe\tthings\tyou\tneed\tto\tbe\tcareful\tabout\tin\tSeneca\tis\thow\tto initialize\tyour\tplugins.\tThe\tfunction\tthat\twraps\tthe\tplugin\t(in\tthe\tpreceding example,\tthe\tmath()\tfunction)\tis\texecuted\tsynchronously\tby\tdesign\tand\tit is\tcalled\tthe\tdefinition\tfunction.\tIf\tyou\tremember\tfrom\tthe\tprevious chapter,\tNode.js\tapps\tare\tsingle-threaded.\n\nTo\tinitialize\ta\tplugin,\tyou\tadd\ta\tspecial\tinit()\taction\tpattern.\tThis\taction pattern\tis\tcalled\tin\tsequence\tfor\teach\tplugin.\tThe\tinit()\tfunction\tmust call\tits\trespond\tcallback\twithout\terrors.\tIf\tthe\tplugin\tinitialization\tfails, then\tSeneca\texits\tthe\tNode.js\tprocess.\tYou\twant\tyour\tmicroservices\tto fail\tfast\t(and\tscream\tloudly)\twhen\tthere's\ta\tproblem.\tAll\tplugins\tmust complete\tinitialization\tbefore\tany\tactions\tare\texecuted.\n\nLet's\tsee\tan\texample\tof\thow\tto\tinitialize\ta\tplugin\tin\tthe\tfollowing\tway:\n\nfunction\tinit(msg,\trespond)\t{ \t\tconsole.log(\"plugin\tinitialized!\"); \t\tconsole.log(\"expensive\toperation\ttaking\tplace\tnow...\t DONE!\"); \t\trespond(); }\n\nfunction\tmath(\toptions\t)\t{\n\nthis.add({role:'math',\tcmd:\t'sum'},\tfunction(\tmsg,\t respond\t)\t{ \t\t\t\trespond(\tnull,\t{\tanswer:\tmsg.left\t+\tmsg.right\t}\t) \t\t})\n\nthis.add({role:'math',\tcmd:\t'product'},\tfunction(\t msg,\trespond\t)\t{ \t\t\t\trespond(\tnull,\t{\tanswer:\tmsg.left\t*\tmsg.right\t}\t) \t\t})",
      "content_length": 1510,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 80,
      "content": "this.add({init:\t\"math\"},\tinit); } require(\t'seneca'\t)() \t\t.use(\tmath\t) \t\t.act(\t'role:math,cmd:sum,left:1,right:2',\t console.log\t)\n\nThen,\tafter\texecuting\tthis\tfile,\tthe\toutput\tshould\tlook\tvery\tsimilar\tto\tthe following\timage:\n\nAs\tyou\tcan\tread\tfrom\tthe\toutput,\tthe\tfunction\tthat\tinitializes\tthe\tplugin was\tcalled.\n\nTip\n\nThe\tgeneral\trule\tin\tNode.js\tapps\tis\tto\tnever\tblock\tthe\tthread.\tIf\tyou find\tyourself\tblocking\tthe\tthread,\tyou\tmight\tneed\tto\trethink\thow\tto avoid\tit.\n\nWeb\tserver\tintegration\n\nIn\tChapter\t1,\tMicroservices\tArchitecture,\twe\tput\ta\tspecial\temphasis\ton using\tstandard\ttechnologies\tto\tcommunicate\twith\tyour\tmicroservices.\n\nSeneca,\tby\tdefault,\tuses\ta\tTCP\ttransport\tlayer\tthat,\talthough\tit\tuses TCP,\tis\tnot\teasy\tto\tinteract\twith,\tas\tthe\tcriteria\tto\tdecide\tthe\tmethod\tthat gets\texecuted\tis\tbased\ton\ta\tpayload\tsent\tfrom\tthe\tclient.\n\nLet's\tdive\tinto\tthe\tmost\tcommon\tuse\tcase:\tyour\tservice\tis\tcalled\tby JavaScript\ton\ta\tbrowser.\tAlthough\tit\tcan\tbe\tdone,\tit\twould\tbe\tmuch easier\tif\tSeneca\texposed\ta\tREST\tAPI\tinstead\tof\tthe\tJSON\tdialog,\twhich is\tperfect\tfor\tcommunication\tbetween\tmicroservices\t(unless\tyou\thave ultra-low\tlatency\trequirements).",
      "content_length": 1141,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 81,
      "content": "Seneca\tis\tnot\ta\tweb\tframework.\tIt\tcan\tbe\tdefined\tas\ta\tgeneral\tpurpose microservices\tframework,\tso\tit\twould\tnot\tmake\ttoo\tmuch\tsense\tto\tbuild\tit around\ta\tconcrete\tcase\tlike\tthe\tone\texposed\tbefore.\n\nInstead\tof\tthat,\tSeneca\twas\tbuilt\tin\ta\tway\tthat\tmakes\tthe\tintegration\twith other\tframeworks\tfairly\teasy.\n\nExpress\tis\tthe\tfirst\toption\twhen\tbuilding\tweb\tapplications\ton\tNode.js. The\tamount\tof\texamples\tand\tdocumentation\tthat\tcan\tbe\tfound\ton Internet\tabout\tExpress\tmakes\tthe\ttask\tof\tlearning\tit\tfairly\teasy.\n\nSeneca\tas\tExpress\tmiddleware\n\nExpress\twas\talso\tbuilt\tunder\tthe\tprinciple\tof\tAPI\tcomposition.\tEvery piece\tof\tsoftware\tin\tExpress\tis\tcalled\tmiddleware,\tand\tthey\tare\tchained in\tthe\tcode\tin\torder\tto\tprocess\tevery\trequest.\n\nIn\tthis\tcase,\twe\tare\tgoing\tto\tuse\tseneca-web\tas\ta\tmiddleware\tfor Express\tso\tthat\tonce\twe\tspecify\tthe\tconfiguration,\tall\tthe\tURLs\twill\tfollow a\tnaming\tconvention.\n\nLet's\tconsider\tthe\tfollowing\texample:\n\nvar\tseneca\t=\trequire('seneca')()\n\nseneca.add('role:api,cmd:bazinga',function(args,done){ \t\tdone(null,{bar:\"Bazinga!\"}); }); seneca.act('role:web',{use:{ \t\tprefix:\t'/my-api', \t\tpin:\t{role:'api',cmd:'*'},\n\nmap:{ \t\t\t\tbazinga:\t{GET:\ttrue} \t\t} }}) var\texpress\t=\trequire('express') var\tapp\t=\texpress() app.use(\tseneca.export('web')\t) app.listen(3000)\n\nThis\tcode\tis\tnot\tas\teasy\tto\tunderstand\tas\tthe\tprevious\texamples,\tbut\tI'll do\tmy\tbest\tto\texplain\tit:",
      "content_length": 1368,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 82,
      "content": "The\tsecond\tline\tadds\ta\tpattern\tto\tSeneca.\tWe\tare\tpretty\tfamiliar with\tit\tas\tall\tthe\texamples\ton\tthis\tbook\tdo\tthat. The\tthird\tinstruction,\tseneca.act(),\tis\twhere\tthe\tmagic\thappens.\tWe are\tmounting\tthe\tpatterns\twith\tthe\trole:api\tpattern\tand\tany\tcmd pattern\t(cmd:*)\tto\treact\tto\tURLs\tunder\t/my-api.\tIn\tthis\texample,\tthe first\tseneca.add()\twill\treply\tto\tthe\tURL\tmy-apibazinga,\tas\tmy-api\tis specified\tby\tthe\tprefix\tvariable\tand\tbazinga\tby\tthe\tcmd\tpart\tof\tthe seneca.add()\tcommand. app.use(seneca.export('web'))\tinstructs\tExpress\tto\tuse\tseneca-web as\tmiddleware\tto\texecute\tactions\tbased\ton\tthe\tconfiguration\trules. app.listen(3000)\tbinds\tthe\tport\t3000\tto\tExpress.\n\nIf\tyou\tremember\tfrom\tan\tearlier\tsection\tin\tthis\tchapter,\tseneca.act() takes\ta\tfunction\tas\ta\tsecond\tparameter.\tIn\tthis\tcase,\twe\tare\texposing configuration\tto\tbe\tused\tby\tExpress\ton\thow\tto\tmap\tthe\tincoming requests\tto\tSeneca\tactions.\n\nLet's\ttest\tit:\n\nThe\tpreceding\tcode\tis\tpretty\tdense,\tso\tlet's\texplain\tit\tdown\tto\tthe\tcode from\tthe\tbrowser:\n\nExpress\treceives\ta\trequest\tthat\tis\thandled\tby\tseneca-web. The\tseneca-web\tplugin\twas\tconfigured\tto\tuse\tmy-api\tas\ta\tprefix, which\tis\tbeing\tbound\twith\tthe\tkeyword\tpin\t(refer\tto\tseneca.act() from\tthe\tpreceding\tcode)\tto\tSeneca\tactions\t(seneca.add())\tthat",
      "content_length": 1247,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 83,
      "content": "contain\tthe\trole:api\tpattern,\tplus\tany\tcmd\tpattern\t(cmd:*).\tIn\tthis case,\tmy-apibazinga\tcorresponds\tto\tthe\tfirst\t(and\tonly)\tseneca.add() command\twith\tthe\t{role:\t'api',\tcmd:\t'bazinga'}\tpattern.\n\nIt\ttakes\ta\twhile\tto\tfully\tunderstand\tthe\tintegration\tbetween\tSeneca\tand Express,\tbut\tonce\tit\tis\tclear,\tthe\tflexibility\toffered\tby\tthe\tAPI composability\tpattern\tis\tlimitless.\n\nExpress\titself\tis\tbig\tenough\tto\tbe\tout\tof\tthe\tscope\tof\tthis\tbook,\tbut\tit\tis worth\ttaking\ta\tlook\tas\tit\tis\ta\tvery\tpopular\tframework.\n\nData\tstorage\n\nSeneca\tcomes\twith\ta\tdata-abstraction\tlayer\tthat\tallows\tyou\tto\tinteract with\tthe\tdata\tof\tyour\tapplication\tin\ta\tgeneric\tway.\n\nBy\tdefault,\tSeneca\tcomes\twith\tan\tin-memory\tplugin\t(as\texplained\tin\tthe previous\tsection),\ttherefore,\tit\tworks\tout\tof\tthe\tbox.\n\nWe\tare\tgoing\tto\tbe\tusing\tit\tfor\tthe\tmajority\tof\tthis\tbook,\tas\tthe\tdifferent storage\tsystems\tare\tcompletely\tout\tof\tscope\tand\tSeneca\tabstracts\tus from\tthem.\n\nSeneca\tprovides\ta\tsimple\tdata\tabstraction\tlayer\t(Object-relational mapping\t(ORM))\tbased\ton\tthe\tfollowing\toperations:\n\nload:\tThis\tloads\tan\tentity\tby\tidentifier save:\tThis\tcreates\tor\tupdates\t(if\tyou\tprovide\tan\tidentifier)\tan\tentity list:\tThis\tlists\tentities\tmatching\ta\tsimple\tquery remove:\tThis\tdeletes\tan\tentity\tby\tan\tidentifier\n\nLet's\tbuild\ta\tplugin\tthat\tmanages\temployees\tin\tthe\tdatabase:\n\nmodule.exports\t=\tfunction(options)\t{ \t\tthis.add({role:\t'employee',\tcmd:\t'add'},\t function(msg,\trespond){\n\nthis.make('employee').data$(msg.data).save$(respond); \t\t});\n\nthis.find({role:\t'employee',\tcmd:\t'get'},\t function(msg,\trespond)\t{",
      "content_length": 1547,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 84,
      "content": "this.make('employee').load$(msg.id,\trespond); \t\t}); }\n\nRemember\tthat\tthe\tdatabase\tis,\tby\tdefault,\tin\tmemory,\tso\twe\tdon't\tneed to\tworry\tabout\tthe\ttable\tstructure\tfor\tnow.\n\nThe\tfirst\tcommand\tadds\tan\temployee\tto\tthe\tdatabase.\tThe\tsecond command\trecovers\tan\temployee\tfrom\tthe\tdatabase\tby\tid.\n\nNote\tthat\tall\tthe\tORM\tprimitives\tin\tSeneca\tend\tup\twith\tthe\tdollar\tsymbol ($).\n\nAs\tyou\tcan\tsee\tnow,\twe\thave\tbeen\tabstracted\tfrom\tthe\tdata\tstorage details.\tIf\tthe\tapplication\tchanges\tin\tthe\tfuture\tand\twe\tdecide\tto\tuse MongoDB\tas\ta\tdata\tstorage\tinstead\tof\tan\tin-memory\tstorage,\tthe\tonly thing\twe\tneed\tto\ttake\tcare\tof\tis\tthe\tplugin\tthat\tdeals\twith\tMongoDB.\n\nLet's\tuse\tour\temployee\tmanagement\tplugin,\tas\tshown\tin\tthe\tfollowing code:\n\nvar\tseneca\t=\trequire('seneca')().use('employees- storage') var\temployee\t=\t\t{ \t\tname:\t\"David\", \t\tsurname:\t\"Gonzalez\", \t\tposition:\t\"Software\tDeveloper\" }\n\nfunction\tadd_employee()\t{ \t\tseneca.act({role:\t'employee',\tcmd:\t'add',\tdata:\t employee},\tfunction\t(err,\tmsg)\t{ \t\t\t\tconsole.log(msg); \t\t}); } add_employee();\n\nIn\tthe\tpreceding\texample,\twe\tadd\tan\temployee\tto\tthe\tin-memory database\tby\tinvoking\tthe\tpattern\texposed\tin\tthe\tplugin.\n\nAlong\tthe\tbook,\twe\twill\tsee\tdifferent\texamples\tabout\thow\tto\tuse\tthe\tdata abstraction\tlayer,\tbut\tthe\tmain\tfocus\twill\tbe\ton\thow\tto\tbuild\tmicroservices and\tnot\thow\tto\tdeal\twith\tthe\tdifferent\tdata\tstorages.",
      "content_length": 1349,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 85,
      "content": "PM2\t–\ta\ttask\trunner\tfor\tNode.js\n\nPM2\tis\ta\tproduction-process\tmanager\tthat\thelps\tto\tscale\tthe\tNode.js\tup or\tdown,\tas\twell\tas\tload\tbalance\tthe\tinstances\tof\tthe\tserver.\tIt\talso ensures\tthat\tthe\tprocesses\tare\trunning\tconstantly,\ttackling\tdown\tone\tof the\tside\teffects\tof\tthe\tthread\tmodel\tof\tNode.js:\tan\tuncaught\texception kills\tthe\tthread,\twhich\tin\tturn\tkills\tyour\tapplication.\n\nSingle-threaded\tapplications\tand exceptions\n\nAs\tyou\tlearned\tbefore,\tNode.js\tapplications\tare\trun\tin\ta\tsingle\tthread. This\tdoesn't\tmean\tthat\tNode.js\tis\tnot\tconcurrent,\tit\tonly\tmeans\tthat\tyour application\truns\ton\ta\tsingle\tthread,\tbut\teverything\telse\truns\tparallel.\n\nThis\thas\tan\timplication:\tif\tan\texception\tbubbles\tout\twithout\tbeing handled,\tyour\tapplication\tdies.\n\nThe\tsolution\tfor\tthis\tis\tmaking\tan\tintensive\tuse\tof\tpromises\tlibraries\tsuch as\tbluebird;\tit\tadds\thandlers\tfor\tsuccess\tand\tfailures\tso\tthat\tif\tthere\tis an\terror,\tthe\texception\tdoes\tnot\tbubble\tout,\tkilling\tyour\tapp.\n\nHowever,\tthere\tare\tsome\tsituations\tthat\twe\tcan't\tcontrol,\twe\tcall\tthem unrecoverable\terrors\tor\tbugs.\tEventually,\tyour\tapplication\twill\tdie\tdue\tto a\tbadly\thandled\terror.\tIn\tlanguages\tsuch\tas\tJava,\tan\texception\tis\tnot\ta huge\tdeal:\tthe\tthread\tdies,\tbut\tthe\tapplication\tcontinues\tworking.\n\nIn\tNode.js,\tit\tis\ta\tbig\tproblem.\tThis\tproblem\twas\tsolved\tin\tthe\tfirst instance\tusing\ttask\trunners\tsuch\tas\tforever.\n\nBoth\tof\tthem\tare\ttask\trunners\tthat,\twhen\tyour\tapplication\texits\tfor\tsome reason,\trerun\tit\tagain\tso\tit\tensures\tthe\tuptime.\n\nConsider\tthe\tfollowing\texample:",
      "content_length": 1509,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 86,
      "content": "The\thelloWorld.js\tapplication\tis\tnow\thandled\tby\tforever,\twhich\twill\trerun it\tif\tthe\tapplication\tdies.\tLet's\tkill\tit,\tas\tshown\tin\tthe\tfollowing\timage:\n\nAs\tyou\tcan\tsee,\tforever\thas\tspawned\ta\tdifferent\tprocess\twith\tthe\t4903 PID.\tNow,\twe\tissue\ta\tkill\tcommand\t(kill\t-9\t4093)\tand\tthat\tis\tthe\toutput from\tforever,\tas\tfollows:\n\nAlthough\twe\thave\tkilled\tit,\tour\tapplication\twas\trespawned\tby\tforever without\tany\tdowntime\t(at\tleast,\tnoticeable\tdowntime).\n\nAs\tyou\tcan\tsee,\tforever\tis\tpretty\tbasic:\tit\treruns\tthe\tapplication\tas\tmany times\tas\tit\tgets\tkilled.\n\nThere\tis\tanother\tpackage\tcalled\tnodemon,\twhich\tis\tone\tof\tthe\tmost useful\ttools\tfor\tdeveloping\tNode.js\tapplications.\tIt\treloads\tthe\tapplication if\tit\tdetects\tchanges\tin\tthe\tfiles\tthat\tit\tmonitors\t(by\tdefault,\t.):\n\nNow,\tif\twe\tmodify\tthe\thelloWorld.js\tfile,\twe\tcan\tsee\thow\tnodemon reloads\tthe\tapplication.\tThis\tis\tvery\tinteresting\tin\torder\tto\tavoid\tthe edit/reload\tcycle\tand\tspeed\tup\tthe\tdevelopment.",
      "content_length": 942,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 87,
      "content": "Using\tPM2\t–\tthe\tindustry-standard\ttask runner\n\nAlthough,\tforever\tlooks\tvery\tinteresting,\tPM2\tis\ta\tmore\tadvanced\ttask runner\tthan\tforever.\tWith\tPM2,\tyou\tcan\tcompletely\tmanage\tyour application\tlife\tcycle\twithout\tany\tdowntime,\tas\twell\tas\tscale\tyour application\tup\tor\tdown\twith\ta\tsimple\tcommand.\n\nPM2\talso\tacts\tas\ta\tload\tbalancer.\n\nLet's\tconsider\tthe\tfollowing\texample:\n\nvar\thttp\t=\trequire('http');\n\nvar\tserver\t=\thttp.createServer(function\t(request,\t response)\t{ \t\tconsole.log('called!'); \t\tresponse.writeHead(200,\t{\"Content-Type\":\t \"text/plain\"}); \t\tresponse.end(\"Hello\tWorld\\n\"); }); server.listen(8000); console.log(\"Server\trunning\tat\t http://127.0.0.1:8000/\");\n\nThis\tis\ta\tfairly\tsimple\tapplication.\tLet's\trun\tit\tusing\tPM2:\n\npm2\tstart\thelloWorld.js\n\nThis\tproduces\tan\toutput\tsimilar\tto\tthe\tfollowing\timage:\n\nPM2\thas\tregistered\tan\tapp\tnamed\thelloWorld.\tThis\tapp\tis\trunning\tin\tthe fork\tmode\t(that\tmeans,\tPM2\tis\tnot\tacting\tas\ta\tload\tbalancer,\tit\thas\tjust",
      "content_length": 949,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 88,
      "content": "forked\tthe\tapp)\tand\tthe\tPID\tof\tthe\toperating\tsystem\tis\t6858.\n\nNow,\tas\tthe\tfollowing\tscreen\tsuggests,\twe\twill\trun\tpm2\tshow\t0,\twhich shows\tthe\tinformation\trelevant\tto\tthe\tapp\twith\tid\t0,\tas\tshown\tin\tthe following\timage:\n\nWith\ttwo\tcommands,\twe\thave\tmanaged\tto\trun\ta\tsimple\tapplication\tin\ta very\tsophisticated\tway.\n\nFrom\tnow\ton,\tPM2\twill\tensure\tthat\tyour\tapp\tis\talways\trunning\tso\tthat\tif your\tapplication\tdies,\tPM2\twill\trestart\tit\tagain.\n\nWe\tcan\talso\tmonitor\tthe\tnumber\tof\tapps\tPM2\tis\trunning:\n\npm2\tmonit\n\nThis\tshows\tthe\tfollowing\toutput:",
      "content_length": 533,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 89,
      "content": "This\tis\tthe\tPM2\tmonitor.\tIn\tthis\tcase,\tit\tis\ta\tcomplete\toverkill\tas\tour system\tis\tonly\tcomposed\tof\tone\tapplication,\twhich\truns\tin\tthe\tfork\tmode.\n\nWe\tcan\talso\tsee\tthe\tlogs\texecuting\tpm2\tlogs\tas\tshown\tin\tthe\tfollowing image:\n\nAs\tyou\tcan\tsee,\tPM2\tfeels\tsolid.\tWith\tfew\tcommands,\twe\thave\tcovered 90%\tof\tthe\tmonitoring\tnecessities\tof\tour\tapplication.\tHowever,\tthis\tis\tnot everything.\n\nPM2\talso\tcomes\twith\tan\teasy\tway\tto\treload\tyour\tapplications\twithout",
      "content_length": 447,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 90,
      "content": "downtime:\n\npm2\treload\tall\n\nThis\tcommand\tensures\tthat\tyour\tapps\tare\trestarted\twith\tzero\tdowntime. PM2\twill\tqueue\tthe\tincoming\trequests\tfor\tyou\tand\treprocess\tthem\tonce your\tapp\tis\tresponsive\tagain.\tThere\tis\ta\tmore\tfine-grained\toption\twhere you\tcan\tspecify\treloading\tonly\tcertain\tapps\tby\tspecifying\tthe\tapp\tname:\n\npm2\treload\thelloWorld\n\nFor\tthose\twho\thave\tbeen\tfighting\tfor\tyears\twith\tApache,\tNGINX,\tPHP- FPM,\tand\tso\ton,\tthis\twill\tsound\tvery\tfamiliar.\n\nAnother\tinteresting\tfeature\tin\tPM2\tis\trunning\tyour\tapplication\tin\tthe cluster\tmode.\tIn\tthis\tmode,\tPM2\tspawns\ta\tcontroller\tprocess\tand\tas many\tworkers\t(your\tapp)\tas\tyou\tspecify\tso\tthat\tyou\tcan\ttake\tthe\tbenefit of\tmulticore\tCPUs\twith\ta\tsingle-thread\ttechnology\tsuch\tas\tNode.js.\n\nBefore\tdoing\tthis,\twe\tneed\tto\tstop\tour\trunning\tapplication:\n\npm2\tstop\tall\n\nThis\twill\tresult\tin\tthe\tfollowing\toutput:\n\nPM2\tremembers\tthe\tapps\tthat\twere\trunning,\tso\tbefore\trerunning\tthe\tapp in\tthe\tcluster\tmode,\twe\tneed\tto\tinform\tPM2\tto\tforget\tabout\tyour\tapp,\tas follows:\n\npm2\tdelete\tall",
      "content_length": 1011,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 91,
      "content": "We\tare\tready\tto\trun\tour\tapp\tin\tthe\tcluster\tmode:\n\npm2\tstart\thelloWorld.js\t-i\t3\n\nPM2\tis\tacting\tas\ta\tround-robin\tbetween\tthe\tmain\tprocess\tand\tthe\tthree workers\tso\tthat\tthey\tcan\tcope\twith\tthree\trequests\tat\tthe\tsame\ttime.\tWe can\talso\tscale\tdown\tor\tup\tour\tnumber\tof\tworkers:\n\npm2\tscale\thelloWorld\t2\n\nThis\twill\tresult\tin\ttwo\tprocesses\tbeing\trun\tfor\tthe\tsame\tapp\tinstead\tof three:\n\nAs\tyou\tcan\tsee,\twith\tvery\tlittle\teffort,\twe\thave\tmanaged\tto\tconfigure\tour app\tin\torder\tto\tbe\tproduction\tready.\n\nNow,\twe\tcan\tsave\tthe\tstatus\tof\tPM2\tso\tthat\tif\twe\trestart\tthe\tserver,\tand",
      "content_length": 559,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 92,
      "content": "PM2\tis\trunning\tas\ta\tdaemon,\tthe\tapps\twill\tautomatically\tstart.\n\nPM2\thas\ta\tcode\tAPI\tso\tthat\twe\tcan\twrite\ta\tNode.js\tprogram\tto\tmanage all\tthe\tsteps\tthat\twe\thave\tbeen\tmanually\tdoing.\tIt\talso\thas\ta\tway\tof configuring\tyour\tservices\twith\ta\tJSON\tfile.\tWe\twill\tdiscuss\tthis\tin\tmore depth\tin\tChapter\t6,\tTesting\tand\tDocumenting\tNode.js\tMicroservices, when\twe\tstudy\thow\tto\tuse\tPM2\tand\tDocker\tto\tdeploy\tNode.js applications.",
      "content_length": 412,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 93,
      "content": "Summary\n\nIn\tthis\tchapter,\tyou\tlearned\tthe\tbasics\tof\tSeneca\tand\tPM2\tso\tthat\twe\twill be\table\tto\tbuild\tand\trun\ta\tmicroservices-oriented\tsystem\tin\tChapter\t4, Writing\tYour\tFirst\tMicroservice\tin\tNode.js,\tof\tthis\tbook.\n\nWe\thave\talso\tdemonstrated\tthat\ta\tfew\tof\tthe\tconcepts\texposed\tin\tthe previous\tchapter\tare\tactually\thelpful\tin\tsolving\treal-world\tproblems\tas well\tas\tmaking\tour\tlife\tvery\teasy.\n\nIn\tthe\tnext\tchapter,\twe\twill\ttalk\tabout\thow\tto\tsplit\ta\tmonolithic application,\ta\ttask\tfor\twhich\twe\twill\tneed\tto\tknow\ta\tfew\tof\tthe\tconcepts developed\tduring\tthis\tchapter.",
      "content_length": 558,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 94,
      "content": "Chapter\t3.\tFrom\tthe\tMonolith\tto Microservices\n\nIn\tmy\tprofessional\tlife,\tI\thave\tworked\tin\tquite\ta\tfew\tdifferent\tcompanies, mainly\tin\tfinancial\tservices,\tand\tall\tof\tthe\tcompanies\tthat\tI\thave\tworked for\tfollow\tthe\tsame\tpattern\tas\tshown\tin\tthe\tfollowing:\n\n1.\t A\tcompany\tis\tset\tup\tby\ta\tcouple\tof\tpeople\twith\tgood\tdomain knowledge:\tinsurance,\tpayments,\tcredit\tcards,\tand\tso\ton.\n\n2.\t The\tcompany\tgrows,\tdemanding\tnew\tbusiness\trequirements\tthat need\tto\tbe\tsatisfied\tquickly\t(regulation,\tbig\tcustomers\tdemanding silly\tthings,\tand\tso\ton),\twhich\tare\tbuilt\tin\ta\thurry\twith\tlittle\tto\tno planning.\n\n3.\t The\tcompany\texperiences\tanother\tphase\tof\tgrowing,\twhere\tthe business\ttransactions\tare\tclearly\tdefined\tand\tpoorly\tmodelled\tby\ta hard-to-maintain\tmonolithic\tsoftware.\n\n4.\t The\tcompany\tincreases\tthe\theadcount\tthat\tdrives\tinto\tgrowing\tpains and\tloss\tof\tefficiency\tdue\tto\trestrictions\timposed\ton\thow\tthe software\twas\tbuilt\tin\tthe\tfirst\tinstance.\n\nThis\tchapter\tis\tnot\tonly\tabout\thow\tto\tavoid\tthe\tprevious\tflow (uncontrolled\torganic\tgrowth),\tbut\tit\tis\talso\tabout\thow\tto\tmodel\ta\tnew system\tusing\tmicroservices.\tThis\tchapter\tis\tthe\tsoul\tof\tthis\tbook,\tas\tI\twill try\tto\tsynthetize\tmy\texperience\tin\ta\tfew\tpages,\tsetting\tup\tthe\tprinciples to\tbe\tfollowed\tin\tChapter\t4,\tWriting\tYour\tFirst\tMicroservice\tin\tNode.js, where\twe\twill\tbe\tbuilding\ta\tfull\tsystem\tbased\ton\tmicroservices\tusing\tthe lessons\tlearned\tin\tthe\tprevious\tchapters.\n\nFirst,\tthere\twas\tthe\tmonolith\n\nA\thuge\tpercentage\t(my\testimate\tis\taround\t90%)\tof\tthe\tmodern enterprise\tsoftware\tis\tbuilt\tfollowing\ta\tmonolithic\tapproach.\n\nLarge\tsoftware\tcomponents\tthat\trun\tin\ta\tsingle\tcontainer\tand\thave\ta well-defined\tdevelopment\tlife\tcycle,\twhich\tgoes\tcompletely\tagainst\tthe agile\tprinciples,\tdeliver\tearly\tand\tdeliver\toften",
      "content_length": 1746,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 95,
      "content": "(https://en.wikipedia.org/wiki/Release_early,_release_often),\tas\tfollows:\n\nDeliver\tearly:\tThe\tsooner\tyou\tfail,\tthe\teasier\tit\tis\tto\trecover.\tIf\tyou are\tworking\tfor\ttwo\tyears\ton\ta\tsoftware\tcomponent\tand\tthen\tit\tis released,\tthere\tis\ta\thuge\trisk\tof\tdeviation\tfrom\tthe\toriginal requirements,\twhich\tare\tusually\twrong\tand\tchange\tevery\tfew\tdays. Deliver\toften:\tDelivering\toften,\tthe\tstakeholders\tare\taware\tof\tthe progress\tand\tcan\tsee\tthe\tchanges\treflected\tquickly\tin\tthe\tsoftware. Errors\tcan\tbe\tfixed\tin\ta\tfew\tdays\tand\timprovements\tare\tidentified easily.\n\nCompanies\tbuild\tbig\tsoftware\tcomponents\tinstead\tof\tsmaller\tones\tthat work\ttogether\tas\tit\tis\tthe\tnatural\tthing\tto\tdo,\tas\tshown\tin\tthe\tfollowing:\n\n1.\t The\tdeveloper\thas\ta\tnew\trequirement. 2.\t He\tbuilds\ta\tnew\tmethod\ton\tan\texisting\tclass\ton\tthe\tservice\tlayer. 3.\t The\tmethod\tis\texposed\ton\tthe\tAPI\tvia\tHTTP,\tSOAP,\tor\tany\tother protocol.\n\nNow,\tmultiply\tit\tby\tthe\tnumber\tof\tdevelopers\tin\tyour\tcompany,\tand\tyou will\tobtain\tsomething\tcalled\torganic\tgrowth.\tOrganic\tgrowth\tis\ta\ttype\tof uncontrolled\tand\tunplanned\tgrowth\ton\tsoftware\tsystems\tunder\tbusiness pressure\twithout\tan\tadequate\tlong-term\tplanning,\tand\tit\tis\tbad.\n\nHow\tto\ttackle\torganic\tgrowth?\n\nThe\tfirst\tthing\trequired\tto\ttackle\torganic\tgrowth\tis\tto\tmake\tsure\tthat\tthe business\tand\tIT\tare\taligned\tin\tthe\tcompany.\tUsually,\tin\tbig\tcompanies,\tIT is\tnot\tseen\tas\ta\tcore\tpart\tof\tthe\tbusiness.\n\nOrganizations\toutsource\ttheir\tIT\tsystems,\tkeeping\tthe\tprice\tin\tmind,\tbut not\tthe\tquality\tso\tthat\tthe\tpartners\tbuilding\tthese\tsoftware\tcomponents are\tfocused\ton\tone\tthing:\tdeliver\ton\ttime\tand\taccording\tto\tthe specifications\teven\tif\tthey\tare\tincorrect.\n\nThis\tproduces\ta\tless-than-ideal\tecosystem\tto\trespond\tto\tthe\tbusiness needs\twith\ta\tworking\tsolution\tfor\tan\texisting\tproblem.\tIT\tis\tlead\tby people\twho\tbarely\tunderstand\thow\tthe\tsystems\tare\tbuilt,\tand\tusually overlook\tthe\tcomplexity\tof\tsoftware\tdevelopment.",
      "content_length": 1890,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 96,
      "content": "Fortunately,\tthis\tis\ta\tchanging\ttendency\tas\tIT\tsystems\tbecome\tthe\tdriver of\t99%\tof\tthe\tbusinesses\taround\tthe\tworld,\tbut\twe\tneed\tto\tget\tsmarter about\thow\twe\tbuild\tthem.\n\nThe\tfirst\tmeasure\tto\ttackle\torganic\tgrowth\tis\taligning\tIT\tand\tbusiness stakeholders\tto\twork\ttogether:\teducating\tthe\tnontechnical\tstakeholders\tis the\tkey\tto\tsuccess.\n\nIf\twe\tgo\tback\tto\tthe\tfew\tbig\treleases\tschema.\tCan\twe\tdo\tit\tbetter?\n\nOf\tcourse\twe\tcan.\tDivide\tthe\twork\tinto\tmanageable\tsoftware\tartifacts that\tmodel\ta\tsingle,\twell-defined\tbusiness\tactivity\tand\tgive\tit\tan\tentity.\n\nIt\tdoes\tnot\tneed\tto\tbe\ta\tmicroservice\tat\tthis\tstage,\tbut\tkeeping\tthe\tlogic inside\tof\ta\tseparated,\twell-defined,\teasily\ttestable,\tand\tdecoupled module\twill\tgive\tus\ta\thuge\tadvantage\tfor\tfuture\tchanges\tin\tthe application.\n\nLet's\tconsider\tthe\tfollowing\texample:",
      "content_length": 805,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 97,
      "content": "In\tthis\tinsurance\tsystem,\tyou\tcan\tsee\tthat\tsomeone\twas\tin\ta\thurry.\tSMS and\te-mail\tsender,\talthough\tboth\tare\tcommunication\tchannels,\tthey\thave a\tvery\tdifferent\tnature\tand\tyou\tprobably\twant\tthem\tto\tact\tin\tdifferent ways.\n\nThe\tcalling\tservices\tare\tgrouped\tinto\tthe\tfollowing\ttwo\thigh-level\tentities:\n\nNew\tBusiness:\tThe\tnew\tcustomers\tthat\treceive\tan\te-mail\twhen they\tsign\tup Renewals:\tThe\texisting\tcustomers\tthat\treceive\tan\tSMS\twhen\tthe insurance\tpolicy\tis\tready\tto\tbe\trenewed\n\nAt\tsome\tpoint,\tthe\tsystem\tneeded\tto\tsend\tSMSs\tand\te-mails\tand someone\tcreated\tthe\tcommunication\tservice\tentity\tthat\thandles\tall\tthe third-party\tcommunications.\n\nIt\tlooks\tlike\ta\tgood\tidea\tin\tthe\tbeginning.\tSMS\tor\te-mail,\tat\tthe\tend\tof\tthe day,\tis\tonly\ta\tchannel,\tthe\tcommunication\tmechanism\twill\tbe\t90%\tsame and\twe\tcan\treuse\tplenty\tof\tfunctionality.\n\nWhat\thappens\tif\twe\tsuddenly\twant\tto\tintegrate\ta\tthird-party\tservice\tthat handles\tall\tthe\tphysical\tpost?\n\nWhat\thappens\tif\twe\twant\tto\tadd\ta\tnewsletter\tthat\tgoes\tout\tto\tthe customers\tonce\ta\tweek\twith\tinformation\tthat\twe\tconsider\tinteresting\tfor our\tcustomers?\n\nThe\tservice\twill\tgrow\tout\tof\tcontrol\tand\tit\twill\tbecome\tmore\tdifficult\tto test,\trelease,\tand\tensure\tthat\tthe\tchanges\tin\tthe\tSMS\tcode\twon't\taffect sending\tthe\te-mail\tin\tany\tform.\n\nThis\tis\torganic\tgrowth\tand,\tin\tthis\tcase,\tit\tis\trelated\tto\ta\tlaw\tcalled Conway's\tLaw,\twhich\tstates\tthe\tfollowing:\n\nAny\torganization\tthat\tdesigns\ta\tsystem\t(defined\tmore\tbroadly\there\tthan just\tinformation\tsystems)\twill\tinevitably\tproduce\ta\tdesign\twhose\tstructure is\ta\tcopy\tof\tthe\torganization's\tcommunication\tstructure.",
      "content_length": 1578,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 98,
      "content": "In\tthis\tcase,\twe\tare\tfalling\tinto\ta\ttrap.\tWe\tare\ttrying\tto\tmodel\tthe communication\ton\ta\tsingle\tsoftware\tcomponent\tthat\tis\tprobably\ttoo\tbig and\tcomplex\tto\treact\tquickly\tto\tnew\tbusiness\tneeds.\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\tdiagram:\n\nNow,\twe\thave\tencapsulated\tevery\tcommunication\tchannel\ton\tits\town service\t(which,\tlater\ton,\twill\tbe\tdeployed\tas\ta\tmicroservice)\tand\twe\twill do\tthe\tsame\tfor\tfuture\tcommunication\tchannels.\n\nThis\tis\tthe\tfirst\tstep\tto\tbeat\torganic\tgrowth:\tcreate\tfine-grained\tservices with\twell-defined\tboundaries\tand\ta\tsingle\tresponsibility—do\tsomething small,\tbut\tdo\tit\twell.\n\nHow\tabstract\tis\ttoo\tabstract?\n\nOur\tbrain\tcan't\thandle\tcomplicated\tmechanisms.\tThe\tabstraction capacity\tis\tone\tof\tthe\tmost\trecent\thuman\tintelligence\tacquisitions.",
      "content_length": 755,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 99,
      "content": "In\tthe\texample\tfrom\tthe\tprevious\tsection,\tI've\tgiven\tsomething\tfor\tgood, which\twill\tupset\thalf\tof\tthe\tprogrammers\tin\tthe\tworld:\teradicating\tthe abstraction\tof\tour\tsystem.\n\nThe\tabstraction\tcapacity\tis\tsomething\tthat\twe\tlearn\talong\tthe\tyears\tand, unlike\tintelligence,\tit\tcan\tbe\ttrained.\tNot\teveryone\tcan\treach\tthe\tsame level\tof\tabstraction,\tand\tif\twe\tmix\tthe\tspecific\tand\tcomplex\tdomain knowledge\trequired\tby\tsome\tindustries\twith\ta\thigh-level\tof\tabstraction, we\thave\tthe\tperfect\trecipe\tfor\ta\tdisaster.\n\nWhen\tbuilding\tsoftware,\tone\tof\tthe\tgolden\trules\tthat\tI\talways\ttried\tto follow\t(and\ttry\tis\tthe\tcorrect\tword,\tas\tI\talways\tfind\thuge\topposition\tto\tit) is\tto\tavoid\tpremature\tabstraction.\n\nHow\tmany\ttimes\tdid\tyou\tfind\tyourself\tin\ta\tcorner\twith\ta\tsimple\tset\tof requirements:\tbuild\ta\tprogram\tto\tsolve\tX.\tHowever,\tyour\tteam\tgoes\toff and\tanticipates\tall\tthe\tpossible\tvariations\tof\tX,\twithout\teven\tknowing\tif they\tare\tplausible.\tThen,\tonce\tthe\tsoftware\tis\tin\tproduction,\tone\tof\tthe stakeholders\tcomes\twith\ta\tvariation\tof\tX\tthat\tyou\tcould\thave\tnever imagined\t(as\tthe\trequirements\twere\tnot\teven\tcorrect)\tand\tnow,\tgetting this\tvariation\tto\twork\twill\tcost\tyou\ta\tfew\tdays\tand\ta\tmassive\trefactor.\n\nThe\tway\tto\tavoid\tthis\tproblem\tis\tsimple:\tavoid\tabstraction\twithout\tat\tleast three\tuse\tcases.\n\nDo\tnot\tfactor\tin\tthe\tpossibility\tof\tsending\tthe\tdata\tthrough\tdifferent\ttypes of\tchannels\tas\tit\tmight\tnot\thappen\tand\tyou\tare\tcompromising\tthe\tcurrent feature\twith\tunnecessary\tabstractions.\tOnce\tyou\thave\tat\tleast\tone\tother communication\tchannel,\tit\tis\ttime\tto\tstart\tthinking\tabout\thow\tthese\ttwo software\tcomponents\tcan\tbe\tdesigned\tbetter,\tand\twhen\tthe\tthird\tuse case\tshows\tup,\trefactor.\n\nRemember\tthat\twhen\tbuilding\tmicroservices,\tthey\tshould\tbe\tsmall enough\tto\tbe\trewritten\ton\ta\tsingle\tsprint\t(around\ttwo\tweeks),\tso\tthe benefits\tof\thaving\ta\tworking\tprototype\tin\tsuch\ta\tshort\tperiod\tof\ttime\tis worth\tthe\trisk\tof\thaving\tto\trewrite\tit\tonce\tthe\trequirements\tare\tmore concrete:\tsomething\tto\tshow\tto\tthe\tstakeholders\tis\tthe\tquickest\tway\tto nail\tdown\tthe\trequirements.\n\nSeneca\tis\tgreat\tin\tthis\tregard\tas,\tthrough\tpattern\tmatching,\twe\tcan",
      "content_length": 2105,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 100,
      "content": "extend\tthe\tAPI\tof\ta\tgiven\tmicroservice\twithout\taffecting\tthe\texisting calling\tcode:\tour\tservice\tis\topen\tfor\textension,\tbut\tclosed\tfor\tmodification (the\tSOLID\tprinciples)\tas\twe\tare\tadding\tfunctionality\twithout\taffecting\tthe existing\tone.\tWe\twill\tsee\tmore\tcomplete\texamples\tof\tthis\tbehavior\tin Chapter\t4,\tWriting\tYour\tFirst\tMicroservice\tin\tNode.js.",
      "content_length": 346,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 101,
      "content": "Then\tthe\tmicroservices\tappeared\n\nMicroservices\tare\there\tto\tstay.\tNowadays,\tthe\tcompanies\tgive\tmore importance\tto\tthe\tquality\tof\tthe\tsoftware.\tAs\tstated\tin\tthe\tprevious section,\tdeliver\tearly\tand\tdeliver\toften\tare\tthe\tkey\tto\tsucceed\tin\tsoftware development.\n\nMicroservices\tare\thelping\tus\tto\tsatisfy\tbusiness\tneeds\tas\tquickly\tas possible\tthrough\tmodularity\tand\tspecialization.\tSmall\tpieces\tof\tsoftware that\tcan\teasily\tbe\tversioned\tand\tupgraded\twithin\ta\tfew\tdays\tand\tthey are\teasy\tto\ttest\tas\tthey\thave\ta\tclear\tand\tsmall\tpurpose\t(specialization) and\tare\twritten\tin\tsuch\ta\tway\tthat\tthey\tare\tisolated\tfrom\tthe\trest\tof\tthe system\t(modularization).\n\nUnfortunately,\tit\tis\tnot\tcommon\tto\tfind\tthe\tsituation\tas\tdescribed previously.\tUsually,\tbig\tsoftware\tsystems\tare\tnot\tbuilt\tin\ta\tway\tthat modularization\tor\tspecialization\tare\teasy\tto\tidentify.\tThe\tgeneral\trule\tis\tto build\ta\tbig\tsoftware\tcomponent\tthat\tdoes\teverything\tand\tthe modularization\tis\tpoor,\tso\twe\tneed\tto\tstart\tfrom\tthe\tvery\tbasics.\n\nLet's\tstart\tby\twriting\tsome\tcode,\tas\tshown\tin\tthe\tfollowing:\n\nmodule.exports\t=\tfunction(options)\t{\n\nvar\tinit\t=\t{}\n\n/** \t\t\t\tSends\tone\tSMS \t\t\t/ \t\tinit.sendSMS\t=\tfunction(destination,\tcontent)\t{ \t\t\t\t//\tCode\tto\tsend\tSMS \t\t}\n\n/** \t\t\t\tReads\tthe\tpending\tlist\tof\tSMS. \t\t\t/ \t\tinit.readPendingSMS\t=\tfunction()\t{ \t\t\t\t//\tcode\tto\treceive\tSMS \t\t\t\treturn\tlistOfSms; \t\t}\n\n/**",
      "content_length": 1343,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 102,
      "content": "Sends\tan\temail. \t\t\t/ \t\tinit.sendEmail\t=\tfunction(subject,\tcontent)\t{ \t\t\t\t//\tcode\tto\tsend\temails \t\t}\n\n/** \t\t\t\tGets\ta\tlist\tof\tpending\temails. \t\t\t/ \t\tinit.readPendingEmails\t=\tfunction()\t{ \t\t\t\t//\tcode\tto\tread\tthe\tpending\temails \t\t\t\treturn\tlistOfEmails; \t\t}\n\n/** \t\t\t\tThis\tcode\tmarks\tan\temail\tas\tread\tso\tit\tdoes\tnot\t get \t\t\t\tfetch\tagain\tby\tthe\treadPendingEmails\tfunction. \t\t\t/ \t\tinit.markEmailAsRead\t=\tfunction(messageId)\t{ \t\t\t\t//\tcode\tto\tmark\ta\tmessage\tas\tread. \t\t}\n\n/* \t\t\t\tThis\tfunction\tqueues\ta\tdocument\tto\tbe\tprinted\tand \t\t\t\tsent\tby\tpost. \t\t\t*/ \t\tinit.queuePost\t=\tfunction(document)\t{ \t\t\t\t//\tcode\tto\tqueue\tpost \t\t}\n\nreturn\tinit; }\n\nAs\tyou\tcan\tsee,\tthis\tmodule\tcan\tbe\teasily\tcalled\tcommunications service\tand\tit\twill\tbe\tfairly\teasy\tto\tguess\twhat\tit\tis\tdoing.\tIt\tmanages\tthe e-mail,\tSMS,\tand\tpost\tcommunications.\n\nThis\tis\tprobably\ttoo\tmuch.\tThis\tservice\tis\tdeemed\tto\tgrow\tout\tof\tcontrol, as\tpeople\twill\tkeep\tadding\tmethods\trelated\tto\tcommunications.\tThis\tis the\tkey\tproblem\tof\tmonolithic\tsoftware:\tthe\tbounded\tcontext\tspans across\tdifferent\tareas,\taffecting\tthe\tquality\tof\tour\tsoftware\tfrom\tboth functional\tand\tmaintenance\tpoint\tof\tview.\n\nIf\tyou\tare\ta\tsoftware\tdeveloper,\ta\tred\tflag\twill\tbe\traised\tstraightaway:\tthe cohesion\tof\tthis\tmodule\tis\tquite\tpoor.",
      "content_length": 1250,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 103,
      "content": "Although\tit\tcould\thave\tworked\tfor\ta\twhile,\twe\tare\tnow\tchanging\tour mindset.\tWe\tare\tbuilding\tsmall,\tscalable,\tand\tautonomous\tcomponents that\tcan\tbe\tisolated.\tThe\tcohesion\tin\tthis\tcase\tis\tbad\tas\tthe\tmodule\tis doing\ttoo\tmany\tdifferent\tthings:\te-mail,\tSMS,\tand\tpost.\n\nWhat\thappens\tif\twe\tadd\tanother\tcommunication\tchannel\tsuch\tas\tTwitter and\tFacebook\tnotifications?\n\nThe\tservice\tgrows\tout\tof\tcontrol.\tInstead\tof\thaving\tsmall\tfunctional software\tcomponents,\tyou\tend\tup\twith\ta\tgigantic\tmodule\tthat\twill\tbe difficult\tto\trefactor,\ttest,\tand\tmodify.\tLet's\ttake\ta\tlook\tat\tthe\tfollowing SOLID\tdesign\tprinciples,\texplained\tin\tChapter\t2,\tMicroservices\tin Node.js\t–\tSeneca\tand\tPM2\tAlternatives:\n\nSingle-responsibility\tprinciple:\tThe\tmodule\tdoes\ttoo\tmany\tthings. Open\tfor\textension,\tclosed\tfor\tmodification:\tThe\tmodule\twill need\tto\tbe\tmodified\tto\tadd\tnew\tfunctionalities\tand\tprobably\tchange the\tcommon\tcode. Liskov\tSubstitution:\tWe\twill\tskip\tthis\tone\tagain. Interface\tsegregation:\tWe\tdon't\thave\tany\tinterface\tspecified\tin\tthe module,\tjust\tthe\timplementation\tof\tan\tarbitrary\tset\tof\tfunctions. Dependency\tinjection:\tThere\tis\tno\tdependency\tinjection.\tThe module\tneeds\tto\tbe\tbuilt\tby\tthe\tcalling\tcode.\n\nThings\tget\tmore\tcomplicated\tif\twe\tdon't\thave\ttests.\n\nTherefore,\tlet's\tsplit\tit\tinto\tvarious\tsmall\tmodules\tusing\tSeneca.\n\nFirst,\tthe\te-mail\tmodule\t(email.js)\twill\tbe\tas\tfollows:\n\nmodule.exports\t=\tfunction\t(options)\t{\n\n/** \t\t\t\tSends\tan\temail. \t\t\t/ \t\tthis.add({channel:\t'email',\taction:\t'send'},\t function(msg,\trespond)\t{ \t\t\t\t//\tCode\tto\tsend\tan\temail. \t\t\t\trespond(null,\t{...}); \t\t});\n\n/**",
      "content_length": 1568,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 104,
      "content": "Gets\ta\tlist\tof\tpending\temails. \t\t\t/ \t\tthis.add({channel:\t'email',\taction:\t'pending'},\t function(msg,\trespond)\t{ \t\t\t\t//\tCode\tto\tread\tpending\temail. \t\t\t\trespond(null,\t{...}); \t\t});\n\n/** \t\t\t\tMarks\ta\tmessage\tas\tread. \t\t\t/ \t\tthis.add({channel:\t'email',\taction:\t'read'},\t function(msg,\trespond)\t{ \t\t\t\t//\tCode\tto\tmark\ta\tmessage\tas\tread. \t\t\t\trespond(null,\t{...}); \t\t}); }\n\nThe\tSMS\tmodule\t(sms.js)\twill\tbe\tas\tfollows:\n\nmodule.exports\t=\tfunction\t(options)\t{\n\n/** \t\t\t\tSends\tan\temail. \t\t\t/ \t\tthis.add({channel:\t'sms',\taction:\t'send'},\t function(msg,\trespond)\t{ \t\t\t\t//\tCode\tto\tsend\ta\tsms. \t\t\t\trespond(null,\t{...}); \t\t});\n\n/** \t\t\t\tReceives\tthe\tpending\tSMS. \t\t\t/ \t\tthis.add({channel:\t'sms',\taction:\t'pending'},\t function(msg,\trespond)\t{ \t\t\t\t//\tCode\tto\tread\tpending\tsms. \t\t\t\trespond(null,\t{...}); \t\t}); }\n\nFinally,\tthe\tpost\tmodule\t(post.js)\twill\tbe\tas\tfollows:\n\nmodule.exports\t=\tfunction\t(options)\t{\n\n/** \t\t\t\tQueues\ta\tpost\tmessage\tfor\tprinting\tand\tsending.",
      "content_length": 940,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 105,
      "content": "/ \t\tthis.add({channel:\t'post',\taction:\t'queue'},\t function(msg,\trespond)\t{ \t\t\t\t//\tCode\tto\tqueue\ta\tpost\tmessage. \t\t\t\trespond(null,\t{...}); \t\t}); }\n\nThe\tfollowing\tdiagram\tshows\tthe\tnew\tstructure\tof\tmodules:",
      "content_length": 204,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 106,
      "content": "Now,\twe\thave\tthree\tmodules.\tEach\tone\tof\tthese\tmodules\tdoes\tone specific\tthing\twithout\tinterfering\twith\teach\tother;\twe\thave\tcreated\thigh- cohesion\tmodules.",
      "content_length": 154,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 107,
      "content": "Let's\trun\tthe\tpreceding\tcode,\tas\tfollows:\n\nvar\tseneca\t=\trequire(\"seneca\")() \t\t\t\t\t\t.use(\"email\") \t\t\t\t\t\t.use(\"sms\") \t\t\t\t\t\t.use(\"post\");\n\nseneca.listen({port:\t1932,\thost:\t\"10.0.0.7\"});\n\nAs\tsimple\tas\tthat,\twe\thave\tcreated\ta\tserver\twith\tthe\tIP\t10.0.0.7\tbound that\tlistens\ton\tthe\t1932\tport\tfor\tincoming\trequests.\tAs\tyou\tcan\tsee,\twe haven't\treferenced\tany\tfile,\twe\tjust\treferenced\tthe\tmodule\tby\tname; Seneca\twill\tdo\tthe\trest.\n\nLet's\trun\tit\tand\tverify\tthat\tSeneca\thas\tloaded\tthe\tplugins:\n\nnode\tindex.js\t--seneca.log.all\t|\tgrep\tDEFINE\n\nThis\tcommand\twill\toutput\tsomething\tsimilar\tto\tthe\tfollowing\tlines:\n\nIf\tyou\tremember\tfrom\tChapter\t2,\tMicroservices\tin\tNode.js\t–\tSeneca\tand PM2\tAlternatives,\tSeneca\tloads\ta\tfew\tplugins\tby\tdefault:\tbasic, transport,\tweb,\tand\tmem-store,\twhich\tallow\tSeneca\tto\twork\tout\tof\tthe\tbox without\tbeing\thassled\twith\tthe\tconfiguration.\tObviously,\tas\twe\twill\tsee\tin Chapter\t4,\tWriting\tYour\tFirst\tMicroservice\tin\tNode.js,\tthat\tthe configuration\tis\tnecessary\tas,\tfor\texample,\tmem-store\twill\tonly\tstore\tdata in\tthe\tmemory\twithout\tpersisting\tit\tbetween\texecutions.\n\nAside\tfrom\tthe\tstandard\tplugins,\twe\tcan\tsee\tthat\tSeneca\thas\tloaded three\textra\tplugins:\temail,\tsms,\tand\tpost,\twhich\tare\tthe\tplugins\tthat\twe have\tcreated.\n\nAs\tyou\tcan\tsee,\tthe\tservices\twritten\tin\tSeneca\tare\tquite\teasy\tto understand\tonce\tyou\tknow\thow\tthe\tframework\tworks.\tIn\tthis\tcase,\tI\thave",
      "content_length": 1363,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 108,
      "content": "written\tthe\tcode\tin\tthe\tform\tof\ta\tplugin\tso\tthat\tit\tcan\tbe\tused\tby\tdifferent instances\tof\tSeneca\ton\tdifferent\tmachines,\tas\tSeneca\thas\ta\ttransparent transport\tmechanism\tthat\tallows\tus\tto\tquickly\tredeploy\tand\tscale\tparts\tof our\tmonolithic\tapp\tas\tmicroservices,\tas\tfollows:\n\nThe\tnew\tversion\tcan\tbe\teasily\ttested,\tas\tchanges\ton\tthe\te-mail functionality\twill\tonly\taffect\tsending\tthe\te-mail. It\tis\teasy\tto\tscale.\tAs\twe\twill\tsee\tin\tthe\tnext\tchapter,\treplicating\ta service\tis\tas\teasy\tas\tconfiguring\ta\tnew\tserver\tand\tpointing\tour Seneca\tclient\tto\tit. It\tis\talso\teasy\tto\tmaintain,\tas\tthe\tsoftware\tis\teasier\tto\tunderstand and\tmodify.\n\nDisadvantages\n\nWith\tmicroservices,\twe\tsolve\tthe\tbiggest\tproblems\tin\tmodern\tenterprise, but\tthat\tdoes\tnot\tmean\tthat\tthey\tare\tproblem\tfree.\tMicroservices\toften lead\tto\tdifferent\ttypes\tof\tproblems\tthat\tare\tnot\teasy\tto\tforesee.\n\nThe\tfirst\tand\tmost\tconcerning\tone\tis\tthe\toperational\toverhead\tthat\tcould chew\tup\tthe\tbenefits\tobtained\tfrom\tusing\tmicroservices.\tWhen\tyou\tare designing\ta\tsystem,\tyou\tshould\talways\thave\tone\tquestion\tin\tmind:\thow to\tautomate\tthis?\tAutomation\tis\tthe\tkey\tto\ttackling\tthis\tproblem.\n\nThe\tsecond\tdisadvantage\twith\tmicroservices\tis\tnonuniformity\ton\tthe applications.\tA\tteam\tmight\tconsider\tsomething\ta\tgood\tpractice\tthat\tcould be\tbanned\tin\tanother\tteam\t(especially\taround\texception\thandling),\twhich adds\tan\textra\tlayer\tof\tisolation\tbetween\tteams\tthat\tprobably\tdoes\tnot\tdo well\tfor\tthe\tcommunication\tof\tyour\tengineers\twithin\tthe\tteam.\n\nLastly,\tbut\tnot\tless\timportant,\tmicroservices\tintroduce\ta\tbigger communication\tcomplexity\tthat\tcould\tlead\tto\tsecurity\tproblems.\tInstead of\thaving\tto\tcontrol\ta\tsingle\tapplication\tand\tits\tcommunication\twith\tthe outer\tworld,\twe\tare\tnow\tfacing\ta\tnumber\tof\tservers\tthat\tcommunicate with\teach\tother.\n\nSplitting\tthe\tmonolith",
      "content_length": 1792,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 109,
      "content": "Consider\tthat\tthe\tmarketing\tdepartment\tof\tyour\tcompany\thas\tdecided\tto run\tan\taggressive\te-mail\tcampaign\tthat\tis\tgoing\tto\trequire\tpeaks\tof capacity\tthat\tcould\tharm\tthe\tnormal\tday-to-day\tprocess\tof\tsending\te- mail.\tUnder\tstress,\tthe\te-mails\twill\tbe\tdelayed\tand\tthat\tcould\tcause\tus problems.\n\nLuckily,\twe\thave\tbuilt\tour\tsystem\tas\texplained\tin\tthe\tprevious\tsection. Small\tSeneca\tmodules\tin\tthe\tform\tof\ta\thigh-cohesion\tand\tlow-coupled plugins.\n\nThen,\tthe\tsolution\tto\tachieve\tit\tis\tsimple:\tdeploy\tthe\te-mail\tservice (email.js)\ton\tmore\tthan\tone\tmachine:\n\nvar\tseneca\t=\trequire(\"seneca\")().use(\"email\"); seneca.listen({port:\t1932,\thost:\t\"new-email-service- ip\"});\n\nAlso,\tcreate\ta\tSeneca\tclient\tpointing\tto\tit,\tas\tfollows:\n\nvar\tseneca\t=\trequire(\"seneca\")() \t\t\t\t\t\t.use(\"email\") \t\t\t\t\t\t.use(\"sms\") \t\t\t\t\t\t.use(\"post\"); seneca.listen({port:\t1932,\thost:\t\"10.0.0.7\"});\n\n//\tinteract\twith\tthe\texisting\temail\tservice\tusing\t \"seneca\"\n\nvar\tsenecaEmail\t=\trequire(\"seneca\").client({host:\t \"new-email-service-ip\",\tport:\t1932});\n\n//\tinteract\twith\tthe\tnew\temail\tservice\tusing\t \"senecaEmail\"\n\nFrom\tnow\ton,\tthe\tsenecaEmail\tvariable\twill\tcontact\tthe\tremote\tservice when\tcalling\tact\tand\twe\twould\thave\tachieved\tour\tgoal:\tscale\tup\tour\tfirst microservice.\n\nProblems\tsplitting\tthe\tmonolith\t–\tit\tis\tall about\tthe\tdata",
      "content_length": 1281,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 110,
      "content": "Data\tstorage\tcould\tbe\tproblematic.\tIf\tyour\tapplication\thas\tgrown\tout\tof control\tfor\ta\tnumber\tof\tyears,\tthe\tdatabase\twould\thave\tdone\tthe\tsame, and\tby\tnow,\tthe\torganic\tgrowth\twill\tmake\tit\thard\tto\tdeal\twith\tsignificant changes\tin\tthe\tdatabase.\n\nMicroservices\tshould\tlook\tafter\ttheir\town\tdata.\tKeeping\tthe\tdata\tlocal\tto the\tservice\tis\tone\tof\tthe\tkeys\tto\tensure\tthat\tthe\tsystem\tremains\tflexible as\tit\tevolves,\tbut\tit\tmight\tnot\tbe\talways\tpossible.\tAs\tan\texample, financial\tservices\tsuffer\tespecially\tfrom\tone\tof\tthe\tmain\tweak\tpoints\tof microservices-oriented\tarchitectures:\tthe\tlack\tof\ttransactionality.\tWhen\ta software\tcomponent\tdeals\twith\tmoney,\tit\tneeds\tto\tensure\tthat\tthe\tdata remains\tconsistent\tand\tnot\teventually\tconsistent\tafter\tevery\tsingle operation.\tIf\ta\tcustomer\tdeposits\tmoney\tin\ta\tfinancial\tcompany,\tthe software\tthat\tholds\tthe\taccount\tbalance\tneeds\tto\tbe\tconsistent\twith\tthe money\theld\tin\tthe\tbank,\totherwise,\tthe\treconciliation\tof\tthe\taccounts\twill fail.\tNot\tonly\tthat,\tif\tyour\tcompany\tis\ta\tregulated\tentity,\tit\tcould\tcause serious\tproblems\tfor\tthe\tcontinuity\tof\tthe\tbusiness.\n\nThe\tgeneral\trule\tof\tthumb,\twhen\tworking\twith\tmicroservices\tand\tfinancial systems,\tis\tto\tkeep\ta\tnot-so-microservice\tthat\tdeals\twith\tall\tthe\tmoney and\tcreates\tmicroservices\tfor\tthe\tauxiliary\tmodules\tof\tthe\tsystem\tsuch as\temailing,\tSMS,\tuser\tregistration,\tand\tso\ton,\tas\tshown\tin\tthe\tfollowing image:\n\nAs\tyou\tcan\tsee\tin\tthe\tpreceding\tpicture,\tthe\tfact\tthat\tpayments\twill\tbe\ta big\tmicroservice\tinstead\tof\tsmaller\tservices,\tit\tonly\thas\timplications\tin",
      "content_length": 1532,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 111,
      "content": "the\toperational\tside,\tthere\tis\tnothing\tpreventing\tus\tfrom\tmodularizing\tthe application\tas\tseen\tbefore.\tThe\tfact\tthat\twithdrawing\tmoney\tfrom\tan ATM\thas\tto\tbe\tan\tatomic\toperation\t(either\tsucceed\tor\tfail\twithout intermediate\tstatus)\tshould\tnot\tdictate\thow\twe\torganize\tthe\tcode\tin\tour application,\tallowing\tus\tto\tmodularize\tthe\tservices,\tbut\tspanning\tthe transaction\tscope\tacross\tall\tof\tthem.",
      "content_length": 388,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 112,
      "content": "Organizational\talignment\n\nIn\ta\tcompany\twhere\tthe\tsoftware\tis\tbuilt\tbased\ton\tmicroservices,\tevery single\tstakeholder\tneeds\tto\tbe\tinvolved\tin\tdecision\tmaking.\n\nMicroservices\tare\ta\thuge\tparadigm\tshift.\tUsually,\tlarge\torganizations tend\tto\tbuild\tsoftware\tin\ta\tvery\told\tfashioned\tmanner.\tBig\treleases\tevery few\tmonths\tthat\trequire\tdays\tto\tcomplete\tthe\tquality\tassurance\t(QA) phase\tand\tfew\thours\tto\tdeploy.\n\nWhen\ta\tcompany\tchooses\tto\timplement\ta\tmicroservices-oriented architecture,\tthe\tmethodology\tchanges\tcompletely:\tsmall\tteams\twork\ton small\tfeatures\tthat\tare\tbuilt,\ttested,\tand\tdeployed\ton\ttheir\town.\tThe teams\tdo\tone\tthing\t(one\tmicroservice,\tor\tmore\trealistic,\ta\tfew\tof\tthem) and\tthey\tdo\tit\twell\t(they\tmaster\tthe\tdomain\tand\ttechnical\tknowledge required\tto\tbuild\tthe\tsoftware).\n\nThese\tare\twhat\tusually\tcalled\tcross-functional\tteams.\tA\tunit\tof\twork\tof few\tpeople\tthat\thave\tthe\trequired\tknowledge\tto\tbuild\thigh-quality software\tcomponents.\n\nIt\tis\talso\timportant\tto\tflag\tthat\tthe\tteam\thas\tto\tmaster\tthe\tdomain knowledge\tneeded\tto\tunderstand\tthe\tbusiness\trequirements.\n\nHere\tis\twhere\tthe\tmajority\tof\tthe\tcompanies\twhere\tI\thave\tworked\tin\tmy professional\tlife\tfail\t(in\tmy\topinion).\tDevelopers\tare\tconsidered\tbrick stackers\tthat\tmagically\tunderstand\tthe\tbusiness\tflows\twithout\tbeing exposed\tto\tthem\tbefore.\tIf\tone\tdeveloper\tdelivers\tX\tamount\tof\twork\tin one\tweek,\tten\tdevelopers\twill\tdeliver\t10X.\tThis\tis\twrong.\n\nPeople\tin\tcross-functional\tteams\tthat\tbuild\tthe\tmicroservices\thave\tto master\t(not\tonly\tknow)\tthe\tdomain-specific\tknowledge\tin\torder\tto\tbe efficient\tand\tfactor\tthe\tConway's\tLaw\tand\tits\timplications\tinto\tthe\tsystem for\tchanging\thow\tthe\tbusiness\tprocesses\twork.\n\nWhen\ttalking\tabout\torganizational\talignment\tin\tmicroservices,\tautonomy is\tthe\tkey.\tThe\tteams\tneed\tto\tbe\tautonomous\tin\torder\tto\tbe\tagile\twhile building\tthe\tmicroservices,\twhich\timplies\tkeeping\tthe\ttechnical\tauthority",
      "content_length": 1878,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 113,
      "content": "within\tthe\tteam,\tas\tfollows:\n\nLanguages\tused Code\tstandards Patterns\tused\tto\tsolve\tproblems Tools\tchosen\tto\tbuild,\ttest,\tdebug,\tand\tdeploy\tthe\tsoftware\n\nThis\tis\tan\timportant\tpart,\tas\tthis\tis\twhere\twe\tneed\tto\tdefine\thow\tthe company\tbuilds\tsoftware\tand\twhere\tthe\tengineering\tproblems\tmay\tbe introduced.\n\nAs\tan\texample,\twe\tcan\tlook\tinto\tthe\tcoding\tstandards,\tas\tshown\tin\tthe following\tlist:\n\nDo\twe\twant\tto\tkeep\tthe\tsame\tcoding\tstandards\tacross\tthe\tteams? Do\twe\twant\teach\tteam\tto\thave\ttheir\town\tcoding\tstandards?\n\nIn\tgeneral,\tI\tam\talways\tin\tfavor\tof\tthe\t80%\trule:\t80%\tof\tperfection\tis more\tthan\tenough\tfor\t100%\tof\tthe\tuse\tcases.\tIt\tmeans\tthat\tloosening\tup the\tcoding\tstandards\t(it\tcan\tbe\tapplied\tto\tother\tareas)\tand\tallowing\tsome level\tof\timperfection/personalization,\thelps\tto\treduce\tthe\tfriction\tbetween teams\tand\talso\tallows\tthe\tengineers\tto\tquickly\tcatch\tup\twith\tthe\tvery\tfew important\trules\tto\tfollow\tsuch\tas\tlogging\tstrategies\tor\texception\thandling.\n\nIf\tyour\tcoding\tstandards\tare\ttoo\tcomplicated,\tthere\twill\tbe\tfriction\twhen\ta team\ttries\tto\tpush\ta\tcode\tinto\ta\tmicroservice\tout\tof\ttheir\tusual\tscope (remember,\tteams\town\tthe\tservices,\tbut\tevery\tteam\tcan\tcontribute\tto them).",
      "content_length": 1174,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 114,
      "content": "Summary\n\nIn\tthis\tchapter,\twe\tdiscussed\tthe\tprinciples\tof\tbuilding\tmonolithic applications\toriented\tto\tbe\tsplit\tas\tmicroservices,\tdepending\ton\tthe business\tneeds.\tAs\tyou\thave\tlearned,\tthe\tAtomicity,\tConsistency, Isolation,\tDurability\t(ACID)\tdesign\tprinciples\tare\tconcepts\tthat\twe\tneed to\thave\tin\tmind\tin\torder\tto\tbuild\thigh\tquality\tsoftware.\n\nYou\thave\talso\tlearned\tthat\twe\tcannot\tassume\tthat\twe\tare\tgoing\tto\tbe able\tto\tdesign\ta\tsystem\tfrom\tscratch,\tso\twe\tneed\tto\tbe\tsmart\tabout\thow we\tbuild\tthe\tnew\tparts\tof\tthe\tsystem\tand\thow\twe\trefactor\tthe\texisting ones\tso\tthat\twe\tachieve\tthe\tlevel\tof\tflexibility\trequired\tto\tsatisfy\tthe business\tneeds\tand\tbe\tresilient.\n\nWe\talso\thave\tgiven\ta\tsmall\tintroduction\tabout\tmonolithic\tdesigned databases\tand\thow\tthey\tare\tthe\tbiggest\tpain\tpoints\twhen\tsplitting\ta monolithic\tsoftware\tinto\tmicroservices,\tas\tit\tis\tusually\trequired\tto\tshut down\tthe\tsystem\tfor\ta\tfew\thours\tin\torder\tto\tsplit\tthe\tdata\tinto\tlocal databases.\tThis\tsubject\tcould\twell\tbe\tan\tentire\tbook\tas\tnew\ttrends\twith NoSQL\tdatabases\tare\tchanging\tthe\tgame\tof\tdata\tstorage.\n\nFinally,\twe\tdiscussed\thow\tto\talign\tthe\tteams\tof\tengineers\tin\tour company\tin\torder\tto\tbe\tefficient\twhile\tkeeping\tthe\tflexibility\tand\tresilience needed\tto\tbe\table\tto\tbe\tagile,\tas\twell\tas\thow\tthe\tConway's\tLaw\timpacts the\tconversion\tof\tmonolithic\tsystems\tinto\tmicroservices-oriented architectures.\n\nIn\tthe\tnext\tchapter,\twe\twill\tapply\tall\tthe\tprinciples\tdiscussed\tin\tthe\tfirst three\tchapters,\tas\twell\tas\ta\tbig\tdose\tof\tcommon\tsense\tto\tbuild\ta\tfull working\tsystem\tbased\ton\tmicroservices.",
      "content_length": 1544,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 115,
      "content": "Chapter\t4.\tWriting\tYour\tFirst Microservice\tin\tNode.js\n\nWe\thave\tbeen\tlearning\tabout\thow\tto\tbuild\trobust\tmicroservices-oriented software,\tand\tnow\tit\tis\ttime\tto\tput\tall\tthe\tconcepts\tto\tpractice.\tIn\tthis chapter,\twe\tare\tgoing\tto\tbuild\ta\tmicroservices-oriented\te-commerce using\tSeneca\tand\tsome\tother\tframeworks\tthat\tare\tgoing\tto\tallow\tus\tto write\ta\tsoftware\tthat\twill\tbenefit\tfrom\tthe\tparticularities\tof\tthe microservices.\n\nMicromerce\t–\tthe\tbig\tpicture\n\nIt\tcovers\tthe\tfollowing:\n\nWriting\tmicroservices Sizing\tmicroservices Creating\tAPIs Integrating\tSeneca\twith\tExpress Storing\tdata\tusing\tSeneca\n\nIn\tthis\tchapter,\twe\tare\tgoing\tto\twrite\ta\tfull\t(nearly)\tsimplistic\te-commerce solution\tbased\ton\tmicroservices.\tFull\tmeans\tfull\tfrom\tthe\tconceptual point\tof\tview,\tbut\tfor\tobvious\treasons,\tit\twon't\tbe\tfull\t(as\tproduction ready)\tas\tit\tcould\ttake\tus\ta\tfew\tbooks\tto\thandle\tall\tthe\tpossible\tflows.\n\nWe\twon't\tgo\tdeep\tin\tto\tthe\tUI,\tas\tit\tis\tnot\trelated\tto\tthe\tsubject\tof\tthis book.\tWhat\twe\twill\tdo\tinstead\tis\ta\tmicroservice\tthat\twill\taggregate\tall\tthe other\tmicroservices,\tcreating\ta\tfrontend\tAPI\tto\tbe\tconsumed\tby\ta Single-Page\tApplication\t(SPA),\tbuilt\twith\tany\tof\tthe\tmodern\tJavaScript frameworks.\n\nIn\tthis\tchapter,\twe\tare\tgoing\tto\tdevelop\tthe\tfollowing\tfour\tmicroservices:\n\nProduct\tManager:\tThis\tmicroservice\twill\tbe\tresponsible\tfor\tadding, editing,\tand\tremoving\tproducts\tfrom\tour\tdatabase,\tas\twell\tas\tserving products\tto\tthe\tcustomers.\tThis\tmicroservice\twill\tbe\tpartially\tpublic",
      "content_length": 1464,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 116,
      "content": "for\ta\tpotential\tadmin\tsite\tto\tadd/remove\tproducts. Order\tManager:\tThis\tmicroservice\twill\tbe\tresponsible\tfor\tmanaging the\torder\tand\tbilling. Emailer:\tThis\tmicroservice\twill\tbe\tresponsible\tfor\tdelivering\te-mails to\tthe\tcustomers. UI:\tThis\tmicroservice\twill\texpose\tthe\tfeature\tfrom\tthe\tother microservices\tto\ta\tpotential\tSPA,\tbut\twe\twill\tonly\tbuild\tthe\tJSON interface.\n\nBuilding\tthe\tfour\tpreceding\tmicroservices,\twe\twill\tdevelop\tthe\tconcepts discussed\tin\tthe\tprevious\tchapters\tso\tthat,\tby\tthe\tend\tof\tthis\tchapter,\twe will\tbe\table\tto\tidentify\tthe\tmost\tcommon\tpitfalls\tgoing\tforward.\tKeep\tin mind\tthat\tthe\tobjective\tof\tthis\tbook\tis\tnot\tconverting\tyou\tinto\ta microservices\tor\tNode.js\texpert,\tbut\tto\tgive\tyou\tthe\ttools\trequired\tto learn\tby\tyourself,\tas\twell\tas\tmake\tyou\taware\tof\tthe\tbest\tdesign principles\tand\tthe\tmost\tcommon\tpitfalls.\n\nLet's\ttake\ta\tlook\tat\tthe\tdeployment\tdiagram:",
      "content_length": 874,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 117,
      "content": "This\tdiagram\tshows\thow\tour\tcompany\t(the\tyellow\tsquare)\thides\tsome\tof our\tmicroservices\tfrom\tthe\treal\tworld\tand\texposes\tsome\tothers\tto different\tnetworks,\tas\tfollows:\n\nUI\twill\tbe\texposed\tto\tthe\tInternet.\tEverybody\twill\tbe\table\tto\thit\tthis endpoint. Product\tManagement\twill\tmanage\tthe\tproducts\tin\tour\te-commerce. It\twill\thave\tthe\tfollowing\ttwo\tinterfaces:\n\nA\tSeneca\tendpoint\tfrom\twhere\tthe\tUI\twill\textract\tdata A\tJSON\tAPI\tfrom\twhere\tthe\toffice\tof\tour\tcompany\twill\tbe\table to\tcreate,\tupdate,\tand\tdelete\tproducts\n\nEmailer\twill\tbe\tour\tcommunication\tchannel\twith\tour\tcustomers.\tWe will\tuse\tthis\tmicroservice\tto\texplain\tthe\tgood\tpoints\tof\tSeneca,\tand we\twill\talso\tgive\tan\texample\tof\tthe\teventual\tconsistency\tand\tsystem",
      "content_length": 711,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 118,
      "content": "degradation\twhen\ta\tmicroservice\tfails. Order\tManager:\tThis\tmicroservice\twill\tlet\tus\thandle\tthe\torders\tfor our\tcustomers.\tWith\tthis\tmicroservice,\twe\twill\tdiscuss\thow\tto\thandle the\tfact\tthat\tthe\tdata\tis\tlocal\tto\teach\tmicroservice,\tinstead\tof\tbeing global\tto\tthe\tsystem.\tYou\tcan't\tjust\tgo\tto\tthe\tdatabase\tto\trecover\tthe product\tname\tor\tprice,\tit\tneeds\tto\tbe\trecovered\tfrom\tother microservice.\n\nTip\n\nAs\tyou\tcan\tsee,\tthere\tis\tno\tuser\tor\tstaff\tmanagement,\tbut\twith\tthese four\tmicroservices,\twe\twill\tbe\table\tto\tdevelop\tthe\tcore\tconcepts\tof microservices\tarchitectures.\tSeneca\tcomes\twith\ta\tvery\tpowerful\tdata and\ttransport\tplugin\tsystem\tthat\tmakes\tit\teasy\tto\tuse\tSeneca\twith different\tdata\tstorages\tand\ttransport\tsystems.\n\nFor\tall\tour\tmicroservices,\twe\tare\tgoing\tto\tuse\tMongoDB\tas\tthe\tstorage. Seneca\tcomes\twith\tan\tout-of-the-box\tin-memory\tdatabase\tplugin\tthat allows\tyou\tto\tstart\tcoding\tstraightaway,\tbut\tthe\tstorage\tis\ttransient:\tit does\tnot\tpersist\tthe\tdata\tbetween\tcalls.",
      "content_length": 967,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 119,
      "content": "Product\tManager\t–\tthe\ttwo-faced core\n\nProduct\tManager\tis\tthe\tcore\tof\tour\tsystem.\tI\tknow\twhat\tyou\tare\tthinking: microservices\tshould\tbe\tsmall\t(micro)\tand\tdistributed\t(no\tcentral\tpoint), but\tyou\tneed\tto\tset\tthe\tconceptual\tcentre\tsomewhere,\totherwise\tyou\twill end\tup\twith\ta\tfragmented\tsystem\tand\ttraceability\tproblems\t(we\twill\ttalk about\tit\tlater).\n\nBuilding\ta\tdual\tAPI\twith\tSeneca\tis\tfairly\teasy,\tas\tit\tcomes\twith\ta\tquite straightforward\tintegration\twith\tExpress.\tExpress\tis\tgoing\tto\tbe\tused\tto expose\tsome\tcapabilities\tof\tthe\tUI\tsuch\tas\tediting\tproducts,\tadding products,\tdeleting\tproducts,\tand\tso\ton.\tIt\tis\ta\tvery\tconvenient\tframework, easy\tto\tlearn,\tand\tit\tintegrates\twell\twith\tSeneca.\tIt\tis\talso\ta\tde-facto standard\ton\tNode.js\tfor\tweb\tapps,\tso\tit\tmakes\tit\teasy\tto\tfind\tinformation about\tthe\tpossible\tproblems.\n\nIt\tis\tgoing\tto\talso\thave\ta\tprivate\tpart\texposed\tthrough\tSeneca\tTCP\t(the default\tplugin\tin\tSeneca)\tso\tthat\tour\tinternal\tnetwork\tof\tmicroservices (specifically,\tthe\tUI)\twill\tbe\table\tto\taccess\tthe\tlist\tof\tproducts\tin\tour catalogue.\n\nProduct\tManager\tis\tgoing\tto\tbe\tsmall\tand\tcohesioned\t(it\twill\tonly manage\tproducts),\tas\twell\tas\tscalable,\tbut\tit\twill\thold\tall\tthe\tknowledge required\tto\tdeal\twith\tproducts\tin\tour\te-commerce.\n\nFirst\tthing\twe\tneed\tto\tdo\tis\tto\tdefine\tour\tProduct\tManager\tmicroservice, as\tfollows:\n\nThis\tis\tgoing\tto\thave\ta\tfunction\tto\tretrieve\tall\tthe\tproducts\tin\tthe database.\tThis\tis\tprobably\ta\tbad\tidea\tin\ta\tproduction\tsystem\t(as\tit probably\twould\trequire\tpagination),\tbut\tit\tworks\tfor\tour\texample. This\tshould\thave\tone\tfunction\tthat\tfetches\tall\tthe\tproducts\tfor\ta given\tcategory.\tIt\tis\tsimilar\tto\tthe\tprevious\tone,\tit\twould\tneed pagination\tin\ta\tproduction-ready\tsystem. This\tshould\thave\ta\tfunction\tto\tretrieve\tproducts\tby\tidentifier\t(id). This\tshould\thave\tone\tfunction\tthat\tallows\tus\tto\tadd\tproducts\tto\tthe",
      "content_length": 1831,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 120,
      "content": "database\t(in\tthis\tcase\tMongoDB).\tThis\tfunction\twill\tuse\tthe\tSeneca data\tabstraction\tto\tdecouple\tour\tmicroservice\tfrom\tthe\tstorage:\twe will\tbe\table\tto\t(in\ttheory)\tswitch\tMongo\tto\ta\tdifferent\tdatabase without\ttoo\tmuch\thassle\t(in\ttheory\tagain). This\tshould\thave\tone\tfunction\tto\tremove\tproducts.\tAgain,\tusing Seneca\tdata\tabstraction. This\tshould\thave\tone\tfunction\tto\tedit\tproducts.\n\nOur\tproduct\twill\tbe\ta\tdata\tstructure\thaving\tfour\tfields:\tname,\tcategory, description,\tand\tprice.\tAs\tyou\tcan\tsee,\tit\tis\ta\tbit\tsimplistic,\tbut\tit\twill help\tus\tto\tunderstand\tthe\tcomplicated\tworld\tof\tmicroservices.\n\nOur\tProduct\tManagement\tmicroservice\tis\tgoing\tto\tuse\tMongoDB (https://www.mongodb.org/).\tMongo\tis\ta\tdocument-oriented\tschema-less database\tthat\tallows\tan\tenormous\tflexibility\tto\tstore\tdata\tsuch\tas products\t(that,\tat\tthe\tend\tof\tthe\tday,\tare\tdocuments).\tIt\tis\talso\ta\tgood choice\tfor\tNode.js\tas\tit\tstores\tJSON\tobjects,\twhich\tis\ta\tstandard,\tcreated for\tJavaScript\t(JSON\tstands\tfor\tJavaScript\tObject\tNotation),\tso\tthat looks\tlike\tthe\tperfect\tpairing.\n\nThere\tis\ta\tlot\tof\tuseful\tinformation\ton\tthe\tMongoDB\twebsite\tif\tyou\twant to\tlearn\tmore\tabout\tit.\n\nLet's\tstart\tcoding\tour\tfunctions.\n\nFetching\tproducts\n\nTo\tfetch\tproducts,\twe\tgo\tto\tthe\tdatabase\tand\tdump\tthe\tfull\tlist\tof products\tstraight\tto\tthe\tinterface.\tIn\tthis\tcase,\twe\twon't\tcreate\tany pagination\tmechanism,\tbut\tin\tgeneral,\tpaginating\tdata\tis\ta\tgood\tpractice to\tavoid\tdatabase\t(or\tapplications,\tbut\tmainly\tdatabase)\tperformance problems.\n\nLet's\tsee\tthe\tfollowing\tcode:\n\n/** \t\tFetch\tthe\tlist\tof\tall\tthe\tproducts. \t/ seneca.add({area:\t\"product\",\taction:\t\"fetch\"},\t function(args,\tdone)\t{",
      "content_length": 1624,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 121,
      "content": "var\tproducts\t=\tthis.make(\"products\"); \t\tproducts.list$({},\tdone); });\n\nWe\talready\thave\ta\tpattern\tin\tSeneca\tthat\treturns\tall\tthe\tdata\tin\tour database.\n\nThe\tproducts.list$()\tfunction\twill\treceive\tthe\tfollowing\ttwo\tparameters:\n\nThe\tquery\tcriteria A\tfunction\tthat\treceives\tan\terror\tand\tresult\tobject\t(remember\tthe error-first\tcallback\tapproach)\n\nSeneca\tuses\tthe\t$\tsymbol\tto\tidentify\tthe\tkey\tfunctions\tsuch\tas\tlist$, save$,\tand\tso\ton.\tRegarding\tthe\tnaming\tof\tthe\tproperties\tof\tyour\tobjects, as\tlong\tas\tyou\tuse\talphanumeric\tidentifiers,\tyour\tnaming\twill\tbe\tcollision free.\n\nWe\tare\tpassing\tthe\tdone\tfunction\tfrom\tthe\tseneca.add()\tmethod\tto\tthe list$\tmethod.\tThis\tworks\tas\tSeneca\tfollows\tthe\tcallback\twith\terror-first approach.\tIn\tother\twords,\twe\tare\tcreating\ta\tshortcut\tfor\tthe\tfollowing code:\n\nseneca.add({area:\t\"product\",\taction:\t\"fetch\"},\t function(args,\tdone)\t{ \t\tvar\tproducts\t=\tthis.make(\"products\"); \t\tproducts.list$({},\tfunction(err,\tresult)\t{ \t\t\t\tdone(err,\tresult); \t\t}); });\n\nFetching\tby\tcategory\n\nFetching\tby\tcategory\tis\tvery\tsimilar\tto\tfetching\tthe\tfull\tlist\tof\tproducts. The\tonly\tdifference\tis\tthat\tnow\tthe\tSeneca\taction\twill\ttake\ta\tparameter\tto filter\tthe\tproducts\tby\tcategory.\n\nLet's\tsee\tthe\tcode:\n\n/** \t\tFetch\tthe\tlist\tof\tproducts\tby\tcategory.",
      "content_length": 1251,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 122,
      "content": "/ seneca.add({area:\t\"product\",\taction:\t\"fetch\",\t criteria:\t\"byCategory\"},\tfunction(args,\tdone)\t{ \t\tvar\tproducts\t=\tthis.make(\"products\"); \t\tproducts.list$({category:\targs.category},\tdone); });\n\nOne\tof\tthe\tfirst\tquestions\tthat\tmost\tadvanced\tdevelopers\twill\tnow\thave in\ttheir\tmind\tis\tthat\tisn't\tthis\ta\tperfect\tscenario\tfor\tan\tinjection\tattack? Well,\tSeneca\tis\tsmart\tenough\tto\tprevent\tit,\tso\twe\tdon't\tneed\tto\tworry about\tit\tany\tmore\tthan\tavoid\tconcatenating\tstrings\twith\tuser\tinput.\n\nAs\tyou\tcan\tsee,\tthe\tonly\tsignificant\tdifference\tis\tthe\tparameter\tpassed called\tcategory,\twhich\tgets\tdelegated\tinto\tSeneca\tdata\tabstraction\tlayer that\twill\tgenerate\tthe\tappropriate\tquery,\tdepending\ton\tthe\tstorage\twe use.\tThis\tis\textremely\tpowerful\twhen\ttalking\tabout\tmicroservices.\tIf\tyou remember,\tin\tthe\tprevious\tchapters,\twe\talways\ttalked\tabout\tcoupling\tas if\tit\twas\tthe\troot\tof\tall\tevils,\tand\tnow\twe\tcan\tassure\tit\tis,\tand\tSeneca handles\tit\tin\ta\tvery\telegant\tway.\tIn\tthis\tcase,\tthe\tframework\tprovides\ta contract\tthat\tthe\tdifferent\tstorage\tplugins\thave\tto\tsatisfy\tin\torder\tto\twork. In\tthe\tpreceding\texample,\tlist$\tis\tpart\tof\tthis\tcontract.\tIf\tyou\tuse\tthe Seneca\tstorage\twisely,\tswitching\tyour\tmicroservice\tover\tto\ta\tnew database\tengine\t(have\tyou\tever\tbeen\ttempted\tto\tmove\ta\tpart\tof\tyour data\tover\tMongoDB?)\tis\ta\tmatter\tof\tconfiguration.\n\nFetching\tby\tID\n\nFetching\ta\tproduct\tby\tID\tis\tone\tof\tthe\tmost\tnecessary\tmethods,\tand\tit\tis also\ta\ttricky\tone.\tNot\ttricky\tfrom\tthe\tcoding\tpoint\tof\tview,\tas\tshown\tin\tthe following:\n\n/** \t\tFetch\ta\tproduct\tby\tid. \t/ seneca.add({area:\t\"product\",\taction:\t\"fetch\",\t criteria:\t\"byId\"},\tfunction(args,\tdone)\t{ \t\tvar\tproduct\t=\tthis.make(\"products\"); \t\tproduct.load$(args.id,\tdone); });\n\nThe\ttricky\tpart\tis\thow\tid\tis\tgenerated.\tThe\tgeneration\tof\tid\tis\tone\tof\tthe",
      "content_length": 1768,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 123,
      "content": "contact\tpoints\twith\tthe\tdatabase.\tMongo\tcreates\ta\thash\tto\trepresent\ta synthetic\tID;\twhereas,\tMySQL\tusually\tcreates\tan\tinteger\tthat\tauto- increments\tto\tuniquely\tidentify\teach\trecord.\tGiven\tthat,\tif\twe\twant\tto switch\tMongoDB\tto\tMySQL\tin\tone\tof\tour\tapps,\tthe\tfirst\tproblem\tthat\twe need\tto\tsolve\tis\thow\tto\tmap\ta\thash\tthat\tlooks\tsomething\tsimilar\tto\tthe following\tinto\tan\tordinal\tnumber:\n\ne777d434a849760a1303b7f9f989e33a\n\nIn\t99%\tof\tthe\tcases,\tthis\tis\tfine,\tbut\twe\tneed\tto\tbe\tcareful,\tespecially when\tstoring\tIDs\tas,\tif\tyou\trecall\tfrom\tthe\tprevious\tchapters,\tthe\tdata should\tbe\tlocal\tto\teach\tmicroservice,\twhich\tcould\timply\tthat\tchanging\tthe data\ttype\tof\tthe\tID\tof\tone\tentity,\trequires\tchanging\tthe\treferenced\tID\tin all\tthe\tother\tdatabases.\n\nAdding\ta\tproduct\n\nAdding\ta\tproduct\tis\ttrivial.\tWe\tjust\tneed\tto\tcreate\tthe\tdata\tand\tsave\tit\tin the\tdatabase:\n\n/** \t\tAdds\ta\tproduct. \t/ seneca.add({area:\t\"product\",\taction:\t\"add\"},\t function(args,\tdone)\t{ \t\tvar\tproducts\t=\tthis.make(\"products\"); \t\tproducts.category\t=\targs.category; \t\tproducts.name\t=\targs.name; \t\tproducts.description\t=\targs.description; \t\tproducts.category\t=\targs.category; \t\tproducts.price\t=\targs.price \t\tproducts.save$(function(err,\tproduct)\t{ \t\t\t\tdone(err,\tproducts.data$(false)); \t\t}); });\n\nIn\tthis\tmethod,\twe\tare\tusing\ta\thelper\tfrom\tSeneca, products.data$(false).\tThis\thelper\twill\tallow\tus\tto\tretrieve\tthe\tdata\tof the\tentity\twithout\tall\tthe\tmetadata\tabout\tnamespace\t(zone),\tentity\tname, and\tbase\tname\tthat\twe\tare\tnot\tinterested\tin\twhen\tthe\tdata\tis\treturned\tto the\tcalling\tmethod.",
      "content_length": 1536,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 124,
      "content": "Removing\ta\tproduct\n\nThe\tremoval\tof\ta\tproduct\tis\tusually\tdone\tby\tid:\tWe\ttarget\tthe\tspecific data\tthat\twe\twant\tto\tremove\tby\tthe\tprimary\tkey\tand\tthen\tremove\tit,\tas follows:\n\n/** \t\tRemoves\ta\tproduct\tby\tid. \t/ seneca.add({area:\t\"product\",\taction:\t\"remove\"},\t function(args,\tdone)\t{ \t\tvar\tproduct\t=\tthis.make(\"products\"); \t\tproduct.remove$(args.id,\tfunction(err)\t{ \t\tdone(err,\tnull); \t\t}); });\n\nIn\tthis\tcase,\twe\tdon't\treturn\tanything\taside\tfrom\tan\terror\tif\tsomething goes\twrong,\tso\tthe\tendpoint\tthat\tcalls\tthis\taction\tcan\tassume\tthat\ta\tnon- errored\tresponse\tis\ta\tsuccess.\n\nEditing\ta\tproduct\n\nWe\tneed\tto\tprovide\tan\taction\tto\tedit\tproducts.\tThe\tcode\tfor\tdoing\tthat\tis as\tfollows:\n\n/** \t\tEdits\ta\tproduct\tfetching\tit\tby\tid\tfirst. \t/ seneca.edit({area:\t\"product\",\taction:\t\"edit\"},\t function(args,\tdone)\t{ \t\tseneca.act({area:\t\"product\",\taction:\t\"fetch\",\t criteria:\t\"byId\",\tid:\targs.id},\tfunction(err,\tresult)\t { \t\tresult.data$( \t\t{ \t\t\t\tname:\targs.name,\t \t\t\t\tcategory:\targs.category,\t \t\t\t\tdescription:\targs.description, \t\t\t\tprice:\targs.price\t \t\t} \t\t); \t\tresult.save$(function(err,\tproduct){",
      "content_length": 1077,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 125,
      "content": "done(product.data$(false)); \t\t\t\t}); \t\t}); });\n\nHere\tis\tan\tinteresting\tscenario.\tBefore\tediting\ta\tproduct,\twe\tneed\tto fetch\tit\tby\tID,\tand\twe\thave\talready\tdone\tthat.\tSo,\twhat\twe\tare\tdoing\there is\trelying\ton\tthe\talready\texisting\taction\tto\tretrieve\ta\tproduct\tby\tID, copying\tthe\tdata\tacross,\tand\tsaving\tit.\n\nThis\tis\ta\tnice\tway\tfor\tcode\treuse\tintroduced\tby\tSeneca,\twhere\tyou\tcan delegate\ta\tcall\tfrom\tone\taction\tto\tanother\tand\twork\tin\tthe\twrapper\taction with\tthe\tresult.\n\nWiring\teverything\tup\n\nAs\twe\tagreed\tearlier,\tthe\tproduct\tmanager\tis\tgoing\tto\thave\ttwo\tfaces: one\tthat\twill\tbe\texposed\tto\tother\tmicroservices\tusing\tthe\tSeneca transport\tover\tTCP\tand\ta\tsecond\tone\texposed\tthrough\tExpress\t(a Node.js\tlibrary\tto\tcreate\tweb\tapps)\tin\tthe\tREST\tway.\n\nLet's\twire\teverything\ttogether:\n\nvar\tplugin\t=\tfunction(options)\t{ \t\tvar\tseneca\t=\tthis;\n\n/** \t\t\t*\tFetch\tthe\tlist\tof\tall\tthe\tproducts.\n\nseneca.add({area:\t\"product\",\taction:\t\"fetch\"},\t function(args,\tdone)\t{ \t\t\t\tvar\tproducts\t=\tthis.make(\"products\"); \t\t\t\tproducts.list$({},\tdone); \t\t});\n\n*\tFetch\tthe\tlist\tof\tproducts\tby\tcategory.\n\nseneca.add({area:\t\"product\",\taction:\t\"fetch\",\t criteria:\t\"byCategory\"},\tfunction(args,\tdone)\t{ \t\t\t\tvar\tproducts\t=\tthis.make(\"products\"); \t\t\t\tproducts.list$({category:\targs.category},\tdone); \t\t});",
      "content_length": 1261,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 126,
      "content": "*\tFetch\ta\tproduct\tby\tid.\n\nseneca.add({area:\t\"product\",\taction:\t\"fetch\",\t criteria:\t\"byId\"},\tfunction(args,\tdone)\t{ \t\t\t\tvar\tproduct\t=\tthis.make(\"products\"); \t\t\t\tproduct.load$(args.id,\tdone); \t\t});\n\n*\tAdds\ta\tproduct.\n\nseneca.add({area:\t\"product\",\taction:\t\"add\"},\t function(args,\tdone)\t{ \t\t\t\tvar\tproducts\t=\tthis.make(\"products\"); \t\t\t\tproducts.category\t=\targs.category; \t\t\t\tproducts.name\t=\targs.name; \t\t\t\tproducts.description\t=\targs.description; \t\t\t\tproducts.category\t=\targs.category; \t\t\t\tproducts.price\t=\targs.price \t\t\t\tproducts.save$(function(err,\tproduct)\t{ \t\t\t\t\t\tdone(err,\tproducts.data$(false)); \t\t\t\t}); \t\t});\n\n*\tRemoves\ta\tproduct\tby\tid.\n\nseneca.add({area:\t\"product\",\taction:\t\"remove\"},\t function(args,\tdone)\t{ \t\t\t\tvar\tproduct\t=\tthis.make(\"products\"); \t\t\t\tproduct.remove$(args.id,\tfunction(err)\t{ \t\t\t\t\t\tdone(err,\tnull); \t\t\t\t}); \t\t});\n\nEdits\ta\tproduct\tfetching\tit\tby\tid\tfirst. \t\t\t/ \t\tseneca.add({area:\t\"product\",\taction:\t\"edit\"},\t function(args,\tdone)\t{ \t\t\t\tseneca.act({area:\t\"product\",\taction:\t\"fetch\",\t criteria:\t\"byId\",\tid:\targs.id},\tfunction(err,\tresult)\t { \t\t\t\t\t\tresult.data$( \t\t\t\t\t\t\t\t{ \t\t\t\t\t\t\t\t\t\tname:\targs.name,\t \t\t\t\t\t\t\t\t\t\tcategory:\targs.category,\t \t\t\t\t\t\t\t\t\t\tdescription:\targs.description,",
      "content_length": 1196,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 127,
      "content": "price:\targs.price\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t\t\t\t\t} \t\t\t\t\t\t); \t\t\t\t\t\tresult.save$(function(err,\tproduct){ \t\t\t\t\t\t\t\tdone(err,\tproduct.data$(false)); \t\t\t\t\t\t}); \t\t\t\t}); \t\t}); } module.exports\t=\tplugin;\n\nvar\tseneca\t=\trequire(\"seneca\")(); seneca.use(plugin); seneca.use(\"mongo-store\",\t{ \t\tname:\t\"seneca\", \t\thost:\t\"127.0.0.1\", \t\tport:\t\"27017\" });\n\nseneca.ready(function(err){\n\nseneca.act('role:web',{use:{ \t\t\t\tprefix:\t'/products', \t\t\t\tpin:\t{area:'product',action:'*'}, \t\t\t\tmap:{ \t\t\t\tfetch:\t{GET:true}, \t\t\t\tedit:\t{GET:false,POST:true}, \t\t\t\tdelete:\t{GET:\tfalse,\tDELETE:\ttrue} \t\t\t\t} \t\t}}); \t\tvar\texpress\t=\trequire('express'); \t\tvar\tapp\t=\texpress(); \t\tapp.use(require(\"body-parser\").json());\n\n//\tThis\tis\thow\tyou\tintegrate\tSeneca\twith\tExpress \t\tapp.use(\tseneca.export('web')\t);\n\napp.listen(3000);\n\n});\n\nNow\tlet's\texplain\tthe\tcode:\n\nWe\thave\tcreated\ta\tSeneca\tplugin.\tThis\tplugin\tcan\tbe\treused\tacross different\tmicroservices.\tThis\tplugin\tcontains\tall\tthe\tdefinitions\tof\tmethods needed\tby\tour\tmicroservice\tthat\twe\thave\tpreviously\tdescribed.",
      "content_length": 1010,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 128,
      "content": "The\tpreceding\tcode\tdescribes\tthe\tfollowing\ttwo\tsections:\n\nThe\tfirst\tfew\tlines\tconnect\tto\tMongo.\tIn\tthis\tcase,\twe\tare\tspecifying that\tMongo\tis\ta\tlocal\tdatabase.\tWe\tare\tdoing\tthat\tthrough\tthe\tuse\tof a\tplugin\tcalled\tmongo-store—https://github.com/rjrodger/seneca- mongo-store,\twritten\tby\tRichard\tRodger,\tthe\tauthor\tof\tSeneca. The\tsecond\tpart\tis\tnew\tto\tus.\tIt\tmight\tsound\tfamiliar\tif\tyou\thave used\tJQuery\tbefore,\tbut\tbasically\twhat\tthe\tseneca.ready()\tcallback is\tdoing\tis\ttaking\tcare\tof\tthe\tfact\tthat\tSeneca\tmight\tnot\thave connected\tto\tMongo\tbefore\tthe\tcalls\tstart\tflowing\tinto\tits\tAPI.\tThe seneca.ready()\tcallback\tis\twhere\tthe\tcode\tfor\tintegrating\tExpress with\tSeneca\tlives.\n\nThe\tfollowing\tis\tthe\tpackage.json\tconfiguration\tof\tour\tapp:\n\n{ \t\t\"name\":\t\"Product\tManager\", \t\t\"version\":\t\"1.0.0\", \t\t\"description\":\t\"Product\tManagement\tsub-system\", \t\t\"main\":\t\"index.js\", \t\t\"keywords\":\t[ \t\t\t\t\"microservices\", \t\t\t\t\"products\" \t\t], \t\t\"author\":\t\"David\tGonzalez\", \t\t\"license\":\t\"ISC\", \t\t\"dependencies\":\t{ \t\t\"body-parser\":\t\"^1.14.1\", \t\t\"debug\":\t\"^2.2.0\", \t\t\"express\":\t\"^4.13.3\", \t\t\"seneca\":\t\"^0.8.0\", \t\t\"seneca-mongo-store\":\t\"^0.2.0\", \t\t\"type-is\":\t\"^1.6.10\" \t\t} }\n\nHere\twe\tcontrol\tall\tthe\tlibraries\tneeded\tfor\tour\tmicroservice\tto\trun,\tas well\tas\tthe\tconfiguration.\n\nIntegrating\twith\tExpress\t–\thow\tto\tcreate a\tREST\tAPI",
      "content_length": 1297,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 129,
      "content": "Integrating\twith\tExpress\tis\tquite\tstraightforward.\tLet's\ttake\ta\tlook\tat\tthe code:\n\nseneca.act('role:web',{use:{ \t\t\t\tprefix:\t'/products', \t\t\t\tpin:\t{area:'product',action:'*'}, \t\t\t\tmap:{ \t\t\t\tfetch:\t{GET:true},\t\t\t\t\t\t \t\t\t\tedit:\t{PUT:true}, \t\t\t\tdelete:\t{GET:\tfalse,\tDELETE:\ttrue} \t\t\t\t} \t\t}}); \t\tvar\texpress\t=\trequire('express'); \t\tvar\tapp\t=\texpress(); \t\tapp.use(require(\"body-parser\").json());\n\n//\tThis\tis\thow\tyou\tintegrate\tSeneca\twith\tExpress \t\tapp.use(\tseneca.export('web')\t);\n\napp.listen(3000);\n\nThis\tcode\tsnippet,\tas\twe've\tseen\tin\tthe\tpreceding\tsection,\tprovides\tthe following\tthree\tREST\tendpoints:\n\nproductsfetch\n\nproductsedit\n\nproductsdelete\n\nLet's\texplain\thow.\n\nFirst,\twhat\twe\tdo\tis\ttell\tSeneca\tto\texecute\tthe\trole:web\taction,\tindicating the\tconfiguration.\tThis\tconfiguration\tspecifies\tto\tuse\ta\t/products\tprefix for\tall\tthe\tURLs,\tand\tit\tpins\tthe\taction\twith\ta\tmatching\t{area:\t\"product\", action:\t\"*\"}\tpattern.\tThis\tis\talso\tnew\tfor\tus,\tbut\tit\tis\ta\tnice\tway\tto specify\tto\tSeneca\tthat\twhatever\taction\tit\texecutes\tin\tthe\tURL,\tit\twill\thave implicit\tarea:\t\"product\"\tof\tthe\thandler.\tThis\tmeans\tthat\tproductsfetch endpoint\twill\tcorrespond\tto\tthe\t{area:\t'products',\taction:\t'fetch'} pattern.\tThis\tcould\tbe\ta\tbit\tdifficult,\tbut\tonce\tyou\tget\tused\tto\tit,\tit\tis actually\treally\tpowerful.\tIt\tdoes\tnot\tforce\tuse\tto\tfully\tcouple\tour\tactions with\tour\tURLs\tby\tconventions.",
      "content_length": 1355,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 130,
      "content": "In\tthe\tconfiguration,\tthe\tattribute\tmap\tspecifies\tthe\tHTTP\tactions\tthat can\tbe\texecuted\tover\tan\tendpoint:\tfetch\twill\tallow\tGET,\tedit\twill\tallow\tPUT, and\tdelete\twill\tonly\tallow\tDELETE.\tThis\tway,\twe\tcan\tcontrol\tthe\tsemantics of\tthe\tapplication.\n\nEverything\telse\tis\tprobably\tfamiliar\tto\tyou.\tCreate\tan\tExpress\tapp\tand specify\tusing\tthe\tfollowing\ttwo\tplugins:\n\nThe\tJSON\tbody\tparser The\tSeneca\tweb\tplugin\n\nThis\tis\tall.\tNow,\tif\twe\tadd\ta\tnew\taction\tto\tour\tSeneca\tlist\tof\tactions\tin order\tto\texpose\tit\tthrough\tthe\tAPI,\tthe\tonly\tthing\tthat\tneeds\tto\tbe\tdone\tis to\tmodify\tthe\tmap\tattribute\tto\tallow\tHTTP\tmethods.\n\nAlthough\twe\thave\tbuilt\ta\tvery\tsimplistic\tmicroservice,\tit\tcaptures\ta\tbig portion\tof\tthe\tcommon\tpatterns\tthat\tyou\tfind\twhen\tcreating\ta\tCRUD (Create\tRead\tUpdate\tDelete)\tapplication.\tWe\thave\talso\tcreated\ta\tsmall REST\tAPI\tout\tof\ta\tSeneca\tapplication\twith\tlittle\tto\tno\teffort.\tAll\twe\tneed to\tdo\tnow\tis\tconfigure\tthe\tinfrastructure\t(MongoDB)\tand\twe\tare\tready\tto deploy\tour\tmicroservice.",
      "content_length": 983,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 131,
      "content": "The\temailer\t–\ta\tcommon\tproblem\n\nEmailing\tis\tsomething\tthat\tevery\tcompany\tneeds\tto\tdo.\tWe\tneed\tto communicate\twith\tour\tcustomers\tin\torder\tto\tsend\tnotifications,\tbills,\tor registration\te-mails.\n\nIn\tthe\tcompanies\twhere\tI've\tworked\tbefore,\temailing\talways\tpresented\ta problem\tsuch\tas\te-mails\tnot\tbeing\tdelivered,\tor\tbeing\tdelivered\ttwice, with\tthe\twrong\tcontent\tto\tthe\twrong\tcustomer,\tand\tso\ton.\tIt\tlooks terrifying\tthat\tsomething\tas\tsimple\tas\tsending\tan\te-mail\tcould\tbe\tthis complicated\tto\tmanage.\n\nIn\tgeneral,\te-mail\tcommunication\tis\tthe\tfirst\tcandidate\tto\twrite\ta microservice.\tThink\tabout\tit:\n\nE-mail\tdoes\tone\tthing E-mail\tdoes\tit\twell E-mail\tkeeps\tits\town\tdata\n\nIt\tis\talso\ta\tgood\texample\tof\thow\tthe\tConway's\tlaw\tkicks\tinto\tour\tsystems without\tbeing\tnoticed.\tWe\tdesign\tour\tsystems\tmodeling\tthe\texisting communication\tin\tour\tcompany\tas\twe\tare\tconstrained\tby\tit.\n\nHow\tto\tsend\te-mails\n\nBack\tto\tthe\tbasics.\tHow\tdo\twe\tsend\te-mails?\tI\tam\tnot\ttalking\tabout which\tnetwork\tprotocol\twe\tuse\tfor\tsending\tthe\te-mail\tor\twhat\tare\tthe minimum\tacceptable\theaders?\n\nI\tam\ttalking\tabout\twhat\twe\tneed\tto\tsend\tan\te-mail\tfrom\tthe\tbusiness point\tof\tview:\n\nA\ttitle The\tcontent A\tdestination\taddress\n\nThat\tis\teverything.\tWe\tcould\thave\tgone\tfar,\ttalking\tabout acknowledgements,\tsecure\te-mail,\tBCCs,\tand\tso\ton.\tHowever,\twe\tare",
      "content_length": 1298,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 132,
      "content": "following\tthe\tlean\tmethodology:\tstart\twith\tthe\tminimum\tviable\tproduct and\tbuild\tup\tfrom\tit\tuntil\tyou\tachieve\tthe\tdesired\tresult.\n\nI\tcan't\tremember\ta\tproject\twhere\tthe\te-mail\tsending\twasn't\ta controversial\tpart.\tThe\tproduct\tchosen\tto\tdeliver\te-mails\tends\tup\ttightly coupled\tto\tthe\tsystem\tand\tit\tis\treally\thard\tto\treplace\tit\tseamlessly. However,\tmicroservices\tare\there\tto\trescue\tus.\n\nDefining\tthe\tinterface\n\nAs\tI\tmentioned\tbefore,\talthough\tit\tsounds\teasy,\tsending\tcorporate\te- mails\tcould\tend\tup\tbeing\ta\tmess.\tTherefore,\tthe\tfirst\tthing\twe\tneed\tto clear\tis\tour\tminimum\trequirements:\n\nHow\tdo\twe\trender\tthe\te-mail?\n\nDoes\trendering\tthe\temail\tbelongs\tto\tthe\tbound\tcontext\tof\tthe email\tmanipulation? Do\twe\tcreate\tanother\tmicroservice\tto\trender\te-mails? Do\twe\tuse\ta\tthird\tparty\tto\tmanage\tthe\te-mails?\n\nDo\twe\tstore\tthe\talready\tsent\te-mails\tfor\tauditing\tpurposes?\n\nFor\tthis\tmicroservice,\twe\tare\tgoing\tto\tuse\tMandrill.\tMandrill\tis\ta\tcompany that\tallows\tus\tto\tsend\tcorporate\te-mails,\ttrack\tthe\talready\tsent\te-mails, and\tcreate\te-mail\ttemplates\tthat\tcan\tbe\tedited\tonline.\n\nOur\tmicroservice\tis\tgoing\tto\tlook\tas\tshown\tin\tthe\tfollowing\tcode:\n\nvar\tplugin\t=\tfunction(options)\t{ \t\tvar\tseneca\t=\tthis; \t\t/** \t\t\t\tSends\tan\temail\tusing\ta\ttemplate\temail. \t\t\t/ \t\tseneca.add({area:\t\"email\",\taction:\t\"send\",\ttemplate:\t \"\"},\tfunction(args,\tdone)\t{ //\tTODO:\tMore\tcode\tto\tcome. \t\t});\n\n/* \t\t\t\tSends\tan\temail\tincluding\tthe\tcontent. \t\t\t/",
      "content_length": 1403,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 133,
      "content": "seneca.add({area:\t\"email\",\taction:\t\"send\"},\t function(args,\tdone)\t{ //\tTODO:\tMore\tcode\tto\tcome. \t\t}); };\n\nWe\thave\ttwo\tpatterns:\tone\tthat\tmakes\tuse\tof\ttemplates\tand\tthe\tother that\tsends\tthe\tcontent\tcontained\tin\tthe\trequest.\n\nAs\tyou\tcan\tsee,\teverything\tthat\twe\thave\tdefined\there\tis\tinformation related\tto\temailing.\tThere\tis\tno\tbleeding\tfrom\tthe\tMandrill\tterminology into\twhat\tthe\tother\tmicroservices\tsee\tin\tour\te-mail\tsending.\tThe\tonly compromise\tthat\twe\tare\tmaking\tis\tthe\ttemplating.\tWe\tare\tdelegating\tthe template\trendering\tto\tthe\te-mail\tsender,\tbut\tit\tis\tnot\ta\tbig\tdeal,\tas\teven\tif we\twalk\taway\tfrom\tMandrill,\twe\twill\tneed\tto\trender\tthe\tcontent\tsomehow.\n\nWe\twill\tcome\tback\tto\tthe\tcode\tlater.\n\nSetting\tup\tMandrill\n\nMandrill\tis\tfairly\teasy\tto\tuse\tand\tshouldn't\tbe\ta\tproblem\tto\tset\tup. However,\twe\tare\tgoing\tto\tuse\tthe\ttest\tmode\tso\tthat\twe\tcan\tassure\tthat the\te-mails\tare\tnot\tgoing\tto\tbe\tdelivered\tand\twe\tcan\taccess\tthe\tAPI\tfor all\tour\tneeds.\n\nThe\tfirst\tthing\twe\tneed\tto\tdo\tis\tcreate\tan\taccount\ton\tMandrill.\tJust register\twith\tyour\te-mail\tat\thttps://mandrillapp.com,\tand\tyou\tshould\tbe able\tto\taccess\tto\tit,\tas\tshown\tin\tthe\tfollowing\tscreenshot:",
      "content_length": 1142,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 134,
      "content": "Now\twe\thave\tcreated\tan\taccount\tthat\twe\tneed\tto\tenter\tinto\tthe\ttest mode.\tIn\torder\tto\tdo\tit,\tjust\tclick\ton\tyour\te-mail\tat\tthe\ttop-right\tcorner\tand select\tthe\tTurn\ton\tthe\ttest\tmode\toption\tfrom\tthe\tmenu.\tThe\tMandrill menu\ton\tthe\tleft\twill\tturn\torange\tnow.\n\nNext,\twe\tneed\tto\tcreate\tan\tAPI\tkey.\tThis\tkey\tis\tthe\tlogin\tinformation\tto be\tused\tby\tthe\tMandrill\tAPI.\tJust\tclick\ton\tSettings\tand\tSMTP\t&\tAPI\tInfo and\tadd\ta\tnew\tkey\t(don't\tforget\tthe\tcheckbox\tto\tmark\tthe\tkey\tas\ttest key).\tIt\tshould\tlook\tlike\tthe\tfollowing\tscreenshot\tnow:",
      "content_length": 523,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 135,
      "content": "The\tkey\tis\teverything\tyou\tneed\tfor\tnow.\tLet's\ttest\tthe\tAPI:\n\nvar\tmandrill\t=\trequire(\"mandrill-api/mandrill\"); var\tmandrillClient\t=\tnew\tmandrill.Mandrill(\"<YOUR-KEY- HERE>\");\n\nmandrillClient.users.info({},\tfunction(result){ \t\tconsole.log(result); },\tfunction(e){ \t\tconsole.log(e); });\n\nWith\tthese\tfew\tlines,\twe\thave\tmanaged\tto\ttest\tthat\tMandrill\tis\tup\tand running\tand\twe\thave\ta\tvalid\tkey.\tThe\toutput\tof\tthis\tprogram\tshould\tbe something\tvery\tsimilar\tto\tthe\tfollowing\tJSON:\n\nHands\ton\t–\tintegrating\tMandrill\tin\tyour microservice\n\nEverything\tis\tready\tnow.\tWe\thave\ta\tworking\tkey\tand\tour\tinterface.\tThe only\tthing\tleft\tis\tto\tcreate\tthe\tcode.\tWe\tare\tgoing\tto\tuse\ta\tsmall\tpart\tof the\tMandrill\tAPI,\tbut\tif\tyou\twant\tto\tmake\tuse\tof\tother\tfeatures,\tyou\tcan find\ta\tbetter\tdescription\there:\thttps://mandrillapp.com/api/docs/\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\tcode:\n\n/** \t\t\t\tSends\tan\temail\tincluding\tthe\tcontent.",
      "content_length": 898,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 136,
      "content": "/ \t\tseneca.add({area:\t\"email\",\taction:\t\"send\"},\t function(args,\tdone)\t{ \t\t\t\tconsole.log(args); \t\t\t\tvar\tmessage\t=\t{ \t\t\t\t\t\t\"html\":\targs.content, \t\t\t\t\t\t\"subject\":\targs.subject, \t\t\t\t\t\t\"to\":\t[{ \t\t\t\t\t\t\t\t\"email\":\targs.to, \t\t\t\t\t\t\t\t\"name\":\targs.toName, \t\t\t\t\t\t\t\t\"type\":\t\"to\" \t\t\t\t\t\t}], \t\t\t\t\t\t\"from_email\":\t\"info@micromerce.com\", \t\t\t\t\t\t\"from_name\":\t\"Micromerce\" \t\t\t\t} \t\t\t\tmandrillClient.messages.send({\"message\":\tmessage},\t function(result)\t{ \t\t\t\t\t\tdone(null,\t{status:\tresult.status}); \t\t\t\t},\tfunction(e)\t{ \t\t\t\t\t\tdone({code:\te.name},\tnull); \t\t\t\t}); \t\t});\n\nThis\tfirst\tmethod\tsends\tmessages\twithout\tusing\ta\ttemplate.\tWe\tjust\tget the\tHTML\tcontent\t(and\ta\tfew\tother\tparameters)\tfrom\tour\tapplication\tand deliver\tit\tthrough\tMandrill.\n\nAs\tyou\tcan\tsee,\twe\tonly\thave\ttwo\tcontact\tpoints\twith\tthe\touter\tworld:\tthe parameters\tpassed\tin\tand\tthe\treturn\tof\tour\tactions.\tBoth\tof\tthem\thave\ta clear\tcontract\tthat\thas\tnothing\tto\tdo\twith\tMandrill,\tbut\twhat\tabout\tthe data?\n\nAt\tthe\terror,\twe\tare\treturning\te.name,\tassuming\tthat\tit\tis\ta\tcode.\tAt\tsome point,\tsomeone\twill\tend\tup\tbranching\tthe\tflow\tdepending\ton\tthis\terror code.\tHere,\twe\thave\tsomething\tcalled\tdata\tcoupling;\tour\tsoftware components\tdon't\tdepend\ton\tthe\tcontract,\tbut\tthey\tdo\tdepend\ton\tthe content\tsent\tacross.\n\nNow,\tthe\tquestion\tis:\thow\tdo\twe\tfix\tit?\tWe\tcan't.\tAt\tleast\tnot\tin\tan\teasy way.\tWe\tneed\tto\tassume\tthat\tour\tmicroservice\tis\tnot\tperfect,\tit\thas\ta flaw.\tIf\twe\tswitch\tprovider\tfor\temailing,\twe\tare\tgoing\tto\tneed\tto\trevisit\tthe calling\tcode\tto\tcheck\tpotential\tcouplings.\n\nIn\tthe\tworld\tof\tsoftware,\tin\tevery\tsingle\tproject\tthat\tI've\tworked\ton",
      "content_length": 1575,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 137,
      "content": "before,\tthere\twas\talways\ta\tbig\tpush\ttrying\tto\tmake\tthe\tcode\tas\tgeneric as\tpossible,\ttrying\tto\tguess\tthe\tfuture,\twhich\tusually\tcould\tbe\tas\tbad\tas assuming\tthat\tyour\tmicroservice\twon't\tbe\tperfect.\tThere\tis\tsomething that\talways\tattracted\tmy\tattention:\twe\tput\ta\tlarge\tamount\tof\teffort\tin\tto perfection,\tbut\twe\tpretty\tmuch\tignore\tthe\tfact\tthat\twe\tare\tgoing\tto\tfail and\twe\tdo\tcan\tnothing\tabout\tit.\tSoftware\tfails\toften\tand\twe\tneed\tto\tbe prepared\tfor\tthat.\n\nLater,\twe\twill\tsee\ta\tpattern\tto\tfactor\thuman\tnature\tinto\tthe\tmicroservices: the\tcircuit\tbreaker.\n\nDon't\tbe\tsurprised\tif\tMandrill\trejects\tthe\te-mails\tdue\tto\tthe\tunsigned reason.\tThis\tis\tdue\tto\tthe\tfact\tthat\tthey\tcouldn't\tvalidate\tthe\tdomain\tfrom where\twe\tare\tsending\tthe\te-mail\t(in\tthis\tcase,\ta\tdummy\tdomain\tthat does\tnot\texist).\tIf\twe\twant\tMandrill\tto\tactually\tprocess\tthe\te-mails\t(even though\twe\tare\tin\ttest\tmode),\twe\tjust\tneed\tto\tverify\tour\tdomain\tby\tadding some\tconfiguration\tto\tit.\n\nNote\n\nMore\tinformation\tcan\tbe\tfound\tin\tthe\tMandrill\tdocumentation\there:\n\nhttps://mandrillapp.com/api/docs/\n\nThe\tsecond\tmethod\tto\tsend\te-mails\tis\tsend\tan\te-mail\tfrom\ta\ttemplate.\tIn this\tcase,\tMandrill\tprovides\ta\tflexible\tAPI:\n\nIt\tprovides\tper-recipient\tvariables\tin\tcase\twe\tsend\tthe\te-mail\tto\ta\tlist of\tcustomers It\thas\tglobal\tvariables It\tallows\tcontent\treplacement\t(we\tcan\treplace\ta\tfull\tsection)\n\nFor\tconvenience,\twe\tare\tgoing\tto\tjust\tuse\tglobal\tvariables\tas\twe\tare limited\ton\tspace\tin\tthis\tbook.\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\tcode:\n\n/**",
      "content_length": 1484,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 138,
      "content": "Sends\tan\temail\tusing\ta\ttemplate\temail. \t\t\t/ \t\tseneca.add({area:\t\"email\",\taction:\t\"send\",\ttemplate:\t \"*\"},\tfunction(args,\tdone)\t{ \t\t\t\tconsole.log(\"sending\"); \t\t\t\tvar\tmessage\t=\t{ \t\t\t\t\t\t\"subject\":\targs.subject, \t\t\t\t\t\t\"to\":\t[{ \t\t\t\t\t\t\t\t\"email\":\targs.to, \t\t\t\t\t\t\t\t\"name\":\targs.toName, \t\t\t\t\t\t\t\t\"type\":\t\"to\" \t\t\t\t\t\t}], \t\t\t\t\t\t\"from_email\":\t\"info@micromerce.com\", \t\t\t\t\t\t\"from_name\":\t\"Micromerce\", \t\t\t\t\t\t\"global_merge_vars\":\targs.vars, \t\t\t\t} \t\t\t\tmandrillClient.messages.sendTemplate( \t\t\t\t\t\t{\"template_name\":\targs.template,\t \"template_content\":\t{},\t\"message\":\tmessage},\t \t\t\t\tfunction(result)\t{ \t\t\t\t\t\tdone(null,\t{status:\tresult.status}); \t\t\t\t},\tfunction(e)\t{ \t\t\t\t\t\tdone({code:\te.name},\tnull); \t\t\t\t}); \t\t});\n\nNow\twe\tcan\tcreate\tour\ttemplates\tin\tMandrill\t(and\tlet\tsomeone\telse\tto manage\tthem)\tand\twe\tare\table\tto\tuse\tthem\tto\tsend\te-mails.\tAgain,\twe are\tspecializing.\tOur\tsystem\tspecializes\tin\tsending\te-mails\tand\tyou leave\tthe\tcreation\tof\tthe\te-mails\tto\tsomeone\telse\t(maybe\tsomeone\tfrom the\tmarketing\tteam\twho\tknows\thow\tto\ttalk\tto\tcustomers).\n\nLet's\tanalyze\tthis\tmicroservice:\n\nData\tis\tstored\tlocally:\tNot\treally\t(it\tis\tstored\tin\tMandrill),\tbut\tfrom the\tdesign\tpoint\tof\tview,\tit\tis Our\tmicroservice\tis\twell\tcohesioned:\tIt\tsends\tonly\te-mails;\tit\tdoes one\tthing,\tand\tdoes\tit\twell The\tsize\tof\tthe\tmicroservice\tis\tcorrect:\tIt\tcan\tbe\tunderstood\tin\ta few\tminutes,\tit\tdoes\tnot\thave\tunnecessary\tabstractions\tand\tcan\tbe rewritten\tfairly\teasily\n\nWhen\twe\ttalked\tabout\tthe\tSOLID\tdesign\tprinciples\tearlier,\twe\talways skipped\tL,\twhich\tstands\tfor\tLiskov\tSubstitution.\tBasically,\tthis\tmeans",
      "content_length": 1555,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 139,
      "content": "that\tthe\tsoftware\thas\tto\tbe\tsemantically\tcorrect.\tFor\texample,\tif\twe\twrite an\tobject-oriented\tprogram\tthat\thandles\tone\tabstract\tclass,\tthe\tprogram has\tto\tbe\table\tto\thandle\tall\tthe\tsubclasses.\n\nComing\tback\tto\tNode.js,\tif\tour\tservice\tis\table\tto\thandle\tsending\ta\tplain e-mail,\tit\tshould\tbe\teasy\tto\textend\tand\tadd\tcapabilities\twithout\tmodifying the\texisting\tones.\n\nThink\tabout\tit\tfrom\tthe\tday-to-day\tproduction\toperations\tpoint\tof\tview;\tif a\tnew\tfeature\tis\tadded\tto\tyour\tsystem,\tthe\tlast\tthing\tyou\twant\tto\tdo\tis retest\tthe\texisting\tfunctionalities\tor\teven\tworse,\tdeliver\tthe\tfeature\tto production,\tintroducing\ta\tbug\tthat\tno\tone\twas\taware\tof.\n\nLet's\tcreate\ta\tuse\tcase.\tWe\twant\tto\tsend\tthe\tsame\te-mail\tto\ttwo recipients.\tAlthough\tMandrill\tAPI\tallows\tthe\tcalling\tcode\tto\tdo\tit,\twe haven't\tfactored\tin\ta\tpotential\tCC.\n\nTherefore,\twe\tare\tgoing\tto\tadd\ta\tnew\taction\tin\tSeneca\tthat\tallows\tus\tto do\tit,\tas\tfollows:\n\n/** \t\t\t\tSends\tan\temail\tincluding\tthe\tcontent. \t\t\t/ \t\tseneca.add({area:\t\"email\",\taction:\t\"send\",\tcc:\t\"*\"},\t function(args,\tdone)\t{ \t\t\t\tvar\tmessage\t=\t{ \t\t\t\t\t\t\"html\":\targs.content, \t\t\t\t\t\t\"subject\":\targs.subject, \t\t\t\t\t\t\"to\":\t[{ \t\t\t\t\t\t\t\t\"email\":\targs.to, \t\t\t\t\t\t\t\t\"name\":\targs.toName, \t\t\t\t\t\t\t\t\"type\":\t\"to\" \t\t\t\t\t\t},{ \t\t\t\t\t\t\t\t\"email\":\targs.cc, \t\t\t\t\t\t\t\t\"name\":\targs.ccName, \t\t\t\t\t\t\t\t\"type\":\t\"cc\" \t\t\t\t\t\t}], \t\t\t\t\t\t\"from_email\":\t\"info@micromerce.com\", \t\t\t\t\t\t\"from_name\":\t\"Micromerce\" \t\t\t\t} \t\t\t\tmandrillClient.messages.send({\"message\":\tmessage},\t function(result)\t{ \t\t\t\t\t\tdone(null,\t{status:\tresult.status}); \t\t\t\t},\tfunction(e)\t{",
      "content_length": 1518,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 140,
      "content": "done({code:\te.name},\tnull); \t\t\t\t}); \t\t});\n\nWe\thave\tinstructed\tSeneca\tto\ttake\tthe\tcalls\tthat\tinclude\tcc\tin\tthe\tlist\tof parameters\tand\tsend\tthem\tusing\ta\tMandrill\tCC\tin\tthe\tsend\tAPI.\tIf\twe want\tto\tuse\tit,\tthe\tfollowing\tsignature\tof\tthe\tcalling\tcode\twill\tchange:\n\nseneca.act({area:\t\"email\",\taction:\t\"send\",\tsubject:\t \"The\tSubject\",\tto:\t\"test@test.com\",\ttoName:\t\"Test\t Testingtong\"},\tfunction(err,\tresult){ //\tMore\tcode\there });\n\nThe\tsignature\twill\tchange\tto\tthe\tfollowing\tcode:\n\nseneca.act({area:\t\"email\",\taction:\t\"send\",\tsubject:\t \"The\tSubject\",\tto:\t\"test@test.com\",\ttoName:\t\"Test\t Testingtong\",\tcc:\t\"test2@test.com\",\tccName:\t\"Test\t2\"},\t function(err,\tresult){ //\tMore\tcode\there });\n\nIf\tyou\tremember\tcorrectly,\tthe\tpattern\tmatching\ttries\tto\tmatch\tthe\tmost concrete\tinput\tso\tthat\tif\tan\taction\tmatches\twith\tmore\tparameters\tthan another\tone,\tthe\tcall\twill\tbe\tdirected\tto\tit.\n\nHere\tis\twhere\tSeneca\tshines:\tWe\tcan\tcall\tit\tpolymorphism\tof\tactions, as\twe\tcan\tdefine\tdifferent\tversions\tof\tthe\tsame\taction\twith\tdifferent parameters\tthat\tend\tup\tdoing\tslightly\tdifferent\tthings\tand\tenabling\tus\tto reutilize\tthe\tcode\tif\twe\tare\t100%\tsure\tthat\tthis\tis\tthe\tright\tthing\tto\tdo (remember,\tmicroservices\tenforce\tthe\tshare-nothing\tapproach:\trepeating the\tcode\tmight\tnot\tbe\tas\tbad\tas\tcoupling\ttwo\tactions).\n\nHere\tis\tthe\tpackage.json\tfor\tthe\temailer\tmicroservice:\n\n{ \t\t\"name\":\t\"emailing\", \t\t\"version\":\t\"1.0.0\", \t\t\"description\":\t\"Emailing\tsub-system\", \t\t\"main\":\t\"index.js\", \t\t\"keywords\":\t[",
      "content_length": 1463,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 141,
      "content": "\"microservices\", \t\t\"emailing\" \t\t], \t\t\"author\":\t\"David\tGonzalez\", \t\t\"license\":\t\"ISC\", \t\t\"dependencies\":\t{ \t\t\"mandrill-api\":\t\"^1.0.45\", \t\t\"seneca\":\t\"^0.8.0\" \t\t} }\n\nThe\tfallback\tstrategy\n\nWhen\tyou\tdesign\ta\tsystem,\tusually\twe\tthink\tabout\treplaceability\tof\tthe existing\tcomponents;\tfor\texample,\twhen\tusing\ta\tpersistence\ttechnology in\tJava,\twe\ttend\tto\tlean\ttowards\tstandards\t(JPA)\tso\tthat\twe\tcan\treplace the\tunderlying\timplementation\twithout\ttoo\tmuch\teffort.\n\nMicroservices\ttake\tthe\tsame\tapproach,\tbut\tthey\tisolate\tthe\tproblem instead\tof\tworking\ttowards\tan\teasy\treplaceability.\tIf\tyou\tread\tthe preceding\tcode,\tinside\tthe\tSeneca\tactions,\twe\thave\tdone\tnothing\tto\thide the\tfact\tthat\twe\tare\tusing\tMandrill\tto\tsend\tthe\te-mails.\n\nAs\tI\tmentioned\tbefore,\temailing\tis\tsomething\tthat,\talthough\tseems simple,\talways\tends\tup\tgiving\tproblems.\n\nImagine\tthat\twe\twant\tto\treplace\tMandrill\tfor\ta\tplain\tSMTP\tserver\tsuch\tas Gmail.\tWe\tdon't\tneed\tto\tdo\tanything\tspecial,\twe\tjust\tchange\tthe implementation\tand\troll\tout\tthe\tnew\tversion\tof\tour\tmicroservice.\n\nThe\tprocess\tis\tas\tsimple\tas\tapplying\tthe\tfollowing\tcode:\n\nvar\tnodemailer\t=\trequire('nodemailer'); var\tseneca\t=\trequire(\"seneca\")(); var\ttransporter\t=\tnodemailer.createTransport({ \t\tservice:\t'Gmail', \t\tauth:\t{ \t\t\t\tuser:\t'info@micromerce.com', \t\t\t\tpass:\t'verysecurepassword' \t\t} });\n\n/**",
      "content_length": 1313,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 142,
      "content": "Sends\tan\temail\tincluding\tthe\tcontent. \t/ seneca.add({area:\t\"email\",\taction:\t\"send\"},\t function(args,\tdone)\t{ \t\tvar\tmailOptions\t=\t{ \t\t\t\tfrom:\t'Micromerce\tInfo\t<info@micromerce.com>', \t\t\t\tto:\targs.to,\t \t\t\t\tsubject:\targs.subject, \t\t\t\thtml:\targs.body \t\t}; \t\ttransporter.sendMail(mailOptions,\tfunction(error,\t info){ \t\t\t\tif(error){ \t\t\t\t\t\tdone({code:\te},\tnull); \t\t\t\t} \t\t\t\tdone(null,\t{status:\t\"sent\"}); \t\t}); });\n\nFor\tthe\touter\tworld,\tour\tsimplest\tversion\tof\tthe\te-mail\tsender\tis\tnow using\tSMTP\tthrough\tGmail\tto\tdeliver\tour\te-mails.\n\nAs\twe\twill\tsee\tlater\tin\tthe\tbook,\tdelivering\ta\tnew\tversion\tof\tthe\tsame interface\tin\ta\tmicroservice\tnetwork\tis\tfairly\teasy;\tas\tlong\tas\twe\trespect the\tinterface,\tthe\timplementation\tshould\tbe\tirrelevant.\n\nWe\tcould\teven\troll\tout\tone\tserver\twith\tthis\tnew\tversion\tand\tsend\tsome traffic\tto\tit\tin\torder\tto\tvalidate\tour\timplementation\twithout\taffecting\tall\tthe customers\t(in\tother\twords,\tcontain\tthe\tfailure).\n\nWe\thave\tseen\thow\tto\twrite\tan\te-mail\tsender\tin\tthis\tsection.\tWe\thave worked\tthrough\ta\tfew\texamples\ton\thow\tour\tmicroservice\tcan\tbe\tadapted quickly\tfor\tnew\trequirements\tas\tsoon\tas\tthe\tbusiness\trequires\tnew capabilities\tor\twe\tdecide\tthat\tour\tvendor\tis\tnot\tgood\tenough\tto\tcope\twith our\ttechnical\trequirements.",
      "content_length": 1233,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 143,
      "content": "The\torder\tmanager\n\nThe\torder\tmanager\tis\ta\tmicroservice\tthat\tprocesses\tthe\torders\tthat\tthe customer\tplaces\tthrough\tthe\tUI.\tAs\tyou\tprobably\tremember,\twe\tare\tnot going\tto\tcreate\ta\tsophisticated\tsingle-page\tapplication\twith\ta\tmodern visual\tframework,\tas\tit\tis\tout\tof\tthe\tscope\tof\tthis\tbook,\tbut\twe\tare\tgoing to\tprovide\tthe\tJSON\tinterface\tin\torder\tto\tbe\table\tto\tbuild\tthe\tfront\tend later.\n\nOrder\tmanager\tintroduces\tan\tinteresting\tproblem:\tthis\tmicroservice needs\taccess\tto\tthe\tinformation\tabout\tproducts,\tsuch\tas\tname,\tprice, availability,\tand\tso\ton.\tHowever,\tit\tis\tstored\tin\tthe\tproduct\tmanager microservice,\tso\thow\tdo\twe\tdo\tthat?\n\nWell,\tthe\tanswer\tfor\tthis\tquestion\tmight\tlook\tsimple,\tbut\trequires\ta\tbit\tof thinking.\n\nDefining\tthe\tmicroservice\t–\thow\tto gather\tnon-local\tdata\n\nOur\tmicroservice\twill\tneed\tto\tdo\tthe\tfollowing\tthree\tthings:\n\nRecover\torders Create\torders Delete\texisting\torders\n\nWhen\trecovering\tan\torder,\tthe\toption\tis\tgoing\tto\tbe\tsimple.\tRecover\tthe order\tby\tthe\tprimary\tkey.\tWe\tcould\textend\tit\tto\trecover\torders\tby\tdifferent criteria,\tsuch\tas\tprice,\tdate,\tand\tso\ton,\tbut\twe\tare\tgoing\tto\tkeep\tit\tsimple as\twe\twant\tto\tfocus\ton\tmicroservices.\n\nWhen\tdeleting\texisting\torders,\tthe\toption\tis\talso\tclear:\tuse\tthe\tID\tto delete\torders.\tAgain,\twe\tcould\tchoose\ta\tmore\tadvanced\tdeletion\tcriteria, but\twe\twant\tto\tkeep\tit\tsimple.\n\nThe\tproblem\tarises\twhen\twe\tare\ttrying\tto\tcreate\torders.\tCreating\tan order\tin\tour\tsmall\tmicroservice\tarchitecture\tmeans\tsending\tan\te-mail\tto",
      "content_length": 1467,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 144,
      "content": "the\tcustomer,\tspecifying\tthat\twe\tare\tprocessing\ttheir\torder,\talong\twith the\tdetails\tof\tthe\torder,\tas\tfollows:\n\nNumber\tof\tproducts Price\tper\tproduct Total\tprice Order\tID\t(in\tcase\tthe\tcustomer\tneeds\tto\ttroubleshoot\tproblems\twith the\torder)\n\nHow\tdo\twe\trecover\tthe\tproduct\tdetails?\n\nIf\tyou\tsee\tour\tdiagram\tshown\tin\tthe\tMicromerce\t–\tthe\tbig\tpicture\tsection of\tthis\tchapter,\torder\tmanager\twill\tonly\tbe\tcalled\tfrom\tthe\tUI,\twhich\twill be\tresponsible\tto\trecover\tthe\tproduct\tname,\tits\tprice,\tand\tso\ton.\tWe could\tadopt\tthe\tfollowing\ttwo\tstrategies\there:\n\nOrder\tmanager\tcalls\tproduct\tmanager\tand\tgets\tthe\tdetails UI\tcalls\tproduct\tmanager\tand\tdelegates\tthe\tdata\tto\tthe\torder manager\n\nBoth\toptions\tare\ttotally\tvalid,\tbut\tin\tthis\tcase,\twe\tare\tgoing\tfor\tthe second:\tUI\twill\tgather\tthe\tinformation\tneeded\tto\tgenerate\tan\torder\tand\tit will\tonly\tcall\tthe\torder\tmanager\twhen\tall\tthe\tdata\trequired\tis\tavailable.\n\nNow\tto\tanswer\tthe\tquestion:\twhy?\n\nA\tsimple\treason:\tfailure\ttolerance.\tLet's\ttake\ta\tlook\tat\tthe\tfollowing sequence\tdiagram\tof\tthe\ttwo\toptions:",
      "content_length": 1032,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 145,
      "content": "The\tdiagram\tfor\tthe\tsecond\toption\tis\tshown\tas\tfollows:",
      "content_length": 54,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 146,
      "content": "In\tthe\tfirst\tview,\tthere\tis\ta\tbig\tdifference:\tthe\tdepth\tof\tthe\tcall;\twhereas\tin the\tfirst\texample,\twe\thave\ttwo\tlevels\tof\tdepth\t(UI\tcalls\tthe\torder manager,\twhich\tcalls\tthe\tproduct\tmanager).\tIn\tthe\tsecond\texample,\twe have\tonly\tone\tlevel\tof\tdepth.\tThere\tare\ta\tfew\timmediate\teffects\tin\tour architecture,\tas\tfollows:\n\nWhen\tsomething\tgoes\twrong,\tif\twe\tonly\thave\tone\tlevel\tof\tdepth,\twe don't\tneed\tto\tcheck\tin\ttoo\tmany\tplaces. We\tare\tmore\tresilient.\tIf\tsomething\tgoes\twrong,\tit\tis\tthe\tUI\tof\tthe microservice\tthat\tnotices\tit,\treturning\tthe\tappropriate\tHTTP\tcode,\tin this\tcase,\twithout\thaving\tto\ttranslate\tthe\terrors\tthat\toccurred\ta\tfew levels\tabove\tthe\tclient-facing\tmicroservice. It\tis\teasier\tto\tdeploy\tand\ttest.\tNot\tmuch\teasier,\tbut\twe\tdon't\tneed\tto juggle\taround,\twe\tcan\tsee\tstraight\taway\tif\tthe\tproduct\tmanager\tis reached\tfrom\tthe\tUI,\tinstead\tof\thaving\tto\tgo\tthrough\tthe\torder manager.\n\nThe\tfact\tthat\twe\tare\tusing\tthis\tarchitecture\tinstead\tof\tthe\ttwo-level\tdepth",
      "content_length": 958,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 147,
      "content": "does\tnot\tmean\tthat\tit\tisn't\tappropriate\tfor\tanother\tsituation:\tthe\tnetwork topology\tis\tsomething\tthat\tyou\tneed\tto\tplan\tahead\tif\tyou\tare\tcreating\ta microservices-oriented\tarchitecture,\tas\tit\tis\tone\tof\tthe\thardest\taspects\tto change.\n\nIn\tsome\tcases,\tif\twe\twant\tto\tbe\textremely\tflexible,\twe\tcan\tuse\ta messaging\tqueue\twith\tpublisher/subscriber\ttechnology\twhere\tour microservices\tcan\tsubscribe\tto\tdifferent\ttypes\tof\tmessages\tand\temit others\tto\tbe\tconsumed\tby\ta\tdifferent\tservice,\tbut\tit\tcould\tcomplicate\tthe infrastructure\tthat\twe\tneed\tto\tput\tin\tplace\tto\tavoid\tsingle\tpoint\tof\tfailures.\n\nThe\torder\tmanager\t–\tthe\tcode\n\nLet's\ttake\ta\tlook\tat\tthe\tcode\tfor\tthe\torder\tmanager:\n\nvar\tplugin\t=\tfunction(options)\t{ \t\tvar\tseneca\t=\tthis;\n\nseneca.add({area:\t\"orders\",\taction:\t\"fetch\"},\t function(args,\tdone)\t{ \t\t\t\tvar\torders\t=\tthis.make(\"orders\"); \t\t\t\torders.list$({id:\targs.id},\tdone); \t\t});\n\nseneca.add({area:\t\"orders\",\taction:\t\"delete\"},\t function(args,\tdone)\t{ \t\t\t\tvar\torders\t=\tthis.make(\"orders\"); \t\t\t\torders.remove$({id:\targs.id},\tfunction(err)\t{ \t\t\t\t\t\t\t\tdone(err,\tnull); \t\t\t\t}); \t\t}); } module.exports\t=\tplugin;\n\nAs\tyou\tcan\tsee,\tthere\tis\tnothing\tcomplicated\tabout\tthe\tcode.\tThe\tonly interesting\tpoint\tis\tthe\tmissing\tcode\tfrom\tthe\tcreate\taction.\n\nCalling\tremote\tservices\n\nUntil\tnow,\twe\thave\tassumed\tthat\tall\tour\tmicroservices\trun\tin\tthe\tsame machine,\tbut\tthat\tis\tfar\tfrom\tideal.\tIn\tthe\treal\tworld,\tmicroservices\tare distributed\tand\twe\tneed\tto\tuse\tsome\tsort\tof\ttransport\tprotocol\tto\tcarry",
      "content_length": 1474,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 148,
      "content": "the\tmessage\tfrom\tone\tservice\tto\tanother.\n\nSeneca,\tas\twell\tas\tnearForm,\tthe\tcompany\tbehind\tSeneca,\thas\tsorted this\tproblem\tfor\tus\tand\tthe\topen\tsource\tcommunity\taround\tit.\n\nAs\ta\tmodular\tsystem,\tSeneca\thas\tembedded\tthe\tconcept\tof\tplugin.\tBy default,\tSeneca\tcomes\twith\ta\tbundled\tplugin\tto\tuse\tTCP\tas\tthe\tprotocol, but\tit\tis\tnot\thard\tto\tcreate\ta\tnew\ttransport\tplugin.\n\nNote\n\nWhile\twriting\tthis\tbook,\tI\tcreated\tone\tby\tmyself: https://github.com/dgonzalez/seneca-nservicebus-transport/\n\nWith\tthis\tplugin,\twe\tcould\troute\tthe\tSeneca\tmessages\tthrough NServiceBus\t(a\t.NET-based\tEnterprise\tBus),\tchanging\tthe\tconfiguration of\tour\tclient\tand\tserver.\n\nLet's\tsee\thow\tto\tconfigure\tSeneca\tto\tpoint\tto\ta\tdifferent\tmachine:\n\nvar\tsenecaEmailer\t=\trequire(\"seneca\")().client({host:\t \"192.168.0.2\",\tport:\t8080});\n\nBy\tdefault,\tSeneca\twill\tuse\tthe\tdefault\tplugin\tfor\ttransport,\twhich\tas we've\tseen\tin\tChapter\t2,\tMicroservices\tin\tNode.js\t–\tSeneca\tand\tPM2 Alternatives,\tis\ttcp,\tand\twe\thave\tspecified\tit\tto\tpoint\tto\tthe\t192.168.0.2 host\ton\tthe\t8080\tport.\n\nAs\tsimple\tas\tthat,\tfrom\tnow\ton,\twhen\twe\texecute\tan\tact\tcommand\ton senecaEmailer,\tthe\ttransport\twill\tsend\tthe\tmessage\tacross\tto\tthe\temailer and\treceives\tthe\tresponse.\n\nLet's\tsee\tthe\trest\tof\tthe\tcode:\n\nseneca.add({area:\t\"orders\",\taction:\t\"create\"},\t function(args,\tdone)\t{ \t\t\t\tvar\tproducts\t=\targs.products; \t\t\t\tvar\ttotal\t=\t0.0; \t\t\t\tproducts.forEach(function(product){",
      "content_length": 1393,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 149,
      "content": "total\t+=\tproduct.price; \t\t\t\t}); \t\t\t\tvar\torders\t=\tthis.make(\"orders\"); \t\t\t\torders.total\t=\ttotal; \t\t\t\torders.customer_email\t=\targs.email; \t\t\t\torders.customer_name\t=\targs.name; \t\t\t\torders.save$(function(err,\torder)\t{ \t\t\t\t\t\tvar\tpattern\t=\t{ \t\t\t\t\t\t\t\tarea:\t\"email\",\t \t\t\t\t\t\t\t\taction:\t\"send\",\t \t\t\t\t\t\t\t\ttemplate:\t\"new_order\",\t \t\t\t\t\t\t\t\tto:\targs.email, \t\t\t\t\t\t\t\ttoName:\targs.name, \t\t\t\t\t\t\t\tvars:\t{ \t\t\t\t\t\t\t\t\t\t//\t...\tvars\tfor\trendering\tthe\ttemplate\t including\tthe\tproducts\t... \t\t\t\t\t\t\t\t} \t\t\t\t\t\t} \t\t\t\t\t\tsenecaEmailer.act(pattern,\tdone); \t\t\t\t}); \t\t});\n\nAs\tyou\tcan\tsee,\twe\tare\treceiving\ta\tlist\tof\tproducts\twith\tall\tthe\tdata needed\tand\tpassing\tthem\tto\tthe\temailer\tto\trender\tthe\te-mail.\n\nIf\twe\tchange\tthe\thost\twhere\tthe\temailer\tlives,\tthe\tonly\tchange\tthat\twe need\tto\tdo\there\tis\tthe\tconfiguration\tof\tthe\tsenecaEmailer\tvariable.\n\nEven\tif\twe\tchange\tthe\tnature\tof\tthe\tchannel\t(we\tcould\tpotentially\teven write\ta\tplugin\tto\tsend\tthe\tdata\tover\tTwitter,\tfor\texample),\tthe\tplugin should\tlook\tafter\tthe\tparticularities\tof\tit\tand\tbe\ttransparent\tfor\tthe application.\n\nResilience\tover\tperfection\n\nIn\tthe\texample\tfrom\tthe\tpreceding\tsection,\twe\tbuilt\ta\tmicroservice\tthat calls\tanother\tmicroservice\tin\torder\tto\tresolve\tthe\tcall\tthat\tit\treceives. However,\tthe\tfollowing\tpoints\tneed\tto\tbe\tkept\tin\tmind:\n\nWhat\thappens\tif\tthe\temailer\tis\tdown? What\thappens\tif\tthe\tconfiguration\tis\twrong\tand\tthe\temailer\tis\tnot working\ton\tthe\tcorrect\tport?",
      "content_length": 1394,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 150,
      "content": "We\tcould\tbe\tthrowing\twhat\tifs\tfor\tfew\tpages.\n\nHumans\tare\timperfect\tand\tso\tare\tthe\tthings\tthat\tthey\tbuild,\tand\tsoftware is\tnot\tan\texception.\tHumans\tare\talso\tbad\tat\trecognizing\tthe\tpotential problems\tin\tlogical\tflows,\tand\tsoftware\ttends\tto\tbe\ta\tcomplex\tsystem.\n\nIn\tother\tlanguages,\tplaying\twith\texceptions\tis\talmost\tsomething\tnormal, but\tin\tJavaScript,\texceptions\tare\ta\tbig\tdeal:\n\nIf\tan\texception\tbubbles\tout\tin\ta\tweb\tapp\tin\tJava,\tit\tkills\tthe\tcurrent stack\tof\tcalls\tand\tTomcat\t(or\tthe\tcontainer\tthat\tyou\tuse)\treturns\tan error\tto\tthe\tclient If\tan\texception\tbubbles\tout\tin\ta\tNode.js\tapp,\tthe\tapplication\tis\tkilled as\twe\tonly\thave\tone\tthread\texecuting\tthe\tapp\n\nAs\tyou\tcan\tsee,\tpretty\tmuch\tevery\tsingle\tcallback\tin\tNode.js\thas\ta\tfirst parameter\tthat\tis\tan\terror.\n\nWhen\ttalking\tabout\tmicroservices,\tthis\terror\tis\tespecially\timportant.\tYou want\tto\tbe\tresilient.\tThe\tfact\tthat\tan\te-mail\thas\tfailed\tsending\tdoes\tnot mean\tthat\tthe\torder\tcannot\tbe\tprocessed,\tbut\tthe\te-mail\tcould\tbe manually\tsent\tlater\tby\tsomeone\treprocessing\tthe\tdata.\tThis\tis\twhat\twe call\teventual\tconsistency;\twe\tfactor\tinto\tour\tsystem\tthe\tfact\tthat\tat\tsome point\tour\tsystem\tis\tgoing\tto\tcrash.\n\nIn\tthis\tcase,\tif\tthere\tis\ta\tproblem\tsending\tthe\te-mail,\tbut\twe\tcould\tstore the\torder\tin\tthe\tdatabase,\tthe\tcalling\tcode,\tin\tthis\tcase\tthe\tUI,\tshould have\tenough\tinformation\tto\tdecide\twhether\tthe\tcustomer\tgets\ta\tfatal message\tor\tjust\ta\twarning:\n\nYour\torder\tis\tready\tto\tbe\tprocessed,\thowever\tit\tmight\ttake\tus\ttwo\tdays\tto send\tyou\tthe\te-mail\twith\tthe\torder\tdetails.\tThanks\tfor\tyour\tpatience.\n\nUsually,\tthe\tfact\tthat\tour\tapplication\twill\tkeep\tworking\teven\tif\twe\tcannot complete\ta\trequest,\tit\tis\tusually\tmore\tbusiness\tthan\ttechnical\tdecision. This\tis\tan\timportant\tdetail,\tas\twhen\tbuilding\tmicroservices,\tConway's\tlaw is\tpushing\tus,\tthe\ttechnical\tpeople,\tto\tmodel\tthe\texisting\tbusiness process\tand\tpartial\tsuccess\tmaps\tperfectly\tto\tthe\thuman\tnature.\tIf\tyou can't\tcomplete\ta\ttask,\tcreate\ta\treminder\tin\tEvernote\t(or\ta\tsimilar\ttool) and\tcome\tback\tto\tit\tonce\tthe\tblocker\tis\tresolved.",
      "content_length": 2026,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 151,
      "content": "This\treads\tmuch\tbetter\tthan\tthe\tfollowing:\n\nSomething\thappened\tabout\tsomething,\tbut\twe\tcan't\ttell\tyou\tmore\t(which is\twhat\tmy\tmind\treads\tsometimes\twhen\tI\tget\ta\tgeneral\tfailure\tin\tsome websites).\n\nWe\tcall\tthis\tway\tof\thandling\terrors\tsystem\tdegradation:\tit\tmight\tnot\tbe 100%\tfunctional,\tbut\tit\twill\tstill\twork\teven\tthough\tits\tfew\tfeatures\tare\tnot available,\tinstead\tof\ta\tgeneral\tfailure.\n\nIf\tyou\tthink\tfor\ta\tsecond,\thow\tmany\ttimes\ta\tweb\tservice\tcall\thas\trolled back\ta\tfull\ttransaction\tin\tyour\tbig\tcorporate\tsystem\tonly\tbecause\tit couldn't\treach\ta\tthird-party\tservice\tthat\tmight\tnot\teven\tbe\timportant?\n\nIn\tthis\tsection,\twe\tbuilt\ta\tmicroservice\tthat\tuses\tanother\tmicroservice\tto resolve\ta\trequest\tfrom\ta\tcustomer:\torder\tmanager\tuses\temailer\tto complete\tthe\trequest.\tWe\thave\talso\ttalked\tabout\tresilience\tand\thow important\tit\tis\tin\tour\tarchitecture\tin\torder\tto\tprovide\tthe\tbest\tservice.",
      "content_length": 879,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 152,
      "content": "The\tUI\t–\tAPI\taggregation\n\nUntil\tnow,\twe\thave\tbuilt\tindependent\tmicroservices.\tThey\thad\ta\tspecific purpose\tand\tdealt\twith\tone\tspecific\tpart\tof\tour\tsystem:\te-mail\tsending, product\tmanagement,\tand\torder\tprocessing,\tbut\tnow\twe\tare\tbuilding\ta microservice\twhose\tonly\tpurpose\tis\tto\tfacilitate\tthe\tcommunication between\tmicroservices.\n\nNow\twe\tare\tgoing\tto\tbuild\ta\tmicroservice\tthat\tinteracts\twith\tothers\tand\tis the\tfront-facing\tfaçade\tto\tthe\tcustomer.\n\nWhen\tI\twas\tplanning\tthe\tcontents\tof\tthis\tchapter,\ta\tservice\tlike\tthis\tone wasn't\tin\tit.\tHowever,\tafter\tthinking\tabout\tit,\tthis\tchapter\twouldn't\thave been\tthe\tsame\twithout\tshowing\ta\tfew\tconcepts\taround\tAPI\taggregation that\tare\tfairly\teasy\tto\tshow\tin\ta\tfrontend\tmicroservice.\n\nNeed\tfor\tfrontend\tmicroservice\n\nThink\tabout\tscalability.\tWhen\tdealing\twith\tHTTP\ttraffic,\tthere\tis\ta pyramid\tof\ttraffic.\tThere\tare\tmore\thits\tin\tthe\tfrontend\tthan\tin\tthe backend.\tUsually,\tin\torder\tto\treach\tthe\tbackend,\tthe\tfrontend\tneeds\tto process\tthe\tfollowing\tfew\trequests\tfrom\tthe\tfrontend:\n\nRead\ta\tform Validate\tit Manage\tthe\tPRG\tpattern (https://en.wikipedia.org/wiki/Post/Redirect/Get)\n\nAs\tyou\tcan\tsee,\tthere\tis\ta\tlot\tof\tlogic\tthat\tneeds\tto\tbe\tprocessed\tby\tthe frontend,\tso\tthat\tit\tis\tnot\thard\tto\tsee\tcapacity\tproblems\tif\tthe\tsoftware\tis busy.\tIf\twe\tare\tusing\ta\tmicroservice,\tand\twe\tare\tusing\tit\tin\tthe\tright\tway, scaling\tup\tor\tdown\tshould\tbe\tan\tautomatic\tprocess\tthat\tcan\tbe\ttriggered with\ta\tcouple\tof\tclicks\t(or\tcommands).\n\nThe\tcode\n\nUntil\tnow,\twe\thave\tpretty\tmuch\talways\ttested\tthe\tcode\tin\ta\tsingle\tserver.",
      "content_length": 1535,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 153,
      "content": "This\tis\tfine\tfor\ttesting,\tbut\twhen\twe\tare\tbuilding\tmicroservices,\twe\twant them\tto\tbe\tdistributed.\tTherefore,\tin\torder\tto\tachieve\tit,\twe\tneed\tto indicate\tto\tSeneca\thow\tto\treach\tthe\tservices:\n\nvar\tsenecaEmailer\t=\trequire(\"seneca\")().client({ \t\thost:\t\"192.168.0.2\",\t \t\tport:\t8080 }); var\tsenecaProductManager\t=\trequire(\"seneca\") ().client({ \t\thost:\t\"192.168.0.3\",\t \t\tport:\t8080 }); var\tsenecaOrderProcessor\t=\trequire(\"seneca\") ().client({ \t\thost:\t\"192.168.0.4\",\t \t\tport:\t8080 });\n\nWhat\twe\thave\tdone\tis\tcreate\tthree\tSeneca\tinstances.\tThey\tare\tlike communication\tpipes\tbetween\tservers.\n\nLet's\texplain\tthe\tcode:\n\nSeneca,\tby\tdefault,\tuses\tthe\ttransport\tplugin\tTCP.\tIt\tmeans\tthat\tSeneca will\tbe\tlistening\tto\tthe\t/act\tURL\ton\tthe\tserver.\tAs\tan\texample,\twhen\twe create\tsenecaEmailer,\tthe\tURL\twhere\tSeneca\twill\tbe\tpointing\tto\tis http://192.168.0.2:8080/act.\n\nWe\tcan\tactually\tverify\tit\twith\tcurl.\tIf\twe\texecute\tthe\tfollowing\tcommand line,\treplacing\t<valid\tSeneca\tpattern>\tby\ta\tvalid\tSeneca\tcommand,\twe should\tget\ta\tresponse\tfrom\tthe\tserver\tin\tthe\tJSON\tformat,\twhich\twould be\tthe\tsecond\tparameter\tin\tthe\tdone\tfunction\tfor\tthe\taction:\n\ncurl\t-d\t'<valid\tSeneca\tpattern>'\t-v\t http://192.168.0.2:8080/act\n\nTip\n\nSeneca's\tdefault\ttransport\tplugin\tis\tTCP.\tIf\twe\tdon't\tspecify\tany\tother, Seneca\twill\tuse\tit\tto\treach\tother\tservers\tand\tlisten\tto\tcalls.",
      "content_length": 1327,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 154,
      "content": "Let's\tsee\tan\teasy\texample:\n\nvar\tseneca\t=\trequire(\"seneca\")(); seneca.add({cmd:\t\"test\"},\tfunction(args,\tdone)\t{ \t\tdone(null,\t{response:\t\"Hello\tWorld!\"}); });\n\nseneca.listen({port:\t3000});\n\nIf\twe\trun\tthis\tprogram,\twe\tcan\tsee\tthe\tfollowing\toutput\tfrom\tthe\tterminal:\n\nIt\tmeans\tthat\tSeneca\tis\tlistening\tto\tthe\tport\t3000.\tLet's\ttest\tit:\n\ncurl\t-d\t'{\"cmd\":\t\"test\"}'\t-v\thttp://127.0.0.1:3000/act\n\nThis\tshould\tprint\tsomething\tvery\tsimilar\tto\tthe\tfollowing\tcode\tin\tthe terminal:",
      "content_length": 467,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 155,
      "content": "The\tpreceding\tcode\tis\tthe\tTCP/IP\tdialog\tbetween\tour\tterminal\tand Seneca\tserver\twith\tthe\tresult\tof\tthe\tresponse\tin\tthe\tlast\tline.\n\nSo,\twhat\twe\tachieved\tearlier\ton\thaving\tthree\tdifferent\tinstances\tof Seneca\tis\tconfiguring\tour\tnetwork\tof\tmicroservices;\tSeneca\twill\ttransport the\tmessages\tacross\tthe\tnetwork\tfor\tus.\n\nThe\tfollowing\tflow\tdiagram\tdescribes\thow\ta\tsingle\tAPI\tcan\thide\tmultiple Seneca\tservers\tin\tthe\tbackend\twith\tdifferent\tmicroservices\t(different Seneca\tinstances,\tbasically):",
      "content_length": 484,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 156,
      "content": "Now,\tlet's\ttake\ta\tlook\tat\tthe\tskeleton\tof\tthe\tmicroservice:\n\nvar\texpress\t=\trequire(\"express\"); var\tbodyParser\t=\trequire('body-parser'); var\tsenecaEmailer\t=\trequire(\"seneca\")().client({ \t\thost:\t\"192.168.0.2\",\t \t\tport:\t8080 }); var\tsenecaProductManager\t=\trequire(\"seneca\") ().client({ \t\thost:\t\"192.168.0.3\",\t \t\tport:\t8080 }); var\tsenecaOrderProcessor\t=\trequire(\"seneca\") ().client({ \t\thost:\t\"192.168.0.4\",\t \t\tport:\t8080 });\n\nfunction\tapi(options)\t{ \t\tvar\tseneca\t=\tthis;\n\n/** \t\t\t\tGets\tthe\tfull\tlist\tof\tproducts \t\t\t/ \t\tseneca.add({area:\t\"ui\",\taction:\t\"products\"},\t function(args,\tdone)\t{ \t\t\t\t//\tMore\tcode\tto\tcome \t\t}); \t\t/** \t\t\t\tGet\ta\tproduct\tby\tid",
      "content_length": 644,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 157,
      "content": "/ \t\tseneca.add({area:\t\"ui\",\taction:\t\"productbyid\"},\t function(args,\tdone)\t{ \t\t\t\t//\tMore\tcode\tto\tcome \t\t});\n\n/** \t\t\t\tCreates\tan\torder \t\t\t/ \t\tseneca.add({area:\t\"ui\",\taction:\t\"createorder\"},\t function(args,\tdone)\t{ \t\t\t\t//\tMore\tcode\tto\tcome \t\t});\n\nthis.add(\"init:api\",\tfunction(msg,\trespond){ \t\t\t\tseneca.act('role:web',{\tuse:\t{ \t\t\t\t\t\tprefix:\t'/api', \t\t\t\t\t\tpin:\t\t'area:ui,action:*', \t\t\t\t\t\tmap:\t{ \t\t\t\t\t\t\t\tproducts:\t\t{GET:true}\t\t \t\t\t\t\t\t\t\tproductbyid:\t{GET:true,\tsuffix:'/:id'} \t\t\t\t\t\t\t\tcreateorder:\t{POST:true} \t\t\t\t\t\t} \t\t\t\t}},\trespond) \t\t}); } module.exports\t=\tapi; var\tseneca\t=\trequire(\"seneca\")(); seneca.use(api);\n\nvar\tapp\t=\trequire(\"express\")(); app.use(\trequire(\"body-parser\").json()); app.use(seneca.export(\"web\")); app.listen(3000);\n\nWe\thave\tactually\tleft\tthe\tfunctionality\tthat\tcalls\tother\tmicroservices\tfor later\tdiscussion.\tNow\twe\tare\tgoing\tto\tfocus\ton\thow\tthe\tcode\tis articulated:\n\nWe\tare\tcreating\ta\tnew\tplugin.\tThe\tplugin\tis\tcalled\tapi\t(the\tname\tof the\tfunction\tfor\twrapping\tthe\tplugin\tis\tapi). The\tplugin\thas\tto\tperform\tthe\tfollowing\tthree\tactions:\n\nList\tall\tthe\tproducts Get\ta\tproduct\tby\tID Create\tan\torder",
      "content_length": 1112,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 158,
      "content": "These\tthree\tactions\twill\tcall\tto\ttwo\tdifferent\tmicroservices:\tProduct Manager\tand\tOrder\tManager.\tWe\twill\tcome\tback\tto\tthis\ttopic\tlater.\n\nTip\n\nSeneca\tcan\tbe\tseamlessly\tintegrated\twith\tExpress\tin\torder\tto\tprovide web\tcapabilities\tto\tSeneca\tmicroservices.\n\nUntil\there,\teverything\tis\twell\tknown,\tbut\twhat\tabout\tthe\tinitialization function\tof\tthe\tplugin?\n\nAt\tfirst\tlook,\tit\tlooks\tlike\tdark\tmagic:\n\nthis.add(\"init:api\",\tfunction(msg,\trespond){ \t\t\t\tseneca.act('role:web',{\tuse:\t{ \t\t\t\t\t\tprefix:\t'/api', \t\t\t\t\t\tpin:\t\t'area:ui,action:*', \t\t\t\t\t\tmap:\t{ \t\t\t\t\t\t\t\tproducts:\t\t{GET:true}\t\t \t\t\t\t\t\t\t\tproductbyid:\t{GET:true,\tsuffix:'/:id'} \t\t\t\t\t\t\t\tcreateorder:\t{POST:true} \t\t\t\t\t\t} \t\t\t\t}},\trespond) \t\t});\n\nLet's\texplain\tit:\n\n1.\t Seneca\twill\tcall\tthe\tinit:\t<plugin-name>\taction\tin\torder\tto\tinitialize the\tplugin.\n\n2.\t Through\tthe\tprefix\targument,\twe\tare\tlistening\tto\tURLs\tunder\tthe /api\tpath.\n\n3.\t We\tare\tinstructing\tSeneca\tto\tmap\tthe\tURLs\tto\taction\tby\tpinning\ta base\tcommon\targument.\tIn\tthis\tcase,\tall\tour\tseneca.add(..) contains\tan\targument\tcalled\tarea\twith\tthe\tui\tvalue.\tWe\tare\talso asking\tSeneca\tto\troute\tcalls\tthat\tcontain\tthe\taction\targument\t(no matter\tthe\tvalue,\tthat\tis\twhy\twe\tuse\tthe\t*)\tso\tthat\tit\twould\tignore calls\tthat\tdon't\tspecify\tthe\taction\targument.\n\nThe\tfollowing\targument\t(map)\tspecifies\tthe\tmethods\tallowed\tin\tthe",
      "content_length": 1309,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 159,
      "content": "matching.\n\nHow\tis\tthe\targument\tmatching\tdone?\n\nThe\tarea\targument\tis\timplicit\tas\twe\thave\tpinned\tit\twith\tthe\tui\tvalue.\n\nThe\taction\targument\tneeds\tto\tbe\tpresent.\n\nThe\tURL\tmust\tstart\twith\t/api\tas\twe\tspecified\ta\tprefix.\n\nSo,\twith\tthis\tinformation,\tapiproducts\twill\tcorrespond\tto\tthe\t{area:\t\"ui\", action:\t\"products\"}\taction.\tIn\tthe\tsame\tway,\tapicreateorder\twill correspond\tto\tthe\t{area:\t\"ui\",\taction:\"createorder\"}\taction.\n\nThe\tProductbyid\targument\tis\ta\tbit\tspecial.\n\nTip\n\nThe\tSeneca\tpin\tkeyword\tis\tused\tto\tassume\tthat\tthe\tcalling\tcode\thas a\tpair\tof\targument-value\tso\tthat\tit\tmakes\tthe\tcode\teasier\tto understand,\tbut\tbe\tcareful,\timplicit\tvalues\tcan\thave\tbad\teffects\tto\tthe readability.\n\nNow,\talthough\tit\tis\tnot\tsimple,\tthis\tlooks\tmuch\teasier.\n\nLet's\tgo\tback\tto\tthe\tSeneca\tactions\tthat\tare\tgoing\tto\tprovide\tthe functionality:\n\n/** \t\t\t*\tGets\tthe\tfull\tlist\tof\tproducts.\n\nseneca.add({area:\t\"ui\",\taction:\t\"products\"},\t function(args,\tdone)\t{ \t\t\t\tsenecaProductManager.act({area:\t\"product\",\taction:\t \"fetch\"},\tfunction(err,\tresult)\t{ \t\t\t\t\t\tdone(err,\tresult); \t\t\t\t}); \t\t});\n\n*\tGet\ta\tproduct\tby\tid.",
      "content_length": 1083,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 160,
      "content": "seneca.add({area:\t\"ui\",\taction:\t\"productbyid\"},\t function(args,\tdone)\t{ \t\t\t\tsenecaProductManager.act({area:\t\"product\",\taction:\t \"fetch\",\tcriteria:\t\"byId\",\tid:\targs.id},\tfunction(err,\t result)\t{ \t\t\t\t\t\tdone(err,\tresult); \t\t\t\t}); \t\t});\n\nCreates\tan\torder\tto\tbuy\ta\tsingle\tprodct. \t\t\t/ \t\tseneca.add({area:\t\"ui\",\taction:\t\"createorder\"},\t function(args,\tdone)\t{ \t\t\t\tsenecaProductManager.act({area:\t\"product\",\taction:\t \"fetch\",\tcriteria:\t\"byId\",\tid:\targs.id},\tfunction(err,\t product)\t{ \t\t\t\t\t\tif(err)\tdone(err,\tnull); \t\t\t\t\t\tsenecaOrderProcessor.act(area:\t\"orders\",\taction:\t \"create\",\tproducts:\t[product],\temail:\targs.email,\t name:\targs.name,\tfunction(err,\torder)\t{ \t\t\t\t\t\t\t\tdone(err,\torder); \t\t\t\t\t\t}); \t\t\t\t}); \t\t});\n\nNote\n\nWarning!\tIn\tthe\tservices\twritten\tin\tthis\tchapter,\tthere\tis\tno\tdata validation\tperformed\tin\torder\tto\tmake\tthe\tconcepts\taround\tthe\tdesign of\tmicroservices\tclear.\tYou\tshould\talways\tvalidate\tthe\tincoming\tdata from\tuntrusted\tsystems\t(such\tas\tcustomers\tinput).\n\nWe\tare\tactually\tusing\teverything\tthat\twe've\tdiscussed\tin\tthe\tprevious chapters,\tbut\twe\tare\ttaking\ta\tstep\tforward\tin\tthe\tSeneca\tsemantics.\n\nWe\thave\tcreated\tan\tAPI\twith\ta\tvery\tlimited\tset\tof\tfunctionalities,\tbut through\tthem,\twe\tare\taggregating\tthe\tfunctionality\tof\tdifferent microservices\tinto\tone.\n\nA\tdetail\tto\ttake\tinto\taccount\tis\tthe\tamount\tof\tnested\tcalls\tin\tthe\tcreate order\taction\t(the\tlast\tone).\tIn\tthis\tcase,\twe\tare\tcreating\torders\tout\tof\tonly",
      "content_length": 1418,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 161,
      "content": "a\tproduct\tto\tsimplify\tthe\tcode,\tbut\tif\twe\tare\tnesting\ttoo\tmany\tcalls\tfor non-blocking\tactions\twaiting\tfor\tthe\tresponse\tin\ta\tcallback,\twe\twill\tend up\thaving\ta\tpyramid\tof\tcode\tthat\tmakes\tyour\tprogram\tdifficult\tto\tread.\n\nThe\tsolution\tfor\tit\twould\tbe\tto\trefactor\thow\tthe\tdata\tis\tfetched\tand/or reorganize\tthe\tanonymous\tfunctions,\tavoiding\tinlining.\n\nAnother\tsolution\tis\tthe\tusage\tof\tpromises\tlibraries\tsuch\tas\tQ\tor\tBluebird (http://bluebirdjs.com/)\tthat\tallow\tus\tto\tchain\tthe\tflow\tof\tthe\tmethods through\tpromises:\n\nmyFunction().then(function()\t{ //\tCode\there }).then(function(){ //\tMore\tcode\there }).catch(function(error){ //\tHandle\tthe\terror. });\n\nIn\tthis\tway,\tinstead\tof\tbuilding\ta\tsea\tof\tcallbacks,\twe\tare\tnicely\tchaining the\tcalls\tto\tthe\tmethods\tand\tadding\terror\thandlers\tto\tavoid\tthe exceptions\tfrom\tbubbling\tup.\n\nAs\tyou\tcan\tsee,\twe\tare\tusing\tthe\tUI\tas\ta\tcentral\tpoint\tof\tcommunication for\tall\tthe\tmicroservices,\texcept\tfor\tthe\tmailer,\tand\twe\thave\ta\treally\tgood reason\tfor\tit.\n\nService\tdegradation\t–\twhen\tthe\tfailure\tis not\ta\tdisaster\n\nMicroservices\tare\tgreat,\tand\twe\thave\tdemonstrated\tthat\tby\twriting\ta small\tsystem\tin\ta\tfew\thundred\tlines\tof\tcode\tthat\tis\tfairly\teasy\tto understand.\n\nThey\tare\talso\tgreat\tas\tthey\tallow\tus\tto\treact\tin\tthe\tevent\tof\ta\tfailure:\n\nWhat\thappens\tif\tthe\temailer\tmicroservice\tstops\tworking? What\thappens\tif\tthe\torder\tprocessor\tstops\tworking? Can\twe\trecover\tfrom\tthe\tsituation?",
      "content_length": 1400,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 162,
      "content": "What\tdoes\tthe\tcustomer\tsee?\n\nThese\tquestions,\ton\ta\tmonolithic\tsystem,\tare\tnonsense.\tThe\temailer probably\twould\tbe\ta\tpart\tof\tthe\tapplication.\tThe\tfailure\ton\tsending\tan\te- mail\timplies\ta\tgeneral\terror,\tunless\tit\tis\tspecifically\thandled.\tSame\twith the\torder\tprocessor.\n\nHowever,\twhat\tabout\tour\tmicroservices-oriented\tarchitecture?\n\nThe\tfact\tthat\tthe\temailer\thas\tfailed\tto\tdeliver\ta\tfew\te-mails\tdoes\tnot prevent\tthe\torders\tfrom\tbeing\tprocessed,\teven\tthough\tthe\tcustomers aren't\tgetting\tthe\te-mails.\tThis\tis\twhat\twe\tcall\tperformance\tor\tservice degradation;\tthe\tsystem\tmight\tbe\tslower,\tbut\tsome\tfunctionalities\twill\tstill work.\n\nTip\n\nService\tdegradation\tis\tthe\tability\tof\ta\tsystem\tto\tlose\ta\tfeature\twithout suffering\ta\tgeneral\tfailure.\n\nWhat\tabout\tthe\torder\tmanager?\tWell...we\tcan\tstill\tmake\tthe\tproducts- related\tcalls\twork,\tbut\twe\twon't\tbe\table\tto\tprocess\tany\torder…which might\tstill\tbe\ta\tgood\tthing.\n\nThe\tfact\tthat\tthe\torder\tmanager\tis\tresponsible\tfor\tsending\tthe\te-mail instead\tof\tthe\tUI\tmicroservice\tis\tnot\tcoincidental;\twe\tonly\twant\tto\tsend the\te-mail\twith\tthe\tacknowledgement\tof\ta\tsale\ton\tthe\tsuccess\tevent,\tand we\tdon't\twant\tto\tsend\tthe\tsuccess\te-mail\tin\tany\tother\tcase.\n\nCircuit\tbreakers\n\nIn\tthe\tprevious\tsection,\twe\ttalked\tabout\tsystem\tdegradation\tin\tthe\tevent of\ta\tfailure,\tbut\teverybody\twho\thas\tworked\tin\tIT\tfor\ta\tnumber\tof\tyears knows\tthat\ta\tsystem\tdoes\tnot\tfail\tsuddenly\tin\tmost\tcases\tof\tfailures.\n\nThe\tmost\tcommon\tevent\tis\ta\ttimeout;\tthe\tserver\tis\tbusy\tfor\ta\tperiod\tof time,\twhich\tmakes\tthe\trequest\tto\tfail,\tgiving\tour\tcustomers\ta\tterrible\tuser",
      "content_length": 1553,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 163,
      "content": "experience.\n\nHow\tcan\twe\tsolve\tthis\tparticular\tproblem?\n\nWe\tcan\tsolve\tthis\tproblem\twith\ta\tcircuit\tbreaker,\tas\tshown\tin\tthe following\timage:\n\nA\tcircuit\tbreaker\tis\ta\tmechanism\tto\tprevent\trequests\tfrom\treaching\tan unstable\tserver\tthat\tcould\tcause\tour\tapplication\tto\tmisbehave.\n\nAs\tyou\tcan\tsee\tin\tthe\tpreceding\tschema,\tthe\tcircuit\tbreaker\thas\tthe following\tthree\tstatuses:\n\nClosed:\tThe\tcircuit\tis\tclosed;\tthe\trequests\treach\ttheir\tdestination. Open:\tThe\tcircuit\tis\topen;\tthe\trequests\tdon't\tget\tpast\tthe\tcircuit breaker\tand\tthe\tclient\tgets\tan\terror.\tThe\tsystem\twill\tretry\tthe communication\tafter\ta\ttime\tperiod. HalfOpen:\tThe\tcircuit\ttests\tthe\tservice\tagain,\tand\tif\tthere\tis\tno\terror reaching\tit,\tthe\trequests\tcan\tflow\tagain\tand\tthe\tcircuit\tbreaker\tis Closed.\n\nWith\tthis\tsimple\tmechanism,\twe\tcan\tprevent\tthe\terrors\tto\tcascade through\tour\tsystem,\tavoiding\tcatastrophic\tfailures.\n\nIdeally,\tthe\tcircuit\tbreaker\tshould\tbe\tasynchronous.\tThis\tmeans\tthat",
      "content_length": 939,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 164,
      "content": "even\tif\tthere\tare\tno\trequests,\tevery\tfew\tseconds/milliseconds,\tthe system\tshould\tbe\ttrying\tto\tre-establish\tthe\tconnection\tto\tthe\tfaulty service\tin\torder\tto\tcontinue\tthe\tnormal\toperation.\n\nTip\n\nFailure\tis\ta\tcommon\tdenominator\tin\tthe\thuman\tnature:\tbetter\tbe prepared\tfor\tit.\n\nCircuit\tbreakers\tare\talso\tan\tideal\tplace\tto\talert\tthe\tsupport\tengineers. Depending\ton\tthe\tnature\tof\tour\tsystem,\tthe\tfact\tthat\ta\tgiven\tservice cannot\tbe\treached\tcould\tmean\ta\tserious\tissue.\tCan\tyou\timagine\ta\tbank that\tis\tunable\tto\treach\tthe\tSMS\tservice\tto\tsend\ttwo-factor\tauthentication codes?\tNo\tmatter\thow\thard\twe\ttry,\tit\twill\talways\thappen\tat\tsome\tpoint. So,\tbe\tprepared\tfor\tit.\n\nNote\n\nThere\tis\ta\tvery\tinspiring\tarticle\tfrom\tMartin\tFowler\t(one\tof\tthe\tbig names\tin\tmicroservices)\tabout\tcircuit\tbreakers\tat http://martinfowler.com/bliki/CircuitBreaker.html.\n\nSeneca\t–\ta\tsimple\tpuzzle\tthat\tmakes\tour lives\teasier\n\nSeneca\tis\tgreat.\tIt\tenables\tthe\tdevelopers\tto\ttake\ta\tsimple\tand\tsmall idea\tand\ttranslate\tit\tinto\ta\tpiece\tof\tcode\twith\ta\tconnection\tpoint\tthat\tdoes not\tmake\tany\tassumption,\tjust\tfacts.\tAn\taction\thas\ta\tclear\tinput\tand provides\tyou\tthe\tinterface\tto\tgive\tan\tanswer\tfor\tit\tthrough\ta\tcallback.\n\nHow\tmany\ttimes\thave\tyou\tfound\tyour\tteam\tstruggling\twith\tthe\tclass structure\tof\tan\tapplication\tjust\tto\treuse\tcode\tin\ta\tnice\tway?\n\nSeneca\tfocuses\ton\tsimplicity.\tThe\tfact\tthat\twe\tare\tnot\tmodeling\tobjects,",
      "content_length": 1376,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 165,
      "content": "but\tjust\tparts\tof\tsystems\tusing\tsmall\tportions\tof\tcode\tthat\tare\textremely cohesive\tand\tidempotent\tto\tobjects\tmakes\tour\tlife\tmuch\teasier.\n\nAnother\tway\thow\tSeneca\tmakes\tour\tlife\teasy\tis\tthrough\tthe\tplugability.\n\nIf\tyou\treview\tthe\tcode\tthat\twe\thave\tbeen\twriting\tin\tthis\tbook,\tthe\tfirst thing\tthat\twill\tbe\tspotted\tis\thow\tconvenient\tthe\tplugins\tare.\n\nThey\tprovide\tthe\tright\tlevel\tof\tencapsulation\tfor\ta\tbunch\tof\tactions\t(Does it\tlook\tsimilar\tto\ta\tclass?)\tthat\tare\tsomehow\trelated\tto\teach\tother.\n\nI\talways\ttry\tnot\tto\tover-engineer\tsolutions.\tIt\tis\treally\teasy\tto\tfall\tinto premature\tabstraction,\tpreparing\tthe\tcode\tfor\ta\tfuture\tthat\twe\tdon't\tknow whether\tit\tit\tis\tgoing\tto\thappen\tin\tthe\tmajority\tof\tthe\tcases.\n\nWe\tdon't\trealize\thow\tlong\twe\tspend\tmaintaining\tfeatures\tthat\thave\tbeen overdesigned\tand\tneed\tto\tbe\ttested\tevery\ttime\tsomeone\tchanges\tthe code\taround\tthem.\n\nSeneca\tavoids\t(or\tat\tleast\tdiscourages)\tthis\ttype\tof\tdesigns.\tThink\tabout Seneca\tactions\tas\ta\tsmall\tpiece\tof\tpaper\t(like\ta\tpost-it),\twhere\tyou\tneed to\twrite\twhat\thappened\tlast\tweek.\tYou\tneed\tto\tbe\tsmart\tabout\twhat\tto\tfit in\tthere,\tand\tpossibly,\tsplit\tit\tinto\tanother\tpost-it\tif\tthe\tcontent\tgets\tto dense.\n\nAnother\tpoint\twhere\tSeneca\tis\tgood\tis\tin\tconfigurability.\tAs\twe\thave seen\tbefore,\tSeneca\tcomes\twith\ta\tnumber\tof\tintegrations\tfor\tdata storage\tand\ttransport.\n\nAn\timportant\tside\tof\tSeneca\tis\tthe\ttransport\tprotocol.\tAs\twe\tknow\tby now,\tthe\tdefault\ttransport\tis\tcarried\tover\tTCP,\tbut\tcan\twe\tuse\ta\tmessage queue\tto\tdo\tit?\tThe\tstructure\tis\tshown\tas\tfollows:\n\nYes,\twe\tcan.\tIt\tis\talready\tdone\tand\tmaintained.",
      "content_length": 1566,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 166,
      "content": "Note\n\nThe\tfollowing\tURL\tis\ta\tplugin\tfor\tSeneca\tthat\tallows\tit\tto\tsend messages\tover\tRabbitMQ\tinstead\tof\tHTTP:\n\nhttps://github.com/senecajs/seneca-rabbitmq-transport\n\nIf\tyou\tlook\tinto\tthe\tcode\tof\tthe\tplugin\t(it\tlooks\treally\tcomplex,\tbut\tit\tis not),\tyou\tcan\tspot\twhere\tthe\tmagic\thappens\tin\tfew\tseconds:\n\nseneca.add({role:\t'transport',\thook:\t'listen',\ttype:\t 'rabbitmq'},\thook_listen_rabbitmq) \t\tseneca.add({role:\t'transport',\thook:\t'client',\ttype:\t 'rabbitmq'},\thook_client_rabbitmq)\n\nSeneca\tis\tusing\tSeneca\tactions\tto\tdelegate\tthe\ttransport\tof\tthe message.\tAlthough\tit\tlooks\ta\tbit\trecursive,\tit\tis\tbrilliant!\n\nOnce\tyou\tunderstand\thow\tSeneca\tand\tthe\ttransport\tprotocol\tchosen work,\tyou\tare\timmediately\tqualified\tto\twrite\ta\ttransport\tplugin\tfor\tSeneca.\n\nNote\n\nWhen\tI\tstarted\tlearning\tabout\tSeneca\tin\torder\tto\twrite\tthis\tbook,\tI also\twrote\ta\ttransport\tplugin\tto\tuse\tNServiceBus (http://particular.net/).\n\nNServiceBus\tis\tan\tinteresting\tidea,\tit\tallows\tyou\tto\tconnect\ta\tnumber\tof storages\tand\tAMPQ-compliant\tsystems\tand\tuse\tthem\tas\tclients.\tFor example,\twe\tcould\tbe\twriting\tmessages\tin\ta\tSQL\tServer\ttable\tand consuming\tthem\tfrom\ta\tqueue\tonce\tthey\tget\trouted\tthrough NServiceBus,\thaving\timmediate\tauditing\tcapabilities\ton\tthe\thistory\tof\tthe messages.\n\nWith\tsuch\tflexibility,\twe\tcould\tpotentially\twrite\ta\tplugin\tthat\tuses\tpretty much\tanything\tas\ta\ttransport\tprotocol.",
      "content_length": 1359,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 167,
      "content": "Seneca\tand\tpromises\n\nAll\tour\tcode\tfrom\tthe\tprevious\tchapters\tis\trelying\ton\tcallbacks.\tCallbacks are\tgood\tas\tfar\tas\tyour\tcode\tdoes\tnot\tnest\tthem\ton\tmore\tthan\tthree levels.\n\nHowever,\tthere\tis\tan\teven\tbetter\tway\tof\tmanaging\tthe\tasynchronous nature\tof\tJavaScript:\tpromises.\n\nTake\ta\tlook\tat\tthe\tfollowing\tcode:\n\n<!doctype\thtml> <html\tlang=\"en\"> <head> \t\t<meta\tcharset=\"utf-8\"> \t\t<title>promise\tdemo</title> <script\tsrc=\"https://code.jquery.com/jquery- 1.10.2.js\"></script> </head> <body>\n\n<button>Go</button> <p>Ready...</p> <div></div> <div></div> <div></div> <div></div>\n\n<script> var\teffect\t=\tfunction()\t{ \t\treturn\t$(\t\"div\"\t).fadeIn(\t800\t).delay(\t1200\t ).fadeOut(); };\n\n$(\t\"button\"\t).on(\t\"click\",\tfunction()\t{ \t\t$(\t\"p\"\t).append(\t\"\tStarted...\t\"\t);\n\n$.when(\teffect()\t).done(function()\t{ \t\t$(\t\"p\"\t).append(\t\"\tFinished!\t\"\t); \t\t}); }); </script>\n\n</body> </html>",
      "content_length": 855,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 168,
      "content": "The\tpreceding\tcode\tis\tan\texample\tof\tthe\tJQuery\tfragment\tusing promises.\n\nA\tpromise,\tby\tits\tdefinition\tis:\n\nA\tdeclaration\tor\tassurance\tthat\tone\twill\tdo\tsomething\tor\tthat\ta\tparticular thing\twill\thappen.\n\nThat\tis\texactly\tit.\tIf\tyou\tsee\tthe\tpreceding\tcode,\t$.when,\treturns\ta promise.\tWe\tdon't\tknow\thow\tlong\tthe\teffect\tfunction\twill\ttake,\tbut\twe\tcan guarantee\tthat\tonce\tit\tis\tready,\tthe\tfunction\tinside\tof\tdone\twill\tbe executed.\tIt\tlooks\tvery\tsimilar\tto\tcallbacks,\tbut\ttake\ta\tlook\tat\tthe following\tcode:\n\ncallhttp(url1,\tdata1).then(function(result1)\t{ \t\t\t//\tresult1\tis\tavailable\there \t\t\treturn\tcallhttp(url2,\tdata2); }).then(function(result2)\t{ \t\t\t//\tonly\tresult2\tis\tavailable\there \t\t\treturn\tcallhttp(url3,\tdata3); }).then(function(result3)\t{ \t\t\t//\tall\tthree\tare\tdone\tnow,\tfinal\tresult\tis\tin\t result3 });\n\nDon't\ttry\tto\texecute\tit,\tit\tis\tjust\ta\thypothetical\texample,\tbut\twhat\twe\tare doing\tin\tthere\tis\tchain\tpromises;\tand\tthat\tmakes\tthe\tcode\tvertical\tinstead of\tending\tup\tin\ta\tpyramid-shaped\tprogram,\twhich\tis\ta\tlot\tharder\tto\tread, as\tshown\tin\tthe\tfollowing\tdiagram:",
      "content_length": 1059,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 169,
      "content": "Seneca,\tby\tdefault,\tis\tnot\ta\tpromise-oriented\tframework,\tbut\t(there\tis always\ta\tbut)\tusing\tBluebird,\tone\tof\tthe\tmost\tfamous\tpromises\tlibraries in\tJavaScript,\twe\tcan\tpromisify\tSeneca,\tas\tfollows:\n\nvar\tPromise\t=\trequire('bluebird'); var\tseneca\t=\trequire('seneca')();\n\n//\tPromisify\tthe\t.act()\tmethod;\tto\tlearn\tmore\tabout\t this\ttechnique\tsee: //\t http://bluebirdjs.com/docs/features.html#promisificati on-on-steroids var\tact\t=\tPromise.promisify(seneca.act,\tseneca);\n\n//\tReturn\tno\terror\tand\ta\tsuccess\tmessage\tto\tillustrate\t a\tresolved\tpromise seneca.add({cmd:\t'resolve'},\tfunction\t(args,\tdone)\t{ \t\tdone(null,\t{message:\t\"Yay,\tI've\tbeen\tresolved!\"}); });\n\n//\tReturn\tan\terror\tto\tforce\ta\trejected\tpromise seneca.add({cmd:\t'reject'},\tfunction\t(args,\tdone)\t{ \t\tdone(new\tError(\"D'oh!\tI've\tbeen\trejected.\")); });\n\n//\tUse\tthe\tnew\tpromisified\tact()\twith\tno\tcallback act({cmd:\t'resolve'}) \t\t.then(function\t(result)\t{ \t\t//\tresult\twill\tbe\t{message:\t\"Yay,\tI've\tbeen\t resolved!\"}\tsince\t \t\t//\tits\tguaranteed\tto\tresolve \t\t}) \t\t.catch(function\t(err)\t{ \t\t//\tCatch\tany\terror\tas\tusual\tif\tit\twas\trejected \t\t});\n\nact({cmd:\t'reject'}) \t\t.then(function\t(result)\t{ \t\t//\tNever\treaches\there\tsince\twe\tthrow\tan\terror\ton\t purpose \t\t}) \t\t.catch(function\t(err)\t{ \t\t//\terr\twill\tbe\tset\twith\tmessage\t\"D'oh!\tI've\tbeen\t rejected.\" \t\t});\n\nThere\tare\ttwo\timportant\tdetails\tin\tthe\tpreceding\tcode:",
      "content_length": 1349,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 170,
      "content": "var\tact\t=\tPromise.promisify(seneca.act,\tseneca);\n\nThis\tcreates\ta\tpromisified\tversion\tof\tthe\tact\tfunction\tand\tits\tuse,\tas follows:\n\nact({cmd:\t'reject'}) \t\t.then(function\t(result)\t{ \t\t//\tNever\treaches\there\tsince\twe\tthrow\tan\terror\ton\t purpose \t\t}) \t\t.catch(function\t(err)\t{ \t\t//\terr\twill\tbe\tset\twith\tmessage\t\"D'oh!\tI've\tbeen\t rejected.\" \t\t});\n\nAn\timportant\tdetail\tin\tthis\tlast\tfragment;\tinstead\tof\treceiving\ta\tcallback with\tthe\tfollowing\ttwo\tparameters:\n\nAn\terror The\tresults\n\nWe\tare\tchaining\tthe\tfollowing\ttwo\tmethods:\n\nThen:\tThis\tis\texecuted\twhen\tthe\tpromise\tis\tresolved Catch:\tThis\tis\texecuted\tif\tthere\tis\tan\terror\twhile\tresolving\tthe promise\n\nThis\ttype\tof\tconstructions\tallows\tus\tto\twrite\tthe\tfollowing\tcode:\n\nact({cmd:\t'timeout'}) \t\t.then(function\t(result)\t{ \t\t//\tNever\treaches\there\tsince\tthe\tgate\texecuter\ttimes\t out \t\t}) \t\t.catch(function\t(err)\t{ \t\t//\terr\twill\tbe\tset\twith\ta\ttimeout\terror\tthrown\tby\t the\tgate\texecuter \t\t});\n\nThis\tcode\tis\thandling\tsomething\tthat\twe\thave\tnever\ttalked\tabout\tbefore: the\tgate\texecutor\ttimeouts.\tIt\thappens\twhen\tSeneca\tcannot\treach\tthe destination\tin\tsome\tsituations,\tand\tit\tcan\tbe\teasily\thandled\twith\ta",
      "content_length": 1136,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 171,
      "content": "promise\tas\tshown\tearlier.\tThe\tthen\tpart\twould\tnever\tbe\texecuted\tas\tthe function\twill\tonly\tbe\tcalled\twhen\tthere\tis\tan\terror.\n\nThere\tare\ta\tfew\twell-consolidated\toptions\tin\tthe\tmarket\tnow\tfor\tpromises in\tJavaScript.\tNowadays,\tmy\tpreferred\tchoice\twould\tbe\tBluebird (https://github.com/petkaantonov/bluebird)\tbecause\tof\tits\tsimplicity.\tQ\tis another\toption\tused\tby\tAngularJS\t(one\tof\tthe\tmost\tpopular\tSPA frameworks),\tbut\tfor\tday-to-day\tuse,\tit\tlooks\tmore\tcomplicated\tthan Bluebird.",
      "content_length": 475,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 172,
      "content": "Debugging\n\nDebugging\ta\tNode.js\tapplication\tis\tvery\tsimilar\tto\tdebugging\tany\tother application.\tIDEs\tlike\tWebStorm\tor\tIntelliJ\tprovide\ta\ttraditional debugger\twhere\tyou\tcan\tinstall\tbreakpoints\tand\tstop\tthe\texecution whenever\tthe\tapplication\thits\tthe\tgiven\tline.\n\nThis\tis\tperfect\tif\tyou\tbuy\ta\tlicense\tfor\tone\tof\tthe\tIDEs,\tbut\tthere\tis\ta\tfree alternative\tthat\twill\thave\ta\tvery\tsimiliar\tresult\tfor\tthe\tusers\tof\tGoogle Chrome,\tnode-inspector.\n\nNode-inspector\tis\tan\tnpm\tpackage\tthat\tpretty\tmuch\tenables\tthe\tChrome debugger\tto\tdebug\tNode.js\tapplications.\n\nLet's\tsee\thow\tit\tworks:\n\n1.\t First\tof\tall,\twe\tneed\tto\tinstall\tnode-inspector:\n\nnpm\tinstall\t–g\tnode-inspector\n\nThis\tshould\tadd\ta\tcommand\tto\tour\tsystem\tcalled\tnode-inspector.\tIf we\texecute\tit,\twe\tget\tthe\tfollowing\toutput:\n\nThat\tmeans\tour\tdebug\tserver\thas\tstarted.\n\n2.\t Now\twe\tneed\tto\trun\ta\tnode\tapplication\twith\ta\tspecial\tflag\tto\tindicate that\tit\tneeds\tto\tbe\tdebugged.\n\nLet's\ttake\ta\tsimple\tSeneca\tact\tas\tan\texample:\n\nvar\tseneca\t=\trequire(\t'seneca'\t)() seneca.add({role:\t'math',\tcmd:\t'sum'},\tfunction\t (msg,\trespond)\t{ \t\tvar\tsum\t=\tmsg.left\t+\tmsg.right \t\trespond(null,\t{answer:\tsum}) })",
      "content_length": 1130,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 173,
      "content": "seneca.add({role:\t'math',\tcmd:\t'product'},\t function\t(msg,\trespond)\t{ \t\tvar\tproduct\t=\tmsg.left\t*\tmsg.right \t\trespond(\tnull,\t{\tanswer:\tproduct\t}\t) })\n\nseneca.act({role:\t'math',\tcmd:\t'sum',\tleft:\t1,\t right:\t2},\tconsole.log) seneca.act({role:\t'math',\tcmd:\t'product',\tleft:\t3,\t right:\t4},\tconsole.log)\n\n3.\t Now,\tin\torder\tto\trun\tit\ton\tthe\tdebug\tmode,\texecute\tthe\tfollowing command:\n\nnode\tindex.js\t--debug-brk\n\nThe\tway\tto\taccess\tthe\tdebugger\tis\tthrough\tthe\tURL http://127.0.0.1:8080/?port=5858:\n\nI\tam\tsure\tthis\timage\tis\tvery\tfamiliar\tto\tevery\tdeveloper\tin\tthe\tworld:\tit\tis the\tChrome\tdebugger\tshowing\tour\tcode.\tAs\tyou\tcan\tsee\tin\tthe\tfirst\tline, the\tone\thighlighted\tin\tblue,\tthe\tapplication\tstopped\tin\tthe\tfirst\tinstruction so\tthat\twe\tcan\tplace\tthe\tbreakpoints\tby\tclicking\tthe\tline\tnumbers,\tas shown\tin\tthe\tfollowing\timage:",
      "content_length": 816,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 174,
      "content": "As\tyou\tcan\tsee\tin\tthe\tpreceding\timage,\twe\thave\tinstalled\ta\tbreakpoint\tin line\t9.\tNow\twe\tcan\tuse\tthe\tcontrol\tpanel\tto\tnavigate\tthrough\tthe\tcode and\tvalues\tof\tour\tvariables:\n\nThe\tcontrols\ton\tthe\ttop\tspeak\tfor\tthemselves\tif\tyou\tever\tdebugged\tan application:\n\nThe\tfirst\tbutton\tis\tcalled\tplay\tand\tit\tallows\tthe\tapplication\tto\trun\tto the\tnext\tbreakpoint Step\tover\texecutes\tthe\tnext\tline\tin\tthe\tcurrent\tfile Step\tinto\tgoes\tinto\tthe\tnext\tline,\tgetting\tdeeper\tin\tthe\tcall\tstack\tso that\twe\tcan\tsee\tthe\tcall\thierarchy Step\tout\tis\tthe\treverse\tof\tstep\tinto",
      "content_length": 543,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 175,
      "content": "Disable\tbreakpoints\twill\tprevent\tthe\tprogram\tfrom\tstopping\tat\tthe breakpoints Pause\ton\texceptions,\tas\tits\tname\tindicates,\twill\tcause\tthe\tprogram to\tstop\ton\texceptions\t(it\tis\tvery\tuseful\twhen\ttrying\tto\tcatch\terrors)\n\nIf\twe\tclick\ton\tplay,\twe\tcan\tsee\thow\tthe\tscript\twill\tstop\tin\tline\t9\tin\tthe following\timage:\n\nAs\ta\tgood\tdebugger,\tit\twill\tlet\tus\tinspect\tthe\tvalue\tof\tour\tvariables\tby hovering\tthe\tcursor\tover\tthe\tvariable\tname.",
      "content_length": 424,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 176,
      "content": "Summary\n\nThis\tchapter\thas\tbeen\tpretty\tintense.\tWe\thave\tgone\tthrough\ta\tlot\tof content\tthat\thelped\tus\tin\tbuilding\ta\tsmall\tmicroservices\tecosystem\tthat, when\torchestrated\ttogether,\twould\tfairly\twork\twell.\tWe\thave\tbeen\ta\tbit simplistic\tsome\ttimes,\tbut\tthe\tidea\tof\tthe\tbook\tis\tto\tindicate\tthe\tpower\tof the\tmicroservices-oriented\tsoftware.\tAt\tthis\tstage,\tI\twould\trecommend the\treader\tto\tstart\tperforming\tsome\ttesting\taround\tSeneca.\n\nThe\tdocumentation\ton\tthe\twebsite\tis\tquite\thelpful,\tand\tthere\tare\ta\tlot\tof examples\tto\tfollow.\n\nThere\tare\ta\tfew\tplugins\tfor\tstorage\tand\ttransport,\tas\twell\tas\tother\ttype\tof plugins\t(such\tas\tuser\tauthentication),\tthat\twould\tallow\tyou\tto\texperiment with\tdifferent\tfeatures\tof\tSeneca.\n\nWe\twill\tbe\ttalking\tmore\tabout\tsome\tof\tthem\tin\tthe\tfollowing\tchapters.",
      "content_length": 777,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 177,
      "content": "Chapter\t5.\tSecurity\tand Traceability\n\nSecurity\tis\tone\tof\tthe\tbiggest\tconcerns\tin\tsystems\tnowadays.\tThe amount\tof\tinformation\tleaked\tfrom\tbig\tcompanies\tis\tworrying,\tespecially because\t90%\tof\tthe\tinformation\tleaks\tcould\tbe\tmended\twith\tvery\tsmall actions\tby\tthe\tsoftware\tdevelopers.\tSomething\tsimilar\thappens\twith\tthe logging\tof\tevents\tand\tthe\ttraceability\tof\terrors.\tNo\tone\treally\tpays\ttoo much\tattention\tuntil\tsomeone\trequests\tthe\tlogs\tthat\tyou\tdon't\thave\tin order\tto\taudit\ta\tfailure.\tIn\tthis\tchapter,\twe\twill\tdiscuss\thow\tto\tmanage security\tand\tlogging\tso\tthat\tour\tsystem\tis\tsafe\tand\ttraceable,\twith\tthe help\tof\tthe\tfollowing\ttopics:\n\nInfrastructure\tlogical\tsecurity:\tWe\twill\tdiscuss\thow\tto\tsecure\tour software\tinfrastructure\tin\torder\tto\tprovide\tthe\tindustry\tstandard security\tlayer\tin\tour\tcommunications. Application\tsecurity:\tWe\twill\tintroduce\tthe\tcommon\ttechniques\tto secure\tour\tapplications.\tPractices\tsuch\tas\toutput\tencoding\tor\tinput validation\tare\tthe\tindustry\tstandard\tand\tthey\tcould\tsave\tus\tfrom\ta catastrophe. Traceability:\tBeing\table\tto\tfollow\tthe\trequests\taround\tour\tsystem\tis a\tmust\tin\tmicroservices\tarchitectures.\tWe\twill\tleverage\tthis\ttask\tto Seneca\tand\tlearn\thow\tto\tget\tthe\tinformation\tfrom\tthis\tfantastic framework. Auditing:\tEven\tthough\twe\tput\tour\tbest\tefforts\tin\tbuilding\ta\tsoftware, accidents\thappen.\tThe\tability\tto\trebuild\tthe\tsequence\tof\tcalls\tand see\texactly\twhat\thappened\tis\timportant.\tWe\twill\tdiscuss\thow\tto enable\tour\tsystem\tin\torder\tto\tbe\table\tto\trecover\tthe\trequired information.\n\nInfrastructure\tlogical\tsecurity\n\nInfrastructure\tsecurity\tis\tusually\tignored\tby\tsoftware\tengineers\tas\tit\tis completely\tdifferent\tfrom\ttheir\tarea\tof\texpertise.\tHowever,\tnowadays, and\tespecially\tif\tyour\tcareer\tis\tleaning\ttowards\tDevOps,\tit\tis\ta\tsubject",
      "content_length": 1756,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 178,
      "content": "that\tshould\tnot\tbe\tignored.\n\nIn\tthis\tbook,\twe\tare\tnot\tgoing\tto\tgo\tvery\tdeep\tinto\tthe\tinfrastructure security\tmore\tthan\tfew\trules\tof\tthumb\tto\tkeep\tyour\tmicroservices\tsafe.\n\nIt\tis\tstrongly\trecommended\tfor\tthe\treaders\tto\tread\tand\tlearn\tabout cryptography\tand\tall\tthe\timplications\taround\tthe\tusage\tof\tSSH,\twhich\tis one\tof\tthe\tmain\tresources\tfor\tkeeping\tcommunications\tsecure nowadays.\n\nSSH\t–\tencrypting\tthe\tcommunications\n\nIn\tany\torganization,\tthere\tis\ta\tstrict\tlist\tof\tpeople\twho\tcan\taccess\tcertain services.\tIn\tgeneral,\tthis\tauthentication\tfor\tthese\tservices\tis\tdone\tvia username\tand\tpassword,\tbut\tit\tcan\talso\tbe\tdone\tusing\ta\tkey\tto\tverify\tthe identity\tof\tthe\tuser.\n\nNo\tmatter\twhat\tauthentication\tmethod\tis\tused,\tthe\tcommunication\tshould always\tbe\tdone\tover\ta\tsecure\tchannel\tsuch\tas\tSSH.\n\nSSH\tstands\tfor\tSecure\tShell\tand\tit\tis\ta\tsoftware\tused\tto\taccess\tshells\tin remote\tmachines,\tbut\tit\tcan\talso\tbe\ta\tvery\thelpful\ttool\tto\tcreate\tproxies and\ttunnels\tto\taccess\tremote\tservers.\n\nLet's\texplain\thow\tit\tworks\tusing\tthe\tfollowing\tcommand:\n\nhomedavid:(develop)\tx\tssh\tdavid@192.168.0.1 The\tauthenticity\tof\thost\t'192.168.0.1\t(192.168.0.1)'\t can't\tbe\testablished. RSA\tkey\tfingerprint\tis\t SHA256:S22/A2/eqxSqkS4VfR1BrcDxNX1rmfM1JkZaGhrjMbk. Are\tyou\tsure\tyou\twant\tto\tcontinue\tconnecting\t(yes/no)?\t yes Warning:\tPermanently\tadded\t'192.168.0.1'\t(RSA)\tto\tthe\t list\tof\tknown\thosts. vagrant@192.168.0.1's\tpassword: Last\tlogin:\tMon\tJan\t25\t02:30:21\t2016\tfrom\t10.0.2.2 Welcome\tto\tyour\tvirtual\tmachine.\n\nIn\tthis\tcase,\tI\tam\tusing\tVagrant\tto\tfacilitate\tthe\tbuilding\tof\tvirtual machines.\tVagrant\tis\ta\tvery\tpopular\ttool\tto\tautomate\tdevelopment",
      "content_length": 1615,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 179,
      "content": "environments\tand\ttheir\twebsite\t(https://www.vagrantup.com/)\tconsists\tof useful\tinformation.\n\nIn\tthe\tfirst\tline,\twe\texecute\tthe\tssh\tdavid@192.168.0.1\tcommand.\tThis command\ttries\tto\topen\ta\tterminal\tas\tthe\tuser\tdavid\tin\tthe\t192.168.0.1 host.\n\nAs\tit\tis\tthe\tfirst\ttime\tthat\tthis\tcommand\tis\texecuted\tagainst\tthe\tmachine in\tthe\tIP\t192.168.0.1,\tour\tcomputer\twill\tnot\ttrust\tthe\tremote\tserver.\n\nThis\tis\tdone\tby\tmaintaining\ta\tfile\tcalled\tknown_hosts,\tunder\tthe homedavid/.ssh/known_hosts\tfolder\tin\tthis\tcase\t(it\twill\tdepend\ton\tthe user).\n\nThis\tfile\tis\ta\tlist\tof\thosts\twith\tthe\tcorresponding\tkey.\tAs\tyou\tcan\tsee,\tthe following\ttwo\tlines\texplain\tthat\tthe\thost\tcannot\tbe\ttrusted\tand\tpresent\tthe fingerprint\tof\tthe\tkey\theld\tby\tthe\tremote\tserver\tin\torder\tto\tverify\tit:\n\nThe\tauthenticity\tof\thost\t'192.168.0.1\t(192.168.0.1)'\t can't\tbe\testablished. RSA\tkey\tfingerprint\tis\t SHA256:S22/A2/eqxSqkS4VfR1BrcDxNX1rmfM1JkZaGhrjMbk.\n\nAt\tthis\tpoint,\tthe\tuser\tis\tsupposed\tto\tverify\tthe\tidentity\tof\tthe\tserver\tby checking\tthe\tkey.\tOnce\tthis\tis\tdone,\twe\tcan\tinstruct\tSSH\tto\tconnect\tto the\tserver,\twhich\twill\tresult\tin\tthe\tfollowing\tlog\tbeing\tprinted:\n\nWarning:\tPermanently\tadded\t'192.168.0.1'\t(RSA)\tto\tthe\t list\tof\tknown\thosts.\n\nNow,\tif\twe\tcheck\tour\tknown_hosts\tfile,\twe\tcan\tsee\tthat\tthe\tkey\thas\tbeen added\tto\tthe\tlist,\tas\tfollows:\n\nThis\tkey\tstored\tin\tthe\tknown_hosts\tfile\tis\tthe\tpublic\tkey\tof\tthe\tremote server.",
      "content_length": 1381,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 180,
      "content": "SSH\tuses\ta\tcryptography\talgorithm\tcalled\tRSA.\tThis\talgorithm\tis\tbuilt around\tthe\tconcept\tof\tasymmetric\tcryptography,\twhich\tis\tshown\tin\tthe following\timage:\n\nThe\tasymmetric\tcryptography\trelies\ton\ta\tset\tof\tkeys:\tone\tpublic\tand\tone private.\tAs\tthe\tname\tstates,\tthe\tpublic\tkey\tcan\tbe\tshared\twith\teveryone; whereas,\tthe\tprivate\tkey\thas\tto\tbe\tkept\tsecret.\n\nThe\tmessages\tencrypted\twith\tthe\tprivate\tkey\tcan\tonly\tbe\tdecrypted\twith the\tpublic\tkey\tand\tthe\tother\tway\taround\tso\tthat\tit\tis\talmost\timpossible (unless\tsomeone\tgets\tthe\tother\thalf\tof\tthe\tkey)\tto\tintercept\tand\tdecrypt\ta message.\n\nAt\tthis\tpoint,\tour\tcomputer\tknows\tthe\tpublic\tkey\tof\tthe\tserver\tand\twe\tare in\ta\tposition\tto\tstart\tan\tencrypted\tsession\twith\tthe\tserver.\tOnce\twe\tget the\tterminal,\tall\tthe\tcommands\tand\tresults\tof\tthese\tcommands\twill\tbe encrypted\tand\tsent\tover\tthe\twire.",
      "content_length": 828,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 181,
      "content": "This\tkey\tcan\talso\tbe\tused\tto\tconnect\tto\ta\tremote\tserver\twithout password.\tThe\tonly\tthing\twe\tneed\tto\tdo\tis\tgenerate\tan\tSSH\tkey\tin\tour machine\tand\tinstall\tit\tin\tthe\tserver\tin\ta\tfile\tcalled\tauthorized_keys\tunder the\t.ssh\tfolder,\twhere\tthe\tknown_hosts\tfile\tis.\n\nWhen\tworking\twith\tmicroservices,\tyou\tcan\tbe\tremotely\tlogged\tin\tto\tquite a\tfew\tdifferent\tmachines\tso\tthat\tthis\tapproach\tbecomes\tmore\tattractive. However,\twe\tneed\tto\tbe\tvery\tcareful\tabout\thow\twe\thandle\tthe\tprivate keys\tbecause\tif\ta\tuser\tleaks\tthat\tprivate\tkey,\tour\tinfrastructure\tcould\tbe compromised.",
      "content_length": 557,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 182,
      "content": "Application\tsecurity\n\nApplication\tsecurity\tis\tbecoming\tmore\tand\tmore\timportant.\tAs\tthe\tcloud is\tbecoming\tthe\tde-facto\tstandard\tfor\tinfrastructure\tin\tlarge\tcompanies, we\tcan't\trely\ton\tthe\tfact\tthat\tthe\tdata\tis\tconfined\tin\ta\tsingle\tdata\tcentre.\n\nUsually,\twhen\tsomeone\tstarts\ta\tnew\tbusiness,\tthe\tmain\tfocus\tis\tto\tbuild the\tproduct\tfrom\tthe\tfunctional\tpoint\tof\tview.\tSecurity\tis\tnot\tthe\tmain focus\tand\tusually\tgets\toverlooked.\n\nThis\tis\ta\tvery\tdangerous\tpractice\tand\twe\tare\tgoing\tto\tamend\tthat\tby letting\tthe\treader\tknow\tthe\tmain\tsecurity\tthreats\tthat\tcould\tcompromise our\tapplication.\n\nThe\tmain\tfour\tbig\tsecurity\tpoints\tto\tdevelop\tapplications\tin\ta\tsecure manner\tare\tas\tfollows:\n\nInjection Cross-site\tscripting Cross-site\trequest\tforgery\ttoken\tprotection Open\tredirects\n\nAt\tthe\tend\tof\tthis\tsection,\twe\twill\tbe\table\tto\tidentify\tthe\tmain vulnerabilities,\tbut\twe\twon't\tbe\tarmored\tagainst\ta\tmalicious\tattacker.\tIn general,\ta\tsoftware\tengineer\tshould\tbe\tup\tto\tdate\twith\tthe\tsecurity\tas much\tas\tthey\tare\tup\tto\tdate\twith\tnew\ttechnologies.\tNo\tmatter\thow\tgood the\tproduct\tyou\tbuild\tis,\tif\tit\tis\tnot\tsecure,\tsomeone\twill\tfind\tout\tand\ttake the\tadvantage\tof\tit.\n\nCommon\tthreats\t–\thow\tto\tbe\tup\tto\tdate\n\nAs\twe\tstated\tbefore,\tsecurity\tis\tan\tongoing\tsubject\tin\tapplication development.\tNo\tmatter\twhat\ttype\tof\tsoftware\tyou\tare\tbuilding,\tthere\twill always\tbe\tsecurity\timplications\taround\tit.\n\nThe\tbest\tway\tI've\tfound\tduring\tmy\tprofessional\tcareer\tto\tbe\tup\tto\tdate with\tsecurity\taround\tweb\tdevelopment\twithout\tbeing\ta\tfull-time\tdedicated security\tengineer\tis\tto\tfollow\tthe\tOWASP\tproject.\tOWASP\tstands\tfor",
      "content_length": 1581,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 183,
      "content": "Open\tWeb\tApplication\tSecurity\tProject\tand\tthey\tproduce\tquite\tan interesting\tdocument\t(among\tothers)\ton\ta\tyearly\tbasis\tcalled\tOWASP Top\t10.\n\nNote\n\nOWASP\tTop\t10\twas\tfirst\tpublished\tin\t2003\tand\tits\tgoal\tis\tto\traise awareness\tin\tthe\tdevelopment\tcommunity\tabout\tthe\tmost\tcommon threats\tin\tapplication\tdevelopment.\n\nIn\tthe\tprevious\tsection,\twe\tidentified\tthe\tfour\tmain\tsecurity\tissues\tthat\ta software\tdeveloper\tcan\tface\tand\tall\tof\tthem\tare\tmentioned\tin\tthe following\tsections.\n\nInjection\n\nInjection\tis,\tby\tfar,\tthe\tmost\tdangerous\tattack\tthat\twe\tcould\tbe\texposed to.\tSpecifically,\ta\tSQL\tinjection\tis\tthe\tmost\tcommon\tform\tof\tinjection\tthat affects\tapplications\tand\tit\tconsists\tof\tan\tattacker\tforcing\ta\tSQL\tcode\tin one\tof\tour\tapplication\tqueries,\tleading\tto\ta\tdifferent\tquery\tthat\tcould compromise\tthe\tdata\tof\tour\tcompany.\n\nThere\tare\tother\ttypes\tof\tinjections,\tbut\twe\tare\tgoing\tto\tfocus\ton\tSQL injection,\tas\tpretty\tmuch\tevery\tapplication\tin\tthe\tmodern\tworld\tuses\ta relational\tdatabase.\n\nSQL\tinjection\tconsists\tof\tthe\tinjection\tor\tmanipulation\tof\tSQL\tqueries\tin our\tapplication\tthrough\tthe\tinput\tfrom\tnon-validated\tsources,\tsuch\tas\ta web\tform\tor\tany\tother\tdata\tsource\twith\tarbitrary\tinput\tof\ttext.\n\nLet's\tconsider\tthe\tfollowing\texample:\n\nSELECT\t*\tFROM\tusers\tWHERE\tusername\t=\t'username'\tAND\t password\t=\t'password'\n\nTip",
      "content_length": 1307,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 184,
      "content": "Never\tstore\tpasswords\tin\tplain\tin\tthe\tdatabase.\tAlways\thash\tand\tsalt them\tto\tavoid\trainbow-table\tattacks.\tThis\tis\tjust\tan\texample.\n\nThis\tquery\twill\tgive\tus\tthe\tuser\tthat\tcorresponds\tto\ta\tgiven\tname\tand password.\tIn\torder\tto\tbuild\tthe\tquery\tfrom\tthe\tclient's\tinput,\twe\tcan consider\tdoing\tsomething\tsimilar\tto\tthe\tfollowing\tcode\tas\ta\tgood\tidea:\n\nvar\texpress\t=\trequire('express'); var\tapp\t=\texpress(); var\tmysql\t\t\t\t\t\t=\trequire('mysql');\n\nvar\tconnection\t=\tmysql.createConnection({ \t\thost\t\t\t\t\t:\t'localhost', \t\tuser\t\t\t\t\t:\t'me', \t\tpassword\t:\t'secret', \t\tdatabase\t:\t'test_db' });\n\napp.get('/login',\tfunction(req,\tres)\t{ \t\tvar\tusername\t=\treq.param(\"username\"); \t\tvar\tpassword\t=\treq.param(\"password\");\n\nconnection.connect(); \t\tvar\tquery\t=\t\"SELECT\t*\tFROM\tusers\tWHERE\tusername\t=\t'\"\t +\tusername\t+\t\"'\tAND\tpassword\t=\t'\"\t+\tpassword\t+\t\"'\"; \t\tconnection.query(query,\tfunction(err,\trows,\tfields)\t { \t\t\t\tif\t(err)\tthrow\terr; \t\t\t\tres.send(rows); \t\t}); \t\tconnection.end(); });\n\napp.listen(3000,\tfunction()\t{ \t\tconsole.log(\"Application\trunning\tin\tport\t3000.\"); });\n\nAt\tfirst\tsight,\tit\tlooks\tlike\tan\teasy\tprogram\tthat\taccesses\tthe\tdatabase called\ttest_db\tand\tissues\ta\tquery\tto\tcheck\twhether\tthere\tis\ta\tuser\tthat matches\tthe\tusername\tand\tpassword\tand\trenders\tit\tback\tto\tthe\tclient\tso that\tif\twe\topen\tthe\tbrowser\tand\ttry\tto\tbrowse\tto\tthe http://localhost:3000/login?username=david&password=mypassword\tURL, the\tbrowser\twill\trender\ta\tJSON\tobject\twith\tthe\tresult\tof\tthe\tfollowing query:",
      "content_length": 1456,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 185,
      "content": "SELECT\t*\tFROM\tusers\tWHERE\tusername\t=\t'david'\tAND\t password\t=\t'mypassword'\n\nNothing\tstrange\tyet,\tbut\twhat\thappens\tif\tthe\tcustomer\ttries\tto\thack\tus?\n\nTake\ta\tlook\tat\tthe\tfollowing\tinput:\n\nhttp://localhost:3000/login?username='\tOR\t1=1\t-- &password=mypassword\n\nAs\tyou\tcan\tsee,\tthe\tquery\tgenerated\tby\tit\tis\tthe\tfollowing\tcode:\n\nSELECT\t*\tFROM\tusers\tWHERE\tusername\t=\t''\tOR\t1=1\t--\tAND\t password\t=\t'mypassword'\n\nIn\tSQL,\tthe\t--\tcharacter\tsequence\tis\tused\tto\tcomment\tthe\trest\tof\tthe\tline so\tthat\tthe\teffective\tquery\twould\tbe\tas\tfollows:\n\nSELECT\t*\tFROM\tusers\tWHERE\tusername=''\tOR\t1=1\n\nThis\tquery\treturns\tthe\tfull\tlist\tof\tusers,\tand\tif\tour\tsoftware\tis\tusing\tthe result\tof\tthis\tquery\tto\tresolve\twhether\tthe\tuser\tshould\tbe\tlogged\tin\tor not,\twe\tare\tin\tsome\tserious\tproblems.\tWe\thave\tjust\tgranted\taccess\tto our\tsystem\tto\tsomeone\twho\tdoes\tnot\teven\tknow\ta\tvalid\tusername.\n\nThis\tis\tone\tof\tthe\tmany\texamples\ton\thow\tSQL\tinjection\tcan\taffect\tus.\n\nIn\tthis\tcase,\tit\tis\tpretty\tobvious\tthat\twe\tare\tconcatenating\tuntrusted\tdata (coming\tfrom\tthe\tuser)\tinto\tour\tquery,\tbut\tbelieve\tme,\twhen\tthe\tsoftware gets\tmore\tcomplicated,\tit\tis\tnot\talways\teasy\tto\tidentify.\n\nA\tway\tto\tavoid\tSQL\tinjection\tis\tthrough\tthe\tusage\tof\tprepared statements.\n\nInput\tvalidation\n\nApplications\tinteract\twith\tusers\tmainly\tthrough\tforms.\tThese\tforms usually\tcontain\tfree\ttext\tinput\tfields\tthat\tcould\tlead\tto\tan\tattack.\n\nThe\teasiest\tway\tto\tprevent\tcorrupted\tdata\tfrom\tgetting\tinto\tour\tserver\tis",
      "content_length": 1434,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 186,
      "content": "through\tinput\tvalidation,\twhich\tas\tthe\tname\tsuggests,\tconsists\tof validating\tthe\tinput\tfrom\tthe\tuser\tto\tavoid\tthe\tsituation\tdescribed\tearlier.\n\nThere\tare\ttwo\ttypes\tof\tinput\tvalidation,\tas\tfollows:\n\nWhite\tlisting Black\tlisting\n\nBlack\tlisting\tis\ta\tdangerous\ttechnique.\tIn\tmajority\tof\tcases,\ttrying\tto define\twhat\tis\tincorrect\tin\tthe\tinput\ttakes\ta\tlot\tmore\teffort\tthan\tsimply defining\twhat\twe\texpect.\n\nThe\trecommended\tapproach\tis\t(and\twill\talways\tbe)\tto\twhite\tlist\tthe\tdata coming\tfrom\tthe\tuser,\tvalidating\tit\tthrough\tthe\tuse\tof\ta\tregular expression:\twe\tknow\thow\ta\tphone\tnumber\tlooks\tlike,\twe\talso\tknow\thow a\tusername\tshould\tlook\tlike,\tand\tso\ton.\n\nInput\tvalidation\tis\tnot\talways\teasy.\tIf\tyou\thave\tever\tcome\tacross\tthe validation\tof\tan\te-mail,\tyou\twill\tknow\twhat\tI\tam\ttalking\tabout:\tthe\tregular expression\tto\tvalidate\tan\te-mail\tis\tanything\tbut\tsimple.\n\nThe\tfact\tthat\tthere\tis\tnot\tan\teasy\tway\tto\tvalidate\tsome\tdata\tshould\tnot restrict\tus\tfrom\tdoing\tit\tas\tthe\tomission\tof\tinput\tvalidation\tcould\tlead\tto\ta serious\tsecurity\tflaw.\n\nInput\tvalidation\tis\tnot\tthe\tsilver\tbullet\tfor\tSQL\tinjections,\tbut\tit\talso\thelps with\tother\tsecurity\tthreats\tsuch\tas\tcross-site\tscripting.\n\nIn\tthe\tquery\tfrom\tthe\tprevious\tsection,\twe\tdo\tsomething\tquite dangerous:\tconcatenate\tuser\tinput\tinto\tour\tquery.\n\nOne\tof\tthe\tsolutions\tcould\tbe\tto\tuse\tsome\tsort\tof\tescaping\tlibrary\tthat will\tsanitize\tthe\tinput\tfrom\tthe\tuser,\tas\tfollows:\n\napp.get('/login',\tfunction(req,\tres)\t{ \t\tvar\tusername\t=\treq.param(\"username\"); \t\tvar\tpassword\t=\treq.param(\"password\");\n\nconnection.connect(); \t\tvar\tquery\t=\t\"SELECT\t*\tFROM\tusers\tWHERE\tusername\t=\t'\"\t +\tconnection.escape(username)\t+\t\"'\tAND\tpassword\t=\t'\"\t+",
      "content_length": 1651,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 187,
      "content": "connection.escape(password)\t+\t\"'\"; \t\tconnection.query(query,\tfunction(err,\trows,\tfields)\t { \t\t\t\tif\t(err)\tthrow\terr; \t\t\t\tres.send(rows); \t\t}); \t\tconnection.end(); });\n\nIn\tthis\tcase,\tthe\tmysql\tlibrary\tused\tprovides\ta\tsuite\tof\tmethods\tto\tescape strings.\tLet's\tsee\thow\tit\tworks:\n\nvar\tmysql\t=\trequire('mysql'); var\tconnection\t=\tmysql.createConnection({ \t\thost:\t'localhost', \t\tusername:\t'root', \t\tpassword:\t'root' });\n\nconsole.log(connection.escape(\"'\tOR\t1=1\t--\"))\n\nThe\tsmall\tscript\tfrom\tearlier\tescapes\tthe\tstring\tprovided\tas\tusername\tin the\tprevious\texample,\tthe\tresult\tis\t\\'\tOR\t1=1\t--.\n\nAs\tyou\tcan\tsee,\tthe\tescape()\tmethod\thas\treplaced\tthe\tdangerous characters,\tsanitizing\tthe\tinput\tfrom\tthe\tuser.\n\nCross-site\tscripting\n\nCross-site\tscripting,\talso\tknown\tas\tXSS,\tis\ta\tsecurity\tvulnerability\tthat mainly\taffects\tweb\tapplications.\tIt\tis\tone\tof\tthe\tmost\tcommon\tsecurity issues\tand\tthe\timplications\tcan\tbe\thuge\tfor\tthe\tcustomer\tas\tpotentially, someone\tcould\tsteal\tthe\tuser\tidentity\twith\tthis\tattack.\n\nThe\tattack\tis\tan\tinjection\tcode\tput\tinto\ta\tthird-party\twebsite\tthat\tcould steal\tdata\tfrom\tthe\tclient's\tbrowser.\tThere\tare\ta\tfew\tways\tof\tdoing\tit,\tbut by\tfar,\tthe\tmost\tcommon\tis\tby\tunescaped\tinput\tfrom\tthe\tclient.\n\nIn\tfew\twebsites\ton\tthe\tInternet,\tusers\tcan\tadd\tcomments\tcontaining arbitrary\tinput.\tThis\tarbitrary\tinput\tcan\tcontain\tscript\ttags\tthat\tload\ta JavaScript\tfrom\ta\tremote\tserver\tthat\tcan\tsteal\tthe\tsession\tcookie\t(or other\ttypes\tof\tvaluable\tinformation),\tletting\tthe\tattacker\treplicate\tthe\tuser",
      "content_length": 1495,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 188,
      "content": "session\ton\ta\tremote\tmachine.\n\nThere\tare\ttwo\tmain\ttypes\tof\tXSS\tattacks:\tpersistent\tand\tnon- persistent.\n\nThe\tpersistent\ttype\tof\tXSS\tconsists\tof\tstoring\tthe\tXSS\tattack\tby\tcrafting a\tparticular\tstring\tof\ttext\tthat\tresolves\tinto\tthe\tattack\tonce\tit\tis\tdisplayed to\tthe\tuser\tin\tthe\twebsite.\tThis\tcode\tcould\tbe\tinjected\tvia\tan\tarbitrary input\ttext\tthat\tis\tstored\tin\tthe\tdatabase\t(such\tas\ta\tcomment\tin\ta\tforum).\n\nThe\tnon-persistent\ttype\tof\tXSS\tis\twhen\tthe\tattack\tis\tinserted\tinto\ta non-persistent\tpart\tof\tthe\tapplication\tdue\tto\tbad\tdata\thandling.\n\nLet's\ttake\ta\tlook\tat\tthe\tfollowing\tscreenshot:\n\nAs\tyou\tcan\tsee,\twe\thave\tsearched\tfor\ta\tbook\t(this\tbook)\tin http://www.amazon.co.uk/.\tIt\tdoes\tnot\tproduce\tany\toutput\t(as\tthe\tbook\tis not\tpublished\tyet),\tbut\tit\tspecifies\tthat\tYour\tsearch\t\"microservices nodejs\"\tdid\tnot\tmatch\tany\tproducts,\twhich\tis\tsomehow\tusing\tthe input\tfrom\tthe\tweb\tbrowser\tas\toutput.\tEven\tmore,\twhen\tI\tclicked\ton search,\tAmazon\tredirected\tme\tto\tthe\tfollowing\tURL:",
      "content_length": 969,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 189,
      "content": "http://www.amazon.co.uk/s/ref=nb_sb_noss?url=search- alias%3Daps&field-keywords=microservices+nodejs\n\nWe\tknow\tAmazon\tis\tsecure,\tbut\tif\tit\twas\tsensible\tto\tXSS\tattacks,\twe could\thave\tmodified\tthe\tvalue\tof\tthe\tfield-keywords\tparameter\tto\tcraft\ta request\tthat\tinjected\ta\tscript\ttag\tin\tthe\tcontent,\tleading\tto\tthe\tattacker being\table\tto\tsteal\tthe\tsession\tcookie\tthat\tcould\tresult\tin\tsome\tserious problems\tfor\tthe\twebsite.\n\nOutput\tencoding\n\nA\tway\tto\tprotect\tagainst\tthis\tattack\tis\toutput\tencoding.\tWe\thave\tdone\tit before,\twhen\twe\tused\tconnection.escape()\tin\tthe\tInput\tvalidation\tsection of\tthis\tchapter.\tIn\tfairness,\twe\tshould\tbe\tvalidating\tall\tthe\tdata\tentered from\tthe\tuser\tand\tencoding\tall\tthe\toutputs\tthat\tcome\tfrom\tthird\tparties. This\tincludes\tthe\tinput\tentered\tby\tthe\tuser,\tas\twell\tas\tsources\tof information\tcoming\tfrom\toutside\tof\tthe\tsystem.\n\nWhen\tnarrowing\tthe\tproblem\tto\tweb\tdevelopment,\twe\thave\tto\tbe\taware of\tthe\tthree\tdifferent\tareas\twhere\toutput\tencoding\tis\tneeded:\n\nCSS JavaScript HTML\n\nThe\tmost\tproblematic\ttwo\tare\tJavaScript\tand\tHTML,\twhere\tan\tattacker could\teasily\tsteal\tinformation\twithout\ttoo\tmuch\teffort.\n\nGenerally,\tno\tmatter\twhich\tframework\twe\tuse\tfor\tbuilding\tour\tapp,\tit always\thas\tfunctions\tto\tencode\tthe\toutput.\n\nCross-site\trequest\tforgery\n\nCross-site\trequest\tforgery\t(CSRF)\tis\tthe\treverse\tof\tcross-site\trequest scripting.\tIn\tcross-site\trequest\tscripting,\tthe\tproblem\tis\tin\tthe\tclient trusting\tthe\tdata\tcoming\tfrom\tthe\tserver.\tWith\tcross-site\trequest\tforgery, the\tproblem\tis\tthat\tthe\tserver\ttrusts\tthe\tdata\tcoming\tfrom\tthe\tclient.\n\nAfter\tstealing\tthe\tsession\tcookie,\tthe\tattacker\tcan\tnot\tonly\tsteal information\tfrom\tthe\tuser,\tbut\tcan\talso\tmodify\tthe\tinformation\tof\tthe",
      "content_length": 1688,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 190,
      "content": "account\tassociated\twith\tthe\tcookie.\n\nThis\tis\tdone\tby\tposting\tthe\tdata\tto\tthe\tserver\tvia\tHTTP\trequests.\n\nHTTP\tclassifies\tits\trequests\tin\tmethods.\tA\tmethod\tis\tbasically\tused\tto specify\twhat\tis\tthe\toperation\tto\tbe\tcarried\tby\tthe\trequest.\tThe\tmost interesting\tfour\tmethods\tare\tthe\tfollowing\tones:\n\nGET:\tThis\tgets\tthe\tdata\tfrom\tthe\tserver.\tIt\tshould\tnot\tmodify\tany persistent\tdata. POST:\tThis\tcreates\ta\tresource\tin\tthe\tserver. PUT:\tThis\tupdates\ta\tresource\tin\tthe\tserver. DELETE:\tThis\tdeletes\ta\tresource\tfrom\tthe\tserver.\n\nThere\tare\tmore\tmethods\t(such\tas\tPATCH\tor\tCONNECT),\tbut\tlet's\tfocus\ton these\tfour.\tAs\tyou\tcan\tsee,\tthree\tof\tthese\tfour\tmethods\tmodify\tdata\tfrom the\tserver,\tand\ta\tuser\twith\ta\tvalid\tsession\tcould\tpotentially\tsteal\tdata, create\tpayments,\torder\tgoods,\tand\tso\ton.\n\nA\tway\tto\tavoid\tthe\tcross-site\trequest\tforgery\tattack\tis\tby\tprotecting\tthe POST,\tPUT\tand\tDELETE\tendpoints\twith\ta\tcross-site\trequest\ttoken.\n\nTake\ta\tlook\tat\tthe\tfollowing\tHTML\tform:\n\n<form\taction=\"register\"\tmethod=\"post\"> \t\t<input\tname=\"email\"\ttype=\"text\"\t> \t\t<input\tname=\"password\"\ttype=\"password\"\t> <form>\n\nThis\tform\tdescribes\ta\tperfectly\tvalid\tsituation:\ta\tuser\tregistering\ton\tour website;\tvery\tsimple,\tbut\tstill\tvalid\tand\tflawed.\n\nWe\tare\tspecifying\ta\tURL\tand\tthe\tlist\tof\texpected\tparameters\tso\tthat\tan attacker\tcan\tregister\thundreds\tor\tthousands\tof\taccounts\twithin\ta\tspan\tof minutes,\twith\ta\tsmall\tscript\tthat\tissues\ta\tPOST\trequest\twith\tthe\ttwo parameters\t(email\tand\tpassword)\tin\tthe\tbody.\n\nNow,\tlook\tat\tthe\tfollowing\tform:\n\n<form\taction=\"register\"\tmethod=\"post\">",
      "content_length": 1538,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 191,
      "content": "<input\tname=\"email\"\ttype=\"text\"\t> \t\t<input\tname=\"password\"\ttype=\"password\"\t/> \t\t<input\tname=\"csrftoken\"\ttype=\"hidden\"\t value=\"as7d6fasd678f5a5sf5asf\"\t> <form>\n\nYou\tcan\tsee\tthe\tdifference:\tthere\tis\tan\textra\thidden\tparameter\tcalled csrftoken.\n\nThis\tparameter\tis\ta\trandom\tstring\tthat\tis\tgenerated\tevery\ttime\ta\tform\tis rendered\tso\tthat\twe\tcan\tadd\tthis\textra\tparameter\tto\tevery\tform.\n\nOnce\tthe\tform\tis\tsubmitted,\tthe\tcsrftoken\tparameter\tis\tvalidated\tto\tonly let\tgo\tthrough\tthe\trequests\twith\ta\tvalid\ttoken\tand\tgenerate\ta\tnew\ttoken to\tbe\trendered\ton\tthe\tpage\tagain.\n\nOpen\tredirects\n\nSometimes,\tour\tapplication\tmight\tneed\tto\tredirect\tthe\tuser\tto\ta\tcertain URL.\tFor\texample,\twhen\thitting\ta\tprivate\tURL\twithout\ta\tvalid authentication,\tthe\tuser\twill\tusually\tbe\tredirected\tto\tthe\tlogin\tpage:\n\nhttp://www.mysite.com/my-private-page\n\nThis\tcould\tresult\tinto\ta\tredirect\tto\tthe\tfollowing:\n\nhttp://www.mysite.com/login?redirect=/my-private-page\n\nThis\tsounds\tlegit.\tThe\tuser\tis\tsent\tto\tthe\tlogin\tpage,\tand\tonce\the provides\ta\tvalid\tset\tof\tcredentials,\tit\tis\tredirected\tto\t/my-private-page.\n\nWhat\thappens\tif\tsomeone\ttries\tto\tsteal\tthe\taccount\tof\tour\tuser?\n\nLook\tat\tthe\tfollowing\trequest:\n\nhttp://www.mysite.com/login?redirect=http://myslte.com\n\nThis\tis\ta\tcrafted\trequest\tthat\twill\tredirect\tthe\tuser\tto\tmyslte.com\tinstead of\tmysite.com\t(note\tthe\tl\tinstead\tof\ti).\n\nSomeone\tcould\tmake\tmyslte.com\tlook\tlike\tthe\tlogin\tpage\tof\tmysite.com",
      "content_length": 1410,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 192,
      "content": "and\tsteal\tyour\tuser's\tpassword\tand\tusername\tby\tdistributing\tthe preceding\tURL\tin\tthe\tsocial\tmedia\tas\tthe\tusers\twill\tbe\tredirected\tto\ta malicious\tpage.\n\nThe\tsolution\tfor\tthe\tpreceding\tproblem\tis\tquite\tsimple:\tdon't\tredirect\tthe user\tto\tuntrusted\tthird-party\twebsites.\n\nAgain,\tthe\tbest\tway\tof\tdoing\tsuch\ttask\tis\twhite\tlisting\tthe\ttarget\thosts\tfor redirects.\tBasically,\twe\tdon't\tlet\tour\tsoftware\tredirect\tour\tcustomers\tto unknown\twebsites.\n\nEffective\tcode\treviews\n\nOne\tof\tthe\tmost\teffective\tways\tto\treduce\tsecurity\tflaws\tin\tour applications\tis\tthrough\ta\tsystematic\tand\tinformed\tcode\treview\tprocess. The\tproblem\twith\tcode\treviews\tis\tthat\tthey\talways\tend\tup\tbeing\ta\tdump area\tfor\topinions\tand\tpersonal\tpreferences\tthat\tusually\tnot\tonly\twon't improve\tthe\tquality\tof\tthe\tcode,\tbut\twill\talso\tlead\tto\tlast\tminute\tchanges that\tcould\texpose\tvulnerabilities\tin\tour\tapplication.\n\nA\tdedicated\tstage\tin\tthe\tproduct\tdevelopment\tlife\tcycle\tfor\ta\tsecurity code\treview\thelps\tto\tdrastically\treduce\tthe\tamount\tof\tbugs\tdelivered\tto production.\n\nThe\tproblem\tthat\tthe\tsoftware\tengineers\thave\tis\tthat\ttheir\tmind\tis\ttrained to\tbuild\tthings\tthat\twork\twell,\tbut\tthey\tdon't\thave\tthe\tmindset\tto\tfind defects,\tespecially\taround\tthe\tthings\tthat\tthey\tbuild.\tThis\tis\twhy\tyou should\tnot\tbe\ttesting\tyour\town\tcode\t(any\tfurther\tthan\tthe\ttest\tcarried\ton when\tdeveloping),\tand\teven\tless,\tsecurity\ttesting\tyour\tapplication.\n\nHowever,\twe\tusually\twork\tin\tteams\tand\tthat\tenables\tus\tto\treview someone\telse's\tcode,\tbut\twe\thave\tto\tdo\tit\tin\tan\teffective\tmanner.\n\nCode\treviews\trequire\tas\tmuch\tbrain\tpower\tas\tneeded\tto\twrite\tsoftware, especially\tif\tyou\tare\treviewing\ta\tcomplex\tcode.\tYou\tshould\tnever\tspend more\tthan\ttwo\thours\treviewing\tthe\tsame\tfunctionality,\totherwise important\tflaws\twill\tbe\tmissed\tand\tattention\tto\tdetail\twill\tdecrease\tto\ta worrying\tlevel.",
      "content_length": 1809,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 193,
      "content": "This\tis\tnot\ta\tbig\tproblem\tin\tmicroservices-based\tarchitectures\tas\tthe functionality\tshould\tbe\tsmall\tenough\tto\tbe\tread\tin\ta\treasonable\tperiod\tof time,\tespecially\tif\tyou\ttalked\tto\tthe\tauthor\tabout\twhat\the\twas\ttrying\tto build.\n\nYou\tshould\talways\tfollow\ta\ttwo\tphase\treview,\tas\tfollows:\n\nReview\tthe\tcode\tquickly\tto\tget\tthe\tbig\tpicture:\thow\tit\tworks,\twhat technology\tit\tuses\tthat\tyou\tare\tnot\tfamiliar\twith,\tdoes\tit\tdo\twhat\tit\tis supposed\tto\tdo,\tand\tso\ton Review\tthe\tcode\tfollowing\ta\tchecklist\tof\titems\tto\tlook\tfor\n\nThis\tlist\tof\titems\thas\tto\tbe\tdecided\tupfront\tand\tdepends\ton\tthe\tnature\tof the\tsoftware\tthat\tyour\tcompany\tis\tbuilding.\n\nUsually,\tthe\tlist\tof\titems\tto\tcheck\taround\tthe\tcode\tsecurity\tconcerns during\ta\tcode\treview\tis\tquite\tbig,\tbut\twe\tcan\tnarrow\tit\tdown\tto\tthe following\tcomponents:\n\nIs\tall\tthe\tinput\tvalidated/encoded\twhen\tapplicable? Is\tall\tthe\toutput\tencoded,\tincluding\tlogs? Do\twe\tprotect\tendpoints\twith\tcross-site\trequest\tforgery\ttokens? Are\tall\tthe\tuser\tcredentials\tencrypted\tor\thashed\tin\tthe\tdatabase?\n\nIf\twe\tcheck\tthis\tlist,\twe\twill\tbe\table\tto\tidentify\tthe\tbiggest\tissues\taround security\tin\tour\tapps.",
      "content_length": 1113,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 194,
      "content": "Traceability\n\nTraceability\tis\textremely\timportant\tin\tthe\tmodern\tinformation\tsystems.\tIt is\ta\tdelicate\tmatter\tin\tmicroservices\tthat\tis\tgracefully\tsolved\tin\tSeneca, making\tthe\trequests\teasy\tto\tfollow\taround\tour\tsystem\tso\tthat\twe\tcan audit\tthe\tfailure.\n\nLogging\n\nSeneca\tis\tpretty\tgood\twith\tthe\tlogging.\tThere\tare\tso\tmany\toptions\tthat can\tbe\tconfigured\tin\tSeneca\tin\torder\tto\tget\tthe\trequired\tinformation about\thow\teverything\tis\tworking\t(if\tit\tis\tworking).\n\nLet's\tsee\thow\tlogging\tworks\twith\ta\tsmall\tapplication:\n\nvar\tseneca\t=\trequire(\"seneca\")();\n\nseneca.add({cmd:\t\"greeter\"},\tfunction(args,\tcallback){ \t\tcallback(null,\t{message:\t\"Hello\t\"\t+\targs.name}); });\n\nseneca.act({cmd:\t\"greeter\",\tname:\t\"David\"},\t function(err,\tresult)\t{ \t\tconsole.log(result); });\n\nThis\tis\tthe\tsimplest\tSeneca\tapplication\tthat\tcan\tbe\twritten.\tLet's\trun\tit\tas follows:\n\nseneca\t\tnode\tindex.js 2016-02-01T09:55:40.962Z\t 3rhomq69cbe0/1454579740947/84217/-\tINFO\thello\t Seneca/1.0.0/3rhomq69cbe0/1454579740947/84217/- {\tmessage:\t'Hello\tDavid'\t}\n\nThis\tis\tthe\tresult\tof\trunning\tthe\tapp\twith\tthe\tdefault\tlogging\tconfiguration. Aside\tfrom\tthe\tconsole.log()\tmethod\tthat\twe\thave\tused\tin\tthe\tcode, there\tis\tsome\tinternal\tinformation\tabout\tSeneca\tbeing\tlogged. Sometimes,\tyou\tmight\twant\tto\tonly\tlog\twhat\tyour\tapplication\tis\tproducing",
      "content_length": 1288,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 195,
      "content": "so\tthat\tyou\tcan\tdebug\tthe\tapplication\twithout\tall\tthe\tnoise.\tIn\tthis\tcase, just\trun\tthe\tfollowing\tcommand:\n\nseneca\t\tnode\tindex.js\t--seneca.log.quiet {\tmessage:\t'Hello\tDavid'\t}\n\nHowever,\tsometimes,\tthere\tare\tweird\tbehaviors\tin\tthe\tsystem\t(or\teven\ta bug\tin\tthe\tframeworks\tused)\tand\tyou\twant\tto\tget\tall\tthe\tinformation about\twhat\tis\thappening.\tSeneca\tsupports\tthat\tas\twell,\tas\tshown\tin\tthe following\tcommand:\n\nseneca\t\tnode\tindex.js\t--seneca.log.print\n\nThe\tpreceding\tcommand\twill\tprint\tan\tendless\tamount\tof\tinformation\tthat might\tnot\tbe\thelpful.\n\nIn\torder\tto\treduce\tthe\tamount\tof\tlogging\tproduced\tby\tSeneca,\tthere\tis\ta fine-grain\tcontrol\tin\twhat\tgets\tlogged\tinto\tthe\toutput.\tLet's\ttake\ta\tlook\tat the\tfollowing\tlines:\n\n2016-02-01T10:00:07.191Z\t dyy9ixcavqu4/1454580006885/85010/-\tDEBUG\tregister\t install\ttransport\t{exports:[transport/utils]}\tseneca- 8t1dup 2016-02-01T10:00:07.305Z\t dyy9ixcavqu4/1454580006885/85010/-\tDEBUG\tregister\tinit\t seneca-y9os9j 2016-02-01T10:00:07.305Z\t dyy9ixcavqu4/1454580006885/85010/-\tDEBUG\tplugin\t seneca-y9os9j\tDEFINE\t{} 2016-02-01T10:00:07.330Z\t dyy9ixcavqu4/1454580006885/85010/-\tDEBUG\tact\troot$\t\t\t\t\t\t\t IN\to5onzziv9i7a/b7dtf6v1u9sq\tcmd:greeter\t {cmd:greeter,name:David}\tENTRY\t(mnb89)\t-\t-\t-\n\nThey\tare\trandom\tlines\tfrom\ta\tlog\toutput\ton\tthe\tpreceding\tcode\texample, but\tit\twill\tgive\tus\tuseful\tinformation:\tthese\tentries\tare\tdebug-level\tlog lines\tfor\tdifferent\tactions\t(such\tas\tplugin,\tregister,\tand\tact)\ton\tthe Seneca\tframework.\tIn\torder\tto\tfilter\tthem,\tSeneca\tprovides\ta\tcontrol\tover what\tlevels\tor\tactions\tdo\twe\twant\tto\tsee.\tConsider\tthe\tfollowing\tfor example:",
      "content_length": 1586,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 196,
      "content": "node\tindex.js\t--seneca.log=level:INFO\n\nThis\twill\tonly\toutput\tthe\tlogs\trelated\tto\tthe\tINFO\tlevel:\n\nseneca\t\tnode\tindex.js\t--seneca.log=level:INFO 2016-02-04T10:39:04.685Z\t q6wnh8qmm1l3/1454582344670/91823/-\tINFO\thello\t Seneca/1.0.0/q6wnh8qmm1l3/1454582344670/91823/- {\tmessage:\t'Hello\tDavid'\t}\n\nYou\tcan\talso\tfilter\tby\taction\ttype,\twhich\tis\tquite\tinteresting.\tWhen\tyou are\tworking\twith\tmicroservices,\tknowing\tthe\tchain\tof\tevents\tthat happened\tin\ta\tflow\tis\tone\tof\tthe\tfirst\tthings\tthat\tyou\tneed\tto\tlook\tinto\tin order\tto\taudit\ta\tfailure.\tWith\tthis\tcontrol\tover\tthe\tlogging\tthat\tSeneca gives\tus,\tit\tis\tas\teasy\tas\texecuting\tthe\tfollowing\tcommand:\n\nnode\tindex.js\t--seneca.log=type:act\n\nThis\twill\tproduce\tthe\tfollowing\toutput:\n\nAs\tyou\tcan\tsee,\tall\tthe\tpreceding\tlines\tcorrespond\tto\tthe\tact\ttype,\tand even\tmore,\tif\twe\tfollow\tthe\toutput\tof\tthe\tcommand\tfrom\ttop\tto\tbottom, we\texactly\tknow\tthe\tsequence\tof\tevents\tto\twhich\tSeneca\treacted\tand their\torder.\n\nTracing\trequests\n\nTracing\trequests\tis\talso\ta\tvery\timportant\tactivity,\tand\tsometimes,\tit\tis even\ta\tlegal\trequirement,\tespecially\tif\tyou\twork\tin\tthe\tworld\tof\tfinance. Again,\tSeneca\tis\tfantastic\tat\ttracing\trequests.\tFor\tevery\tcall,\tSeneca generates\ta\tunique\tidentifier.\tThis\tidentifier\tcan\tbe\ttraced\tacross\tall\tthe paths\tto\twhere\tthe\tcall\tis\tgoing\tto,\tas\tfollows:",
      "content_length": 1302,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 197,
      "content": "var\tseneca\t=\trequire(\"seneca\")();\n\nseneca.add({cmd:\t\"greeter\"},\tfunction(args,\tcallback){ \t\tconsole.log(this.fixedargs['tx$']); \t\tcallback(null,\t{message:\t\"Hello\t\"\t+\targs.name}); }); seneca.act({cmd:\t\"greeter\",\tname:\t\"David\"},\t function(err,\tresult)\t{ \t\tconsole.log(this.fixedargs['tx$']); });\n\nHere,\twe\tare\tlogging\ta\tdictionary\tthat\tcontains\tthe\ttransaction\tID\tin Seneca\tto\tthe\tterminal.\tSo,\tif\twe\texecute\tit,\twe\twill\tget\tthe\tfollowing output:\n\n2016-02-04T10:58:07.570Z\t zl0u7hj3hbeg/1454583487555/95159/-\tINFO\thello\t Seneca/1.0.0/zl0u7hj3hbeg/1454583487555/95159/- 3jlroj2n91da 3jlroj2n91da\n\nYou\tcan\tsee\thow\tall\tthe\trequests\tin\tSeneca\tare\ttraced:\tthe\tframework assigns\tan\tID\tand\tit\tgets\tpropagated\tacross\tendpoints.\tIn\tthis\tcase,\tall our\tendpoints\tare\tin\tthe\tlocal\tmachine,\tbut\tif\twe\tdistribute\tthem\tin different\tmachines,\tthe\tID\twill\tstill\tbe\tthe\tsame.\n\nWith\tthis\tunique\tID,\twe\twill\tbe\table\tto\treconstruct\tthe\tjourney\tof\tthe customer\tdata\tin\tour\tsystem,\tand\tordering\tthe\trequests\twith\tthe associated\ttimestamp,\twe\tcan\tget\tan\taccurate\tpicture\tof\twhat\tthe\tuser was\tdoing,\thow\tmuch\ttime\tdid\tevery\taction\ttake,\twhat\tare\tthe\tpossible problems\tassociated\twith\tdelays,\tand\tso\ton.\tUsually,\tthe\tlogging combined\twith\tcircuit\tbreakers\toutput\tinformation\tallows\tthe\tengineers\tto solve\tissues\twithin\ta\tvery\treduced\ttime\tframe.\n\nAuditing\n\nUp\ttill\tnow,\twe\thave\tbeen\tusing\tconsole.log()\tto\toutput\tthe\tdata\tinto\tthe logs.\tThis\tis\ta\tbad\tpractice.\tIt\tbreaks\tthe\tformat\tof\tthe\tlogs\tand\tthrows the\tcontent\tto\tthe\tstandard\toutput.\n\nAgain,\tSeneca\tcomes\tto\tthe\trescue:",
      "content_length": 1548,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 198,
      "content": "var\tseneca\t=\trequire(\"seneca\")();\n\nseneca.add({cmd:\t\"greeter\"},\tfunction(args,\tcallback){ \t\tthis.log.warn(this.fixedargs['tx$']); \t\tcallback(null,\t{message:\t\"Hello\t\"\t+\targs.name}); });\n\nseneca.act({cmd:\t\"greeter\",\tname:\t\"David\"},\t function(err,\tresult)\t{ \t\tthis.log.warn(this.fixedargs['tx$']); });\n\nLet's\tsee\twhat\tSeneca\tproduces\tas\toutput:\n\nseneca\t\tnode\tindex.js 2016-02-04T11:17:28.772Z\t wo10oa299tub/1454584648758/98550/-\tINFO\thello\t Seneca/1.0.0/wo10oa299tub/1454584648758/98550/- 2016-02-04T11:17:29.156Z\t wo10oa299tub/1454584648758/98550/-\tWARN\t-\t-\tACT\t 02jlpyiux70s/9ca086d19x7n\tcmd:greeter\t9ca086d19x7n 2016-02-04T11:17:29.157Z\t wo10oa299tub/1454584648758/98550/-\tWARN\t-\t-\tACT\t 02jlpyiux70s/9ca086d19x7n\tcmd:greeter\t9ca086d19x7n\n\nAs\tyou\tcan\tsee,\twe\tare\tnow\toutputting\tthe\ttransaction\tID\tusing\tthe logger.\tWe\thave\tproduced\ta\tWARN\tmessage\tinstead\tof\ta\tsimple\tconsole dump.\tFrom\tnow\ton,\twe\tcan\tuse\tSeneca\tlog\tfilters\tto\thide\tthe\toutput\tof our\tactions\tin\torder\tto\tfocus\ton\twhat\twe\tare\ttrying\tto\tfind.\n\nSeneca\tprovides\tthe\tfollowing\tfive\tlevels\tof\tlogging:\n\nDEBUG:\tThis\tis\tused\tto\tdebug\tapplications\twhen\tyou\tare developing\tthem\tand\talso\ttrace\tproblems\tin\tproduction\tsystems. INFO:\tThis\tlog\tlevel\tis\tused\tto\tproduce\timportant\tmessages\tabout events\tsuch\tas\ta\ttransaction\thas\tstarted\tor\tcompleted. WARN:\tThis\tis\tthe\twarning\tlevel.\tWe\tuse\tit\twhen\tsomething\tbad happens\tin\tthe\tsystem,\tbut\tit\tis\tnot\tcritical,\tthe\tuser\tusually\tdoes\tnot get\taffected;\thowever,\tit\tis\tan\tindication\tthat\tsomething\tis\tgoing\tin the\twrong\tway. ERROR:\tThis\tis\tused\tto\tlog\terrors.\tGenerally,\tthe\tuser\tgets\taffected by\tit\tand\tit\talso\tinterrupts\tthe\tflow.",
      "content_length": 1627,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 199,
      "content": "FATAL:\tThis\tis\tthe\tmost\tcatastrophic\tlevel.\tIt\tis\tonly\tused\twhen\ta non-recoverable\terror\thas\toccurred\tand\tthe\tsystem\twon't\tbe\table\tto function\tnormally.\n\nA\tway\tto\tproduce\tlogs\tin\tdifferent\tlevels\tis\tto\tuse\tthe\tassociated functions.\tAs\twe\thave\tseen\tearlier,\twe\tcalled\tthis.log.warn()\tto\tlog\ta warning.\tIf\twe\tcall\tthe\tthis.log.fatal()\tmethod,\twe\twill\tbe\tlogging\ta fatal\terror,\tand\tsame\twith\tthe\tother\tlevels.\n\nTip\n\nTry\tto\tadjust\tthe\tlogs\tin\tyour\tapplication\tas\ta\tpart\tof\tthe\tdevelopment process\tor\tyou\twill\tregret\tthe\tlack\tof\tinformation\twhen\tsomething\tbad occurs\tin\tproduction.\n\nIn\tgeneral,\tINFO,\tDEBUG,\tand\tWARN\twill\tbe\tthe\tmost\tused\tlog\tlevels.\n\nHTTP\tcodes\n\nHTTP\tcodes\tare\toften\tignored,\tbut\tthey\tare\ta\treally\timportant mechanism\tto\tstandardize\tresponses\tfrom\tremote\tservers.\n\nWhen\ta\tprogram\t(or\tuser)\tissues\ta\trequest\tto\ta\tserver,\tthere\tare\ta\tfew things\tthat\tcould\thappen,\tas\tfollows:\n\nIt\tcould\tbe\tsuccessful It\tcould\tfail\tvalidation It\tcould\tproduce\ta\tserver\terror\n\nAs\tyou\tcan\tsee,\tthe\tpossibilities\tare\tendless.\tThe\tproblem\tthat\twe\tnow have\tis\tthat\tHTTP\twas\tcreated\tfor\tthe\tcommunication\tbetween machines.\tHow\tdo\twe\thandle\tthe\tfact\tthat\tmachines\twill\tbe\treading\tthese codes?\n\nHTTP\tsolved\tthis\tproblem\tin\ta\tvery\telegant\tway:\tevery\tsingle\trequest has\tto\tbe\tresolved\twith\tan\tHTTP\tcode\tand\tthese\tcodes\thave\tranges\tthat indicate\tthe\tnature\tof\tthe\tcode.",
      "content_length": 1351,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 200,
      "content": "1xx\t–\tinformational\n\nThe\tcodes\tin\tthe\t100-199\trange\tare\tpurely\tinformational.\tThe\tmost interesting\tcode\tin\tthis\trange\tis\tthe\t102\tcode.\tThis\tcode\tis\tused\tto specify\tthat\tan\toperation\tis\thappening\tin\tthe\tbackground\tand\tmight\ttake some\ttime\tto\tcomplete.\n\n2xx\t–\tsuccess\tcodes\n\nSuccess\tcodes\tare\tused\tto\tindicate\ta\tcertain\tlevel\tof\tsuccess\tin\tthe HTTP\trequest.\tIt\tis\tthe\tmost\tcommon\t(and\tdesired)\tcodes.\n\nThe\tmost\tcommon\tcodes\tin\tthis\trange\tare\tas\tfollows:\n\n200:\tSuccess:\tThis\tcode\tindicates\ta\tfull\tsuccess.\tNothing\twent wrong\teven\tremotely. 201:\tCreated:\tThis\tcode\tis\tused\tmainly\tfor\tREST\tAPIs\twhen\tthe client\trequests\tto\tcreate\ta\tnew\tentity\tin\tthe\tserver. 203:\tNon-authoritative\tinformation:\tThis\tcode\tis\tintended\tto\tbe used\twhen,\twhile\trouting\tthe\trequest\tthrough\ta\ttransforming\tproxy, the\torigin\tresponds\twith\ta\t200. 204:\tNo\tContent:\tThis\tis\ta\tsuccessful\tcode,\tbut\tthere\tis\tno\tcontent coming\tback\tfrom\tthe\tserver.\tSometimes,\tAPIs\treturns\t200,\teven\tif there\tis\tno\tcontent. 206:\tPartial\tContent:\tThis\tcode\tis\tused\tfor\tpaginated\tresponses.\tA header\tis\tsent,\tspecifying\ta\trange\t(and\tan\toffset)\tthat\tthe\tclient\twill accept.\tIf\tthe\tresponse\tis\tbigger\tthan\tthe\trange,\tthe\tserver\twill\treply with\t206,\tindicating\tthat\tthere\tis\tmore\tdata\tto\tfollow.\n\n3xx\t–\tredirection\n\nThe\tcodes\tin\tthe\t300\tto\t399\trange\tindicate\tthat\tthe\tclient\tmust\ttake\tsome additional\tactions\tto\tcomplete\tthe\trequest.\n\nThe\tmost\tcommon\tcodes\tin\tthis\trange\tare\tdescribed\tas\tfollows:\n\n301:\tMoved\tpermanently:\tThis\tstatus\tcode\tis\tindicating\tthat\tthe resource\tthat\tthe\tclient\twas\ttrying\tto\tget\thas\tbeen\tmoved permanently\tto\tanother\tlocation.",
      "content_length": 1594,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 201,
      "content": "302:\tFound:\tThis\tcode\tindicates\tthat\tthe\tuser\tis\trequired\tto\tperform\ta temporary\tredirect\tfor\tsome\treason,\tbut\tthe\tbrowsers\tstarted implementing\tthis\tcode\tas\t303\tSee\tOther.\tThis\tlead\tto\tthe introduction\tof\tthe\t303\tand\t307\tTemporary\tredirect\tcodes\tto disambiguate\tthe\toverlap\tof\tbehavior. 308\tPermanent\tRedirect:\tThis\tcode,\tas\tthe\tname\tindicates,\tis\tused to\tspecify\ta\tpermanent\tredirect\tfor\ta\tresource.\tIt\tcould\tbe\tconfused with\t301,\tbut\tthere\tis\ta\tsmall\tdifference,\tthe\t308\tcode\tdoes\tnot\tallow the\tHTTP\tmethod\tto\tchange.\n\n4xx\t–\tclient\terrors\n\nThe\tcodes\tin\tthe\t400\tto\t499\trange\trepresent\terrors\tgenerated\tby\tthe client.\tThey\tindicate\tthat\tthere\tis\ta\tproblem\twith\tthe\trequest.\tThis\trange is\tparticularly\timportant\tas\tit\tis\tthe\tway\tthat\tHTTP\tservers\thave\tto indicate\tthe\tclients\tthat\tsomething\tis\twrong\twith\ttheir\trequest.\n\nThe\tcommon\tcodes\tin\tthis\trange\tare\tas\tfollows:\n\n400\tBad\tRequest:\tThis\tcode\tindicates\tthat\tthe\trequest\tfrom\tthe\tuser is\tsyntactically\tincorrect.\tThere\tcould\tbe\tparameters\tmissing\tor some\tof\tthe\tvalues\tdidn't\tpass\tvalidation. 401\tUnauthorized:\tThis\tcode\trepresents\ta\tlack\tof\tauthentication\tof the\tclient.\tUsually,\ta\tvalid\tlogin\twill\tfix\tthis\tproblem. 403\tForbidden:\tThis\tis\tsimilar\tto\t401,\tbut\tin\tthis\tcase,\tit\tis\tindicating that\tthe\tuser\tdoes\tnot\thave\tenough\tprivileges. 404\tNot\tFound:\tThis\tmeans\tthat\tthe\tresource\tis\tnot\tfound\tin\tthe server.\tThis\tis\tthe\terror\tthat\tyou\tget\twhen\tyou\tnavigate\tto\ta\tpage that\tdoes\tnot\texist.\n\n5xx\t–\tserver\terrors\n\nThis\trange\tindicates\tthat\tthere\thas\tbeen\ta\tprocessing\terror\tin\tthe\tserver. When\ta\t5xx\tcode\tis\tissued,\tit\tmeans\tthat\tthere\twas\tsome\tsort\tof\tproblem in\tthe\tserver\tand\tit\tcannot\tbe\tfixed\tfrom\tthe\tclient.\n\nSome\tof\tthe\tcodes\tin\tthis\trange\tare\tas\tfollows:\n\n500\tInternal\tServer\tError:\tThis\tmeans\tthat\tan\terror\thas\toccurred",
      "content_length": 1780,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 202,
      "content": "in\tthe\tsoftware\tin\tthe\tserver.\tThere\tis\tno\tmore\tinformation\tdisclosed. 501\tNot\tImplemented:\tThis\terror\toccurs\twhen\ta\tclient\thits\tan endpoint\tthat\thas\tnot\tbeen\timplemented\tyet. 503\tService\tunavailable:\tThis\tcode\tis\tissued\twhen\tthe\tserver\tis\tnot available\tfor\tsome\treason,\teither\tan\texcess\tof\tthe\tload\tor\tthe\tserver is\tdown.\n\nWhy\tHTTP\tcodes\tmatter\tin\tmicroservices\n\nThe\tpopular\tsaying\tdon't\treinvent\tthe\twheel\tis\tone\tof\tmy\tfavorite principles\twhen\tbuilding\tsoftware.\tHTTP\tcodes\tare\ta\tstandard,\tso everybody\tunderstands\tthe\tconsequences\tof\tthe\tdifferent\tcodes.\n\nWhen\tbuilding\tmicroservices,\tyou\talways\tneed\tto\tkeep\tin\tmind\tthat\tyour system\twill\tbe\tinteracting\twith\tproxies,\tcaches,\tand\tother\tservices\tthat already\tspeak\tHTTP\tso\tthat\tthey\tcan\treact\taccording\tto\tthe\tresponse from\tthe\tservers.\n\nThe\tbest\texample\tof\tthis\tis\tthe\tcircuit-breaker\tpattern.\tNo\tmatter\thow\tyou implement\tit\tand\twhat\tsoftware\tyou\tuse,\ta\tcircuit\tbreaker\thas\tto understand\tthat\tan\tHTTP\trequest\twith\t500\tcode\tis\tan\terror,\tso\tit\tcan open\tthe\tcircuit\taccordingly.\n\nIn\tgeneral,\tit\tis\tgood\tpractice\tto\tkeep\tthe\tcodes\tof\tyour\tapplication\tas accurate\tas\tpossible\tas\tit\twill\tbenefit\tyour\tsystem\tin\tthe\tlong\trun.",
      "content_length": 1171,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 203,
      "content": "Summary\n\nIn\tthis\tchapter,\tyou\thave\tlearned\thow\tto\tbuild\tsecure\tsoftware\t(and\tnot only\tmicroservices),\talthough\tit\tis\ta\tsubject\tbig\tenough\tto\twrite\ta\tfull book\ton\tit.\tThe\tproblem\twith\tsecurity\tis\tthat\tcompanies\tusually\tsee investing\tin\tsecurity\tas\tburning\tmoney,\tbut\tthat\tis\tfar\tfrom\treality.\tI\tam\ta big\tfan\tof\tthe\t80-20\trule:\t20%\tof\ttime\twill\tgive\tyou\t80%\tof\tfeatures\tand the\t20%\tof\tmissing\tfeatures\twill\trequire\t80%\tof\tthe\ttime.\n\nIn\tsecurity,\twe\treally\tshould\tbe\taiming\tfor\t100%\tcoverage;\thowever,\tthe 80%\tshown\tin\tthis\tchapter\twill\tcover\tmajority\tof\tthe\tcases.\tAnyway,\tas\tI mentioned\tbefore,\ta\tsoftware\tengineer\tshould\tbe\tup\tto\tdate\twith\tsecurity as\ta\tflaw\tin\tthe\tsecurity\tof\tan\tapplication\tis\tthe\teasiest\tway\tto\tkill\ta company.\n\nWe\thave\talso\tbeen\ttalking\tabout\ttraceability\tand\tlogging,\tone\tof\tthe\tmost ignored\tsubjects\tin\tthe\tmodern\tsoftware\tengineering\tthat\tare\tbecoming more\tand\tmore\timportant,\tespecially\tif\tyour\tsoftware\tis\tbuilt\tusing\ta microservices\tapproach.",
      "content_length": 969,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 204,
      "content": "Chapter\t6.\tTesting\tand Documenting\tNode.js Microservices\n\nUntil\tnow,\tall\tthat\twe\thave\tdone\tis\tdevelop\tmicroservices\tand\tdiscuss\tthe frameworks\taround\tthe\tprocess\tof\tbuilding\tsoftware\tcomponents.\tNow\tit is\ttime\tto\ttest\tall\tof\tthem.\tTesting\tis\tthe\tactivity\tof\tvalidating\tthe\tsoftware that\thas\tbeen\tbuilt.\tValidating\tis\ta\tvery\tbroad\tterm.\tIn\tthis\tchapter,\twe\tare going\tto\tlearn\thow\tto\ttest\tmicroservices,\tnot\tonly\tfrom\tthe\tfunctional point\tof\tview,\tbut\twe\twill\talso\tlearn\thow\tto\ttest\tthe\tperformance\tof\tour applications,\tas\twell\tas\tother\taspects\tsuch\tas\tintegration\twith\tdifferent modules.\tWe\twill\talso\tbuild\ta\tproxy\tusing\tNode.js\tto\thelp\tus\tto\tinspect the\tinputs\tand\toutputs\tof\tour\tservices\tso\tthat\twe\tcan\tvalidate\tthat\twhat we\thave\tdesigned\tis\tactually\thappening\tand,\tonce\tagain,\treassure\tthe versatility\tof\ta\tlanguage,\tsuch\tas\tJavaScript,\tto\tquickly\tprototype features.\n\nIt\tis\talso\tnowadays\ta\ttrend\tto\trelease\tfeatures\twith\tan\tA/B\ttest,\twhere\twe only\tenable\tthe\tfeatures\tfor\tcertain\ttype\tof\tusers,\tand\tthen\twe\tcollect metrics\tto\tsee\thow\tthe\tchanges\tto\tour\tsystem\tare\tperforming.\tIn\tthis chapter,\twe\twill\tbuild\ta\tmicroservice\tthat\tis\tgoing\tto\tgive\tus\tthe\tcapability of\trolling\tout\tfeatures\tin\ta\tcontrolled\tway.\n\nOn\tthe\tother\thand,\twe\tare\tgoing\tto\tdocument\tour\tapplication,\twhich unfortunately,\tis\ta\tforgotten\tactivity\tin\ttraditional\tsoftware\tdevelopment:\tI haven't\tfound\ta\tsingle\tcompany\twhere\tthe\tdocumentation\tcaptures\t100% the\tinformation\tneeded\tby\tnew\tdevelopers.\n\nWe\twill\tcover\tthe\tfollowing\ttopics\tin\tthis\tchapter:\n\nFunctional\ttesting:\tIn\tthis\tsection,\twe\twill\tlearn\thow\tto\ttest microservices\tand\twhat\ta\tgood\ttesting\tstrategy\tis.\tWe\twill\talso\tget\tto study\ta\ttool\tcalled\tPostman\tto\tmanually\ttest\tour\tAPIs,\tas\twell\tas build\ta\tproxy\twith\tNode.js\tto\tspy\tour\tconnections. Documenting\tmicroservices:\tWe\twill\tlearn\thow\tto\tuse\tSwagger\tto document\tour\tmicroservices\tusing\tthe\topen\tAPI\tstandard.\tWe\twill",
      "content_length": 1898,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 205,
      "content": "also\tgenerate\tthe\tcode\tfrom\tthe\tYAML\tdefinition\tusing\tan\topen source\ttool.\n\nFunctional\ttesting\n\nTesting\tis\tusually\ta\ttime-consuming\tactivity\tthat\tdoes\tnot\tget\tall\tthe required\tattention\twhile\tbuilding\ta\tsoftware.\n\nThink\tabout\thow\ta\tcompany\tevolves:\n\n1.\t Someone\tcomes\tup\twith\tan\tidea. 2.\t A\tfew\tengineers/product\tpeople\tbuild\tthe\tsystem. 3.\t The\tcompany\tgoes\tto\tmarket.\n\nThere\tis\tno\ttime\tto\ttest\tmore\tthan\tthe\tminimal\trequired\tmanual\ttesting. Especially,\twhen\tsomeone\treads\ton\tthe\tInternet\tthat\ttesting\tdone\tright could\ttake\tup\tto\t40%\tof\tyour\tdevelopment\ttime,\tand\tonce\tagain,\tthe common\tsense\tfails.\n\nAutomation\tis\tgood\tand\tunit,\tintegration,\tand\tend-to-end\ttests\tare\ta\tform of\tautomation.\tBy\tletting\ta\tcomputer\ttest\tour\tsoftware,\twe\tare\tdrastically cutting\tdown\tthe\thuman\teffort\trequired\tto\tvalidate\tour\tsoftware.\n\nThink\tabout\thow\tthe\tsoftware\tis\tdeveloped.\tEven\tthough\tour\tcompany likes\tto\tclaim\tthat\twe\tare\tagile,\tthe\ttruth\tis\tthat\tevery\tsingle\tsoftware project\thas\tsome\tlevel\tof\titerative\tdevelopment,\tand\ttesting\tis\ta\tpart\tof every\tcycle,\tbut\tgenerally,\tit\tis\toverlooked\tin\tfavour\tof\tdelivering\tnew features.\n\nBy\tautomating\tthe\tmajority\t(or\ta\tbig\tchunk)\tof\tthe\ttesting,\twe\tare\tsaving money,\tas\tshown\tin\tthe\tfollowing\tdiagram:",
      "content_length": 1231,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 206,
      "content": "Costs\tand\tIterations\n\nTesting\tis\tactually\ta\tcost\tsaver\tif\tis\tdone\tright,\tand\tthe\tkey\tis\tdoing\tit right,\twhich\tis\tnot\talways\teasy.\tHow\tmuch\ttesting\tis\ttoo\tmuch\ttesting? Should\twe\tcover\tevery\tsingle\tcorner\tof\tour\tapplication?\tDo\twe\treally need\tdeep\tperformance\ttesting?\n\nThese\tquestions\tusually\tlead\tto\ta\tdifferent\tstream\tof\topinions,\tand\tthe interesting\tthing\tis\tthat\tthere\tis\tnot\ta\tsingle\tsource\tof\ttruth.\tIt\tdepends\ton the\tnature\tof\tyour\tsystem.\n\nIn\tthis\tchapter,\twe\tare\tgoing\tto\tlearn\ta\tset\tof\textensive\ttesting techniques,\twhich\tdoes\tnot\tmean\tthat\twe\tshould\tbe\tincluding\tall\tof\tthem in\tour\ttest\tplan,\tbut\tat\tleast\twe\twill\tbe\taware\tof\tthe\ttesting methodologies.\n\nIn\tthe\tpast\tseven\tyears,\tRuby\ton\tRails\thas\tcreated\ta\tmassive\ttrend towards\ta\tnew\tparadigm,\tcalled\tTest-driven\tdevelopment\t(TDD),\tup\tto a\tpoint\tthat,\tnowadays,\tmajority\tof\tthe\tnew\tdevelopment\tplatforms\tare built\twith\tTDD\tin\tmind.\n\nPersonally,\tI\tam\tnot\ta\tfierce\tadopter\tof\tTDD,\tbut\tI\tlike\tto\ttake\tthe\tgood parts.\tPlanning\tthe\ttest\tbefore\tthe\tdevelopment\thelps\tto\tcreate\tmodules with\tthe\tright\tlevel\tof\tcohesion\tand\tdefine\ta\tclear\tand\teasy-to-test",
      "content_length": 1109,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 207,
      "content": "interface.\tIn\tthis\tchapter,\twe\twon't\tcover\tthe\tTDD\tin\tdepth,\tbut\twe\twill mention\tit\ta\tfew\ttimes\tand\texplain\thow\tto\tapply\tthe\texposed\ttechniques to\ta\tTDD\ttest\tplan.\n\nThe\tpyramid\tof\tautomated\ttesting\n\nHow\tto\tlay\tdown\tyour\ttesting\tplan\tis\ta\ttricky\tquestion.\tNo\tmatter\twhat you\tdo,\tyou\twill\talways\tend\tup\twith\tthe\tsensation\tthat\tthis\tis\tcompletely wrong.\n\nBefore\tdiving\tinto\tthe\tdeep,\tlet's\tdefine\tthe\tdifferent\ttype\tof\ttests\tthat\twe are\tgoing\tto\tbe\tdealing\twith\tfrom\tthe\tfunctional\tpoint\tof\tview,\tand\twhat should\tthey\tbe\tdesigned\tfor.\n\nUnit\ttests\n\nA\tunit\ttest\tis\ta\ttest\tthat\tcovers\tindividual\tparts\tof\tthe\tapplication\twithout taking\tinto\taccount\tthe\tintegration\twith\tdifferent\tmodules.\tIt\tis\talso\tcalled white\tbox\ttesting\tas\tthe\taim\tis\tto\tcover\tand\tverify\tas\tmany\tbranches\tas possible.\n\nGenerally,\tthe\tway\tto\tmeasure\tthe\tquality\tof\tour\ttests\tis\tthe\ttest\tcoverage and\tit\tis\tmeasured\tin\tpercentage.\tIf\tour\tcode\tspans\tover\tten\tbranches and\tour\ttests\tcover\tseven\tbranches,\tour\tcode\tcoverage\tis\t70%.\tThis\tis\ta good\tindication\tof\thow\treliable\tour\ttest\tcoverage\tis.\tHowever,\tit\tcould\tbe misleading\tas\tthe\ttests\tcould\tbe\tflawed,\tor\teven\tthough\tall\tthe\tbranches are\ttested,\ta\tdifferent\tinput\twould\tcause\ta\tdifferent\toutput\tthat\twasn't captured\tby\ta\ttest.\n\nIn\tunit\ttests,\tas\twe\tdon't\tinteract\twith\tother\tmodules,\twe\twill\tbe\tmaking\ta heavy\tuse\tof\tmocks\tand\tstubs\tin\torder\tto\tsimulate\tresponses\tfrom\tthird- party\tsystems\tand\tcontrol\tthe\tflow\tto\thit\tthe\tdesired\tbranch.\n\nIntegration\ttests\n\nIntegration\ttests,\tas\tthe\tname\tsuggests,\tare\tthe\ttests\tdesigned\tto\tverify the\tintegration\tof\tour\tmodule\tin\tthe\tapplication\tenvironment.\tThey\tare\tnot designed\tto\ttest\tthe\tbranches\tof\tour\tcode,\tbut\tbusiness\tunits,\twhere\twe",
      "content_length": 1694,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 208,
      "content": "will\tbe\tsaving\tthe\tdata\tinto\tdatabases,\tcalling\tthird-party\tweb\tservices\tor other\tmicroservices\tof\tour\tarchitecture.\n\nThese\ttests\tare\tthe\tperfect\ttool\tfor\tchecking\twhether\tour\tservice\tis behaving\tas\texpected,\tand\tsometimes,\tcould\tbe\thard\tto\tmaintain\t(more often\tthan\tnot).\n\nDuring\tmy\tyears\tof\texperience,\tI\thaven't\tfound\ta\tcompany\twhere\tthe integration\ttesting\tis\tdone\tright\tand\tthere\tare\ta\tnumber\tof\treasons\tfor this,\tas\tstated\tin\tthe\tfollowing\tlist:\n\nSome\tcompanies\tthink\tthat\tintegration\ttesting\tis\texpensive\t(and\tit\tis true)\tas\tit\trequires\textra\tresources\t(such\tas\tdatabases\tand\textra machines) Some\tother\tcompanies\ttry\tto\tcover\tall\tthe\tbusiness\tcases\tjust\twith unit\ttesting,\twhich\tdepending\ton\tthe\tbusiness\tcases,\tcould\twork,\tbut it\tis\tfar\tfrom\tideal\tas\tunit\ttests\tmake\tassumptions\t(mocks)\tthat\tcould give\tus\ta\tfalse\tconfidence\tin\tour\ttest\tsuite Sometimes,\tintegration\ttests\tare\tused\tto\tverify\tthe\tcode\tbranches\tas if\tthey\twere\tunit\ttests,\twhich\tis\ttime\tconsuming\tas\tyou\tneed\tto\twork out\tthe\tenvironment\tto\tmake\tthe\tintegration\ttest\tto\thit\tthe\trequired branch\n\nNo\tmatter\thow\tsmart\tyou\twant\tto\tbe,\tintegration\ttesting\tis\tsomething\tthat you\twant\tto\tdo\tright,\tas\tit\tis\tthe\tfirst\treal\tbarrier\tin\tour\tsoftware\tto\tprevent integration\tbugs\tfrom\tbeing\treleased\tinto\tproduction.\n\nEnd-to-end\ttests\n\nHere,\twe\twill\tdemonstrate\tthat\tour\tapplication\tactually\tworks.\tIn\tan integration\ttest,\twe\tare\tinvoking\tthe\tservices\tat\tcode\tlevel.\tThis\tmeans that\twe\tneed\tto\tbuild\tthe\tcontext\tof\tthe\tservice\tand\tthen\tissue\tthe\tcall.\n\nThe\tdifference\twith\tend-to-end\ttesting\tis\tthat,\tin\tend-to-end\ttesting,\twe actually\tfully\tdeploy\tour\tapplication\tand\tissue\tthe\trequired\tcalls\tto execute\tthe\ttarget\tcode.\tHowever,\tmany\ttimes,\tthe\tengineers\tcan\tdecide to\tbundle\tboth\ttype\tof\ttests\t(integration\tand\tend-to-end\ttests)\ttogether, as\tthe\tmodern\tframeworks\tallow\tus\tto\tquickly\trun\tE2E\ttests\tas\tif\tthey were\tintegration\ttests.",
      "content_length": 1893,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 209,
      "content": "As\tthe\tintegration\ttests,\tthe\ttarget\tof\tthe\tend-to-end\ttests\tis\tnot\tto\ttest\tall the\tpaths\tof\tthe\tapplication\tbut\ttest\tthe\tuse\tcases.\n\nIn\tend-to-end\ttests,\twe\tcan\tfind\ta\tfew\tdifferent\tmodalities\t(paradigms)\tof testing,\tas\tfollows:\n\nWe\tcan\ttest\tour\tAPI\tissuing\tJSON\trequests\t(or\tother\ttype\tof requests) We\tcan\ttest\tour\tUI\tusing\tSelenium\tto\temulate\tclicks\ton\tthe\tDOM We\tcan\tuse\ta\tnew\tparadigm\tcalled\tbehavior-driven\tdevelopment (BDD)\ttesting,\twhere\tthe\tuse\tcases\tare\tmapped\tinto\tactions\tin\tour application\t(clicks\ton\tthe\tUI,\trequests\tin\tthe\tAPI,\tand\tso\ton)\tand execute\tthe\tuse\tcases\tfor\twhich\tthe\tapplication\twas\tbuilt\n\nEnd-to-end\ttests\tare\tusually\tvery\tfragile\tand\tthey\tget\tbroken\tfairly\teasy. Depending\ton\tour\tapplication,\twe\tmight\tget\trelaxed\tabout\tthese\ttests\tas the\tcost-value\tratio\tis\tpretty\tlow,\tbut\tstill,\tI\twould\trecommend\thaving some\tof\tthem\tcovering\tat\tleast\tthe\tmost\tbasic\tand\tessential\tflows.\n\nHow\tmuch\ttesting\tis\ttoo\tmuch?\n\nQuestions\tsuch\tas\tthe\tfollowing\tare\tnot\teasy\tto\tanswer,\tespecially\tin\tfast paced\tbusinesses,\tlike\tstartups:\n\nDo\twe\thave\ttoo\tmany\tintegration\ttests? Should\twe\taim\tfor\t100%\tunit\ttest\tcoverage? Why\tbother\twith\tSelenium\ttests\tif\tthey\tbreak\tevery\tsecond\tday\tfor no\treason?\n\nThere\tis\talways\ta\tcompromise.\tTest\tcoverage\tversus\ttime\tconsumed, and\talso,\tthere\tis\tno\tsimple\tand\tsingle\tanswer\tto\tthese\tquestions.\n\nThe\tonly\tuseful\tguideline\tthat\tI've\tfound\talong\tthe\tyears\tis\twhat\tthe testing\tworld\tcalls\tthe\tpyramid\tof\ttesting,\twhich\tis\tshown\tin\tthe following\tfigure.\tIf\tyou\tthink\tfor\ta\tmoment,\tin\tthe\tprojects\twhere\tyou worked\tbefore,\thow\tmany\ttests\tdid\tyou\thave\tin\ttotal?\tWhat\tpercentage of\tthese\twere\tintegration\ttests\tand\tunit\ttests?\tWhat\tabout\tend-to-end tests?:",
      "content_length": 1691,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 210,
      "content": "The\tpyramid\tof\ttesting\n\nThe\tpreceding\tpyramid\tshows\tthe\tanswers\tfor\tthese\tquestions.\tIn\ta healthy\ttest\tplan,\twe\tshould\thave\ta\tlot\tof\tunit\ttests:\tsome\tintegration tests\tand\tvery\tfew\tE2E\ttests.\n\nThe\treason\tfor\tthis\tis\tvery\tsimple,\tmajority\tof\tthe\tproblems\tcan\tbe\tcaught within\tunit\ttesting.\tHitting\tthe\tdifferent\tbranches\tof\tour\tcode\twill\tverify\tthe functionality\tof\tpretty\tmuch\tevery\tfunctional\tcase\tin\tour\tapplication,\tso\tit makes\tsense\tto\thave\tplenty\tof\tthem\tin\tour\ttest\tplan.\tBased\ton\tmy experience,\tin\ta\tbalanced\ttest\tplan,\taround\t70%\tof\tour\ttests\tshould\tbe unit\ttests.\tHowever,\tin\ta\tmicroservices-oriented\tarchitecture,\tespecially with\ta\tdynamic\tlanguage\tsuch\tas\tNode.js,\tthis\tfigure\tcan\teasily\tgo\tdown and\tstill\tbe\teffective\twith\tour\ttesting.\tThe\treasoning\tbehind\tit\tis\tthat Node.js\tallows\tyou\tto\twrite\tintegration\ttests\tvery\tquickly\tso\tthat\twe\tcan replace\tsome\tunit\ttests\tby\tintegration\ttests.\n\nTip\n\nTesting\tis\ta\tvery\twell-documented,\tcomplex\tprocess.\tTrying\tto",
      "content_length": 967,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 211,
      "content": "outsmart\tthe\texisting\tmethodologies\tcould\tresult\tin\ta\thard-to-maintain and\tdifficult-to-trust\ttest\tsuite.\n\nIntegration\ttests\tare\tresponsible\tfor\tcatching\tintegration\tproblems,\tas shown\tin\tthe\tfollowing:\n\nCan\tour\tcode\tcall\tthe\tSMS\tgateway? Would\tthe\tconnection\tto\tthe\tdatabase\tbe\tOK? Are\tthe\tHTTP\theaders\tbeing\tsent\tfrom\tour\tservice?\n\nAgain,\taround\t20%\tof\tour\ttests,\tbased\ton\tmy\texperience,\tshould\tbe integration\ttests;\tfocus\ton\tthe\tpositive\tflows\tand\tsome\tof\tthe\tnegative that\tdepend\ton\tthird-party\tmodules.\n\nWhen\tit\tcomes\tdown\tto\tE2E\ttests,\tthey\tshould\tbe\tvery\tlimited\tand\tonly test\tthe\tmain\tflows\tof\tthe\tapplications\twithout\tgoing\tinto\ttoo\tmuch\tdetail. These\tdetails\tshould\tbe\talready\tcaptured\tby\tthe\tunit\tand\tintegration\ttests that\tare\teasy\tto\tfix\tin\tan\tevent\tof\tfailure.\tHowever,\tthere\tis\ta\tcatch\there: when\ttesting\tmicroservices\tin\tNode.js,\t90%\tof\tthe\ttime,\tintegration\tand E2E\ttests\tcan\tbe\tthe\tsame\tthing.\tDue\tto\tthe\tdynamic\tnature\tof\tNode.js, we\tcan\ttest\tthe\trest\tAPI\tfrom\tthe\tintegration\tpoint\tof\tview\t(the\tfull\tserver running),\tbut\tin\treality,\twe\twill\talso\tbe\ttesting\thow\tour\tcode\tbehaves when\tintegrated\twith\tother\tmodules.\tWe\twill\tsee\tan\texample\tlater\tin\tthis chapter.\n\nTesting\tmicroservices\tin\tNode.js\n\nNode.js\tis\tan\timpressive\tlanguage.\tThe\tamount\tof\tlibraries\taround\tany single\taspect\tof\tthe\tdevelopment\tis\tamazing.\tNo\tmatter\thow\tbizarre\tthe task\tthat\tyou\twant\tto\tachieve\tin\tNode.js\tis,\tthere\twill\tbe\talways\tan\tnpm module.\n\nRegarding\tthe\ttesting,\tNode.js\thas\ta\tvery\tpowerful\tset\tof\tlibraries,\tbut two\tof\tthem\tare\tespecially\tpopular:\tMocha\tand\tChai.\n\nThey\tare\tpretty\tmuch\tthe\tindustry\tstandard\tfor\tapp\ttesting\tand\tare\tvery well\tmaintained\tand\tupgraded.",
      "content_length": 1665,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 212,
      "content": "Another\tinteresting\tlibrary\tis\tcalled\tSinon.JS,\tand\tit\tis\tused\tfor\tmocking, spying\tand\tstubbing\tmethods.\tWe\twill\tcome\tback\tto\tthese\tconcepts\tin the\tfollowing\tsections,\tbut\tthis\tlibrary\tis\tbasically\tused\tto\tsimulate integrations\twith\tthird\tparties\twithout\tinteracting\twith\tthem.\n\nChai\n\nThis\tlibrary\tis\ta\tBDD/TDD\tassertions\tlibrary\tthat\tcan\tbe\tused\tin conjunction\twith\tany\tother\tlibrary\tto\tcreate\thigh\tquality\ttests.\n\nAn\tassertion\tis\ta\tcode\tstatement\tthat\twill\teither\tbe\tfulfilled\tor\tthrow\tan error,\tstopping\tthe\ttest\tand\tmarking\tit\tas\ta\tfailure:\n\n5\tshould\tbe\tequal\tto\tA\n\nThe\tpreceding\tstatement\twill\tbe\tcorrect\twhen\tthe\tvariable\tA\tcontains\tthe value\t5.\tThis\tis\ta\tvery\tpowerful\ttool\tto\twrite\teasy-to-understand\ttests, and\tespecially\twith\tChai,\twe\thave\taccess\tto\tassertions\tmaking\tuse\tof\tthe following\tthree\tdifferent\tinterfaces:\n\nshould expect assert\n\nAt\tthe\tend\tof\tthe\tday,\tevery\tsingle\tcondition\tcan\tbe\tchecked\tusing\ta single\tinterface,\tbut\tthe\tfact\tthat\tthe\tlibrary\tprovides\tus\twith\tsuch\ta\trich interface\tfacilitates\tthe\tverbosity\tof\tthe\ttests\tin\torder\tto\twrite\tclean,\teasy, and\tmaintainable\ttests.\n\nLet's\tinstall\tthe\tlibrary:\n\nnpm\tinstall\tchai\n\nThis\twill\tproduce\tthe\tfollowing\toutput:",
      "content_length": 1186,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 213,
      "content": "This\tmeans\tthat\tChai\tdepends\ton\tassertion-error,\ttype-detect,\tand deep-eql.\tAs\tyou\tcan\tsee,\tthis\tis\ta\tgood\tindication\tthat\twe\twill\tbe\table\tto check,\twith\tsimple\tinstructions,\tcomplex\tstatements\tsuch\tas\tdeep equality\tin\tobjects\tor\ttype\tmatching.\n\nTesting\tlibraries\tsuch\tas\tChai\tare\tnot\ta\tdirect\tdependency\tof\tour application,\tbut\ta\tdevelopment\tdependency.\tWe\tneed\tthem\tto\tdevelop applications,\tbut\tthey\tshould\tnot\tbe\tshipped\tto\tproduction.\tThis\tis\ta\tgood reason\tto\trestructure\tour\tpackage.json\tand\tadd\tChai\tin\tthe devDependencies\tdependency\ttag,\tas\tfollows:\n\n{ \t\t\"name\":\t\"chai-test\", \t\t\"version\":\t\"1.0.0\", \t\t\"description\":\t\"A\ttest\tscript\", \t\t\"main\":\t\"chai.js\", \t\t\"dependencies\":\t{ \t\t}, \t\t\"devDependencies\":\t{ \t\t\t\t\"chai\":\t\"*\" \t\t}, \t\t\"author\":\t\"David\tGonzalez\", \t\t\"license\":\t\"ISC\" }\n\nThis\twill\tprevent\tour\tsoftware\tto\tship\tinto\tproduction\tlibraries\tsuch\tas Chai,\twhich\thas\tnothing\tto\tdo\twith\tthe\toperation\tof\tour\tapplication.\n\nOnce\twe\thave\tinstalled\tChai,\twe\tcan\tstart\tplaying\taround\twith\tthe interfaces.\n\nBDD-style\tinterfaces\n\nChai\tcomes\twith\ttwo\tflavors\tof\tBDD\tinterfaces.\tIt\tis\ta\tmatter\tof preference\twhich\tone\tto\tuse,\tbut\tmy\tpersonal\trecommendation\tis\tto\tuse the\tone\tthat\tmakes\tyou\tfeel\tmore\tcomfortable\tin\tany\tsituation.\n\nLet's\tstart\twith\tthe\tshould\tInterface.\tThis\tone\tis\ta\tBDD-style\tinterface, using\tsomething\tsimilar\tto\tthe\tnatural\tlanguage,\twe\tcan\tcreate assertions\tthat\twill\tdecide\twhether\tour\ttest\tsucceeds\tor\tfails:\n\nmyVar.should.be.a('string')",
      "content_length": 1453,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 214,
      "content": "In\torder\tto\tbe\table\tto\tbuild\tsentences\tlike\tthe\tone\tbefore,\twe\tneed\tto import\tthe\tshould\tmodule\tin\tour\tprogram:\n\nvar\tchai\t=\trequire('chai');\n\nchai.should();\n\nvar\tfoo\t=\t\"Hello\tworld\"; console.log(foo);\n\nfoo.should.equal('Hello\tworld');\n\nAlthough\tit\tlooks\tlike\ta\tbit\tof\tdark\tmagic,\tit\tis\treally\tconvenient\twhen testing\tour\tcode\tas\twe\tuse\tsomething\tsimilar\tto\tthe\tnatural\tlanguage\tto ensure\tthat\tour\tcode\tis\tmeeting\tsome\tcriteria:\tfoo\tshould\tbe\tequal\tto 'Hello\tworld'\thas\ta\tdirect\ttranslation\tto\tour\ttest.\n\nThe\tsecond\tBDD-style\tinterface\tprovided\tby\tChai\tis\texpect.\tAlthough\tit\tis very\tsimilar\tto\tshould,\tit\tchanges\ta\tbit\tof\tsyntax\tin\torder\tto\tset expectations\tthat\tthe\tresults\thave\tto\tmeet.\n\nLet's\tsee\tthe\tfollowing\texample:\n\nvar\texpect\t=\trequire('chai').expect;\n\nvar\tfoo\t=\t\"Hello\tworld\";\n\nexpect(foo).to.equal(\"Hello\tworld\");\n\nAs\tyou\tcan\tsee,\tthe\tstyle\tis\tvery\tsimilar:\ta\tfluent\tinterface\tthat\tallows\tus to\tcheck\twhether\tthe\tconditions\tfor\tthe\ttest\tto\tsucceed\tare\tmet,\tbut\twhat happens\tif\tthe\tconditions\tare\tnot\tmet?\n\nLet's\texecute\ta\tsimple\tNode.js\tprogram\tthat\tfails\tin\tone\tof\tthe\tconditions:\n\nvar\texpect\t=\trequire('chai').expect; var\tanimals\t=\t['cat',\t'dog',\t'parrot']; expect(animals).to.have.length(4);\n\nNow,\tlet's\texecute\tthe\tprevious\tscript,\tassuming\tthat\tyou\thave\talready",
      "content_length": 1277,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 215,
      "content": "installed\tChai:\n\ncode/node_modules/chai/lib/chai/assertion.js:107 \t\t\t\t\t\tthrow\tnew\tAssertionError(msg,\t{ \t\t\t\t\t\t\t\t\t\t\t\t^ AssertionError:\texpected\t[\t'cat',\t'dog',\t'parrot'\t]\tto\t have\ta\tlength\tof\t4\tbut\tgot\t3 \t\t\t\tat\tObject.<anonymous>\t (/Users/dgonzalez/Dropbox/Microservices\twith\t Node/Writing\tBundle/Chapter\t6/code/chai.js:24:25) \t\t\t\tat\tModule._compile\t(module.js:460:26) \t\t\t\tat\tObject.Module._extensions..js\t (module.js:478:10) \t\t\t\tat\tModule.load\t(module.js:355:32) \t\t\t\tat\tFunction.Module._load\t(module.js:310:12) \t\t\t\tat\tFunction.Module.runMain\t(module.js:501:10) \t\t\t\tat\tstartup\t(node.js:129:16) \t\t\t\tat\tnode.js:814:3\n\nAn\texception\tis\tthrown\tand\tthe\ttest\tfails.\tIf\tall\tthe\tconditions\twere validated,\tno\texception\twould\thave\tbeen\traised\tand\tthe\ttest\twould\thave succeeded.\n\nAs\tyou\tcan\tsee,\tthere\tare\ta\tnumber\tof\tnatural\tlanguage\twords\tthat\twe can\tuse\tfor\tour\ttests\tusing\tboth\texpect\tand\tshould\tinterfaces.\tThe\tfull\tlist can\tbe\tfound\tin\tthe\tChai\tdocumentation\t(http://chaijs.com/api/bdd/#- include-value-),\tbut\tlet's\texplain\tsome\tof\tthe\tmost\tinteresting\tones\tin\tthe following\tlist:\n\nnot:\tThis\tword\tis\tused\tto\tnegate\tthe\tassertions\tfollowing\tin\tthe chain.\tFor\texample,\texpect(\"some\tstring\").to.not.equal(\"Other String\")\twill\tpass. deep:\tThis\tword\tis\tone\tof\tthe\tmost\tinteresting\tof\tall\tthe\tcollection.\tIt\tis used\tto\tdeep-compare\tobjects,\twhich\tis\tthe\tquickest\tway\tto\tcarry\ton a\tfull\tequal\tcomparison.\tFor\texample, expect(foo).to.deep.equal({name:\t\"David\"})\twill\tsucceed\tif\tfoo\tis\ta JavaScript\tobject\twith\tone\tproperty\tcalled\tname\twith\tthe\t\"David\" string\tvalue. any/all:\tThis\tis\tused\tto\tcheck\twhether\tthe\tdictionary\tor\tobject contains\tany\tof\tthe\tkeys\tin\tthe\tgiven\tlist\tso\tthat expect(foo).to.have.any.keys(\"name\",\t\"surname\")\twill\tsucceed\tif foo\tcontains\tany\tof\tthe\tgiven\tkeys,\tand",
      "content_length": 1770,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 216,
      "content": "expect(foo).to.have.all.keys(\"name\",\t\"surname\")\twill\tonly\tsucceed if\tit\thas\tall\tof\tthe\tkeys. ok:\tThis\tis\tan\tinteresting\tone.\tAs\tyou\tprobably\tknow,\tJavaScript\thas a\tfew\tpitfalls,\tand\tone\tof\tthem\tis\tthe\ttrue/false\tevaluation\tof expressions.\tWith\tok,\twe\tcan\tabstract\tall\tthe\tmess\tand\tdo\tsomething similar\tto\tthe\tfollowing\tlist\tof\texpressions:\n\nexpect('everything').to.be.ok:\t'everything'\tis\ta\tstring\tand\tit will\tbe\tevaluated\tto\tok expect(undefined).to.not.be.ok:\tUndefined\tis\tnot\tok\tin\tthe JavaScript\tworld,\tso\tthis\tassertion\twill\tsucceed\n\nabove:\tThis\tis\ta\tvery\tuseful\tword\tto\tcheck\twhether\tan\tarray\tor collection\tcontains\ta\tnumber\tof\telements\tabove\ta\tcertain\tthreshold, as\tfollows:\texpect([1,2,3]).to.have.length.above(2)\n\nAs\tyou\tcan\tsee,\tthe\tChai\tAPI\tfor\tfluent\tassertions\tis\tquite\trich\tand enables\tus\tto\twrite\tvery\tdescriptive\ttests\tthat\tare\teasy\tto\tmaintain.\n\nNow,\tyou\tmay\tbe\tasking\tyourself,\twhy\thave\ttwo\tflavors\tof\tthe\tsame interface\tthat\tpretty\tmuch\twork\tthe\tsame?\tWell,\tthey\tfunctionally\tdo\tthe same,\thowever,\ttake\ta\tlook\tat\tthe\tdetail:\n\nexpect\tprovides\ta\tstarting\tpoint\tin\tyour\tchainable\tlanguage should\textends\tthe\tObject.prototype\tsignature\tto\tadd\tthe\tchainable language\tto\tevery\tsingle\tobject\tin\tJavaScript\n\nFrom\tNode.js'\tpoint\tof\tview,\tboth\tof\tthem\tare\tfine,\talthough\tthe\tfact\tthat should\tis\tinstrumenting\tthe\tprototype\tof\tObject\tcould\tbe\ta\treason\tto\tbe\ta bit\tparanoid\tabout\tusing\tit\tas\tit\tis\tintrusive.\n\nAssertions\tinterface\n\nThe\tassertions\tinterface\tmatches\tthe\tmost\tcommon\told-fashioned\ttests assertion\tlibrary.\tIn\tthis\tflavor,\twe\tneed\tto\tbe\tspecific\tabout\twhat\twe\twant to\ttest,\tand\tthere\tis\tno\tsuch\tthing\tas\tfluent\tchaining\tof\texpressions:\n\nvar\tassert\t=\trequire('chai').assert; var\tmyStringVar\t=\t'Here\tis\tmy\tstring'; //\tNo\tmessage:",
      "content_length": 1745,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 217,
      "content": "assert.typeOf(myStringVar,\t'string'); //\tWith\tmessage: assert.typeOf(myStringVar,\t'string',\t'myStringVar\tis\t not\tstring\ttype.'); //\tAsserting\ton\tlength: assert.lengthOf(myStringVar,\t17);\n\nThere\tis\treally\tnothing\tmore\tto\tgo\tin\tdepth\tif\tyou\thave\talready\tused\tany of\tthe\texisting\ttest\tlibraries\tin\tany\tlanguage.\n\nMocha\n\nMocha\tis,\tin\tmy\topinion,\tone\tof\tthe\tmost\tconvenient\ttesting\tframeworks that\tI\thave\tever\tused\tin\tmy\tprofessional\tlife.\tIt\tfollows\tthe\tprinciples\tof behavior-driven\tdevelopment\ttesting\t(BDDT),\twhere\tthe\ttest describes\ta\tuse\tcase\tof\tthe\tapplication\tand\tuses\tthe\tassertions\tfrom another\tlibrary\tto\tverify\tthe\toutcome\tof\tthe\texecuted\tcode.\n\nAlthough\tit\tsounds\ta\tbit\tcomplicated,\tit\tis\treally\tconvenient\tto\tensure\tthat our\tcode\tis\tcovered\tfrom\tthe\tfunctional\tand\ttechnical\tpoint\tof\tview,\tas\twe will\tbe\tmirroring\tthe\trequirements\tused\tto\tbuild\tthe\tapplication\tinto automated\ttests\tthat\tverifies\tthem.\n\nLet's\tstart\twith\ta\tsimple\texample.\tMocha\tis\ta\tbit\tdifferent\tfrom\tany\tother library,\tas\tit\tdefines\tits\town\tdomain-specific\tlanguage\t(DSL)\tthat\tneeds to\tbe\texecuted\twith\tMocha\tinstead\tof\tNode.js.\tIt\tis\tan\textension\tof\tthe language.\n\nFirst\twe\tneed\tto\tinstall\tMocha\tin\tthe\tsystem:\n\nnpm\tinstall\tmocha\t-g\n\nThis\twill\tproduce\tan\toutput\tsimilar\tto\tthe\tfollowing\timage:",
      "content_length": 1271,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 218,
      "content": "From\tnow\ton,\twe\thave\ta\tnew\tcommand\tin\tour\tsystem:\tmocha.\n\nThe\tnext\tstep\tis\tto\twrite\ta\ttest\tusing\tMocha:\n\nfunction\trollDice()\t{ \t\treturn\tMath.floor(Math.random()\t*\t6)\t+\t1; }\n\nrequire('chai').should(); var\texpect\t=\trequire('chai').expect;\n\ndescribe('When\ta\tcustomer\trolls\ta\tdice',\tfunction(){\n\nit('should\treturn\tan\tinteger\tnumber',\tfunction()\t{ \t\t\t\texpect(rollDice()).to.be.an('number'); \t\t});\n\nit('should\tget\ta\tnumber\tbelow\t7',\tfunction(){ \t\t\t\trollDice().should.be.below(7); \t\t});\n\nit('should\tget\ta\tnumber\tbigger\tthan\t0',\tfunction(){ \t\t\t\trollDice().should.be.above(0); \t\t});\n\nit('should\tnot\tbe\tnull',\tfunction()\t{ \t\t\t\texpect(rollDice()).to.not.be.null; \t\t});\n\nit('should\tnot\tbe\tundefined',\tfunction()\t{ \t\t\t\texpect(rollDice()).to.not.be.undefined; \t\t}); });\n\nThe\tpreceding\texample\tis\tsimple.\tA\tfunction\tthat\trolls\ta\tdice\tand\treturns",
      "content_length": 830,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 219,
      "content": "an\tinteger\tnumber\tfrom\t1\tto\t6.\tNow\twe\tneed\tto\tthink\ta\tbit\tabout\tthe\tuse cases\tand\tthe\trequirements:\n\nThe\tnumber\thas\tto\tbe\tan\tinteger This\tinteger\thas\tto\tbe\tbelow\t7 It\thas\tto\tbe\tabove\t0,\tdice\tdon't\thave\tnegative\tnumbers The\tfunction\tcannot\treturn\tnull The\tfunction\tcannot\treturn\tundefined\n\nThis\tcovers\tpretty\tmuch\tevery\tcorner\tcase\tabout\trolling\ta\tdice\tin\tNode.js. What\twe\tare\tdoing\tis\tdescribing\tsituations\tthat\twe\tcertainly\twant\tto\ttest, in\torder\tto\tsafely\tmake\tchanges\tto\tthe\tsoftware\twithout\tbreaking\tthe existing\tfunctionality.\n\nThese\tfive\tuse\tcases\tare\tan\texact\tmap\tto\tthe\ttests\twritten\tearlier:\n\nWe\tdescribe\tthe\tsituation:\tWhen\ta\tcustomer\trolls\ta\tdice Conditions\tget\tverified:\tIt\tshould\treturn\tan\tinteger\tnumber\n\nLet's\trun\tthe\tprevious\ttest\tand\tcheck\tthe\tresults:\n\nmocha\ttests.js\n\nThis\tshould\treturn\tsomething\tsimilar\tto\tthe\tfollowing\tscreenshot:\n\nAs\tyou\tcan\tsee,\tMocha\treturns\ta\tcomprehensive\treport\ton\twhat\tis\tgoing on\tin\tthe\ttests.\tIn\tthis\tcase,\tall\tof\tthem\tpass,\tso\twe\tdon't\tneed\tto\tbe worried\tabout\tproblems.\n\nLet's\tforce\tsome\tof\tthe\ttests\tto\tfail:",
      "content_length": 1059,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 220,
      "content": "function\trollDice()\t{ \t\treturn\t-1\t\tMath.floor(Math.random()\t\t6)\t+\t1; }\n\nrequire('chai').should(); var\texpect\t=\trequire('chai').expect;\n\ndescribe('When\ta\tcustomer\trolls\ta\tdice',\tfunction(){\n\nit('should\treturn\tan\tinteger\tnumber',\tfunction()\t{ \t\t\t\texpect(rollDice()).to.be.an('number'); \t\t});\n\nit('should\tget\ta\tnumber\tbelow\t7',\tfunction(){ \t\t\t\trollDice().should.be.below(7); \t\t});\n\nit('should\tget\ta\tnumber\tbigger\tthan\t0',\tfunction(){ \t\t\t\trollDice().should.be.above(0); \t\t});\n\nit('should\tnot\tbe\tnull',\tfunction()\t{ \t\t\t\texpect(rollDice()).to.not.be.null; \t\t});\n\nit('should\tnot\tbe\tundefined',\tfunction()\t{ \t\t\t\texpect(rollDice()).to.not.be.undefined; \t\t}); });\n\nAccidentally,\tsomeone\thas\tbumped\ta\tcode\tfragment\tinto\tthe\trollDice() function,\twhich\tmakes\tthe\tfunction\treturn\ta\tnumber\tthat\tdoes\tnot\tmeet some\tof\tthe\trequirements.\tLet's\trun\tMocha\tagain,\tas\tshown\tin\tthe following\timage:",
      "content_length": 875,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 221,
      "content": "Now,\twe\tcan\tsee\tthe\treport\treturning\tone\terror:\tthe\tmethod\tis\treturning -4,\twhere\tit\tshould\talways\treturn\ta\tnumber\tbigger\tthan\t0.\n\nAlso,\tone\tof\tthe\tbenefits\tof\tthis\ttype\tof\ttesting\tin\tNode.js\tusing\tMocha and\tChai\tis\tthe\ttime.\tTests\trun\tvery\tfast\tso\tthat\tit\tis\teasy\tto\treceive feedback\tif\twe\thave\tbroken\tsomething.\tThe\tpreceding\tsuite\tran\tin\t10ms.\n\nSinon.JS\t–\ta\tmocking\tframework\n\nThe\tprevious\ttwo\tchapters\thave\tbeen\tfocused\ton\tasserting\tconditions\ton return\tvalues\tof\tfunctions,\tbut\twhat\thappens\twhen\tour\tfunction\tdoes\tnot return\tany\tvalue?\tThe\tonly\tcorrect\tmeasurement\tis\tto\tcheck\twhether\tthe method\twas\tcalled\tor\tnot.\tAlso,\twhat\tif\tone\tof\tour\tmodules\tis\tcalling\ta third-party\tweb\tservice,\tbut\twe\tdon't\twant\tour\ttests\tto\tcall\tthe\tremote server?\n\nFor\tanswering\tthese\tquestions,\twe\thave\ttwo\tconceptual\ttools\tcalled mocks\tand\tspies,\tand\tNode.js\thas\tthe\tperfect\tlibrary\tto\timplement\tthem: Sinon.JS.\n\nFirst\tinstall\tit,\tas\tfollows:\n\nnpm\tinstall\tsinon\n\nThe\tpreceding\tcommand\tshould\tproduce\tthe\tfollowing\toutput:",
      "content_length": 1005,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 222,
      "content": "Now\tlet's\texplain\thow\tit\tworks\tthrough\tan\texample:\n\nfunction\tcalculateHypotenuse(x,\ty,\tcallback)\t{ \t\tcallback(null,\tMath.sqrt(x*x\t+\ty*x)); }\n\ncalculateHypotenuse(3,\t3,\tfunction(err,\tresult){ \t\tconsole.log(result); });\n\nThis\tsimple\tscript\tcalculates\tthe\thypotenuse\tof\ta\ttriangle,\tgiven\tthe length\tof\tthe\tother\ttwo\tsides\tof\tthe\ttriangle.\tOne\tof\tthe\ttests\tthat\twe\twant to\tcarry\ton\tis\tthe\tfact\tthat\tthe\tcallback\tis\texecuted\twith\tthe\tright\tlist\tof arguments\tsupplied.\tWhat\twe\tneed\tto\taccomplish\tsuch\ttask\tis\twhat Sinon.JS\tcalls\ta\tspy:\n\nvar\tsinon\t=\trequire('sinon');\n\nrequire('chai').should();\n\nfunction\tcalculateHypotenuse(x,\ty,\tcallback)\t{ \t\tcallback(null,\tMath.sqrt(x*x\t+\ty*x)); }\n\ndescribe(\"When\tthe\tuser\tcalculates\tthe\thypotenuse\",\t function(){ \t\tit(\"should\texecute\tthe\tcallback\tpassed\tas\targument\",\t function()\t{ \t\t\t\tvar\tcallback\t=\tsinon.spy(); \t\t\t\tcalculateHypotenuse(3,\t3,\tcallback); \t\t\t\tcallback.called.should.be.true; \t\t}); });\n\nOnce\tagain,\twe\tare\tusing\tMocha\tto\trun\tthe\tscript\tand\tChai\tto\tverify\tthe results\tin\tthe\ttest\tthrough\tthe\tshould\tinterface,\tas\tshown\tin\tthe\tfollowing image:",
      "content_length": 1087,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 223,
      "content": "The\timportant\tline\tin\tthe\tpreceding\tscript\tis:\n\nvar\tcallback\t=\tsinon.spy();\n\nHere,\twe\tare\tcreating\tthe\tspy\tand\tinjecting\tit\tinto\tthe\tfunction\tas\ta callback.\tThis\tfunction\tcreated\tby\tSinon.JS\tis\tactually\tnot\tonly\ta\tfunction, but\ta\tfull\tobject\twith\ta\tfew\tinteresting\tpoints\tof\tinformation.\tSinon.JS does\tthat,\ttaking\tadvantage\tof\tthe\tdynamic\tnature\tof\tJavaScript.\tYou\tcan actually\tsee\twhat\tis\tin\tthis\tobject\tby\tdumping\tit\tinto\tthe\tconsole\twith console.log().\n\nAnother\tvery\tpowerful\ttool\tin\tSinon.JS\tare\tthe\tstubs.\tStubs\tare\tvery similar\tto\tmocks\t(identical\tat\tpractical\teffects\tin\tJavaScript)\tand\tallow\tus to\tfake\tfunctions\tto\tsimulate\tthe\trequired\treturn:\n\nvar\tsinon\t=\trequire('sinon'); var\texpect\t=\trequire('chai').expect;\n\nfunction\trollDice()\t{ \t\treturn\t-1\t\tMath.floor(Math.random()\t\t6)\t+\t1; } describe(\"When\trollDice\tgets\tcalled\",\tfunction()\t{ \t\tit(\"Math#random\tshould\tbe\tcalled\twith\tno\targuments\",\t function()\t{ \t\t\t\tsinon.stub(Math,\t\"random\"); \t\t\t\trollDice(); \t\t\t\tconsole.log(Math.random.calledWith()); \t\t}); })\n\nIn\tthis\tcase,\twe\thave\tstubbed\tthe\tMath#random\tmethod,\twhich\tcauses\tthe method\tto\tbe\tsome\tsort\tof\toverloaded\tempty\tfunction\t(it\tdoes\tnot\tissue the\tget\tcall)\tthat\trecords\tstats\ton\twhat\tor\thow\tit\twas\tcalled.",
      "content_length": 1220,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 224,
      "content": "There\tis\tone\tcatch\tin\tthe\tpreceding\tcode:\twe\tnever\trestored\tthe\trandom() method\tback\tand\tthis\tis\tquite\tdangerous.\tIt\thas\ta\tmassive\tside\teffect,\tas other\ttests\twill\tsee\tthe\tMath#random\tmethod\tas\ta\tstub,\tnot\tas\tthe\toriginal one,\tand\tit\tcan\tlead\tto\tus\tcoding\tour\ttests\taccording\tto\tinvalid information.\n\nIn\torder\tto\tprevent\tthis,\twe\tneed\tto\tmake\tuse\tof\tthe\tbefore()\tand after()\tmethods\tfrom\tMocha:\n\nvar\tsinon\t=\trequire('sinon'); var\texpect\t=\trequire('chai').expect;\n\nvar\tsinon\t=\trequire('sinon'); var\texpect\t=\trequire('chai').expect;\n\nfunction\trollDice()\t{ \t\treturn\t-1\t\tMath.floor(Math.random()\t\t6)\t+\t1; } describe(\"When\trollDice\tgets\tcalled\",\tfunction()\t{\n\nit(\"Math#random\tshould\tbe\tcalled\twith\tno\targuments\",\t function()\t{ \t\t\t\tsinon.stub(Math,\t\"random\"); \t\t\t\trollDice(); \t\t\t\tconsole.log(Math.random.calledWith()); \t\t}); after(function(){ \t\t\t\tMath.random.restore(); \t\t}); });\n\nIf\tyou\tpay\tattention\tto\tthe\thighlighted\tcode,\twe\tare\ttelling\tSinon.JS\tto restore\tthe\toriginal\tmethod\tthat\twas\tstubbed\tinside\tone\tof\tthe\tit\tblocks, so\tthat\tif\tanother\tdescribe\tblock\tmakes\tuse\tof\thttp.get,\twe\twon't\tsee\tthe stub,\tbut\tthe\toriginal\tmethod.\n\nTip\n\nThe\tbefore()\tand\tafter()\tmethods\tare\tvery\thelpful\tto\tset\tup\tand wind\tdown\tthe\tcontext\tfor\tthe\ttests.\tHowever,\tyou\tneed\tto\tbe\tcareful with\tthe\tscope\twhere\tthey\tare\texecuted\tas\tit\tcould\tlead\tto\ttest interactions.",
      "content_length": 1343,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 225,
      "content": "Mocha\thas\ta\tfew\tflavors\tof\tbefore\tand\tafter:\n\nbefore(callback):\tThis\tis\texecuted\tbefore\tthe\tcurrent\tscope\t(at\tthe beginning\tof\tthe\tdescribe\tblock\tin\tthe\tpreceding\tcode) after(callback):\tThis\tis\texecuted\tafter\tthe\tcurrent\tscope\t(at\tthe\tend of\tthe\tdescribe\tblock\tin\tthe\tpreceding\tcode) beforeEach(callback):\tThis\tis\texecuted\tat\tthe\tbeginning\tof\tevery element\tin\tthe\tcurrent\tscope\t(before\teach\tit\tin\tthe\tpreceding example) afterEach(callback):\tThis\tis\texecuted\tat\tthe\tend\tof\tevery\telement\tin the\tcurrent\tscope\t(after\tevery\tit\tin\tthe\tpreceding\texample)\n\nAnother\tinteresting\tfeature\tin\tSinon.JS\tis\tthe\ttime\tmanipulation.\tSome\tof the\ttests\tneed\tto\texecute\tperiodic\ttasks\tor\trespond\tafter\ta\tcertain\ttime\tof an\tevent's\toccurrence.\tWith\tSinon.JS,\twe\tcan\tdictate\ttime\tas\tone\tof\tthe parameters\tof\tour\ttests:\n\nvar\tsinon\t=\trequire('sinon'); var\texpect\t=\trequire('chai').expect\n\nfunction\tareWeThereYet(callback)\t{\n\nsetTimeout(function()\t{ \t\t\t\tcallback.apply(this); \t\t},\t10);\n\n}\n\nvar\tclock;\n\nbefore(function(){ \t\tclock\t=\tsinon.useFakeTimers(); });\n\nit(\"callback\tgets\tcalled\tafter\t10ms\",\tfunction\t()\t{ \t\tvar\tcallback\t=\tsinon.spy(); \t\tvar\tthrottled\t=\tareWeThereYet(callback);\n\nareWeThereYet(callback);\n\nclock.tick(9); \t\texpect(callback.notCalled).to.be.true;",
      "content_length": 1241,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 226,
      "content": "clock.tick(1); \t\texpect(callback.notCalled).to.be.false; });\n\nafter(function(){ \t\tclock.restore(); });\n\nAs\tyou\tcan\tsee,\twe\tcan\tnow\tcontrol\tthe\ttime\tin\tour\ttests.\n\nTesting\ta\treal\tmicroservice\n\nNow,\tit\tis\ttime\tto\ttest\ta\treal\tmicroservice\tin\torder\tto\tget\ta\tgeneral\tpicture of\tthe\tfull\ttest\tsuite.\n\nOur\tmicroservice\tis\tgoing\tto\tuse\tExpress,\tand\tit\twill\tfilter\tan\tinput\ttext\tto remove\twhat\tthe\tsearch\tengines\tcall\tstop\twords:\twords\twith\tless\tthan three\tcharacters\tand\twords\tthat\tare\tbanned.\n\nLet's\tsee\tthe\tcode:\n\nvar\t\t=\trequire('lodash'); var\texpress\t=\trequire('express');\n\nvar\tbannedWords\t=\t[\"kitten\",\t\"puppy\",\t\"parrot\"];\n\nfunction\tremoveStopWords\t(text,\tcallback)\t{ \t\tvar\twords\t=\ttext.split('\t'); \t\tvar\tvalidWords\t=\t[]; \t\t(words).forEach(function(word,\tindex)\t{ \t\t\t\tvar\taddWord\t=\ttrue;\n\nif\t(word.length\t<\t3)\t{ \t\t\t\t\t\taddWord\t=\tfalse; \t\t\t\t}\n\nif(addWord\t&&\tbannedWords.indexOf(word)\t>\t-1)\t{ \t\t\t\t\t\taddWord\t=\tfalse; \t\t\t\t}\n\nif\t(addWord)\t{ \t\t\t\t\t\tvalidWords.push(word);\t \t\t\t\t}\n\n//\tLast\titeration:",
      "content_length": 985,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 227,
      "content": "if\t(index\t==\t(words.length\t-\t1))\t{ \t\t\t\t\t\tcallback(null,\tvalidWords.join(\"\t\")); \t\t\t\t} \t\t}); } var\tapp\t=\texpress();\n\napp.get('/filter',\tfunction(req,\tres)\t{ \t\tremoveStopWords(req.query.text,\tfunction(err,\t response){ \t\t\t\tres.send(response); \t\t}); });\n\napp.listen(3000,\tfunction()\t{ \t\tconsole.log(\"app\tstarted\tin\tport\t3000\"); });\n\nAs\tyou\tcan\tsee,\tthe\tservice\tis\tpretty\tsmall,\tso\tit\tis\tthe\tperfect\texample\tfor explaining\thow\tto\twrite\tunit,\tintegration,\tand\tE2E\ttests.\tIn\tthis\tcase,\tas we\tstated\tbefore,\tE2E\tand\tintegration\ttests\tare\tgoing\tto\tbe\tthe\texact same\tas\ttesting\tthe\tservice\tthrough\tthe\tREST\tAPI\twill\tbe\tequivalent\tto testing\tthe\tsystem\tfrom\tthe\tend-to-end\tpoint\tof\tview,\tbut\talso\thow\tour component\tis\tintegrated\twithin\tthe\tsystem.\tGiven\tthat,\tif\twe\twere\tto\tadd a\tUI,\twe\twould\thave\tto\tsplit\tintegration\ttests\tfrom\tE2E\tin\torder\tto\tensure the\tquality.\n\nTDD\t–\tTest-driven\tdevelopment\n\nOur\tservice\tis\tdone\tand\tworking.\tHowever,\tnow\twe\twant\tto\tunit\ttest\tit, but\twe\tfind\tsome\tproblems:\n\nThe\tfunction\tthat\twe\twant\tto\tunit\ttest\tis\tnot\tvisible\toutside\tthe\tmain .js\tfile The\tserver\tcode\tis\ttightly\tcoupled\tto\tthe\tfunctional\tcode\tand\thas\tbad cohesion\n\nHere\tTDD\tcomes\tto\tthe\trescue;\twe\tshould\talways\task\tourselves\t\"how am\tI\tgoing\tto\ttest\tthis\tfunction\twhen\twriting\tsoftware?\"\tIt\tdoes\tnot\tmean that\twe\tshould\tmodify\tour\tsoftware\twith\tthe\tspecific\tpurpose\tof\ttesting, but\tif\tyou\tare\thaving\tproblems\twhile\ttesting\ta\tpart\tof\tyour\tprogram,\tmore than\tlikely,\tyou\tshould\tlook\tinto\tcohesion\tand\tcoupling,\tas\tit\tis\ta\tgood indication\tof\tproblems.\tLet's\ttake\ta\tlook\tat\tthe\tfollowing\tfile:",
      "content_length": 1569,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 228,
      "content": "var\t\t=\trequire('lodash'); var\texpress\t=\trequire('express');\n\nmodule.exports\t=\tfunction(options)\t{ \t\tbannedWords\t=\t[]; \t\tif\t(typeof\toptions\t!==\t'undefined')\t{ \t\t\t\tconsole.log(options); \t\t\t\tbannedWords\t=\toptions.bannedWords\t||\t[]; \t\t}\n\nreturn\tfunction\tbannedWords(text,\tcallback)\t{ \t\t\t\tvar\twords\t=\ttext.split('\t'); \t\t\t\tvar\tvalidWords\t=\t[]; \t\t\t\t(words).forEach(function(word,\tindex)\t{ \t\t\t\t\t\tvar\taddWord\t=\ttrue;\n\nif\t(word.length\t<\t3)\t{ \t\t\t\t\t\t\t\taddWord\t=\tfalse; \t\t\t\t\t\t}\n\nif(addWord\t&&\tbannedWords.indexOf(word)\t>\t-1)\t{ \t\t\t\t\t\t\t\taddWord\t=\tfalse; \t\t\t\t\t\t}\n\nif\t(addWord)\t{ \t\t\t\t\t\t\t\tvalidWords.push(word);\t \t\t\t\t\t\t}\n\n//\tLast\titeration: \t\t\t\t\t\tif\t(index\t==\t(words.length\t-\t1))\t{ \t\t\t\t\t\t\t\tcallback(null,\tvalidWords.join(\"\t\")); \t\t\t\t\t\t} \t\t\t\t}); \t\t} }\n\nThis\tfile\tis\ta\tmodule\tthat,\tin\tmy\topinion,\tis\thighly\treusable\tand\thas\tgood cohesion:\n\nWe\tcan\timport\tit\teverywhere\t(even\tin\ta\tbrowser) The\tbanned\twords\tcan\tbe\tinjected\twhen\tcreating\tthe\tmodule\t(very useful\tfor\ttesting) It\tis\tnot\ttangled\twith\tthe\tapplication\tcode\n\nLaying\tdown\tthe\tcode\tthis\tway,\tour\tapplication\tmodule\twill\tlook\tsimilar\tto the\tfollowing:",
      "content_length": 1085,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 229,
      "content": "var\t_\t=\trequire('lodash'); var\texpress\t=\trequire('express');\n\nvar\tremoveStopWords\t=\trequire('./remove-stop-words') ({bannedWords:\t[\"kitten\",\t\"puppy\",\t\"parrot\"]});\n\nvar\tapp\t=\texpress();\n\napp.get('filter',\tfunction(req,\tres)\t{ \t\tres.send(removeStopWords(req.query.text)); });\n\napp.listen(3000,\tfunction()\t{ \t\tconsole.log(\"app\tstarted\tin\tport\t3000\"); });\n\nAs\tyou\tcan\tsee,\twe\thave\tclearly\tseparated\tthe\tbusiness\tunit\t(the function\tthat\tcaptures\tthe\tbusiness\tlogic)\tfrom\tthe\toperational\tunit\t(the setup\tof\tthe\tserver).\n\nAs\tI\tmentioned\tbefore,\tI\tam\tnot\ta\tbig\tfan\tof\twriting\tthe\ttests\tprior\tto\tthe code,\tbut\tthey\tshould\tbe\twritten\t(in\tmy\topinion)\talongside\tthe\tcode,\tbut always\thaving\tin\tmind\tthe\tquestion\tmentioned\tbefore.\n\nThere\tseem\tto\tbe\ta\tpush\tin\tcompanies\tto\tadopt\ta\tTDD\tmethodology,\tbut it\tcould\tlead\tto\ta\tsignificant\tinefficiency,\tespecially\tif\tthe\tbusiness requirements\tare\tunclear\t(as\tthey\tare\t90%\tof\tthe\ttime)\tand\twe\tface changes\talong\tthe\tdevelopment\tprocess.\n\nUnit\ttesting\n\nNow\tthat\tour\tcode\tis\tin\ta\tbetter\tshape,\twe\tare\tgoing\tto\tunit\ttest\tour function.\tWe\twill\tuse\tMocha\tand\tChai\tto\taccomplish\tsuch\ttask:\n\nvar\tremoveStopWords\t=\trequire('./remove-stop-words') ({bannedWords:\t[\"kitten\",\t\"parrot\"]});\n\nvar\tchai\t=\trequire('chai'); var\tassert\t=\tchai.assert; chai.should(); var\texpect\t=\tchai.expect;\n\ndescribe('When\texecuting\t\"removeStopWords\"',\t function()\t{",
      "content_length": 1360,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 230,
      "content": "it('should\tremove\twords\twith\tless\tthan\t3\tchars\tof\t length',\tfunction()\t{ \t\t\t\tremoveStopWords('my\tsmall\tlist\tof\twords',\t function(err,\tresponse)\t{ \t\t\t\t\t\texpect(response).to.equal(\"small\tlist\twords\"); \t\t\t\t}); \t\t});\n\nit('should\tremove\textra\twhite\tspaces',\tfunction()\t{ \t\t\t\tremoveStopWords('my\tsmall\t\t\t\t\t\t\tlist\tof\twords',\t function(err,\tresponse)\t{ \t\t\t\t\t\texpect(response).to.equal(\"small\tlist\twords\"); \t\t\t\t}); \t\t});\n\nit('should\tremove\tbanned\twords',\tfunction()\t{ \t\t\t\tremoveStopWords('My\tkitten\tis\tsleeping',\t function(err,\tresponse)\t{ \t\t\t\t\t\texpect(response).to.equal(\"sleeping\"); \t\t\t\t}); \t\t});\n\nit('should\tnot\tfail\twith\tnull\tas\tinput',\tfunction()\t { \t\t\t\tremoveStopWords(null,\tfunction(err,\tresponse)\t{ \t\t\t\t\t\texpect(response).to.equal(\"small\tlist\twords\"); \t\t\t\t}); \t\t});\n\nit('should\tfail\tif\tthe\tinput\tis\tnot\ta\tstring',\t function()\t{ \t\t\t\ttry\t{ \t\t\t\t\t\tremoveStopWords(5,\tfunction(err,\tresponse)\t{}); \t\t\t\t\t\tassert.fail(); \t\t\t\t} \t\t\t\tcatch(err)\t{ \t\t\t\t} \t\t}); });\n\nAs\tyou\tcan\tsee,\twe\thave\tcovered\tpretty\tmuch\tevery\tsingle\tcase\tand branch\tinside\tour\tapplication,\tbut\thow\tis\tour\tcode\tcoverage\tlooking?\n\nUntil\tnow,\twe\thave\tmentioned\tit,\tbut\tnever\tactually\tmeasured\tit.\tWe\tare going\tto\tuse\tone\ttool,\tcalled\tIstanbul,\tto\tmeasure\tthe\ttest\tcoverage:",
      "content_length": 1229,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 231,
      "content": "npm\tinstall\t-g\tistanbul\n\nThis\tshould\tinstall\tIstanbul.\tNow\twe\tneed\tto\trun\tthe\tcoverage\treport:\n\nistanbul\tcover\t_mocha\tmy-tests.js\n\nThis\twill\tproduce\tan\toutput\tsimilar\tto\tthe\tone\tshown\tin\tthe\tfollowing image:\n\nThis\twill\talso\tgenerate\ta\tcoverage\treport\tin\tHTML,\tpointing\tout\twhich lines,\tfunctions,\tbranches,\tand\tstatements\tare\tnot\tbeing\tcovered,\tas shown\tin\tthe\tfollowing\tscreenshot:\n\nAs\tyou\tcan\tsee,\twe\tare\tlooking\tpretty\twell.\tOur\tcode\t(not\tthe\ttests)\tis actually\twell\tcovered,\tespecially\tif\twe\tlook\tinto\tthe\tdetailed\treport\tfor\tour code\tfile,\tas\tshown\tin\tthe\tfollowing\timage:",
      "content_length": 577,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 232,
      "content": "We\tcan\tsee\tthat\tonly\tone\tbranch\t(the\tor\toperator\tin\tline\t7)\tis\tnot\tcovered and\tthe\tif\toperator\tin\tline\t6\tnever\tdiverted\tto\tthe\telse\toperator.\n\nWe\talso\tgot\tinformation\tabout\tthe\tnumber\tof\ttimes\ta\tline\tis\texecuted:\tit\tis showing\tin\tthe\tvertical\tbar\tbeside\tthe\tline\tnumber.\tThis\tinformation\tis also\tvery\tuseful\tto\tspot\tthe\thot\tareas\tof\tour\tapplication\twhere\tan optimization\twill\tbenefit\tthe\tmost.\n\nRegarding\tthe\tright\tlevel\tof\tcoverage,\tin\tthis\texample,\tit\tis\tfairly\teasy\tto go\tup\tto\t90%+,\tbut\tunfortunately,\tit\tis\tnot\tthat\teasy\tin\tproduction",
      "content_length": 539,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 233,
      "content": "systems:\n\nCode\tis\ta\tlot\tmore\tcomplex Time\tis\talways\ta\tconstraint Testing\tmight\tnot\tbe\tseen\tas\tproductive\ttime\n\nHowever,\tyou\tshould\texercise\tcaution\twhen\tworking\twith\ta\tdynamic language.\tIn\tJava\tor\tC#,\tcalling\ta\tfunction\tthat\tdoes\tnot\texist\tresults\tin\ta compilation\ttime\terror;\twhereas\tin\tJavaScript,\tit\twill\tresult\tin\ta\truntime error.\tThe\tonly\treal\tbarrier\tis\tthe\ttesting\t(manual\tor\tautomated),\tso\tit\tis\ta good\tpractice\tto\tensure\tthat\tat\tleast\tevery\tline\tis\texecuted\tonce.\tIn general\tcode\tcoverage,\tover\t75%\tshould\tbe\tgood\tenough\tfor\tthe majority\tof\tcases.\n\nEnd-to-end\ttesting\n\nIn\torder\tto\ttest\tour\tapplication\tend\tto\tend,\twe\tare\tgoing\tto\tneed\ta\tserver running\tit.\tUsually,\tend-to-end\ttests\tare\texecuted\tagainst\ta\tcontrolled environment,\tsuch\tas\ta\tQA\tbox\tor\ta\tpre-production\tmachine,\tto\tverify that\tour\tabout-to-be-deployed\tsoftware\tis\tbehaving\tas\texpected.\n\nIn\tthis\tcase,\tour\tapplication\tis\tan\tAPI,\tso\twe\tare\tgoing\tto\tcreate\tthe\tend- to-end\ttests,\twhich\tat\tthe\tsame\ttime,\tare\tgoing\tto\tbe\tused\tas\tintegration tests.\n\nHowever,\tin\ta\tfull\tapplication,\twe\tmight\twant\tto\thave\ta\tclear\tseparation between\tthe\tintegration\tand\tend-to-end\ttests\tand\tuse\tsomething\tlike Selenium\tto\ttest\tour\tapplication\tfrom\tthe\tUI\tpoint\tof\tview.\n\nSelenium\tis\ta\tframework\tthat\tallows\tour\tcode\tto\tsend\tinstructions\tto\tthe browser,\tas\tfollows:\n\nClick\tthe\tbutton\twith\tthe\tbutton1\tID Hover\tover\tthe\tdiv\telement\twith\tthe\tCSS\tclass\thighlighted\n\nIn\tthis\tway,\twe\tcan\tensure\tthat\tour\tapp\tflows\twork\tas\texpected,\tend\tto end,\tand\tour\tnext\trelease\tis\tnot\tgoing\tto\tbreak\tthe\tkey\tflows\tof\tour\tapp.\n\nLet's\tfocus\ton\tthe\tend-to-end\ttests\tfor\tour\tmicroservice.\tWe\thave\tbeen using\tChai\tand\tMocha\twith\ttheir\tcorresponding\tassertion\tinterfaces\tto",
      "content_length": 1696,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 234,
      "content": "unit\ttest\tour\tsoftware,\tand\tSinon.JS\tto\tmock\tservices\tfunctions\tand\tother elements\tto\tavoid\tthe\tcalls\tbeing\tpropagated\tto\tthird-party\tweb\tservices or\tget\ta\tcontrolled\tresponse\tfrom\tone\tmethod.\n\nNow,\tin\tour\tend-to-end\ttest\tplan,\twe\tactually\twant\tto\tissue\tthe\tcalls\tto our\tservice\tand\tget\tthe\tresponse\tto\tvalidate\tthe\tresults.\n\nThe\tfirst\tthing\twe\tneed\tto\tdo\tis\trun\tour\tmicroservice\tsomewhere.\tWe\tare going\tto\tuse\tour\tlocal\tmachine\tjust\tfor\tconvenience,\tbut\twe\tcan\texecute these\ttests\tin\ta\tcontinuous\tdevelopment\tenvironment\tagainst\ta\tQA machine.\n\nSo,\tlet's\tstart\tthe\tserver:\n\nnode\tstop-words.js\n\nI\tcall\tmy\tscript\tstop-words.js\tfor\tconvenience.\tOnce\tthe\tserver\tis running,\twe\tare\tready\tto\tstart\ttesting.\tIn\tsome\tsituations,\twe\tmight\twant our\ttest\tto\tstart\tand\tstop\tthe\tserver\tso\tthat\teverything\tis\tself-contained. Let's\tsee\ta\tsmall\texample\tabout\thow\tto\tdo\tit:\n\nvar\texpress\t=\trequire('express');\n\nvar\tmyServer\t=\texpress();\n\nvar\tchai\t=\trequire('chai');\n\nmyServer.get('endpoint',\tfunction(req,\tres){ \t\tres.send('endpoint\treached'); });\n\nvar\tserverHandler;\n\nbefore(function(){ \t\tserverHandler\t=\tmyServer.listen(3000); });\n\ndescribe(\"When\texecuting\t'GET'\tinto\tendpoint\",\t function(){ \t\tit(\"should\treturn\t'endpoint\treached'\",\tfunction(){ \t\t\t\t//\tYour\ttest\tlogic\there.\thttp://localhost:3000\tis\t your\tserver. \t\t}); });",
      "content_length": 1306,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 235,
      "content": "after(function(){ \t\tserverHandler.close(); });\n\nAs\tyou\tcan\tsee,\tExpress\tprovides\ta\thandler\tto\toperate\tthe\tserver programmatically,\tso\tit\tis\tas\tsimple\tas\tmaking\tuse\tof\tthe\tbefore()\tand after()\tfunctions\tto\tdo\tthe\ttrick.\n\nIn\tour\texample,\twe\tare\tgoing\tto\tassume\tthat\tthe\tserver\tis\trunning.\tIn order\tto\tissue\tthe\trequests,\twe\tare\tgoing\tto\tuse\ta\tlibrary\tcalled\trequest to\tissue\tthe\tcalls\tto\tthe\tserver.\n\nThe\tway\tto\tinstall\tit,\tas\tusual,\tis\tto\texecute\tnpm\tinstall\trequest.\tOnce\tit is\tfinished,\twe\tcan\tmake\tuse\tof\tthis\tamazing\tlibrary:\n\nvar\tchai\t=\trequire('chai'); var\tchaiHttp\t=\trequire('chai-http'); var\texpect\t=\tchai.expect; chai.use(chaiHttp);\n\ndescribe(\"when\twe\tissue\ta\t'GET'\tto\tfilter\twith\t text='aaaa\tbbbb\tcccc'\",\tfunction(){ \t\tit(\"should\treturn\tHTTP\t200\",\tfunction(done)\t{ \t\t\t\tchai.request('http:/localhost:3000') \t\t\t\t\t\t.get('filter') \t\t\t\t\t\t.query({text:\t'aa\tbb\tccccc'}).end(function(req,\t res){ \t\t\t\t\t\t\t\texpect(res.status).to.equal(200); \t\t\t\t\t\t\t\tdone(); \t\t\t\t\t\t}); \t\t}); });\n\ndescribe(\"when\twe\tissue\ta\t'GET'\tto\tfilter\twith\t text='aa\tbb\tccccc'\",\tfunction(){ \t\tit(\"should\treturn\t'ccccc'\",\tfunction(done)\t{ \t\t\t\tchai.request('http://localhost:3000') \t\t\t\t\t\t.get('filter') \t\t\t\t\t\t.query({text:\t'aa\tbb\tccccc'}).end(function(req,\t res){ \t\t\t\t\t\t\t\texpect(res.text).to.equal('ccccc'); \t\t\t\t\t\t\t\tdone(); \t\t\t\t\t\t}); \t\t}); });",
      "content_length": 1307,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 236,
      "content": "describe(\"when\twe\tissue\ta\t'GET'\tto\tfilter\twith\t text='aa\tbb\tcc'\",\tfunction(){ \t\tit(\"should\treturn\t''\",\tfunction(done)\t{ \t\t\t\tchai.request('http://localhost:3000') \t\t\t\t\t\t.get('/filter') \t\t\t\t\t\t.query({text:\t'aa\tbb\tcc'}).end(function(req,\t res){ \t\t\t\t\t\t\t\texpect(res.text).to.equal(''); \t\t\t\t\t\t\t\tdone(); \t\t\t\t\t\t}); \t\t}); });\n\nWith\tthe\tsimple\ttest\tfrom\tearlier,\twe\tmanaged\tto\ttest\tour\tserver\tin\ta\tway that\tensures\tthat\tevery\tsingle\tmobile\tpart\tof\tthe\tapplication\thas\tbeen executed.\n\nThere\tis\ta\tparticularity\there\tthat\twe\tdidn't\thave\tbefore:\n\nit(\"should\treturn\t'ccccc'\",\tfunction(done)\t{ \t\t\t\tchai.request('http://localhost:3000') \t\t\t\t\t\t.get('/filter') \t\t\t\t\t\t.query({text:\t'aa\tbb\tccccc'}).end(function(req,\t res){ \t\t\t\t\t\t\t\texpect(res.text).to.equal('ccccc'); \t\t\t\t\t\t\t\tdone(); \t\t\t\t\t\t}); \t\t});\n\nIf\tyou\ttake\ta\tlook\tat\tthe\thighlighted\tcode,\tyou\tcan\tsee\ta\tnew\tcallback called\tdone.\tThis\tcallback\thas\tone\tmission:\tprevent\tthe\ttest\tfrom\tfinishing until\tit\tis\tcalled,\tso\tthat\tthe\tHTTP\trequest\thas\ttime\tto\tbe\texecuted\tand return\tthe\tappropriated\tvalue.\tRemember,\tNode.js\tis\tasynchronous, there\tis\tno\tsuch\tthing\tas\ta\tthread\tbeing\tblocked\tuntil\tone\toperation finishes.\n\nOther\tthan\tthat,\twe\tare\tusing\ta\tnew\tDSL\tintroduced\tby\tchai-http\tto\tbuild get\trequests.\n\nThis\tlanguage\tallows\tus\tto\tbuild\ta\tlarge\trange\tof\tcombinations,\tconsider the\tfollowing,\tfor\texample:",
      "content_length": 1334,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 237,
      "content": "chai.request('http://mydomain.com') \t\t.post('/myform') \t\t.field('_method',\t'put') \t\t.field('username',\t'dgonzalez') \t\t.field('password',\t'123456').end(...)\n\nIn\tthe\tpreceding\trequest,\twe\tare\tsubmitting\ta\tform\tthat\tlooks\tlike\ta\tlogin, so\tthat\tin\tthe\tend()\tfunction,\twe\tcan\tassert\tthe\treturn\tfrom\tthe\tserver.\n\nThere\tare\tan\tendless\tnumber\tof\tcombinations\tto\ttest\tour\tAPIs\twith\tchai- http.\n\nManual\ttesting\t–\tthe\tnecessary\tevil\n\nNo\tmatter\thow\tmuch\teffort\twe\tput\tin\tto\tour\tautomated\ttesting,\tthere\twill always\tbe\ta\tnumber\tof\tmanual\ttests\texecuted.\n\nSometimes,\twe\tneed\tto\tdo\tit\tjust\twhen\twe\tare\tdeveloping\tour\tAPI,\tas\twe want\tto\tsee\tthe\tmessages\tgoing\tfrom\tour\tclient\tto\tthe\tserver,\tbut\tsome other\ttimes,\twe\tjust\twant\tto\thit\tour\tendpoints\twith\ta\tpre-forged\trequest\tto cause\tthe\tsoftware\tto\texecute\tas\twe\texpect.\n\nIn\tthe\tfirst\tcase,\twe\tare\tgoing\tto\ttake\tthe\tadvantage\tof\tNode.js\tand\tits dynamic\tnature\tto\tbuild\ta\tproxy\tthat\twill\tsniff\tall\tthe\trequests\tand\tlog them\tto\ta\tterminal\tso\tthat\twe\tcan\tdebug\twhat\tis\tgoing\ton.\tThis\ttechnique can\tbe\tused\tto\tleverage\tthe\tcommunication\tbetween\ttwo\tmicroservices and\tsee\twhat\tis\tgoing\ton\twithout\tinterrupting\tthe\tflow.\n\nIn\tthe\tsecond\tcase,\twe\tare\tgoing\tto\tuse\tsoftware\tcalled\tPostman\tto issue\trequests\tagainst\tour\tserver\tin\ta\tcontrolled\tway.\n\nBuilding\ta\tproxy\tto\tdebug\tour\tmicroservices\n\nMy\tfirst\tcontact\twith\tNode.js\twas\texactly\tdue\tto\tthis\tproblem:\ttwo\tservers sending\tmessages\tto\teach\tother,\tcausing\tmisbehavior\twithout\tan apparent\tcause.\n\nIt\tis\ta\tvery\tcommon\tproblem\tthat\thas\tmany\talready-working\tsolutions (man-in-the-middle\tproxies\tbasically),\tbut\twe\tare\tgoing\tto\tdemonstrate how\tpowerful\tNode.js\tis:",
      "content_length": 1635,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 238,
      "content": "var\thttp\t=\trequire('http'); var\thttpProxy\t=\trequire('http-proxy'); var\tproxy\t=\thttpProxy.createProxyServer({});\n\nhttp.createServer(function(req,\tres)\t{ \t\tconsole.log(req.rawHeaders); \t\tproxy.web(req,\tres,\t{\ttarget:\t 'http://localhost:3000'\t}); }).listen(4000);\n\nIf\tyou\tremember\tfrom\tthe\tprevious\tsection,\tour\tstop-words.js\tprogram was\trunning\ton\tthe\tport\t3000.\tWhat\twe\thave\tdone\twith\tthis\tcode\tis\tcreate a\tproxy\tusing\thttp-proxy,\tthat\ttunnels\tall\tthe\trequests\tmade\ton\tthe\tport 4000\tinto\tthe\tport\t3000\tafter\tlogging\tthe\theaders\tinto\tthe\tconsole.\n\nIf\twe\trun\tthe\tprogram\tafter\tinstalling\tall\tthe\tdependencies\twith\tthe\tnpm install\tcommand\tin\tthe\troot\tof\tthe\tproject,\twe\tcan\tsee\thow\teffectively the\tproxy\tis\tlogging\tthe\trequests\tand\ttunneling\tthem\tinto\tthe\ttarget\thost:\n\ncurl\thttp://localhost:4000/filter?text=aaa\n\nThis\twill\tproduce\tthe\tfollowing\toutput:\n\nThis\texample\tis\tvery\tsimplistic,\tbut\tthis\tsmall\tproxy\tcould\tvirtually\tbe deployed\tanywhere\tin\tbetween\tour\tmicroservices\tand\tgive\tus\tvery valuable\tinformation\tabout\twhat\tis\tgoing\ton\tin\tthe\tnetwork.\n\nPostman\n\nOut\tof\tall\tthe\tsoftware\tthat\twe\tcan\tfind\ton\tthe\tInternet\tfor\ttesting\tAPIs, Postman\tis\tmy\tfavorite.\tIt\tstarted\tas\ta\textension\tfor\tGoogle\tChrome,\tbut nowadays,\thas\ttaken\tthe\tform\tof\ta\tstandalone\tapp\tbuilt\ton\tthe\tChrome runtime.",
      "content_length": 1283,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 239,
      "content": "It\tcan\tbe\tfound\tin\tthe\tChrome\tweb\tstore,\tand\tit\tis\tfree\t(so\tyou\tdon't\tneed to\tpay\tfor\tit),\talthough\tit\thas\ta\tversion\tfor\tteams\twith\tmore\tadvanced features\tthat\tis\tpaid.\n\nThe\tinterface\tis\tvery\tconcise\tand\tsimple,\tas\tshown\tin\tthe\tfollowing screenshot:\n\nOn\tthe\tleft-hand\tside,\twe\tcan\tsee\tthe\tHistory\tof\trequests,\tas\twell\tas\tthe Collections\tof\trequests,\twhich\twill\tbe\tvery\thandy\tfor\twhen\twe\tare working\ton\ta\tlong-term\tproject\tand\twe\thave\tsome\tcomplicated\trequests to\tbe\tbuilt.\n\nWe\tare\tgoing\tto\tuse\tagain\tour\tstop-words.js\tmicroservice\tto\tshow\thow powerful\tPostman\tcan\tbe.\n\nTherefore,\tthe\tfirst\tthing\tis\tto\tmake\tsure\tthat\tour\tmicroservice\tis\trunning. Once\tit\tis,\tlet's\tissue\ta\trequest\tfrom\tPostman,\tas\tshown\tin\tthe\tfollowing screenshot:",
      "content_length": 731,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 240,
      "content": "As\tsimple\tas\tthat,\twe\thave\tissued\tthe\trequest\tfor\tour\tservice\t(using\tthe GET\tverb)\tand\tit\thas\treplied\twith\tthe\ttext\tfiltered:\tvery\tsimple\tand effective.\n\nNow\timagine\tthat\twe\twant\tto\texecute\tthat\tcall\tover\tNode.js.\tPostman comes\twith\ta\tvery\tinteresting\tfeature,\twhich\tis\tgenerating\tthe\tcode\tfor the\trequests\tthat\twe\tissue\tfrom\tthe\tinterface.\tIf\tyou\tclick\ton\tthe\ticon under\tthe\tsave\tbutton\ton\tthe\tright-hand\tside\tof\tthe\twindow,\tthe appearing\tscreen\twill\tdo\tthe\tmagic:",
      "content_length": 465,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 241,
      "content": "Let's\ttake\ta\tlook\tat\tthe\tgenerated\tcode:\n\nvar\thttp\t=\trequire(\"http\");\n\nvar\toptions\t=\t{ \t\t\"method\":\t\"GET\", \t\t\"hostname\":\t\"localhost\", \t\t\"port\":\t\"3000\", \t\t\"path\":\t\"/filter?text=aaa%20bb%20cc\", \t\t\"headers\":\t{ \t\t\t\t\"cache-control\":\t\"no-cache\", \t\t\t\t\"postman-token\":\t\"912cacd8-bcc0-213f-f6ff- f0bcd98579c0\" \t\t} };\n\nvar\treq\t=\thttp.request(options,\tfunction\t(res)\t{ \t\tvar\tchunks\t=\t[];\n\nres.on(\"data\",\tfunction\t(chunk)\t{ \t\t\t\tchunks.push(chunk); \t\t});\n\nres.on(\"end\",\tfunction\t()\t{",
      "content_length": 469,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 242,
      "content": "var\tbody\t=\tBuffer.concat(chunks); \t\t\t\tconsole.log(body.toString()); \t\t}); });\n\nreq.end();\n\nIt\tis\tquite\tan\teasy\tcode\tto\tunderstand,\tespecially\tif\tyou\tare\tfamiliar\twith the\tHTTP\tlibrary.\n\nWith\tPostman,\twe\tcan\talso\tsend\tcookies,\theaders,\tand\tforms\tto\tthe servers\tin\torder\tto\tmimic\tthe\tauthentication\tthat\tan\tapplication\twill\tfulfill by\tsending\tthe\tauthentication\ttoken\tor\tcookie\tacross.\n\nLet's\tredirect\tour\trequest\tto\tthe\tproxy\tthat\twe\tcreated\tin\tthe\tpreceding section,\tas\tshown\tin\tthe\tfollowing\tscreenshot:\n\nIf\tyou\thave\tthe\tproxy\tand\tthe\tstop-words.js\tmicroservice\trunning,\tyou should\tsee\tsomething\tsimilar\tto\tthe\tfollowing\toutput\tin\tthe\tproxy:",
      "content_length": 642,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 243,
      "content": "The\theader\tthat\twe\tsent\tover\twith\tPostman,\tmy-awesome-header,\twill show\tup\tin\tthe\tlist\tof\traw\theaders.",
      "content_length": 102,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 244,
      "content": "Documenting\tmicroservices\n\nIn\tthis\tsection,\twe\tare\tgoing\tto\tlearn\thow\tto\tuse\tSwagger\tto\tdocument APIs.\tSwagger\tis\tan\tAPI\tmanager\tthat\tfollows\tthe\tOpen\tAPI\tstandard, so\tthat\tit\tis\ta\tcommon\tlanguage\tfor\tall\tthe\tAPI\tcreators.\tWe\twill\tdiscuss how\tto\twrite\tdefinitions\tand\twhy\tit\tis\tso\timportant\tto\tagree\ton\thow\tto describe\tresources.\n\nDocumenting\tAPIs\twith\tSwagger\n\nDocumentation\tis\talways\ta\tproblem.\tNo\tmatter\thow\thard\tyou\ttry,\tit\twill always\teventually\tgo\tout\tof\tdate.\tLuckily,\tin\tthe\tpast\tfew\tyears,\tthere\thas been\ta\tpush\tinto\tproducing\ta\thigh\tquality\tdocumentation\tfor\tREST\tAPIs.\n\nAPI\tmanagers\thave\tplayed\ta\tkey\trole\tin\tit,\tand\tSwagger\tis\tparticularly\tan interesting\tplatform\tto\tlook\tat.\tMore\tthan\ta\tmodule\tfor\tdocumentation, Swagger\tmanages\tyour\tAPI\tin\ta\tsuch\tway\tthat\tgives\tyou\ta\tholistic\tview of\tyour\twork.\n\nLet's\tstart\tinstalling\tit:\n\nnpm\tinstall\t-g\tswagger\n\nThis\twill\tinstall\tSwagger\tsystem-wide,\tso\tit\twill\tbe\tanother\tcommand\tin our\tsystem.\tNow,\twe\tneed\tto\tcreate\ta\tproject\tusing\tit:\n\nswagger\tproject\tcreate\tmy-project\n\nThis\tcommand\twill\tallow\tyou\tto\tchoose\tdifferent\tweb\tframeworks.\tWe\tare going\tto\tchoose\tExpress,\tas\tit\tis\tthe\tone\tthat\twe\thave\talready\tbeen using.\tThe\toutput\tof\tthe\tpreceding\tcommand\tis\tshown\tin\tthe\tfollowing screenshot:",
      "content_length": 1245,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 245,
      "content": "This\tscreenshot\tis\tshowing\thow\tto\tstart\ta\tproject\twith\tSwagger\n\nNow\twe\tcan\tfind\ta\tnew\tfolder,\tcalled\tmy-project,\tthat\tlooks\tlike\tthe following\timage:\n\nThe\tstructure\tis\tself-explanatory\tand\tit\tis\tthe\tcommon\tlayout\tof\ta\tNode.js application:",
      "content_length": 238,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 246,
      "content": "api:\tHere,\tour\tAPI\tcode\twill\tlay\tdown config:\tAll\tthe\tconfiguration\tsits\tin\there node_modules:\tThis\tis\ta\tfolder\twith\tall\tthe\tdependencies\trequired\tto run\tour\tapplication test:\tThis\tis\twhere\tSwagger\thas\tgenerated\tsome\tdummy\ttests\tand where\twe\tcould\tadd\tour\town\ttests\n\nSwagger\tcomes\twith\tan\timpressive\tfeature:\tan\tembedded\teditor\tthat allows\tyou\tto\tmodel\tthe\tendpoints\tof\tyour\tAPI.\tIn\torder\tto\trun\tit,\tfrom within\tthe\tgenerated\tfolder,\texecute\tthe\tfollowing\tcommand:\n\nSwagger\tproject\tedit\n\nIt\twill\topen\tSwagger\tEditor\tin\tthe\tdefault\tbrowser,\twith\ta\twindow\tsimilar to\tthe\tfollowing\timage:\n\nSwagger\tmakes\tuse\tof\tYet\tAnother\tMarkup\tLanguage\t(YAML).\tIt\tis\ta language\tthat\tis\tvery\tsimilar\tto\tJSON,\tbut\twith\ta\tdifferent\tsyntax.",
      "content_length": 719,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 247,
      "content": "In\tthis\tdocument,\twe\tcan\tcustomize\ta\tnumber\tof\tthings,\tsuch\tas\tpaths (routes\tin\tour\tapplication).\tLet's\ttake\ta\tlook\tat\tthe\tpath\tgenerated\tby Swagger:\n\nhello: \t\t#\tbinds\ta127\tapp\tlogic\tto\ta\troute \t\tx-swagger-router-controller:\thello_world \t\tget: \t\t\t\tdescription:\tReturns\t'Hello'\tto\tthe\tcaller \t\t\t\t#\tused\tas\tthe\tmethod\tname\tof\tthe\tcontroller \t\t\t\toperationId:\thello \t\t\t\tparameters: \t\t\t\t\t\t-\tname:\tname \t\t\t\t\t\t\t\tin:\tquery \t\t\t\t\t\t\t\tdescription:\tThe\tname\tof\tthe\tperson\tto\twhom\tto\t say\thello \t\t\t\t\t\t\t\trequired:\tfalse \t\t\t\t\t\t\t\ttype:\tstring \t\t\t\tresponses: \t\t\t\t\t\t\"200\": \t\t\t\t\t\t\t\tdescription:\tSuccess \t\t\t\t\t\t\t\tschema: \t\t\t\t\t\t\t\t\t\t#\ta\tpointer\tto\ta\tdefinition \t\t\t\t\t\t\t\t\t\t$ref:\t\"#definitions/HelloWorldResponse\" \t\t\t\t\t\t#\tresponses\tmay\tfall\tthrough\tto\terrors \t\t\t\t\t\tdefault: \t\t\t\t\t\t\t\tdescription:\tError \t\t\t\t\t\t\t\tschema: \t\t\t\t\t\t\t\t\t\t$ref:\t\"#/definitions/ErrorResponse\"\n\nThe\tdefinition\tis\tself-documented.\tBasically,\twe\twill\tconfigure\tthe parameters\tused\tby\tour\tendpoint,\tbut\tin\ta\tdeclarative\tway.\tThis\tendpoint is\tmapping\tthe\tincoming\tactions\tinto\tthe\thello_world\tcontroller,\tand specifically\tinto\tthe\thello\tmethod,\twhich\tis\tdefined\tby\tthe\tid\toperation. Let's\tsee\twhat\tSwagger\thas\tgenerated\tfor\tus\tin\tthis\tcontroller:\n\n'use\tstrict';\n\nvar\tutil\t=\trequire('util');\n\nmodule.exports\t=\t{ \t\thello:\thello };\n\nfunction\thello(req,\tres)\t{ \t\tvar\tname\t=\treq.swagger.params.name.value\t||",
      "content_length": 1340,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 248,
      "content": "'stranger'; \t\tvar\thello\t=\tutil.format('Hello,\t%s!',\tname); \t\tres.json(hello); }\n\nThis\tcode\tcan\tbe\tfound\tin\tthe\tapi/controllers\tfolder\tof\tthe\tproject.\tAs you\tcan\tsee,\tit\tis\ta\tpretty\tstandard\tExpress\tcontroller\tpacked\tas\ta module\t(well-cohesioned).\tThe\tonly\tstrange\tline\tis\tthe\tfirst\tone\tin\tthe hello\tfunction,\twhere\twe\tpick\tup\tthe\tparameters\tfrom\tSwagger.\tWe\twill come\tback\tto\tthis\tlater,\tonce\twe\trun\tthe\tproject.\n\nThe\tsecond\tpart\tof\tthe\tendpoint\tis\tthe\tresponses.\tAs\twe\tcan\tsee,\twe\tare referencing\ttwo\tdefinitions:\tHelloWorldResponse\tfor\thttp\tcode\t200\tand ErrorResponse\tfor\tthe\trest\tof\tthe\tcodes.\tThese\tobjects\tare\tdefined\tin\tthe following\tcode:\n\ndefinitions: \t\tHelloWorldResponse: \t\t\t\trequired: \t\t\t\t\t\t-\tmessage \t\t\t\tproperties: \t\t\t\t\t\tmessage: \t\t\t\t\t\t\t\ttype:\tstring \t\tErrorResponse: \t\t\t\trequired: \t\t\t\t\t\t-\tmessage \t\t\t\tproperties: \t\t\t\t\t\tmessage: \t\t\t\t\t\t\t\ttype:\tstring\n\nThis\tis\tsomething\treally\tinteresting,\talthough\twe\tare\tusing\ta\tdynamic language,\tthe\tcontract\tis\tbeing\tdefined\tby\tSwagger\tso\tthat\twe\thave\ta language-agnostic\tdefinition\tthat\tcan\tbe\tconsumed\tby\ta\tnumber\tof different\ttechnologies,\trespecting\tthe\tprinciple\tof\ttechnology heterogeneity\tthat\twe\twere\ttalking\tabout\tearlier\tin\tChapter\t1, Microservices\tArchitecture,\tand\tChapter\t2,\tMicroservices\tin\tNode.js\t– Seneca\tand\tPM2\tAlternatives.\n\nAfter\texplaining\thow\tthe\tdefinition\tworks,\tit\tis\ttime\tto\tstart\tthe\tserver:\n\nswagger\tproject\tstart",
      "content_length": 1391,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 249,
      "content": "This\tshould\tproduce\tan\toutput\tthat\tis\tvery\tsimilar\tto\tthe\tfollowing\tcode:\n\nStarting:\tC:\\my-project\\app.js... \t\tproject\tstarted\there:\thttp://localhost:10010/ \t\tproject\twill\trestart\ton\tchanges. \t\tto\trestart\tat\tany\ttime,\tenter\t`rs` try\tthis: curl\thttp://127.0.0.1:10010/hello?name=Scott\n\nNow,\tif\twe\tfollow\tthe\tinstructions\tof\tthe\toutput\tand\texecute\tthe\tcurl command,\twe\tget\tthe\tfollowing\toutput:\n\ncurl\thttp://127.0.0.1:10010/hello?name=David \"Hello\tDavid!\"\n\nSwagger\tis\tbinding\tthe\tname\tquery\tparameter\tto\tthe\tSwagger\tparameter specified\tin\tthe\tYAML\tdefinition.\tThis\tmay\tsound\tbad,\tas\twe\tare\tcoupling our\tsoftware\tto\tSwagger,\tbut\tit\tgives\tyou\tan\timmense\tbenefit:\tSwagger allows\tyou\tto\ttest\tthe\tendpoint\tthrough\tthe\teditor.\tLet's\tsee\thow\tit\tworks.\n\nOn\tthe\tright-hand\tside\tof\tthe\teditor,\tyou\tcan\tsee\ta\tbutton\twith\tthe\tTry this\toperation\tlabel,\tas\tshown\tin\tthe\tfollowing\tscreenshot:\n\nOnce\tyou\tclick\tit,\tit\twill\tpresent\tyou\ta\tform\tthat\tallows\tyou\tto\ttest\tthe endpoint,\tas\tshown\tin\tthe\tfollowing\tscreenshot:",
      "content_length": 998,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 250,
      "content": "There\tis\ta\twarning\tmessage\ton\tthis\tform\tabout\tcross-origin\trequests.\tWe don't\tneed\tto\tworry\tabout\tit\twhen\tdeveloping\tin\tour\tlocal\tmachine; however,\twe\tcould\thave\tproblems\twhen\ttesting\tother\thosts\tusing\tthe Swagger\tEditor.\n\nNote\n\nFor\tmore\tinformation,\tvisit\tthe\tfollowing\tURL:\n\nhttps://en.wikipedia.org/wiki/Cross-origin_resource_sharing\n\nEnter\ta\tvalue\tfor\tthe\tname\tparameter,\tand\tafter\tthat,\tclick\ton\tSend Request,\tas\tshown\tin\tthe\tfollowing\timage:",
      "content_length": 447,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 251,
      "content": "This\tis\ta\tresponse\texample\tusing\tSwagger\tEditor\tto\ttest\tthe\tendpoint\n\nBe\taware\tthat,\tfor\tthis\ttest\tto\twork,\tour\tapp\tserver\thas\tto\tbe\tup\tand running.\n\nGenerating\ta\tproject\tfrom\tthe\tSwagger definition\n\nUntil\tnow,\twe\thave\tbeen\tplaying\twith\tSwagger\tand\tthe\tgenerated\tproject, but\twe\tare\tnow\tgoing\tto\tgenerate\tthe\tproject\tfrom\tthe\tswagger.yaml\tfile. We\twill\tuse\tthe\talready\tgenerated\tproject\tas\ta\tstarting\tpoint,\tbut\twe\twill add\ta\tnew\tendpoint:\n\nswagger:\t\"2.0\" info: \t\tversion:\t\"0.0.1\" \t\ttitle:\tStop\tWords\tFiltering\tApp host:\tlocalhost:8000 basePath:\t schemes: \t\t-\thttp \t\t-\thttps",
      "content_length": 574,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 252,
      "content": "consumes: \t\t-\tapplicationjson produces: \t\t-\tapplication/json paths: \t\tstopwords: \t\t\t\tx-swagger-router-controller:\tstop_words \t\t\t\tget: \t\t\t\t\t\tdescription:\tRemoves\tthe\tstop\twords\tfrom\tan\t arbitrary\tinput\ttext. \t\t\t\t\t\toperationId:\tstopwords \t\t\t\t\t\tparameters: \t\t\t\t\t\t\t\t-\tname:\ttext \t\t\t\t\t\t\t\t\t\tin:\tquery \t\t\t\t\t\t\t\t\t\tdescription:\tThe\ttext\tto\tbe\tsanitized \t\t\t\t\t\t\t\t\t\trequired:\tfalse \t\t\t\t\t\t\t\t\t\ttype:\tstring \t\t\t\t\t\tresponses: \t\t\t\t\t\t\t\t\"200\": \t\t\t\t\t\t\t\t\t\tdescription:\tSuccess \t\t\t\t\t\t\t\t\t\tschema: \t\t\t\t\t\t\t\t\t\t\t\t$ref:\t\"#definitions/StopWordsResponse\" \t\t/swagger: \t\t\t\tx-swagger-pipe:\tswagger_raw definitions: \t\tStopWordsResponse: \t\t\t\trequired: \t\t\t\t\t\t-\tmessage \t\t\t\tproperties: \t\t\t\t\t\tmessage: \t\t\t\t\t\t\t\ttype:\tstring\n\nThis\tendpoint\tmight\tsound\tvery\tfamiliar\tto\tyou,\tas\twe\tunit\ttested\tit\tearlier in\tthis\tchapter.\tAs\tyou\tprobably\tknow\tby\tnow,\tthe\tSwagger\tEditor\tis\tquite cool:\tit\tprovides\tfeedback\tas\tyou\ttype\ton,\tabout\twhat\tis\tgoing\ton\tin\tthe YAML\tfile,\tas\twell\tas\tsaves\tthe\tchanges.\n\nThe\tnext\tstep\tis\tto\tdownload\tthe\tSwagger\tcode\tgenerator\tfrom https://github.com/swagger-api/swagger-codegen.\tIt\tis\ta\tJava\tproject,\tso we\tare\tgoing\tto\tneed\tthe\tJava\tSDK\tand\tMaven\tto\tbuild\tit,\tas\tfollows:\n\nmvn\tpackage\n\nCodegen\tis\ta\ttool\tthat\tallow\tus\tto\tread\tthe\tAPI\tdefinition\tfrom\tthe Swagger\tYAML\tand\tbuild\tthe\tbasic\tstructure\tfor\ta\tproject\tin\ta\tlanguage",
      "content_length": 1306,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 253,
      "content": "of\tour\tchoice,\tin\tthis\tcase,\tNode.js.\n\nThe\tpreceding\tcommand\tin\tthe\troot\tof\tthe\tproject\tshould\tbuild\tall\tthe submodules.\tNow,\tit\tis\tas\teasy\tas\texecuting\tthe\tfollowing\tcommand\tin the\troot\tof\tthe\tswagger-codegen\tfolder:\n\njava\t-jar\tmodules/swagger-codegen-cli/target/swagger- codegen-cli.jar\tgenerate\t-i\tmy-project.yaml\t-l\tnodejs\t -o\tmy-project\n\nThe\tSwagger\tcode\tgenerator\tsupports\ta\tnumber\tof\tlanguages.\tHere,\tthe trick\tis\tthat\twhen\tusing\tit\tfor\tmicroservices,\twe\tcan\tdefine\tthe\tinterface and\tthen\tuse\tthe\tmost\tappropriate\ttechnology\tto\tbuild\tour\tservice.\n\nIf\tyou\tgo\tto\tthe\tmy-project\tfolder,\tyou\tshould\tfind\tthe\tfull\tstructure\tof\tthe project\tin\tthere,\tready\tto\tstart\tcoding.",
      "content_length": 673,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 254,
      "content": "Summary\n\nIn\tthis\tchapter,\tyou\tlearned\thow\tto\ttest\tand\tdocument\tmicroservices.\tIt\tis usually\tthe\tforgotten\tactivity\tin\tsoftware\tdevelopment,\tdue\tto\tthe pressures\tto\tdeliver\tnew\tfunctionalities,\tbut\tin\tmy\topinion,\tit\tis\ta\trisky decision.\tWe\thave\tto\tfind\tthe\tbalance\tbetween\ttoo\tmuch\tand\tvery\tlittle testing.\tIn\tgeneral,\twe\twill\talways\ttry\tto\tfind\tthe\tright\tproportion\tfor\tunit, integration\tand\tend-to-end\ttests.\n\nYou\talso\tlearned\tabout\tmanual\ttesting\tand\tthe\ttools\tto\tefficiently\ttest\tour software\tmanually\t(there\tis\talways\ta\tcomponent\tof\tmanual\ttesting).\n\nAnother\tinteresting\tpoint\tis\tthe\tdocumentation\tand\tAPI\tmanagement.\tIn this\tcase,\twe\tgot\tto\tknow\tSwagger,\twhich\tis\tprobably\tthe\tmost\tpopular API\tmanager\tthat\tled\tto\tthe\tcreation\tof\tthe\tOpen\tAPI\tstandard.\n\nIf\tyou\twant\tto\tgo\tdeeper\tin\tto\tthe\tAPI\tworld\t(there\tis\ta\tlot\tto\tlearn\tin\torder to\tbuild\ta\tpractical\tand\tefficient\tAPI),\tyou\tshould\tprobably\tbrowse http://apigee.com.\tApigee\tare\ta\tcompany\texpert\ton\tbuilding\tAPIs\tand providing\ttools\tfor\tdevelopers\tand\tenterprises\tthat\tcould\thelp\tyou\tto\tbuild a\tbetter\tAPI.",
      "content_length": 1063,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 255,
      "content": "Chapter\t7.\tMonitoring Microservices\n\nMonitoring\tservers\tis\talways\ta\tcontroversial\tsubject.\tIt\tusually\tfalls\tunder system\tadministration,\tand\tsoftware\tengineers\tdon't\teven\tgo\tnear\tit,\tbut we\tare\tlosing\tone\tof\tthe\thuge\tbenefits\tof\tmonitoring:\tthe\tability\tto\treact quickly\tto\tfailures.\tBy\tmonitoring\tour\tsystem\tvery\tclosely,\twe\tcan\tbe aware\tof\tproblems\talmost\timmediately\tso\tthat\tthe\tactions\tto\tcorrect\tthe problem\tmay\teven\tsave\tus\tfrom\timpacting\tthe\tcustomers.\tAlong\twith monitoring,\tthere\tis\tthe\tconcept\tof\tperformance.\tBy\tknowing\thow\tour system\tbehaves\tduring\tload\tperiods,\twe\twill\tbe\table\tto\tanticipate\tthe necessity\tof\tscaling\tthe\tsystem.\tIn\tthis\tchapter,\twe\twill\tdiscuss\thow\tto monitor\tservers,\tand\tspecifically\tmicroservices,\tin\torder\tto\tmaintain\tthe stability\tof\tour\tsystem.\n\nIn\tthis\tchapter,\twe\twill\tcover\tthe\tfollowing\ttopics:\n\nMonitoring\tservices Monitoring\tusing\tPM2\tand\tKeymetrics Monitoring\tmetrics Simian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify Throughput\tand\tperformance\tdegradation\n\nMonitoring\tservices\n\nWhen\tmonitoring\ta\tmicroservice,\twe\tare\tinterested\tin\ta\tfew\tdifferent types\tof\tmetrics.\tThe\tfirst\tbig\tgroup\tof\tmetrics\tis\tthe\thardware\tresources, which\tare\tdescribed\tas\tfollows:\n\nMemory\tmetrics:\tThis\tindicates\thow\tmuch\tmemory\tis\tleft\tin\tour system\tor\tconsumed\tby\tour\tapplication CPU\tutilization:\tAs\tthe\tname\tsuggests,\tthis\tindicates\thow\tmuch CPU\tare\twe\tusing\tat\ta\tgiven\ttime Disk\tutilization:\tThis\tindicates\tthe\tI/O\tpressure\tin\tthe\tphysical\thard drives",
      "content_length": 1471,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 256,
      "content": "The\tsecond\tbig\tgroup\tis\tthe\tapplication\tmetrics,\tas\tfollows:\n\nNumber\tof\terrors\tper\ttime\tunit Number\tof\tcalls\tper\ttime\tunit Response\ttime\n\nEven\tthough\tboth\tgroups\tare\tconnected\tand\ta\tproblem\tin\tthe\thardware will\timpact\tthe\tapplication\tperformance\t(and\tthe\tother\tway\taround), knowing\tall\tof\tthem\tis\ta\tmust.\n\nHardware\tmetrics\tare\teasy\tto\tquery\tif\tour\tserver\tis\ta\tLinux\tmachine.\tOn Linux,\tall\tthe\tmagic\tof\thardware\tresources\thappens\tin\tthe\t/proc\tfolder. This\tfolder\tis\tmaintained\tby\tthe\tkernel\tof\tthe\tsystem\tand\tcontains\tfiles about\thow\tthe\tsystem\tbehaves\tregarding\ta\tnumber\tof\taspects\tin\tthe system.\n\nSoftware\tmetrics\tare\tharder\tto\tcollect\tand\twe\tare\tgoing\tto\tuse Keymetrics\tfrom\tthe\tcreators\tof\tPM2\tto\tmonitor\tour\tNode.js applications.\n\nMonitoring\tusing\tPM2\tand\tKeymetrics\n\nPM2,\tas\twe've\tseen\tbefore,\tis\ta\tvery\tpowerful\tinstrument\tto\trun\tNode applications,\tbut\tit\tis\talso\tvery\tgood\tat\tmonitoring\tstandalone applications\tin\tproduction\tservers.\tHowever,\tdepending\ton\tyour\tbusiness case,\tit\tis\tnot\talways\teasy\tto\tget\taccess\tto\tthe\tproduction.\n\nThe\tcreators\tof\tPM2\thave\tsolved\tthis\tproblem\tby\tcreating\tKeymetrics. Keymetrics\tis\ta\tSoftware\tas\ta\tservice\t(SaaS)\tcomponent\tthat\tallows PM2\tto\tsend\tmonitoring\tdata\tacross\tthe\tnetwork\tto\tits\twebsite,\tas\tshown in\tthe\tfollowing\timage\t(as\tfound\tat\thttps://keymetrics.io/):",
      "content_length": 1307,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 257,
      "content": "Even\tthough\tKeymetrics\tis\tnot\tfree,\tit\tprovides\ta\tfree\ttier\tto\tdemonstrate how\tit\tworks.\tWe\tare\tgoing\tto\tuse\tit\tin\tthis\tchapter.\n\nThe\tvery\tfirst\tthing\tthat\twe\tneed\tto\tdo\tis\tregister\ta\tuser.\tOnce\twe\tget access\tto\tour\taccount,\twe\tshould\tsee\tsomething\tsimilar\tto\tthe\tfollowing screen:\n\nThis\tscreen\tis\tasking\tus\tto\tcreate\ta\tbucket.\tKeymetrics\tuses\tthe\tbucket concept\tto\tdefine\ta\tcontext.\tFor\texample,\tif\tour\torganization\thas\tdifferent areas\t(payments,\tcustomer\tservice,\tand\tso\ton)\twith\tdifferent\tservers\ton each\tarea,\twe\tcould\tmonitor\tall\tthe\tservers\tin\tone\tbucket.\tThere\tare\tno restrictions\ton\thow\tmany\tservers\tyou\tcan\thave\tin\tone\tbucket.\tIt\tis\teven",
      "content_length": 646,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 258,
      "content": "possible\tto\thave\tall\tthe\torganization\tin\tthe\tsame\tbucket\tso\tthat everything\tis\teasy\tto\taccess.\n\nLet's\tcreate\ta\tbucket\tcalled\tMonitoring\tTest,\tas\tshown\tin\tthe\tfollowing image:\n\nEasy,\tonce\twe\ttap\ton\tCreate\tBucket,\tKeymetrics\twill\tshow\tus\ta\tscreen with\tthe\tinformation\tneeded\tto\tstart\tmonitoring\tour\tapp,\tas\tshown\tin\tthe following\timage:",
      "content_length": 334,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 259,
      "content": "As\tyou\tcan\tsee,\tthe\tscreen\tdisplays\tinformation\tabout\tthe\tprivate\tkey used\tby\tKeymetrics.\tUsually,\tit\tis\ta\tvery\tbad\tidea\tto\tshare\tthis\tkey\twith anyone.\n\nAs\tshown\ton\tthe\tscreen,\tthe\tnext\tstep\tis\tto\tconfigure\tPM2\tto\tpush\tdata into\tKeymetrics.\tThere\tis\talso\tuseful\tinformation\tabout\tthe\tnetworking needed\tto\tmake\tKeymetrics\twork:\n\nPM2\twill\tbe\tpushing\tdata\tto\tthe\tport\t80\ton\tKeymetrics Keymetrics\twill\tbe\tpushing\tdata\tback\tto\tus\ton\tthe\tport\t43554\n\nUsually,\tin\tlarge\torganizations,\tthere\tare\trestrictions\tabout\tthe networking,\tbut\tif\tyou\tare\ttesting\tthis\tfrom\thome,\teverything\tshould\twork straightaway.\n\nIn\torder\tto\tmake\tPM2\table\tto\tsend\tmetrics\tto\tKeymetrics,\twe\tneed\tto install\tone\tPM2\tmodule\tcalled\tpm2-server-monit.\tThis\tis\ta\tfairly\teasy task:\n\npm2\tinstall\tpm2-server-monit\n\nThis\twill\tresult\tin\tan\toutput\tsimilar\tto\tthe\tfollowing:",
      "content_length": 829,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 260,
      "content": "Let's\trun\tthe\tadvised\tcommand:\n\npm2\tlink\tfan7p32fnysuuw8\tznlz25frrcwakg6\tmy-server\n\nIn\tthis\tcase,\tI\thave\treplaced\t[server\tname]\twith\tmy-server.\tThere\tare\tno restrictions\ton\tthe\tserver\tname;\thowever,\twhen\trolling\tout\tKeymetrics into\ta\treal\tsystem,\tit\tis\trecommended\tto\tchoose\ta\tdescriptive\tname\tin order\tto\teasily\tidentify\tthe\tserver\tin\tthe\tdashboard.\n\nThe\tpreceding\tcommand\twill\tproduce\tan\toutput\tsimilar\tto\tthe\tfollowing image:\n\nThis\tis\tan\tindication\tthat\teverything\twent\twell\tand\tour\tapplication\tis\tready to\tbe\tmonitored\tfrom\tKeymetrics\tthat\tcan\tbe\tchecked\ton https://app.keymetrics.io/,\tas\tfollows:",
      "content_length": 601,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 261,
      "content": "Now,\tour\tserver\tis\tshowing\tup\tin\tthe\tinterface.\tAs\twe\tpreviously\tstated, this\tbucket\tcould\tmonitor\tdifferent\tservers.\tA\tsimple\tvirtual\tmachine\tis created,\tand\tas\tyou\tcan\tsee\tat\tthe\tbottom\tof\tthe\tscreen,\tKeymetrics provides\tus\twith\tthe\tcommand\tto\tbe\texecuted\tin\torder\tto\tadd\tanother server.\tIn\tthis\tcase,\tas\twe\tare\tusing\tthe\tfree\taccess\tto\tKeymetrics,\tso\twe can\tonly\tmonitor\tone\tserver.\n\nLet's\tsee\twhat\tKeymetrics\tcan\toffer\tus.\tAt\tfirst\tsight,\twe\tcan\tsee interesting\tmetrics\tsuch\tas\tCPU\tusage,\tmemory\tavailable,\tdisk\tavailable, and\tso\ton.\n\nAll\tthese\tare\thardware\tmetrics\tthat\tindicate\thow\tour\tsystem\tis\tbehaving. Under\tpressure,\tthey\tare\tthe\tperfect\tindicator\tto\tpoint\tout\tthe\tneed\tfor more\thardware\tresources.\n\nUsually,\tthe\thardware\tresources\tare\tthe\tmain\tindicator\tof\tfailure\tin\tan application.\tNow,\twe\tare\tgoing\tto\tsee\thow\tto\tuse\tKeymetrics\tto\tdiagnose the\tproblem.\n\nDiagnosing\tproblems\n\nA\tmemory\tleak\tis\tusually\ta\tdifficult\tproblem\tto\tsolve\tdue\tto\tthe\tnature\tof the\tflaw.\tTake\ta\tlook\tat\tthe\tfollowing\tcode.\n\nLet's\trun\tthe\tprogram\tusing\ta\tsimple\tseneca.act()\taction:",
      "content_length": 1068,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 262,
      "content": "var\tseneca\t=\trequire('seneca')();\n\nvar\tnames\t=\t[];\n\nseneca.add({cmd:\t'memory-leak'},\tfunction(args,\tdone){ \t\tnames.push(args.name); \t\tgreetings\t=\t\"Hello\t\"\t+\targs.name; \t\tdone(null\t,{result:\tgreetings}); });\n\nseneca.act({cmd:\t'memory-leak',\tname:\t'David'},\t function(err,\tresponse)\t{ \t\tconsole.log(response); });\n\nThis\tprogram\thas\ta\tvery\tobvious\tmemory\tleak,\tand\tby\tobvious,\tI\tmean that\tit\tis\twritten\tto\tbe\tobvious.\tThe\tnames\tarray\twill\tkeep\tgrowing indefinitely.\tIn\tthe\tpreceding\texample,\tit\tis\tnot\ta\tbig\tdeal\tdue\tto\tthe\tfact that\tour\tapplication\tis\ta\tscript\tthat\twill\tstart\tand\tfinish\twithout\tkeeping\tthe state\tin\tmemory.\n\nTip\n\nRemember\tthat\tJavaScript\tallocates\tvariables\tin\tthe\tglobal\tscope\tif the\tvar\tkeyword\tis\tnot\tused.\n\nThe\tproblem\tcomes\twhen\tsomeone\telse\treutilizes\tour\tcode\tin\ta\tdifferent part\tof\tthe\tapplication.\n\nLet's\tassume\tthat\tour\tsystem\tgrows\tto\ta\tpoint\tthat\twe\tneed\ta microservice\tto\tgreet\tnew\tcustomers\t(or\tdeliver\tthe\tinitial\tpayload\tof personal\tinformation\tsuch\tas\tname,\tpreferences,\tconfiguration,\tand\tso on).\tThe\tfollowing\tcode\tcould\tbe\ta\tgood\texample\ton\thow\tto\tbuild\tit:\n\nvar\tseneca\t=\trequire('seneca')();\n\nvar\tnames\t=\t[];\n\nseneca.add({cmd:\t'memory-leak'},\tfunction(args,\tdone){ \t\tnames.push(args.name); \t\tgreetings\t=\t\"Hello\t\"\t+\targs.name;",
      "content_length": 1262,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 263,
      "content": "done(null\t,{result:\tgreetings}); });\n\nseneca.listen(null,\t{port:\t8080});\n\nIn\tthis\texample,\tSeneca\twill\tbe\tlistening\tover\tHTTP\tfor\trequests\tfrom Seneca\tclients\tor\tother\ttypes\tof\tsystems\tsuch\tas\tcurl.\tWhen\twe\trun\tthe application:\n\nnode\tindex.js 2016-02-14T13:30:26.748Z\t szwj2mazorea/1455456626740/40489/-\tINFO\thello\t Seneca/1.1.0/szwj2mazorea/1455456626740/40489/- 2016-02-14T13:30:27.003Z\t szwj2mazorea/1455456626740/40489/-\tINFO\tlisten\t {port:8080}\n\nThen\tfrom\tanother\tterminal,\twe\tuse\tcurl\tto\tact\tas\ta\tclient\tof\tour microservice,\teverything\twill\twork\tsmoothly\tand\tour\tmemory\tleak\twill\tgo unnoticed:\n\ncurl\t-d\t'{\"cmd\":\t\"memory-leak\",\t\"name\":\"David\"}'\t http://127.0.0.1:8080/act {\"result\":\"Hello\tDavid\"}%\n\nHowever,\twe\tare\tgoing\tto\tuse\tKeymetrics\tto\tfind\tthe\tproblem.\tThe\tfirst thing\twe\tneed\tto\tdo\tis\trun\tour\tprogram\tusing\tPM2.\tIn\torder\tto\tdo\tit\tso, we\trun\tthe\tfollowing\tcommand:\n\npm2\tstart\tindex.js\n\nThis\tcommand\twill\tproduce\tthe\tfollowing\toutput:",
      "content_length": 945,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 264,
      "content": "Let's\texplain\tthe\toutput\tin\tthe\tfollowing:\n\nThe\tfirst\tline\tgives\tus\tinformation\tabout\tthe\tintegration\twith Keymetrics.\tData\tsuch\tas\tpublic\tkey,\tserver\tname,\tand\tthe\tURL\tto access\tKeymetrics. In\tthe\tfirst\ttable,\twe\tcan\tsee\tthe\tname\tof\tthe\tapplication\trunning,\tas well\tas\tfew\tstatistics\ton\tmemory,\tuptime,\tCPU,\tand\tso\ton. In\tthe\tsecond\ttable,\twe\tcan\tsee\tthe\tinformation\trelevant\tto\tthe\tpm2- server-monit\tPM2\tmodule.\n\nNow,\tlet's\tgo\tto\tKeymetrics\tand\tsee\twhat\thas\thappened:",
      "content_length": 469,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 265,
      "content": "The\tapplication\tis\tnow\tregistered\tin\tKeymetrics\tas\tit\tcan\tbe\tseen\tin\tthe\tcontrol\tpanel\n\nAs\tyou\tcan\tsee,\tnow\tour\tapplication\tis\tshowing\tup\tin\tKeymetrics.\n\nStraightaway,\twe\tcan\tsee\tthe\tvery\tuseful\tthings\tabout\tour\tapp.\tOne\tof these\tis\tthe\tmemory\tused.\tThis\tis\tthe\tmetric\tthat\twill\tindicate\ta\tmemory leak,\tas\tit\twill\tkeep\tgrowing.\n\nNow,\twe\tare\tgoing\tto\tforce\tthe\tmemory\tleak\tto\tcause\ta\tproblem\tin\tour application.\tIn\tthis\tcase,\tthe\tonly\tthing\tthat\twe\tneed\tto\tdo\tis\tstart\tour server\t(the\tsmall\tapplication\tthat\twe\twrote\tbefore)\tand\tissue\ta\tsignificant number\tof\trequests:\n\nfor\ti\tin\t{0..100000} do \t\tcurl\t-d\t'{\"cmd\":\t\"memory-leak\",\t\"name\":\"David\"}'\t http://127.0.0.1:8080/act done\n\nAs\tsimple\tas\tthe\tsmall\tbash\tscript,\tthis\tis\tall\tit\ttakes\tto\topen\tPandora's Box\tin\tour\tapplication:",
      "content_length": 775,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 266,
      "content": "The\tapplication\tis\tnow\tshowing\ta\thigh\tload\t(36%\tof\tCPU\tand\tan\tincreased\tuse\tof\tmemory\tup\tto 167\tMB)\n\nThe\tpreceding\timage\tshows\tthe\timpact\tof\trunning\tthe\tloop\tof\trequests\tin our\tsystem.\tLet's\texplain\tit\tin\tthe\tfollowing:\n\nThe\tCPU\tin\tour\tapplication\thas\tgone\tto\t11%\twith\tan\taverage\tloop delay\tof\t1.82\tmilliseconds.\tRegarding\tour\tsystem,\tthe\toverall\tCPU utilization\thas\tgone\tup\tto\t36.11%\tdue\tto\tthe\tfact\tthat\tboth\tthe application\tand\tbash\tscript\tuse\ta\tsignificant\tamount\tof\tresources. The\tmemory\tconsumption\thas\tsoared\tfrom\t81.9\tMB\tto\t167.6\tMB. As\tyou\tcan\tsee,\tthe\tline\ton\tthe\tgraph\tof\tmemory\tallocation\tis\tnot going\tstraight\tup,\tand\tthat\tis\tdue\tto\tgarbage\tcollections.\tA\tgarbage collection\tis\tan\tactivity\twithin\tthe\tNode.js\tframework\twhere unreferenced\tobjects\tare\tfreed\tfrom\tthe\tmemory,\tallowing\tour system\tto\treuse\tthe\thardware\tresources.",
      "content_length": 838,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 267,
      "content": "Regarding\tthe\terrors,\tour\tapplication\thas\tbeen\tstable\twith\t0\terrors (we'll\tcome\tback\tto\tthis\tsection\tlater).\n\nNow,\tonce\tour\tbash\tscript\tis\tfinished\t(I\tstopped\tit\tmanually,\tas\tit\tcan\ttake a\tsignificant\tamount\tof\tresources\tand\ttime\tto\tfinish),\twe\tcan\tagain\tsee what\thappened\tto\tour\tsystem\tin\tthe\tfollowing\tscreenshot:\n\nWe\tcan\tsee\tthat\tthe\tCPU\thas\tgone\tback\tto\tnormal,\tbut\twhat\tabout\tthe memory?\tThe\tmemory\tconsumed\tby\tour\tapplication\thasn't\tbeen\tfreed due\tto\tthe\tfact\tthat\tour\tprogram\thas\ta\tmemory\tleak,\tand\tas\tlong\tas\tour variable\tis\treferencing\tthe\tmemory\tconsumed\t(remember\tthe\tnames\tarray is\taccumulating\tmore\tand\tmore\tnames),\tit\twon't\tbe\tfreed.\n\nIn\tthis\tcase,\twe\thave\ta\tvery\tsimple\texample\tthat\tclearly\tshows\twhere\tthe memory\tleak\tis,\tbut\tin\tcomplex\tapplications,\tit\tis\tnot\talways\tobvious.\tThis",
      "content_length": 797,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 268,
      "content": "error,\tin\tparticular,\tcould\tnever\tshow\tup\tas\ta\tproblem\tdue\tto\tthe\tfact\tthat we\tprobably\tdeploy\tnew\tversions\tof\tour\tapp\toften\tenough\tto\tnot\trealize it.\n\nMonitoring\tapplication\texceptions\n\nApplication\terrors\tare\tevents\tthat\toccur\twhen\tour\tapplication\tcan't\thandle an\tunexpected\tsituation.\tThings\tsuch\tas\tdividing\ta\tnumber\tby\tzero\tor trying\tto\taccess\tan\tundefined\tproperty\tof\tour\tapplication\tusually\tleads\tto these\ttype\tof\tproblems.\n\nWhen\tworking\ton\ta\tmultithreaded\tframework\t(language)\tsuch\tas\tTomcat, the\tfact\tthat\tone\tof\tour\tthreads\tdies\tdue\tto\tan\texception\tusually\tonly affects\tto\tone\tcustomer\t(the\tone\tholding\tthe\tthread).\tHowever,\tin Node.js,\ta\tbubbled\texception\tcould\tbe\ta\tsignificant\tproblem\tas\tour application\tdies.\n\nPM2\tand\tSeneca\tdo\ta\tvery\tgood\tjob\tat\tkeeping\tit\talive\tas\tPM2\twill restart\tour\tapp\tif\tsomething\tmakes\tit\tstop,\tand\tSeneca\twon't\tlet\tthe application\tdie\tif\tan\texception\toccurs\tin\tone\tof\tthe\tactions.\n\nKeymetrics\thas\tdeveloped\ta\tmodule\tcalled\tpmx\tthat\twe\tcan\tuse\tto programmatically\tget\talerts\ton\terrors:\n\nvar\tseneca\t=\trequire('seneca')();\n\nvar\tpmx\t=\trequire('pmx');\n\nvar\tnames\t=\t[];\n\nseneca.add({cmd:\t'exception'},\tfunction(args,\tdone){ \t\tpmx.notify(new\tError(\"Unexpected\tException!\"));\n\ndone(null\t,{result:\t100/args.number});\t });\n\nseneca.listen({port:\t8085});\n\nIt\tis\teasy\tand\tself-descriptive:\tan\taction\tthat\tsends\tan\texception\tto Keymetrics\tif\tthe\tnumber\tsent\tas\ta\tparameter\tis\tzero.\tIf\twe\trun\tit,\twe\twill get\tthe\tfollowing\toutput:",
      "content_length": 1454,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 269,
      "content": "Now\twe\tneed\tto\thit\tthe\tserver\tin\torder\tto\tcause\tthe\terror.\tAs\twe\tdid earlier,\twe\twill\tdo\tthis\tusing\tcurl:\n\ncurl\t-d\t'{\"cmd\":\t\"exception\",\t\"number\":\t\"0\"}'\t http://localhost:8085/act {\"result\":null}%\n\nNow,\twhen\twe\tgo\tto\tKeymetrics,\twe\tcan\tsee\tthat\tthere\tis\tan\terror logged,\tas\tshown\tin\tthe\tfollowing\timage:\n\nAnother\tinteresting\tpoint\tof\tKeymetrics\tis\tthe\tconfiguration\tof\talerts.\tAs PM2\tsends\tdata\tabout\tpretty\tmuch\tevery\tmetric\tin\tour\tsystem,\twe\thave the\tability\tto\tconfigure\tKeymetrics\ton\tthe\tthresholds\tthat\twe\tconsider healthy\tfor\tour\tapplication.\n\nThis\tis\tvery\thandy\tas\twe\tcould\tget\tthe\tnotifications\tintegrated\tin\tour corporate\tchat\t(something\tsimilar\tto\tSlack)\tand\tbe\talerted\treal\ttime",
      "content_length": 689,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 270,
      "content": "when\tsomething\tis\tnot\tgoing\tcorrectly\tin\tour\tapplication.\n\nCustom\tmetrics\n\nKeymetrics\talso\tallows\tus\tto\tuse\tprobes.\tA\tprobe\tis\ta\tcustom\tmetric\tthat is\tsent\tprogrammatically\tby\tthe\tapplication\tto\tKeymetrics.\n\nThere\tare\tdifferent\ttypes\tof\tvalues\tthat\tthe\tnative\tlibrary\tfrom\tKeymetrics allows\tus\tto\tpush\tdirectly.\tWe\tare\tgoing\tto\tsee\tthe\tmost\tuseful\tones.\n\nSimple\tmetric\n\nA\tsimple\tmetric\tis,\tas\tits\tname\tindicates,\ta\tvery\tbasic\tmetric\twhere\tthe developer\tcan\tset\tthe\tvalue\tto\tthe\tdata\tsent\tto\tKeymetrics:\n\nvar\tseneca\t=\trequire('seneca')(); var\tpmx\t=\trequire(\"pmx\").init({ \t\thttp:\ttrue, \t\terrors:\ttrue, \t\tcustom_probes:\ttrue, \t\tnetwork:\ttrue, \t\tports:\ttrue }); var\tnames\t=\t[]; var\tprobe\t=\tpmx.probe();\n\nvar\tmeter\t=\tprobe.metric({ \t\tname\t\t\t\t\t\t:\t'Last\tcall' });\n\nseneca.add({cmd:\t'last-call'},\tfunction(args,\tdone){ \t\tconsole.log(meter); \t\tmeter.set(new\tDate().toISOString()); \t\tdone(null,\t{result:\t\"done!\"}); });\n\nseneca.listen({port:\t8085});\n\nIn\tthis\tcase,\tthe\tmetric\twill\tsend\tthe\ttime\twhen\tthe\taction\twas\tcalled\tfor the\tlast\ttime\tto\tthe\tKeymetrics:",
      "content_length": 1047,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 271,
      "content": "The\tconfiguration\tfor\tthis\tmetric\tis\tnon-existent:\n\nvar\tprobe\t=\tpmx.probe();\n\nvar\tmeter\t=\tprobe.metric({ \t\tname\t\t\t\t\t\t:\t'Last\tcall' });\n\nThere\tis\tno\tcomplexity\tin\tthis\tmetric.\n\nCounter\n\nThis\tmetric\tis\tvery\tuseful\tto\tcount\thow\tmany\ttimes\tan\tevent\toccurred:\n\nvar\tseneca\t=\trequire('seneca')(); var\tpmx\t=\trequire(\"pmx\").init({ \t\thttp:\ttrue, \t\terrors:\ttrue, \t\tcustom_probes:\ttrue, \t\tnetwork:\ttrue, \t\tports:\ttrue }); var\tnames\t=\t[]; var\tprobe\t=\tpmx.probe();\n\nvar\tcounter\t=\tprobe.counter({ \t\tname\t:\t'Number\tof\tcalls' });\n\nseneca.add({cmd:\t'counter'},\tfunction(args,\tdone){ \t\tcounter.inc(); \t\tdone(null,\t{result:\t\"done!\"}); });\n\nseneca.listen({port:\t8085});",
      "content_length": 648,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 272,
      "content": "In\tthe\tpreceding\tcode,\twe\tcan\tsee\thow\tthe\tcounter\tis\tincremented\tfor every\tsingle\tcall\tto\tthe\taction\tcounter.\n\nThis\tmetric\twill\talso\tallow\tus\tto\tdecrement\tthe\tvalue\tcalling\tthe\tdec() method\ton\tthe\tcounter:\n\ncounter.dec();\n\nAverage\tcalculated\tvalues\n\nThis\tmetric\tallows\tus\tto\trecord\twhen\tan\tevent\toccurs,\tand\tit\twill automatically\tcalculate\tthe\tnumber\tof\tevents\tper\ttime\tunit.\tIt\tis\tquite useful\tto\tcalculate\taverages\tand\tis\ta\tgood\ttool\tto\tmeasure\tthe\tload\tin\tthe system.\tLet's\tsee\ta\tsimple\texample,\tas\tfollows:\n\nvar\tseneca\t=\trequire('seneca')(); var\tpmx\t=\trequire(\"pmx\").init({ \t\thttp:\ttrue, \t\terrors:\ttrue, \t\tcustom_probes:\ttrue, \t\tnetwork:\ttrue, \t\tports:\ttrue }); var\tnames\t=\t[]; var\tprobe\t=\tpmx.probe();\n\nvar\tmeter\t=\tprobe.meter({ \t\tname\t\t\t\t\t\t:\t'Calls\tper\tminute', \t\tsamples\t\t\t:\t60, \t\ttimeframe\t:\t3600 });\n\nseneca.add({cmd:\t'calls-minute'},\tfunction(args,\tdone) { \t\tmeter.mark(); \t\tdone(null,\t{result:\t\"done!\"}); });\n\nseneca.listen({port:\t8085});\n\nThe\tpreceding\tcode\tcreates\ta\tprobe\tand\tsends\ta\tnew\tmetric\tcalled\tCalls per\tminute\tto\tKeymetrics.\n\nNow,\tif\twe\trun\tthe\tapplication\tand\tthe\tfollowing\tcommand\ta\tfew\ttimes,",
      "content_length": 1118,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 273,
      "content": "the\tmetric\tis\tshown\tin\tthe\tfollowing\tKeymetrics\tinterface:\n\ncurl\t-d\t'{\"cmd\":\t\"calls-minute\"}'\t http://localhost:8085/act\n\nAs\tyou\tcan\tsee,\tthere\tis\ta\tnew\tmetric\tcalled\tCalls\tper\tminute\tin\tthe\tUI. The\tkey\tto\tconfigure\tthis\tmetric\tis\tin\tthe\tfollowing\tinitialization:\n\nvar\tmeter\t=\tprobe.meter({ \t\tname\t\t\t\t\t\t:\t'Calls\tper\tminute', \t\tsamples\t\t\t:\t60, \t\ttimeframe\t:\t3600 });\n\nAs\tyou\tcan\tsee,\tthe\tname\tof\tthe\tmetric\tis\tin\tthe\tconfiguration\tdictionary as\twell\tas\tin\ttwo\tparameters:\tsamples\tand\ttimeframe.\n\nThe\tsamples\tparameter\tcorrespond\tto\tthe\tinterval\twhere\twe\twant\tto\trate the\tmetric;\tin\tthis\tcase,\tit\tis\tthe\tnumber\tof\tcalls\tper\tminute\tso\tthat\trate\tis 60\tseconds.\n\nThe\ttimeframe\tparameter,\ton\tthe\tother\thand,\tis\tfor\thow\tlong\twe\twant Keymetrics\tto\thold\tthe\tdata\tfor,\tor\tto\texpress\tin\tsimpler\twords,\tit\tis\tthe timeframe\tover\twhich\tthe\tmetric\twill\tbe\tanalyzed.",
      "content_length": 850,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 274,
      "content": "Simian\tArmy\t–\tthe\tactive monitoring\tfrom\tSpotify\n\nSpotify\tis\tone\tof\tthe\tcompanies\tof\treference\twhen\tbuilding microservices-oriented\tapplications.\tThey\tare\textremely\tcreative\tand talented\twhen\tit\tboils\tdown\tto\tcoming\tup\twith\tnew\tideas.\n\nOne\tof\tmy\tfavourite\tideas\tamong\tthem\tis\twhat\tthey\tcall\tthe\tSimian Army.\tI\tlike\tto\tcall\tit\tactive\tmonitoring.\n\nIn\tthis\tbook,\tI\thave\ttalked\ta\tlot\ttimes\tabout\thow\thumans\tfail\tat performing\tdifferent\ttasks.\tNo\tmatter\thow\tmuch\teffort\tyou\tput\tin\tto creating\tyour\tsoftware,\tthere\tare\tgoing\tto\tbe\tbugs\tthat\twill\tcompromise the\tstability\tof\tthe\tsystem.\n\nThis\tis\ta\tbig\tproblem,\tbut\tit\tbecomes\ta\thuge\tdeal\twhen,\twith\tthe\tmodern cloud\tproviders,\tyour\tinfrastructure\tis\tautomated\twith\ta\tscript.\n\nThink\tabout\tit,\twhat\thappens\tif\tin\ta\tpool\tof\tthousand\tservers,\tthree\tof them\thave\tthe\ttime\tzone\tout\tof\tsync\twith\tthe\trest\tof\tthe\tservers?\tWell, depending\ton\tthe\tnature\tof\tyour\tsystem,\tit\tcould\tbe\tfine\tor\tit\tcould\tbe\ta big\tdeal.\tCan\tyou\timagine\tyour\tbank\tgiving\tyou\ta\tstatement\twith disordered\ttransactions?\n\nSpotify\thas\tsolved\t(or\tmitigated)\tthe\tpreceding\tproblem\tby\tcreating\ta number\tof\tsoftware\tagents\t(a\tprogram\tthat\tmoves\twithin\tthe\tdifferent machines\tof\tour\tsystem),\tnaming\tthem\tafter\tdifferent\tspecies\tof\tmonkeys with\tdifferent\tpurposes\tto\tensure\tthe\trobustness\tof\ttheir\tinfrastructure. Let's\texplain\tit\ta\tbit\tfurther.\n\nAs\tyou\tare\tprobably\taware,\tif\tyou\thave\tworked\tbefore\twith\tAmazon\tWeb Services,\tthe\tmachines\tand\tcomputational\telements\tare\tdivided\tin\tto regions\t(EU,\tAustralia,\tUSA,\tand\tso\ton)\tand\tinside\tevery\tregion,\tthere are\tavailability\tzones,\tas\tshown\tin\tthe\tfollowing\tdiagram:",
      "content_length": 1611,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 275,
      "content": "This\tenables\tus,\tthe\tengineers,\tto\tcreate\tsoftware\tand\tinfrastructure without\thitting\twhat\twe\tcall\ta\tsingle\tpoint\tof\tfailure.\n\nNote\n\nA\tsingle\tpoint\tof\tfailure\tis\ta\tcondition\tin\ta\tsystem\twhere\tthe\tfailure of\ta\tsingle\telement\twill\tcause\tthe\tsystem\tto\tmisbehave.",
      "content_length": 259,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 276,
      "content": "This\tconfiguration\traised\ta\tnumber\tof\tquestions\tto\tthe\tengineers\tin Spotify,\tas\tfollows:\n\nWhat\thappens\tif\twe\tblindly\ttrust\tour\tdesign\twithout\ttesting\twhether we\tactually\thave\tany\tpoint\tof\tfailures\tor\tnot? What\thappens\tif\ta\tfull\tavailability\tzone\tor\tregion\tgoes\tdown? How\tis\tour\tapplication\tgoing\tto\tbehave\tif\tthere\tis\tan\tabnormal latency\tfor\tsome\treason?\n\nTo\tanswer\tall\tthese\tquestions,\tNetflix\thas\tcreated\tvarious\tagents.\tAn agent\tis\ta\tsoftware\tthat\truns\ton\ta\tsystem\t(in\tthis\tcase,\tour\tmicroservices system)\tand\tcarries\ton\tdifferent\toperations\tsuch\tas\tchecking\tthe hardware,\tmeasuring\tthe\tnetwork\tlatency,\tand\tso\ton.\tThe\tidea\tof\tagent\tis not\tnew,\tbut\tuntil\tnow,\tits\tapplication\twas\tnearly\ta\tfuturistic\tsubject.\tLet's take\ta\tlook\tat\tthe\tfollowing\tagents\tcreated\tby\tNetflix:\n\nChaos\tMonkey:\tThis\tagent\tdisconnects\thealthy\tmachines\tfrom\tthe network\tin\ta\tgiven\tavailability\tzone.\tThis\tensures\tthat\tthere\tare\tno single\tpoints\tof\tfailures\twithin\tan\tavailability\tzone.\tSo\tthat\tif\tour application\tis\tbalanced\tacross\tfour\tnodes,\twhen\tthe\tChaos\tMonkey kicks\tin,\tit\twill\tdisconnect\tone\tof\tthese\tfour\tmachines. Chaos\tGorilla:\tThis\tis\tsimilar\tto\tChaos\tMonkey,\tChaos\tGorilla\twill disconnect\ta\tfull\tavailability\tzone\tin\torder\tto\tverify\tthat\tNetflix services\trebalance\tto\tthe\tother\tavailable\tzones.\tIn\tother\twords, Chaos\tGorilla\tis\tthe\tbig\tbrother\tof\tChaos\tMonkey;\tinstead\tof operating\tat\tthe\tserver\tlevel,\tit\toperates\tat\tthe\tpartition\tlevel. Latency\tMonkey:\tThis\tagent\tis\tresponsible\tfor\tintroducing\tartificial latencies\tin\tthe\tconnections.\tLatency\tis\tusually\tsomething\tthat\tis hardly\tconsidered\twhen\tdeveloping\ta\tsystem,\tbut\tit\tis\ta\tvery\tdelicate subject\twhen\tbuilding\ta\tmicroservices\tarchitecture:\tlatency\tin\tone node\tcould\tcompromise\tthe\tquality\tof\tthe\tfull\tsystem.\tWhen\ta service\tis\trunning\tout\tof\tresources,\tusually\tthe\tfirst\tindication\tis\tthe latency\tin\tthe\tresponses;\ttherefore,\tLatency\tMonkey\tis\ta\tgood\tway to\tfind\tout\thow\tour\tsystem\twill\tbehave\tunder\tpressure. Doctor\tMonkey:\tA\thealth\tcheck\tis\tan\tendpoint\tin\tour\tapplication that\treturns\tan\tHTTP\t200\tif\teverything\tis\tcorrect\tand\t500\terror\tcode if\tthere\tis\ta\tproblem\twithin\tthe\tapplication.\tDoctor\tMonkey\tis\tan agent\tthat\twill\trandomly\texecute\tthe\thealth\tcheck\tof\tnodes\tin\tour application\tand\treport\tthe\tfaulty\tones\tin\torder\tto\treplace\tthem.",
      "content_length": 2284,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 277,
      "content": "10-18\tMonkey:\tOrganizations\tsuch\tas\tNetflix\tare\tglobal,\tso\tthey need\tto\tbe\tlanguage-aware\t(certainly,\tyou\tdon't\twant\tto\tget\ta website\tin\tGerman\twhen\tyour\tmother\ttongue\tis\tSpanish).\tThe\t10-18 Monkey\treports\ton\tinstances\tthat\tare\tmisconfigured.\n\nThere\tare\ta\tfew\tother\tagents,\tbut\tI\tjust\twant\tto\texplain\tactive\tmonitoring to\tyou.\tOf\tcourse,\tthis\ttype\tof\tmonitoring\tis\tout\tof\treach\tof\tsmall organizations,\tbut\tit\tis\tgood\tto\tknow\tabout\ttheir\texistence\tso\tthat\twe\tcan get\tinspired\tto\tset\tup\tour\tmonitoring\tprocedures.\n\nNote\n\nThe\tcode\tis\tavailable\tunder\tApache\tLicense\tin\tthe\tfollowing repository:\n\nhttps://github.com/Netflix/SimianArmy.\n\nIn\tgeneral,\tthis\tactive\tmonitoring\tfollows\tthe\tphilosophy\tof\tfail\tearly,\tof which,\tI\tam\ta\tbig\tadept.\tNo\tmatter\thow\tbig\tthe\tflaw\tin\tyour\tsystem\tis\tor how\tcritical\tit\tis,\tyou\twant\tto\tfind\tit\tsooner\tthan\tlater,\tand\tideally,\twithout impacting\tany\tcustomer.\n\nThroughput\tand\tperformance degradation\n\nThroughput\tis\tto\tour\tapplication\twhat\tthe\tmonthly\tproduction\tis\tto\ta factory.\tIt\tis\ta\tunit\tof\tmeasurement\tthat\tgives\tus\tan\tindication\tabout\thow our\tapplication\tis\tperforming\tand\tanswers\tthe\thow\tmany\tquestion\tof\ta system.\n\nVery\tclose\tto\tthroughput,\tthere\tis\tanother\tunit\tthat\twe\tcan\tmeasure: latency.\n\nLatency\tis\tthe\tperformance\tunit\tthat\tanswers\tthe\tquestion\tof\thow\tlong.\n\nLet's\tconsider\tthe\tfollowing\texample:",
      "content_length": 1336,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 278,
      "content": "Our\tapplication\tis\ta\tmicroservices-based\tarchitecture\tthat\tis\tresponsible for\tcalculating\tcredit\tratings\tof\tapplicants\tto\twithdraw\ta\tmortgage.\tAs\twe have\ta\tlarge\tvolume\tof\tcustomers\t(a\tnice\tproblem\tto\thave),\twe\thave decided\tto\tprocess\tthe\tapplications\tin\tbatches.\tLet's\tdraw\ta\tsmall algorithm\taround\tit:\n\nvar\tseneca\t=\trequire('seneca')(); var\tsenecaPendingApplications\t=\t require('seneca').client({type:\t'tcp',\t \t\tport:\t8002,\t \t\thost:\t\"192.168.1.2\"}); \t\tvar\tsenecaCreditRatingCalculator\t=\t require('seneca').client({type:\t'tcp',\t \t\tport:\t8002,\t \t\thost:\t\"192.168.1.3\"});\n\nseneca.add({cmd:\t'mortgages',\taction:\t'calculate'},\t function(args,\tcallback)\t{ \t\tsenecaPendingApplications.act({ \t\t\t\tcmd:\t'applications',\t \t\t\t\tsection:\t'mortgages',\t \t\t\t\tcustmers:\targs.customers},\tfunction(err,\t responseApplications)\t{ \t\t\t\t\t\tsenecaCreditRatingCalculator.act({cmd:\t'rating',\t customers:\targs.customers},\tfunction(err,\tresponse)\t{\n\nprocessApplications(response.ratings,\t \t\t\t\t\t\t\t\tresponseApplications.applications, \t\t\t\t\t\t\t\targs.customers \t\t\t\t\t\t); \t\t\t\t}); \t\t}); });\n\nThis\tis\ta\tsmall\tand\tsimple\tSeneca\tapplication\t(this\tis\tonly\ttheoretical, don't\ttry\tto\trun\tit\tas\tthere\tis\ta\tlot\tof\tcode\tmissing!)\tthat\tacts\tas\ta\tclient\tfor two\tother\tmicroservices,\tas\tfollows:\n\nThe\tfirst\tone\tgets\tthe\tlist\tof\tpending\tapplications\tfor\tmortgages The\tsecond\tone\tgets\tthe\tlist\tof\tcredit\trating\tfor\tthe\tcustomers\tthat we\thave\trequested\n\nThis\tcould\tbe\ta\treal\tsituation\tfor\tprocessing\tmortgage\tapplications.\tIn\tall fairness,\tI\tworked\ton\ta\tvery\tsimilar\tsystem\tin\tthe\tpast,\tand\teven\tthough\tit",
      "content_length": 1550,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 279,
      "content": "was\ta\tlot\tmore\tcomplex,\tthe\tworkflow\twas\tvery\tsimilar.\n\nLet's\ttalk\tabout\tthroughput\tand\tlatency.\tImagine\tthat\twe\thave\ta\tfairly\tbig batch\tof\tmortgages\tto\tprocess\tand\tthe\tsystem\tis\tmisbehaving:\tthe network\tis\tnot\tbeing\tas\tfast\tas\tit\tshould\tand\tis\texperiencing\tsome dropouts.\n\nSome\tof\tthese\tapplications\twill\tbe\tlost\tand\twill\tneed\tto\tbe\tretried.\tIn\tideal conditions,\tour\tsystem\tis\tproducing\ta\tthroughput\tof\t500\tapplications\tper hour\tand\ttakes\tan\taverage\tof\t7.2\tseconds\ton\tlatency\tto\tprocess\tevery single\tapplication.\tHowever,\ttoday,\tas\twe\tstated\tbefore,\tthe\tsystem\tis\tnot at\tits\tbest;\twe\tare\tprocessing\tonly\t270\tapplications\tper\thour\tand\ttakes on\taverage\t13.3\tseconds\tto\tprocess\ta\tsingle\tmortgage\tapplication.\n\nAs\tyou\tcan\tsee,\twith\tlatency\tand\tthroughput,\twe\tcan\tmeasure\thow\tour business\ttransactions\tare\tbehaving\twith\trespect\tto\tthe\tprevious experiences;\twe\tare\toperating\tat\t54%\tof\tour\tnormal\tcapacity.\n\nThis\tcould\tbe\ta\tserious\tissue.\tIn\tall\tfairness,\ta\tdrop\toff\tlike\tthis\tshould ring\tall\tthe\talarms\tin\tour\tsystems\tas\tsomething\treally\tserious\tis\tgoing\ton in\tour\tinfrastructure;\thowever,\tif\twe\thave\tbeen\tsmart\tenough\twhile building\tour\tsystem,\tthe\tperformance\twill\tbe\tdegraded,\tbut\tour\tsystem won't\tstop\tworking.\tThis\tcan\tbe\teasily\tachieved\tby\tthe\tusage\tof\tcircuit breakers\tand\tqueueing\ttechnologies\tsuch\tas\tRabbitMQ.\n\nQueueing\tis\tone\tof\tthe\tbest\texamples\tto\tshow\thow\tto\tapply\thuman behavior\tto\tan\tIT\tsystem.\tSeriously,\tthe\tfact\tthat\twe\tcan\teasily\tdecouple our\tsoftware\tcomponents\thaving\ta\tsimple\tmessage\tas\ta\tjoint\tpoint, which\tour\tservices\teither\tproduce\tor\tconsume,\tgives\tus\ta\tbig\tadvantage when\twriting\tcomplex\tsoftware.\n\nOther\tadvantage\tof\tqueuing\tover\tHTTP\tis\tthat\tan\tHTTP\tmessage\tis\tlost if\tthere\tis\ta\tnetwork\tdrop\tout.\n\nWe\tneed\tto\tbuild\tour\tapplication\taround\tthe\tfact\tthat\tit\tis\teither\tfull success\tor\terror.\tWith\tqueueing\ttechnologies\tsuch\tas\tRabbitMQ,\tour messaging\tdelivery\tis\tasynchronous\tso\tthat\twe\tdon't\tneed\tto\tworry\tabout intermittent\tfailures:\tas\tsoon\tas\twe\tcan\tdeliver\tthe\tmessage\tto\tthe appropriate\tqueue,\tit\twill\tget\tpersisted\tuntil\tthe\tclient\tis\table\tto\tconsume it\t(or\tthe\tmessage\ttimeout\toccurs).",
      "content_length": 2116,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 280,
      "content": "This\tenables\tus\tto\taccount\tfor\tintermittent\terrors\tin\tthe\tinfrastructure\tand build\teven\tmore\trobust\tapplications\tbased\ton\tthe\tcommunication\taround queues.\n\nAgain,\tSeneca\tmakes\tour\tlife\tvery\teasy:\tthe\tplugin\tsystem\ton\twhich\tthe Seneca\tframework\tis\tbuilt\tmakes\twriting\ta\ttransport\tplugin\ta\tfairly\tsimple task.\n\nNote\n\nRabbitMQ\ttransport\tplugin\tcan\tbe\tfound\tin\tthe\tfollowing\tGitHub repository:\n\nhttps://github.com/senecajs/seneca-rabbitmq-transport\n\nThere\tare\tquite\tfew\ttransport\tplugins\tand\twe\tcan\talso\tcreate\tour\town ones\t(or\tmodify\tthe\texisting\tones!)\tto\tsatisfy\tour\tneeds.\n\nIf\tyou\ttake\ta\tquick\tlook\tat\tthe\tRabbitMQ\tplugin\t(just\tas\tan\texample),\tthe only\tthing\tthat\twe\tneed\tto\tdo\tto\twrite\ta\ttransport\tplugin\tis\toverriding\tthe following\ttwo\tSeneca\tactions:\n\nseneca.add({role:\t'transport',\thook:\t'listen',\ttype: 'rabbitmq'},\t...) seneca.add({role:\t'transport',\thook:\t'client',\ttype: 'rabbitmq'},\t...)\n\nUsing\tqueueing\ttechnologies,\tour\tsystem\twill\tbe\tmore\tresilient\tagainst intermittent\tfailures\tand\twe\twould\tbe\table\tto\tdegrade\tthe\tperformance instead\tof\theading\tinto\ta\tcatastrophic\tfailure\tdue\tto\tmissing\tmessages.",
      "content_length": 1110,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 281,
      "content": "Summary\n\nIn\tthis\tchapter,\twe\tdeep\tdived\tinto\tPM2\tmonitoring\tthrough\tKeymetrics. We\tlearned\thow\tto\tput\ttight\tmonitoring\tin\tplace\tso\tthat\twe\tare\tquickly informed\tabout\tthe\tfailures\tin\tour\tapplication.\n\nIn\tthe\tsoftware\tdevelopment\tlife\tcycle,\tthe\tQA\tphase\tis,\tin\tmy\topinion, one\tof\tthe\tmost\timportant\tone:\tno\tmatter\thow\tgood\tyour\tcode\tlooks,\tif\tit does\tnot\twork,\tit\tis\tuseless.\tHowever,\tif\tI\thave\tto\tchoose\tanother\tphase where\tengineers\tshould\tput\tmore\temphasis,\tit\twould\tbe\tthe\tdeployment, and\tmore\tspecifically,\tthe\tmonitoring\tthat\tis\tcarried\tout\tafter\tevery deployment.\tIf\tyou\treceive\terror\treports\timmediately,\tchances\tare\tthat the\treaction\tcan\tbe\tquick\tenough\tto\tavoid\tbigger\tproblems\tsuch\tas corrupted\tdata\tor\tcustomers\tcomplaining.\n\nWe\talso\tsaw\tan\texample\tof\tactive\tmonitoring\tcarried\tout\tby\tNetflix\ton their\tsystems,\twhich\teven\tthough\tmight\tbe\tout\tof\tthe\treach\tof\tyour company,\tit\tcan\tspark\tgood\tideas\tand\tpractices\tin\torder\tto\tmonitor\tyour software.\n\nKeymetrics\tis\tjust\tan\texample\tthat\tfits\tthe\tbill\tfor\tNode.js\tas\tit\tis extremely\twell\tintegrated\twith\tPM2,\tbut\tthere\tare\talso\tother\tgood monitoring\tsystems\tsuch\tas\tAppDynamics,\tor\tif\tyou\twant\tto\tgo\tfor\tan\tin- house\tsoftware,\tyou\tcould\tuse\tNagios.\tThe\tkey\tis\tbeing\tclear\tabout\twhat you\tneed\tto\tmonitor\tin\tthe\tapplication,\tand\tthen,\tfind\tthe\tbest\tprovider.\n\nAnother\ttwo\tgood\toptions\tfor\tmonitoring\tNode.js\tapps\tare\tStrongLoop and\tNew\tRelic.\tThey\tare\tboth\ton\tthe\tsame\tline\twith\tKeymetrics,\tbut\tthey work\tbetter\tfor\tlarge-scale\tsystems,\tespecially\tStrongLoop,\twhich\tis oriented\tto\tapplications\twritten\tin\tNode.js\tand\toriented\tto\tmicroservices.",
      "content_length": 1595,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 282,
      "content": "Chapter\t8.\tDeploying Microservices\n\nIn\tthis\tchapter,\twe\tare\tgoing\tto\tdeploy\tmicroservices.\tWe\twill\tuse different\ttechnologies\tin\torder\tto\tprovide\tthe\treader\twith\tthe\tknowledge required\tto\tchoose\tthe\tright\ttool\tfor\tevery\tjob.\tFirst,\twe\twill\tuse\tPM2\tand its\tdeployment\tcapabilities\tto\trun\tapplications\tin\tremote\tservers.\tThen, we\twill\tplay\taround\tDocker,\twhich\tis\tone\tof\tthe\tmost\tadvanced deployment\tplatforms,\tand\tthe\tentire\tecosystem\taround\tcontainers.\tIn this\tchapter,\twe\twill\tshow\thow\tto\tautomate\tall\tthe\tdeployments\tas\thighly as\tpossible.\n\nConcepts\tin\tsoftware\tdeployment\n\nDeployments\tare\tusually\tthe\tugly\tfriend\tof\tthe\tSoftware\tDevelopment Life\tCycle\t(SDLC)\tparty.\tThere\tis\ta\tmissing\tcontact\tpoint\tbetween development\tand\tsystems\tadministration\tthat\tDevOps\tis\tgoing\tto\tsolve\tin the\tnext\tfew\tyears.\tThe\tcost\tof\tfixing\tbugs\tat\tdifferent\tstages\tof\tSDLC\tis shown\tin\tthe\tfollowing\tfigure:\n\nThis\tdiagram\tshows\tthe\tcost\tof\tfixing\ta\tbug,\tdepending\ton\tthe\tstage\tof\tthe\tSDLC\n\nFail\tearly\tis\tone\tof\tmy\tfavorite\tconcepts\tin\tthe\tlean\tmethodology.\tIn\tthe",
      "content_length": 1043,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 283,
      "content": "change\tmanagement\tworld,\tthe\tcost\tof\tfixing\ta\tbug\tin\tthe\tdifferent\tstages of\tthe\tsoftware\tlife\tcycle\tis\tcalled\tthe\tcost\tof\tchange\tcurve.\n\nRoughly,\tfixing\ta\tbug\tin\tproduction\tis\testimated\tto\tcost\t150\ttimes\tthe resources\tas\tcompared\tto\tthe\tcosts\tto\tfix\tit\twhen\ttaking\trequirements.\n\nNo\tmatter\twhat\tthe\tfigure\tis,\twhich\tdepends\ta\tlot\ton\tthe\tmethodology and\ttechnology\tthat\twe\tuse,\tthe\tlesson\tlearned\tis\tthat\twe\tcan\tsave\ta\tlot of\ttime\tby\tcatching\tbugs\tearly.\n\nFrom\tthe\tcontinuous\tintegration\tup\tto\tcontinuous\tdelivery,\tthe\tprocess should\tbe\tautomated\tas\tmuch\tas\tpossible,\twhere\tas\tmuch\tas\tpossible means\t100%.\tRemember,\thumans\tare\timperfect\tand\tmore\tprone\tto errors\twhile\tcarrying\tout\tmanual\trepetitive\ttasks.\n\nContinuous\tintegration\n\nContinuous\tintegration\t(CI)\tis\tthe\tpractice\tof\tintegrating\tthe\twork\tfrom different\tbranches\ton\tdaily\tbasis\t(or\tmore\tthan\tonce\ta\tday)\tand validating\tthat\tthe\tchanges\tdo\tnot\tbreak\texisting\tfeatures\tby\trunning integration\tand\tunit\ttests.\n\nCI\tshould\tbe\tautomated\tusing\tthe\tsame\tinfrastructure\tconfiguration\tas we\twill\tbe\tusing\tlater\tin\tpre-production\tand\tproduction,\tso\tif\tthere\tis\tany flaw,\tit\tcan\tbe\tcaught\tearly.\n\nContinuous\tdelivery\n\nContinuous\tdelivery\t(CD)\tis\ta\tsoftware\tengineering\tapproach\tthat\taims to\tbuild\tsmall,\ttestable,\tand\teasily\tdeployable\tpieces\tof\tfunctionality\tthat can\tbe\tdelivered\tseamlessly\tat\tany\ttime.\n\nThis\tis\twhat\twe\tare\taiming\tfor\twith\tthe\tmicroservices.\tAgain,\twe\tshould be\tpushing\tto\tautomate\tthe\tdelivery\tprocess\tas,\tif\twe\tare\tdoing\tit manually,\twe\tare\tonly\tlooking\tfor\tproblems.\n\nWhen\ttalking\tfrom\tthe\tmicroservices'\tperspective,\tautomation\ton deployments\tis\tthe\tkey.\tWe\tneed\tto\ttackle\tthe\toverhead\tof\thaving\ta\tfew",
      "content_length": 1672,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 284,
      "content": "dozen\tof\tservices\tinstead\tof\ta\tfew\tmachines,\tor\twe\tcan\tfind\tourselves maintaining\ta\tcloud\tof\tservices\tinstead\tof\tadding\tvalue\tto\tour\tcompany.\n\nDocker\tis\tour\tbest\tally\there.\tWith\tDocker,\twe\tare\treducing\tthe\thassle\tof deploying\ta\tnew\tsoftware\tto\tpretty\tmuch\tmoving\ta\tfile\t(a\tcontainer) around\tin\tdifferent\tenvironments,\tas\twe\twill\tsee\tlater\tin\tthis\tchapter.",
      "content_length": 355,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 285,
      "content": "Deployments\twith\tPM2\n\nPM2\tis\tan\textremely\tpowerful\ttool.\tNo\tmatter\twhat\tstage\tof\tdevelopment we\tare\tin,\tPM2\talways\thas\tsomething\tto\toffer.\n\nIn\tthis\tphase\tof\tsoftware\tdevelopment,\tthe\tdeployment\tis\twhere\tPM2 really\tshines.\tThrough\ta\tJSON\tconfiguration\tfile,\tPM2\twill\tmanage\ta cluster\tof\tapplications\tso\tthat\twe\tcan\teasily\tdeploy,\tredeploy,\tand manage\tapplications\ton\tremote\tservers.\n\nPM2\t–\tecosystems\n\nPM2\tcalls\ta\tgroup\tof\tapplications\tecosystem.\tEvery\tecosystem\tis described\tby\ta\tJSON\tfile,\tand\tthe\teasiest\tway\tto\tgenerate\tit\tis\texecuting the\tfollowing\tcommand:\n\npm2\tecosystem\n\nThis\tshould\toutput\tsomething\tsimilar\tto\tthe\tfollowing\tcode:\n\n[PM2]\tSpawning\tPM2\tdaemon [PM2]\tPM2\tSuccessfully\tdaemonized File\tpathto/your/app/ecosystem.json\tgenerated\n\nThe\tcontent\tof\tthe\tecosystem.json\tfile\tvaries,\tdepending\ton\tthe\tversion\tof PM2,\tbut\twhat\tthis\tfile\tcontains\tis\tthe\tskeleton\tof\ta\tPM2\tcluster:\n\n{ \t\tapps\t:\t[\n\n{ \t\t\t\t\t\tname\t\t\t\t\t\t:\t\"My\tApplication\", \t\t\t\t\t\tscript\t\t\t\t:\t\"app.js\" \t\t\t\t},\n\n{ \t\t\t\t\t\tname\t\t\t\t\t\t:\t\"Test\tWeb\tServer\", \t\t\t\t\t\tscript\t\t\t\t:\t\"proxy-server.js\" \t\t\t\t} \t\t],",
      "content_length": 1061,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 286,
      "content": "/ \t\tdeploy\t:\t{ \t\t\t\tproduction\t:\t{ \t\t\t\t\t\tuser\t:\t\"admin\", \t\t\t\t\t\thost\t:\t\"10.0.0.1\", \t\t\t\t\t\tref\t\t:\t\"remotes/origin/master\", \t\t\t\t\t\trepo\t:\t\"git@github.com:the-repository.git\", \t\t\t\t\t\tpath\t:\t\"appsrepository\", \t\t\t\t\t\t\"post-deploy\"\t:\t\"pm2\tstartOrRestart\t ecosystem.json\t--env\tproduction\" \t\t\t\t}, \t\t\t\tdev\t:\t{ \t\t\t\t\t\tuser\t:\t\"devadmin\", \t\t\t\t\t\thost\t:\t\"10.0.0.1\", \t\t\t\t\t\tref\t\t:\t\"remotes/origin/master\", \t\t\t\t\t\trepo\t:\t\"git@github.com:the-repository.git\", \t\t\t\t\t\tpath\t:\t\"homedavid/development/test-app/\", \t\t\t\t\t\t\"post-deploy\"\t:\t\"pm2\tstartOrRestart\t ecosystem.json\t--env\tdev\", \t\t\t\t} \t\t} }\n\nThis\tfile\tcontains\ttwo\tapplications\tconfigured\tfor\ttwo\tenvironments.\tWe are\tgoing\tto\tmodify\tthis\tskeleton\tto\tadapt\tit\tto\tour\tneeds,\tmodeling\tour entire\tecosystem\twritten\tin\tChapter\t4,\tWriting\tYour\tFirst\tMicroservice\tin Node.js.\n\nHowever,\tfor\tnow,\tlet's\texplain\ta\tbit\tfor\tthe\tconfiguration:\n\nWe\thave\tan\tarray\tof\tapplications\t(apps)\tdefining\ttwo\tapps:\tAPI\tand WEB As\tyou\tcan\tsee,\twe\thave\ta\tfew\tconfiguration\tparameters\tfor\teach app:\n\nname:\tThis\tis\tthe\tname\tof\tthe\tapplication script:\tThis\tis\tthe\tstartup\tscript\tof\tthe\tapp env:\tThese\tare\tthe\tenvironment\tvariables\tto\tbe\tinjected\tinto\tthe system\tby\tPM2 env_<environment>:\tThis\tis\tsame\tas\tenv,\tbut\tit\tis\ttailored\tper environment\n\nThere\tare\ttwo\tenvironments\tdefined\tin\tthe\tdefault\tecosystem\tunder",
      "content_length": 1304,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 287,
      "content": "the\tdeploy\tkey,\tas\tfollows:\n\nproduction dev\n\nAs\tyou\tcan\tsee,\tbetween\tthese\ttwo\tenvironments,\tthere\tare\tno significant\tchanges\texcept\tfor\tthe\tfact\tthat\twe\tare\tconfiguring\tone environment\tvariable\tin\tdevelopment\tand\tthe\tfolder\twhere\twe\tdeploy\tour application.\n\nDeploying\tmicroservices\twith\tPM2\n\nIn\tChapter\t4,\tWriting\tYour\tFirst\tMicroservice\tin\tNode.js,\twe\twrote\ta simple\te-commerce\tin\torder\tto\tshow\tthe\tdifferent\tconcepts\tand\tcommon catches\tin\tmicroservices.\n\nNow,\twe\tare\tgoing\tto\tlearn\thow\tto\tdeploy\tthem\tusing\tPM2.\n\nConfiguring\tthe\tserver\n\nFirst\tthing\twe\tneed\tto\tdo\tin\torder\tto\tdeploy\tsoftware\twith\tPM2\tis\tto configure\tthe\tremote\tmachine\tand\tlocal\tmachine\tto\tbe\table\tto\ttalk\tusing SSH,\twith\ta\tpublic/private\tkey\tschema.\n\nThe\tway\tof\tdoing\tit\tis\teasy,\tas\tfollows:\n\nGenerate\tone\tRSA\tkey Install\tit\tinto\tthe\tremote\tserver\n\nLet's\tdo\tit:\n\nssh-keygen\t-t\trsa\n\nThat\tshould\tproduce\tsomething\tsimilar\tto\tthe\tfollowing\toutput:\n\nGenerating\tpublic/private\trsa\tkey\tpair. Enter\tfile\tin\twhich\tto\tsave\tthe\tkey\t (Usersyouruser/.ssh/id_rsa):\t Usersyouruser/.ssh/pm2_rsa",
      "content_length": 1049,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 288,
      "content": "Enter\tpassphrase\t(empty\tfor\tno\tpassphrase): Enter\tsame\tpassphrase\tagain: Your\tidentification\thas\tbeen\tsaved\tin\tpm2_rsa. Your\tpublic\tkey\thas\tbeen\tsaved\tin\tpm2_rsa.pub. The\tkey\tfingerprint\tis: eb:bc:24:fe:23:b2:6e:2d:58:e4:5f:ab:7b:b7:ee:38\t dgonzalez@yourmachine.local The\tkey's\trandomart\timage\tis: +--[\tRSA\t2048]----+ |\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| |\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| |\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| |\t\t\t\t.\t\t\t\t\t\t\t\t\t\t\t\t| |\t\t\to\t\t\t\tS\t\t\t\t\t\t\t\t| |\t\t\t\to\t\t\t..\t\t\t\t\t\t\t| |\t\t\to\to..o.\t\t\t\t\t\t\t| |\t\t.\t+.+=E..\t\t\t\t\t\t| |\t\t\too++**B+.\t\t\t\t\t| +-----------------+\n\nNow,\tif\twe\tgo\tto\tthe\tfolder\tindicated\tin\tthe\tpreceding\toutput,\twe\tcan\tfind the\tfollowing\ttwo\tfiles:\n\npm2_rsa:\tThe\tfirst\tone,\tpm2_rsa,\tis\tyour\tprivate\tkey.\tAs\tyou\tcan\tread from\tthe\tname,\tno\tone\tshould\thave\taccess\tto\tthis\tkey\tas\tthey\tmay steal\tyour\tidentity\tin\tthe\tservers\tthat\ttrust\tthis\tkey. pm2_rsa.pub:\tThe\tpm2_rsa.pub\tis\tyour\tpublic\tkey.\tThis\tkey\tcan\tbe handed\tover\tto\tanyone\tso\tthat\tusing\tasymmetric\tcryptography techniques,\tthey\tcan\tverify\tyour\tidentity\t(or\twho\tyou\tsay\tyou\tare).\n\nWhat\twe\tare\tgoing\tto\tdo\tnow\tis\tcopy\tthe\tpublic\tkey\tto\tthe\tremote\tserver so\tthat\twhen\tour\tlocal\tmachine\tPM2\ttries\tto\ttalk\tto\tthe\tserver,\tit\tknows who\twe\tare\tand\tlet's\tget\tinto\tthe\tshell\twithout\tpassword:\n\ncat\tpm2_rsa.pub\t|\tssh\tyouruser@yourremoteserver\t'cat\t >>\t.ssh/authorized_keys'\n\nThe\tlast\tstep\tis\tto\tregister\tyour\tprivate\tkey\tas\ta\tknown\tidentity\tin\tyour local\tmachine:\n\nssh-add\tpm2_rsa\n\nThat's\tabout\tit.",
      "content_length": 1412,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 289,
      "content": "From\tnow\ton,\twhenever\tyou\tSSH\tinto\tthe\tremote\tserver\tusing\tas\ta\tuser youruser,\tyou\twon't\tneed\tto\tenter\tthe\tpassword\tin\torder\tto\tget\tinto\tthe shell.\n\nOnce\tthis\tconfiguration\tis\tdone,\tthere\tis\tvery\tlittle\tto\tdo\tin\torder\tto\tdeploy any\tapplication\tinto\tthis\tserver:\n\npm2\tdeploy\tecosystem.json\tproduction\tsetup pm2\tdeploy\tecosystem.json\tproduction\n\nThe\tfirst\tcommand\twill\tconfigure\teverything\tneeded\tto\taccommodate\tthe app.\tThe\tsecond\tcommand\twill\tactually\tdeploy\tthe\tapplication\titself\tas we\tconfigured\tearlier.",
      "content_length": 507,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 290,
      "content": "Docker\t–\ta\tcontainer\tfor\tsoftware delivery\n\nVirtualization\thas\tbeen\tone\tof\tthe\tbiggest\ttrends\tin\tthe\tpast\tfew\tyears. Virtualization\tenables\tthe\tengineer\tto\tshare\tthe\thardware\tacross\tdifferent software\tinstances.\tDocker\tis\tnot\treally\ta\tvirtualization\tsoftware,\tbut\tit\tis conceptually\tthe\tsame.\n\nWith\ta\tpure\tvirtualization\tsolution,\ta\tnew\tOS\truns\ton\ttop\tof\ta\thypervisor sitting\ton\ttop\tof\tan\texisting\toperating\tsystem\t(host\tOS).\tRunning\tthe\tfull OS\tmeans\tthat\twe\tcan\tbe\tconsuming\ta\tfew\tgigabytes\tof\thard\tdrive\tin order\tto\treplicate\tthe\tfull\tstack\tfrom\tthe\tkernel\tto\tthe\tfilesystem,\twhich usually\tconsumes\ta\tgood\tchunk\tof\tresources.\tThe\tstructure\tof\ta virtualization\tsolution\tis\tshown\tin\tthe\tfollowing\timage:",
      "content_length": 704,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 291,
      "content": "Layers\tdiagram\tfor\ta\tvirtual\tmachine\tenvironment\n\nWith\tDocker,\twe\tonly\treplicate\tthe\tfilesystem\tand\tbinaries\tso\tthat\tthere\tis no\tneed\tto\trun\tthe\tfull\tstack\tof\tthe\tOS\twhere\twe\tdon't\tneed\tit.\tDocker images\tare\tusually\ta\tfew\thundreds\tof\tmegabytes,\tinstead\tof\tgigabytes, and\tthey\tare\tquite\tlightweight,\ttherefore,\twe\tcan\trun\tsome\tcontainers\ton the\tsame\tmachine.\tThe\tprevious\tstructure\tusing\tDocker\tis\tshown\tas follows:\n\nLayers\tdiagram\tfor\tDocker\n\nWith\tDocker,\twe\talso\teliminate\tone\tof\tthe\tbiggest\tproblems\tof\tsoftware deployment,\tthat\tis,\tthe\tconfiguration\tmanagement.\n\nWe\tare\tswitching\ta\tcomplicated\tper-environment\tconfiguration management,\twhere\twe\tneed\tto\tworry\tabout\thow\tthe\tapplication\tis deployed/configured\tinto\ta\tcontainer\tthat\tis\tbasically\tlike\ta\tsoftware package\tthat\tcan\tbe\tinstalled\tin\tany\tDocker-ready\tmachine.\n\nThe\tonly\tDocker-ready\tOS\tnowadays\tis\tLinux,\tas\tDocker\tneeds\tto\tmake use\tof\tthe\tadvanced\tkernel\tfeatures,\tforcing\tWindows\tand\tMac\tusers\tto run\ta\tvirtual\tmachine\twith\tLinux\tin\torder\tto\tprovide\tsupport\tto\trun\tDocker containers.\n\nSetting\tup\tthe\tcontainer",
      "content_length": 1072,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 292,
      "content": "Docker\tcomes\twith\ta\tvery\tpowerful\tand\tfamiliar\tway\t(for\tdevelopers)\tof configuring\tthe\tcontainers.\n\nYou\tcan\tcreate\tcontainers\tbased\ton\tan\texisting\timage\t(there\tare thousands\tof\timages\ton\tthe\tInternet)\tand\tthen\tmodify\tthe\timage\tto\tfulfil your\tneeds\tby\tadding\tnew\tsoftware\tpackages\tor\taltering\tthe\tfilesystem.\n\nOnce\twe\tare\tsatisfied\twith\tit,\twe\tcan\tuse\tthe\tnew\tversion\tof\tthe\timage\tto create\tour\tcontainers\tusing\ta\tversion\tcontrol\tsystem\tsimilar\tto\tGit.\n\nHowever,\twe\tneed\tto\tunderstand\thow\tDocker\tworks\tfirst.\n\nInstalling\tDocker\n\nAs\tit\twas\tmentioned\tbefore,\tDocker\tneeds\ta\tvirtual\tmachine\tto\tprovide support\ton\tMac\tand\tWindows,\ttherefore,\tthe\tinstallation\ton\tthese systems\tmay\tvary.\tThe\tbest\tway\tto\tinstall\tDocker\ton\tyour\tsystem\tis\tto\tgo to\tthe\tofficial\twebsite\tand\tfollow\tthe\tsteps:\n\nhttps://docs.docker.com/engine/installation/\n\nAt\tthe\tmoment,\tit\tis\ta\tvery\tactive\tproject,\tso\tyou\tcan\texpect\tchanges every\tfew\tweeks.\n\nChoosing\tthe\timage\n\nBy\tdefault,\tDocker\tcomes\twith\tno\timages.\tWe\tcan\tverify\tthis\tby\trunning docker\timages\ton\tthe\tterminal,\twhich\twill\tproduce\tan\toutput\tvery\tsimilar to\tthe\tfollowing\tscreenshot:\n\nIt\tis\tan\tempty\tlist.\tThere\tare\tno\timages\tstored\tin\tthe\tlocal\tmachine.\tThe first\tthing\twe\tneed\tto\tdo\tis\tsearch\tfor\tan\timage.\tIn\tthis\tcase,\twe\tare going\tto\tuse\tCentOS\tas\tour\tbase\tfor\tcreating\tthe\timages.\tCentOS\tis very\tclose\tto\tRed\tHat\tEnterprise\tLinux,\twhich\tseems\tto\tbe\tone\tof\tthe",
      "content_length": 1391,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 293,
      "content": "most\textended\tdistributions\tof\tLinux\tin\tthe\tindustry.\tThey\tprovide\tgreat support\tand\tthere\tis\tplenty\tof\tinformation\tavailable\ton\tthe\tInternet\tto troubleshoot\tproblems.\n\nLet's\tsearch\tfor\ta\tCentOS\timage\tas\tfollows:\n\nAs\tyou\tcan\tsee,\tthere\tis\ta\tlong\tlist\tof\timages\tbased\ton\tCentOS,\tbut\tonly the\tfirst\tone\tis\tofficial.\n\nThis\tlist\tof\timages\tis\tcoming\tfrom\tsomething\tcalled\tthe\tRegistry\tin\tthe Docker\tworld.\tA\tDocker\tRegistry\tis\ta\tsimple\trepository\tof\timages available\tto\tthe\tgeneral\tpublic.\tYou\tcan\talso\trun\tyour\town\tRegistry\tin order\tto\tprevent\tyour\timages\tfrom\tgoing\tto\tthe\tgeneral\tone.\n\nNote\n\nMore\tinformation\tcan\tbe\tfound\tat\tthe\tfollowing\tlink:\n\nhttps://docs.docker.com/registry/\n\nThere\tis\tone\tcolumn\tin\tthe\ttable\tin\tthe\tpreceding\tscreenshot\tthat\tshould",
      "content_length": 751,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 294,
      "content": "have\tcaught\tyour\tattention\talmost\timmediately,\tthe\tcolumn\tcalled STARS.\tThis\tcolumn\trepresents\tthe\trating\tgiven\tby\tthe\tusers\tfor\ta\tgiven image.\tWe\tcan\tnarrow\tthe\tsearch\tbased\ton\tthe\tnumber\tof\tstars\tthat\tthe users\thave\tgiven\tto\tan\timage\tby\tusing\tthe\t-s\tflag.\n\nIf\tyou\trun\tthe\tfollowing\tcommand,\tyou\twill\tsee\ta\tlist\tof\timages\trated\twith 1000\tor\tmore\tstars:\n\ndocker\tsearch\t-s\t1000\tcentos\n\nTip\n\nBe\tcareful\twith\tthe\timages\tyou\tchoose,\tthere\tis\tnothing\tpreventing\ta user\tto\tcreate\tan\timage\twith\tmalicious\tsoftware.\n\nIn\torder\tto\tfetch\tthe\tCentOS\timage\tto\tthe\tlocal\tmachine,\twe\tneed\tto\trun the\tfollowing\tcommand:\n\ndocker\tpull\tcentos\n\nThe\toutput\tproduced\twill\tbe\tvery\tsimilar\tto\tthe\tfollowing\timage:\n\nOnce\tthe\tcommand\tfinishes,\tif\twe\trun\tDocker\timages\tagain,\twe\tcan\tsee that\tcentos\tis\tnow\tappearing\tin\tthe\tfollowing\tlist:\n\nAs\twe\tspecified\tearlier,\tDocker\tdoes\tnot\tuse\tthe\tfull\timage,\tbut\tit\tuses\ta reduced\tversion\tof\tit,\tonly\tvirtualizing\tthe\tlast\tfew\tlayers\tof\tthe\tOS.\tYou",
      "content_length": 963,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 295,
      "content": "can\tclearly\tsee\tit,\tas\tthe\tsize\tof\tthe\timage\tis\tnot\teven\t200\tMB,\twhich\tfor a\tfull\tversion\tof\tCentOS,\tcan\tgo\tup\tto\ta\tfew\tGB.\n\nRunning\tthe\tcontainer\n\nNow\tthat\twe\thave\ta\tcopy\tof\tthe\timage\tin\tour\tlocal\tmachine,\tit\tis\ttime\tto run\tit:\n\ndocker\trun\t-i\t-t\tcentos\tbinbash\n\nThis\twill\tproduce\tthe\tfollowing\toutput:\n\nAs\tyou\tcan\tsee,\tthe\tprompt\tof\tthe\tterminal\thas\tchanged\tto\tsomething like\troot@debd09c7aa3b,\twhich\tmeans\tthat\twe\tare\tinside\tthe\tcontainer.\n\nFrom\tnow\ton,\tevery\tsingle\tcommand\tthat\twe\trun\twill\tbe\texecuted\tinside a\tcontained\tversion\tof\tCentOS\tLinux.\n\nThere\tis\tanother\tinteresting\tcommand\tin\tDocker:\n\ndocker\tps\n\nIf\twe\trun\tthis\tcommand\tin\ta\tnew\tterminal\t(without\texiting\tfrom\tthe running\tcontainer),\twe\twill\tget\tthe\tfollowing\toutput:\n\nThis\toutput\tis\tself\texplanatory;\tit\tis\tan\teasy\tway\tto\tsee\twhat\tis\tgoing\ton in\tour\tDocker\tcontainers.\n\nInstalling\tthe\trequired\tsoftware\n\nLet's\tinstall\tNode.js\tin\tthe\tcontainer:",
      "content_length": 908,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 296,
      "content": "curl\t--silent\t--location\t https://rpm.nodesource.com/setup_4.x\t|\tbash\t-\n\nThis\tcommand\twill\tpull\tand\texecute\tthe\tsetup\tscript\tfor\tNode.js.\n\nThis\twill\tproduce\tan\toutput\tvery\tsimilar\tto\tthe\tfollowing\timage:\n\nFollow\tthe\tinstructions,\tas\tthis\twill\tinstall\tnode:\n\nyum\tinstall\t-y\tnodejs\n\nIt\tis\thighly\trecommended\tto\tinstall\tthe\tdevelopment\ttools,\tas\tthe installation\tprocess\tof\ta\tfew\tmodules\trequires\ta\tcompilation\tstep.\tLet's do\tit:\n\nyum\tinstall\t-y\tgcc-c++\tmake\n\nOnce\tthe\tcommand\tfinishes,\twe\tare\tready\tto\trun\tthe\tnode\tapplications inside\tour\tcontainer.\n\nSaving\tthe\tchanges",
      "content_length": 567,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 297,
      "content": "In\tthe\tDocker\tworld,\tan\timage\tis\tthe\tconfiguration\tfor\ta\tgiven\tcontainer. We\tcan\tuse\tthe\timage\tas\ta\ttemplate\tto\trun\tas\tmany\tcontainers\tas\twe want,\thowever\tfirst,\twe\tneed\tto\tsave\tthe\tchanges\tmade\tin\tthe\tprevious section.\n\nIf\tyou\tare\ta\tsoftware\tdeveloper,\tyou\tprobably\tare\tfamiliar\twith\tcontrol version\tsystems\tsuch\tas\tCVS,\tSubversion,\tor\tGit.\tDocker\twas\tbuilt\twith their\tphilosophy\tin\tmind—a\tcontainer\tcan\tbe\ttreated\tlike\ta\tversionable software\tcomponent\tand\tthen\tchanges\tcan\tbe\tcommitted.\n\nIn\torder\tto\tdo\tit,\trun\tthe\tfollowing\tcommand:\n\ndocker\tps\t-a\n\nThis\tcommand\twill\tshow\ta\tlist\tof\tcontainers\tthat\thave\trun\tin\tthe\tpast,\tas shown\tin\tthe\tfollowing\timage:\n\nIn\tmy\tcase,\tthere\tare\tfew\tcontainers,\tbut\tthe\tinteresting\tone\tin\tthis\tcase is\tthe\tsecond;\tthis\tis\twhere\tNode.js\tis\tinstalled.\n\nNow,\twe\tneed\tto\tcommit\tthe\tstatus\tof\tthe\tcontainer\tin\torder\tto\tcreate\ta new\timage\twith\tour\tchanges.\tWe\tdo\tit\tby\trunning\tthe\tfollowing command:\n\ndocker\tcommit\t-a\tdgonzalez\t62e7336a4627\tcentos- microservices:1.0\n\nLet's\texplain\tthe\tcommand:\n\nThe\t-a\tflag\tindicates\tthe\tauthor.\tIn\tthis\tcase,\tdgonzalez. The\tfollowing\tparameter\tis\tcontainer\tid.\tAs\twe\tindicated\tearlier,\tthe second\tcontainer\thas\tthe\tcorresponding\tID\t62e7336a4627. The\tthird\tparameter\tis\ta\tcombination\tof\tthe\tname\tgiven\tto\tthe\tnew image\tand\tthe\ttag\tof\tthe\timage.\tThe\ttagging\tsystem\tcan\tbe\tvery",
      "content_length": 1335,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 298,
      "content": "powerful\twhen\twe\tare\tdealing\twith\tquite\ta\tfew\timages,\tas\tit\tcan\tget really\tcomplicated\tto\tidentify\tsmall\tvariations\tbetween\tthem.\n\nIt\tmight\ttake\ta\tfew\tseconds,\tbut\tafter\tfinishing,\tthe\toutput\tof\tthe command\tmust\tbe\tvery\tsimilar\tto\tthe\tfollowing\timage:\n\nThis\tis\tthe\tindication\tthat\twe\thave\ta\tnew\timage\tin\tour\tlist\twith\tour software\tinstalled.\tRun\tdocker\timages\tagain\tand\tthe\toutput\twill\tconfirm\tit, as\tshown\tin\tthe\tfollowing\timage:\n\nIn\torder\tto\trun\ta\tcontainer\tbased\ton\tthe\tnew\timage,\twe\tcan\trun\tthe following\tcommand:\n\ndocker\trun\t-i\t-t\tcentos-microservices:1.0\tbinbash\n\nThis\twill\tgive\tus\taccess\tto\tthe\tshell\tin\tthe\tcontainer,\tand\twe\tcan\tconfirm that\tNode.js\tis\tinstalled\tby\trunning\tnode\t-v,\twhich\tshould\toutput\tthe version\tof\tNode,\tin\tthis\tcase,\t4.2.4.\n\nDeploying\tNode.js\tapplications\n\nNow,\tit\tis\ttime\tto\tdeploy\tNode.js\tapplications\tinside\tthe\tcontainer.\tIn order\tto\tdo\tit,\twe\tare\tgoing\tto\tneed\tto\texpose\tthe\tcode\tfrom\tour\tlocal machine\tto\tthe\tDocker\tcontainer.\n\nThe\tcorrect\tway\tof\tdoing\tit\tis\tby\tmounting\ta\tlocal\tfolder\tin\tthe\tDocker machine,\tbut\tfirst,\twe\tneed\tto\tcreate\tthe\tsmall\tapplication\tto\tbe\trun inside\tthe\tcontainer,\tas\tfollows:\n\nvar\texpress\t=\trequire('express'); var\tmyApplication\t=\texpress();\n\napp.get('/hello',\tfunction\t(req,\tres)\t{",
      "content_length": 1245,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 299,
      "content": "res.send('Hello\tEarth!'); });\n\nvar\tport\t=\t80;\n\napp.listen(port,\tfunction\t()\t{ \t\tconsole.log('Listeningistening\ton\tport\t'+\tport); });\n\nIt\tis\ta\tsimple\tapplication,\tusing\tExpress\tthat\tbasically\trenders\tHello Earth!\tinto\ta\tbrowser.\tIf\twe\trun\tit\tfrom\ta\tterminal\tand\twe\taccess http://localhost:80/hello,\twe\tcan\tsee\tthe\tresults.\n\nNow,\twe\tare\tgoing\tto\trun\tit\tinside\tthe\tcontainer.\tIn\torder\tto\tdo\tit,\twe\tare going\tto\tmount\ta\tlocal\tfolder\tas\ta\tvolume\tin\tthe\tDocker\tcontainer\tand\trun it.\n\nDocker\tcomes\tfrom\tthe\texperience\tof\tsysadmins\tand\tdevelopers\tthat have\tlately\tmelted\tinto\ta\trole\tcalled\tDevOps,\twhich\tis\tsomewhere\tin between\tthem.\tBefore\tDocker,\tevery\tsingle\tcompany\thad\tits\town\tway\tof deploying\tapps\tand\tmanaging\tconfigurations,\tso\tthere\twas\tno\tconsensus on\thow\tto\tdo\tthings\tthe\tright\tway.\n\nNow\twith\tDocker,\tthe\tcompanies\thave\ta\tway\tto\tprovide\tuniformity\tto deployments.\tNo\tmatter\twhat\tyour\tbusiness\tis,\teverything\tis\treduced\tto build\tthe\tcontainer,\tdeploy\tthe\tapplication,\tand\trun\tthe\tcontainer\tin\tthe appropriate\tmachine.\n\nLet's\tassume\tthat\tthe\tapplication\tis\tin\tthe\tappstest/\tfolder.\tNow,\tin\torder to\texpose\tit\tto\tthe\tcontainer,\twe\trun\tthe\tfollowing\tcommand:\n\ndocker\trun\t-i\t-t\t-v\tapptest:/test_app\t-p\t8000:3000\t centos-microservices:1.0\tbinbash\n\nAs\tyou\tcan\tsee,\tDocker\tcan\tget\tvery\tverbose\twith\tparameters,\tbut\tlet's explain\tthem,\tas\tfollows:\n\nThe\t-i\tand\t-t\tflags\tare\tfamiliar\tto\tus.\tThey\tcapture\tthe\tinput\tand send\tthe\toutput\tto\ta\tterminal. The\t-v\tflag\tis\tnew.\tIt\tspecifies\ta\tvolume\tfrom\tthe\tlocal\tmachine\tand where\tto\tmount\tit\tin\tthe\tcontainer.\tIn\tthis\tcase,\twe\tare\tmounting",
      "content_length": 1575,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 300,
      "content": "appstest\tfrom\tthe\tlocal\tmachine\tinto\t/test_app.\tPlease\tnote\tthe colon\tsymbol\tto\tseparate\tthe\tlocal\tand\tthe\tremote\tpath. The\t-p\tflag\tspecifies\tthe\tport\ton\tthe\tlocal\tmachine\tthat\twill\texpose the\tremote\tport\tin\tthe\tcontainer.\tIn\tthis\tcase,\twe\texpose\tthe\tport 3000\tin\tthe\tcontainer\tthrough\tthe\tport\t8000\tin\tthe\tDocker\tmachine,\tso accessing\tdocker-machine:8000\tfrom\tthe\thost\tmachine\twill\tend\tup accessing\tthe\tport\t3000\tin\tthe\tcontainer. The\tcentos-microservices:1.0\tis\tthe\tname\tand\ttag\tof\tthe\timage\tthat we\thave\tcreated\tin\tthe\tpreceding\tsection. The\tbinbash\tis\tthe\tcommand\tthat\twe\twant\tto\texecute\tinside\tthe container.\tThe\tbinbash\tis\tgoing\tto\tgive\tus\taccess\tto\tthe\tprompt\tof the\tsystem.\n\nIf\teverything\tworked\twell,\twe\tshould\thave\tgotten\taccess\tto\tthe\tsystem prompt\tinside\tthe\tcontainer,\tas\tshown\tin\tthe\tfollowing\timage:\n\nAs\tyou\tcan\tsee\tin\tthe\timage,\tthere\tis\ta\tfolder\tcalled\t/test_app\tthat contains\tour\tprevious\tapplication,\tcalled\tsmall-script.js.\n\nNow,\tit\tis\ttime\tto\taccess\tto\tthe\tapp,\tbut\tfirst,\tlet's\texplain\thow\tDocker works.\n\nDocker\tis\twritten\tin\tGo,\twhich\tis\ta\tmodern\tlanguage\tcreated\tby\tGoogle, grouping\tall\tthe\tbenefits\tfrom\ta\tcompiled\tlanguage\tsuch\tas\tC++\twith\tall the\thigh-level\tfeatures\tfrom\ta\tmodern\tlanguage\tsuch\tas\tJava.\n\nIt\tis\tfairly\teasy\tto\tlearn\tand\tnot\thard\tto\tmaster.\tThe\tphilosophy\tof\tGo\tis\tto bring\tall\tthe\tbenefits\tof\tan\tinterpreted\tlanguage,\tsuch\tas\treducing\tthe compilation\ttimes\t(the\tcomplete\tlanguage\tcan\tbe\tcompiled\tin\tunder\ta minute)\tto\ta\tcompiled\tlanguage.\n\nDocker\tuses\tvery\tspecific\tfeatures\tfrom\tthe\tLinux\tkernel\tthat\tforces Windows\tand\tMac\tusers\tto\tuse\ta\tvirtual\tmachine\tto\trun\tDocker containers.\tThis\tmachine\tused\tto\tbe\tcalled\tboot2docker,\tbut\tthe\tnew version\tis\tcalled\tDocker\tMachine,\twhich\tcontains\tmore\tadvanced",
      "content_length": 1743,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 301,
      "content": "features\tsuch\tas\tdeploying\tcontainers\tin\tremote\tvirtual\tmachines.\tFor this\texample,\twe\twill\tonly\tuse\tthe\tlocal\tcapabilities.\n\nGiven\tthat,\tif\tyou\trun\tthe\tapp\tfrom\twithin\tthe\tcontainer\tlocated\tin\tthe /test_app/\tfolder,\tand\tyou\tare\tin\tLinux,\taccessing http://localhost:8000/,\tit\twould\tbe\tenough\tto\tget\tinto\tthe\tapplication.\n\nWhen\tyou\tare\tusing\tMac\tor\tWindows,\tDocker\tis\trunning\teither\tin\tthe Docker\tMachine\tor\tboot2docker\tso\tthat\tthe\tIP\tis\tgiven\tby\tthis\tvirtual machine,\twhich\tis\tshown\twhen\tthe\tDocker\tterminal\tstarts,\tas\tshown\tin the\tfollowing\timage:\n\nAs\tyou\tcan\tsee,\tthe\tIP\tis\t192.168.99.100,\tso\tin\torder\tto\taccess\tour application,\twe\tneed\tto\tvisit\tthe\thttp://192.168.99.100:9000/\tURL.\n\nAutomating\tDocker\tcontainer\tcreation\n\nIf\tyou\tremember,\tin\tthe\tprevious\tchapters,\tone\tof\tthe\tmost\timportant concepts\twas\tautomation.\tAutomation\tis\tthe\tkey\twhen\tworking\twith microservices.\tInstead\tof\toperating\tone\tserver,\tyou\tprobably\twill\tneed\tto operate\tfew\tdozens,\treaching\ta\tpoint\twhere\tyou\tare\talmost\tfully\tbooked on\tday-to-day\ttasks.\n\nDocker\tdesigners\thad\tthat\tin\tmind\twhen\tallowing\tthe\tusers\tto\tcreate containers\tfrom\ta\tscript\twritten\tin\ta\tfile\tcalled\tDockerfile.\n\nIf\tyou\thave\tever\tworked\ton\tcoding\tC\tor\tC++,\teven\tin\tcollege,\tyou\tare probably\tfamiliar\twith\tMakefiles.\tA\tMakefile\tfile\tis\ta\tscript\twhere\tthe",
      "content_length": 1296,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 302,
      "content": "developer\tspecifies\tthe\tsteps\tto\tautomatically\tbuild\ta\tsoftware component.\tHere\tis\tan\texample:\n\nall:\tmy-awesome-app\n\nmy-awesome-app:\tmain.o\texternal-module.o\tapp-core.o \t\tg++\tmain.o\texternal-module.o\tapp-core.o\t-o\tmy- awesome-app\n\nmain.o:\tmain.cc \t\tg++\t-c\tmain.cc\n\nexternal-module.o:\texternal-module.cc \t\tg++\t-c\texternal-module.cc\n\napp-core.o:\tapp-core.cc \t\tg++\t-c\thello.cc\n\nclean: \t\trm\t*.o\tmy-awesome-app\n\nThe\tpreceding\tMakefile\tcontains\ta\tlist\tof\ttasks\tand\tdependencies\tto\tbe executed.\tFor\texample,\tif\twe\texecute\tmake\tclean\ton\tthe\tsame\tfolder where\tthe\tMakefile\tfile\tis\tcontained,\tit\twill\tremove\tthe\texecutable\tand\tall the\tfiles\tending\twith\to.\n\nDockerfile,\tunlike\tMakefile,\tis\tnot\ta\tlist\tof\ttasks\tand\tdependencies\t(even though\tthe\tconcept\tis\tthe\tsame),\tit\tis\ta\tlist\tof\tinstructions\tto\tbuild\ta container\tfrom\tscratch\tto\ta\tready\tstatus.\n\nLet's\tsee\tan\texample:\n\nFROM\tcentos MAINTAINER\tDavid\tGonzalez RUN\tcurl\t--silent\t--location\t https://rpm.nodesource.com/setup_4.x\t|\tbash\t- RUN\tyum\t-y\tinstall\tnodejs\n\nThese\tsmall\tfew\tpreceding\tlines\tare\tenough\tto\tbuild\ta\tcontainer\thaving Node.js\tinstalled.",
      "content_length": 1091,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 303,
      "content": "Let's\texplain\tit\tin\tthe\tfollowing:\n\nFirst,\twe\tchoose\tthe\tbase\timage.\tIn\tthis\tcase,\tit\tis\tcentos\tas\twe used\tbefore.\tFor\tdoing\tthis,\twe\tuse\tthe\tFROM\tcommand\tand\tthen\tthe name\tof\tthe\timage. MAINTAINER\tspecifies\tthe\tname\tof\tthe\tperson\twho\tcreated\tthe container.\tIn\tthis\tcase,\tit\tis\tDavid\tGonzalez. RUN,\tas\tits\tname\tindicates,\truns\ta\tcommand.\tIn\tthis\tcase,\twe\tuse\tit twice:\tonce\tto\tadd\tthe\trepository\tto\tyum,\tand\tthen\tto\tinstall\tNode.js.\n\nDockerfiles\tcan\tcontain\ta\tnumber\tof\tdifferent\tcommands.\tThe documentation\tfor\tthem\tis\tpretty\tclear,\tbut\tlet's\ttake\ta\tlook\tat\tthe\tmost common\t(aside\tfrom\tthe\tones\tseen\tbefore):\n\nCMD:\tThis\tis\tsimilar\tto\trun,\tbut\tit\tactually\tgets\texecuted\tafter\tbuilding the\tcommand.\tCMD\tis\tthe\tcommand\tto\tbe\tused\tto\tstart\tan\tapplication once\tthe\tcontainer\tis\tinstantiated. WORKDIR:\tThis\tis\tto\tbe\tused\tin\tconjunction\twith\tCMD,\tit\tis\tthe\tcommand used\tto\tspecify\tthe\twork\tdirectory\tfor\tthe\tnext\tCMD\tcommand. ADD:\tThis\tcommand\tis\tused\tto\tcopy\tfiles\tfrom\tthe\tlocal\tfilesystem\tto the\tcontainer\tinstance\tfilesystem.\tIn\tthe\tprevious\texample,\twe\tcan use\tADD\tto\tcopy\tthe\tapplication\tfrom\tthe\thost\tmachine\tinto\tthe container,\trun\tnpm\tinstall\twith\tthe\tCMD\tcommand,\tand\tthen\trun\tthe app\tonce\tagain\twith\tthe\tCMD\tcommand.\tIt\tcan\talso\tbe\tused\tto\tcopy the\tcontent\tfrom\ta\tURL\tto\ta\tdestination\tfolder\tinside\tthe\tcontainer. ENV:\tThis\tis\tused\tto\tset\tenvironment\tvariables.\tFor\texample,\tyou could\tspecify\ta\tfolder\tto\tstore\tfiles\tuploaded\tby\tpassing\tan environment\tvariable\tto\tthe\tcontainer,\tas\tfollows:\n\nENV\tUPLOAD_PATH=/tmp/\n\nEXPOSE:\tThis\tis\tused\tto\texpose\tports\tto\tthe\trest\tof\tthe\tcontainers\tin your\tcluster.\n\nAs\tyou\tcan\tsee,\tthe\tdomain-specific\tlanguage\t(DSL)\tof\tDockerfiles\tis quite\trich\tand\tyou\tcan\tpretty\tmuch\tbuild\tevery\tsystem\trequired.\tThere are\thundreds\tof\texamples\ton\tthe\tInternet\tto\tbuild\tpretty\tmuch\teverything: MySQL,\tMongoDB,\tApache\tservers,\tand\tso\ton.\n\nIt\tis\tstrongly\trecommended\tto\tcreate\tcontainers\tthrough\tDockerfiles,\tas",
      "content_length": 1933,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 304,
      "content": "it\tcan\tbe\tused\tas\ta\tscript\tto\treplicate\tand\tmake\tchanges\tto\tthe containers\tin\tthe\tfuture,\tas\twell\tas\tbeing\table\tto\tautomatically\tdeploy\tour software\twithout\tmuch\tmanual\tintervention.",
      "content_length": 182,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 305,
      "content": "Node.js\tevent\tloop\t–\teasy\tto\tlearn and\thard\tto\tmaster\n\nWe\tall\tknow\tthat\tNode.js\tis\ta\tplatform\tthat\truns\tapplications\tin\ta\tsingle- threaded\tway;\tso,\twhy\tdon't\twe\tuse\tmultiple\tthreads\tto\trun\tapplications so\tthat\twe\tcan\tget\tthe\tbenefit\tof\tmulticore\tprocessors?\n\nNode.js\tis\tbuilt\tupon\ta\tlibrary\tcalled\tlibuv.\tThis\tlibrary\tabstracts\tthe system\tcalls,\tproviding\tan\tasynchronous\tinterface\tto\tthe\tprogram\tthat uses\tit.\n\nI\tcome\tfrom\ta\tvery\theavy\tJava\tbackground,\tand\tthere,\teverything\tis synchronous\t(unless\tyou\tare\tcoding\twith\tsome\tsort\tof\tnon-blocking libraries),\tand\tif\tyou\tissue\ta\trequest\tto\tthe\tdatabase,\tthe\tthread\tis blocked\tand\tresumed\tonce\tthe\tdatabase\treplies\twith\tthe\tdata.\n\nThis\tusually\tworks\tfine,\tbut\tit\tpresents\tan\tinteresting\tproblem:\ta\tblocked thread\tis\tconsuming\tresources\tthat\tcould\tbe\tused\tto\tserve\tother requests.\tThe\tevent\tloop\tof\tNode.js\tis\tshown\tin\tthe\tfollowing\tfigure:\n\nThis\tis\tthe\tNode.js\tevent\tloop\tdiagram\n\nJavaScript\tis,\tby\tdefault,\tan\tevent-driven\tlanguage.\tIt\texecutes\tthe program\tthat\tconfigures\ta\tlist\tof\tevent\thandlers\tthat\twill\treact\tto\tgiven events,\tand\tafter\tthat,\tit\tjust\twaits\tfor\tthe\taction\tto\ttake\tplace.\n\nLet's\ttake\ta\tlook\tat\ta\tvery\tfamiliar\texample:",
      "content_length": 1184,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 306,
      "content": "<div\tid=\"target\"> \t\tClick\there </div> <div\tid=\"other\"> \t\tTrigger\tthe\thandler </div>\n\nThen\tthe\tJavaScript\tcode\tis\tas\tfollows:\n\n$(\t\"#target\"\t).click(function()\t{ \t\talert(\t\"Handler\tfor\t.click()\tcalled.\"\t); });\n\nAs\tyou\tcan\tsee,\tthis\tis\ta\tvery\tsimple\texample.\tHTML\tthat\tshows\ta\tbutton and\tsnippet\tof\tJavaScript\tcode\tthat,\tusing\tJQuery,\tshows\tan\talert\tbox when\tthe\tbutton\tis\tclicked.\n\nThis\tis\tthe\tkey:\twhen\tthe\tbutton\tis\tclicked.\n\nClicking\ta\tbutton\tis\tan\tevent,\tand\tthe\tevent\tis\tprocessed\tthrough\tthe event\tloop\tof\tJavaScript\tusing\ta\thandler\tspecified\tin\tthe\tJavaScript.\n\nAt\tthe\tend\tof\tthe\tday,\twe\tonly\thave\tone\tthread\texecuting\tthe\tevents,\tand we\tnever\ttalk\tabout\tparallelism\tin\tJavaScript,\tthe\tcorrect\tword\tis concurrency.\tSo,\tbeing\tmore\tconcise,\twe\tcan\tsay\tthat\tNode.js\tprograms are\thighly\tconcurrent.\n\nYour\tapplication\twill\talways\tbe\texecuted\tin\tonly\tone\tthread,\tand\twe\tneed to\tkeep\tthat\tin\tmind\twhile\tcoding.\n\nIf\tyou\thave\tbeen\tworking\tin\tJava\tor\t.NET\tor\tany\tother language/frameworks\tdesigned\tand\timplemented\twith\tthread-blocking techniques,\tyou\tmight\thave\tobserved\tthat\tTomcat,\twhen\trunning\tan application,\tspawns\ta\tnumber\tof\tthreads\tlistening\tto\tthe\trequests.\n\nIn\tthe\tJava\tworld,\teach\tof\tthese\tthreads\tare\tcalled\tworkers,\tand\tthey are\tresponsible\tto\thandle\tthe\trequest\tfrom\ta\tgiven\tuser\tfrom\tthe beginning\tto\tthe\tend.\tThere\tis\tone\ttype\tof\tdata\tstructure\tin\tJava\tthat takes\tthe\tbenefit\tof\tit.\tIt\tis\tcalled\tThreadLocal\tand\tit\tstores\tthe\tdata\tin the\tlocal\tthread\tso\tthat\tit\tcan\tbe\trecovered\tlater\ton.\tThis\ttype\tof\tstorage",
      "content_length": 1519,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 307,
      "content": "is\tpossible\tbecause\tthe\tthread\tthat\tstarts\tthe\trequest\tis\talso\tresponsible to\tfinish\tit,\tand\tif\tthe\tthread\tis\texecuting\tany\tblocking\toperation\t(such\tas reading\ta\tfile\tor\taccessing\ta\tdatabase),\tit\twill\twait\tuntil\tit\tis\tcompleted.\n\nThis\tis\tusually\tnot\ta\tbig\tdeal,\tbut\twhen\tyour\tsoftware\trelies\theavily\ton I/O,\tthe\tproblems\tcan\tbecome\tserious.\n\nAnother\tbig\tpoint\tin\tfavor\tof\tthe\tnon-blocking\tmodel\tof\tNode.js\tis\tthe\tlack of\tcontext\tswitch.\n\nWhen\tthe\tCPU\tswitches\tone\tthread\twith\tanother,\twhat\thappens\tis\tthat\tall the\tdata\tin\tthe\tregisters,\tand\tother\tareas\tof\tthe\tmemory,\tis\tstacked\tand allows\tthe\tCPU\tto\tswitch\tthe\tcontext\twith\ta\tnew\tprocess\tthat\thas\tits\town data\tto\tbe\tplaced\tin\tthere,\tas\tshown\tin\tthe\tfollowing\timage:\n\nThis\tis\ta\tdiagram\tshowing\tcontext\tswitching\tin\tthreads\tfrom\tthe\ttheoretical\tpoint\tof\tview.\n\nThis\toperation\ttakes\ttime,\tand\tthis\ttime\tis\tnot\tused\tby\tthe\tapplication.\tIt simply\tgets\tlost.\tIn\tNode.js,\tyour\tapplication\truns\tin\tonly\tone\tthread,\tso there\tis\tno\tsuch\tcontext\tswitching\twhile\trunning\t(it\tis\tstill\tpresent\tin\tthe background,\tbut\thidden\tto\tyour\tprogram).\tIn\tthe\tfollowing\timage,\twe\tcan see\twhat\thappens\tin\tthe\treal\tworld\twhen\ta\tCPU\tswitches\ta\tthread:\n\nThis\tis\ta\tdiagram\tshowing\tcontext\tswitching\tin\tthreads\tfrom\tthe\tpractical\t(shows\tthe\tdead\ttimes) point\tof\tview.",
      "content_length": 1287,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 308,
      "content": "Clustering\tNode.js\tapplications\n\nBy\tnow,\tyou\tknow\thow\tNode.js\tapplications\twork,\tand\tcertainly,\tsome\tof the\treaders\tmay\thave\ta\tquestion\tthat\tif\tthe\tapp\truns\ton\ta\tsingle\tthread, then\twhat\thappens\twith\tthe\tmodern\tmulticore\tprocessors?\n\nBefore\tanswering\tthis\tquestion,\tlet's\ttake\ta\tlook\tat\tthe\tfollowing\tscenario.\n\nWhen\tI\twas\tin\thigh\tschool,\tthere\twas\ta\tbig\ttechnology\tleap\tin\tCPUs:\tthe segmentation.\n\nIt\twas\tthe\tfirst\tattempt\tto\tintroduce\tparallelism\tat\tthe\tinstruction\tlevel.\tAs you\tprobably\tare\taware,\tthe\tCPU\tinterprets\tassembler\tinstructions\tand each\tof\tthese\tinstructions\tare\tcomposed\tof\ta\tnumber\tof\tphases,\tas shown\tin\tthe\tfollowing\tdiagram:\n\nBefore\tthe\tIntel\t4x86,\tthe\tCPUs\twere\texecuting\tone\tinstruction\tat\tthe time,\tso\ttaking\tthe\tinstruction\tmodel\tfrom\tthe\tpreceding\tdiagram,\tany CPU\tcould\tonly\texecute\tone\tinstruction\tevery\tsix\tCPU\tcycles.",
      "content_length": 847,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 309,
      "content": "Then,\tthe\tsegmentation\tcame\tinto\tplay.\tWith\ta\tset\tof\tintermediate registers,\tthe\tCPU\tengineers\tmanaged\tto\tparallelize\tthe\tindividual phases\tof\tinstructions\tso\tthat\tin\tthe\tbest-case\tscenario,\tthe\tCPUs\tare able\tto\texecute\tone\tinstruction\tper\tcycle\t(or\tnearly),\tas\tshown\tin\tthe following\tdiagram:\n\nThe\timage\tdescribes\tthe\texecution\tof\tinstructions\tin\ta\tCPU\twith\ta\tsegmented\tpipeline\n\nThis\ttechnical\timprovement\tled\tto\tfaster\tCPUs\tand\topened\tthe\tdoor\tto native\thardware\tmultithreading,\twhich\tled\tto\tthe\tmodern\tn-core processors\tthat\tcan\texecute\ta\tlarge\tnumber\tof\tparallel\ttasks,\tbut\twhen we\tare\trunning\tNode.js\tapplications,\twe\tonly\tuse\tone\tcore.\n\nIf\twe\tdon't\tcluster\tour\tapp,\twe\tare\tgoing\tto\thave\ta\tserious\tperformance degradation\twhen\tcompared\tto\tother\tplatforms\tthat\ttake\tthe\tbenefit\tof the\tmultiple\tcores\tof\ta\tCPU.\n\nHowever,\tthis\ttime\twe\tare\tlucky,\tPM2\talready\tallows\tyou\tto\tcluster Node.js\tapps\tto\tmaximize\tthe\tusage\tof\tyour\tCPUs.\n\nAlso,\tone\tof\tthe\timportant\taspects\tof\tPM2\tis\tthat\tit\tallows\tyou\tto\tscale applications\twithout\tany\tdowntime.\n\nLet's\trun\ta\tsimple\tapp\tin\tthe\tcluster\tmode:\n\nvar\thttp\t=\trequire(\"http\"); http.createServer(function\t(request,\tresponse)\t{ \t\tresponse.writeHead(200,\t{ \t\t\t\t'Content-Type':\t'text/plain'",
      "content_length": 1224,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 310,
      "content": "}); \t\tresponse.write('Here\twe\tare!') \t\tresponse.end(); }).listen(3000);\n\nThis\ttime\twe\thave\tused\tthe\tnative\tHTTP\tlibrary\tfor\tNode.js\tin\torder\tto handle\tthe\tincoming\tHTTP\trequests.\n\nNow\twe\tcan\trun\tthe\tapplication\tfrom\tthe\tterminal\tand\tsee\thow\tit\tworks:\n\nnode\tapp.js\n\nAlthough\tit\tdoes\tnot\toutput\tanything,\twe\tcan\tcurl\tto\tthe http://localhost:3000/\tURL\tin\torder\tto\tsee\thow\tthe\tserver\tresponds,\tas shown\tin\tthe\tfollowing\tscreenshot:\n\nAs\tyou\tcan\tsee,\tNode.js\thas\tmanaged\tall\tthe\tHTTP\tnegotiation\tand\tit has\talso\tmanaged\tto\treply\twith\tthe\tHere\twe\tare!\tphrase\tas\tit\twas specified\tin\tthe\tcode.\n\nThis\tservice\tis\tquite\ttrivial,\tbut\tit\tis\tthe\tprinciple\ton\twhich\tmore\tcomplex",
      "content_length": 662,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 311,
      "content": "web\tservices\twork,\tso\twe\tneed\tto\tcluster\tthe\tweb\tservice\tto\tavoid bottlenecks.\n\nNode.js\thas\tone\tlibrary\tcalled\tcluster\tthat\tallows\tus\tto\tprogrammatically cluster\tour\tapplication,\tas\tfollows:\n\nvar\tcluster\t=\trequire('cluster'); var\thttp\t=\trequire('http'); var\tcpus\t=\trequire('os').cpus().length;\n\n//\tHere\twe\tverify\tif\tthe\twe\tare\tthe\tmaster\tof\tthe\t cluster:\tThis\tis\tthe\troot\tprocess //\tand\tneeds\tto\tfork\tal\tthe\tchilds\tthat\twill\tbe\t executing\tthe\tweb\tserver. if\t(cluster.isMaster)\t{ \t\tfor\t(var\ti\t=\t0;\ti\t<\tcpus;\ti++)\t{ \t\t\t\tcluster.fork(); \t\t}\n\ncluster.on('exit',\tfunction\t(worker,\tcode,\tsignal)\t{ \t\t\t\tconsole.log(\"Worker\t\"\t+\tworker.proces.pid\t+\t\"\thas\t finished.\"); \t\t}); }\telse\t{ \t\t//\tHere\twe\tare\ton\tthe\tchild\tprocess.\tThey\twill\tbe\t executing\tthe\tweb\tserver. \t\thttp.createServer(function\t(request,\tresponse)\t{ \t\t\t\tresponse.writeHead(200); \t\t\t\tresponse.end('Here\twe\tare!d\\n'); \t\t}).listen(80); }\n\nPersonally,\tI\tfind\tit\tmuch\teasier\tto\tuse\tspecific\tsoftware\tsuch\tas\tPM2\tto accomplish\teffective\tclustering,\tas\tthe\tcode\tcan\tget\treally\tcomplicated while\ttrying\tto\thandle\tthe\tclustered\tinstances\tof\tour\tapp.\n\nGiven\tthis,\twe\tcan\trun\tthe\tapplication\tthrough\tPM2\tas\tfollows:\n\npm2\tstart\tapp.js\t-i\t1",
      "content_length": 1182,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 312,
      "content": "The\t-i\tflag\tin\tPM2,\tas\tyou\tcan\tsee\tin\tthe\toutput\tof\tthe\tcommand,\tis\tused to\tspecify\tthe\tnumber\tof\tcores\tthat\twe\twant\tto\tuse\tfor\tour\tapplication.\n\nIf\twe\trun\tpstree,\twe\tcan\tsee\tthe\tprocess\ttree\tin\tour\tsystem\tand\tcheck whether\tPM2\tis\trunning\tonly\tone\tprocess\tfor\tour\tapp,\tas\tshown\tin\tthe following\timage:\n\nIn\tthis\tcase,\twe\tare\trunning\tthe\tapp\tin\tonly\tone\tprocess,\tso\tit\twill\tbe allocated\tin\tone\tcore\tof\tthe\tCPU.\n\nIn\tthis\tcase,\twe\tare\tnot\ttaking\tadvantage\tof\tthe\tmulticore\tcapabilities\tof the\tCPU\tthat\tis\trunning\tthe\tapp,\tbut\twe\tstill\tget\tthe\tbenefit\tof\trestarting the\tapp\tautomatically\tif\tone\texception\tbubbles\tup\tfrom\tour\talgorithm.\n\nNow,\twe\tare\tgoing\tto\trun\tour\tapplication\tusing\tall\tthe\tcores\tavailable\tin our\tCPU\tso\tthat\twe\tmaximize\tthe\tusage\tof\tit,\tbut\tfirst,\twe\tneed\tto\tstop the\tcluster:\n\npm2\tstop\tall",
      "content_length": 804,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 313,
      "content": "PM2,\tafter\tstopping\tall\tthe\tservices\n\npm2\tdelete\tall\n\nNow,\twe\tare\tin\ta\tposition\tto\trerun\tthe\tapplication\tusing\tall\tthe\tcores\tof our\tCPU:\n\npm2\tstart\tapp.js\t-i\t0\n\nPM2\tshowing\tfour\tservices\trunning\tin\ta\tcluster\tmode\n\nPM2\thas\tmanaged\tto\tguess\tthe\tnumber\tof\tCPUs\tin\tour\tcomputer,\tin\tmy case,\tthis\tis\tan\tiMac\twith\tfour\tcores,\tas\tshown\tin\tthe\tfollowing screenshot:",
      "content_length": 357,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 314,
      "content": "As\tyou\tcan\tsee\tin\tpstree,\tPM2\tstarted\tfour\tthreads\tat\tthe\tOS\tlevel,\tas shown\tin\tthe\tfollowing\timage:\n\nWhen\tclustering\tan\tapplication,\tthere\tis\tan\tunwritten\trule\tabout\tthe number\tof\tcores\tthat\tan\tapplication\tshould\tbe\tusing\tand\tthis\tnumber\tis the\tnumber\tof\tcores\tminus\tone.\n\nThe\treason\tbehind\tthis\tnumber\tis\tthe\tfact\tthat\tthe\tOS\tneeds\tsome\tCPU power\tso\tthat\tif\twe\tuse\tall\tthe\tCPUs\tin\tour\tapplication,\tonce\tthe\tOS starts\tcarrying\ton\twith\tsome\tother\ttasks,\tit\twill\tforce\tcontext\tswitching\tas all\tthe\tcores\twill\tbe\tbusy\tand\tthis\twill\tslow\tdown\tthe\tapplication.",
      "content_length": 556,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 315,
      "content": "Load\tbalancing\tour\tapplication\n\nSometimes,\tclustering\tour\tapp\tis\tnot\tenough\tand\twe\tneed\tto\tscale\tour application\thorizontally.\n\nThere\tare\ta\tnumber\tof\tways\tto\thorizontally\tscale\tan\tapp.\tNowadays,\twith cloud\tproviders\tsuch\tas\tAmazon,\tevery\tsingle\tprovider\thas\timplemented their\town\tsolution\twith\ta\tnumber\tof\tfeatures.\n\nOne\tof\tmy\tpreferred\tways\tof\timplementing\tthe\tload\tbalancing\tis\tusing NGINX.\n\nNGINX\tis\ta\tweb\tserver\twith\ta\tstrong\tfocus\ton\tthe\tconcurrency\tand\tlow memory\tusage.\tIt\tis\talso\tthe\tperfect\tfit\tfor\tNode.js\tapplications\tas\tit\tis highly\tdiscouraged\tto\tserve\tstatic\tresources\tfrom\twithin\ta\tNode.js application.\tThe\tmain\treason\tis\tto\tavoid\tthe\tapplication\tfrom\tbeing\tunder stress\tdue\tto\ta\ttask\tthat\tcould\tbe\tdone\tbetter\twith\tanother\tsoftware,\tsuch as\tNGINX\t(which\tis\tanother\texample\tof\tspecialization).\n\nHowever,\tlet's\tfocus\ton\tload\tbalancing.\tThe\tfollowing\tfigure\tshows\thow NGINX\tworks\tas\ta\tload\tbalancer:",
      "content_length": 912,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 316,
      "content": "As\tyou\tcan\tsee\tin\tthe\tpreceding\tdiagram,\twe\thave\ttwo\tPM2\tclusters\tload balanced\tby\tan\tinstance\tof\tNGINX.\n\nThe\tfirst\tthing\twe\tneed\tto\tdo\tis\tknow\thow\tNGINX\tmanages\tthe configuration.\n\nOn\tLinux,\tNGINX\tcan\tbe\tinstalled\tvia\tyum,\tapt-get,\tor\tany\tother\tpackage manager.\tIt\tcan\talso\tbe\tbuilt\tfrom\tthe\tsource,\tbut\tthe\trecommended method,\tunless\tyou\thave\tvery\tspecific\trequirements,\tis\tto\tuse\ta\tpackage manager.\n\nBy\tdefault,\tthe\tmain\tconfiguration\tfile\tis\tetcnginx/nginx.conf,\tas\tfollows:\n\nuser\t\tnginx;",
      "content_length": 492,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 317,
      "content": "worker_processes\t\t1;\n\nerror_log\t\tvarlog/nginx/error.log\twarn; pid\t\t\t\t\t\t\t\tvarrun/nginx.pid;\n\nevents\t{ \t\tworker_connections\t\t1024; }\n\nhttp\t{ \t\tinclude\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tetcnginx/mime.types; \t\tdefault_type\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tapplication/octet- stream;\n\nlog_format\t\t\t\t\t\t\t\t\t\tmain\t'$remote_addr\t-\t $remote_user\t[$time_local]\t\"$request\"\t' \t\t\t\t\t'$status\t$body_bytes_sent\t\"$http_referer\"\t' \t\t\t\t\t'\"$http_user_agent\"\t\"$http_x_forwarded_for\"\t' \t\t\t\t\t'$request_time';\n\naccess_log\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvarlog/nginx/access.log\t\t main; \t\tserver_tokens\t\t\t\t\t\t\t\t\t\t\t\t\t\t\toff; \t\tsendfile\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton; \t\t#tcp_nopush\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton; \t\tkeepalive_timeout\t\t\t\t\t\t\t\t\t\t\t65s; \t\tsend_timeout\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t15s; \t\tclient_header_timeout\t\t\t\t\t\t\t15s; \t\tclient_body_timeout\t\t\t\t\t\t\t\t\t15s; \t\tclient_max_body_size\t\t\t\t\t\t\t\t5m; \t\tignore_invalid_headers\t\t\t\t\t\ton; \t\tfastcgi_buffers\t\t\t\t\t\t\t\t\t\t\t\t\t16\t4k; \t\t#gzip\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton; \t\tinclude\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tetcnginx/sites- enabled/*.conf; }\n\nThis\tfile\tis\tpretty\tstraightforward,\tit\tspecifies\tthe\tnumber\tof\tworkers (remember,\tprocesses\tto\tserve\trequests),\tthe\tlocation\tof\terror\tlogs, number\tconnections\tthat\ta\tworker\tcan\thave\tactive\tat\tthe\ttime,\tand\tfinally, the\tHTTP\tconfiguration.\n\nThe\tlast\tline\tis\tthe\tmost\tinteresting\tone:\twe\tare\tinforming\tNGINX\tto\tuse etcnginx/sites-enabled/*.conf\tas\tpotential\tconfiguration\tfiles.\n\nWith\tthis\tconfiguration,\tevery\tfile\tending\tin\t.conf\tunder\tthe\tspecified folder\tis\tgoing\tto\tbe\tpart\tof\tthe\tNGINX\tconfiguration.",
      "content_length": 1465,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 318,
      "content": "As\tyou\tcan\tsee,\tthere\tis\ta\tdefault\tfile\talready\texisting\tthere.\tModify\tit\tto look\tas\tfollows:\n\nhttp\t{ \t\tupstream\tapp\t{ \t\t\t\tserver\t10.0.0.1:3000; \t\t\t\tserver\t10.0.0.2:3000; \t\t} \t\tserver\t{ \t\t\t\tlisten\t80; \t\t\t\tlocation\t\t{ \t\t\t\t\t\tproxy_pass\thttp:/app; \t\t\t\t} \t\t} }\n\nThis\tis\tall\tthe\tconfiguration\twe\tneed\tto\tbuild\ta\tload\tbalancer.\tLet's explain\tit\tin\tthe\tfollowing:\n\nThe\tupstream\tapp\tdirective\tis\tcreating\ta\tgroup\tof\tservices\tcalled\tapp. Inside\tthis\tdirective,\twe\tspecify\ttwo\tservers\tas\twe've\tseen\tin\tthe previous\timage. The\tserver\tdirective\tspecifies\tto\tNGINX\tthat\tit\tshould\tbe\tlistening\tto all\tthe\trequests\tfrom\tport\t80\tand\tpassing\tthem\tto\tthe\tgroup\tof upstream\tcalled\tapp.\n\nNow,\thow\tdoes\tNGINX\tdecide\tto\tsend\tthe\trequest\tto\twhich\tcomputer?\n\nIn\tthis\tcase,\twe\tcould\tspecify\tthe\tstrategy\tused\tto\tspread\tthe\tload.\n\nBy\tdefault,\tNGINX,\twhen\tthere\tis\tnot\ta\tbalancing\tmethod\tspecifically configured,\tuses\tRound\tRobin.\n\nOne\tthing\tto\tbear\tin\tmind\tis\tthat\tif\twe\tuse\tround\trobin,\tour\tapplication should\tbe\tstateless\tas\twe\twon't\tbe\talways\thitting\tthe\tsame\tmachine,\tso if\twe\tsave\tthe\tstatus\tin\tthe\tserver,\tit\tmight\tnot\tbe\tthere\tin\tthe\tfollowing call.\n\nRound\tRobin\tis\tthe\tmost\telementary\tway\tof\tdistributing\tload\tfrom\ta queue\tof\twork\tinto\ta\tnumber\tof\tworkers;\tit\trotates\tthem\tso\tthat\tevery node\tgets\tthe\tsame\tamount\tof\trequests.",
      "content_length": 1307,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 319,
      "content": "There\tare\tother\tmechanisms\tto\tspread\tthe\tload,\tas\tfollows:\n\nupstream\tapp\t{ \t\t\t\tleast_conn; \t\t\t\tserver\t10.0.0.1:3000; \t\t\t\tserver\t10.0.0.2:3000; \t\t}\n\nLeast\tconnected,\tas\tits\tname\tindicates,\tsends\tthe\trequest\tto\tthe\tleast connected\tnode,\tequally\tdistributing\tthe\tload\tbetween\tall\tthe\tnodes:\n\nupstream\tapp\t{ \t\t\t\tip_hash; \t\t\t\tserver\t10.0.0.1:3000; \t\t\t\tserver\t10.0.0.2:3000; \t\t}\n\nIP\thashing\tis\tan\tinteresting\tway\tof\tdistributing\tthe\tload.\tIf\tyou\thave\tever worked\twith\tany\tweb\tapplication,\tthe\tconcept\tof\tsessions\tis\tsomething present\tin\talmost\tany\tapplication.\tIn\torder\tto\tremember\twho\tthe\tuser\tis, the\tbrowser\tsends\ta\tcookie\tto\tthe\tserver,\twhich\thas\tstored\twho\tthe\tuser is\tin\tmemory\tand\twhat\tdata\the/she\tneeds/can\tbe\taccessed\tby\tthat\tgiven user.\tThe\tproblem\twith\tthe\tother\ttype\tof\tload\tbalancing\tis\tthat\twe\tare\tnot guaranteed\tto\talways\thit\tthe\tsame\tserver.\n\nFor\texample,\tif\twe\tare\tusing\tLeast\tconnected\tas\ta\tpolicy\tfor\tbalancing, we\tcould\thit\tthe\tserver\tone\tin\tthe\tfirst\tload,\tbut\tthen\thit\ta\tdifferent\tserver on\tsubsequent\tredirections\tthat\twill\tresult\tin\tthe\tuser\tnot\tbeing\tdisplayed with\tthe\tright\tinformation\tas\tthe\tsecond\tserver\twon't\tknow\twho\tthe\tuser is.\n\nWith\tIP\thashing,\tthe\tload\tbalancer\twill\tcalculate\ta\thash\tfor\ta\tgiven\tIP. This\thash\twill\tsomehow\tresult\tin\ta\tnumber\tfrom\t1\tto\tN,\twhere\tN\tis\tthe number\tof\tservers,\tand\tthen,\tthe\tuser\twill\talways\tbe\tredirected\tto\tthe same\tmachine\tas\tlong\tas\tthey\tkeep\tthe\tsame\tIP.\n\nWe\tcan\talso\tapply\ta\tweight\tto\tthe\tload\tbalancing,\tas\tfollows:\n\nupstream\tapp\t{ \t\t\t\tserver\t10.0.0.1:3000\tweight=5; \t\t\t\tserver\t10.0.0.2:3000;",
      "content_length": 1557,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 320,
      "content": "}\n\nThis\twill\tdistribute\tthe\tload\tin\tsuch\tway\tthat,\tfor\tevery\tsix\trequests,\tfive will\tbe\tdirected\tto\tthe\tfirst\tmachine\tand\tone\twill\tbe\tdirected\tto\tthe\tsecond machine.\n\nOnce\twe\thave\tchosen\tour\tpreferred\tload\tbalancing\tmethod,\twe\tcan restart\tNGINX\tfor\tthe\tchanges\tto\ttake\teffect,\tbut\tfirst,\twe\twant\tto\tvalidate them\tas\tshown\tin\tthe\tfollowing\timage:\n\nAs\tyou\tcan\tsee,\tthe\tconfiguration\ttest\tcan\tbe\treally\thelpful\tin\torder\tto avoid\tconfiguration\tdisasters.\n\nOnce\tNGINX\thas\tpassed\tconfigtest,\tit\tis\tguaranteed\tthat\tNGINX\twill\tbe able\tto\trestart/start/reload\twithout\tany\tsyntax\tproblem,\tas\tfollows:\n\nsudo\tetcinit.d/nginx\treload\n\nReload\twill\tgracefully\twait\tuntil\tthe\told\tthreads\tare\tdone,\tand\tthen,\treload the\tconfiguration\tand\troute\tthe\tnew\trequests\twith\tthe\tnew\tconfiguration.\n\nIf\tyou\tare\tinterested\tin\tlearning\tabout\tNGINX,\tI\tfound\tthe\tfollowing\tofficial documentation\tof\tNGINX\tquite\thelpful:\n\nhttp://nginx.org/en/docs/\n\nHealth\tcheck\ton\tNGINX\n\nHealth\tchecking\tis\tone\tof\tthe\timportant\tactivities\ton\ta\tload\tbalancer. What\thappens\tif\tone\tof\tthe\tnodes\tsuffers\ta\tcritical\thardware\tfailure\tand is\tunable\tto\tserve\tmore\trequests?\n\nIn\tthis\tcase,\tNGINX\tcomes\twith\ttwo\ttypes\tof\thealth\tchecks:\tpassive\tand active.",
      "content_length": 1196,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 321,
      "content": "Passive\thealth\tcheck\n\nHere,\tNGINX\tis\tconfigured\tas\ta\treverse\tproxy\t(as\twe\tdid\tin\tthe preceding\tsection).\tIt\treacts\tto\ta\tcertain\ttype\tof\tresponse\tfrom\tthe upstream\tservers.\n\nIf\tthere\tis\tan\terror\tcoming\tback,\tNGINX\twill\tmark\tthe\tnode\tas\tfaulty, removing\tit\tfrom\tthe\tload\tbalancing\tfor\ta\tcertain\tperiod\tof\ttime\tbefore reintroducing\tit.\tWith\tthis\tstrategy,\tthe\tnumber\tof\tfailures\twill\tbe drastically\treduced\tas\tNGINX\twill\tbe\tconstantly\tremoving\tthe\tnode\tfrom the\tload\tbalancer.\n\nThere\tare\ta\tfew\tconfigurable\tparameters,\tsuch\tas\tmax_fails\tor fail_timeout,\twhere\twe\tcan\tconfigure\tthe\tamount\tof\tfailures\trequired\tto mark\ta\tnode\tas\tinvalid\tor\tthe\ttime\tout\tfor\trequests.\n\nActive\thealth\tcheck\n\nActive\thealth\tchecks,\tunlike\tpassive\thealth\tchecks,\tactively\tissue connections\tto\tthe\tupstream\tservers\tto\tcheck\twhether\tthey\tare responding\tcorrectly\tto\tthe\texperiencing\tproblems.\n\nThe\tmost\tsimplistic\tconfiguration\tfor\tactive\thealth\tchecks\tin\tNGINX\tis\tthe following\tone:\n\nhttp\t{ \t\tupstream\tapp\t{ \t\t\t\tzone\tapp\ttest; \t\t\t\tserver\t10.0.0.1:3000; \t\t\t\tserver\t10.0.0.2:3000; \t\t} \t\tserver\t{ \t\t\t\tlisten\t80; \t\t\t\tlocation\t\t{ \t\t\t\t\t\tproxy_pass\thttp:/app; \t\t\t\t\t\thealth_check; \t\t\t\t} \t\t} }\n\nThere\tare\ttwo\tnew\tlines\tin\tthis\tconfig\tfile,\tas\tfollows:",
      "content_length": 1214,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 322,
      "content": "health_check:\tThis\tenables\tthe\tactive\thealth\tcheck.\tThe\tdefault configuration\tis\tto\tissue\ta\tconnection\tevery\tfive\tseconds\tto\tthe\thost and\tport\tspecified\tin\tthe\tupstream\tsection. zone\tapp\ttest:\tThis\tis\trequired\tby\tthe\tNGINX\tconfiguration\twhen enabling\tthe\thealth\tcheck.\n\nThere\tis\ta\twide\trange\tof\toptions\tto\tconfigure\tmore\tspecific\thealth checks,\tand\tall\tof\tthem\tare\tavailable\tin\tNGINX\tconfiguration\tthat\tcan\tbe combined\tto\tsatisfy\tthe\tneeds\tof\tdifferent\tusers.",
      "content_length": 459,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 323,
      "content": "Summary\n\nIn\tthis\tchapter,\tyou\tlearned\ta\twide\trange\tof\ttechnologies\tthat\twe\tcan\tuse to\tdeploy\tmicroservices.\tBy\tnow\tyou\tknow\thow\tto\tbuild,\tdeploy,\tand configure\tsoftware\tcomponents\tin\tsuch\ta\tway\tthat\twe\tare\table\tto homogenize\ta\tvery\tdiverse\trange\tof\ttechnologies.\tThe\tobjective\tof\tthis book\tis\tto\tprovide\tyou\tthe\tconcepts\trequired\tto\tstart\tworking\twith microservices\tand\tenable\tthe\treader\tto\tknow\thow\tto\tlook\tfor\tthe\tneeded information.\n\nPersonally,\tI\thave\tstruggled\tto\tfind\ta\tbook\tthat\tprovides\ta\tsummary\tof\tall the\taspects\tof\tthe\tlife\tcycle\tof\tmicroservices\tand\tI\treally\thope\tthat\tthis book\tcovers\tthis\tempty\tspace.",
      "content_length": 616,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 324,
      "content": "Index\n\nA\n\nACID\n\natomicity\t/\tDecentralization consistency\t/\tDecentralization isolation\t/\tDecentralization durability\t/\tDecentralization\n\nactive\thealth\tcheck\n\nabout\t/\tActive\thealth\tcheck\n\nactive\tmonitoring\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nADD\tcommand\n\nabout\t/\tAutomating\tDocker\tcontainer\tcreation\n\nAPI\taggregation\n\nabout\t/\tAPI\taggregation\n\napplication\texceptions\n\nmonitoring,\tKeymetrics\tused\t/\tMonitoring\tapplication\texceptions\n\napplication\tmetrics\n\nabout\t/\tMonitoring\tservices\n\napplication\tsecurity\n\nabout\t/\tApplication\tsecurity",
      "content_length": 553,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 325,
      "content": "B\n\nasymmetric\tcryptography\t/\tSSH\t–\tencrypting\tthe\tcommunications Asynchronous\tJavaScript\tand\tXML\t(AJAX)\n\nabout\t/\tThe\tfuture\tof\tNode.js\n\nauditing\n\nabout\t/\tAuditing\n\nautomated\ttesting\n\nabout\t/\tThe\tpyramid\tof\tautomated\ttesting unit\ttests\t/\tUnit\ttests integration\ttests\t/\tIntegration\ttests end-to-end\ttests\t/\tEnd-to-end\ttests need\tfor\t/\tHow\tmuch\ttesting\tis\ttoo\tmuch?\n\naverage\tcalculated\tvalues\tmetric\n\nabout\t/\tAverage\tcalculated\tvalues\n\nbehavior-driven\tdevelopment\t(BDD)\t/\tEnd-to-end\ttests behavior-driven\tdevelopment\ttesting\t(BDDT)\t/\tMocha black\tlisting\n\nabout\t/\tInput\tvalidation\n\nbluebird\t/\tSingle-threaded\tapplications\tand\texceptions Bluebird\n\nURL\t/\tThe\tcode,\tSeneca\tand\tpromises\n\nboot2docker\n\nabout\t/\tDeploying\tNode.js\tapplications\n\nbounded\tcontext",
      "content_length": 748,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 326,
      "content": "C\n\nabout\t/\tReplaceability\n\nBusiness\tProcess\tExecution\tLanguage\t(BPEL)\n\nabout\t/\tSmart\tservices,\tdumb\tcommunication\tpipes\n\nbusiness\tunits\n\nabout\t/\tBusiness\tunits,\tno\tcomponents\n\ncallback\t/\tOur\tfirst\tprogram\t–\tHello\tWorld calling\tservices\n\nNew\tBusiness\t/\tHow\tto\ttackle\torganic\tgrowth? Renewals\t/\tHow\tto\ttackle\torganic\tgrowth?\n\nChai\t/\tTesting\tmicroservices\tin\tNode.js,\tChai\n\nBDD-style\tinterfaces\t/\tBDD-style\tinterfaces assertions\tinterface\t/\tAssertions\tinterface\n\nChaos\tGorilla\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nChaos\tMonkey\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nChef\n\nURL\t/\tInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2\n\ncircuit\tbreakers\n\nURL\t/\tCircuit\tbreakers\n\nCMD\tcommand",
      "content_length": 712,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 327,
      "content": "about\t/\tAutomating\tDocker\tcontainer\tcreation\n\ncode\treviews\n\neffective\tways\t/\tEffective\tcode\treviews\n\ncommunications\tservice\n\nabout\t/\tThen\tthe\tmicroservices\tappeared\n\nconfiguration\tmanagement\n\nabout\t/\tDocker\t–\ta\tcontainer\tfor\tsoftware\tdelivery\n\ncontainer\n\nsetting\tup\t/\tSetting\tup\tthe\tcontainer executing\t/\tRunning\tthe\tcontainer creation,\tautomating\t/\tAutomating\tDocker\tcontainer\tcreation\n\ncontinuous\tdelivery\t(CD)\n\nabout\t/\tContinuous\tdelivery\n\ncontinuous\tintegration\t(CI)\n\nabout\t/\tContinuous\tintegration\n\nConway's\tLaw\n\nabout\t/\tHow\tto\ttackle\torganic\tgrowth?\n\ncost\tof\tchange\tcurve\n\nabout\t/\tConcepts\tin\tsoftware\tdeployment\n\ncounter\tmetric\n\nabout\t/\tCounter\n\nCross-site\trequest\tforgery\t(CSRF)",
      "content_length": 686,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 328,
      "content": "D\n\nabout\t/\tCross-site\trequest\tforgery\n\ncross-site\tscripting\n\nabout\t/\tCross-site\tscripting output\tencoding\t/\tOutput\tencoding\n\nCRUD\t(Create\tRead\tUpdate\tDelete)\n\nabout\t/\tTechnology\theterogeneity\n\ncryptography\talgorithm\t/\tSSH\t–\tencrypting\tthe\tcommunications curl\n\nabout\t/\tDiagnosing\tproblems\n\ncustom\tmetrics\n\nabout\t/\tCustom\tmetrics simple\tmetric\t/\tSimple\tmetric counter\tmetric\t/\tCounter average\tcalculated\tvalues\tmetric\t/\tAverage\tcalculated\tvalues\n\ndata\taccess\tobject\t(DAO)\tpattern\t/\tModular\torganization\tbest practices debugging\n\nabout\t/\tDebugging\n\ndecentralization\n\nabout\t/\tDecentralization\n\ndefinition\tfunction\t/\tWriting\tplugins deliver\tearly\n\nreference\tlink\t/\tFirst,\tthere\twas\tthe\tmonolith about\t/\tFirst,\tthere\twas\tthe\tmonolith",
      "content_length": 727,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 329,
      "content": "E\n\ndeliver\toften\n\nreference\tlink\t/\tFirst,\tthere\twas\tthe\tmonolith about\t/\tFirst,\tthere\twas\tthe\tmonolith\n\nDocker\n\nabout\t/\tContinuous\tdelivery,\tDocker\t–\ta\tcontainer\tfor\tsoftware delivery container,\tsetting\tup\t/\tSetting\tup\tthe\tcontainer installing\t/\tInstalling\tDocker URL\t/\tInstalling\tDocker image,\tselecting\t/\tChoosing\tthe\timage container,\texecuting\t/\tRunning\tthe\tcontainer Node.js,\tinstalling\t/\tInstalling\tthe\trequired\tsoftware modifications,\tsaving\t/\tSaving\tthe\tchanges Node.js\tapplications,\tdeploying\t/\tDeploying\tNode.js\tapplications container\tcreation,\tautomating\t/\tAutomating\tDocker\tcontainer creation\n\nDocker\tMachine\n\nabout\t/\tDeploying\tNode.js\tapplications\n\nDoctor\tMonkey\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nDocument\tObject\tModel\t(DOM)\t/\tJavascript domain-specific\tlanguage\t(DSL)\t/\tMocha\n\nabout\t/\tAutomating\tDocker\tcontainer\tcreation\n\nemailer\n\nabout\t/\tThe\temailer\t–\ta\tcommon\tproblem e-mails,\tsending\t/\tHow\tto\tsend\te-mails",
      "content_length": 947,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 330,
      "content": "interface,\tdefining\t/\tDefining\tthe\tinterface Mandrill,\tsetting\tup\t/\tSetting\tup\tMandrill Mandrill,\tintegrating\tin\tmicroservice\t/\tHands\ton\t–\tintegrating Mandrill\tin\tyour\tmicroservice fallback\tstrategy\t/\tThe\tfallback\tstrategy\n\nECMAScript\t6\n\nabout\t/\tThe\tfuture\tof\tNode.js\n\nemailer\n\nabout\t/\tMicromerce\t–\tthe\tbig\tpicture\n\nend-to-end\ttesting\n\nabout\t/\tEnd-to-end\ttesting\n\nend-to-end\ttests\t/\tEnd-to-end\ttests Enterprise\tService\tBus\t(ESB)\n\nabout\t/\tSOA\tversus\tmicroservices\n\nENV\tcommand\n\nabout\t/\tAutomating\tDocker\tcontainer\tcreation\n\nEuropean\tComputer\tManufacturers\tAssociation\t(ECMA)\n\nabout\t/\tThe\tfuture\tof\tNode.js\n\nevent\tloop,\tNode.js\n\nabout\t/\tNode.js\tevent\tloop\t–\teasy\tto\tlearn\tand\thard\tto\tmaster\n\nexceptions\t/\tSingle-threaded\tapplications\tand\texceptions EXPOSE\tcommand\n\nabout\t/\tAutomating\tDocker\tcontainer\tcreation\n\nExpress\t/\tNeed\tfor\tNode.js,\tWeb\tserver\tintegration",
      "content_length": 859,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 331,
      "content": "F\n\nH\n\nintegrating\twith\t/\tIntegrating\twith\tExpress\t–\thow\tto\tcreate\ta REST\tAPI\n\nforever\t/\tNeed\tfor\tNode.js,\tSingle-threaded\tapplications\tand exceptions functional\ttesting\n\nabout\t/\tFunctional\ttesting automated\ttesting\t/\tThe\tpyramid\tof\tautomated\ttesting\n\nhardware\tresource\tmetrics\n\nmemory\tmetrics\t/\tMonitoring\tservices CPU\tutilization\t/\tMonitoring\tservices disk\tutilization\t/\tMonitoring\tservices\n\nhealth\tcheck\n\nabout\t/\tHealth\tcheck\ton\tNGINX passive\thealth\tcheck\t/\tPassive\thealth\tcheck active\thealth\tcheck\t/\tActive\thealth\tcheck\n\nHello\tWorld\tprogram\t/\tOur\tfirst\tprogram\t–\tHello\tWorld highly\tcohesive\tbusiness\tunit\n\nabout\t/\tBusiness\tunits,\tno\tcomponents\n\nHTTP\tcodes\n\nabout\t/\tHTTP\tcodes 1xx\t-\tinformational\t/\t1xx\t–\tinformational 2xx\t-\tsuccess\tcodes\t/\t2xx\t–\tsuccess\tcodes 3xx\t-\tredirection\t/\t3xx\t–\tredirection 4xx\t-\tclient\terrors\t/\t4xx\t–\tclient\terrors 5xx\t-\tserver\terrors\t/\t5xx\t–\tserver\terrors",
      "content_length": 884,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 332,
      "content": "I\n\nJ\n\nin\tmicroservices,\timportance\t/\tWhy\tHTTP\tcodes\tmatter\tin microservices\n\nHyper\tText\tTransfer\tProtocol\t(HTTP)\n\nabout\t/\tSmart\tservices,\tdumb\tcommunication\tpipes\n\nindependence\n\nabout\t/\tIndependence\n\ninfrastructure\tlogical\tsecurity\n\nabout\t/\tInfrastructure\tlogical\tsecurity\n\ninjection\n\nabout\t/\tInjection input\tvalidation\t/\tInput\tvalidation\n\ninput\tvalidation\n\nabout\t/\tInput\tvalidation\n\nintegration\ttests\t/\tIntegration\ttests IP\thashing\n\nabout\t/\tLoad\tbalancing\tour\tapplication\n\nJava\tRemote\tMethod\tInvocation\t(RMI)\n\nabout\t/\tTechnology\talignment\n\nJavaScript\t/\tJavascript JavaScript\tObject\tNotation\t(JSON)",
      "content_length": 598,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 333,
      "content": "K\n\nL\n\nabout\t/\tProduct\tManager\t–\tthe\ttwo-faced\tcore\n\nJSON\t/\tDocumenting\tAPIs\twith\tSwagger\n\nkey\tbenefits\n\nresilience\t/\tResilience scalability\t/\tScalability technology\theterogeneity\t/\tTechnology\theterogeneity replaceability\t/\tReplaceability independence\t/\tIndependence easy\tto\tdeploy\t/\tEasy\tto\tdeploy\n\nkey\tdesign\tprinciples\n\nabout\t/\tKey\tdesign\tprinciples business\tunits\t/\tBusiness\tunits,\tno\tcomponents smart\tservices\t/\tSmart\tservices,\tdumb\tcommunication\tpipes decentralization\t/\tDecentralization technology\talignment\t/\tTechnology\talignment small\tsize\t/\tHow\tsmall\tis\ttoo\tsmall?\n\nKeymetrics\n\nused,\tfor\tmonitoring\tservices\t/\tMonitoring\tusing\tPM2\tand Keymetrics about\t/\tMonitoring\tusing\tPM2\tand\tKeymetrics URL\t/\tMonitoring\tusing\tPM2\tand\tKeymetrics used,\tfor\tdiagnosing\tproblems\t/\tDiagnosing\tproblems used,\tfor\tmonitoring\tapplication\texceptions\t/\tMonitoring application\texceptions custom\tmetrics\t/\tCustom\tmetrics\n\nlatency",
      "content_length": 913,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 334,
      "content": "M\n\nabout\t/\tThroughput\tand\tperformance\tdegradation\n\nLatency\tMonkey\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nleast\tconnected\tnode\n\nabout\t/\tLoad\tbalancing\tour\tapplication\n\nlibuv\tlibrary\n\nabout\t/\tNode.js\tevent\tloop\t–\teasy\tto\tlearn\tand\thard\tto\tmaster\n\nload\tbalancing\n\nof\tNode.js\tapplications\t/\tLoad\tbalancing\tour\tapplication\n\nlogging\n\nabout\t/\tLogging\n\nlogging,\tlevels\t/\tAuditing\n\nDEBUG\t/\tAuditing INFO\t/\tAuditing WAR\t/\tAuditing FATAL\t/\tAuditing\n\nloosely\tcoupled\tbusiness\tunit\n\nabout\t/\tBusiness\tunits,\tno\tcomponents\n\n10-18\tMonkey\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nMandrill",
      "content_length": 609,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 335,
      "content": "setting\tup\t/\tSetting\tup\tMandrill URL\t/\tSetting\tup\tMandrill,\tHands\ton\t–\tintegrating\tMandrill\tin your\tmicroservice integrating,\tin\tmicroservice\t/\tHands\ton\t–\tintegrating\tMandrill\tin your\tmicroservice\n\nmanual\ttesting\n\nabout\t/\tManual\ttesting\t–\tthe\tnecessary\tevil proxy,\tbuilding\tto\tdebug\tmicroservices\t/\tBuilding\ta\tproxy\tto debug\tour\tmicroservices Postman\t/\tPostman\n\nmemory\tleak\n\nabout\t/\tDiagnosing\tproblems\n\nmicromerce\n\nabout\t/\tMicromerce\t–\tthe\tbig\tpicture deploying,\tPM2\tused\t/\tDeploying\tmicroservices\twith\tPM2\n\nmicroservice\n\ntesting\t/\tTesting\ta\treal\tmicroservice\n\nmicroservices\n\nneed\tfor\t/\tNeed\tfor\tmicroservices in\treal\tworld\t/\tMicroservices\tin\tthe\treal\tworld versus\tService-Oriented\tArchitectures\t(SOA)\t/\tSOA\tversus microservices evolution\t/\tThen\tthe\tmicroservices\tappeared disadvantages\t/\tDisadvantages monolith,\tsplitting\t/\tSplitting\tthe\tmonolith testing,\tin\tNode.js\t/\tTesting\tmicroservices\tin\tNode.js documenting\t/\tDocumenting\tmicroservices APIs,\tdocumenting\twith\tSwagger\t/\tDocumenting\tAPIs\twith Swagger project,\tgenerating\tfrom\tSwagger\tdefinition\t/\tGenerating\ta",
      "content_length": 1065,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 336,
      "content": "N\n\nproject\tfrom\tthe\tSwagger\tdefinition\n\nmicroservices-oriented\tarchitectures\n\nabout\t/\tMicroservice-oriented\tarchitectures benefits\t/\tHow\tis\tit\tbetter? shortcomings\t/\tShortcomings\n\nMocha\t/\tTesting\tmicroservices\tin\tNode.js\n\nabout\t/\tMocha\n\nmongo-store\n\nURL\t/\tWiring\teverything\tup\n\nMongoDB\n\nURL\t/\tProduct\tManager\t–\tthe\ttwo-faced\tcore\n\nmonolith\n\nabout\t/\tFirst,\tthere\twas\tthe\tmonolith organic\tgrowth,\ttackling\t/\tHow\tto\ttackle\torganic\tgrowth? abstraction\tcapacity\t/\tHow\tabstract\tis\ttoo\tabstract? splitting\t/\tSplitting\tthe\tmonolith problems,\tin\tsplitting\t/\tProblems\tsplitting\tthe\tmonolith\t–\tit\tis\tall about\tthe\tdata\n\nmonolithic\tsoftware\n\nabout\t/\tMonolithic\tsoftware\n\nmonolithic\tsoftware\tarchitecture\n\nabout\t/\tMonolithic\tsoftware\n\nNetflix",
      "content_length": 729,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 337,
      "content": "about\t/\tMicroservices\tin\tthe\treal\tworld\n\nnetwork\tlatency\n\nabout\t/\tShortcomings\n\nNGINX\n\nabout\t/\tLoad\tbalancing\tour\tapplication using\t/\tLoad\tbalancing\tour\tapplication URL\t/\tLoad\tbalancing\tour\tapplication health\tcheck\t/\tHealth\tcheck\ton\tNGINX\n\nNode.js\n\nneed\tfor\t/\tWhy\tNode.js?,\tNeed\tfor\tNode.js API\taggregation\t/\tAPI\taggregation future\t/\tThe\tfuture\tof\tNode.js installing\t/\tInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2,\tInstalling the\trequired\tsoftware URL\t/\tInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2 threading\tmodel\t/\tNode.js\tthreading\tmodel modular\torganization\tbest\tpractices\t/\tModular\torganization\tbest practices JavaScript\t/\tJavascript SOLID\t/\tSOLID\tdesign\tprinciples microservices,\ttesting\t/\tTesting\tmicroservices\tin\tNode.js Chai\t/\tChai BDD-style\tinterfaces\t/\tBDD-style\tinterfaces assertions\tinterface\t/\tAssertions\tinterface Mocha\t/\tMocha Sinon\t/\tSinon.JS\t–\ta\tmocking\tframework real\tmicroservice,\ttesting\t/\tTesting\ta\treal\tmicroservice Test-driven\tdevelopment\t(TDD)\t/\tTDD\t–\tTest-driven development event\tloop\t/\tNode.js\tevent\tloop\t–\teasy\tto\tlearn\tand\thard\tto master\n\nNode.js\tapplications",
      "content_length": 1081,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 338,
      "content": "O\n\ndeploying\t/\tDeploying\tNode.js\tapplications clustering\t/\tClustering\tNode.js\tapplications load\tbalancing\t/\tLoad\tbalancing\tour\tapplication\n\nnodemon\t/\tNeed\tfor\tNode.js,\tSingle-threaded\tapplications\tand exceptions Node\tPackage\tManager\t(npm)\t/\tInstalling\tNode.js,\tnpm,\tSeneca, and\tPM2 non-persistent\tXSS\tattacks\t/\tCross-site\tscripting npm\n\nabout\t/\tWhy\tNode.js? installing\t/\tInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2 learning\t/\tLearning\tnpm\n\nNServiceBus\n\nURL\t/\tSeneca\t–\ta\tsimple\tpuzzle\tthat\tmakes\tour\tlives\teasier\n\nObject-relational\tmapping\t(ORM)\t/\tData\tstorage open\tredirects\n\nabout\t/\tOpen\tredirects\n\nOpen\tWeb\tApplication\tSecurity\t(OWASP)\t/\tCommon\tthreats\t–\thow to\tbe\tup\tto\tdate order\tmanager\n\nabout\t/\tMicromerce\t–\tthe\tbig\tpicture,\tThe\torder\tmanager microservice,\tdefining\t/\tDefining\tthe\tmicroservice\t–\thow\tto gather\tnon-local\tdata code\t/\tThe\torder\tmanager\t–\tthe\tcode remote\tservices,\tcalling\t/\tCalling\tremote\tservices resilience,\tover\tperfection\t/\tResilience\tover\tperfection\n\norganic\tgrowth",
      "content_length": 987,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 339,
      "content": "P\n\nabout\t/\tNeed\tfor\tmicroservices,\tFirst,\tthere\twas\tthe\tmonolith tackling\t/\tHow\tto\ttackle\torganic\tgrowth?\n\norganizational\talignment\n\nabout\t/\tOrganizational\talignment\n\npassive\thealth\tcheck\n\nabout\t/\tPassive\thealth\tcheck\n\nPatrun\n\nabout\t/\tInversion\tof\tcontrol\tdone\tright,\tPatrun\t–\ta\tpattern- matching\tlibrary Pclosest\tmatch\t/\tPatrun\t–\ta\tpattern-matching\tlibrary patterns,\treusing\t/\tReusing\tpatterns\n\npersistent\tXSS\tattacks\t/\tCross-site\tscripting PM2\n\ninstalling\t/\tInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2 about\t/\tPM2\t–\ta\ttask\trunner\tfor\tNode.js,\tMonitoring\tusing\tPM2 and\tKeymetrics single-threaded\tapplications\tand\texceptions\t/\tSingle-threaded applications\tand\texceptions using\t/\tUsing\tPM2\t–\tthe\tindustry-standard\ttask\trunner used,\tfor\tmonitoring\tservices\t/\tMonitoring\tusing\tPM2\tand Keymetrics used,\tfor\tsoftware\tdeployment\t/\tDeployments\twith\tPM2 ecosystems\t/\tPM2\t–\tecosystems used,\tfor\tdeploying\tmicromerce\t/\tDeploying\tmicroservices\twith PM2 server,\tconfiguring\t/\tConfiguring\tthe\tserver\n\npmx",
      "content_length": 988,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 340,
      "content": "Q\n\nR\n\nabout\t/\tMonitoring\tapplication\texceptions\n\npolymorphism\tof\tactions\t/\tHands\ton\t–\tintegrating\tMandrill\tin\tyour microservice Postman\t/\tPostman PRG\tpattern\n\nURL\t/\tNeed\tfor\tfrontend\tmicroservice\n\nprobes\n\nabout\t/\tCustom\tmetrics\n\nProduct\tManager\n\nabout\t/\tMicromerce\t–\tthe\tbig\tpicture,\tProduct\tManager\t–\tthe two-faced\tcore products,\tfetching\t/\tFetching\tproducts fetching,\tby\tcategory\t/\tFetching\tby\tcategory fetching,\tby\tID\t/\tFetching\tby\tID product,\tadding\t/\tAdding\ta\tproduct product,\tremoving\t/\tRemoving\ta\tproduct product,\tediting\t/\tEditing\ta\tproduct wiring\t/\tWiring\teverything\tup REST\tAPI,\tcreating\t/\tIntegrating\twith\tExpress\t–\thow\tto\tcreate\ta REST\tAPI Express,\tintegrating\twith\t/\tIntegrating\twith\tExpress\t–\thow\tto create\ta\tREST\tAPI\n\npyramid\tof\ttesting\t/\tHow\tmuch\ttesting\tis\ttoo\tmuch?\n\nqueueing\n\nabout\t/\tThroughput\tand\tperformance\tdegradation",
      "content_length": 841,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 341,
      "content": "S\n\nRabbitMQ\n\nURL\t/\tSeneca\t–\ta\tsimple\tpuzzle\tthat\tmakes\tour\tlives\teasier about\t/\tThroughput\tand\tperformance\tdegradation\n\nRabbitMQ\ttransport\tplugin\n\nURL\t/\tThroughput\tand\tperformance\tdegradation\n\nRegistry\n\nabout\t/\tChoosing\tthe\timage URL\t/\tChoosing\tthe\timage\n\nreplaceability\n\nabout\t/\tReplaceability importance\t/\tWhy\tis\treplaceability\timportant?\n\nresilience\n\nabout\t/\tResilience\n\nrestify\t/\tNeed\tfor\tNode.js Round\tRobin\n\nabout\t/\tLoad\tbalancing\tour\tapplication\n\nRSA\t/\tSSH\t–\tencrypting\tthe\tcommunications run\tcommand,\tparameters\n\nt\tflag\t/\tDeploying\tNode.js\tapplications -i\tflag\t/\tDeploying\tNode.js\tapplications -v\tflag\t/\tDeploying\tNode.js\tapplications -p\tflag\t/\tDeploying\tNode.js\tapplications /bin/bash\tcommand\t/\tDeploying\tNode.js\tapplications\n\nscalability",
      "content_length": 747,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 342,
      "content": "about\t/\tScalability\n\nSecure\tShell\t(SSH)\n\nabout\t/\tSSH\t–\tencrypting\tthe\tcommunications\n\nsecurity\n\ninfrastructure\tlogical\tsecurity\t/\tInfrastructure\tlogical\tsecurity\n\nSeneca\n\nabout\t/\tAPI\taggregation,\tSeneca\t–\ta\tmicroservices\tframework, How\tabstract\tis\ttoo\tabstract?,\tSeneca\t–\ta\tsimple\tpuzzle\tthat makes\tour\tlives\teasier installing\t/\tInstalling\tNode.js,\tnpm,\tSeneca,\tand\tPM2 Inversion\tof\tcontrol\t/\tInversion\tof\tcontrol\tdone\tright pattern\tmatching\t/\tPattern\tmatching\tin\tSeneca plugins,\twriting\t/\tWriting\tplugins web\tserver\tintegration\t/\tWeb\tserver\tintegration as\tExpress\tmiddleware\t/\tSeneca\tas\tExpress\tmiddleware data\tstorage\t/\tData\tstorage and\tpromises\t/\tSeneca\tand\tpromises\n\nseneca-web\t/\tSeneca\tas\tExpress\tmiddleware Service-Oriented\tArchitectures\t(SOA)\n\nabout\t/\tSOA\tversus\tmicroservices versus\tmicroservices\t/\tSOA\tversus\tmicroservices\n\nservices\n\nmonitoring\t/\tMonitoring\tservices monitoring,\tPM2\tused\t/\tMonitoring\tusing\tPM2\tand\tKeymetrics monitoring,\tKeymetrics\tused\t/\tMonitoring\tusing\tPM2\tand Keymetrics\n\nSimian\tArmy\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify",
      "content_length": 1071,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 343,
      "content": "URL\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify throughput\t/\tThroughput\tand\tperformance\tdegradation performance\tdegradation\t/\tThroughput\tand\tperformance degradation\n\nsimple\tmetric\n\nabout\t/\tSimple\tmetric\n\nSingle-Page\tApplication\t(SPA)\n\nabout\t/\tWhy\tNode.js?\n\n/\tMicromerce\t–\tthe\tbig\tpicture single-threaded\tapplications\t/\tSingle-threaded\tapplications\tand exceptions Single\tEuro\tPayments\tArea\t(SEPA)\n\nabout\t/\tHow\tsmall\tis\ttoo\tsmall?\n\nsingle\tpoint\tof\tfailure\n\nabout\t/\tSimian\tArmy\t–\tthe\tactive\tmonitoring\tfrom\tSpotify\n\nSinon\t/\tSinon.JS\t–\ta\tmocking\tframework Sinon.JS\t/\tTesting\tmicroservices\tin\tNode.js Slack\n\nabout\t/\tMonitoring\tapplication\texceptions\n\nsmall\tsize\tmicroservices\n\nabout\t/\tHow\tsmall\tis\ttoo\tsmall?\n\nsmart\tservices\n\nabout\t/\tSmart\tservices,\tdumb\tcommunication\tpipes\n\nSOAP\n\nabout\t/\tWhy\tis\treplaceability\timportant?",
      "content_length": 824,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 344,
      "content": "Software\tas\ta\tservice\t(SaaS)\n\nabout\t/\tMonitoring\tusing\tPM2\tand\tKeymetrics\n\nsoftware\tdeployment\n\nconcepts\t/\tConcepts\tin\tsoftware\tdeployment continuous\tintegration\t(CI)\t/\tContinuous\tintegration continuous\tdelivery\t(CD)\t/\tContinuous\tdelivery with\tPM2\t/\tDeployments\twith\tPM2\n\nSoftware\tDevelopment\tLife\tCycle\t(SDLC)\n\nabout\t/\tConcepts\tin\tsoftware\tdeployment\n\nSOLID\n\nabout\t/\tSOLID\tdesign\tprinciples principles\t/\tSOLID\tdesign\tprinciples\n\nSOLID\tdesign\tprinciples\n\nsingle-responsibility\tprinciple\t/\tThen\tthe\tmicroservices\tappeared open\tfor\textension,\tclosed\tfor\tmodification\t/\tThen\tthe microservices\tappeared Liskov\tsubstitution\t/\tThen\tthe\tmicroservices\tappeared interface\tsegregation\t/\tThen\tthe\tmicroservices\tappeared dependency\tinjection\t/\tThen\tthe\tmicroservices\tappeared\n\nSpotify\n\nabout\t/\tMicroservices\tin\tthe\treal\tworld,\tSimian\tArmy\t–\tthe\tactive monitoring\tfrom\tSpotify\n\nSTARS\n\nabout\t/\tChoosing\tthe\timage\n\nStubs\t/\tSinon.JS\t–\ta\tmocking\tframework Swagger",
      "content_length": 946,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 345,
      "content": "T\n\nU\n\nAPIs,\tdocumenting\twith\t/\tDocumenting\tAPIs\twith\tSwagger\n\ntechnical\tdebt\n\nabout\t/\tWhy\tis\treplaceability\timportant?\n\ntechnology\talignment\n\nabout\t/\tTechnology\talignment\n\ntechnology\theterogeneity\n\nabout\t/\tTechnology\talignment,\tTechnology\theterogeneity\n\nTest-driven\tdevelopment\t(TDD)\t/\tFunctional\ttesting\n\nabout\t/\tTDD\t–\tTest-driven\tdevelopment\n\nThreadLocal\n\nabout\t/\tNode.js\tevent\tloop\t–\teasy\tto\tlearn\tand\thard\tto\tmaster\n\ntraceability\n\nabout\t/\tTraceability logging\t/\tLogging tracing\trequests\t/\tTracing\trequests auditing\t/\tAuditing HTTP\tcodes\t/\tHTTP\tcodes\n\ntracing\trequests\n\nabout\t/\tTracing\trequests\n\nUI\t-\tAPI\taggregation",
      "content_length": 619,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 346,
      "content": "V\n\nW\n\nX\n\nabout\t/\tMicromerce\t–\tthe\tbig\tpicture,\tThe\tUI\t–\tAPI\taggregation frontend\tmicroservice,\tneed\tfor\t/\tNeed\tfor\tfrontend\tmicroservice code\t/\tThe\tcode service\tdegradation\t/\tService\tdegradation\t–\twhen\tthe\tfailure\tis not\ta\tdisaster circuit\tbreakers\t/\tCircuit\tbreakers Seneca\tpuzzle\t/\tSeneca\t–\ta\tsimple\tpuzzle\tthat\tmakes\tour\tlives easier Seneca,\tand\tpromises\t/\tSeneca\tand\tpromises\n\nunit\ttesting\n\nabout\t/\tUnit\ttesting\n\nunit\ttests\t/\tUnit\ttests\n\nVagrant\n\nURL\t/\tSSH\t–\tencrypting\tthe\tcommunications\n\nwhite\tbox\ttesting\t/\tUnit\ttests white\tlist\n\nabout\t/\tInput\tvalidation\n\nWORKDIR\tcommand\n\nabout\t/\tAutomating\tDocker\tcontainer\tcreation\n\nworkers\n\nabout\t/\tNode.js\tevent\tloop\t–\teasy\tto\tlearn\tand\thard\tto\tmaster",
      "content_length": 696,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 347,
      "content": "Y\n\nXSS\tattacks\n\npersistent\t/\tCross-site\tscripting non-persistent\t/\tCross-site\tscripting\n\nYet\tAnother\tMarkup\tLanguage\t(YAML)\t/\tDocumenting\tAPIs\twith Swagger",
      "content_length": 155,
      "extraction_method": "Unstructured"
    }
  ]
}
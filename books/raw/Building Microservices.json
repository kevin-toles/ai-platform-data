{
  "metadata": {
    "title": "Building Microservices",
    "author": "Sam Newman",
    "publisher": "Unknown Publisher",
    "edition": "1st Edition",
    "isbn": "",
    "total_pages": 473,
    "conversion_date": "2025-12-19T18:21:22.360567",
    "conversion_method": "PyMuPDF + OCR fallback",
    "source_pdf": "Building Microservices.pdf",
    "extraction_method": "Unstructured"
  },
  "chapters": [
    {
      "number": 1,
      "title": "Microservices",
      "start_page": 15,
      "end_page": 34,
      "detection_method": "regex_chapter_title",
      "content": "What\tAre\tMicroservices?\n\nMicroservices\tare\tsmall,\tautonomous\tservices\tthat\twork\ttogether.\tLet’s\tbreak\tthat definition\tdown\ta\tbit\tand\tconsider\tthe\tcharacteristics\tthat\tmake\tmicroservices\tdifferent.\n\nSmall,\tand\tFocused\ton\tDoing\tOne\tThing\tWell\n\nCodebases\tgrow\tas\twe\twrite\tcode\tto\tadd\tnew\tfeatures.\tOver\ttime,\tit\tcan\tbe\tdifficult\tto know\twhere\ta\tchange\tneeds\tto\tbe\tmade\tbecause\tthe\tcodebase\tis\tso\tlarge.\tDespite\ta\tdrive for\tclear,\tmodular\tmonolithic\tcodebases,\tall\ttoo\toften\tthese\tarbitrary\tin-process boundaries\tbreak\tdown.\tCode\trelated\tto\tsimilar\tfunctions\tstarts\tto\tbecome\tspread\tall\tover, making\tfixing\tbugs\tor\timplementations\tmore\tdifficult.\n\nWithin\ta\tmonolithic\tsystem,\twe\tfight\tagainst\tthese\tforces\tby\ttrying\tto\tensure\tour\tcode\tis more\tcohesive,\toften\tby\tcreating\tabstractions\tor\tmodules.\tCohesion\t—\tthe\tdrive\tto\thave related\tcode\tgrouped\ttogether\t—\tis\tan\timportant\tconcept\twhen\twe\tthink\tabout microservices.\tThis\tis\treinforced\tby\tRobert\tC.\tMartin’s\tdefinition\tof\tthe\tSingle Responsibility\tPrinciple,\twhich\tstates\t“Gather\ttogether\tthose\tthings\tthat\tchange\tfor\tthe same\treason,\tand\tseparate\tthose\tthings\tthat\tchange\tfor\tdifferent\treasons.”\n\nMicroservices\ttake\tthis\tsame\tapproach\tto\tindependent\tservices.\tWe\tfocus\tour\tservice boundaries\ton\tbusiness\tboundaries,\tmaking\tit\tobvious\twhere\tcode\tlives\tfor\ta\tgiven\tpiece of\tfunctionality.\tAnd\tby\tkeeping\tthis\tservice\tfocused\ton\tan\texplicit\tboundary,\twe\tavoid the\ttemptation\tfor\tit\tto\tgrow\ttoo\tlarge,\twith\tall\tthe\tassociated\tdifficulties\tthat\tthis\tcan introduce.\n\nThe\tquestion\tI\tam\toften\tasked\tis\thow\tsmall\tis\tsmall?\tGiving\ta\tnumber\tfor\tlines\tof\tcode\tis problematic,\tas\tsome\tlanguages\tare\tmore\texpressive\tthan\tothers\tand\tcan\ttherefore\tdo more\tin\tfewer\tlines\tof\tcode.\tWe\tmust\talso\tconsider\tthe\tfact\tthat\twe\tcould\tbe\tpulling\tin multiple\tdependencies,\twhich\tthemselves\tcontain\tmany\tlines\tof\tcode.\tIn\taddition,\tsome part\tof\tyour\tdomain\tmay\tbe\tlegitimately\tcomplex,\trequiring\tmore\tcode.\tJon\tEaves\tat RealEstate.com.au\tin\tAustralia\tcharacterizes\ta\tmicroservice\tas\tsomething\tthat\tcould\tbe rewritten\tin\ttwo\tweeks,\ta\trule\tof\tthumb\tthat\tmakes\tsense\tfor\this\tparticular\tcontext.\n\nAnother\tsomewhat\ttrite\tanswer\tI\tcan\tgive\tis\tsmall\tenough\tand\tno\tsmaller.\tWhen\tspeaking at\tconferences,\tI\tnearly\talways\task\tthe\tquestion\twho\thas\ta\tsystem\tthat\tis\ttoo\tbig\tand\tthat you’d\tlike\tto\tbreak\tdown?\tNearly\teveryone\traises\ttheir\thands.\tWe\tseem\tto\thave\ta\tvery good\tsense\tof\twhat\tis\ttoo\tbig,\tand\tso\tit\tcould\tbe\targued\tthat\tonce\ta\tpiece\tof\tcode\tno longer\tfeels\ttoo\tbig,\tit’s\tprobably\tsmall\tenough.\n\nA\tstrong\tfactor\tin\thelping\tus\tanswer\thow\tsmall?\tis\thow\twell\tthe\tservice\taligns\tto\tteam structures.\tIf\tthe\tcodebase\tis\ttoo\tbig\tto\tbe\tmanaged\tby\ta\tsmall\tteam,\tlooking\tto\tbreak\tit down\tis\tvery\tsensible.\tWe’ll\ttalk\tmore\tabout\torganizational\talignment\tlater\ton.\n\nWhen\tit\tcomes\tto\thow\tsmall\tis\tsmall\tenough,\tI\tlike\tto\tthink\tin\tthese\tterms:\tthe\tsmaller\tthe service,\tthe\tmore\tyou\tmaximize\tthe\tbenefits\tand\tdownsides\tof\tmicroservice\tarchitecture. As\tyou\tget\tsmaller,\tthe\tbenefits\taround\tinterdependence\tincrease.\tBut\tso\ttoo\tdoes\tsome\tof the\tcomplexity\tthat\temerges\tfrom\thaving\tmore\tand\tmore\tmoving\tparts,\tsomething\tthat\twe will\texplore\tthroughout\tthis\tbook.\tAs\tyou\tget\tbetter\tat\thandling\tthis\tcomplexity,\tyou\tcan strive\tfor\tsmaller\tand\tsmaller\tservices.\n\nAutonomous\n\nOur\tmicroservice\tis\ta\tseparate\tentity.\tIt\tmight\tbe\tdeployed\tas\tan\tisolated\tservice\ton\ta platform\tas\ta\tservice\t(PAAS),\tor\tit\tmight\tbe\tits\town\toperating\tsystem\tprocess.\tWe\ttry\tto avoid\tpacking\tmultiple\tservices\tonto\tthe\tsame\tmachine,\talthough\tthe\tdefinition\tof machine\tin\ttoday’s\tworld\tis\tpretty\thazy!\tAs\twe’ll\tdiscuss\tlater,\talthough\tthis\tisolation\tcan add\tsome\toverhead,\tthe\tresulting\tsimplicity\tmakes\tour\tdistributed\tsystem\tmuch\teasier\tto reason\tabout,\tand\tnewer\ttechnologies\tare\table\tto\tmitigate\tmany\tof\tthe\tchallenges associated\twith\tthis\tform\tof\tdeployment.\n\nAll\tcommunication\tbetween\tthe\tservices\tthemselves\tare\tvia\tnetwork\tcalls,\tto\tenforce separation\tbetween\tthe\tservices\tand\tavoid\tthe\tperils\tof\ttight\tcoupling.\n\nThese\tservices\tneed\tto\tbe\table\tto\tchange\tindependently\tof\teach\tother,\tand\tbe\tdeployed\tby themselves\twithout\trequiring\tconsumers\tto\tchange.\tWe\tneed\tto\tthink\tabout\twhat\tour services\tshould\texpose,\tand\twhat\tthey\tshould\tallow\tto\tbe\thidden.\tIf\tthere\tis\ttoo\tmuch sharing,\tour\tconsuming\tservices\tbecome\tcoupled\tto\tour\tinternal\trepresentations.\tThis decreases\tour\tautonomy,\tas\tit\trequires\tadditional\tcoordination\twith\tconsumers\twhen making\tchanges.\n\nOur\tservice\texposes\tan\tapplication\tprogramming\tinterface\t(API),\tand\tcollaborating services\tcommunicate\twith\tus\tvia\tthose\tAPIs.\tWe\talso\tneed\tto\tthink\tabout\twhat technology\tis\tappropriate\tto\tensure\tthat\tthis\titself\tdoesn’t\tcouple\tconsumers.\tThis\tmay mean\tpicking\ttechnology-agnostic\tAPIs\tto\tensure\tthat\twe\tdon’t\tconstrain\ttechnology choices.\tWe’ll\tcome\tback\ttime\tand\tagain\tto\tthe\timportance\tof\tgood,\tdecoupled\tAPIs throughout\tthis\tbook.\n\nWithout\tdecoupling,\teverything\tbreaks\tdown\tfor\tus.\tThe\tgolden\trule:\tcan\tyou\tmake\ta change\tto\ta\tservice\tand\tdeploy\tit\tby\titself\twithout\tchanging\tanything\telse?\tIf\tthe\tanswer\tis no,\tthen\tmany\tof\tthe\tadvantages\twe\tdiscuss\tthroughout\tthis\tbook\twill\tbe\thard\tfor\tyou\tto achieve.\n\nTo\tdo\tdecoupling\twell,\tyou’ll\tneed\tto\tmodel\tyour\tservices\tright\tand\tget\tthe\tAPIs\tright.\tI’ll be\ttalking\tabout\tthat\ta\tlot.\n\nKey\tBenefits\n\nThe\tbenefits\tof\tmicroservices\tare\tmany\tand\tvaried.\tMany\tof\tthese\tbenefits\tcan\tbe\tlaid\tat the\tdoor\tof\tany\tdistributed\tsystem.\tMicroservices,\thowever,\ttend\tto\tachieve\tthese\tbenefits to\ta\tgreater\tdegree\tprimarily\tdue\tto\thow\tfar\tthey\ttake\tthe\tconcepts\tbehind\tdistributed systems\tand\tservice-oriented\tarchitecture.\n\nTechnology\tHeterogeneity\n\nWith\ta\tsystem\tcomposed\tof\tmultiple,\tcollaborating\tservices,\twe\tcan\tdecide\tto\tuse\tdifferent technologies\tinside\teach\tone.\tThis\tallows\tus\tto\tpick\tthe\tright\ttool\tfor\teach\tjob,\trather\tthan having\tto\tselect\ta\tmore\tstandardized,\tone-size-fits-all\tapproach\tthat\toften\tends\tup\tbeing the\tlowest\tcommon\tdenominator.\n\nIf\tone\tpart\tof\tour\tsystem\tneeds\tto\timprove\tits\tperformance,\twe\tmight\tdecide\tto\tuse\ta different\ttechnology\tstack\tthat\tis\tbetter\table\tto\tachieve\tthe\tperformance\tlevels\trequired. We\tmay\talso\tdecide\tthat\thow\twe\tstore\tour\tdata\tneeds\tto\tchange\tfor\tdifferent\tparts\tof\tour system.\tFor\texample,\tfor\ta\tsocial\tnetwork,\twe\tmight\tstore\tour\tusers’\tinteractions\tin\ta graph-oriented\tdatabase\tto\treflect\tthe\thighly\tinterconnected\tnature\tof\ta\tsocial\tgraph,\tbut perhaps\tthe\tposts\tthe\tusers\tmake\tcould\tbe\tstored\tin\ta\tdocument-oriented\tdata\tstore,\tgiving rise\tto\ta\theterogeneous\tarchitecture\tlike\tthe\tone\tshown\tin\tFigure\t1-1.\n\nFigure\t1-1.\tMicroservices\tcan\tallow\tyou\tto\tmore\teasily\tembrace\tdifferent\ttechnologies\n\nWith\tmicroservices,\twe\tare\talso\table\tto\tadopt\ttechnology\tmore\tquickly,\tand\tunderstand how\tnew\tadvancements\tmay\thelp\tus.\tOne\tof\tthe\tbiggest\tbarriers\tto\ttrying\tout\tand adopting\tnew\ttechnology\tis\tthe\trisks\tassociated\twith\tit.\tWith\ta\tmonolithic\tapplication,\tif\tI want\tto\ttry\ta\tnew\tprogramming\tlanguage,\tdatabase,\tor\tframework,\tany\tchange\twill\timpact a\tlarge\tamount\tof\tmy\tsystem.\tWith\ta\tsystem\tconsisting\tof\tmultiple\tservices,\tI\thave multiple\tnew\tplaces\tin\twhich\tto\ttry\tout\ta\tnew\tpiece\tof\ttechnology.\tI\tcan\tpick\ta\tservice\tthat is\tperhaps\tlowest\trisk\tand\tuse\tthe\ttechnology\tthere,\tknowing\tthat\tI\tcan\tlimit\tany\tpotential negative\timpact.\tMany\torganizations\tfind\tthis\tability\tto\tmore\tquickly\tabsorb\tnew technologies\tto\tbe\ta\treal\tadvantage\tfor\tthem.\n\nEmbracing\tmultiple\ttechnologies\tdoesn’t\tcome\twithout\tan\toverhead,\tof\tcourse.\tSome organizations\tchoose\tto\tplace\tsome\tconstraints\ton\tlanguage\tchoices.\tNetflix\tand\tTwitter, for\texample,\tmostly\tuse\tthe\tJava\tVirtual\tMachine\t(JVM)\tas\ta\tplatform,\tas\tthey\thave\ta very\tgood\tunderstanding\tof\tthe\treliability\tand\tperformance\tof\tthat\tsystem.\tThey\talso develop\tlibraries\tand\ttooling\tfor\tthe\tJVM\tthat\tmake\toperating\tat\tscale\tmuch\teasier,\tbut make\tit\tmore\tdifficult\tfor\tnon-Java-based\tservices\tor\tclients.\tBut\tneither\tTwitter\tnor Netflix\tuse\tonly\tone\ttechnology\tstack\tfor\tall\tjobs,\teither.\tAnother\tcounterpoint\tto\tconcerns\n\nabout\tmixing\tin\tdifferent\ttechnologies\tis\tthe\tsize.\tIf\tI\treally\tcan\trewrite\tmy\tmicroservice in\ttwo\tweeks,\tyou\tmay\twell\tmitigate\tthe\trisks\tof\tembracing\tnew\ttechnology.\n\nAs\tyou’ll\tfind\tthroughout\tthis\tbook,\tjust\tlike\tmany\tthings\tconcerning\tmicroservices,\tit’s all\tabout\tfinding\tthe\tright\tbalance.\tWe’ll\tdiscuss\thow\tto\tmake\ttechnology\tchoices\tin Chapter\t2,\twhich\tfocuses\ton\tevolutionary\tarchitecture;\tand\tin\tChapter\t4,\twhich\tdeals\twith integration,\tyou’ll\tlearn\thow\tto\tensure\tthat\tyour\tservices\tcan\tevolve\ttheir\ttechnology independently\tof\teach\tother\twithout\tundue\tcoupling.\n\nResilience\n\nA\tkey\tconcept\tin\tresilience\tengineering\tis\tthe\tbulkhead.\tIf\tone\tcomponent\tof\ta\tsystem fails,\tbut\tthat\tfailure\tdoesn’t\tcascade,\tyou\tcan\tisolate\tthe\tproblem\tand\tthe\trest\tof\tthe system\tcan\tcarry\ton\tworking.\tService\tboundaries\tbecome\tyour\tobvious\tbulkheads.\tIn\ta monolithic\tservice,\tif\tthe\tservice\tfails,\teverything\tstops\tworking.\tWith\ta\tmonolithic system,\twe\tcan\trun\ton\tmultiple\tmachines\tto\treduce\tour\tchance\tof\tfailure,\tbut\twith microservices,\twe\tcan\tbuild\tsystems\tthat\thandle\tthe\ttotal\tfailure\tof\tservices\tand\tdegrade functionality\taccordingly.\n\nWe\tdo\tneed\tto\tbe\tcareful,\thowever.\tTo\tensure\tour\tmicroservice\tsystems\tcan\tproperly embrace\tthis\timproved\tresilience,\twe\tneed\tto\tunderstand\tthe\tnew\tsources\tof\tfailure\tthat distributed\tsystems\thave\tto\tdeal\twith.\tNetworks\tcan\tand\twill\tfail,\tas\twill\tmachines.\tWe need\tto\tknow\thow\tto\thandle\tthis,\tand\twhat\timpact\t(if\tany)\tit\tshould\thave\ton\tthe\tend\tuser of\tour\tsoftware.\n\nWe’ll\ttalk\tmore\tabout\tbetter\thandling\tresilience,\tand\thow\tto\thandle\tfailure\tmodes,\tin Chapter\t11.\n\nScaling\n\nWith\ta\tlarge,\tmonolithic\tservice,\twe\thave\tto\tscale\teverything\ttogether.\tOne\tsmall\tpart\tof our\toverall\tsystem\tis\tconstrained\tin\tperformance,\tbut\tif\tthat\tbehavior\tis\tlocked\tup\tin\ta giant\tmonolithic\tapplication,\twe\thave\tto\thandle\tscaling\teverything\tas\ta\tpiece.\tWith smaller\tservices,\twe\tcan\tjust\tscale\tthose\tservices\tthat\tneed\tscaling,\tallowing\tus\tto\trun other\tparts\tof\tthe\tsystem\ton\tsmaller,\tless\tpowerful\thardware,\tlike\tin\tFigure\t1-2.\n\nFigure\t1-2.\tYou\tcan\ttarget\tscaling\tat\tjust\tthose\tmicroservices\tthat\tneed\tit\n\nGilt,\tan\tonline\tfashion\tretailer,\tadopted\tmicroservices\tfor\tthis\texact\treason.\tStarting\tin 2007\twith\ta\tmonolithic\tRails\tapplication,\tby\t2009\tGilt’s\tsystem\twas\tunable\tto\tcope\twith the\tload\tbeing\tplaced\ton\tit.\tBy\tsplitting\tout\tcore\tparts\tof\tits\tsystem,\tGilt\twas\tbetter\table\tto deal\twith\tits\ttraffic\tspikes,\tand\ttoday\thas\tover\t450\tmicroservices,\teach\tone\trunning\ton multiple\tseparate\tmachines.\n\nWhen\tembracing\ton-demand\tprovisioning\tsystems\tlike\tthose\tprovided\tby\tAmazon\tWeb Services,\twe\tcan\teven\tapply\tthis\tscaling\ton\tdemand\tfor\tthose\tpieces\tthat\tneed\tit.\tThis allows\tus\tto\tcontrol\tour\tcosts\tmore\teffectively.\tIt’s\tnot\toften\tthat\tan\tarchitectural\tapproach can\tbe\tso\tclosely\tcorrelated\tto\tan\talmost\timmediate\tcost\tsavings.\n\nEase\tof\tDeployment\n\nA\tone-line\tchange\tto\ta\tmillion-line-long\tmonolithic\tapplication\trequires\tthe\twhole application\tto\tbe\tdeployed\tin\torder\tto\trelease\tthe\tchange.\tThat\tcould\tbe\ta\tlarge-impact, high-risk\tdeployment.\tIn\tpractice,\tlarge-impact,\thigh-risk\tdeployments\tend\tup\thappening infrequently\tdue\tto\tunderstandable\tfear.\tUnfortunately,\tthis\tmeans\tthat\tour\tchanges\tbuild up\tand\tbuild\tup\tbetween\treleases,\tuntil\tthe\tnew\tversion\tof\tour\tapplication\thitting production\thas\tmasses\tof\tchanges.\tAnd\tthe\tbigger\tthe\tdelta\tbetween\treleases,\tthe\thigher the\trisk\tthat\twe’ll\tget\tsomething\twrong!\n\nWith\tmicroservices,\twe\tcan\tmake\ta\tchange\tto\ta\tsingle\tservice\tand\tdeploy\tit\tindependently of\tthe\trest\tof\tthe\tsystem.\tThis\tallows\tus\tto\tget\tour\tcode\tdeployed\tfaster.\tIf\ta\tproblem\tdoes occur,\tit\tcan\tbe\tisolated\tquickly\tto\tan\tindividual\tservice,\tmaking\tfast\trollback\teasy\tto achieve.\tIt\talso\tmeans\twe\tcan\tget\tour\tnew\tfunctionality\tout\tto\tcustomers\tfaster.\tThis\tis one\tof\tthe\tmain\treasons\twhy\torganizations\tlike\tAmazon\tand\tNetflix\tuse\tthese architectures\t—\tto\tensure\tthey\tremove\tas\tmany\timpediments\tas\tpossible\tto\tgetting software\tout\tthe\tdoor.\n\nThe\ttechnology\tin\tthis\tspace\thas\tchanged\tgreatly\tin\tthe\tlast\tcouple\tof\tyears,\tand\twe’ll\tbe looking\tmore\tdeeply\tinto\tthe\ttopic\tof\tdeployment\tin\ta\tmicroservice\tworld\tin\tChapter\t6.\n\nOrganizational\tAlignment\n\nMany\tof\tus\thave\texperienced\tthe\tproblems\tassociated\twith\tlarge\tteams\tand\tlarge codebases.\tThese\tproblems\tcan\tbe\texacerbated\twhen\tthe\tteam\tis\tdistributed.\tWe\talso know\tthat\tsmaller\tteams\tworking\ton\tsmaller\tcodebases\ttend\tto\tbe\tmore\tproductive.\n\nMicroservices\tallow\tus\tto\tbetter\talign\tour\tarchitecture\tto\tour\torganization,\thelping\tus minimize\tthe\tnumber\tof\tpeople\tworking\ton\tany\tone\tcodebase\tto\thit\tthe\tsweet\tspot\tof\tteam size\tand\tproductivity.\tWe\tcan\talso\tshift\townership\tof\tservices\tbetween\tteams\tto\ttry\tto\tkeep people\tworking\ton\tone\tservice\tcolocated.\tWe\twill\tgo\tinto\tmuch\tmore\tdetail\ton\tthis\ttopic when\twe\tdiscuss\tConway’s\tlaw\tin\tChapter\t10.\n\nComposability\n\nOne\tof\tthe\tkey\tpromises\tof\tdistributed\tsystems\tand\tservice-oriented\tarchitectures\tis\tthat we\topen\tup\topportunities\tfor\treuse\tof\tfunctionality.\tWith\tmicroservices,\twe\tallow\tfor\tour functionality\tto\tbe\tconsumed\tin\tdifferent\tways\tfor\tdifferent\tpurposes.\tThis\tcan\tbe especially\timportant\twhen\twe\tthink\tabout\thow\tour\tconsumers\tuse\tour\tsoftware.\tGone\tis the\ttime\twhen\twe\tcould\tthink\tnarrowly\tabout\teither\tour\tdesktop\twebsite\tor\tmobile application.\tNow\twe\tneed\tto\tthink\tof\tthe\tmyriad\tways\tthat\twe\tmight\twant\tto\tweave together\tcapabilities\tfor\tthe\tWeb,\tnative\tapplication,\tmobile\tweb,\ttablet\tapp,\tor\twearable device.\tAs\torganizations\tmove\taway\tfrom\tthinking\tin\tterms\tof\tnarrow\tchannels\tto\tmore holistic\tconcepts\tof\tcustomer\tengagement,\twe\tneed\tarchitectures\tthat\tcan\tkeep\tup.\n\nWith\tmicroservices,\tthink\tof\tus\topening\tup\tseams\tin\tour\tsystem\tthat\tare\taddressable\tby outside\tparties.\tAs\tcircumstances\tchange,\twe\tcan\tbuild\tthings\tin\tdifferent\tways.\tWith\ta monolithic\tapplication,\tI\toften\thave\tone\tcoarse-grained\tseam\tthat\tcan\tbe\tused\tfrom\tthe outside.\tIf\tI\twant\tto\tbreak\tthat\tup\tto\tget\tsomething\tmore\tuseful,\tI’ll\tneed\ta\thammer!\tIn Chapter\t5,\tI’ll\tdiscuss\tways\tfor\tyou\tto\tbreak\tapart\texisting\tmonolithic\tsystems,\tand hopefully\tchange\tthem\tinto\tsome\treusable,\tre-composable\tmicroservices.\n\nOptimizing\tfor\tReplaceability\n\nIf\tyou\twork\tat\ta\tmedium-size\tor\tbigger\torganization,\tchances\tare\tyou\tare\taware\tof\tsome big,\tnasty\tlegacy\tsystem\tsitting\tin\tthe\tcorner.\tThe\tone\tno\tone\twants\tto\ttouch.\tThe\tone\tthat is\tvital\tto\thow\tyour\tcompany\truns,\tbut\tthat\thappens\tto\tbe\twritten\tin\tsome\todd\tFortran variant\tand\truns\tonly\ton\thardware\tthat\treached\tend\tof\tlife\t25\tyears\tago.\tWhy\thasn’t\tit been\treplaced?\tYou\tknow\twhy:\tit’s\ttoo\tbig\tand\trisky\ta\tjob.\n\nWith\tour\tindividual\tservices\tbeing\tsmall\tin\tsize,\tthe\tcost\tto\treplace\tthem\twith\ta\tbetter implementation,\tor\teven\tdelete\tthem\taltogether,\tis\tmuch\teasier\tto\tmanage.\tHow\toften\thave you\tdeleted\tmore\tthan\ta\thundred\tlines\tof\tcode\tin\ta\tsingle\tday\tand\tnot\tworried\ttoo\tmuch about\tit?\tWith\tmicroservices\toften\tbeing\tof\tsimilar\tsize,\tthe\tbarriers\tto\trewriting\tor removing\tservices\tentirely\tare\tvery\tlow.\n\nTeams\tusing\tmicroservice\tapproaches\tare\tcomfortable\twith\tcompletely\trewriting\tservices when\trequired,\tand\tjust\tkilling\ta\tservice\twhen\tit\tis\tno\tlonger\tneeded.\tWhen\ta\tcodebase\tis just\ta\tfew\thundred\tlines\tlong,\tit\tis\tdifficult\tfor\tpeople\tto\tbecome\temotionally\tattached\tto it,\tand\tthe\tcost\tof\treplacing\tit\tis\tpretty\tsmall.\n\nWhat\tAbout\tService-Oriented\tArchitecture?\n\nService-oriented\tarchitecture\t(SOA)\tis\ta\tdesign\tapproach\twhere\tmultiple\tservices collaborate\tto\tprovide\tsome\tend\tset\tof\tcapabilities.\tA\tservice\there\ttypically\tmeans\ta completely\tseparate\toperating\tsystem\tprocess.\tCommunication\tbetween\tthese\tservices occurs\tvia\tcalls\tacross\ta\tnetwork\trather\tthan\tmethod\tcalls\twithin\ta\tprocess\tboundary.\n\nSOA\temerged\tas\tan\tapproach\tto\tcombat\tthe\tchallenges\tof\tthe\tlarge\tmonolithic applications.\tIt\tis\tan\tapproach\tthat\taims\tto\tpromote\tthe\treusability\tof\tsoftware;\ttwo\tor more\tend-user\tapplications,\tfor\texample,\tcould\tboth\tuse\tthe\tsame\tservices.\tIt\taims\tto make\tit\teasier\tto\tmaintain\tor\trewrite\tsoftware,\tas\ttheoretically\twe\tcan\treplace\tone\tservice with\tanother\twithout\tanyone\tknowing,\tas\tlong\tas\tthe\tsemantics\tof\tthe\tservice\tdon’t change\ttoo\tmuch.\n\nSOA\tat\tits\theart\tis\ta\tvery\tsensible\tidea.\tHowever,\tdespite\tmany\tefforts,\tthere\tis\ta\tlack\tof good\tconsensus\ton\thow\tto\tdo\tSOA\twell.\tIn\tmy\topinion,\tmuch\tof\tthe\tindustry\thas\tfailed\tto look\tholistically\tenough\tat\tthe\tproblem\tand\tpresent\ta\tcompelling\talternative\tto\tthe narrative\tset\tout\tby\tvarious\tvendors\tin\tthis\tspace.\n\nMany\tof\tthe\tproblems\tlaid\tat\tthe\tdoor\tof\tSOA\tare\tactually\tproblems\twith\tthings\tlike communication\tprotocols\t(e.g.,\tSOAP),\tvendor\tmiddleware,\ta\tlack\tof\tguidance\tabout service\tgranularity,\tor\tthe\twrong\tguidance\ton\tpicking\tplaces\tto\tsplit\tyour\tsystem.\tWe’ll tackle\teach\tof\tthese\tin\tturn\tthroughout\tthe\trest\tof\tthe\tbook.\tA\tcynic\tmight\tsuggest\tthat vendors\tco-opted\t(and\tin\tsome\tcases\tdrove)\tthe\tSOA\tmovement\tas\ta\tway\tto\tsell\tmore products,\tand\tthose\tselfsame\tproducts\tin\tthe\tend\tundermined\tthe\tgoal\tof\tSOA.\n\nMuch\tof\tthe\tconventional\twisdom\taround\tSOA\tdoesn’t\thelp\tyou\tunderstand\thow\tto\tsplit something\tbig\tinto\tsomething\tsmall.\tIt\tdoesn’t\ttalk\tabout\thow\tbig\tis\ttoo\tbig.\tIt\tdoesn’t\ttalk enough\tabout\treal-world,\tpractical\tways\tto\tensure\tthat\tservices\tdo\tnot\tbecome\toverly coupled.\tThe\tnumber\tof\tthings\tthat\tgo\tunsaid\tis\twhere\tmany\tof\tthe\tpitfalls\tassociated\twith SOA\toriginate.\n\nThe\tmicroservice\tapproach\thas\temerged\tfrom\treal-world\tuse,\ttaking\tour\tbetter understanding\tof\tsystems\tand\tarchitecture\tto\tdo\tSOA\twell.\tSo\tyou\tshould\tinstead\tthink\tof microservices\tas\ta\tspecific\tapproach\tfor\tSOA\tin\tthe\tsame\tway\tthat\tXP\tor\tScrum\tare specific\tapproaches\tfor\tAgile\tsoftware\tdevelopment.\n\nOther\tDecompositional\tTechniques\n\nWhen\tyou\tget\tdown\tto\tit,\tmany\tof\tthe\tadvantages\tof\ta\tmicroservice-based\tarchitecture come\tfrom\tits\tgranular\tnature\tand\tthe\tfact\tthat\tit\tgives\tyou\tmany\tmore\tchoices\tas\tto\thow to\tsolve\tproblems.\tBut\tcould\tsimilar\tdecompositional\ttechniques\tachieve\tthe\tsame benefits?\n\nShared\tLibraries\n\nA\tvery\tstandard\tdecompositional\ttechnique\tthat\tis\tbuilt\tinto\tvirtually\tany\tlanguage\tis breaking\tdown\ta\tcodebase\tinto\tmultiple\tlibraries.\tThese\tlibraries\tmay\tbe\tprovided\tby\tthird parties,\tor\tcreated\tin\tyour\town\torganization.\n\nLibraries\tgive\tyou\ta\tway\tto\tshare\tfunctionality\tbetween\tteams\tand\tservices.\tI\tmight\tcreate a\tset\tof\tuseful\tcollection\tutilities,\tfor\texample,\tor\tperhaps\ta\tstatistics\tlibrary\tthat\tcan\tbe reused.\n\nTeams\tcan\torganize\tthemselves\taround\tthese\tlibraries,\tand\tthe\tlibraries\tthemselves\tcan\tbe reused.\tBut\tthere\tare\tsome\tdrawbacks.\n\nFirst,\tyou\tlose\ttrue\ttechnology\theterogeneity.\tThe\tlibrary\ttypically\thas\tto\tbe\tin\tthe\tsame language,\tor\tat\tthe\tvery\tleast\trun\ton\tthe\tsame\tplatform.\tSecond,\tthe\tease\twith\twhich\tyou can\tscale\tparts\tof\tyour\tsystem\tindependently\tfrom\teach\tother\tis\tcurtailed.\tNext,\tunless you’re\tusing\tdynamically\tlinked\tlibraries,\tyou\tcannot\tdeploy\ta\tnew\tlibrary\twithout redeploying\tthe\tentire\tprocess,\tso\tyour\tability\tto\tdeploy\tchanges\tin\tisolation\tis\treduced. And\tperhaps\tthe\tkicker\tis\tthat\tyou\tlack\tthe\tobvious\tseams\taround\twhich\tto\terect architectural\tsafety\tmeasures\tto\tensure\tsystem\tresiliency.\n\nShared\tlibraries\tdo\thave\ttheir\tplace.\tYou’ll\tfind\tyourself\tcreating\tcode\tfor\tcommon\ttasks that\taren’t\tspecific\tto\tyour\tbusiness\tdomain\tthat\tyou\twant\tto\treuse\tacross\tthe\torganization, which\tis\tan\tobvious\tcandidate\tfor\tbecoming\ta\treusable\tlibrary.\tYou\tdo\tneed\tto\tbe\tcareful, though.\tShared\tcode\tused\tto\tcommunicate\tbetween\tservices\tcan\tbecome\ta\tpoint\tof coupling,\tsomething\twe’ll\tdiscuss\tin\tChapter\t4.\n\nServices\tcan\tand\tshould\tmake\theavy\tuse\tof\tthird-party\tlibraries\tto\treuse\tcommon\tcode. But\tthey\tdon’t\tget\tus\tall\tthe\tway\tthere.\n\nModules\n\nSome\tlanguages\tprovide\ttheir\town\tmodular\tdecomposition\ttechniques\tthat\tgo\tbeyond simple\tlibraries.\tThey\tallow\tsome\tlifecycle\tmanagement\tof\tthe\tmodules,\tsuch\tthat\tthey can\tbe\tdeployed\tinto\ta\trunning\tprocess,\tallowing\tyou\tto\tmake\tchanges\twithout\ttaking\tthe whole\tprocess\tdown.\n\nThe\tOpen\tSource\tGateway\tInitiative\t(OSGI)\tis\tworth\tcalling\tout\tas\tone\ttechnology- specific\tapproach\tto\tmodular\tdecomposition.\tJava\titself\tdoesn’t\thave\ta\ttrue\tconcept\tof modules,\tand\twe’ll\thave\tto\twait\tat\tleast\tuntil\tJava\t9\tto\tsee\tthis\tadded\tto\tthe\tlanguage. OSGI,\twhich\temerged\tas\ta\tframework\tto\tallow\tplug-ins\tto\tbe\tinstalled\tin\tthe\tEclipse\tJava IDE,\tis\tnow\tused\tas\ta\tway\tto\tretrofit\ta\tmodule\tconcept\tin\tJava\tvia\ta\tlibrary.\n\nThe\tproblem\twith\tOSGI\tis\tthat\tit\tis\ttrying\tto\tenforce\tthings\tlike\tmodule\tlifecycle management\twithout\tenough\tsupport\tin\tthe\tlanguage\titself.\tThis\tresults\tin\tmore\twork having\tto\tbe\tdone\tby\tmodule\tauthors\tto\tdeliver\ton\tproper\tmodule\tisolation.\tWithin\ta process\tboundary,\tit\tis\talso\tmuch\teasier\tto\tfall\tinto\tthe\ttrap\tof\tmaking\tmodules\toverly coupled\tto\teach\tother,\tcausing\tall\tsorts\tof\tproblems.\tMy\town\texperience\twith\tOSGI, which\tis\tmatched\tby\tthat\tof\tcolleagues\tin\tthe\tindustry,\tis\tthat\teven\twith\tgood\tteams\tit\tis easy\tfor\tOSGI\tto\tbecome\ta\tmuch\tbigger\tsource\tof\tcomplexity\tthan\tits\tbenefits\twarrant.\n\nErlang\tfollows\ta\tdifferent\tapproach,\tin\twhich\tmodules\tare\tbaked\tinto\tthe\tlanguage runtime.\tThus,\tErlang\tis\ta\tvery\tmature\tapproach\tto\tmodular\tdecomposition.\tErlang modules\tcan\tbe\tstopped,\trestarted,\tand\tupgraded\twithout\tissue.\tErlang\teven\tsupports running\tmore\tthan\tone\tversion\tof\tthe\tmodule\tat\ta\tgiven\ttime,\tallowing\tfor\tmore\tgraceful module\tupgrading.\n\nThe\tcapabilities\tof\tErlang’s\tmodules\tare\timpressive\tindeed,\tbut\teven\tif\twe\tare\tlucky enough\tto\tuse\ta\tplatform\twith\tthese\tcapabilities,\twe\tstill\thave\tthe\tsame\tshortcomings\tas we\tdo\twith\tnormal\tshared\tlibraries.\tWe\tare\tstrictly\tlimited\tin\tour\tability\tto\tuse\tnew technologies,\tlimited\tin\thow\twe\tcan\tscale\tindependently,\tcan\tdrift\ttoward\tintegration techniques\tthat\tare\toverly\tcoupling,\tand\tlack\tseams\tfor\tarchitectural\tsafety\tmeasures.\n\nThere\tis\tone\tfinal\tobservation\tworth\tsharing.\tTechnically,\tit\tshould\tbe\tpossible\tto\tcreate well-factored,\tindependent\tmodules\twithin\ta\tsingle\tmonolithic\tprocess.\tAnd\tyet\twe\trarely see\tthis\thappen.\tThe\tmodules\tthemselves\tsoon\tbecome\ttightly\tcoupled\twith\tthe\trest\tof\tthe code,\tsurrendering\tone\tof\ttheir\tkey\tbenefits.\tHaving\ta\tprocess\tboundary\tseparation\tdoes enforce\tclean\thygiene\tin\tthis\trespect\t(or\tat\tleast\tmakes\tit\tharder\tto\tdo\tthe\twrong\tthing!).\tI wouldn’t\tsuggest\tthat\tthis\tshould\tbe\tthe\tmain\tdriver\tfor\tprocess\tseparation,\tof\tcourse,\tbut it\tis\tinteresting\tthat\tthe\tpromises\tof\tmodular\tseparation\twithin\tprocess\tboundaries\trarely deliver\tin\tthe\treal\tworld.\n\nSo\twhile\tmodular\tdecomposition\twithin\ta\tprocess\tboundary\tmay\tbe\tsomething\tyou\twant to\tdo\tas\twell\tas\tdecomposing\tyour\tsystem\tinto\tservices,\tby\titself\tit\twon’t\thelp\tsolve everything.\tIf\tyou\tare\ta\tpure\tErlang\tshop,\tthe\tquality\tof\tErlang’s\tmodule\timplementation\n\nmay\tget\tyou\ta\tvery\tlong\tway,\tbut\tI\tsuspect\tmany\tof\tyou\tare\tnot\tin\tthat\tsituation.\tFor\tthe rest\tof\tus,\twe\tshould\tsee\tmodules\tas\toffering\tthe\tsame\tsorts\tof\tbenefits\tas\tshared\tlibraries.\n\nNo\tSilver\tBullet\n\nBefore\twe\tfinish,\tI\tshould\tcall\tout\tthat\tmicroservices\tare\tno\tfree\tlunch\tor\tsilver\tbullet,\tand make\tfor\ta\tbad\tchoice\tas\ta\tgolden\thammer.\tThey\thave\tall\tthe\tassociated\tcomplexities\tof distributed\tsystems,\tand\twhile\twe\thave\tlearned\ta\tlot\tabout\thow\tto\tmanage\tdistributed systems\twell\t(which\twe’ll\tdiscuss\tthroughout\tthe\tbook)\tit\tis\tstill\thard.\tIf\tyou’re\tcoming from\ta\tmonolithic\tsystem\tpoint\tof\tview,\tyou’ll\thave\tto\tget\tmuch\tbetter\tat\thandling deployment,\ttesting,\tand\tmonitoring\tto\tunlock\tthe\tbenefits\twe’ve\tcovered\tso\tfar.\tYou’ll also\tneed\tto\tthink\tdifferently\tabout\thow\tyou\tscale\tyour\tsystems\tand\tensure\tthat\tthey\tare resilient.\tDon’t\talso\tbe\tsurprised\tif\tthings\tlike\tdistributed\ttransactions\tor\tCAP\ttheorem start\tgiving\tyou\theadaches,\teither!\n\nEvery\tcompany,\torganization,\tand\tsystem\tis\tdifferent.\tA\tnumber\tof\tfactors\twill\tplay\tinto whether\tor\tnot\tmicroservices\tare\tright\tfor\tyou,\tand\thow\taggressive\tyou\tcan\tbe\tin\tadopting them.\tThroughout\teach\tchapter\tin\tthis\tbook\tI’ll\tattempt\tto\tgive\tyou\tguidance\thighlighting the\tpotential\tpitfalls,\twhich\tshould\thelp\tyou\tchart\ta\tsteady\tpath.\n\nSummary\n\nHopefully\tby\tnow\tyou\tknow\twhat\ta\tmicroservice\tis,\twhat\tmakes\tit\tdifferent\tfrom\tother compositional\ttechniques,\tand\twhat\tsome\tof\tthe\tkey\tadvantages\tare.\tIn\teach\tof\tthe following\tchapters\twe\twill\tgo\tinto\tmore\tdetail\ton\thow\tto\tachieve\tthese\tbenefits\tand\thow to\tavoid\tsome\tof\tthe\tcommon\tpitfalls.\n\nThere\tare\ta\tnumber\tof\ttopics\tto\tcover,\tbut\twe\tneed\tto\tstart\tsomewhere.\tOne\tof\tthe\tmain challenges\tthat\tmicroservices\tintroduce\tis\ta\tshift\tin\tthe\trole\tof\tthose\twho\toften\tguide\tthe evolution\tof\tour\tsystems:\tthe\tarchitects.\tWe’ll\tlook\tnext\tat\tsome\tdifferent\tapproaches\tto this\trole\tthat\tcan\tensure\twe\tget\tthe\tmost\tout\tof\tthis\tnew\tarchitecture.\n\nChapter\t2.\tThe\tEvolutionary\tArchitect\n\nAs\twe\thave\tseen\tso\tfar,\tmicroservices\tgive\tus\ta\tlot\tof\tchoice,\tand\taccordingly\ta\tlot\tof decisions\tto\tmake.\tFor\texample,\thow\tmany\tdifferent\ttechnologies\tshould\twe\tuse,\tshould we\tlet\tdifferent\tteams\tuse\tdifferent\tprogramming\tidioms,\tand\tshould\twe\tsplit\tor\tmerge\ta service?\tHow\tdo\twe\tgo\tabout\tmaking\tthese\tdecisions?\tWith\tthe\tfaster\tpace\tof\tchange,\tand the\tmore\tfluid\tenvironment\tthat\tthese\tarchitectures\tallow,\tthe\trole\tof\tthe\tarchitect\talso\thas to\tchange.\tIn\tthis\tchapter,\tI’ll\ttake\ta\tfairly\topinionated\tview\tof\twhat\tthe\trole\tof\tan architect\tis,\tand\thopefully\tlaunch\tone\tfinal\tassault\ton\tthe\tivory\ttower.",
      "page_number": 15
    },
    {
      "number": 2,
      "title": "The\tEvolutionary\tArchitect",
      "start_page": 35,
      "end_page": 61,
      "detection_method": "regex_chapter_title",
      "content": "Inaccurate\tComparisons\n\nYou\tkeep\tusing\tthat\tword.\tI\tdo\tnot\tthink\tit\tmeans\twhat\tyou\tthink\tit\tmeans.\n\nInigo\tMontoya,\tfrom\tThe\tPrincess\tBride\n\nArchitects\thave\tan\timportant\tjob.\tThey\tare\tin\tcharge\tof\tmaking\tsure\twe\thave\ta\tjoined-up technical\tvision,\tone\tthat\tshould\thelp\tus\tdeliver\tthe\tsystem\tour\tcustomers\tneed.\tIn\tsome places,\tthey\tmay\tonly\thave\tto\twork\twith\tone\tteam,\tin\twhich\tcase\tthe\trole\tof\tthe\tarchitect and\ttechnical\tlead\tis\toften\tthe\tsame.\tIn\tothers,\tthey\tmay\tbe\tdefining\tthe\tvision\tfor\tan entire\tprogram\tof\twork,\tcoordinating\twith\tmultiple\tteams\tacross\tthe\tworld,\tor\tperhaps even\tan\tentire\torganization.\tAt\twhatever\tlevel\tthey\toperate,\tthe\trole\tis\ta\ttricky\tone\tto\tpin down,\tand\tdespite\tit\toften\tbeing\tthe\tobvious\tcareer\tprogression\tfor\tdevelopers\tin enterprise\torganizations,\tit\tis\talso\ta\trole\tthat\tgets\tmore\tcriticism\tthan\tvirtually\tany\tother. More\tthan\tany\tother\trole,\tarchitects\tcan\thave\ta\tdirect\timpact\ton\tthe\tquality\tof\tthe\tsystems built,\ton\tthe\tworking\tconditions\tof\ttheir\tcolleagues,\tand\ton\ttheir\torganization’s\tability\tto respond\tto\tchange,\tand\tyet\twe\tso\tfrequently\tseem\tto\tget\tthis\trole\twrong.\tWhy\tis\tthat?\n\nOur\tindustry\tis\ta\tyoung\tone.\tThis\tis\tsomething\twe\tseem\tto\tforget,\tand\tyet\twe\thave\tonly been\tcreating\tprograms\tthat\trun\ton\twhat\twe\trecognize\tas\tcomputers\tfor\taround\t70\tyears. Therefore,\twe\tare\tconstantly\tlooking\tto\tother\tprofessions\tin\tan\tattempt\tto\texplain\twhat\twe do.\tWe\taren’t\tmedical\tdoctors\tor\tengineers,\tbut\tnor\tare\twe\tplumbers\tor\telectricians. Instead,\twe\tfall\tinto\tsome\tmiddle\tground,\twhich\tmakes\tit\thard\tfor\tsociety\tto\tunderstand us,\tor\tfor\tus\tto\tunderstand\twhere\twe\tfit.\n\nSo\twe\tborrow\tfrom\tother\tprofessions.\tWe\tcall\tourselves\tsoftware\t“engineers,”\tor “architects.”\tBut\twe\taren’t,\tare\twe?\tArchitects\tand\tengineers\thave\ta\trigor\tand\tdiscipline we\tcould\tonly\tdream\tof,\tand\ttheir\timportance\tin\tsociety\tis\twell\tunderstood.\tI\tremember talking\tto\ta\tfriend\tof\tmine,\tthe\tday\tbefore\the\tbecame\ta\tqualified\tarchitect.\t“Tomorrow,”\the said,\t“if\tI\tgive\tyou\tadvice\tdown\tat\tthe\tpub\tabout\thow\tto\tbuild\tsomething\tand\tit’s\twrong,\tI get\theld\tto\taccount.\tI\tcould\tget\tsued,\tas\tin\tthe\teyes\tof\tthe\tlaw\tI\tam\tnow\ta\tqualified architect\tand\tI\tshould\tbe\theld\tresponsible\tif\tI\tget\tit\twrong.”\tThe\timportance\tof\tthese\tjobs to\tsociety\tmeans\tthat\tthere\tare\trequired\tqualifications\tpeople\thave\tto\tmeet.\tIn\tthe\tUK,\tfor example,\ta\tminimum\tof\tseven\tyears\tstudy\tis\trequired\tbefore\tyou\tcan\tbe\tcalled\tan architect.\tBut\tthese\tjobs\tare\talso\tbased\ton\ta\tbody\tof\tknowledge\tgoing\tback\tthousands\tof years.\tAnd\tus?\tNot\tquite.\tWhich\tis\talso\twhy\tI\tview\tmost\tforms\tof\tIT\tcertification\tas worthless,\tas\twe\tknow\tso\tlittle\tabout\twhat\tgood\tlooks\tlike.\n\nPart\tof\tus\twants\trecognition,\tso\twe\tborrow\tnames\tfrom\tother\tprofessions\tthat\talready\thave the\trecognition\twe\tas\tan\tindustry\tcrave.\tBut\tthis\tcan\tbe\tdoubly\tharmful.\tFirst,\tit\timplies we\tknow\twhat\twe\tare\tdoing,\twhen\twe\tplainly\tdon’t.\tI\twouldn’t\tsay\tthat\tbuildings\tand bridges\tnever\tfall\tdown,\tbut\tthey\tfall\tdown\tmuch\tless\tthan\tthe\tnumber\tof\ttimes\tour programs\twill\tcrash,\tmaking\tcomparisons\twith\tengineers\tquite\tunfair.\tSecond,\tthe analogies\tbreak\tdown\tvery\tquickly\twhen\tgiven\teven\ta\tcursory\tglance.\tTo\tturn\tthings\n\naround,\tif\tbridge\tbuilding\twere\tlike\tprogramming,\thalfway\tthrough\twe’d\tfind\tout\tthat\tthe far\tbank\twas\tnow\t50\tmeters\tfarther\tout,\tthat\tit\twas\tactually\tmud\trather\tthan\tgranite,\tand that\trather\tthan\tbuilding\ta\tfootbridge\twe\twere\tinstead\tbuilding\ta\troad\tbridge.\tOur\tsoftware isn’t\tconstrained\tby\tthe\tsame\tphysical\trules\tthat\treal\tarchitects\tor\tengineers\thave\tto\tdeal with,\tand\twhat\twe\tcreate\tis\tdesigned\tto\tflex\tand\tadapt\tand\tevolve\twith\tuser\trequirements.\n\nPerhaps\tthe\tterm\tarchitect\thas\tdone\tthe\tmost\tharm.\tThe\tidea\tof\tsomeone\twho\tdraws\tup detailed\tplans\tfor\tothers\tto\tinterpret,\tand\texpects\tthis\tto\tbe\tcarried\tout.\tThe\tbalance\tof\tpart artist,\tpart\tengineer,\toverseeing\tthe\tcreation\tof\twhat\tis\tnormally\ta\tsingular\tvision,\twith\tall other\tviewpoints\tbeing\tsubservient,\texcept\tfor\tthe\toccasional\tobjection\tfrom\tthe\tstructural engineer\tregarding\tthe\tlaws\tof\tphysics.\tIn\tour\tindustry,\tthis\tview\tof\tthe\tarchitect\tleads\tto some\tterrible\tpractices.\tDiagram\tafter\tdiagram,\tpage\tafter\tpage\tof\tdocumentation,\tcreated with\ta\tview\tto\tinform\tthe\tconstruction\tof\tthe\tperfect\tsystem,\twithout\ttaking\tinto\taccount the\tfundamentally\tunknowable\tfuture.\tUtterly\tdevoid\tof\tany\tunderstanding\tas\tto\thow\thard it\twill\tbe\tto\timplement,\tor\twhether\tor\tnot\tit\twill\tactually\twork,\tlet\talone\thaving\tany\tability to\tchange\tas\twe\tlearn\tmore.\n\nWhen\twe\tcompare\tourselves\tto\tengineers\tor\tarchitects,\twe\tare\tin\tdanger\tof\tdoing everyone\ta\tdisservice.\tUnfortunately,\twe\tare\tstuck\twith\tthe\tword\tarchitect\tfor\tnow.\tSo\tthe best\twe\tcan\tdo\tis\tto\tredefine\twhat\tit\tmeans\tin\tour\tcontext.\n\nAn\tEvolutionary\tVision\tfor\tthe\tArchitect\n\nOur\trequirements\tshift\tmore\trapidly\tthan\tthey\tdo\tfor\tpeople\twho\tdesign\tand\tbuild buildings\t—\tas\tdo\tthe\ttools\tand\ttechniques\tat\tour\tdisposal.\tThe\tthings\twe\tcreate\tare\tnot fixed\tpoints\tin\ttime.\tOnce\tlaunched\tinto\tproduction,\tour\tsoftware\twill\tcontinue\tto\tevolve as\tthe\tway\tit\tis\tused\tchanges.\tFor\tmost\tthings\twe\tcreate,\twe\thave\tto\taccept\tthat\tonce\tthe software\tgets\tinto\tthe\thands\tof\tour\tcustomers\twe\twill\thave\tto\treact\tand\tadapt,\trather\tthan it\tbeing\ta\tnever-changing\tartifact.\tThus,\tour\tarchitects\tneed\tto\tshift\ttheir\tthinking\taway from\tcreating\tthe\tperfect\tend\tproduct,\tand\tinstead\tfocus\ton\thelping\tcreate\ta\tframework\tin which\tthe\tright\tsystems\tcan\temerge,\tand\tcontinue\tto\tgrow\tas\twe\tlearn\tmore.\n\nAlthough\tI\thave\tspent\tmuch\tof\tthe\tchapter\tso\tfar\twarning\tyou\toff\tcomparing\tourselves\ttoo much\tto\tother\tprofessions,\tthere\tis\tone\tanalogy\tthat\tI\tlike\twhen\tit\tcomes\tto\tthe\trole\tof\tthe IT\tarchitect\tand\tthat\tI\tthink\tbetter\tencapsulates\twhat\twe\twant\tthis\trole\tto\tbe.\tErik Doernenburg\tfirst\tshared\twith\tme\tthe\tidea\tthat\twe\tshould\tthink\tof\tour\trole\tmore\tas\ttown planners\tthan\tarchitects\tfor\tthe\tbuilt\tenvironment.\tThe\trole\tof\tthe\ttown\tplanner\tshould\tbe familiar\tto\tany\tof\tyou\twho\thave\tplayed\tSimCity\tbefore.\tA\ttown\tplanner’s\trole\tis\tto\tlook\tat a\tmultitude\tof\tsources\tof\tinformation,\tand\tthen\tattempt\tto\toptimize\tthe\tlayout\tof\ta\tcity\tto best\tsuit\tthe\tneeds\tof\tthe\tcitizens\ttoday,\ttaking\tinto\taccount\tfuture\tuse.\tThe\tway\the influences\thow\tthe\tcity\tevolves,\tthough,\tis\tinteresting.\tHe\tdoes\tnot\tsay,\t“build\tthis specific\tbuilding\tthere”;\tinstead,\the\tzones\ta\tcity.\tSo\tas\tin\tSimCity,\tyou\tmight\tdesignate part\tof\tyour\tcity\tas\tan\tindustrial\tzone,\tand\tanother\tpart\tas\ta\tresidential\tzone.\tIt\tis\tthen\tup to\tother\tpeople\tto\tdecide\twhat\texact\tbuildings\tget\tcreated,\tbut\tthere\tare\trestrictions:\tif\tyou want\tto\tbuild\ta\tfactory,\tit\twill\tneed\tto\tbe\tin\tan\tindustrial\tzone.\tRather\tthan\tworrying\ttoo much\tabout\twhat\thappens\tin\tone\tzone,\tthe\ttown\tplanner\twill\tinstead\tspend\tfar\tmore\ttime working\tout\thow\tpeople\tand\tutilities\tmove\tfrom\tone\tzone\tto\tanother.\n\nMore\tthan\tone\tperson\thas\tlikened\ta\tcity\tto\ta\tliving\tcreature.\tThe\tcity\tchanges\tover\ttime.\tIt shifts\tand\tevolves\tas\tits\toccupants\tuse\tit\tin\tdifferent\tways,\tor\tas\texternal\tforces\tshape\tit. The\ttown\tplanner\tdoes\this\tbest\tto\tanticipate\tthese\tchanges,\tbut\taccepts\tthat\ttrying\tto\texert direct\tcontrol\tover\tall\taspects\tof\twhat\thappens\tis\tfutile.\n\nThe\tcomparison\twith\tsoftware\tshould\tbe\tobvious.\tAs\tour\tusers\tuse\tour\tsoftware,\twe\tneed to\treact\tand\tchange.\tWe\tcannot\tforesee\teverything\tthat\twill\thappen,\tand\tso\trather\tthan plan\tfor\tany\teventuality,\twe\tshould\tplan\tto\tallow\tfor\tchange\tby\tavoiding\tthe\turge\tto overspecify\tevery\tlast\tthing.\tOur\tcity\t—\tthe\tsystem\t—\tneeds\tto\tbe\ta\tgood,\thappy\tplace\tfor everyone\twho\tuses\tit.\tOne\tthing\tthat\tpeople\toften\tforget\tis\tthat\tour\tsystem\tdoesn’t\tjust accommodate\tusers;\tit\talso\taccommodates\tdevelopers\tand\toperations\tpeople\twho\talso have\tto\twork\tthere,\tand\twho\thave\tthe\tjob\tof\tmaking\tsure\tit\tcan\tchange\tas\trequired.\tTo borrow\ta\tterm\tfrom\tFrank\tBuschmann,\tarchitects\thave\ta\tduty\tto\tensure\tthat\tthe\tsystem\tis habitable\tfor\tdevelopers\ttoo.\n\nA\ttown\tplanner,\tjust\tlike\tan\tarchitect,\talso\tneeds\tto\tknow\twhen\this\tplan\tisn’t\tbeing\n\nfollowed.\tAs\the\tis\tless\tprescriptive,\tthe\tnumber\tof\ttimes\the\tneeds\tto\tget\tinvolved\tto correct\tdirection\tshould\tbe\tminimal,\tbut\tif\tsomeone\tdecides\tto\tbuild\ta\tsewage\tplant\tin\ta residential\tarea,\the\tneeds\tto\tbe\table\tto\tshut\tit\tdown.\n\nSo\tour\tarchitects\tas\ttown\tplanners\tneed\tto\tset\tdirection\tin\tbroad\tstrokes,\tand\tonly\tget involved\tin\tbeing\thighly\tspecific\tabout\timplementation\tdetail\tin\tlimited\tcases.\tThey\tneed to\tensure\tthat\tthe\tsystem\tis\tfit\tfor\tpurpose\tnow,\tbut\talso\ta\tplatform\tfor\tthe\tfuture.\tAnd they\tneed\tto\tensure\tthat\tit\tis\ta\tsystem\tthat\tmakes\tusers\tand\tdevelopers\tequally\thappy.\tThis sounds\tlike\ta\tpretty\ttall\torder.\tWhere\tdo\twe\tstart?\n\nZoning\n\nSo,\tto\tcontinue\tthe\tmetaphor\tof\tthe\tarchitect\tas\ttown\tplanner\tfor\ta\tmoment,\twhat\tare\tour zones?\tThese\tare\tour\tservice\tboundaries,\tor\tperhaps\tcoarse-grained\tgroups\tof\tservices.\tAs architects,\twe\tneed\tto\tworry\tmuch\tless\tabout\twhat\thappens\tinside\tthe\tzone\tthan\twhat happens\tbetween\tthe\tzones.\tThat\tmeans\twe\tneed\tto\tspend\ttime\tthinking\tabout\thow\tour services\ttalk\tto\teach\tother,\tor\tensuring\tthat\twe\tcan\tproperly\tmonitor\tthe\toverall\thealth\tof our\tsystem.\tHow\tinvolved\twe\tget\tinside\tthe\tzone\twill\tvary\tsomewhat.\tMany\torganizations have\tadopted\tmicroservices\tin\torder\tto\tmaximize\tfor\tautonomy\tof\tteams,\tsomething\twe’ll expand\ton\tin\tChapter\t10.\tIf\tyou\tare\tin\tsuch\tan\torganization,\tyou\twill\trely\tmore\ton\tthe team\tto\tmake\tthe\tright\tlocal\tdecision.\n\nBut\tbetween\tthe\tzones,\tor\tthe\tboxes\ton\tour\ttraditional\tarchitecture\tdiagram,\twe\tneed\tto\tbe careful;\tgetting\tthings\twrong\there\tleads\tto\tall\tsorts\tof\tproblems\tand\tcan\tbe\tvery\thard\tto correct.\n\nWithin\teach\tservice,\tyou\tmay\tbe\tOK\twith\tthe\tteam\twho\towns\tthat\tzone\tpicking\ta\tdifferent technology\tstack\tor\tdata\tstore.\tOther\tconcerns\tmay\tkick\tin\there,\tof\tcourse.\tYour inclination\tto\tlet\tteams\tpick\tthe\tright\ttool\tfor\tthe\tjob\tmay\tbe\ttempered\tby\tthe\tfact\tthat\tit becomes\tharder\tto\thire\tpeople\tor\tmove\tthem\tbetween\tteams\tif\tyou\thave\t10\tdifferent technology\tstacks\tto\tsupport.\tSimilarly,\tif\teach\tteam\tpicks\ta\tcompletely\tdifferent\tdata store,\tyou\tmay\tfind\tyourself\tlacking\tenough\texperience\tto\trun\tany\tof\tthem\tat\tscale. Netflix,\tfor\texample,\thas\tmostly\tstandardized\ton\tCassandra\tas\ta\tdata-store\ttechnology. Although\tit\tmay\tnot\tbe\tthe\tbest\tfit\tfor\tall\tof\tits\tcases,\tNetflix\tfeels\tthat\tthe\tvalue\tgained\tby building\ttooling\tand\texpertise\taround\tCassandra\tis\tmore\timportant\tthan\thaving\tto\tsupport and\toperate\tat\tscale\tmultiple\tother\tplatforms\tthat\tmay\tbe\ta\tbetter\tfit\tfor\tcertain\ttasks. Netflix\tis\tan\textreme\texample,\twhere\tscale\tis\tlikely\tthe\tstrongest\toverriding\tfactor,\tbut you\tget\tthe\tidea.\n\nBetween\tservices\tis\twhere\tthings\tcan\tget\tmessy,\thowever.\tIf\tone\tservice\tdecides\tto\texpose REST\tover\tHTTP,\tanother\tmakes\tuse\tof\tprotocol\tbuffers,\tand\ta\tthird\tuses\tJava\tRMI,\tthen integration\tcan\tbecome\ta\tnightmare\tas\tconsuming\tservices\thave\tto\tunderstand\tand\tsupport multiple\tstyles\tof\tinterchange.\tThis\tis\twhy\tI\ttry\tto\tstick\tto\tthe\tguideline\tthat\twe\tshould\t“be worried\tabout\twhat\thappens\tbetween\tthe\tboxes,\tand\tbe\tliberal\tin\twhat\thappens\tinside.”\n\nTHE\tCODING\tARCHITECT\n\nIf\twe\tare\tto\tensure\tthat\tthe\tsystems\twe\tcreate\tare\thabitable\tfor\tour\tdevelopers,\tthen\tour\tarchitects\tneed\tto understand\tthe\timpact\tof\ttheir\tdecisions.\tAt\tthe\tvery\tleast,\tthis\tmeans\tspending\ttime\twith\tthe\tteam,\tand\tideally\tit should\tmean\tthat\tthese\tdevelopers\tactually\tspend\ttime\tcoding\twith\tthe\tteam\ttoo.\tFor\tthose\tof\tyou\twho\tpractice\tpair programming,\tit\tbecomes\ta\tsimple\tmatter\tfor\tan\tarchitect\tto\tjoin\ta\tteam\tfor\ta\tshort\tperiod\tas\tone\tmember\tof\tthe pair.\tIdeally,\tyou\tshould\twork\ton\tnormal\tstories,\tto\treally\tunderstand\twhat\tnormal\twork\tis\tlike.\tI\tcannot\temphasize how\timportant\tit\tis\tfor\tthe\tarchitect\tto\tactually\tsit\twith\tthe\tteam!\tThis\tis\tsignificantly\tmore\teffective\tthan\thaving\ta call\tor\tjust\tlooking\tat\ther\tcode.\n\nAs\tfor\thow\toften\tyou\tshould\tdo\tthis,\tthat\tdepends\tgreatly\ton\tthe\tsize\tof\tthe\tteam(s)\tyou\tare\tworking\twith.\tBut\tthe key\tis\tthat\tit\tshould\tbe\ta\troutine\tactivity.\tIf\tyou\tare\tworking\twith\tfour\tteams,\tfor\texample,\tspending\thalf\ta\tday\twith each\tteam\tevery\tfour\tweeks\tensures\tyou\tbuild\tan\tawareness\tand\timproved\tcommunications\twith\tthe\tteams\tyou\tare working\twith.\n\nA\tPrincipled\tApproach\n\nRules\tare\tfor\tthe\tobedience\tof\tfools\tand\tthe\tguidance\tof\twise\tmen.\n\nGenerally\tattributed\tto\tDouglas\tBader\n\nMaking\tdecisions\tin\tsystem\tdesign\tis\tall\tabout\ttrade-offs,\tand\tmicroservice\tarchitectures give\tus\tlots\tof\ttrade-offs\tto\tmake!\tWhen\tpicking\ta\tdatastore,\tdo\twe\tpick\ta\tplatform\tthat we\thave\tless\texperience\twith,\tbut\tthat\tgives\tus\tbetter\tscaling?\tIs\tit\tOK\tfor\tus\tto\thave\ttwo different\ttechnology\tstacks\tin\tour\tsystem?\tWhat\tabout\tthree?\tSome\tdecisions\tcan\tbe\tmade completely\ton\tthe\tspot\twith\tinformation\tavailable\tto\tus,\tand\tthese\tare\tthe\teasiest\tto\tmake. But\twhat\tabout\tthose\tdecisions\tthat\tmight\thave\tto\tbe\tmade\ton\tincomplete\tinformation?\n\nFraming\there\tcan\thelp,\tand\ta\tgreat\tway\tto\thelp\tframe\tour\tdecision\tmaking\tis\tto\tdefine\ta set\tof\tprinciples\tand\tpractices\tthat\tguide\tit,\tbased\ton\tgoals\tthat\twe\tare\ttrying\tto\tachieve. Let’s\tlook\tat\teach\tin\tturn.\n\nStrategic\tGoals\n\nThe\trole\tof\tthe\tarchitect\tis\talready\tdaunting\tenough,\tso\tluckily\twe\tusually\tdon’t\thave\tto also\tdefine\tstrategic\tgoals!\tStrategic\tgoals\tshould\tspeak\tto\twhere\tyour\tcompany\tis\tgoing, and\thow\tit\tsees\titself\tas\tbest\tmaking\tits\tcustomers\thappy.\tThese\twill\tbe\thigh-level\tgoals, and\tmay\tnot\tinclude\ttechnology\tat\tall.\tThey\tcould\tbe\tdefined\tat\ta\tcompany\tlevel\tor\ta division\tlevel.\tThey\tmight\tbe\tthings\tlike\t“Expand\tinto\tSoutheast\tAsia\tto\tunlock\tnew markets,”\tor\t“Let\tthe\tcustomer\tachieve\tas\tmuch\tas\tpossible\tusing\tself-service.”\tThe\tkey\tis that\tthis\tis\twhere\tyour\torganization\tis\theaded,\tso\tyou\tneed\tto\tmake\tsure\tthe\ttechnology\tis aligned\tto\tit.\n\nIf\tyou’re\tthe\tperson\tdefining\tthe\tcompany’s\ttechnical\tvision,\tthis\tmay\tmean\tyou’ll\tneed\tto spend\tmore\ttime\twith\tthe\tnontechnical\tparts\tof\tyour\torganization\t(or\tthe\tbusiness,\tas\tthey are\toften\tcalled).\tWhat\tis\tthe\tdriving\tvision\tfor\tthe\tbusiness?\tAnd\thow\tdoes\tit\tchange?\n\nPrinciples\n\nPrinciples\tare\trules\tyou\thave\tmade\tin\torder\tto\talign\twhat\tyou\tare\tdoing\tto\tsome\tlarger goal,\tand\twill\tsometimes\tchange.\tFor\texample,\tif\tone\tof\tyour\tstrategic\tgoals\tas\tan organization\tis\tto\tdecrease\tthe\ttime\tto\tmarket\tfor\tnew\tfeatures,\tyou\tmay\tdefine\ta\tprinciple that\tsays\tthat\tdelivery\tteams\thave\tfull\tcontrol\tover\tthe\tlifecycle\tof\ttheir\tsoftware\tto\tship whenever\tthey\tare\tready,\tindependently\tof\tany\tother\tteam.\tIf\tanother\tgoal\tis\tthat\tyour organization\tis\tmoving\tto\taggressively\tgrow\tits\toffering\tin\tother\tcountries,\tyou\tmay decide\tto\timplement\ta\tprinciple\tthat\tthe\tentire\tsystem\tmust\tbe\tportable\tto\tallow\tfor\tit\tto\tbe deployed\tlocally\tin\torder\tto\trespect\tsovereignty\tof\tdata.\n\nYou\tprobably\tdon’t\twant\tloads\tof\tthese.\tFewer\tthan\t10\tis\ta\tgood\tnumber\t—\tsmall\tenough that\tpeople\tcan\tremember\tthem,\tor\tto\tfit\ton\tsmall\tposters.\tThe\tmore\tprinciples\tyou\thave, the\tgreater\tthe\tchance\tthat\tthey\toverlap\tor\tcontradict\teach\tother.\n\nHeroku’s\t12\tFactors\tare\ta\tset\tof\tdesign\tprinciples\tstructured\taround\tthe\tgoal\tof\thelping you\tcreate\tapplications\tthat\twork\twell\ton\tthe\tHeroku\tplatform.\tThey\talso\tmay\twell\tmake sense\tin\tother\tcontexts.\tSome\tof\tthe\tprinciples\tare\tactually\tconstraints\tbased\ton\tbehaviors your\tapplication\tneeds\tto\texhibit\tin\torder\tto\twork\ton\tHeroku.\tA\tconstraint\tis\treally something\tthat\tis\tvery\thard\t(or\tvirtually\timpossible)\tto\tchange,\twhereas\tprinciples\tare things\twe\tdecide\tto\tchoose.\tYou\tmay\tdecide\tto\texplicitly\tcall\tout\tthose\tthings\tthat\tare principles\tversus\tthose\tthat\tare\tconstraints,\tto\thelp\tindicate\tthose\tthings\tyou\treally\tcan’t change.\tPersonally,\tI\tthink\tthere\tcan\tbe\tsome\tvalue\tin\tkeeping\tthem\tin\tthe\tsame\tlist\tto encourage\tchallenging\tconstraints\tevery\tnow\tand\tthen\tand\tsee\tif\tthey\treally\tare immovable!\n\nPractices\n\nOur\tpractices\tare\thow\twe\tensure\tour\tprinciples\tare\tbeing\tcarried\tout.\tThey\tare\ta\tset\tof detailed,\tpractical\tguidance\tfor\tperforming\ttasks.\tThey\twill\toften\tbe\ttechnology-specific, and\tshould\tbe\tlow\tlevel\tenough\tthat\tany\tdeveloper\tcan\tunderstand\tthem.\tPractices\tcould include\tcoding\tguidelines,\tthe\tfact\tthat\tall\tlog\tdata\tneeds\tto\tbe\tcaptured\tcentrally,\tor\tthat HTTP/REST\tis\tthe\tstandard\tintegration\tstyle.\tDue\tto\ttheir\ttechnical\tnature,\tpractices\twill often\tchange\tmore\toften\tthan\tprinciples.\n\nAs\twith\tprinciples,\tsometimes\tpractices\treflect\tconstraints\tin\tyour\torganization.\tFor example,\tif\tyou\tsupport\tonly\tCentOS,\tthis\twill\tneed\tto\tbe\treflected\tin\tyour\tpractices.\n\nPractices\tshould\tunderpin\tour\tprinciples.\tA\tprinciple\tstating\tthat\tdelivery\tteams\tcontrol the\tfull\tlifecycle\tof\ttheir\tsystems\tmay\tmean\tyou\thave\ta\tpractice\tstating\tthat\tall\tservices are\tdeployed\tinto\tisolated\tAWS\taccounts,\tproviding\tself-service\tmanagement\tof\tthe resources\tand\tisolation\tfrom\tother\tteams.\n\nCombining\tPrinciples\tand\tPractices\n\nOne\tperson’s\tprinciples\tare\tanother’s\tpractices.\tYou\tmight\tdecide\tto\tcall\tthe\tuse\tof HTTP/REST\ta\tprinciple\trather\tthan\ta\tpractice,\tfor\texample.\tAnd\tthat\twould\tbe\tfine.\tThe key\tpoint\tis\tthat\tthere\tis\tvalue\tin\thaving\toverarching\tideas\tthat\tguide\thow\tthe\tsystem evolves,\tand\tin\thaving\tenough\tdetail\tso\tthat\tpeople\tknow\thow\tto\timplement\tthose\tideas. For\ta\tsmall\tenough\tgroup,\tperhaps\ta\tsingle\tteam,\tcombining\tprinciples\tand\tpractices might\tbe\tOK.\tHowever,\tfor\tlarger\torganizations,\twhere\tthe\ttechnology\tand\tworking practices\tmay\tdiffer,\tyou\tmay\twant\ta\tdifferent\tset\tof\tpractices\tin\tdifferent\tplaces,\tas\tlong as\tthey\tboth\tmap\tto\ta\tcommon\tset\tof\tprinciples.\tA\t.NET\tteam,\tfor\texample,\tmight\thave one\tset\tof\tpractices,\tand\ta\tJava\tteam\tanother,\twith\ta\tset\tof\tpractices\tcommon\tto\tboth.\tThe principles,\tthough,\tcould\tbe\tthe\tsame\tfor\tboth.\n\nA\tReal-World\tExample\n\nMy\tcolleague\tEvan\tBottcher\tdeveloped\tthe\tdiagram\tshown\tin\tFigure\t2-1\tin\tthe\tcourse\tof working\twith\tone\tof\tour\tclients.\tThe\tfigure\tshows\tthe\tinterplay\tof\tgoals,\tprinciples,\tand practices\tin\ta\tvery\tclear\tformat.\tOver\tthe\tcourse\tof\ta\tcouple\tyears,\tthe\tpractices\ton\tthe\tfar right\twill\tchange\tfairly\tregularly,\twhereas\tthe\tprinciples\tremain\tfairly\tstatic.\tA\tdiagram such\tas\tthis\tcan\tbe\tprinted\tnicely\ton\ta\tsingle\tsheet\tof\tpaper\tand\tshared,\tand\teach\tidea\tis simple\tenough\tfor\tthe\taverage\tdeveloper\tto\tremember.\tThere\tis,\tof\tcourse,\tmore\tdetail behind\teach\tpoint\there,\tbut\tbeing\table\tto\tarticulate\tthis\tin\tsummary\tform\tis\tvery\tuseful.\n\nFigure\t2-1.\tA\treal-world\texample\tof\tprinciples\tand\tpractices\n\nIt\tmakes\tsense\tto\thave\tdocumentation\tsupporting\tsome\tof\tthese\titems.\tIn\tthe\tmain, though,\tI\tlike\tthe\tidea\tof\thaving\texample\tcode\tthat\tyou\tcan\tlook\tat,\tinspect,\tand\trun, which\tembodies\tthese\tideas.\tEven\tbetter,\twe\tcan\tcreate\ttooling\tthat\tdoes\tthe\tright\tthing out\tof\tthe\tbox.\tWe’ll\tdiscuss\tthat\tin\tmore\tdepth\tmomentarily.\n\nThe\tRequired\tStandard\n\nWhen\tyou’re\tworking\tthrough\tyour\tpractices\tand\tthinking\tabout\tthe\ttrade-offs\tyou\tneed\tto make,\tone\tof\tthe\tcore\tbalances\tto\tfind\tis\thow\tmuch\tvariability\tto\tallow\tin\tyour\tsystem. One\tof\tthe\tkey\tways\tto\tidentify\twhat\tshould\tbe\tconstant\tfrom\tservice\tto\tservice\tis\tto define\twhat\ta\twell-behaved,\tgood\tservice\tlooks\tlike.\tWhat\tis\ta\t“good\tcitizen”\tservice\tin your\tsystem?\tWhat\tcapabilities\tdoes\tit\tneed\tto\thave\tto\tensure\tthat\tyour\tsystem\tis manageable\tand\tthat\tone\tbad\tservice\tdoesn’t\tbring\tdown\tthe\twhole\tsystem?\tAnd,\tas\twith people,\twhat\ta\tgood\tcitizen\tis\tin\tone\tcontext\tdoes\tnot\treflect\twhat\tit\tlooks\tlike\tsomewhere else.\tNonetheless,\tthere\tare\tsome\tcommon\tcharacteristics\tof\twell-behaved\tservices\tthat\tI think\tare\tfairly\timportant\tto\tobserve.\tThese\tare\tthe\tfew\tkey\tareas\twhere\tallowing\ttoo much\tdivergence\tcan\tresult\tin\ta\tpretty\ttorrid\ttime.\tAs\tBen\tChristensen\tfrom\tNetflix\tputs it,\twhen\twe\tthink\tabout\tthe\tbigger\tpicture,\t“it\tneeds\tto\tbe\ta\tcohesive\tsystem\tmade\tof many\tsmall\tparts\twith\tautonomous\tlifecycles\tbut\tall\tcoming\ttogether.”\tSo\twe\tneed\tto\tfind the\tbalance\tbetween\toptimizing\tfor\tautonomy\tof\tthe\tindividual\tmicroservice\twithout losing\tsight\tof\tthe\tbigger\tpicture.\tDefining\tclear\tattributes\tthat\teach\tservice\tshould\thave\tis one\tway\tof\tbeing\tclear\tas\tto\twhere\tthat\tbalance\tsits.\n\nMonitoring\n\nIt\tis\tessential\tthat\twe\tare\table\tto\tdraw\tup\tcoherent,\tcross-service\tviews\tof\tour\tsystem health.\tThis\thas\tto\tbe\ta\tsystem-wide\tview,\tnot\ta\tservice-specific\tview.\tAs\twe’ll\tdiscuss\tin Chapter\t8,\tknowing\tthe\thealth\tof\tan\tindividual\tservice\tis\tuseful,\tbut\toften\tonly\twhen you’re\ttrying\tto\tdiagnose\ta\twider\tproblem\tor\tunderstand\ta\tlarger\ttrend.\tTo\tmake\tthis\tas easy\tas\tpossible,\tI\twould\tsuggest\tensuring\tthat\tall\tservices\temit\thealth\tand\tgeneral monitoring-related\tmetrics\tin\tthe\tsame\tway.\n\nYou\tmight\tchoose\tto\tadopt\ta\tpush\tmechanism,\twhere\teach\tservice\tneeds\tto\tpush\tthis\tdata into\ta\tcentral\tlocation.\tFor\tyour\tmetrics\tthis\tmight\tbe\tGraphite,\tand\tfor\tyour\thealth\tit might\tbe\tNagios.\tOr\tyou\tmight\tdecide\tto\tuse\tpolling\tsystems\tthat\tscrape\tdata\tfrom\tthe nodes\tthemselves.\tBut\twhatever\tyou\tpick,\ttry\tto\tkeep\tit\tstandardized.\tMake\tthe technology\tinside\tthe\tbox\topaque,\tand\tdon’t\trequire\tthat\tyour\tmonitoring\tsystems\tchange in\torder\tto\tsupport\tit.\tLogging\tfalls\tinto\tthe\tsame\tcategory\there:\twe\tneed\tit\tin\tone\tplace.\n\nInterfaces\n\nPicking\ta\tsmall\tnumber\tof\tdefined\tinterface\ttechnologies\thelps\tintegrate\tnew\tconsumers. Having\tone\tstandard\tis\ta\tgood\tnumber.\tTwo\tisn’t\ttoo\tbad,\teither.\tHaving\t20\tdifferent styles\tof\tintegration\tis\tbad.\tThis\tisn’t\tjust\tabout\tpicking\tthe\ttechnology\tand\tthe\tprotocol.\tIf you\tpick\tHTTP/REST,\tfor\texample,\twill\tyou\tuse\tverbs\tor\tnouns?\tHow\twill\tyou\thandle pagination\tof\tresources?\tHow\twill\tyou\thandle\tversioning\tof\tend\tpoints?\n\nArchitectural\tSafety\n\nWe\tcannot\tafford\tfor\tone\tbadly\tbehaved\tservice\tto\truin\tthe\tparty\tfor\teveryone.\tWe\thave\tto ensure\tthat\tour\tservices\tshield\tthemselves\taccordingly\tfrom\tunhealthy,\tdownstream\tcalls. The\tmore\tservices\twe\thave\tthat\tdo\tnot\tproperly\thandle\tthe\tpotential\tfailure\tof\tdownstream calls,\tthe\tmore\tfragile\tour\tsystems\twill\tbe.\tThis\tmeans\tyou\twill\tprobably\twant\tto\tmandate as\ta\tminimum\tthat\teach\tdownstream\tservice\tgets\tits\town\tconnection\tpool,\tand\tyou\tmay even\tgo\tas\tfar\tas\tto\tsay\tthat\teach\talso\tuses\ta\tcircuit\tbreaker.\tThis\twill\tget\tcovered\tin\tmore depth\twhen\twe\tdiscuss\tmicroservices\tat\tscale\tin\tChapter\t11.\n\nPlaying\tby\tthe\trules\tis\timportant\twhen\tit\tcomes\tto\tresponse\tcodes,\ttoo.\tIf\tyour\tcircuit breakers\trely\ton\tHTTP\tcodes,\tand\tone\tservice\tdecides\tto\tsend\tback\t2XX\tcodes\tfor\terrors, or\tconfuses\t4XX\tcodes\twith\t5XX\tcodes,\tthen\tthese\tsafety\tmeasures\tcan\tfall\tapart.\tSimilar concerns\twould\tapply\teven\tif\tyou’re\tnot\tusing\tHTTP;\tknowing\tthe\tdifference\tbetween\ta request\tthat\twas\tOK\tand\tprocessed\tcorrectly,\ta\trequest\tthat\twas\tbad\tand\tthus\tprevented the\tservice\tfrom\tdoing\tanything\twith\tit,\tand\ta\trequest\tthat\tmight\tbe\tOK\tbut\twe\tcan’t\ttell because\tthe\tserver\twas\tdown\tis\tkey\tto\tensuring\twe\tcan\tfail\tfast\tand\ttrack\tdown\tissues.\tIf our\tservices\tplay\tfast\tand\tloose\twith\tthese\trules,\twe\tend\tup\twith\ta\tmore\tvulnerable system.\n\nGovernance\tThrough\tCode\n\nGetting\ttogether\tand\tagreeing\ton\thow\tthings\tcan\tbe\tdone\tis\ta\tgood\tidea.\tBut\tspending time\tmaking\tsure\tpeople\tare\tfollowing\tthese\tguidelines\tis\tless\tfun,\tas\tis\tplacing\ta\tburden on\tdevelopers\tto\timplement\tall\tthese\tstandard\tthings\tyou\texpect\teach\tservice\tto\tdo.\tI\tam\ta great\tbeliever\tin\tmaking\tit\teasy\tto\tdo\tthe\tright\tthing.\tTwo\ttechniques\tI\thave\tseen\twork well\there\tare\tusing\texemplars\tand\tproviding\tservice\ttemplates.\n\nExemplars\n\nWritten\tdocumentation\tis\tgood,\tand\tuseful.\tI\tclearly\tsee\tthe\tvalue;\tafter\tall,\tI’ve\twritten this\tbook.\tBut\tdevelopers\talso\tlike\tcode,\tand\tcode\tthey\tcan\trun\tand\texplore.\tIf\tyou\thave\ta set\tof\tstandards\tor\tbest\tpractices\tyou\twould\tlike\tto\tencourage,\tthen\thaving\texemplars\tthat you\tcan\tpoint\tpeople\tto\tis\tuseful.\tThe\tidea\tis\tthat\tpeople\tcan’t\tgo\tfar\twrong\tjust\tby imitating\tsome\tof\tthe\tbetter\tparts\tof\tyour\tsystem.\n\nIdeally,\tthese\tshould\tbe\treal-world\tservices\tyou\thave\tthat\tget\tthings\tright,\trather\tthan isolated\tservices\tthat\tare\tjust\timplemented\tto\tbe\tperfect\texamples.\tBy\tensuring\tyour exemplars\tare\tactually\tbeing\tused,\tyou\tensure\tthat\tall\tthe\tprinciples\tyou\thave\tactually make\tsense.\n\nTailored\tService\tTemplate\n\nWouldn’t\tit\tbe\tgreat\tif\tyou\tcould\tmake\tit\treally\teasy\tfor\tall\tdevelopers\tto\tfollow\tmost\tof the\tguidelines\tyou\thave\twith\tvery\tlittle\twork?\tWhat\tif,\tout\tof\tthe\tbox,\tthe\tdevelopers\thad most\tof\tthe\tcode\tin\tplace\tto\timplement\tthe\tcore\tattributes\tthat\teach\tservice\tneeds?\n\nDropwizard\tand\tKaryon\tare\ttwo\topen\tsource,\tJVM-based\tmicrocontainers.\tThey\twork\tin similar\tways,\tpulling\ttogether\ta\tset\tof\tlibraries\tto\tprovide\tfeatures\tlike\thealth\tchecking, serving\tHTTP,\tor\texposing\tmetrics.\tSo,\tout\tof\tthe\tbox,\tyou\thave\ta\tservice\tcomplete\twith an\tembedded\tservlet\tcontainer\tthat\tcan\tbe\tlaunched\tfrom\tthe\tcommand\tline.\tThis\tis\ta great\tway\tto\tget\tgoing,\tbut\twhy\tstop\tthere?\tWhile\tyou’re\tat\tit,\twhy\tnot\ttake\tsomething like\ta\tDropwizard\tor\tKaryon,\tand\tadd\tmore\tfeatures\tso\tthat\tit\tbecomes\tcompliant\tfor\tyour context?\n\nFor\texample,\tyou\tmight\twant\tto\tmandate\tthe\tuse\tof\tcircuit\tbreakers.\tIn\tthat\tcase,\tyou might\tintegrate\ta\tcircuit\tbreaker\tlibrary\tlike\tHystrix.\tOr\tyou\tmight\thave\ta\tpractice\tthat\tall your\tmetrics\tneed\tto\tbe\tsent\tto\ta\tcentral\tGraphite\tserver,\tso\tperhaps\tpull\tin\tan\topen\tsource library\tlike\tDropwizard’s\tMetrics\tand\tconfigure\tit\tso\tthat,\tout\tof\tthe\tbox,\tresponse\ttimes and\terror\trates\tare\tpushed\tautomatically\tto\ta\tknown\tlocation.\n\nBy\ttailoring\tsuch\ta\tservice\ttemplate\tfor\tyour\town\tset\tof\tdevelopment\tpractices,\tyou\tensure that\tteams\tcan\tget\tgoing\tfaster,\tand\talso\tthat\tdevelopers\thave\tto\tgo\tout\tof\ttheir\tway\tto make\ttheir\tservices\tbadly\tbehaved.\n\nOf\tcourse,\tif\tyou\tembraced\tmultiple\tdisparate\ttechnology\tstacks,\tyou’d\tneed\ta\tmatching service\ttemplate\tfor\teach.\tThis\tmay\tbe\ta\tway\tyou\tsubtly\tconstrain\tlanguage\tchoices\tin your\tteams,\tthough.\tIf\tthe\tin-house\tservice\ttemplate\tsupports\tonly\tJava,\tthen\tpeople\tmay be\tdiscouraged\tfrom\tpicking\talternative\tstacks\tif\tthey\thave\tto\tdo\tlots\tmore\twork themselves.\tNetflix,\tfor\texample,\tis\tespecially\tconcerned\twith\taspects\tlike\tfault\ttolerance, to\tensure\tthat\tthe\toutage\tof\tone\tpart\tof\tits\tsystem\tcannot\ttake\teverything\tdown.\tTo\thandle this,\ta\tlarge\tamount\tof\twork\thas\tbeen\tdone\tto\tensure\tthat\tthere\tare\tclient\tlibraries\ton\tthe JVM\tto\tprovide\tteams\twith\tthe\ttools\tthey\tneed\tto\tkeep\ttheir\tservices\twell\tbehaved. Anyone\tintroducing\ta\tnew\ttechnology\tstack\twould\tmean\thaving\tto\treproduce\tall\tthis effort.\tThe\tmain\tconcern\tfor\tNetflix\tis\tless\tabout\tthe\tduplicated\teffort,\tand\tmore\tabout\tthe fact\tthat\tit\tis\tso\teasy\tto\tget\tthis\twrong.\tThe\trisk\tof\ta\tservice\tgetting\tnewly\timplemented fault\ttolerance\twrong\tis\thigh\tif\tit\tcould\timpact\tmore\tof\tthe\tsystem.\tNetflix\tmitigates\tthis by\tusing\tsidecar\tservices,\twhich\tcommunicate\tlocally\twith\ta\tJVM\tthat\tis\tusing\tthe appropriate\tlibraries.\n\nYou\tdo\thave\tto\tbe\tcareful\tthat\tcreating\tthe\tservice\ttemplate\tdoesn’t\tbecome\tthe\tjob\tof\ta central\ttools\tor\tarchitecture\tteam\twho\tdictates\thow\tthings\tshould\tbe\tdone,\talbeit\tvia\tcode. Defining\tthe\tpractices\tyou\tuse\tshould\tbe\ta\tcollective\tactivity,\tso\tideally\tyour\tteam(s) should\ttake\tjoint\tresponsibility\tfor\tupdating\tthis\ttemplate\t(an\tinternal\topen\tsource approach\tworks\twell\there).\n\nI\thave\talso\tseen\tmany\ta\tteam’s\tmorale\tand\tproductivity\tdestroyed\tby\thaving\ta\tmandated framework\tthrust\tupon\tthem.\tIn\ta\tdrive\tto\timprove\tcode\treuse,\tmore\tand\tmore\twork\tis placed\tinto\ta\tcentralized\tframework\tuntil\tit\tbecomes\tan\toverwhelming\tmonstrosity.\tIf\tyou decide\tto\tuse\ta\ttailored\tservice\ttemplate,\tthink\tvery\tcarefully\tabout\twhat\tits\tjob\tis.\tIdeally, its\tuse\tshould\tbe\tpurely\toptional,\tbut\tif\tyou\tare\tgoing\tto\tbe\tmore\tforceful\tin\tits\tadoption you\tneed\tto\tunderstand\tthat\tease\tof\tuse\tfor\tthe\tdevelopers\thas\tto\tbe\ta\tprime\tguiding\tforce.\n\nAlso\tbe\taware\tof\tthe\tperils\tof\tshared\tcode.\tIn\tour\tdesire\tto\tcreate\treusable\tcode,\twe\tcan introduce\tsources\tof\tcoupling\tbetween\tservices.\tAt\tleast\tone\torganization\tI\tspoke\tto\tis\tso worried\tabout\tthis\tthat\tit\tactually\tcopies\tits\tservice\ttemplate\tcode\tmanually\tinto\teach service.\tThis\tmeans\tthat\tan\tupgrade\tto\tthe\tcore\tservice\ttemplate\ttakes\tlonger\tto\tbe\tapplied across\tits\tsystem,\tbut\tthis\tis\tless\tconcerning\tto\tit\tthan\tthe\tdanger\tof\tcoupling.\tOther\tteams I\thave\tspoken\tto\thave\tsimply\ttreated\tthe\tservice\ttemplate\tas\ta\tshared\tbinary\tdependency, although\tthey\thave\tto\tbe\tvery\tdiligent\tin\tnot\tletting\tthe\ttendency\tfor\tDRY\t(don’t\trepeat yourself)\tresult\tin\tan\toverly\tcoupled\tsystem!\tThis\tis\ta\tnuanced\ttopic,\tso\twe’ll\texplore\tit\tin more\tdetail\tin\tChapter\t4.\n\nTechnical\tDebt\n\nWe\tare\toften\tput\tin\tsituations\twhere\twe\tcannot\tfollow\tthrough\tto\tthe\tletter\ton\tour technical\tvision.\tOften,\twe\tneed\tto\tmake\ta\tchoice\tto\tcut\ta\tfew\tcorners\tto\tget\tsome\turgent features\tout.\tThis\tis\tjust\tone\tmore\ttrade-off\tthat\twe’ll\tfind\tourselves\thaving\tto\tmake.\tOur technical\tvision\texists\tfor\ta\treason.\tIf\twe\tdeviate\tfrom\tthis\treason,\tit\tmight\thave\ta\tshort- term\tbenefit\tbut\ta\tlong-term\tcost.\tA\tconcept\tthat\thelps\tus\tunderstand\tthis\ttrade-off\tis technical\tdebt.\tWhen\twe\taccrue\ttechnical\tdebt,\tjust\tlike\tdebt\tin\tthe\treal\tworld\tit\thas\tan ongoing\tcost,\tand\tis\tsomething\twe\twant\tto\tpay\tdown.\n\nSometimes\ttechnical\tdebt\tisn’t\tjust\tsomething\twe\tcause\tby\ttaking\tshortcuts.\tWhat\thappens if\tour\tvision\tfor\tthe\tsystem\tchanges,\tbut\tnot\tall\tof\tour\tsystem\tmatches?\tIn\tthis\tsituation, too,\twe\thave\tcreated\tnew\tsources\tof\ttechnical\tdebt.\n\nThe\tarchitect’s\tjob\tis\tto\tlook\tat\tthe\tbigger\tpicture,\tand\tunderstand\tthis\tbalance.\tHaving some\tview\tas\tto\tthe\tlevel\tof\tdebt,\tand\twhere\tto\tget\tinvolved,\tis\timportant.\tDepending\ton your\torganization,\tyou\tmight\tbe\table\tto\tprovide\tgentle\tguidance,\tbut\thave\tthe\tteams themselves\tdecide\thow\tto\ttrack\tand\tpay\tdown\tthe\tdebt.\tFor\tother\torganizations,\tyou\tmay need\tto\tbe\tmore\tstructured,\tperhaps\tmaintaining\ta\tdebt\tlog\tthat\tis\treviewed\tregularly.\n\nException\tHandling\n\nSo\tour\tprinciples\tand\tpractices\tguide\thow\tour\tsystems\tshould\tbe\tbuilt.\tBut\twhat\thappens when\tour\tsystem\tdeviates\tfrom\tthis?\tSometimes\twe\tmake\ta\tdecision\tthat\tis\tjust\tan exception\tto\tthe\trule.\tIn\tthese\tcases,\tit\tmight\tbe\tworth\tcapturing\tsuch\ta\tdecision\tin\ta\tlog somewhere\tfor\tfuture\treference.\tIf\tenough\texceptions\tare\tfound,\tit\tmay\teventually\tmake sense\tto\tchange\tthe\tprinciple\tor\tpractice\tto\treflect\ta\tnew\tunderstanding\tof\tthe\tworld.\tFor example,\twe\tmight\thave\ta\tpractice\tthat\tstates\tthat\twe\twill\talways\tuse\tMySQL\tfor\tdata storage.\tBut\tthen\twe\tsee\tcompelling\treasons\tto\tuse\tCassandra\tfor\thighly\tscalable\tstorage, at\twhich\tpoint\twe\tchange\tour\tpractice\tto\tsay,\t“Use\tMySQL\tfor\tmost\tstorage\trequirements, unless\tyou\texpect\tlarge\tgrowth\tin\tvolumes,\tin\twhich\tcase\tuse\tCassandra.”\n\nIt’s\tprobably\tworth\treiterating,\tthough,\tthat\tevery\torganization\tis\tdifferent.\tI’ve\tworked with\tsome\tcompanies\twhere\tthe\tdevelopment\tteams\thave\ta\thigh\tdegree\tof\ttrust\tand autonomy,\tand\tthere\tthe\tprinciples\tare\tlightweight\t(and\tthe\tneed\tfor\tovert\texception handling\tis\tgreatly\treduced\tif\tnot\teliminated).\tIn\tmore\tstructured\torganizations\tin\twhich developers\thave\tless\tfreedom,\ttracking\texceptions\tmay\tbe\tvital\tto\tensure\tthat\tthe\trules\tput in\tplace\tproperly\treflect\tthe\tchallenges\tpeople\tare\tfacing.\tWith\tall\tthat\tsaid,\tI\tam\ta\tfan\tof microservices\tas\ta\tway\tof\toptimizing\tfor\tautonomy\tof\tteams,\tgiving\tthem\tas\tmuch freedom\tas\tpossible\tto\tsolve\tthe\tproblem\tat\thand.\tIf\tyou\tare\tworking\tin\tan\torganization that\tplaces\tlots\tof\trestrictions\ton\thow\tdevelopers\tcan\tdo\ttheir\twork,\tthen\tmicroservices may\tnot\tbe\tfor\tyou.\n\nGovernance\tand\tLeading\tfrom\tthe\tCenter\n\nPart\tof\twhat\tarchitects\tneed\tto\thandle\tis\tgovernance.\tWhat\tdo\tI\tmean\tby\tgovernance?\tIt turns\tout\tthe\tControl\tObjectives\tfor\tInformation\tand\tRelated\tTechnology\t(COBIT)\thas\ta pretty\tgood\tdefinition:\n\nGovernance\tensures\tthat\tenterprise\tobjectives\tare\tachieved\tby\tevaluating\tstakeholder needs,\tconditions\tand\toptions;\tsetting\tdirection\tthrough\tprioritisation\tand\tdecision making;\tand\tmonitoring\tperformance,\tcompliance\tand\tprogress\tagainst\tagreed-on direction\tand\tobjectives.\n\nCOBIT\t5\n\nGovernance\tcan\tapply\tto\tmultiple\tthings\tin\tthe\tforum\tof\tIT.\tWe\twant\tto\tfocus\ton\tthe aspect\tof\ttechnical\tgovernance,\tsomething\tI\tfeel\tis\tthe\tjob\tof\tthe\tarchitect.\tIf\tone\tof\tthe architect’s\tjobs\tis\tensuring\tthere\tis\ta\ttechnical\tvision,\tthen\tgovernance\tis\tabout\tensuring what\twe\tare\tbuilding\tmatches\tthis\tvision,\tand\tevolving\tthe\tvision\tif\tneeded.\n\nArchitects\tare\tresponsible\tfor\ta\tlot\tof\tthings.\tThey\tneed\tto\tensure\tthere\tis\ta\tset\tof principles\tthat\tcan\tguide\tdevelopment,\tand\tthat\tthese\tprinciples\tmatch\tthe\torganization’s strategy.\tThey\tneed\tto\tmake\tsure\tas\twell\tthat\tthese\tprinciples\tdon’t\trequire\tworking practices\tthat\tmake\tdevelopers\tmiserable.\tThey\tneed\tto\tkeep\tup\tto\tdate\twith\tnew technology,\tand\tknow\twhen\tto\tmake\tthe\tright\ttrade-offs.\tThis\tis\tan\tawful\tlot\tof responsibility.\tAll\tthat,\tand\tthey\talso\tneed\tto\tcarry\tpeople\twith\tthem\t—\tthat\tis,\tto\tensure that\tthe\tcolleagues\tthey\tare\tworking\twith\tunderstand\tthe\tdecisions\tbeing\tmade\tand\tare brought\tin\tto\tcarry\tthem\tout.\tOh,\tand\tas\twe’ve\talready\tmentioned:\tthey\tneed\tto\tspend some\ttime\twith\tthe\tteams\tto\tunderstand\tthe\timpact\tof\ttheir\tdecisions,\tand\tperhaps\teven code\ttoo.\n\nA\ttall\torder?\tAbsolutely.\tBut\tI\tam\tfirmly\tof\tthe\topinion\tthat\tthey\tshouldn’t\tdo\tthis\talone. A\tproperly\tfunctioning\tgovernance\tgroup\tcan\twork\ttogether\tto\tshare\tthe\twork\tand\tshape the\tvision.\n\nNormally,\tgovernance\tis\ta\tgroup\tactivity.\tIt\tcould\tbe\tan\tinformal\tchat\twith\ta\tsmall\tenough team,\tor\ta\tmore\tstructured\tregular\tmeeting\twith\tformal\tgroup\tmembership\tfor\ta\tlarger scope.\tThis\tis\twhere\tI\tthink\tthe\tprinciples\twe\tcovered\tearlier\tshould\tbe\tdiscussed\tand changed\tas\trequired.\tThis\tgroup\tneeds\tto\tbe\tled\tby\ta\ttechnologist,\tand\tto\tconsist predominantly\tof\tpeople\twho\tare\texecuting\tthe\twork\tbeing\tgoverned.\tThis\tgroup\tshould also\tbe\tresponsible\tfor\ttracking\tand\tmanaging\ttechnical\trisks.\n\nA\tmodel\tI\tgreatly\tfavor\tis\thaving\tthe\tarchitect\tchair\tthe\tgroup,\tbut\thaving\tthe\tbulk\tof\tthe group\tdrawn\tfrom\tthe\ttechnologists\tof\teach\tdelivery\tteam\t—\tthe\tleads\tof\teach\tteam\tat\ta minimum.\tThe\tarchitect\tis\tresponsible\tfor\tmaking\tsure\tthe\tgroup\tworks,\tbut\tthe\tgroup\tas\ta whole\tis\tresponsible\tfor\tgovernance.\tThis\tshares\tthe\tload,\tand\tensures\tthat\tthere\tis\ta higher\tlevel\tof\tbuy-in.\tIt\talso\tensures\tthat\tinformation\tflows\tfreely\tfrom\tthe\tteams\tinto\tthe group,\tand\tas\ta\tresult,\tthe\tdecision\tmaking\tis\tmuch\tmore\tsensible\tand\tinformed.\n\nSometimes,\tthe\tgroup\tmay\tmake\tdecisions\twith\twhich\tthe\tarchitect\tdisagrees.\tAt\tthis point,\twhat\tis\tthe\tarchitect\tto\tdo?\tHaving\tbeen\tin\tthis\tposition\tbefore,\tI\tcan\ttell\tyou\tthis\tis one\tof\tthe\tmost\tchallenging\tsituations\tto\tface.\tOften,\tI\ttake\tthe\tapproach\tthat\tI\tshould\tgo with\tthe\tgroup\tdecision.\tI\ttake\tthe\tview\tthat\tI’ve\tdone\tmy\tbest\tto\tconvince\tpeople,\tbut ultimately\tI\twasn’t\tconvincing\tenough.\tThe\tgroup\tis\toften\tmuch\twiser\tthan\tthe\tindividual, and\tI’ve\tbeen\tproven\twrong\tmore\tthan\tonce!\tAnd\timagine\thow\tdisempowering\tit\tcan\tbe for\ta\tgroup\tto\thave\tbeen\tgiven\tspace\tto\tcome\tup\twith\ta\tdecision,\tand\tthen\tultimately\tbe ignored.\tBut\tsometimes\tI\thave\toverruled\tthe\tgroup.\tBut\twhy,\tand\twhen?\tHow\tdo\tyou\tpick the\tlines?\n\nThink\tabout\tteaching\tchildren\tto\tride\ta\tbike.\tYou\tcan’t\tride\tit\tfor\tthem.\tYou\twatch\tthem wobble,\tbut\tif\tyou\tstepped\tin\tevery\ttime\tit\tlooked\tlike\tthey\tmight\tfall\toff,\tthen\tthey’d never\tlearn,\tand\tin\tany\tcase\tthey\tfall\toff\tfar\tless\tthan\tyou\tthink\tthey\twill!\tBut\tif\tyou\tsee them\tabout\tto\tveer\tinto\ttraffic,\tor\tinto\ta\tnearby\tduck\tpond,\tthen\tyou\thave\tto\tstep\tin. Likewise,\tas\tan\tarchitect,\tyou\tneed\tto\thave\ta\tfirm\tgrasp\tof\twhen,\tfiguratively,\tyour\tteam\tis steering\tinto\ta\tduck\tpond.\tYou\talso\tneed\tto\tbe\taware\tthat\teven\tif\tyou\tknow\tyou\tare\tright and\toverrule\tthe\tteam,\tthis\tcan\tundermine\tyour\tposition\tand\talso\tmake\tthe\tteam\tfeel\tthat they\tdon’t\thave\ta\tsay.\tSometimes\tthe\tright\tthing\tis\tto\tgo\talong\twith\ta\tdecision\tyou\tdon’t agree\twith.\tKnowing\twhen\tto\tdo\tthis\tand\twhen\tnot\tto\tis\ttough,\tbut\tis\tsometimes\tvital.\n\nBuilding\ta\tTeam\n\nBeing\tthe\tmain\tpoint\tperson\tresponsible\tfor\tthe\ttechnical\tvision\tof\tyour\tsystem\tand ensuring\tthat\tyou’re\texecuting\ton\tthis\tvision\tisn’t\tjust\tabout\tmaking\ttechnology\tdecisions. It’s\tthe\tpeople\tyou\twork\twith\twho\twill\tbe\tdoing\tthe\twork.\tMuch\tof\tthe\trole\tof\tthe technical\tleader\tis\tabout\thelping\tgrow\tthem\t—\tto\thelp\tthem\tunderstand\tthe\tvision themselves\t—\tand\talso\tensuring\tthat\tthey\tcan\tbe\tactive\tparticipants\tin\tshaping\tand implementing\tthe\tvision\ttoo.\n\nHelping\tthe\tpeople\taround\tyou\ton\ttheir\town\tcareer\tgrowth\tcan\ttake\tmany\tforms,\tmost\tof which\tare\toutside\tthe\tscope\tof\tthis\tbook.\tThere\tis\tone\taspect,\tthough,\twhere\ta microservice\tarchitecture\tis\tespecially\trelevant.\tWith\tlarger,\tmonolithic\tsystems,\tthere\tare fewer\topportunities\tfor\tpeople\tto\tstep\tup\tand\town\tsomething.\tWith\tmicroservices,\ton\tthe other\thand,\twe\thave\tmultiple\tautonomous\tcodebases\tthat\twill\thave\ttheir\town\tindependent lifecycles.\tHelping\tpeople\tstep\tup\tby\thaving\tthem\ttake\townership\tof\tindividual\tservices before\taccepting\tmore\tresponsibility\tcan\tbe\ta\tgreat\tway\tto\thelp\tthem\tachieve\ttheir\town career\tgoals,\tand\tat\tthe\tsame\ttime\tlightens\tthe\tload\ton\twhoever\tis\tin\tcharge!\n\nI\tam\ta\tstrong\tbeliever\tthat\tgreat\tsoftware\tcomes\tfrom\tgreat\tpeople.\tIf\tyou\tworry\tonly about\tthe\ttechnology\tside\tof\tthe\tequation,\tyou’re\tmissing\tway\tmore\tthan\thalf\tof\tthe picture.\n\nSummary\n\nTo\tsummarize\tthis\tchapter,\there\tare\twhat\tI\tsee\tas\tthe\tcore\tresponsibilities\tof\tthe evolutionary\tarchitect:\n\nVision\n\nEnsure\tthere\tis\ta\tclearly\tcommunicated\ttechnical\tvision\tfor\tthe\tsystem\tthat\twill\thelp your\tsystem\tmeet\tthe\trequirements\tof\tyour\tcustomers\tand\torganization\n\nEmpathy\n\nUnderstand\tthe\timpact\tof\tyour\tdecisions\ton\tyour\tcustomers\tand\tcolleagues\n\nCollaboration\n\nEngage\twith\tas\tmany\tof\tyour\tpeers\tand\tcolleagues\tas\tpossible\tto\thelp\tdefine,\trefine, and\texecute\tthe\tvision\n\nAdaptability\n\nMake\tsure\tthat\tthe\ttechnical\tvision\tchanges\tas\tyour\tcustomers\tor\torganization requires\tit\n\nAutonomy\n\nFind\tthe\tright\tbalance\tbetween\tstandardizing\tand\tenabling\tautonomy\tfor\tyour\tteams\n\nGovernance\n\nEnsure\tthat\tthe\tsystem\tbeing\timplemented\tfits\tthe\ttechnical\tvision\n\nThe\tevolutionary\tarchitect\tis\tone\twho\tunderstands\tthat\tpulling\toff\tthis\tfeat\tis\ta\tconstant balancing\tact.\tForces\tare\talways\tpushing\tyou\tone\tway\tor\tanother,\tand\tunderstanding where\tto\tpush\tback\tor\twhere\tto\tgo\twith\tthe\tflow\tis\toften\tsomething\tthat\tcomes\tonly\twith experience.\tBut\tthe\tworst\treaction\tto\tall\tthese\tforces\tthat\tpush\tus\ttoward\tchange\tis\tto become\tmore\trigid\tor\tfixed\tin\tour\tthinking.\n\nWhile\tmuch\tof\tthe\tadvice\tin\tthis\tchapter\tcan\tapply\tto\tany\tsystems\tarchitect,\tmicroservices give\tus\tmany\tmore\tdecisions\tto\tmake.\tTherefore,\tbeing\tbetter\table\tto\tbalance\tall\tof\tthese trade-offs\tis\tessential.\n\nIn\tthe\tnext\tchapter,\twe’ll\ttake\tsome\tof\tour\tnewfound\tawareness\tof\tthe\tarchitect’s\trole\twith us\tas\twe\tstart\tthinking\tabout\thow\tto\tfind\tthe\tright\tboundaries\tfor\tour\tmicroservices.\n\nChapter\t3.\tHow\tto\tModel\tServices\n\nMy\topponent’s\treasoning\treminds\tme\tof\tthe\theathen,\twho,\tbeing\tasked\ton\twhat\tthe world\tstood,\treplied,\t“On\ta\ttortoise.”\tBut\ton\twhat\tdoes\tthe\ttortoise\tstand?\t“On another\ttortoise.”\n\nJoseph\tBarker\t(1854)\n\nSo\tyou\tknow\twhat\tmicroservices\tare,\tand\thopefully\thave\ta\tsense\tof\ttheir\tkey\tbenefits. You’re\tprobably\teager\tnow\tto\tgo\tand\tstart\tmaking\tthem,\tright?\tBut\twhere\tto\tstart?\tIn\tthis chapter,\twe’ll\tlook\tat\thow\tto\tthink\tabout\tthe\tboundaries\tof\tyour\tmicroservices\tthat\twill hopefully\tmaximize\tthe\tupsides\tand\tavoid\tsome\tof\tthe\tpotential\tdownsides.\tBut\tfirst,\twe need\tsomething\tto\twork\twith.",
      "page_number": 35
    },
    {
      "number": 3,
      "title": "How\tto\tModel\tServices",
      "start_page": 62,
      "end_page": 79,
      "detection_method": "regex_chapter_title",
      "content": "Introducing\tMusicCorp\n\nBooks\tabout\tideas\twork\tbetter\twith\texamples.\tWhere\tpossible,\tI’ll\tbe\tsharing\tstories\tfrom real-world\tsituations,\tbut\tI’ve\tfound\tit’s\talso\tuseful\tto\thave\ta\tfictional\tdomain\twith\twhich to\twork.\tThroughout\tthe\tbook,\twe’ll\tbe\treturning\tto\tthis\tdomain,\tseeing\thow\tthe\tconcept of\tmicroservices\tworks\twithin\tthis\tworld.\n\nSo\tlet’s\tturn\tour\tattention\tto\tthe\tcutting-edge\tonline\tretailer\tMusicCorp.\tMusicCorp\twas recently\ta\tbrick-and-mortar\tretailer,\tbut\tafter\tthe\tbottom\tdropped\tout\tof\tthe\tgramophone record\tbusiness\tit\tfocused\tmore\tand\tmore\tof\tits\tefforts\tonline.\tThe\tcompany\thas\ta\twebsite, but\tfeels\tthat\tnow\tis\tthe\ttime\tto\tdouble-down\ton\tthe\tonline\tworld.\tAfter\tall,\tthose\tiPods are\tjust\ta\tpassing\tfad\t(Zunes\tare\tway\tbetter,\tobviously)\tand\tmusic\tfans\tare\tquite\thappy\tto wait\tfor\tCDs\tto\tarrive\tat\ttheir\tdoorsteps.\tQuality\tover\tconvenience,\tright?\tAnd\twhile we’re\tat\tit,\twhat’s\tthis\tSpotify\tthing\tpeople\tkeep\ttalking\tabout\t—\tsome\tsort\tof\tskin treatment\tfor\tteenagers?\n\nDespite\tbeing\ta\tlittle\tbehind\tthe\tcurve,\tMusicCorp\thas\tgrand\tambitions.\tLuckily,\tit\thas decided\tthat\tits\tbest\tchance\tof\ttaking\tover\tthe\tworld\tis\tby\tmaking\tsure\tit\tcan\tmake changes\tas\teasily\tas\tpossible.\tMicroservices\tfor\tthe\twin!\n\nWhat\tMakes\ta\tGood\tService?\n\nBefore\tthe\tteam\tfrom\tMusicCorp\ttears\toff\tinto\tthe\tdistance,\tcreating\tservice\tafter\tservice in\tan\tattempt\tto\tdeliver\teight-track\ttapes\tto\tall\tand\tsundry,\tlet’s\tput\tthe\tbrakes\ton\tand\ttalk a\tbit\tabout\tthe\tmost\timportant\tunderlying\tidea\twe\tneed\tto\tkeep\tin\tmind.\tWhat\tmakes\ta good\tservice?\tIf\tyou’ve\tsurvived\ta\tfailed\tSOA\timplementation,\tyou\tmay\thave\tsome\tidea where\tI’m\tgoing\tnext.\tBut\tjust\tin\tcase\tyou\taren’t\tthat\t(un)fortunate,\tI\twant\tyou\tto\tfocus\ton two\tkey\tconcepts:\tloose\tcoupling\tand\thigh\tcohesion.\tWe’ll\ttalk\tin\tdetail\tthroughout\tthe book\tabout\tother\tideas\tand\tpractices,\tbut\tthey\tare\tall\tfor\tnaught\tif\twe\tget\tthese\ttwo\tthing wrong.\n\nDespite\tthe\tfact\tthat\tthese\ttwo\tterms\tare\tused\ta\tlot,\tespecially\tin\tthe\tcontext\tof\tobject- oriented\tsystems,\tit\tis\tworth\tdiscussing\twhat\tthey\tmean\tin\tterms\tof\tmicroservices.\n\nLoose\tCoupling\n\nWhen\tservices\tare\tloosely\tcoupled,\ta\tchange\tto\tone\tservice\tshould\tnot\trequire\ta\tchange\tto another.\tThe\twhole\tpoint\tof\ta\tmicroservice\tis\tbeing\table\tto\tmake\ta\tchange\tto\tone\tservice and\tdeploy\tit,\twithout\tneeding\tto\tchange\tany\tother\tpart\tof\tthe\tsystem.\tThis\tis\treally\tquite important.\n\nWhat\tsort\tof\tthings\tcause\ttight\tcoupling?\tA\tclassic\tmistake\tis\tto\tpick\tan\tintegration\tstyle that\ttightly\tbinds\tone\tservice\tto\tanother,\tcausing\tchanges\tinside\tthe\tservice\tto\trequire\ta change\tto\tconsumers.\tWe’ll\tdiscuss\thow\tto\tavoid\tthis\tin\tmore\tdepth\tin\tChapter\t4.\n\nA\tloosely\tcoupled\tservice\tknows\tas\tlittle\tas\tit\tneeds\tto\tabout\tthe\tservices\twith\twhich\tit collaborates.\tThis\talso\tmeans\twe\tprobably\twant\tto\tlimit\tthe\tnumber\tof\tdifferent\ttypes\tof calls\tfrom\tone\tservice\tto\tanother,\tbecause\tbeyond\tthe\tpotential\tperformance\tproblem, chatty\tcommunication\tcan\tlead\tto\ttight\tcoupling.\n\nHigh\tCohesion\n\nWe\twant\trelated\tbehavior\tto\tsit\ttogether,\tand\tunrelated\tbehavior\tto\tsit\telsewhere.\tWhy? Well,\tif\twe\twant\tto\tchange\tbehavior,\twe\twant\tto\tbe\table\tto\tchange\tit\tin\tone\tplace,\tand release\tthat\tchange\tas\tsoon\tas\tpossible.\tIf\twe\thave\tto\tchange\tthat\tbehavior\tin\tlots\tof different\tplaces,\twe’ll\thave\tto\trelease\tlots\tof\tdifferent\tservices\t(perhaps\tat\tthe\tsame\ttime) to\tdeliver\tthat\tchange.\tMaking\tchanges\tin\tlots\tof\tdifferent\tplaces\tis\tslower,\tand\tdeploying lots\tof\tservices\tat\tonce\tis\trisky\t—\tboth\tof\twhich\twe\twant\tto\tavoid.\n\nSo\twe\twant\tto\tfind\tboundaries\twithin\tour\tproblem\tdomain\tthat\thelp\tensure\tthat\trelated behavior\tis\tin\tone\tplace,\tand\tthat\tcommunicate\twith\tother\tboundaries\tas\tloosely\tas possible.\n\nThe\tBounded\tContext\n\nEric\tEvans’s\tbook\tDomain-Driven\tDesign\t(Addison-Wesley)\tfocuses\ton\thow\tto\tcreate systems\tthat\tmodel\treal-world\tdomains.\tThe\tbook\tis\tfull\tof\tgreat\tideas\tlike\tusing ubiquitous\tlanguage,\trepository\tabstractions,\tand\tthe\tlike,\tbut\tthere\tis\tone\tvery\timportant concept\tEvans\tintroduces\tthat\tcompletely\tpassed\tme\tby\tat\tfirst:\tbounded\tcontext.\tThe\tidea is\tthat\tany\tgiven\tdomain\tconsists\tof\tmultiple\tbounded\tcontexts,\tand\tresiding\twithin\teach are\tthings\t(Eric\tuses\tthe\tword\tmodel\ta\tlot,\twhich\tis\tprobably\tbetter\tthan\tthings)\tthat\tdo\tnot need\tto\tbe\tcommunicated\toutside\tas\twell\tas\tthings\tthat\tare\tshared\texternally\twith\tother bounded\tcontexts.\tEach\tbounded\tcontext\thas\tan\texplicit\tinterface,\twhere\tit\tdecides\twhat models\tto\tshare\twith\tother\tcontexts.\n\nAnother\tdefinition\tof\tbounded\tcontexts\tI\tlike\tis\t“a\tspecific\tresponsibility\tenforced\tby explicit\tboundaries.”1\tIf\tyou\twant\tinformation\tfrom\ta\tbounded\tcontext,\tor\twant\tto\tmake requests\tof\tfunctionality\twithin\ta\tbounded\tcontext,\tyou\tcommunicate\twith\tits\texplicit boundary\tusing\tmodels.\tIn\this\tbook,\tEvans\tuses\tthe\tanalogy\tof\tcells,\twhere\t“[c]ells\tcan exist\tbecause\ttheir\tmembranes\tdefine\twhat\tis\tin\tand\tout\tand\tdetermine\twhat\tcan\tpass.”\n\nLet’s\treturn\tfor\ta\tmoment\tto\tthe\tMusicCorp\tbusiness.\tOur\tdomain\tis\tthe\twhole\tbusiness\tin which\twe\tare\toperating.\tIt\tcovers\teverything\tfrom\tthe\twarehouse\tto\tthe\treception\tdesk, from\tfinance\tto\tordering.\tWe\tmay\tor\tmay\tnot\tmodel\tall\tof\tthat\tin\tour\tsoftware,\tbut\tthat\tis nonetheless\tthe\tdomain\tin\twhich\twe\tare\toperating.\tLet’s\tthink\tabout\tparts\tof\tthat\tdomain that\tlook\tlike\tthe\tbounded\tcontexts\tthat\tEvans\trefers\tto.\tAt\tMusicCorp,\tour\twarehouse\tis\ta hive\tof\tactivity\t—\tmanaging\torders\tbeing\tshipped\tout\t(and\tthe\todd\treturn),\ttaking\tdelivery of\tnew\tstock,\thaving\tforklift\ttruck\traces,\tand\tso\ton.\tElsewhere,\tthe\tfinance\tdepartment\tis perhaps\tless\tfun-loving,\tbut\tstill\thas\ta\tvery\timportant\tfunction\tinside\tour\torganization. These\temployees\tmanage\tpayroll,\tkeep\tthe\tcompany\taccounts,\tand\tproduce\timportant reports.\tLots\tof\treports.\tThey\tprobably\talso\thave\tinteresting\tdesk\ttoys.\n\nShared\tand\tHidden\tModels\n\nFor\tMusicCorp,\twe\tcan\tthen\tconsider\tthe\tfinance\tdepartment\tand\tthe\twarehouse\tto\tbe\ttwo separate\tbounded\tcontexts.\tThey\tboth\thave\tan\texplicit\tinterface\tto\tthe\toutside\tworld\t(in terms\tof\tinventory\treports,\tpay\tslips,\tetc.),\tand\tthey\thave\tdetails\tthat\tonly\tthey\tneed\tto know\tabout\t(forklift\ttrucks,\tcalculators).\n\nNow\tthe\tfinance\tdepartment\tdoesn’t\tneed\tto\tknow\tabout\tthe\tdetailed\tinner\tworkings\tof\tthe warehouse.\tIt\tdoes\tneed\tto\tknow\tsome\tthings,\tthough\t—\tfor\texample\tit\tneeds\tto\tknow about\tstock\tlevels\tto\tkeep\tthe\taccounts\tup\tto\tdate.\tFigure\t3-1\tshows\tan\texample\tcontext diagram.\tWe\tsee\tconcepts\tthat\tare\tinternal\tto\tthe\twarehouse,\tlike\tPicker\t(people\twho\tpick orders),\tshelves\tthat\trepresent\tstock\tlocations,\tand\tso\ton.\tLikewise,\tthe\tcompany’s\tgeneral ledger\tis\tintegral\tto\tfinance\tbut\tis\tnot\tshared\texternally\there.\n\nFigure\t3-1.\tA\tshared\tmodel\tbetween\tthe\tfinance\tdepartment\tand\tthe\twarehouse\n\nTo\tbe\table\tto\twork\tout\tthe\tvaluation\tof\tthe\tcompany,\tthough,\tthe\tfinance\temployees\tneed information\tabout\tthe\tstock\twe\thold.\tThe\tstock\titem\tthen\tbecomes\ta\tshared\tmodel between\tthe\ttwo\tcontexts.\tHowever,\tnote\tthat\twe\tdon’t\tneed\tto\tblindly\texpose\teverything about\tthe\tstock\titem\tfrom\tthe\twarehouse\tcontext.\tFor\texample,\talthough\tinternally\twe keep\ta\trecord\ton\ta\tstock\titem\tas\tto\twhere\tit\tshould\tlive\twithin\tthe\twarehouse,\tthat\tdoesn’t need\tto\tbe\texposed\tin\tthe\tshared\tmodel.\tSo\tthere\tis\tthe\tinternal-only\trepresentation,\tand the\texternal\trepresentation\twe\texpose.\tIn\tmany\tways,\tthis\tforeshadows\tthe\tdiscussion around\tREST\tin\tChapter\t4.\n\nSometimes\twe\tmay\tencounter\tmodels\twith\tthe\tsame\tname\tthat\thave\tvery\tdifferent meanings\tin\tdifferent\tcontexts\ttoo.\tFor\texample,\twe\tmight\thave\tthe\tconcept\tof\ta\treturn, which\trepresents\ta\tcustomer\tsending\tsomething\tback.\tWithin\tthe\tcontext\tof\tthe\tcustomer, a\treturn\tis\tall\tabout\tprinting\ta\tshipping\tlabel,\tdispatching\ta\tpackage,\tand\twaiting\tfor\ta refund.\tFor\tthe\twarehouse,\tthis\tcould\trepresent\ta\tpackage\tthat\tis\tabout\tto\tarrive,\tand\ta stock\titem\tthat\tneeds\tto\tbe\trestocked.\tIt\tfollows\tthat\twithin\tthe\twarehouse\twe\tstore additional\tinformation\tassociated\twith\tthe\treturn\tthat\trelates\tto\tthe\ttasks\tto\tbe\tcarried\tout;\n\nfor\texample,\twe\tmay\tgenerate\ta\trestock\trequest.\tThe\tshared\tmodel\tof\tthe\treturn\tbecomes associated\twith\tdifferent\tprocesses\tand\tsupporting\tentities\twithin\teach\tbounded\tcontext, but\tthat\tis\tvery\tmuch\tan\tinternal\tconcern\twithin\tthe\tcontext\titself.\n\nModules\tand\tServices\n\nBy\tthinking\tclearly\tabout\twhat\tmodels\tshould\tbe\tshared,\tand\tnot\tsharing\tour\tinternal representations,\twe\tavoid\tone\tof\tthe\tpotential\tpitfalls\tthat\tcan\tresult\tin\ttight\tcoupling\t(the opposite\tof\twhat\twe\twant).\tWe\thave\talso\tidentified\ta\tboundary\twithin\tour\tdomain\twhere all\tlike-minded\tbusiness\tcapabilities\tshould\tlive,\tgiving\tus\tthe\thigh\tcohesion\twe\twant. These\tbounded\tcontexts,\tthen,\tlend\tthemselves\textremely\twell\tto\tbeing\tcompositional boundaries.\n\nAs\twe\tdiscussed\tin\tChapter\t1,\twe\thave\tthe\toption\tof\tusing\tmodules\twithin\ta\tprocess boundary\tto\tkeep\trelated\tcode\ttogether\tand\tattempt\tto\treduce\tthe\tcoupling\tto\tother modules\tin\tthe\tsystem.\tWhen\tyou’re\tstarting\tout\ton\ta\tnew\tcodebase,\tthis\tis\tprobably\ta good\tplace\tto\tbegin.\tSo\tonce\tyou\thave\tfound\tyour\tbounded\tcontexts\tin\tyour\tdomain, make\tsure\tthey\tare\tmodeled\twithin\tyour\tcodebase\tas\tmodules,\twith\tshared\tand\thidden models.\n\nThese\tmodular\tboundaries\tthen\tbecome\texcellent\tcandidates\tfor\tmicroservices.\tIn\tgeneral, microservices\tshould\tcleanly\talign\tto\tbounded\tcontexts.\tOnce\tyou\tbecome\tvery\tproficient, you\tmay\tdecide\tto\tskip\tthe\tstep\tof\tkeeping\tthe\tbounded\tcontext\tmodeled\tas\ta\tmodule within\ta\tmore\tmonolithic\tsystem,\tand\tjump\tstraight\tfor\ta\tseparate\tservice.\tWhen\tstarting out,\thowever,\tkeep\ta\tnew\tsystem\ton\tthe\tmore\tmonolithic\tside;\tgetting\tservice\tboundaries wrong\tcan\tbe\tcostly,\tso\twaiting\tfor\tthings\tto\tstabilize\tas\tyou\tget\tto\tgrips\twith\ta\tnew domain\tis\tsensible.\tWe’ll\tdiscuss\tthis\tmore\tin\tChapter\t5,\talong\twith\ttechniques\tto\thelp break\tapart\texisting\tsystems\tinto\tmicroservices.\n\nSo,\tif\tour\tservice\tboundaries\talign\tto\tthe\tbounded\tcontexts\tin\tour\tdomain,\tand\tour microservices\trepresent\tthose\tbounded\tcontexts,\twe\tare\toff\tto\tan\texcellent\tstart\tin ensuring\tthat\tour\tmicroservices\tare\tloosely\tcoupled\tand\tstrongly\tcohesive.\n\nPremature\tDecomposition\n\nAt\tThoughtWorks,\twe\tourselves\texperienced\tthe\tchallenges\tof\tsplitting\tout\tmicroservices too\tquickly.\tAside\tfrom\tconsulting,\twe\talso\tcreate\ta\tfew\tproducts.\tOne\tof\tthem\tis\tSnapCI, a\thosted\tcontinuous\tintegration\tand\tcontinuous\tdelivery\ttool\t(we’ll\tdiscuss\tthose\tconcepts later\tin\tChapter\t6).\tThe\tteam\thad\tpreviously\tworked\ton\tanother\tsimilar\ttool,\tGo-CD,\ta now\topen\tsource\tcontinuous\tdelivery\ttool\tthat\tcan\tbe\tdeployed\tlocally\trather\tthan\tbeing hosted\tin\tthe\tcloud.\n\nAlthough\tthere\twas\tsome\tcode\treuse\tvery\tearly\ton\tbetween\tthe\tSnapCI\tand\tGo-CD projects,\tin\tthe\tend\tSnapCI\tturned\tout\tto\tbe\ta\tcompletely\tnew\tcodebase.\tNonetheless,\tthe previous\texperience\tof\tthe\tteam\tin\tthe\tdomain\tof\tCD\ttooling\temboldened\tthem\tto\tmove more\tquickly\tin\tidentifying\tboundaries,\tand\tbuilding\ttheir\tsystem\tas\ta\tset\tof microservices.\n\nAfter\ta\tfew\tmonths,\tthough,\tit\tbecame\tclear\tthat\tthe\tuse\tcases\tof\tSnapCI\twere\tsubtly different\tenough\tthat\tthe\tinitial\ttake\ton\tthe\tservice\tboundaries\twasn’t\tquite\tright.\tThis\tled to\tlots\tof\tchanges\tbeing\tmade\tacross\tservices,\tand\tan\tassociated\thigh\tcost\tof\tchange. Eventually\tthe\tteam\tmerged\tthe\tservices\tback\tinto\tone\tmonolithic\tsystem,\tgiving\tthem time\tto\tbetter\tunderstand\twhere\tthe\tboundaries\tshould\texist.\tA\tyear\tlater,\tthe\tteam\twas then\table\tto\tsplit\tthe\tmonolithic\tsystem\tapart\tinto\tmicroservices,\twhose\tboundaries\tproved to\tbe\tmuch\tmore\tstable.\tThis\tis\tfar\tfrom\tthe\tonly\texample\tof\tthis\tsituation\tI\thave\tseen. Prematurely\tdecomposing\ta\tsystem\tinto\tmicroservices\tcan\tbe\tcostly,\tespecially\tif\tyou\tare new\tto\tthe\tdomain.\tIn\tmany\tways,\thaving\tan\texisting\tcodebase\tyou\twant\tto\tdecompose into\tmicroservices\tis\tmuch\teasier\tthan\ttrying\tto\tgo\tto\tmicroservices\tfrom\tthe\tbeginning.\n\nBusiness\tCapabilities\n\nWhen\tyou\tstart\tto\tthink\tabout\tthe\tbounded\tcontexts\tthat\texist\tin\tyour\torganization,\tyou should\tbe\tthinking\tnot\tin\tterms\tof\tdata\tthat\tis\tshared,\tbut\tabout\tthe\tcapabilities\tthose contexts\tprovide\tthe\trest\tof\tthe\tdomain.\tThe\twarehouse\tmay\tprovide\tthe\tcapability\tto\tget\ta current\tstock\tlist,\tfor\texample,\tor\tthe\tfinance\tcontext\tmay\twell\texpose\tthe\tend-of-month accounts\tor\tlet\tyou\tset\tup\tpayroll\tfor\ta\tnew\trecruit.\tThese\tcapabilities\tmay\trequire\tthe interchange\tof\tinformation\t—\tshared\tmodels\t—\tbut\tI\thave\tseen\ttoo\toften\tthat\tthinking about\tdata\tleads\tto\tanemic,\tCRUD-based\t(create,\tread,\tupdate,\tdelete)\tservices.\tSo\task first\t“What\tdoes\tthis\tcontext\tdo?”,\tand\tthen\t“So\twhat\tdata\tdoes\tit\tneed\tto\tdo\tthat?”\n\nWhen\tmodeled\tas\tservices,\tthese\tcapabilities\tbecome\tthe\tkey\toperations\tthat\twill\tbe exposed\tover\tthe\twire\tto\tother\tcollaborators.\n\nTurtles\tAll\tthe\tWay\tDown\n\nAt\tthe\tstart,\tyou\twill\tprobably\tidentify\ta\tnumber\tof\tcoarse-grained\tbounded\tcontexts.\tBut these\tbounded\tcontexts\tcan\tin\tturn\tcontain\tfurther\tbounded\tcontexts.\tFor\texample,\tyou could\tdecompose\tthe\twarehouse\tinto\tcapabilities\tassociated\twith\torder\tfulfillment, inventory\tmanagement,\tor\tgoods\treceiving.\tWhen\tconsidering\tthe\tboundaries\tof\tyour microservices,\tfirst\tthink\tin\tterms\tof\tthe\tlarger,\tcoarser-grained\tcontexts,\tand\tthen subdivide\talong\tthese\tnested\tcontexts\twhen\tyou’re\tlooking\tfor\tthe\tbenefits\tof\tsplitting\tout these\tseams.\n\nI\thave\tseen\tthese\tnested\tcontexts\tremaining\thidden\tto\tother,\tcollaborating\tmicroservices to\tgreat\teffect.\tTo\tthe\toutside\tworld,\tthey\tare\tstill\tmaking\tuse\tof\tbusiness\tcapabilities\tin the\twarehouse,\tbut\tthey\tare\tunaware\tthat\ttheir\trequests\tare\tactually\tbeing\tmapped transparently\tto\ttwo\tor\tmore\tseparate\tservices,\tas\tyou\tcan\tsee\tin\tFigure\t3-2.\tSometimes, you\twill\tdecide\tit\tmakes\tmore\tsense\tfor\tthe\thigher-level\tbounded\tcontext\tto\tnot\tbe explicitly\tmodeled\tas\ta\tservice\tboundary,\tas\tin\tFigure\t3-3,\tso\trather\tthan\ta\tsingle warehouse\tboundary,\tyou\tmight\tinstead\tsplit\tout\tinventory,\torder\tfulfillment,\tand\tgoods receiving.\n\nFigure\t3-2.\tMicroservices\trepresenting\tnested\tbounded\tcontexts\thidden\tinside\tthe\twarehouse\n\nFigure\t3-3.\tThe\tbounded\tcontexts\tinside\tthe\twarehouse\tbeing\tpopped\tup\tinto\ttheir\town\ttop-level\tcontexts\n\nIn\tgeneral,\tthere\tisn’t\ta\thard-and-fast\trule\tas\tto\twhat\tapproach\tmakes\tthe\tmost\tsense. However,\twhether\tyou\tchoose\tthe\tnested\tapproach\tover\tthe\tfull\tseparation\tapproach should\tbe\tbased\ton\tyour\torganizational\tstructure.\tIf\torder\tfulfillment,\tinventory management,\tand\tgoods\treceiving\tare\tmanaged\tby\tdifferent\tteams,\tthey\tprobably\tdeserve their\tstatus\tas\ttop-level\tmicroservices.\tIf,\ton\tthe\tother\thand,\tall\tof\tthem\tare\tmanaged\tby one\tteam,\tthen\tthe\tnested\tmodel\tmakes\tmore\tsense.\tThis\tis\tbecause\tof\tthe\tinterplay\tof organizational\tstructures\tand\tsoftware\tarchitecture,\twhich\twe\twill\tdiscuss\ttoward\tthe\tend of\tthe\tbook\tin\tChapter\t10.\n\nAnother\treason\tto\tprefer\tthe\tnested\tapproach\tcould\tbe\tto\tchunk\tup\tyour\tarchitecture\tto simplify\ttesting.\tFor\texample,\twhen\ttesting\tservices\tthat\tconsume\tthe\twarehouse,\tI\tdon’t have\tto\tstub\teach\tservice\tinside\tthe\twarehouse\tcontext,\tjust\tthe\tmore\tcoarse-grained\tAPI. This\tcan\talso\tgive\tyou\ta\tunit\tof\tisolation\twhen\tconsidering\tlarger-scoped\ttests.\tI\tmay,\tfor example,\tdecide\tto\thave\tend-to-end\ttests\twhere\tI\tlaunch\tall\tservices\tinside\tthe\twarehouse context,\tbut\tfor\tall\tother\tcollaborators\tI\tmight\tstub\tthem\tout.\tWe’ll\texplore\tmore\tabout testing\tand\tisolation\tin\tChapter\t7.\n\nCommunication\tin\tTerms\tof\tBusiness\tConcepts\n\nThe\tchanges\twe\timplement\tto\tour\tsystem\tare\toften\tabout\tchanges\tthe\tbusiness\twants\tto make\tto\thow\tthe\tsystem\tbehaves.\tWe\tare\tchanging\tfunctionality\t—\tcapabilities\t—\tthat\tare exposed\tto\tour\tcustomers.\tIf\tour\tsystems\tare\tdecomposed\talong\tthe\tbounded\tcontexts\tthat represent\tour\tdomain,\tthe\tchanges\twe\twant\tto\tmake\tare\tmore\tlikely\tto\tbe\tisolated\tto\tone, single\tmicroservice\tboundary.\tThis\treduces\tthe\tnumber\tof\tplaces\twe\tneed\tto\tmake\ta change,\tand\tallows\tus\tto\tdeploy\tthat\tchange\tquickly.\n\nIt’s\talso\timportant\tto\tthink\tof\tthe\tcommunication\tbetween\tthese\tmicroservices\tin\tterms\tof the\tsame\tbusiness\tconcepts.\tThe\tmodeling\tof\tyour\tsoftware\tafter\tyour\tbusiness\tdomain shouldn’t\tstop\tat\tthe\tidea\tof\tbounded\tcontexts.\tThe\tsame\tterms\tand\tideas\tthat\tare\tshared between\tparts\tof\tyour\torganization\tshould\tbe\treflected\tin\tyour\tinterfaces.\tIt\tcan\tbe\tuseful to\tthink\tof\tforms\tbeing\tsent\tbetween\tthese\tmicroservices,\tmuch\tas\tforms\tare\tsent\taround an\torganization.\n\nThe\tTechnical\tBoundary\n\nIt\tcan\tbe\tuseful\tto\tlook\tat\twhat\tcan\tgo\twrong\twhen\tservices\tare\tmodeled\tincorrectly.\tA while\tback,\ta\tfew\tcolleagues\tand\tI\twere\tworking\twith\ta\tclient\tin\tCalifornia,\thelping\tthe company\tadopt\tsome\tcleaner\tcode\tpractices\tand\tmove\tmore\ttoward\tautomated\ttesting. We’d\tstarted\twith\tsome\tof\tthe\tlow-hanging\tfruit,\tsuch\tas\tservice\tdecomposition,\twhen\twe noticed\tsomething\tmuch\tmore\tworrying.\tI\tcan’t\tgo\tinto\ttoo\tmuch\tdetail\tas\tto\twhat\tthe application\tdid,\tbut\tit\twas\ta\tpublic-facing\tapplication\twith\ta\tlarge,\tglobal\tcustomer\tbase.\n\nThe\tteam,\tand\tsystem,\thad\tgrown.\tOriginally\tone\tperson’s\tvision,\tthe\tsystem\thad\ttaken\ton more\tand\tmore\tfeatures,\tand\tmore\tand\tmore\tusers.\tEventually,\tthe\torganization\tdecided\tto increase\tthe\tcapacity\tof\tthe\tteam\tby\thaving\ta\tnew\tgroup\tof\tdevelopers\tbased\tin\tBrazil\ttake on\tsome\tof\tthe\twork.\tThe\tsystem\tgot\tsplit\tup,\twith\tthe\tfront\thalf\tof\tthe\tapplication\tbeing essentially\tstateless,\timplementing\tthe\tpublic-facing\twebsite,\tas\tshown\tin\tFigure\t3-4.\tThe back\thalf\tof\tthe\tsystem\twas\tsimply\ta\tremote\tprocedure\tcall\t(RPC)\tinterface\tover\ta\tdata store.\tEssentially,\timagine\tyou’d\ttaken\ta\trepository\tlayer\tin\tyour\tcodebase\tand\tmade\tthis\ta separate\tservice.\n\nFigure\t3-4.\tA\tservice\tboundary\tsplit\tacross\ta\ttechnical\tseam\n\nChanges\tfrequently\thad\tto\tbe\tmade\tto\tboth\tservices.\tBoth\tservices\tspoke\tin\tterms\tof\tlow- level,\tRPC-style\tmethod\tcalls,\twhich\twere\toverly\tbrittle\t(we’ll\tdiscuss\tthis\tfuther\tin Chapter\t4).\tThe\tservice\tinterface\twas\talso\tvery\tchatty\ttoo,\tresulting\tin\tperformance\tissues. This\tresulted\tin\tthe\tneed\tfor\telaborate\tRPC-batching\tmechanisms.\tI\tcalled\tthis\tonion architecture,\tas\tit\thad\tlots\tof\tlayers\tand\tmade\tme\tcry\twhen\twe\thad\tto\tcut\tthrough\tit.\n\nNow\ton\tthe\tface\tof\tit,\tthe\tidea\tof\tsplitting\tthe\tpreviously\tmonolithic\tsystem\talong geographical/organizational\tlines\tmakes\tperfect\tsense,\tas\twe’ll\texpand\ton\tin\tChapter\t10. Here,\thowever,\trather\tthan\ttaking\ta\tvertical,\tbusiness-focused\tslice\tthrough\tthe\tstack,\tthe team\tpicked\twhat\twas\tpreviously\tan\tin-process\tAPI\tand\tmade\ta\thorizontal\tslice.\n\nMaking\tdecisions\tto\tmodel\tservice\tboundaries\talong\ttechnical\tseams\tisn’t\talways\twrong.\tI have\tcertainly\tseen\tthis\tmake\tlots\tof\tsense\twhen\tan\torganization\tis\tlooking\tto\tachieve certain\tperformance\tobjectives,\tfor\texample.\tHowever,\tit\tshould\tbe\tyour\tsecondary\tdriver\n\nfor\tfinding\tthese\tseams,\tnot\tyour\tprimary\tone.\n\nSummary\n\nIn\tthis\tchapter,\tyou’ve\tlearned\ta\tbit\tabout\twhat\tmakes\ta\tgood\tservice,\tand\thow\tto\tfind seams\tin\tour\tproblem\tspace\tthat\tgive\tus\tthe\tdual\tbenefits\tof\tboth\tloose\tcoupling\tand\thigh cohesion.\tBounded\tcontexts\tare\ta\tvital\ttool\tin\thelping\tus\tfind\tthese\tseams,\tand\tby\taligning our\tmicroservices\tto\tthese\tboundaries\twe\tensure\tthat\tthe\tresulting\tsystem\thas\tevery chance\tof\tkeeping\tthose\tvirtues\tintact.\tWe’ve\talso\tgot\ta\thint\tabout\thow\twe\tcan\tsubdivide our\tmicroservices\tfurther,\tsomething\twe’ll\texplore\tin\tmore\tdepth\tlater.\tAnd\twe\talso introduced\tMusicCorp,\tthe\texample\tdomain\tthat\twe\twill\tuse\tthroughout\tthis\tbook.\n\nThe\tideas\tpresented\tin\tEric\tEvans’s\tDomain-Driven\tDesign\tare\tvery\tuseful\tto\tus\tin finding\tsensible\tboundaries\tfor\tour\tservices,\tand\tI’ve\tjust\tscratched\tthe\tsurface\there.\tI recommend\tVaughn\tVernon’s\tbook\tImplementing\tDomain-Driven\tDesign\t(Addison- Wesley)\tto\thelp\tyou\tunderstand\tthe\tpracticalities\tof\tthis\tapproach.\n\nAlthough\tthis\tchapter\thas\tbeen\tmostly\thigh-level,\twe\tneed\tto\tget\tmuch\tmore\ttechnical\tin the\tnext.\tThere\tare\tmany\tpitfalls\tassociated\twith\timplementing\tinterfaces\tbetween services\tthat\tcan\tlead\tto\tall\tsorts\tof\ttrouble,\tand\twe\twill\thave\tto\ttake\ta\tdeep\tdive\tinto\tthis topic\tif\twe\tare\tto\tkeep\tour\tsystems\tfrom\tbecoming\ta\tgiant,\ttangled\tmess.\n\n1\thttp://bit.ly/bounded-context-explained\n\nChapter\t4.\tIntegration\n\nGetting\tintegration\tright\tis\tthe\tsingle\tmost\timportant\taspect\tof\tthe\ttechnology\tassociated with\tmicroservices\tin\tmy\topinion.\tDo\tit\twell,\tand\tyour\tmicroservices\tretain\ttheir autonomy,\tallowing\tyou\tto\tchange\tand\trelease\tthem\tindependent\tof\tthe\twhole.\tGet\tit wrong,\tand\tdisaster\tawaits.\tHopefully\tonce\tyou’ve\tread\tthis\tchapter\tyou’ll\tlearn\thow\tto avoid\tsome\tof\tthe\tbiggest\tpitfalls\tthat\thave\tplagued\tother\tattempts\tat\tSOA\tand\tcould\tyet await\tyou\tin\tyour\tjourney\tto\tmicroservices.",
      "page_number": 62
    },
    {
      "number": 4,
      "title": "Integration",
      "start_page": 80,
      "end_page": 144,
      "detection_method": "regex_chapter_title",
      "content": "Looking\tfor\tthe\tIdeal\tIntegration\tTechnology\n\nThere\tis\ta\tbewildering\tarray\tof\toptions\tout\tthere\tfor\thow\tone\tmicroservice\tcan\ttalk\tto another.\tBut\twhich\tis\tthe\tright\tone:\tSOAP?\tXML-RPC?\tREST?\tProtocol\tbuffers?\tWe’ll dive\tinto\tthose\tin\ta\tmoment,\tbut\tbefore\twe\tdo,\tlet’s\tthink\tabout\twhat\twe\twant\tout\tof whatever\ttechnology\twe\tpick.\n\nAvoid\tBreaking\tChanges\n\nEvery\tnow\tand\tthen,\twe\tmay\tmake\ta\tchange\tthat\trequires\tour\tconsumers\tto\talso\tchange. We’ll\tdiscuss\thow\tto\thandle\tthis\tlater,\tbut\twe\twant\tto\tpick\ttechnology\tthat\tensures\tthis happens\tas\trarely\tas\tpossible.\tFor\texample,\tif\ta\tmicroservice\tadds\tnew\tfields\tto\ta\tpiece\tof data\tit\tsends\tout,\texisting\tconsumers\tshouldn’t\tbe\timpacted.\n\nKeep\tYour\tAPIs\tTechnology-Agnostic\n\nIf\tyou\thave\tbeen\tin\tthe\tIT\tindustry\tfor\tmore\tthan\t15\tminutes,\tyou\tdon’t\tneed\tme\tto\ttell you\tthat\twe\twork\tin\ta\tspace\tthat\tis\tchanging\trapidly.\tThe\tone\tcertainty\tis\tchange.\tNew tools,\tframeworks,\tand\tlanguages\tare\tcoming\tout\tall\tthe\ttime,\timplementing\tnew\tideas that\tcan\thelp\tus\twork\tfaster\tand\tmore\teffectively.\tRight\tnow,\tyou\tmight\tbe\ta\t.NET\tshop. But\twhat\tabout\tin\ta\tyear\tfrom\tnow,\tor\tfive\tyears\tfrom\tnow?\tWhat\tif\tyou\twant\tto experiment\twith\tan\talternative\ttechnology\tstack\tthat\tmight\tmake\tyou\tmore\tproductive?\n\nI\tam\ta\tbig\tfan\tof\tkeeping\tmy\toptions\topen,\twhich\tis\twhy\tI\tam\tsuch\ta\tfan\tof\tmicroservices. It\tis\talso\twhy\tI\tthink\tit\tis\tvery\timportant\tto\tensure\tthat\tyou\tkeep\tthe\tAPIs\tused\tfor communication\tbetween\tmicroservices\ttechnology-agnostic.\tThis\tmeans\tavoiding integration\ttechnology\tthat\tdictates\twhat\ttechnology\tstacks\twe\tcan\tuse\tto\timplement\tour microservices.\n\nMake\tYour\tService\tSimple\tfor\tConsumers\n\nWe\twant\tto\tmake\tit\teasy\tfor\tconsumers\tto\tuse\tour\tservice.\tHaving\ta\tbeautifully\tfactored microservice\tdoesn’t\tcount\tfor\tmuch\tif\tthe\tcost\tof\tusing\tit\tas\ta\tconsumer\tis\tsky\thigh!\tSo let’s\tthink\tabout\twhat\tmakes\tit\teasy\tfor\tconsumers\tto\tuse\tour\twonderful\tnew\tservice. Ideally,\twe’d\tlike\tto\tallow\tour\tclients\tfull\tfreedom\tin\ttheir\ttechnology\tchoice,\tbut\ton\tthe other\thand,\tproviding\ta\tclient\tlibrary\tcan\tease\tadoption.\tOften,\thowever,\tsuch\tlibraries\tare incompatible\twith\tother\tthings\twe\twant\tto\tachieve.\tFor\texample,\twe\tmight\tuse\tclient libraries\tto\tmake\tit\teasy\tfor\tconsumers,\tbut\tthis\tcan\tcome\tat\tthe\tcost\tof\tincreased coupling.\n\nHide\tInternal\tImplementation\tDetail\n\nWe\tdon’t\twant\tour\tconsumers\tto\tbe\tbound\tto\tour\tinternal\timplementation.\tThis\tleads\tto increased\tcoupling.\tThis\tmeans\tthat\tif\twe\twant\tto\tchange\tsomething\tinside\tour microservice,\twe\tcan\tbreak\tour\tconsumers\tby\trequiring\tthem\tto\talso\tchange.\tThat increases\tthe\tcost\tof\tchange\t—\tthe\texact\tresult\twe\tare\ttrying\tto\tavoid.\tIt\talso\tmeans\twe are\tless\tlikely\tto\twant\tto\tmake\ta\tchange\tfor\tfear\tof\thaving\tto\tupgrade\tour\tconsumers, which\tcan\tlead\tto\tincreased\ttechnical\tdebt\twithin\tthe\tservice.\tSo\tany\ttechnology\tthat pushes\tus\tto\texpose\tinternal\trepresentation\tdetail\tshould\tbe\tavoided.\n\nInterfacing\twith\tCustomers\n\nNow\tthat\twe’ve\tgot\ta\tfew\tguidelines\tthat\tcan\thelp\tus\tselect\ta\tgood\ttechnology\tto\tuse\tfor integration\tbetween\tservices,\tlet’s\tlook\tat\tsome\tof\tthe\tmost\tcommon\toptions\tout\tthere\tand try\tto\twork\tout\twhich\tone\tworks\tbest\tfor\tus.\tTo\thelp\tus\tthink\tthis\tthrough,\tlet’s\tpick\ta real-world\texample\tfrom\tMusicCorp.\n\nCustomer\tcreation\tat\tfirst\tglance\tcould\tbe\tconsidered\ta\tsimple\tset\tof\tCRUD\toperations, but\tfor\tmost\tsystems\tit\tis\tmore\tcomplex\tthan\tthat.\tEnrolling\ta\tnew\tcustomer\tmay\tneed\tto kick\toff\tadditional\tprocesses,\tlike\tsetting\tup\tfinancial\tpayments\tor\tsending\tout\twelcome emails.\tAnd\twhen\twe\tchange\tor\tdelete\ta\tcustomer,\tother\tbusiness\tprocesses\tmight\tget triggered\tas\twell.\n\nSo\twith\tthat\tin\tmind,\twe\tshould\tlook\tat\tsome\tdifferent\tways\tin\twhich\twe\tmight\twant\tto work\twith\tcustomers\tin\tour\tMusicCorp\tsystem.\n\nThe\tShared\tDatabase\n\nBy\tfar\tthe\tmost\tcommon\tform\tof\tintegration\tthat\tI\tor\tany\tof\tmy\tcolleagues\tsee\tin\tthe industry\tis\tdatabase\t(DB)\tintegration.\tIn\tthis\tworld,\tif\tother\tservices\twant\tinformation from\ta\tservice,\tthey\treach\tinto\tthe\tdatabase.\tAnd\tif\tthey\twant\tto\tchange\tit,\tthey\treach\tinto the\tdatabase!\tThis\tis\treally\tsimple\twhen\tyou\tfirst\tthink\tabout\tit,\tand\tis\tprobably\tthe\tfastest form\tof\tintegration\tto\tstart\twith\t—\twhich\tprobably\texplains\tits\tpopularity.\n\nFigure\t4-1\tshows\tour\tregistration\tUI,\twhich\tcreates\tcustomers\tby\tperforming\tSQL operations\tdirectly\ton\tthe\tdatabase.\tIt\talso\tshows\tour\tcall\tcenter\tapplication\tthat\tviews\tand edits\tcustomer\tdata\tby\trunning\tSQL\ton\tthe\tdatabase.\tAnd\tthe\twarehouse\tupdates information\tabout\tcustomer\torders\tby\tquerying\tthe\tdatabase.\tThis\tis\ta\tcommon\tenough pattern,\tbut\tit’s\tone\tfraught\twith\tdifficulties.\n\nFigure\t4-1.\tUsing\tDB\tintegration\tto\taccess\tand\tchange\tcustomer\tinformation\n\nFirst,\twe\tare\tallowing\texternal\tparties\tto\tview\tand\tbind\tto\tinternal\timplementation\tdetails. The\tdata\tstructures\tI\tstore\tin\tthe\tDB\tare\tfair\tgame\tto\tall;\tthey\tare\tshared\tin\ttheir\tentirety with\tall\tother\tparties\twith\taccess\tto\tthe\tdatabase.\tIf\tI\tdecide\tto\tchange\tmy\tschema\tto\tbetter represent\tmy\tdata,\tor\tmake\tmy\tsystem\teasier\tto\tmaintain,\tI\tcan\tbreak\tmy\tconsumers.\tThe DB\tis\teffectively\ta\tvery\tlarge,\tshared\tAPI\tthat\tis\talso\tquite\tbrittle.\tIf\tI\twant\tto\tchange\tthe logic\tassociated\twith,\tsay,\thow\tthe\thelpdesk\tmanages\tcustomers\tand\tthis\trequires\ta\tchange to\tthe\tdatabase,\tI\thave\tto\tbe\textremely\tcareful\tthat\tI\tdon’t\tbreak\tparts\tof\tthe\tschema\tused by\tother\tservices.\tThis\tsituation\tnormally\tresults\tin\trequiring\ta\tlarge\tamount\tof\tregression testing.\n\nSecond,\tmy\tconsumers\tare\ttied\tto\ta\tspecific\ttechnology\tchoice.\tPerhaps\tright\tnow\tit makes\tsense\tto\tstore\tcustomers\tin\ta\trelational\tdatabase,\tso\tmy\tconsumers\tuse\tan appropriate\t(potentially\tDB-specific)\tdriver\tto\ttalk\tto\tit.\tWhat\tif\tover\ttime\twe\trealize\twe would\tbe\tbetter\toff\tstoring\tdata\tin\ta\tnonrelational\tdatabase?\tCan\tit\tmake\tthat\tdecision?\tSo consumers\tare\tintimately\ttied\tto\tthe\timplementation\tof\tthe\tcustomer\tservice.\tAs\twe discussed\tearlier,\twe\treally\twant\tto\tensure\tthat\timplementation\tdetail\tis\thidden\tfrom consumers\tto\tallow\tour\tservice\ta\tlevel\tof\tautonomy\tin\tterms\tof\thow\tit\tchanges\tits internals\tover\ttime.\tGoodbye,\tloose\tcoupling.\n\nFinally,\tlet’s\tthink\tabout\tbehavior\tfor\ta\tmoment.\tThere\tis\tgoing\tto\tbe\tlogic\tassociated\twith how\ta\tcustomer\tis\tchanged.\tWhere\tis\tthat\tlogic?\tIf\tconsumers\tare\tdirectly\tmanipulating the\tDB,\tthen\tthey\thave\tto\town\tthe\tassociated\tlogic.\tThe\tlogic\tto\tperform\tthe\tsame\tsorts\tof manipulation\tto\ta\tcustomer\tmay\tnow\tbe\tspread\tamong\tmultiple\tconsumers.\tIf\tthe warehouse,\tregistration\tUI,\tand\tcall\tcenter\tUI\tall\tneed\tto\tedit\tcustomer\tinformation,\tI\tneed to\tfix\ta\tbug\tor\tchange\tthe\tbehavior\tin\tthree\tdifferent\tplaces,\tand\tdeploy\tthose\tchanges\ttoo. Goodbye,\tcohesion.\n\nRemember\twhen\twe\ttalked\tabout\tthe\tcore\tprinciples\tbehind\tgood\tmicroservices?\tStrong cohesion\tand\tloose\tcoupling\t—\twith\tdatabase\tintegration,\twe\tlose\tboth\tthings.\tDatabase integration\tmakes\tit\teasy\tfor\tservices\tto\tshare\tdata,\tbut\tdoes\tnothing\tabout\tsharing behavior.\tOur\tinternal\trepresentation\tis\texposed\tover\tthe\twire\tto\tour\tconsumers,\tand\tit\tcan be\tvery\tdifficult\tto\tavoid\tmaking\tbreaking\tchanges,\twhich\tinevitably\tleads\tto\ta\tfear\tof\tany change\tat\tall.\tAvoid\tat\t(nearly)\tall\tcosts.\n\nFor\tthe\trest\tof\tthe\tchapter,\twe’ll\texplore\tdifferent\tstyles\tof\tintegration\tthat\tinvolve collaborating\tservices,\twhich\tthemselves\thide\ttheir\town\tinternal\trepresentations.\n\nSynchronous\tVersus\tAsynchronous\n\nBefore\twe\tstart\tdiving\tinto\tthe\tspecifics\tof\tdifferent\ttechnology\tchoices,\twe\tshould\tdiscuss one\tof\tthe\tmost\timportant\tdecisions\twe\tcan\tmake\tin\tterms\tof\thow\tservices\tcollaborate. Should\tcommunication\tbe\tsynchronous\tor\tasynchronous?\tThis\tfundamental\tchoice inevitably\tguides\tus\ttoward\tcertain\timplementation\tdetail.\n\nWith\tsynchronous\tcommunication,\ta\tcall\tis\tmade\tto\ta\tremote\tserver,\twhich\tblocks\tuntil the\toperation\tcompletes.\tWith\tasynchronous\tcommunication,\tthe\tcaller\tdoesn’t\twait\tfor the\toperation\tto\tcomplete\tbefore\treturning,\tand\tmay\tnot\teven\tcare\twhether\tor\tnot\tthe operation\tcompletes\tat\tall.\n\nSynchronous\tcommunication\tcan\tbe\teasier\tto\treason\tabout.\tWe\tknow\twhen\tthings\thave completed\tsuccessfully\tor\tnot.\tAsynchronous\tcommunication\tcan\tbe\tvery\tuseful\tfor\tlong- running\tjobs,\twhere\tkeeping\ta\tconnection\topen\tfor\ta\tlong\tperiod\tof\ttime\tbetween\tthe client\tand\tserver\tis\timpractical.\tIt\talso\tworks\tvery\twell\twhen\tyou\tneed\tlow\tlatency,\twhere blocking\ta\tcall\twhile\twaiting\tfor\tthe\tresult\tcan\tslow\tthings\tdown.\tDue\tto\tthe\tnature\tof mobile\tnetworks\tand\tdevices,\tfiring\toff\trequests\tand\tassuming\tthings\thave\tworked\t(unless told\totherwise)\tcan\tensure\tthat\tthe\tUI\tremains\tresponsive\teven\tif\tthe\tnetwork\tis\thighly laggy.\tOn\tthe\tflipside,\tthe\ttechnology\tto\thandle\tasynchronous\tcommunication\tcan\tbe\ta\tbit more\tinvolved,\tas\twe’ll\tdiscuss\tshortly.\n\nThese\ttwo\tdifferent\tmodes\tof\tcommunication\tcan\tenable\ttwo\tdifferent\tidiomatic\tstyles\tof collaboration:\trequest/response\tor\tevent-based.\tWith\trequest/response,\ta\tclient\tinitiates\ta request\tand\twaits\tfor\tthe\tresponse.\tThis\tmodel\tclearly\taligns\twell\tto\tsynchronous communication,\tbut\tcan\twork\tfor\tasynchronous\tcommunication\ttoo.\tI\tmight\tkick\toff\tan operation\tand\tregister\ta\tcallback,\tasking\tthe\tserver\tto\tlet\tme\tknow\twhen\tmy\toperation\thas completed.\n\nWith\tan\tevent-based\tcollaboration,\twe\tinvert\tthings.\tInstead\tof\ta\tclient\tinitiating\trequests asking\tfor\tthings\tto\tbe\tdone,\tit\tinstead\tsays\tthis\tthing\thappened\tand\texpects\tother\tparties to\tknow\twhat\tto\tdo.\tWe\tnever\ttell\tanyone\telse\twhat\tto\tdo.\tEvent-based\tsystems\tby\ttheir nature\tare\tasynchronous.\tThe\tsmarts\tare\tmore\tevenly\tdistributed\t—\tthat\tis,\tthe\tbusiness logic\tis\tnot\tcentralized\tinto\tcore\tbrains,\tbut\tinstead\tpushed\tout\tmore\tevenly\tto\tthe\tvarious collaborators.\tEvent-based\tcollaboration\tis\talso\thighly\tdecoupled.\tThe\tclient\tthat\temits\tan event\tdoesn’t\thave\tany\tway\tof\tknowing\twho\tor\twhat\twill\treact\tto\tit,\twhich\talso\tmeans\tthat you\tcan\tadd\tnew\tsubscribers\tto\tthese\tevents\twithout\tthe\tclient\tever\tneeding\tto\tknow.\n\nSo\tare\tthere\tany\tother\tdrivers\tthat\tmight\tpush\tus\tto\tpick\tone\tstyle\tover\tanother?\tOne important\tfactor\tto\tconsider\tis\thow\twell\tthese\tstyles\tare\tsuited\tfor\tsolving\tan\toften- complex\tproblem:\thow\tdo\twe\thandle\tprocesses\tthat\tspan\tservice\tboundaries\tand\tmay\tbe long\trunning?\n\nOrchestration\tVersus\tChoreography\n\nAs\twe\tstart\tto\tmodel\tmore\tand\tmore\tcomplex\tlogic,\twe\thave\tto\tdeal\twith\tthe\tproblem\tof managing\tbusiness\tprocesses\tthat\tstretch\tacross\tthe\tboundary\tof\tindividual\tservices.\tAnd with\tmicroservices,\twe’ll\thit\tthis\tlimit\tsooner\tthan\tusual.\tLet’s\ttake\tan\texample\tfrom MusicCorp,\tand\tlook\tat\twhat\thappens\twhen\twe\tcreate\ta\tcustomer:\n\n1.\t A\tnew\trecord\tis\tcreated\tin\tthe\tloyalty\tpoints\tbank\tfor\tthe\tcustomer.\n\n2.\t Our\tpostal\tsystem\tsends\tout\ta\twelcome\tpack.\n\n3.\t We\tsend\ta\twelcome\temail\tto\tthe\tcustomer.\n\nThis\tis\tvery\teasy\tto\tmodel\tconceptually\tas\ta\tflowchart,\tas\twe\tdo\tin\tFigure\t4-2.\n\nWhen\tit\tcomes\tto\tactually\timplementing\tthis\tflow,\tthere\tare\ttwo\tstyles\tof\tarchitecture\twe could\tfollow.\tWith\torchestration,\twe\trely\ton\ta\tcentral\tbrain\tto\tguide\tand\tdrive\tthe\tprocess, much\tlike\tthe\tconductor\tin\tan\torchestra.\tWith\tchoreography,\twe\tinform\teach\tpart\tof\tthe system\tof\tits\tjob,\tand\tlet\tit\twork\tout\tthe\tdetails,\tlike\tdancers\tall\tfinding\ttheir\tway\tand reacting\tto\tothers\taround\tthem\tin\ta\tballet.\n\nFigure\t4-2.\tThe\tprocess\tfor\tcreating\ta\tnew\tcustomer\n\nLet’s\tthink\tabout\twhat\tan\torchestration\tsolution\twould\tlook\tlike\tfor\tthis\tflow.\tHere, probably\tthe\tsimplest\tthing\tto\tdo\twould\tbe\tto\thave\tour\tcustomer\tservice\tact\tas\tthe\tcentral brain.\tOn\tcreation,\tit\ttalks\tto\tthe\tloyalty\tpoints\tbank,\temail\tservice,\tand\tpostal\tservice\tas we\tsee\tin\tFigure\t4-3,\tthrough\ta\tseries\tof\trequest/response\tcalls.\tThe\tcustomer\tservice\n\nitself\tcan\tthen\ttrack\twhere\ta\tcustomer\tis\tin\tthis\tprocess.\tIt\tcan\tcheck\tto\tsee\tif\tthe customer’s\taccount\thas\tbeen\tset\tup,\tor\tthe\temail\tsent,\tor\tthe\tpost\tdelivered.\tWe\tget\tto\ttake the\tflowchart\tin\tFigure\t4-2\tand\tmodel\tit\tdirectly\tinto\tcode.\tWe\tcould\teven\tuse\ttooling\tthat implements\tthis\tfor\tus,\tperhaps\tusing\tan\tappropriate\trules\tengine.\tCommercial\ttools\texist for\tthis\tvery\tpurpose\tin\tthe\tform\tof\tbusiness\tprocess\tmodeling\tsoftware.\tAssuming\twe\tuse synchronous\trequest/response,\twe\tcould\teven\tknow\tif\teach\tstage\thas\tworked.\n\nFigure\t4-3.\tHandling\tcustomer\tcreation\tvia\torchestration\n\nThe\tdownside\tto\tthis\torchestration\tapproach\tis\tthat\tthe\tcustomer\tservice\tcan\tbecome\ttoo much\tof\ta\tcentral\tgoverning\tauthority.\tIt\tcan\tbecome\tthe\thub\tin\tthe\tmiddle\tof\ta\tweb,\tand\ta central\tpoint\twhere\tlogic\tstarts\tto\tlive.\tI\thave\tseen\tthis\tapproach\tresult\tin\ta\tsmall\tnumber of\tsmart\t“god”\tservices\ttelling\tanemic\tCRUD-based\tservices\twhat\tto\tdo.\n\nWith\ta\tchoreographed\tapproach,\twe\tcould\tinstead\tjust\thave\tthe\tcustomer\tservice\temit\tan event\tin\tan\tasynchronous\tmanner,\tsaying\tCustomer\tcreated.\tThe\temail\tservice,\tpostal service,\tand\tloyalty\tpoints\tbank\tthen\tjust\tsubscribe\tto\tthese\tevents\tand\treact\taccordingly, as\tin\tFigure\t4-4.\tThis\tapproach\tis\tsignificantly\tmore\tdecoupled.\tIf\tsome\tother\tservice needed\tto\treach\tto\tthe\tcreation\tof\ta\tcustomer,\tit\tjust\tneeds\tto\tsubscribe\tto\tthe\tevents\tand do\tits\tjob\twhen\tneeded.\tThe\tdownside\tis\tthat\tthe\texplicit\tview\tof\tthe\tbusiness\tprocess\twe see\tin\tFigure\t4-2\tis\tnow\tonly\timplicitly\treflected\tin\tour\tsystem.\n\nFigure\t4-4.\tHandling\tcustomer\tcreation\tvia\tchoreography\n\nThis\tmeans\tadditional\twork\tis\tneeded\tto\tensure\tthat\tyou\tcan\tmonitor\tand\ttrack\tthat\tthe right\tthings\thave\thappened.\tFor\texample,\twould\tyou\tknow\tif\tthe\tloyalty\tpoints\tbank\thad\ta bug\tand\tfor\tsome\treason\tdidn’t\tset\tup\tthe\tcorrect\taccount?\tOne\tapproach\tI\tlike\tfor\tdealing with\tthis\tis\tto\tbuild\ta\tmonitoring\tsystem\tthat\texplicitly\tmatches\tthe\tview\tof\tthe\tbusiness process\tin\tFigure\t4-2,\tbut\tthen\ttracks\twhat\teach\tof\tthe\tservices\tdoes\tas\tindependent entities,\tletting\tyou\tsee\todd\texceptions\tmapped\tonto\tthe\tmore\texplicit\tprocess\tflow.\tThe flowchart\twe\tsaw\tearlier\tisn’t\tthe\tdriving\tforce,\tbut\tjust\tone\tlens\tthrough\twhich\twe\tcan see\thow\tthe\tsystem\tis\tbehaving.\n\nIn\tgeneral,\tI\thave\tfound\tthat\tsystems\tthat\ttend\tmore\ttoward\tthe\tchoreographed\tapproach are\tmore\tloosely\tcoupled,\tand\tare\tmore\tflexible\tand\tamenable\tto\tchange.\tYou\tdo\tneed\tto do\textra\twork\tto\tmonitor\tand\ttrack\tthe\tprocesses\tacross\tsystem\tboundaries,\thowever.\tI have\tfound\tmost\theavily\torchestrated\timplementations\tto\tbe\textremely\tbrittle,\twith\ta higher\tcost\tof\tchange.\tWith\tthat\tin\tmind,\tI\tstrongly\tprefer\taiming\tfor\ta\tchoreographed system,\twhere\teach\tservice\tis\tsmart\tenough\tto\tunderstand\tits\trole\tin\tthe\twhole\tdance.\n\nThere\tare\tquite\ta\tfew\tfactors\tto\tunpack\there.\tSynchronous\tcalls\tare\tsimpler,\tand\twe\tget\tto know\tif\tthings\tworked\tstraightaway.\tIf\twe\tlike\tthe\tsemantics\tof\trequest/response\tbut\tare dealing\twith\tlonger-lived\tprocesses,\twe\tcould\tjust\tinitiate\tasynchronous\trequests\tand\twait for\tcallbacks.\tOn\tthe\tother\thand,\tasynchronous\tevent\tcollaboration\thelps\tus\tadopt\ta choreographed\tapproach,\twhich\tcan\tyield\tsignificantly\tmore\tdecoupled\tservices\t— something\twe\twant\tto\tstrive\tfor\tto\tensure\tour\tservices\tare\tindependently\treleasable.\n\nWe\tare,\tof\tcourse,\tfree\tto\tmix\tand\tmatch.\tSome\ttechnologies\twill\tfit\tmore\tnaturally\tinto one\tstyle\tor\tanother.\tWe\tdo,\thowever,\tneed\tto\tappreciate\tsome\tof\tthe\tdifferent\ttechnical implementation\tdetails\tthat\twill\tfurther\thelp\tus\tmake\tthe\tright\tcall.\n\nTo\tstart\twith,\tlet’s\tlook\tat\ttwo\ttechnologies\tthat\tfit\twell\twhen\twe\tare\tconsidering request/response:\tremote\tprocedure\tcall\t(RPC)\tand\tREpresentational\tState\tTransfer (REST).\n\nRemote\tProcedure\tCalls\n\nRemote\tprocedure\tcall\trefers\tto\tthe\ttechnique\tof\tmaking\ta\tlocal\tcall\tand\thaving\tit\texecute on\ta\tremote\tservice\tsomewhere.\tThere\tare\ta\tnumber\tof\tdifferent\ttypes\tof\tRPC\ttechnology out\tthere.\tSome\tof\tthis\ttechnology\trelies\ton\thaving\tan\tinterface\tdefinition\t(SOAP,\tThrift, protocol\tbuffers).\tThe\tuse\tof\ta\tseparate\tinterface\tdefinition\tcan\tmake\tit\teasier\tto\tgenerate client\tand\tserver\tstubs\tfor\tdifferent\ttechnology\tstacks,\tso,\tfor\texample,\tI\tcould\thave\ta\tJava server\texposing\ta\tSOAP\tinterface,\tand\ta\t.NET\tclient\tgenerated\tfrom\tthe\tWeb\tService Definition\tLanguage\t(WSDL)\tdefinition\tof\tthe\tinterface.\tOther\ttechnology,\tlike\tJava\tRMI, calls\tfor\ta\ttighter\tcoupling\tbetween\tthe\tclient\tand\tserver,\trequiring\tthat\tboth\tuse\tthe\tsame underlying\ttechnology\tbut\tavoid\tthe\tneed\tfor\ta\tshared\tinterface\tdefinition.\tAll\tthese technologies,\thowever,\thave\tthe\tsame,\tcore\tcharacteristic\tin\tthat\tthey\tmake\ta\tlocal\tcall look\tlike\ta\tremote\tcall.\n\nMany\tof\tthese\ttechnologies\tare\tbinary\tin\tnature,\tlike\tJava\tRMI,\tThrift,\tor\tprotocol\tbuffers, while\tSOAP\tuses\tXML\tfor\tits\tmessage\tformats.\tSome\timplementations\tare\ttied\tto\ta specific\tnetworking\tprotocol\t(like\tSOAP,\twhich\tmakes\tnominal\tuse\tof\tHTTP),\twhereas others\tmight\tallow\tyou\tto\tuse\tdifferent\ttypes\tof\tnetworking\tprotocols,\twhich\tthemselves can\tprovide\tadditional\tfeatures.\tFor\texample,\tTCP\toffers\tguarantees\tabout\tdelivery, whereas\tUDP\tdoesn’t\tbut\thas\ta\tmuch\tlower\toverhead.\tThis\tcan\tallow\tyou\tto\tuse\tdifferent networking\ttechnology\tfor\tdifferent\tuse\tcases.\n\nThose\tRPC\timplementations\tthat\tallow\tyou\tto\tgenerate\tclient\tand\tserver\tstubs\thelp\tyou get\tstarted\tvery,\tvery\tfast.\tI\tcan\tbe\tsending\tcontent\tover\ta\tnetwork\tboundary\tin\tno\ttime\tat all.\tThis\tis\toften\tone\tof\tthe\tmain\tselling\tpoints\tof\tRPC:\tits\tease\tof\tuse.\tThe\tfact\tthat\tI\tcan just\tmake\ta\tnormal\tmethod\tcall\tand\ttheoretically\tignore\tthe\trest\tis\ta\thuge\tboon.\n\nSome\tRPC\timplementations,\tthough,\tdo\tcome\twith\tsome\tdownsides\tthat\tcan\tcause\tissues. These\tissues\taren’t\talways\tapparent\tinitially,\tbut\tnonetheless\tthey\tcan\tbe\tsevere\tenough\tto outweigh\tthe\tbenefits\tof\tbeing\tso\teasy\tto\tget\tup\tand\trunning\tquickly.\n\nTechnology\tCoupling\n\nSome\tRPC\tmechanisms,\tlike\tJava\tRMI,\tare\theavily\ttied\tto\ta\tspecific\tplatform,\twhich\tcan limit\twhich\ttechnology\tcan\tbe\tused\tin\tthe\tclient\tand\tserver.\tThrift\tand\tprotocol\tbuffers have\tan\timpressive\tamount\tof\tsupport\tfor\talternative\tlanguages,\twhich\tcan\treduce\tthis downside\tsomewhat,\tbut\tbe\taware\tthat\tsometimes\tRPC\ttechnology\tcomes\twith restrictions\ton\tinteroperability.\n\nIn\ta\tway,\tthis\ttechnology\tcoupling\tcan\tbe\ta\tform\tof\texposing\tinternal\ttechnical implementation\tdetails.\tFor\texample,\tthe\tuse\tof\tRMI\tties\tnot\tonly\tthe\tclient\tto\tthe\tJVM, but\tthe\tserver\ttoo.\n\nLocal\tCalls\tAre\tNot\tLike\tRemote\tCalls\n\nThe\tcore\tidea\tof\tRPC\tis\tto\thide\tthe\tcomplexity\tof\ta\tremote\tcall.\tMany\timplementations\tof RPC,\tthough,\thide\ttoo\tmuch.\tThe\tdrive\tin\tsome\tforms\tof\tRPC\tto\tmake\tremote\tmethod calls\tlook\tlike\tlocal\tmethod\tcalls\thides\tthe\tfact\tthat\tthese\ttwo\tthings\tare\tvery\tdifferent.\tI can\tmake\tlarge\tnumbers\tof\tlocal,\tin-process\tcalls\twithout\tworrying\toverly\tabout\tthe performance.\tWith\tRPC,\tthough,\tthe\tcost\tof\tmarshalling\tand\tun-marshalling\tpayloads\tcan be\tsignificant,\tnot\tto\tmention\tthe\ttime\ttaken\tto\tsend\tthings\tover\tthe\tnetwork.\tThis\tmeans you\tneed\tto\tthink\tdifferently\tabout\tAPI\tdesign\tfor\tremote\tinterfaces\tversus\tlocal interfaces.\tJust\ttaking\ta\tlocal\tAPI\tand\ttrying\tto\tmake\tit\ta\tservice\tboundary\twithout\tany more\tthought\tis\tlikely\tto\tget\tyou\tin\ttrouble.\tIn\tsome\tof\tthe\tworst\texamples,\tdevelopers may\tbe\tusing\tremote\tcalls\twithout\tknowing\tit\tif\tthe\tabstraction\tis\toverly\topaque.\n\nYou\tneed\tto\tthink\tabout\tthe\tnetwork\titself.\tFamously,\tthe\tfirst\tof\tthe\tfallacies\tof distributed\tcomputing\tis\t“The\tnetwork\tis\treliable”.\tNetworks\taren’t\treliable.\tThey\tcan\tand will\tfail,\teven\tif\tyour\tclient\tand\tthe\tserver\tyou\tare\tspeaking\tto\tare\tfine.\tThey\tcan\tfail\tfast, they\tcan\tfail\tslow,\tand\tthey\tcan\teven\tmalform\tyour\tpackets.\tYou\tshould\tassume\tthat\tyour networks\tare\tplagued\twith\tmalevolent\tentities\tready\tto\tunleash\ttheir\tire\ton\ta\twhim. Therefore,\tthe\tfailure\tmodes\tyou\tcan\texpect\tare\tdifferent.\tA\tfailure\tcould\tbe\tcaused\tby\tthe remote\tserver\treturning\tan\terror,\tor\tby\tyou\tmaking\ta\tbad\tcall.\tCan\tyou\ttell\tthe\tdifference, and\tif\tso,\tcan\tyou\tdo\tanything\tabout\tit?\tAnd\twhat\tdo\tyou\tdo\twhen\tthe\tremote\tserver\tjust starts\tresponding\tslowly?\tWe’ll\tcover\tthis\ttopic\twhen\twe\ttalk\tabout\tresiliency\tin Chapter\t11.\n\nBrittleness\n\nSome\tof\tthe\tmost\tpopular\timplementations\tof\tRPC\tcan\tlead\tto\tsome\tnasty\tforms\tof brittleness,\tJava’s\tRMI\tbeing\ta\tvery\tgood\texample.\tLet’s\tconsider\ta\tvery\tsimple\tJava interface\tthat\twe\thave\tdecided\tto\tmake\ta\tremote\tAPI\tfor\tour\tcustomer\tservice.\tExample\t4- 1\tdeclares\tthe\tmethods\twe\tare\tgoing\tto\texpose\tremotely.\tJava\tRMI\tthen\tgenerates\tthe client\tand\tserver\tstubs\tfor\tour\tmethod.\n\nExample\t4-1.\tDefining\ta\tservice\tendpoint\tusing\tJava\tRMI import\tjava.rmi.Remote; import\tjava.rmi.RemoteException;\n\npublic\tinterface\tCustomerRemote\textends\tRemote\t{ \t\tpublic\tCustomer\tfindCustomer(String\tid)\tthrows\tRemoteException;\n\npublic\tCustomer\tcreateCustomer(String\tfirstname,\tString\tsurname,\tString\temailAddress) \t\t\t\t\t\tthrows\tRemoteException; }\n\nIn\tthis\tinterface,\tfindCustomer\ttakes\tthe\tfirst\tname,\tsurname,\tand\temail\taddress.\tWhat happens\tif\twe\tdecide\tto\tallow\tthe\tCustomer\tobject\tto\talso\tbe\tcreated\twith\tjust\tan\temail address?\tWe\tcould\tadd\ta\tnew\tmethod\tat\tthis\tpoint\tpretty\teasily,\tlike\tso:\n\n... public\tCustomer\tcreateCustomer(String\temailAddress)\tthrows\tRemoteException; ...\n\nThe\tproblem\tis\tthat\tnow\twe\tneed\tto\tregenerate\tthe\tclient\tstubs\ttoo.\tClients\tthat\twant\tto consume\tthe\tnew\tmethod\tneed\tthe\tnew\tstubs,\tand\tdepending\ton\tthe\tnature\tof\tthe\tchanges to\tthe\tspecification,\tconsumers\tthat\tdon’t\tneed\tthe\tnew\tmethod\tmay\talso\tneed\tto\thave their\tstubs\tupgraded\ttoo.\tThis\tis\tmanageable,\tof\tcourse,\tbut\tto\ta\tpoint.\tThe\treality\tis\tthat changes\tlike\tthis\tare\tfairly\tcommon.\tRPC\tendpoints\toften\tend\tup\thaving\ta\tlarge\tnumber\tof methods\tfor\tdifferent\tways\tof\tcreating\tor\tinteracting\twith\tobjects.\tThis\tis\tdue\tin\tpart\tto\tthe fact\tthat\twe\tare\tstill\tthinking\tof\tthese\tremote\tcalls\tas\tlocal\tones.\n\nThere\tis\tanother\tsort\tof\tbrittleness,\tthough.\tLet’s\ttake\ta\tlook\tat\twhat\tour\tCustomer\tobject looks\tlike:\n\npublic\tclass\tCustomer\timplements\tSerializable\t{ \t\tprivate\tString\tfirstName; \t\tprivate\tString\tsurname; \t\tprivate\tString\temailAddress; \t\tprivate\tString\tage; }\n\nNow,\twhat\tif\tit\tturns\tout\tthat\talthough\twe\texpose\tthe\tage\tfield\tin\tour\tCustomer\tobjects, none\tof\tour\tconsumers\tever\tuse\tit?\tWe\tdecide\twe\twant\tto\tremove\tthis\tfield.\tBut\tif\tthe server\timplementation\tremoves\tage\tfrom\tits\tdefinition\tof\tthis\ttype,\tand\twe\tdon’t\tdo\tthe same\tto\tall\tthe\tconsumers,\tthen\teven\tthough\tthey\tnever\tused\tthe\tfield,\tthe\tcode\tassociated with\tdeserializing\tthe\tCustomer\tobject\ton\tthe\tconsumer\tside\twill\tbreak.\tTo\troll\tout\tthis change,\tI\twould\thave\tto\tdeploy\tboth\ta\tnew\tserver\tand\tclients\tat\tthe\tsame\ttime.\tThis\tis\ta\n\nkey\tchallenge\twith\tany\tRPC\tmechanism\tthat\tpromotes\tthe\tuse\tof\tbinary\tstub\tgeneration: you\tdon’t\tget\tto\tseparate\tclient\tand\tserver\tdeployments.\tIf\tyou\tuse\tthis\ttechnology,\tlock- step\treleases\tmay\tbe\tin\tyour\tfuture.\n\nSimilar\tproblems\toccur\tif\tI\twant\tto\trestructure\tthe\tCustomer\tobject\teven\tif\tI\tdidn’t\tremove fields\t—\tfor\texample,\tif\tI\twanted\tto\tencapsulate\tfirstName\tand\tsurname\tinto\ta\tnew naming\ttype\tto\tmake\tit\teasier\tto\tmanage.\tI\tcould,\tof\tcourse,\tfix\tthis\tby\tpassing\taround dictionary\ttypes\tas\tthe\tparameters\tof\tmy\tcalls,\tbut\tat\tthat\tpoint,\tI\tlose\tmany\tof\tthe\tbenefits of\tthe\tgenerated\tstubs\tbecause\tI’ll\tstill\thave\tto\tmanually\tmatch\tand\textract\tthe\tfields\tI want.\n\nIn\tpractice,\tobjects\tused\tas\tpart\tof\tbinary\tserialization\tacross\tthe\twire\tcan\tbe\tthought\tof\tas expand-only\ttypes.\tThis\tbrittleness\tresults\tin\tthe\ttypes\tbeing\texposed\tover\tthe\twire\tand becoming\ta\tmass\tof\tfields,\tsome\tof\twhich\tare\tno\tlonger\tused\tbut\tcan’t\tbe\tsafely\tremoved.\n\nIs\tRPC\tTerrible?\n\nDespite\tits\tshortcomings,\tI\twouldn’t\tgo\tso\tfar\tas\tto\tcall\tRPC\tterrible.\tSome\tof\tthe common\timplementations\tthat\tI\thave\tencountered\tcan\tlead\tto\tthe\tsorts\tof\tproblems\tI\thave outlined\there.\tDue\tto\tthe\tchallenges\tof\tusing\tRMI,\tI\twould\tcertainly\tgive\tthat\ttechnology a\twide\tberth.\tMany\toperations\tfall\tquite\tnicely\tinto\tthe\tRPC-based\tmodel,\tand\tmore modern\tmechanisms\tlike\tprotocol\tbuffers\tor\tThrift\tmitigate\tsome\tof\tsins\tof\tthe\tpast\tby avoiding\tthe\tneed\tfor\tlock-step\treleases\tof\tclient\tand\tserver\tcode.\n\nJust\tbe\taware\tof\tsome\tof\tthe\tpotential\tpitfalls\tassociated\twith\tRPC\tif\tyou’re\tgoing\tto\tpick this\tmodel.\tDon’t\tabstract\tyour\tremote\tcalls\tto\tthe\tpoint\twhere\tthe\tnetwork\tis\tcompletely hidden,\tand\tensure\tthat\tyou\tcan\tevolve\tthe\tserver\tinterface\twithout\thaving\tto\tinsist\ton lock-step\tupgrades\tfor\tclients.\tFinding\tthe\tright\tbalance\tfor\tyour\tclient\tcode\tis\timportant, for\texample.\tMake\tsure\tyour\tclients\taren’t\toblivious\tto\tthe\tfact\tthat\ta\tnetwork\tcall\tis\tgoing to\tbe\tmade.\tClient\tlibraries\tare\toften\tused\tin\tthe\tcontext\tof\tRPC,\tand\tif\tnot\tstructured\tright they\tcan\tbe\tproblematic.\tWe’ll\ttalk\tmore\tabout\tthem\tshortly.\n\nCompared\tto\tdatabase\tintegration,\tRPC\tis\tcertainly\tan\timprovement\twhen\twe\tthink\tabout options\tfor\trequest/response\tcollaboration.\tBut\tthere’s\tanother\toption\tto\tconsider.\n\nREST\n\nREpresentational\tState\tTransfer\t(REST)\tis\tan\tarchitectural\tstyle\tinspired\tby\tthe\tWeb. There\tare\tmany\tprinciples\tand\tconstraints\tbehind\tthe\tREST\tstyle,\tbut\twe\tare\tgoing\tto focus\ton\tthose\tthat\treally\thelp\tus\twhen\twe\tface\tintegration\tchallenges\tin\ta\tmicroservices world,\tand\twhen\twe’re\tlooking\tfor\tan\talternative\tstyle\tto\tRPC\tfor\tour\tservice\tinterfaces.\n\nMost\timportant\tis\tthe\tconcept\tof\tresources.\tYou\tcan\tthink\tof\ta\tresource\tas\ta\tthing\tthat\tthe service\titself\tknows\tabout,\tlike\ta\tCustomer.\tThe\tserver\tcreates\tdifferent\trepresentations\tof this\tCustomer\ton\trequest.\tHow\ta\tresource\tis\tshown\texternally\tis\tcompletely\tdecoupled from\thow\tit\tis\tstored\tinternally.\tA\tclient\tmight\task\tfor\ta\tJSON\trepresentation\tof\ta Customer,\tfor\texample,\teven\tif\tit\tis\tstored\tin\ta\tcompletely\tdifferent\tformat.\tOnce\ta\tclient has\ta\trepresentation\tof\tthis\tCustomer,\tit\tcan\tthen\tmake\trequests\tto\tchange\tit,\tand\tthe server\tmay\tor\tmay\tnot\tcomply\twith\tthem.\n\nThere\tare\tmany\tdifferent\tstyles\tof\tREST,\tand\tI\ttouch\tonly\tbriefly\ton\tthem\there.\tI\tstrongly recommend\tyou\ttake\ta\tlook\tat\tthe\tRichardson\tMaturity\tModel,\twhere\tthe\tdifferent\tstyles of\tREST\tare\tcompared.\n\nREST\titself\tdoesn’t\treally\ttalk\tabout\tunderlying\tprotocols,\talthough\tit\tis\tmost\tcommonly used\tover\tHTTP.\tI\thave\tseen\timplementations\tof\tREST\tusing\tvery\tdifferent\tprotocols before,\tsuch\tas\tserial\tor\tUSB,\talthough\tthis\tcan\trequire\ta\tlot\tof\twork.\tSome\tof\tthe\tfeatures that\tHTTP\tgives\tus\tas\tpart\tof\tthe\tspecification,\tsuch\tas\tverbs,\tmake\timplementing\tREST over\tHTTP\teasier,\twhereas\twith\tother\tprotocols\tyou’ll\thave\tto\thandle\tthese\tfeatures yourself.\n\nREST\tand\tHTTP\n\nHTTP\titself\tdefines\tsome\tuseful\tcapabilities\tthat\tplay\tvery\twell\twith\tthe\tREST\tstyle.\tFor example,\tthe\tHTTP\tverbs\t(e.g.,\tGET,\tPOST,\tand\tPUT)\talready\thave\twell-understood meanings\tin\tthe\tHTTP\tspecification\tas\tto\thow\tthey\tshould\twork\twith\tresources.\tThe REST\tarchitectural\tstyle\tactually\ttells\tus\tthat\tmethods\tshould\tbehave\tthe\tsame\tway\ton\tall resources,\tand\tthe\tHTTP\tspecification\thappens\tto\tdefine\ta\tbunch\tof\tmethods\twe\tcan\tuse. GET\tretrieves\ta\tresource\tin\tan\tidempotent\tway,\tand\tPOST\tcreates\ta\tnew\tresource.\tThis means\twe\tcan\tavoid\tlots\tof\tdifferent\tcreateCustomer\tor\teditCustomer\tmethods.\tInstead, we\tcan\tsimply\tPOST\ta\tcustomer\trepresentation\tto\trequest\tthat\tthe\tserver\tcreate\ta\tnew resource,\tand\tinitiate\ta\tGET\trequest\tto\tretrieve\ta\trepresentation\tof\ta\tresource. Conceptually,\tthere\tis\tone\tendpoint\tin\tthe\tform\tof\ta\tCustomer\tresource\tin\tthese\tcases,\tand the\toperations\twe\tcan\tcarry\tout\tupon\tit\tare\tbaked\tinto\tthe\tHTTP\tprotocol.\n\nHTTP\talso\tbrings\ta\tlarge\tecosystem\tof\tsupporting\ttools\tand\ttechnology.\tWe\tget\tto\tuse HTTP\tcaching\tproxies\tlike\tVarnish\tand\tload\tbalancers\tlike\tmod_proxy,\tand\tmany monitoring\ttools\talready\thave\tlots\tof\tsupport\tfor\tHTTP\tout\tof\tthe\tbox.\tThese\tbuilding blocks\tallow\tus\tto\thandle\tlarge\tvolumes\tof\tHTTP\ttraffic\tand\troute\tthem\tsmartly,\tin\ta\tfairly transparent\tway.\tWe\talso\tget\tto\tuse\tall\tthe\tavailable\tsecurity\tcontrols\twith\tHTTP\tto\tsecure our\tcommunications.\tFrom\tbasic\tauth\tto\tclient\tcerts,\tthe\tHTTP\tecosystem\tgives\tus\tlots\tof tools\tto\tmake\tthe\tsecurity\tprocess\teasier,\tand\twe’ll\texplore\tthat\ttopic\tmore\tin\tChapter\t9. That\tsaid,\tto\tget\tthese\tbenefits,\tyou\thave\tto\tuse\tHTTP\twell.\tUse\tit\tbadly,\tand\tit\tcan\tbe\tas insecure\tand\thard\tto\tscale\tas\tany\tother\ttechnology\tout\tthere.\tUse\tit\tright,\tthough,\tand\tyou get\ta\tlot\tof\thelp.\n\nNote\tthat\tHTTP\tcan\tbe\tused\tto\timplement\tRPC\ttoo.\tSOAP,\tfor\texample,\tgets\trouted\tover HTTP,\tbut\tunfortunately\tuses\tvery\tlittle\tof\tthe\tspecification.\tVerbs\tare\tignored,\tas\tare simple\tthings\tlike\tHTTP\terror\tcodes.\tAll\ttoo\toften,\tit\tseems,\tthe\texisting,\twell-understood standards\tand\ttechnology\tare\tignored\tin\tfavor\tof\tnew\tstandards\tthat\tcan\tonly\tbe implemented\tusing\tbrand-new\ttechnology\t—\tconveniently\tprovided\tby\tthe\tsame companies\tthat\thelp\tdesign\tthe\tnew\tstandards\tin\tthe\tfirst\tplace!\n\nHypermedia\tAs\tthe\tEngine\tof\tApplication\tState\n\nAnother\tprinciple\tintroduced\tin\tREST\tthat\tcan\thelp\tus\tavoid\tthe\tcoupling\tbetween\tclient and\tserver\tis\tthe\tconcept\tof\thypermedia\tas\tthe\tengine\tof\tapplication\tstate\t(often abbreviated\tas\tHATEOAS,\tand\tboy,\tdid\tit\tneed\tan\tabbreviation).\tThis\tis\tfairly\tdense wording\tand\ta\tfairly\tinteresting\tconcept,\tso\tlet’s\tbreak\tit\tdown\ta\tbit.\n\nHypermedia\tis\ta\tconcept\twhereby\ta\tpiece\tof\tcontent\tcontains\tlinks\tto\tvarious\tother\tpieces of\tcontent\tin\ta\tvariety\tof\tformats\t(e.g.,\ttext,\timages,\tsounds).\tThis\tshould\tbe\tpretty familiar\tto\tyou,\tas\tit’s\twhat\tthe\taverage\tweb\tpage\tdoes:\tyou\tfollow\tlinks,\twhich\tare\ta\tform of\thypermedia\tcontrols,\tto\tsee\trelated\tcontent.\tThe\tidea\tbehind\tHATEOAS\tis\tthat\tclients should\tperform\tinteractions\t(potentially\tleading\tto\tstate\ttransitions)\twith\tthe\tserver\tvia these\tlinks\tto\tother\tresources.\tIt\tdoesn’t\tneed\tto\tknow\twhere\texactly\tcustomers\tlive\ton\tthe server\tby\tknowing\twhich\tURI\tto\thit;\tinstead,\tthe\tclient\tlooks\tfor\tand\tnavigates\tlinks\tto find\twhat\tit\tneeds.\n\nThis\tis\ta\tbit\tof\tan\todd\tconcept,\tso\tlet’s\tfirst\tstep\tback\tand\tconsider\thow\tpeople\tinteract with\ta\tweb\tpage,\twhich\twe’ve\talready\testablished\tis\trich\twith\thypermedia\tcontrols.\n\nThink\tof\tthe\tAmazon.com\tshopping\tsite.\tThe\tlocation\tof\tthe\tshopping\tcart\thas\tchanged over\ttime.\tThe\tgraphic\thas\tchanged.\tThe\tlink\thas\tchanged.\tBut\tas\thumans\twe\tare\tsmart enough\tto\tstill\tsee\ta\tshopping\tcart,\tknow\twhat\tit\tis,\tand\tinteract\twith\tit.\tWe\thave\tan understanding\tof\twhat\ta\tshopping\tcart\tmeans,\teven\tif\tthe\texact\tform\tand\tunderlying control\tused\tto\trepresent\tit\thas\tchanged.\tWe\tknow\tthat\tif\twe\twant\tto\tview\tthe\tcart,\tthis\tis the\tcontrol\twe\twant\tto\tinteract\twith.\tThis\tis\twhy\tweb\tpages\tcan\tchange\tincrementally\tover time.\tAs\tlong\tas\tthese\timplicit\tcontracts\tbetween\tthe\tcustomer\tand\tthe\twebsite\tare\tstill met,\tchanges\tdon’t\tneed\tto\tbe\tbreaking\tchanges.\n\nWith\thypermedia\tcontrols,\twe\tare\ttrying\tto\tachieve\tthe\tsame\tlevel\tof\tsmarts\tfor\tour electronic\tconsumers.\tLet’s\tlook\tat\ta\thypermedia\tcontrol\tthat\twe\tmight\thave\tfor MusicCorp.\tWe’ve\taccessed\ta\tresource\trepresenting\ta\tcatalog\tentry\tfor\ta\tgiven\talbum\tin Example\t4-2.\tAlong\twith\tinformation\tabout\tthe\talbum,\twe\tsee\ta\tnumber\tof\thypermedia controls.\n\nExample\t4-2.\tHypermedia\tcontrols\tused\ton\tan\talbum\tlisting <album> \t\t<name>Give\tBlood</name> \t\t<link\trel=\"/artist\"\thref=\"/artist/theBrakes\"\t/>\t \t\t<description> \t\t\t\tAwesome,\tshort,\tbrutish,\tfunny\tand\tloud.\tMust\tbuy! \t\t</description> \t\t<link\trel=\"/instantpurchase\"\thref=\"/instantPurchase/1234\"\t/>\t </album>\n\nThis\thypermedia\tcontrol\tshows\tus\twhere\tto\tfind\tinformation\tabout\tthe\tartist.\n\nAnd\tif\twe\twant\tto\tpurchase\tthe\talbum,\twe\tnow\tknow\twhere\tto\tgo.\n\nIn\tthis\tdocument,\twe\thave\ttwo\thypermedia\tcontrols.\tThe\tclient\treading\tsuch\ta\tdocument needs\tto\tknow\tthat\ta\tcontrol\twith\ta\trelation\tof\tartist\tis\twhere\tit\tneeds\tto\tnavigate\tto\tget information\tabout\tthe\tartist,\tand\tthat\tinstantpurchase\tis\tpart\tof\tthe\tprotocol\tused\tto purchase\tthe\talbum.\tThe\tclient\thas\tto\tunderstand\tthe\tsemantics\tof\tthe\tAPI\tin\tmuch\tthe same\tway\tas\ta\thuman\tbeing\tneeds\tto\tunderstand\tthat\ton\ta\tshopping\twebsite\tthe\tcart\tis where\tthe\titems\tto\tbe\tpurchased\twill\tbe.\n\nAs\ta\tclient,\tI\tdon’t\tneed\tto\tknow\twhich\tURI\tscheme\tto\taccess\tto\tbuy\tthe\talbum,\tI\tjust need\tto\taccess\tthe\tresource,\tfind\tthe\tbuy\tcontrol,\tand\tnavigate\tto\tthat.\tThe\tbuy\tcontrol could\tchange\tlocation,\tthe\tURI\tcould\tchange,\tor\tthe\tsite\tcould\teven\tsend\tme\tto\tanother service\taltogether,\tand\tas\ta\tclient\tI\twouldn’t\tcare.\tThis\tgives\tus\ta\thuge\tamount\tof decoupling\tbetween\tthe\tclient\tand\tserver.\n\nWe\tare\tgreatly\tabstracted\tfrom\tthe\tunderlying\tdetail\there.\tWe\tcould\tcompletely\tchange\tthe implementation\tof\thow\tthe\tcontrol\tis\tpresented\tas\tlong\tas\tthe\tclient\tcan\tstill\tfind\ta\tcontrol that\tmatches\tits\tunderstanding\tof\tthe\tprotocol,\tin\tthe\tsame\tway\tthat\ta\tshopping\tcart control\tmight\tgo\tfrom\tbeing\ta\tsimple\tlink\tto\ta\tmore\tcomplex\tJavaScript\tcontrol.\tWe\tare also\tfree\tto\tadd\tnew\tcontrols\tto\tthe\tdocument,\tperhaps\trepresenting\tnew\tstate\ttransitions that\twe\tcan\tperform\ton\tthe\tresource\tin\tquestion.\tWe\twould\tend\tup\tbreaking\tour consumers\tonly\tif\twe\tfundamentally\tchanged\tthe\tsemantics\tof\tone\tof\tthe\tcontrols\tso\tit behaved\tvery\tdifferently,\tor\tif\twe\tremoved\ta\tcontrol\taltogether.\n\nUsing\tthese\tcontrols\tto\tdecouple\tthe\tclient\tand\tserver\tyields\tsignificant\tbenefits\tover\ttime that\tgreatly\toffset\tthe\tsmall\tincrease\tin\tthe\ttime\tit\ttakes\tto\tget\tthese\tprotocols\tup\tand running.\tBy\tfollowing\tthe\tlinks,\tthe\tclient\tgets\tto\tprogressively\tdiscover\tthe\tAPI,\twhich can\tbe\ta\treally\thandy\tcapability\twhen\twe\tare\timplementing\tnew\tclients.\n\nOne\tof\tthe\tdownsides\tis\tthat\tthis\tnavigation\tof\tcontrols\tcan\tbe\tquite\tchatty,\tas\tthe\tclient needs\tto\tfollow\tlinks\tto\tfind\tthe\toperation\tit\twants\tto\tperform.\tUltimately,\tthis\tis\ta\ttrade- off.\tI\twould\tsuggest\tyou\tstart\twith\thaving\tyour\tclients\tnavigate\tthese\tcontrols\tfirst,\tthen optimize\tlater\tif\tnecessary.\tRemember\tthat\twe\thave\ta\tlarge\tamount\tof\thelp\tout\tof\tthe\tbox by\tusing\tHTTP,\twhich\twe\tdiscussed\tearlier.\tThe\tevils\tof\tpremature\toptimization\thave been\twell\tdocumented\tbefore,\tso\tI\tdon’t\tneed\tto\texpand\tupon\tthem\there.\tAlso\tnote\tthat\ta lot\tof\tthese\tapproaches\twere\tdeveloped\tto\tcreate\tdistributed\thypertext\tsystems,\tand\tnot\tall of\tthem\tfit!\tSometimes\tyou’ll\tfind\tyourself\tjust\twanting\tgood\told-fashioned\tRPC.\n\nPersonally,\tI\tam\ta\tfan\tof\tusing\tlinks\tto\tallow\tconsumers\tto\tnavigate\tAPI\tendpoints.\tThe benefits\tof\tprogressive\tdiscovery\tof\tthe\tAPI\tand\treduced\tcoupling\tcan\tbe\tsignificant. However,\tit\tis\tclear\tthat\tnot\teveryone\tis\tsold,\tas\tI\tdon’t\tsee\tit\tbeing\tused\tanywhere\tnear\tas much\tas\tI\twould\tlike.\tI\tthink\ta\tlarge\tpart\tof\tthis\tis\tthat\tthere\tis\tsome\tinitial\tupfront\twork required,\tbut\tthe\trewards\toften\tcome\tlater.\n\nJSON,\tXML,\tor\tSomething\tElse?\n\nThe\tuse\tof\tstandard\ttextual\tformats\tgives\tclients\ta\tlot\tof\tflexibility\tas\tto\thow\tthey consume\tresources,\tand\tREST\tover\tHTTP\tlets\tus\tuse\ta\tvariety\tof\tformats.\tThe\texamples\tI have\tgiven\tso\tfar\tused\tXML,\tbut\tat\tthis\tstage,\tJSON\tis\ta\tmuch\tmore\tpopular\tcontent\ttype for\tservices\tthat\twork\tover\tHTTP.\n\nThe\tfact\tthat\tJSON\tis\ta\tmuch\tsimpler\tformat\tmeans\tthat\tconsumption\tis\talso\teasier.\tSome proponents\talso\tcite\tits\trelative\tcompactness\twhen\tcompared\tto\tXML\tas\tanother\twinning factor,\talthough\tthis\tisn’t\toften\ta\treal-world\tissue.\n\nJSON\tdoes\thave\tsome\tdownsides,\tthough.\tXML\tdefines\tthe\tlink\tcontrol\twe\tused\tearlier as\ta\thypermedia\tcontrol.\tThe\tJSON\tstandard\tdoesn’t\tdefine\tanything\tsimilar,\tso\tin-house styles\tare\tfrequently\tused\tto\tshoe-horn\tthis\tconcept\tin.\tThe\tHypertext\tApplication Language\t(HAL)\tattempts\tto\tfix\tthis\tby\tdefining\tsome\tcommon\tstandards\tfor hyperlinking\tfor\tJSON\t(and\tXML\ttoo,\talthough\targuably\tXML\tneeds\tless\thelp).\tIf\tyou follow\tthe\tHAL\tstandard,\tyou\tcan\tuse\ttools\tlike\tthe\tweb-based\tHAL\tbrowser\tfor exploring\thypermedia\tcontrols,\twhich\tcan\tmake\tthe\ttask\tof\tcreating\ta\tclient\tmuch\teasier.\n\nWe\taren’t\tlimited\tto\tthese\ttwo\tformats,\tof\tcourse.\tWe\tcan\tsend\tpretty\tmuch\tanything\tover HTTP\tif\twe\twant,\teven\tbinary.\tI\tam\tseeing\tmore\tand\tmore\tpeople\tjust\tusing\tHTML\tas\ta format\tinstead\tof\tXML.\tFor\tsome\tinterfaces,\tthe\tHTML\tcan\tdo\tdouble\tduty\tas\ta\tUI\tand\tan API,\talthough\tthere\tare\tpitfalls\tto\tbe\tavoided\there,\tas\tthe\tinteractions\tof\ta\thuman\tand\ta computer\tare\tquite\tdifferent!\tBut\tit\tis\tcertainly\tan\tattractive\tidea.\tThere\tare\tlots\tof\tHTML parsers\tout\tthere,\tafter\tall.\n\nPersonally,\tthough,\tI\tam\tstill\ta\tfan\tof\tXML.\tSome\tof\tthe\ttool\tsupport\tis\tbetter.\tFor example,\tif\tI\twant\tto\textract\tonly\tcertain\tparts\tof\tthe\tpayload\t(a\ttechnique\twe’ll\tdiscuss more\tin\t“Versioning”)\tI\tcan\tuse\tXPATH,\twhich\tis\ta\twell-understood\tstandard\twith\tlots\tof tool\tsupport,\tor\teven\tCSS\tselectors,\twhich\tmany\tfind\teven\teasier.\tWith\tJSON,\tI\thave JSONPATH,\tbut\tthis\tis\tnot\twidely\tsupported.\tI\tfind\tit\todd\tthat\tpeople\tpick\tJSON\tbecause it\tis\tnice\tand\tlightweight,\tthen\ttry\tand\tpush\tconcepts\tinto\tit\tlike\thypermedia\tcontrols\tthat already\texist\tin\tXML.\tI\taccept,\tthough,\tthat\tI\tam\tprobably\tin\tthe\tminority\there\tand\tthat JSON\tis\tthe\tformat\tof\tchoice\tfor\tmost\tpeople!\n\nBeware\tToo\tMuch\tConvenience\n\nAs\tREST\thas\tbecome\tmore\tpopular,\tso\ttoo\thave\tthe\tframeworks\tthat\thelp\tus\tcreate RESTFul\tweb\tservices.\tHowever,\tsome\tof\tthese\ttools\ttrade\toff\ttoo\tmuch\tin\tterms\tof\tshort- term\tgain\tfor\tlong-term\tpain;\tin\ttrying\tto\tget\tyou\tgoing\tfast,\tthey\tcan\tencourage\tsome\tbad behaviors.\tFor\texample,\tsome\tframeworks\tactually\tmake\tit\tvery\teasy\tto\tsimply\ttake database\trepresentations\tof\tobjects,\tdeserialize\tthem\tinto\tin-process\tobjects,\tand\tthen directly\texpose\tthese\texternally.\tI\tremember\tat\ta\tconference\tseeing\tthis\tdemonstrated using\tSpring\tBoot\tand\tcited\tas\ta\tmajor\tadvantage.\tThe\tinherent\tcoupling\tthat\tthis\tsetup promotes\twill\tin\tmost\tcases\tcause\tfar\tmore\tpain\tthan\tthe\teffort\trequired\tto\tproperly decouple\tthese\tconcepts.\n\nThere\tis\ta\tmore\tgeneral\tproblem\tat\tplay\there.\tHow\twe\tdecide\tto\tstore\tour\tdata,\tand\thow we\texpose\tit\tto\tour\tconsumers,\tcan\teasily\tdominate\tour\tthinking.\tOne\tpattern\tI\tsaw\tused effectively\tby\tone\tof\tour\tteams\twas\tto\tdelay\tthe\timplementation\tof\tproper\tpersistence\tfor the\tmicroservice,\tuntil\tthe\tinterface\thad\tstabilized\tenough.\tFor\tan\tinterim\tperiod,\tentities were\tjust\tpersisted\tin\ta\tfile\ton\tlocal\tdisk,\twhich\tis\tobviously\tnot\ta\tsuitable\tlong-term solution.\tThis\tensured\tthat\thow\tthe\tconsumers\twanted\tto\tuse\tthe\tservice\tdrove\tthe\tdesign and\timplementation\tdecisions.\tThe\trationale\tgiven,\twhich\twas\tborne\tout\tin\tthe\tresults, was\tthat\tit\tis\ttoo\teasy\tfor\tthe\tway\twe\tstore\tdomain\tentities\tin\ta\tbacking\tstore\tto\tovertly influence\tthe\tmodels\twe\tsend\tover\tthe\twire\tto\tcollaborators.\tOne\tof\tthe\tdownsides\twith this\tapproach\tis\tthat\twe\tare\tdeferring\tthe\twork\trequired\tto\twire\tup\tour\tdata\tstore.\tI\tthink for\tnew\tservice\tboundaries,\thowever,\tthis\tis\tan\tacceptable\ttrade-off.\n\nDownsides\tto\tREST\tOver\tHTTP\n\nIn\tterms\tof\tease\tof\tconsumption,\tyou\tcannot\teasily\tgenerate\ta\tclient\tstub\tfor\tyour\tREST over\tHTTP\tapplication\tprotocol\tlike\tyou\tcan\twith\tRPC.\tSure,\tthe\tfact\tthat\tHTTP\tis\tbeing used\tmeans\tthat\tyou\tget\tto\ttake\tadvantage\tof\tall\tthe\texcellent\tHTTP\tclient\tlibraries\tout there,\tbut\tif\tyou\twant\tto\timplement\tand\tuse\thypermedia\tcontrols\tas\ta\tclient\tyou\tare\tpretty much\ton\tyour\town.\tPersonally,\tI\tthink\tclient\tlibraries\tcould\tdo\tmuch\tbetter\tat\tthis\tthan they\tdo,\tand\tthey\tare\tcertainly\tbetter\tnow\tthan\tin\tthe\tpast,\tbut\tI\thave\tseen\tthis\tapparent increased\tcomplexity\tresult\tin\tpeople\tbacksliding\tinto\tsmuggling\tRPC\tover\tHTTP\tor building\tshared\tclient\tlibraries.\tShared\tcode\tbetween\tclient\tand\tserver\tcan\tbe\tvery dangerous,\tas\twe’ll\tdiscuss\tin\t“DRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta\tMicroservice World”.\n\nA\tmore\tminor\tpoint\tis\tthat\tsome\tweb\tserver\tframeworks\tdon’t\tactually\tsupport\tall\tthe HTTP\tverbs\twell.\tThat\tmeans\tthat\tit\tmight\tbe\teasy\tfor\tyou\tto\tcreate\ta\thandler\tfor\tGET\tor POST\trequests,\tbut\tyou\tmay\thave\tto\tjump\tthrough\thoops\tto\tget\tPUT\tor\tDELETE\trequests to\twork.\tProper\tREST\tframeworks\tlike\tJersey\tdon’t\thave\tthis\tproblem,\tand\tyou\tcan normally\twork\taround\tthis,\tbut\tif\tyou\tare\tlocked\tinto\tcertain\tframework\tchoices\tthis\tmight limit\twhat\tstyle\tof\tREST\tyou\tcan\tuse.\n\nPerformance\tmay\talso\tbe\tan\tissue.\tREST\tover\tHTTP\tpayloads\tcan\tactually\tbe\tmore compact\tthan\tSOAP\tbecause\tit\tsupports\talternative\tformats\tlike\tJSON\tor\teven\tbinary,\tbut it\twill\tstill\tbe\tnowhere\tnear\tas\tlean\ta\tbinary\tprotocol\tas\tThrift\tmight\tbe.\tThe\toverhead\tof HTTP\tfor\teach\trequest\tmay\talso\tbe\ta\tconcern\tfor\tlow-latency\trequirements.\n\nHTTP,\twhile\tit\tcan\tbe\tsuited\twell\tto\tlarge\tvolumes\tof\ttraffic,\tisn’t\tgreat\tfor\tlow-latency communications\twhen\tcompared\tto\talternative\tprotocols\tthat\tare\tbuilt\ton\ttop\tof Transmission\tControl\tProtocol\t(TCP)\tor\tother\tnetworking\ttechnology.\tDespite\tthe\tname, WebSockets,\tfor\texample,\thas\tvery\tlittle\tto\tdo\twith\tthe\tWeb.\tAfter\tthe\tinitial\tHTTP handshake,\tit’s\tjust\ta\tTCP\tconnection\tbetween\tclient\tand\tserver,\tbut\tit\tcan\tbe\ta\tmuch\tmore efficient\tway\tfor\tyou\tto\tstream\tdata\tfor\ta\tbrowser.\tIf\tthis\tis\tsomething\tyou’re\tinterested\tin, note\tthat\tyou\taren’t\treally\tusing\tmuch\tof\tHTTP,\tlet\talone\tanything\tto\tdo\twith\tREST.\n\nFor\tserver-to-server\tcommunications,\tif\textremely\tlow\tlatency\tor\tsmall\tmessage\tsize\tis important,\tHTTP\tcommunications\tin\tgeneral\tmay\tnot\tbe\ta\tgood\tidea.\tYou\tmay\tneed\tto pick\tdifferent\tunderlying\tprotocols,\tlike\tUser\tDatagram\tProtocol\t(UDP),\tto\tachieve\tthe performance\tyou\twant,\tand\tmany\tRPC\tframeworks\twill\tquite\thappily\trun\ton\ttop\tof networking\tprotocols\tother\tthan\tTCP.\n\nConsumption\tof\tthe\tpayloads\tthemselves\trequires\tmore\twork\tthan\tis\tprovided\tby\tsome RPC\timplementations\tthat\tsupport\tadvanced\tserialization\tand\tdeserialization\tmechanisms. These\tcan\tbecome\ta\tcoupling\tpoint\tin\ttheir\town\tright\tbetween\tclient\tand\tserver,\tas implementing\ttolerant\treaders\tis\ta\tnontrivial\tactivity\t(we’ll\tdiscuss\tthis\tshortly),\tbut\tfrom the\tpoint\tof\tview\tof\tgetting\tup\tand\trunning,\tthey\tcan\tbe\tvery\tattractive.\n\nDespite\tthese\tdisadvantages,\tREST\tover\tHTTP\tis\ta\tsensible\tdefault\tchoice\tfor\tservice-to- service\tinteractions.\tIf\tyou\twant\tto\tknow\tmore,\tI\trecommend\tREST\tin\tPractice\t(O’Reilly), which\tcovers\tthe\ttopic\tof\tREST\tover\tHTTP\tin\tdepth.\n\nImplementing\tAsynchronous\tEvent-Based\tCollaboration\n\nWe’ve\ttalked\tfor\ta\tbit\tabout\tsome\ttechnologies\tthat\tcan\thelp\tus\timplement request/response\tpatterns.\tWhat\tabout\tevent-based,\tasynchronous\tcommunication?\n\nTechnology\tChoices\n\nThere\tare\ttwo\tmain\tparts\twe\tneed\tto\tconsider\there:\ta\tway\tfor\tour\tmicroservices\tto\temit events,\tand\ta\tway\tfor\tour\tconsumers\tto\tfind\tout\tthose\tevents\thave\thappened.\n\nTraditionally,\tmessage\tbrokers\tlike\tRabbitMQ\ttry\tto\thandle\tboth\tproblems.\tProducers\tuse an\tAPI\tto\tpublish\tan\tevent\tto\tthe\tbroker.\tThe\tbroker\thandles\tsubscriptions,\tallowing consumers\tto\tbe\tinformed\twhen\tan\tevent\tarrives.\tThese\tbrokers\tcan\teven\thandle\tthe\tstate of\tconsumers,\tfor\texample\tby\thelping\tkeep\ttrack\tof\twhat\tmessages\tthey\thave\tseen\tbefore. These\tsystems\tare\tnormally\tdesigned\tto\tbe\tscalable\tand\tresilient,\tbut\tthat\tdoesn’t\tcome\tfor free.\tIt\tcan\tadd\tcomplexity\tto\tthe\tdevelopment\tprocess,\tbecause\tit\tis\tanother\tsystem\tyou may\tneed\tto\trun\tto\tdevelop\tand\ttest\tyour\tservices.\tAdditional\tmachines\tand\texpertise\tmay also\tbe\trequired\tto\tkeep\tthis\tinfrastructure\tup\tand\trunning.\tBut\tonce\tit\tdoes,\tit\tcan\tbe\tan incredibly\teffective\tway\tto\timplement\tloosely\tcoupled,\tevent-driven\tarchitectures.\tIn general,\tI’m\ta\tfan.\n\nDo\tbe\twary,\tthough,\tabout\tthe\tworld\tof\tmiddleware,\tof\twhich\tthe\tmessage\tbroker\tis\tjust\ta small\tpart.\tQueues\tin\tand\tof\tthemselves\tare\tperfectly\tsensible,\tuseful\tthings.\tHowever, vendors\ttend\tto\twant\tto\tpackage\tlots\tof\tsoftware\twith\tthem,\twhich\tcan\tlead\tto\tmore\tand more\tsmarts\tbeing\tpushed\tinto\tthe\tmiddleware,\tas\tevidenced\tby\tthings\tlike\tthe\tEnterprise Service\tBus.\tMake\tsure\tyou\tknow\twhat\tyou’re\tgetting:\tkeep\tyour\tmiddleware\tdumb,\tand keep\tthe\tsmarts\tin\tthe\tendpoints.\n\nAnother\tapproach\tis\tto\ttry\tto\tuse\tHTTP\tas\ta\tway\tof\tpropagating\tevents.\tATOM\tis\ta\tREST- compliant\tspecification\tthat\tdefines\tsemantics\t(among\tother\tthings)\tfor\tpublishing\tfeeds of\tresources.\tMany\tclient\tlibraries\texist\tthat\tallow\tus\tto\tcreate\tand\tconsume\tthese\tfeeds. So\tour\tcustomer\tservice\tcould\tjust\tpublish\tan\tevent\tto\tsuch\ta\tfeed\twhen\tour\tcustomer service\tchanges.\tOur\tconsumers\tjust\tpoll\tthe\tfeed,\tlooking\tfor\tchanges.\tOn\tone\thand,\tthe fact\tthat\twe\tcan\treuse\tthe\texisting\tATOM\tspecification\tand\tany\tassociated\tlibraries\tis useful,\tand\twe\tknow\tthat\tHTTP\thandles\tscale\tvery\twell.\tHowever,\tHTTP\tis\tnot\tgood\tat low\tlatency\t(where\tsome\tmessage\tbrokers\texcel),\tand\twe\tstill\tneed\tto\tdeal\twith\tthe\tfact that\tthe\tconsumers\tneed\tto\tkeep\ttrack\tof\twhat\tmessages\tthey\thave\tseen\tand\tmanage\ttheir own\tpolling\tschedule.\n\nI\thave\tseen\tpeople\tspend\tan\tage\timplementing\tmore\tand\tmore\tof\tthe\tbehaviors\tthat\tyou get\tout\tof\tthe\tbox\twith\tan\tappropriate\tmessage\tbroker\tto\tmake\tATOM\twork\tfor\tsome\tuse cases.\tFor\texample,\tthe\tCompeting\tConsumer\tpattern\tdescribes\ta\tmethod\twhereby\tyou bring\tup\tmultiple\tworker\tinstances\tto\tcompete\tfor\tmessages,\twhich\tworks\twell\tfor\tscaling up\tthe\tnumber\tof\tworkers\tto\thandle\ta\tlist\tof\tindependent\tjobs.\tHowever,\twe\twant\tto\tavoid the\tcase\twhere\ttwo\tor\tmore\tworkers\tsee\tthe\tsame\tmessage,\tas\twe’ll\tend\tup\tdoing\tthe\tsame task\tmore\tthan\twe\tneed\tto.\tWith\ta\tmessage\tbroker,\ta\tstandard\tqueue\twill\thandle\tthis.\tWith ATOM,\twe\tnow\tneed\tto\tmanage\tour\town\tshared\tstate\tamong\tall\tthe\tworkers\tto\ttry\tto reduce\tthe\tchances\tof\treproducing\teffort.\n\nIf\tyou\talready\thave\ta\tgood,\tresilient\tmessage\tbroker\tavailable\tto\tyou,\tconsider\tusing\tit\tto handle\tpublishing\tand\tsubscribing\tto\tevents.\tBut\tif\tyou\tdon’t\talready\thave\tone,\tgive ATOM\ta\tlook,\tbut\tbe\taware\tof\tthe\tsunk-cost\tfallacy.\tIf\tyou\tfind\tyourself\twanting\tmore and\tmore\tof\tthe\tsupport\tthat\ta\tmessage\tbroker\tgives\tyou,\tat\ta\tcertain\tpoint\tyou\tmight\twant to\tchange\tyour\tapproach.\n\nIn\tterms\tof\twhat\twe\tactually\tsend\tover\tthese\tasynchronous\tprotocols,\tthe\tsame considerations\tapply\tas\twith\tsynchronous\tcommunication.\tIf\tyou\tare\tcurrently\thappy\twith encoding\trequests\tand\tresponses\tusing\tJSON,\tstick\twith\tit.\n\nComplexities\tof\tAsynchronous\tArchitectures\n\nSome\tof\tthis\tasynchronous\tstuff\tseems\tfun,\tright?\tEvent-driven\tarchitectures\tseem\tto\tlead to\tsignificantly\tmore\tdecoupled,\tscalable\tsystems.\tAnd\tthey\tcan.\tBut\tthese\tprogramming styles\tdo\tlead\tto\tan\tincrease\tin\tcomplexity.\tThis\tisn’t\tjust\tthe\tcomplexity\trequired\tto manage\tpublishing\tand\tsubscribing\tto\tmessages\tas\twe\tjust\tdiscussed,\tbut\talso\tin\tthe\tother problems\twe\tmight\tface.\tFor\texample,\twhen\tconsidering\tlong-running\tasync request/response,\twe\thave\tto\tthink\tabout\twhat\tto\tdo\twhen\tthe\tresponse\tcomes\tback.\tDoes it\tcome\tback\tto\tthe\tsame\tnode\tthat\tinitiated\tthe\trequest?\tIf\tso,\twhat\tif\tthat\tnode\tis\tdown? If\tnot,\tdo\tI\tneed\tto\tstore\tinformation\tsomewhere\tso\tI\tcan\treact\taccordingly?\tShort-lived async\tcan\tbe\teasier\tto\tmanage\tif\tyou’ve\tgot\tthe\tright\tAPIs,\tbut\teven\tso,\tit\tis\ta\tdifferent way\tof\tthinking\tfor\tprogrammers\twho\tare\taccustomed\tto\tintra-process\tsynchronous message\tcalls.\n\nTime\tfor\ta\tcautionary\ttale.\tBack\tin\t2006,\tI\twas\tworking\ton\tbuilding\ta\tpricing\tsystem\tfor\ta bank.\tWe\twould\tlook\tat\tmarket\tevents,\tand\twork\tout\twhich\titems\tin\ta\tportfolio\tneeded\tto be\trepriced.\tOnce\twe\tdetermined\tthe\tlist\tof\tthings\tto\twork\tthrough,\twe\tput\tthese\tall\tonto\ta message\tqueue.\tWe\twere\tmaking\tuse\tof\ta\tgrid\tto\tcreate\ta\tpool\tof\tpricing\tworkers, allowing\tus\tto\tscale\tup\tand\tdown\tthe\tpricing\tfarm\ton\trequest.\tThese\tworkers\tused\tthe competing\tconsumer\tpattern,\teach\tone\tgobbling\tmessages\tas\tfast\tas\tpossible\tuntil\tthere was\tnothing\tleft\tto\tprocess.\n\nThe\tsystem\twas\tup\tand\trunning,\tand\twe\twere\tfeeling\trather\tsmug.\tOne\tday,\tthough,\tjust after\twe\tpushed\ta\trelease\tout,\twe\thit\ta\tnasty\tproblem.\tOur\tworkers\tkept\tdying.\tAnd\tdying. And\tdying.\n\nEventually,\twe\ttracked\tdown\tthe\tproblem.\tA\tbug\thad\tcrept\tin\twhereby\ta\tcertain\ttype\tof pricing\trequest\twould\tcause\ta\tworker\tto\tcrash.\tWe\twere\tusing\ta\ttransacted\tqueue:\tas\tthe worker\tdied,\tits\tlock\ton\tthe\trequest\ttimed\tout,\tand\tthe\tpricing\trequest\twas\tput\tback\ton\tthe queue\t—\tonly\tfor\tanother\tworker\tto\tpick\tit\tup\tand\tdie.\tThis\twas\ta\tclassic\texample\tof\twhat Martin\tFowler\tcalls\ta\tcatastrophic\tfailover.\n\nAside\tfrom\tthe\tbug\titself,\twe’d\tfailed\tto\tspecify\ta\tmaximum\tretry\tlimit\tfor\tthe\tjob\ton\tthe queue.\tWe\tfixed\tthe\tbug\titself,\tand\talso\tconfigured\ta\tmaximum\tretry.\tBut\twe\talso\trealized we\tneeded\ta\tway\tto\tview,\tand\tpotentially\treplay,\tthese\tbad\tmessages.\tWe\tended\tup\thaving to\timplement\ta\tmessage\thospital\t(or\tdead\tletter\tqueue),\twhere\tmessages\tgot\tsent\tif\tthey failed.\tWe\talso\tcreated\ta\tUI\tto\tview\tthose\tmessages\tand\tretry\tthem\tif\tneeded.\tThese\tsorts of\tproblems\taren’t\timmediately\tobvious\tif\tyou\tare\tonly\tfamiliar\twith\tsynchronous\tpoint- to-point\tcommunication.\n\nThe\tassociated\tcomplexity\twith\tevent-driven\tarchitectures\tand\tasynchronous programming\tin\tgeneral\tleads\tme\tto\tbelieve\tthat\tyou\tshould\tbe\tcautious\tin\thow\teagerly you\tstart\tadopting\tthese\tideas.\tEnsure\tyou\thave\tgood\tmonitoring\tin\tplace,\tand\tstrongly consider\tthe\tuse\tof\tcorrelation\tIDs,\twhich\tallow\tyou\tto\ttrace\trequests\tacross\tprocess\n\nboundaries,\tas\twe’ll\tcover\tin\tdepth\tin\tChapter\t8.\n\nI\talso\tstrongly\trecommend\tEnterprise\tIntegration\tPatterns\t(Addison-Wesley),\twhich contains\ta\tlot\tmore\tdetail\ton\tthe\tdifferent\tprogramming\tpatterns\tthat\tyou\tmay\tneed\tto consider\tin\tthis\tspace.\n\nServices\tas\tState\tMachines\n\nWhether\tyou\tchoose\tto\tbecome\ta\tREST\tninja,\tor\tstick\twith\tan\tRPC-based\tmechanism\tlike SOAP,\tthe\tcore\tconcept\tof\tthe\tservice\tas\ta\tstate\tmachine\tis\tpowerful.\tWe’ve\tspoken before\t(probably\tad\tnauseum\tby\tthis\tpoint)\tabout\tour\tservices\tbeing\tfashioned\taround bounded\tcontexts.\tOur\tcustomer\tmicroservice\towns\tall\tlogic\tassociated\twith\tbehavior\tin this\tcontext.\n\nWhen\ta\tconsumer\twants\tto\tchange\ta\tcustomer,\tit\tsends\tan\tappropriate\trequest\tto\tthe customer\tservice.\tThe\tcustomer\tservice,\tbased\ton\tits\tlogic,\tgets\tto\tdecide\tif\tit\taccepts\tthat request\tor\tnot.\tOur\tcustomer\tservice\tcontrols\tall\tlifecycle\tevents\tassociated\twith\tthe customer\titself.\tWe\twant\tto\tavoid\tdumb,\tanemic\tservices\tthat\tare\tlittle\tmore\tthan\tCRUD wrappers.\tIf\tthe\tdecision\tabout\twhat\tchanges\tare\tallowed\tto\tbe\tmade\tto\ta\tcustomer\tleak out\tof\tthe\tcustomer\tservice\titself,\twe\tare\tlosing\tcohesion.\n\nHaving\tthe\tlifecycle\tof\tkey\tdomain\tconcepts\texplicitly\tmodeled\tlike\tthis\tis\tpretty powerful.\tNot\tonly\tdo\twe\thave\tone\tplace\tto\tdeal\twith\tcollisions\tof\tstate\t(e.g.,\tsomeone trying\tto\tupdate\ta\tcustomer\tthat\thas\talready\tbeen\tremoved),\tbut\twe\talso\thave\ta\tplace\tto attach\tbehavior\tbased\ton\tthose\tstate\tchanges.\n\nI\tstill\tthink\tthat\tREST\tover\tHTTP\tmakes\tfor\ta\tmuch\tmore\tsensible\tintegration\ttechnology than\tmany\tothers,\tbut\twhatever\tyou\tpick,\tkeep\tthis\tidea\tin\tmind.\n\nReactive\tExtensions\n\nReactive\textensions,\toften\tshortened\tto\tRx,\tare\ta\tmechanism\tto\tcompose\tthe\tresults\tof multiple\tcalls\ttogether\tand\trun\toperations\ton\tthem.\tThe\tcalls\tthemselves\tcould\tbe blocking\tor\tnonblocking\tcalls.\tAt\tits\theart,\tRx\tinverts\ttraditional\tflows.\tRather\tthan\tasking for\tsome\tdata,\tthen\tperforming\toperations\ton\tit,\tyou\tobserve\tthe\toutcome\tof\tan\toperation (or\tset\tof\toperations)\tand\treact\twhen\tsomething\tchanges.\tSome\timplementations\tof\tRx allow\tyou\tto\tperform\tfunctions\ton\tthese\tobservables,\tsuch\tas\tRxJava,\twhich\tallows traditional\tfunctions\tlike\tmap\tor\tfilter\tto\tbe\tused.\n\nThe\tvarious\tRx\timplementations\thave\tfound\ta\tvery\thappy\thome\tin\tdistributed\tsystems. They\tallow\tus\tto\tabstract\tout\tthe\tdetails\tof\thow\tcalls\tare\tmade,\tand\treason\tabout\tthings more\teasily.\tI\tobserve\tthe\tresult\tof\ta\tcall\tto\ta\tdownstream\tservice.\tI\tdon’t\tcare\tif\tit\twas\ta blocking\tor\tnonblocking\tcall,\tI\tjust\twait\tfor\tthe\tresponse\tand\treact.\tThe\tbeauty\tis\tthat\tI can\tcompose\tmultiple\tcalls\ttogether,\tmaking\thandling\tconcurrent\tcalls\tto\tdownstream services\tmuch\teasier.\n\nAs\tyou\tfind\tyourself\tmaking\tmore\tservice\tcalls,\tespecailly\twhen\tmaking\tmultiple\tcalls\tto perform\ta\tsingle\toperation,\ttake\ta\tlook\tat\tthe\treactive\textensions\tfor\tyour\tchosen technology\tstack.\tYou\tmay\tbe\tsurprised\thow\tmuch\tsimpler\tyour\tlife\tcan\tbecome.\n\nDRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta\tMicroservice\tWorld\n\nOne\tof\tthe\tacronyms\twe\tdevelopers\thear\ta\tlot\tis\tDRY:\tdon’t\trepeat\tyourself.\tThough\tits definition\tis\tsometimes\tsimplified\tas\ttrying\tto\tavoid\tduplicating\tcode,\tDRY\tmore accurately\tmeans\tthat\twe\twant\tto\tavoid\tduplicating\tour\tsystem\tbehavior\tand\tknowledge. This\tis\tvery\tsensible\tadvice\tin\tgeneral.\tHaving\tlots\tof\tlines\tof\tcode\tthat\tdo\tthe\tsame\tthing makes\tyour\tcodebase\tlarger\tthan\tneeded,\tand\ttherefore\tharder\tto\treason\tabout.\tWhen\tyou want\tto\tchange\tbehavior,\tand\tthat\tbehavior\tis\tduplicated\tin\tmany\tparts\tof\tyour\tsystem,\tit is\teasy\tto\tforget\teverywhere\tyou\tneed\tto\tmake\ta\tchange,\twhich\tcan\tlead\tto\tbugs.\tSo\tusing DRY\tas\ta\tmantra,\tin\tgeneral,\tmakes\tsense.\n\nDRY\tis\twhat\tleads\tus\tto\tcreate\tcode\tthat\tcan\tbe\treused.\tWe\tpull\tduplicated\tcode\tinto abstractions\tthat\twe\tcan\tthen\tcall\tfrom\tmultiple\tplaces.\tPerhaps\twe\tgo\tas\tfar\tas\tmaking\ta shared\tlibrary\tthat\twe\tcan\tuse\teverywhere!\tThis\tapproach,\thowever,\tcan\tbe\tdeceptively dangerous\tin\ta\tmicroservice\tarchitecture.\n\nOne\tof\tthe\tthings\twe\twant\tto\tavoid\tat\tall\tcosts\tis\toverly\tcoupling\ta\tmicroservice\tand consumers\tsuch\tthat\tany\tsmall\tchange\tto\tthe\tmicroservice\titself\tcan\tcause\tunnecessary changes\tto\tthe\tconsumer.\tSometimes,\thowever,\tthe\tuse\tof\tshared\tcode\tcan\tcreate\tthis\tvery coupling.\tFor\texample,\tat\tone\tclient\twe\thad\ta\tlibrary\tof\tcommon\tdomain\tobjects\tthat represented\tthe\tcore\tentities\tin\tuse\tin\tour\tsystem.\tThis\tlibrary\twas\tused\tby\tall\tthe\tservices we\thad.\tBut\twhen\ta\tchange\twas\tmade\tto\tone\tof\tthem,\tall\tservices\thad\tto\tbe\tupdated.\tOur system\tcommunicated\tvia\tmessage\tqueues,\twhich\talso\thad\tto\tbe\tdrained\tof\ttheir\tnow invalid\tcontents,\tand\twoe\tbetide\tyou\tif\tyou\tforgot.\n\nIf\tyour\tuse\tof\tshared\tcode\tever\tleaks\toutside\tyour\tservice\tboundary,\tyou\thave\tintroduced\ta potential\tform\tof\tcoupling.\tUsing\tcommon\tcode\tlike\tlogging\tlibraries\tis\tfine,\tas\tthey\tare internal\tconcepts\tthat\tare\tinvisible\tto\tthe\toutside\tworld.\tRealEstate.com.au\tmakes\tuse\tof\ta tailored\tservice\ttemplate\tto\thelp\tbootstrap\tnew\tservice\tcreation.\tRather\tthan\tmake\tthis code\tshared,\tthe\tcompany\tcopies\tit\tfor\tevery\tnew\tservice\tto\tensure\tthat\tcoupling\tdoesn’t leak\tin.\n\nMy\tgeneral\trule\tof\tthumb:\tdon’t\tviolate\tDRY\twithin\ta\tmicroservice,\tbut\tbe\trelaxed\tabout violating\tDRY\tacross\tall\tservices.\tThe\tevils\tof\ttoo\tmuch\tcoupling\tbetween\tservices\tare\tfar worse\tthan\tthe\tproblems\tcaused\tby\tcode\tduplication.\tThere\tis\tone\tspecific\tuse\tcase\tworth exploring\tfurther,\tthough.\n\nClient\tLibraries\n\nI’ve\tspoken\tto\tmore\tthan\tone\tteam\twho\thas\tinsisted\tthat\tcreating\tclient\tlibraries\tfor\tyour services\tis\tan\tessential\tpart\tof\tcreating\tservices\tin\tthe\tfirst\tplace.\tThe\targument\tis\tthat\tthis makes\tit\teasy\tto\tuse\tyour\tservice,\tand\tavoids\tthe\tduplication\tof\tcode\trequired\tto\tconsume the\tservice\titself.\n\nThe\tproblem,\tof\tcourse,\tis\tthat\tif\tthe\tsame\tpeople\tcreate\tboth\tthe\tserver\tAPI\tand\tthe\tclient API,\tthere\tis\tthe\tdanger\tthat\tlogic\tthat\tshould\texist\ton\tthe\tserver\tstarts\tleaking\tinto\tthe client.\tI\tshould\tknow:\tI’ve\tdone\tthis\tmyself.\tThe\tmore\tlogic\tthat\tcreeps\tinto\tthe\tclient library,\tthe\tmore\tcohesion\tstarts\tto\tbreak\tdown,\tand\tyou\tfind\tyourself\thaving\tto\tchange multiple\tclients\tto\troll\tout\tfixes\tto\tyour\tserver.\tYou\talso\tlimit\ttechnology\tchoices, especially\tif\tyou\tmandate\tthat\tthe\tclient\tlibrary\thas\tto\tbe\tused.\n\nA\tmodel\tfor\tclient\tlibraries\tI\tlike\tis\tthe\tone\tfor\tAmazon\tWeb\tServices\t(AWS).\tThe underlying\tSOAP\tor\tREST\tweb\tservice\tcalls\tcan\tbe\tmade\tdirectly,\tbut\teveryone\tends\tup using\tjust\tone\tof\tthe\tvarious\tsoftware\tdevelopment\tkits\t(SDKs)\tthat\texist,\twhich\tprovide abstractions\tover\tthe\tunderlying\tAPI.\tThese\tSDKs,\tthough,\tare\twritten\tby\tthe\tcommunity or\tAWS\tpeople\tother\tthan\tthose\twho\twork\ton\tthe\tAPI\titself.\tThis\tdegree\tof\tseparation seems\tto\twork,\tand\tavoids\tsome\tof\tthe\tpitfalls\tof\tclient\tlibraries.\tPart\tof\tthe\treason\tthis works\tso\twell\tis\tthat\tthe\tclient\tis\tin\tcharge\tof\twhen\tthe\tupgrade\thappens.\tIf\tyou\tgo\tdown the\tpath\tof\tclient\tlibraries\tyourself,\tmake\tsure\tthis\tis\tthe\tcase.\n\nNetflix\tin\tparticular\tplaces\tspecial\temphasis\ton\tthe\tclient\tlibrary,\tbut\tI\tworry\tthat\tpeople view\tthat\tpurely\tthrough\tthe\tlens\tof\tavoiding\tcode\tduplication.\tIn\tfact,\tthe\tclient\tlibraries used\tby\tNetflix\tare\tas\tmuch\t(if\tnot\tmore)\tabout\tensuring\treliability\tand\tscalability\tof\ttheir systems.\tThe\tNetflix\tclient\tlibraries\thandle\tservice\tdiscovery,\tfailure\tmodes,\tlogging,\tand other\taspects\tthat\taren’t\tactually\tabout\tthe\tnature\tof\tthe\tservice\titself.\tWithout\tthese shared\tclients,\tit\twould\tbe\thard\tto\tensure\tthat\teach\tpiece\tof\tclient/server\tcommunications behaved\twell\tat\tthe\tmassive\tscale\tat\twhich\tNetflix\toperates.\tTheir\tuse\tat\tNetflix\thas certainly\tmade\tit\teasy\tto\tget\tup\tand\trunning\tand\tincreased\tproductivity\twhile\talso ensuring\tthe\tsystem\tbehaves\twell.\tHowever,\taccording\tto\tat\tleast\tone\tperson\tat\tNetflix, over\ttime\tthis\thas\tled\tto\ta\tdegree\tof\tcoupling\tbetween\tclient\tand\tserver\tthat\thas\tbeen problematic.\n\nIf\tthe\tclient\tlibrary\tapproach\tis\tsomething\tyou’re\tthinking\tabout,\tit\tcan\tbe\timportant\tto separate\tout\tclient\tcode\tto\thandle\tthe\tunderlying\ttransport\tprotocol,\twhich\tcan\tdeal\twith things\tlike\tservice\tdiscovery\tand\tfailure,\tfrom\tthings\trelated\tto\tthe\tdestination\tservice itself.\tDecide\twhether\tor\tnot\tyou\tare\tgoing\tto\tinsist\ton\tthe\tclient\tlibrary\tbeing\tused,\tor\tif you’ll\tallow\tpeople\tusing\tdifferent\ttechnology\tstacks\tto\tmake\tcalls\tto\tthe\tunderlying\tAPI. And\tfinally,\tmake\tsure\tthat\tthe\tclients\tare\tin\tcharge\tof\twhen\tto\tupgrade\ttheir\tclient libraries:\twe\tneed\tto\tensure\twe\tmaintain\tthe\tability\tto\trelease\tour\tservices\tindependently of\teach\tother!\n\nAccess\tby\tReference\n\nOne\tconsideration\tI\twant\tto\ttouch\ton\tis\thow\twe\tpass\taround\tinformation\tabout\tour domain\tentities.\tWe\tneed\tto\tembrace\tthe\tidea\tthat\ta\tmicroservice\twill\tencompass\tthe lifecycle\tof\tour\tcore\tdomain\tentities,\tlike\tthe\tCustomer.\tWe’ve\talready\ttalked\tabout\tthe importance\tof\tthe\tlogic\tassociated\twith\tchanging\tthis\tCustomer\tbeing\theld\tin\tthe\tcustomer service,\tand\tthat\tif\twe\twant\tto\tchange\tit\twe\thave\tto\tissue\ta\trequest\tto\tthe\tcustomer\tservice. But\tit\talso\tfollows\tthat\twe\tshould\tconsider\tthe\tcustomer\tservice\tas\tbeing\tthe\tsource\tof truth\tfor\tCustomers.\n\nWhen\twe\tretrieve\ta\tgiven\tCustomer\tresource\tfrom\tthe\tcustomer\tservice,\twe\tget\tto\tsee what\tthat\tresource\tlooked\tlike\twhen\twe\tmade\tthe\trequest.\tIt\tis\tpossible\tthat\tafter\twe requested\tthat\tCustomer\tresource,\tsomething\telse\thas\tchanged\tit.\tWhat\twe\thave\tin\teffect is\ta\tmemory\tof\twhat\tthe\tCustomer\tresource\tonce\tlooked\tlike.\tThe\tlonger\twe\thold\ton\tto this\tmemory,\tthe\thigher\tthe\tchance\tthat\tthis\tmemory\twill\tbe\tfalse.\tOf\tcourse,\tif\twe\tavoid requesting\tdata\tmore\tthan\twe\tneed\tto,\tour\tsystems\tcan\tbecome\tmuch\tmore\tefficient.\n\nSometimes\tthis\tmemory\tis\tgood\tenough.\tOther\ttimes\tyou\tneed\tto\tknow\tif\tit\thas\tchanged. So\twhether\tyou\tdecide\tto\tpass\taround\ta\tmemory\tof\twhat\tan\tentity\tonce\tlooked\tlike,\tmake sure\tyou\talso\tinclude\ta\treference\tto\tthe\toriginal\tresource\tso\tthat\tthe\tnew\tstate\tcan\tbe retrieved.\n\nLet’s\tconsider\tthe\texample\twhere\twe\task\tthe\temail\tservice\tto\tsend\tan\temail\twhen\tan\torder has\tbeen\tshipped.\tNow\twe\tcould\tsend\tin\tthe\trequest\tto\tthe\temail\tservice\twith\tthe customer’s\temail\taddress,\tname,\tand\torder\tdetails.\tHowever,\tif\tthe\temail\tservice\tis actually\tqueuing\tup\tthese\trequests,\tor\tpulling\tthem\tfrom\ta\tqueue,\tthings\tcould\tchange\tin the\tmeantime.\tIt\tmight\tmake\tmore\tsense\tto\tjust\tsend\ta\tURI\tfor\tthe\tCustomer\tand\tOrder resources,\tand\tlet\tthe\temail\tserver\tgo\tlook\tthem\tup\twhen\tit\tis\ttime\tto\tsend\tthe\temail.\n\nA\tgreat\tcounterpoint\tto\tthis\temerges\twhen\twe\tconsider\tevent-based\tcollaboration.\tWith events,\twe’re\tsaying\tthis\thappened,\tbut\twe\tneed\tto\tknow\twhat\thappened.\tIf\twe’re receiving\tupdates\tdue\tto\ta\tCustomer\tresource\tchanging,\tfor\texample,\tit\tcould\tbe\tvaluable to\tus\tto\tknow\twhat\tthe\tCustomer\tlooked\tlike\twhen\tthe\tevent\toccurred.\tAs\tlong\tas\twe\talso get\ta\treference\tto\tthe\tentity\titself\tso\twe\tcan\tlook\tup\tits\tcurrent\tstate,\tthen\twe\tcan\tget\tthe best\tof\tboth\tworlds.\n\nThere\tare\tother\ttrade-offs\tto\tbe\tmade\there,\tof\tcourse,\twhen\twe’re\taccessing\tby\treference. If\twe\talways\tgo\tto\tthe\tcustomer\tservice\tto\tlook\tat\tthe\tinformation\tassociated\twith\ta\tgiven Customer,\tthe\tload\ton\tthe\tcustomer\tservice\tcan\tbe\ttoo\tgreat.\tIf\twe\tprovide\tadditional information\twhen\tthe\tresource\tis\tretrieved,\tletting\tus\tknow\tat\twhat\ttime\tthe\tresource\twas in\tthe\tgiven\tstate\tand\tperhaps\thow\tlong\twe\tcan\tconsider\tthis\tinformation\tto\tbe\tfresh,\tthen we\tcan\tdo\ta\tlot\twith\tcaching\tto\treduce\tload.\tHTTP\tgives\tus\tmuch\tof\tthis\tsupport\tout\tof the\tbox\twith\ta\twide\tvariety\tof\tcache\tcontrols,\tsome\tof\twhich\twe’ll\tdiscuss\tin\tmore\tdetail\n\nin\tChapter\t11.\n\nAnother\tproblem\tis\tthat\tsome\tof\tour\tservices\tmight\tnot\tneed\tto\tknow\tabout\tthe\twhole Customer\tresource,\tand\tby\tinsisting\tthat\tthey\tgo\tlook\tit\tup\twe\tare\tpotentially\tincreasing coupling.\tIt\tcould\tbe\targued,\tfor\texample,\tthat\tour\temail\tservice\tshould\tbe\tmore\tdumb, and\tthat\twe\tshould\tjust\tsend\tit\tthe\temail\taddress\tand\tname\tof\tthe\tcustomer.\tThere\tisn’t\ta hard-and-fast\trule\there,\tbut\tbe\tvery\twary\tof\tpassing\taround\tdata\tin\trequests\twhen\tyou don’t\tknow\tits\tfreshness.\n\nVersioning\n\nIn\tevery\tsingle\ttalk\tI\thave\tever\tdone\tabout\tmicroservices,\tI\tget\tasked\thow\tdo\tyou\tdo versioning?\tPeople\thave\tthe\tlegitimate\tconcern\tthat\teventually\tthey\twill\thave\tto\tmake\ta change\tto\tthe\tinterface\tof\ta\tservice,\tand\tthey\twant\tto\tunderstand\thow\tto\tmanage\tthat.\tLet’s break\tdown\tthe\tproblem\ta\tbit\tand\tlook\tat\tthe\tvarious\tsteps\twe\tcan\ttake\tto\thandle\tit.\n\nDefer\tIt\tfor\tas\tLong\tas\tPossible\n\nThe\tbest\tway\tto\treduce\tthe\timpact\tof\tmaking\tbreaking\tchanges\tis\tto\tavoid\tmaking\tthem\tin the\tfirst\tplace.\tYou\tcan\tachieve\tmuch\tof\tthis\tby\tpicking\tthe\tright\tintegration\ttechnology, as\twe’ve\tdiscussed\tthroughout\tthis\tchapter.\tDatabase\tintegration\tis\ta\tgreat\texample\tof technology\tthat\tcan\tmake\tit\tvery\thard\tto\tavoid\tbreaking\tchanges.\tREST,\ton\tthe\tother hand,\thelps\tbecause\tchanges\tto\tinternal\timplementation\tdetail\tare\tless\tlikely\tto\tresult\tin\ta change\tto\tthe\tservice\tinterface.\n\nAnother\tkey\tto\tdeferring\ta\tbreaking\tchange\tis\tto\tencourage\tgood\tbehavior\tin\tyour\tclients, and\tavoid\tthem\tbinding\ttoo\ttightly\tto\tyour\tservices\tin\tthe\tfirst\tplace.\tLet’s\tconsider\tour email\tservice,\twhose\tjob\tit\tis\tto\tsend\tout\temails\tto\tour\tcustomers\tfrom\ttime\tto\ttime.\tIt\tgets asked\tto\tsend\tan\torder\tshipped\temail\tto\tcustomer\twith\tthe\tID\t1234.\tIt\tgoes\toff\tand retrieves\tthe\tcustomer\twith\tthat\tID,\tand\tgets\tback\tsomething\tlike\tthe\tresponse\tshown\tin Example\t4-3.\n\nExample\t4-3.\tSample\tresponse\tfrom\tthe\tcustomer\tservice <customer> \t\t<firstname>Sam</firstname> \t\t<lastname>Newman</lastname> \t\t<email>sam@magpiebrain.com</email> \t\t<telephoneNumber>555-1234-5678</telephoneNumber> </customer>\n\nNow\tto\tsend\tthe\temail,\twe\tneed\tonly\tthe\tfirstname,\tlastname,\tand\temail\tfields.\tWe don’t\tneed\tto\tknow\tthe\ttelephoneNumber.\tWe\twant\tto\tsimply\tpull\tout\tthose\tfields\twe\tcare about,\tand\tignore\tthe\trest.\tSome\tbinding\ttechnology,\tespecially\tthat\tused\tby\tstrongly typed\tlanguages,\tcan\tattempt\tto\tbind\tall\tfields\twhether\tthe\tconsumer\twants\tthem\tor\tnot. What\thappens\tif\twe\trealize\tthat\tno\tone\tis\tusing\tthe\ttelephoneNumber\tand\twe\tdecide\tto remove\tit?\tThis\tcould\tcause\tconsumers\tto\tbreak\tneedlessly.\n\nLikewise,\twhat\tif\twe\twanted\tto\trestructure\tour\tCustomer\tobject\tto\tsupport\tmore\tdetails, perhaps\tadding\tsome\tfurther\tstructure\tas\tin\tExample\t4-4?\tThe\tdata\tour\temail\tservice wants\tis\tstill\tthere,\tand\tstill\twith\tthe\tsame\tname,\tbut\tif\tour\tcode\tmakes\tvery\texplicit assumptions\tas\tto\twhere\tthe\tfirstname\tand\tlastname\tfields\twill\tbe\tstored,\tthen\tit\tcould break\tagain.\tIn\tthis\tinstance,\twe\tcould\tinstead\tuse\tXPath\tto\tpull\tout\tthe\tfields\twe\tcare about,\tallowing\tus\tto\tbe\tambivalent\tabout\twhere\tthe\tfields\tare,\tas\tlong\tas\twe\tcan\tfind them.\tThis\tpattern\t—\tof\timplementing\ta\treader\table\tto\tignore\tchanges\twe\tdon’t\tcare\tabout —\tis\twhat\tMartin\tFowler\tcalls\ta\tTolerant\tReader.\n\nExample\t4-4.\tA\trestructured\tCustomer\tresource:\tthe\tdata\tis\tall\tstill\tthere,\tbut\tcan\tour consumers\tfind\tit? <customer> \t\t<naming> \t\t\t\t<firstname>Sam</firstname> \t\t\t\t<lastname>Newman</lastname> \t\t\t\t<nickname>Magpiebrain</nickname> \t\t\t\t<fullname>Sam\t\"Magpiebrain\"\tNewman</fullname> \t\t</naming> \t\t<email>sam@magpiebrain.com</email>\n\n</customer>\n\nThe\texample\tof\ta\tclient\ttrying\tto\tbe\tas\tflexible\tas\tpossible\tin\tconsuming\ta\tservice demonstrates\tPostel’s\tLaw\t(otherwise\tknown\tas\tthe\trobustness\tprinciple),\twhich\tstates: “Be\tconservative\tin\twhat\tyou\tdo,\tbe\tliberal\tin\twhat\tyou\taccept\tfrom\tothers.”\tThe\toriginal context\tfor\tthis\tpiece\tof\twisdom\twas\tthe\tinteraction\tof\tdevices\tover\tnetworks,\twhere\tyou should\texpect\tall\tsorts\tof\todd\tthings\tto\thappen.\tIn\tthe\tcontext\tof\tour\trequest/response interaction,\tit\tcan\tlead\tus\tto\ttry\tour\tbest\tto\tallow\tthe\tservice\tbeing\tconsumed\tto\tchange without\trequiring\tus\tto\tchange.\n\nCatch\tBreaking\tChanges\tEarly\n\nIt’s\tcrucial\tto\tmake\tsure\twe\tpick\tup\tchanges\tthat\twill\tbreak\tconsumers\tas\tsoon\tas\tpossible, because\teven\tif\twe\tchoose\tthe\tbest\tpossible\ttechnology,\tbreaks\tcan\tstill\thappen.\tI\tam strongly\tin\tfavor\tof\tusing\tconsumer-driven\tcontracts,\twhich\twe’ll\tcover\tin\tChapter\t7,\tto help\tspot\tthese\tproblems\tearly\ton.\tIf\tyou’re\tsupporting\tmultiple\tdifferent\tclient\tlibraries, running\ttests\tusing\teach\tlibrary\tyou\tsupport\tagainst\tthe\tlatest\tservice\tis\tanother\ttechnique that\tcan\thelp.\tOnce\tyou\trealize\tyou\tare\tgoing\tto\tbreak\ta\tconsumer,\tyou\thave\tthe\tchoice\tto either\ttry\tto\tavoid\tthe\tbreak\taltogether\tor\telse\tembrace\tit\tand\tstart\thaving\tthe\tright conversations\twith\tthe\tpeople\tlooking\tafter\tthe\tconsuming\tservices.\n\nUse\tSemantic\tVersioning\n\nWouldn’t\tit\tbe\tgreat\tif\tas\ta\tclient\tyou\tcould\tlook\tjust\tat\tthe\tversion\tnumber\tof\ta\tservice and\tknow\tif\tyou\tcan\tintegrate\twith\tit?\tSemantic\tversioning\tis\ta\tspecification\tthat\tallows just\tthat.\tWith\tsemantic\tversioning,\teach\tversion\tnumber\tis\tin\tthe\tform MAJOR.MINOR.PATCH.\tWhen\tthe\tMAJOR\tnumber\tincrements,\tit\tmeans\tthat\tbackward incompatible\tchanges\thave\tbeen\tmade.\tWhen\tMINOR\tincrements,\tnew\tfunctionality\thas been\tadded\tthat\tshould\tbe\tbackward\tcompatible.\tFinally,\ta\tchange\tto\tPATCH\tstates\tthat\tbug fixes\thave\tbeen\tmade\tto\texisting\tfunctionality.\n\nTo\tsee\thow\tuseful\tsemantic\tversioning\tcan\tbe,\tlet’s\tlook\tat\ta\tsimple\tuse\tcase.\tOur helpdesk\tapplication\tis\tbuilt\tto\twork\tagainst\tversion\t1.2.0\tof\tthe\tcustomer\tservice.\tIf\ta new\tfeature\tis\tadded,\tcausing\tthe\tcustomer\tservice\tto\tchange\tto\t1.3.0,\tour\thelpdesk application\tshould\tsee\tno\tchange\tin\tbehavior\tand\tshouldn’t\tbe\texpected\tto\tmake\tany changes.\tWe\tcouldn’t\tguarantee\tthat\twe\tcould\twork\tagainst\tversion\t1.1.0\tof\tthe\tcustomer service,\tthough,\tas\twe\tmay\trely\ton\tfunctionality\tadded\tin\tthe\t1.2.0\trelease.\tWe\tcould\talso expect\tto\thave\tto\tmake\tchanges\tto\tour\tapplication\tif\ta\tnew\t2.0.0\trelease\tof\tthe\tcustomer service\tcomes\tout.\n\nYou\tmay\tdecide\tto\thave\ta\tsemantic\tversion\tfor\tthe\tservice,\tor\teven\tfor\tan\tindividual endpoint\ton\ta\tservice\tif\tyou\tare\tcoexisting\tthem\tas\tdetailed\tin\tthe\tnext\tsection.\n\nThis\tversioning\tscheme\tallows\tus\tto\tpack\ta\tlot\tof\tinformation\tand\texpectations\tinto\tjust three\tfields.\tThe\tfull\tspecification\toutlines\tin\tvery\tsimple\tterms\tthe\texpectations\tclients can\thave\tof\tchanges\tto\tthese\tnumbers,\tand\tcan\tsimplify\tthe\tprocess\tof\tcommunicating about\twhether\tchanges\tshould\timpact\tconsumers.\tUnfortunately,\tI\thaven’t\tsee\tthis approach\tused\tenough\tin\tthe\tcontext\tof\tdistributed\tsystems.\n\nCoexist\tDifferent\tEndpoints\n\nIf\twe’ve\tdone\tall\twe\tcan\tto\tavoid\tintroducing\ta\tbreaking\tinterface\tchange,\tour\tnext\tjob\tis to\tlimit\tthe\timpact.\tThe\tthing\twe\twant\tto\tavoid\tis\tforcing\tconsumers\tto\tupgrade\tin\tlock- step\twith\tus,\tas\twe\talways\twant\tto\tmaintain\tthe\tability\tto\trelease\tmicroservices independently\tof\teach\tother.\tOne\tapproach\tI\thave\tused\tsuccessfully\tto\thandle\tthis\tis\tto coexist\tboth\tthe\told\tand\tnew\tinterfaces\tin\tthe\tsame\trunning\tservice.\tSo\tif\twe\twant\tto release\ta\tbreaking\tchange,\twe\tdeploy\ta\tnew\tversion\tof\tthe\tservice\tthat\texposes\tboth\tthe old\tand\tnew\tversions\tof\tthe\tendpoint.\n\nThis\tallows\tus\tto\tget\tthe\tnew\tmicroservice\tout\tas\tsoon\tas\tpossible,\talong\twith\tthe\tnew interface,\tbut\tgive\ttime\tfor\tconsumers\tto\tmove\tover.\tOnce\tall\tof\tthe\tconsumers\tare\tno longer\tusing\tthe\told\tendpoint,\tyou\tcan\tremove\tit\talong\twith\tany\tassociated\tcode,\tas\tshown in\tFigure\t4-5.\n\nFigure\t4-5.\tCoexisting\tdifferent\tendpoint\tversions\tallows\tconsumers\tto\tmigrate\tgradually\n\nWhen\tI\tlast\tused\tthis\tapproach,\twe\thad\tgotten\tourselves\tinto\ta\tbit\tof\ta\tmess\twith\tthe number\tof\tconsumers\twe\thad\tand\tthe\tnumber\tof\tbreaking\tchanges\twe\thad\tmade.\tThis meant\tthat\twe\twere\tactually\tcoexisting\tthree\tdifferent\tversions\tof\tthe\tendpoint.\tThis\tis\tnot something\tI’d\trecommend!\tKeeping\tall\tthe\tcode\taround\tand\tthe\tassociated\ttesting required\tto\tensure\tthey\tall\tworked\twas\tabsolutely\tan\tadditional\tburden.\tTo\tmake\tthis\tmore manageable,\twe\tinternally\ttransformed\tall\trequests\tto\tthe\tV1\tendpoint\tto\ta\tV2\trequest, and\tthen\tV2\trequests\tto\tthe\tV3\tendpoint.\tThis\tmeant\twe\tcould\tclearly\tdelineate\twhat\tcode was\tgoing\tto\tbe\tretired\twhen\tthe\told\tendpoint(s)\tdied.\n\nThis\tis\tin\teffect\tan\texample\tof\tthe\texpand\tand\tcontract\tpattern,\twhich\tallows\tus\tto\tphase breaking\tchanges\tin.\tWe\texpand\tthe\tcapabilities\twe\toffer,\tsupporting\tboth\told\tand\tnew\n\nways\tof\tdoing\tsomething.\tOnce\tthe\told\tconsumers\tdo\tthings\tin\tthe\tnew\tway,\twe\tcontract our\tAPI,\tremoving\tthe\told\tfunctionality.\n\nIf\tyou\tare\tgoing\tto\tcoexist\tendpoints,\tyou\tneed\ta\tway\tfor\tcallers\tto\troute\ttheir\trequests accordingly.\tFor\tsystems\tmaking\tuse\tof\tHTTP,\tI\thave\tseen\tthis\tdone\twith\tboth\tversion numbers\tin\trequest\theaders\tand\talso\tin\tthe\tURI\titself\t—\tfor\texample,\t/v1/customer/\tor /v2/customer/.\tI’m\ttorn\tas\tto\twhich\tapproach\tmakes\tthe\tmost\tsense.\tOn\tthe\tone\thand,\tI like\tURIs\tbeing\topaque\tto\tdiscourage\tclients\tfrom\thardcoding\tURI\ttemplates,\tbut\ton\tthe other\thand,\tthis\tapproach\tdoes\tmake\tthings\tvery\tobvious\tand\tcan\tsimplify\trequest\trouting.\n\nFor\tRPC,\tthings\tcan\tbe\ta\tlittle\ttrickier.\tI\thave\thandled\tthis\twith\tprotocol\tbuffers\tby\tputting my\tmethods\tin\tdifferent\tnamespaces\t—\tfor\texample,\tv1.createCustomer\tand v2.createCustomer\t—\tbut\twhen\tyou\tare\ttrying\tto\tsupport\tdifferent\tversions\tof\tthe\tsame types\tbeing\tsent\tover\tthe\tnetwork,\tthis\tcan\tbecome\treally\tpainful.\n\nUse\tMultiple\tConcurrent\tService\tVersions\n\nAnother\tversioning\tsolution\toften\tcited\tis\tto\thave\tdifferent\tversions\tof\tthe\tservice\tlive\tat once,\tand\tfor\tolder\tconsumers\tto\troute\ttheir\ttraffic\tto\tthe\tolder\tversion,\twith\tnewer versions\tseeing\tthe\tnew\tone,\tas\tshown\tin\tFigure\t4-6.\tThis\tis\tthe\tapproach\tused\tsparingly by\tNetflix\tin\tsituations\twhere\tthe\tcost\tof\tchanging\tolder\tconsumers\tis\ttoo\thigh,\tespecially in\trare\tcases\twhere\tlegacy\tdevices\tare\tstill\ttied\tto\tolder\tversions\tof\tthe\tAPI.\tPersonally,\tI am\tnot\ta\tfan\tof\tthis\tidea,\tand\tunderstand\twhy\tNetflix\tuses\tit\trarely.\tFirst,\tif\tI\tneed\tto\tfix\tan internal\tbug\tin\tmy\tservice,\tI\tnow\thave\tto\tfix\tand\tdeploy\ttwo\tdifferent\tsets\tof\tservices. This\twould\tprobably\tmean\tI\thave\tto\tbranch\tthe\tcodebase\tfor\tmy\tservice,\tand\tthis\tis always\tproblematic.\tSecond,\tit\tmeans\tI\tneed\tsmarts\tto\thandle\tdirecting\tconsumers\tto\tthe right\tmicroservice.\tThis\tbehavior\tinevitably\tends\tup\tsitting\tin\tmiddleware\tsomewhere\tor\ta bunch\tof\tnginx\tscripts,\tmaking\tit\tharder\tto\treason\tabout\tthe\tbehavior\tof\tthe\tsystem. Finally,\tconsider\tany\tpersistent\tstate\tour\tservice\tmight\tmanage.\tCustomers\tcreated\tby either\tversion\tof\tthe\tservice\tneed\tto\tbe\tstored\tand\tmade\tvisible\tto\tall\tservices,\tno\tmatter which\tversion\twas\tused\tto\tcreate\tthe\tdata\tin\tthe\tfirst\tplace.\tThis\tcan\tbe\tan\tadditional source\tof\tcomplexity.\n\nFigure\t4-6.\tRunning\tmultiple\tversions\tof\tthe\tsame\tservice\tto\tsupport\told\tendpoints\n\nCoexisting\tconcurrent\tservice\tversions\tfor\ta\tshort\tperiod\tof\ttime\tcan\tmake\tperfect\tsense, especially\twhen\tyou’re\tdoing\tthings\tlike\tblue/green\tdeployments\tor\tcanary\treleases\t(we’ll be\tdiscussing\tthese\tpatterns\tmore\tin\tChapter\t7).\tIn\tthese\tsituations,\twe\tmay\tbe\tcoexisting versions\tonly\tfor\ta\tfew\tminutes\tor\tperhaps\thours,\tand\tnormally\twill\thave\tonly\ttwo different\tversions\tof\tthe\tservice\tpresent\tat\tthe\tsame\ttime.\tThe\tlonger\tit\ttakes\tfor\tyou\tto\tget consumers\tupgraded\tto\tthe\tnewer\tversion\tand\treleased,\tthe\tmore\tyou\tshould\tlook\tto coexist\tdifferent\tendpoints\tin\tthe\tsame\tmicroservice\trather\tthan\tcoexist\tentirely\tdifferent versions.\tI\tremain\tunconvinced\tthat\tthis\twork\tis\tworthwhile\tfor\tthe\taverage\tproject.\n\nUser\tInterfaces\n\nSo\tfar,\twe\thaven’t\treally\ttouched\ton\tthe\tworld\tof\tthe\tuser\tinterface.\tA\tfew\tof\tyou\tout\tthere might\tjust\tbe\tproviding\ta\tcold,\thard,\tclinical\tAPI\tto\tyour\tcustomers,\tbut\tmany\tof\tus\tfind ourselves\twanting\tto\tcreate\tbeautiful,\tfunctional\tuser\tinterfaces\tthat\twill\tdelight\tour customers.\tBut\twe\treally\tdo\tneed\tto\tthink\tabout\tthem\tin\tthe\tcontext\tof\tintegration.\tThe user\tinterface,\tafter\tall,\tis\twhere\twe’ll\tbe\tpulling\tall\tthese\tmicroservices\ttogether\tinto something\tthat\tmakes\tsense\tto\tour\tcustomers.\n\nIn\tthe\tpast,\twhen\tI\tfirst\tstarted\tcomputing,\twe\twere\tmostly\ttalking\tabout\tbig,\tfat\tclients that\tran\ton\tour\tdesktops.\tI\tspent\tmany\thours\twith\tMotif\tand\tthen\tSwing\ttrying\tto\tmake my\tsoftware\tas\tnice\tto\tuse\tas\tpossible.\tOften\tthese\tsystems\twere\tjust\tfor\tthe\tcreation\tand manipulation\tof\tlocal\tfiles,\tbut\tmany\tof\tthem\thad\ta\tserver-side\tcomponent.\tMy\tfirst\tjob\tat ThoughtWorks\tinvolved\tcreating\ta\tSwing-based\telectronic\tpoint-of-sale\tsystem\tthat\twas just\tpart\tof\ta\tlarge\tnumber\tof\tmoving\tparts,\tmost\tof\twhich\twere\ton\tthe\tserver.\n\nThen\tcame\tthe\tWeb.\tWe\tstarted\tthinking\tof\tour\tUIs\tas\tbeing\tthin\tinstead,\twith\tmore\tlogic on\tthe\tserver\tside.\tIn\tthe\tbeginning,\tour\tserver-side\tprograms\trendered\tthe\tentire\tpage\tand sent\tit\tto\tthe\tclient\tbrowser,\twhich\tdid\tvery\tlittle.\tAny\tinteractions\twere\thandled\ton\tthe server\tside,\tvia\tGETs\tand\tPOSTs\ttriggered\tby\tthe\tuser\tclicking\ton\tlinks\tor\tfilling\tin\tforms. Over\ttime,\tJavaScript\tbecame\ta\tmore\tpopular\toption\tto\tadd\tdynamic\tbehavior\tto\tthe browser-based\tUI,\tand\tsome\tapplications\tcould\tnow\tbe\targued\tto\tbe\tas\tfat\tas\tthe\told desktop\tclients.\n\nToward\tDigital\n\nOver\tthe\tlast\tcouple\tof\tyears,\torganizations\thave\tstarted\tto\tmove\taway\tfrom\tthinking\tthat web\tor\tmobile\tshould\tbe\ttreated\tdifferently;\tthey\tare\tinstead\tthinking\tabout\tdigital\tmore holistically.\tWhat\tis\tthe\tbest\tway\tfor\tour\tcustomers\tto\tuse\tthe\tservices\twe\toffer?\tAnd\twhat does\tthat\tdo\tto\tour\tsystem\tarchitecture?\tThe\tunderstanding\tthat\twe\tcannot\tpredict\texactly how\ta\tcustomer\tmight\tend\tup\tinteracting\twith\tour\tcompany\thas\tdriven\tadoption\tof\tmore granular\tAPIs,\tlike\tthose\tdelivered\tby\tmicroservices.\tBy\tcombining\tthe\tcapabilities\tour services\texpose\tin\tdifferent\tways,\twe\tcan\tcurate\tdifferent\texperiences\tfor\tour\tcustomers on\ttheir\tdesktop\tapplication,\tmobile\tdevice,\twearable\tdevice,\tor\teven\tin\tphysical\tform\tif they\tvisit\tour\tbrick-and-mortar\tstore.\n\nSo\tthink\tof\tuser\tinterfaces\tas\tcompositional\tlayers\t—\tplaces\twhere\twe\tweave\ttogether\tthe various\tstrands\tof\tthe\tcapabilities\twe\toffer.\tSo\twith\tthat\tin\tmind,\thow\tdo\twe\tpull\tall\tthese strands\ttogether?\n\nConstraints\n\nConstraints\tare\tthe\tdifferent\tforms\tin\twhich\tour\tusers\tinteract\twith\tour\tsystem.\tOn\ta desktop\tweb\tapplication,\tfor\texample,\twe\tconsider\tconstraints\tsuch\tas\twhat\tbrowser visitors\tare\tusing,\tor\ttheir\tresolution.\tBut\tmobile\thas\tbrought\ta\twhole\thost\tof\tnew constraints.\tThe\tway\tour\tmobile\tapplications\tcommunicate\twith\tthe\tserver\tcan\thave\tan impact.\tIt\tisn’t\tjust\tabout\tpure\tbandwidth\tconcerns,\twhere\tthe\tlimitations\tof\tmobile networks\tcan\tplay\ta\tpart.\tDifferent\tsorts\tof\tinteractions\tcan\tdrain\tbattery\tlife,\tleading\tto some\tcross\tcustomers.\n\nThe\tnature\tof\tinteractions\tchanges,\ttoo.\tI\tcan’t\teasily\tright-click\ton\ta\ttablet.\tOn\ta\tmobile phone,\tI\tmay\twant\tto\tdesign\tmy\tinterface\tto\tbe\tused\tmostly\tone-handed,\twith\tmost operations\tbeing\tcontrolled\tby\ta\tthumb.\tElsewhere,\tI\tmight\tallow\tpeople\tto\tinteract\twith services\tvia\tSMS\tin\tplaces\twhere\tbandwidth\tis\tat\ta\tpremium\t—\tthe\tuse\tof\tSMS\tas\tan interface\tis\thuge\tin\tthe\tglobal\tsouth,\tfor\texample.\n\nSo,\talthough\tour\tcore\tservices\t—\tour\tcore\toffering\t—\tmight\tbe\tthe\tsame,\twe\tneed\ta\tway to\tadapt\tthem\tfor\tthe\tdifferent\tconstraints\tthat\texist\tfor\teach\ttype\tof\tinterface.\tWhen\twe look\tat\tdifferent\tstyles\tof\tuser\tinterface\tcomposition,\twe\tneed\tto\tensure\tthat\tthey\taddress this\tchallenge.\tLet’s\tlook\tat\ta\tfew\tmodels\tof\tuser\tinterfaces\tto\tsee\thow\tthis\tmight\tbe achieved.\n\nAPI\tComposition\n\nAssuming\tthat\tour\tservices\talready\tspeak\tXML\tor\tJSON\tto\teach\tother\tvia\tHTTP,\tan obvious\toption\tavailable\tto\tus\tis\tto\thave\tour\tuser\tinterface\tinteract\tdirectly\twith\tthese APIs,\tas\tin\tFigure\t4-7.\tA\tweb-based\tUI\tcould\tuse\tJavaScript\tGET\trequests\tto\tretrieve data,\tor\tPOST\trequests\tto\tchange\tit.\tEven\tfor\tnative\tmobile\tapplications,\tinitiating\tHTTP communications\tis\tfairly\tstraightforward.\tThe\tUI\twould\tthen\tneed\tto\tcreate\tthe\tvarious components\tthat\tmake\tup\tthe\tinterface,\thandling\tsynchronization\tof\tstate\tand\tthe\tlike\twith the\tserver.\tIf\twe\twere\tusing\ta\tbinary\tprotocol\tfor\tservice-to-service\tcommunication,\tthis would\tbe\tmore\tdifficult\tfor\tweb-based\tclients,\tbut\tcould\tbe\tfine\tfor\tnative\tmobile\tdevices.\n\nThere\tare\ta\tcouple\tof\tdownsides\twith\tthis\tapproach.\tFirst,\twe\thave\tlittle\tability\tto\ttailor the\tresponses\tfor\tdifferent\tsorts\tof\tdevices.\tFor\texample,\twhen\tI\tretrieve\ta\tcustomer record,\tdo\tI\tneed\tto\tpull\tback\tall\tthe\tsame\tdata\tfor\ta\tmobile\tshop\tas\tI\tdo\tfor\ta\thelpdesk application?\tOne\tsolution\tto\tthis\tapproach\tis\tto\tallow\tconsumers\tto\tspecify\twhat\tfields\tto pull\tback\twhen\tthey\tmake\ta\trequest,\tbut\tthis\tassumes\tthat\teach\tservice\tsupports\tthis\tform of\tinteraction.\n\nAnother\tkey\tquestion:\twho\tcreates\tthe\tuser\tinterface?\tThe\tpeople\twho\tlook\tafter\tthe services\tare\tremoved\tfrom\thow\ttheir\tservices\tare\tsurfaced\tto\tthe\tusers\t—\tfor\texample,\tif another\tteam\tis\tcreating\tthe\tUI,\twe\tcould\tbe\tdrifting\tback\tinto\tthe\tbad\told\tdays\tof\tlayered architecture\twhere\tmaking\teven\tsmall\tchanges\trequires\tchange\trequests\tto\tmultiple\tteams.\n\nFigure\t4-7.\tUsing\tmultiple\tAPIs\tto\tpresent\ta\tuser\tinterface\n\nThis\tcommunication\tcould\talso\tbe\tfairly\tchatty.\tOpening\tlots\tof\tcalls\tdirectly\tto\tservices can\tbe\tquite\tintensive\tfor\tmobile\tdevices,\tand\tcould\tbe\ta\tvery\tinefficient\tuse\tof\ta customer’s\tmobile\tplan!\tHaving\tan\tAPI\tgateway\tcan\thelp\there,\tas\tyou\tcould\texpose\tcalls that\taggregate\tmultiple\tunderlying\tcalls,\talthough\tthat\titself\tcan\thave\tsome\tdownsides\tthat we’ll\texplore\tshortly.\n\nUI\tFragment\tComposition\n\nRather\tthan\thaving\tour\tUI\tmake\tAPI\tcalls\tand\tmap\teverything\tback\tto\tUI\tcontrols,\twe could\thave\tour\tservices\tprovide\tparts\tof\tthe\tUI\tdirectly,\tand\tthen\tjust\tpull\tthese\tfragments in\tto\tcreate\ta\tUI,\tas\tin\tFigure\t4-8.\tImagine,\tfor\texample,\tthat\tthe\trecommendation\tservice provides\ta\trecommendation\twidget\tthat\tis\tcombined\twith\tother\tcontrols\tor\tUI\tfragments to\tcreate\tan\toverall\tUI.\tIt\tmight\tget\trendered\tas\ta\tbox\ton\ta\tweb\tpage\talong\twith\tother content.\n\nA\tvariation\tof\tthis\tapproach\tthat\tcan\twork\twell\tis\tto\tassemble\ta\tseries\tof\tcoarser-grained parts\tof\ta\tUI.\tSo\trather\tthan\tcreating\tsmall\twidgets,\tyou\tare\tassembling\tentire\tpanes\tof\ta thick\tclient\tapplication,\tor\tperhaps\ta\tset\tof\tpages\tfor\ta\twebsite.\n\nThese\tcoarser-grained\tfragments\tare\tserved\tup\tfrom\tserver-side\tapps\tthat\tare\tin\tturn making\tthe\tappropriate\tAPI\tcalls.\tThis\tmodel\tworks\tbest\twhen\tthe\tfragments\talign\twell\tto team\townership.\tFor\texample,\tperhaps\tthe\tteam\tthat\tlooks\tafter\torder\tmanagement\tin\tthe music\tshop\tserves\tup\tall\tthe\tpages\tassociated\twith\torder\tmanagement.\n\nFigure\t4-8.\tServices\tdirectly\tserving\tup\tUI\tcomponents\tfor\tassembly\n\nYou\tstill\tneed\tsome\tsort\tof\tassembly\tlayer\tto\tpull\tthese\tparts\ttogether.\tThis\tcould\tbe\tas simple\tas\tsome\tserver-side\ttemplating,\tor,\twhere\teach\tset\tof\tpages\tcomes\tfrom\ta\tdifferent app,\tperhaps\tyou’ll\tneed\tsome\tsmart\tURI\trouting.\n\nOne\tof\tthe\tkey\tadvantages\tof\tthis\tapproach\tis\tthat\tthe\tsame\tteam\tthat\tmakes\tchanges\tto the\tservices\tcan\talso\tbe\tin\tcharge\tof\tmaking\tchanges\tto\tthose\tparts\tof\tthe\tUI.\tIt\tallows\tus to\tget\tchanges\tout\tfaster.\tBut\tthere\tare\tsome\tproblems\twith\tthis\tapproach.\n\nFirst,\tensuring\tconsistency\tof\tthe\tuser\texperience\tis\tsomething\twe\tneed\tto\taddress.\tUsers\n\nwant\tto\thave\ta\tseamless\texperience,\tnot\tto\tfeel\tthat\tdifferent\tparts\tof\tthe\tinterface\twork\tin different\tways,\tor\tpresent\ta\tdifferent\tdesign\tlanguage.\tThere\tare\ttechniques\tto\tavoid\tthis problem,\tthough,\tsuch\tas\tliving\tstyle\tguides,\twhere\tassets\tlike\tHTML\tcomponents,\tCSS, and\timages\tcan\tbe\tshared\tto\thelp\tgive\tsome\tlevel\tof\tconsistency.\n\nAnother\tprobem\tis\tharder\tto\tdeal\twith.\tWhat\thappens\twith\tnative\tapplications\tor\tthick clients?\tWe\tcan’t\tserve\tup\tUI\tcomponents.\tWe\tcould\tuse\ta\thybrid\tapproach\tand\tuse\tnative applications\tto\tserve\tup\tHTML\tcomponents,\tbut\tthis\tapproach\thas\tbeen\tshown\ttime\tand again\tto\thave\tdownsides.\tSo\tif\tyou\tneed\ta\tnative\texperience,\twe\twill\thave\tto\tfall\tback\tto an\tapproach\twhere\tthe\tfrontend\tapplication\tmakes\tAPI\tcalls\tand\thandles\tthe\tUI\titself.\tBut even\tif\twe\tconsider\tweb-only\tUIs,\twe\tstill\tmay\twant\tvery\tdifferent\ttreatments\tfor\tdifferent types\tof\tdevices.\tBuilding\tresponsive\tcomponents\tcan\thelp,\tof\tcourse.\n\nThere\tis\tone\tkey\tproblem\twith\tthis\tapproach\tthat\tI’m\tnot\tsure\tcan\tbe\tsolved.\tSometimes the\tcapabilities\toffered\tby\ta\tservice\tdo\tnot\tfit\tneatly\tinto\ta\twidget\tor\ta\tpage.\tSure,\tI\tmight want\tto\tsurface\trecommendations\tin\ta\tbox\ton\ta\tpage\ton\tour\twebsite,\tbut\twhat\tif\tI\twant\tto weave\tin\tdynamic\trecommendations\telsewhere?\tWhen\tI\tsearch,\tI\twant\tthe\ttype\tahead\tto automatically\ttrigger\tfresh\trecommendations,\tfor\texample.\tThe\tmore\tcross-cutting\ta\tform of\tinteraction\tis,\tthe\tless\tlikely\tthis\tmodel\twill\tfit\tand\tthe\tmore\tlikely\tit\tis\tthat\twe’ll\tfall back\tto\tjust\tmaking\tAPI\tcalls.\n\nBackends\tfor\tFrontends\n\nA\tcommon\tsolution\tto\tthe\tproblem\tof\tchatty\tinterfaces\twith\tbackend\tservices,\tor\tthe\tneed to\tvary\tcontent\tfor\tdifferent\ttypes\tof\tdevices,\tis\tto\thave\ta\tserver-side\taggregation endpoint,\tor\tAPI\tgateway.\tThis\tcan\tmarshal\tmultiple\tbackend\tcalls,\tvary\tand\taggregate content\tif\tneeded\tfor\tdifferent\tdevices,\tand\tserve\tit\tup,\tas\twe\tsee\tin\tFigure\t4-9.\tI’ve\tseen this\tapproach\tlead\tto\tdisaster\twhen\tthese\tserver-side\tendpoints\tbecome\tthick\tlayers\twith too\tmuch\tbehavior.\tThey\tend\tup\tgetting\tmanaged\tby\tseparate\tteams,\tand\tbeing\tanother place\twhere\tlogic\thas\tto\tchange\twhenever\tsome\tfunctionality\tchanges.\n\nFigure\t4-9.\tUsing\ta\tsingle\tmonolithic\tgateway\tto\thandle\tcalls\tto/from\tUIs\n\nThe\tproblem\tthat\tcan\toccur\tis\tthat\tnormally\twe’ll\thave\tone\tgiant\tlayer\tfor\tall\tour\tservices. This\tleads\tto\teverything\tbeing\tthrown\tin\ttogether,\tand\tsuddenly\twe\tstart\tto\tlose\tisolation of\tour\tvarious\tuser\tinterfaces,\tlimiting\tour\tability\tto\trelease\tthem\tindependently.\tA\tmodel I\tprefer\tand\tthat\tI’ve\tseen\twork\twell\tis\tto\trestrict\tthe\tuse\tof\tthese\tbackends\tto\tone\tspecific user\tinterface\tor\tapplication,\tas\twe\tsee\tin\tFigure\t4-10.\n\nFigure\t4-10.\tUsing\tdedicated\tbackends\tfor\tfrontends\n\nThis\tpattern\tis\tsometimes\treferred\tto\tas\tbackends\tfor\tfrontends\t(BFFs).\tIt\tallows\tthe\tteam focusing\ton\tany\tgiven\tUI\tto\talso\thandle\tits\town\tserver-side\tcomponents.\tYou\tcan\tsee these\tbackends\tas\tparts\tof\tthe\tuser\tinterface\tthat\thappen\tto\tbe\tembedded\tin\tthe\tserver. Some\ttypes\tof\tUI\tmay\tneed\ta\tminimal\tserver-side\tfootprint,\twhile\tothers\tmay\tneed\ta\tlot more.\tIf\tyou\tneed\tan\tAPI\tauthentication\tand\tauthorization\tlayer,\tthis\tcan\tsit\tbetween\tour BFFs\tand\tour\tUIs.\tWe’ll\texplore\tthis\tmore\tin\tChapter\t9.\n\nThe\tdanger\twith\tthis\tapproach\tis\tthe\tsame\tas\twith\tany\taggregating\tlayer;\tit\tcan\ttake\ton logic\tit\tshouldn’t.\tThe\tbusiness\tlogic\tfor\tthe\tvarious\tcapabilities\tthese\tbackends\tuse should\tstay\tin\tthe\tservices\tthemselves.\tThese\tBFFs\tshould\tonly\tcontain\tbehavior\tspecific to\tdelivering\ta\tparticular\tuser\texperience.\n\nA\tHybrid\tApproach\n\nMany\tof\tthe\taforementioned\toptions\tdon’t\tneed\tto\tbe\tone-size-fits-all.\tI\tcould\tsee\tan organization\tadopting\tthe\tapproach\tof\tfragment-based\tassembly\tto\tcreate\ta\twebsite,\tbut using\ta\tbackends-for-frontends\tapproach\twhen\tit\tcomes\tto\tits\tmobile\tapplication.\tThe\tkey point\tis\tthat\twe\tneed\tto\tretain\tcohesion\tof\tthe\tunderlying\tcapabilities\tthat\twe\toffer\tour users.\tWe\tneed\tto\tensure\tthat\tlogic\tassociated\twith\tordering\tmusic\tor\tchanging\tcustomer details\tlives\tinside\tthose\tservices\tthat\thandle\tthose\toperations,\tand\tdoesn’t\tget\tsmeared\tall over\tour\tsystem.\tAvoiding\tthe\ttrap\tof\tputting\ttoo\tmuch\tbehavior\tinto\tany\tintermediate layers\tis\ta\ttricky\tbalancing\tact.\n\nIntegrating\twith\tThird-Party\tSoftware\n\nWe’ve\tlooked\tat\tapproaches\tto\tbreaking\tapart\texisting\tsystems\tthat\tare\tunder\tour\tcontrol, but\twhat\tabout\twhen\twe\tcan’t\tchange\tthe\tthings\twe\ttalk\tto?\tFor\tmany\tvalid\treasons,\tthe organizations\twe\twork\tfor\tbuy\tcommercial\toff-the-shelf\tsoftware\t(COTS)\tor\tmake\tuse\tof software\tas\ta\tservice\t(SaaS)\tofferings\tover\twhich\twe\thave\tlittle\tcontrol.\tSo\thow\tdo\twe integrate\twith\tthem\tsensibly?\n\nIf\tyou’re\treading\tthis\tbook,\tyou\tprobably\twork\tat\tan\torganization\tthat\twrites\tcode.\tYou might\twrite\tsoftware\tfor\tyour\town\tinternal\tpurposes\tor\tfor\tan\texternal\tclient,\tor\tboth. Nonetheless,\teven\tif\tyou\tare\tan\torganization\twith\tthe\tability\tto\tcreate\ta\tsignificant\tamount of\tcustom\tsoftware,\tyou’ll\tstill\tuse\tsoftware\tproducts\tprovided\tby\texternal\tparties,\tbe\tthey commercial\tor\topen\tsource.\tWhy\tis\tthis?\n\nFirst,\tyour\torganization\talmost\tcertainly\thas\ta\tgreater\tdemand\tfor\tsoftware\tthan\tcan\tbe satisfied\tinternally.\tThink\tof\tall\tthe\tproducts\tyou\tuse,\tfrom\toffice\tproductivity\ttools\tlike Excel\tto\toperating\tsystems\tto\tpayroll\tsystems.\tCreating\tall\tof\tthose\tfor\tyour\town\tuse would\tbe\ta\tmammoth\tundertaking.\tSecond,\tand\tmost\timportant,\tit\twouldn’t\tbe\tcost effective!\tThe\tcost\tfor\tyou\tto\tbuild\tyour\town\temail\tsystem,\tfor\texample,\tis\tlikely\tto\tdwarf the\tcost\tof\tusing\tan\texisting\tcombination\tof\tmail\tserver\tand\tclient,\teven\tif\tyou\tgo\tfor commercial\toptions.\n\nMy\tclients\toften\tstruggle\twith\tthe\tquestion\t“Should\tI\tbuild,\tor\tshould\tI\tbuy?”\tIn\tgeneral, the\tadvice\tI\tand\tmy\tcolleagues\tgive\twhen\thaving\tthis\tconversation\twith\tthe\taverage enterprise\torganization\tboils\tdown\tto\t“Build\tif\tit\tis\tunique\tto\twhat\tyou\tdo,\tand\tcan\tbe considered\ta\tstrategic\tasset;\tbuy\tif\tyour\tuse\tof\tthe\ttool\tisn’t\tthat\tspecial.”\n\nFor\texample,\tthe\taverage\torganization\twould\tnot\tconsider\tits\tpayroll\tsystem\tto\tbe\ta strategic\tasset.\tPeople\ton\tthe\twhole\tget\tpaid\tthe\tsame\tthe\tworld\tover.\tLikewise,\tmost organizations\ttend\tto\tbuy\tcontent\tmanagement\tsystems\t(CMSes)\toff\tthe\tshelf,\tas\ttheir\tuse of\tsuch\ta\ttool\tisn’t\tconsidered\tsomething\tthat\tis\tkey\tto\ttheir\tbusiness.\tOn\tthe\tother\thand,\tI was\tinvolved\tearly\ton\tin\trebuilding\tthe\tGuardian’s\twebsite,\tand\tthere\tthe\tdecision\twas made\tto\tbuild\ta\tbespoke\tcontent\tmanagement\tsystem,\tas\tit\twas\tcore\tto\tthe\tnewspaper’s business.\n\nSo\tthe\tnotion\tthat\twe\twill\toccasionally\tencounter\tcommercial,\tthird-party\tsoftware\tis sensible,\tand\tto\tbe\twelcomed.\tHowever,\tmany\tof\tus\tend\tup\tcursing\tsome\tof\tthese systems.\tWhy\tis\tthat?\n\nLack\tof\tControl\n\nOne\tchallenge\tassociated\twith\tintegrating\twith\tand\textending\tthe\tcapabilities\tof\tCOTS products\tlike\tCMS\tor\tSaaS\ttools\tis\tthat\ttypically\tmany\tof\tthe\ttechnical\tdecisions\thave been\tmade\tfor\tyou.\tHow\tdo\tyou\tintegrate\twith\tthe\ttool?\tThat’s\ta\tvendor\tdecision.\tWhich programming\tlanguage\tcan\tyou\tuse\tto\textend\tthe\ttool?\tUp\tto\tthe\tvendor.\tCan\tyou\tstore the\tconfiguration\tfor\tthe\ttool\tin\tversion\tcontrol,\tand\trebuild\tfrom\tscratch,\tso\tas\tto\tenable continuous\tintegration\tof\tcustomizations?\tIt\tdepends\ton\tchoices\tthe\tvendor\tmakes.\n\nIf\tyou\tare\tlucky,\thow\teasy\t—\tor\thard\t—\tit\tis\tto\twork\twith\tthe\ttool\tfrom\ta\tdevelopment point\tof\tview\thas\tbeen\tconsidered\tas\tpart\tof\tthe\ttool\tselection\tprocess.\tBut\teven\tthen,\tyou are\teffectively\tceding\tsome\tlevel\tof\tcontrol\tto\tan\toutside\tparty.\tThe\ttrick\tis\tto\tbring\tthe integration\tand\tcustomization\twork\tback\ton\tto\tyour\tterms.\n\nCustomization\n\nMany\ttools\tthat\tenterprise\torganizations\tpurchase\tsell\tthemselves\ton\ttheir\tability\tto\tbe heavily\tcustomized\tjust\tfor\tyou.\tBeware!\tOften,\tdue\tto\tthe\tnature\tof\tthe\ttool\tchain\tyou have\taccess\tto,\tthe\tcost\tof\tcustomization\tcan\tbe\tmore\texpensive\tthan\tbuilding\tsomething bespoke\tfrom\tscratch!\tIf\tyou’ve\tdecided\tto\tbuy\ta\tproduct\tbut\tthe\tparticular\tcapabilities\tit provides\taren’t\tthat\tspecial\tto\tyou,\tit\tmight\tmake\tmore\tsense\tto\tchange\thow\tyour organization\tworks\trather\tthan\tembark\ton\tcomplex\tcustomization.\n\nContent\tmanagement\tsystems\tare\ta\tgreat\texample\tof\tthis\tdanger.\tI\thave\tworked\twith multiple\tCMSes\tthat\tby\tdesign\tdo\tnot\tsupport\tcontinuous\tintegration,\tthat\thave\tterrible APIs,\tand\tfor\twhich\teven\ta\tminor-point\tupgrade\tin\tthe\tunderlying\ttool\tcan\tbreak\tany customizations\tyou\thave\tmade.\n\nSalesforce\tis\tespecially\ttroublesome\tin\tthis\tregard.\tFor\tmany\tyears\tit\thas\tpushed\tits Force.com\tplatform,\twhich\trequires\tthe\tuse\tof\ta\tprogramming\tlanguage,\tApex,\tthat\texists only\twithin\tthe\tForce.com\tecosystem!\n\nIntegration\tSpaghetti\n\nAnother\tchallenge\tis\thow\tyou\tintegrate\twith\tthe\ttool.\tAs\twe\tdiscussed\tearlier,\tthinking carefully\tabout\thow\tyou\tintegrate\tbetween\tservices\tis\timportant,\tand\tideally\tyou\twant\tto standardize\ton\ta\tsmall\tnumber\tof\ttypes\tof\tintegration.\tBut\tif\tone\tproduct\tdecides\tto\tuse\ta proprietary\tbinary\tprotocol,\tanother\tsome\tflavor\tof\tSOAP,\tand\tanother\tXML-RPC,\twhat are\tyou\tleft\twith?\tEven\tworse\tare\tthe\ttools\tthat\tallow\tyou\tto\treach\tright\tinside\ttheir underlying\tdata\tstores,\tleading\tto\tall\tthe\tsame\tcoupling\tissues\twe\tdiscussed\tearlier.\n\nOn\tYour\tOwn\tTerms\n\nCOTS\tand\tSAAS\tproducts\tabsolutely\thave\ttheir\tplace,\tand\tit\tisn’t\tfeasible\t(or\tsensible) for\tmost\tof\tus\tto\tbuild\teverything\tfrom\tscratch.\tSo\thow\tdo\twe\tresolve\tthese\tchallenges? The\tkey\tis\tto\tmove\tthings\tback\ton\tto\tyour\town\tterms.\n\nThe\tcore\tidea\there\tis\tto\tdo\tany\tcustomizations\ton\ta\tplatform\tyou\tcontrol,\tand\tto\tlimit\tthe number\tof\tdifferent\tconsumers\tof\tthe\ttool\titself.\tTo\texplore\tthis\tidea\tin\tdetail,\tlet’s\tlook\tat a\tcouple\tof\texamples.\n\nExample:\tCMS\tas\ta\tservice\n\nIn\tmy\texperience,\tthe\tCMS\tis\tone\tof\tthe\tmost\tcommonly\tused\tproduct\tthat\tneeds\tto\tbe customized\tor\tintegrated\twith.\tThe\treason\tfor\tthis\tis\tthat\tunless\tyou\twant\ta\tbasic\tstatic site,\tthe\taverage\tenterprise\torganization\twants\tto\tenrich\tthe\tfunctionality\tof\tits\twebsite with\tdynamic\tcontent\tlike\tcustomer\trecords\tor\tthe\tlatest\tproduct\tofferings.\tThe\tsource\tof this\tdynamic\tcontent\tis\ttypically\tother\tservices\tinside\tthe\torganization,\twhich\tyou\tmay have\tactually\tbuilt\tyourself.\n\nThe\ttemptation\t—\tand\toften\tthe\tselling\tpoint\tof\tthe\tCMS\t—\tis\tthat\tyou\tcan\tcustomize\tthe CMS\tto\tpull\tin\tall\tthis\tspecial\tcontent\tand\tdisplay\tit\tto\tthe\toutside\tworld.\tHowever,\tthe development\tenvironment\tfor\tthe\taverage\tCMS\tis\tterrible.\n\nLet’s\tlook\tat\twhat\tthe\taverage\tCMS\tspecializes\tin,\tand\twhat\twe\tprobably\tbought\tit\tfor: content\tcreation\tand\tcontent\tmanagement.\tMost\tCMSes\tare\tpretty\tbad\teven\tat\tdoing\tpage layout,\ttypically\tproviding\tdrag-and-drop\ttools\tthat\tdon’t\tcut\tthe\tmustard.\tAnd\teven\tthen, you\tend\tup\tneeding\tto\thave\tsomeone\twho\tunderstands\tHTML\tand\tCSS\tto\tfine-tune\tthe CMS\ttemplates.\tThey\ttend\tto\tbe\tterrible\tplatforms\ton\twhich\tto\tbuild\tcustom\tcode.\n\nThe\tanswer?\tFront\tthe\tCMS\twith\tyour\town\tservice\tthat\tprovides\tthe\twebsite\tto\tthe\toutside world,\tas\tshown\tin\tFigure\t4-11.\tTreat\tthe\tCMS\tas\ta\tservice\twhose\trole\tis\tto\tallow\tfor\tthe creation\tand\tretrieval\tof\tcontent.\tIn\tyour\town\tservice,\tyou\twrite\tthe\tcode\tand\tintegrate with\tservices\thow\tyou\twant.\tYou\thave\tcontrol\tover\tscaling\tthe\twebsite\t(many\tcommercial CMSes\tprovide\ttheir\town\tproprietary\tadd-ons\tto\thandle\tload),\tand\tyou\tcan\tpick\tthe templating\tsystem\tthat\tmakes\tsense.\n\nMost\tCMSes\talso\tprovide\tAPIs\tto\tallow\tfor\tcontent\tcreation,\tso\tyou\talso\thave\tthe\tability to\tfront\tthat\twith\tyour\town\tservice\tfaçade.\tFor\tsome\tsituations,\twe’ve\teven\tused\tsuch\ta façade\tto\tabstract\tout\tthe\tAPIs\tfor\tretrieving\tcontent.\n\nFigure\t4-11.\tHiding\ta\tCMS\tusing\tyour\town\tservice\n\nWe’ve\tused\tthis\tpattern\tmultiple\ttimes\tacross\tThoughtWorks\tin\tthe\tlast\tfew\tyears,\tand I’ve\tdone\tthis\tmore\tthan\tonce\tmyself.\tOne\tnotable\texample\twas\ta\tclient\tthat\twas\tlooking to\tpush\tout\ta\tnew\twebsite\tfor\tits\tproducts.\tInitially,\tit\twanted\tto\tbuild\tthe\tentire\tsolution on\tthe\tCMS,\tbut\tit\thad\tyet\tto\tpick\tone.\tWe\tinstead\tsuggested\tthis\tapproach,\tand\tstarted development\tof\tthe\tfronting\twebsite.\tWhile\twaiting\tfor\tthe\tCMS\ttool\tto\tbe\tselected,\twe faked\tit\tby\thaving\ta\tweb\tservice\tthat\tjust\tsurfaced\tstatic\tcontent.\tWe\tended\tup\tgoing\tlive with\tthe\tsite\twell\tbefore\tthe\tCMS\twas\tselected\tby\tusing\tour\tfake\tcontent\tservice\tin production\tto\tsurface\tcontent\tto\tthe\tlive\tsite.\tLater\ton,\twe\twere\table\tto\tjust\tdrop\tin\tthe eventually\tselected\ttool\twithout\tany\tchange\tto\tthe\tfronting\tapplication.\n\nUsing\tthis\tapproach,\twe\tkeep\tthe\tscope\tof\twhat\tthe\tCMS\tdoes\tdown\tto\ta\tminimum\tand move\tcustomizations\tonto\tour\town\ttechnology\tstack.\n\nExample:\tThe\tmultirole\tCRM\tsystem\n\nThe\tCRM\t—\tor\tCustomer\tRelationship\tManagement\t—\ttool\tis\tan\toften-encountered\tbeast that\tcan\tinstill\tfear\tin\tthe\theart\tof\teven\tthe\thardiest\tarchitect.\tThis\tsector,\tas\ttypified\tby vendors\tlike\tSalesforce\tor\tSAP,\tis\trife\twith\texamples\tof\ttools\tthat\ttry\tto\tdo\teverything\tfor you.\tThis\tcan\tlead\tto\tthe\ttool\titself\tbecoming\ta\tsingle\tpoint\tof\tfailure,\tand\ta\ttangled\tknot of\tdependencies.\tMany\timplementations\tof\tCRM\ttools\tI\thave\tseen\tare\tamong\tthe\tbest examples\tof\tadhesive\t(as\topposed\tto\tcohesive)\tservices.\n\nThe\tscope\tof\tsuch\ta\ttool\ttypically\tstarts\tsmall,\tbut\tover\ttime\tit\tbecomes\tan\tincreasingly important\tpart\tof\thow\tyour\torganization\tworks.\tThe\tproblem\tis\tthat\tthe\tdirection\tand choices\tmade\taround\tthis\tnow-vital\tsystem\tare\toften\tmade\tby\tthe\ttool\tvendor\titself,\tnot\tby you.\n\nI\twas\tinvolved\trecently\tin\tan\texercise\tto\ttry\tto\twrest\tsome\tcontrol\tback.\tThe\torganization I\twas\tworking\twith\trealized\tthat\talthough\tit\twas\tusing\tthe\tCRM\ttool\tfor\ta\tlot\tof\tthings,\tit\n\nwasn’t\tgetting\tthe\tvalue\tof\tthe\tincreasing\tcosts\tassociated\twith\tthe\tplatform.\tAt\tthe\tsame time,\tmultiple\tinternal\tsystems\twere\tusing\tthe\tless-than-ideal\tCRM\tAPIs\tfor\tintegration. We\twanted\tto\tmove\tthe\tsystem\tarchitecture\ttoward\ta\tplace\twhere\twe\thad\tservices\tthat modeled\tour\tbusinesses\tdomain,\tand\talso\tlay\tthe\tgroundwork\tfor\ta\tpotential\tmigration.\n\nThe\tfirst\tthing\twe\tdid\twas\tidentify\tthe\tcore\tconcepts\tto\tour\tdomain\tthat\tthe\tCRM\tsystem currently\towned.\tOne\tof\tthese\twas\tthe\tconcept\tof\ta\tproject\t—\tthat\tis,\tsomething\tto\twhich a\tmember\tof\tstaff\tcould\tbe\tassigned.\tMultiple\tother\tsystems\tneeded\tproject\tinformation. What\twe\tdid\twas\tinstead\tcreate\ta\tproject\tservice.\tThis\tservice\texposed\tprojects\tas RESTful\tresources,\tand\tthe\texternal\tsystems\tcould\tmove\ttheir\tintegration\tpoints\tover\tto the\tnew,\teasier-to-work-with\tservice.\tInternally,\tthe\tproject\tservice\twas\tjust\ta\tfaçade, hiding\tthe\tdetail\tof\tthe\tunderlying\tintegration.\tYou\tcan\tsee\tthis\tin\tFigure\t4-12.\n\nFigure\t4-12.\tUsing\tfaçade\tservices\tto\tmask\tthe\tunderlying\tCRM\n\nThe\twork,\twhich\tat\tthe\ttime\tof\tthis\twriting\twas\tstill\tunder\tway,\twas\tto\tidentify\tother domain\tconcepts\tthat\tthe\tCRM\twas\thandling,\tand\tcreate\tmore\tfaçades\tfor\tthem.\tWhen\tthe time\tcomes\tfor\tmigration\taway\tfrom\tthe\tunderlying\tCRM,\twe\tcould\tthen\tlook\tat\teach façade\tin\tturn\tto\tdecide\tif\tan\tinternal\tsoftware\tsolution\tor\tsomething\toff\tthe\tshelf\tcould\tfit the\tbill.\n\nThe\tStrangler\tPattern\n\nWhen\tit\tcomes\tto\tlegacy\tor\teven\tCOTS\tplatforms\tthat\taren’t\ttotally\tunder\tour\tcontrol,\twe also\thave\tto\tdeal\twith\twhat\thappens\twhen\twe\twant\tto\tremove\tthem\tor\tat\tleast\tmove\taway from\tthem.\tA\tuseful\tpattern\there\tis\tthe\tStrangler\tApplication\tPattern.\tMuch\tlike\twith\tour example\tof\tfronting\tthe\tCMS\tsystem\twith\tour\town\tcode,\twith\ta\tstrangler\tyou\tcapture\tand intercept\tcalls\tto\tthe\told\tsystem.\tThis\tallows\tyou\tto\tdecide\tif\tyou\troute\tthese\tcalls\tto existing,\tlegacy\tcode,\tor\tdirect\tthem\tto\tnew\tcode\tyou\tmay\thave\twritten.\tThis\tallows\tyou to\treplace\tfunctionality\tover\ttime\twithout\trequiring\ta\tbig\tbang\trewrite.\n\nWhen\tit\tcomes\tto\tmicroservices,\trather\tthan\thaving\ta\tsingle\tmonolithic\tapplication intercepting\tall\tcalls\tto\tthe\texisting\tlegacy\tsystem,\tyou\tmay\tinstead\tuse\ta\tseries\tof microservices\tto\tperform\tthis\tinterception.\tCapturing\tand\tredirecting\tthe\toriginal\tcalls\tcan become\tmore\tcomplex\tin\tthis\tsituation,\tand\tyou\tmay\trequire\tthe\tuse\tof\ta\tproxy\tto\tdo\tthis for\tyou.\n\nSummary\n\nWe’ve\tlooked\tat\ta\tnumber\tof\tdifferent\toptions\taround\tintegration,\tand\tI’ve\tshared\tmy thoughts\ton\twhat\tchoices\tare\tmost\tlikely\tto\tensure\tour\tmicroservices\tremain\tas\tdecoupled as\tpossible\tfrom\ttheir\tother\tcollaborators:\n\nAvoid\tdatabase\tintegration\tat\tall\tcosts.\n\nUnderstand\tthe\ttrade-offs\tbetween\tREST\tand\tRPC,\tbut\tstrongly\tconsider\tREST\tas\ta good\tstarting\tpoint\tfor\trequest/response\tintegration.\n\nPrefer\tchoreography\tover\torchestration.\n\nAvoid\tbreaking\tchanges\tand\tthe\tneed\tto\tversion\tby\tunderstanding\tPostel’s\tLaw\tand using\ttolerant\treaders.\n\nThink\tof\tuser\tinterfaces\tas\tcompositional\tlayers.\n\nWe\tcovered\tquite\ta\tlot\there,\tand\tweren’t\table\tto\tgo\tinto\tdepth\ton\tall\tof\tthese\ttopics. Nonetheless,\tthis\tshould\tbe\ta\tgood\tfoundation\tto\tget\tyou\tgoing\tand\tpoint\tyou\tin\tthe\tright direction\tif\tyou\twant\tto\tlearn\tmore.\n\nWe\talso\tspent\tsome\ttime\tlooking\tat\thow\tto\twork\twith\tsystems\tthat\taren’t\tcompletely under\tour\tcontrol\tin\tthe\tform\tof\tCOTS\tproducts.\tIt\tturns\tout\tthat\tthis\tdescription\tcan\tjust as\teasily\tapply\tto\tsoftware\twe\twrote!\n\nSome\tof\tthe\tapproaches\toutlined\there\tapply\tequally\twell\tto\tlegacy\tsoftware,\tbut\twhat\tif we\twant\tto\ttackle\tthe\toften-monumental\ttask\tof\tbringing\tthese\tolder\tsystems\tto\theel\tand decomposing\tthem\tinto\tmore\tusable\tparts?\tWe’ll\tdiscuss\tthat\tin\tdetail\tin\tthe\tnext\tchapter.\n\nChapter\t5.\tSplitting\tthe\tMonolith\n\nWe’ve\tdiscussed\twhat\ta\tgood\tservice\tlooks\tlike,\tand\twhy\tsmaller\tservers\tmay\tbe\tbetter\tfor us.\tWe\talso\tpreviously\tdiscussed\tthe\timportance\tof\tbeing\table\tto\tevolve\tthe\tdesign\tof\tour systems.\tBut\thow\tdo\twe\thandle\tthe\tfact\tthat\twe\tmay\talready\thave\ta\tlarge\tnumber\tof codebases\tlying\tabout\tthat\tdon’t\tfollow\tthese\tpatterns?\tHow\tdo\twe\tgo\tabout\tdecomposing these\tmonolithic\tapplications\twithout\thaving\tto\tembark\ton\ta\tbig-bang\trewrite?\n\nThe\tmonolith\tgrows\tover\ttime.\tIt\tacquires\tnew\tfunctionality\tand\tlines\tof\tcode\tat\tan alarming\trate.\tBefore\tlong\tit\tbecomes\ta\tbig,\tscary\tgiant\tpresence\tin\tour\torganization\tthat people\tare\tscared\tto\ttouch\tor\tchange.\tBut\tall\tis\tnot\tlost!\tWith\tthe\tright\ttools\tat\tour disposal,\twe\tcan\tslay\tthis\tbeast.",
      "page_number": 80
    },
    {
      "number": 5,
      "title": "Splitting\tthe\tMonolith",
      "start_page": 145,
      "end_page": 187,
      "detection_method": "regex_chapter_title",
      "content": "It’s\tAll\tAbout\tSeams\n\nWe\tdiscussed\tin\tChapter\t3\tthat\twe\twant\tour\tservices\tto\tbe\thighly\tcohesive\tand\tloosely coupled.\tThe\tproblem\twith\tthe\tmonolith\tis\tthat\tall\ttoo\toften\tit\tis\tthe\topposite\tof\tboth. Rather\tthan\ttend\ttoward\tcohesion,\tand\tkeep\tthings\ttogether\tthat\ttend\tto\tchange\ttogether, we\tacquire\tand\tstick\ttogether\tall\tsorts\tof\tunrelated\tcode.\tLikewise,\tloose\tcoupling\tdoesn’t really\texist:\tif\tI\twant\tto\tmake\ta\tchange\tto\ta\tline\tof\tcode,\tI\tmay\tbe\table\tto\tdo\tthat\teasily enough,\tbut\tI\tcannot\tdeploy\tthat\tchange\twithout\tpotentially\timpacting\tmuch\tof\tthe\trest\tof the\tmonolith,\tand\tI’ll\tcertainly\thave\tto\tredeploy\tthe\tentire\tsystem.\n\nIn\this\tbook\tWorking\tEffectively\twith\tLegacy\tCode\t(Prentice-Hall),\tMichael\tFeathers defines\tthe\tconcept\tof\ta\tseam\t—\tthat\tis,\ta\tportion\tof\tthe\tcode\tthat\tcan\tbe\ttreated\tin isolation\tand\tworked\ton\twithout\timpacting\tthe\trest\tof\tthe\tcodebase.\tWe\talso\twant\tto identify\tseams.\tBut\trather\tthan\tfinding\tthem\tfor\tthe\tpurpose\tof\tcleaning\tup\tour\tcodebase, we\twant\tto\tidentify\tseams\tthat\tcan\tbecome\tservice\tboundaries.\n\nSo\twhat\tmakes\ta\tgood\tseam?\tWell,\tas\twe\tdiscussed\tpreviously,\tbounded\tcontexts\tmake excellent\tseams,\tbecause\tby\tdefinition\tthey\trepresent\tcohesive\tand\tyet\tloosely\tcoupled boundaries\tin\tan\torganization.\tSo\tthe\tfirst\tstep\tis\tto\tstart\tidentifying\tthese\tboundaries\tin our\tcode.\n\nMost\tprogramming\tlanguages\tprovide\tnamespace\tconcepts\tthat\tallow\tus\tto\tgroup\tsimilar code\ttogether.\tJava’s\tpackage\tconcept\tis\ta\tfairly\tweak\texample,\tbut\tgives\tus\tmuch\tof\twhat we\tneed.\tAll\tother\tmainstream\tprogramming\tlanguages\thave\tsimilar\tconcepts\tbuilt\tin, with\tJavaScript\tvery\targuably\tbeing\tan\texception.\n\nBreaking\tApart\tMusicCorp\n\nImagine\twe\thave\ta\tlarge\tbackend\tmonolithic\tservice\tthat\trepresents\ta\tsubstantial\tamount of\tthe\tbehavior\tof\tMusicCorp’s\tonline\tsystems.\tTo\tstart,\twe\tshould\tidentify\tthe\thigh-level bounded\tcontexts\tthat\twe\tthink\texist\tin\tour\torganization,\tas\twe\tdiscussed\tin\tChapter\t3. Then\twe\twant\tto\ttry\tto\tunderstand\twhat\tbounded\tcontexts\tthe\tmonolith\tmaps\tto.\tLet’s imagine\tthat\tinitially\twe\tidentify\tfour\tcontexts\twe\tthink\tour\tmonolithic\tbackend\tcovers:\n\nCatalog\n\nEverything\tto\tdo\twith\tmetadata\tabout\tthe\titems\twe\toffer\tfor\tsale\n\nFinance\n\nReporting\tfor\taccounts,\tpayments,\trefunds,\tetc.\n\nWarehouse\n\nDispatching\tand\treturning\tof\tcustomer\torders,\tmanaging\tinventory\tlevels,\tetc.\n\nRecommendation\n\nOur\tpatent-pending,\trevolutionary\trecommendation\tsystem,\twhich\tis\thighly\tcomplex code\twritten\tby\ta\tteam\twith\tmore\tPhDs\tthan\tthe\taverage\tscience\tlab\n\nThe\tfirst\tthing\tto\tdo\tis\tto\tcreate\tpackages\trepresenting\tthese\tcontexts,\tand\tthen\tmove\tthe existing\tcode\tinto\tthem.\tWith\tmodern\tIDEs,\tcode\tmovement\tcan\tbe\tdone\tautomatically via\trefactorings,\tand\tcan\tbe\tdone\tincrementally\twhile\twe\tare\tdoing\tother\tthings.\tYou’ll still\tneed\ttests\tto\tcatch\tany\tbreakages\tmade\tby\tmoving\tcode,\thowever,\tespecially\tif\tyou’re using\ta\tdynamically\ttyped\tlanguage\twhere\tthe\tIDEs\thave\ta\tharder\ttime\tof\tperforming refactoring.\tOver\ttime,\twe\tstart\tto\tsee\twhat\tcode\tfits\twell,\tand\twhat\tcode\tis\tleft\tover\tand doesn’t\treally\tfit\tanywhere.\tThis\tremaining\tcode\twill\toften\tidentify\tbounded\tcontexts\twe might\thave\tmissed!\n\nDuring\tthis\tprocess\twe\tcan\tuse\tcode\tto\tanalyze\tthe\tdependencies\tbetween\tthese\tpackages too.\tOur\tcode\tshould\trepresent\tour\torganization,\tso\tour\tpackages\trepresenting\tthe bounded\tcontexts\tin\tour\torganization\tshould\tinteract\tin\tthe\tsame\tway\tthe\treal-life organizational\tgroups\tin\tour\tdomain\tinteract.\tFor\texample,\ttools\tlike\tStructure\t101\tallow us\tto\tsee\tthe\tdependencies\tbetween\tpackages\tgraphically.\tIf\twe\tspot\tthings\tthat\tlook wrong\t—\tfor\texample,\tthe\twarehouse\tpackage\tdepends\ton\tcode\tin\tthe\tfinance\tpackage when\tno\tsuch\tdependency\texists\tin\tthe\treal\torganization\t—\tthen\twe\tcan\tinvestigate\tthis problem\tand\ttry\tto\tresolve\tit.\n\nThis\tprocess\tcould\ttake\tan\tafternoon\ton\ta\tsmall\tcodebase,\tor\tseveral\tweeks\tor\tmonths when\tyou’re\tdealing\twith\tmillions\tof\tlines\tof\tcode.\tYou\tmay\tnot\tneed\tto\tsort\tall\tcode\tinto domain-oriented\tpackages\tbefore\tsplitting\tout\tyour\tfirst\tservice,\tand\tindeed\tit\tcan\tbe\tmore valuable\tto\tconcentrate\tyour\teffort\tin\tone\tplace.\tThere\tis\tno\tneed\tfor\tthis\tto\tbe\ta\tbig-bang approach.\tIt\tis\tsomething\tthat\tcan\tbe\tdone\tbit\tby\tbit,\tday\tby\tday,\tand\twe\thave\ta\tlot\tof\ttools\n\nat\tour\tdisposal\tto\ttrack\tour\tprogress.\n\nSo\tnow\tthat\twe\thave\tour\tcodebase\torganized\taround\tthese\tseams,\twhat\tnext?\n\nThe\tReasons\tto\tSplit\tthe\tMonolith\n\nDeciding\tthat\tyou’d\tlike\ta\tmonolithic\tservice\tor\tapplication\tto\tbe\tsmaller\tis\ta\tgood\tstart. But\tI\twould\tstrongly\tadvise\tyou\tto\tchip\taway\tat\tthese\tsystems.\tAn\tincremental\tapproach will\thelp\tyou\tlearn\tabout\tmicroservices\tas\tyou\tgo,\tand\twill\talso\tlimit\tthe\timpact\tof\tgetting something\twrong\t(and\tyou\twill\tget\tthings\twrong!).\tThink\tof\tour\tmonolith\tas\ta\tblock\tof marble.\tWe\tcould\tblow\tthe\twhole\tthing\tup,\tbut\tthat\trarely\tends\twell.\tIt\tmakes\tmuch\tmore sense\tto\tjust\tchip\taway\tat\tit\tincrementally.\n\nSo\tif\twe\tare\tgoing\tto\tbreak\tapart\tthe\tmonolith\ta\tpiece\tat\ta\ttime,\twhere\tshould\twe\tstart? We\thave\tour\tseams\tnow,\tbut\twhich\tone\tshould\twe\tpull\tout\tfirst?\tIt’s\tbest\tto\tthink\tabout where\tyou\tare\tgoing\tto\tget\tthe\tmost\tbenefit\tfrom\tsome\tpart\tof\tyour\tcodebase\tbeing separated,\trather\tthan\tjust\tsplitting\tthings\tfor\tthe\tsake\tof\tit.\tLet’s\tconsider\tsome\tdrivers that\tmight\thelp\tguide\tour\tchisel.\n\nPace\tof\tChange\n\nPerhaps\twe\tknow\tthat\twe\thave\ta\tload\tof\tchanges\tcoming\tup\tsoon\tin\thow\twe\tmanage inventory.\tIf\twe\tsplit\tout\tthe\twarehouse\tseam\tas\ta\tservice\tnow,\twe\tcould\tchange\tthat service\tfaster,\tas\tit\tis\ta\tseparate\tautonomous\tunit.\n\nTeam\tStructure\n\nMusicCorp’s\tdelivery\tteam\tis\tactually\tsplit\tacross\ttwo\tgeographical\tregions.\tOne\tteam\tis in\tLondon,\tthe\tother\tin\tHawaii\t(some\tpeople\thave\tit\teasy!).\tIt\twould\tbe\tgreat\tif\twe\tcould split\tout\tthe\tcode\tthat\tthe\tHawaii\tteam\tworks\ton\tthe\tmost,\tso\tit\tcan\ttake\tfull\townership. We’ll\texplore\tthis\tidea\tfurther\tin\tChapter\t10.\n\nSecurity\n\nMusicCorp\thas\thad\ta\tsecurity\taudit,\tand\thas\tdecided\tto\ttighten\tup\tits\tprotection\tof sensitive\tinformation.\tCurrently,\tall\tof\tthis\tis\thandled\tby\tthe\tfinance-related\tcode.\tIf\twe split\tthis\tservice\tout,\twe\tcan\tprovide\tadditional\tprotections\tto\tthis\tindividual\tservice\tin terms\tof\tmonitoring,\tprotection\tof\tdata\tat\ttransit,\tand\tprotection\tof\tdata\tat\trest\t—\tideas we’ll\tlook\tat\tin\tmore\tdetail\tin\tChapter\t9.\n\nTechnology\n\nThe\tteam\tlooking\tafter\tour\trecommendation\tsystem\thas\tbeen\tspiking\tout\tsome\tnew algorithms\tusing\ta\tlogic\tprogramming\tlibrary\tin\tthe\tlanguage\tClojure.\tThe\tteam\tthinks this\tcould\tbenefit\tour\tcustomers\tby\timproving\twhat\twe\toffer\tthem.\tIf\twe\tcould\tsplit\tout the\trecommendation\tcode\tinto\ta\tseparate\tservice,\tit\twould\tbe\teasy\tto\tconsider\tbuilding\tan alternative\timplementation\tthat\twe\tcould\ttest\tagainst.\n\nTangled\tDependencies\n\nThe\tother\tpoint\tto\tconsider\twhen\tyou’ve\tidentified\ta\tcouple\tof\tseams\tto\tseparate\tis\thow entangled\tthat\tcode\tis\twith\tthe\trest\tof\tthe\tsystem.\tWe\twant\tto\tpull\tout\tthe\tseam\tthat\tis\tleast depended\ton\tif\twe\tcan.\tIf\tyou\tcan\tview\tthe\tvarious\tseams\tyou\thave\tfound\tas\ta\tdirected acyclical\tgraph\tof\tdependencies\t(something\tthe\tpackage\tmodeling\ttools\tI\tmentioned earlier\tare\tvery\tgood\tat),\tthis\tcan\thelp\tyou\tspot\tthe\tseams\tthat\tare\tlikely\tgoing\tto\tbe\tharder to\tdisentangle.\n\nThis\tbrings\tus\tto\twhat\tis\toften\tthe\tmother\tof\tall\ttangled\tdependencies:\tthe\tdatabase.\n\nThe\tDatabase\n\nWe’ve\talready\tdiscussed\tat\tlength\tthe\tchallenges\tof\tusing\tdatabases\tas\ta\tmethod\tof integrating\tmultiple\tservices.\tAs\tI\tmade\tit\tpretty\tclear\tearlier,\tI\tam\tnot\ta\tfan!\tThis\tmeans we\tneed\tto\tfind\tseams\tin\tour\tdatabases\ttoo\tso\twe\tcan\tsplit\tthem\tout\tcleanly.\tDatabases, however,\tare\ttricky\tbeasts.\n\nGetting\tto\tGrips\twith\tthe\tProblem\n\nThe\tfirst\tstep\tis\tto\ttake\ta\tlook\tat\tthe\tcode\titself\tand\tsee\twhich\tparts\tof\tit\tread\tto\tand\twrite from\tthe\tdatabase.\tA\tcommon\tpractice\tis\tto\thave\ta\trepository\tlayer,\tbacked\tby\tsome\tsort of\tframework\tlike\tHibernate,\tto\tbind\tyour\tcode\tto\tthe\tdatabase,\tmaking\tit\teasy\tto\tmap objects\tor\tdata\tstructures\tto\tand\tfrom\tthe\tdatabase.\tIf\tyou\thave\tbeen\tfollowing\talong\tso far,\tyou’ll\thave\tgrouped\tour\tcode\tinto\tpackages\trepresenting\tour\tbounded\tcontexts;\twe want\tto\tdo\tthe\tsame\tfor\tour\tdatabase\taccess\tcode.\tThis\tmay\trequire\tsplitting\tup\tthe repository\tlayer\tinto\tseveral\tparts,\tas\tshown\tin\tFigure\t5-1.\n\nFigure\t5-1.\tSplitting\tout\tour\trepository\tlayers\n\nHaving\tthe\tdatabase\tmapping\tcode\tcolocated\tinside\tthe\tcode\tfor\ta\tgiven\tcontext\tcan\thelp us\tunderstand\twhat\tparts\tof\tthe\tdatabase\tare\tused\tby\twhat\tbits\tof\tcode.\tHibernate,\tfor example,\tcan\tmake\tthis\tvery\tclear\tif\tyou\tare\tusing\tsomething\tlike\ta\tmapping\tfile\tper bounded\tcontext.\n\nThis\tdoesn’t\tgive\tus\tthe\twhole\tstory,\thowever.\tFor\texample,\twe\tmay\tbe\table\tto\ttell\tthat\tthe finance\tcode\tuses\tthe\tledger\ttable,\tand\tthat\tthe\tcatalog\tcode\tuses\tthe\tline\titem\ttable,\tbut\tit might\tnot\tbe\tclear\tthat\tthe\tdatabase\tenforces\ta\tforeign\tkey\trelationship\tfrom\tthe\tledger table\tto\tthe\tline\titem\ttable.\tTo\tsee\tthese\tdatabase-level\tconstraints,\twhich\tmay\tbe\ta stumbling\tblock,\twe\tneed\tto\tuse\tanother\ttool\tto\tvisualize\tthe\tdata.\tA\tgreat\tplace\tto\tstart\tis to\tuse\ta\ttool\tlike\tthe\tfreely\tavailable\tSchemaSpy,\twhich\tcan\tgenerate\tgraphical representations\tof\tthe\trelationships\tbetween\ttables.\n\nAll\tthis\thelps\tyou\tunderstand\tthe\tcoupling\tbetween\ttables\tthat\tmay\tspan\twhat\twill eventually\tbecome\tservice\tboundaries.\tBut\thow\tdo\tyou\tcut\tthose\tties?\tAnd\twhat\tabout cases\twhere\tthe\tsame\ttables\tare\tused\tfrom\tmultiple\tdifferent\tbounded\tcontexts?\tHandling problems\tlike\tthese\tis\tnot\teasy,\tand\tthere\tare\tmany\tanswers,\tbut\tit\tis\tdoable.\n\nComing\tback\tto\tsome\tconcrete\texamples,\tlet’s\tconsider\tour\tmusic\tshop\tagain.\tWe\thave identified\tfour\tbounded\tcontexts,\tand\twant\tto\tmove\tforward\twith\tmaking\tthem\tfour distinct,\tcollaborating\tservices.\tWe’re\tgoing\tto\tlook\tat\ta\tfew\tconcrete\texamples\tof problems\twe\tmight\tface,\tand\ttheir\tpotential\tsolutions.\tAnd\twhile\tsome\tof\tthese\texamples talk\tspecifically\tabout\tchallenges\tencountered\tin\tstandard\trelational\tdatabases,\tyou\twill find\tsimilar\tproblems\tin\tother\talternative\tNOSQL\tstores.\n\nExample:\tBreaking\tForeign\tKey\tRelationships\n\nIn\tthis\texample,\tour\tcatalog\tcode\tuses\ta\tgeneric\tline\titem\ttable\tto\tstore\tinformation\tabout an\talbum.\tOur\tfinance\tcode\tuses\ta\tledger\ttable\tto\ttrack\tfinancial\ttransactions.\tAt\tthe\tend of\teach\tmonth\twe\tneed\tto\tgenerate\treports\tfor\tvarious\tpeople\tin\tthe\torganization\tso\tthey can\tsee\thow\twe’re\tdoing.\tWe\twant\tto\tmake\tthe\treports\tnice\tand\teasy\tto\tread,\tso\trather than\tsaying,\t“We\tsold\t400\tcopies\tof\tSKU\t12345\tand\tmade\t$1,300,”\twe’d\tlike\tto\tadd\tmore information\tabout\twhat\twas\tsold\t(i.e.,\t“We\tsold\t400\tcopies\tof\tBruce\tSpringsteen’s Greatest\tHits\tand\tmade\t$1,300”).\tTo\tdo\tthis,\tour\treporting\tcode\tin\tthe\tfinance\tpackage will\treach\tinto\tthe\tline\titem\ttable\tto\tpull\tout\tthe\ttitle\tfor\tthe\tSKU.\tIt\tmay\talso\thave\ta foreign\tkey\tconstraint\tfrom\tthe\tledger\tto\tthe\tline\titem\ttable,\tas\twe\tsee\tin\tFigure\t5-2.\n\nFigure\t5-2.\tForeign\tkey\trelationship\n\nSo\thow\tdo\twe\tfix\tthings\there?\tWell,\twe\tneed\tto\tmake\ta\tchange\tin\ttwo\tplaces.\tFirst,\twe need\tto\tstop\tthe\tfinance\tcode\tfrom\treaching\tinto\tthe\tline\titem\ttable,\tas\tthis\ttable\treally belongs\tto\tthe\tcatalog\tcode,\tand\twe\tdon’t\twant\tdatabase\tintegration\thappening\tonce catalog\tand\tfinance\tare\tservices\tin\ttheir\town\trights.\tThe\tquickest\tway\tto\taddress\tthis\tis rather\tthan\thaving\tthe\tcode\tin\tfinance\treach\tinto\tthe\tline\titem\ttable,\twe’ll\texpose\tthe\tdata via\tan\tAPI\tcall\tin\tthe\tcatalog\tpackage\tthat\tthe\tfinance\tcode\tcan\tcall.\tThis\tAPI\tcall\twill\tbe the\tforerunner\tof\ta\tcall\twe\twill\tmake\tover\tthe\twire,\tas\twe\tsee\tin\tFigure\t5-3.\n\nFigure\t5-3.\tPost\tremoval\tof\tthe\tforeign\tkey\trelationship\n\nAt\tthis\tpoint\tit\tbecomes\tclear\tthat\twe\tmay\twell\tend\tup\thaving\tto\tmake\ttwo\tdatabase\tcalls to\tgenerate\tthe\treport.\tThis\tis\tcorrect.\tAnd\tthe\tsame\tthing\twill\thappen\tif\tthese\tare\ttwo separate\tservices.\tTypically\tconcerns\taround\tperformance\tare\tnow\traised.\tI\thave\ta\tfairly easy\tanswer\tto\tthose:\thow\tfast\tdoes\tyour\tsystem\tneed\tto\tbe?\tAnd\thow\tfast\tis\tit\tnow?\tIf you\tcan\ttest\tits\tcurrent\tperformance\tand\tknow\twhat\tgood\tperformance\tlooks\tlike,\tthen you\tshould\tfeel\tconfident\tin\tmaking\ta\tchange.\tSometimes\tmaking\tone\tthing\tslower\tin exchange\tfor\tother\tthings\tis\tthe\tright\tthing\tto\tdo,\tespecially\tif\tslower\tis\tstill\tperfectly acceptable.\n\nBut\twhat\tabout\tthe\tforeign\tkey\trelationship?\tWell,\twe\tlose\tthis\taltogether.\tThis\tbecomes\ta constraint\twe\tneed\tto\tnow\tmanage\tin\tour\tresulting\tservices\trather\tthan\tin\tthe\tdatabase level.\tThis\tmay\tmean\tthat\twe\tneed\tto\timplement\tour\town\tconsistency\tcheck\tacross services,\tor\telse\ttrigger\tactions\tto\tclean\tup\trelated\tdata.\tWhether\tor\tnot\tthis\tis\tneeded\tis often\tnot\ta\ttechnologist’s\tchoice\tto\tmake.\tFor\texample,\tif\tour\torder\tservice\tcontains\ta\tlist of\tIDs\tfor\tcatalog\titems,\twhat\thappens\tif\ta\tcatalog\titem\tis\tremoved\tand\tan\torder\tnow refers\tto\tan\tinvalid\tcatalog\tID?\tShould\twe\tallow\tit?\tIf\twe\tdo,\tthen\thow\tis\tthis\trepresented in\tthe\torder\twhen\tit\tis\tdisplayed?\tIf\twe\tdon’t,\tthen\thow\tcan\twe\tcheck\tthat\tthis\tisn’t violated?\tThese\tare\tquestions\tyou’ll\tneed\tto\tget\tanswered\tby\tthe\tpeople\twho\tdefine\thow your\tsystem\tshould\tbehave\tfor\tits\tusers.\n\nExample:\tShared\tStatic\tData\n\nI\thave\tseen\tperhaps\tas\tmany\tcountry\tcodes\tstored\tin\tdatabases\t(shown\tin\tFigure\t5-4)\tas\tI have\twritten\tStringUtils\tclasses\tfor\tin-house\tJava\tprojects.\tThis\tseems\tto\timply\tthat\twe plan\tto\tchange\tthe\tcountries\tour\tsystem\tsupports\tway\tmore\tfrequently\tthan\twe’ll\tdeploy new\tcode,\tbut\twhatever\tthe\treal\treason,\tthese\texamples\tof\tshared\tstatic\tdata\tbeing\tstored in\tdatabases\tcome\tup\ta\tlot.\tSo\twhat\tdo\twe\tdo\tin\tour\tmusic\tshop\tif\tall\tour\tpotential services\tread\tfrom\tthe\tsame\ttable\tlike\tthis?\n\nFigure\t5-4.\tCountry\tcodes\tin\tthe\tdatabase\n\nWell,\twe\thave\ta\tfew\toptions.\tOne\tis\tto\tduplicate\tthis\ttable\tfor\teach\tof\tour\tpackages,\twith the\tlong-term\tview\tthat\tit\twill\tbe\tduplicated\twithin\teach\tservice\talso.\tThis\tleads\tto\ta potential\tconsistency\tchallenge,\tof\tcourse:\twhat\thappens\tif\tI\tupdate\tone\ttable\tto\treflect\tthe creation\tof\tNewmantopia\toff\tthe\teast\tcoast\tof\tAustralia,\tbut\tnot\tanother?\n\nA\tsecond\toption\tis\tto\tinstead\ttreat\tthis\tshared,\tstatic\tdata\tas\tcode.\tPerhaps\tit\tcould\tbe\tin\ta property\tfile\tdeployed\tas\tpart\tof\tthe\tservice,\tor\tperhaps\tjust\tas\tan\tenumeration.\tThe problems\taround\tthe\tconsistency\tof\tdata\tremain,\talthough\texperience\thas\tshown\tthat\tit\tis far\teasier\tto\tpush\tout\tchanges\tto\tconfiguration\tfiles\tthan\talter\tlive\tdatabase\ttables.\tThis\tis often\ta\tvery\tsensible\tapproach.\n\nA\tthird\toption,\twhich\tmay\twell\tbe\textreme,\tis\tto\tpush\tthis\tstatic\tdata\tinto\ta\tservice\tof\tits own\tright.\tIn\ta\tcouple\tof\tsituations\tI\thave\tencountered,\tthe\tvolume,\tcomplexity,\tand\trules associated\twith\tthe\tstatic\treference\tdata\twere\tsufficient\tthat\tthis\tapproach\twas\twarranted, but\tit’s\tprobably\toverkill\tif\twe\tare\tjust\ttalking\tabout\tcountry\tcodes!\n\nPersonally,\tin\tmost\tsituations\tI’d\ttry\tto\tpush\tfor\tkeeping\tthis\tdata\tin\tconfiguration\tfiles\tor directly\tin\tcode,\tas\tit\tis\tthe\tsimple\toption\tfor\tmost\tcases.\n\nExample:\tShared\tData\n\nNow\tlet’s\tdive\tinto\ta\tmore\tcomplex\texample,\tbut\tone\tthat\tcan\tbe\ta\tcommon\tproblem when\tyou’re\ttrying\tto\ttease\tapart\tsystems:\tshared\tmutable\tdata.\tOur\tfinance\tcode\ttracks payments\tmade\tby\tcustomers\tfor\ttheir\torders,\tand\talso\ttracks\trefunds\tgiven\tto\tthem\twhen they\treturn\titems.\tMeanwhile,\tthe\twarehouse\tcode\tupdates\trecords\tto\tshow\tthat\torders\tfor customers\thave\tbeen\tdispatched\tor\treceived.\tAll\tof\tthis\tdata\tis\tdisplayed\tin\tone convenient\tplace\ton\tthe\twebsite\tso\tthat\tcustomers\tcan\tsee\twhat\tis\tgoing\ton\twith\ttheir account.\tTo\tkeep\tthings\tsimple,\twe\thave\tstored\tall\tthis\tinformation\tin\ta\tfairly\tgeneric customer\trecord\ttable,\tas\tshown\tin\tFigure\t5-5.\n\nFigure\t5-5.\tAccessing\tcustomer\tdata:\tare\twe\tmissing\tsomething?\n\nSo\tboth\tthe\tfinance\tand\tthe\twarehouse\tcode\tare\twriting\tto,\tand\tprobably\toccasionally reading\tfrom,\tthe\tsame\ttable.\tHow\tcan\twe\ttease\tthis\tapart?\tWhat\twe\tactually\thave\there\tis something\tyou’ll\tsee\toften\t—\ta\tdomain\tconcept\tthat\tisn’t\tmodeled\tin\tthe\tcode,\tand\tis\tin fact\timplicitly\tmodeled\tin\tthe\tdatabase.\tHere,\tthe\tdomain\tconcept\tthat\tis\tmissing\tis\tthat\tof Customer.\n\nWe\tneed\tto\tmake\tthe\tcurrent\tabstract\tconcept\tof\tthe\tcustomer\tconcrete.\tAs\ta\ttransient step,\twe\tcreate\ta\tnew\tpackage\tcalled\tCustomer.\tWe\tcan\tthen\tuse\tan\tAPI\tto\texpose Customer\tcode\tto\tother\tpackages,\tsuch\tas\tfinance\tor\twarehouse.\tRolling\tthis\tall\tthe\tway forward,\twe\tmay\tnow\tend\tup\twith\ta\tdistinct\tcustomer\tservice\t(Figure\t5-6).\n\nFigure\t5-6.\tRecognizing\tthe\tbounded\tcontext\tof\tthe\tcustomer\n\nExample:\tShared\tTables\n\nFigure\t5-7\tshows\tour\tlast\texample.\tOur\tcatalog\tneeds\tto\tstore\tthe\tname\tand\tprice\tof\tthe records\twe\tsell,\tand\tthe\twarehouse\tneeds\tto\tkeep\tan\telectronic\trecord\tof\tinventory.\tWe decide\tto\tkeep\tthese\ttwo\tthings\tin\tthe\tsame\tplace\tin\ta\tgeneric\tline\titem\ttable.\tBefore,\twith all\tthe\tcode\tmerged\tin\ttogether,\tit\twasn’t\tclear\tthat\twe\tare\tactually\tconflating\tconcerns, but\tnow\twe\tcan\tsee\tthat\tin\tfact\twe\thave\ttwo\tseparate\tconcepts\tthat\tcould\tbe\tstored differently.\n\nFigure\t5-7.\tTables\tbeing\tshared\tbetween\tdifferent\tcontexts\n\nThe\tanswer\there\tis\tto\tsplit\tthe\ttable\tin\ttwo\tas\twe\thave\tin\tFigure\t5-8,\tperhaps\tcreating\ta stock\tlist\ttable\tfor\tthe\twarehouse,\tand\ta\tcatalog\tentry\ttable\tfor\tthe\tcatalog\tdetails.\n\nFigure\t5-8.\tPulling\tapart\tthe\tshared\ttable\n\nRefactoring\tDatabases\n\nWhat\twe\thave\tcovered\tin\tthe\tpreceding\texamples\tare\ta\tfew\tdatabase\trefactorings\tthat\tcan help\tyou\tseparate\tyour\tschemas.\tFor\ta\tmore\tdetailed\tdiscussion\tof\tthe\tsubject,\tyou\tmay want\tto\ttake\ta\tlook\tat\tRefactoring\tDatabases\tby\tScott\tJ.\tAmbler\tand\tPramod\tJ.\tSadalage (Addison-Wesley).\n\nStaging\tthe\tBreak\n\nSo\twe’ve\tfound\tseams\tin\tour\tapplication\tcode,\tgrouping\tit\taround\tbounded\tcontexts. We’ve\tused\tthis\tto\tidentify\tseams\tin\tthe\tdatabase,\tand\twe’ve\tdone\tour\tbest\tto\tsplit\tthose out.\tWhat\tnext?\tDo\tyou\tdo\ta\tbig-bang\trelease,\tgoing\tfrom\tone\tmonolithic\tservice\twith\ta single\tschema\tto\ttwo\tservices,\teach\twith\tits\town\tschema?\tI\twould\tactually\trecommend that\tyou\tsplit\tout\tthe\tschema\tbut\tkeep\tthe\tservice\ttogether\tbefore\tsplitting\tthe\tapplication code\tout\tinto\tseparate\tmicroservices,\tas\tshown\tin\tFigure\t5-9.\n\nFigure\t5-9.\tStaging\ta\tservice\tseparation\n\nWith\ta\tseparate\tschema,\twe’ll\tbe\tpotentially\tincreasing\tthe\tnumber\tof\tdatabase\tcalls\tto perform\ta\tsingle\taction.\tWhere\tbefore\twe\tmight\thave\tbeen\table\tto\thave\tall\tthe\tdata\twe wanted\tin\ta\tsingle\tSELECT\tstatement,\tnow\twe\tmay\tneed\tto\tpull\tthe\tdata\tback\tfrom\ttwo locations\tand\tjoin\tin\tmemory.\tAlso,\twe\tend\tup\tbreaking\ttransactional\tintegrity\twhen\twe move\tto\ttwo\tschemas,\twhich\tcould\thave\tsignificant\timpact\ton\tour\tapplications;\twe’ll\tbe discussing\tthis\tnext.\tBy\tsplitting\tthe\tschemas\tout\tbut\tkeeping\tthe\tapplication\tcode together,\twe\tgive\tourselves\tthe\tability\tto\trevert\tour\tchanges\tor\tcontinue\tto\ttweak\tthings without\timpacting\tany\tconsumers\tof\tour\tservice.\tOnce\twe\tare\tsatisfied\tthat\tthe\tDB separation\tmakes\tsense,\twe\tcan\tthen\tthink\tabout\tsplitting\tout\tthe\tapplication\tcode\tinto\ttwo services.\n\nTransactional\tBoundaries\n\nTransactions\tare\tuseful\tthings.\tThey\tallow\tus\tto\tsay\tthese\tevents\teither\tall\thappen together,\tor\tnone\tof\tthem\thappen.\tThey\tare\tvery\tuseful\twhen\twe’re\tinserting\tdata\tinto\ta database;\tthey\tlet\tus\tupdate\tmultiple\ttables\tat\tonce,\tknowing\tthat\tif\tanything\tfails, everything\tgets\trolled\tback,\tensuring\tour\tdata\tdoesn’t\tget\tinto\tan\tinconsistent\tstate. Simply\tput,\ta\ttransaction\tallows\tus\tto\tgroup\ttogether\tmultiple\tdifferent\tactivities\tthat\ttake our\tsystem\tfrom\tone\tconsistent\tstate\tto\tanother\t—\teverything\tworks,\tor\tnothing\tchanges.\n\nTransactions\tdon’t\tjust\tapply\tto\tdatabases,\talthough\twe\tmost\toften\tuse\tthem\tin\tthat context.\tMessage\tbrokers,\tfor\texample,\thave\tlong\tallowed\tyou\tto\tpost\tand\treceive messages\twithin\ttransactions\ttoo.\n\nWith\ta\tmonolithic\tschema,\tall\tour\tcreate\tor\tupdates\twill\tprobably\tbe\tdone\twithin\ta\tsingle transactional\tboundary.\tWhen\twe\tsplit\tapart\tour\tdatabases,\twe\tlose\tthe\tsafety\tafforded\tto us\tby\thaving\ta\tsingle\ttransaction.\tConsider\ta\tsimple\texample\tin\tthe\tMusicCorp\tcontext. When\tcreating\tan\torder,\tI\twant\tto\tupdate\tthe\torder\ttable\tstating\tthat\ta\tcustomer\torder\thas been\tcreated,\tand\talso\tput\tan\tentry\tinto\ta\ttable\tfor\tthe\twarehouse\tteam\tso\tit\tknows\tthere\tis an\torder\tthat\tneeds\tto\tbe\tpicked\tfor\tdispatch.\tWe’ve\tgotten\tas\tfar\tas\tgrouping\tour application\tcode\tinto\tseparate\tpackages,\tand\thave\talso\tseparated\tthe\tcustomer\tand warehouse\tparts\tof\tthe\tschema\twell\tenough\tthat\twe\tare\tready\tto\tput\tthem\tinto\ttheir\town schemas\tprior\tto\tseparating\tthe\tapplication\tcode.\n\nWithin\ta\tsingle\ttransaction\tin\tour\texisting\tmonolithic\tschema,\tcreating\tthe\torder\tand inserting\tthe\trecord\tfor\tthe\twarehouse\tteam\ttakes\tplace\twithin\ta\tsingle\ttransaction,\tas shown\tin\tFigure\t5-10.\n\nFigure\t5-10.\tUpdating\ttwo\ttables\tin\ta\tsingle\ttransaction\n\nBut\tif\twe\thave\tpulled\tapart\tthe\tschema\tinto\ttwo\tseparate\tschemas,\tone\tfor\tcustomer- related\tdata\tincluding\tour\torder\ttable,\tand\tanother\tfor\tthe\twarehouse,\twe\thave\tlost\tthis transactional\tsafety.\tThe\torder\tplacing\tprocess\tnow\tspans\ttwo\tseparate\ttransactional boundaries,\tas\twe\tsee\tin\tFigure\t5-11.\tIf\tour\tinsert\tinto\tthe\torder\ttable\tfails,\twe\tcan\tclearly stop\teverything,\tleaving\tus\tin\ta\tconsistent\tstate.\tBut\twhat\thappens\twhen\tthe\tinsert\tinto\tthe order\ttable\tworks,\tbut\tthe\tinsert\tinto\tthe\tpicking\ttable\tfails?\n\nFigure\t5-11.\tSpanning\ttransactional\tboundaries\tfor\ta\tsingle\toperation\n\nTry\tAgain\tLater\n\nThe\tfact\tthat\tthe\torder\twas\tcaptured\tand\tplaced\tmight\tbe\tenough\tfor\tus,\tand\twe\tmay decide\tto\tretry\tthe\tinsertion\tinto\tthe\twarehouse’s\tpicking\ttable\tat\ta\tlater\tdate.\tWe\tcould queue\tup\tthis\tpart\tof\tthe\toperation\tin\ta\tqueue\tor\tlogfile,\tand\ttry\tagain\tlater.\tFor\tsome\tsorts of\toperations\tthis\tmakes\tsense,\tbut\twe\thave\tto\tassume\tthat\ta\tretry\twould\tfix\tit.\n\nIn\tmany\tways,\tthis\tis\tanother\tform\tof\twhat\tis\tcalled\teventual\tconsistency.\tRather\tthan using\ta\ttransactional\tboundary\tto\tensure\tthat\tthe\tsystem\tis\tin\ta\tconsistent\tstate\twhen\tthe transaction\tcompletes,\tinstead\twe\taccept\tthat\tthe\tsystem\twill\tget\titself\tinto\ta\tconsistent state\tat\tsome\tpoint\tin\tthe\tfuture.\tThis\tapproach\tis\tespecially\tuseful\twith\tbusiness operations\tthat\tmight\tbe\tlong-lived.\tWe’ll\tdiscuss\tthis\tidea\tin\tmore\tdepth\tin\tChapter\t11 when\twe\tcover\tscaling\tpatterns.\n\nAbort\tthe\tEntire\tOperation\n\nAnother\toption\tis\tto\treject\tthe\tentire\toperation.\tIn\tthis\tcase,\twe\thave\tto\tput\tthe\tsystem back\tinto\ta\tconsistent\tstate.\tThe\tpicking\ttable\tis\teasy,\tas\tthat\tinsert\tfailed,\tbut\twe\thave\ta committed\ttransaction\tin\tthe\torder\ttable.\tWe\tneed\tto\tunwind\tthis.\tWhat\twe\thave\tto\tdo\tis issue\ta\tcompensating\ttransaction,\tkicking\toff\ta\tnew\ttransaction\tto\twind\tback\twhat\tjust happened.\tFor\tus,\tthat\tcould\tbe\tsomething\tas\tsimple\tas\tissuing\ta\tDELETE\tstatement\tto remove\tthe\torder\tfrom\tthe\tdatabase.\tThen\twe’d\talso\tneed\tto\treport\tback\tvia\tthe\tUI\tthat\tthe operation\tfailed.\tOur\tapplication\tcould\thandle\tboth\taspects\twithin\ta\tmonolithic\tsystem, but\twe’d\thave\tto\tconsider\twhat\twe\tcould\tdo\twhen\twe\tsplit\tup\tthe\tapplication\tcode.\tDoes the\tlogic\tto\thandle\tthe\tcompensating\ttransaction\tlive\tin\tthe\tcustomer\tservice,\tthe\torder service,\tor\tsomewhere\telse?\n\nBut\twhat\thappens\tif\tour\tcompensating\ttransaction\tfails?\tIt’s\tcertainly\tpossible.\tThen\twe’d have\tan\torder\tin\tthe\torder\ttable\twith\tno\tmatching\tpick\tinstruction.\tIn\tthis\tsituation,\tyou’d either\tneed\tto\tretry\tthe\tcompensating\ttransaction,\tor\tallow\tsome\tbackend\tprocess\tto\tclean up\tthe\tinconsistency\tlater\ton.\tThis\tcould\tbe\tsomething\tas\tsimple\tas\ta\tmaintenance\tscreen that\tadmin\tstaff\thad\taccess\tto,\tor\tan\tautomated\tprocess.\n\nNow\tthink\tabout\twhat\thappens\tif\twe\thave\tnot\tone\tor\ttwo\toperations\twe\twant\tto\tbe consistent,\tbut\tthree,\tfour,\tor\tfive.\tHandling\tcompensating\ttransactions\tfor\teach\tfailure mode\tbecomes\tquite\tchallenging\tto\tcomprehend,\tlet\talone\timplement.\n\nDistributed\tTransactions\n\nAn\talternative\tto\tmanually\torchestrating\tcompensating\ttransactions\tis\tto\tuse\ta\tdistributed transaction.\tDistributed\ttransactions\ttry\tto\tspan\tmultiple\ttransactions\twithin\tthem,\tusing some\toverall\tgoverning\tprocess\tcalled\ta\ttransaction\tmanager\tto\torchestrate\tthe\tvarious transactions\tbeing\tdone\tby\tunderlying\tsystems.\tJust\tas\twith\ta\tnormal\ttransaction,\ta distributed\ttransaction\ttries\tto\tensure\tthat\teverything\tremains\tin\ta\tconsistent\tstate,\tonly\tin this\tcase\tit\ttries\tto\tdo\tso\tacross\tmultiple\tdifferent\tsystems\trunning\tin\tdifferent\tprocesses, often\tcommunicating\tacross\tnetwork\tboundaries.\n\nThe\tmost\tcommon\talgorithm\tfor\thandling\tdistributed\ttransactions\t—\tespecially\tshort- lived\ttransactions,\tas\tin\tthe\tcase\tof\thandling\tour\tcustomer\torder\t—\tis\tto\tuse\ta\ttwo-phase commit.\tWith\ta\ttwo-phase\tcommit,\tfirst\tcomes\tthe\tvoting\tphase.\tThis\tis\twhere\teach participant\t(also\tcalled\ta\tcohort\tin\tthis\tcontext)\tin\tthe\tdistributed\ttransaction\ttells\tthe transaction\tmanager\twhether\tit\tthinks\tits\tlocal\ttransaction\tcan\tgo\tahead.\tIf\tthe\ttransaction manager\tgets\ta\tyes\tvote\tfrom\tall\tparticipants,\tthen\tit\ttells\tthem\tall\tto\tgo\tahead\tand\tperform their\tcommits.\tA\tsingle\tno\tvote\tis\tenough\tfor\tthe\ttransaction\tmanager\tto\tsend\tout\ta rollback\tto\tall\tparties.\n\nThis\tapproach\trelies\ton\tall\tparties\thalting\tuntil\tthe\tcentral\tcoordinating\tprocess\ttells\tthem to\tproceed.\tThis\tmeans\twe\tare\tvulnerable\tto\toutages.\tIf\tthe\ttransaction\tmanager\tgoes down,\tthe\tpending\ttransactions\tnever\tcomplete.\tIf\ta\tcohort\tfails\tto\trespond\tduring\tvoting, everything\tblocks.\tAnd\tthere\tis\talso\tthe\tcase\tof\twhat\thappens\tif\ta\tcommit\tfails\tafter voting.\tThere\tis\tan\tassumption\timplicit\tin\tthis\talgorithm\tthat\tthis\tcannot\thappen:\tif\ta cohort\tsays\tyes\tduring\tthe\tvoting\tperiod,\tthen\twe\thave\tto\tassume\tit\twill\tcommit.\tCohorts need\ta\tway\tof\tmaking\tthis\tcommit\twork\tat\tsome\tpoint.\tThis\tmeans\tthis\talgorithm\tisn’t foolproof\t—\trather,\tit\tjust\ttries\tto\tcatch\tmost\tfailure\tcases.\n\nThis\tcoordination\tprocess\talso\tmean\tlocks;\tthat\tis,\tpending\ttransactions\tcan\thold\tlocks\ton resources.\tLocks\ton\tresources\tcan\tlead\tto\tcontention,\tmaking\tscaling\tsystems\tmuch\tmore difficult,\tespecially\tin\tthe\tcontext\tof\tdistributed\tsystems.\n\nDistributed\ttransactions\thave\tbeen\timplemented\tfor\tspecific\ttechnology\tstacks,\tsuch\tas Java’s\tTransaction\tAPI,\tallowing\tfor\tdisparate\tresources\tlike\ta\tdatabase\tand\ta\tmessage queue\tto\tall\tparticipate\tin\tthe\tsame,\toverarching\ttransaction.\tThe\tvarious\talgorithms\tare hard\tto\tget\tright,\tso\tI’d\tsuggest\tyou\tavoid\ttrying\tto\tcreate\tyour\town.\tInstead,\tdo\tlots\tof research\ton\tthis\ttopic\tif\tthis\tseems\tlike\tthe\troute\tyou\twant\tto\ttake,\tand\tsee\tif\tyou\tcan\tuse an\texisting\timplementation.\n\nSo\tWhat\tto\tDo?\n\nAll\tof\tthese\tsolutions\tadd\tcomplexity.\tAs\tyou\tcan\tsee,\tdistributed\ttransactions\tare\thard\tto get\tright\tand\tcan\tactually\tinhibit\tscaling.\tSystems\tthat\teventually\tconverge\tthrough compensating\tretry\tlogic\tcan\tbe\tharder\tto\treason\tabout,\tand\tmay\tneed\tother\tcompensating behavior\tto\tfix\tup\tinconsistencies\tin\tdata.\n\nWhen\tyou\tencounter\tbusiness\toperations\tthat\tcurrently\toccur\twithin\ta\tsingle\ttransaction, ask\tyourself\tif\tthey\treally\tneed\tto.\tCan\tthey\thappen\tin\tdifferent,\tlocal\ttransactions,\tand rely\ton\tthe\tconcept\tof\teventual\tconsistency?\tThese\tsystems\tare\tmuch\teasier\tto\tbuild\tand scale\t(we’ll\tdiscuss\tthis\tmore\tin\tChapter\t11).\n\nIf\tyou\tdo\tencounter\tstate\tthat\treally,\treally\twants\tto\tbe\tkept\tconsistent,\tdo\teverything\tyou can\tto\tavoid\tsplitting\tit\tup\tin\tthe\tfirst\tplace.\tTry\treally\thard.\tIf\tyou\treally\tneed\tto\tgo\tahead with\tthe\tsplit,\tthink\tabout\tmoving\tfrom\ta\tpurely\ttechnical\tview\tof\tthe\tprocess\t(e.g.,\ta database\ttransaction)\tand\tactually\tcreate\ta\tconcrete\tconcept\tto\trepresent\tthe\ttransaction itself.\tThis\tgives\tyou\ta\thandle,\tor\ta\thook,\ton\twhich\tto\trun\tother\toperations\tlike compensating\ttransactions,\tand\ta\tway\tto\tmonitor\tand\tmanage\tthese\tmore\tcomplex concepts\tin\tyour\tsystem.\tFor\texample,\tyou\tmight\tcreate\tthe\tidea\tof\tan\t“in-process-order” that\tgives\tyou\ta\tnatural\tplace\tto\tfocus\tall\tlogic\taround\tprocessing\tthe\torder\tend\tto\tend (and\tdealing\twith\texceptions).\n\nReporting\n\nAs\twe’ve\talready\tseen,\tin\tsplitting\ta\tservice\tinto\tsmaller\tparts,\twe\tneed\tto\talso\tpotentially split\tup\thow\tand\twhere\tdata\tis\tstored.\tThis\tcreates\ta\tproblem,\thowever,\twhen\tit\tcomes\tto one\tvital\tand\tcommon\tuse\tcase:\treporting.\n\nA\tchange\tin\tarchitecture\tas\tfundamental\tas\tmoving\tto\ta\tmicroservices\tarchitecture\twill cause\ta\tlot\tof\tdisruption,\tbut\tit\tdoesn’t\tmean\twe\thave\tto\tabandon\teverything\twe\tdo.\tThe audience\tof\tour\treporting\tsystems\tare\tusers\tlike\tany\tother,\tand\twe\tneed\tto\tconsider\ttheir needs.\tIt\twould\tbe\tarrogant\tto\tfundamentally\tchange\tour\tarchitecture\tand\tjust\task\tthem\tto adapt.\tWhile\tI’m\tnot\tsuggesting\tthat\tthe\tspace\tof\treporting\tisn’t\tripe\tfor\tdisruption\t—\tit certainly\tis\t—\tthere\tis\tvalue\tin\tdetermining\thow\tto\twork\twith\texisting\tprocesses\tfirst. Sometimes\twe\thave\tto\tpick\tour\tbattles.\n\nThe\tReporting\tDatabase\n\nReporting\ttypically\tneeds\tto\tgroup\ttogether\tdata\tfrom\tacross\tmultiple\tparts\tof\tour organization\tin\torder\tto\tgenerate\tuseful\toutput.\tFor\texample,\twe\tmight\twant\tto\tenrich\tthe data\tfrom\tour\tgeneral\tledger\twith\tdescriptions\tof\twhat\twas\tsold,\twhich\twe\tget\tfrom\ta catalog.\tOr\twe\tmight\twant\tto\tlook\tat\tthe\tshopping\tbehavior\tof\tspecific,\thigh-value customers,\twhich\tcould\trequire\tinformation\tfrom\ttheir\tpurchase\thistory\tand\ttheir\tcustomer profile.\n\nIn\ta\tstandard,\tmonolithic\tservice\tarchitecture,\tall\tour\tdata\tis\tstored\tin\tone\tbig\tdatabase. This\tmeans\tall\tthe\tdata\tis\tin\tone\tplace,\tso\treporting\tacross\tall\tthe\tinformation\tis\tactually pretty\teasy,\tas\twe\tcan\tsimply\tjoin\tacross\tthe\tdata\tvia\tSQL\tqueries\tor\tthe\tlike.\tTypically\twe won’t\trun\tthese\treports\ton\tthe\tmain\tdatabase\tfor\tfear\tof\tthe\tload\tgenerated\tby\tour\tqueries impacting\tthe\tperformance\tof\tthe\tmain\tsystem,\tso\toften\tthese\treporting\tsystems\thang\ton\ta read\treplica\tas\tshown\tin\tFigure\t5-12.\n\nFigure\t5-12.\tStandard\tread\treplication\n\nWith\tthis\tapproach\twe\thave\tone\tsizeable\tupside\t—\tthat\tall\tthe\tdata\tis\talready\tin\tone\tplace, so\twe\tcan\tuse\tfairly\tstraightforward\ttools\tto\tquery\tit.\tBut\tthere\tare\talso\ta\tcouple\tof downsides\twith\tthis\tapproach.\tFirst,\tthe\tschema\tof\tthe\tdatabase\tis\tnow\teffectively\ta\tshared API\tbetween\tthe\trunning\tmonolithic\tservices\tand\tany\treporting\tsystem.\tSo\ta\tchange\tin schema\thas\tto\tbe\tcarefully\tmanaged.\tIn\treality,\tthis\tis\tanother\timpediment\tthat\treduces\tthe chances\tof\tanyone\twanting\tto\ttake\ton\tthe\ttask\tof\tmaking\tand\tcoordinating\tsuch\ta\tchange.\n\nSecond,\twe\thave\tlimited\toptions\tas\tto\thow\tthe\tdatabase\tcan\tbe\toptimized\tfor\teither\tuse case\t—\tbacking\tthe\tlive\tsystem\tor\tthe\treporting\tsystem.\tSome\tdatabases\tlet\tus\tmake\n\noptimizations\ton\tread\treplicas\tto\tenable\tfaster,\tmore\tefficient\treporting;\tfor\texample, MySQL\twould\tallow\tus\tto\trun\ta\tdifferent\tbackend\tthat\tdoesn’t\thave\tthe\toverhead\tof managing\ttransactions.\tHowever,\twe\tcannot\tstructure\tthe\tdata\tdifferently\tto\tmake reporting\tfaster\tif\tthat\tchange\tin\tdata\tstructure\thas\ta\tbad\timpact\ton\tthe\trunning\tsystem. What\toften\thappens\tis\tthat\tthe\tschema\teither\tends\tup\tbeing\tgreat\tfor\tone\tuse\tcase\tand lousy\tfor\tthe\tother,\tor\telse\tbecomes\tthe\tlowest\tcommon\tdenominator,\tgreat\tfor\tneither purpose.\n\nFinally,\tthe\tdatabase\toptions\tavailable\tto\tus\thave\texploded\trecently.\tWhile\tstandard relational\tdatabases\texpose\tSQL\tquery\tinterfaces\tthat\twork\twith\tmany\treporting\ttools, they\taren’t\talways\tthe\tbest\toption\tfor\tstoring\tdata\tfor\tour\trunning\tservices.\tWhat\tif\tour application\tdata\tis\tbetter\tmodeled\tas\ta\tgraph,\tas\tin\tNeo4j?\tOr\twhat\tif\twe’d\trather\tuse\ta document\tstore\tlike\tMongoDB?\tLikewise,\twhat\tif\twe\twanted\tto\texplore\tusing\ta\tcolumn- oriented\tdatabase\tlike\tCassandra\tfor\tour\treporting\tsystem,\twhich\tmakes\tit\tmuch\teasier\tto scale\tfor\tlarger\tvolumes?\tBeing\tconstrained\tin\thaving\tto\thave\tone\tdatabase\tfor\tboth purposes\tresults\tin\tus\toften\tnot\tbeing\table\tto\tmake\tthese\tchoices\tand\texplore\tnew\toptions.\n\nSo\tit’s\tnot\tperfect,\tbut\tit\tworks\t(mostly).\tNow\tif\tour\tinformation\tis\tstored\tin\tmultiple different\tsystems,\twhat\tdo\twe\tdo?\tIs\tthere\ta\tway\tfor\tus\tto\tbring\tall\tthe\tdata\ttogether\tto\trun our\treports?\tAnd\tcould\twe\talso\tpotentially\tfind\ta\tway\tto\teliminate\tsome\tof\tthe\tdownsides associated\twith\tthe\tstandard\treporting\tdatabase\tmodel?\n\nIt\tturns\tout\twe\thave\ta\tnumber\tof\tviable\talternatives\tto\tthis\tapproach.\tWhich\tsolution makes\tthe\tmost\tsense\tto\tyou\twill\tdepend\ton\ta\tnumber\tof\tfactors,\tbut\twe’ll\texplore\ta\tfew different\toptions\tthat\tI\thave\tseen\tin\tpractice.\n\nData\tRetrieval\tvia\tService\tCalls\n\nThere\tare\tmany\tvariants\tof\tthis\tmodel,\tbut\tthey\tall\trely\ton\tpulling\tthe\trequired\tdata\tfrom the\tsource\tsystems\tvia\tAPI\tcalls.\tFor\ta\tvery\tsimple\treporting\tsystem,\tlike\ta\tdashboard\tthat might\tjust\twant\tto\tshow\tthe\tnumber\tof\torders\tplaced\tin\tthe\tlast\t15\tminutes,\tthis\tmight\tbe fine.\tTo\treport\tacross\tdata\tfrom\ttwo\tor\tmore\tsystems,\tyou\tneed\tto\tmake\tmultiple\tcalls\tto assemble\tthis\tdata.\n\nThis\tapproach\tbreaks\tdown\trapidly\twith\tuse\tcases\tthat\trequire\tlarger\tvolumes\tof\tdata, however.\tImagine\ta\tuse\tcase\twhere\twe\twant\tto\treport\ton\tcustomer\tpurchasing\tbehavior\tfor our\tmusic\tshop\tover\tthe\tlast\t24\tmonths,\tlooking\tat\tvarious\ttrends\tin\tcustomer\tbehavior and\thow\tthis\thas\timpacted\ton\trevenue.\tWe\tneed\tto\tpull\tlarge\tvolumes\tof\tdata\tfrom\tat\tleast the\tcustomer\tand\tfinance\tsystems.\tKeeping\ta\tlocal\tcopy\tof\tthis\tdata\tin\tthe\treporting system\tis\tdangerous,\tas\twe\tmay\tnot\tknow\tif\tit\thas\tchanged\t(even\thistoric\tdata\tmay\tbe changed\tafter\tthe\tfact),\tso\tto\tgenerate\tan\taccurate\treport\twe\tneed\tall\tof\tthe\tfinance\tand customer\trecords\tfor\tthe\tlast\ttwo\tyears.\tWith\teven\tmodest\tnumbers\tof\tcustomers,\tyou\tcan see\tthat\tthis\tquickly\twill\tbecome\ta\tvery\tslow\toperation.\n\nReporting\tsystems\talso\toften\trely\ton\tthird-party\ttools\tthat\texpect\tto\tretrieve\tdata\tin\ta certain\tway,\tand\there\tproviding\ta\tSQL\tinterface\tis\tthe\tfastest\tway\tto\tensure\tyour\treporting tool\tchain\tis\tas\teasy\tto\tintegrate\twith\tas\tpossible.\tWe\tcould\tstill\tuse\tthis\tapproach\tto\tpull data\tperiodically\tinto\ta\tSQL\tdatabase,\tof\tcourse,\tbut\tthis\tstill\tpresents\tus\twith\tsome challenges.\n\nOne\tof\tthe\tkey\tchallenges\tis\tthat\tthe\tAPIs\texposed\tby\tthe\tvarious\tmicroservices\tmay\twell not\tbe\tdesigned\tfor\treporting\tuse\tcases.\tFor\texample,\ta\tcustomer\tservice\tmay\tallow\tus\tto find\ta\tcustomer\tby\tan\tID,\tor\tsearch\tfor\ta\tcustomer\tby\tvarious\tfields,\tbut\twouldn’t necessarily\texpose\tan\tAPI\tto\tretrieve\tall\tcustomers.\tThis\tcould\tlead\tto\tmany\tcalls\tbeing made\tto\tretrieve\tall\tthe\tdata\t—\tfor\texample,\thaving\tto\titerate\tthrough\ta\tlist\tof\tall\tthe customers,\tmaking\ta\tseparate\tcall\tfor\teach\tone.\tNot\tonly\tcould\tthis\tbe\tinefficient\tfor\tthe reporting\tsystem,\tit\tcould\tgenerate\tload\tfor\tthe\tservice\tin\tquestion\ttoo.\n\nWhile\twe\tcould\tspeed\tup\tsome\tof\tthe\tdata\tretrieval\tby\tadding\tcache\theaders\tto\tthe resources\texposed\tby\tour\tservice,\tand\thave\tthis\tdata\tcached\tin\tsomething\tlike\ta\treverse proxy,\tthe\tnature\tof\treporting\tis\toften\tthat\twe\taccess\tthe\tlong\ttail\tof\tdata.\tThis\tmeans\tthat we\tmay\twell\trequest\tresources\tthat\tno\tone\telse\thas\trequested\tbefore\t(or\tat\tleast\tnot\tfor\ta sufficiently\tlong\ttime),\tresulting\tin\ta\tpotentially\texpensive\tcache\tmiss.\n\nYou\tcould\tresolve\tthis\tby\texposing\tbatch\tAPIs\tto\tmake\treporting\teasier.\tFor\texample,\tour customer\tservice\tcould\tallow\tyou\tto\tpass\ta\tlist\tof\tcustomer\tIDs\tto\tit\tto\tretrieve\tthem\tin batches,\tor\tmay\teven\texpose\tan\tinterface\tthat\tlets\tyou\tpage\tthrough\tall\tthe\tcustomers.\tA more\textreme\tversion\tof\tthis\tis\tto\tmodel\tthe\tbatch\trequest\tas\ta\tresource\tin\tits\town\tright. For\texample,\tthe\tcustomer\tservice\tmight\texpose\tsomething\tlike\ta\tBatchCustomerExport resource\tendpoint.\tThe\tcalling\tsystem\twould\tPOST\ta\tBatchRequest,\tperhaps\tpassing\tin\ta\n\nlocation\twhere\ta\tfile\tcan\tbe\tplaced\twith\tall\tthe\tdata.\tThe\tcustomer\tservice\twould\treturn\tan HTTP\t202\tresponse\tcode,\tindicating\tthat\tthe\trequest\twas\taccepted\tbut\thas\tnot\tyet\tbeen processed.\tThe\tcalling\tsystem\tcould\tthen\tpoll\tthe\tresource\twaiting\tuntil\tit\tretrieves\ta\t201 Created\tstatus,\tindicating\tthat\tthe\trequest\thas\tbeen\tfulfilled,\tand\tthen\tthe\tcalling\tsystem could\tgo\tand\tfetch\tthe\tdata.\tThis\twould\tallow\tpotentially\tlarge\tdata\tfiles\tto\tbe\texported without\tthe\toverhead\tof\tbeing\tsent\tover\tHTTP;\tinstead,\tthe\tsystem\tcould\tsimply\tsave\ta CSV\tfile\tto\ta\tshared\tlocation.\n\nI\thave\tseen\tthe\tpreceding\tapproach\tused\tfor\tbatch\tinsertion\tof\tdata,\twhere\tit\tworked\twell. I\tam\tless\tin\tfavor\tof\tit\tfor\treporting\tsystems,\thowever,\tas\tI\tfeel\tthat\tthere\tare\tother, potentially\tsimpler\tsolutions\tthat\tcan\tscale\tmore\teffectively\twhen\tyou’re\tdealing\twith traditional\treporting\tneeds.\n\nData\tPumps\n\nRather\tthan\thave\tthe\treporting\tsystem\tpull\tthe\tdata,\twe\tcould\tinstead\thave\tthe\tdata\tpushed to\tthe\treporting\tsystem.\tOne\tof\tthe\tdownsides\tof\tretrieving\tthe\tdata\tby\tstandard\tHTTP calls\tis\tthe\toverhead\tof\tHTTP\twhen\twe’re\tmaking\ta\tlarge\tnumber\tof\tcalls,\ttogether\twith the\toverhead\tof\thaving\tto\tcreate\tAPIs\tthat\tmay\texist\tonly\tfor\treporting\tpurposes.\tAn alternative\toption\tis\tto\thave\ta\tstandalone\tprogram\tthat\tdirectly\taccesses\tthe\tdatabase\tof the\tservice\tthat\tis\tthe\tsource\tof\tdata,\tand\tpumps\tit\tinto\ta\treporting\tdatabase,\tas\tshown\tin Figure\t5-13.\n\nFigure\t5-13.\tUsing\ta\tdata\tpump\tto\tperiodically\tpush\tdata\tto\ta\tcentral\treporting\tdatabase\n\nAt\tthis\tpoint\tyou’ll\tbe\tsaying,\t“But\tSam,\tyou\tsaid\thaving\tlots\tof\tprograms\tintegrating\ton the\tsame\tdatabase\tis\ta\tbad\tidea!”\tAt\tleast\tI\thope\tyou’ll\tbe\tsaying\tthat,\tgiven\thow\tfirmly\tI made\tthe\tpoint\tearlier!\tThis\tapproach,\tif\timplemented\tproperly,\tis\ta\tnotable\texception, where\tthe\tdownsides\tof\tthe\tcoupling\tare\tmore\tthan\tmitigated\tby\tmaking\tthe\treporting easier.\n\nTo\tstart\twith,\tthe\tdata\tpump\tshould\tbe\tbuilt\tand\tmanaged\tby\tthe\tsame\tteam\tthat\tmanages the\tservice.\tThis\tcan\tbe\tsomething\tas\tsimple\tas\ta\tcommand-line\tprogram\ttriggered\tvia Cron.\tThis\tprogram\tneeds\tto\thave\tintimate\tknowledge\tof\tboth\tthe\tinternal\tdatabase\tfor\tthe service,\tand\talso\tthe\treporting\tschema.\tThe\tpump’s\tjob\tis\tto\tmap\tone\tfrom\tthe\tother.\tWe try\tto\treduce\tthe\tproblems\twith\tcoupling\tto\tthe\tservice’s\tschema\tby\thaving\tthe\tsame\tteam that\tmanages\tthe\tservice\talso\tmanage\tthe\tpump.\tI\twould\tsuggest,\tin\tfact,\tthat\tyou\tversion- control\tthese\ttogether,\tand\thave\tbuilds\tof\tthe\tdata\tpump\tcreated\tas\tan\tadditional\tartifact\tas part\tof\tthe\tbuild\tof\tthe\tservice\titself,\twith\tthe\tassumption\tthat\twhenever\tyou\tdeploy\tone\tof them,\tyou\tdeploy\tthem\tboth.\tAs\twe\texplicitly\tstate\tthat\twe\tdeploy\tthese\ttogether,\tand don’t\topen\tup\taccess\tto\tthe\tschema\tto\tanyone\toutside\tof\tthe\tservice\tteam,\tmany\tof\tthe traditional\tDB\tintegration\tchallenges\tare\tlargely\tmitigated.\n\nThe\tcoupling\ton\tthe\treporting\tschema\titself\tremains,\tbut\twe\thave\tto\ttreat\tit\tas\ta\tpublished API\tthat\tis\thard\tto\tchange.\tSome\tdatabases\tgive\tus\ttechniques\twhere\twe\tcould\tfurther mitigate\tthis\tcost.\tFigure\t5-14\tshows\tan\texample\tof\tthis\tfor\trelational\tdatabases,\twhere\twe could\thave\tone\tschema\tin\tthe\treporting\tdatabase\tfor\teach\tservice,\tusing\tthings\tlike\n\nmaterialized\tviews\tto\tcreate\tthe\taggregated\tview.\tThat\tway,\twe\texpose\tonly\tthe\treporting schema\tfor\tthe\tcustomer\tdata\tto\tthe\tcustomer\tdata\tpump.\tWhether\tthis\tis\tsomething\tthat you\tcan\tdo\tin\ta\tperformant\tmanner,\thowever,\twill\tdepend\ton\tthe\tcapabilities\tof\tthe database\tyou\tpicked\tfor\treporting.\n\nFigure\t5-14.\tUtilizing\tmaterialized\tviews\tto\tform\ta\tsingle\tmonolithic\treporting\tschema\n\nHere,\tof\tcourse,\tthe\tcomplexity\tof\tintegration\tis\tpushed\tdeeper\tinto\tthe\tschema,\tand\twill rely\ton\tcapabilities\tin\tthe\tdatabase\tto\tmake\tsuch\ta\tsetup\tperformant.\tWhile\tI\tthink\tdata pumps\tin\tgeneral\tare\ta\tsensible\tand\tworkable\tsuggestion,\tI\tam\tless\tconvinced\tthat\tthe complexity\tof\ta\tsegmented\tschema\tis\tworthwhile,\tespecially\tgiven\tthe\tchallenges\tin managing\tchange\tin\tthe\tdatabase.\n\nAlternative\tDestinations\n\nOn\tone\tproject\tI\twas\tinvolved\twith,\twe\tused\ta\tseries\tof\tdata\tpumps\tto\tpopulate\tJSON\tfiles in\tAWS\tS3,\teffectively\tusing\tS3\tto\tmasquerade\tas\ta\tgiant\tdata\tmart!\tThis\tapproach worked\tvery\twell\tuntil\twe\tneeded\tto\tscale\tour\tsolution,\tand\tat\tthe\ttime\tof\twriting\twe\tare looking\tto\tchange\tthese\tpumps\tto\tinstead\tpopulate\ta\tcube\tthat\tcan\tbe\tintegrated\twith standard\treporting\ttools\tlike\tExcel\tand\tTableau.\n\nEvent\tData\tPump\n\nIn\tChapter\t4,\twe\ttouched\ton\tthe\tidea\tof\tmicroservices\temitting\tevents\tbased\ton\tthe\tstate change\tof\tentities\tthat\tthey\tmanage.\tFor\texample,\tour\tcustomer\tservice\tmay\temit\tan\tevent when\ta\tgiven\tcustomer\tis\tcreated,\tor\tupdated,\tor\tdeleted.\tFor\tthose\tmicroservices\tthat expose\tsuch\tevent\tfeeds,\twe\thave\tthe\toption\tof\twriting\tour\town\tevent\tsubscriber\tthat pumps\tdata\tinto\tthe\treporting\tdatabase,\tas\tshown\tin\tFigure\t5-15.\n\nFigure\t5-15.\tAn\tevent\tdata\tpump\tusing\tstate\tchange\tevents\tto\tpopulate\ta\treporting\tdatabase\n\nThe\tcoupling\ton\tthe\tunderlying\tdatabase\tof\tthe\tsource\tmicroservice\tis\tnow\tavoided. Instead,\twe\tare\tjust\tbinding\tto\tthe\tevents\temitted\tby\tthe\tservice,\twhich\tare\tdesigned\tto\tbe exposed\tto\texternal\tconsumers.\tGiven\tthat\tevents\tare\ttemporal\tin\tnature,\tit\talso\tmakes\tit easier\tfor\tus\tto\tbe\tsmarter\tin\twhat\tdata\twe\tsent\tto\tour\tcentral\treporting\tstore;\twe\tcan\tsend data\tto\tthe\treporting\tsystem\tas\twe\tsee\tan\tevent,\tallowing\tdata\tto\tflow\tfaster\tto\tour reporting\tsystem,\trather\tthan\trelying\ton\ta\tregular\tschedule\tas\twith\tthe\tdata\tpump.\n\nAlso,\tif\twe\tstore\twhich\tevents\thave\talready\tbeen\tprocessed,\twe\tcan\tjust\tprocess\tthe\tnew events\tas\tthey\tarrive,\tassuming\tthe\told\tevents\thave\talready\tbeen\tmapped\tinto\tthe\treporting system.\tThis\tmeans\tour\tinsertion\twill\tbe\tmore\tefficient,\tas\twe\tonly\tneed\tto\tsend\tdeltas. We\tcan\tdo\tsimilar\tthings\twith\ta\tdata\tpump,\tbut\twe\thave\tto\tmanage\tthis\tourselves,\twhereas the\tfundamentally\ttemporal\tnature\tof\tthe\tstream\tof\tevents\t(x\thappens\tat\ttimestamp\ty) helps\tus\tgreatly.\n\nAs\tour\tevent\tdata\tpump\tis\tless\tcoupled\tto\tthe\tinternals\tof\tthe\tservice,\tit\tis\talso\teasier\tto consider\tthis\tbeing\tmanaged\tby\ta\tseparate\tgroup\tfrom\tthe\tteam\tlooking\tafter\tthe microservice\titself.\tAs\tlong\tas\tthe\tnature\tof\tour\tevent\tstream\tdoesn’t\toverly\tcouple subscribers\tto\tchanges\tin\tthe\tservice,\tthis\tevent\tmapper\tcan\tevolve\tindependently\tof\tthe service\tit\tsubscribes\tto.\n\nThe\tmain\tdownsides\tto\tthis\tapproach\tare\tthat\tall\tthe\trequired\tinformation\tmust\tbe broadcast\tas\tevents,\tand\tit\tmay\tnot\tscale\tas\twell\tas\ta\tdata\tpump\tfor\tlarger\tvolumes\tof\tdata that\thas\tthe\tbenefit\tof\toperating\tdirectly\tat\tthe\tdatabase\tlevel.\tNonetheless,\tthe\tlooser coupling\tand\tfresher\tdata\tavailable\tvia\tsuch\tan\tapproach\tmakes\tit\tstrongly\tworth considering\tif\tyou\tare\talready\texposing\tthe\tappropriate\tevents.\n\nBackup\tData\tPump\n\nThis\toption\tis\tbased\ton\tan\tapproach\tused\tat\tNetflix,\twhich\ttakes\tadvantage\tof\texisting backup\tsolutions\tand\talso\tresolves\tsome\tscale\tissues\tthat\tNetflix\thas\tto\tdeal\twith.\tIn\tsome ways,\tyou\tcan\tconsider\tthis\ta\tspecial\tcase\tof\ta\tdata\tpump,\tbut\tit\tseemed\tlike\tsuch\tan interesting\tsolution\tthat\tit\tdeserves\tinclusion.\n\nNetflix\thas\tdecided\tto\tstandardize\ton\tCassandra\tas\tthe\tbacking\tstore\tfor\tits\tservices,\tof which\tthere\tare\tmany.\tNetflix\thas\tinvested\tsignificant\ttime\tin\tbuilding\ttools\tto\tmake Cassandra\teasy\tto\twork\twith,\tmuch\tof\twhich\tthe\tcompany\thas\tshared\twith\tthe\trest\tof\tthe world\tvia\tnumerous\topen\tsource\tprojects.\tObviously\tit\tis\tvery\timportant\tthat\tthe\tdata Netflix\tstores\tis\tproperly\tbacked\tup.\tTo\tback\tup\tCassandra\tdata,\tthe\tstandard\tapproach\tis to\tmake\ta\tcopy\tof\tthe\tdata\tfiles\tthat\tback\tit\tand\tstore\tthem\tsomewhere\tsafe.\tNetflix\tstores these\tfiles,\tknown\tas\tSSTables,\tin\tAmazon’s\tS3\tobject\tstore,\twhich\tprovides\tsignificant data\tdurability\tguarantees.\n\nNetflix\tneeds\tto\treport\tacross\tall\tthis\tdata,\tbut\tgiven\tthe\tscale\tinvolved\tthis\tis\ta\tnontrivial challenge.\tIts\tapproach\tis\tto\tuse\tHadoop\tthat\tuses\tSSTable\tbackup\tas\tthe\tsource\tof\tits jobs.\tIn\tthe\tend,\tNetflix\tended\tup\timplementing\ta\tpipeline\tcapable\tof\tprocessing\tlarge amounts\tof\tdata\tusing\tthis\tapproach,\twhich\tit\tthen\topen\tsourced\tas\tthe\tAegisthus\tproject. Like\tdata\tpumps,\tthough,\twith\tthis\tpattern\twe\tstill\thave\ta\tcoupling\tto\tthe\tdestination reporting\tschema\t(or\ttarget\tsystem).\n\nIt\tis\tconceivable\tthat\tusing\ta\tsimilar\tapproach\t—\tthat\tis,\tusing\tmappers\tthat\twork\toff backups\t—\twould\twork\tin\tother\tcontexts\tas\twell.\tAnd\tif\tyou’re\talready\tusing\tCassandra, Netflix\thas\talready\tdone\tmuch\tof\tthe\twork\tfor\tyou!\n\nToward\tReal\tTime\n\nMany\tof\tthe\tpatterns\tpreviously\toutlined\tare\tdifferent\tways\tof\tgetting\ta\tlot\tof\tdata\tfrom many\tdifferent\tplaces\tto\tone\tplace.\tBut\tdoes\tthe\tidea\tthat\tall\tour\treporting\twill\tbe\tdone from\tone\tlocation\treally\tstack\tup\tanymore?\tWe\thave\tdashboards,\talerting,\tfinancial reports,\tuser\tanalytics\t—\tall\tof\tthese\tuse\tcases\thave\tdifferent\ttolerances\tfor\taccuracy\tand timeliness,\twhich\tmay\tresult\tin\tdifferent\ttechnical\toptions\tcoming\tto\tbear.\tAs\tI\twill\tdetail in\tChapter\t8,\twe\tare\tmoving\tmore\tand\tmore\ttoward\tgeneric\teventing\tsystems\tcapable\tof routing\tour\tdata\tto\tmultiple\tdifferent\tplaces\tdepending\ton\tneed.\n\nCost\tof\tChange\n\nThere\tare\tmany\treasons\twhy,\tthroughout\tthe\tbook,\tI\tpromote\tthe\tneed\tto\tmake\tsmall, incremental\tchanges,\tbut\tone\tof\tthe\tkey\tdrivers\tis\tto\tunderstand\tthe\timpact\tof\teach alteration\twe\tmake\tand\tchange\tcourse\tif\trequired.\tThis\tallows\tus\tto\tbetter\tmitigate\tthe cost\tof\tmistakes,\tbut\tdoesn’t\tremove\tthe\tchance\tof\tmistakes\tentirely.\tWe\tcan\t—\tand\twill —\tmake\tmistakes,\tand\twe\tshould\tembrace\tthat.\tWhat\twe\tshould\talso\tdo,\tthough,\tis understand\thow\tbest\tto\tmitigate\tthe\tcosts\tof\tthose\tmistakes.\n\nAs\twe\thave\tseen,\tthe\tcost\tinvolved\tin\tmoving\tcode\taround\twithin\ta\tcodebase\tis\tpretty small.\tWe\thave\tlots\tof\ttools\tthat\tsupport\tus,\tand\tif\twe\tcause\ta\tproblem,\tthe\tfix\tis\tgenerally quick.\tSplitting\tapart\ta\tdatabase,\thowever,\tis\tmuch\tmore\twork,\tand\trolling\tback\ta\tdatabase change\tis\tjust\tas\tcomplex.\tLikewise,\tuntangling\tan\toverly\tcoupled\tintegration\tbetween services,\tor\thaving\tto\tcompletely\trewrite\tan\tAPI\tthat\tis\tused\tby\tmultiple\tconsumers,\tcan be\ta\tsizeable\tundertaking.\tThe\tlarge\tcost\tof\tchange\tmeans\tthat\tthese\toperations\tare increasingly\trisky.\tHow\tcan\twe\tmanage\tthis\trisk?\tMy\tapproach\tis\tto\ttry\tto\tmake\tmistakes where\tthe\timpact\twill\tbe\tlowest.\n\nI\ttend\tto\tdo\tmuch\tof\tmy\tthinking\tin\tthe\tplace\twhere\tthe\tcost\tof\tchange\tand\tthe\tcost\tof mistakes\tis\tas\tlow\tas\tit\tcan\tbe:\tthe\twhiteboard.\tSketch\tout\tyour\tproposed\tdesign.\tSee\twhat happens\twhen\tyou\trun\tuse\tcases\tacross\twhat\tyou\tthink\tyour\tservice\tboundaries\twill\tbe. For\tour\tmusic\tshop,\tfor\texample,\timagine\twhat\thappens\twhen\ta\tcustomer\tsearches\tfor\ta record,\tregisters\twith\tthe\twebsite,\tor\tpurchases\tan\talbum.\tWhat\tcalls\tget\tmade?\tDo\tyou start\tseeing\todd\tcircular\treferences?\tDo\tyou\tsee\ttwo\tservices\tthat\tare\toverly\tchatty,\twhich might\tindicate\tthey\tshould\tbe\tone\tthing?\n\nA\tgreat\ttechnique\there\tis\tto\tadapt\tan\tapproach\tmore\ttypically\ttaught\tfor\tthe\tdesign\tof object-oriented\tsystems:\tclass-responsibility-collaboration\t(CRC)\tcards.\tWith\tCRC\tcards, you\twrite\ton\tone\tindex\tcard\tthe\tname\tof\tthe\tclass,\twhat\tits\tresponsibilities\tare,\tand\twho\tit collaborates\twith.\tWhen\tworking\tthrough\ta\tproposed\tdesign,\tfor\teach\tservice\tI\tlist\tits responsibilities\tin\tterms\tof\tthe\tcapabilities\tit\tprovides,\twith\tthe\tcollaborators\tspecified\tin the\tdiagram.\tAs\tyou\twork\tthrough\tmore\tuse\tcases,\tyou\tstart\tto\tget\ta\tsense\tas\tto\twhether all\tof\tthis\thangs\ttogether\tproperly.\n\nUnderstanding\tRoot\tCauses\n\nWe\thave\tdiscussed\thow\tto\tsplit\tapart\tlarger\tservices\tinto\tsmaller\tones,\tbut\twhy\tdid\tthese services\tgrow\tso\tlarge\tin\tthe\tfirst\tplace?\tThe\tfirst\tthing\tto\tunderstand\tis\tthat\tgrowing\ta service\tto\tthe\tpoint\tthat\tit\tneeds\tto\tbe\tsplit\tis\tcompletely\tOK.\tWe\twant\tthe\tarchitecture\tof our\tsystem\tto\tchange\tover\ttime\tin\tan\tincremental\tfashion.\tThe\tkey\tis\tknowing\tit\tneeds\tto be\tsplit\tbefore\tthe\tsplit\tbecomes\ttoo\texpensive.\n\nBut\tin\tpractice\tmany\tof\tus\twill\thave\tseen\tservices\tgrow\twell\tbeyond\tthe\tpoint\tof\tsanity. Despite\tknowing\tthat\ta\tsmaller\tset\tof\tservices\twould\tbe\teasier\tto\tdeal\twith\tthan\tthe\thuge monstrosity\twe\tcurrently\thave,\twe\tstill\tplow\ton\twith\tgrowing\tthe\tbeast.\tWhy?\n\nPart\tof\tthe\tproblem\tis\tknowing\twhere\tto\tstart,\tand\tI’m\thoping\tthis\tchapter\thas\thelped.\tBut another\tchallenge\tis\tthe\tcost\tassociated\twith\tsplitting\tout\tservices.\tFinding\tsomewhere\tto run\tthe\tservice,\tspinning\tup\ta\tnew\tservice\tstack,\tand\tso\ton,\tare\tnontrivial\ttasks.\tSo\thow\tdo we\taddress\tthis?\tWell,\tif\tdoing\tsomething\tis\tright\tbut\tdifficult,\twe\tshould\tstrive\tto\tmake things\teasier.\tInvestment\tin\tlibraries\tand\tlightweight\tservice\tframeworks\tcan\treduce\tthe cost\tassociated\twith\tcreating\tthe\tnew\tservice.\tGiving\tpeople\taccess\tto\tself-service provision\tvirtual\tmachines\tor\teven\tmaking\ta\tplatform\tas\ta\tservice\t(PaaS)\tavailable\twill make\tit\teasier\tto\tprovision\tsystems\tand\ttest\tthem.\tThroughout\tthe\trest\tof\tthe\tbook,\twe’ll be\tdiscussing\ta\tnumber\tof\tways\tto\thelp\tyou\tkeep\tthis\tcost\tdown.\n\nSummary\n\nWe\tdecompose\tour\tsystem\tby\tfinding\tseams\talong\twhich\tservice\tboundaries\tcan\temerge, and\tthis\tcan\tbe\tan\tincremental\tapproach.\tBy\tgetting\tgood\tat\tfinding\tthese\tseams\tand working\tto\treduce\tthe\tcost\tof\tsplitting\tout\tservices\tin\tthe\tfirst\tplace,\twe\tcan\tcontinue\tto grow\tand\tevolve\tour\tsystems\tto\tmeet\twhatever\trequirements\tcome\tdown\tthe\troad.\tAs\tyou can\tsee,\tsome\tof\tthis\twork\tcan\tbe\tpainstaking.\tBut\tthe\tvery\tfact\tthat\tit\tcan\tbe\tdone incrementally\tmeans\tthere\tis\tno\tneed\tto\tfear\tthis\twork.\n\nSo\tnow\twe\tcan\tsplit\tour\tservices\tout,\tbut\twe’ve\tintroduced\tsome\tnew\tproblems\ttoo.\tWe have\tmany\tmore\tmoving\tparts\tto\tget\tinto\tproduction\tnow!\tSo\tnext\tup\twe’ll\tdive\tinto\tthe world\tof\tdeployment.\n\nChapter\t6.\tDeployment\n\nDeploying\ta\tmonolithic\tapplication\tis\ta\tfairly\tstraightforward\tprocess.\tMicroservices,\twith their\tinterdependence,\tare\ta\tdifferent\tkettle\tof\tfish\taltogether.\tIf\tyou\tdon’t\tapproach deployment\tright,\tit’s\tone\tof\tthose\tareas\twhere\tthe\tcomplexity\tcan\tmake\tyour\tlife\ta misery.\tIn\tthis\tchapter,\twe’re\tgoing\tto\tlook\tat\tsome\ttechniques\tand\ttechnology\tthat\tcan help\tus\twhen\tdeploying\tmicroservices\tinto\tfine-grained\tarchitectures.\n\nWe’re\tgoing\tto\tstart\toff,\tthough,\tby\ttaking\ta\tlook\tat\tcontinuous\tintegration\tand\tcontinuous delivery.\tThese\trelated\tbut\tdifferent\tconcepts\twill\thelp\tshape\tthe\tother\tdecisions\twe’ll make\twhen\tthinking\tabout\twhat\tto\tbuild,\thow\tto\tbuild\tit,\tand\thow\tto\tdeploy\tit.\n\nA\tBrief\tIntroduction\tto\tContinuous\tIntegration\n\nContinuous\tintegration\t(CI)\thas\tbeen\taround\tfor\ta\tnumber\tof\tyears\tat\tthis\tpoint.\tIt’s\tworth spending\ta\tbit\tof\ttime\tgoing\tover\tthe\tbasics,\thowever,\tas\tespecially\twhen\twe\tthink\tabout the\tmapping\tbetween\tmicroservices,\tbuilds,\tand\tversion\tcontrol\trepositories,\tthere\tare some\tdifferent\toptions\tto\tconsider.\n\nWith\tCI,\tthe\tcore\tgoal\tis\tto\tkeep\teveryone\tin\tsync\twith\teach\tother,\twhich\twe\tachieve\tby making\tsure\tthat\tnewly\tchecked-in\tcode\tproperly\tintegrates\twith\texisting\tcode.\tTo\tdo\tthis, a\tCI\tserver\tdetects\tthat\tthe\tcode\thas\tbeen\tcommitted,\tchecks\tit\tout,\tand\tcarries\tout\tsome verification\tlike\tmaking\tsure\tthe\tcode\tcompiles\tand\tthat\ttests\tpass.\n\nAs\tpart\tof\tthis\tprocess,\twe\toften\tcreate\tartifact(s)\tthat\tare\tused\tfor\tfurther\tvalidation,\tsuch as\tdeploying\ta\trunning\tservice\tto\trun\ttests\tagainst\tit.\tIdeally,\twe\twant\tto\tbuild\tthese artifacts\tonce\tand\tonce\tonly,\tand\tuse\tthem\tfor\tall\tdeployments\tof\tthat\tversion\tof\tthe\tcode. This\tis\tin\torder\tto\tavoid\tdoing\tthe\tsame\tthing\tover\tand\tover\tagain,\tand\tso\tthat\twe\tcan confirm\tthat\tthe\tartifact\twe\tdeployed\tis\tthe\tone\twe\ttested.\tTo\tenable\tthese\tartifacts\tto\tbe reused,\twe\tplace\tthem\tin\ta\trepository\tof\tsome\tsort,\teither\tprovided\tby\tthe\tCI\ttool\titself\tor on\ta\tseparate\tsystem.\n\nWe’ll\tbe\tlooking\tat\twhat\tsorts\tof\tartifacts\twe\tcan\tuse\tfor\tmicroservices\tshortly,\tand\twe’ll look\tin\tdepth\tat\ttesting\tin\tChapter\t7.\n\nCI\thas\ta\tnumber\tof\tbenefits.\tWe\tget\tsome\tlevel\tof\tfast\tfeedback\tas\tto\tthe\tquality\tof\tour code.\tIt\tallows\tus\tto\tautomate\tthe\tcreation\tof\tour\tbinary\tartifacts.\tAll\tthe\tcode\trequired\tto build\tthe\tartifact\tis\titself\tversion\tcontrolled,\tso\twe\tcan\tre-create\tthe\tartifact\tif\tneeded.\tWe also\tget\tsome\tlevel\tof\ttraceability\tfrom\ta\tdeployed\tartifact\tback\tto\tthe\tcode,\tand depending\ton\tthe\tcapabilities\tof\tthe\tCI\ttool\titself,\tcan\tsee\twhat\ttests\twere\trun\ton\tthe\tcode and\tartifact\ttoo.\tIt’s\tfor\tthese\treasons\tthat\tCI\thas\tbeen\tso\tsuccessful.",
      "page_number": 145
    },
    {
      "number": 6,
      "title": "Deployment",
      "start_page": 188,
      "end_page": 230,
      "detection_method": "regex_chapter_title",
      "content": "Are\tYou\tReally\tDoing\tIt?\n\nI\tsuspect\tyou\tare\tprobably\tusing\tcontinuous\tintegration\tin\tyour\town\torganization.\tIf\tnot, you\tshould\tstart.\tIt\tis\ta\tkey\tpractice\tthat\tallows\tus\tto\tmake\tchanges\tquickly\tand\teasily,\tand without\twhich\tthe\tjourney\tinto\tmicroservices\twill\tbe\tpainful.\tThat\tsaid,\tI\thave\tworked with\tmany\tteams\twho,\tdespite\tsaying\tthat\tthey\tdo\tCI,\taren’t\tactually\tdoing\tit\tat\tall.\tThey confuse\tthe\tuse\tof\ta\tCI\ttool\twith\tadopting\tthe\tpractice\tof\tCI.\tThe\ttool\tis\tjust\tsomething that\tenables\tthe\tapproach.\n\nI\treally\tlike\tJez\tHumble’s\tthree\tquestions\the\tasks\tpeople\tto\ttest\tif\tthey\treally\tunderstand what\tCI\tis\tabout:\n\nDo\tyou\tcheck\tin\tto\tmainline\tonce\tper\tday?\n\nYou\tneed\tto\tmake\tsure\tyour\tcode\tintegrates.\tIf\tyou\tdon’t\tcheck\tyour\tcode\ttogether with\teveryone\telse’s\tchanges\tfrequently,\tyou\tend\tup\tmaking\tfuture\tintegration\tharder. Even\tif\tyou\tare\tusing\tshort-lived\tbranches\tto\tmanage\tchanges,\tintegrate\tas\tfrequently as\tyou\tcan\tinto\ta\tsingle\tmainline\tbranch.\n\nDo\tyou\thave\ta\tsuite\tof\ttests\tto\tvalidate\tyour\tchanges?\n\nWithout\ttests,\twe\tjust\tknow\tthat\tsyntactically\tour\tintegration\thas\tworked,\tbut\twe don’t\tknow\tif\twe\thave\tbroken\tthe\tbehavior\tof\tthe\tsystem.\tCI\twithout\tsome verification\tthat\tour\tcode\tbehaves\tas\texpected\tisn’t\tCI.\n\nWhen\tthe\tbuild\tis\tbroken,\tis\tit\tthe\t#1\tpriority\tof\tthe\tteam\tto\tfix\tit?\n\nA\tpassing\tgreen\tbuild\tmeans\tour\tchanges\thave\tsafely\tbeen\tintegrated.\tA\tred\tbuild means\tthe\tlast\tchange\tpossibly\tdid\tnot\tintegrate.\tYou\tneed\tto\tstop\tall\tfurther\tcheck- ins\tthat\taren’t\tinvolved\tin\tfixing\tthe\tbuilds\tto\tget\tit\tpassing\tagain.\tIf\tyou\tlet\tmore changes\tpile\tup,\tthe\ttime\tit\ttakes\tto\tfix\tthe\tbuild\twill\tincrease\tdrastically.\tI’ve\tworked with\tteams\twhere\tthe\tbuild\thas\tbeen\tbroken\tfor\tdays,\tresulting\tin\tsubstantial\tefforts to\teventually\tget\ta\tpassing\tbuild.\n\nMapping\tContinuous\tIntegration\tto\tMicroservices\n\nWhen\tthinking\tabout\tmicroservices\tand\tcontinuous\tintegration,\twe\tneed\tto\tthink\tabout how\tour\tCI\tbuilds\tmap\tto\tindividual\tmicroservices.\tAs\tI\thave\tsaid\tmany\ttimes,\twe\twant\tto ensure\tthat\twe\tcan\tmake\ta\tchange\tto\ta\tsingle\tservice\tand\tdeploy\tit\tindependently\tof\tthe rest.\tWith\tthis\tin\tmind,\thow\tshould\twe\tmap\tindividual\tmicroservices\tto\tCI\tbuilds\tand source\tcode?\n\nIf\twe\tstart\twith\tthe\tsimplest\toption,\twe\tcould\tlump\teverything\tin\ttogether.\tWe\thave\ta single,\tgiant\trepository\tstoring\tall\tour\tcode,\tand\thave\tone\tsingle\tbuild,\tas\twe\tsee\tin Figure\t6-1.\tAny\tcheck-in\tto\tthis\tsource\tcode\trepository\twill\tcause\tour\tbuild\tto\ttrigger, where\twe\twill\trun\tall\tthe\tverification\tsteps\tassociated\twith\tall\tour\tmicroservices,\tand produce\tmultiple\tartifacts,\tall\ttied\tback\tto\tthe\tsame\tbuild.\n\nFigure\t6-1.\tUsing\ta\tsingle\tsource\tcode\trepository\tand\tCI\tbuild\tfor\tall\tmicroservices\n\nThis\tseems\tmuch\tsimpler\ton\tthe\tsurface\tthan\tother\tapproaches:\tfewer\trepositories\tto worry\tabout,\tand\ta\tconceptually\tsimpler\tbuild.\tFrom\ta\tdeveloper\tpoint\tof\tview,\tthings\tare pretty\tstraightforward\ttoo.\tI\tjust\tcheck\tcode\tin.\tIf\tI\thave\tto\twork\ton\tmultiple\tservices\tat once,\tI\tjust\thave\tto\tworry\tabout\tone\tcommit.\n\nThis\tmodel\tcan\twork\tperfectly\twell\tif\tyou\tbuy\tinto\tthe\tidea\tof\tlock-step\treleases,\twhere you\tdon’t\tmind\tdeploying\tmultiple\tservices\tat\tonce.\tIn\tgeneral,\tthis\tis\tabsolutely\ta\tpattern to\tavoid,\tbut\tvery\tearly\ton\tin\ta\tproject,\tespecially\tif\tonly\tone\tteam\tis\tworking\ton everything,\tthis\tmight\tmake\tsense\tfor\tshort\tperiods\tof\ttime.\n\nHowever,\tthere\tare\tsome\tsignificant\tdownsides.\tIf\tI\tmake\ta\tone-line\tchange\tto\ta\tsingle service\t—\tfor\texample,\tchanging\tthe\tbehavior\tin\tthe\tuser\tservice\tin\tFigure\t6-1\t—\tall\tthe other\tservices\tget\tverified\tand\tbuilt.\tThis\tcould\ttake\tmore\ttime\tthan\tneeded\t—\tI’m waiting\tfor\tthings\tthat\tprobably\tdon’t\tneed\tto\tbe\ttested.\tThis\timpacts\tour\tcycle\ttime,\tthe speed\tat\twhich\twe\tcan\tmove\ta\tsingle\tchange\tfrom\tdevelopment\tto\tlive.\tMore\ttroubling, though,\tis\tknowing\twhat\tartifacts\tshould\tor\tshouldn’t\tbe\tdeployed.\tDo\tI\tnow\tneed\tto deploy\tall\tthe\tbuild\tservices\tto\tpush\tmy\tsmall\tchange\tinto\tproduction?\tIt\tcan\tbe\thard\tto tell;\ttrying\tto\tguess\twhich\tservices\treally\tchanged\tjust\tby\treading\tthe\tcommit\tmessages\tis\n\ndifficult.\tOrganizations\tusing\tthis\tapproach\toften\tfall\tback\tto\tjust\tdeploying\teverything together,\twhich\twe\treally\twant\tto\tavoid.\n\nFurthermore,\tif\tmy\tone-line\tchange\tto\tthe\tuser\tservice\tbreaks\tthe\tbuild,\tno\tother\tchanges can\tbe\tmade\tto\tthe\tother\tservices\tuntil\tthat\tbreak\tis\tfixed.\tAnd\tthink\tabout\ta\tscenario where\tyou\thave\tmultiple\tteams\tall\tsharing\tthis\tgiant\tbuild.\tWho\tis\tin\tcharge?\n\nA\tvariation\tof\tthis\tapproach\tis\tto\thave\tone\tsingle\tsource\ttree\twith\tall\tof\tthe\tcode\tin\tit,\twith multiple\tCI\tbuilds\tmapping\tto\tparts\tof\tthis\tsource\ttree,\tas\twe\tsee\tin\tFigure\t6-2.\tWith\twell- defined\tstructure,\tyou\tcan\teasily\tmap\tthe\tbuilds\tto\tcertain\tparts\tof\tthe\tsource\ttree.\tIn general,\tI\tam\tnot\ta\tfan\tof\tthis\tapproach,\tas\tthis\tmodel\tcan\tbe\ta\tmixed\tblessing.\tOn\tthe\tone hand,\tmy\tcheck-in/check-out\tprocess\tcan\tbe\tsimpler\tas\tI\thave\tonly\tone\trepository\tto worry\tabout.\tOn\tthe\tother\thand,\tit\tbecomes\tvery\teasy\tto\tget\tinto\tthe\thabit\tof\tchecking\tin source\tcode\tfor\tmultiple\tservices\tat\tonce,\twhich\tcan\tmake\tit\tequally\teasy\tto\tslip\tinto making\tchanges\tthat\tcouple\tservices\ttogether.\tI\twould\tgreatly\tprefer\tthis\tapproach, however,\tover\thaving\ta\tsingle\tbuild\tfor\tmultiple\tservices.\n\nFigure\t6-2.\tA\tsingle\tsource\trepo\twith\tsubdirectories\tmapped\tto\tindependent\tbuilds\n\nSo\tis\tthere\tanother\talternative?\tThe\tapproach\tI\tprefer\tis\tto\thave\ta\tsingle\tCI\tbuild\tper microservice,\tto\tallow\tus\tto\tquickly\tmake\tand\tvalidate\ta\tchange\tprior\tto\tdeployment\tinto production,\tas\tshown\tin\tFigure\t6-3.\tHere\teach\tmicroservice\thas\tits\town\tsource\tcode repository,\tmapped\tto\tits\town\tCI\tbuild.\tWhen\tmaking\ta\tchange,\tI\trun\tonly\tthe\tbuild\tand tests\tI\tneed\tto.\tI\tget\ta\tsingle\tartifact\tto\tdeploy.\tAlignment\tto\tteam\townership\tis\tmore\tclear too.\tIf\tyou\town\tthe\tservice,\tyou\town\tthe\trepository\tand\tthe\tbuild.\tMaking\tchanges\tacross repositories\tcan\tbe\tmore\tdifficult\tin\tthis\tworld,\tbut\tI’d\tmaintain\tthis\tis\teasier\tto\tresolve (e.g.,\tby\tusing\tcommand-line\tscripts)\tthan\tthe\tdownside\tof\tthe\tmonolithic\tsource\tcontrol and\tbuild\tprocess.\n\nFigure\t6-3.\tUsing\tone\tsource\tcode\trepository\tand\tCI\tbuild\tper\tmicroservice\n\nThe\ttests\tfor\ta\tgiven\tmicroservice\tshould\tlive\tin\tsource\tcontrol\twith\tthe\tmicroservice’s source\tcode\ttoo,\tto\tensure\twe\talways\tknow\twhat\ttests\tshould\tbe\trun\tagainst\ta\tgiven service.\n\nSo,\teach\tmicroservice\twill\tlive\tin\tits\town\tsource\tcode\trepository,\tand\tits\town\tCI\tbuild process.\tWe’ll\tuse\tthe\tCI\tbuild\tprocess\tto\tcreate\tour\tdeployable\tartifacts\ttoo\tin\ta\tfully automated\tfashion.\tNow\tlets\tlook\tbeyond\tCI\tto\tsee\thow\tcontinuous\tdelivery\tfits\tin.\n\nBuild\tPipelines\tand\tContinuous\tDelivery\n\nVery\tearly\ton\tin\tusing\tcontinuous\tintegration,\twe\trealized\tthe\tvalue\tin\tsometimes\thaving multiple\tstages\tinside\ta\tbuild.\tTests\tare\ta\tvery\tcommon\tcase\twhere\tthis\tcomes\tinto\tplay.\tI may\thave\ta\tlot\tof\tfast,\tsmall-scoped\ttests,\tand\ta\tsmall\tnumber\tof\tlarge-scoped,\tslow\ttests. If\twe\trun\tall\tthe\ttests\ttogether,\twe\tmay\tnot\tbe\table\tto\tget\tfast\tfeedback\twhen\tour\tfast\ttests fail\tif\twe’re\twaiting\tfor\tour\tlong-scoped\tslow\ttests\tto\tfinally\tfinish.\tAnd\tif\tthe\tfast\ttests fail,\tthere\tprobably\tisn’t\tmuch\tsense\tin\trunning\tthe\tslower\ttests\tanyway!\tA\tsolution\tto\tthis problem\tis\tto\thave\tdifferent\tstages\tin\tour\tbuild,\tcreating\twhat\tis\tknown\tas\ta\tbuild\tpipeline. One\tstage\tfor\tthe\tfaster\ttests,\tone\tfor\tthe\tslower\ttests.\n\nThis\tbuild\tpipeline\tconcept\tgives\tus\ta\tnice\tway\tof\ttracking\tthe\tprogress\tof\tour\tsoftware\tas it\tclears\teach\tstage,\thelping\tgive\tus\tinsight\tinto\tthe\tquality\tof\tour\tsoftware.\tWe\tbuild\tour artifact,\tand\tthat\tartifact\tis\tused\tthroughout\tthe\tpipeline.\tAs\tour\tartifact\tmoves\tthrough these\tstages,\twe\tfeel\tmore\tand\tmore\tconfident\tthat\tthe\tsoftware\twill\twork\tin\tproduction.\n\nContinuous\tdelivery\t(CD)\tbuilds\ton\tthis\tconcept,\tand\tthen\tsome.\tAs\toutlined\tin\tJez Humble\tand\tDave\tFarley’s\tbook\tof\tthe\tsame\tname,\tcontinuous\tdelivery\tis\tthe\tapproach whereby\twe\tget\tconstant\tfeedback\ton\tthe\tproduction\treadiness\tof\teach\tand\tevery\tcheck-in, and\tfurthermore\ttreat\teach\tand\tevery\tcheck-in\tas\ta\trelease\tcandidate.\n\nTo\tfully\tembrace\tthis\tconcept,\twe\tneed\tto\tmodel\tall\tthe\tprocesses\tinvolved\tin\tgetting\tour software\tfrom\tcheck-in\tto\tproduction,\tand\tknow\twhere\tany\tgiven\tversion\tof\tthe\tsoftware is\tin\tterms\tof\tbeing\tcleared\tfor\trelease.\tIn\tCD,\twe\tdo\tthis\tby\textending\tthe\tidea\tof\tthe multistage\tbuild\tpipeline\tto\tmodel\teach\tand\tevery\tstage\tour\tsoftware\thas\tto\tgo\tthrough, both\tmanual\tand\tautomated.\tIn\tFigure\t6-4,\twe\tsee\ta\tsample\tpipeline\tthat\tmay\tbe\tfamiliar.\n\nFigure\t6-4.\tA\tstandard\trelease\tprocess\tmodeled\tas\ta\tbuild\tpipeline\n\nHere\twe\treally\twant\ta\ttool\tthat\tembraces\tCD\tas\ta\tfirst-class\tconcept.\tI\thave\tseen\tmany people\ttry\tto\thack\tand\textend\tCI\ttools\tto\tmake\tthem\tdo\tCD,\toften\tresulting\tin\tcomplex systems\tthat\tare\tnowhere\tas\teasy\tto\tuse\tas\ttools\tthat\tbuild\tin\tCD\tfrom\tthe\tbeginning. Tools\tthat\tfully\tsupport\tCD\tallow\tyou\tto\tdefine\tand\tvisualize\tthese\tpipelines,\tmodeling the\tentire\tpath\tto\tproduction\tfor\tyour\tsoftware.\tAs\ta\tversion\tof\tour\tcode\tmoves\tthrough the\tpipeline,\tif\tit\tpasses\tone\tof\tthese\tautomated\tverification\tsteps\tit\tmoves\tto\tthe\tnext stage.\tOther\tstages\tmay\tbe\tmanual.\tFor\texample,\tif\twe\thave\ta\tmanual\tuser\tacceptance testing\t(UAT)\tprocess\tI\tshould\tbe\table\tto\tuse\ta\tCD\ttool\tto\tmodel\tit.\tI\tcan\tsee\tthe\tnext available\tbuild\tready\tto\tbe\tdeployed\tinto\tour\tUAT\tenvironment,\tdeploy\tit,\tand\tif\tit\tpasses our\tmanual\tchecks,\tmark\tthat\tstage\tas\tbeing\tsuccessful\tso\tit\tcan\tmove\tto\tthe\tnext.\n\nBy\tmodeling\tthe\tentire\tpath\tto\tproduction\tfor\tour\tsoftware,\twe\tgreatly\timprove\tvisibility of\tthe\tquality\tof\tour\tsoftware,\tand\tcan\talso\tgreatly\treduce\tthe\ttime\ttaken\tbetween\treleases,\n\nas\twe\thave\tone\tplace\tto\tobserve\tour\tbuild\tand\trelease\tprocess,\tand\tan\tobvious\tfocal\tpoint for\tintroducing\timprovements.\n\nIn\ta\tmicroservices\tworld,\twhere\twe\twant\tto\tensure\twe\tcan\trelease\tour\tservices independently\tof\teach\tother,\tit\tfollows\tthat\tas\twith\tCI,\twe’ll\twant\tone\tpipeline\tper\tservice. In\tour\tpipelines,\tit\tis\tan\tartifact\tthat\twe\twant\tto\tcreate\tand\tmove\tthrough\tour\tpath\tto production.\tAs\talways,\tit\tturns\tout\tour\tartifacts\tcan\tcome\tin\tlots\tof\tsizes\tand\tshapes.\tWe’ll look\tat\tsome\tof\tthe\tmost\tcommon\toptions\tavailable\tto\tus\tin\ta\tmoment.\n\nAnd\tthe\tInevitable\tExceptions\n\nAs\twith\tall\tgood\trules,\tthere\tare\texceptions\twe\tneed\tto\tconsider\ttoo.\tThe\t“one microservice\tper\tbuild”\tapproach\tis\tabsolutely\tsomething\tyou\tshould\taim\tfor,\tbut\tare\tthere times\twhen\tsomething\telse\tmakes\tsense?\tWhen\ta\tteam\tis\tstarting\tout\twith\ta\tnew\tproject, especially\ta\tgreenfield\tone\twhere\tthey\tare\tworking\twith\ta\tblank\tsheet\tof\tpaper,\tit\tis\tquite likely\tthat\tthere\twill\tbe\ta\tlarge\tamount\tof\tchurn\tin\tterms\tof\tworking\tout\twhere\tthe\tservice boundaries\tlie.\tThis\tis\ta\tgood\treason,\tin\tfact,\tfor\tkeeping\tyour\tinitial\tservices\ton\tthe\tlarger side\tuntil\tyour\tunderstanding\tof\tthe\tdomain\tstabilizes.\n\nDuring\tthis\ttime\tof\tchurn,\tchanges\tacross\tservice\tboundaries\tare\tmore\tlikely,\tand\twhat\tis in\tor\tnot\tin\ta\tgiven\tservice\tis\tlikely\tto\tchange\tfrequently.\tDuring\tthis\tperiod,\thaving\tall services\tin\ta\tsingle\tbuild\tto\treduce\tthe\tcost\tof\tcross-service\tchanges\tmay\tmake\tsense.\n\nIt\tdoes\tfollow,\tthough,\tthat\tin\tthis\tcase\tyou\tneed\tto\tbuy\tinto\treleasing\tall\tthe\tservices\tas\ta bundle.\tIt\talso\tabsolutely\tneeds\tto\tbe\ta\ttransitionary\tstep.\tAs\tservice\tAPIs\tstabilize,\tstart moving\tthem\tout\tinto\ttheir\town\tbuilds.\tIf\tafter\ta\tfew\tweeks\t(or\ta\tvery\tsmall\tnumber\tof months)\tyou\tare\tunable\tto\tget\tstability\tin\tservice\tboundaries\tin\torder\tto\tproperly\tseparate them,\tmerge\tthem\tback\tinto\ta\tmore\tmonolithic\tservice\t(albeit\tretaining\tmodular separation\twithin\tthe\tboundary)\tand\tgive\tyourself\ttime\tto\tget\tto\tgrips\twith\tthe\tdomain. This\treflects\tthe\texperiences\tof\tour\town\tSnapCI\tteam,\tas\twe\tdiscussed\tin\tChapter\t3.\n\nPlatform-Specific\tArtifacts\n\nMost\ttechnology\tstacks\thave\tsome\tsort\tof\tfirst-class\tartifact,\talong\twith\ttools\tto\tsupport creating\tand\tinstalling\tthem.\tRuby\thas\tgems,\tJava\thas\tJAR\tfiles\tand\tWAR\tfiles,\tand Python\thas\teggs.\tDevelopers\twith\texperience\tin\tone\tof\tthese\tstacks\twill\tbe\twell\tversed\tin working\twith\t(and\thopefully\tcreating)\tthese\tartifacts.\n\nFrom\tthe\tpoint\tof\tview\tof\ta\tmicroservice,\tthough,\tdepending\ton\tyour\ttechnology\tstack, this\tartifact\tmay\tnot\tbe\tenough\tby\titself.\tWhile\ta\tJava\tJAR\tfile\tcan\tbe\tmade\tto\tbe executable\tand\trun\tan\tembedded\tHTTP\tprocess,\tfor\tthings\tlike\tRuby\tand\tPython applications,\tyou’ll\texpect\tto\tuse\ta\tprocess\tmanager\trunning\tinside\tApache\tor\tNginx.\tSo we\tmay\tneed\tsome\tway\tof\tinstalling\tand\tconfiguring\tother\tsoftware\tthat\twe\tneed\tin\torder to\tdeploy\tand\tlaunch\tour\tartifacts.\tThis\tis\twhere\tautomated\tconfiguration\tmanagement tools\tlike\tPuppet\tand\tChef\tcan\thelp.\n\nAnother\tdownfall\there\tis\tthat\tthese\tartifacts\tare\tspecific\tto\ta\tcertain\ttechnology\tstack, which\tmay\tmake\tdeployment\tmore\tdifficult\twhen\twe\thave\ta\tmix\tof\ttechnologies\tin\tplay. Think\tof\tit\tfrom\tthe\tpoint\tof\tview\tof\tsomeone\ttrying\tto\tdeploy\tmultiple\tservices\ttogether. They\tcould\tbe\ta\tdeveloper\tor\ttester\twanting\tto\ttest\tsome\tfunctionality,\tor\tit\tcould\tbe someone\tmanaging\ta\tproduction\tdeployment.\tNow\timagine\tthat\tthose\tservices\tuse\tthree completely\tdifferent\tdeployment\tmechanisms.\tPerhaps\twe\thave\ta\tRuby\tGem,\ta\tJAR\tfile, and\ta\tnodeJS\tNPM\tpackage.\tWould\tthey\tthank\tyou?\n\nAutomation\tcan\tgo\ta\tlong\tway\ttoward\thiding\tthe\tdifferences\tin\tthe\tdeployment mechanisms\tof\tthe\tunderlying\tartifacts.\tChef,\tPuppet,\tand\tAnsible\tall\tsupport\tmultiple different\tcommon\ttechnology-specific\tbuild\tartifacts\ttoo.\tBut\tthere\tare\tdifferent\ttypes\tof artifacts\tthat\tmight\tbe\teven\teasier\tto\twork\twith.\n\nOperating\tSystem\tArtifacts\n\nOne\tway\tto\tavoid\tthe\tproblems\tassociated\twith\ttechnology-specific\tartifacts\tis\tto\tcreate artifacts\tthat\tare\tnative\tto\tthe\tunderlying\toperating\tsystem.\tFor\texample,\tfor\ta\tRedHat–\tor CentOS-based\tsystem,\tI\tmight\tbuild\tRPMs;\tfor\tUbuntu,\tI\tmight\tbuild\ta\tdeb\tpackage;\tor for\tWindows,\tan\tMSI.\n\nThe\tadvantage\tof\tusing\tOS-specific\tartifacts\tis\tthat\tfrom\ta\tdeployment\tpoint\tof\tview\twe don’t\tcare\twhat\tthe\tunderlying\ttechnology\tis.\tWe\tjust\tuse\tthe\ttools\tnative\tto\tthe\tOS\tto install\tthe\tpackage.\tThe\tOS\ttools\tcan\talso\thelp\tus\tuninstall\tand\tget\tinformation\tabout\tthe packages\ttoo,\tand\tmay\teven\tprovide\tpackage\trepositories\tthat\tour\tCI\ttools\tcan\tpush\tto. Much\tof\tthe\twork\tdone\tby\tthe\tOS\tpackage\tmanager\tcan\talso\toffset\twork\tthat\tyou\tmight otherwise\tdo\tin\ta\ttool\tlike\tPuppet\tor\tChef.\tOn\tall\tLinux\tplatforms\tI\thave\tused,\tfor example,\tyou\tcan\tdefine\tdependencies\tfrom\tyour\tpackages\tto\tother\tpackages\tyou\trely\ton, and\tthe\tOS\ttools\twill\tautomatically\tinstall\tthem\tfor\tyou\ttoo.\n\nThe\tdownside\tcan\tbe\tthe\tdifficulty\tin\tcreating\tthe\tpackages\tin\tthe\tfirst\tplace.\tFor\tLinux, the\tFPM\tpackage\tmanager\ttool\tgives\ta\tnicer\tabstraction\tfor\tcreating\tLinux\tOS\tpackages, and\tconverting\tfrom\ta\ttarball-based\tdeployment\tto\tan\tOS-based\tdeployment\tcan\tbe\tfairly straightforward.\tThe\tWindows\tspace\tis\tsomewhat\ttrickier.\tThe\tnative\tpackaging\tsystem\tin the\tform\tof\tMSI\tinstallers\tand\tthe\tlike\tleave\ta\tlot\tto\tbe\tdesired\twhen\tcompared\tto\tthe capabilities\tin\tthe\tLinux\tspace.\tThe\tNuGet\tpackage\tsystem\thas\tstarted\tto\thelp\taddress this,\tat\tleast\tin\tterms\tof\thelping\tmanage\tdevelopment\tlibraries.\tMore\trecently,\tChocolatey NuGet\thas\textended\tthese\tideas,\tproviding\ta\tpackage\tmanager\tfor\tWindows\tdesigned\tfor deploying\ttools\tand\tservices,\twhich\tis\tmuch\tmore\tlike\tthe\tpackage\tmanagers\tin\tthe\tLinux space.\tThis\tis\tcertainly\ta\tstep\tin\tthe\tright\tdirection,\talthough\tthe\tfact\tthat\tthe\tidiomatic style\tin\tWindows\tis\tstill\tdeploy\tsomething\tin\tIIS\tmeans\tthat\tthis\tapproach\tmay\tbe unappealing\tfor\tsome\tWindows\tteams.\n\nAnother\tdownside,\tof\tcourse,\tcould\tbe\tif\tyou\tare\tdeploying\tonto\tmultiple\tdifferent operating\tsystems.\tThe\toverhead\tof\tmanaging\tartifacts\tfor\tdifferent\tOSes\tcould\tbe\tpretty steep.\tIf\tyou’re\tcreating\tsoftware\tfor\tother\tpeople\tto\tinstall,\tyou\tmay\tnot\thave\ta\tchoice.\tIf you\tare\tinstalling\tsoftware\tonto\tmachines\tyou\tcontrol,\thowever,\tI\twould\tsuggest\tyou\tlook at\tunifying\tor\tat\tleast\treducing\tthe\tnumber\tof\tdifferent\toperating\tsystems\tyou\tuse.\tIt\tcan greatly\treduce\tvariations\tin\tbehavior\tfrom\tone\tmachine\tto\tthe\tnext,\tand\tsimplify deployment\tand\tmaintenance\ttasks.\n\nIn\tgeneral,\tthose\tteams\tI’ve\tseen\tthat\thave\tmoved\tto\tOS-based\tpackage\tmanagement\thave simplified\ttheir\tdeployment\tapproach,\tand\ttend\tto\tavoid\tthe\ttrap\tof\tbig,\tcomplex deployment\tscripts.\tEspecially\tif\tyou’re\ton\tLinux,\tthis\tcan\tbe\ta\tgood\tway\tto\tsimplify deployment\tof\tmicroservices\tusing\tdisparate\ttechnology\tstacks.\n\nCustom\tImages\n\nOne\tof\tthe\tchallenges\twith\tautomated\tconfiguration\tmanagement\tsystems\tlike\tPuppet, Chef,\tand\tAnsible\tcan\tbe\tthe\ttime\ttaken\tto\trun\tthe\tscripts\ton\ta\tmachine.\tLet’s\ttake\ta simple\texample\tof\ta\tserver\tbeing\tprovisioned\tand\tconfigured\tto\tallow\tfor\tthe\tdeployment of\ta\tJava\tapplication.\tLet’s\tassume\tI’m\tusing\tAWS\tto\tprovision\tthe\tserver,\tusing\tthe standard\tUbuntu\timage.\tThe\tfirst\tthing\tI\tneed\tto\tdo\tis\tinstall\tthe\tOracle\tJVM\tto\trun\tmy Java\tapplication.\tI’ve\tseen\tthis\tsimple\tprocess\ttake\taround\tfive\tminutes,\twith\ta\tcouple\tof minutes\ttaken\tup\tby\tthe\tmachine\tbeing\tprovisioned,\tand\ta\tfew\tmore\tto\tinstall\tthe\tJVM. Then\twe\tcan\tthink\tabout\tactually\tputting\tour\tsoftware\ton\tit.\n\nThis\tis\tactually\ta\tfairly\ttrivial\texample.\tWe\twill\toften\twant\tto\tinstall\tother\tcommon\tbits\tof software.\tFor\texample,\twe\tmight\twant\tto\tuse\tcollectd\tfor\tgathering\tOS\tstats,\tuse\tlogstash for\tlog\taggregation,\tand\tperhaps\tinstall\tthe\tappropriate\tbits\tof\tnagios\tfor\tmonitoring\t(we’ll talk\tmore\tabout\tthis\tsoftware\tin\tChapter\t8).\tOver\ttime,\tmore\tthings\tmight\tget\tadded, leading\tto\tlonger\tand\tlonger\tamounts\tof\ttime\tneeded\tfor\tprovisioning\tof\tthese dependencies.\n\nPuppet,\tChef,\tAnsible,\tand\ttheir\tilk\tcan\tbe\tsmart\tand\twill\tavoid\tinstalling\tsoftware\tthat\tis already\tpresent.\tThis\tdoes\tnot\tmean\tthat\trunning\tthe\tscripts\ton\texisting\tmachines\twill always\tbe\tfast,\tunfortunately,\tas\trunning\tall\tthe\tchecks\ttakes\ttime.\tWe\talso\twant\tto\tavoid keeping\tour\tmachines\taround\tfor\ttoo\tlong,\tas\twe\tdon’t\twant\tto\tallow\tfor\ttoo\tmuch configuration\tdrift\t(which\twe’ll\texplore\tin\tmore\tdepth\tshortly).\tAnd\tif\twe’re\tusing\tan\ton- demand\tcompute\tplatform\twe\tmight\tbe\tconstantly\tshutting\tdown\tand\tspinning\tup\tnew instances\ton\ta\tdaily\tbasis\t(if\tnot\tmore\tfrequently),\tso\tthe\tdeclarative\tnature\tof\tthese configuration\tmanagement\ttools\tmay\tbe\tof\tlimited\tuse.\n\nOver\ttime,\twatching\tthe\tsame\ttools\tget\tinstalled\tover\tand\tover\tagain\tcan\tbecome\ta\treal drag.\tIf\tyou\tare\ttrying\tto\tdo\tthis\tmultiple\ttimes\tper\tday\t—\tperhaps\tas\tpart\tof\tdevelopment or\tCI\t—\tthis\tbecomes\ta\treal\tproblem\tin\tterms\tof\tproviding\tfast\tfeedback.\tIt\tcan\talso\tlead to\tincreased\tdowntime\twhen\tdeploying\tin\tproduction\tif\tyour\tsystems\tdon’t\tallow\tfor\tzero- downtime\tdeployment,\tas\tyou’re\twaiting\tto\tinstall\tall\tthe\tpre-requisites\ton\tyour\tmachines even\tbefore\tyou\tget\tto\tinstalling\tyour\tsoftware.\tModels\tlike\tblue/green\tdeployment (which\twe’ll\tdiscuss\tin\tChapter\t7)\tcan\thelp\tmitigate\tthis,\tas\tthey\tallow\tus\tto\tdeploy\ta\tnew version\tof\tour\tservice\twithout\ttaking\tthe\told\tone\toffline.\n\nOne\tapproach\tto\treducing\tthis\tspin-up\ttime\tis\tto\tcreate\ta\tvirtual\tmachine\timage\tthat\tbakes in\tsome\tof\tthe\tcommon\tdependencies\twe\tuse,\tas\tshown\tin\tFigure\t6-5.\tAll\tvirtualization platforms\tI’ve\tused\tallow\tyou\tto\tbuild\tyour\town\timages,\tand\tthe\ttools\tto\tdo\tso\tare\tmuch more\tadvanced\tthan\tthey\twere\teven\ta\tfew\tyears\tago.\tThis\tshifts\tthings\tsomewhat.\tNow we\tcould\tbake\tthe\tcommon\ttools\tinto\tour\town\timage.\tWhen\twe\twant\tto\tdeploy\tour software,\twe\tspin\tup\tan\tinstance\tof\tthis\tcustom\timage,\tand\tall\twe\thave\tto\tdo\tis\tinstall\tthe latest\tversion\tof\tour\tservice.\n\nFigure\t6-5.\tCreating\ta\tcustom\tVM\timage\n\nOf\tcourse,\tbecause\tyou\tbuild\tthe\timage\tonly\tonce,\twhen\tyou\tsubsequently\tlaunch\tcopies of\tthis\timage\tyou\tdon’t\tneed\tto\tspend\ttime\tinstalling\tyour\tdependencies,\tas\tthey\tare already\tthere.\tThis\tcan\tresult\tin\ta\tsignificant\ttime\tsavings.\tIf\tyour\tcore\tdependencies\tdon’t change,\tnew\tversions\tof\tyour\tservice\tcan\tcontinue\tto\tuse\tthe\tsame\tbase\timage.\n\nThere\tare\tsome\tdrawbacks\twith\tthis\tapproach,\tthough.\tBuilding\timages\tcan\ttake\ta\tlong time.\tThis\tmeans\tthat\tfor\tdevelopers\tyou\tmay\twant\tto\tsupport\tother\tways\tof\tdeploying services\tto\tensure\tthey\tdon’t\thave\tto\twait\thalf\tan\thour\tjust\tto\tcreate\ta\tbinary\tdeployment. Second,\tsome\tof\tthe\tresulting\timages\tcan\tbe\tlarge.\tThis\tcould\tbe\ta\treal\tproblem\tif\tyou’re creating\tyour\town\tVMWare\timages,\tfor\texample,\tas\tmoving\ta\t20GB\timage\taround\ta network\tisn’t\talways\ta\tsimple\tactivity.\tWe’ll\tbe\tlooking\tat\tcontainer\ttechnology\tshortly, and\tspecifically\tDocker,\twhich\tcan\tavoid\tsome\tof\tthese\tdrawbacks.\n\nHistorically,\tone\tof\tthe\tchallenges\tis\tthat\tthe\ttool\tchain\trequired\tto\tbuild\tsuch\tan\timage varied\tfrom\tplatform\tto\tplatform.\tBuilding\ta\tVMWare\timage\tis\tdifferent\tfrom\tbuilding\tan AWS\tAMI,\ta\tVagrant\timage,\tor\ta\tRackspace\timage.\tThis\tmay\tnot\thave\tbeen\ta\tproblem\tif you\thad\tthe\tsame\tplatform\teverywhere,\tbut\tnot\tall\torganizations\twere\tthis\tlucky.\tAnd even\tif\tthey\twere,\tthe\ttools\tin\tthis\tspace\twere\toften\tdifficult\tto\twork\twith,\tand\tthey\tdidn’t play\tnicely\twith\tother\ttools\tyou\tmight\tbe\tusing\tfor\tmachine\tconfiguration.\n\nPacker\tis\ta\ttool\tdesigned\tto\tmake\tcreation\tof\timages\tmuch\teasier.\tUsing\tconfiguration scripts\tof\tyour\tchoice\t(Chef,\tAnsible,\tPuppet,\tand\tmore\tare\tsupported),\tit\tallows\tus\tto create\timages\tfor\tdifferent\tplatforms\tfrom\tthe\tsame\tconfiguration.\tAt\tthe\ttime\tof\twriting, it\thas\tsupport\tfor\tVMWare,\tAWS,\tRackspace\tCloud,\tDigital\tOcean,\tand\tVagrant,\tand\tI’ve seen\tteams\tuse\tit\tsuccessfully\tfor\tbuilding\tLinux\tand\tWindows\timages.\tThis\tmeans\tyou could\tcreate\tan\timage\tfor\tdeployment\ton\tyour\tproduction\tAWS\tenvironment\tand\ta matching\tVagrant\timage\tfor\tlocal\tdevelopment\tand\ttest,\tall\tfrom\tthe\tsame\tconfiguration.\n\nImages\tas\tArtifacts\n\nSo\twe\tcan\tcreate\tvirtual\tmachine\timages\tthat\tbake\tin\tdependencies\tto\tspeed\tup\tfeedback, but\twhy\tstop\tthere?\tWe\tcould\tgo\tfurther,\tbake\tour\tservice\tinto\tthe\timage\titself,\tand\tadopt the\tmodel\tof\tour\tservice\tartifact\tbeing\tan\timage.\tNow,\twhen\twe\tlaunch\tour\timage,\tour service\tis\tthere\tready\tto\tgo.\tThis\treally\tfast\tspin-up\ttime\tis\tthe\treason\tthat\tNetflix\thas adopted\tthe\tmodel\tof\tbaking\tits\town\tservices\tas\tAWS\tAMIs.\n\nJust\tas\twith\tOS-specific\tpackages,\tthese\tVM\timages\tbecome\ta\tnice\tway\tof\tabstracting\tout the\tdifferences\tin\tthe\ttechnology\tstacks\tused\tto\tcreate\tthe\tservices.\tDo\twe\tcare\tif\tthe service\trunning\ton\tthe\timage\tis\twritten\tin\tRuby\tor\tJava,\tand\tuses\ta\tgem\tor\tJAR\tfile?\tAll we\tcare\tabout\tis\tthat\tit\tworks.\tWe\tcan\tfocus\tour\tefforts,\tthen,\ton\tautomating\tthe\tcreation and\tdeployment\tof\tthese\timages.\tThis\talso\tbecomes\ta\treally\tneat\tway\tto\timplement another\tdeployment\tconcept,\tthe\timmutable\tserver.\n\nImmutable\tServers\n\nBy\tstoring\tall\tour\tconfiguration\tin\tsource\tcontrol,\twe\tare\ttrying\tto\tensure\tthat\twe\tcan automatically\treproduce\tservices\tand\thopefully\tentire\tenvironments\tat\twill.\tBut\tonce\twe run\tour\tdeployment\tprocess,\twhat\thappens\tif\tsomeone\tcomes\talong,\tlogs\tinto\tthe\tbox,\tand changes\tthings\tindependently\tof\twhat\tis\tin\tsource\tcontrol?\tThis\tproblem\tis\toften\tcalled configuration\tdrift\t—\tthe\tcode\tin\tsource\tcontrol\tno\tlonger\treflects\tthe\tconfiguration\tof\tthe running\thost.\n\nTo\tavoid\tthis,\twe\tcan\tensure\tthat\tno\tchanges\tare\tever\tmade\tto\ta\trunning\tserver.\tInstead, any\tchange,\tno\tmatter\thow\tsmall,\thas\tto\tgo\tthrough\ta\tbuild\tpipeline\tin\torder\tto\tcreate\ta new\tmachine.\tYou\tcan\timplement\tthis\tpattern\twithout\tusing\timage-based\tdeployments, but\tit\tis\talso\ta\tlogical\textension\tof\tusing\timages\tas\tartifacts.\tDuring\tour\timage\tcreation, for\texample,\twe\tcould\tactually\tdisable\tSSH,\tensuring\tthat\tno\tone\tcould\teven\tlog\tonto\tthe box\tto\tmake\ta\tchange!\n\nThe\tsame\tcaveats\twe\tdiscussed\tearlier\tabout\tcycle\ttime\tstill\tapply,\tof\tcourse.\tAnd\twe\talso need\tto\tensure\tthat\tany\tdata\twe\tcare\tabout\tthat\tis\tstored\ton\tthe\tbox\tis\tstored\telsewhere. These\tcomplexities\taside,\tI’ve\tseen\tadopting\tthis\tpattern\tlead\tto\tmuch\tmore straightforward\tdeployments,\tand\teasier-to-reason-about\tenvironments.\tAnd\tas\tI’ve already\tsaid,\tanything\twe\tcan\tdo\tto\tsimplify\tthings\tshould\tbe\tpursued!\n\nEnvironments\n\nAs\tour\tsoftware\tmoves\tthrough\tour\tCD\tpipeline\tstages,\tit\twill\talso\tbe\tdeployed\tinto different\ttypes\tof\tenvironments.\tIf\twe\tthink\tof\tthe\texample\tbuild\tpipeline\tin\tFigure\t6-4, we\tprobably\thave\tto\tconsider\tat\tleast\tfour\tdistinct\tenvironments:\tone\tenvironment\twhere we\trun\tour\tslow\ttests,\tanother\tfor\tUAT,\tanother\tfor\tperformance,\tand\ta\tfinal\tone\tfor production.\tOur\tmicroservice\tshould\tbe\tthe\tsame\tthroughout,\tbut\tthe\tenvironment\twill\tbe different.\tAt\tthe\tvery\tleast,\tthey’ll\tbe\tseparate,\tdistinct\tcollections\tof\tconfiguration\tand hosts.\tBut\toften\tthey\tcan\tvary\tmuch\tmore\tthan\tthat.\tFor\texample,\tour\tproduction environment\tfor\tour\tservice\tmight\tconsist\tof\tmultiple\tload-balanced\thosts\tspread\tacross two\tdata\tcenters,\twhereas\tour\ttest\tenvironment\tmight\tjust\thave\teverything\trunning\ton\ta single\thost.\tThese\tdifferences\tin\tenvironments\tcan\tintroduce\ta\tfew\tproblems.\n\nI\twas\tbitten\tby\tthis\tpersonally\tmany\tyears\tago.\tWe\twere\tdeploying\ta\tJava\tweb\tservice\tinto a\tclustered\tWebLogic\tapplication\tcontainer\tin\tproduction.\tThis\tWebLogic\tcluster replicated\tsession\tstate\tbetween\tmultiple\tnodes,\tgiving\tus\tsome\tlevel\tof\tresilience\tif\ta single\tnode\tfailed.\tHowever,\tthe\tWebLogic\tlicenses\twere\texpensive,\tas\twere\tthe\tmachines our\tsoftware\twas\tdeployed\tonto.\tThis\tmeant\tthat\tin\tour\ttest\tenvironment,\tour\tsoftware was\tdeployed\ton\ta\tsingle\tmachine,\tin\ta\tnonclustered\tconfiguration.\n\nThis\thurt\tus\tbadly\tduring\tone\trelease.\tFor\tWebLogic\tto\tbe\table\tto\tcopy\tsession\tstate between\tnodes,\tthe\tsession\tdata\tneeds\tto\tbe\tproperly\tserializable.\tUnfortunately,\tone\tof our\tcommits\tbroke\tthis,\tso\twhen\twe\tdeployed\tinto\tproduction\tour\tsession\treplication failed.\tWe\tended\tup\tresolving\tthis\tby\tpushing\thard\tto\treplicate\ta\tclustered\tsetup\tin\tour\ttest environment.\n\nThe\tservice\twe\twant\tto\tdeploy\tis\tthe\tsame\tin\tall\tthese\tdifferent\tenvironments,\tbut\teach\tof the\tenvironments\tserves\ta\tdifferent\tpurpose.\tOn\tmy\tdeveloper\tlaptop\tI\twant\tto\tquickly deploy\tthe\tservice,\tpotentially\tagainst\tstubbed\tcollaborators,\tto\trun\ttests\tor\tcarry\tout\tsome manual\tvalidation\tof\tbehavior,\twhereas\twhen\tI\tdeploy\tinto\ta\tproduction\tenvironment\tI may\twant\tto\tdeploy\tmultiple\tcopies\tof\tmy\tservice\tin\ta\tload-balanced\tfashion,\tperhaps\tsplit across\tone\tor\tmore\tdata\tcenters\tfor\tdurability\treasons.\n\nAs\tyou\tmove\tfrom\tyour\tlaptop\tto\tbuild\tserver\tto\tUAT\tenvironment\tall\tthe\tway\tto production,\tyou’ll\twant\tto\tensure\tthat\tyour\tenvironments\tare\tmore\tand\tmore\tproduction- like\tto\tcatch\tany\tproblems\tassociated\twith\tthese\tenvironmental\tdifferences\tsooner.\tThis will\tbe\ta\tconstant\tbalance.\tSometimes\tthe\ttime\tand\tcost\tto\treproduce\tproduction-like environments\tcan\tbe\tprohibitive,\tso\tyou\thave\tto\tmake\tcompromises.\tAdditionally, sometimes\tusing\ta\tproduction-like\tenvironment\tcan\tslow\tdown\tfeedback\tloops;\twaiting for\t25\tmachines\tto\tinstall\tyour\tsoftware\tin\tAWS\tmight\tbe\tmuch\tslower\tthan\tsimply deploying\tyour\tservice\tinto\ta\tlocal\tVagrant\tinstance,\tfor\texample.\n\nThis\tbalance,\tbetween\tproduction-like\tenvironments\tand\tfast\tfeedback,\twon’t\tbe\tstatic. Keep\tan\teye\ton\tthe\tbugs\tyou\tfind\tfurther\tdownstream\tand\tyour\tfeedback\ttimes,\tand\tadjust\n\nthis\tbalance\tas\trequired.\n\nManaging\tenvironments\tfor\tsingle-artfact\tmonolithic\tsystems\tcan\tbe\tchallenging, especially\tif\tyou\tdon’t\thave\taccess\tto\tsystems\tthat\tare\teasily\tautomatable.\tWhen\tyou\tthink about\tmultiple\tenvironments\tper\tmicroservice,\tthis\tcan\tbe\teven\tmore\tdaunting.\tWe’ll\tlook shortly\tat\tsome\tdifferent\tdeployment\tplatforms\tthat\tcan\tmake\tthis\tmuch\teasier\tfor\tus.\n\nService\tConfiguration\n\nOur\tservices\tneed\tsome\tconfiguration.\tIdeally,\tthis\tshould\tbe\ta\tsmall\tamount,\tand\tlimited to\tthose\tfeatures\tthat\tchange\tfrom\tone\tenvironment\tto\tanother,\tsuch\tas\twhat\tusername\tand password\tshould\tI\tuse\tto\tconnect\tto\tmy\tdatabase?\tConfiguration\tthat\tchanges\tfrom\tone environment\tto\tanother\tshould\tbe\tkept\tto\tan\tabsolute\tminimum.\tThe\tmore\tyour configuration\tchanges\tfundamental\tservice\tbehavior,\tand\tthe\tmore\tthat\tconfiguration varies\tfrom\tone\tenvironment\tto\tanother,\tthe\tmore\tyou\twill\tfind\tproblems\tonly\tin\tcertain environments,\twhich\tis\tpainful\tin\tthe\textreme.\n\nSo\tif\twe\thave\tsome\tconfiguration\tfor\tour\tservice\tthat\tdoes\tchange\tfrom\tone\tenvironment to\tanother,\thow\tshould\twe\thandle\tthis\tas\tpart\tof\tour\tdeployment\tprocess?\tOne\toption\tis\tto build\tone\tartifact\tper\tenvironment,\twith\tconfiguration\tinside\tthe\tartifact\titself.\tInitially this\tseems\tsensible.\tThe\tconfiguration\tis\tbuilt\tright\tin;\tjust\tdeploy\tit\tand\teverything\tshould work\tfine,\tright?\tThis\tis\tproblematic.\tRemember\tthe\tconcept\tof\tcontinuous\tdelivery.\tWe want\tto\tcreate\tan\tartifact\tthat\trepresents\tour\trelease\tcandidate,\tand\tmove\tit\tthrough\tour pipeline,\tconfirming\tthat\tit\tis\tgood\tenough\tto\tgo\tinto\tproduction.\tLet’s\timagine\tI\tbuild\ta Customer-Service-Test\tand\tCustomer-Service-Prod\tartifacts.\tIf\tmy\tCustomer-Service-Test artifact\tpasses\tthe\ttests,\tbut\tit’s\tthe\tCustomer-Service-Prod\tartifact\tthat\tI\tactually\tdeploy, can\tI\tbe\tsure\tthat\tI\thave\tverified\tthe\tsoftware\tthat\tactually\tends\tup\tin\tproduction?\n\nThere\tare\tother\tchallenges\tas\twell.\tFirst,\tthere\tis\tthe\tadditional\ttime\ttaken\tto\tbuild\tthese artifacts.\tNext,\tthe\tfact\tthat\tyou\tneed\tto\tknow\tat\tbuild\ttime\twhat\tenvironments\texist.\tAnd how\tdo\tyou\thandle\tsensitive\tconfiguration\tdata?\tI\tdon’t\twant\tinformation\tabout production\tpasswords\tchecked\tin\twith\tmy\tsource\tcode,\tbut\tif\tit\tis\tneeded\tat\tbuild\ttime\tto create\tall\tthose\tartifacts,\tthis\tis\toften\tdifficult\tto\tavoid.\n\nA\tbetter\tapproach\tis\tto\tcreate\tone\tsingle\tartifact,\tand\tmanage\tconfiguration\tseparately. This\tcould\tbe\ta\tproperties\tfile\tthat\texists\tfor\teach\tenvironment,\tor\tdifferent\tparameters passed\tin\tto\tan\tinstall\tprocess.\tAnother\tpopular\toption,\tespecially\twhen\tdealing\twith\ta larger\tnumber\tof\tmicroservices,\tis\tto\tuse\ta\tdedicated\tsystem\tfor\tproviding\tconfiguration, which\twe’ll\texplore\tmore\tin\tChapter\t11.\n\nService-to-Host\tMapping\n\nOne\tof\tthe\tquestions\tthat\tcomes\tup\tquite\tearly\ton\tin\tthe\tdiscussion\taround\tmicroservices is\t“How\tmany\tservices\tper\tmachine?”\tBefore\twe\tgo\ton,\twe\tshould\tpick\ta\tbetter\tterm\tthan machine,\tor\teven\tthe\tmore\tgeneric\tbox\tthat\tI\tused\tearlier.\tIn\tthis\tera\tof\tvirtualization,\tthe mapping\tbetween\ta\tsingle\thost\trunning\tan\toperating\tsystem\tand\tthe\tunderlying\tphysical infrastructure\tcan\tvary\tto\ta\tgreat\textent.\tThus,\tI\ttend\tto\ttalk\tabout\thosts,\tusing\tthem\tas\ta generic\tunit\tof\tisolation\t—\tnamely,\tan\toperating\tsystem\tonto\twhich\tI\tcan\tinstall\tand\trun my\tservices.\tIf\tyou\tare\tdeploying\tdirectly\ton\tto\tphysical\tmachines,\tthen\tone\tphysical server\tmaps\tto\tone\thost\t(which\tis\tperhaps\tnot\tcompletely\tcorrect\tterminology\tin\tthis context,\tbut\tin\tthe\tabsence\tof\tbetter\tterms\tmay\thave\tto\tsuffice).\tIf\tyou’re\tusing virtualization,\ta\tsingle\tphysical\tmachine\tcan\tmap\tto\tmultiple\tindependent\thosts,\teach\tof which\tcould\thold\tone\tor\tmore\tservices.\n\nSo\twhen\tthinking\tof\tdifferent\tdeployment\tmodels,\twe’ll\ttalk\tabout\thosts.\tSo,\tthen,\thow many\tservices\tper\thost\tshould\twe\thave?\n\nI\thave\ta\tdefinite\tview\tas\tto\twhich\tmodel\tis\tpreferable,\tbut\tthere\tare\ta\tnumber\tof\tfactors\tto consider\twhen\tworking\tout\twhich\tmodel\twill\tbe\tright\tfor\tyou.\tIt’s\talso\timportant\tto understand\tthat\tsome\tchoices\twe\tmake\tin\tthis\tregard\twill\tlimit\tsome\tof\tthe\tdeployment options\tavailable\tto\tus.\n\nMultiple\tServices\tPer\tHost\n\nHaving\tmultiple\tservices\tper\thost,\tas\tshown\tin\tFigure\t6-6,\tis\tattractive\tfor\ta\tnumber\tof reasons.\tFirst,\tpurely\tfrom\ta\thost\tmanagement\tpoint\tof\tview,\tit\tis\tsimpler.\tIn\ta\tworld where\tone\tteam\tmanages\tthe\tinfrastructure\tand\tanother\tteam\tmanages\tthe\tsoftware,\tthe infrastructure\tteam’s\tworkload\tis\toften\ta\tfunction\tof\tthe\tnumber\tof\thosts\tit\thas\tto\tmanage. If\tmore\tservices\tare\tpacked\ton\tto\ta\tsingle\thost,\tthe\thost\tmanagement\tworkload\tdoesn’t increase\tas\tthe\tnumber\tof\tservices\tincreases.\tSecond\tis\tcost.\tEven\tif\tyou\thave\taccess\tto\ta virtualization\tplatform\tthat\tallows\tyou\tto\tprovision\tand\tresize\tvirtual\thosts,\tthe virtualization\tcan\tadd\tan\toverhead\tthat\treduces\tthe\tunderlying\tresources\tavailable\tto\tyour services.\tIn\tmy\topinion,\tboth\tthese\tproblems\tcan\tbe\taddressed\twith\tnew\tworking\tpractices and\ttechnology,\tand\twe’ll\texplore\tthat\tshortly.\n\nThis\tmodel\tis\talso\tfamiliar\tto\tthose\twho\tdeploy\tinto\tsome\tform\tof\tan\tapplication container.\tIn\tsome\tways,\tthe\tuse\tof\tan\tapplication\tcontainer\tis\ta\tspecial\tcase\tof\tthe multiple-services-per-host\tmodel,\tso\twe’ll\tlook\tinto\tthat\tseparately.\tThis\tmodel\tcan\talso simplify\tthe\tlife\tof\tthe\tdeveloper.\tDeploying\tmultiple\tservices\tto\ta\tsingle\thost\tin production\tis\tsynonymous\twith\tdeploying\tmultiple\tservices\tto\ta\tlocal\tdev\tworkstation\tor laptop.\tIf\twe\twant\tto\tlook\tat\tan\talternative\tmodel,\twe\twant\tto\tfind\ta\tway\tto\tkeep\tthis conceptually\tsimple\tfor\tdevelopers.\n\nFigure\t6-6.\tMultiple\tmicroservices\tper\thost\n\nThere\tare\tsome\tchallenges\twith\tthis\tmodel,\tthough.\tFirst,\tit\tcan\tmake\tmonitoring\tmore difficult.\tFor\texample,\twhen\ttracking\tCPU,\tdo\tI\tneed\tto\ttrack\tthe\tCPU\tof\tone\tservice independent\tof\tthe\tothers?\tOr\tdo\tI\tcare\tabout\tthe\tCPU\tof\tthe\tbox\tas\ta\twhole?\tSide\teffects\n\ncan\talso\tbe\thard\tto\tavoid.\tIf\tone\tservice\tis\tunder\tsignificant\tload,\tit\tcan\tend\tup\treducing the\tresources\tavailable\tto\tother\tparts\tof\tthe\tsystem.\tGilt,\twhen\tscaling\tout\tthe\tnumber\tof services\tit\tran,\thit\tthis\tproblem.\tInitially\tit\tcoexisted\tmany\tservices\ton\ta\tsingle\tbox,\tbut uneven\tload\ton\tone\tof\tthe\tservices\twould\thave\tan\tadverse\timpact\ton\teverything\telse running\ton\tthat\thost.\tThis\tmakes\timpact\tanalysis\tof\thost\tfailures\tmore\tcomplex\tas\twell\t— taking\ta\tsingle\thost\tout\tof\tcommission\tcan\thave\ta\tlarge\tripple\teffect.\n\nDeployment\tof\tservices\tcan\tbe\tsomewhat\tmore\tcomplex\ttoo,\tas\tensuring\tone\tdeployment doesn’t\taffect\tanother\tleads\tto\tadditional\theadaches.\tFor\texample,\tif\tI\tuse\tPuppet\tto prepare\ta\thost,\tbut\teach\tservice\thas\tdifferent\t(and\tpotentially\tcontradictory)\tdependencies, how\tcan\tI\tmake\tthat\twork?\tIn\tthe\tworst-case\tscenario,\tI\thave\tseen\tpeople\ttie\tmultiple service\tdeployments\ttogether,\tdeploying\tmultiple\tdifferent\tservices\tto\ta\tsingle\thost\tin\tone step,\tto\ttry\tto\tsimplify\tthe\tdeployment\tof\tmultiple\tservices\tto\tone\thost.\tIn\tmy\topinion,\tthe small\tupside\tin\timproving\tsimplicity\tis\tmore\tthan\toutweighed\tby\tthe\tfact\tthat\twe\thave given\tup\tone\tof\tthe\tkey\tbenefits\tof\tmicroservices:\tstriving\tfor\tindependent\trelease\tof\tour software.\tIf\tyou\tdo\tadopt\tthe\tmultiple-services-per-host\tmodel,\tmake\tsure\tyou\tkeep\thold of\tthe\tidea\tthat\teach\tservice\tshould\tbe\tdeployed\tindependently.\n\nThis\tmodel\tcan\talso\tinhibit\tautonomy\tof\tteams.\tIf\tservices\tfor\tdifferent\tteams\tare\tinstalled on\tthe\tsame\thost,\twho\tgets\tto\tconfigure\tthe\thost\tfor\ttheir\tservices?\tIn\tall\tlikelihood,\tthis ends\tup\tgetting\thandled\tby\ta\tcentralized\tteam,\tmeaning\tit\ttakes\tmore\tcoordination\tto\tget services\tdeployed.\n\nAnother\tissue\tis\tthat\tthis\toption\tcan\tlimit\tour\tdeployment\tartifact\toptions.\tImage-based deployments\tare\tout,\tas\tare\timmutable\tservers\tunless\tyou\ttie\tmultiple\tdifferent\tservices together\tin\ta\tsingle\tartifact,\twhich\twe\treally\twant\tto\tavoid.\n\nThe\tfact\tthat\twe\thave\tmultiple\tservices\ton\ta\tsingle\thost\tmeans\tthat\tefforts\tto\ttarget\tscaling to\tthe\tservice\tmost\tin\tneed\tof\tit\tcan\tbe\tcomplicated.\tLikewise,\tif\tone\tmicroservice\thandles data\tand\toperations\tthat\tare\tespecially\tsensitive,\twe\tmight\twant\tto\tset\tup\tthe\tunderlying host\tdifferently,\tor\tperhaps\teven\tplace\tthe\thost\titself\tin\ta\tseparate\tnetwork\tsegment. Having\teverything\ton\tone\thost\tmeans\twe\tmight\tend\tup\thaving\tto\ttreat\tall\tservices\tthe same\tway\teven\tif\ttheir\tneeds\tare\tdifferent.\n\nAs\tmy\tcolleague\tNeal\tFord\tputs\tit,\tmany\tof\tour\tworking\tpractices\taround\tdeployment\tand host\tmanagement\tare\tan\tattempt\tto\toptimize\tfor\tscarcity\tof\tresources.\tIn\tthe\tpast,\tthe\tonly option\tif\twe\twanted\tanother\thost\twas\tto\tbuy\tor\trent\tanother\tphysical\tmachine.\tThis\toften had\ta\tlarge\tlead\ttime\tto\tit\tand\tresulted\tin\ta\tlong-term\tfinancial\tcommitment.\tIt\twasn’t uncommon\tfor\tclients\tI\thave\tworked\twith\tto\tprovision\tnew\tservers\tonly\tevery\ttwo\tto\tthree years,\tand\ttrying\tto\tget\tadditional\tmachines\toutside\tof\tthese\ttimelines\twas\tdifficult.\tBut on-demand\tcomputing\tplatforms\thave\tdrastically\treduced\tthe\tcosts\tof\tcomputing resources,\tand\timprovements\tin\tvirtualization\ttechnology\tmean\teven\tfor\tin-house\thosted infrastructure\tthere\tis\tmore\tflexibility.\n\nApplication\tContainers\n\nIf\tyou’re\tfamiliar\twith\tdeploying\t.NET\tapplications\tbehind\tIIS\tor\tJava\tapplications\tinto\ta servlet\tcontainer,\tyou\twill\tbe\twell\tacquainted\twith\tthe\tmodel\twhere\tmultiple\tdistinct services\tor\tapplications\tsit\tinside\ta\tsingle\tapplication\tcontainer,\twhich\tin\tturn\tsits\ton\ta single\thost,\tas\twe\tsee\tin\tFigure\t6-7.\tThe\tidea\tis\tthat\tthe\tapplication\tcontainer\tyour services\tlive\tin\tgives\tyou\tbenefits\tin\tterms\tof\timproved\tmanageability,\tsuch\tas\tclustering support\tto\thandle\tgrouping\tmultiple\tinstances\ttogether,\tmonitoring\ttools,\tand\tthe\tlike.\n\nFigure\t6-7.\tMultiple\tmicroservices\tper\thost\n\nThis\tsetup\tcan\talso\tyield\tbenefits\tin\tterms\tof\treducing\toverhead\tof\tlanguage\truntimes. Consider\trunning\tfive\tJava\tservices\tin\ta\tsingle\tJava\tservlet\tcontainer.\tI\tonly\thave\tthe overhead\tof\tone\tsingle\tJVM.\tCompare\tthis\twith\trunning\tfive\tindependent\tJVMs\ton\tthe same\thost\twhen\tusing\tembedded\tcontainers.\tThat\tsaid,\tI\tstill\tfeel\tthat\tthese\tapplication containers\thave\tenough\tdownsides\tthat\tyou\tshould\tchallenge\tyourself\tto\tsee\tif\tthey\tare really\trequired.\n\nFirst\tamong\tthe\tdownsides\tis\tthat\tthey\tinevitably\tconstrain\ttechnology\tchoice.\tYou\thave to\tbuy\tinto\ta\ttechnology\tstack.\tThis\tcan\tlimit\tnot\tonly\tthe\ttechnology\tchoices\tfor\tthe implementation\tof\tthe\tservice\titself,\tbut\talso\tthe\toptions\tyou\thave\tin\tterms\tof\tautomation and\tmanagement\tof\tyour\tsystems.\tAs\twe’ll\tdiscuss\tshortly,\tone\tof\tthe\tways\twe\tcan address\tthe\toverhead\tof\tmanaging\tmultiple\thosts\tis\taround\tautomation,\tand\tso\n\nconstraining\tour\toptions\tfor\tresolving\tthis\tmay\twell\tbe\tdoubly\tdamaging.\n\nI\twould\talso\tquestion\tsome\tof\tthe\tvalue\tof\tthe\tcontainer\tfeatures.\tMany\tof\tthem\ttout\tthe ability\tto\tmanage\tclusters\tto\tsupport\tshared\tin-memory\tsession\tstate,\tsomething\twe absolutely\twant\tto\tavoid\tin\tany\tcase\tdue\tto\tthe\tchallenges\tthis\tcreates\twhen\tscaling\tour services.\tAnd\tthe\tmonitoring\tcapabilities\tthey\tprovide\twon’t\tbe\tsufficient\twhen\twe consider\tthe\tsorts\tof\tjoined-up\tmonitoring\twe\twant\tto\tdo\tin\ta\tmicroservices\tworld,\tas we’ll\tsee\tin\tChapter\t8.\tMany\tof\tthem\talso\thave\tquite\tslow\tspin-up\ttimes,\timpacting developer\tfeedback\tcycles.\n\nThere\tare\tother\tsets\tof\tproblems\ttoo.\tAttempting\tto\tdo\tproper\tlifecycle\tmanagement\tof applications\ton\ttop\tof\tplatforms\tlike\tthe\tJVM\tcan\tbe\tproblematic,\tand\tmore\tcomplex\tthan simply\trestarting\ta\tJVM.\tAnalyzing\tresource\tuse\tand\tthreads\tis\talso\tmuch\tmore\tcomplex, as\tyou\thave\tmultiple\tapplications\tsharing\tthe\tsame\tprocess.\tAnd\tremember,\teven\tif\tyou\tdo get\tvalue\tfrom\ta\ttechnology-specific\tcontainer,\tthey\taren’t\tfree.\tAside\tfrom\tthe\tfact\tthat many\tof\tthem\tare\tcommercial\tand\tso\thave\ta\tcost\timplication,\tthey\tadd\ta\tresource overhead\tin\tand\tof\tthemselves.\n\nUltimately,\tthis\tapproach\tis\tagain\tan\tattempt\tto\toptimize\tfor\tscarcity\tof\tresources\tthat simply\tmay\tnot\thold\tup\tanymore.\tWhether\tyou\tdecide\tto\thave\tmultiple\tservices\tper\thost as\ta\tdeployment\tmodel,\tI\twould\tstrongly\tsuggest\tlooking\tat\tself-contained\tdeployable microservices\tas\tartifacts.\tFor\t.NET,\tthis\tis\tpossible\twith\tthings\tlike\tNancy,\tand\tJava\thas supported\tthis\tmodel\tfor\tyears.\tFor\texample,\tthe\tvenerable\tJetty\tembedded\tcontainer makes\tfor\ta\tvery\tlightweight\tself-contained\tHTTP\tserver,\twhich\tis\tthe\tcore\tof\tthe Dropwizard\tstack.\tGoogle\thas\tbeen\tknown\tto\tquite\thappily\tuse\tembedded\tJetty\tcontainers for\tserving\tstatic\tcontent\tdirectly,\tso\twe\tknow\tthese\tthings\tcan\toperate\tat\tscale.\n\nSingle\tService\tPer\tHost\n\nWith\ta\tsingle-service-per-host\tmodel\tshown\tin\tFigure\t6-8,\twe\tavoid\tside\teffects\tof multiple\thosts\tliving\ton\ta\tsingle\thost,\tmaking\tmonitoring\tand\tremediation\tmuch\tsimpler. We\thave\tpotentially\treduced\tour\tsingle\tpoints\tof\tfailure.\tAn\toutage\tto\tone\thost\tshould impact\tonly\ta\tsingle\tservice,\talthough\tthat\tisn’t\talways\tclear\twhen\tyou’re\tusing\ta virtualized\tplatform.\tWe’ll\tcover\tdesigning\tfor\tscale\tand\tfailure\tmore\tin\tChapter\t11.\tWe also\tcan\tmore\teasily\tscale\tone\tservice\tindependent\tfrom\tothers,\tand\tdeal\twith\tsecurity concerns\tmore\teasily\tby\tfocusing\tour\tattention\tonly\ton\tthe\tservice\tand\thost\tthat\trequires it.\n\nFigure\t6-8.\tA\tsingle\tmicroservice\tper\thost\n\nJust\tas\timportant\tis\tthat\twe\thave\topened\tup\tthe\tpotential\tto\tuse\talternative\tdeployment techniques\tsuch\tas\timage-based\tdeployments\tor\tthe\timmutable\tserver\tpattern,\twhich\twe discussed\tearlier.\n\nWe’ve\tadded\ta\tlot\tof\tcomplexity\tin\tadopting\ta\tmicroservice\tarchitecture.\tThe\tlast\tthing\twe want\tto\tdo\tis\tgo\tlooking\tfor\tmore\tsources\tof\tcomplexity.\tIn\tmy\topinion,\tif\tyou\tdon’t\thave a\tviable\tPaaS\tavailable,\tthen\tthis\tmodel\tdoes\ta\tvery\tgood\tjob\tof\treducing\ta\tsystem’s overall\tcomplexity.\tHaving\ta\tsingle-service-per-host\tmodel\tis\tsignificantly\teasier\tto\n\nreason\tabout\tand\tcan\thelp\treduce\tcomplexity.\tIf\tyou\tcan’t\tembrace\tthis\tmodel\tyet,\tI\twon’t say\tmicroservices\taren’t\tfor\tyou.\tBut\tI\twould\tsuggest\tthat\tyou\tlook\tto\tmove\ttoward\tthis model\tover\ttime\tas\ta\tway\tof\treducing\tthe\tcomplexity\tthat\ta\tmicroservice\tarchitecture\tcan bring.\n\nHaving\tan\tincreased\tnumber\tof\thosts\thas\tpotential\tdownsides,\tthough.\tWe\thave\tmore servers\tto\tmanage,\tand\tthere\tmight\talso\tbe\ta\tcost\timplication\tof\trunning\tmore\tdistinct hosts.\tDespite\tthese\tproblems,\tthis\tis\tstill\tthe\tmodel\tI\tprefer\tfor\tmicroservice architectures.\tAnd\twe’ll\ttalk\tabout\ta\tfew\tthings\twe\tcan\tdo\tto\treduce\tthe\toverhead\tof handling\tlarge\tnumbers\tof\thosts\tshortly.\n\nPlatform\tas\ta\tService\n\nWhen\tusing\ta\tplatform\tas\ta\tservice\t(PaaS),\tyou\tare\tworking\tat\ta\thigher-level\tabstraction than\tat\ta\tsingle\thost.\tMost\tof\tthese\tplatforms\trely\ton\ttaking\ta\ttechnology-specific\tartifact, such\tas\ta\tJava\tWAR\tfile\tor\tRuby\tgem,\tand\tautomatically\tprovisioning\tand\trunning\tit\tfor you.\tSome\tof\tthese\tplatforms\twill\ttransparently\tattempt\tto\thandle\tscaling\tthe\tsystem\tup and\tdown\tfor\tyou,\talthough\ta\tmore\tcommon\t(and\tin\tmy\texperience\tless\terror-prone)\tway will\tallow\tyou\tsome\tcontrol\tover\thow\tmany\tnodes\tyour\tservice\tmight\trun\ton,\tbut\tit handles\tthe\trest.\n\nAt\tthe\ttime\tof\twriting,\tmost\tof\tthe\tbest,\tmost\tpolished\tPaaS\tsolutions\tare\thosted.\tHeroku comes\tto\tmind\tas\tbeing\tprobably\tthe\tgold\tclass\tof\tPaaS.\tIt\tdoesn’t\tjust\thandle\trunning your\tservice,\tit\talso\tsupports\tservices\tlike\tdatabases\tin\ta\tvery\tsimple\tfashion.\tSelf-hosted solutions\tdo\texist\tin\tthis\tspace,\talthough\tthey\tare\tmore\timmature\tthan\tthe\thosted solutions.\n\nWhen\tPaaS\tsolutions\twork\twell,\tthey\twork\tvery\twell\tindeed.\tHowever,\twhen\tthey\tdon’t quite\twork\tfor\tyou,\tyou\toften\tdon’t\thave\tmuch\tcontrol\tin\tterms\tof\tgetting\tunder\tthe\thood to\tfix\tthings.\tThis\tis\tpart\tof\tthe\ttrade-off\tyou\tmake.\tI\twould\tsay\tthat\tin\tmy\texperience\tthe smarter\tthe\tPaaS\tsolutions\ttry\tto\tbe,\tthe\tmore\tthey\tgo\twrong.\tI’ve\tused\tmore\tthan\tone PaaS\tthat\tattempts\tto\tautoscale\tbased\ton\tapplication\tuse,\tbut\tdoes\tit\tbadly.\tInvariably\tthe heuristics\tthat\tdrive\tthese\tsmarts\ttend\tto\tbe\ttailored\tfor\tthe\taverage\tapplication\trather\tthan your\tspecific\tuse\tcase.\tThe\tmore\tnonstandard\tyour\tapplication,\tthe\tmore\tlikely\tit\tis\tthat\tit might\tnot\tplay\tnicely\twith\ta\tPaaS.\n\nAs\tthe\tgood\tPaaS\tsolutions\thandle\tso\tmuch\tfor\tyou,\tthey\tcan\tbe\tan\texcellent\tway\tof handling\tthe\tincreased\toverhead\twe\tget\twith\thaving\tmany\tmore\tmoving\tparts.\tThat\tsaid, I’m\tstill\tnot\tsure\tthat\twe\thave\tall\tthe\tmodels\tright\tin\tthis\tspace\tyet,\tand\tthe\tlimited\tself- hosted\toptions\tmean\tthat\tthis\tapproach\tmight\tnot\twork\tfor\tyou.\tIn\tthe\tcoming\tdecade though\tI\texpect\twe’ll\tbe\ttargeting\tPaaS\tfor\tdeployment\tmore\tthan\thaving\tto\tself-manage hosts\tand\tdeployments\tof\tindividual\tservices.\n\nAutomation\n\nThe\tanswer\tto\tso\tmany\tproblems\twe\thave\traised\tso\tfar\tcomes\tdown\tto\tautomation.\tWith\ta small\tnumber\tof\tmachines,\tit\tis\tpossible\tto\tmanage\teverything\tmanually.\tI\tused\tto\tdo\tthis. I\tremember\trunning\ta\tsmall\tset\tof\tproduction\tmachines,\tand\tI\twould\tcollect\tlogs,\tdeploy software,\tand\tcheck\tprocesses\tby\tmanually\tlogging\tin\tto\tthe\tbox.\tMy\tproductivity\tseemed to\tbe\tconstrained\tby\tthe\tnumber\tof\tterminal\twindows\tI\tcould\thave\topen\tat\tonce\t—\ta second\tmonitor\twas\ta\thuge\tstep\tup.\tThis\tbreaks\tdown\treally\tfast,\tthough.\n\nOne\tof\tthe\tpushbacks\tagainst\tthe\tsingle-service-per-host\tsetup\tis\tthe\tperception\tthat\tthe amount\tof\toverhead\tto\tmanage\tthese\thosts\twill\tincrease.\tThis\tis\tcertainly\ttrue\tif\tyou\tare doing\teverything\tmanually.\tDouble\tthe\tservers,\tdouble\tthe\twork!\tBut\tif\twe\tautomate control\tof\tour\thosts,\tand\tdeployment\tof\tthe\tservices,\tthen\tthere\tis\tno\treason\twhy\tadding more\thosts\tshould\tincrease\tour\tworkload\tin\ta\tlinear\tfashion.\n\nBut\teven\tif\twe\tkeep\tthe\tnumber\tof\thosts\tsmall,\twe\tstill\tare\tgoing\tto\thave\tlots\tof\tservices. That\tmeans\tmultiple\tdeployments\tto\thandle,\tservices\tto\tmonitor,\tlogs\tto\tcollect. Automation\tis\tessential.\n\nAutomation\tis\talso\thow\twe\tcan\tmake\tsure\tthat\tour\tdevelopers\tstill\tremain\tproductive. Giving\tthem\tthe\tability\tto\tself-service-provision\tindividual\tservices\tor\tgroups\tof\tservices is\tkey\tto\tmaking\tdevelopers’\tlives\teasier.\tIdeally,\tdevelopers\tshould\thave\taccess\tto\texactly the\tsame\ttool\tchain\tas\tis\tused\tfor\tdeployment\tof\tour\tproduction\tservices\tso\tas\tto\tensure that\twe\tcan\tspot\tproblems\tearly\ton.\tWe’ll\tbe\tlooking\tat\ta\tlot\tof\ttechnology\tin\tthis\tchapter that\tembraces\tthis\tview.\n\nPicking\ttechnology\tthat\tenables\tautomation\tis\thighly\timportant.\tThis\tstarts\twith\tthe\ttools used\tto\tmanage\thosts.\tCan\tyou\twrite\ta\tline\tof\tcode\tto\tlaunch\ta\tvirtual\tmachine,\tor\tshut one\tdown?\tCan\tyou\tdeploy\tthe\tsoftware\tyou\thave\twritten\tautomatically?\tCan\tyou\tdeploy database\tchanges\twithout\tmanual\tintervention?\tEmbracing\ta\tculture\tof\tautomation\tis\tkey if\tyou\twant\tto\tkeep\tthe\tcomplexities\tof\tmicroservice\tarchitectures\tin\tcheck.\n\nTwo\tCase\tStudies\ton\tthe\tPower\tof\tAutomation\n\nIt\tis\tprobably\thelpful\tto\tgive\tyou\ta\tcouple\tof\tconcrete\texamples\tthat\texplain\tthe\tpower\tof good\tautomation.\tOne\tof\tour\tclients\tin\tAustralia\tis\tRealEstate.com.au\t(REA).\tAmong other\tthings,\tthe\tcompany\tprovides\treal\testate\tlistings\tfor\tretail\tand\tcommercial\tcustomers in\tAustralia\tand\telsewhere\tin\tthe\tAsia-Pacific\tregion.\tOver\ta\tnumber\tof\tyears,\tit\thas\tbeen moving\tits\tplatform\ttoward\ta\tdistributed,\tmicroservices\tdesign.\tWhen\tit\tstarted\ton\tthis journey\tit\thad\tto\tspend\ta\tlot\tof\ttime\tgetting\tthe\ttooling\taround\tthe\tservices\tjust\tright\t— making\tit\teasy\tfor\tdevelopers\tto\tprovision\tmachines,\tto\tdeploy\ttheir\tcode,\tor\tmonitor them.\tThis\tcaused\ta\tfront-loading\tof\twork\tto\tget\tthings\tstarted.\n\nIn\tthe\tfirst\tthree\tmonths\tof\tthis\texercise,\tREA\twas\table\tto\tmove\tjust\ttwo\tnew microservices\tinto\tproduction,\twith\tthe\tdevelopment\tteam\ttaking\tfull\tresponsibility\tfor\tthe entire\tbuild,\tdeployment,\tand\tsupport\tof\tthe\tservices.\tIn\tthe\tnext\tthree\tmonths,\tbetween 10–15\tservices\twent\tlive\tin\ta\tsimilar\tmanner.\tBy\tthe\tend\tof\tthe\t18-month\tperiod,\tREA\thad over\t60–70\tservices.\n\nThis\tsort\tof\tpattern\tis\talso\tborne\tout\tby\tthe\texperiences\tof\tGilt,\tan\tonline\tfashion\tretailer that\tstarted\tin\t2007.\tGilt’s\tmonolithic\tRails\tapplication\twas\tstarting\tto\tbecome\tdifficult\tto scale,\tand\tthe\tcompany\tdecided\tin\t2009\tto\tstart\tdecomposing\tthe\tsystem\tinto microservices.\tAgain\tautomation,\tespecially\ttooling\tto\thelp\tdevelopers,\twas\tgiven\tas\ta key\treason\tto\tdrive\tGilt’s\texplosion\tin\tthe\tuse\tof\tmicroservices.\tA\tyear\tlater,\tGilt\thad around\t10\tmicroservices\tlive;\tby\t2012,\tover\t100;\tand\tin\t2014,\tover\t450\tmicroservices\tby Gilt’s\town\tcount\t—\tin\tother\twords,\taround\tthree\tservices\tfor\tevery\tdeveloper\tin\tGilt.\n\nFrom\tPhysical\tto\tVirtual\n\nOne\tof\tthe\tkey\ttools\tavailable\tto\tus\tin\tmanaging\ta\tlarge\tnumber\tof\thosts\tis\tfinding\tways of\tchunking\tup\texisting\tphysical\tmachines\tinto\tsmaller\tparts.\tTraditional\tvirtualization like\tVMWare\tor\tthat\tused\tby\tAWS\thas\tyielded\thuge\tbenefits\tin\treducing\tthe\toverhead\tof host\tmanagement.\tHowever,\tthere\thave\tbeen\tsome\tnew\tadvances\tin\tthis\tspace\tthat\tare well\tworth\texploring,\tas\tthey\tcan\topen\tup\teven\tmore\tinteresting\tpossibilities\tfor\tdealing with\tour\tmicroservice\tarchitecture.\n\nTraditional\tVirtualization\n\nWhy\tis\thaving\tlots\tof\thosts\texpensive?\tWell,\tif\tyou\tneed\ta\tphysical\tserver\tper\thost,\tthe answer\tis\tfairly\tobvious.\tIf\tthis\tis\tthe\tworld\tyou\tare\toperating\tin,\tthen\tthe\tmultiple- service-per-host\tmodel\tis\tprobably\tright\tfor\tyou,\talthough\tdon’t\tbe\tsurprised\tif\tthis becomes\tan\tever\tmore\tchallenging\tconstraint.\tI\tsuspect,\thowever,\tthat\tmost\tof\tyou\tare using\tvirtualization\tof\tsome\tsort.\tVirtualization\tallows\tus\tto\tslice\tup\ta\tphysical\tserver\tinto separate\thosts,\teach\tof\twhich\tcan\trun\tdifferent\tthings.\tSo\tif\twe\twant\tone\tservice\tper\thost, can’t\twe\tjust\tslice\tup\tour\tphysical\tinfrastructure\tinto\tsmaller\tand\tsmaller\tpieces?\n\nWell,\tfor\tsome\tpeople,\tyou\tcan.\tHowever,\tslicing\tup\tthe\tmachine\tinto\tever\tincreasing VMs\tisn’t\tfree.\tThink\tof\tour\tphysical\tmachine\tas\ta\tsock\tdrawer.\tIf\twe\tput\tlots\tof\twooden dividers\tinto\tour\tdrawer,\tcan\twe\tstore\tmore\tsocks\tor\tfewer?\tThe\tanswer\tis\tfewer:\tthe dividers\tthemselves\ttake\tup\troom\ttoo!\tOur\tdrawer\tmight\tbe\teasier\tto\tdeal\twith\tand organize,\tand\tperhaps\twe\tcould\tdecide\tto\tput\tT-shirts\tin\tone\tof\tthe\tspaces\tnow\trather\tthan just\tsocks,\tbut\tmore\tdividers\tmeans\tless\toverall\tspace.\n\nIn\tthe\tworld\tof\tvirtualization,\twe\thave\ta\tsimilar\toverhead\tas\tour\tsock\tdrawer\tdividers.\tTo understand\twhere\tthis\toverhead\tcomes\tfrom,\tlet’s\tlook\tat\thow\tmost\tvirtualization\tis\tdone. Figure\t6-9\tshows\ta\tcomparison\tof\ttwo\ttypes\tof\tvirtualization.\tOn\tthe\tleft,\twe\tsee\tthe various\tlayers\tinvolved\tin\twhat\tis\tcalled\ttype\t2\tvirtualization,\twhich\tis\tthe\tsort implemented\tby\tAWS,\tVMWare,\tVSphere,\tXen,\tand\tKVM.\t(Type\t1\tvirtualization\trefers to\ttechnology\twhere\tthe\tVMs\trun\tdirectly\ton\thardware,\tnot\ton\ttop\tof\tanother\toperating system.)\tOn\tour\tphysical\tinfrastructure\twe\thave\ta\thost\toperating\tsystem.\tOn\tthis\tOS\twe run\tsomething\tcalled\ta\thypervisor,\twhich\thas\ttwo\tkey\tjobs.\tFirst,\tit\tmaps\tresources\tlike CPU\tand\tmemory\tfrom\tthe\tvirtual\thost\tto\tthe\tphysical\thost.\tSecond,\tit\tacts\tas\ta\tcontrol layer,\tallowing\tus\tto\tmanipulate\tthe\tvirtual\tmachines\tthemselves.\n\nFigure\t6-9.\tA\tcomparison\tof\tstandard\tType\t2\tvirtualization,\tand\tlightweight\tcontainers\n\nInside\tthe\tVMs,\twe\tget\twhat\tlooks\tlike\tcompletely\tdifferent\thosts.\tThey\tcan\trun\ttheir\town\n\noperating\tsystems,\twith\ttheir\town\tkernels.\tThey\tcan\tbe\tconsidered\talmost\thermetically sealed\tmachines,\tkept\tisolated\tfrom\tthe\tunderlying\tphysical\thost\tand\tthe\tother\tvirtual machines\tby\tthe\thypervisor.\n\nThe\tproblem\tis\tthat\tthe\thypervisor\there\tneeds\tto\tset\taside\tresources\tto\tdo\tits\tjob.\tThis takes\taway\tCPU,\tI/O,\tand\tmemory\tthat\tcould\tbe\tused\telsewhere.\tThe\tmore\thosts\tthe hypervisor\tmanages,\tthe\tmore\tresources\tit\tneeds.\tAt\ta\tcertain\tpoint,\tthis\toverhead becomes\ta\tconstraint\tin\tslicing\tup\tyour\tphysical\tinfrastructure\tany\tfurther.\tIn\tpractice,\tthis means\tthat\tthere\tare\toften\tdiminishing\treturns\tin\tslicing\tup\ta\tphysical\tbox\tinto\tsmaller\tand smaller\tparts,\tas\tproportionally\tmore\tand\tmore\tresources\tgo\tinto\tthe\toverhead\tof\tthe hypervisor.\n\nVagrant\n\nVagrant\tis\ta\tvery\tuseful\tdeployment\tplatform,\twhich\tis\tnormally\tused\tfor\tdev\tand\ttest rather\tthan\tproduction.\tVagrant\tprovides\tyou\twith\ta\tvirtual\tcloud\ton\tyour\tlaptop. Underneath,\tit\tuses\ta\tstandard\tvirtualization\tsystem\t(typically\tVirtualBox,\talthough\tit\tcan use\tother\tplatforms).\tIt\tallows\tyou\tto\tdefine\ta\tset\tof\tVMs\tin\ta\ttext\tfile,\talong\twith\thow\tthe VMs\tare\tnetworked\ttogether\tand\twhich\timages\tthe\tVMs\tshould\tbe\tbased\ton.\tThis\ttext\tfile can\tbe\tchecked\tin\tand\tshared\tbetween\tteam\tmembers.\n\nThis\tmakes\tit\teasier\tfor\tyou\tto\tcreate\tproduction-like\tenvironments\ton\tyour\tlocal\tmachine. You\tcan\tspin\tup\tmultiple\tVMs\tat\ta\ttime,\tshut\tindividual\tones\tto\ttest\tfailure\tmodes,\tand have\tthe\tVMs\tmapped\tthrough\tto\tlocal\tdirectories\tso\tyou\tcan\tmake\tchanges\tand\tsee\tthem reflected\timmediately.\tEven\tfor\tteams\tusing\ton-demand\tcloud\tplatforms\tlike\tAWS,\tthe faster\tturnaround\tof\tusing\tVagrant\tcan\tbe\ta\thuge\tboon\tfor\tdevelopment\tteams.\n\nOne\tof\tthe\tdownsides,\tthough,\tis\tthat\trunning\tlots\tof\tVMs\tcan\ttax\tthe\taverage development\tmachine.\tIf\twe\thave\tone\tservice\tto\tone\tVM,\tyou\tmay\tnot\tbe\table\tto\tbring\tup your\tentire\tsystem\ton\tyour\tlocal\tmachine.\tThis\tcan\tresult\tin\tthe\tneed\tto\tstub\tout\tsome dependencies\tto\tmake\tthings\tmanageable,\twhich\tis\tone\tmore\tthing\tyou’ll\thave\tto\thandle to\tensure\tthat\tthe\tdevelopment\tand\ttest\texperience\tis\ta\tgood\tone.\n\nLinux\tContainers\n\nFor\tLinux\tusers,\tthere\tis\tan\talternative\tto\tvirtualization.\tRather\tthan\thaving\ta\thypervisor to\tsegment\tand\tcontrol\tseparate\tvirtual\thosts,\tLinux\tcontainers\tinstead\tcreate\ta\tseparate process\tspace\tin\twhich\tother\tprocesses\tlive.\n\nOn\tLinux,\tprocess\tare\trun\tby\ta\tgiven\tuser,\tand\thave\tcertain\tcapabilities\tbased\ton\thow\tthe permissions\tare\tset.\tProcesses\tcan\tspawn\tother\tprocesses.\tFor\texample,\tif\tI\tlaunch\ta process\tin\ta\tterminal,\tthat\tchild\tprocess\tis\tgenerally\tconsidered\ta\tchild\tof\tthe\tterminal process.\tThe\tLinux\tkernel’s\tjob\tis\tmaintaining\tthis\ttree\tof\tprocesses.\n\nLinux\tcontainers\textend\tthis\tidea.\tEach\tcontainer\tis\teffectively\ta\tsubtree\tof\tthe\toverall system\tprocess\ttree.\tThese\tcontainers\tcan\thave\tphysical\tresources\tallocated\tto\tthem, something\tthe\tkernel\thandles\tfor\tus.\tThis\tgeneral\tapproach\thas\tbeen\taround\tin\tmany forms,\tsuch\tas\tSolaris\tZones\tand\tOpenVZ,\tbut\tit\tis\tLXC\tthat\thas\tbecome\tmost\tpopular. LXC\tis\tnow\tavailable\tout\tof\tthe\tbox\tin\tany\tmodern\tLinux\tkernel.\n\nIf\twe\tlook\tat\ta\tstack\tdiagram\tfor\ta\thost\trunning\tLXC\tin\tFigure\t6-9,\twe\tsee\ta\tfew differences.\tFirst,\twe\tdon’t\tneed\ta\thypervisor.\tSecond,\talthough\teach\tcontainer\tcan\trun\tits own\toperating\tsystem\tdistribution,\tit\thas\tto\tshare\tthe\tsame\tkernel\t(because\tthe\tkernel\tis where\tthe\tprocess\ttree\tlives).\tThis\tmeans\tthat\tour\thost\toperating\tsystem\tcould\trun\tUbuntu, and\tour\tcontainers\tCentOS,\tas\tlong\tas\tthey\tcould\tboth\tshare\tthe\tsame\tkernel.\n\nWe\tdon’t\tjust\tbenefit\tfrom\tthe\tresources\tsaved\tby\tnot\tneeding\ta\thypervisor.\tWe\talso\tgain in\tterms\tof\tfeedback.\tLinux\tcontainers\tare\tmuch\tfaster\tto\tprovision\tthan\tfull-fat\tvirtual machines.\tIt\tisn’t\tuncommon\tfor\ta\tVM\tto\ttake\tmany\tminutes\tto\tstart\t—\tbut\twith\tLinux containers,\tstartup\tcan\ttake\ta\tfew\tseconds.\tYou\talso\thave\tfiner-grained\tcontrol\tover\tthe containers\tthemselves\tin\tterms\tof\tassigning\tresources\tto\tthem,\twhich\tmakes\tit\tmuch\teasier to\ttweak\tthe\tsettings\tto\tget\tthe\tmost\tout\tof\tthe\tunderlying\thardware.\n\nDue\tto\tthe\tlighter-weight\tnature\tof\tcontainers,\twe\tcan\thave\tmany\tmore\tof\tthem\trunning on\tthe\tsame\thardware\tthan\twould\tbe\tpossible\twith\tVMs.\tBy\tdeploying\tone\tservice\tper container,\tas\tin\tFigure\t6-10,\twe\tget\ta\tdegree\tof\tisolation\tfrom\tother\tcontainers\t(although this\tisn’t\tperfect),\tand\tcan\tdo\tso\tmuch\tmore\tcost\teffectively\tthan\twould\tbe\tpossible\tif\twe wanted\tto\trun\teach\tservice\tin\tits\town\tVM.\n\nFigure\t6-10.\tRunning\tservices\tin\tseparate\tcontainers\n\nContainers\tcan\tbe\tused\twell\twith\tfull-fat\tvirtualization\ttoo.\tI’ve\tseen\tmore\tthan\tone project\tprovision\ta\tlarge\tAWS\tEC2\tinstance\tand\trun\tLXC\tcontainers\ton\tit\tto\tget\tthe\tbest of\tboth\tworlds:\tan\ton-demand\tephemeral\tcompute\tplatform\tin\tthe\tform\tof\tEC2,\tcoupled with\thighly\tflexible\tand\tfast\tcontainers\trunning\ton\ttop\tof\tit.\n\nLinux\tcontainers\taren’t\twithout\tsome\tproblems,\thowever.\tImagine\tI\thave\tlots\tof microservices\trunning\tin\ttheir\town\tcontainers\ton\ta\thost.\tHow\tdoes\tthe\toutside\tworld\tsee them?\tYou\tneed\tsome\tway\tto\troute\tthe\toutside\tworld\tthrough\tto\tthe\tunderlying\tcontainers, something\tmany\tof\tthe\thypervisors\tdo\tfor\tyou\twith\tnormal\tvirtualization.\tI’ve\tseen\tmany a\tperson\tsink\tinordinate\tamounts\tof\ttime\tinto\tconfiguring\tport\tforwarding\tusing\tIPTables to\texpose\tcontainers\tdirectly.\tAnother\tpoint\tto\tbear\tin\tmind\tis\tthat\tthese\tcontainers\tcannot be\tconsidered\tcompletely\tsealed\tfrom\teach\tother.\tThere\tare\tmany\tdocumented\tand\tknown ways\tin\twhich\ta\tprocess\tfrom\tone\tcontainer\tcan\tbust\tout\tand\tinteract\twith\tother\tcontainers or\tthe\tunderlying\thost.\tSome\tof\tthese\tproblems\tare\tby\tdesign\tand\tsome\tare\tbugs\tthat\tare\n\nbeing\taddressed,\tbut\teither\tway\tif\tyou\tdon’t\ttrust\tthe\tcode\tyou\tare\trunning,\tdon’t\texpect that\tyou\tcan\trun\tit\tin\ta\tcontainer\tand\tbe\tsafe.\tIf\tyou\tneed\tthat\tsort\tof\tisolation,\tyou’ll\tneed to\tconsider\tusing\tvirtual\tmachines\tinstead.\n\nDocker\n\nDocker\tis\ta\tplatform\tbuilt\ton\ttop\tof\tlightweight\tcontainers.\tIt\thandles\tmuch\tof\tthe\twork around\thandling\tcontainers\tfor\tyou.\tIn\tDocker,\tyou\tcreate\tand\tdeploy\tapps,\twhich\tare synonymous\twith\timages\tin\tthe\tVM\tworld,\talbeit\tfor\ta\tcontainer-based\tplatform.\tDocker manages\tthe\tcontainer\tprovisioning,\thandles\tsome\tof\tthe\tnetworking\tproblems\tfor\tyou, and\teven\tprovides\tits\town\tregistry\tconcept\tthat\tallows\tyou\tto\tstore\tand\tversion\tDocker applications.\n\nThe\tDocker\tapp\tabstraction\tis\ta\tuseful\tone\tfor\tus,\tbecause\tjust\tas\twith\tVM\timages\tthe underlying\ttechnology\tused\tto\timplement\tthe\tservice\tis\thidden\tfrom\tus.\tWe\thave\tour builds\tfor\tour\tservices\tcreate\tDocker\tapplications,\tand\tstore\tthem\tin\tthe\tDocker\tregistry, and\taway\twe\tgo.\n\nDocker\tcan\talso\talleviate\tsome\tof\tthe\tdownsides\tof\trunning\tlots\tof\tservices\tlocally\tfor\tdev and\ttest\tpurposes.\tRather\tthan\tusing\tVagrant\tto\thost\tmultiple\tindependent\tVMs,\teach\tone containing\tits\town\tservice,\twe\tcan\thost\ta\tsingle\tVM\tin\tVagrant\tthat\truns\ta\tDocker instance.\tWe\tthen\tuse\tVagrant\tto\tset\tup\tand\ttear\tdown\tthe\tDocker\tplatform\titself,\tand\tuse Docker\tfor\tfast\tprovisioning\tof\tindividual\tservices.\n\nA\tnumber\tof\tdifferent\ttechnologies\tare\tbeing\tdeveloped\tto\ttake\tadvantage\tof\tDocker. CoreOS\tis\ta\tvery\tinteresting\toperating\tsystem\tdesigned\twith\tDocker\tin\tmind.\tIt\tis\ta stripped-down\tLinux\tOS\tthat\tprovides\tonly\tthe\tessential\tservices\tto\tallow\tDocker\tto\trun. This\tmeans\tit\tconsumes\tfewer\tresources\tthan\tother\toperating\tsystems,\tmaking\tit\tpossible to\tdedicate\teven\tmore\tresources\tof\tthe\tunderlying\tmachine\tto\tour\tcontainers.\tRather\tthan using\ta\tpackage\tmanager\tlike\tdebs\tor\tRPMs,\tall\tsoftware\tis\tinstalled\tas\tindependent Docker\tapps,\teach\trunning\tin\tits\town\tcontainer.\n\nDocker\titself\tdoesn’t\tsolve\tall\tproblems\tfor\tus.\tThink\tof\tit\tas\ta\tsimple\tPaaS\tthat\tworks\ton a\tsingle\tmachine.\tIf\tyou\twant\ttools\tto\thelp\tyou\tmanage\tservices\tacross\tmultiple\tDocker instances\tacross\tmultiple\tmachines,\tyou’ll\tneed\tto\tlook\tat\tother\tsoftware\tthat\tadds\tthese capabilities.\tThere\tis\ta\tkey\tneed\tfor\ta\tscheduling\tlayer\tthat\tlets\tyou\trequest\ta\tcontainer and\tthen\tfinds\ta\tDocker\tcontainer\tthat\tcan\trun\tit\tfor\tyou.\tIn\tthis\tspace,\tGoogle’s\trecently open\tsourced\tKubernetes\tand\tCoreOS’s\tcluster\ttechnology\tcan\thelp,\tand\tit\tseems\tevery month\tthere\tis\ta\tnew\tentrant\tin\tthis\tspace.\tDeis\tis\tanother\tinteresting\ttool\tbased\ton Docker,\twhich\tis\tattempting\tto\tprovide\ta\tHeroku-like\tPaaS\ton\ttop\tof\tDocker.\n\nI\ttalked\tearlier\tabout\tPaaS\tsolutions.\tMy\tstruggle\twith\tthem\thas\talways\tbeen\tthat\tthey often\tget\tthe\tabstraction\tlevel\twrong,\tand\tthat\tself-hosted\tsolutions\tlag\tsignificantly behind\thosted\tsolutions\tlike\tHeroku.\tDocker\tgets\tmuch\tmore\tof\tthis\tright,\tand\tthe explosion\tof\tinterest\tin\tthis\tspace\tmeans\tI\tsuspect\tit\twill\tbecome\ta\tmuch\tmore\tviable platform\tfor\tall\tsorts\tof\tdeployments\tover\tthe\tnext\tfew\tyears\tfor\tall\tsorts\tof\tdifferent\tuse cases.\tIn\tmany\tways,\tDocker\twith\tan\tappropriate\tscheduling\tlayer\tsits\tbetween\tIaaS\tand PaaS\tsolutions\t—\tthe\tterm\tcontainers\tas\ta\tservice\t(CaaS)\tis\talready\tbeing\tused\tto\n\ndescribe\tit.\n\nDocker\tis\tbeing\tused\tin\tproduction\tby\tmultiple\tcompanies.\tIt\tprovides\tmany\tof\tthe benefits\tof\tlightweight\tcontainers\tin\tterms\tof\tefficiency\tand\tspeed\tof\tprovisioning, together\twith\tthe\ttools\tto\tavoid\tmany\tof\tthe\tdownsides.\tIf\tyou\tare\tinterested\tin\tlooking\tat alternative\tdeployment\tplatforms,\tI’d\tstrongly\tsuggest\tyou\tgive\tDocker\ta\tlook.\n\nA\tDeployment\tInterface\n\nWhatever\tunderlying\tplatform\tor\tartifacts\tyou\tuse,\thaving\ta\tuniform\tinterface\tto\tdeploy\ta given\tservice\tis\tvital.\tWe’ll\twant\tto\ttrigger\tdeployment\tof\ta\tmicroservice\ton\tdemand\tin\ta variety\tof\tdifferent\tsituations,\tfrom\tdeployments\tlocally\tfor\tdev\tand\ttest\tto\tproduction deployments.\tWe’ll\talso\twant\tto\tkeep\tour\tdeployment\tmechanisms\tas\tsimilar\tas\tpossible from\tdev\tto\tproduction,\tas\tthe\tlast\tthing\twe\twant\tis\tto\tfind\tourselves\thitting\tproblems\tin production\tbecause\tdeployment\tuses\ta\tcompletely\tdifferent\tprocess!\n\nAfter\tmany\tyears\tof\tworking\tin\tthis\tspace,\tI\tam\tconvinced\tthat\tthe\tmost\tsensible\tway\tto trigger\tany\tdeployment\tis\tvia\ta\tsingle,\tparameterizable\tcommand-line\tcall.\tThis\tcan\tbe triggered\tby\tscripts,\tlaunched\tby\tyour\tCI\ttool,\tor\ttyped\tin\tby\thand.\tI’ve\tbuilt\twrapper scripts\tin\ta\tvariety\tof\ttechnology\tstacks\tto\tmake\tthis\twork,\tfrom\tWindows\tbatch,\tto\tbash, to\tPython\tFabric\tscripts,\tand\tmore,\tbut\tall\tof\tthe\tcommand\tlines\tshare\tthe\tsame\tbasic format.\n\nWe\tneed\tto\tknow\twhat\twe\tare\tdeploying,\tso\twe\tneed\tto\tprovide\tthe\tname\tof\ta\tknown entity,\tor\tin\tour\tcase\ta\tmicroservice.\tWe\talso\tneed\tto\tknow\twhat\tversion\tof\tthe\tentity\twe want.\tThe\tanswer\tto\twhat\tversion\ttends\tto\tbe\tone\tof\tthree\tpossibilities.\tWhen\tyou’re working\tlocally,\tit’ll\tbe\twhatever\tversion\tis\ton\tyour\tlocal\tmachine.\tWhen\ttesting,\tyou’ll want\tthe\tlatest\tgreen\tbuild,\twhich\tcould\tjust\tbe\tthe\tmost\trecent\tblessed\tartifact\tin\tour artifact\trepository.\tOr\twhen\ttesting/diagnosing\tissues,\twe\tmay\twant\tto\tdeploy\tan\texact build.\n\nThe\tthird\tand\tfinal\tthing\twe’ll\tneed\tto\tknow\tis\twhat\tenvironment\twe\twant\tthe microservice\tdeployed\tinto.\tAs\twe\tdiscussed\tearlier,\tour\tmicroservice’s\ttopology\tmay differ\tfrom\tone\tenvironment\tto\tthe\tnext,\tbut\tthat\tshould\tbe\thidden\tfrom\tus\there.\n\nSo,\timagine\twe\tcreate\ta\tsimple\tdeploy\tscript\tthat\ttakes\tthese\tthree\tparameters.\tSay\twe’re developing\tlocally\tand\twant\tto\tdeploy\tour\tcatalog\tservice\tinto\tour\tlocal\tenvironment.\tI might\ttype:\n\n$\tdeploy\tartifact=catalog\tenvironment=local\tversion=local\n\nOnce\tI’ve\tchecked\tin,\tour\tCI\tbuild\tservice\tpicks\tup\tthe\tchange\tand\tcreates\ta\tnew\tbuild artifact,\tgiving\tit\tthe\tbuild\tnumber\tb456.\tAs\tis\tstandard\tin\tmost\tCI\ttools,\tthis\tvalue\tgets passed\talong\tthe\tpipeline.\tWhen\tour\ttest\tstage\tgets\ttriggered,\tthe\tCI\tstage\twill\trun:\n\n$\tdeploy\tartifact=catalog\tenvironment=ci\tversion=b456\n\nMeanwhile,\tour\tQA\twants\tto\tpull\tthe\tlatest\tversion\tof\tthe\tcatalog\tservice\tinto\tan integrated\ttest\tenvironment\tto\tdo\tsome\texploratory\ttesting,\tand\tto\thelp\twith\ta\tshowcase. That\tteam\truns:\n\n$\tdeploy\tartifact=catalog\tenvironment=integrated_qa\tversion=latest\n\nThe\ttool\tI’ve\tused\tthe\tmost\tfor\tthis\tis\tFabric,\ta\tPython\tlibrary\tdesigned\tto\tmap\tcommand- line\tcalls\tto\tfunctions,\talong\twith\tgood\tsupport\tfor\thandling\ttasks\tlike\tSSH\tinto\tremote machines.\tPair\tit\twith\tan\tAWS\tclient\tlibrary\tlike\tBoto,\tand\tyou\thave\teverything\tyou\tneed to\tfully\tautomate\tvery\tlarge\tAWS\tenvironments.\tFor\tRuby,\tCapistrano\tis\tsimilar\tin\tsome ways\tto\tFabric,\tand\ton\tWindows\tyou\tcould\tgo\ta\tlong\tway\tusing\tPowerShell.\n\nEnvironment\tDefinition\n\nClearly,\tfor\tthis\tto\twork,\twe\tneed\tto\thave\tsome\tway\tof\tdefining\twhat\tour\tenvironments look\tlike,\tand\twhat\tour\tservice\tlooks\tlike\tin\ta\tgiven\tenvironment.\tYou\tcan\tthink\tof\tan environment\tdefinition\tas\ta\tmapping\tfrom\ta\tmicroservice\tto\tcompute,\tnetwork,\tand storage\tresources.\tI’ve\tdone\tthis\twith\tYAML\tfiles\tbefore,\tand\tused\tmy\tscripts\tto\tpull\tthis data\tin.\tExample\t6-1\tis\ta\tsimplified\tversion\tof\tsome\twork\tI\tdid\ta\tcouple\tof\tyears\tago\tfor\ta project\tthat\tused\tAWS.\n\nExample\t6-1.\tAn\texample\tenvironment\tdefinition development: \t\tnodes: \t\t-\tami_id:\tami-e1e1234 \t\t\t\tsize:\t\t\tt1.micro\t \t\t\t\tcredentials_name:\teu-west-ssh\t \t\t\t\tservices:\t[catalog-service] \t\t\t\tregion:\teu-west-1\n\nproduction: \t\tnodes: \t\t-\tami_id:\tami-e1e1234 \t\t\t\tsize:\t\t\tm3.xlarge\t \t\t\t\tcredentials_name:\tprod-credentials\t \t\t\t\tservices:\t[catalog-service] \t\t\t\tnumber:\t5\n\nWe\tvaried\tthe\tsize\tof\tthe\tinstances\twe\tused\tto\tbe\tmore\tcost\teffective.\tYou\tdon’t\tneed a\t16-core\tbox\twith\t64GB\tof\tRAM\tfor\texploratory\ttesting!\n\nBeing\table\tto\tspecify\tdifferent\tcredentials\tfor\tdifferent\tenvironments\tis\tkey. Credentials\tfor\tsensitive\tenvironments\twere\tstored\tin\tdifferent\tsource\tcode\trepos\tthat only\tselect\tpeople\twould\thave\taccess\tto.\n\nWe\tdecided\tthat\tby\tdefault\tif\ta\tservice\thad\tmore\tthan\tone\tnode\tconfigured,\twe\twould automatically\tcreate\ta\tload\tbalancer\tfor\tit.\n\nI\thave\tremoved\tsome\tdetail\tfor\tthe\tsake\tof\tbrevity.\n\nThe\tcatalog-service\tinformation\twas\tstored\telsewhere.\tIt\tdidn’t\tdiffer\tfrom\tone environment\tto\tthe\tnext,\tas\tyou\tcan\tsee\tin\tExample\t6-2.\n\nExample\t6-2.\tAn\texample\tenvironment\tdefinition catalog-service: \t\tpuppet_manifest\t:\tcatalog.pp\t \t\tconnectivity: \t\t\t\t-\tprotocol:\ttcp \t\t\t\t\t\tports:\t[\t8080,\t8081\t] \t\t\t\t\t\tallowed:\t[\tWORLD\t]\n\nThis\twas\tthe\tname\tof\tthe\tPuppet\tfile\tto\trun\t—\twe\thappened\tto\tuse\tPuppet\tsolo\tin\tthis situation,\tbut\ttheoretically\tcould\thave\tsupported\talternative\tconfiguration\tsystems.\n\nObviously,\ta\tlot\tof\tthe\tbehavior\there\twas\tconvention\tbased.\tFor\texample,\twe\tdecided\tto normalize\twhich\tports\tservices\tused\twherever\tthey\tran,\tand\tautomatically\tconfigured\tload balancers\tif\ta\tservice\thad\tmore\tthan\tone\tinstance\t(something\tthat\tAWS’s\tELBs\tmake fairly\teasy).\n\nBuilding\ta\tsystem\tlike\tthis\trequired\ta\tsignificant\tamount\tof\twork.\tThe\teffort\tis\toften\tfront- loaded,\tbut\tcan\tbe\tessential\tto\tmanage\tthe\tdeployment\tcomplexity\tyou\thave.\tI\thope\tin\tthe future\tyou\twon’t\thave\tto\tdo\tthis\tyourself.\tTerraform\tis\ta\tvery\tnew\ttool\tfrom\tHashicorp, which\tworks\tin\tthis\tspace.\tI’d\tgenerally\tshy\taway\tfrom\tmentioning\tsuch\ta\tnew\ttool\tin\ta book\tthat\tis\tmore\tabout\tideas\tthan\ttechnology,\tbut\tit\tis\tattempting\tto\tcreate\tan\topen\tsource tool\talong\tthese\tlines.\tIt’s\tearly\tdays\tyet,\tbut\talready\tits\tcapabilities\tseem\treally interesting.\tWith\tthe\tability\tto\ttarget\tdeployments\ton\ta\tnumber\tof\tdifferent\tplatforms,\tin the\tfuture\tit\tcould\tbe\tjust\tthe\ttool\tfor\tthe\tjob.\n\nSummary\n\nWe’ve\tcovered\ta\tlot\tof\tground\there,\tso\ta\trecap\tis\tin\torder.\tFirst,\tfocus\ton\tmaintaining\tthe ability\tto\trelease\tone\tservice\tindependently\tfrom\tanother,\tand\tmake\tsure\tthat\twhatever technology\tyou\tselect\tsupports\tthis.\tI\tgreatly\tprefer\thaving\ta\tsingle\trepository\tper microservice,\tbut\tam\tfirmer\tstill\tthat\tyou\tneed\tone\tCI\tbuild\tper\tmicroservice\tif\tyou\twant to\tdeploy\tthem\tseparately.\n\nNext,\tif\tpossible,\tmove\tto\ta\tsingle-service\tper\thost/container.\tLook\tat\talternative technologies\tlike\tLXC\tor\tDocker\tto\tmake\tmanaging\tthe\tmoving\tparts\tcheaper\tand\teasier, but\tunderstand\tthat\twhatever\ttechnology\tyou\tadopt,\ta\tculture\tof\tautomation\tis\tkey\tto managing\teverything.\tAutomate\teverything,\tand\tif\tthe\ttechnology\tyou\thave\tdoesn’t\tallow this,\tget\tsome\tnew\ttechnology!\tBeing\table\tto\tuse\ta\tplatform\tlike\tAWS\twill\tgive\tyou\thuge benefits\twhen\tit\tcomes\tto\tautomation.\n\nMake\tsure\tyou\tunderstand\tthe\timpact\tyour\tdeployment\tchoices\thave\ton\tdevelopers,\tand make\tsure\tthey\tfeel\tthe\tlove\ttoo.\tCreating\ttools\tthat\tlet\tyou\tself-service-deploy\tany\tgiven service\tinto\ta\tnumber\tof\tdifferent\tenvironments\tis\treally\timportant,\tand\twill\thelp developers,\ttesters,\tand\toperations\tpeople\talike.\n\nFinally,\tif\tyou\twant\tto\tgo\tdeeper\tinto\tthis\ttopic,\tI\tthoroughly\trecommend\tyou\tread\tJez Humble\tand\tDavid\tFarley’s\tContinuous\tDelivery\t(Addison-Wesley),\twhich\tgoes\tinto much\tmore\tdetail\ton\tsubjects\tlike\tpipeline\tdesign\tand\tartifact\tmanagement.\n\nIn\tthe\tnext\tchapter,\twe’ll\tbe\tgoing\tdeeper\tinto\ta\ttopic\twe\ttouched\ton\tbriefly\there.\tNamely, how\tdo\twe\ttest\tour\tmicroservices\tto\tmake\tsure\tthey\tactually\twork?\n\nChapter\t7.\tTesting\n\nThe\tworld\tof\tautomated\ttesting\thas\tadvanced\tsignificantly\tsince\tI\tfirst\tstarted\twriting code,\tand\tevery\tmonth\tthere\tseems\tto\tbe\tsome\tnew\ttool\tor\ttechnique\tto\tmake\tit\teven better.\tBut\tchallenges\tremain\tas\thow\tto\teffectively\tand\tefficiently\ttest\tour\tfunctionality when\tit\tspans\ta\tdistributed\tsystem.\tThis\tchapter\tbreaks\tdown\tthe\tproblems\tassociated\twith testing\tfiner-grained\tsystems\tand\tpresents\tsome\tsolutions\tto\thelp\tyou\tmake\tsure\tyou\tcan release\tyour\tnew\tfunctionality\twith\tconfidence.\n\nTesting\tcovers\ta\tlot\tof\tground.\tEven\twhen\twe\tare\tjust\ttalking\tabout\tautomated\ttests,\tthere are\ta\tlarge\tnumber\tto\tconsider.\tWith\tmicroservices,\twe\thave\tadded\tanother\tlevel\tof complexity.\tUnderstanding\twhat\tdifferent\ttypes\tof\ttests\twe\tcan\trun\tis\timportant\tto\thelp\tus balance\tthe\tsometimes-opposing\tforces\tof\tgetting\tour\tsoftware\tinto\tproduction\tas\tquickly as\tpossible\tversus\tmaking\tsure\tour\tsoftware\tis\tof\tsufficient\tquality.\n\nTypes\tof\tTests\n\nAs\ta\tconsultant,\tI\tlike\tpulling\tout\tthe\todd\tquadrant\tas\ta\tway\tof\tcategorizing\tthe\tworld,\tand I\twas\tstarting\tto\tworry\tthis\tbook\twouldn’t\thave\tone.\tLuckily,\tBrian\tMarick\tcame\tup\twith a\tfantastic\tcategorization\tsystem\tfor\ttests\tthat\tfits\tright\tin.\tFigure\t7-1\tshows\ta\tvariation\tof Marick’s\tquadrant\tfrom\tLisa\tCrispin\tand\tJanet\tGregory’s\tbook\tAgile\tTesting\t(Addison- Wesley)\tthat\thelps\tcategorize\tthe\tdifferent\ttypes\tof\ttests.\n\nFigure\t7-1.\tBrian\tMarick’s\ttesting\tquadrant.\tCrispin,\tLisa;\tGregory,\tJanet,\tAgile\tTesting:\tA\tPractical\tGuide\tfor\tTesters and\tAgile\tTeams,\t1st\tEdition,\t©\t2009.\tAdapted\tby\tpermission\tof\tPearson\tEducation,\tInc.,\tUpper\tSaddle\tRiver,\tNJ.\n\nAt\tthe\tbottom,\twe\thave\ttests\tthat\tare\ttechnology-facing\t—\tthat\tis,\ttests\tthat\taid\tthe developers\tin\tcreating\tthe\tsystem\tin\tthe\tfirst\tplace.\tPerformance\ttests\tand\tsmall-scoped unit\ttests\tfall\tinto\tthis\tcategory\t—\tall\ttypically\tautomated.\tThis\tis\tcompared\twith\tthe\ttop half\tof\tthe\tquadrant,\twhere\ttests\thelp\tthe\tnontechnical\tstakeholders\tunderstand\thow\tyour system\tworks.\tThese\tcould\tbe\tlarge-scoped,\tend-to-end\ttests,\tas\tshown\tin\tthe\ttop-left Acceptance\tTest\tsquare,\tor\tmanual\ttesting\tas\ttypified\tby\tuser\ttesting\tdone\tagainst\ta\tUAT system,\tas\tshown\tin\tthe\tExploratory\tTesting\tsquare.\n\nEach\ttype\tof\ttest\tshown\tin\tthis\tquadrant\thas\ta\tplace.\tExactly\thow\tmuch\tof\teach\ttest\tyou want\tto\tdo\twill\tdepend\ton\tthe\tnature\tof\tyour\tsystem,\tbut\tthe\tkey\tpoint\tto\tunderstand\tis that\tyou\thave\tmultiple\tchoices\tin\tterms\tof\thow\tto\ttest\tyour\tsystem.\tThe\ttrend\trecently\thas been\taway\tfrom\tany\tlarge-scale\tmanual\ttesting,\tin\tfavor\tof\tautomating\tas\tmuch\tas possible,\tand\tI\tcertainly\tagree\twith\tthis\tapproach.\tIf\tyou\tcurrently\tcarry\tout\tlarge\tamounts of\tmanual\ttesting,\tI\twould\tsuggest\tyou\taddress\tthat\tbefore\tproceeding\ttoo\tfar\tdown\tthe path\tof\tmicroservices,\tas\tyou\twon’t\tget\tmany\tof\ttheir\tbenefits\tif\tyou\tare\tunable\tto\tvalidate your\tsoftware\tquickly\tand\tefficiently.\n\nFor\tthe\tpurposes\tof\tthis\tchapter,\twe\twill\tignore\tmanual\ttesting.\tAlthough\tthis\tsort\tof testing\tcan\tbe\tvery\tuseful\tand\tcertainly\thas\tits\tpart\tto\tplay,\tthe\tdifferences\twith\ttesting\ta microservice\tarchitecture\tmostly\tplay\tout\tin\tthe\tcontext\tof\tvarious\ttypes\tof\tautomated tests,\tso\tthat\tis\twhere\twe\twill\tfocus\tour\ttime.",
      "page_number": 188
    },
    {
      "number": 7,
      "title": "Testing",
      "start_page": 231,
      "end_page": 267,
      "detection_method": "regex_chapter_title",
      "content": "But\twhen\tit\tcomes\tto\tautomated\ttests,\thow\tmany\tof\teach\ttest\tdo\twe\twant?\tAnother\tmodel will\tcome\tin\tvery\thandy\tto\thelp\tus\tanswer\tthis\tquestion,\tand\tunderstand\twhat\tthe\tdifferent trade-offs\tmight\tbe.\n\nTest\tScope\n\nIn\this\tbook\tSucceeding\twith\tAgile\t(Addison-Wesley),\tMike\tCohn\toutlines\ta\tmodel\tcalled the\tTest\tPyramid\tto\thelp\texplain\twhat\ttypes\tof\tautomated\ttests\tyou\tneed.\tThe\tpyramid helps\tus\tthink\tabout\tthe\tscopes\tthe\ttests\tshould\tcover,\tbut\talso\tthe\tproportions\tof\tdifferent types\tof\ttests\twe\tshould\taim\tfor.\tCohn’s\toriginal\tmodel\tsplit\tautomated\ttests\tinto\tUnit, Service,\tand\tUI,\twhich\tyou\tcan\tsee\tin\tFigure\t7-2.\n\nFigure\t7-2.\tMike\tCohn’s\tTest\tPyramid.\tCohn,\tMike,\tSucceeding\twith\tAgile:\tSoftware\tDevelopment\tUsing\tScrum,\t1st Edition,\t©\t2010.\tAdapted\tby\tpermission\tof\tPearson\tEducation,\tInc.,\tUpper\tSaddle\tRiver,\tNJ.\n\nThe\tproblem\twith\tthis\tmodel\tis\tthat\tall\tthese\tterms\tmean\tdifferent\tthings\tto\tdifferent people.\t“Service”\tis\tespecially\toverloaded,\tand\tthere\tare\tmany\tdefinitions\tof\ta\tunit\ttest\tout there.\tIs\ta\ttest\ta\tunit\ttest\tif\tI\tonly\ttest\tone\tline\tof\tcode?\tI’d\tsay\tyes.\tIs\tit\tstill\ta\tunit\ttest\tif\tI test\tmultiple\tfunctions\tor\tclasses?\tI’d\tsay\tno,\tbut\tmany\twould\tdisagree!\tI\ttend\tto\tstick with\tthe\tUnit\tand\tService\tnames\tdespite\ttheir\tambiguity,\tbut\tmuch\tprefer\tcalling\tUI\ttests end-to-end\ttests,\twhich\twe’ll\tdo\tfrom\tnow\ton.\n\nGiven\tthe\tconfusion,\tit’s\tworth\tus\tlooking\tat\twhat\tthese\tdifferent\tlayers\tmean.\n\nLet’s\tlook\tat\ta\tworked\texample.\tIn\tFigure\t7-3,\twe\thave\tour\thelpdesk\tapplication\tand\tour main\twebsite,\tboth\tof\twhich\tare\tinteracting\twith\tour\tcustomer\tservice\tto\tretrieve,\treview, and\tedit\tcustomer\tdetails.\tOur\tcustomer\tservice\tin\tturn\tis\ttalking\tto\tour\tloyalty\tpoints bank,\twhere\tour\tcustomers\taccrue\tpoints\tby\tbuying\tJustin\tBieber\tCDs.\tProbably.\tThis\tis obviously\ta\tsliver\tof\tour\toverall\tmusic\tshop\tsystem,\tbut\tit\tis\ta\tgood\tenough\tslice\tfor\tus\tto\n\ndive\tinto\ta\tfew\tdifferent\tscenarios\twe\tmay\twant\tto\ttest.\n\nFigure\t7-3.\tPart\tof\tour\tmusic\tshop\tunder\ttest\n\nUnit\tTests\n\nThese\tare\ttests\tthat\ttypically\ttest\ta\tsingle\tfunction\tor\tmethod\tcall.\tThe\ttests\tgenerated\tas\ta side\teffect\tof\ttest-driven\tdesign\t(TDD)\twill\tfall\tinto\tthis\tcategory,\tas\tdo\tthe\tsorts\tof\ttests generated\tby\ttechniques\tsuch\tas\tproperty-based\ttesting.\tWe’re\tnot\tlaunching\tservices\there, and\tare\tlimiting\tthe\tuse\tof\texternal\tfiles\tor\tnetwork\tconnections.\tIn\tgeneral,\tyou\twant\ta large\tnumber\tof\tthese\tsorts\tof\ttests.\tDone\tright,\tthey\tare\tvery,\tvery\tfast,\tand\ton\tmodern hardware\tyou\tcould\texpect\tto\trun\tmany\tthousands\tof\tthese\tin\tless\tthan\ta\tminute.\n\nThese\tare\ttests\tthat\thelp\tus\tdevelopers\tand\tso\twould\tbe\ttechnology-facing,\tnot\tbusiness- facing,\tin\tMarick’s\tterminology.\tThey\tare\talso\twhere\twe\thope\tto\tcatch\tmost\tof\tour\tbugs. So,\tin\tour\texample,\twhen\twe\tthink\tabout\tthe\tcustomer\tservice,\tunit\ttests\twould\tcover small\tparts\tof\tthe\tcode\tin\tisolation,\tas\tshown\tin\tFigure\t7-4.\n\nFigure\t7-4.\tScope\tof\tunit\ttests\ton\tour\texample\tsystem\n\nThe\tprime\tgoal\tof\tthese\ttests\tis\tto\tgive\tus\tvery\tfast\tfeedback\tabout\twhether\tour functionality\tis\tgood.\tTests\tcan\tbe\timportant\tto\tsupport\trefactoring\tof\tcode,\tallowing\tus\tto restructure\tour\tcode\tas\twe\tgo,\tknowing\tthat\tour\tsmall-scoped\ttests\twill\tcatch\tus\tif\twe make\ta\tmistake.\n\nService\tTests\n\nService\ttests\tare\tdesigned\tto\tbypass\tthe\tuser\tinterface\tand\ttest\tservices\tdirectly.\tIn\ta monolithic\tapplication,\twe\tmight\tjust\tbe\ttesting\ta\tcollection\tof\tclasses\tthat\tprovide\ta service\tto\tthe\tUI.\tFor\ta\tsystem\tcomprising\ta\tnumber\tof\tservices,\ta\tservice\ttest\twould\ttest an\tindividual\tservice’s\tcapabilities.\n\nThe\treason\twe\twant\tto\ttest\ta\tsingle\tservice\tby\titself\tis\tto\timprove\tthe\tisolation\tof\tthe\ttest to\tmake\tfinding\tand\tfixing\tproblems\tfaster.\tTo\tachieve\tthis\tisolation,\twe\tneed\tto\tstub\tout all\texternal\tcollaborators\tso\tonly\tthe\tservice\titself\tis\tin\tscope,\tas\tFigure\t7-5\tshows.\n\nFigure\t7-5.\tScope\tof\tservice\ttests\ton\tour\texample\tsystem\n\nSome\tof\tthese\ttests\tcould\tbe\tas\tfast\tas\tsmall\ttests,\tbut\tif\tyou\tdecide\tto\ttest\tagainst\ta\treal database,\tor\tgo\tover\tnetworks\tto\tstubbed\tdownstream\tcollaborators,\ttest\ttimes\tcan increase.\tThey\talso\tcover\tmore\tscope\tthan\ta\tsimple\tunit\ttest,\tso\tthat\twhen\tthey\tfail\tit\tcan be\tharder\tto\tdetect\twhat\tis\tbroken\tthan\twith\ta\tunit\ttest.\tHowever,\tthey\thave\tmuch\tfewer moving\tparts\tand\tare\ttherefore\tless\tbrittle\tthan\tlarger-scoped\ttests.\n\nEnd-to-End\tTests\n\nEnd-to-end\ttests\tare\ttests\trun\tagainst\tyour\tentire\tsystem.\tOften\tthey\twill\tbe\tdriving\ta\tGUI through\ta\tbrowser,\tbut\tcould\teasily\tbe\tmimicking\tother\tsorts\tof\tuser\tinteraction,\tlike uploading\ta\tfile.\n\nThese\ttests\tcover\ta\tlot\tof\tproduction\tcode,\tas\twe\tsee\tin\tFigure\t7-6\t.\tSo\twhen\tthey\tpass, you\tfeel\tgood:\tyou\thave\ta\thigh\tdegree\tof\tconfidence\tthat\tthe\tcode\tbeing\ttested\twill\twork in\tproduction.\tBut\tthis\tincreased\tscope\tcomes\twith\tdownsides,\tand\tas\twe’ll\tsee\tshortly, they\tcan\tbe\tvery\ttricky\tto\tdo\twell\tin\ta\tmicroservices\tcontext.\n\nFigure\t7-6.\tScope\tof\tend-to-end\ttests\ton\tour\texample\tsystem\n\nTrade-Offs\n\nWhen\tyou’re\treading\tthe\tpyramid,\tthe\tkey\tthing\tto\ttake\taway\tis\tthat\tas\tyou\tgo\tup\tthe pyramid,\tthe\ttest\tscope\tincreases,\tas\tdoes\tour\tconfidence\tthat\tthe\tfunctionality\tbeing tested\tworks.\tOn\tthe\tother\thand,\tthe\tfeedback\tcycle\ttime\tincreases\tas\tthe\ttests\ttake\tlonger to\trun,\tand\twhen\ta\ttest\tfails\tit\tcan\tbe\tharder\tto\tdetermine\twhich\tfunctionality\thas\tbroken. As\tyou\tgo\tdown\tthe\tpyramid,\tin\tgeneral\tthe\ttests\tbecome\tmuch\tfaster,\tso\twe\tget\tmuch faster\tfeedback\tcycles.\tWe\tfind\tbroken\tfunctionality\tfaster,\tour\tcontinuous\tintegration builds\tare\tfaster,\tand\twe\tare\tless\tlikely\tto\tmove\ton\tto\ta\tnew\ttask\tbefore\tfinding\tout\twe have\tbroken\tsomething.\tWhen\tthose\tsmaller-scoped\ttests\tfail,\twe\talso\ttend\tto\tknow\twhat broke,\toften\texactly\twhat\tline\tof\tcode.\tOn\tthe\tflipside,\twe\tdon’t\tget\ta\tlot\tof\tconfidence that\tour\tsystem\tas\ta\twhole\tworks\tif\twe’ve\tonly\ttested\tone\tline\tof\tcode!\n\nWhen\tbroader-scoped\ttests\tlike\tour\tservice\tor\tend-to-end\ttests\tfail,\twe\twill\ttry\tto\twrite\ta fast\tunit\ttest\tto\tcatch\tthat\tproblem\tin\tthe\tfuture.\tIn\tthat\tway,\twe\tare\tconstantly\ttrying\tto improve\tour\tfeedback\tcycles.\n\nVirtually\tevery\tteam\tI’ve\tworked\ton\thas\tused\tdifferent\tnames\tthan\tthe\tones\tthat\tCohn uses\tin\tthe\tpyramid.\tWhatever\tyou\tcall\tthem,\tthe\tkey\ttakeaway\tis\tthat\tyou\twill\twant\ttests of\tdifferent\tscope\tfor\tdifferent\tpurposes.\n\nHow\tMany?\n\nSo\tif\tthese\ttests\tall\thave\ttrade-offs,\thow\tmany\tof\teach\ttype\tdo\tyou\twant?\tA\tgood\trule\tof thumb\tis\tthat\tyou\tprobably\twant\tan\torder\tof\tmagnitude\tmore\ttests\tas\tyou\tdescend\tthe pyramid,\tbut\tthe\timportant\tthing\tis\tknowing\tthat\tyou\tdo\thave\tdifferent\ttypes\tof\tautomated tests\tand\tunderstanding\tif\tyour\tcurrent\tbalance\tgives\tyou\ta\tproblem!\n\nI\tworked\ton\tone\tmonolithic\tsystem,\tfor\texample,\twhere\twe\thad\t4,000\tunit\ttests,\t1,000 service\ttests,\tand\t60\tend-to-end\ttests.\tWe\tdecided\tthat\tfrom\ta\tfeedback\tpoint\tof\tview\twe had\tway\ttoo\tmany\tservice\tand\tend-to-end\ttests\t(the\tlatter\tof\twhich\twere\tthe\tworst offenders\tin\timpacting\tfeedback\tloops),\tso\twe\tworked\thard\tto\treplace\tthe\ttest\tcoverage with\tsmaller-scoped\ttests.\n\nA\tcommon\tanti-pattern\tis\twhat\tis\toften\treferred\tto\tas\ta\ttest\tsnow\tcone,\tor\tinverted pyramid.\tHere,\tthere\tare\tlittle\tto\tno\tsmall-scoped\ttests,\twith\tall\tthe\tcoverage\tin\tlarge- scoped\ttests.\tThese\tprojects\toften\thave\tglacially\tslow\ttest\truns,\tand\tvery\tlong\tfeedback cycles.\tIf\tthese\ttests\tare\trun\tas\tpart\tof\tcontinuous\tintegration,\tyou\twon’t\tget\tmany\tbuilds, and\tthe\tnature\tof\tthe\tbuild\ttimes\tmeans\tthat\tthe\tbuild\tcan\tstay\tbroken\tfor\ta\tlong\tperiod when\tsomething\tdoes\tbreak.\n\nImplementing\tService\tTests\n\nImplementing\tunit\ttests\tis\ta\tfairly\tsimple\taffair\tin\tthe\tgrand\tscheme\tof\tthings,\tand\tthere\tis plenty\tof\tdocumentation\tout\tthere\texplaining\thow\tto\twrite\tthem.\tThe\tservice\tand\tend-to- end\ttests\tare\tthe\tones\tthat\tare\tmore\tinteresting.\n\nOur\tservice\ttests\twant\tto\ttest\ta\tslice\tof\tfunctionality\tacross\tthe\twhole\tservice,\tbut\tto isolate\tourselves\tfrom\tother\tservices\twe\tneed\tto\tfind\tsome\tway\tto\tstub\tout\tall\tof\tour collaborators.\tSo,\tif\twe\twanted\tto\twrite\ta\ttest\tlike\tthis\tfor\tthe\tcustomer\tservice\tfrom Figure\t7-3,\twe\twould\tdeploy\tan\tinstance\tof\tthe\tcustomer\tservice,\tand\tas\tdiscussed\tearlier we\twould\twant\tto\tstub\tout\tany\tdownstream\tservices.\n\nOne\tof\tthe\tfirst\tthings\tour\tcontinuous\tintegration\tbuild\twill\tdo\tis\tcreate\ta\tbinary\tartifact for\tour\tservice,\tso\tdeploying\tthat\tis\tpretty\tstraightforward.\tBut\thow\tdo\twe\thandle\tfaking the\tdownstream\tcollaborators?\n\nOur\tservice\ttest\tsuite\tneeds\tto\tlaunch\tstub\tservices\tfor\tany\tdownstream\tcollaborators\t(or ensure\tthey\tare\trunning),\tand\tconfigure\tthe\tservice\tunder\ttest\tto\tconnect\tto\tthe\tstub services.\tWe\tthen\tneed\tto\tconfigure\tthe\tstubs\tto\tsend\tresponses\tback\tto\tmimic\tthe\treal- world\tservices.\tFor\texample,\twe\tmight\tconfigure\tthe\tstub\tfor\tthe\tloyalty\tpoints\tbank\tto return\tknown\tpoints\tbalances\tfor\tcertain\tcustomers.\n\nMocking\tor\tStubbing\n\nWhen\tI\ttalk\tabout\tstubbing\tdownstream\tcollaborators,\tI\tmean\tthat\twe\tcreate\ta\tstub\tservice that\tresponds\twith\tcanned\tresponses\tto\tknown\trequests\tfrom\tthe\tservice\tunder\ttest.\tFor example,\tI\tmight\ttell\tmy\tstub\tpoints\tbank\tthat\twhen\tasked\tfor\tthe\tbalance\tof\tcustomer 123,\tit\tshould\treturn\t15,000.\tThe\ttest\tdoesn’t\tcare\tif\tthe\tstub\tis\tcalled\t0,\t1,\tor\t100\ttimes.\tA variation\ton\tthis\tis\tto\tuse\ta\tmock\tinstead\tof\ta\tstub.\n\nWhen\tusing\ta\tmock,\tI\tactually\tgo\tfurther\tand\tmake\tsure\tthe\tcall\twas\tmade.\tIf\tthe\texpected call\tis\tnot\tmade,\tthe\ttest\tfails.\tImplementing\tthis\tapproach\trequires\tmore\tsmarts\tin\tthe fake\tcollaborators\tthat\twe\tcreate,\tand\tif\toverused\tcan\tcause\ttests\tto\tbecome\tbrittle.\tAs noted,\thowever,\ta\tstub\tdoesn’t\tcare\tif\tit\tis\tcalled\t0,\t1,\tor\tmany\ttimes.\n\nSometimes,\tthough,\tmocks\tcan\tbe\tvery\tuseful\tto\tensure\tthat\tthe\texpected\tside\teffects happen.\tFor\texample,\tI\tmight\twant\tto\tcheck\tthat\twhen\tI\tcreate\ta\tcustomer,\ta\tnew\tpoints balance\tis\tset\tup\tfor\tthat\tcustomer.\tThe\tbalance\tbetween\tstubbing\tand\tmocking\tcalls\tis\ta delicate\tone,\tand\tis\tjust\tas\tfraught\tin\tservice\ttests\tas\tin\tunit\ttests.\tIn\tgeneral,\tthough,\tI\tuse stubs\tfar\tmore\tthan\tmocks\tfor\tservice\ttests.\tFor\ta\tmore\tin-depth\tdiscussion\tof\tthis\ttrade- off,\ttake\ta\tlook\tat\tGrowing\tObject-Oriented\tSoftware,\tGuided\tby\tTests,\tby\tSteve\tFreeman and\tNat\tPryce\t(Addison-Wesley).\n\nIn\tgeneral,\tI\trarely\tuse\tmocks\tfor\tthis\tsort\tof\ttesting.\tBut\thaving\ta\ttool\tthat\tcan\tdo\tboth\tis useful.\n\nWhile\tI\tfeel\tthat\tstubs\tand\tmocks\tare\tactually\tfairly\twell\tdifferentiated,\tI\tknow\tthe distinction\tcan\tbe\tconfusing\tto\tsome,\tespecially\twhen\tsome\tpeople\tthrow\tin\tother\tterms like\tfakes,\tspies,\tand\tdummies.\tMartin\tFowler\tcalls\tall\tof\tthese\tthings,\tincluding\tstubs\tand mocks,\ttest\tdoubles.\n\nA\tSmarter\tStub\tService\n\nNormally\tfor\tstub\tservices\tI’ve\trolled\tthem\tmyself.\tI’ve\tused\teverything\tfrom\tApache\tor Nginx\tto\tembedded\tJetty\tcontainers\tor\teven\tcommand-line-launched\tPython\tweb\tservers used\tto\tlaunch\tstub\tservers\tfor\tsuch\ttest\tcases.\tI’ve\tprobably\treproduced\tthe\tsame\twork time\tand\ttime\tagain\tin\tcreating\tthese\tstubs.\tMy\tThoughtWorks\tcolleague\tBrandon\tBryars has\tpotentially\tsaved\tmany\tof\tus\ta\tchunk\tof\twork\twith\this\tstub/mock\tserver\tcalled Mountebank.\n\nYou\tcan\tthink\tof\tMountebank\tas\ta\tsmall\tsoftware\tappliance\tthat\tis\tprogrammable\tvia HTTP.\tThe\tfact\tthat\tit\thappens\tto\tbe\twritten\tin\tNodeJS\tis\tcompletely\topaque\tto\tany calling\tservice.\tWhen\tit\tlaunches,\tyou\tsend\tit\tcommands\ttelling\tit\twhat\tport\tto\tstub\ton, what\tprotocol\tto\thandle\t(currently\tTCP,\tHTTP,\tand\tHTTPS\tare\tsupported,\twith\tmore planned),\tand\twhat\tresponses\tit\tshould\tsend\twhen\trequests\tare\tsent.\tIt\talso\tsupports setting\texpectations\tif\tyou\twant\tto\tuse\tit\tas\ta\tmock.\tYou\tcan\tadd\tor\tremove\tthese\tstub endpoints\tat\twill,\tmaking\tit\tpossible\tfor\ta\tsingle\tMountebank\tinstance\tto\tstub\tmore\tthan one\tdownstream\tdependency.\n\nSo,\tif\twe\twant\tto\trun\tour\tservice\ttests\tfor\tjust\tour\tcustomer\tservice\twe\tcan\tlaunch\tthe customer\tservice,\tand\ta\tMountebank\tinstance\tthat\tacts\tas\tour\tloyalty\tpoints\tbank.\tAnd\tif those\ttests\tpass,\tI\tcan\tdeploy\tthe\tcustomer\tservice\tstraightaway!\tOr\tcan\tI?\tWhat\tabout\tthe services\tthat\tcall\tthe\tcustomer\tservice\t—\tthe\thelpdesk\tand\tthe\tweb\tshop?\tDo\twe\tknow\tif we\thave\tmade\ta\tchange\tthat\tmay\tbreak\tthem?\tOf\tcourse,\twe\thave\tforgotten\tthe\timportant tests\tat\tthe\ttop\tof\tthe\tpyramid:\tthe\tend-to-end\ttests.\n\nThose\tTricky\tEnd-to-End\tTests\n\nIn\ta\tmicroservice\tsystem,\tthe\tcapabilities\twe\texpose\tvia\tour\tuser\tinterfaces\tare\tdelivered by\ta\tnumber\tof\tservices.\tThe\tpoint\tof\tthe\tend-to-end\ttests\tas\toutlined\tin\tMike\tCohn’s pyramid\tis\tto\tdrive\tfunctionality\tthrough\tthese\tuser\tinterfaces\tagainst\teverything underneath\tto\tgive\tus\tan\toverview\tof\ta\tlarge\tamount\tof\tour\tsystem.\n\nSo,\tto\timplement\tan\tend-to-end\ttest\twe\tneed\tto\tdeploy\tmultiple\tservices\ttogether,\tthen\trun a\ttest\tagainst\tall\tof\tthem.\tObviously,\tthis\ttest\thas\tmuch\tmore\tscope,\tresulting\tin\tmore confidence\tthat\tour\tsystem\tworks!\tOn\tthe\tother\thand,\tthese\ttests\tare\tliable\tto\tbe\tslower and\tmake\tit\tharder\tto\tdiagnose\tfailure.\tLet’s\tdig\tinto\tthem\ta\tbit\tmore\tusing\tour\tprevious example\tto\tsee\thow\tthese\ttests\tcan\tfit\tin.\n\nImagine\twe\twant\tto\tpush\tout\ta\tnew\tversion\tof\tthe\tcustomer\tservice.\tWe\twant\tto\tdeploy our\tchanges\tinto\tproduction\tas\tsoon\tas\tpossible,\tbut\tare\tconcerned\tthat\twe\tmay\thave introduced\ta\tchange\tthat\tcould\tbreak\teither\tthe\thelpdesk\tor\tthe\tweb\tshop.\tNo\tproblem\t— let’s\tdeploy\tall\tof\tour\tservices\ttogether,\tand\trun\tsome\ttests\tagainst\tthe\thelpdesk\tand\tweb shop\tto\tsee\tif\twe’ve\tintroduced\ta\tbug.\tNow\ta\tnaive\tapproach\twould\tbe\tto\tjust\tadd\tthese tests\tonto\tthe\tend\tof\tour\tcustomer\tservice\tpipeline,\tas\tin\tFigure\t7-7.\n\nFigure\t7-7.\tAdding\tour\tend-to-end\ttests\tstage:\tthe\tright\tapproach?\n\nSo\tfar,\tso\tgood.\tBut\tthe\tfirst\tquestion\twe\thave\tto\task\tourselves\tis\twhich\tversion\tof\tthe other\tservices\tshould\twe\tuse?\tShould\twe\trun\tour\ttests\tagainst\tthe\tversions\tof\thelpdesk\tand web\tshop\tthat\tare\tin\tproduction?\tIt’s\ta\tsensible\tassumption,\tbut\twhat\tif\tthere\tis\ta\tnew version\tof\teither\tthe\thelpdesk\tor\tweb\tshop\tqueued\tup\tto\tgo\tlive;\twhat\tshould\twe\tdo\tthen?\n\nAnother\tproblem:\tif\twe\thave\ta\tset\tof\tcustomer\tservice\ttests\tthat\tdeploy\tlots\tof\tservices and\trun\ttests\tagainst\tthem,\twhat\tabout\tthe\tend-to-end\ttests\tthat\tthe\tother\tservices\trun?\tIf they\tare\ttesting\tthe\tsame\tthing,\twe\tmay\tfind\tourselves\tcovering\tlots\tof\tthe\tsame\tground, and\tmay\tduplicate\ta\tlot\tof\tthe\teffort\tto\tdeploy\tall\tthose\tservices\tin\tthe\tfirst\tplace.\n\nWe\tcan\tdeal\twith\tboth\tof\tthese\tproblems\telegantly\tby\thaving\tmultiple\tpipelines\tfan\tin\tto\ta single,\tend-to-end\ttest\tstage.\tHere,\twhenever\ta\tnew\tbuild\tof\tone\tof\tour\tservices\tis triggered,\twe\trun\tour\tend-to-end\ttests,\tan\texample\tof\twhich\twe\tcan\tsee\tin\tFigure\t7-8. Some\tCI\ttools\twith\tbetter\tbuild\tpipeline\tsupport\twill\tenable\tfan-in\tmodels\tlike\tthis\tout\tof the\tbox.\n\nFigure\t7-8.\tA\tstandard\tway\tto\thandle\tend-to-end\ttests\tacross\tservices\n\nSo\tany\ttime\tany\tof\tour\tservices\tchanges,\twe\trun\tthe\ttests\tlocal\tto\tthat\tservice.\tIf\tthose tests\tpass,\twe\ttrigger\tour\tintegration\ttests.\tGreat,\teh?\tWell,\tthere\tare\ta\tfew\tproblems.\n\nDownsides\tto\tEnd-to-End\tTesting\n\nThere\tare,\tunfortunately,\tmany\tdisadvantages\tto\tend-to-end\ttesting.\n\nFlaky\tand\tBrittle\tTests\n\nAs\ttest\tscope\tincreases,\tso\ttoo\tdo\tthe\tnumber\tof\tmoving\tparts.\tThese\tmoving\tparts\tcan introduce\ttest\tfailures\tthat\tdo\tnot\tshow\tthat\tthe\tfunctionality\tunder\ttest\tis\tbroken,\tbut\tthat some\tother\tproblem\thas\toccurred.\tAs\tan\texample,\tif\twe\thave\ta\ttest\tto\tverify\tthat\twe\tcan place\tan\torder\tfor\ta\tsingle\tCD,\tbut\twe\tare\trunning\tthat\ttest\tagainst\tfour\tor\tfive\tservices,\tif any\tof\tthem\tis\tdown\twe\tcould\tget\ta\tfailure\tthat\thas\tnothing\tto\tdo\twith\tthe\tnature\tof\tthe test\titself.\tLikewise,\ta\ttemporary\tnetwork\tglitch\tcould\tcause\ta\ttest\tto\tfail\twithout\tsaying anything\tabout\tthe\tfunctionality\tunder\ttest.\n\nThe\tmore\tmoving\tparts,\tthe\tmore\tbrittle\tour\ttests\tmay\tbe,\tand\tthe\tless\tdeterministic\tthey are.\tIf\tyou\thave\ttests\tthat\tsometimes\tfail,\tbut\teveryone\tjust\tre-runs\tthem\tbecause\tthey\tmay pass\tagain\tlater,\tthen\tyou\thave\tflaky\ttests.\tIt\tisn’t\tonly\ttests\tcovering\tlots\tof\tdifferent process\tthat\tare\tthe\tculprit\there.\tTests\tthat\tcover\tfunctionality\tbeing\texercised\ton\tmultiple threads\tare\toften\tproblematic,\twhere\ta\tfailure\tcould\tmean\ta\trace\tcondition,\ta\ttimeout,\tor that\tthe\tfunctionality\tis\tactually\tbroken.\tFlaky\ttests\tare\tthe\tenemy.\tWhen\tthey\tfail,\tthey don’t\ttell\tus\tmuch.\tWe\tre-run\tour\tCI\tbuilds\tin\tthe\thope\tthat\tthey\twill\tpass\tagain\tlater,\tonly to\tsee\tcheck-ins\tpile\tup,\tand\tsuddenly\twe\tfind\tourselves\twith\ta\tload\tof\tbroken functionality.\n\nWhen\twe\tdetect\tflaky\ttests,\tit\tis\tessential\tthat\twe\tdo\tour\tbest\tto\tremove\tthem.\tOtherwise, we\tstart\tto\tlose\tfaith\tin\ta\ttest\tsuite\tthat\t“always\tfails\tlike\tthat.”\tA\ttest\tsuite\twith\tflaky\ttests can\tbecome\ta\tvictim\tof\twhat\tDiane\tVaughan\tcalls\tthe\tnormalization\tof\tdeviance\t—\tthe idea\tthat\tover\ttime\twe\tcan\tbecome\tso\taccustomed\tto\tthings\tbeing\twrong\tthat\twe\tstart\tto accept\tthem\tas\tbeing\tnormal\tand\tnot\ta\tproblem.2\tThis\tvery\thuman\ttendency\tmeans\twe need\tto\tfind\tand\teliminate\tthese\ttests\tas\tsoon\tas\twe\tcan\tbefore\twe\tstart\tto\tassume\tthat failing\ttests\tare\tOK.\n\nIn\t“Eradicating\tNon-Determinism\tin\tTests”,\tMartin\tFowler\tadvocates\tthe\tapproach\tthat\tif you\thave\tflaky\ttests,\tyou\tshould\ttrack\tthem\tdown\tand\tif\tyou\tcan’t\timmediately\tfix\tthem, remove\tthem\tfrom\tthe\tsuite\tso\tyou\tcan\ttreat\tthem.\tSee\tif\tyou\tcan\trewrite\tthem\tto\tavoid testing\tcode\trunning\ton\tmultiple\tthreads.\tSee\tif\tyou\tcan\tmake\tthe\tunderlying\tenvironment more\tstable.\tBetter\tyet,\tsee\tif\tyou\tcan\treplace\tthe\tflaky\ttest\twith\ta\tsmaller-scoped\ttest\tthat is\tless\tlikely\tto\texhibit\tproblems.\tIn\tsome\tcases,\tchanging\tthe\tsoftware\tunder\ttest\tto\tmake it\teasier\tto\ttest\tcan\talso\tbe\tthe\tright\tway\tforward.\n\nWho\tWrites\tThese\tTests?\n\nWith\tthe\ttests\tthat\trun\tas\tpart\tof\tthe\tpipeline\tfor\ta\tspecific\tservice,\tthe\tsensible\tstarting point\tis\tthat\tthe\tteam\tthat\towns\tthat\tservice\tshould\twrite\tthose\ttests\t(we’ll\ttalk\tmore\tabout service\townership\tin\tChapter\t10).\tBut\tif\twe\tconsider\tthat\twe\tmight\thave\tmultiple\tteams involved,\tand\tthe\tend-to-end-tests\tstep\tis\tnow\teffectively\tshared\tbetween\tthe\tteams,\twho writes\tand\tlooks\tafter\tthese\ttests?\n\nI\thave\tseen\ta\tnumber\tof\tanti-patterns\tcaused\there.\tThese\ttests\tbecome\ta\tfree-for-all,\twith all\tteams\tgranted\taccess\tto\tadd\ttests\twithout\tany\tunderstanding\tof\tthe\thealth\tof\tthe\twhole suite.\tThis\tcan\toften\tresult\tin\tan\texplosion\tof\ttest\tcases,\tsometimes\tresulting\tin\tthe\ttest snow\tcone\twe\ttalked\tabout\tearlier.\tI\thave\tseen\tsituations\twhere,\tbecause\tthere\twas\tno\treal obvious\townership\tof\tthese\ttests,\ttheir\tresults\tget\tignored.\tWhen\tthey\tbreak,\teveryone assumes\tit\tis\tsomeone\telse’s\tproblem,\tso\tthey\tdon’t\tcare\twhether\tthe\ttests\tare\tpassing.\n\nSometimes\torganizations\treact\tby\thaving\ta\tdedicated\tteam\twrite\tthese\ttests.\tThis\tcan\tbe disastrous.\tThe\tteam\tdeveloping\tthe\tsoftware\tbecomes\tincreasingly\tdistant\tfrom\tthe\ttests for\tits\tcode.\tCycle\ttimes\tincrease,\tas\tservice\towners\tend\tup\twaiting\tfor\tthe\ttest\tteam\tto write\tend-to-end\ttests\tfor\tthe\tfunctionality\tthey\tjust\twrote.\tBecause\tanother\tteam\twrites these\ttests,\tthe\tteam\tthat\twrote\tthe\tservice\tis\tless\tinvolved\twith,\tand\ttherefore\tless\tlikely to\tknow,\thow\tto\trun\tand\tfix\tthese\ttests.\tAlthough\tit\tis\tunfortunately\tstill\ta\tcommon organizational\tpattern,\tI\tsee\tsignificant\tharm\tdone\twhenever\ta\tteam\tis\tdistanced\tfrom writing\ttests\tfor\tthe\tcode\tit\twrote\tin\tthe\tfirst\tplace.\n\nGetting\tthis\taspect\tright\tis\treally\thard.\tWe\tdon’t\twant\tto\tduplicate\teffort,\tnor\tdo\twe\twant to\tcompletely\tcentralize\tthis\tto\tthe\textent\tthat\tthe\tteams\tbuilding\tservices\tare\ttoo\tfar removed\tfrom\tthings.\tThe\tbest\tbalance\tI\thave\tfound\tis\tto\ttreat\tthe\tend-to-end\ttest\tsuite\tas a\tshared\tcodebase,\tbut\twith\tjoint\townership.\tTeams\tare\tfree\tto\tcheck\tin\tto\tthis\tsuite,\tbut the\townership\tof\tthe\thealth\tof\tthe\tsuite\thas\tto\tbe\tshared\tbetween\tthe\tteams\tdeveloping\tthe services\tthemselves.\tIf\tyou\twant\tto\tmake\textensive\tuse\tof\tend-to-end\ttests\twith\tmultiple teams\tI\tthink\tthis\tapproach\tis\tessential,\tand\tyet\tI\thave\tseen\tit\tdone\tvery\trarely,\tand\tnever without\tissue.\n\nHow\tLong?\n\nThese\tend-to-end\ttests\tcan\ttake\ta\twhile.\tI\thave\tseen\tthem\ttake\tup\tto\ta\tday\tto\trun,\tif\tnot more,\tand\ton\tone\tproject\tI\tworked\ton,\ta\tfull\tregression\tsuite\ttook\tsix\tweeks!\tI\trarely\tsee teams\tactually\tcurate\ttheir\tend-to-end\ttest\tsuites\tto\treduce\toverlap\tin\ttest\tcoverage,\tor spend\tenough\ttime\tin\tmaking\tthem\tfast.\n\nThis\tslowness,\tcombined\twith\tthe\tfact\tthat\tthese\ttests\tcan\toften\tbe\tflaky,\tcan\tbe\ta\tmajor problem.\tA\ttest\tsuite\tthat\ttakes\tall\tday\tand\toften\thas\tbreakages\tthat\thave\tnothing\tto\tdo with\tbroken\tfunctionality\tare\ta\tdisaster.\tEven\tif\tyour\tfunctionality\tis\tbroken,\tit\tcould\ttake you\tmany\thours\tto\tfind\tout\t—\tat\twhich\tpoint\tmany\tof\tus\twould\talready\thave\tmoved\ton\tto other\tactivities,\tand\tthe\tcontext\tswitch\tin\tshifting\tour\tbrains\tback\tto\tfix\tthe\tissue\tis painful.\n\nWe\tcan\tameliorate\tsome\tof\tthis\tby\trunning\ttests\tin\tparallel\t—\tfor\texample,\tmaking\tuse\tof tools\tlike\tSelenium\tGrid.\tHowever,\tthis\tapproach\tis\tnot\ta\tsubstitute\tfor\tactually understanding\twhat\tneeds\tto\tbe\ttested\tand\tactively\tremoving\ttests\tthat\tare\tno\tlonger needed.\n\nRemoving\ttests\tis\tsometimes\ta\tfraught\texercise,\tand\tI\tsuspect\tshares\tmuch\tin\tcommon with\tpeople\twho\twant\tto\tremove\tcertain\tairport\tsecurity\tmeasures.\tNo\tmatter\thow ineffective\tthe\tsecurity\tmeasures\tmight\tbe,\tany\tconversation\tabout\tremoving\tthem\tis\toften countered\twith\tknee-jerk\treactions\tabout\tnot\tcaring\tabout\tpeople’s\tsafety\tor\twanting terrorists\tto\twin.\tIt\tis\thard\tto\thave\ta\tbalanced\tconversation\tabout\tthe\tvalue\tsomething\tadds versus\tthe\tburden\tit\tentails.\tIt\tcan\talso\tbe\ta\tdifficult\trisk/reward\ttrade-off.\tDo\tyou\tget thanked\tif\tyou\tremove\ta\ttest?\tMaybe.\tBut\tyou’ll\tcertainly\tget\tblamed\tif\ta\ttest\tyou removed\tlets\ta\tbug\tthrough.\tWhen\tit\tcomes\tto\tthe\tlarger-scoped\ttest\tsuites,\thowever,\tthis is\texactly\twhat\twe\tneed\tto\tbe\table\tto\tdo.\tIf\tthe\tsame\tfeature\tis\tcovered\tin\t20\tdifferent tests,\tperhaps\twe\tcan\tget\trid\tof\thalf\tof\tthem,\tas\tthose\t20\ttests\ttake\t10\tminutes\tto\trun! What\tthis\trequires\tis\ta\tbetter\tunderstanding\tof\trisk,\twhich\tsomething\thumans\tare famously\tbad\tat.\tAs\ta\tresult,\tthis\tintelligent\tcuration\tand\tmanagement\tof\tlarger-scoped, high-burden\ttests\thappens\tincredibly\tinfrequently.\tWishing\tpeople\tdid\tthis\tmore\tisn’t\tthe same\tthing\tas\tmaking\tit\thappen.\n\nThe\tGreat\tPile-up\n\nThe\tlong\tfeedback\tcycles\tassociated\twith\tend-to-end\ttests\taren’t\tjust\ta\tproblem\twhen\tit comes\tto\tdeveloper\tproductivity.\tWith\ta\tlong\ttest\tsuite,\tany\tbreaks\ttake\ta\twhile\tto\tfix, which\treduces\tthe\tamount\tof\ttime\tthat\tthe\tend-to-end\ttests\tcan\tbe\texpected\tto\tbe\tpassing. If\twe\tdeploy\tonly\tsoftware\tthat\thas\tpassed\tthrough\tall\tour\ttests\tsuccessfully\t(which\twe should!),\tthis\tmeans\tfewer\tof\tour\tservices\tget\tthrough\tto\tthe\tpoint\tof\tbeing\tdeployable into\tproduction.\n\nThis\tcan\tlead\tto\ta\tpile-up.\tWhile\ta\tbroken\tintegration\ttest\tstage\tis\tbeing\tfixed,\tmore changes\tfrom\tupstream\tteams\tcan\tpile\tin.\tAside\tfrom\tthe\tfact\tthat\tthis\tcan\tmake\tfixing\tthe build\tharder,\tit\tmeans\tthe\tscope\tof\tchanges\tto\tbe\tdeployed\tincreases.\tOne\tway\tto\tresolve this\tis\tto\tnot\tlet\tpeople\tcheck\tin\tif\tthe\tend-to-end\ttests\tare\tfailing,\tbut\tgiven\ta\tlong\ttest suite\ttime\tthis\tis\toften\timpractical.\tTry\tsaying,\t“You\t30\tdevelopers:\tno\tcheck-ins\ttil\twe\tfix this\tseven-hour-long\tbuild!”\n\nThe\tlarger\tthe\tscope\tof\ta\tdeployment\tand\tthe\thigher\tthe\trisk\tof\ta\trelease,\tthe\tmore\tlikely we\tare\tto\tbreak\tsomething.\tA\tkey\tdriver\tto\tensuring\twe\tcan\trelease\tour\tsoftware frequently\tis\tbased\ton\tthe\tidea\tthat\twe\trelease\tsmall\tchanges\tas\tsoon\tas\tthey\tare\tready.\n\nThe\tMetaversion\n\nWith\tthe\tend-to-end\ttest\tstep,\tit\tis\teasy\tto\tstart\tthinking,\tSo,\tI\tknow\tall\tthese\tservices\tat these\tversions\twork\ttogether,\tso\twhy\tnot\tdeploy\tthem\tall\ttogether?\tThis\tvery\tquickly becomes\ta\tconversation\talong\tthe\tlines\tof,\tSo\twhy\tnot\tuse\ta\tversion\tnumber\tfor\tthe\twhole system?\tTo\tquote\tBrandon\tBryars,\t“Now\tyou\thave\t2.1.0\tproblems.”\n\nBy\tversioning\ttogether\tchanges\tmade\tto\tmultiple\tservices,\twe\teffectively\tembrace\tthe\tidea that\tchanging\tand\tdeploying\tmultiple\tservices\tat\tonce\tis\tacceptable.\tIt\tbecomes\tthe\tnorm, it\tbecomes\tOK.\tIn\tdoing\tso,\twe\tcede\tone\tof\tthe\tmain\tadvantages\tof\tmicroservices:\tthe ability\tto\tdeploy\tone\tservice\tby\titself,\tindependently\tof\tother\tservices.\n\nAll\ttoo\toften,\tthe\tapproach\tof\taccepting\tmultiple\tservices\tbeing\tdeployed\ttogether\tdrifts into\ta\tsituation\twhere\tservices\tbecome\tcoupled.\tBefore\tlong,\tnicely\tseparate\tservices become\tincreasingly\ttangled\twith\tothers,\tand\tyou\tnever\tnotice\tas\tyou\tnever\ttry\tto\tdeploy them\tby\tthemselves.\tYou\tend\tup\twith\ta\ttangled\tmess\twhere\tyou\thave\tto\torchestrate\tthe deployment\tof\tmultiple\tservices\tat\tonce,\tand\tas\twe\tdiscussed\tpreviously,\tthis\tsort\tof coupling\tcan\tleave\tus\tin\ta\tworse\tplace\tthan\twe\twould\tbe\twith\ta\tsingle,\tmonolithic application.\n\nThis\tis\tbad.\n\nTest\tJourneys,\tNot\tStories\n\nDespite\tthe\tdisadvantages\tjust\toutlined,\tfor\tmany\tusers\tend-to-end\ttests\tcan\tstill\tbe manageable\twith\tone\tor\ttwo\tservices,\tand\tin\tthese\tsituations\tstill\tmake\ta\tlot\tof\tsense.\tBut what\thappens\twith\t3,\t4,\t10,\tor\t20\tservices?\tVery\tquickly\tthese\ttest\tsuites\tbecome\thugely bloated,\tand\tin\tthe\tworst\tcase\tcan\tresult\tin\tCartesian-like\texplosion\tin\tthe\tscenarios\tunder test.\n\nThis\tsituation\tworsens\tif\twe\tfall\tinto\tthe\ttrap\tof\tadding\ta\tnew\tend-to-end\ttest\tfor\tevery piece\tof\tfunctionality\twe\tadd.\tShow\tme\ta\tcodebase\twhere\tevery\tnew\tstory\tresults\tin\ta\tnew end-to-end\ttest,\tand\tI’ll\tshow\tyou\ta\tbloated\ttest\tsuite\tthat\thas\tpoor\tfeedback\tcycles\tand huge\toverlaps\tin\ttest\tcoverage.\n\nThe\tbest\tway\tto\tcounter\tthis\tis\tto\tfocus\ton\ta\tsmall\tnumber\tof\tcore\tjourneys\tto\ttest\tfor\tthe whole\tsystem.\tAny\tfunctionality\tnot\tcovered\tin\tthese\tcore\tjourneys\tneeds\tto\tbe\tcovered\tin tests\tthat\tanalyze\tservices\tin\tisolation\tfrom\teach\tother.\tThese\tjourneys\tneed\tto\tbe\tmutually agreed\tupon,\tand\tjointly\towned.\tFor\tour\tmusic\tshop,\twe\tmight\tfocus\ton\tactions\tlike ordering\ta\tCD,\treturning\ta\tproduct,\tor\tperhaps\tcreating\ta\tnew\tcustomer\t—\thigh-value interactions\tand\tvery\tfew\tin\tnumber.\n\nBy\tfocusing\ton\ta\tsmall\tnumber\t(and\tI\tmean\tsmall:\tvery\tlow\tdouble\tdigits\teven\tfor complex\tsystems)\tof\ttests\twe\tcan\treduce\tthe\tdownsides\tof\tintegration\ttests,\tbut\twe\tcannot avoid\tall\tof\tthem.\tIs\tthere\ta\tbetter\tway?\n\nConsumer-Driven\tTests\tto\tthe\tRescue\n\nWhat\tis\tone\tof\tthe\tkey\tproblems\twe\tare\ttrying\tto\taddress\twhen\twe\tuse\tthe\tintegration\ttests outlined\tpreviously?\tWe\tare\ttrying\tto\tensure\tthat\twhen\twe\tdeploy\ta\tnew\tservice\tto production,\tour\tchanges\twon’t\tbreak\tconsumers.\tOne\tway\twe\tcan\tdo\tthis\twithout requiring\ttesting\tagainst\tthe\treal\tconsumer\tis\tby\tusing\ta\tconsumer-driven\tcontract\t(CDC).\n\nWith\tCDCs,\twe\tare\tdefining\tthe\texpectations\tof\ta\tconsumer\ton\ta\tservice\t(or\tproducer). The\texpectations\tof\tthe\tconsumers\tare\tcaptured\tin\tcode\tform\tas\ttests,\twhich\tare\tthen\trun against\tthe\tproducer.\tIf\tdone\tright,\tthese\tCDCs\tshould\tbe\trun\tas\tpart\tof\tthe\tCI\tbuild\tof\tthe producer,\tensuring\tthat\tit\tnever\tgets\tdeployed\tif\tit\tbreaks\tone\tof\tthese\tcontracts.\tVery importantly\tfrom\ta\ttest\tfeedback\tpoint\tof\tview,\tthese\ttests\tneed\tto\tbe\trun\tonly\tagainst\ta single\tproducer\tin\tisolation,\tso\tcan\tbe\tfaster\tand\tmore\treliable\tthan\tthe\tend-to-end\ttests they\tmight\treplace.\n\nAs\tan\texample,\tlet’s\trevisit\tour\tcustomer\tservice\tscenario.\tThe\tcustomer\tservice\thas\ttwo separate\tconsumers:\tthe\thelpdesk\tand\tweb\tshop.\tBoth\tthese\tconsuming\tservices\thave expectations\tfor\thow\tthe\tcustomer\tservice\twill\tbehave.\tIn\tthis\texample,\tyou\tcreate\ttwo sets\tof\ttests:\tone\tfor\teach\tconsumer\trepresenting\tthe\thelpdesk’s\tand\tweb\tshop’s\tuse\tof\tthe customer\tservice.\tA\tgood\tpractice\there\tis\tto\thave\tsomeone\tfrom\tthe\tproducer\tand consumer\tteams\tcollaborate\ton\tcreating\tthe\ttests,\tso\tperhaps\tpeople\tfrom\tthe\tweb\tshop and\thelpdesk\tteams\tpair\twith\tpeople\tfrom\tthe\tcustomer\tservice\tteam.\n\nBecause\tthese\tCDCs\tare\texpectations\ton\thow\tthe\tcustomer\tservice\tshould\tbehave,\tthey can\tbe\trun\tagainst\tthe\tcustomer\tservice\tby\titself\twith\tany\tof\tits\tdownstream\tdependencies stubbed\tout,\tas\tFigure\t7-9\tshows.\tFrom\ta\tscope\tpoint\tof\tview,\tthey\tsit\tat\tthe\tsame\tlevel\tin the\ttest\tpyramid\tas\tservice\ttests,\talbeit\twith\ta\tvery\tdifferent\tfocus,\tas\tshown\tin\tFigure\t7- 10.\tThese\ttests\tare\tfocused\ton\thow\ta\tconsumer\twill\tuse\tthe\tservice,\tand\tthe\ttrigger\tif\tthey break\tis\tvery\tdifferent\twhen\tcompared\twith\tservice\ttests.\tIf\tone\tof\tthese\tCDCs\tbreaks during\ta\tbuild\tof\tthe\tcustomer\tservice,\tit\tbecomes\tobvious\twhich\tconsumer\twould\tbe impacted.\tAt\tthis\tpoint,\tyou\tcan\teither\tfix\tthe\tproblem\tor\telse\tstart\tthe\tdiscussion\tabout introducing\ta\tbreaking\tchange\tin\tthe\tmanner\twe\tdiscussed\tin\tChapter\t4.\tSo\twith\tCDCs, we\tcan\tidentify\ta\tbreaking\tchange\tprior\tto\tour\tsoftware\tgoing\tinto\tproduction\twithout having\tto\tuse\ta\tpotentially\texpensive\tend-to-end\ttest.\n\nFigure\t7-9.\tConsumer-driven\ttesting\tin\tthe\tcontext\tof\tour\tcustomer\tservice\texample\n\nFigure\t7-10.\tIntegrating\tconsumer-driven\ttests\tinto\tthe\ttest\tpyramid\n\nPact\n\nPact\tis\ta\tconsumer-driven\ttesting\ttool\tthat\twas\toriginally\tdeveloped\tin-house\tat RealEstate.com.au,\tbut\tis\tnow\topen\tsource,\twith\tBeth\tSkurrie\tdriving\tmost\tof\tthe development.\tOriginally\tjust\tfor\tRuby,\tPact\tnow\tincludes\tJVM\tand\t.NET\tports.\n\nPact\tworks\tin\ta\tvery\tinteresting\tway,\tas\tsummarized\tin\tFigure\t7-11.\tThe\tconsumer\tstarts by\tdefining\tthe\texpectations\tof\tthe\tproducer\tusing\ta\tRuby\tDSL.\tThen,\tyou\tlaunch\ta\tlocal mock\tserver,\tand\trun\tthis\texpectation\tagainst\tit\tto\tcreate\tthe\tPact\tspecification\tfile.\tThe Pact\tfile\tis\tjust\ta\tformal\tJSON\tspecification;\tyou\tcould\tobviously\thandcode\tthese,\tbut using\tthe\tlanguage\tAPI\tis\tmuch\teasier.\tThis\talso\tgives\tyou\ta\trunning\tmock\tserver\tthat\tcan be\tused\tfor\tfurther\tisolated\ttests\tof\tthe\tconsumer.\n\nFigure\t7-11.\tAn\toverview\tof\thow\tPact\tdoes\tconsumer-driven\ttesting\n\nOn\tthe\tproducer\tside,\tyou\tthen\tverify\tthat\tthis\tconsumer\tspecification\tis\tmet\tby\tusing\tthe JSON\tPact\tspecification\tto\tdrive\tcalls\tagainst\tyour\tAPI\tand\tverify\tresponses.\tFor\tthis\tto work,\tthe\tproducer\tcodebase\tneeds\taccess\tto\tthe\tPact\tfile.\tAs\twe\tdiscussed\tearlier\tin Chapter\t6,\twe\texpect\tboth\tthe\tconsumer\tand\tproducer\tto\tbe\tin\tdifferent\tbuilds.\tThe\tuse\tof a\tlanguage-agnostic\tJSON\tspecification\tis\tan\tespecially\tnice\ttouch.\tIt\tmeans\tthat\tyou\tcan generate\tthe\tconsumer’s\tspecification\tusing\ta\tRuby\tclient,\tbut\tuse\tit\tto\tverify\ta\tJava producer\tby\tusing\tthe\tJVM\tport\tof\tPact.\n\nAs\tthe\tJSON\tPact\tspecification\tis\tcreated\tby\tthe\tconsumer,\tthis\tneeds\tto\tbecome\tan artifact\tthat\tthe\tproducer\tbuild\thas\taccess\tto.\tYou\tcould\tstore\tthis\tin\tyour\tCI/CD\ttool’s artifact\trepository,\tor\telse\tuse\tthe\tPact\tBroker,\twhich\tallows\tyou\tto\tstore\tmultiple\tversions of\tyour\tPact\tspecifications.\tThis\tcould\tlet\tyou\trun\tyour\tconsumer-driven\tcontract\ttests against\tmultiple\tdifferent\tversions\tof\tthe\tconsumers,\tif\tyou\twanted\tto\ttest\tagainst,\tsay,\tthe version\tof\tthe\tconsumer\tin\tproduction\tand\tthe\tversion\tof\tthe\tconsumer\tthat\twas\tmost recently\tbuilt.\n\nConfusingly,\tthere\tis\ta\tThoughtWorks\topen\tsource\tproject\tcalled\tPacto,\twhich\tis\talso\ta Ruby\ttool\tused\tfor\tconsumer-driven\ttesting.\tIt\thas\tthe\tability\tto\trecord\tinteractions\n\nbetween\tclient\tand\tserver\tto\tgenerate\tthe\texpectations.\tThis\tmakes\twriting\tconsumer- driven\tcontracts\tfor\texisting\tservices\tfairly\teasy.\tWith\tPacto,\tonce\tgenerated\tthese expectations\tare\tmore\tor\tless\tstatic,\twhereas\twith\tPact\tyou\tregenerate\tthe\texpectations\tin the\tconsumer\twith\tevery\tbuild.\tThe\tfact\tthat\tyou\tcan\tdefine\texpectations\tfor\tcapabilities the\tproducer\tmay\tnot\teven\thave\tyet\talso\tbetter\tfits\tinto\ta\tworkflow\twhere\tthe\tproducing service\tis\tstill\tbeing\t(or\thas\tyet\tto\tbe)\tdeveloped.\n\nIt’s\tAbout\tConversations\n\nIn\tagile,\tstories\tare\toften\treferred\tto\tas\ta\tplaceholder\tfor\ta\tconversation.\tCDCs\tare\tjust like\tthat.\tThey\tbecome\tthe\tcodification\tof\ta\tset\tof\tdiscussions\tabout\twhat\ta\tservice\tAPI should\tlook\tlike,\tand\twhen\tthey\tbreak,\tthey\tbecome\ta\ttrigger\tpoint\tto\thave\tconversations about\thow\tthat\tAPI\tshould\tevolve.\n\nIt\tis\timportant\tto\tunderstand\tthat\tCDCs\trequire\tgood\tcommunication\tand\ttrust\tbetween\tthe consumer\tand\tproducing\tservice.\tIf\tboth\tparties\tare\tin\tthe\tsame\tteam\t(or\tthe\tsame person!),\tthen\tthis\tshouldn’t\tbe\thard.\tHowever,\tif\tyou\tare\tconsuming\ta\tservice\tprovided with\ta\tthird\tparty,\tyou\tmay\tnot\thave\tthe\tfrequency\tof\tcommunication,\tor\ttrust,\tto\tmake CDCs\twork.\tIn\tthese\tsituations,\tyou\tmay\thave\tto\tmake\tdo\twith\tlimited\tlarger-scoped integration\ttests\tjust\taround\tthe\tuntrusted\tcomponent.\tAlternatively,\tif\tyou\tare\tcreating\tan API\tfor\tthousands\tof\tpotential\tconsumers,\tsuch\tas\twith\ta\tpublicly\tavailable\tweb\tservice API,\tyou\tmay\thave\tto\tplay\tthe\trole\tof\tthe\tconsumer\tyourself\t(or\tperhaps\twork\twith\ta subset\tof\tyour\tconsumers)\tin\tdefining\tthese\ttests.\tBreaking\thuge\tnumbers\tof\texternal consumers\tis\ta\tpretty\tbad\tidea,\tso\tif\tanything\tthe\timportance\tof\tCDCs\tis\tincreased!\n\nSo\tShould\tYou\tUse\tEnd-to-End\tTests?\n\nAs\toutlined\tin\tdetail\tearlier\tin\tthe\tchapter,\tend-to-end\ttests\thave\ta\tlarge\tnumber\tof disadvantages\tthat\tgrow\tsignificantly\tas\tyou\tadd\tmore\tmoving\tparts\tunder\ttest.\tFrom speaking\tto\tpeople\twho\thave\tbeen\timplementing\tmicroservices\tat\tscale\tfor\ta\twhile\tnow,\tI have\tlearned\tthat\tmost\tof\tthem\tover\ttime\tremove\tthe\tneed\tentirely\tfor\tend-to-end\ttests\tin favor\tof\ttools\tlike\tCDCs\tand\timproved\tmonitoring.\tBut\tthey\tdo\tnot\tnecessarily\tthrow those\ttests\taway.\tThey\tend\tup\tusing\tmany\tof\tthose\tend-to-end\tjourney\ttests\tto\tmonitor\tthe production\tsystem\tusing\ta\ttechnique\tcalled\tsemantic\tmonitoring,\twhich\twe\twill\tdiscuss more\tin\tChapter\t8.\n\nYou\tcan\tview\trunning\tend-to-end\ttests\tprior\tto\tproduction\tdeployment\tas\ttraining\twheels. While\tyou\tare\tlearning\thow\tCDCs\twork,\tand\timproving\tyour\tproduction\tmonitoring\tand deployment\ttechniques,\tthese\tend-to-end\ttests\tmay\tform\ta\tuseful\tsafety\tnet,\twhere\tyou\tare trading\toff\tcycle\ttime\tfor\tdecreased\trisk.\tBut\tas\tyou\timprove\tthose\tother\tareas,\tyou\tcan start\tto\treduce\tyour\treliance\ton\tend-to-end\ttests\tto\tthe\tpoint\twhere\tthey\tare\tno\tlonger needed.\n\nSimilarly,\tyou\tmay\twork\tin\tan\tenvironment\twhere\tthe\tappetite\tto\tlearn\tin\tproduction\tis low,\tand\tpeople\twould\trather\twork\tas\thard\tas\tthey\tcan\tto\teliminate\tany\tdefects\tbefore production,\teven\tif\tthat\tmeans\tsoftware\ttakes\tlonger\tto\tship.\tAs\tlong\tas\tyou\tunderstand that\tyou\tcannot\tbe\tcertain\tthat\tyou\thave\teliminated\tall\tsources\tof\tdefects,\tand\tthat\tyou\twill still\tneed\tto\thave\teffective\tmonitoring\tand\tremediation\tin\tplace\tin\tproduction,\tthis\tmay\tbe a\tsensible\tdecision.\n\nObviously\tyou’ll\thave\ta\tbetter\tunderstanding\tof\tyour\town\torganization’s\trisk\tprofile\tthan me,\tbut\tI\twould\tchallenge\tyou\tto\tthink\tlong\tand\thard\tabout\thow\tmuch\tend-to-end\ttesting you\treally\tneed\tto\tdo.\n\nTesting\tAfter\tProduction\n\nMost\ttesting\tis\tdone\tbefore\tthe\tsystem\tis\tin\tproduction.\tWith\tour\ttests,\twe\tare\tdefining\ta series\tof\tmodels\twith\twhich\twe\thope\tto\tprove\twhether\tour\tsystem\tworks\tand\tbehaves\tas we\twould\tlike,\tboth\tfunctionally\tand\tnonfunctionally.\tBut\tif\tour\tmodels\tare\tnot\tperfect, then\twe\twill\tencounter\tproblems\twhen\tour\tsystems\tare\tused\tin\tanger.\tBugs\tslip\tinto production,\tnew\tfailure\tmodes\tare\tdiscovered,\tand\tour\tusers\tuse\tthe\tsystem\tin\tways\twe could\tnever\texpect.\n\nOne\treaction\tto\tthis\tis\toften\tto\tdefine\tmore\tand\tmore\ttests,\tand\trefine\tour\tmodels,\tto\tcatch more\tissues\tearly\tand\treduce\tthe\tnumber\tof\tproblems\twe\tencounter\twith\tour\trunning production\tsystem.\tHowever,\tat\ta\tcertain\tpoint\twe\thave\tto\taccept\tthat\twe\thit\tdiminishing returns\twith\tthis\tapproach.\tWith\ttesting\tprior\tto\tdeployment,\twe\tcannot\treduce\tthe\tchance of\tfailure\tto\tzero.\n\nSeparating\tDeployment\tfrom\tRelease\n\nOne\tway\tin\twhich\twe\tcan\tcatch\tmore\tproblems\tbefore\tthey\toccur\tis\tto\textend\twhere\twe run\tour\ttests\tbeyond\tthe\ttraditional\tpredeployment\tsteps.\tInstead,\tif\twe\tcan\tdeploy\tour software,\tand\ttest\tit\tin\tsitu\tprior\tto\tdirecting\tproduction\tloads\tagainst\tit,\twe\tcan\tdetect issues\tspecific\tto\ta\tgiven\tenvironment.\tA\tcommon\texample\tof\tthis\tis\tthe\tsmoke\ttest\tsuite, a\tcollection\tof\ttests\tdesigned\tto\tbe\trun\tagainst\tnewly\tdeployed\tsoftware\tto\tconfirm\tthat the\tdeployment\tworked.\tThese\ttests\thelp\tyou\tpick\tup\tany\tlocal\tenvironmental\tissues.\tIf you’re\tusing\ta\tsingle\tcommand-line\tcommand\tto\tdeploy\tany\tgiven\tmicroservice\t(and\tyou should),\tthis\tcommand\tshould\trun\tthe\tsmoke\ttests\tautomatically.\n\nAnother\texample\tof\tthis\tis\twhat\tis\tcalled\tblue/green\tdeployment.\tWith\tblue/green,\twe have\ttwo\tcopies\tof\tour\tsoftware\tdeployed\tat\ta\ttime,\tbut\tonly\tone\tversion\tof\tit\tis\treceiving real\trequests.\n\nLet’s\tconsider\ta\tsimple\texample,\tseen\tin\tFigure\t7-12.\tIn\tproduction,\twe\thave\tv123\tof\tthe customer\tservice\tlive.\tWe\twant\tto\tdeploy\ta\tnew\tversion,\tv456.\tWe\tdeploy\tthis\talongside v123,\tbut\tdo\tnot\tdirect\tany\ttraffic\tto\tit.\tInstead,\twe\tperform\tsome\ttesting\tin\tsitu\tagainst\tthe newly\tdeployed\tversion.\tOnce\tthe\ttests\thave\tworked,\twe\tdirect\tthe\tproduction\tload\tto\tthe new\tv456\tversion\tof\tthe\tcustomer\tservice.\tIt\tis\tcommon\tto\tkeep\tthe\told\tversion\taround\tfor a\tshort\tperiod\tof\ttime,\tallowing\tfor\ta\tfast\tfallback\tif\tyou\tdetect\tany\terrors.\n\nFigure\t7-12.\tUsing\tblue/green\tdeployments\tto\tseparate\tdeployment\tfrom\trelease\n\nImplementing\tblue/green\tdeployment\trequires\ta\tfew\tthings.\tFirst,\tyou\tneed\tto\tbe\table\tto direct\tproduction\ttraffic\tto\tdifferent\thosts\t(or\tcollections\tof\thosts).\tYou\tcould\tdo\tthis\tby changing\tDNS\tentries,\tor\tupdating\tload-balancing\tconfiguration.\tYou\talso\tneed\tto\tbe\table to\tprovision\tenough\thosts\tto\thave\tboth\tversions\tof\tthe\tmicroservice\trunning\tat\tonce.\tIf you’re\tusing\tan\telastic\tcloud\tprovider,\tthis\tcould\tbe\tstraightforward.\tUsing\tblue/green deployments\tallows\tyou\tto\treduce\tthe\trisk\tof\tdeployment,\tas\twell\tas\tgives\tyou\tthe\tchance to\trevert\tshould\tyou\tencounter\ta\tproblem.\tIf\tyou\tget\tgood\tat\tthis,\tthe\tentire\tprocess\tcan\tbe completely\tautomated,\twith\teither\tthe\tfull\troll-out\tor\trevert\thappening\twithout\tany\thuman intervention.\n\nQuite\taside\tfrom\tthe\tbenefit\tof\tallowing\tus\tto\ttest\tour\tservices\tin\tsitu\tprior\tto\tsending them\tproduction\ttraffic,\tby\tkeeping\tthe\told\tversion\trunning\twhile\twe\tperform\tour\trelease\n\nwe\tgreatly\treduce\tthe\tdowntime\tassociated\twith\treleasing\tour\tsoftware.\tDepending\ton what\tmechanism\tis\tused\tto\timplement\tthe\ttraffic\tredirection,\tthe\tswitchover\tbetween versions\tcan\tbe\tcompletely\tinvisible\tto\tthe\tcustomer,\tgiving\tus\tzero-downtime deployments.\n\nThere\tis\tanother\ttechnique\tworth\tdiscussing\tbriefly\there\ttoo,\twhich\tis\tsometimes\tconfused with\tblue/green\tdeployments,\tas\tit\tcan\tuse\tsome\tof\tthe\tsame\ttechnical\timplementations.\tIt is\tknown\tas\tcanary\treleasing.\n\nCanary\tReleasing\n\nWith\tcanary\treleasing,\twe\tare\tverifying\tour\tnewly\tdeployed\tsoftware\tby\tdirecting amounts\tof\tproduction\ttraffic\tagainst\tthe\tsystem\tto\tsee\tif\tit\tperforms\tas\texpected. “Performing\tas\texpected”\tcan\tcover\ta\tnumber\tof\tthings,\tboth\tfunctional\tand nonfunctional.\tFor\texample,\twe\tcould\tcheck\tthat\ta\tnewly\tdeployed\tservice\tis\tresponding to\trequests\twithin\t500ms,\tor\tthat\twe\tsee\tthe\tsame\tproportional\terror\trates\tfrom\tthe\tnew and\tthe\told\tservice.\tBut\tyou\tcould\tgo\tdeeper\tthan\tthat.\tImagine\twe’ve\treleased\ta\tnew version\tof\tthe\trecommendation\tservice.\tWe\tmight\trun\tboth\tof\tthem\tside\tby\tside\tbut\tsee\tif the\trecommendations\tgenerated\tby\tthe\tnew\tversion\tof\tthe\tservice\tresult\tin\tas\tmany expected\tsales,\tmaking\tsure\tthat\twe\thaven’t\treleased\ta\tsuboptimal\talgorithm.\n\nIf\tthe\tnew\trelease\tis\tbad,\tyou\tget\tto\trevert\tquickly.\tIf\tit\tis\tgood,\tyou\tcan\tpush\tincreasing amounts\tof\ttraffic\tthrough\tthe\tnew\tversion.\tCanary\treleasing\tdiffers\tfrom\tblue/green\tin that\tyou\tcan\texpect\tversions\tto\tcoexist\tfor\tlonger,\tand\tyou’ll\toften\tvary\tthe\tamounts\tof traffic.\n\nNetflix\tuses\tthis\tapproach\textensively.\tPrior\tto\trelease,\tnew\tservice\tversions\tare\tdeployed alongside\ta\tbaseline\tcluster\tthat\trepresents\tthe\tsame\tversion\tas\tproduction.\tNetflix\tthen runs\ta\tsubset\tof\tthe\tproduction\tload\tover\ta\tnumber\tof\thours\tagainst\tboth\tthe\tnew\tversion and\tthe\tbaseline,\tscoring\tboth.\tIf\tthe\tcanary\tpasses,\tthe\tcompany\tthen\tproceeds\tto\ta\tfull roll-out\tinto\tproduction.\n\nWhen\tconsidering\tcanary\treleasing,\tyou\tneed\tto\tdecide\tif\tyou\tare\tgoing\tto\tdivert\ta\tportion of\tproduction\trequests\tto\tthe\tcanary\tor\tjust\tcopy\tproduction\tload.\tSome\tteams\tare\table\tto shadow\tproduction\ttraffic\tand\tdirect\tit\tto\ttheir\tcanary.\tIn\tthis\tway,\tthe\texisting\tproduction and\tcanary\tversions\tcan\tsee\texactly\tthe\tsame\trequests,\tbut\tonly\tthe\tresults\tof\tthe production\trequests\tare\tseen\texternally.\tThis\tallows\tyou\tto\tdo\ta\tside-by-side\tcomparison while\teliminating\tthe\tchance\tthat\ta\tfailure\tin\tthe\tcanary\tcan\tbe\tseen\tby\ta\tcustomer\trequest. The\twork\tto\tshadow\tproduction\ttraffic\tcan\tbe\tcomplex,\tthough,\tespecially\tif\tthe events/requests\tbeing\treplayed\taren’t\tidempotent.\n\nCanary\treleasing\tis\ta\tpowerful\ttechnique,\tand\tcan\thelp\tyou\tverify\tnew\tversions\tof\tyour software\twith\treal\ttraffic,\twhile\tgiving\tyou\ttools\tto\tmanage\tthe\trisk\tof\tpushing\tout\ta\tbad release.\tIt\tdoes\trequire\ta\tmore\tcomplex\tsetup,\thowever,\tthan\tblue/green\tdeployment,\tand\ta bit\tmore\tthought.\tYou\tcould\texpect\tto\tcoexist\tdifferent\tversions\tof\tyour\tservices\tfor\tlonger than\twith\tblue/green,\tso\tyou\tmay\tbe\ttying\tup\tmore\thardware\tfor\tlonger\tthan\tbefore.\tYou’ll also\tneed\tmore\tsophisticated\ttraffic\trouting,\tas\tyou\tmay\twant\tto\tramp\tup\tor\tdown\tthe percentages\tof\tthe\ttraffic\tto\tget\tmore\tconfidence\tthat\tyour\trelease\tworks.\tIf\tyou\talready handle\tblue/green\tdeployments,\tyou\tmay\thave\tsome\tof\tthe\tbuilding\tblocks\talready.\n\nMean\tTime\tto\tRepair\tOver\tMean\tTime\tBetween\tFailures?\n\nSo\tby\tlooking\tat\ttechniques\tlike\tblue/green\tdeployment\tor\tcanary\treleasing,\twe\tfind\ta\tway to\ttest\tcloser\tto\t(or\teven\tin)\tproduction,\tand\twe\talso\tbuild\ttools\tto\thelp\tus\tmanage\ta\tfailure if\tit\toccurs.\tUsing\tthese\tapproaches\tis\ta\ttacit\tacknowledgment\tthat\twe\tcannot\tspot\tand catch\tall\tproblems\tbefore\twe\tactually\trelease\tour\tsoftware.\n\nSometimes\texpending\tthe\tsame\teffort\tinto\tgetting\tbetter\tat\tremediation\tof\ta\trelease\tcan\tbe significantly\tmore\tbeneficial\tthan\tadding\tmore\tautomated\tfunctional\ttests.\tIn\tthe\tweb operations\tworld,\tthis\tis\toften\treferred\tto\tas\tthe\ttrade-off\tbetween\toptimizing\tfor\tmean time\tbetween\tfailures\t(MTBF)\tand\tmean\ttime\tto\trepair\t(MTTR).\n\nTechniques\tto\treduce\tthe\ttime\tto\trecovery\tcan\tbe\tas\tsimple\tas\tvery\tfast\trollbacks\tcoupled with\tgood\tmonitoring\t(which\twe’ll\tdiscuss\tin\tChapter\t8),\tlike\tblue/green\tdeployments.\tIf we\tcan\tspot\ta\tproblem\tin\tproduction\tearly,\tand\troll\tback\tearly,\twe\treduce\tthe\timpact\tto\tour customers.\tWe\tcan\talso\tuse\ttechniques\tlike\tblue/green\tdeployment,\twhere\twe\tdeploy\ta new\tversion\tof\tour\tsoftware\tand\ttest\tit\tin\tsitu\tprior\tto\tdirecting\tour\tusers\tto\tthe\tnew version.\n\nFor\tdifferent\torganizations,\tthis\ttrade-off\tbetween\tMTBF\tand\tMTTR\twill\tvary,\tand\tmuch of\tthis\tlies\twith\tunderstanding\tthe\ttrue\timpact\tof\tfailure\tin\ta\tproduction\tenvironment. However,\tmost\torganizations\tthat\tI\tsee\tspending\ttime\tcreating\tfunctional\ttest\tsuites\toften expend\tlittle\tto\tno\teffort\tat\tall\ton\tbetter\tmonitoring\tor\trecovering\tfrom\tfailure.\tSo\twhile they\tmay\treduce\tthe\tnumber\tof\tdefects\tthat\toccur\tin\tthe\tfirst\tplace,\tthey\tcan’t\teliminate\tall of\tthem,\tand\tare\tunprepared\tfor\tdealing\twith\tthem\tif\tthey\tpop\tup\tin\tproduction.\n\nTrade-offs\tother\tthan\tMTBF\tand\tMTTR\texist.\tFor\texample,\tif\tyou\tare\ttrying\tto\twork\tout if\tanyone\twill\tactually\tuse\tyour\tsoftware,\tit\tmay\tmake\tmuch\tmore\tsense\tto\tget\tsomething out\tnow,\tto\tprove\tthe\tidea\tor\tthe\tbusiness\tmodel\tbefore\tbuilding\trobust\tsoftware.\tIn\tan environment\twhere\tthis\tis\tthe\tcase,\ttesting\tmay\tbe\toverkill,\tas\tthe\timpact\tof\tnot\tknowing if\tyour\tidea\tworks\tis\tmuch\thigher\tthan\thaving\ta\tdefect\tin\tproduction.\tIn\tthese\tsituations,\tit can\tbe\tquite\tsensible\tto\tavoid\ttesting\tprior\tto\tproduction\taltogether.\n\nCross-Functional\tTesting\n\nThe\tbulk\tof\tthis\tchapter\thas\tbeen\tfocused\ton\ttesting\tspecific\tpieces\tof\tfunctionality,\tand how\tthis\tdiffers\twhen\tyou\tare\ttesting\ta\tmicroservice-based\tsystem.\tHowever,\tthere\tis another\tcategory\tof\ttesting\tthat\tis\timportant\tto\tdiscuss.\tNonfunctional\trequirements\tis\tan umbrella\tterm\tused\tto\tdescribe\tthose\tcharacteristics\tyour\tsystem\texhibits\tthat\tcannot simply\tbe\timplemented\tlike\ta\tnormal\tfeature.\tThey\tinclude\taspects\tlike\tthe\tacceptable latency\tof\ta\tweb\tpage,\tthe\tnumber\tof\tusers\ta\tsystem\tshould\tsupport,\thow\taccessible\tyour user\tinterface\tshould\tbe\tto\tpeople\twith\tdisabilities,\tor\thow\tsecure\tyour\tcustomer\tdata should\tbe.\n\nThe\tterm\tnonfunctional\tnever\tsat\twell\twith\tme.\tSome\tof\tthe\tthings\tthat\tget\tcovered\tby\tthis term\tseem\tvery\tfunctional\tin\tnature!\tOne\tof\tmy\tcolleagues,\tSarah\tTaraporewalla,\tcoined the\tphrase\tcross-functional\trequirements\t(CFR)\tinstead,\twhich\tI\tgreatly\tprefer.\tIt\tspeaks more\tto\tthe\tfact\tthat\tthese\tsystem\tbehaviors\treally\tonly\temerge\tas\tthe\tresult\tof\tlots\tof cross-cutting\twork.\n\nMany,\tif\tnot\tmost,\tCFRs\tcan\treally\tonly\tbe\tmet\tin\tproduction.\tThat\tsaid,\twe\tcan\tdefine test\tstrategies\tto\thelp\tus\tsee\tif\twe\tare\tat\tleast\tmoving\ttoward\tmeeting\tthese\tgoals.\tThese sorts\tof\ttests\tfall\tinto\tthe\tProperty\tTesting\tquadrant.\tA\tgreat\texample\tof\tthis\tis\tthe performance\ttest,\twhich\twe’ll\tdiscuss\tin\tmore\tdepth\tshortly.\n\nFor\tsome\tCFRs,\tyou\tmay\twant\tto\ttrack\tthem\tat\tan\tindividual\tservice\tlevel.\tFor\texample, you\tmay\tdecide\tthat\tthe\tdurability\tof\tservice\tyou\trequire\tfrom\tyour\tpayment\tservice\tis significantly\thigher,\tbut\tyou\tare\thappy\twith\tmore\tdowntime\tfor\tyour\tmusic recommendation\tservice,\tknowing\tthat\tyour\tcore\tbusiness\tcan\tsurvive\tif\tyou\tare\tunable\tto recommend\tartists\tsimilar\tto\tMetallica\tfor\t10\tminutes\tor\tso.\tThese\ttrade-offs\twill\tend\tup having\ta\tlarge\timpact\ton\thow\tyou\tdesign\tand\tevolve\tyour\tsystem,\tand\tonce\tagain\tthe\tfine- grained\tnature\tof\ta\tmicroservice-based\tsystem\tgives\tyou\tmany\tmore\tchances\tto\tmake these\ttrade-offs.\n\nTests\taround\tCFRs\tshould\tfollow\tthe\tpyramid\ttoo.\tSome\ttests\twill\thave\tto\tbe\tend-to-end, like\tload\ttests,\tbut\tothers\twon’t.\tFor\texample,\tonce\tyou’ve\tfound\ta\tperformance bottleneck\tin\tan\tend-to-end\tload\ttest,\twrite\ta\tsmaller-scoped\ttest\tto\thelp\tyou\tcatch\tthe problem\tin\tthe\tfuture.\tOther\tCFRs\tfit\tfaster\ttests\tquite\teasily.\tI\tremember\tworking\ton\ta project\twhere\twe\thad\tinsisted\ton\tensuring\tour\tHTML\tmarkup\twas\tusing\tproper accessibility\tfeatures\tto\thelp\tpeople\twith\tdisabilities\tuse\tour\twebsite.\tChecking\tthe generated\tmarkup\tto\tmake\tsure\tthat\tthe\tappropriate\tcontrols\twere\tthere\tcould\tbe\tdone very\tquickly\twithout\tthe\tneed\tfor\tany\tnetworking\troundtrips.\n\nAll\ttoo\toften,\tconsiderations\tabout\tCFRs\tcome\tfar\ttoo\tlate.\tI\tstrongly\tsuggest\tlooking\tat your\tCFRs\tas\tearly\tas\tpossible,\tand\treviewing\tthem\tregularly.\n\nPerformance\tTests\n\nPerformance\ttests\tare\tworth\tcalling\tout\texplicitly\tas\ta\tway\tof\tensuring\tthat\tsome\tof\tour cross-functional\trequirements\tcan\tbe\tmet.\tWhen\tdecomposing\tsystems\tinto\tsmaller microservices,\twe\tincrease\tthe\tnumber\tof\tcalls\tthat\twill\tbe\tmade\tacross\tnetwork boundaries.\tWhere\tpreviously\tan\toperation\tmight\thave\tinvolved\tone\tdatabase\tcall,\tit\tmay now\tinvolve\tthree\tor\tfour\tcalls\tacross\tnetwork\tboundaries\tto\tother\tservices,\twith\ta matching\tnumber\tof\tdatabase\tcalls.\tAll\tof\tthis\tcan\tdecrease\tthe\tspeed\tat\twhich\tour systems\toperate.\tTracking\tdown\tsources\tof\tlatency\tis\tespecially\timportant.\tWhen\tyou have\ta\tcall\tchain\tof\tmultiple\tsynchronous\tcalls,\tif\tany\tpart\tof\tthe\tchain\tstarts\tacting slowly,\teverything\tis\taffected,\tpotentially\tleading\tto\ta\tsignificant\timpact.\tThis\tmakes having\tsome\tway\tto\tperformance\ttest\tyour\tapplications\teven\tmore\timportant\tthan\tit\tmight be\twith\ta\tmore\tmonolithic\tsystem.\tOften\tthe\treason\tthis\tsort\tof\ttesting\tgets\tdelayed\tis because\tinitially\tthere\tisn’t\tenough\tof\tthe\tsystem\tthere\tto\ttest.\tI\tunderstand\tthis\tproblem, but\tall\ttoo\toften\tit\tleads\tto\tkicking\tthe\tcan\tdown\tthe\troad,\twith\tperformance\ttesting\toften only\tbeing\tdone\tjust\tbefore\tyou\tgo\tlive\tfor\tthe\tfirst\ttime,\tif\tat\tall!\tDon’t\tfall\tinto\tthis\ttrap.\n\nAs\twith\tfunctional\ttests,\tyou\tmay\twant\ta\tmix.\tYou\tmay\tdecide\tthat\tyou\twant\tperformance tests\tthat\tisolate\tindividual\tservices,\tbut\tstart\twith\ttests\tthat\tcheck\tcore\tjourneys\tin\tyour system.\tYou\tmay\tbe\table\tto\ttake\tend-to-end\tjourney\ttests\tand\tsimply\trun\tthese\tat\tvolume.\n\nTo\tgenerate\tworthwhile\tresults,\tyou’ll\toften\tneed\tto\trun\tgiven\tscenarios\twith\tgradually increasing\tnumbers\tof\tsimulated\tcustomers.\tThis\tallows\tyou\tto\tsee\thow\tlatency\tof\tcalls varies\twith\tincreasing\tload.\tThis\tmeans\tthat\tperformance\ttests\tcan\ttake\ta\twhile\tto\trun.\tIn addition,\tyou’ll\twant\tthe\tsystem\tto\tmatch\tproduction\tas\tclosely\tas\tpossible,\tto\tensure\tthat the\tresults\tyou\tsee\twill\tbe\tindicative\tof\tthe\tperformance\tyou\tcan\texpect\ton\tthe\tproduction systems.\tThis\tcan\tmean\tthat\tyou’ll\tneed\tto\tacquire\ta\tmore\tproduction-like\tvolume\tof\tdata, and\tmay\tneed\tmore\tmachines\tto\tmatch\tthe\tinfrastructure\t—\ttasks\tthat\tcan\tbe\tchallenging. Even\tif\tyou\tstruggle\tto\tmake\tthe\tperformance\tenvironment\ttruly\tproduction-like,\tthe\ttests may\tstill\thave\tvalue\tin\ttracking\tdown\tbottlenecks.\tJust\tbe\taware\tthat\tyou\tmay\tget\tfalse negatives,\tor\teven\tworse,\tfalse\tpositives.\n\nDue\tto\tthe\ttime\tit\ttakes\tto\trun\tperformance\ttests,\tit\tisn’t\talways\tfeasible\tto\trun\tthem\ton every\tcheck-in.\tIt\tis\ta\tcommon\tpractice\tto\trun\ta\tsubset\tevery\tday,\tand\ta\tlarger\tset\tevery week.\tWhatever\tapproach\tyou\tpick,\tmake\tsure\tyou\trun\tthem\tas\tregularly\tas\tyou\tcan.\tThe longer\tyou\tgo\twithout\trunning\tperformance\ttests,\tthe\tharder\tit\tcan\tbe\tto\ttrack\tdown\tthe culprit.\tPerformance\tproblems\tare\tespecially\tdifficult\tto\tresolve,\tso\tif\tyou\tcan\treduce\tthe number\tof\tcommits\tyou\tneed\tto\tlook\tat\tin\torder\tto\tsee\ta\tnewly\tintroduced\tproblem,\tyour life\twill\tbe\tmuch\teasier.\n\nAnd\tmake\tsure\tyou\talso\tlook\tat\tthe\tresults!\tI’ve\tbeen\tvery\tsurprised\tby\tthe\tnumber\tof teams\tI\thave\tencountered\twho\thave\tspent\ta\tlot\tof\twork\timplementing\ttests\tand\trunning them,\tand\tnever\tcheck\tthe\tnumbers.\tOften\tthis\tis\tbecause\tpeople\tdon’t\tknow\twhat\ta\tgood result\tlooks\tlike.\tYou\treally\tneed\tto\thave\ttargets.\tThis\tway,\tyou\tcan\tmake\tthe\tbuild\tgo\tred\n\nor\tgreen\tbased\ton\tthe\tresults,\twith\ta\tred\t(failing)\tbuild\tbeing\ta\tclear\tcall\tto\taction.\n\nPerformance\ttesing\tneeds\tto\tbe\tdone\tin\tconcert\twith\tmonitoring\tthe\treal\tsystem performance\t(which\twe’ll\tdiscuss\tmore\tin\tChapter\t8),\tand\tideally\tshould\tuse\tthe\tsame tools\tin\tyour\tperformance\ttest\tenvironment\tfor\tvisualizing\tsystem\tbehavior\tas\tthose\tyou use\tin\tproduction.\tThis\tcan\tmake\tit\tmuch\teasier\tto\tcompare\tlike\twith\tlike.\n\nSummary\n\nBringing\tthis\tall\ttogether,\twhat\tI\thave\toutlined\there\tis\ta\tholistic\tapproach\tto\ttesting\tthat hopefully\tgives\tyou\tsome\tgeneral\tguidance\ton\thow\tto\tproceed\twhen\ttesting\tyour\town systems.\tTo\treiterate\tthe\tbasics:\n\nOptimize\tfor\tfast\tfeedback,\tand\tseparate\ttypes\tof\ttests\taccordingly.\n\nAvoid\tthe\tneed\tfor\tend-to-end\ttests\twherever\tpossible\tby\tusing\tconsumer-driven contracts.\n\nUse\tconsumer-driven\tcontracts\tto\tprovide\tfocus\tpoints\tfor\tconversations\tbetween teams.\n\nTry\tto\tunderstand\tthe\ttrade-off\tbetween\tputting\tmore\tefforts\tinto\ttesting\tand detecting\tissues\tfaster\tin\tproduction\t(optimizing\tfor\tMTBF\tversus\tMTTR).\n\nIf\tyou\tare\tinterested\tin\treading\tmore\tabout\ttesting,\tI\trecommend\tAgile\tTesting\tby\tLisa Crispin\tand\tJanet\tGregory\t(Addison-Wesley),\twhich\tamong\tother\tthings\tcovers\tthe\tuse\tof the\ttesting\tquadrant\tin\tmore\tdetail.\n\nThis\tchapter\tfocused\tmostly\ton\tmaking\tsure\tour\tcode\tworks\tbefore\tit\thits\tproduction,\tbut we\talso\tneed\tto\tknow\thow\tto\tmake\tsure\tour\tcode\tworks\tonce\tit’s\tdeployed.\tIn\tthe\tnext chapter,\twe’ll\ttake\ta\tlook\tat\thow\tto\tmonitor\tour\tmicroservice-based\tsystems.\n\n2\tDiane\tVaughan,\tThe\tChallenger\tLaunch\tDecision:\tRisky\tTechnology,\tCulture,\tand Deviance\tat\tNASA\t(Chicago:\tUniversity\tof\tChicago\tPress,\t1996).\n\nChapter\t8.\tMonitoring\n\nAs\tI’ve\thopefully\tshown\tso\tfar,\tbreaking\tour\tsystem\tup\tinto\tsmaller,\tfine-grained microservices\tresults\tin\tmultiple\tbenefits.\tIt\talso,\thowever,\tadds\tcomplexity\twhen\tit comes\tto\tmonitoring\tthe\tsystem\tin\tproduction.\tIn\tthis\tchapter,\twe’ll\tlook\tat\tthe\tchallenges associated\twith\tmonitoring\tand\tidentifying\tproblems\tin\tour\tfine-grained\tsystems,\tand\tI’ll outline\tsome\tof\tthe\tthings\tyou\tcan\tdo\tto\thave\tyour\tcake\tand\teat\tit\ttoo!\n\nPicture\tthe\tscene.\tIt’s\ta\tquiet\tFriday\tafternoon,\tand\tthe\tteam\tis\tlooking\tforward\tto\tsloping off\tearly\tto\tthe\tpub\tas\ta\tway\tto\tstart\ta\tweekend\taway\tfrom\twork.\tThen\tsuddenly\tthe emails\tarrive.\tThe\twebsite\tis\tmisbehaving!\tTwitter\tis\tablaze\twith\tyour\tcompany’s\tfailings, your\tboss\tis\tchewing\tyour\tear\toff,\tand\tthe\tprospects\tof\ta\tquiet\tweekend\tvanish.\n\nWhat’s\tthe\tfirst\tthing\tyou\tneed\tto\tknow?\tWhat\tthe\thell\thas\tgone\twrong?\n\nIn\tthe\tworld\tof\tthe\tmonolithic\tapplication,\twe\tat\tleast\thave\ta\tvery\tobvious\tplace\tto\tstart our\tinvestigations.\tWebsite\tslow?\tIt’s\tthe\tmonolith.\tWebsite\tgiving\todd\terrors?\tIt’s\tthe monolith.\tCPU\tat\t100%?\tMonolith.\tSmell\tof\tburning?\tWell,\tyou\tget\tthe\tidea.\tHaving\ta single\tpoint\tof\tfailure\talso\tmakes\tfailure\tinvestigation\tsomewhat\tsimpler!\n\nNow\tlet’s\tthink\tabout\tour\town,\tmicroservice-based\tsystem.\tThe\tcapabilities\twe\toffer\tour users\tare\tserved\tfrom\tmultiple\tsmall\tservices,\tsome\tof\twhich\tcommunicate\twith\tyet\tmore services\tto\taccomplish\ttheir\ttasks.\tThere\tare\tlots\tof\tadvantages\tto\tsuch\tan\tapproach (which\tis\tgood,\tas\totherwise\tthis\tbook\twould\tbe\ta\twaste\tof\ttime),\tbut\tin\tthe\tworld\tof monitoring,\twe\thave\ta\tmore\tcomplex\tproblem\ton\tour\thands.\n\nWe\tnow\thave\tmultiple\tservers\tto\tmonitor,\tmultiple\tlogfiles\tto\tsift\tthrough,\tand\tmultiple places\twhere\tnetwork\tlatency\tcould\tcause\tproblems.\tSo\thow\tdo\twe\tapproach\tthis?\tWe need\tto\tmake\tsense\tof\twhat\totherwise\tmight\tbe\ta\tchaotic,\ttangled\tmess\t—\tthe\tlast\tthing any\tof\tus\twants\tto\tdeal\twith\ton\ta\tFriday\tafternoon\t(or\tat\tany\ttime,\tcome\tto\tthat!).\n\nThe\tanswer\there\tis\tpretty\tstraightforward:\tmonitor\tthe\tsmall\tthings,\tand\tuse\taggregation\tto see\tthe\tbigger\tpicture.\tTo\tsee\thow,\twe’ll\tstart\twith\tthe\tsimplest\tsystem\twe\tcan:\ta\tsingle node.\n\nSingle\tService,\tSingle\tServer\n\nFigure\t8-1\tpresents\ta\tvery\tsimple\tsetup:\tone\thost,\trunning\tone\tservice.\tNow\twe\tneed\tto monitor\tit\tin\torder\tto\tknow\twhen\tsomething\tgoes\twrong,\tso\twe\tcan\tfix\tit.\tSo\twhat\tshould we\tlook\tfor?\n\nFigure\t8-1.\tA\tsingle\tservice\ton\ta\tsingle\thost\n\nFirst,\twe’ll\twant\tto\tmonitor\tthe\thost\titself.\tCPU,\tmemory\t—\tall\tof\tthese\tthings\tare\tuseful. We’ll\twant\tto\tknow\twhat\tthey\tshould\tbe\twhen\tthings\tare\thealthy,\tso\twe\tcan\talert\twhen they\tgo\tout\tof\tbounds.\tIf\twe\twant\tto\trun\tour\town\tmonitoring\tsoftware,\twe\tcould\tuse something\tlike\tNagios\tto\tdo\tso,\tor\telse\tuse\ta\thosted\tservice\tlike\tNew\tRelic.\n\nNext,\twe’ll\twant\tto\thave\taccess\tto\tthe\tlogs\tfrom\tthe\tserver\titself.\tIf\ta\tuser\treports\tan\terror, these\tlogs\tshould\tpick\tit\tup\tand\thopefully\ttell\tus\twhen\tand\twhere\tthe\terror\tis.\tAt\tthis point,\twith\tour\tsingle\thost\twe\tcan\tprobably\tget\tby\twith\tjust\tlogging\ton\tto\tthe\thost\tand using\tcommand-line\ttools\tto\tscan\tthe\tlog.\tWe\tmay\teven\tget\tadvanced\tand\tuse\tlogrotate to\tmove\told\tlogs\tout\tof\tthe\tway\tand\tavoid\tthem\ttaking\tup\tall\tour\tdisk\tspace.\n\nFinally,\twe\tmight\twant\tto\tmonitor\tthe\tapplication\titself.\tAt\ta\tbare\tminimum,\tmonitoring the\tresponse\ttime\tof\tthe\tservice\tis\ta\tgood\tidea.\tYou’ll\tprobably\tbe\table\tto\tdo\tthis\tby looking\tat\tthe\tlogs\tcoming\teither\tfrom\ta\tweb\tserver\tfronting\tyour\tservice,\tor\tperhaps\tfrom the\tservice\titself.\tIf\twe\tget\tvery\tadvanced,\twe\tmight\twant\tto\ttrack\tthe\tnumber\tof\terrors\twe are\treporting.\n\nTime\tpasses,\tloads\tincrease,\tand\twe\tfind\tourselves\tneeding\tto\tscale…",
      "page_number": 231
    },
    {
      "number": 8,
      "title": "Monitoring",
      "start_page": 268,
      "end_page": 285,
      "detection_method": "regex_chapter_title",
      "content": "Single\tService,\tMultiple\tServers\n\nNow\twe\thave\tmultiple\tcopies\tof\tthe\tservice\trunning\ton\tseparate\thosts,\tas\tshown\tin Figure\t8-2,\twith\trequests\tto\tthe\tdifferent\tservice\tinstances\tdistributed\tvia\ta\tload\tbalancer. Things\tstart\tto\tget\ta\tbit\ttrickier\tnow.\tWe\tstill\twant\tto\tmonitor\tall\tthe\tsame\tthings\tas\tbefore, but\tneed\tto\tdo\tso\tin\tsuch\ta\tway\tthat\twe\tcan\tisolate\tthe\tproblem.\tWhen\tthe\tCPU\tis\thigh,\tis it\ta\tproblem\twe\tare\tseeing\ton\tall\thosts,\twhich\twould\tpoint\tto\tan\tissue\twith\tthe\tservice itself,\tor\tis\tit\tisolated\tto\ta\tsingle\thost,\timplying\tthat\tthe\thost\titself\thas\tthe\tproblem\t— perhaps\ta\trogue\tOS\tprocess?\n\nFigure\t8-2.\tA\tsingle\tservice\tdistributed\tacross\tmultiple\thosts\n\nSo\tat\tthis\tpoint,\twe\tstill\twant\tto\ttrack\tthe\thost-level\tmetrics,\tand\talert\ton\tthem.\tBut\tnow we\twant\tto\tsee\twhat\tthey\tare\tacross\tall\thosts,\tas\twell\tas\tindividual\thosts.\tIn\tother\twords, we\twant\tto\taggregate\tthem\tup,\tand\tstill\tbe\table\tto\tdrill\tdown.\tNagios\tlets\tus\tgroup\tour hosts\tlike\tthis\t—\tso\tfar,\tso\tgood.\tA\tsimilar\tapproach\twill\tprobably\tsuffice\tfor\tour application.\n\nThen\twe\thave\tour\tlogs.\tWith\tour\tservice\trunning\ton\tmore\tthan\tone\tserver,\twe’ll\tprobably get\ttired\tof\tlogging\tinto\teach\tbox\tto\tlook\tat\tit.\tWith\tjust\ta\tfew\thosts,\tthough,\twe\tcan\tuse tools\tlike\tssh-multiplexers,\twhich\tallow\tus\tto\trun\tthe\tsame\tcommands\ton\tmultiple\thosts. A\tbig\tmonitor\tand\ta\tgrep\t\"Error\"\tapp.log\tlater,\tand\twe\tcan\tfind\tour\tculprit.\n\nFor\ttasks\tlike\tresponse\ttime\ttracking,\twe\tcan\tget\tsome\tof\tthe\taggregation\tfor\tfree\tby tracking\tat\tthe\tload\tbalancer\titself.\tBut\twe\tneed\tto\ttrack\tthe\tload\tbalancer\tas\twell,\tof course;\tif\tthat\tmisbehaves,\twe\thave\ta\tproblem.\tAt\tthis\tpoint,\twe\talso\tprobably\tcare\ta\tlot more\tabout\twhat\ta\thealthy\tservice\tlooks\tlike,\tas\twe’ll\tconfigure\tour\tload\tbalancer\tto remove\tunhealthy\tnodes\tfrom\tour\tapplication.\tHopefully\tby\tthe\ttime\twe\tget\there\twe\thave at\tleast\tsome\tidea\tof\tthat…\n\nMultiple\tServices,\tMultiple\tServers\n\nIn\tFigure\t8-3,\tthings\tget\tmuch\tmore\tinteresting.\tMultiple\tservices\tare\tcollaborating\tto provide\tcapabilities\tto\tour\tusers,\tand\tthose\tservices\tare\trunning\ton\tmultiple\thosts\t—\tbe they\tphysical\tor\tvirtual.\tHow\tdo\tyou\tfind\tthe\terror\tyou’re\tlooking\tfor\tin\tthousands\tof\tlines of\tlogs\ton\tmultiple\thosts?\tHow\tdo\tyou\tdetermine\tif\tone\tserver\tis\tmisbehaving,\tor\tif\tit\tis\ta systematic\tissue?\tAnd\thow\tdo\tyou\ttrack\tback\tan\terror\tfound\tdeep\tdown\tin\ta\tcall\tchain between\tmultiple\thosts\tand\twork\tout\twhat\tcaused\tit?\n\nFigure\t8-3.\tMultiple\tcollaborating\tservices\tdistributed\tacross\tmultiple\thosts\n\nThe\tanswer\tis\tcollection\tand\tcentral\taggregation\tof\tas\tmuch\tas\twe\tcan\tget\tour\thands\ton, from\tlogs\tto\tapplication\tmetrics.\n\nLogs,\tLogs,\tand\tYet\tMore\tLogs…\n\nNow\tthe\tnumber\tof\thosts\twe\tare\trunning\ton\tis\tbecoming\ta\tchallenge.\tSSH-multiplexing\tto retrieve\tlogs\tprobably\tisn’t\tgoing\tto\tcut\tit\tnow,\tand\tthere\tisn’t\ta\tscreen\tbig\tenough\tfor\tyou to\thave\tterminals\topen\ton\tevery\thost.\tInstead,\twe’re\tlooking\tto\tuse\tspecialized\tsubsystems to\tgrab\tour\tlogs\tand\tmake\tthem\tavailable\tcentrally.\tOne\texample\tof\tthis\tis\tlogstash,\twhich can\tparse\tmultiple\tlogfile\tformats\tand\tcan\tsend\tthem\tto\tdownstream\tsystems\tfor\tfurther investigation.\n\nKibana\tis\tan\tElasticSearch-backed\tsystem\tfor\tviewing\tlogs,\tillustrated\tin\tFigure\t8-4.\tYou can\tuse\ta\tquery\tsyntax\tto\tsearch\tthrough\tlogs,\tallowing\tyou\tto\tdo\tthings\tlike\trestrict\ttime and\tdate\tranges\tor\tuse\tregular\texpressions\tto\tfind\tmatching\tstrings.\tKibana\tcan\teven generate\tgraphs\tfrom\tthe\tlogs\tyou\tsend\tit,\tallowing\tyou\tto\tsee\tat\ta\tglance\thow\tmany errors\thave\tbeen\tgenerated\tover\ttime,\tfor\texample.\n\nFigure\t8-4.\tUsing\tKibana\tto\tview\taggregated\tlogs\n\nMetric\tTracking\tAcross\tMultiple\tServices\n\nAs\twith\tthe\tchallenge\tof\tlooking\tat\tlogs\tfor\tdifferent\thosts,\twe\tneed\tto\tlook\tat\tbetter\tways to\tgather\tand\tview\tour\tmetrics.\tIt\tcan\tbe\thard\tto\tknow\twhat\tgood\tlooks\tlike\twhen\twe’re looking\tat\tmetrics\tfor\ta\tmore\tcomplex\tsystem.\tOur\twebsite\tis\tseeing\tnearly\t50\t4XX\tHTTP error\tcodes\tper\tsecond.\tIs\tthat\tbad?\tThe\tCPU\tload\ton\tthe\tcatalog\tservice\thas\tincreased\tby 20%\tsince\tlunch;\thas\tsomething\tgone\twrong?\tThe\tsecret\tto\tknowing\twhen\tto\tpanic\tand when\tto\trelax\tis\tto\tgather\tmetrics\tabout\thow\tyour\tsystem\tbehaves\tover\ta\tlong-enough period\tof\ttime\tthat\tclear\tpatterns\temerge.\n\nIn\ta\tmore\tcomplex\tenvironment,\twe’ll\tbe\tprovisioning\tnew\tinstances\tof\tour\tservices pretty\tfrequently,\tso\twe\twant\tthe\tsystem\twe\tpick\tto\tmake\tit\tvery\teasy\tto\tcollect\tmetrics from\tnew\thosts.\tWe’ll\twant\tto\tbe\table\tto\tlook\tat\ta\tmetric\taggregated\tfor\tthe\twhole\tsystem —\tfor\texample,\tthe\tavergage\tCPU\tload\t—\tbut\twe’ll\talso\twant\tto\taggregate\tthat\tmetric\tfor all\tthe\tinstances\tof\ta\tgiven\tservice,\tor\teven\tfor\ta\tsingle\tinstance\tof\tthat\tservice.\tThat means\twe’ll\tneed\tto\tbe\table\tto\tassociate\tmetadata\twith\tthe\tmetric\tto\tallow\tus\tto\tinfer\tthis structure.\n\nGraphite\tis\tone\tsuch\tsystem\tthat\tmakes\tthis\tvery\teasy.\tIt\texposes\ta\tvery\tsimple\tAPI\tand allows\tyou\tto\tsend\tmetrics\tin\treal\ttime.\tIt\tthen\tallows\tyou\tto\tquery\tthose\tmetrics\tto produce\tcharts\tand\tother\tdisplays\tto\tsee\twhat\tis\thappening.\tThe\tway\tit\thandles\tvolume\tis also\tinteresting.\tEffectively,\tyou\tconfigure\tit\tso\tthat\tyou\treduce\tthe\tresolution\tof\tolder metrics\tto\tensure\tthe\tvolumes\tdon’t\tget\ttoo\tlarge.\tSo,\tfor\texample,\tI\tmight\trecord\tthe\tCPU for\tmy\thosts\tonce\tevery\t10\tseconds\tfor\tthe\tlast\t10\tminutes,\tthen\tan\taggregated\tsample every\tminute\tfor\tthe\tlast\tday,\tdown\tto\tperhaps\tone\tsample\tevery\t30\tminutes\tfor\tthe\tlast several\tyears.\tIn\tthis\tway,\tyou\tcan\tstore\tinformation\tabout\thow\tyour\tsystem\thas\tbehaved over\ta\tlong\tperiod\tof\ttime\twithout\tneeding\thuge\tamounts\tof\tstorage.\n\nGraphite\talso\tenables\tyou\tto\taggregate\tacross\tsamples,\tor\tdrill\tdown\tto\ta\tsingle\tseries,\tso you\tcan\tsee\tthe\tresponse\ttime\tfor\tyour\twhole\tsystem,\ta\tgroup\tof\tservices,\tor\ta\tsingle instance.\tIf\tGraphite\tdoesn’t\twork\tfor\tyou\tfor\twhatever\treason,\tmake\tsure\tyou\tget\tsimilar capabilities\tin\tany\tother\ttool\tyou\tselect.\tAnd\tcertainly\tmake\tsure\tyou\tcan\tget\taccess\tto\tthe raw\tdata\tto\tprovide\tyour\town\treporting\tor\tdashboards\tif\tyou\tneed\tto.\n\nAnother\tkey\tbenefit\tof\tunderstanding\tyour\ttrends\tis\twhen\tit\tcomes\tto\tcapacity\tplanning. Are\twe\treaching\tour\tlimit?\tHow\tlong\tuntil\twe\tneed\tmore\thosts?\tIn\tthe\tpast\twhen\twe brought\tphysical\thosts,\tthis\twas\toften\tan\tannual\tjob.\tIn\tthe\tnew\tage\tof\ton-demand computing\tprovided\tby\tinfrastructure\tas\ta\tservice\t(IaaS)\tvendors,\twe\tcan\tnow\tscale\tup\tor down\tin\tminutes,\tif\tnot\tseconds.\tThis\tmeans\tthat\tif\twe\tunderstand\tour\tusage\tpatterns,\twe can\tmake\tsure\twe\thave\tjust\tenough\tinfrastructure\tto\tserve\tour\tneeds.\tThe\tsmarter\twe\tare in\ttracking\tour\ttrends\tand\tknowing\twhat\tto\tdo\twith\tthem,\tthe\tmore\tcost\teffective\tand responsive\tour\tsystems\tcan\tbe.\n\nService\tMetrics\n\nThe\toperating\tsystems\twe\trun\ton\tgenerate\ta\tlarge\tnumber\tof\tmetrics\tfor\tus,\tas\tyou’ll\tfind the\tmoment\tyou\tinstall\tcollectd\ton\ta\tLinux\tbox\tand\tpoint\tit\tat\tGraphite.\tLikewise, supporting\tsubsystems\tlike\tNginx\tor\tVarnish\texposes\tuseful\tinformation\tlike\tresponse times\tor\tcache\thit\trates.\tBut\twhat\tabout\tyour\town\tservice?\n\nI\twould\tstrongly\tsuggest\thaving\tyour\tservices\texpose\tbasic\tmetrics\tthemselves.\tAt\ta\tbare minimum,\tfor\ta\tweb\tservice\tyou\tshould\tprobably\texpose\tmetrics\tlike\tresponse\ttimes\tand error\trates\t—\tvital\tif\tyour\tserver\tisn’t\tfronted\tby\ta\tweb\tserver\tthat\tis\tdoing\tthis\tfor\tyou. But\tyou\tshould\treally\tgo\tfurther.\tFor\texample,\tour\taccounts\tservice\tmay\twant\tto\texpose the\tnumber\tof\ttimes\tcustomers\tview\ttheir\tpast\torders,\tor\tyour\tweb\tshop\tmight\twant\tto capture\thow\tmuch\tmoney\thas\tbeen\tmade\tduring\tthe\tlast\tday.\n\nWhy\tdo\twe\tcare\tabout\tthis?\tWell,\tfor\ta\tnumber\tof\treasons.\tFirst,\tthere\tis\tan\told\tadage\tthat 80%\tof\tsoftware\tfeatures\tare\tnever\tused.\tNow\tI\tcan’t\tcomment\ton\thow\taccurate\tthat figure\tis,\tbut\tas\tsomeone\twho\thas\tbeen\tdeveloping\tsoftware\tfor\tnearly\t20\tyears,\tI\tknow that\tI\thave\tspent\ta\tlot\tof\ttime\ton\tfeatures\tthat\tnever\tactually\tget\tused.\tWouldn’t\tit\tbe\tnice to\tknow\twhat\tthey\tare?\n\nSecond,\twe\tare\tgetting\tbetter\tthan\tever\tat\treacting\tto\thow\tour\tusers\tare\tusing\tour\tsystem to\twork\tout\thow\tto\timprove\tit.\tMetrics\tthat\tinform\tus\tof\thow\tour\tsystems\tbehave\tcan\tonly help\tus\there.\tWe\tpush\tout\ta\tnew\tversion\tof\tthe\twebsite,\tand\tfind\tthat\tthe\tnumber\tof searches\tby\tgenre\thas\tgone\tup\tsignificantly\ton\tthe\tcatalog\tservice.\tIs\tthat\ta\tproblem,\tor expected?\n\nFinally,\twe\tcan\tnever\tknow\twhat\tdata\twill\tbe\tuseful!\tMore\ttimes\tthan\tI\tcan\tcount\tI’ve wanted\tto\tcapture\tdata\tto\thelp\tme\tunderstand\tsomething\tonly\tafter\tthe\tchance\tto\tdo\tso\thas long\tpassed.\tI\ttend\tto\terr\ttoward\texposing\teverything\tand\trelying\ton\tmy\tmetrics\tsystem\tto handle\tthis\tlater.\n\nLibraries\texist\tfor\ta\tnumber\tof\tdifferent\tplatforms\tthat\tallow\tour\tservices\tto\tsend\tmetrics to\tstandard\tsystems.\tCodahale’s\tMetrics\tlibrary\tis\tone\tsuch\texample\tlibrary\tfor\tthe\tJVM. It\tallows\tyou\tto\tstore\tmetrics\tas\tcounters,\ttimers,\tor\tgauges;\tsupports\ttime-boxing\tmetrics (so\tyou\tcan\tspecify\tmetrics\tlike\t“number\tof\torders\tin\tthe\tlast\tfive\tminutes”);\tand\talso comes\tout\tof\tthe\tbox\twith\tsupport\tfor\tsending\tdata\tto\tGraphite\tand\tother\taggregating\tand reporting\tsystems.\n\nSynthetic\tMonitoring\n\nWe\tcan\ttry\tto\twork\tout\tif\ta\tservice\tis\thealthy\tby,\tfor\texample,\tdeciding\twhat\ta\tgood\tCPU level\tis,\tor\twhat\tmakes\tfor\tan\tacceptable\tresponse\ttime.\tIf\tour\tmonitoring\tsystem\tdetects that\tthe\tactual\tvalues\tfall\toutside\tthis\tsafe\tlevel,\twe\tcan\ttrigger\tan\talert\t—\tsomething\tthat a\ttool\tlike\tNagios\tis\tmore\tthan\tcapable\tof.\n\nHowever,\tin\tmany\tways,\tthese\tvalues\tare\tone\tstep\tremoved\tfrom\twhat\twe\tactually\twant\tto track\t—\tnamely,\tis\tthe\tsystem\tworking?\tThe\tmore\tcomplex\tthe\tinteractions\tbetween\tthe services,\tthe\tfurther\tremoved\twe\tare\tfrom\tactually\tanswering\tthat\tquestion.\tSo\twhat\tif\tour monitoring\tsystems\twere\tprogrammed\tto\tact\ta\tbit\tlike\tour\tusers,\tand\tcould\treport\tback\tif something\tgoes\twrong?\n\nI\tfirst\tdid\tthis\tback\tin\t2005.\tI\twas\tpart\tof\ta\tsmall\tThoughtWorks\tteam\tthat\twas\tbuilding\ta system\tfor\tan\tinvestment\tbank.\tThroughout\tthe\ttrading\tday,\tlots\tof\tevents\tcame\tin representing\tchanges\tin\tthe\tmarket.\tOur\tjob\twas\tto\treact\tto\tthese\tchanges,\tand\tlook\tat\tthe impact\ton\tthe\tbank’s\tportfolio.\tWe\twere\tworking\tunder\tsome\tfairly\ttight\tdeadlines,\tas\tthe goal\twas\tto\thave\tdone\tall\tour\tcalculations\tin\tless\tthan\t10\tseconds\tafter\tthe\tevent\tarrived. The\tsystem\titself\tconsisted\tof\taround\tfive\tdiscrete\tservices,\tat\tleast\tone\tof\twhich\twas running\ton\ta\tcomputing\tgrid\tthat,\tamong\tother\tthings,\twas\tscavenging\tunused\tCPU\tcycles on\taround\t250\tdesktop\thosts\tin\tthe\tbank’s\tdisaster\trecovery\tcenter.\n\nThe\tnumber\tof\tmoving\tparts\tin\tthe\tsystem\tmeant\ta\tlot\tof\tnoise\twas\tbeing\tgenerated\tfrom many\tof\tthe\tlower-level\tmetrics\twe\twere\tgathering.\tWe\tdidn’t\thave\tthe\tbenefit\tof\tscaling gradually\tor\thaving\tthe\tsystem\trun\tfor\ta\tfew\tmonths\tto\tunderstand\twhat\tgood\tlooked\tlike for\tmetrics\tlike\tour\tCPU\trate\tor\teven\tthe\tlatencies\tof\tsome\tof\tthe\tindividual\tcomponents. Our\tapproach\twas\tto\tgenerate\tfake\tevents\tto\tprice\tpart\tof\tthe\tportfolio\tthat\twas\tnot booked\tinto\tthe\tdownstream\tsystems.\tEvery\tminute\tor\tso,\twe\thad\tNagios\trun\ta\tcommand- line\tjob\tthat\tinserted\ta\tfake\tevent\tinto\tone\tof\tour\tqueues.\tOur\tsystem\tpicked\tit\tup\tand\tran all\tthe\tvarious\tcalculations\tjust\tlike\tany\tother\tjob,\texcept\tthe\tresults\tappeared\tin\tthe\tjunk book,\twhich\twas\tused\tonly\tfor\ttesting.\tIf\ta\tre-pricing\twasn’t\tseen\twithin\ta\tgiven\ttime, Nagios\treported\tthis\tas\tan\tissue.\n\nThis\tfake\tevent\twe\tcreated\tis\tan\texample\tof\tsynthetic\ttransaction.\tWe\tused\tthis\tsynthetic transaction\tto\tensure\tthe\tsystem\twas\tbehaving\tsemantically,\twhich\tis\twhy\tthis\ttechnique\tis often\tcalled\tsemantic\tmonitoring.\n\nIn\tpractice,\tI’ve\tfound\tthe\tuse\tof\tsynthetic\ttransactions\tto\tperform\tsemantic\tmonitoring like\tthis\tto\tbe\ta\tfar\tbetter\tindicator\tof\tissues\tin\tsystems\tthan\talerting\ton\tthe\tlower-level metrics.\tThey\tdon’t\treplace\tthe\tneed\tfor\tthe\tlower-level\tmetrics,\tthough\t—\twe’ll\tstill\twant that\tdetail\twhen\twe\tneed\tto\tfind\tout\twhy\tour\tsemantic\tmonitoring\tis\treporting\ta\tproblem.\n\nImplementing\tSemantic\tMonitoring\n\nNow\tin\tthe\tpast,\timplementing\tsemantic\tmonitoring\twas\ta\tfairly\tdaunting\ttask.\tBut\tthe world\thas\tmoved\ton,\tand\tthe\tmeans\tto\tdo\tthis\tis\tat\tour\tfingertips!\tYou\tare\trunning\ttests for\tyour\tsystems,\tright?\tIf\tnot,\tgo\tread\tChapter\t7\tand\tcome\tback.\tAll\tdone?\tGood!\n\nIf\twe\tlook\tat\tthe\ttests\twe\thave\tthat\ttest\ta\tgiven\tservice\tend\tto\tend,\tor\teven\tour\twhole system\tend\tto\tend,\twe\thave\tmuch\tof\twhat\twe\tneed\tto\timplement\tsemantic\tmonitoring. Our\tsystem\talready\texposes\tthe\thooks\tneeded\tto\tlaunch\tthe\ttest\tand\tcheck\tthe\tresult.\tSo why\tnot\tjust\trun\ta\tsubset\tof\tthese\ttests,\ton\tan\tongoing\tbasis,\tas\ta\tway\tof\tmonitoring\tour system?\n\nThere\tare\tsome\tthings\twe\tneed\tto\tdo,\tof\tcourse.\tFirst,\twe\tneed\tto\tbe\tcareful\tabout\tthe\tdata requirements\tof\tour\ttests.\tWe\tmay\tneed\tto\tfind\ta\tway\tfor\tour\ttests\tto\tadapt\tto\tdifferent\tlive data\tif\tthis\tchanges\tover\ttime,\tor\telse\tset\ta\tdifferent\tsource\tof\tdata.\tFor\texample,\twe\tcould have\ta\tset\tof\tfake\tusers\twe\tuse\tin\tproduction\twith\ta\tknown\tset\tof\tdata.\n\nLikewise,\twe\thave\tto\tmake\tsure\twe\tdon’t\taccidentally\ttrigger\tunforeseen\tside\teffects.\tA friend\ttold\tme\ta\tstory\tabout\tan\tecommerce\tcompany\tthat\taccidentally\tran\tits\ttests\tagainst its\tproduction\tordering\tsystems.\tIt\tdidn’t\trealize\tits\tmistake\tuntil\ta\tlarge\tnumber\tof washing\tmachines\tarrived\tat\tthe\thead\toffice.\n\nCorrelation\tIDs\n\nWith\ta\tlarge\tnumber\tof\tservices\tinteracting\tto\tprovide\tany\tgiven\tend-user\tcapability,\ta single\tinitiating\tcall\tcan\tend\tup\tgenerating\tmultiple\tmore\tdownstream\tservice\tcalls.\tFor example,\tconsider\tthe\texample\tof\ta\tcustomer\tbeing\tregistered.\tThe\tcustomer\tfills\tin\tall\ther details\tin\ta\tform\tand\tclicks\tsubmit.\tBehind\tthe\tscenes,\twe\tcheck\tvalidity\tof\tthe\tcredit\tcard details\twith\tour\tpayment\tservice,\ttalk\tto\tour\tpostal\tservice\tto\tsend\tout\ta\twelcome\tpack\tin the\tpost,\tand\tsend\ta\twelcome\temail\tusing\tour\temail\tservice.\tNow\twhat\thappens\tif\tthe\tcall to\tthe\tpayment\tservice\tends\tup\tgenerating\tan\todd\terror?\tWe’ll\ttalk\tat\tlength\tabout handling\tthe\tfailure\tin\tChapter\t11,\tbut\tconsider\tthe\tdifficulty\tof\tdiagnosing\twhat happened.\n\nIf\twe\tlook\tat\tthe\tlogs,\tthe\tonly\tservice\tregistering\tan\terror\tis\tour\tpayment\tservice.\tIf\twe are\tlucky,\twe\tcan\twork\tout\twhat\trequest\tcaused\tthe\tproblem,\tand\twe\tmay\teven\tbe\table\tto look\tat\tthe\tparameters\tof\tthe\tcall.\tNow\tconsider\tthat\tthis\tis\ta\tsimple\texample,\tand\tthat\tone initiating\trequest\tcould\tgenerate\ta\tchain\tof\tdownstream\tcalls\tand\tmaybe\tevents\tbeing\tfired off\tthat\tare\thandled\tin\tan\tasynchronous\tmanner.\tHow\tcan\twe\treconstruct\tthe\tflow\tof\tcalls in\torder\tto\treproduce\tand\tfix\tthe\tproblem?\tOften\twhat\twe\tneed\tis\tto\tsee\tthat\terror\tin\tthe wider\tcontext\tof\tthe\tinitiating\tcall;\tin\tother\twords,\twe’d\tlike\tto\ttrace\tthe\tcall\tchain upstream,\tjust\tlike\twe\tdo\twith\ta\tstack\ttrace.\n\nOne\tapproach\tthat\tcan\tbe\tuseful\there\tis\tto\tuse\tcorrelation\tIDs.\tWhen\tthe\tfirst\tcall\tis\tmade, you\tgenerate\ta\tGUID\tfor\tthe\tcall.\tThis\tis\tthen\tpassed\talong\tto\tall\tsubsequent\tcalls,\tas\tseen in\tFigure\t8-5,\tand\tcan\tbe\tput\tinto\tyour\tlogs\tin\ta\tstructured\tway,\tmuch\tas\tyou’ll\talready\tdo with\tcomponents\tlike\tthe\tlog\tlevel\tor\tdate.\tWith\tthe\tright\tlog\taggregation\ttooling,\tyou’ll then\tbe\table\tto\ttrace\tthat\tevent\tall\tthe\tway\tthrough\tyour\tsystem:\n\n15-02-2014\t16:01:01\tWeb-Frontend\tINFO\t[abc-123]\tRegister 15-02-2014\t16:01:02\tRegisterService\tINFO\t[abc-123]\tRegisterCustomer… 15-02-2014\t16:01:03\tPostalSystem\tINFO\t[abc-123]\tSendWelcomePack… 15-02-2014\t16:01:03\tEmailSystem\tINFO\t[abc-123]\tSendWelcomeEmail… 15-02-2014\t16:01:03\tPaymentGateway\tERROR\t[abc-123]\tValidatePayment…\n\nFigure\t8-5.\tUsing\tcorrelation\tIDs\tto\ttrack\tcall\tchains\tacross\tmultiple\tservices\n\nYou\twill,\tof\tcourse,\tneed\tto\tensure\tthat\teach\tservice\tknows\tto\tpass\ton\tthe\tcorrelation\tID. This\tis\twhere\tyou\tneed\tto\tstandardize\tand\tbe\tstronger\tin\tenforcing\tthis\tacross\tyour system.\tBut\tonce\tyou\thave\tdone\tthis,\tyou\tcan\tactually\tcreate\ttooling\tto\ttrack\tall\tsorts\tof interactions.\tSuch\ttooling\tcan\tbe\tuseful\tin\ttracking\tdown\tevent\tstorms,\todd\tcorner\tcases, or\teven\tidentifying\tespecially\tcostly\ttransactions,\tas\tyou\tcan\tpicture\tthe\twhole\tcascade\tof calls.\n\nSoftware\tsuch\tas\tZipkin\tcan\talso\ttrace\tcalls\tacross\tmultiple\tsystem\tboundaries.\tBased\ton the\tideas\tfrom\tGoogle’s\town\ttracing\tsystem,\tDapper,\tZipkin\tcan\tprovide\tvery\tdetailed tracing\tof\tinterservice\tcalls,\talong\twith\ta\tUI\tto\thelp\tpresent\tthe\tdata.\tPersonally,\tI’ve found\tthe\trequirements\tof\tZipkin\tto\tbe\tsomewhat\theavyweight,\trequiring\tcustom\tclients and\tsupporting\tcollection\tsystems.\tGiven\tthat\tyou’ll\talready\twant\tlog\taggregation\tfor other\tpurposes,\tit\tfeels\tmuch\tsimpler\tto\tinstead\tmake\tuse\tof\tdata\tyou’re\talready\tcollecting than\thave\tto\tplumb\tin\tadditional\tsources\tof\tdata.\tThat\tsaid,\tif\tyou\tfind\tthat\tyou\tneed\ta more\tadvanced\ttool\tto\ttrack\tinterservice\tcalls\tlike\tthis,\tyou\tmight\twant\tto\tgive\tthem\ta look.\n\nOne\tof\tthe\treal\tproblems\twith\tcorrelation\tIDs\tis\tthat\tyou\toften\tdon’t\tknow\tyou\tneed\tone until\tafter\tyou\talready\thave\ta\tproblem\tthat\tcould\tbe\tdiagnosed\tonly\tif\tyou\thad\tthe\tID\tat the\tbeginning!\tThis\tis\tespecially\tproblematic,\tas\tretrofitting\tcorrelation\tIDs\tin\tis\tvery difficult;\tyou\tneed\tto\thandle\tthem\tin\ta\tstandardized\tway\tto\tbe\table\tto\teasily\treconsititute call\tchains.\tAlthough\tit\tmight\tseem\tlike\tadditional\twork\tup\tfront,\tI\twould\tstrongly\tsuggest you\tconsider\tputting\tthem\tin\tas\tsoon\tas\tyou\tcan,\tespecially\tif\tyour\tsystem\twill\tmake\tuse of\tevent-drive\tarchitecture\tpatterns,\twhich\tcan\tlead\tto\tsome\todd\temergent\tbehavior.\n\nNeeding\tto\thandle\ttasks\tlike\tconsistently\tpassing\tthrough\tcorrelation\tIDs\tcan\tbe\ta\tstrong argument\tfor\tthe\tuse\tof\tthin\tshared\tclient\twrapper\tlibraries.\tAt\ta\tcertain\tscale,\tit\tbecomes difficult\tto\tensure\tthat\teveryone\tis\tcalling\tdownstream\tservices\tin\tthe\tright\tway\tand collecting\tthe\tright\tsort\tof\tdata.\tIt\tonly\ttakes\tone\tservice\tpartway\tthrough\tthe\tchain\tto forget\tto\tdo\tthis\tfor\tyou\tto\tlose\tcritical\tinformation.\tIf\tyou\tdo\tdecide\tto\tcreate\tan\tin-house client\tlibrary\tto\tmake\tthings\tlike\tthis\twork\tout\tof\tthe\tbox,\tdo\tmake\tsure\tyou\tkeep\tit\tvery thin\tand\tnot\ttied\tto\tany\tparticular\tproducing\tservice.\tFor\texample,\tif\tyou\tare\tusing\tHTTP as\tthe\tunderlying\tprotocol\tfor\tcommunication,\tjust\twrap\ta\tstandard\tHTTP\tclient\tlibrary, adding\tin\tcode\tto\tmake\tsure\tyou\tpropogate\tthe\tcorrelation\tIDs\tin\tthe\theaders.\n\nThe\tCascade\n\nCascading\tfailures\tcan\tbe\tespecially\tperilous.\tImagine\ta\tsituation\twhere\tthe\tnetwork connection\tbetween\tour\tmusic\tshop\twebsite\tand\tthe\tcatalog\tservice\tgoes\tdown.\tThe services\tthemselves\tappear\thealthy,\tbut\tthey\tcan’t\ttalk\tto\teach\tother.\tIf\twe\tjust\tlooked\tat the\thealth\tof\tthe\tindividual\tservice,\twe\twouldn’t\tknow\tthere\tis\ta\tproblem.\tUsing\tsynthetic monitoring\t—\tfor\texample,\tto\tmimic\ta\tcustomer\tsearching\tfor\ta\tsong\t—\twould\tpick\tup the\tproblem.\tBut\twe’d\talso\tneed\tto\treport\ton\tthe\tfact\tthat\tone\tservice\tcannot\tsee\tanother in\torder\tto\tdetermine\tthe\tcause\tof\tthe\tproblem.\n\nTherefore,\tmonitoring\tthe\tintegration\tpoints\tbetween\tsystems\tis\tkey.\tEach\tservice\tinstance should\ttrack\tand\texpose\tthe\thealth\tof\tits\tdownstream\tdependencies,\tfrom\tthe\tdatabase\tto other\tcollaborating\tservices.\tYou\tshould\talso\tallow\tthis\tinformation\tto\tbe\taggregated\tto give\tyou\ta\trolled-up\tpicture.\tYou’ll\twant\tto\tsee\tthe\tresponse\ttime\tof\tthe\tdownstream\tcalls, and\talso\tdetect\tif\tit\tis\terroring.\n\nAs\twe’ll\tdiscuss\tmore\tin\tChapter\t11,\tyou\tcan\tuse\tlibraries\tto\timplement\ta\tcircuit\tbreaker around\tnetwork\tcalls\tto\thelp\tyou\thandle\tcascading\tfailures\tin\ta\tmore\telegant\tfashion, allowing\tyou\tto\tmore\tgracefully\tdegrade\tyour\tsystem.\tSome\tof\tthese\tlibraries,\tsuch\tas Hystrix\tfor\tthe\tJVM,\talso\tdo\ta\tgood\tjob\tof\tproviding\tthese\tmonitoring\tcapabilities\tfor you.\n\nStandardization\n\nAs\twe’ve\tcovered\tpreviously,\tone\tof\tthe\tongoing\tbalancing\tacts\tyou’ll\tneed\tto\tpull\toff\tis where\tto\tallow\tfor\tdecisions\tto\tbe\tmade\tnarrowly\tfor\ta\tsingle\tservice\tversus\twhere\tyou need\tto\tstandardize\tacross\tyour\tsystem.\tIn\tmy\topinion,\tmonitoring\tis\tone\tarea\twhere standardization\tis\tincredibly\timportant.\tWith\tservices\tcollaborating\tin\tlots\tof\tdifferent ways\tto\tprovide\tcapabilities\tto\tusers\tusing\tmultiple\tinterfaces,\tyou\tneed\tto\tview\tthe system\tin\ta\tholistic\tway.\n\nYou\tshould\ttry\tto\twrite\tyour\tlogs\tout\tin\ta\tstandard\tformat.\tYou\tdefinitely\twant\tto\thave\tall your\tmetrics\tin\tone\tplace,\tand\tyou\tmay\twant\tto\thave\ta\tlist\tof\tstandard\tnames\tfor\tyour metrics\ttoo;\tit\twould\tbe\tvery\tannoying\tfor\tone\tservice\tto\thave\ta\tmetric\tcalled ResponseTime,\tand\tanother\tto\thave\tone\tcalled\tRspTimeSecs,\twhen\tthey\tmean\tthe\tsame thing.\n\nAs\talways\twith\tstandardization,\ttools\tcan\thelp.\tAs\tI’ve\tsaid\tbefore,\tthe\tkey\tis\tmaking\tit easy\tto\tdo\tthe\tright\tthing\t—\tso\twhy\tnot\tprovide\tpreconfigured\tvirtual\tmachine\timages with\tlogstash\tand\tcollectd\tready\tto\tgo,\talong\twith\tapplication\tlibraries\tthat\tlet\tyou\ttalk\tto Graphite\treally\teasily?\n\nConsider\tthe\tAudience\n\nAll\tthis\tdata\twe\tare\tgathering\tis\tfor\ta\tpurpose.\tMore\tspecifically,\twe\tare\tgathering\tall\tthis data\tfor\tdifferent\tpeople\tto\thelp\tthem\tdo\ttheir\tjobs;\tthis\tdata\tbecomes\ta\tcall\tto\taction. Some\tof\tthis\tdata\tneeds\tto\ttrigger\tan\timmediate\tcall\tto\taction\tfor\tour\tsupport\tteam\t—\tfor example,\tin\tthe\tcase\tof\tone\tof\tour\tsynthetic\tmonitoring\ttests\tfailing.\tOther\tdata,\tlike\tthe fact\tthat\tour\tCPU\tload\thas\tincreased\tby\t2%\tover\tthe\tlast\tweek,\tis\tpotentially\tonly\tof interest\twhen\twe’re\tdoing\tcapacity\tplanning.\tLikewise,\tyour\tboss\tis\tprobably\tgoing\tto want\tto\tknow\tright\taway\tthat\trevenue\tdipped\t25%\tafter\tthe\tlast\trelease,\tbut\tprobably doesn’t\tneed\tto\tbe\twoken\tup\tbecause\tsearches\tfor\t“Justin\tBieber”\thave\tgone\tup\t5%\tin\tthe last\thour.\n\nWhat\tour\tpeople\twant\tto\tsee\tand\treact\tto\tright\tnow\tis\tdifferent\tthan\twhat\tthey\tneed\twhen drilling\tdown.\tSo,\tfor\tthe\ttype\tof\tperson\twho\twill\tbe\tlooking\tat\tthis\tdata,\tconsider\tthe following:\n\nWhat\tthey\tneed\tto\tknow\tright\tnow\n\nWhat\tthey\tmight\twant\tlater\n\nHow\tthey\tlike\tto\tconsume\tdata\n\nAlert\ton\tthe\tthings\tthey\tneed\tto\tknow\tright\tnow.\tCreate\tbig\tvisible\tdisplays\twith\tthis information\tthat\tsit\tin\tthe\tcorner\tof\tthe\troom.\tGive\tthem\teasy\taccess\tto\tthe\tdata\tthey\tneed to\tknow\tlater.\tAnd\tspend\ttime\twith\tthem\tto\tknow\thow\tthey\twant\tto\tconsume\tdata.\tA discussion\tabout\tall\tthe\tnuances\tinvolved\tin\tthe\tgraphical\tdisplay\tof\tquantitative information\tis\tcertainly\toutside\tthe\tscope\tof\tthis\tbook,\tbut\ta\tgreat\tplace\tto\tstart\tis\tStephen Few’s\texcellent\tbook\tInformation\tDashboard\tDesign:\tDisplaying\tData\tfor\tAt-a-Glance Monitoring\t(Analytics\tPress).\n\nThe\tFuture\n\nI\thave\tseen\tmany\torganizations\twhere\tmetrics\tare\tsiloed\tinto\tdifferent\tsystems. Application-level\tmetrics,\tlike\tthe\tnumber\tof\torders\tplaced,\tend\tup\tin\ta\tproprietary analytics\tsystem\tlike\tOmniture,\twhich\tis\toften\tavailable\tonly\tto\tselect\tparts\tof\tthe business,\tor\telse\tends\tup\tin\tthe\tdreaded\tdata\twarehouse,\taka\twhere\tdata\tgoes\tto\tdie. Reporting\tfrom\tsuch\tsystems\tis\toften\tnot\tavailable\tin\treal\ttime,\talthough\tthat\tis\tstarting\tto change.\tMeanwhile,\tsystem\tmetrics\tlike\tresponse\ttimes,\terror\trates,\tand\tCPU\tload\tare stored\tin\tsystems\tthat\tthe\toperations\tteams\tcan\taccess.\tThese\tsystems\ttypically\tallow\tfor real-time\treporting,\tas\tnormally\tthe\tpoint\tof\tthem\tis\tto\tprovoke\tan\timmediate\tcall\tto action.\n\nHistorically,\tthe\tidea\tthat\twe\tcan\tfind\tout\tabout\tkey\tbusiness\tmetrics\ta\tday\tor\ttwo\tlater was\tfine,\tas\ttypically\twe\twere\tunable\tto\treact\tfast\tenough\tto\tthis\tdata\tto\tdo\tanything\tabout it\tanyway.\tNow,\tthough,\twe\toperate\tin\ta\tworld\tin\twhich\tmany\tof\tus\tcan\tand\tdo\tpush\tout multiple\treleases\tper\tday.\tTeams\tnow\tmeasure\tthemselves\tnot\tin\tterms\tof\thow\tmany points\tthey\tcomplete,\tbut\tinstead\toptimize\tfor\thow\tlong\tit\ttakes\tfor\tcode\tto\tget\tfrom laptop\tto\tlive.\tIn\tsuch\tan\tenvironment,\twe\tneed\tall\tour\tmetrics\tat\tour\tfingertips\tto\ttake\tthe right\taction.\tIronically,\tthe\tvery\tsystems\tthat\tstore\tbusiness\tmetrics\tare\toften\tnot\ttuned\tfor immediate\taccess\tto\tdata,\tbut\tour\toperational\tsystems\tare.\n\nSo\twhy\thandle\toperational\tand\tbusiness\tmetrics\tin\tthe\tsame\tway?\tUltimately,\tboth\ttypes of\tthings\tbreak\tdown\tto\tevents\tthat\tsay\tsomething\thappened\tat\tX.\tSo,\tif\twe\tcan\tunify\tthe systems\twe\tuse\tto\tgather,\taggregate,\tand\tstore\tthese\tevents,\tand\tmake\tthem\tavailable\tfor reporting,\twe\tend\tup\twith\ta\tmuch\tsimpler\tarchitecture.\n\nRiemann\tis\tan\tevent\tserver\tthat\tallows\tfor\tfairly\tadvanced\taggregation\tand\trouting\tof events\tand\tcan\tform\tpart\tof\tsuch\ta\tsolution.\tSuro\tis\tNetflix’s\tdata\tpipeline\tand\toperates\tin a\tsimilar\tspace.\tSuro\tis\texplicitly\tused\tto\thandle\tboth\tmetrics\tassociated\twith\tuser behavior,\tand\tmore\toperational\tdata\tlike\tapplication\tlogs.\tThis\tdata\tcan\tthen\tbe\tdispatched to\ta\tvariety\tof\tsystems,\tlike\tStorm\tfor\treal-time\tanalysis,\tHadoop\tfor\toffline\tbatch processing,\tor\tKibana\tfor\tlog\tanalysis.\n\nMany\torganizations\tare\tmoving\tin\ta\tfundamentally\tdifferent\tdirection:\taway\tfrom\thaving specialized\ttool\tchains\tfor\tdifferent\ttypes\tof\tmetrics\tand\ttoward\tmore\tgeneric\tevent routing\tsystems\tcapable\tof\tsignificant\tscale.\tThese\tsystems\tmanage\tto\tprovide\tmuch\tmore flexibility,\twhile\tat\tthe\tsame\ttime\tactually\tsimplifying\tour\tarchitecture.\n\nSummary\n\nSo,\twe’ve\tcovered\ta\tlot\there!\tI’ll\tattempt\tto\tsummarize\tthis\tchapter\tinto\tsome\teasy-to- follow\tadvice.\n\nFor\teach\tservice:\n\nTrack\tinbound\tresponse\ttime\tat\ta\tbare\tminimum.\tOnce\tyou’ve\tdone\tthat,\tfollow\twith error\trates\tand\tthen\tstart\tworking\ton\tapplication-level\tmetrics.\n\nTrack\tthe\thealth\tof\tall\tdownstream\tresponses,\tat\ta\tbare\tminimum\tincluding\tthe response\ttime\tof\tdownstream\tcalls,\tand\tat\tbest\ttracking\terror\trates.\tLibraries\tlike Hystrix\tcan\thelp\there.\n\nStandardize\ton\thow\tand\twhere\tmetrics\tare\tcollected.\n\nLog\tinto\ta\tstandard\tlocation,\tin\ta\tstandard\tformat\tif\tpossible.\tAggregation\tis\ta\tpain\tif every\tservice\tuses\ta\tdifferent\tlayout!\n\nMonitor\tthe\tunderlying\toperating\tsystem\tso\tyou\tcan\ttrack\tdown\trogue\tprocesses\tand do\tcapacity\tplanning.\n\nFor\tthe\tsystem:\n\nAggregate\thost-level\tmetrics\tlike\tCPU\ttogether\twith\tapplication-level\tmetrics.\n\nEnsure\tyour\tmetric\tstorage\ttool\tallows\tfor\taggregation\tat\ta\tsystem\tor\tservice\tlevel, and\tdrill\tdown\tto\tindividual\thosts.\n\nEnsure\tyour\tmetric\tstorage\ttool\tallows\tyou\tto\tmaintain\tdata\tlong\tenough\tto understand\ttrends\tin\tyour\tsystem.\n\nHave\ta\tsingle,\tqueryable\ttool\tfor\taggregating\tand\tstoring\tlogs.\n\nStrongly\tconsider\tstandardizing\ton\tthe\tuse\tof\tcorrelation\tIDs.\n\nUnderstand\twhat\trequires\ta\tcall\tto\taction,\tand\tstructure\talerting\tand\tdashboards accordingly.\n\nInvestigate\tthe\tpossibility\tof\tunifying\thow\tyou\taggregate\tall\tof\tyour\tvarious\tmetrics by\tseeing\tif\ta\ttool\tlike\tSuro\tor\tRiemann\tmakes\tsense\tfor\tyou.\n\nI’ve\talso\tattempted\tto\toutline\tthe\tdirection\tin\twhich\tmonitoring\tis\tmoving:\taway\tfrom systems\tspecialized\tto\tdo\tjust\tone\tthing,\tand\ttoward\tgeneric\tevent\tprocessing\tsystems\tthat allow\tyou\tto\tlook\tat\tyour\tsystem\tin\ta\tmore\tholistic\tway.\tThis\tis\tan\texciting\tand\temerging space,\tand\twhile\ta\tfull\tinvestigation\tis\toutside\tthe\tscope\tof\tthis\tbook,\thopefully\tI’ve\tgiven you\tenough\tto\tget\tstarted\twith.\tIf\tyou\twant\tto\tknow\tmore,\tI\tgo\tinto\tsome\tof\tthese\tideas\n\nand\tmore\tin\tmy\tearlier\tpublication\tLightweight\tSystems\tfor\tRealtime\tMonitoring (O’Reilly).\n\nIn\tthe\tnext\tchapter,\twe’ll\ttake\ta\tdifferent\tholistic\tview\tof\tour\tsystems\tto\tconsider\tsome\tof the\tunique\tadvantages\t—\tand\tchallenges\t—\tthat\tfine-grained\tarchitectures\tcan\tprovide\tin the\tarea\tof\tsecurity.\n\nChapter\t9.\tSecurity\n\nWe’ve\tbecome\tfamiliar\twith\tstories\tabout\tsecurity\tbreaches\tof\tlarge-scale\tsystems resulting\tin\tour\tdata\tbeing\texposed\tto\tall\tsorts\tof\tdodgy\tcharacters.\tBut\tmore\trecently, events\tlike\tthe\tEdward\tSnowden\trevelations\thave\tmade\tus\teven\tmore\taware\tof\tthe\tvalue of\tdata\tthat\tcompanies\thold\tabout\tus,\tand\tthe\tvalue\tof\tdata\tthat\twe\thold\tfor\tour\tcustomers in\tthe\tsystems\twe\tbuild.\tThis\tchapter\twill\tgive\ta\tbrief\toverview\tof\tsome\taspects\tof security\tyou\tshould\tconsider\twhen\tdesigning\tyour\tsystems.\tWhile\tnot\tmeant\tto\tbe exhaustive,\tit\twill\tlay\tout\tsome\tof\tthe\tmain\toptions\tavailable\tto\tyou\tand\tgive\tyou\ta starting\tpoint\tfor\tyour\town\tfurther\tresearch.\n\nWe\tneed\tto\tthink\tabout\twhat\tprotection\tour\tdata\tneeds\twhile\tin\ttransit\tfrom\tone\tpoint\tto another,\tand\twhat\tprotection\tit\tneeds\tat\trest.\tWe\tneed\tto\tthink\tabout\tthe\tsecurity\tof\tour underlying\toperating\tsystems,\tand\tour\tnetworks\ttoo.\tThere\tis\tso\tmuch\tto\tthink\tabout,\tand so\tmuch\twe\tcould\tdo!\tSo\thow\tmuch\tsecurity\tdo\twe\tneed?\tHow\tcan\twe\twork\tout\twhat\tis enough\tsecurity?\n\nBut\twe\talso\tneed\tto\tthink\tof\tthe\thuman\telement.\tHow\tdo\twe\tknow\twho\ta\tperson\tis,\tand what\the\tcan\tdo?\tAnd\thow\tdoes\tthis\trelate\tto\thow\tour\tservers\ttalk\tto\teach\tother?\tLet’s\tstart there.\n\nAuthentication\tand\tAuthorization\n\nAuthentication\tand\tauthorization\tare\tcore\tconcepts\twhen\tit\tcomes\tto\tpeople\tand\tthings that\tinteract\twith\tour\tsystem.\tIn\tthe\tcontext\tof\tsecurity,\tauthentication\tis\tthe\tprocess\tby which\twe\tconfirm\tthat\ta\tparty\tis\twho\tshe\tsays\tshe\tis.\tFor\ta\thuman,\tyou\ttypically authenticate\ta\tuser\tby\thaving\ther\ttype\tin\ther\tusername\tand\tpassword.\tWe\tassume\tthat\tonly she\thas\taccess\tto\tthis\tinformation,\tand\ttherefore\tthat\tthe\tperson\tentering\tthis\tinformation must\tbe\ther.\tOther,\tmore\tcomplex\tsystems\texist\tas\twell,\tof\tcourse.\tMy\tphone\tnow\tlets\tme use\tmy\tfingerprint\tto\tconfirm\tthat\tI\tam\twho\tI\tsay\tI\tam.\tGenerally,\twhen\twe’re\ttalking abstractly\tabout\twho\tor\twhat\tis\tbeing\tauthenticated,\twe\trefer\tto\tthat\tparty\tas\tthe\tprincipal.\n\nAuthorization\tis\tthe\tmechanism\tby\twhich\twe\tmap\tfrom\ta\tprincipal\tto\tthe\taction\twe\tare allowing\ther\tto\tdo.\tOften,\twhen\ta\tprincipal\tis\tauthenticated,\twe\twill\tbe\tgiven\tinformation about\ther\tthat\twill\thelp\tus\tdecide\twhat\twe\tshould\tlet\ther\tdo.\tWe\tmight,\tfor\texample,\tbe told\twhat\tdepartment\tor\toffice\tshe\tworks\tin\t—\tpieces\tof\tinformation\tthat\tour\tsystems\tcan use\tto\tdecide\twhat\tshe\tcan\tand\tcannot\tdo.\n\nFor\tsingle,\tmonolithic\tapplications,\tit\tis\tcommon\tfor\tthe\tapplication\titself\tto\thandle authentication\tand\tauthorization\tfor\tyou.\tDjango,\tthe\tPython\tweb\tframework,\tcomes\tout of\tthe\tbox\twith\tuser\tmanagement,\tfor\texample.\tWhen\tit\tcomes\tto\tdistributed\tsystems, though,\twe\tneed\tto\tthink\tof\tmore\tadvanced\tschemes.\tWe\tdon’t\twant\teveryone\tto\thave\tto log\tin\tseparately\tfor\tdifferent\tsystems,\tusing\ta\tdifferent\tusername\tand\tpassword\tfor\teach. The\taim\tis\tto\thave\ta\tsingle\tidentity\tthat\twe\tcan\tauthenticate\tonce.",
      "page_number": 268
    },
    {
      "number": 9,
      "title": "Security",
      "start_page": 286,
      "end_page": 322,
      "detection_method": "regex_chapter_title",
      "content": "Common\tSingle\tSign-On\tImplementations\n\nA\tcommon\tapproach\tto\tauthentication\tand\tauthorization\tis\tto\tuse\tsome\tsort\tof\tsingle\tsign- on\t(SSO)\tsolution.\tSAML,\twhich\tis\tthe\treigning\timplementation\tin\tthe\tenterprise\tspace, and\tOpenID\tConnect\tboth\tprovide\tcapabilities\tin\tthis\tarea.\tMore\tor\tless\tthey\tuse\tthe\tsame core\tconcepts,\talthough\tthe\tterminology\tdiffers\tslightly.\tThe\tterms\tused\there\tare\tfrom SAML.\n\nWhen\ta\tprincipal\ttries\tto\taccess\ta\tresource\t(like\ta\tweb-based\tinterface),\tshe\tis\tdirected\tto authenticate\twith\tan\tidentity\tprovider.\tThis\tmay\task\ther\tto\tprovide\ta\tusername\tand password,\tor\tmight\tuse\tsomething\tmore\tadvanced\tlike\ttwo-factor\tauthentication.\tOnce\tthe identity\tprovider\tis\tsatisfied\tthat\tthe\tprincipal\thas\tbeen\tauthenticated,\tit\tgives\tinformation to\tthe\tservice\tprovider,\tallowing\tit\tto\tdecide\twhether\tto\tgrant\ther\taccess\tto\tthe\tresource.\n\nThis\tidentity\tprovider\tcould\tbe\tan\texternally\thosted\tsystem,\tor\tsomething\tinside\tyour\town organization.\tGoogle,\tfor\texample,\tprovides\tan\tOpenID\tConnect\tidentity\tprovider.\tFor enterprises,\tthough,\tit\tis\tcommon\tto\thave\tyour\town\tidentity\tprovider,\twhich\tmay\tbe\tlinked to\tyour\tcompany’s\tdirectory\tservice.\tA\tdirectory\tservice\tcould\tbe\tsomething\tlike\tthe Lightweight\tDirectory\tAccess\tProtocol\t(LDAP)\tor\tActive\tDirectory.\tThese\tsystems\tallow you\tto\tstore\tinformation\tabout\tprincipals,\tsuch\tas\twhat\troles\tthey\tplay\tin\tthe\torganization. Often,\tthe\tdirectory\tservice\tand\tthe\tidentity\tprovider\tare\tone\tand\tthe\tsame,\twhile sometimes\tthey\tare\tseparate\tbut\tlinked.\tOkta,\tfor\texample,\tis\ta\thosted\tSAML\tidentity provider\tthat\thandles\ttasks\tlike\ttwo-factor\tauthentication,\tbut\tcan\tlink\tto\tyour\tcompany’s directory\tservices\tas\tthe\tsource\tof\ttruth.\n\nSAML\tis\ta\tSOAP-based\tstandard,\tand\tis\tknown\tfor\tbeing\tfairly\tcomplex\tto\twork\twith despite\tthe\tlibraries\tand\ttooling\tavailable\tto\tsupport\tit.\tOpenID\tConnect\tis\ta\tstandard\tthat has\temerged\tas\ta\tspecific\timplementation\tof\tOAuth\t2.0,\tbased\ton\tthe\tway\tGoogle\tand others\thandle\tSSO.\tIt\tuses\tsimpler\tREST\tcalls,\tand\tin\tmy\topinion\tis\tlikely\tto\tmake inroads\tinto\tenterprises\tdue\tto\tits\timproved\tease\tof\tuse.\tIts\tbiggest\tstumbling\tblock\tright now\tis\tthe\tlack\tof\tidentity\tproviders\tthat\tsupport\tit.\tFor\ta\tpublic-facing\twebsite,\tyou\tmight be\tOK\tusing\tGoogle\tas\tyour\tprovider,\tbut\tfor\tinternal\tsystems\tor\tsystems\twhere\tyou\twant more\tcontrol\tover\tand\tvisibility\tinto\thow\tand\twhere\tyour\tdata\tis\tinstalled,\tyou’ll\twant your\town\tin-house\tidentity\tprovider.\tAt\tthe\ttime\tof\twriting,\tOpenAM\tand\tGluu\tare\ttwo\tof the\tvery\tfew\toptions\tavailable\tin\tthis\tspace,\tcompared\tto\ta\twealth\tof\toptions\tfor\tSAML (including\tActive\tDirectory,\twhich\tseems\tto\tbe\teverywhere).\tUntil\tand\tunless\texisting identity\tproviders\tstart\tsupporting\tOpenID\tConnect,\tits\tgrowth\tmay\tbe\tlimited\tto\tthose situations\twhere\tpeople\tare\thappy\tusing\ta\tpublic\tidentity\tprovider.\n\nSo\twhile\tI\tthink\tOpenID\tConnect\tis\tthe\tfuture,\tit’s\tquite\tpossible\tit’ll\ttake\ta\twhile\tto\treach widespread\tadoption.\n\nSingle\tSign-On\tGateway\n\nWithin\ta\tmicroservice\tsetup,\teach\tservice\tcould\tdecide\tto\thandle\tthe\tredirection\tto,\tand handshaking\twith,\tthe\tidentity\tprovider.\tObviously,\tthis\tcould\tmean\ta\tlot\tof\tduplicated work.\tA\tshared\tlibrary\tcould\thelp,\tbut\twe’d\thave\tto\tbe\tcareful\tto\tavoid\tthe\tcoupling\tthat can\tcome\tfrom\tshared\tcode.\tThis\talso\twouldn’t\thelp\tif\tyou\thad\tmultiple\tdifferent technology\tstacks.\n\nRather\tthan\thaving\teach\tservice\tmanage\thandshaking\twith\tyour\tidentity\tprovider,\tyou\tcan use\ta\tgateway\tto\tact\tas\ta\tproxy,\tsitting\tbetween\tyour\tservices\tand\tthe\toutside\tworld\t(as shown\tin\tFigure\t9-1).\tThe\tidea\tis\tthat\twe\tcan\tcentralize\tthe\tbehavior\tfor\tredirecting\tthe user\tand\tperform\tthe\thandshake\tin\tonly\tone\tplace.\n\nFigure\t9-1.\tUsing\ta\tgateway\tto\thandle\tSSO\n\nHowever,\twe\tstill\tneed\tto\tsolve\tthe\tproblem\tof\thow\tthe\tdownstream\tservice\treceives information\tabout\tprincipals,\tsuch\tas\ttheir\tusername\tor\twhat\troles\tthey\tplay.\tIf\tyou’re using\tHTTP,\tit\tcould\tpopulate\theaders\twith\tthis\tinformation.\tShibboleth\tis\tone\ttool\tthat can\tdo\tthis\tfor\tyou,\tand\tI’ve\tseen\tit\tused\twith\tApache\tto\tgreat\teffect\tto\thandle\tintegration with\tSAML-based\tidentity\tproviders.\n\nAnother\tproblem\tis\tthat\tif\twe\thave\tdecided\tto\toffload\tresponsibility\tfor\tauthentication\tto\ta gateway,\tit\tcan\tbe\tharder\tto\treason\tabout\thow\ta\tmicroservice\tbehaves\twhen\tlooking\tat\tit in\tisolation.\tRemember\tin\tChapter\t7\twhere\twe\texplored\tsome\tof\tthe\tchallenges\tin reproducing\tproduction-like\tenvironments?\tIf\tyou\tgo\tthe\tgateway\troute,\tmake\tsure\tyour developers\tcan\tlaunch\ttheir\tservices\tbehind\tone\twithout\ttoo\tmuch\twork.\n\nOne\tfinal\tproblem\twith\tthis\tapproach\tis\tthat\tit\tcan\tlull\tyou\tinto\ta\tfalse\tsense\tof\tsecurity.\tI like\tthe\tidea\tof\tdefense\tin\tdepth\t—\tfrom\tnetwork\tperimeter,\tto\tsubnet,\tto\tfirewall,\tto\n\nmachine,\tto\toperating\tsystem,\tto\tthe\tunderlying\thardware.\tYou\thave\tthe\tability\tto implement\tsecurity\tmeasures\tat\tall\tof\tthese\tpoints,\tsome\tof\twhich\twe’ll\tget\tinto\tshortly.\tI have\tseen\tsome\tpeople\tput\tall\ttheir\teggs\tin\tone\tbasket,\trelying\ton\tthe\tgateway\tto\thandle every\tstep\tfor\tthem.\tAnd\twe\tall\tknow\twhat\thappens\twhen\twe\thave\ta\tsingle\tpoint\tof failure…\n\nObviously\tyou\tcould\tuse\tthis\tgateway\tto\tdo\tother\tthings.\tIf\tusing\ta\tlayer\tof\tApache instances\trunning\tShibboleth,\tfor\texample,\tyou\tcould\talso\tdecide\tto\tterminate\tHTTPS\tat this\tlevel,\trun\tintrusion\tdetection,\tand\tso\ton.\tDo\tbe\tcareful,\tthough.\tGateway\tlayers\ttend to\ttake\ton\tmore\tand\tmore\tfunctionality,\twhich\titself\tcan\tend\tup\tbeing\ta\tgiant\tcoupling point.\tAnd\tthe\tmore\tfunctionality\tsomething\thas,\tthe\tgreater\tthe\tattack\tsurface.\n\nFine-Grained\tAuthorization\n\nA\tgateway\tmay\tbe\table\tto\tprovide\tfairly\teffective\tcoarse-grained\tauthentication.\tFor example,\tit\tcould\tprevent\taccess\tto\tany\tnon-logged-in\tuser\tto\tthe\thelpdesk\tapplication. Assuming\tour\tgateway\tcan\textract\tattributes\tabout\tthe\tprincipal\tas\ta\tresult\tof\tthe authentication,\tit\tmay\tbe\table\tto\tmake\tmore\tnuanced\tdecisions.\tFor\texample,\tit\tis\tcommon to\tplace\tpeople\tin\tgroups,\tor\tassign\tthem\tto\troles.\tWe\tcan\tuse\tthis\tinformation\tto understand\twhat\tthey\tcan\tdo.\tSo\tfor\tthe\thelpdesk\tapplication,\twe\tmight\tallow\taccess\tonly to\tprincipals\twith\ta\tspecific\trole\t(e.g.,\tSTAFF).\tBeyond\tallowing\t(or\tdisallowing)\taccess to\tspecific\tresources\tor\tendpoints,\tthough,\twe\tneed\tto\tleave\tthe\trest\tto\tthe\tmicroservice itself;\tit\twill\tneed\tto\tmake\tfurther\tdecisions\tabout\twhat\toperations\tto\tallow.\n\nBack\tto\tour\thelpdesk\tapplication:\tdo\twe\tallow\tany\tstaff\tmembers\tto\tsee\tany\tand\tall details?\tMore\tlikely,\twe’ll\thave\tdifferent\troles\tat\twork.\tFor\texample,\ta\tprincipal\tin\tthe CALL_CENTER\tgroup\tmight\tbe\tallowed\tto\tview\tany\tpiece\tof\tinformation\tabout\ta customer\texcept\this\tpayment\tdetails.\tThe\tprincipal\tmight\talso\tbe\table\tto\tissue\trefunds,\tbut that\tamount\tmight\tbe\tcapped.\tSomeone\twho\thas\tthe\tCALL_CENTER_TEAM_LEADER role,\thowever,\tmight\tbe\table\tto\tissue\tlarger\trefunds.\n\nThese\tdecisions\tneed\tto\tbe\tlocal\tto\tthe\tmicroservice\tin\tquestion.\tI\thave\tseen\tpeople\tuse the\tvarious\tattributes\tsupplied\tby\tidentity\tproviders\tin\thorrible\tways,\tusing\treally\tfine- grained\troles\tlike\tCALL_CENTER_50_DOLLAR_REFUND,\twhere\tthey\tend\tup\tputting information\tspecific\tto\tone\tpart\tof\tone\tof\tour\tsystem’s\tbehavior\tinto\ttheir\tdirectory services.\tThis\tis\ta\tnightmare\tto\tmaintain\tand\tgives\tvery\tlittle\tscope\tfor\tour\tservices\tto have\ttheir\town\tindependent\tlifecycle,\tas\tsuddenly\ta\tchunk\tof\tinformation\tabout\thow\ta service\tbehaves\tlives\telsewhere,\tperhaps\tin\ta\tsystem\tmanaged\tby\ta\tdifferent\tpart\tof\tthe organization.\n\nInstead,\tfavor\tcoarse-grained\troles,\tmodeled\taround\thow\tyour\torganization\tworks.\tGoing all\tthe\tway\tback\tto\tthe\tearly\tchapters,\tremember\tthat\twe\tare\tbuilding\tsoftware\tto\tmatch how\tour\torganization\tworks.\tSo\tuse\tyour\troles\tin\tthis\tway\ttoo.\n\nService-to-Service\tAuthentication\tand\tAuthorization\n\nUp\tto\tthis\tpoint\twe’ve\tbeen\tusing\tthe\tterm\tprincipal\tto\tdescribe\tanything\tthat\tcan authenticate\tand\tbe\tauthorized\tto\tdo\tthings,\tbut\tour\texamples\thave\tactually\tbeen\tabout humans\tusing\tcomputers.\tBut\twhat\tabout\tprograms,\tor\tother\tservices,\tauthenticating\twith each\tother?\n\nAllow\tEverything\tInside\tthe\tPerimeter\n\nOur\tfirst\toption\tcould\tbe\tto\tjust\tassume\tthat\tany\tcalls\tto\ta\tservice\tmade\tfrom\tinside\tour perimeter\tare\timplicitly\ttrusted.\n\nDepending\ton\tthe\tsensitivity\tof\tthe\tdata,\tthis\tmight\tbe\tfine.\tSome\torganizations\tattempt\tto ensure\tsecurity\tat\tthe\tperimeter\tof\ttheir\tnetworks,\tand\ttherefore\tassume\tthey\tdon’t\tneed\tto do\tanything\telse\twhen\ttwo\tservices\tare\ttalking\ttogether.\tHowever,\tshould\tan\tattacker penetrate\tyour\tnetwork,\tyou\twill\thave\tlittle\tprotection\tagainst\ta\ttypical\tman-in-the-middle attack.\tIf\tthe\tattacker\tdecides\tto\tintercept\tand\tread\tthe\tdata\tbeing\tsent,\tchange\tthe\tdata without\tyou\tknowing,\tor\teven\tin\tsome\tcircumstances\tpretend\tto\tbe\tthe\tthing\tyou\tare talking\tto,\tyou\tmay\tnot\tknow\tmuch\tabout\tit.\n\nThis\tis\tby\tfar\tthe\tmost\tcommon\tform\tof\tinside-perimeter\ttrust\tI\tsee\tin\torganizations.\tThey may\tdecide\tto\trun\tthis\ttraffic\tover\tHTTPS,\tbut\tthey\tdon’t\tdo\tmuch\telse.\tI’m\tnot\tsaying that\tis\ta\tgood\tthing!\tFor\tmost\tof\tthe\torganizations\tI\tsee\tusing\tthis\tmodel,\tI\tworry\tthat\tthe implicit\ttrust\tmodel\tis\tnot\ta\tconscious\tdecision,\tbut\tmore\tthat\tpeople\tare\tunaware\tof\tthe risks\tin\tthe\tfirst\tplace.\n\nHTTP(S)\tBasic\tAuthentication\n\nHTTP\tBasic\tAuthentication\tallows\tfor\ta\tclient\tto\tsend\ta\tusername\tand\tpassword\tin\ta standard\tHTTP\theader.\tThe\tserver\tcan\tthen\tcheck\tthese\tdetails\tand\tconfirm\tthat\tthe\tclient is\tallowed\tto\taccess\tthe\tservice.\tThe\tadvantage\there\tis\tthat\tthis\tis\tan\textremely\twell- understood\tand\twell-supported\tprotocol.\tThe\tproblem\tis\tthat\tdoing\tthis\tover\tHTTP\tis highly\tproblematic,\tas\tthe\tusername\tand\tpassword\tare\tnot\tsent\tin\ta\tsecure\tmanner.\tAny intermediate\tparty\tcan\tlook\tat\tthe\tinformation\tin\tthe\theader\tand\tsee\tthe\tdata.\tThus,\tHTTP Basic\tAuthentication\tshould\tnormally\tbe\tused\tover\tHTTPS.\n\nWhen\tusing\tHTTPS,\tthe\tclient\tgains\tstrong\tguarantees\tthat\tthe\tserver\tit\tis\ttalking\tto\tis who\tthe\tclient\tthinks\tit\tis.\tIt\talso\tgives\tus\tadditional\tprotection\tagainst\tpeople eavesdropping\ton\tthe\ttraffic\tbetween\tthe\tclient\tand\tserver\tor\tmessing\twith\tthe\tpayload.\n\nThe\tserver\tneeds\tto\tmanage\tits\town\tSSL\tcertificates,\twhich\tcan\tbecome\tproblematic\twhen it\tis\tmanaging\tmultiple\tmachines.\tSome\torganizations\ttake\ton\ttheir\town\tcertificate\tissuing process,\twhich\tis\tan\tadditional\tadministrative\tand\toperational\tburden.\tTools\taround managing\tthis\tin\tan\tautomated\tfashion\tare\tnowhere\tnear\tas\tmature\tas\tthey\tcould\tbe,\tand\tit isn’t\tjust\tthe\tissuing\tprocess\tyou\thave\tto\thandle.\tSelf-signed\tcertificates\tare\tnot\teasily revokable,\tand\tthus\trequire\ta\tlot\tmore\tthought\taround\tdisaster\tscenarios.\tSee\tif\tyou\tcan dodge\tall\tthis\twork\tby\tavoiding\tself-signing\taltogether.\n\nAnother\tdownside\tis\tthat\ttraffic\tsent\tvia\tSSL\tcannot\tbe\tcached\tby\treverse\tproxies\tlike Varnish\tor\tSquid.\tThis\tmeans\tthat\tif\tyou\tneed\tto\tcache\ttraffic,\tit\twill\thave\tto\tbe\tdone either\tinside\tthe\tserver\tor\tinside\tthe\tclient.\tYou\tcan\tfix\tthis\tby\thaving\ta\tload\tbalancer terminate\tthe\tSSL\ttraffic,\tand\thaving\tthe\tcache\tsit\tbehind\tthe\tload\tbalancer.\n\nWe\talso\thave\tto\tthink\tabout\twhat\thappens\tif\twe\tare\tusing\tan\texisting\tSSO\tsolution,\tlike SAML,\tthat\talready\thas\taccess\tto\tusernames\tand\tpasswords.\tDo\twe\twant\tour\tbasic\tservice auth\tto\tuse\tthe\tsame\tset\tof\tcredentials,\tallowing\tus\tone\tprocess\tfor\tissuing\tand\trevoking them?\tWe\tcould\tdo\tthis\tby\thaving\tthe\tservice\ttalk\tto\tthe\tsame\tdirectory\tservice\tthat\tbacks our\tSSO\tsolution.\tAlternatively,\twe\tcould\tstore\tthe\tusernames\tand\tpasswords\tourselves inside\tthe\tservice,\tbut\tthen\twe\trun\tthe\trisk\tof\tduplicating\tbehavior.\n\nOne\tnote:\tin\tthis\tapproach,\tall\tthe\tserver\tknows\tis\tthat\tthe\tclient\thas\tthe\tusername\tand password.\tWe\thave\tno\tidea\tif\tthis\tinformation\tis\tcoming\tfrom\ta\tmachine\twe\texpect;\tit could\tbe\tcoming\tfrom\tanyone\ton\tour\tnetwork.\n\nUse\tSAML\tor\tOpenID\tConnect\n\nIf\tyou\tare\talready\tusing\tSAML\tor\tOpenID\tConnect\tas\tyour\tauthentication\tand authorization\tscheme,\tyou\tcould\tjust\tuse\tthat\tfor\tservice-to-service\tinteractions\ttoo.\tIf you’re\tusing\ta\tgateway,\tyou’ll\tneed\tto\troute\tall\tin-network\ttraffic\tvia\tthe\tgateway\ttoo,\tbut if\teach\tservice\tis\thandling\tthe\tintegration\titself,\tthis\tapproach\tshould\tjust\twork\tout\tof\tthe box.\tThe\tadvantage\there\tis\tthat\tyou’re\tmaking\tuse\tof\texisting\tinfrastructure,\tand\tget\tto centralize\tall\tyour\tservice\taccess\tcontrols\tin\ta\tcentral\tdirectory\tserver.\tWe’d\tstill\tneed\tto route\tthis\tover\tHTTPS\tif\twe\twanted\tto\tavoid\tman-in-the-middle\tattacks.\n\nClients\thave\ta\tset\tof\tcredentials\tthey\tuse\tto\tauthenticate\tthemselves\twith\tthe\tidentity provider,\tand\tthe\tservice\tgets\tthe\tinformation\tit\tneeds\tto\tdecide\ton\tany\tfine-grained authentication.\n\nThis\tdoes\tmean\tyou’ll\tneed\tan\taccount\tfor\tyour\tclients,\tsometimes\treferred\tto\tas\ta\tservice account.\tMany\torganizations\tuse\tthis\tapproach\tquite\tcommonly.\tA\tword\tof\twarning, though:\tif\tyou\tare\tgoing\tto\tcreate\tservice\taccounts,\ttry\tto\tkeep\ttheir\tuse\tnarrow.\tSo consider\teach\tmicroservice\thaving\tits\town\tset\tof\tcredentials.\tThis\tmakes revoking/changing\taccess\teasier\tif\tthe\tcredentials\tbecome\tcompromised,\tas\tyou\tonly\tneed to\trevoke\tthe\tset\tof\tcredentials\tthat\thave\tbeen\taffected.\n\nThere\tare\ta\tcouple\tof\tother\tdownsides,\tthough.\tFirst,\tjust\tas\twith\tBasic\tAuth,\twe\tneed\tto securely\tstore\tour\tcredentials:\twhere\tdo\tthe\tusername\tand\tpassword\tlive?\tThe\tclient\twill need\tto\tfind\tsome\tsecure\tway\tto\tstore\tthis\tdata.\tThe\tother\tproblem\tis\tthat\tsome\tof\tthe technology\tin\tthis\tspace\tto\tdo\tthe\tauthentication\tis\tfairly\ttedious\tto\tcode\tfor.\tSAML,\tin particular,\tmakes\timplementing\ta\tclient\ta\tpainful\taffair.\tOpenID\tConnect\thas\ta\tsimpler workflow,\tbut\tas\twe\tdiscussed\tearlier\tit\tisn’t\tthat\twell\tsupported\tyet.\n\nClient\tCertificates\n\nAnother\tapproach\tto\tconfirm\tthe\tidentity\tof\ta\tclient\tis\tto\tmake\tuse\tof\tcapabilities\tin Transport\tLayer\tSecurity\t(TLS),\tthe\tsuccessor\tto\tSSL,\tin\tthe\tform\tof\tclient\tcertificates. Here,\teach\tclient\thas\tan\tX.509\tcertificate\tinstalled\tthat\tis\tused\tto\testablish\ta\tlink\tbetween client\tand\tserver.\tThe\tserver\tcan\tverify\tthe\tauthenticity\tof\tthe\tclient\tcertificate,\tproviding strong\tguarantees\tthat\tthe\tclient\tis\tvalid.\n\nThe\toperational\tchallenges\there\tin\tcertificate\tmanagement\tare\teven\tmore\tonerous\tthan with\tjust\tusing\tserver-side\tcertificates.\tIt\tisn’t\tjust\tsome\tof\tthe\tbasic\tissues\tof\tcreating\tand managing\ta\tgreater\tnumber\tof\tcertificates;\trather,\tit’s\tthat\twith\tall\tthe\tcomplexities\taround the\tcertificates\tthemselves,\tyou\tcan\texpect\tto\tspend\ta\tlot\tof\ttime\ttrying\tto\tdiagnose\twhy\ta service\twon’t\taccept\twhat\tyou\tbelieve\tto\tbe\ta\tcompletely\tvalid\tclient\tcertificate.\tAnd\tthen we\thave\tto\tconsider\tthe\tdifficulty\tof\trevoking\tand\treissuing\tcertificates\tshould\tthe\tworst happen.\tUsing\twildcard\tcertificates\tcan\thelp,\tbut\twon’t\tsolve\tall\tproblems.\tThis\tadditional burden\tmeans\tyou’ll\tbe\tlooking\tto\tuse\tthis\ttechnique\twhen\tyou\tare\tespecially\tconcerned about\tthe\tsensitivity\tof\tthe\tdata\tbeing\tsent,\tor\tif\tyou\tare\tsending\tdata\tvia\tnetworks\tyou don’t\tfully\tcontrol.\tSo\tyou\tmight\tdecide\tto\tsecure\tcommunication\tof\tvery\timportant\tdata between\tparties\tthat\tis\tsent\tover\tthe\tInternet,\tfor\texample.\n\nHMAC\tOver\tHTTP\n\nAs\twe\tdiscussed\tearlier,\tthe\tuse\tof\tBasic\tAuthentication\tover\tplain\tHTTP\tis\tnot\tterribly sensible\tif\twe\tare\tworried\tabout\tthe\tusername\tand\tpassword\tbeing\tcompromised.\tThe traditional\talternative\tis\troute\ttraffic\tHTTPS,\tbut\tthere\tare\tsome\tdownsides.\tAside\tfrom managing\tthe\tcertificates,\tthe\toverhead\tof\tHTTPS\ttraffic\tcan\tplace\tadditional\tstrain\ton servers\t(although,\tto\tbe\thonest,\tthis\thas\ta\tlower\timpact\tthan\tit\tdid\tseveral\tyears\tago),\tand the\ttraffic\tcannot\teasily\tbe\tcached.\n\nAn\talternative\tapproach,\tas\tused\textensively\tby\tAmazon’s\tS3\tAPIs\tfor\tAWS\tand\tin\tparts of\tthe\tOAuth\tspecification,\tis\tto\tuse\ta\thash-based\tmessaging\tcode\t(HMAC)\tto\tsign\tthe request.\n\nWith\tHMAC\tthe\tbody\trequest\talong\twith\ta\tprivate\tkey\tis\thashed,\tand\tthe\tresulting\thash\tis sent\talong\twith\tthe\trequest.\tThe\tserver\tthen\tuses\tits\town\tcopy\tof\tthe\tprivate\tkey\tand\tthe request\tbody\tto\tre-create\tthe\thash.\tIf\tit\tmatches,\tit\tallows\tthe\trequest.\tThe\tnice\tthing\there is\tthat\tif\ta\tman\tin\tthe\tmiddle\tmesses\twith\tthe\trequest,\tthen\tthe\thash\twon’t\tmatch\tand\tthe server\tknows\tthe\trequest\thas\tbeen\ttampered\twith.\tAnd\tthe\tprivate\tkey\tis\tnever\tsent\tin\tthe request,\tso\tit\tcannot\tbe\tcompromised\tin\ttransit!\tThe\tadded\tbenefit\tis\tthat\tthis\ttraffic\tcan then\tmore\teasily\tbe\tcached,\tand\tthe\toverhead\tof\tgenerating\tthe\thashes\tmay\twell\tbe\tlower than\thandling\tHTTPS\ttraffic\t(although\tyour\tmileage\tmay\tvary).\n\nThere\tare\tthree\tdownsides\tto\tthis\tapproach.\tFirst,\tboth\tthe\tclient\tand\tserver\tneed\ta\tshared secret\tthat\tneeds\tto\tbe\tcommunicated\tsomehow.\tHow\tdo\tthey\tshare\tit?\tIt\tcould\tbe hardcoded\tat\tboth\tends,\tbut\tthen\tyou\thave\tthe\tproblem\tof\trevoking\taccess\tif\tthe\tsecret becomes\tcompromised.\tIf\tyou\tcommunicate\tthis\tkey\tover\tsome\talternative\tprotocol,\tthen you\tneed\tto\tmake\tsure\tthat\tthat\tprotocol\tis\talso\tvery\tsecure!\n\nSecond,\tthis\tis\ta\tpattern,\tnot\ta\tstandard,\tand\tthus\tthere\tare\tdivergent\tways\tof implementing\tit.\tAs\ta\tresult,\tthere\tis\ta\tdearth\tof\tgood,\topen,\tand\tusable\timplementations of\tthis\tapproach.\tIn\tgeneral,\tif\tthis\tapproach\tinterests\tyou,\tthen\tdo\tsome\tmore\treading\tto understand\tthe\tdifferent\tways\tit\tis\tdone.\tI’d\tgo\tas\tfar\tas\tto\tsay\tjust\tlook\tat\thow\tAmazon does\tthis\tfor\tS3\tand\tcopy\tits\tapproach,\tespecially\tusing\ta\tsensible\thashing\tfunction\twith\ta suitably\tlong\tkey\tlike\tSHA-256.\tJSON\tweb\ttokens\t(JWT)\tare\talso\tworth\tlooking\tat,\tas they\timplement\ta\tvery\tsimilar\tapproach\tand\tseem\tto\tbe\tgaining\ttraction.\tBut\tbe\taware\tof the\tdifficulty\tof\tgetting\tthis\tstuff\tright.\tMy\tcolleague\twas\tworking\twith\ta\tteam\tthat\twas implementing\tits\town\tJWT\timplementation,\tomitted\ta\tsingle\tBoolean\tcheck,\tand invalidated\tits\tentire\tauthentication\tcode!\tHopefully\tover\ttime\twe’ll\tsee\tmore\treusable library\timplementations.\n\nFinally,\tunderstand\tthat\tthis\tapproach\tensures\tonly\tthat\tno\tthird\tparty\thas\tmanipulated\tthe request\tand\tthat\tthe\tprivate\tkey\titself\tremains\tprivate.\tThe\trest\tof\tthe\tdata\tin\tthe\trequest will\tstill\tbe\tvisible\tto\tparties\tsnooping\ton\tthe\tnetwork.\n\nAPI\tKeys\n\nAll\tpublic\tAPIs\tfrom\tservices\tlike\tTwitter,\tGoogle,\tFlickr,\tand\tAWS\tmake\tuse\tof\tAPI keys.\tAPI\tkeys\tallow\ta\tservice\tto\tidentify\twho\tis\tmaking\ta\tcall,\tand\tplace\tlimits\ton\twhat they\tcan\tdo.\tOften\tthe\tlimits\tgo\tbeyond\tsimply\tgiving\taccess\tto\ta\tresource,\tand\tcan\textend to\tactions\tlike\trate-limiting\tspecific\tcallers\tto\tprotect\tquality\tof\tservice\tfor\tother\tpeople.\n\nWhen\tit\tcomes\tto\tusing\tAPI\tkeys\tto\thandle\tyour\town\tmicroservice-to-microservice approach,\tthe\texact\tmechanics\tof\thow\tit\tworks\twill\tdepend\ton\tthe\ttechnology\tyou\tuse. Some\tsystems\tuse\ta\tsingle\tAPI\tkey\tthat\tis\tshared,\tand\tuse\tan\tapproach\tsimilar\tto\tHMAC as\tjust\tdescribed.\tA\tmore\tcommon\tapproach\tis\tto\tuse\ta\tpublic\tand\tprivate\tkey\tpair. Typically,\tyou’ll\tmanage\tkeys\tcentrally,\tjust\tas\twe\twould\tmanage\tidentities\tof\tpeople centrally.\tThe\tgateway\tmodel\tis\tvery\tpopular\tin\tthis\tspace.\n\nPart\tof\ttheir\tpopularity\tstems\tfrom\tthe\tfact\tthat\tAPI\tkeys\tare\tfocused\ton\tease\tof\tuse\tfor programs.\tCompared\tto\thandling\ta\tSAML\thandshake,\tAPI\tkey–based\tauthentication\tis much\tsimpler\tand\tmore\tstraightforward.\n\nThe\texact\tcapabilities\tof\tthe\tsystems\tvary,\tand\tyou\thave\tmultiple\toptions\tin\tboth\tthe commercial\tand\topen\tsource\tspace.\tSome\tof\tthe\tproducts\tjust\thandle\tthe\tAPI\tkey exchange\tand\tsome\tbasic\tkey\tmanagement.\tOther\ttools\toffer\teverything\tup\tto\tand including\trate\tlimiting,\tmonetization,\tAPI\tcatalogs,\tand\tdiscovery\tsystems.\n\nSome\tAPI\tsystems\tallow\tyou\tto\tbridge\tAPI\tkeys\tto\texisting\tdirectory\tservices.\tThis\twould allow\tyou\tto\tissue\tAPI\tkeys\tto\tprincipals\t(representing\tpeople\tor\tsystems)\tin\tyour organization,\tand\tcontrol\tthe\tlifecycle\tof\tthose\tkeys\tin\tthe\tsame\tway\tyou’d\tmanage\ttheir normal\tcredentials.\tThis\topens\tup\tthe\tpossibility\tof\tallowing\taccess\tto\tyour\tservices\tin different\tways\tbut\tkeeping\tthe\tsame\tsource\tof\ttruth\t—\tfor\texample,\tusing\tSAML\tto authenticate\thumans\tfor\tSSO,\tand\tusing\tAPI\tkeys\tfor\tservice-to-service\tcommunication, as\tshown\tin\tFigure\t9-2.\n\nFigure\t9-2.\tUsing\tdirectory\tservices\tto\tsynchronize\tprincipal\tinformation\tbetween\tan\tSSO\tand\tan\tAPI\tgateway\n\nThe\tDeputy\tProblem\n\nHaving\ta\tprincipal\tauthenticate\twith\ta\tgiven\tmicroserservice\tis\tsimple\tenough.\tBut\twhat happens\tif\tthat\tservice\tthen\tneeds\tto\tmake\tadditional\tcalls\tto\tcomplete\tan\toperation?\tTake a\tlook\tat\tFigure\t9-3,\twhich\tillustrates\tMusicCorp’s\tonline\tshopping\tsite.\tOur\tonline\tshop is\ta\tbrowser-based\tJavaScript\tUI.\tIt\tmakes\tcalls\tto\ta\tserver-side\tshop\tapplication,\tusing the\tbackends-for-frontends\tpattern\twe\tdescribed\tin\tChapter\t4.\tCalls\tmade\tbetween\tthe browser\tand\tserver\tcalls\tcan\tbe\tauthenticated\tusing\tSAML\tor\tOpenID\tConnect\tor\tsimilar. So\tfar,\tso\tgood.\n\nWhen\tI\tam\tlogged\tin,\tI\tcan\tclick\ton\ta\tlink\tto\tview\tdetails\tof\tan\torder.\tTo\tdisplay\tthe information,\twe\tneed\tto\tpull\tback\tthe\toriginal\torder\tfrom\tthe\torder\tservice,\tbut\twe\talso want\tto\tlook\tup\tshipping\tinformation\tfor\tthe\torder.\tSo\tclicking\tthe\tlink\tto /orderStatus/12345\tcauses\tthe\tonline\tshop\tto\tinitiate\ta\tcall\tfrom\tthe\tonline\tshop\tservice\tto both\tthe\torder\tservice\tand\tshipping\tservice\tasking\tfor\tthose\tdetails.\tBut\tshould\tthese downstream\tservices\taccept\tthe\tcalls\tfrom\tthe\tonline\tshop?\tWe\tcould\tadopt\ta\tstance\tof implicit\ttrust\t—\tthat\tbecause\tthe\tcall\tcame\tfrom\twithin\tour\tperimeter,\tit\tis\tOK.\tWe\tcould even\tuse\tcertificates\tor\tAPI\tkeys\tto\tconfirm\tthat\tyes,\tit\treally\tis\tthe\tonline\tshop\tasking\tfor this\tinformation.\tBut\tis\tthis\tenough?\n\nFigure\t9-3.\tAn\texample\twhere\ta\tconfused\tdeputy\tcould\tcome\tinto\tplay\n\nThere\tis\ta\ttype\tof\tvulnerability\tcalled\tthe\tconfused\tdeputy\tproblem,\twhich\tin\tthe\tcontext of\tservice-to-service\tcommunication\trefers\tto\ta\tsituation\twhere\ta\tmalicious\tparty\tcan\ttrick a\tdeputy\tservice\tinto\tmaking\tcalls\tto\ta\tdownstream\tservice\ton\this\tbehalf\tthat\the\tshouldn’t be\table\tto.\tFor\texample,\tas\ta\tcustomer,\twhen\tI\tlog\tin\tto\tthe\tonline\tshopping\tsystem,\tI\tcan see\tmy\taccount\tdetails.\tWhat\tif\tI\tcould\ttrick\tthe\tonline\tshopping\tUI\tinto\tmaking\ta\trequest for\tsomeone\telse’s\tdetails,\tmaybe\tby\tmaking\ta\tcall\twith\tmy\tlogged-in\tcredentials?\n\nIn\tthis\texample,\twhat\tis\tto\tstop\tme\tfrom\tasking\tfor\torders\tthat\tare\tnot\tmine?\tOnce\tlogged in,\tI\tcould\tstart\tsending\trequests\tfor\tother\torders\tthat\taren’t\tmine\tto\tsee\tif\tI\tcould\tget\n\nuseful\tinformation.\tWe\tcould\ttry\tto\tprotect\tagainst\tthis\tinside\tthe\tonline\tshop\titself,\tby checking\twho\tthe\torder\tis\tfor\tand\trejecting\tit\tif\tsomeone’s\tasking\tfor\tthings\the\tshouldn’t. If\twe\thave\tlots\tof\tdifferent\tapplications\tthat\tsurface\tthis\tinformation,\tthough,\twe\tcould potentially\tbe\tduplicating\tthis\tlogic\tin\tlots\tof\tplaces.\n\nWe\tcould\troute\trequests\tdirectly\tfrom\tthe\tUI\tto\tthe\torder\tservice\tand\tallow\tit\tto\tvalidate the\trequest,\tbut\tthen\twe\thit\tthe\tvarious\tdownsides\twe\tdiscussed\tin\tChapter\t4. Alternatively,\twhen\tthe\tonline\tshop\tsends\tthe\trequest\tto\tthe\torder\tservice,\tit\tcould\tstate not\tjust\twhat\torder\tit\twants,\tbut\talso\ton\twhose\tbehalf\tit\tis\tasking.\tSome\tauthentication schemes\tallow\tus\tto\tpass\tin\tthe\toriginal\tprincipal’s\tcredentials\tdownstream,\talthough\twith SAML\tthis\tis\ta\tbit\tof\ta\tnightmare,\tinvolving\tnested\tSAML\tassertions\tthat\tare\ttechnically achievable\t—\tbut\tso\tdifficult\tthat\tno\tone\tever\tdoes\tthis.\tThis\tcan\tbecome\teven\tmore complex,\tof\tcourse.\tImagine\tif\tthe\tservices\tthe\tonline\tshop\ttalks\tto\tin\tturn\tmake\tmore downstream\tcalls.\tHow\tfar\tdo\twe\thave\tto\tgo\tin\tvalidating\ttrust\tfor\tall\tthose\tdeputies?\n\nThis\tproblem,\tunfortunately,\thas\tno\tsimple\tanswer,\tbecause\tit\tisn’t\ta\tsimple\tproblem.\tBe aware\tthat\tit\texists,\tthough.\tDepending\ton\tthe\tsensitivity\tof\tthe\toperation\tin\tquestion,\tyou might\thave\tto\tchoose\tbetween\timplicit\ttrust,\tverifying\tthe\tidentity\tof\tthe\tcaller,\tor\tasking the\tcaller\tto\tprovide\tthe\tcredentials\tof\tthe\toriginal\tprincipal.\n\nSecuring\tData\tat\tRest\n\nData\tlying\tabout\tis\ta\tliability,\tespecially\tif\tit\tis\tsensitive.\tHopefully\twe’ve\tdone everything\twe\tcan\tto\tensure\tattackers\tcannot\tbreach\tour\tnetwork,\tand\talso\tthat\tthey cannot\tbreach\tour\tapplications\tor\toperating\tsystems\tto\tget\taccess\tto\tthe\tunderlying\tclose up.\tHowever,\twe\tneed\tto\tbe\tprepared\tin\tcase\tthey\tdo\t—\tdefense\tin\tdepth\tis\tkey.\n\nMany\tof\tthe\thigh-profile\tsecurity\tbreaches\tinvolve\tdata\tat\trest\tbeing\tacquired\tby\tan attacker,\tand\tthat\tdata\tbeing\treadable\tby\tthe\tattacker.\tThis\tis\teither\tbecause\tthe\tdata\twas stored\tin\tan\tunencrypted\tform,\tor\tbecause\tthe\tmechanism\tused\tto\tprotect\tthe\tdata\thad\ta fundamental\tflaw.\n\nThe\tmechanisms\tby\twhich\tsecure\tinformation\tcan\tbe\tprotected\tare\tmany\tand\tvaried,\tbut whichever\tapproach\tyou\tpick\tthere\tare\tsome\tgeneral\tthings\tto\tbear\tin\tmind.\n\nGo\twith\tthe\tWell\tKnown\n\nThe\teasiest\tway\tyou\tcan\tmess\tup\tdata\tencryption\tis\tto\ttry\tto\timplement\tyour\town encryption\talgorithms,\tor\teven\ttry\tto\timplement\tsomeone\telse’s.\tWhatever\tprogramming language\tyou\tuse,\tyou’ll\thave\taccess\tto\treviewed,\tregularly\tpatched\timplementations\tof well-regarded\tencryption\talgorithms.\tUse\tthose!\tAnd\tsubscribe\tto\tthe\tmailing lists/advisory\tlists\tfor\tthe\ttechnology\tyou\tchoose\tto\tmake\tsure\tyou\tare\taware\tof vulnerabilities\tas\tthey\tare\tfound\tso\tyou\tcan\tkeep\tthem\tpatched\tand\tup\tto\tdate.\n\nFor\tencryption\tat\trest,\tunless\tyou\thave\ta\tvery\tgood\treason\tfor\tpicking\tsomething\telse, pick\ta\twell-known\timplementation\tof\tAES-128\tor\tAES-256\tfor\tyour\tplatform.3\tBoth\tthe Java\tand\t.NET\truntimes\tinclude\timplementations\tof\tAES\tthat\tare\thighly\tlikely\tto\tbe\twell tested\t(and\twell\tpatched),\tbut\tseparate\tlibraries\texist\tfor\tmost\tplatforms\ttoo\t—\tfor example,\tthe\tBouncy\tCastle\tlibraries\tfor\tJava\tand\tC#.\n\nFor\tpasswords,\tyou\tshould\tconsider\tusing\ta\ttechnique\tcalled\tsalted\tpassword\thashing.\n\nBadly\timplemented\tencryption\tcould\tbe\tworse\tthan\thaving\tnone,\tas\tthe\tfalse\tsense\tof security\t(pardon\tthe\tpun)\tcan\tlead\tyou\tto\ttake\tyour\teye\toff\tthe\tball.\n\nIt’s\tAll\tAbout\tthe\tKeys\n\nAs\thas\tbeen\tcovered\tso\tfar,\tencryption\trelies\ton\tan\talgorithm\ttaking\tthe\tdata\tto\tbe encrypted\tand\ta\tkey\tand\tthen\tproducing\tthe\tencrypted\tdata.\tSo,\twhere\tis\tyour\tkey\tstored? Now\tif\tI\tam\tencrypting\tmy\tdata\tbecause\tI\tam\tworried\tabout\tsomeone\tstealing\tmy\twhole database,\tand\tI\tstore\tthe\tkey\tI\tuse\tin\tthe\tsame\tdatabase,\tthen\tI\thaven’t\treally\tachieved much!\tTherefore,\twe\tneed\tto\tstore\tthe\tkeys\tsomewhere\telse.\tBut\twhere?\n\nOne\tsolution\tis\tto\tuse\ta\tseparate\tsecurity\tappliance\tto\tencrypt\tand\tdecrypt\tdata.\tAnother\tis to\tuse\ta\tseparate\tkey\tvault\tthat\tyour\tservice\tcan\taccess\twhen\tit\tneeds\ta\tkey.\tThe\tlifecycle management\tof\tthe\tkeys\t(and\taccess\tto\tchange\tthem)\tcan\tbe\ta\tvital\toperation,\tand\tthese systems\tcan\thandle\tthis\tfor\tyou.\n\nSome\tdatabases\teven\tinclude\tbuilt-in\tsupport\tfor\tencryption,\tsuch\tas\tSQL\tServer’s Transparent\tData\tEncryption,\tthat\taim\tto\thandle\tthis\tin\ta\ttransparent\tfashion.\tEven\tif\tyour database\tof\tchoice\tdoes,\tresearch\thow\tthe\tkeys\tare\thandled\tand\tunderstand\tif\tthe\tthreat you\tare\tprotecting\tagainst\tis\tactually\tbeing\tmitigated.\n\nAgain,\tthis\tstuff\tis\tcomplex.\tAvoid\timplementing\tyour\town,\tand\tdo\tsome\tgood\tresearch!\n\nPick\tYour\tTargets\n\nAssuming\teverything\tshould\tbe\tencrypted\tcan\tsimplify\tthings\tsomewhat.\tThere\tis\tno guesswork\tabout\twhat\tshould\tor\tshould\tnot\tbe\tprotected.\tHowever,\tyou’ll\tstill\tneed\tto think\tabout\twhat\tdata\tcan\tbe\tput\tinto\tlogfiles\tto\thelp\tproblem\tidentification,\tand\tthe computational\toverhead\tof\tencrypting\teverything\tcan\tbecome\tpretty\tonerous,\tneeding more\tpowerful\thardware\tas\ta\tresult.\tThis\tis\teven\tmore\tchallenging\twhen\tyou’re\tapplying database\tmigrations\tas\tpart\tof\trefactoring\tschemas.\tDepending\ton\tthe\tchanges\tbeing made,\tthe\tdata\tmay\tneed\tto\tbe\tdecrypted,\tmigrated,\tand\tre-encrypted.\n\nBy\tsubdividing\tyour\tsystem\tinto\tmore\tfine-grained\tservices,\tyou\tmight\tidentify\tan\tentire data\tstore\tthat\tcan\tbe\tencrypted\twholesale,\tbut\teven\tthen\tit\tis\tunlikely.\tLimiting\tthis encryption\tto\ta\tknown\tset\tof\ttables\tis\ta\tsensible\tapproach.\n\nDecrypt\ton\tDemand\n\nEncrypt\tdata\twhen\tyou\tfirst\tsee\tit.\tOnly\tdecrypt\ton\tdemand,\tand\tensure\tthat\tdata\tis\tnever stored\tanywhere.\n\nEncrypt\tBackups\n\nBackups\tare\tgood.\tWe\twant\tto\tback\tup\tour\timportant\tdata,\tand\talmost\tby\tdefinition\tdata we\tare\tworried\tenough\tabout\tthat\twe\twant\tto\tencrypt\tit\tis\timportant\tenough\tto\tback\tup! So\tit\tmay\tseem\tlike\tan\tobvious\tpoint,\tbut\twe\tneed\tto\tmake\tsure\tthat\tour\tbackups\tare\talso encrypted.\tThis\talso\tmeans\tthat\twe\tneed\tto\tknow\twhich\tkeys\tare\tneeded\tto\thandle\twhich version\tof\tdata,\tespecially\tif\tthe\tkeys\tchange.\tHaving\tclear\tkey\tmanagement\tbecomes fairly\timportant.\n\nDefense\tin\tDepth\n\nAs\tI’ve\tmentioned\tearlier,\tI\tdislike\tputting\tall\tour\teggs\tin\tone\tbasket.\tIt’s\tall\tabout\tdefence in\tdepth.\tWe’ve\ttalked\talready\tabout\tsecuring\tdata\tin\ttransit,\tand\tsecuring\tdata\tat\trest.\tBut are\tthere\tother\tprotections\twe\tcould\tput\tin\tplace\tto\thelp?\n\nFirewalls\n\nHaving\tone\tor\tmore\tfirewalls\tis\ta\tvery\tsensible\tprecaution\tto\ttake.\tSome\tare\tvery\tsimple, able\tonly\tto\trestrict\taccess\tto\tcertain\ttypes\tof\ttraffic\ton\tcertain\tports.\tOthers\tare\tmore sophisticated.\tModSecurity,\tfor\texample,\tis\ta\ttype\tof\tapplication\tfirewall\tthat\tcan\thelp throttle\tconnections\tfrom\tcertain\tIP\tranges\tand\tdetect\tother\tsorts\tof\tmalicious\tattacks.\n\nThere\tis\tvalue\tin\thaving\tmore\tthan\tone\tfirewall.\tFor\texample,\tyou\tmay\tdecide\tto\tuse IPTables\tlocally\ton\ta\thost\tto\tsecure\tthat\thost,\tsetting\tup\tthe\tallowable\tingress\tand\tegress. These\trules\tcould\tbe\ttailored\tto\tthe\tlocally\trunning\tservices,\twith\ta\tfirewall\tat\tthe perimeter\tfor\tcontrolling\tgeneral\taccess.\n\nLogging\n\nGood\tlogging,\tand\tspecifically\tthe\tability\tto\taggregate\tlogs\tfrom\tmultiple\tsystems,\tis\tnot about\tprevention,\tbut\tcan\thelp\twith\tdetecting\tand\trecovering\tfrom\tbad\tthings\thappening. For\texample,\tafter\tapplying\tsecurity\tpatches\tyou\tcan\toften\tsee\tin\tlogs\tif\tpeople\thave\tbeen exploiting\tcertain\tvulnerabilities.\tPatching\tmakes\tsure\tit\twon’t\thappen\tagain,\tbut\tif\tit already\thas\thappened,\tyou\tmay\tneed\tto\tgo\tinto\trecovery\tmode.\tHaving\tlogs\tavailable allows\tyou\tto\tsee\tif\tsomething\tbad\thappened\tafter\tthe\tfact.\n\nNote,\thowever,\tthat\twe\tneed\tto\tbe\tcareful\tabout\twhat\tinformation\twe\tstore\tin\tour\tlogs! Sensitive\tinformation\tneeds\tto\tbe\tculled\tto\tensure\twe\taren’t\tleaking\timportant\tdata\tinto our\tlogs,\twhich\tcould\tend\tup\tbeing\ta\tgreat\ttarget\tfor\tattackers.\n\nIntrusion\tDetection\t(and\tPrevention)\tSystem\n\nIntrusion\tdetection\tsystems\t(IDS)\tcan\tmonitor\tnetworks\tor\thosts\tfor\tsuspicious\tbehavior, reporting\tproblems\twhen\tit\tsees\tthem.\tIntrusion\tprevention\tsystems\t(IPS),\tas\twell\tas monitoring\tfor\tsuspicious\tactivity,\tcan\tstep\tin\tto\tstop\tit\tfrom\thappening.\tUnlike\ta\tfirewall, which\tis\tprimarily\tlooking\toutward\tto\tstop\tbad\tthings\tfrom\tgetting\tin,\tIDS\tand\tIPS\tare actively\tlooking\tinside\tthe\tperimeter\tfor\tsuspect\tbehavior.\tWhen\tyou’re\tstarting\tfrom scratch,\tIDS\tmay\tmake\tmost\tsense.\tThese\tsystems\tare\theuristic-based\t(as\tare\tmany application\tfirewalls),\tand\tit\tis\tpossible\tthat\tthe\tgeneric\tstarting\tset\tof\trules\twill\teither\tbe too\tlenient\tor\tnot\tlenient\tenough\tfor\thow\tyour\tservice\tbehaves.\tUsing\ta\tmore\tpassive\tIDS to\talert\tyou\tto\tproblems\tis\ta\tgood\tway\tto\ttune\tyour\trules\tbefore\tusing\tit\tin\ta\tmore\tactive capacity.\n\nNetwork\tSegregation\n\nWith\ta\tmonolithic\tsystem,\twe\thave\tlimits\tto\thow\twe\tcan\tstructure\tour\tnetworks\tto\tprovide additional\tprotections.\tWith\tmicroservices,\tthough,\tyou\tcan\tput\tthem\tinto\tdifferent network\tsegments\tto\tfurther\tcontrol\thow\tservices\ttalk\tto\teach\tother.\tAWS,\tfor\texample, provides\tthe\tability\tto\tautomatically\tprovision\ta\tvirtual\tprivate\tcloud\t(VPC),\twhich\tallow hosts\tto\tlive\tin\tseparate\tsubnets.\tYou\tcan\tthen\tspecify\twhich\tVPCs\tcan\tsee\teach\tother\tby defining\tpeering\trules,\tand\teven\troute\ttraffic\tthrough\tgateways\tto\tproxy\taccess,\tgiving you\tin\teffect\tmultiple\tperimeters\tat\twhich\tadditional\tsecurity\tmeasures\tcan\tbe\tput\tinto place.\n\nThis\tcould\tallow\tyou\tto\tsegment\tnetworks\tbased\ton\tteam\townership,\tor\tperhaps\tby\trisk level.\n\nOperating\tSystem\n\nOur\tsystems\trely\ton\ta\tlarge\tamount\tof\tsoftware\tthat\twe\tdidn’t\twrite,\tand\tmay\thave security\tvulnerabilities\tthat\tcould\texpose\tour\tapplication,\tnamely\tour\toperating\tsystems and\tthe\tother\tsupporting\ttools\twe\trun\ton\tthem.\tHere,\tbasic\tadvice\tcan\tget\tyou\ta\tlong\tway. Start\twith\tonly\trunning\tservices\tas\tOS\tusers\tthat\thave\tas\tfew\tpermissions\tas\tpossible,\tto ensure\tthat\tif\tsuch\tan\taccount\tis\tcompromised\tit\twill\tdo\tminimal\tdamage.\n\nNext,\tpatch\tyour\tsoftware.\tRegularly.\tThis\tneeds\tto\tbe\tautomated,\tand\tyou\tneed\tto\tknow if\tyour\tmachines\tare\tout\tof\tsync\twith\tthe\tlatest\tpatch\tlevels.\tTools\tlike\tMicrosoft’s\tSCCM or\tRedHat’s\tSpacewalk\tcan\tbe\tbeneficial\there,\tas\tthey\tcan\thelp\tyou\tsee\tif\tmachines\tare\tup to\tdate\twith\tthe\tlatest\tpatches\tand\tinitiate\tupdates\tif\trequired.\tIf\tyou\tare\tusing\ttools\tlike Ansible,\tPuppet,\tor\tChef,\tchances\tare\tyou\tare\talready\tfairly\thappy\twith\tpushing\tout changes\tautomatically\t—\tthese\ttools\tcan\tget\tyou\ta\tlong\tway\ttoo,\tbut\twon’t\tdo\teverything for\tyou.\n\nThis\treally\tis\tbasic\tstuff,\tbut\tit\tis\tsurprising\thow\toften\tI\tsee\tcritical\tsoftware\trunning\ton unpatched,\told\toperating\tsystems.\tYou\tcan\thave\tthe\tmost\twell-defined\tand\tprotected application-level\tsecurity\tin\tthe\tworld,\tbut\tif\tyou\thave\tan\told\tversion\tof\ta\tweb\tserver running\ton\tyour\tmachine\tas\troot\tthat\thas\tan\tunpatched\tbuffer\toverflow\tvulnerability,\tthen your\tsystem\tcould\tstill\tbe\textremely\tvulnerable.\n\nAnother\tthing\tto\tlook\tat\tif\tyou\tare\tusing\tLinux\tis\tthe\temergence\tof\tsecurity\tmodules\tfor the\toperating\tsystem\titself.\tAppArmour,\tfor\texample,\tallows\tyou\tto\tdefine\thow\tyour application\tis\texpected\tto\tbehave,\twith\tthe\tkernel\tkeeping\tan\teye\ton\tit.\tIf\tit\tstarts\tdoing something\tit\tshouldn’t,\tthe\tkernel\tsteps\tin.\tAppArmour\thas\tbeen\taround\tfor\ta\twhile,\tas has\tSeLinux.\tAlthough\ttechnically\teither\tof\tthem\tshould\twork\ton\tany\tmodern\tLinux system,\tin\tpractice\tsome\tdistributions\tsupport\tone\tbetter\tthan\tthe\tother.\tAppArmour\tis used\tby\tdefault\tin\tUbuntu\tand\tSuSE,\tfor\texample,\twhereas\tSELinux\thas\ttraditionally\tbeen well\tsupported\tby\tRedHat.\tA\tnewer\toption\tis\tGrSSecurity,\twhich\taims\tto\tbe\tsimpler\tto use\tthan\teither\tAppArmour\tor\tGrSecurity\twhile\talso\ttrying\tto\texpand\ton\ttheir\tcapabilities, but\tit\trequires\ta\tcustom\tkernel\tto\twork.\tI’d\tsuggest\ttaking\ta\tlook\tat\tall\tthree\tto\tsee\twhich fits\tyour\tuse\tcases\tbest,\tbut\tI\tlike\tthe\tidea\tof\thaving\tanother\tlayer\tof\tprotection\tand prevention\tat\twork.\n\nA\tWorked\tExample\n\nHaving\ta\tfiner-grained\tsystem\tarchitecture\tgives\tus\tmuch\tmore\tfreedom\tin\thow\twe implement\tour\tsecurity.\tFor\tthose\tparts\tthat\tdeal\twith\tthe\tmost\tsensitive\tinformation\tor expose\tthe\tmost\tvaluable\tcapabilities,\twe\tcan\tadopt\tthe\tstrictest\tsecurity\tprovisions.\tBut for\tother\tparts\tof\tthe\tsystem,\twe\tcan\tafford\tto\tbe\tmuch\tmore\tlax\tin\twhat\twe\tworry\tabout.\n\nLet’s\tconsider\tMusicCorp\tonce\tagain,\tand\tpull\tsome\tof\tthe\tpreceding\tconcepts\ttogether\tto see\twhere\tand\thow\twe\tmight\tuse\tsome\tof\tthese\tsecurity\ttechniques.\tWe’re\tlooking primarily\tat\tthe\tsecurity\tconcerns\tof\tdata\tin\ttransit\tand\tat\trest.\tFigure\t9-4\tshows\ta\tsubset of\tthe\toverall\tsystem\tthat\twe’ll\tbe\tanalyzing,\twhich\tcurrently\tshows\ta\tcrushing\tlack\tof regard\tfor\tsecurity\tconcerns.\tEverything\tis\tsent\tover\tplain\told\tHTTP.\n\nFigure\t9-4.\tA\tsubset\tof\tMusicCorp’s\tunfortunately\tinsecure\tarchitecture\n\nHere\twe\thave\tstandard\tweb\tbrowsers\tthat\tare\tused\tby\tour\tcustomers\tto\tshop\ton\tthe\tsite. We\talso\tintroduce\tthe\tconcept\tof\ta\tthird-party\troyalty\tgateway:\twe’ve\tstarted\tworking with\ta\tthird-party\tcompany\tthat\twill\thandle\troyalty\tpayments\tfor\tour\tnew\tstreaming service.\tIt\tcontacts\tus\toccasionally\tto\tpull\tdown\trecords\tof\twhat\tmusic\thas\tbeen\tstreamed when\t—\tinformation\twe\tjealously\tprotect\tas\twe\tare\tworried\tabout\tcompetition\tfrom\trival companies.\tFinally,\twe\texpose\tour\tcatalog\tdata\tto\tother\tthird\tparties\t—\tfor\texample, allowing\tthe\tmetadata\tabout\tartist\tor\tsong\tto\tbe\tembedded\tin\tmusic\treview\tsites.\tInside our\tnetwork\tperimeter,\twe\thave\tsome\tcollaborating\tservices,\twhich\tare\tonly\tever\tused internally.\n\nFor\tthe\tbrowser,\twe’ll\tuse\ta\tmix\tof\tstandard\tHTTP\ttraffic\tfor\tnonsecure\tcontent,\tto\tallow for\tit\tto\tbe\tcached.\tFor\tsecure,\tlogged-in\tpages,\tall\tsecure\tcontent\twill\tbe\tsent\tover HTTPS,\tgiving\tour\tcustomers\textra\tprotection\tif\tthey\tare\tdoing\tthings\tlike\trunning\ton public\tWiFi\tnetworks.\n\nWhen\tit\tcomes\tto\tthe\tthird-party\troyalty\tpayment\tsystem,\twe\tare\tconcerned\tnot\tonly\tabout the\tnature\tof\tthe\tdata\twe\tare\texposing,\tbut\talso\tabout\tmaking\tsure\tthe\trequests\twe’re\n\ngetting\tare\tlegitimate.\tHere,\twe\tinsist\tthat\tour\tthird\tparty\tuses\tclient\tcertificates.\tAll\tthe data\tis\tsent\tover\ta\tsecure,\tcryptographic\tchannel,\tincreasing\tour\tability\tto\tensure\twe’re being\tasked\tfor\tthis\tdata\tby\tthe\tright\tperson.\tWe\tdo,\tof\tcourse,\thave\tto\tthink\tabout\twhat happens\twhen\tthe\tdata\tleaves\tour\tcontrol.\tWill\tour\tpartner\tcare\tabout\tthe\tdata\tas\tmuch\tas we\twill?\n\nFor\tthe\tfeeds\tof\tcatalog\tdata,\twe\twant\tthis\tinformation\tshared\tas\twidely\tas\tpossible\tto allow\tpeople\tto\teasily\tbuy\tmusic\tfrom\tus!\tHowever,\twe\tdon’t\twant\tthis\tabused,\tand\twe’d like\tsome\tidea\tof\twho\tis\tusing\tour\tdata.\tHere,\tAPI\tkeys\tmake\tperfect\tsense.\n\nInside\tthe\tnetwork\tperimeter,\tthings\tare\ta\tbit\tmore\tnuanced.\tHow\tworried\tare\twe\tabout people\tcompromising\tour\tinternal\tnetworks?\tIdeally,\twe’d\tlike\tto\tuse\tHTTPS\tat\ta minimum,\tbut\tmanaging\tit\tis\tsomewhat\tpainful.\tWe\tdecide\tinstead\tto\tput\tthe\twork (initially,\tat\tleast)\tinto\thardening\tour\tnetwork\tperimeter,\tincluding\thaving\ta\tproperly configured\tfirewall\tand\tselecting\tan\tappropriate\thardware\tor\tsoftware\tsecurity\tappliance to\tcheck\tfor\tmalicious\ttraffic\t(e.g.,\tport\tscanning\tor\tdenial-of-service\tattacks).\n\nThat\tsaid,\twe\tare\tconcerned\tabout\tsome\tof\tour\tdata\tand\twhere\tit\tlives.\tWe\taren’t\tworried about\tthe\tcatalog\tservice;\tafter\tall,\twe\twant\tthat\tdata\tshared\tand\thave\tprovided\tan\tAPI\tfor it!\tBut\twe\tare\tvery\tconcerned\tabout\tour\tcustomers’\tdata.\tHere,\twe\tdecide\tto\tencrypt\tthe data\theld\tby\tthe\tcustomer\tservice,\tand\tdecrypt\tdata\ton\tread.\tIf\tattackers\tdo\tpenetrate\tour network,\tthey\tcould\tstill\trun\trequests\tagainst\tthe\tcustomer\tservice’s\tAPI,\tbut\tthe\tcurrent implementation\tdoes\tnot\tallow\tfor\tthe\tbulk\tretrieval\tof\tcustomer\tdata.\tIf\tit\tdid,\twe\twould likely\tconsider\tthe\tuse\tof\tclient\tcertificates\tto\tprotect\tthis\tinformation.\tEven\tif\tattackers compromise\tthe\tmachine\tthe\tdatabase\tis\trunning\ton\tand\tmanage\tto\tdownload\tthe\tentire contents,\tthey\twould\tneed\taccess\tto\tthe\tkey\tused\tto\tencrypt\tand\tdecrypt\tthe\tdata\tto\tmake use\tif\tit.\n\nFigure\t9-5\tshows\tthe\tfinal\tpicture.\tAs\tyou\tcan\tsee,\tthe\tchoices\twe\tmade\tabout\twhat technology\tto\tuse\twere\tbased\ton\tan\tunderstanding\tof\tthe\tnature\tof\tthe\tinformation\tbeing secured.\tYour\town\tarchitecture’s\tsecurity\tconcerns\tare\tlikely\tto\tbe\tvery\tdifferent,\tand\tso you\tmay\tend\tup\twith\ta\tdifferent-looking\tsolution.\n\nFigure\t9-5.\tMusicCorp’s\tmore\tsecure\tsystem\n\nBe\tFrugal\n\nAs\tdisk\tspace\tbecomes\tcheaper\tand\tthe\tcapabilities\tof\tthe\tdatabases\timprove,\tthe\tease with\twhich\tbulk\tamounts\tof\tinformation\tcan\tbe\tcaptured\tand\tstored\tis\timproving\trapidly. This\tdata\tis\tvaluable\t—\tnot\tonly\tto\tbusinesses\tthemselves,\twhich\tincreasingly\tsee\tdata\tas a\tvaluable\tasset,\tbut\tequally\tto\tthe\tusers\twho\tvalue\ttheir\town\tprivacy.\tThe\tdata\tthat pertains\tto\tan\tindividual,\tor\tcould\tbe\tused\tto\tderive\tinformation\tabout\tan\tindividual,\tmust be\tthe\tdata\twe\tare\tmost\tcareful\tabout.\n\nHowever,\twhat\tif\twe\tmade\tour\tlives\ta\tbit\teasier?\tWhy\tnot\tscrub\tas\tmuch\tinformation\tas possible\tthat\tcan\tbe\tpersonally\tidentifiable,\tand\tdo\tit\tas\tsoon\tas\tpossible?\tWhen\tlogging\ta request\tfrom\ta\tuser,\tdo\twe\tneed\tto\tstore\tthe\tentire\tIP\taddress\tforever,\tor\tcould\twe\treplace the\tlast\tfew\tdigits\twith\tx?\tDo\twe\tneed\tto\tstore\tsomeone’s\tname,\tage,\tgender,\tand\tdate\tof birth\tin\torder\tto\tprovide\ther\twith\tproduct\toffers,\tor\tis\ther\tage\trange\tand\tpostcode\tenough information?\n\nThe\tadvantages\there\tare\tmanifold.\tFirst,\tif\tyou\tdon’t\tstore\tit,\tno\tone\tcan\tsteal\tit.\tSecond,\tif you\tdon’t\tstore\tit,\tno\tone\t(e.g.,\ta\tgovernmental\tagency)\tcan\task\tfor\tit\teither!\n\nThe\tGerman\tphrase\tDatensparsamkeit\trepresents\tthis\tconcept.\tOriginating\tfrom\tGerman privacy\tlegislation,\tit\tencapsulates\tthe\tconcept\tof\tonly\tstoring\tas\tmuch\tinformation\tas\tis absolutely\trequired\tto\tfulfill\tbusiness\toperations\tor\tsatisfy\tlocal\tlaws.\n\nThis\tis\tobviously\tin\tdirect\ttension\twith\tthe\tmove\ttoward\tstoring\tmore\tand\tmore information,\tbut\tit\tis\ta\tstart\tto\trealize\tthat\tthis\ttension\teven\texists!\n\nThe\tHuman\tElement\n\nMuch\tof\twhat\twe\thave\tcovered\there\tis\tthe\tbasics\tof\thow\tto\timplement\ttechnological safeguards\tto\tprotect\tyour\tsystems\tand\tdata\tfrom\tmalicious,\texternal\tattackers.\tHowever, you\tmay\talso\tneed\tprocesses\tand\tpolicies\tin\tplace\tto\tdeal\twith\tthe\thuman\telement\tin\tyour organization.\tHow\tdo\tyou\trevoke\taccess\tto\tcredentials\twhen\tsomeone\tleaves\tthe organization?\tHow\tcan\tyou\tprotect\tyourself\tagainst\tsocial\tengineering?\tAs\ta\tgood\tmental exercise,\tconsider\twhat\tdamage\ta\tdisgruntled\tex-employee\tcould\tdo\tto\tyour\tsystems\tif\tshe wanted\tto.\tPutting\tyourself\tin\tthe\tmindset\tof\ta\tmalicious\tparty\tis\toften\ta\tgood\tway\tto reason\tabout\tthe\tprotections\tyou\tmay\tneed,\tand\tfew\tmalicious\tparties\thave\tas\tmuch\tinside information\tas\ta\trecent\temployee!\n\nThe\tGolden\tRule\n\nIf\tthere\tis\tnothing\telse\tyou\ttake\taway\tfrom\tthis\tchapter,\tlet\tit\tbe\tthis:\tdon’t\twrite\tyour\town crypto.\tDon’t\tinvent\tyour\town\tsecurity\tprotocols.\tUnless\tyou\tare\ta\tcryptographic\texpert with\tyears\tof\texperience,\tif\tyou\ttry\tinventing\tyour\town\tencoding\tor\telaborate cryptographic\tprotections,\tyou\twill\tget\tit\twrong.\tAnd\teven\tif\tyou\tare\ta\tcryptographic expert,\tyou\tmay\tstill\tget\tit\twrong.\n\nMany\tof\tthe\ttools\tpreviously\toutlined,\tlike\tAES,\tare\tindustry-hardened\ttechnologies whose\tunderlying\talgorithms\thave\tbeen\tpeer\treviewed,\tand\twhose\tsoftware implementation\thas\tbeen\trigorously\ttested\tand\tpatched\tover\tmany\tyears.\tThey\tare\tgood enough!\tReinventing\tthe\twheel\tin\tmany\tcases\tis\toften\tjust\ta\twaste\tof\ttime,\tbut\twhen\tit comes\tto\tsecurity\tit\tcan\tbe\toutright\tdangerous.\n\nBaking\tSecurity\tIn\n\nJust\tas\twith\tautomated\tfunctional\ttesting,\twe\tdon’t\twant\tsecurity\tto\tbe\tleft\tto\ta\tdifferent set\tof\tpeople,\tnor\tdo\twe\twant\tto\tleave\teverything\tto\tthe\tlast\tminute.\tHelping\teducate developers\tabout\tsecurity\tconcerns\tis\tkey,\tas\traising\teveryone’s\tgeneral\tawareness\tof security\tissues\tcan\thelp\treduce\tthem\tin\tthe\tfirst\tplace.\tGetting\tpeople\tfamilar\twith\tthe OWASP\tTop\tTen\tlist\tand\tOWASP’s\tSecurity\tTesting\tFramework\tcan\tbe\ta\tgreat\tplace\tto start.\tSpecialists\tabsolutely\thave\ttheir\tplace,\tthough,\tand\tif\tyou\thave\taccess\tto\tthem,\tuse them\tto\thelp\tyou.\n\nThere\tare\tautomated\ttools\tthat\tcan\tprobe\tour\tsystems\tfor\tvulnerabilities,\tsuch\tas\tby looking\tfor\tcross-site\tscripting\tattacks.\tThe\tZed\tAttack\tProxy\t(aka\tZAP)\tis\ta\tgood example.\tInformed\tby\tthe\twork\tof\tOWASP,\tZAP\tattempts\tto\tre-create\tmalicious\tattacks on\tyour\twebsite.\tOther\ttools\texist\tthat\tuse\tstatic\tanalysis\tto\tlook\tfor\tcommon\tcoding mistakes\tthat\tcan\topen\tup\tsecurity\tholes,\tsuch\tas\tBrakeman\tfor\tRuby.\tWhere\tthese\ttools can\tbe\teasily\tintegrated\tinto\tnormal\tCI\tbuilds,\tintegrate\tthem\tinto\tyour\tstandard\tcheck-ins. Other\tsorts\tof\tautomated\ttests\tare\tmore\tinvolved.\tFor\texample,\tusing\tsomething\tlike Nessus\tto\tscan\tfor\tvulnerabilities\tis\ta\tbit\tmore\tinvolved\tand\tit\tmay\trequire\ta\thuman\tto interpret\tthe\tresults.\tThat\tsaid,\tthese\ttests\tare\tstill\tautomatable,\tand\tit\tmay\tmake\tsense\tto run\tthem\twith\tthe\tsame\tsort\tof\tcadence\tas\tload\ttesting.\n\nMicrosoft’s\tSecurity\tDevelopment\tLifecycle\talso\thas\tsome\tgood\tmodels\tfor\thow\tdelivery teams\tcan\tbake\tsecurity\tin.\tSome\taspects\tof\tit\tfeel\toverly\twaterfall,\tbut\ttake\ta\tlook\tand\tsee what\taspects\tcan\tfit\tinto\tyour\tcurrent\tworkflow.\n\nExternal\tVerification\n\nWith\tsecurity,\tI\tthink\tthere\tis\tgreat\tvalue\tin\thaving\tan\texternal\tassessment\tdone.\tExercises like\tpenetration\ttesting,\twhen\tdone\tby\tan\toutside\tparty,\treally\tdo\tmimic\treal-world attempts.\tThey\talso\tsidestep\tthe\tissue\tthat\tteams\taren’t\talways\table\tto\tsee\tthe\tmistakes they\thave\tmade\tthemselves,\tas\tthey\tare\ttoo\tclose\tto\tthe\tproblem.\tIf\tyou’re\ta\tbig\tenough company,\tyou\tmay\thave\ta\tdedicated\tinfosec\tteam\tthat\tcan\thelp\tyou.\tIf\tnot,\tfind\tan external\tparty\twho\tcan.\tReach\tout\tto\tthem\tearly,\tunderstand\thow\tthey\tlike\tto\twork,\tand find\tout\thow\tmuch\tnotice\tthey\tneed\tto\tdo\ta\ttest.\n\nYou’ll\talso\tneed\tto\tconsider\thow\tmuch\tverification\tyou\trequire\tbefore\teach\trelease. Generally,\tdoing\ta\tfull\tpenetration\ttest,\tfor\texample,\tisn’t\tneeded\tfor\tsmall\tincremental releases,\tbut\tmay\tbe\tfor\tlarger\tchanges.\tWhat\tyou\tneed\tdepends\ton\tyour\town\trisk\tprofile.\n\nSummary\n\nSo\tagain\twe\treturn\tto\ta\tcore\ttheme\tof\tthe\tbook\t—\tthat\thaving\ta\tsystem\tdecomposed\tinto finer-grained\tservices\tgives\tus\tmany\tmore\toptions\tas\tto\thow\tto\tsolve\ta\tproblem.\tNot\tonly can\thaving\tmicroservices\tpotentially\treduce\tthe\timpact\tof\tany\tgiven\tbreach,\tbut\tit\talso gives\tus\tmore\tability\tto\ttrade\toff\tthe\toverhead\tof\tmore\tcomplex\tand\tsecure\tapproaches where\tdata\tis\tsensitive,\tand\ta\tlighter-weight\tapproach\twhen\tthe\trisks\tare\tlower.\n\nOnce\tyou\tunderstand\tthe\tthreat\tlevels\tof\tdifferent\tparts\tof\tyour\tsystem,\tyou\tshould\tstart\tto get\ta\tsense\tof\twhen\tto\tconsider\tsecurity\tduring\ttransit,\tat\trest,\tor\tnot\tat\tall.\n\nFinally,\tunderstand\tthe\timportance\tof\tdefense\tin\tdepth,\tmake\tsure\tyou\tpatch\tyour operating\tsystems,\tand\teven\tif\tyou\tconsider\tyourself\ta\trock\tstar,\tdon’t\ttry\tto\timplement your\town\tcryptography!\n\nIf\tyou\twant\ta\tgeneral\toverview\tof\tsecurity\tfor\tbrowser-based\tapplications,\ta\tgreat\tplace\tto start\tis\tthe\texcellent\tOpen\tWeb\tApplication\tSecurity\tProject\t(OWASP)\tnonprofit,\twhose regularly\tupdated\tTop\t10\tSecurity\tRisk\tdocument\tshould\tbe\tconsidered\tessential\treading for\tany\tdeveloper.\tFinally,\tif\tyou\twant\ta\tmore\tgeneral\tdiscussion\tof\tcryptography,\tcheck out\tthe\tbook\tCryptography\tEngineering\tby\tNiels\tFerguson,\tBruce\tSchneier,\tand Tadayoshi\tKohno\t(Wiley).\n\nGetting\tto\tgrips\twith\tsecurity\tis\toften\tabout\tunderstanding\tpeople\tand\thow\tthey\twork\twith our\tsystems.\tOne\thuman-related\taspect\twe\thaven’t\tyet\tdiscussed\tin\tterms\tof\tmicroservices is\tthe\tinterplay\tbetween\torganizational\tstructures\tand\tthe\tarchitectures\tthemselves.\tBut\tas with\tsecurity,\twe’ll\tsee\tthat\tignoring\tthe\thuman\telement\tcan\tbe\ta\tgrave\tmistake.\n\n3\tIn\tgeneral,\tkey\tlength\tincreases\tthe\tamount\tof\twork\trequired\tto\tbrute-force-break\ta\tkey. Therefore\tyou\tcan\tassume\tthe\tlonger\tthe\tkey,\tthe\tmore\tsecure\tyour\tdata.\tHowever,\tsome minor\tconcerns\thave\tbeen\traised\tabout\tthe\timplementation\tof\tAES-256\tfor\tcertain\ttypes of\tkeys\tby\trespected\tsecurity\texpert\tBruce\tSchneier.\tThis\tis\tone\tof\tthose\tareas\twhere\tyou need\tto\tdo\tmore\tresearch\ton\twhat\tthe\tcurrent\tadvice\tis\tat\tthe\ttime\tof\treading!\n\nChapter\t10.\tConway’s\tLaw\tand\tSystem Design\n\nMuch\tof\tthe\tbook\tso\tfar\thas\tfocused\ton\tthe\ttechnical\tchallenges\tin\tmoving\ttoward\ta\tfine- grained\tarchitecture.\tBut\tthere\tare\tother,\torganizational\tissues\tto\tconsider\tas\twell.\tAs we’ll\tlearn\tin\tthis\tchapter,\tyou\tignore\tyour\tcompany’s\torganization\tchart\tat\tyour\tperil!\n\nOur\tindustry\tis\tyoung,\tand\tseems\tto\tbe\tconstantly\treinventing\titself.\tAnd\tyet\ta\tfew\tkey laws\thave\tstood\tthe\ttest\tof\ttime.\tMoore’s\tlaw,\tfor\texample,\twhich\tstates\tthat\tthe\tdensity\tof transistors\ton\tintegrated\tcircuits\tdoubles\tevery\ttwo\tyears,\thas\tproved\tto\tbe\tuncannily accurate\t(although\tsome\tpeople\tpredict\tthat\tthis\ttrend\tis\talready\tslowing).\tOne\tlaw\tthat\tI have\tfound\tto\tbe\talmost\tuniversally\ttrue,\tand\tfar\tmore\tuseful\tin\tmy\tday-to-day\twork,\tis Conway’s\tlaw.\n\nMelvin\tConway’s\tpaper\tHow\tDo\tCommittees\tInvent,\tpublished\tin\tDatamation\tmagazine in\tApril\t1968,\tobserved\tthat:\n\nAny\torganization\tthat\tdesigns\ta\tsystem\t(defined\tmore\tbroadly\there\tthan\tjust information\tsystems)\twill\tinevitably\tproduce\ta\tdesign\twhose\tstructure\tis\ta\tcopy\tof\tthe organization’s\tcommunication\tstructure.\n\nThis\tstatement\tis\toften\tquoted,\tin\tvarious\tforms,\tas\tConway’s\tlaw.\tEric\tS.\tRaymond summarized\tthis\tphenomenon\tin\tThe\tNew\tHacker’s\tDictionary\t(MIT\tPress)\tby\tstating\t“If you\thave\tfour\tgroups\tworking\ton\ta\tcompiler,\tyou’ll\tget\ta\t4-pass\tcompiler.”\n\nEvidence\n\nThe\tstory\tgoes\tthat\twhen\tMelvin\tConway\tsubmitted\this\tpaper\ton\tthis\ttopic\tto\tthe\tHarvard Business\tReview,\tthey\trejected\tit,\tclaiming\the\thadn’t\tproved\this\tthesis.\tI’ve\tseen\tthis theory\tborne\tout\tin\tso\tmany\tdifferent\tsituations\tthat\tI’ve\taccepted\tit\tas\ttrue.\tBut\tyou\tdon’t have\tto\ttake\tmy\tword\tfor\tit:\tsince\tConway’s\toriginal\tsubmission,\ta\tlot\tof\twork\thas\tbeen done\tin\tthis\tarea.\tA\tnumber\tof\tstudies\thave\tbeen\tcarried\tout\tto\texplore\tthe\tinterrelation\tof organizational\tstructure\tand\tthe\tsystems\tthey\tcreate.",
      "page_number": 286
    },
    {
      "number": 10,
      "title": "Conway’s\tLaw\tand\tSystem Design",
      "start_page": 323,
      "end_page": 346,
      "detection_method": "regex_chapter_title",
      "content": "Loose\tand\tTightly\tCoupled\tOrganizations\n\nIn\tExploring\tthe\tDuality\tBetween\tProduct\tand\tOrganizational\tArchitectures\t(Harvard Business\tSchool),\tthe\tauthors\tAlan\tMacCormack,\tJohn\tRusnak,\tand\tCarliss\tBaldwin\tlook at\ta\tnumber\tof\tdifferent\tsoftware\tsystems,\tloosely\tcategorized\tas\tbeing\tcreated\teither\tby loosely\tcoupled\torganizations\tor\ttightly\tcoupled\torganizations.\tFor\ttightly\tcoupled organizations,\tthink\tcommercial\tproduct\tfirms\tthat\tare\ttypically\tcolocated\twith\tstrongly aligned\tvisions\tand\tgoals,\twhile\tloosely\tcoupled\torganizations\tare\twell\trepresented\tby distributed\topen\tsource\tcommunities.\n\nIn\ttheir\tstudy,\tin\twhich\tthey\tmatched\tsimilar\tproduct\tpairs\tfrom\teach\ttype\tof\torganization, the\tauthors\tfound\tthat\tthe\tmore\tloosely\tcoupled\torganizations\tactually\tcreated\tmore modular,\tless\tcoupled\tsystems,\twhereas\tthe\tmore\ttightly\tfocused\torganization’s\tsoftware was\tless\tmodularized.\n\nWindows\tVista\n\nMicrosoft\tcarried\tout\tan\tempirical\tstudy\twhere\tit\tlooked\tat\thow\tits\town\torganizational structure\timpacted\tthe\tsoftware\tquality\tof\ta\tspecific\tproduct,\tWindows\tVista.\tSpecifically, the\tresearchers\tlooked\tat\tmultiple\tfactors\tto\tdetermine\thow\terror-prone\ta\tcomponent\tin the\tsystem\twould\tbe.4\tAfter\tlooking\tat\tmultiple\tmetrics,\tincluding\tcommonly\tused software\tquality\tmetrics\tlike\tcode\tcomplexity,\tthey\tfound\tthat\tthe\tmetrics\tassociated\twith organizational\tstructures\tproved\tto\tbe\tthe\tmost\tstatistically\trelevant\tmeasures.\n\nSo\there\twe\thave\tanother\texample\tof\tthe\torganizational\tstructure\timpacting\tthe\tnature\tof the\tsystem\tthat\torganization\tcreates.\n\nNetflix\tand\tAmazon\n\nProbably\tthe\ttwo\tposter\tchildren\tfor\tthe\tidea\tthat\torganizations\tand\tarchitecture\tshould\tbe aligned\tare\tAmazon\tand\tNetflix.\tEarly\ton,\tAmazon\tstarted\tto\tunderstand\tthe\tbenefits\tof teams\towning\tthe\twhole\tlifecycle\tof\tthe\tsystems\tthey\tmanaged.\tIt\twanted\tteams\tto\town and\toperate\tthe\tsystems\tthey\tlooked\tafter,\tmanaging\tthe\tentire\tlifecycle.\tBut\tAmazon\talso knew\tthat\tsmall\tteams\tcan\twork\tfaster\tthan\tlarge\tteams.\tThis\tled\tfamously\tto\tits\ttwo-pizza teams,\twhere\tno\tteam\tshould\tbe\tso\tbig\tthat\tit\tcould\tnot\tbe\tfed\twith\ttwo\tpizzas.\tThis\tdriver for\tsmall\tteams\towning\tthe\twhole\tlifecycle\tof\ttheir\tservices\tis\ta\tmajor\treason\twhy Amazon\tdeveloped\tAmazon\tWeb\tServices.\tIt\tneeded\tto\tcreate\tthe\ttooling\tto\tallow\tits teams\tto\tbe\tself-sufficient.\n\nNetflix\tlearned\tfrom\tthis\texample,\tand\tensured\tthat\tfrom\tthe\tbeginning\tit\tstructured\titself around\tsmall,\tindependent\tteams,\tso\tthat\tthe\tservices\tthey\tcreated\twould\talso\tbe independent\tfrom\teach\tother.\tThis\tensured\tthat\tthe\tarchitecture\tof\tthe\tsystem\twas optimized\tfor\tspeed\tof\tchange.\tEffectively,\tNetflix\tdesigned\tthe\torganizational\tstructure for\tthe\tsystem\tarchitecture\tit\twanted.\n\nWhat\tCan\tWe\tDo\twith\tThis?\n\nSo\tevidence,\tanecdotal\tand\tempirical,\tpoints\tto\tour\torganizational\tstructure\tbeing\ta\tstrong influence\ton\tthe\tnature\t(and\tquality)\tof\tthe\tsystems\twe\tprovide.\tSo\thow\tdoes\tthis understanding\thelp\tus?\tLet’s\tlook\tat\ta\tfew\tdifferent\torganizational\tsituations\tand understand\twhat\timpact\teach\tmight\thave\ton\tour\tsystem\tdesign.\n\nAdapting\tto\tCommunication\tPathways\n\nLet’s\tfirst\tconsider\ta\tsimple,\tsingle\tteam.\tIt’s\tin\tcharge\tof\tall\taspects\tof\tthe\tsystem\tdesign and\timplementation.\tIt\tcan\thave\tfrequent,\tfine-grained\tcommunication.\tImagine\tthat\tthis team\tis\tin\tcharge\tof\ta\tsingle\tservice\t—\tsay,\tour\tmusic\tshop’s\tcatalog\tservice.\tNow consider\tthe\tinside\tof\ta\tservice:\tlots\tof\tfine-grained\tmethod\tor\tfunction\tcalls.\tAs\twe’ve discussed\tbefore,\twe\taim\tto\tensure\tour\tservices\tare\tdecomposed\tsuch\tthat\tthe\tpace\tof change\tinside\ta\tservice\tis\tmuch\thigher\tthan\tthe\tpace\tof\tchange\tbetween\tservices.\tThis single\tteam,\twith\tits\tability\tfor\tfine-grained\tcommunication,\tmatches\tnicely\twith\tthe communication\tpathways\tof\tthe\tcode\twithin\tthe\tservice.\n\nThis\tsingle\tteam\tfinds\tit\teasy\tto\tcommunicate\tabout\tproposed\tchanges\tand\trefactorings, and\ttypically\thas\ta\tgood\tsense\tof\townership.\n\nNow\tlet’s\timagine\ta\tdifferent\tscenario.\tInstead\tof\ta\tsingle,\tgeolocated\tteam\towning\tour catalog\tservice,\tsuppose\tthat\tteams\tin\tthe\tUK\tand\tIndia\tboth\tare\tactively\tinvolved\tin changing\ta\tservice\t—\teffectively\thaving\tjoint\townership\tof\tthe\tservice.\tGeographical\tand time\tzone\tboundaries\there\tmake\tfine-grained\tcommunication\tbetween\tthose\tteams difficult.\tInstead,\tthey\trely\ton\tmore\tcoarse-grained\tcommunication\tvia\tvideo\tconferencing and\temail.\tHow\teasy\tis\tit\tfor\ta\tteam\tmember\tin\tthe\tUK\tto\tmake\ta\tsimple\trefactoring\twith confidence?\tThe\tcost\tof\tcommunications\tin\ta\tgeographically\tdistributed\tteam\tis\thigher, and\ttherefore\tthe\tcost\tof\tcoordinating\tchanges\tis\thigher.\n\nWhen\tthe\tcost\tof\tcoordinating\tchange\tincreases,\tone\tof\ttwo\tthings\thappen.\tEither\tpeople find\tways\tto\treduce\tthe\tcoordination/communication\tcosts,\tor\tthey\tstop\tmaking\tchanges. The\tlatter\tis\texactly\thow\twe\tend\tup\twith\tlarge,\thard-to-maintain\tcodebases.\n\nI\trecall\tone\tclient\tproject\tI\tworked\ton\twhere\townership\tof\ta\tsingle\tservice\twas\tshared between\ttwo\tgeographical\tlocations.\tEventually,\teach\tsite\tstarted\tspecializing\twhat\twork\tit handled.\tThis\tallowed\tit\tto\ttake\townership\tof\tpart\tof\tthe\tcodebase,\twithin\twhich\tit\tcould have\tan\teasier\tcost\tof\tchange.\tThe\tteams\tthen\thad\tmore\tcoarse-grained\tcommunication about\thow\tthe\ttwo\tparts\tinterrelated;\teffectively,\tthe\tcommunication\tpathways\tmade possible\twithin\tthe\torganizational\tstructure\tmatched\tthe\tcoarse-grained\tAPI\tthat\tformed the\tboundary\tbetween\tthe\ttwo\thalves\tof\tthe\tcodebase.\n\nSo\twhere\tdoes\tthis\tleave\tus\twhen\tconsidering\tevolving\tour\town\tservice\tdesign?\tWell,\tI would\tsuggest\tthat\tgeographical\tboundaries\tbetween\tpeople\tinvolved\twith\tthe development\tof\ta\tsystem\tcan\tbe\ta\tgreat\tway\tto\tdrive\twhen\tservices\tshould\tbe decomposed,\tand\tthat\tin\tgeneral,\tyou\tshould\tlook\tto\tassign\townership\tof\ta\tservice\tto\ta single,\tcolocated\tteam\twho\tcan\tkeep\tthe\tcost\tof\tchange\tlow.\n\nPerhaps\tyour\torganization\tdecides\tthat\tit\twants\tto\tincrease\tthe\tnumber\tof\tpeople\tworking on\tyour\tproject\tby\topening\tup\tan\toffice\tin\tanother\tcountry.\tAt\tthis\tpoint,\tthink\tactively about\twhat\tparts\tof\tyour\tsystem\tcan\tbe\tmoved\tover.\tPerhaps\tthis\tis\twhat\tdrives\tyour decisions\tabout\twhat\tseams\tto\tsplit\tout\tnext.\n\nIt\tis\talso\tworth\tnoting\tat\tthis\tpoint\tthat,\tat\tleast\tbased\ton\tthe\tobservations\tof\tthe\tauthors\tof the\tExploring\tthe\tDuality\tBetween\tProduct\tand\tOrganizational\tArchitectures\treport previously\treferenced,\tif\tthe\torganization\tbuilding\tthe\tsystem\tis\tmore\tloosely\tcoupled (e.g.,\tconsisting\tof\tgeographically\tdistributed\tteams),\tthe\tsystems\tbeing\tbuilt\ttend\ttoward the\tmore\tmodular,\tand\ttherefore\thopefully\tless\tcoupled.\tThe\ttendency\tof\ta\tsingle\tteam that\towns\tmany\tservices\tto\tlean\ttoward\ttighter\tintegration\tis\tvery\thard\tto\tmaintain\tin\ta more\tdistributed\torganization.\n\nService\tOwnership\n\nWhat\tdo\tI\tmean\tby\tservice\townership?\tIn\tgeneral,\tit\tmeans\tthat\tthe\tteam\towning\ta\tservice is\tresponsible\tfor\tmaking\tchanges\tto\tthat\tservice.\tThe\tteam\tshould\tfeel\tfree\tto\trestructure the\tcode\thowever\tit\twants,\tas\tlong\tas\tthat\tchange\tdoesn’t\tbreak\tconsuming\tservices.\tFor many\tteams,\townership\textends\tto\tall\taspects\tof\tthe\tservice,\tfrom\tsourcing\trequirements to\tbuilding,\tdeploying,\tand\tmaintaining\tthe\tapplication.\tThis\tmodel\tis\tespecially\tprevalent with\tmicroservices,\twhere\tit\tis\teasier\tfor\ta\tsmall\tteam\tto\town\ta\tsmall\tservice.\tThis increased\tlevel\tof\townership\tleads\tto\tincreased\tautonomy\tand\tspeed\tof\tdelivery.\tHaving one\tteam\tresponsible\tfor\tdeploying\tand\tmaintaining\tthe\tapplication\tmeans\tit\thas\tan incentive\tto\tcreate\tservices\tthat\tare\teasy\tto\tdeploy;\tthat\tis,\tconcerns\tabout\t“throwing something\tover\tthe\twall”\tdissipate\twhen\tthere\tis\tno\tone\tto\tthrow\tit\tto!\n\nThis\tmodel\tis\tcertainly\tone\tI\tfavor.\tIt\tpushes\tthe\tdecisions\tto\tthe\tpeople\tbest\table\tto\tmake them,\tgiving\tthe\tteam\tboth\tincreased\tpower\tand\tautonomy,\tbut\talso\tmaking\tit\taccountable for\tits\twork.\tI’ve\tseen\tfar\ttoo\tmany\tdevelopers\thand\ttheir\tsystem\tover\tfor\ttesting\tor deployment\tphases\tand\tthink\tthat\ttheir\twork\tis\tdone\tat\tthat\tpoint.\n\nDrivers\tfor\tShared\tServices\n\nI\thave\tseen\tmany\tteams\tadopt\ta\tmodel\tof\tshared\tservice\townership.\tI\tfind\tthis\tapproach suboptimal,\tfor\treasons\talready\tdiscussed.\tHowever,\tthe\tdrivers\tthat\tcause\tpeople\tto\tpick shared\tservices\tare\timportant\tto\tunderstand,\tespecially\tas\twe\tmay\tbe\table\tto\tfind\tsome compelling\talternative\tmodels\tthat\tcan\taddress\tpeople’s\tunderlying\tconcerns.\n\nToo\tHard\tto\tSplit\n\nObviously,\tone\tof\tthe\treasons\tyou\tmay\tfind\tyourself\twith\ta\tsingle\tservice\towned\tby\tmore than\tone\tteam\tis\tthat\tthe\tcost\tof\tsplitting\tthe\tservice\tis\ttoo\thigh,\tor\tperhaps\tyour organization\tmight\tnot\tsee\tthe\tpoint\tof\tit.\tThis\tis\ta\tcommon\toccurrence\twith\tlarge monolithic\tsystems.\tIf\tthis\tis\tthe\tmain\tchallenge\tyou\tface,\tthen\tI\thope\tsome\tof\tthe\tadvice given\tin\tChapter\t5\twill\tbe\tof\tuse.\tYou\tcould\talso\tconsider\tmerging\tteams\ttogether,\tto\talign more\tclosely\twith\tthe\tarchitecture\titself.\n\nFeature\tTeams\n\nThe\tidea\tof\tfeature\tteams\t(aka\tfeature-based\tteams)\tis\tthat\ta\tsmall\tteam\tdrives\tthe development\tof\ta\tset\tof\tfeatures,\timplementing\tall\tfunctionality\trequired\teven\tif\tit\tcuts across\tcomponent\t(or\teven\tservice)\tboundaries.\tThe\tgoals\tof\tfeature\tteams\tare\tsensible enough.\tThis\tstructure\tallows\tthe\tteam\tto\tretain\ta\tfocus\ton\tthe\tend\tresult\tand\tensures\tthat the\twork\tis\tjoined\tup,\tavoiding\tsome\tof\tthe\tchallenges\tof\ttrying\tto\tcoordinate\tchanges across\tmultiple\tdifferent\tteams.\n\nIn\tmany\tsituations,\tthe\tfeature\tteam\tis\ta\treaction\tto\ttraditional\tIT\torganizations\twhere team\tstructure\tis\taligned\taround\ttechnical\tboundaries.\tFor\texample,\tyou\tmight\thave\ta team\tthat\tis\tresponsible\tfor\tthe\tUI,\tanother\tthat\tis\tresponsible\tfor\tthe\tapplication\tlogic,\tand a\tthird\thandling\tthe\tdatabase.\tIn\tthis\tenvironment,\ta\tfeature\tteam\tis\ta\tsignificant\tstep\tup, as\tit\tworks\tacross\tall\tthese\tlayers\tto\tdeliver\tthe\tfunctionality.\n\nWith\twholesale\tadoption\tof\tfeature\tteams,\tall\tservices\tcan\tbe\tconsidered\tshared.\tEveryone can\tchange\tevery\tservice,\tevery\tpiece\tof\tcode.\tThe\trole\tof\tthe\tservice\tcustodians\there becomes\tmuch\tmore\tcomplex,\tif\tthe\trole\texists\tat\tall.\tUnfortunately,\tI\trarely\tsee functioning\tcustodians\tat\tall\twhere\tthis\tpattern\tis\tadopted,\tleading\tto\tthe\tsorts\tof\tissues\twe discussed\tearlier.\n\nBut\tlet’s\tagain\tconsider\twhat\tmicroservices\tare:\tservices\tmodeled\tafter\ta\tbusiness\tdomain, not\ta\ttechnical\tone.\tAnd\tif\tour\tteam\tthat\towns\tany\tgiven\tservice\tis\tsimilarly\taligned\talong the\tbusiness\tdomain,\tit\tis\tmuch\tmore\tlikely\tthat\tthe\tteam\twill\tbe\table\tto\tretain\ta\tcustomer focus,\tand\tsee\tmore\tof\tthe\tfeature\tdevelopment\tthrough,\tbecause\tit\thas\ta\tholistic understanding\tand\townership\tof\tall\tthe\ttechnology\tassociated\twith\ta\tservice.\n\nCross-cutting\tchanges\tcan\toccur,\tof\tcourse,\tbut\ttheir\tlikelihood\tis\tsignificantly\treduced\tby our\tavoiding\ttechnology-oriented\tteams.\n\nDelivery\tBottlenecks\n\nOne\tkey\treason\tpeople\tmove\ttoward\tshared\tservices\tis\tto\tavoid\tdelivery\tbottlenecks. What\tif\tthere\tis\ta\tlarge\tbacklog\tof\tchanges\tthat\tneed\tto\tbe\tmade\tin\ta\tsingle\tservice?\tLet’s imagine\tthat\twe\tare\trolling\tout\tthe\tability\tfor\ta\tcustomer\tto\tsee\tthe\tgenre\tof\ta\ttrack\tacross our\tproducts,\tas\twell\tas\tadding\ta\ta\tbrand\tnew\ttype\tof\tstock:\tvirtual\tmusical\tringtones\tfor the\tmobile\tphone.\tThe\twebsite\tteam\tneeds\tto\tmake\ta\tchange\tto\tsurface\tthe\tgenre information,\twith\tthe\tmobile\tapp\tteam\tworking\tto\tallow\tusers\tto\tbrowse,\tpreview,\tand\tbuy the\tringtones.\tBoth\tchanges\tneed\tto\tbe\tmade\tto\tthe\tcatalog\tservice,\tbut\tunfortunately\thalf the\tteam\tis\tout\twith\tthe\tflu,\tand\tthe\tother\thalf\tis\tstuck\tdiagnosing\ta\tproduction\tfailure.\n\nWe\thave\ta\tcouple\tof\toptions\tthat\tdon’t\tinvolve\tshared\tservices\tto\tavoid\tthis\tsituation.\tThe first\tis\tto\tjust\twait.\tThe\twebsite\tand\tmobile\tapplication\tteams\tmove\ton\tto\tsomething\telse. Depending\ton\thow\timportant\tthe\tfeature\tis,\tor\thow\tlong\tthe\tdelay\tis\tlikely\tto\tbe,\tthis\tmay be\tfine\tor\tit\tmay\tbe\ta\tmajor\tproblem.\n\nYou\tcould\tinstead\tadd\tpeople\tto\tthe\tcatalog\tteam\tto\thelp\tthem\tmove\tthrough\ttheir\twork faster.\tThe\tmore\tstandardized\tthe\ttechnology\tstack\tand\tprogramming\tidioms\tin\tuse\tacross your\tsystem,\tthe\teasier\tit\tis\tfor\tother\tpeople\tto\tmake\tchanges\tin\tyour\tservices.\tThe flipside,\tof\tcourse,\tas\twe\tdiscussed\tearlier,\tis\tthat\tstandardization\ttends\tto\treduce\ta\tteam’s ability\tto\tadopt\tthe\tright\tsolution\tfor\tthe\tjob,\tand\tcan\tlead\tto\tdifferent\tsorts\tof inefficiencies.\tIf\tthe\tteam\tis\ton\tthe\tother\tside\tof\tthe\tplanet,\tthis\tmight\tbe\timpossible, however.\n\nAnother\toption\tcould\tbe\tto\tsplit\tthe\tcatalog\tinto\ta\tseparate\tgeneral\tmusic\tcatalog\tand\ta ringtone\tcatalog.\tIf\tthe\tchange\tbeing\tmade\tto\tsupport\tringtones\tis\tfairly\tsmall,\tand\tthe likelihood\tof\tthis\tbeing\tan\tarea\tin\twhich\twe\twill\tdevelop\theavily\tin\tthe\tfuture\tis\talso\tquite low,\tthis\tmay\twell\tbe\tpremature.\tOn\tthe\tother\thand,\tif\tthere\tare\t10\tweeks\tof\tringtone- related\tfeatures\tstacked\tup,\tsplitting\tout\tthe\tservice\tcould\tmake\tsense,\twith\tthe\tmobile team\ttaking\townership.\n\nThere\tis\tanother\tmodel\tthat\tcould\twork\twell\tfor\tus,\tthough.\n\nInternal\tOpen\tSource\n\nSo\twhat\tif\twe’ve\ttried\tour\thardest,\tbut\twe\tjust\tcan’t\tfind\ta\tway\tpast\thaving\ta\tfew\tshared services?\tAt\tthis\tpoint,\tproperly\tembracing\tthe\tinternal\topen\tsource\tmodel\tcan\tmake\ta\tlot of\tsense.\n\nWith\tnormal\topen\tsource,\ta\tsmall\tgroup\tof\tpeople\tare\tconsidered\tcore\tcommitters.\tThey are\tthe\tcustodians\tof\tthe\tcode.\tIf\tyou\twant\ta\tchange\tto\tan\topen\tsource\tproject,\tyou\teither ask\tone\tof\tthe\tcommitters\tto\tmake\tthe\tchange\tfor\tyou,\tor\telse\tyou\tmake\tthe\tchange yourself\tand\tsend\tthem\ta\tpull\trequest.\tThe\tcore\tcommitters\tare\tstill\tin\tcharge\tof\tthe codebase;\tthey\tare\tthe\towners.\n\nInside\tthe\torganization,\tthis\tpattern\tcan\twork\twell\ttoo.\tPerhaps\tthe\tpeople\twho\tworked\ton the\tservice\toriginally\tare\tno\tlonger\ton\ta\tteam\ttogether;\tperhaps\tthey\tare\tnow\tscattered across\tthe\torganization.\tWell,\tif\tthey\tstill\thave\tcommit\trights,\tyou\tcan\tfind\tthem\tand\task for\ttheir\thelp,\tperhaps\tpairing\tup\twith\tthem,\tor\tif\tyou\thave\tthe\tright\ttooling\tyou\tcan\tsend them\ta\tpull\trequest.\n\nRole\tof\tthe\tCustodians\n\nWe\tstill\twant\tour\tservices\tto\tbe\tsensible.\tWe\twant\tthe\tcode\tto\tbe\tof\tdecent\tquality,\tand\tthe service\titself\tto\texhibit\tsome\tsort\tof\tconsistency\tin\thow\tit\tis\tput\ttogether.\tWe\talso\twant\tto make\tsure\tthat\tchanges\tbeing\tmade\tnow\tdon’t\tmake\tfuture\tplanned\tchanges\tmuch\tharder than\tthey\tneed\tto\tbe.\tThis\tmeans\tthat\twe\tneed\tto\tadopt\tthe\tsame\tpatterns\tused\tin\tnormal open\tsource\tinternally\ttoo,\twhich\tmeans\tseparating\tout\ta\tgroup\tof\ttrusted\tcommitters\t(the core\tteam),\tand\tuntrusted\tcommitters\t(people\tfrom\toutside\tthe\tteam\tsubmitting\tchanges).\n\nThe\tcore\tteam\tneeds\tto\thave\tsome\tway\tof\tvetting\tand\tapproving\tthe\tchanges.\tIt\tneeds\tto make\tsure\tthe\tchanges\tare\tidiomatically\tconsistent\t—\tthat\tis,\tthat\tthey\tfollow\tthe\tgeneral coding\tguidelines\tof\tthe\trest\tof\tthe\tcodebase.\tThe\tpeople\tdoing\tthe\tvetting\tare\ttherefore going\tto\thave\tto\tspend\ttime\tworking\twith\tthe\tsubmitters\tto\tmake\tsure\tthe\tchange\tis\tof sufficient\tquality.\n\nGood\tgatekeepers\tput\ta\tlot\tof\twork\tinto\tthis,\tcommunicating\tclearly\twith\tthe\tsubmitters and\tencouraging\tgood\tbehavior.\tBad\tgatekeepers\tcan\tuse\tthis\tas\tan\texcuse\tto\texert\tpower over\tothers\tor\thave\treligious\twars\tabout\tarbitrary\ttechnical\tdecisions.\tHaving\tseen\tboth sets\tof\tbehavior,\tI\tcan\ttell\tyou\tone\tthing\tis\tclear:\teither\tway\tit\ttakes\ttime.\tWhen considering\tallowing\tuntrusted\tcommitters\tto\tsubmit\tchanges\tto\tyour\tcodebase,\tyou\thave to\tdecide\tif\tthe\toverhead\tof\tbeing\ta\tgatekeeper\tis\tworth\tthe\ttrouble:\tcould\tthe\tcore\tteam\tbe doing\tbetter\tthings\twith\tthe\ttime\tit\tspends\tvetting\tpatches?\n\nMaturity\n\nThe\tless\tstable\tor\tmature\ta\tservice\tis,\tthe\tharder\tit\twill\tbe\tto\tallow\tpeople\toutside\tthe\tcore team\tto\tsubmit\tpatches.\tBefore\tthe\tkey\tspine\tof\ta\tservice\tis\tin\tplace,\tthe\tteam\tmay\tnot know\twhat\tgood\tlooks\tlike,\tand\ttherefore\tmay\tstruggle\tto\tknow\twhat\ta\tgood\tsubmission looks\tlike.\tDuring\tthis\tstage,\tthe\tservice\titself\tis\tundergoing\ta\thigh\tdegree\tof\tchange.\n\nMost\topen\tsource\tprojects\ttend\tto\tnot\ttake\tsubmissions\tfrom\ta\twider\tgroup\tof\tuntrusted committers\tuntil\tthe\tcore\tof\tthe\tfirst\tversion\tis\tdone.\tFollowing\ta\tsimilar\tmodel\tfor\tyour own\torganizations\tmakes\tsense.\tIf\ta\tservice\tis\tpretty\tmature,\tand\tis\trarely\tchanged\t—\tfor example,\tour\tcart\tservice\t—\tthen\tperhaps\tthat\tis\tthe\ttime\tto\topen\tit\tup\tfor\tother contributions.\n\nTooling\n\nTo\tbest\tsupport\tan\tinternal\topen\tsource\tmodel,\tyou’ll\tneed\tsome\ttooling\tin\tplace.\tThe\tuse of\ta\tdistributed\tversion\tcontrol\ttool\twith\tthe\tability\tfor\tpeople\tto\tsubmit\tpull\trequests\t(or something\tsimilar)\tis\timportant.\tDepending\ton\tthe\tsize\tof\tthe\torganization,\tyou\tmay\talso need\ttooling\tto\tallow\tfor\ta\tdiscussion\tand\tevolution\tof\tpatch\trequests;\tthis\tmay\tor\tmay\tnot mean\ta\tfull-blown\tcode\treview\tsystem,\tbut\tthe\tability\tto\tcomment\tinline\ton\tpatches\tis very\tuseful.\tFinally,\tyou’ll\tneed\tto\tmake\tit\tvery\teasy\tfor\ta\tcommitter\tto\tbuild\tand\tdeploy your\tsoftware,\tand\tmake\tit\tavailable\tfor\tothers.\tTypically\tthis\tinvolves\thaving\twell- defined\tbuild\tand\tdeployment\tpipelines\tand\tcentralized\tartifact\trepositories.\n\nBounded\tContexts\tand\tTeam\tStructures\n\nAs\tmentioned\tbefore,\twe\tlook\tto\tdraw\tour\tservice\tboundaries\taround\tbounded\tcontexts.\tIt therefore\tfollows\tthat\twe\twould\tlike\tour\tteams\taligned\talong\tbounded\tcontexts\ttoo.\tThis has\tmultiple\tbenefits.\tFirst,\ta\tteam\twill\tfind\tit\teasier\tto\tgrasp\tdomain\tconcepts\twithin\ta bounded\tcontext,\tas\tthey\tare\tinterrelated.\tSecond,\tservices\twithin\ta\tbounded\tcontext\tare more\tlikely\tto\tbe\tservices\tthat\ttalk\tto\teach\tother,\tmaking\tsystem\tdesign\tand\trelease coordination\teasier.\tFinally,\tin\tterms\tof\thow\tthe\tdelivery\tteam\tinteracts\twith\tthe\tbusiness stakeholders,\tit\tbecomes\teasier\tfor\tthe\tteam\tto\tcreate\tgood\trelationships\twith\tthe\tone\tor two\texperts\tin\tthat\tarea.\n\nThe\tOrphaned\tService?\n\nSo\twhat\tabout\tservices\tthat\tare\tno\tlonger\tbeing\tactively\tmaintained?\tAs\twe\tmove\ttoward finer-grained\tarchitectures,\tthe\tservices\tthemselves\tbecome\tsmaller.\tOne\tof\tthe\tgoals\tof smaller\tservices,\tas\twe\thave\tdiscussed,\tis\tthe\tfact\tthat\tthey\tare\tsimpler.\tSimpler\tservices with\tless\tfunctionality\tmay\tnot\tneed\tto\tchange\tfor\ta\twhile.\tConsider\tthe\thumble\tcart service,\twhich\tprovides\tsome\tfairly\tmodest\tcapabilities:\tAdd\tto\tCart,\tRemove\tfrom\tCart, and\tso\ton.\tIt\tis\tquite\tconceivable\tthat\tthis\tservice\tmay\tnot\thave\tto\tchange\tfor\tmonths\tafter first\tbeing\twritten,\teven\tif\tactive\tdevelopment\tis\tstill\tgoing\ton.\tWhat\thappens\there?\tWho owns\tthis\tservice?\n\nIf\tyour\tteam\tstructures\tare\taligned\talong\tthe\tbounded\tcontexts\tof\tyour\torganization,\tthen even\tservices\tthat\tare\tnot\tchanged\tfrequently\tstill\thave\ta\tde\tfacto\towner.\tImagine\ta\tteam that\tis\taligned\twith\tthe\tconsumer\tweb\tsales\tcontext.\tIt\tmight\thandle\tthe\twebsite,\tcart,\tand recommendation\tservices.\tEven\tif\tthe\tcart\tservice\thasn’t\tbeen\tchanged\tin\tmonths,\tit\twould naturally\tfall\tto\tthis\tteam\tto\tmake\tthe\tchange.\tOne\tof\tthe\tbenefits\tof\tmicroservices,\tof course,\tis\tthat\tif\tthe\tteam\tneeds\tto\tchange\tthe\tservice\tto\tadd\ta\tnew\tfeature\tand\tnot\tfind\tit to\tits\tliking,\trewriting\tit\tshouldn’t\ttake\ttoo\tlong\tat\tall.\n\nThat\tsaid,\tif\tyou’ve\tadopted\ta\ttruly\tpolyglot\tapproach,\tmaking\tuse\tof\tmultiple\ttechnology stacks,\tthen\tthe\tchallenges\tof\tmaking\tchanges\tto\tan\torphaned\tservice\tcould\tbe compounded\tif\tyour\tteam\tdoesn’t\tknow\tthe\ttech\tstack\tany\tlonger.\n\nCase\tStudy:\tRealEstate.com.au\n\nREA’s\tcore\tbusiness\tis\treal\testate.\tBut\tthis\tencompasses\tmultiple\tdifferent\tfacets,\teach\tof which\toperates\tas\ta\tsingle\tline\tof\tbusiness\t(LOB).\tFor\texample,\tone\tline\tof\tbusiness\tdeals with\tresidential\tproperty\tin\tAustralia,\tanother\tcommercial,\twhile\tanother\tmight\trelate\tto one\tof\tREA’s\toverseas\tbusinesses.\tThese\tlines\tof\tbusiness\thave\tIT\tdelivery\tteams\t(or squads)\tassociated\twith\tthem;\tsome\tmay\thave\tonly\ta\tsingle\tsquad,\twhile\tthe\tbiggest\thas four.\tSo\tfor\tresidential\tproperty,\tthere\tare\tmultiple\tteams\tinvolved\twith\tcreating\tthe website\tand\tlisting\tservices\tto\tallow\tpeople\tto\tbrowse\tproperty.\tPeople\trotate\tbetween these\tteams\tevery\tnow\tand\tthen,\tbut\ttend\tto\tstay\twithin\tthat\tline\tof\tbusiness\tfor\textended periods,\tensuring\tthat\tthe\tteam\tmembers\tcan\tbuild\tup\ta\tstrong\tawareness\tof\tthat\tpart\tof the\tdomain.\tThis\tin\tturn\thelps\tthe\tcommunication\tbetween\tthe\tvarious\tbusiness stakeholders\tand\tthe\tteam\tdelivering\tfeatures\tfor\tthem.\n\nEach\tsquad\tinside\ta\tline\tof\tbusiness\tis\texpected\tto\town\tthe\tentire\tlifecycle\tof\tthe\tservices it\tcreates,\tincluding\tbuilding,\ttesting\tand\treleasing,\tsupporting,\tand\teven decommissioning.\tA\tcore\tdelivery\tservices\tteam\tprovides\tadvice\tand\tguidance\tto\tthese teams,\tas\twell\tas\ttooling\tto\thelp\tit\tget\tthe\tjob\tdone.\tA\tstrong\tculture\tof\tautomation\tis\tkey, and\tREA\tmakes\theavy\tuse\tof\tAWS\tas\ta\tkey\tpart\tof\tenabling\tthe\tteams\tto\tbe\tmore autonomous.\tFigure\t10-1\tillustrates\thow\tthis\tall\tworks.\n\nFigure\t10-1.\tAn\toverview\tof\tRealestate.com.au’s\torganizational\tand\tteam\tstructure,\tand\talignment\twith\tarchitecture\n\nIt\tisn’t\tjust\tthe\tdelivery\torganization\tthat\tis\taligned\tto\thow\tthe\tbusiness\toperates.\tIt extends\tto\tthe\tarchitecture\ttoo.\tOne\texample\tof\tthis\tis\tintegration\tmethods.\tWithin\tan LOB,\tall\tservices\tare\tfree\tto\ttalk\tto\teach\tother\tin\tany\tway\tthey\tsee\tfit,\tas\tdecided\tby\tthe squads\twho\tact\tas\ttheir\tcustodians.\tBut\tbetween\tLOBs,\tall\tcommunication\tis\tmandated\tto\n\nbe\tasynchronous\tbatch,\tone\tof\tthe\tfew\tcast-iron\trules\tof\tthe\tvery\tsmall\tarchitecture\tteam. This\tcoarse-grained\tcommunication\tmatches\tthe\tcoarse-grained\tcommunication\tthat\texists between\tthe\tdifferent\tparts\tof\tthe\tbusiness\ttoo.\tBy\tinsisting\ton\tit\tbeing\tbatch,\teach\tLOB has\ta\tlot\tof\tfreedom\tin\thow\tit\tacts\tand\tmanages\titself.\tIt\tcould\tafford\tto\ttake\tits\tservices down\twhenever\tit\twanted,\tknowing\tthat\tas\tlong\tas\tit\tcan\tsatisfy\tthe\tbatch\tintegration\twith other\tparts\tof\tthe\tbusiness\tand\tits\town\tbusiness\tstakeholders,\tno\tone\twould\tcare.\n\nThis\tstructure\thas\tallowed\tfor\tsignificant\tautonomy\tof\tnot\tonly\tthe\tteams\tbut\talso\tthe different\tparts\tof\tthe\tbusiness.\tFrom\ta\thandful\tof\tservices\ta\tfew\tyears\tago,\tREA\tnow\thas hundreds,\twith\tmore\tservices\tthan\tpeople,\tand\tis\tgrowing\tat\ta\trapid\tpace.\tThe\tability\tto deliver\tchange\thas\thelped\tthe\tcompany\tachieve\tsignificant\tsuccess\tin\tthe\tlocal\tmarket\tto the\tpoint\twhere\tit\tis\texpanding\toverseas.\tAnd,\tmost\theartening\tof\tall,\tfrom\ttalking\tto\tthe people\tthere\tI\tget\tthe\timpression\tthat\tboth\tthe\tarchitecture\tand\torganizational\tstructure\tas they\tstand\tnow\tare\tjust\tthe\tlatest\titeration\trather\tthan\tthe\tdestination.\tI\tdaresay\tin\tanother five\tyears\tREA\twill\tlook\tvery\tdifferent\tagain.\n\nThose\torganizations\tthat\tare\tadaptive\tenough\tto\tchange\tnot\tonly\ttheir\tsystem\tarchitecture but\talso\ttheir\torganizational\tstructure\tcan\tyield\thuge\tbenefits\tin\tterms\tof\timproved autonomy\tof\tteams\tand\tfaster\ttime\tto\tmarket\tfor\tnew\tfeatures\tand\tfunctionality.\tREA\tis just\tone\tof\ta\tnumber\tof\torganizations\tthat\tare\trealizing\tthat\tsystem\tarchitecture\tdoesn’t exist\tin\ta\tvacuum.\n\nConway’s\tLaw\tin\tReverse\n\nSo\tfar,\twe’ve\tspoken\tabout\thow\tthe\torganization\timpacts\tthe\tsystem\tdesign.\tBut\twhat about\tthe\treverse?\tNamely,\tcan\ta\tsystem\tdesign\tchange\tthe\torganization?\tWhile\tI\thaven’t been\table\tto\tfind\tthe\tsame\tquality\tof\tevidence\tto\tsupport\tthe\tidea\tthat\tConway’s\tlaw works\tin\treverse,\tI’ve\tseen\tit\tanecdotally.\n\nProbably\tthe\tbest\texample\twas\ta\tclient\tI\tworked\twith\tmany\tyears\tago.\tBack\tin\tthe\tdays when\tthe\tWeb\twas\tfairly\tnascent,\tand\tthe\tInternet\twas\tseen\tas\tsomething\tthat\tarrived\ton an\tAOL\tfloppy\tdisk\tthrough\tthe\tdoor,\tthis\tcompany\twas\ta\tlarge\tprint\tfirm\tthat\thad\ta small,\tmodest\twebsite.\tIt\thad\ta\twebsite\tbecause\tit\twas\tthe\tthing\tto\tdo,\tbut\tin\tthe\tgrand scheme\tof\tthings\tit\twas\tfairly\tunimportant\tto\thow\tthe\tbusiness\toperated.\tWhen\tthe original\tsystem\twas\tcreated,\ta\tfairly\tarbitrary\ttechnical\tdecision\twas\tmade\tas\tto\thow\tthe system\twould\twork.\n\nThe\tcontent\tfor\tthis\tsystem\twas\tsourced\tin\tmultiple\tways,\tbut\tmost\tof\tit\tcame\tfrom\tthird parties\twho\twere\tplacing\tads\tfor\tviewing\tby\tthe\tgeneral\tpublic.\tThere\twas\tan\tinput\tsystem that\tallowed\tcontent\tto\tbe\tcreated\tby\tthe\tpaying\tthird\tparties,\ta\tcentral\tsystem\tthat\ttook that\tdata\tand\tenriched\tit\tin\tvarious\tways,\tand\tan\toutput\tsystem\tthat\tcreated\tthe\tfinal website\tthat\tthe\tgeneral\tpublic\tcould\tbrowse.\n\nWhether\tthe\toriginal\tdesign\tdecisions\twere\tright\tat\tthe\ttime\tis\ta\tconversation\tfor historians,\tbut\tmany\tyears\ton\tthe\tcompany\thad\tchanged\tquite\ta\tbit\tand\tI\tand\tmany\tof\tmy colleagues\twere\tstarting\tto\twonder\tif\tthe\tsystem\tdesign\twas\tfit\tfor\tthe\tcompany’s\tpresent state.\tIts\tphysical\tprint\tbusiness\thad\tdiminished\tsignificantly,\tand\tthe\trevenues\tand therefore\tbusiness\toperations\tof\tthe\torganization\twere\tnow\tdominated\tby\tits\tonline presence.\n\nWhat\twe\tsaw\tat\tthat\ttime\twas\tan\torganization\ttightly\taligned\tto\tthis\tthree-part\tsystem. Three\tchannels\tor\tdivisions\tin\tthe\tIT\tside\tof\tthe\tbusiness\taligned\twith\teach\tof\tthe\tinput, core,\tand\toutput\tparts\tof\tthe\tbusiness.\tWithin\tthose\tchannels,\tthere\twere\tseparate\tdelivery teams.\tWhat\tI\tdidn’t\trealize\tat\tthe\ttime\twas\tthat\tthese\torganizational\tstructures\tdidn’t predate\tthe\tsystem\tdesign,\tbut\tactually\tgrew\tup\taround\tit.\tAs\tthe\tprint\tside\tof\tthe\tbusiness diminished,\tand\tthe\tdigital\tside\tof\tthe\tbusiness\tgrew,\tthe\tsystem\tdesign\tinadvertently\tlay the\tpath\tfor\thow\tthe\torganization\tgrew.\n\nIn\tthe\tend\twe\trealized\tthat\twhatever\tthe\tshortcomings\tof\tthe\tsystem\tdesign\twere,\twe would\thave\tto\tmake\tchanges\tto\tthe\torganizational\tstructure\tto\tmake\ta\tshift.\tMany\tyears later,\tthat\tprocess\tremains\ta\twork\tin\tprogress!\n\nPeople\n\nNo\tmatter\thow\tit\tlooks\tat\tfirst,\tit’s\talways\ta\tpeople\tproblem.\n\nGerry\tWeinberg,\tThe\tSecond\tLaw\tof\tConsulting\n\nWe\thave\tto\taccept\tthat\tin\ta\tmicroservice\tenvironment,\tit\tis\tharder\tfor\ta\tdeveloper\tto\tjust think\tabout\twriting\tcode\tin\this\town\tlittle\tworld.\tHe\thas\tto\tbe\tmore\taware\tof\tthe implications\tof\tthings\tlike\tcalls\tacross\tnetwork\tboundaries,\tor\tthe\timplications\tof\tfailure. We’ve\talso\ttalked\tabout\tthe\tability\tof\tmicroservices\tto\tmake\tit\teasier\tto\ttry\tout\tnew technologies,\tfrom\tdata\tstores\tto\tlanguages.\tBut\tif\tyou’re\tmoving\tfrom\ta\tworld\twhere\tyou have\ta\tmonolithic\tsystem,\twhere\tthe\tmajority\tof\tyour\tdevelopers\thave\tjust\thad\tto\tuse\tone language\tand\tremain\tcompletely\toblivious\tto\tthe\toperational\tconcerns,\tthen\tthrowing them\tinto\tthe\tworld\tof\tmicroservices\tmay\tbe\ta\trude\tawakening\tfor\tthem.\n\nLikewise,\tpushing\tpower\tinto\tdevelopment\tteams\tto\tincrease\tautonomy\tcan\tbe\tfraught. People\twho\thave\tin\tthe\tpast\tthrown\twork\tover\tthe\twall\tto\tsomeone\telse\tare\taccustomed\tto having\tsomeone\telse\tto\tblame,\tand\tmay\tnot\tfeel\tcomfortable\tbeing\tfully\taccountable\tfor their\twork.\tYou\tmay\teven\tfind\tcontractual\tbarriers\tto\thaving\tyour\tdevelopers\tcarry support\tpagers\tfor\tthe\tsystems\tthey\tsupport!\n\nAlthough\tthis\tbook\thas\tmostly\tbeen\tabout\ttechnology,\tpeople\tare\tnot\tjust\ta\tside\tissue\tto be\tconsidered;\tthey\tare\tthe\tpeople\twho\tbuilt\twhat\tyou\thave\tnow,\tand\twill\tbuild\twhat happens\tnext.\tComing\tup\twith\ta\tvision\tfor\thow\tthings\tshould\tbe\tdone\twithout\tconsidering how\tyour\tcurrent\tstaff\twill\tfeel\tabout\tthis\tor\twithout\tconsidering\twhat\tcapabilities\tthey have\tis\tlikely\tto\tlead\tto\ta\tbad\tplace.\n\nEach\torganization\thas\tits\town\tset\tof\tdynamics\taround\tthis\ttopic.\tUnderstand\tyour\tstaff’s appetite\tto\tchange.\tDon’t\tpush\tthem\ttoo\tfast!\tMaybe\tyou\tstill\thave\ta\tseparate\tteam\thandle frontline\tsupport\tor\tdeployment\tfor\ta\tshort\tperiod\tof\ttime,\tgiving\tyour\tdevelopers\ttime\tto adjust\tto\tother\tnew\tpractices.\tYou\tmay,\thowever,\thave\tto\taccept\tthat\tyou\tneed\tdifferent sorts\tof\tpeople\tin\tyour\torganization\tto\tmake\tall\tthis\twork.\tWhatever\tyour\tapproach, understand\tthat\tyou\tneed\tto\tbe\tclear\tin\tarticulating\tthe\tresponsibilities\tof\tyour\tpeople\tin\ta microservices\tworld,\tand\talso\tbe\tclear\twhy\tthose\tresponsibilities\tare\timportant\tto\tyou. This\tcan\thelp\tyou\tsee\twhat\tyour\tskill\tgaps\tmight\tbe,\tand\tthink\tabout\thow\tto\tclose\tthem. For\tmany\tpeople,\tthis\twill\tbe\ta\tpretty\tscary\tjourney.\tJust\tremember\tthat\twithout\tpeople\ton board,\tany\tchange\tyou\tmight\twant\tto\tmake\tcould\tbe\tdoomed\tfrom\tthe\tstart.\n\nSummary\n\nConway’s\tlaw\thighlights\tthe\tperils\tof\ttrying\tto\tenforce\ta\tsystem\tdesign\tthat\tdoesn’t\tmatch the\torganization.\tThis\tleads\tus\tto\ttrying\tto\talign\tservice\townership\tto\tcolocated\tteams, which\tthemselves\tare\taligned\taround\tthe\tsame\tbounded\tcontexts\tof\tthe\torganization. When\tthe\ttwo\tare\tnot\tin\talignment,\twe\tget\ttension\tpoints\tas\toutlined\tthroughout\tthis chapter.\tBy\trecognizing\tthe\tlink\tbetween\tthe\ttwo,\twe’ll\tmake\tsure\tthe\tsystem\twe\tare trying\tto\tbuild\tmakes\tsense\tfor\tthe\torganization\twe’re\tbuilding\tit\tfor.\n\nSome\tof\twhat\twe\tcovered\there\ttouched\ton\tthe\tchallenges\tof\tworking\twith\torganizations\tat scale.\tHowever,\tthere\tare\tother\ttechnical\tconsiderations\tthat\twe\tneed\tto\tworry\tabout\twhen our\tsystems\tstart\tto\tgrow\tbeyond\ta\tfew\tdiscrete\tservices.\tWe’ll\taddress\tthose\tnext.\n\n4\tAnd\twe\tall\tknow\tWindows\tVista\twas\tquite\terror-prone!\n\nChapter\t11.\tMicroservices\tat\tScale\n\nWhen\tyou’re\tdealing\twith\tnice,\tsmall,\tbook-sized\texamples,\teverything\tseems\tsimple.\tBut the\treal\tworld\tis\ta\tmore\tcomplex\tspace.\tWhat\thappens\twhen\tour\tmicroservice architectures\tgrow\tfrom\tsimpler,\tmore\thumble\tbeginnings\tto\tsomething\tmore\tcomplex? What\thappens\twhen\twe\thave\tto\thandle\tfailure\tof\tmultiple\tseparate\tservices\tor\tmanage hundreds\tof\tservices?\tWhat\tare\tsome\tof\tthe\tcoping\tpatterns\twhen\tyou\thave\tmore microservices\tthan\tpeople?\tLet’s\tfind\tout.\n\nFailure\tIs\tEverywhere\n\nWe\tunderstand\tthat\tthings\tcan\tgo\twrong.\tHard\tdisks\tcan\tfail.\tOur\tsoftware\tcan\tcrash.\tAnd as\tanyone\twho\thas\tread\tthe\tfallacies\tof\tdistributed\tcomputing\tcan\ttell\tyou,\twe\tknow\tthat the\tnetwork\tis\tunreliable.\tWe\tcan\tdo\tour\tbest\tto\ttry\tto\tlimit\tthe\tcauses\tof\tfailure,\tbut\tat\ta certain\tscale,\tfailure\tbecomes\tinevitable.\tHard\tdrives,\tfor\texample,\tare\tmore\treliable\tnow than\tever\tbefore,\tbut\tthey’ll\tbreak\teventually.\tThe\tmore\thard\tdrives\tyou\thave,\tthe\thigher the\tlikelihood\tof\tfailure\tfor\tan\tindividual\tunit;\tfailure\tbecomes\ta\tstatistical\tcertainty\tat scale.\n\nEven\tfor\tthose\tof\tus\tnot\tthinking\tat\textreme\tscale,\tif\twe\tcan\tembrace\tthe\tpossibility\tof failure\twe\twill\tbe\tbetter\toff.\tFor\texample,\tif\twe\tcan\thandle\tthe\tfailure\tof\ta\tservice gracefully,\tthen\tit\tfollows\tthat\twe\tcan\talso\tdo\tin-place\tupgrades\tof\ta\tservice,\tas\ta\tplanned outage\tis\tmuch\teasier\tto\tdeal\twith\tthan\tan\tunplanned\tone.\n\nWe\tcan\talso\tspend\ta\tbit\tless\tof\tour\ttime\ttrying\tto\tstop\tthe\tinevitable,\tand\ta\tbit\tmore\tof\tour time\tdealing\twith\tit\tgracefully.\tI’m\tamazed\tat\thow\tmany\torganizations\tput\tprocesses\tand controls\tin\tplace\tto\ttry\tto\tstop\tfailure\tfrom\toccurring,\tbut\tput\tlittle\tto\tno\tthought\tinto actually\tmaking\tit\teasier\tto\trecover\tfrom\tfailure\tin\tthe\tfirst\tplace.\n\nBaking\tin\tthe\tassumption\tthat\teverything\tcan\tand\twill\tfail\tleads\tyou\tto\tthink\tdifferently about\thow\tyou\tsolve\tproblems.\n\nI\tsaw\tone\texample\tof\tthis\tthinking\twhile\tspending\tsome\ttime\ton\tthe\tGoogle\tcampus\tmany years\tago.\tIn\tthe\treception\tarea\tof\tone\tof\tthe\tbuildings\tin\tMountain\tView\twas\tan\told\track of\tmachines,\tthere\tas\ta\tsort\tof\texhibit.\tI\tnoticed\ta\tcouple\tof\tthings.\tFirst,\tthese\tservers weren’t\tin\tserver\tenclosures,\tthey\twere\tjust\tbare\tmotherboards\tslotted\tinto\tthe\track.\tThe main\tthing\tI\tnoticed,\tthough,\twas\tthat\tthe\thard\tdrives\twere\tattached\tby\tvelcro.\tI\tasked\tone of\tthe\tGooglers\twhy\tthat\twas.\t“Oh,”\the\tsaid,\t“the\thard\tdrives\tfail\tso\tmuch\twe\tdon’t\twant them\tscrewed\tin.\tWe\tjust\trip\tthem\tout,\tthrow\tthem\tin\tthe\tbin,\tand\tvelcro\tin\ta\tnew\tone.”\n\nSo\tlet\tme\trepeat:\tat\tscale,\teven\tif\tyou\tbuy\tthe\tbest\tkit,\tthe\tmost\texpensive\thardware,\tyou cannot\tavoid\tthe\tfact\tthat\tthings\tcan\tand\twill\tfail.\tTherefore,\tyou\tneed\tto\tassume\tfailure can\thappen.\tIf\tyou\tbuild\tthis\tthinking\tinto\teverything\tyou\tdo,\tand\tplan\tfor\tfailure,\tyou\tcan make\tdifferent\ttrade-offs.\tIf\tyou\tknow\tyour\tsystem\tcan\thandle\tthe\tfact\tthat\ta\tserver\tcan and\twill\tfail,\twhy\tbother\tspending\tmuch\ton\tit\tat\tall?\tWhy\tnot\tuse\ta\tbare\tmotherboard\twith cheaper\tcomponents\t(and\tsome\tvelcro)\tlike\tGoogle\tdid,\trather\tthan\tworrying\ttoo\tmuch about\tthe\tresiliency\tof\ta\tsingle\tnode?",
      "page_number": 323
    },
    {
      "number": 11,
      "title": "Microservices\tat\tScale",
      "start_page": 347,
      "end_page": 410,
      "detection_method": "regex_chapter_title",
      "content": "How\tMuch\tIs\tToo\tMuch?\n\nWe\ttouched\ton\tthe\ttopic\tof\tcross-functional\trequirements\tin\tChapter\t7.\tUnderstanding cross-functional\trequirements\tis\tall\tabout\tconsidering\taspects\tlike\tdurability\tof\tdata, availability\tof\tservices,\tthroughput,\tand\tacceptable\tlatency\tof\tservices.\tMany\tof\tthe techniques\tcovered\tin\tthis\tchapter\tand\telsewhere\ttalk\tabout\tapproaches\tto\timplement these\trequirements,\tbut\tonly\tyou\tknow\texactly\twhat\tthe\trequirements\tthemselves\tmight be.\n\nHaving\tan\tautoscaling\tsystem\tcapable\tof\treacting\tto\tincreased\tload\tor\tfailure\tof\tindividual nodes\tmight\tbe\tfantastic,\tbut\tcould\tbe\toverkill\tfor\ta\treporting\tsystem\tthat\tonly\tneeds\tto run\ttwice\ta\tmonth,\twhere\tbeing\tdown\tfor\ta\tday\tor\ttwo\tisn’t\tthat\tbig\tof\ta\tdeal.\tLikewise, figuring\tout\thow\tto\tdo\tblue/green\tdeployments\tto\teliminate\tdowntime\tof\ta\tservice\tmight make\tsense\tfor\tyour\tonline\tecommerce\tsystem,\tbut\tfor\tyour\tcorporate\tintranet\tknowledge base\tit’s\tprobably\ta\tstep\ttoo\tfar.\n\nKnowing\thow\tmuch\tfailure\tyou\tcan\ttolerate,\tor\thow\tfast\tyour\tsystem\tneeds\tto\tbe,\tis driven\tby\tthe\tusers\tof\tyour\tsystem.\tThat\tin\tturn\twill\thelp\tyou\tunderstand\twhich techniques\twill\tmake\tthe\tmost\tsense\tfor\tyou.\tThat\tsaid,\tyour\tusers\twon’t\talways\tbe\table\tto articulate\twhat\tthe\texact\trequirements\tare.\tSo\tyou\tneed\tto\task\tquestions\tto\thelp\textract\tthe right\tinformation,\tand\thelp\tthem\tunderstand\tthe\trelative\tcosts\tof\tproviding\tdifferent\tlevels of\tservice.\n\nAs\tI\tmentioned\tpreviously,\tthese\tcross-functional\trequirements\tcan\tvary\tfrom\tservice\tto service,\tbut\tI\twould\tsuggest\tdefining\tsome\tgeneral\tcross-functionals\tand\tthen\toverriding them\tfor\tparticular\tuse\tcases.\tWhen\tit\tcomes\tto\tconsidering\tif\tand\thow\tto\tscale\tout\tyour system\tto\tbetter\thandle\tload\tor\tfailure,\tstart\tby\ttrying\tto\tunderstand\tthe\tfollowing requirements:\n\nResponse\ttime/latency\n\nHow\tlong\tshould\tvarious\toperations\ttake?\tIt\tcan\tbe\tuseful\there\tto\tmeasure\tthis\twith different\tnumbers\tof\tusers\tto\tunderstand\thow\tincreasing\tload\twill\timpact\tthe response\ttime.\tGiven\tthe\tnature\tof\tnetworks,\tyou’ll\talways\thave\toutliers,\tso\tsetting targets\tfor\ta\tgiven\tpercentile\tof\tthe\tresponses\tmonitored\tcan\tbe\tuseful.\tThe\ttarget should\talso\tinclude\tthe\tnumber\tof\tconcurrent\tconnections/users\tyou\twill\texpect\tyour software\tto\thandle.\tSo\tyou\tmight\tsay,\t“We\texpect\tthe\twebsite\tto\thave\ta\t90th- percentile\tresponse\ttime\tof\t2\tseconds\twhen\thandling\t200\tconcurrent\tconnections\tper second.”\n\nAvailability\n\nCan\tyou\texpect\ta\tservice\tto\tbe\tdown?\tIs\tthis\tconsidered\ta\t24/7\tservice?\tSome\tpeople like\tto\tlook\tat\tperiods\tof\tacceptable\tdowntime\twhen\tmeasuring\tavailability,\tbut\thow useful\tis\tthis\tto\tsomeone\tcalling\tyour\tservice?\tI\tshould\teither\tbe\table\tto\trely\ton\tyour service\tresponding\tor\tnot.\tMeasuring\tperiods\tof\tdowntime\tis\treally\tmore\tuseful\tfrom a\thistorical\treporting\tangle.\n\nDurability\tof\tdata\n\nHow\tmuch\tdata\tloss\tis\tacceptable?\tHow\tlong\tshould\tdata\tbe\tkept\tfor?\tThis\tis\thighly likely\tto\tchange\ton\ta\tcase-by-case\tbasis.\tFor\texample,\tyou\tmight\tchoose\tto\tkeep\tuser session\tlogs\tfor\ta\tyear\tor\tless\tto\tsave\tspace,\tbut\tyour\tfinancial\ttransaction\trecords might\tneed\tto\tbe\tkept\tfor\tmany\tyears.\n\nOnce\tyou\thave\tthese\trequirements\tin\tplace,\tyou’ll\twant\ta\tway\tto\tsystematically\tmeasure them\ton\tan\tongoing\tbasis.\tYou\tmay\tdecide\tto\tmake\tuse\tof\tperformance\ttests,\tfor\texample, to\tensure\tyour\tsystem\tmeets\tacceptable\tperformance\ttargets,\tbut\tyou’ll\twant\tto\tmake\tsure you\tare\tmonitoring\tthese\tstats\tin\tproduction\tas\twell!\n\nDegrading\tFunctionality\n\nAn\tessential\tpart\tof\tbuilding\ta\tresilient\tsystem,\tespecially\twhen\tyour\tfunctionality\tis spread\tover\ta\tnumber\tof\tdifferent\tmicroservices\tthat\tmay\tbe\tup\tor\tdown,\tis\tthe\tability\tto safely\tdegrade\tfunctionality.\tLet’s\timagine\ta\tstandard\tweb\tpage\ton\tour\tecommerce\tsite.\tTo pull\ttogether\tthe\tvarious\tparts\tof\tthat\twebsite,\twe\tmight\tneed\tseveral\tmicroservices\tto\tplay a\tpart.\tOne\tmicroservice\tmight\tdisplay\tthe\tdetails\tabout\tthe\talbum\tbeing\toffered\tfor\tsale. Another\tmight\tshow\tthe\tprice\tand\tstock\tlevel.\tAnd\twe’ll\tprobably\tbe\tshowing\tshopping cart\tcontents\ttoo,\twhich\tmay\tbe\tyet\tanother\tmicroservice.\tNow\tif\tone\tof\tthose\tservices\tis down,\tand\tthat\tresults\tin\tthe\twhole\tweb\tpage\tbeing\tunavailable,\tthen\twe\thave\targuably made\ta\tsystem\tthat\tis\tless\tresilient\tthan\tone\tthat\trequires\tonly\tone\tservice\tto\tbe\tavailable.\n\nWhat\twe\tneed\tto\tdo\tis\tunderstand\tthe\timpact\tof\teach\toutage,\tand\twork\tout\thow\tto properly\tdegrade\tfunctionality.\tIf\tthe\tshopping\tcart\tservice\tis\tunavailable,\twe’re\tprobably in\ta\tlot\tof\ttrouble,\tbut\twe\tcould\tstill\tshow\tthe\tweb\tpage\twith\tthe\tlisting.\tPerhaps\twe\tjust hide\tthe\tshopping\tcart\tor\treplace\tit\twith\tan\ticon\tsaying\t“Be\tBack\tSoon!”\n\nWith\ta\tsingle,\tmonolithic\tapplication,\twe\tdon’t\thave\tmany\tdecisions\tto\tmake.\tSystem health\tis\tbinary.\tBut\twith\ta\tmicroservice\tarchitecture,\twe\tneed\tto\tconsider\ta\tmuch\tmore nuanced\tsituation.\tThe\tright\tthing\tto\tdo\tin\tany\tsituation\tis\toften\tnot\ta\ttechnical\tdecision. We\tmight\tknow\twhat\tis\ttechnically\tpossible\twhen\tthe\tshopping\tcart\tis\tdown,\tbut\tunless we\tunderstand\tthe\tbusiness\tcontext\twe\twon’t\tunderstand\twhat\taction\twe\tshould\tbe\ttaking. For\texample,\tperhaps\twe\tclose\tthe\tentire\tsite,\tstill\tallow\tpeople\tto\tbrowse\tthe\tcatalog\tof items,\tor\treplace\tthe\tpart\tof\tthe\tUI\tcontaining\tthe\tcart\tcontrol\twith\ta\tphone\tnumber\tfor placing\tan\torder.\tBut\tfor\tevery\tcustomer-facing\tinterface\tthat\tuses\tmultiple\tmicroservices, or\tevery\tmicroservice\tthat\tdepends\ton\tmultiple\tdownstream\tcollaborators,\tyou\tneed\tto\task yourself,\t“What\thappens\tif\tthis\tis\tdown?”\tand\tknow\twhat\tto\tdo.\n\nBy\tthinking\tabout\tthe\tcriticality\tof\teach\tof\tour\tcapabilities\tin\tterms\tof\tour\tcross-functional requirements,\twe’ll\tbe\tmuch\tbetter\tpositioned\tto\tknow\twhat\twe\tcan\tdo.\tNow\tlet’s consider\tsome\tthings\twe\tcan\tdo\tfrom\ta\ttechnical\tpoint\tof\tview\tto\tmake\tsure\tthat\twhen failure\toccurs\twe\tcan\thandle\tit\tgracefully.\n\nArchitectural\tSafety\tMeasures\n\nThere\tare\ta\tfew\tpatterns,\twhich\tcollectively\tI\trefer\tto\tas\tarchitectural\tsafety\tmeasures,\tthat we\tcan\tmake\tuse\tof\tto\tensure\tthat\tif\tsomething\tdoes\tgo\twrong,\tit\tdoesn’t\tcause\tnasty ripple-out\teffects.\tThese\tare\tpoints\tit\tis\tessential\tyou\tunderstand,\tand\tshould\tstrongly consider\tstandardizing\tin\tyour\tsystem\tto\tensure\tthat\tone\tbad\tcitizen\tdoesn’t\tbring\tthe whole\tworld\tcrashing\tdown\taround\tyour\tears.\tIn\ta\tmoment,\twe’ll\ttake\ta\tlook\tat\ta\tfew\tkey safety\tmeasures\tyou\tshould\tconsider,\tbut\tbefore\twe\tdo,\tI’d\tlike\tto\tshare\ta\tbrief\tstory\tto outline\tthe\tsort\tof\tthing\tthat\tcan\tgo\twrong.\n\nI\twas\ta\ttechnical\tlead\ton\ta\tproject\twhere\twe\twere\tbuilding\tan\tonline\tclassified\tads website.\tThe\twebsite\titself\thandled\tfairly\thigh\tvolumes,\tand\tgenerated\ta\tgood\tdeal\tof income\tfor\tthe\tbusiness.\tOur\tcore\tapplication\thandled\tsome\tdisplay\tof\tclassified\tads\titself, and\talso\tproxied\tcalls\tto\tother\tservices\tthat\tprovided\tdifferent\ttypes\tof\tproducts,\tas\tshown in\tFigure\t11-1.\tThis\tis\tactually\tan\texample\tof\ta\tstrangler\tapplication,\twhere\ta\tnew\tsystem intercepts\tcalls\tmade\tto\tlegacy\tapplications\tand\tgradually\treplaces\tthem\taltogether.\tAs part\tof\tthis\tproject,\twe\twere\tpartway\tthrough\tretiring\tthe\tolder\tapplications.\tWe\thad\tjust moved\tover\tthe\thighest\tvolume\tand\tbiggest\tearning\tproduct,\tbut\tmuch\tof\tthe\trest\tof\tthe ads\twere\tstill\tbeing\tserved\tby\ta\tnumber\tof\tolder\tapplications.\tIn\tterms\tof\tboth\tthe\tnumber of\tsearches\tand\tthe\tmoney\tmade\tby\tthese\tapplications,\tthere\twas\ta\tvery\tlong\ttail.\n\nFigure\t11-1.\tA\tclassified\tads\twebsite\tstrangling\tolder\tlegacy\tapplications\n\nOur\tsystem\thad\tbeen\tlive\tfor\ta\twhile\tand\twas\tbehaving\tvery\twell,\thandling\ta\tnot insignificant\tload.\tAt\tthat\ttime\twe\tmust\thave\tbeen\thandling\taround\t6,000–7,000\trequests per\tsecond\tduring\tpeak,\tand\talthough\tmost\tof\tthat\twas\tvery\theavily\tcached\tby\treverse proxies\tsitting\tin\tfront\tof\tour\tapplication\tservers,\tthe\tsearches\tfor\tproducts\t(the\tmost important\taspect\tof\tthe\tsite)\twere\tmostly\tuncached\tand\trequired\ta\tfull\tserver\tround-trip.\n\nOne\tmorning,\tjust\tbefore\twe\thit\tour\tdaily\tlunchtime\tpeak,\tthe\tsystem\tstarted\tbehaving slowly,\tthen\tgradually\tstarted\tfailing.\tWe\thad\tsome\tlevel\tof\tmonitoring\ton\tour\tnew\tcore application,\tenough\tto\ttell\tus\tthat\teach\tof\tour\tapplication\tnodes\twas\thitting\ta\t100%\tCPU spike,\twell\tabove\tthe\tnormal\tlevels\teven\tat\tpeak.\tIn\ta\tshort\tperiod\tof\ttime,\tthe\tentire\tsite went\tdown.\n\nWe\tmanaged\tto\ttrack\tdown\tthe\tculprit\tand\tbring\tthe\tsite\tback\tup.\tIt\tturned\tout\tone\tof\tthe downstream\tad\tsystems,\tone\tof\tthe\toldest\tand\tleast\tactively\tmaintained,\thad\tstarted responding\tvery\tslowly.\tResponding\tvery\tslowly\tis\tone\tof\tthe\tworst\tfailure\tmodes\tyou\tcan experience.\tIf\ta\tsystem\tis\tjust\tnot\tthere,\tyou\tfind\tout\tpretty\tquickly.\tWhen\tit’s\tjust\tslow, you\tend\tup\twaiting\taround\tfor\ta\twhile\tbefore\tgiving\tup.\tBut\twhatever\tthe\tcause\tof\tthe failure,\twe\thad\tcreated\ta\tsystem\tthat\twas\tvulnerable\tto\ta\tcascading\tfailure.\tA\tdownstream service,\tover\twhich\twe\thad\tlittle\tcontrol,\twas\table\tto\ttake\tdown\tour\twhole\tsystem.\n\nWhile\tone\tteam\tlooked\tat\tthe\tproblems\twith\tthe\tdownstream\tsystem,\tthe\trest\tof\tus\tstarted looking\tat\twhat\thad\tgone\twrong\tin\tour\tapplication.\tWe\tfound\ta\tfew\tproblems.\tWe\twere using\tan\tHTTP\tconnection\tpool\tto\thandle\tour\tdownstream\tconnections.\tThe\tthreads\tin\tthe pool\titself\thad\ttimeouts\tconfigured\tfor\thow\tlong\tthey\twould\twait\twhen\tmaking\tthe downstream\tHTTP\tcall,\twhich\tis\tgood.\tThe\tproblem\twas\tthat\tthe\tworkers\twere\tall\ttaking a\twhile\tto\ttime\tout\tdue\tto\tthe\tslow\tdownstream\tsystem.\tWhile\tthey\twere\twaiting,\tmore requests\twent\tto\tthe\tpool\tasking\tfor\tworker\tthreads.\tWith\tno\tworkers\tavailable,\tthese requests\tthemselves\thung.\tIt\tturned\tout\tthe\tconnection\tpool\tlibrary\twe\twere\tusing\tdid have\ta\ttimeout\tfor\twaiting\tfor\tworkers,\tbut\tthis\twas\tdisabled\tby\tdefault!\tThis\tled\tto\ta\thuge build-up\tof\tblocked\tthreads.\tOur\tapplication\tnormally\thad\t40\tconcurrent\tconnections\tat any\tgiven\ttime.\tIn\tthe\tspace\tof\tfive\tminutes,\tthis\tsituation\tcaused\tus\tto\tpeak\tat\taround\t800 connections,\tbringing\tthe\tsystem\tdown.\n\nWhat\twas\tworse\twas\tthat\tthe\tdownstream\tservice\twe\twere\ttalking\tto\trepresented functionality\tthat\tless\tthan\t5%\tof\tour\tcustomer\tbase\tused,\tand\tgenerated\teven\tless\trevenue than\tthat.\tWhen\tyou\tget\tdown\tto\tit,\twe\tdiscovered\tthe\thard\tway\tthat\tsystems\tthat\tjust\tact slow\tare\tmuch\tharder\tto\tdeal\twith\tthan\tsystems\tthat\tjust\tfail\tfast.\tIn\ta\tdistributed\tsystem, latency\tkills.\n\nEven\tif\twe’d\thad\tthe\ttimeouts\ton\tthe\tpool\tset\tcorrectly,\twe\twere\talso\tsharing\ta\tsingle HTTP\tconnection\tpool\tfor\tall\toutbound\trequests.\tThis\tmeant\tthat\tone\tslow\tservice\tcould exhaust\tthe\tnumber\tof\tavailable\tworkers\tall\tby\titself,\teven\tif\teverything\telse\twas\thealthy. Lastly,\tit\twas\tclear\tthat\tthe\tdownstream\tservice\tin\tquestion\twasn’t\thealthy,\tbut\twe\tkept sending\ttraffic\tits\tway.\tIn\tour\tsituation,\tthis\tmeant\twe\twere\tactually\tmaking\ta\tbad situation\tworse,\tas\tthe\tdownstream\tservice\thad\tno\tchance\tto\trecover.\tWe\tended\tup implementing\tthree\tfixes\tto\tavoid\tthis\thappening\tagain:\tgetting\tour\ttimeouts\tright, implementing\tbulkheads\tto\tseparate\tout\tdifferent\tconnection\tpools,\tand\timplementing\ta circuit\tbreaker\tto\tavoid\tsending\tcalls\tto\tan\tunhealthy\tsystem\tin\tthe\tfirst\tplace.\n\nThe\tAntifragile\tOrganization\n\nIn\this\tbook\tAntifragile\t(Random\tHouse),\tNassim\tTaleb\ttalks\tabout\tthings\tthat\tactually benefit\tfrom\tfailure\tand\tdisorder.\tAriel\tTseitlin\tused\tthis\tconcept\tto\tcoin\tthe\tconcept\tof\tthe antifragile\torganization\tin\tregards\tto\thow\tNetflix\toperates.\n\nThe\tscale\tat\twhich\tNetflix\toperates\tis\twell\tknown,\tas\tis\tthe\tfact\tthat\tNetflix\tis\tbased entirely\ton\tthe\tAWS\tinfrastructure.\tThese\ttwo\tfactors\tmean\tthat\tit\thas\tto\tembrace\tfailure well.\tNetflix\tgoes\tbeyond\tthat\tby\tactually\tinciting\tfailure\tto\tensure\tthat\tits\tsystems\tare tolerant\tof\tit.\n\nSome\torganizations\twould\tbe\thappy\twith\tgame\tdays,\twhere\tfailure\tis\tsimulated\tby systems\tbeing\tswitched\toff\tand\thaving\tthe\tvarious\tteams\treact.\tDuring\tmy\ttime\tat\tGoogle, this\twas\ta\tfairly\tcommon\toccurrence\tfor\tvarious\tsystems,\tand\tI\tcertainly\tthink\tthat\tmany organizations\tcould\tbenefit\tfrom\thaving\tthese\tsorts\tof\texercises\tregularly.\tGoogle\tgoes beyond\tsimple\ttests\tto\tmimic\tserver\tfailure,\tand\tas\tpart\tof\tits\tannual\tDiRT\t(Disaster Recovery\tTest)\texercises\tit\thas\tsimulated\tlarge-scale\tdisasters\tsuch\tas\tearthquakes.\tNetflix also\ttakes\ta\tmore\taggressive\tapproach,\tby\twriting\tprograms\tthat\tcause\tfailure\tand\trunning them\tin\tproduction\ton\ta\tdaily\tbasis.\n\nThe\tmost\tfamous\tof\tthese\tprograms\tis\tthe\tChaos\tMonkey,\twhich\tduring\tcertain\thours\tof the\tday\twill\tturn\toff\trandom\tmachines.\tKnowing\tthat\tthis\tcan\tand\twill\thappen\tin production\tmeans\tthat\tthe\tdevelopers\twho\tcreate\tthe\tsystems\treally\thave\tto\tbe\tprepared for\tit.\tThe\tChaos\tMonkey\tis\tjust\tone\tpart\tof\tNetflix’s\tSimian\tArmy\tof\tfailure\tbots.\tThe Chaos\tGorilla\tis\tused\tto\ttake\tout\tan\tentire\tavailability\tcenter\t(the\tAWS\tequivalent\tof\ta data\tcenter),\twhereas\tthe\tLatency\tMonkey\tsimulates\tslow\tnetwork\tconnectivity\tbetween machines.\tNetflix\thas\tmade\tthese\ttools\tavailable\tunder\tan\topen\tsource\tlicense.\tFor\tmany, the\tultimate\ttest\tof\twhether\tyour\tsystem\treally\tis\trobust\tmight\tbe\tunleashing\tyour\tvery own\tSimian\tArmy\ton\tyour\tproduction\tinfrastructure.\n\nEmbracing\tand\tinciting\tfailure\tthrough\tsoftware,\tand\tbuilding\tsystems\tthat\tcan\thandle\tit, is\tonly\tpart\tof\twhat\tNetflix\tdoes.\tIt\talso\tunderstands\tthe\timportance\tof\tlearning\tfrom\tthe failure\twhen\tit\toccurs,\tand\tadopting\ta\tblameless\tculture\twhen\tmistakes\tdo\thappen. Developers\tare\tfurther\tempowered\tto\tbe\tpart\tof\tthis\tlearning\tand\tevolving\tprocess,\tas\teach developer\tis\talso\tresponsible\tfor\tmanaging\this\tor\ther\tproduction\tservices.\n\nBy\tcausing\tfailure\tto\thappen,\tand\tbuilding\tfor\tit,\tNetflix\thas\tensured\tthat\tthe\tsystems\tit has\tscale\tbetter,\tand\tbetter\tsupport\tthe\tneeds\tof\tits\tcustomers.\n\nNot\teveryone\tneeds\tto\tgo\tto\tthe\tsorts\tof\textremes\tthat\tGoogle\tor\tNetflix\tdo,\tbut\tit\tis important\tto\tunderstand\tthe\tmindset\tshift\tthat\tis\trequired\twith\tdistributed\tsystems.\tThings will\tfail.\tThe\tfact\tthat\tyour\tsystem\tis\tnow\tspread\tacross\tmultiple\tmachines\t(which\tcan\tand will\tfail)\tacross\ta\tnetwork\t(which\twill\tbe\tunreliable)\tcan\tactually\tmake\tyour\tsystem\tmore vulnerable,\tnot\tless.\tSo\tregardless\tof\twhether\tyou’re\ttrying\tto\tprovide\ta\tservice\tat\tthe scale\tof\tGoogle\tor\tNetflix,\tpreparing\tyourself\tfor\tthe\tsorts\tof\tfailure\tthat\thappen\twith\n\nmore\tdistributed\tarchitectures\tis\tpretty\timportant.\tSo\twhat\tdo\twe\tneed\tto\tdo\tto\thandle failure\tin\tour\tsystems?\n\nTimeouts\n\nTimeouts\tare\tsomething\tit\tis\teasy\tto\toverlook,\tbut\tin\ta\tdownstream\tsystem\tthey\tare important\tto\tget\tright.\tHow\tlong\tcan\tI\twait\tbefore\tI\tcan\tconsider\ta\tdownstream\tsystem\tto actually\tbe\tdown?\n\nWait\ttoo\tlong\tto\tdecide\tthat\ta\tcall\thas\tfailed,\tand\tyou\tcan\tslow\tthe\twhole\tsystem\tdown. Time\tout\ttoo\tquickly,\tand\tyou’ll\tconsider\ta\tcall\tthat\tmight\thave\tworked\tas\tfailed.\tHave\tno timeouts\tat\tall,\tand\ta\tdownstream\tsystem\tbeing\tdown\tcould\thang\tyour\twhole\tsystem.\n\nPut\ttimeouts\ton\tall\tout-of-process\tcalls,\tand\tpick\ta\tdefault\ttimeout\tfor\teverything.\tLog when\ttimeouts\toccur,\tlook\tat\twhat\thappens,\tand\tchange\tthem\taccordingly.\n\nCircuit\tBreakers\n\nIn\tyour\town\thome,\tcircuit\tbreakers\texist\tto\tprotect\tyour\telectrical\tdevices\tfrom\tspikes\tin the\tpower.\tIf\ta\tspike\toccurs,\tthe\tcircuit\tbreaker\tgets\tblown,\tprotecting\tyour\texpensive home\tappliances.\tYou\tcan\talso\tmanually\tdisable\ta\tcircuit\tbreaker\tto\tcut\tthe\tpower\tto\tpart of\tyour\thome,\tallowing\tyou\tto\twork\tsafely\ton\tthe\telectrics.\tMichael\tNygard’s\tbook Release\tIt!\t(Pragmatic\tProgrammers)\tshows\thow\tthe\tsame\tidea\tcan\twork\twonders\tas\ta protection\tmechanism\tfor\tour\tsoftware.\n\nConsider\tthe\tstory\tI\tshared\tjust\ta\tmoment\tago.\tThe\tdownstream\tlegacy\tad\tapplication\twas responding\tvery\tslowly,\tbefore\teventually\treturning\tan\terror.\tEven\tif\twe’d\tgot\tthe timeouts\tright,\twe’d\tbe\twaiting\ta\tlong\ttime\tbefore\twe\tgot\tthe\terror.\tAnd\tthen\twe’d\ttry\tit again\tthe\tnext\ttime\ta\trequest\tcame\tin,\tand\twait.\tIt’s\tbad\tenough\tthat\tthe\tdownstream service\tis\tmalfunctioning,\tbut\tit’s\tmaking\tus\tgo\tslow\ttoo.\n\nWith\ta\tcircuit\tbreaker,\tafter\ta\tcertain\tnumber\tof\trequests\tto\tthe\tdownstream\tresource\thave failed,\tthe\tcircuit\tbreaker\tis\tblown.\tAll\tfurther\trequests\tfail\tfast\twhile\tthe\tcircuit\tbreaker\tis in\tits\tblown\tstate.\tAfter\ta\tcertain\tperiod\tof\ttime,\tthe\tclient\tsends\ta\tfew\trequests\tthrough\tto see\tif\tthe\tdownstream\tservice\thas\trecovered,\tand\tif\tit\tgets\tenough\thealthy\tresponses\tit resets\tthe\tcircuit\tbreaker.\tYou\tcan\tsee\tan\toverview\tof\tthis\tprocess\tin\tFigure\t11-2.\n\nHow\tyou\timplement\ta\tcircuit\tbreaker\tdepends\ton\twhat\ta\tfailed\trequest\tmeans,\tbut\twhen I’ve\timplemented\tthem\tfor\tHTTP\tconnections\tI’ve\ttaken\tfailure\tto\tmean\teither\ta\ttimeout or\ta\t5XX\tHTTP\treturn\tcode.\tIn\tthis\tway,\twhen\ta\tdownstream\tresource\tis\tdown,\tor\ttiming out,\tor\treturning\terrors,\tafter\ta\tcertain\tthreshold\tis\treached\twe\tautomatically\tstop\tsending traffic\tand\tstart\tfailing\tfast.\tAnd\twe\tcan\tautomatically\tstart\tagain\twhen\tthings\tare\thealthy.\n\nGetting\tthe\tsettings\tright\tcan\tbe\ta\tlittle\ttricky.\tYou\tdon’t\twant\tto\tblow\tthe\tcircuit\tbreaker too\treadily,\tnor\tdo\tyou\twant\tto\ttake\ttoo\tlong\tto\tblow\tit.\tLikewise,\tyou\treally\twant\tto\tmake sure\tthat\tthe\tdownstream\tservice\tis\thealthy\tagain\tbefore\tsending\ttraffic.\tAs\twith\ttimeouts, I’d\tpick\tsome\tsensible\tdefaults\tand\tstick\twith\tthem\teverywhere,\tthen\tchange\tthem\tfor specific\tcases.\n\nWhile\tthe\tcircuit\tbreaker\tis\tblown,\tyou\thave\tsome\toptions.\tOne\tis\tto\tqueue\tup\tthe\trequests and\tretry\tthem\tlater\ton.\tFor\tsome\tuse\tcases,\tthis\tmight\tbe\tappropriate,\tespecially\tif\tyou’re carrying\tout\tsome\twork\tas\tpart\tof\ta\tasynchronous\tjob.\tIf\tthis\tcall\tis\tbeing\tmade\tas\tpart\tof a\tsynchronous\tcall\tchain,\thowever,\tit\tis\tprobably\tbetter\tto\tfail\tfast.\tThis\tcould\tmean propagating\tan\terror\tup\tthe\tcall\tchain,\tor\ta\tmore\tsubtle\tdegrading\tof\tfunctionality.\n\nIf\twe\thave\tthis\tmechanism\tin\tplace\t(as\twith\tthe\tcircuit\tbreakers\tin\tour\thome),\twe\tcould use\tthem\tmanually\tto\tmake\tit\tsafer\tto\tdo\tour\twork.\tFor\texample,\tif\twe\twanted\tto\ttake\ta microservice\tdown\tas\tpart\tof\troutine\tmaintenance,\twe\tcould\tmanually\tblow\tall\tthe\tcircuit breakers\tof\tthe\tdependent\tsystems\tso\tthey\tfail\tfast\twhile\tthe\tmicroservice\tis\toffline.\tOnce it’s\tback,\twe\tcan\treset\tthe\tcircuit\tbreakers\tand\teverything\tshould\tgo\tback\tto\tnormal.\n\nFigure\t11-2.\tAn\toverview\tof\tcircuit\tbreakers\n\nBulkheads\n\nIn\tanother\tpattern\tfrom\tRelease\tIt!,\tNygard\tintroduces\tthe\tconcept\tof\ta\tbulkhead\tas\ta\tway to\tisolate\tyourself\tfrom\tfailure.\tIn\tshipping,\ta\tbulkhead\tis\ta\tpart\tof\tthe\tship\tthat\tcan\tbe sealed\toff\tto\tprotect\tthe\trest\tof\tthe\tship.\tSo\tif\tthe\tship\tsprings\ta\tleak,\tyou\tcan\tclose\tthe bulkhead\tdoors.\tYou\tlose\tpart\tof\tthe\tship,\tbut\tthe\trest\tof\tit\tremains\tintact.\n\nIn\tsoftware\tarchitecture\tterms,\tthere\tare\tlots\tof\tdifferent\tbulkheads\twe\tcan\tconsider. Returning\tto\tmy\town\texperience,\twe\tactually\tmissed\tthe\tchance\tto\timplement\ta\tbulkhead. We\tshould\thave\tused\tdifferent\tconnection\tpools\tfor\teach\tdownstream\tconnection.\tThat way,\tif\tone\tconnection\tpool\tgets\texhausted,\tthe\tother\tconnections\taren’t\timpacted,\tas\twe see\tin\tFigure\t11-3.\tThis\twould\tensure\tthat\tif\ta\tdownstream\tservice\tstarted\tbehaving slowly\tin\tthe\tfuture,\tonly\tthat\tone\tconnection\tpool\twould\tbe\timpacted,\tallowing\tother calls\tto\tproceed\tas\tnormal.\n\nFigure\t11-3.\tUsing\ta\tconnection\tpool\tper\tdownstream\tservice\tto\tprovide\tbulkheads\n\nSeparation\tof\tconcerns\tcan\talso\tbe\ta\tway\tto\timplement\tbulkheads.\tBy\tteasing\tapart functionality\tinto\tseparate\tmicroservices,\twe\treduce\tthe\tchance\tof\tan\toutage\tin\tone\tarea affecting\tanother.\n\nLook\tat\tall\tthe\taspects\tof\tyour\tsystem\tthat\tcan\tgo\twrong,\tboth\tinside\tyour\tmicroservices and\tbetween\tthem.\tDo\tyou\thave\tbulkheads\tin\tplace?\tI’d\tsuggest\tstarting\twith\tseparate connection\tpools\tfor\teach\tdownstream\tconnection\tat\tthe\tvery\tleast.\tYou\tmay\twant\tto\tgo further,\thowever,\tand\tconsider\tusing\tcircuit\tbreakers\ttoo.\n\nWe\tcan\tthink\tof\tour\tcircuit\tbreakers\tas\tan\tautomatic\tmechanism\tto\tseal\ta\tbulkhead,\tto\tnot only\tprotect\tthe\tconsumer\tfrom\tthe\tdownstream\tproblem,\tbut\talso\tto\tpotentially\tprotect the\tdownstream\tservice\tfrom\tmore\tcalls\tthat\tmay\tbe\thaving\tan\tadverse\timpact.\tGiven\tthe perils\tof\tcascading\tfailure,\tI’d\trecommend\tmandating\tcircuit\tbreakers\tfor\tall\tyour synchronous\tdownstream\tcalls.\tYou\tdon’t\thave\tto\twrite\tyour\town,\teither.\tNetflix’s\tHystrix\n\nlibrary\tis\ta\tJVM\tcircuit\tbreaker\tabstraction\tthat\tcomes\twith\tsome\tpowerful\tmonitoring, but\tother\timplementations\texist\tfor\tdifferent\ttechnology\tstacks,\tsuch\tas\tPolly\tfor\t.NET,\tor the\tcircuit_breaker\tmixin\tfor\tRuby.\n\nIn\tmany\tways,\tbulkheads\tare\tthe\tmost\timportant\tof\tthese\tthree\tpatterns.\tTimeouts\tand circuit\tbreakers\thelp\tyou\tfree\tup\tresources\twhen\tthey\tare\tbecoming\tconstrained,\tbut bulkheads\tcan\tensure\tthey\tdon’t\tbecome\tconstrained\tin\tthe\tfirst\tplace.\tHystrix\tallows\tyou, for\texample,\tto\timplement\tbulkheads\tthat\tactually\treject\trequests\tin\tcertain\tconditions\tto ensure\tthat\tresources\tdon’t\tbecome\teven\tmore\tsaturated;\tthis\tis\tknown\tas\tload\tshedding. Sometimes\trejecting\ta\trequest\tis\tthe\tbest\tway\tto\tstop\tan\timportant\tsystem\tfrom\tbecoming overwhelmed\tand\tbeing\ta\tbottleneck\tfor\tmultiple\tupstream\tservices.\n\nIsolation\n\nThe\tmore\tone\tservice\tdepends\ton\tanother\tbeing\tup,\tthe\tmore\tthe\thealth\tof\tone\timpacts\tthe ability\tof\tthe\tother\tto\tdo\tits\tjob.\tIf\twe\tcan\tuse\tintegration\ttechniques\tthat\tallow\ta downstream\tserver\tto\tbe\toffline,\tupstream\tservices\tare\tless\tlikely\tto\tbe\taffected\tby outages,\tplanned\tor\tunplanned.\n\nThere\tis\tanother\tbenefit\tto\tincreasing\tisolation\tbetween\tservices.\tWhen\tservices\tare isolated\tfrom\teach\tother,\tmuch\tless\tcoordination\tis\tneeded\tbetween\tservice\towners.\tThe less\tcoordination\tneeded\tbetween\tteams,\tthe\tmore\tautonomy\tthose\tteams\thave,\tas\tthey\tare able\tto\toperate\tand\tevolve\ttheir\tservices\tmore\tfreely.\n\nIdempotency\n\nIn\tidempotent\toperations,\tthe\toutcome\tdoesn’t\tchange\tafter\tthe\tfirst\tapplication,\teven\tif the\toperation\tis\tsubsequently\tapplied\tmultiple\ttimes.\tIf\toperations\tare\tidempotent,\twe\tcan repeat\tthe\tcall\tmultiple\ttimes\twithout\tadverse\timpact.\tThis\tis\tvery\tuseful\twhen\twe\twant\tto replay\tmessages\tthat\twe\taren’t\tsure\thave\tbeen\tprocessed,\ta\tcommon\tway\tof\trecovering from\terror.\n\nLet’s\tconsider\ta\tsimple\tcall\tto\tadd\tsome\tpoints\tas\ta\tresult\tof\tone\tof\tour\tcustomers\tplacing an\torder.\tWe\tmight\tmake\ta\tcall\twith\tthe\tsort\tof\tpayload\tshown\tin\tExample\t11-1.\n\nExample\t11-1.\tCrediting\tpoints\tto\tan\taccount <credit> \t\t<amount>100</amount> \t\t<forAccount>1234</account> </credit>\n\nIf\tthis\tcall\tis\treceived\tmultiple\ttimes,\twe\twould\tadd\t100\tpoints\tmultiple\ttimes.\tAs\tit stands,\ttherefore,\tthis\tcall\tis\tnot\tidempotent.\tWith\ta\tbit\tmore\tinformation,\tthough,\twe allow\tthe\tpoints\tbank\tto\tmake\tthis\tcall\tidempotent,\tas\tshown\tin\tExample\t11-2.\n\nExample\t11-2.\tAdding\tmore\tinformation\tto\tthe\tpoints\tcredit\tto\tmake\tit\tidempotent <credit> \t\t<amount>100</amount> \t\t<forAccount>1234</account> \t\t<reason> \t\t\t\t<forPurchase>4567</forPurchase> \t\t</reason> </credit>\n\nNow\twe\tknow\tthat\tthis\tcredit\trelates\tto\ta\tspecific\torder,\t4567.\tAssuming\tthat\twe\tcould receive\tonly\tone\tcredit\tfor\ta\tgiven\torder,\twe\tcould\tapply\tthis\tcredit\tagain\twithout increasing\tthe\toverall\tnumber\tof\tpoints.\n\nThis\tmechanism\tworks\tjust\tas\twell\twith\tevent-based\tcollaboration,\tand\tcan\tbe\tespecially useful\tif\tyou\thave\tmultiple\tinstances\tof\tthe\tsame\ttype\tof\tservice\tsubscribing\tto\tevents. Even\tif\twe\tstore\twhich\tevents\thave\tbeen\tprocessed,\twith\tsome\tforms\tof\tasynchronous message\tdelivery\tthere\tmay\tbe\tsmall\twindows\twhere\ttwo\tworkers\tcan\tsee\tthe\tsame message.\tBy\tprocessing\tthe\tevents\tin\tan\tidempotent\tmanner,\twe\tensure\tthis\twon’t\tcause us\tany\tissues.\n\nSome\tpeople\tget\tquite\tcaught\tup\twith\tthis\tconcept,\tand\tassume\tit\tmeans\tthat\tsubsequent calls\twith\tthe\tsame\tparameters\tcan’t\thave\tany\timpact,\twhich\tthen\tleaves\tus\tin\tan interesting\tposition.\tWe\treally\twould\tstill\tlike\tto\trecord\tthe\tfact\tthat\ta\tcall\twas\treceived\tin our\tlogs,\tfor\texample.\tWe\twant\tto\trecord\tthe\tresponse\ttime\tof\tthe\tcall\tand\tcollect\tthis\tdata for\tmonitoring.\tThe\tkey\tpoint\there\tis\tthat\tit\tis\tthe\tunderlying\tbusiness\toperation\tthat\twe are\tconsidering\tidempotent,\tnot\tthe\tentire\tstate\tof\tthe\tsystem.\n\nSome\tof\tthe\tHTTP\tverbs,\tsuch\tas\tGET\tand\tPUT,\tare\tdefined\tin\tthe\tHTTP\tspecification\tto be\tidempotent,\tbut\tfor\tthat\tto\tbe\tthe\tcase,\tthey\trely\ton\tyour\tservice\thandling\tthese\tcalls\tin\n\nan\tidempotent\tmanner.\tIf\tyou\tstart\tmaking\tthese\tverbs\tnonidempotent,\tbut\tcallers\tthink they\tcan\tsafely\texecute\tthem\trepeatedly,\tyou\tmay\tget\tyourself\tinto\ta\tmess.\tRemember, just\tbecause\tyou’re\tusing\tHTTP\tas\tan\tunderlying\tprotocol\tdoesn’t\tmean\tyou\tget everything\tfor\tfree!\n\nScaling\n\nWe\tscale\tour\tsystems\tin\tgeneral\tfor\tone\tof\ttwo\treasons.\tFirst,\tto\thelp\tdeal\twith\tfailure:\tif we’re\tworried\tthat\tsomething\twill\tfail,\tthen\thaving\tmore\tof\tit\twill\thelp,\tright?\tSecond,\twe scale\tfor\tperformance,\teither\tin\tterms\tof\thandling\tmore\tload,\treducing\tlatency,\tor\tboth. Let’s\tlook\tat\tsome\tcommon\tscaling\ttechniques\twe\tcan\tuse\tand\tthink\tabout\thow\tthey\tapply to\tmicroservice\tarchitectures.\n\nGo\tBigger\n\nSome\toperations\tcan\tjust\tbenefit\tfrom\tmore\tgrunt.\tGetting\ta\tbigger\tbox\twith\tfaster\tCPU and\tbetter\tI/O\tcan\toften\timprove\tlatency\tand\tthroughput,\tallowing\tyou\tto\tprocess\tmore work\tin\tless\ttime.\tHowever,\tthis\tform\tof\tscaling,\toften\tcalled\tvertical\tscaling,\tcan\tbe expensive\t—\tsometimes\tone\tbig\tserver\tcan\tcost\tmore\tthan\ttwo\tsmaller\tservers\twith\tthe same\tcombined\traw\tpower,\tespecially\twhen\tyou\tstart\tgetting\tto\treally\tbig\tmachines. Sometimes\tour\tsoftware\titself\tcannot\tdo\tmuch\twith\tthe\textra\tresources\tavailable\tto\tit. Larger\tmachines\toften\tjust\tgive\tus\tmore\tCPU\tcores,\tbut\tnot\tenough\tof\tour\tsoftware\tis written\tto\ttake\tadvantage\tof\tthem.\tThe\tother\tproblem\tis\tthat\tthis\tform\tof\tscaling\tmay\tnot do\tmuch\tto\timprove\tour\tserver’s\tresiliency\tif\twe\tonly\thave\tone\tof\tthem!\tNonetheless,\tthis can\tbe\ta\tgood\tquick\twin,\tespecially\tif\tyou’re\tusing\ta\tvirtualization\tprovider\tthat\tlets\tyou resize\tmachines\teasily.\n\nSplitting\tWorkloads\n\nAs\toutlined\tin\tChapter\t6,\thaving\ta\tsingle\tmicroservice\tper\thost\tis\tcertainly\tpreferable\tto\ta multiservice-per-host\tmodel.\tInitially,\thowever,\tmany\tpeople\tdecide\tto\tcoexist\tmultiple microservices\ton\tone\tbox\tto\tkeep\tcosts\tdown\tor\tto\tsimplify\thost\tmanagement\t(although that\tis\tan\targuable\treason).\tAs\tthe\tmicroservices\tare\tindependent\tprocesses\tthat communicate\tover\tthe\tnetwork,\tit\tshould\tbe\tan\teasy\ttask\tto\tthen\tmove\tthem\tonto\ttheir own\thosts\tto\timprove\tthroughput\tand\tscaling.\tThis\tcan\talso\tincrease\tthe\tresiliency\tof\tthe system,\tas\ta\tsingle\thost\toutage\twill\timpact\ta\treduced\tnumber\tof\tmicroservices.\n\nOf\tcourse,\twe\tcould\talso\tuse\tthe\tneed\tfor\tincreased\tscale\tto\tsplit\tan\texisting\tmicroservice into\tparts\tto\tbetter\thandle\tthe\tload.\tAs\ta\tsimplistic\texample,\tlet’s\timagine\tthat\tour accounts\tservice\tprovides\tthe\tability\tto\tcreate\tand\tmanage\tindividual\tcustomers’\tfinancial accounts,\tbut\talso\texposes\tan\tAPI\tfor\trunning\tqueries\tto\tgenerate\treports.\tThis\tquery capability\tplaces\ta\tsignificant\tload\ton\tthe\tsystem.\tThe\tquery\tcapacity\tis\tconsidered noncritical,\tas\tit\tisn’t\tneeded\tto\tkeep\torders\tflowing\tin\tduring\tthe\tday.\tThe\tability\tto manage\tthe\tfinancial\trecords\tfor\tour\tcustomers\tis\tcritical,\tthough,\tand\twe\tcan’t\tafford\tfor it\tto\tbe\tdown.\tBy\tsplitting\tthese\ttwo\tcapabilities\tinto\tseparate\tservices,\twe\treduce\tthe\tload on\tthe\tcritical\taccounts\tservice,\tand\tintroduce\ta\tnew\taccounts\treporting\tservice\tthat\tis designed\tnot\tonly\twith\tquerying\tin\tmind\t(perhaps\tusing\tsome\tof\tthe\ttechniques\twe outlined\tin\tChapter\t4,\tbut\talso\tas\ta\tnoncritical\tsystem\tdoesn’t\tneed\tto\tbe\tdeployed\tin\tas resilient\ta\tway\tas\tthe\tcore\taccounts\tservice.\n\nSpreading\tYour\tRisk\n\nOne\tway\tto\tscale\tfor\tresilience\tis\tto\tensure\tthat\tyou\tdon’t\tput\tall\tyour\teggs\tin\tone\tbasket. A\tsimplistic\texample\tof\tthis\tis\tmaking\tsure\tthat\tyou\tdon’t\thave\tmultiple\tservices\ton\tone host,\twhere\tan\toutage\twould\timpact\tmultiple\tservices.\tBut\tlet’s\tconsider\twhat\thost\tmeans. In\tmost\tsituations\tnowadays,\ta\thost\tis\tactually\ta\tvirtual\tconcept.\tSo\twhat\tif\tI\thave\tall\tof my\tservices\ton\tdifferent\thosts,\tbut\tall\tthose\thosts\tare\tactually\tvirtual\thosts,\trunning\ton\tthe same\tphysical\tbox?\tIf\tthat\tbox\tgoes\tdown,\tI\tcould\tlose\tmultiple\tservices.\tSome virtualization\tplatforms\tenable\tyou\tto\tensure\tthat\tyour\thosts\tare\tdistributed\tacross multiple\tdifferent\tphysical\tboxes\tto\treduce\tthis\tchance.\n\nFor\tinternal\tvirtualization\tplatforms,\tit\tis\ta\tcommon\tpractice\tto\thave\tthe\tvirtual\tmachine’s root\tpartition\tmapped\tto\ta\tsingle\tSAN\t(storage\tarea\tnetwork).\tIf\tthat\tSAN\tgoes\tdown,\tit can\ttake\tdown\tall\tconnected\tVMs.\tSANs\tare\tbig,\texpensive,\tand\tdesigned\tnot\tto\tfail.\tThat said,\tI\thave\thad\tbig\texpensive\tSANs\tfail\ton\tme\tat\tleast\ttwice\tin\tthe\tlast\t10\tyears,\tand\teach time\tthe\tresults\twere\tfairly\tserious.\n\nAnother\tcommon\tform\tof\tseparation\tto\treduce\tfailure\tis\tto\tensure\tthat\tnot\tall\tyour\tservices are\trunning\tin\ta\tsingle\track\tin\tthe\tdata\tcenter,\tor\tthat\tyour\tservices\tare\tdistributed\tacross more\tthan\tone\tdata\tcenter.\tIf\tyou’re\tusing\tan\tunderlying\tservice\tprovider,\tit\tis\timportant\tto know\tif\ta\tservice-level\tagreement\t(SLA)\tis\toffered\tand\tplan\taccordingly.\tIf\tyou\tneed\tto ensure\tyour\tservices\tare\tdown\tfor\tno\tmore\tthan\tfour\thours\tevery\tquarter,\tbut\tyour\thosting provider\tcan\tonly\tguarantee\ta\tdowntime\tof\teight\thours\tper\tquarter,\tyou\thave\tto\teither change\tthe\tSLA,\tor\tcome\tup\twith\tan\talternative\tsolution.\n\nAWS,\tfor\texample,\tis\tsplit\tinto\tregions,\twhich\tyou\tcan\tthink\tof\tas\tdistinct\tclouds.\tEach region\tis\tin\tturn\tsplit\tinto\ttwo\tor\tmore\tavailability\tzones\t(AZs).\tAZs\tare\tAWS’s\tequivalent of\ta\tdata\tcenter.\tIt\tis\tessential\tto\thave\tservices\tdistributed\tacross\tmultiple\tavailability zones,\tas\tAWS\tdoes\tnot\toffer\tany\tguarantees\tabout\tthe\tavailability\tof\ta\tsingle\tnode,\tor even\tan\tentire\tavailability\tzone.\tFor\tits\tcompute\tservice,\tit\toffers\tonly\ta\t99.95%\tuptime over\ta\tgiven\tmonthly\tperiod\tof\tthe\tregion\tas\ta\twhole,\tso\tyou’ll\twant\tto\tdistribute\tyour workloads\tacross\tmultiple\tavailability\tzones\tinside\ta\tsingle\tregion.\tFor\tsome\tpeople,\tthis isn’t\tgood\tenough,\tand\tinstead\tthey\trun\ttheir\tservices\tacross\tmultiple\tregions\ttoo.\n\nIt\tshould\tbe\tnoted,\tof\tcourse,\tthat\tbecause\tproviders\tgive\tyou\tan\tSLA\tguarantee,\tthey\twill tend\tto\tlimit\ttheir\tliability!\tIf\tthem\tmissing\ttheir\ttargets\tcosts\tyou\tcustomers\tand\ta\tlarge amount\tof\tmoney,\tyou\tmight\tfind\tyourself\tsearching\tthrough\tcontracts\tto\tsee\tif\tyou\tcan claw\tanything\tback\tfrom\tthem.\tTherefore,\tI\twould\tstrongly\tsuggest\tyou\tunderstand\tthe impact\tof\ta\tsupplier\tfailing\tin\tits\tobligations\tto\tyou,\tand\twork\tout\tif\tyou\tneed\tto\thave\ta plan\tB\t(or\tC)\tin\tyour\tpocket.\tMore\tthan\tone\tclient\tI’ve\tworked\twith\thas\thad\ta\tdisaster recovery\thosting\tplatform\twith\ta\tdifferent\tsupplier,\tfor\texample,\tto\tensure\tthey\tweren’t too\tvulnerable\tto\tthe\tmistakes\tof\tone\tcompany.\n\nLoad\tBalancing\n\nWhen\tyou\tneed\tyour\tservice\tto\tbe\tresilient,\tyou\twant\tto\tavoid\tsingle\tpoints\tof\tfailure.\tFor a\ttypical\tmicroservice\tthat\texposes\ta\tsynchronous\tHTTP\tendpoint,\tthe\teasiest\tway\tto achieve\tthis\tis\tto\thave\tmultiple\thosts\trunning\tyour\tmicroservice\tinstance,\tsitting\tbehind\ta load\tbalancer,\tas\tshown\tin\tFigure\t11-4.\tTo\tconsumers\tof\tthe\tmicroservice,\tyou\tdon’t\tknow if\tyou\tare\ttalking\tto\tone\tmicroservice\tinstance\tor\ta\thundred.\n\nFigure\t11-4.\tAn\texample\tof\ta\tload\tbalancing\tapproach\tto\tscale\tthe\tnumber\tof\tcustomer\tservice\tinstances\n\nLoad\tbalancers\tcome\tin\tall\tshapes\tand\tsizes,\tfrom\tbig\tand\texpensive\thardware\tappliances to\tsoftware-based\tload\tbalancers\tlike\tmod_proxy.\tThey\tall\tshare\tsome\tkey\tcapabilities. They\tdistribute\tcalls\tsent\tto\tthem\tto\tone\tor\tmore\tinstances\tbased\ton\tsome\talgorithm, remove\tinstances\twhen\tthey\tare\tno\tlonger\thealthy,\tand\thopefully\tadd\tthem\tback\tin\twhen they\tare.\n\nSome\tload\tbalancers\tprovide\tuseful\tfeatures.\tA\tcommon\tone\tis\tSSL\ttermination,\twhere inbound\tHTTPS\tconnections\tto\tthe\tload\tbalancer\tare\ttransformed\tto\tHTTP\tconnections once\tthey\thit\tthe\tinstance\titself.\tHistorically,\tthe\toverhead\tof\tmanaging\tSSL\twas significant\tenough\tthat\thaving\ta\tload\tbalancer\thandle\tthis\tprocess\tfor\tyou\twas\tfairly useful.\tNowadays,\tthis\tis\tas\tmuch\tabout\tsimplifying\tthe\tset-up\tof\tthe\tindividual\thosts running\tthe\tinstance.\tThe\tpoint\tof\tusing\tHTTPS,\tthough,\tis\tto\tensure\tthat\tthe\trequests aren’t\tvulnerable\tto\ta\tman-in-the-middle\tattack,\tas\twe\tdiscussed\tin\tChapter\t9,\tso\tif\twe\tuse SSL\ttermination,\twe\tare\tpotentially\texposing\tourselves\tsomewhat.\tOne\tmitigation\tis\tto have\tall\tthe\tinstances\tof\tthe\tmicroservice\tinside\ta\tsingle\tVLAN,\tas\twe\tsee\tin\tFigure\t11-5. A\tVLAN\tis\ta\tvirtual\tlocal\tarea\tnetwork,\tthat\tis\tisolated\tin\tsuch\ta\tway\tthat\trequests\tfrom outside\tit\tcan\tcome\tonly\tvia\ta\trouter,\tand\tin\tthis\tcase\tour\trouter\tis\talso\tour\tSSL- terminating\tload\tbalancer.\tThe\tonly\tcommunication\tto\tthe\tmicroservice\tfrom\toutside\tthe VLAN\tcomes\tover\tHTTPS,\tbut\tinternally\teverything\tis\tHTTP.\n\nFigure\t11-5.\tUsing\tHTTPS\ttermination\tat\tthe\tload\tbalancer\twith\ta\tVLAN\tfor\timproved\tsecurity\n\nAWS\tprovides\tHTTPS-terminating\tload\tbalancers\tin\tthe\tform\tof\tELBs\t(elastic\tload balancers)\tand\tyou\tcan\tuse\tits\tsecurity\tgroups\tor\tvirtual\tprivate\tclouds\t(VPCs)\tto implement\tthe\tVLAN.\tOtherwise,\tsoftware\tlike\tmod_proxy\tcan\tplay\ta\tsimilar\trole\tas\ta software\tload\tbalancer.\tMany\torganizations\thave\thardware\tload\tbalancers,\twhich\tcan\tbe difficult\tto\tautomate.\tIn\tsuch\tcircumstances\tI\thave\tfound\tmyself\tadvocating\tfor\tsoftware load\tbalancers\tsitting\tbehind\tthe\thardware\tload\tbalancers\tto\tallow\tteams\tthe\tfreedom\tto reconfigure\tthese\tas\trequired.\tYou\tdo\twant\tto\twatch\tfor\tthe\tfact\tthat\tall\ttoo\toften\tthe hardware\tload\tbalancers\tthemselves\tare\tsingle\tpoints\tof\tfailure!\tWhatever\tapproach\tyou take,\twhen\tconsidering\tthe\tconfiguration\tof\ta\tload\tbalancer,\ttreat\tit\tas\tyou\ttreat\tthe configuration\tof\tyour\tservice:\tmake\tsure\tit\tis\tstored\tin\tversion\tcontrol\tand\tcan\tbe\tapplied automatically.\n\nLoad\tbalancers\tallow\tus\tto\tadd\tmore\tinstances\tof\tour\tmicroservice\tin\ta\tway\tthat\tis transparent\tto\tany\tservice\tconsumers.\tThis\tgives\tus\tan\tincreased\tability\tto\thandle\tload, and\talso\treduce\tthe\timpact\tof\ta\tsingle\thost\tfailing.\tHowever,\tmany,\tif\tnot\tmost,\tof\tyour microservices\twill\thave\tsome\tsort\tof\tpersistent\tdata\tstore,\tprobably\ta\tdatabase\tsitting\ton\ta different\tmachine.\tIf\twe\thave\tmultiple\tmicroservice\tinstances\ton\tdifferent\tmachines,\tbut only\ta\tsingle\thost\trunning\tthe\tdatabase\tinstance,\tour\tdatabase\tis\tstill\ta\tsingle\tsource\tof failure.\tWe’ll\ttalk\tabout\tpatterns\tto\thandle\tthis\tshortly.\n\nWorker-Based\tSystems\n\nLoad\tbalancing\tisn’t\tthe\tonly\tway\tto\thave\tmultiple\tinstances\tof\tyour\tservice\tshare\tload and\treduce\tfragility.\tDepending\ton\tthe\tnature\tof\tthe\toperations,\ta\tworker-based\tsystem could\tbe\tjust\tas\teffective.\tHere,\ta\tcollection\tof\tinstances\tall\twork\ton\tsome\tshared\tbacklog of\twork.\tThis\tcould\tbe\ta\tnumber\tof\tHadoop\tprocesses,\tor\tperhaps\ta\tnumber\tof\tlisteners\tto a\tshared\tqueue\tof\twork.\tThese\ttypes\tof\toperations\tare\twell\tsuited\tto\tbatch\twork\tor asynchronous\tjobs.\tThink\tof\ttasks\tlike\timage\tthumbnail\tprocessing,\tsending\temail,\tor generating\treports.\n\nThe\tmodel\talso\tworks\twell\tfor\tpeaky\tload,\twhere\tyou\tcan\tspin\tup\tadditional\tinstances\ton demand\tto\tmatch\tthe\tload\tcoming\tin.\tAs\tlong\tas\tthe\twork\tqueue\titself\tis\tresilient,\tthis model\tcan\tbe\tused\tto\tscale\tboth\tfor\timproved\tthroughput\tof\twork,\tbut\talso\tfor\timproved resiliency\t—\tthe\timpact\tof\ta\tworker\tfailing\t(or\tnot\tbeing\tthere)\tis\teasy\tto\tdeal\twith.\tWork will\ttake\tlonger,\tbut\tnothing\tgets\tlost.\n\nI’ve\tseen\tthis\twork\twell\tin\torganizations\twhere\tthere\tis\tlots\tof\tunused\tcompute\tcapacity\tat certain\ttimes\tof\tday.\tFor\texample,\tovernight\tyou\tmight\tnot\tneed\tas\tmany\tmachines\tto\trun your\tecommerce\tsystem,\tso\tyou\tcan\ttemporarily\tuse\tthem\tto\trun\tworkers\tfor\ta\treporting job\tinstead.\n\nWith\tworker-based\tsystems,\talthough\tthe\tworkers\tthemselves\tdon’t\tneed\tto\tbe\tthat reliable,\tthe\tsystem\tthat\tcontains\tthe\twork\tto\tbe\tdone\tdoes.\tYou\tcould\thandle\tthis\tby running\ta\tpersistent\tmessage\tbroker,\tfor\texample,\tor\tperhaps\ta\tsystem\tlike\tZookeeper.\tThe benefit\there\tis\tthat\tif\twe\tuse\texisting\tsoftware\tfor\tthis\tpurpose,\tsomeone\thas\tdone\tmuch\tof the\thard\twork\tfor\tus.\tHowever,\twe\tstill\tneed\tto\tknow\thow\tto\tset\tup\tand\tmaintain\tthese systems\tin\ta\tresilient\tfashion.\n\nStarting\tAgain\n\nThe\tarchitecture\tthat\tgets\tyou\tstarted\tmay\tnot\tbe\tthe\tarchitecture\tthat\tkeeps\tyou\tgoing when\tyour\tsystem\thas\tto\thandle\tvery\tdifferent\tvolumes\tof\tload.\tAs\tJeff\tDean\tsaid\tin\this presentation\t“Challenges\tin\tBuilding\tLarge-Scale\tInformation\tRetrieval\tSystems” (WSDM\t2009\tconference),\tyou\tshould\t“design\tfor\t~10×\tgrowth,\tbut\tplan\tto\trewrite before\t~100×.”\tAt\tcertain\tpoints,\tyou\tneed\tto\tdo\tsomething\tpretty\tradical\tto\tsupport\tthe next\tlevel\tof\tgrowth.\n\nRecall\tthe\tstory\tof\tGilt,\twhich\twe\ttouched\ton\tin\tChapter\t6.\tA\tsimple\tmonolithic\tRails application\tdid\twell\tfor\tGilt\tfor\ttwo\tyears.\tIts\tbusiness\tbecame\tincreasingly\tsuccessful, which\tmeant\tmore\tcustomers\tand\tmore\tload.\tAt\ta\tcertain\ttipping\tpoint,\tthe\tcompany\thad to\tredesign\tthe\tapplication\tto\thandle\tthe\tload\tit\twas\tseeing.\n\nA\tredesign\tmay\tmean\tsplitting\tapart\tan\texisting\tmonolith,\tas\tit\tdid\tfor\tGilt.\tOr\tit\tmight mean\tpicking\tnew\tdata\tstores\tthat\tcan\thandle\tthe\tload\tbetter,\twhich\twe’ll\tlook\tat\tin\ta moment.\tIt\tcould\talso\tmean\tadopting\tnew\ttechniques,\tsuch\tas\tmoving\tfrom\tsynchronous request/response\tto\tevent-based\tsystems,\tadopting\tnew\tdeployment\tplatforms,\tchanging whole\ttechnology\tstacks,\tor\teverything\tin\tbetween.\n\nThere\tis\ta\tdanger\tthat\tpeople\twill\tsee\tthe\tneed\tto\trearchitect\twhen\tcertain\tscaling thresholds\tare\treached\tas\ta\treason\tto\tbuild\tfor\tmassive\tscale\tfrom\tthe\tbeginning.\tThis\tcan be\tdisastrous.\tAt\tthe\tstart\tof\ta\tnew\tproject,\twe\toften\tdon’t\tknow\texactly\twhat\twe\twant\tto build,\tnor\tdo\twe\tknow\tif\tit\twill\tbe\tsuccessful.\tWe\tneed\tto\tbe\table\tto\trapidly\texperiment, and\tunderstand\twhat\tcapabilities\twe\tneed\tto\tbuild.\tIf\twe\ttried\tbuilding\tfor\tmassive\tscale up\tfront,\twe’d\tend\tup\tfront-loading\ta\thuge\tamount\tof\twork\tto\tprepare\tfor\tload\tthat\tmay never\tcome,\twhile\tdiverting\teffort\taway\tfrom\tmore\timportant\tactivities,\tlike understanding\tif\tanyone\twill\twant\tto\tactually\tuse\tour\tproduct.\tEric\tRies\ttells\tthe\tstory\tof spending\tsix\tmonths\tbuilding\ta\tproduct\tthat\tno\tone\tever\tdownloaded.\tHe\treflected\tthat\the could\thave\tput\tup\ta\tlink\ton\ta\tweb\tpage\tthat\t404’d\twhen\tpeople\tclicked\ton\tit\tto\tsee\tif\tthere was\tany\tdemand,\tspent\tsix\tmonths\ton\tthe\tbeach\tinstead,\tand\tlearned\tjust\tas\tmuch!\n\nThe\tneed\tto\tchange\tour\tsystems\tto\tdeal\twith\tscale\tisn’t\ta\tsign\tof\tfailure.\tIt\tis\ta\tsign\tof success.\n\nScaling\tDatabases\n\nScaling\tstateless\tmicroservices\tis\tfairly\tstraightforward.\tBut\twhat\tif\twe\tare\tstoring\tdata\tin a\tdatabase?\tWe’ll\tneed\tto\tknow\thow\tto\tscale\tthat\ttoo.\tDifferent\ttypes\tof\tdatabases\tprovide different\tforms\tof\tscaling,\tand\tunderstanding\twhat\tform\tsuits\tyour\tuse\tcase\tbest\twill ensure\tyou\tselect\tthe\tright\tdatabase\ttechnology\tfrom\tthe\tbeginning.\n\nAvailability\tof\tService\tVersus\tDurability\tof\tData\n\nStraight\toff,\tit\tis\timportant\tto\tseparate\tthe\tconcept\tof\tavailability\tof\tthe\tservice\tfrom\tthe durability\tof\tthe\tdata\titself.\tYou\tneed\tto\tunderstand\tthat\tthese\tare\ttwo\tdifferent\tthings,\tand as\tsuch\tthey\twill\thave\tdifferent\tsolutions.\n\nFor\texample,\tI\tcould\tstore\ta\tcopy\tof\tall\tdata\twritten\tto\tmy\tdatabase\tin\ta\tresilient filesystem.\tIf\tthe\tdatabase\tgoes\tdown,\tmy\tdata\tisn’t\tlost,\tas\tI\thave\ta\tcopy,\tbut\tthe\tdatabase itself\tisn’t\tavailable,\twhich\tmay\tmake\tmy\tmicroservice\tunavailable\ttoo.\tA\tmore\tcommon model\twould\tbe\tusing\ta\tstandby.\tAll\tdata\twritten\tto\tthe\tprimary\tdatabase\tgets\tcopied\tto the\tstandby\treplica\tdatabase.\tIf\tthe\tprimary\tgoes\tdown,\tmy\tdata\tis\tsafe,\tbut\twithout\ta mechanism\tto\teither\tbring\tit\tback\tup\tor\tpromote\tthe\treplica\tto\tthe\tprimary,\twe\tdon’t\thave an\tavailable\tdatabase,\teven\tthough\tour\tdata\tis\tsafe.\n\nScaling\tfor\tReads\n\nMany\tservices\tare\tread-mostly.\tThink\tof\ta\tcatalog\tservice\tthat\tstores\tinformation\tfor\tthe items\twe\thave\tfor\tsale.\tWe\tadd\trecords\tfor\tnew\titems\ton\ta\tfairly\tirregular\tbasis,\tand\tit wouldn’t\tat\tall\tbe\tsurprising\tif\twe\tget\tmore\tthan\t100\treads\tof\tour\tcatalog’s\tdata\tfor\tevery write.\tHappily,\tscaling\tfor\treads\tis\tmuch\teasier\tthan\tscaling\tfor\twrites.\tCaching\tof\tdata can\tplay\ta\tlarge\tpart\there,\tand\twe’ll\tdiscuss\tthat\tin\tmore\tdepth\tshortly.\tAnother\tmodel\tis to\tmake\tuse\tof\tread\treplicas.\n\nIn\ta\trelational\tdatabase\tmanagement\tsystem\t(RDBMS)\tlike\tMySQL\tor\tPostgres,\tdata\tcan be\tcopied\tfrom\ta\tprimary\tnode\tto\tone\tor\tmore\treplicas.\tThis\tis\toften\tdone\tto\tensure\tthat\ta copy\tof\tour\tdata\tis\tkept\tsafe,\tbut\twe\tcan\talso\tuse\tit\tto\tdistribute\tour\treads.\tA\tservice\tcould direct\tall\twrites\tto\tthe\tsingle\tprimary\tnode,\tbut\tdistribute\treads\tto\tone\tor\tmore\tread replicas,\tas\twe\tsee\tin\tFigure\t11-6.\tThe\treplication\tfrom\tthe\tprimary\tdatabase\tto\tthe replicas\thappens\tat\tsome\tpoint\tafter\tthe\twrite.\tThis\tmeans\tthat\twith\tthis\ttechnique\treads may\tsometimes\tsee\tstale\tdata\tuntil\tthe\treplication\thas\tcompleted.\tEventually\tthe\treads will\tsee\tthe\tconsistent\tdata.\tSuch\ta\tsetup\tis\tcalled\teventually\tconsistent,\tand\tif\tyou\tcan handle\tthe\ttemporary\tinconsistency\tit\tis\ta\tfairly\teasy\tand\tcommon\tway\tto\thelp\tscale systems.\tWe’ll\tlook\tinto\tthis\tin\tmore\tdepth\tshortly\twhen\twe\tlook\tat\tthe\tCAP\ttheorem.\n\nFigure\t11-6.\tUsing\tread\treplicas\tto\tscale\treads\n\nYears\tago,\tusing\tread\treplicas\tto\tscale\twas\tall\tthe\trage,\talthough\tnowadays\tI\twould suggest\tyou\tlook\tto\tcaching\tfirst,\tas\tit\tcan\tdeliver\tmuch\tmore\tsignificant\timprovements\tin performance,\toften\twith\tless\twork.\n\nScaling\tfor\tWrites\n\nReads\tare\tcomparatively\teasy\tto\tscale.\tWhat\tabout\twrites?\tOne\tapproach\tis\tto\tuse sharding.\tWith\tsharding,\tyou\thave\tmultiple\tdatabase\tnodes.\tYou\ttake\ta\tpiece\tof\tdata\tto\tbe written,\tapply\tsome\thashing\tfunction\tto\tthe\tkey\tof\tthe\tdata,\tand\tbased\ton\tthe\tresult\tof\tthe function\tlearn\twhere\tto\tsend\tthe\tdata.\tTo\tpick\ta\tvery\tsimplistic\t(and\tactually\tbad) example,\timagine\tthat\tcustomer\trecords\tA–M\tgo\tto\tone\tdatabase\tinstance,\tand\tN–Z another.\tYou\tcan\tmanage\tthis\tyourself\tin\tyour\tapplication,\tbut\tsome\tdatabases,\tlike Mongo,\thandle\tmuch\tof\tit\tfor\tyou.\n\nThe\tcomplexity\twith\tsharding\tfor\twrites\tcomes\tfrom\thandling\tqueries.\tLooking\tup\tan individual\trecord\tis\teasy,\tas\tI\tcan\tjust\tapply\tthe\thashing\tfunction\tto\tfind\twhich\tinstance the\tdata\tshould\tbe\ton,\tand\tthen\tretrieve\tit\tfrom\tthe\tcorrect\tshard.\tBut\twhat\tabout\tqueries that\tspan\tthe\tdata\tin\tmultiple\tnodes\t—\tfor\texample,\tfinding\tall\tthe\tcustomers\twho\tare\tover 18?\tIf\tyou\twant\tto\tquery\tall\tshards,\tyou\teither\tneed\tto\tquery\teach\tindividual\tshard\tand join\tin\tmemory,\tor\thave\tan\talternative\tread\tstore\twhere\tboth\tdata\tsets\tare\tavailable.\tOften querying\tacross\tshards\tis\thandled\tby\tan\tasynchronous\tmechanism,\tusing\tcached\tresults. Mongo\tuses\tmap/reduce\tjobs,\tfor\texample,\tto\tperform\tthese\tqueries.\n\nOne\tof\tthe\tquestions\tthat\temerges\twith\tsharded\tsystems\tis,\twhat\thappens\tif\tI\twant\tto\tadd an\textra\tdatabase\tnode?\tIn\tthe\tpast,\tthis\twould\toften\trequire\tsignificant\tdowntime\t— especially\tfor\tlarge\tclusters\t—\tas\tyou\tmight\thave\tto\ttake\tthe\tentire\tdatabase\tdown\tand rebalance\tthe\tdata.\tMore\trecently,\tmore\tsystems\tsupport\tadding\textra\tshards\tto\ta\tlive system,\twhere\tthe\trebalancing\tof\tdata\thappens\tin\tthe\tbackground;\tCassandra,\tfor\texample, handles\tthis\tvery\twell.\tAdding\tshards\tto\tan\texisting\tcluster\tisn’t\tfor\tthe\tfaint\tof\theart, though,\tso\tmake\tsure\tyou\ttest\tthis\tthoroughly.\n\nSharding\tfor\twrites\tmay\tscale\tfor\twrite\tvolume,\tbut\tmay\tnot\timprove\tresiliency.\tIf customer\trecords\tA–M\talways\tgo\tto\tInstance\tX,\tand\tInstance\tX\tis\tunavailable,\taccess\tto records\tA–M\tcan\tbe\tlost.\tCassandra\toffers\tadditional\tcapabilities\there,\twhere\twe\tcan ensure\tthat\tdata\tis\treplicated\tto\tmultiple\tnodes\tin\ta\tring\t(Cassandra’s\tterm\tfor\ta\tcollection of\tCassandra\tnodes).\n\nAs\tyou\tmay\thave\tinferred\tfrom\tthis\tbrief\toverview,\tscaling\tdatabases\tfor\twrites\tare\twhere things\tget\tvery\ttricky,\tand\twhere\tthe\tcapabilities\tof\tthe\tvarious\tdatabases\treally\tstart\tto become\tdifferentiated.\tI\toften\tsee\tpeople\tchanging\tdatabase\ttechnology\twhen\tthey\tstart hitting\tlimits\ton\thow\teasily\tthey\tcan\tscale\ttheir\texisting\twrite\tvolume.\tIf\tthis\thappens\tto you,\tbuying\ta\tbigger\tbox\tis\toften\tthe\tquickest\tway\tto\tsolve\tthe\tproblem,\tbut\tin\tthe background\tyou\tmight\twant\tto\tlook\tat\tsystems\tlike\tCassandra,\tMongo,\tor\tRiak\tto\tsee\tif their\talternative\tscaling\tmodels\tmight\toffer\tyou\ta\tbetter\tlong-term\tsolution.\n\nShared\tDatabase\tInfrastructure\n\nSome\ttypes\tof\tdatabases,\tsuch\tas\tthe\ttraditional\tRDBMS,\tseparate\tthe\tconcept\tof\tthe database\titself\tand\tthe\tschema.\tThis\tmeans\tone\trunning\tdatabase\tcould\thost\tmultiple, independent\tschemas,\tone\tfor\teach\tmicroservice.\tThis\tcan\tbe\tvery\tuseful\tin\tterms\tof reducing\tthe\tnumber\tof\tmachines\twe\tneed\tto\trun\tour\tsystem,\tbut\twe\tare\tintroducing\ta significant\tsingle\tpoint\tof\tfailure.\tIf\tthis\tdatabase\tinfrastructure\tgoes\tdown,\tit\tcan\timpact multiple\tmicroservices\tat\tonce,\tpotentially\tresulting\tin\ta\tcatastrophic\toutage.\tIf\tyou\tare running\tthis\tsort\tof\tsetup,\tmake\tsure\tyou\tconsider\tthe\trisks.\tAnd\tbe\tvery\tsure\tthat\tthe database\titself\tis\tas\tresilient\tas\tit\tcan\tbe.\n\nCQRS\n\nThe\tCommand-Query\tResponsibility\tSegregation\t(CQRS)\tpattern\trefers\tto\tan\talternate model\tfor\tstoring\tand\tquerying\tinformation.\tWith\tnormal\tdatabases,\twe\tuse\tone\tsystem for\tperforming\tmodifications\tto\tdata\tand\tquerying\tthe\tdata.\tWith\tCQRS,\tpart\tof\tthe system\tdeals\twith\tcommands,\twhich\tcapture\trequests\tto\tmodify\tstate,\twhile\tanother\tpart of\tthe\tsystem\tdeals\twith\tqueries.\n\nCommands\tcome\tin\trequesting\tchanges\tin\tstate.\tThese\tcommands\tare\tvalidated,\tand\tif they\twork,\tthey\twill\tbe\tapplied\tto\tthe\tmodel.\tCommands\tshould\tcontain\tinformation\tabout their\tintent.\tThey\tcan\tbe\tprocessed\tsynchronously\tor\tasynchronously,\tallowing\tfor different\tmodels\tto\thandle\tscaling;\twe\tcould,\tfor\texample,\tjust\tqueue\tup\tinbound\trequests and\tprocess\tthem\tlater.\n\nThe\tkey\ttakeaway\there\tis\tthat\tthe\tinternal\tmodels\tused\tto\thandle\tcommands\tand\tqueries are\tthemselves\tcompletely\tseparate.\tFor\texample,\tI\tmight\tchoose\tto\thandle\tand\tprocess commands\tas\tevents,\tperhaps\tjust\tstoring\tthe\tlist\tof\tcommands\tin\ta\tdata\tstore\t(a\tprocess known\tas\tevent\tsourcing).\tMy\tquery\tmodel\tcould\tquery\tan\tevent\tstore\tand\tcreate projections\tfrom\tstored\tevents\tto\tassemble\tthe\tstate\tof\tdomain\tobjects,\tor\tcould\tjust\tpick up\ta\tfeed\tfrom\tthe\tcommand\tpart\tof\tthe\tsystem\tto\tupdate\ta\tdifferent\ttype\tof\tstore.\tIn\tmany ways,\twe\tget\tthe\tsame\tbenefits\tof\tread\treplicas\tthat\twe\tdiscussed\tearlier,\twithout\tthe requirement\tthat\tthe\tbacking\tstore\tfor\tthe\treplicas\tbe\tthe\tsame\tas\tthe\tdata\tstore\tused\tto handle\tdata\tmodifications.\n\nThis\tform\tof\tseparation\tallows\tfor\tdifferent\ttypes\tof\tscaling.\tThe\tcommand\tand\tquery parts\tof\tour\tsystem\tcould\tlive\tin\tdifferent\tservices,\tor\ton\tdifferent\thardware,\tand\tcould make\tuse\tof\tradically\tdifferent\ttypes\tof\tdata\tstore.\tThis\tcan\tunlock\ta\tlarge\tnumber\tof\tways to\thandle\tscale.\tYou\tcould\teven\tsupport\tdifferent\ttypes\tof\tread\tformat\tby\thaving\tmultiple implementations\tof\tthe\tquery\tpiece,\tperhaps\tsupporting\ta\tgraph-based\trepresentation\tof your\tdata,\tor\ta\tkey/value-based\tform\tof\tyour\tdata.\n\nBe\twarned,\thowever:\tthis\tsort\tof\tpattern\tis\tquite\ta\tshift\taway\tfrom\ta\tmodel\twhere\ta\tsingle data\tstore\thandles\tall\tour\tCRUD\toperations.\tI’ve\tseen\tmore\tthan\tone\texperienced development\tteam\tstruggle\tto\tget\tthis\tpattern\tright!\n\nCaching\n\nCaching\tis\ta\tcommonly\tused\tperformance\toptimization\twhereby\tthe\tprevious\tresult\tof some\toperation\tis\tstored,\tso\tthat\tsubsequent\trequests\tcan\tuse\tthis\tstored\tvalue\trather\tthan spending\ttime\tand\tresources\trecalculating\tthe\tvalue.\tMore\toften\tthan\tnot,\tcaching\tis\tabout eliminating\tneedless\tround-trips\tto\tdatabases\tor\tother\tservices\tto\tserve\tresults\tfaster.\tUsed well,\tit\tcan\tyield\thuge\tperformance\tbenefits.\tThe\treason\tthat\tHTTP\tscales\tso\twell\tin handling\tlarge\tnumbers\tof\trequests\tis\tthat\tthe\tconcept\tof\tcaching\tis\tbuilt\tin.\n\nEven\twith\ta\tsimple\tmonolithic\tweb\tapplication,\tthere\tare\tquite\ta\tfew\tchoices\tas\tto\twhere and\thow\tto\tcache.\tWith\ta\tmicroservice\tarchitecture,\twhere\teach\tservice\tis\tits\town\tsource of\tdata\tand\tbehavior,\twe\thave\tmany\tmore\tchoices\tto\tmake\tabout\twhere\tand\thow\tto\tcache. With\ta\tdistributed\tsystem,\twe\ttypically\tthink\tof\tcaching\teither\ton\tthe\tclient\tside\tor\ton\tthe server\tside.\tBut\twhich\tis\tbest?\n\nClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\nIn\tclient-side\tcaching,\tthe\tclient\tstores\tthe\tcached\tresult.\tThe\tclient\tgets\tto\tdecide\twhen (and\tif)\tit\tgoes\tand\tretrieves\ta\tfresh\tcopy.\tIdeally,\tthe\tdownstream\tservice\twill\tprovide hints\tto\thelp\tthe\tclient\tunderstand\twhat\tto\tdo\twith\tthe\tresponse,\tso\tit\tknows\twhen\tand\tif\tto make\ta\tnew\trequest.\tWith\tproxy\tcaching,\ta\tproxy\tis\tplaced\tbetween\tthe\tclient\tand\tthe server.\tA\tgreat\texample\tof\tthis\tis\tusing\ta\treverse\tproxy\tor\tcontent\tdelivery\tnetwork (CDN).\tWith\tserver-side\tcaching,\tthe\tserver\thandles\tcaching\tresponsibility,\tperhaps making\tuse\tof\ta\tsystem\tlike\tRedis\tor\tMemcache,\tor\teven\ta\tsimple\tin-memory\tcache.\n\nWhich\tone\tmakes\tthe\tmost\tsense\tdepends\ton\twhat\tyou\tare\ttrying\tto\toptimize.\tClient-side caching\tcan\thelp\treduce\tnetwork\tcalls\tdrastically,\tand\tcan\tbe\tone\tof\tthe\tfastest\tways\tof reducing\tload\ton\ta\tdownstream\tservice.\tIn\tthis\tcase,\tthe\tclient\tis\tin\tcharge\tof\tthe\tcaching behavior,\tand\tif\tyou\twant\tto\tmake\tchanges\tto\thow\tcaching\tis\tdone,\trolling\tout\tchanges\tto a\tnumber\tof\tconsumers\tcould\tbe\tdifficult.\tInvalidation\tof\tstale\tdata\tcan\talso\tbe\ttrickier, although\twe’ll\tdiscuss\tsome\tcoping\tmechanisms\tfor\tthis\tin\ta\tmoment.\n\nWith\tproxy\tcaching,\teverything\tis\topaque\tto\tboth\tthe\tclient\tand\tserver.\tThis\tis\toften\ta\tvery simple\tway\tto\tadd\tcaching\tto\tan\texisting\tsystem.\tIf\tthe\tproxy\tis\tdesigned\tto\tcache\tgeneric traffic,\tit\tcan\talso\tcache\tmore\tthan\tone\tservice;\ta\tcommon\texample\tis\ta\treverse\tproxy\tlike Squid\tor\tVarnish,\twhich\tcan\tcache\tany\tHTTP\ttraffic.\tHaving\ta\tproxy\tbetween\tthe\tclient and\tserver\tdoes\tintroduce\tadditional\tnetwork\thops,\talthough\tin\tmy\texperience\tit\tis\tvery rare\tthat\tthis\tcauses\tproblems,\tas\tthe\tperformance\toptimizations\tresulting\tfrom\tthe caching\titself\toutweigh\tany\tadditional\tnetwork\tcosts.\n\nWith\tserver-side\tcaching,\teverything\tis\topaque\tto\tthe\tclients;\tthey\tdon’t\tneed\tto\tworry about\tanything.\tWith\ta\tcache\tnear\tor\tinside\ta\tservice\tboundary,\tit\tcan\tbe\teasier\tto\treason about\tthings\tlike\tinvalidation\tof\tdata,\tor\ttrack\tand\toptimize\tcache\thits.\tIn\ta\tsituation\twhere you\thave\tmultiple\ttypes\tof\tclients,\ta\tserver-side\tcache\tcould\tbe\tthe\tfastest\tway\tto\timprove performance.\n\nFor\tevery\tpublic-facing\twebsite\tI’ve\tworked\ton,\twe’ve\tended\tup\tdoing\ta\tmix\tof\tall\tthree approaches.\tBut\tfor\tmore\tthan\tone\tdistributed\tsystem,\tI’ve\tgotten\taway\twith\tno\tcaching\tat all.\tBut\tit\tall\tcomes\tdown\tto\tknowing\twhat\tload\tyou\tneed\tto\thandle,\thow\tfresh\tyour\tdata needs\tto\tbe,\tand\twhat\tyour\tsystem\tcan\tdo\tright\tnow.\tKnowing\tthat\tyou\thave\ta\tnumber\tof different\ttools\tat\tyour\tdisposal\tis\tjust\tthe\tbeginning.\n\nCaching\tin\tHTTP\n\nHTTP\tprovides\tsome\treally\tuseful\tcontrols\tto\thelp\tus\tcache\teither\ton\tthe\tclient\tside\tor server\tside,\twhich\tare\tworth\tunderstanding\teven\tif\tyou\taren’t\tusing\tHTTP\titself.\n\nFirst,\twith\tHTTP,\twe\tcan\tuse\tcache-control\tdirectives\tin\tour\tresponses\tto\tclients.\tThese tell\tclients\tif\tthey\tshould\tcache\tthe\tresource\tat\tall,\tand\tif\tso\thow\tlong\tthey\tshould\tcache\tit for\tin\tseconds.\tWe\talso\thave\tthe\toption\tof\tsetting\tan\tExpires\theader,\twhere\tinstead\tof saying\thow\tlong\ta\tpiece\tof\tcontent\tcan\tbe\tcached\tfor,\twe\tspecify\ta\ttime\tand\tdate\tat\twhich a\tresource\tshould\tbe\tconsidered\tstale\tand\tfetched\tagain.\tThe\tnature\tof\tthe\tresources\tyou are\tsharing\tdetermines\twhich\tone\tis\tmost\tlikely\tto\tfit.\tStandard\tstatic\twebsite\tcontent\tlike CSS\tor\timages\toften\tfit\twell\twith\ta\tsimple\tcache-control\ttime\tto\tlive\t(TTL).\tOn\tthe other\thand,\tif\tyou\tknow\tin\tadvance\twhen\ta\tnew\tversion\tof\ta\tresource\twill\tbe\tupdated, setting\tan\tExpires\theader\twill\tmake\tmore\tsense.\tAll\tof\tthis\tis\tvery\tuseful\tin\tstopping\ta client\tfrom\teven\tneeding\tto\tmake\ta\trequest\tto\tthe\tserver\tin\tthe\tfirst\tplace.\n\nAside\tfrom\tcache-control\tand\tExpires,\twe\thave\tanother\toption\tin\tour\tarsenal\tof\tHTTP goodies:\tEntity\tTags,\tor\tETags.\tAn\tETag\tis\tused\tto\tdetermine\tif\tthe\tvalue\tof\ta\tresource\thas changed.\tIf\tI\tupdate\ta\tcustomer\trecord,\tthe\tURI\tto\tthe\tresource\tis\tthe\tsame,\tbut\tthe\tvalue is\tdifferent,\tso\tI\twould\texpect\tthe\tETag\tto\tchange.\tThis\tbecomes\tpowerful\twhen\twe’re using\twhat\tis\tcalled\ta\tconditional\tGET.\tWhen\tmaking\ta\tGET\trequest,\twe\tcan\tspecify additional\theaders,\ttelling\tthe\tservice\tto\tsend\tus\tthe\tresource\tonly\tif\tsome\tcriteria\tare\tmet.\n\nFor\texample,\tlet’s\timagine\twe\tfetch\ta\tcustomer\trecord,\tand\tits\tETag\tcomes\tback\tas o5t6fkd2sa.\tLater\ton,\tperhaps\tbecause\ta\tcache-control\tdirective\thas\ttold\tus\tthe\tresource should\tbe\tconsidered\tstale,\twe\twant\tto\tmake\tsure\twe\tget\tthe\tlatest\tversion.\tWhen\tissuing the\tsubsequent\tGET\trequest,\twe\tcan\tpass\tin\ta\tIf-None-Match:\to5t6fkd2sa.\tThis\ttells\tthe server\tthat\twe\twant\tthe\tresource\tat\tthe\tspecified\tURI,\tunless\tit\talready\tmatches\tthis\tETag value.\tIf\twe\talready\thave\tthe\tup-to-date\tversion,\tthe\tservice\tsends\tus\ta\t304\tNot\tModified response,\ttelling\tus\twe\thave\tthe\tlatest\tversion.\tIf\tthere\tis\ta\tnewer\tversion\tavailable,\twe\tget a\t200\tOK\twith\tthe\tchanged\tresource,\tand\ta\tnew\tETag\tfor\tthe\tresource.\n\nThe\tfact\tthat\tthese\tcontrols\tare\tbuilt\tinto\tsuch\ta\twidely\tused\tspecification\tmeans\twe\tget\tto take\tadvantage\tof\ta\tlot\tof\tpreexisting\tsoftware\tthat\thandles\tthe\tcaching\tfor\tus.\tReverse proxies\tlike\tSquid\tor\tVarnish\tcan\tsit\ttransparently\ton\tthe\tnetwork\tbetween\tclient\tand server,\tstoring\tand\texpiring\tcached\tcontent\tas\trequired.\tThese\tsystems\tare\tgeared\ttoward serving\thuge\tnumbers\tof\tconcurrent\trequests\tvery\tfast,\tand\tare\ta\tstandard\tway\tof\tscaling public-facing\twebsites.\tCDNs\tlike\tAWS’s\tCloudFront\tor\tAkamai\tcan\tensure\tthat\trequests are\trouted\tto\tcaches\tnear\tthe\tcalling\tclient,\tmaking\tsure\tthat\ttraffic\tdoesn’t\tgo\thalfway round\tthe\tworld\twhen\tit\tneeds\tto.\tAnd\tmore\tprosaically,\tHTTP\tclient\tlibraries\tand\tclient caches\tcan\thandle\ta\tlot\tof\tthis\twork\tfor\tus.\n\nETags,\tExpires,\tand\tcache-control\tcan\toverlap\ta\tbit,\tand\tif\tyou\taren’t\tcareful\tyou\tcan end\tup\tgiving\tconflicting\tinformation\tif\tyou\tdecide\tto\tuse\tall\tof\tthem!\tFor\ta\tmore\tin-depth\n\ndiscussion\tof\tthe\tvarious\tmerits,\ttake\ta\tlook\tat\tthe\tbook\tREST\tIn\tPractice\t(O’Reilly)\tor read\tsection\t13\tof\tthe\tHTTP\t1.1\tspecification,\twhich\tdescribes\thow\tboth\tclients\tand servers\tare\tsupposed\tto\timplement\tthese\tvarious\tcontrols.\n\nWhether\tyou\tdecide\tto\tuse\tHTTP\tas\tan\tinterservice\tprotocol,\tcaching\tat\tthe\tclient\tand reducing\tthe\tneed\tfor\tround-trips\tto\tthe\tclient\tis\twell\tworth\tit.\tIf\tyou\tdecide\tto\tpick\ta different\tprotocol,\tunderstand\twhen\tand\thow\tyou\tcan\tprovide\thints\tto\tthe\tclient\tto\thelp\tit understand\thow\tlong\tit\tcan\tcache\tfor.\n\nCaching\tfor\tWrites\n\nAlthough\tyou’ll\tfind\tyourself\tusing\tcaching\tfor\treads\tmore\toften,\tthere\tare\tsome\tuse\tcases where\tcaching\tfor\twrites\tmake\tsense.\tFor\texample,\tif\tyou\tmake\tuse\tof\ta\twrite-behind cache,\tyou\tcan\twrite\tto\ta\tlocal\tcache,\tand\tat\tsome\tlater\tpoint\tthe\tdata\twill\tbe\tflushed\tto\ta downstream\tsource,\tprobably\tthe\tcanonical\tsource\tof\tdata.\tThis\tcan\tbe\tuseful\twhen\tyou have\tbursts\tof\twrites,\tor\twhen\tthere\tis\ta\tgood\tchance\tthat\tthe\tsame\tdata\twill\tbe\twritten multiple\ttimes.\tWhen\tused\tto\tbuffer\tand\tpotentially\tbatch\twrites,\twrite-behind\tcaches\tcan be\ta\tuseful\tfurther\tperformance\toptimization.\n\nWith\ta\twrite-behind\tcache,\tif\tthe\tbuffered\twrites\tare\tsuitably\tpersistent,\teven\tif\tthe downstream\tservice\tis\tunavailable\twe\tcould\tqueue\tup\tthe\twrites\tand\tsend\tthem\tthrough when\tit\tis\tavailable\tagain.\n\nCaching\tfor\tResilience\n\nCaching\tcan\tbe\tused\tto\timplement\tresiliency\tin\tcase\tof\tfailure.\tWith\tclient-side\tcaching,\tif the\tdownstream\tservice\tis\tunavailable,\tthe\tclient\tcould\tdecide\tto\tsimply\tuse\tcached\tbut potentially\tstale\tdata.\tWe\tcould\talso\tuse\tsomething\tlike\ta\treverse\tproxy\tto\tserve\tup\tstale data.\tFor\tsome\tsystems,\tbeing\tavailable\teven\twith\tstale\tdata\tis\tbetter\tthan\tnot\treturning\ta result\tat\tall,\tbut\tthat\tis\ta\tjudgment\tcall\tyou’ll\thave\tto\tmake.\tObviously,\tif\twe\tdon’t\thave the\trequested\tdata\tin\tthe\tcache,\tthen\twe\tcan’t\tdo\tmuch\tto\thelp,\tbut\tthere\tare\tways\tto mitigate\tthis.\n\nA\ttechnique\tI\tsaw\tused\tat\tthe\tGuardian,\tand\tsubsequently\telsewhere,\twas\tto\tcrawl\tthe existing\tlive\tsite\tperiodically\tto\tgenerate\ta\tstatic\tversion\tof\tthe\twebsite\tthat\tcould\tbe served\tin\tthe\tevent\tof\tan\toutage.\tAlthough\tthis\tcrawled\tversion\twasn’t\tas\tfresh\tas\tthe cached\tcontent\tserved\tfrom\tthe\tlive\tsystem,\tin\ta\tpinch\tit\tcould\tensure\tthat\ta\tversion\tof\tthe site\twould\tget\tdisplayed.\n\nHiding\tthe\tOrigin\n\nWith\ta\tnormal\tcache,\tif\ta\trequest\tresults\tin\ta\tcache\tmiss,\tthe\trequest\tgoes\ton\tto\tthe\torigin to\tfetch\tthe\tfresh\tdata\twith\tthe\tcaller\tblocking,\twaiting\ton\tthe\tresult.\tIn\tthe\tnormal\tcourse of\tthings,\tthis\tis\tto\tbe\texpected.\tBut\tif\twe\tsuffer\ta\tmassive\tcache\tmiss,\tperhaps\tbecause\tan entire\tmachine\t(or\tgroup\tof\tmachines)\tthat\tprovide\tour\tcache\tfail,\ta\tlarge\tnumber\tof requests\twill\thit\tthe\torigin.\n\nFor\tthose\tservices\tthat\tserve\tup\thighly\tcachable\tdata,\tit\tis\tcommon\tfor\tthe\torigin\titself\tto be\tscaled\tto\thandle\tonly\ta\tfraction\tof\tthe\ttotal\ttraffic,\tas\tmost\trequests\tget\tserved\tout\tof memory\tby\tthe\tcaches\tthat\tsit\tin\tfront\tof\tthe\torigin.\tIf\twe\tsuddenly\tget\ta\tthundering\therd due\tto\tan\tentire\tcache\tregion\tvanishing,\tour\torigin\tcould\tbe\tpummelled\tout\tof\texistence.\n\nOne\tway\tto\tprotect\tthe\torigin\tin\tsuch\ta\tsituation\tis\tnever\tto\tallow\trequests\tto\tgo\tto\tthe origin\tin\tthe\tfirst\tplace.\tInstead,\tthe\torigin\titself\tpopulates\tthe\tcache\tasynchronously\twhen needed,\tas\tshown\tin\tFigure\t11-7.\tIf\ta\tcache\tmiss\tis\tcaused,\tthis\ttriggers\tan\tevent\tthat\tthe origin\tcan\tpick\tup\ton,\talerting\tit\tthat\tit\tneeds\tto\trepopulate\tthe\tcache.\tSo\tif\tan\tentire\tshard has\tvanished,\twe\tcan\trebuild\tthe\tcache\tin\tthe\tbackground.\tWe\tcould\tdecide\tto\tblock\tthe original\trequest\twaiting\tfor\tthe\tregion\tto\tbe\trepopulated,\tbut\tthis\tcould\tcause\tcontention on\tthe\tcache\titself,\tleading\tto\tfurther\tproblems.\tIt’s\tmore\tlikely\tif\twe\tare\tprioritizing keeping\tthe\tsystem\tstable\tthat\twe\twould\tfail\tthe\toriginal\trequest,\tbut\tit\twould\tfail\tfast.\n\nFigure\t11-7.\tHiding\tthe\torigin\tfrom\tthe\tclient\tand\tpopulating\tthe\tcache\tasynchronously\n\nThis\tsort\tof\tapproach\tmay\tnot\tmake\tsense\tfor\tsome\tsituations,\tbut\tit\tcan\tbe\ta\tway\tto ensure\tthe\tsystem\tremains\tup\twhen\tparts\tof\tit\tfail.\tBy\tfailing\trequests\tfast,\tand\tensuring we\tdon’t\ttake\tup\tresources\tor\tincrease\tlatency,\twe\tavoid\ta\tfailure\tin\tour\tcache\tfrom cascading\tdownstream\tand\tgive\tourselves\ta\tchance\tto\trecover.\n\nKeep\tIt\tSimple\n\nBe\tcareful\tabout\tcaching\tin\ttoo\tmany\tplaces!\tThe\tmore\tcaches\tbetween\tyou\tand\tthe source\tof\tfresh\tdata,\tthe\tmore\tstale\tthe\tdata\tcan\tbe,\tand\tthe\tharder\tit\tcan\tbe\tto\tdetermine the\tfreshness\tof\tthe\tdata\tthat\ta\tclient\teventually\tsees.\tThis\tcan\tbe\tespecially\tproblematic with\ta\tmicroservice\tarchitecture\twhere\tyou\thave\tmultiple\tservices\tinvolved\tin\ta\tcall\tchain. Again,\tthe\tmore\tcaching\tyou\thave,\tthe\tharder\tit\twill\tbe\tto\tassess\tthe\tfreshness\tof\tany\tpiece of\tdata.\tSo\tif\tyou\tthink\ta\tcache\tis\ta\tgood\tidea,\tkeep\tit\tsimple,\tstick\tto\tone,\tand\tthink carefully\tbefore\tadding\tmore!\n\nCache\tPoisoning:\tA\tCautionary\tTale\n\nWith\tcaching\twe\toften\tthink\tthat\tif\twe\tget\tit\twrong\tthe\tworst\tthing\tthat\tcan\thappen\tis\twe serve\tstale\tdata\tfor\ta\tbit.\tBut\twhat\thappens\tif\tyou\tend\tup\tserving\tstale\tdata\tforever? Earlier\tI\tmentioned\tthe\tproject\tI\tworked\ton\twhere\twe\twere\tusing\ta\tstrangler\tapplication\tto help\tintercept\tcalls\tto\tmultiple\tlegacy\tsystems\twith\ta\tview\tof\tincrementally\tretiring\tthem. Our\tapplication\toperated\teffectively\tas\ta\tproxy.\tTraffic\tto\tour\tapplication\twas\trouted through\tto\tthe\tlegacy\tapplication.\tOn\tthe\tway\tback,\twe\tdid\ta\tfew\thousekeeping\tthings;\tfor example,\twe\tmade\tsure\tthat\tthe\tresults\tfrom\tthe\tlegacy\tapplication\thad\tproper\tHTTP cache\theaders\tapplied.\n\nOne\tday,\tshortly\tafter\ta\tnormal\troutine\trelease,\tsomething\todd\tstarted\thappening.\tA\tbug had\tbeen\tintroduced\twhereby\ta\tsmall\tsubset\tof\tpages\twere\tfalling\tthrough\ta\tlogic condition\tin\tour\tcache\theader\tinsertion\tcode,\tresulting\tin\tus\tnot\tchanging\tthe\theader\tat\tall. Unfortunately,\tthis\tdownstream\tapplication\thad\talso\tbeen\tchanged\tsometime\tpreviously\tto include\tan\tExpires:\tNever\tHTTP\theader.\tThis\thadn’t\thad\tany\teffect\tearlier,\tas\twe\twere overriding\tthis\theader.\tNow\twe\tweren’t.\n\nOur\tapplication\tmade\theavy\tuse\tof\tSquid\tto\tcache\tHTTP\ttraffic,\tand\twe\tnoticed\tthe problem\tquite\tquickly\tas\twe\twere\tseeing\tmore\trequests\tbypassing\tSquid\titself\tto\thit\tour application\tservers.\tWe\tfixed\tthe\tcache\theader\tcode\tand\tpushed\tout\ta\trelease,\tand\talso manually\tcleared\tthe\trelevant\tregion\tof\tthe\tSquid\tcache.\tHowever,\tthat\twasn’t\tenough.\n\nAs\tI\tmentioned\tearlier,\tyou\tcan\tcache\tin\tmultiple\tplaces.\tWhen\tit\tcomes\tto\tserving\tup content\tto\tusers\tof\ta\tpublic-facing\tweb\tapplication,\tyou\tcould\thave\tmultiple\tcaches between\tyou\tand\tyour\tcustomer.\tNot\tonly\tmight\tyou\tbe\tfronting\tyour\twebsite\twith something\tlike\ta\tCDN,\tbut\tsome\tISPs\tmake\tuse\tof\tcaching.\tCan\tyou\tcontrol\tthose\tcaches? And\teven\tif\tyou\tcould,\tthere\tis\tone\tcache\tthat\tyou\thave\tlittle\tcontrol\tover:\tthe\tcache\tin\ta user’s\tbrowser.\n\nThose\tpages\twith\tExpires:\tNever\tstuck\tin\tthe\tcaches\tof\tmany\tof\tour\tusers,\tand\twould never\tbe\tinvalidated\tuntil\tthe\tcache\tbecame\tfull\tor\tthe\tuser\tcleaned\tthem\tout\tmanually. Clearly\twe\tcouldn’t\tmake\teither\tthing\thappen;\tour\tonly\toption\twas\tto\tchange\tthe\tURLs\tof these\tpages\tso\tthey\twere\trefetched.\n\nCaching\tcan\tbe\tvery\tpowerful\tindeed,\tbut\tyou\tneed\tto\tunderstand\tthe\tfull\tpath\tof\tdata\tthat is\tcached\tfrom\tsource\tto\tdestination\tto\treally\tappreciate\tits\tcomplexities\tand\twhat\tcan\tgo wrong.\n\nAutoscaling\n\nIf\tyou\tare\tlucky\tenough\tto\thave\tfully\tautomatable\tprovisioning\tof\tvirtual\thosts,\tand\tcan fully\tautomate\tthe\tdeployment\tof\tyour\tmicroservice\tinstances,\tthen\tyou\thave\tthe\tbuilding blocks\tto\tallow\tyou\tto\tautomatically\tscale\tyour\tmicroservices.\n\nFor\texample,\tyou\tcould\talso\thave\tthe\tscaling\ttriggered\tby\twell-known\ttrends.\tYou\tmight know\tthat\tyour\tsystem’s\tpeak\tload\tis\tbetween\t9\ta.m.\tand\t5\tp.m.,\tso\tyou\tbring\tup additional\tinstances\tat\t8:45\ta.m.,\tand\tturn\tthem\toff\tat\t5:15\tp.m..\tIf\tyou’re\tusing\tsomething like\tAWS\t(which\thas\tvery\tgood\tsupport\tfor\tautoscaling\tbuilt\tin),\tturning\toff\tinstances\tyou don’t\tneed\tany\tlonger\twill\thelp\tsave\tmoney.\tYou’ll\tneed\tdata\tto\tunderstand\thow\tyour\tload changes\tover\ttime,\tfrom\tday\tto\tday,\tweek\tto\tweek.\tSome\tbusinesses\thave\tobvious seasonal\tcycles\ttoo,\tso\tyou\tmay\tneed\tdata\tgoing\tback\ta\tfair\tway\tto\tmake\tproper\tjudgment calls.\n\nOn\tthe\tother\thand,\tyou\tcould\tbe\treactive,\tbringing\tup\tadditional\tinstances\twhen\tyou\tsee an\tincrease\tin\tload\tor\tan\tinstance\tfailure,\tand\tremove\tinstances\twhen\tyou\tno\tlonger needed\tthem.\tKnowing\thow\tfast\tyou\tcan\tscale\tup\tonce\tyou\tspot\tan\tupward\ttrend\tis\tkey.\tIf you\tknow\tyou’ll\tonly\tget\ta\tcouple\tof\tminutes’\tnotice\tabout\tan\tincrease\tin\tload,\tbut\tscaling up\twill\ttake\tyou\tat\tleast\t10\tminutes,\tyou\tknow\tyou’ll\tneed\tto\tkeep\textra\tcapacity\taround to\tbridge\tthis\tgap.\tHaving\ta\tgood\tsuite\tof\tload\ttests\tis\talmost\tessential\there.\tYou\tcan\tuse them\tto\ttest\tyour\tautoscaling\trules.\tIf\tyou\tdon’t\thave\ttests\tthat\tcan\treproduce\tdifferent loads\tthat\twill\ttrigger\tscaling,\tthen\tyou’re\tonly\tgoing\tto\tfind\tout\tin\tproduction\tif\tyou\tgot the\trules\twrong.\tAnd\tthe\tconsequences\tof\tfailure\taren’t\tgreat!\n\nA\tnews\tsite\tis\ta\tgreat\texample\tof\ta\ttype\tof\tbusiness\twhere\tyou\tmay\twant\ta\tmix\tof predictive\tand\treactive\tscaling.\tOn\tthe\tlast\tnews\tsite\tI\tworked\ton,\twe\tsaw\tvery\tclear\tdaily trends,\twith\tviews\tclimbing\tfrom\tthe\tmorning\tto\tlunchtime\tand\tthen\tstarting\tto\tdecline. This\tpattern\twas\trepeated\tday\tin,\tday\tout,\twith\ttraffic\tless\tpronounced\tat\tthe\tweekend. That\tgave\tyou\ta\tfairly\tclear\ttrend\tthat\tcould\tdrive\tproactive\tscaling\tup\t(and\tdown)\tof resources.\tOn\tthe\tother\thand,\ta\tbig\tnews\tstory\twould\tcause\tan\tunexpected\tspike,\trequiring more\tcapacity\tat\toften\tshort\tnotice.\n\nI\tactually\tsee\tautoscaling\tused\tmuch\tmore\tfor\thandling\tfailure\tof\tinstances\tthan\tfor reacting\tto\tload\tconditions.\tAWS\tlets\tyou\tspecify\trules\tlike\t“There\tshould\tbe\tat\tleast\t5 instances\tin\tthis\tgroup,”\tso\tif\tone\tgoes\tdown\ta\tnew\tone\tis\tautomatically\tlaunched.\tI’ve seen\tthis\tapproach\tlead\tto\ta\tfun\tgame\tof\twhack-a-mole\twhen\tsomeone\tforgets\tto\tturn\toff the\trule\tand\tthen\ttries\tto\ttake\tdown\tthe\tinstances\tfor\tmaintenance,\tonly\tto\tsee\tthem\tkeep spinning\tup!\n\nBoth\treactive\tand\tpredictive\tscaling\tare\tvery\tuseful,\tand\tcan\thelp\tyou\tbe\tmuch\tmore\tcost effective\tif\tyou’re\tusing\ta\tplatform\tthat\tallows\tyou\tto\tpay\tonly\tfor\tthe\tcomputing resources\tyou\tuse.\tBut\tthey\talso\trequire\tcareful\tobservation\tof\tthe\tdata\tavailable\tto\tyou. I’d\tsuggest\tusing\tautoscaling\tfor\tfailure\tconditions\tfirst\twhile\tyou\tcollect\tthe\tdata.\tOnce\n\nyou\twant\tto\tstart\tscaling\tfor\tload,\tmake\tsure\tyou\tare\tvery\tcautious\tabout\tscaling\tdown\ttoo quickly.\tIn\tmost\tsituations,\thaving\tmore\tcomputing\tpower\tat\tyour\thands\tthan\tyou\tneed\tis much\tbetter\tthan\tnot\thaving\tenough!\n\nCAP\tTheorem\n\nWe’d\tlike\tto\thave\tit\tall,\tbut\tunfortunately\twe\tknow\twe\tcan’t.\tAnd\twhen\tit\tcomes\tto distributed\tsystems\tlike\tthose\twe\tbuild\tusing\tmicroservice\tarchitectures,\twe\teven\thave\ta mathematical\tproof\tthat\ttells\tus\twe\tcan’t.\tYou\tmay\twell\thave\theard\tabout\tthe\tCAP theorem,\tespecially\tin\tdiscussions\tabout\tthe\tmerits\tof\tvarious\tdifferent\ttypes\tof\tdata stores.\tAt\tits\theart\tit\ttells\tus\tthat\tin\ta\tdistributed\tsystem,\twe\thave\tthree\tthings\twe\tcan\ttrade off\tagainst\teach\tother:\tconsistency,\tavailability,\tand\tpartition\ttolerance.\tSpecifically,\tthe theorem\ttells\tus\tthat\twe\tget\tto\tkeep\ttwo\tin\ta\tfailure\tmode.\n\nConsistency\tis\tthe\tsystem\tcharacteristic\tby\twhich\tI\twill\tget\tthe\tsame\tanswer\tif\tI\tgo\tto multiple\tnodes.\tAvailability\tmeans\tthat\tevery\trequest\treceives\ta\tresponse.\tPartition tolerance\tis\tthe\tsystem’s\tability\tto\thandle\tthe\tfact\tthat\tcommunication\tbetween\tits\tparts\tis sometimes\timpossible.\n\nSince\tEric\tBrewer\tpublished\this\toriginal\tconjecture,\tthe\tidea\thas\tgained\ta\tmathematical proof.\tI’m\tnot\tgoing\tto\tdive\tinto\tthe\tmath\tof\tthe\tproof\titself,\tas\tnot\tonly\tis\tthis\tnot\tthat sort\tof\tbook,\tbut\tI\tcan\talso\tguarantee\tthat\tI\twould\tget\tit\twrong.\tInstead,\tlet’s\tuse\tsome worked\texamples\tthat\twill\thelp\tus\tunderstand\tthat\tunder\tit\tall,\tthe\tCAP\ttheorem\tis\ta distillation\tof\ta\tvery\tlogical\tset\tof\treasoning.\n\nWe’ve\talready\ttalked\tabout\tsome\tsimple\tdatabase\tscaling\ttechniques.\tLet’s\tuse\tone\tof these\tto\tprobe\tthe\tideas\tbehind\tthe\tCAP\ttheorem.\tLet’s\timagine\tthat\tour\tinventory\tservice is\tdeployed\tacross\ttwo\tseparate\tdata\tcenters,\tas\tshown\tin\tFigure\t11-8.\tBacking\tour\tservice instance\tin\teach\tdata\tcenter\tis\ta\tdatabase,\tand\tthese\ttwo\tdatabases\ttalk\tto\teach\tother\tto\ttry to\tsynchronize\tdata\tbetween\tthem.\tReads\tand\twrites\tare\tdone\tvia\tthe\tlocal\tdatabase\tnode, and\treplication\tis\tused\tto\tsynchronize\tthe\tdata\tbetween\tthe\tnodes.\n\nNow\tlet’s\tthink\tabout\twhat\thappens\twhen\tsomething\tfails.\tImagine\tthat\tsomething\tas simple\tas\tthe\tnetwork\tlink\tbetween\tthe\ttwo\tdata\tcenters\tstops\tworking.\tThe synchronization\tat\tthis\tpoint\tfails.\tWrites\tmade\tto\tthe\tprimary\tdatabase\tin\tDC1\twill\tnot propagate\tto\tDC2,\tand\tvice\tversa.\tMost\tdatabases\tthat\tsupport\tthese\tsetups\talso\tsupport some\tsort\tof\tqueuing\ttechnique\tto\tensure\tthat\twe\tcan\trecover\tfrom\tthis\tafterward,\tbut what\thappens\tin\tthe\tmeantime?\n\nFigure\t11-8.\tUsing\tmultiprimary\treplication\tto\tshare\tdata\tbetween\ttwo\tdatabase\tnodes\n\nSacrificing\tConsistency\n\nLet’s\tassume\tthat\twe\tdon’t\tshut\tthe\tinventory\tservice\tdown\tentirely.\tIf\tI\tmake\ta\tchange now\tto\tthe\tdata\tin\tDC1,\tthe\tdatabase\tin\tDC2\tdoesn’t\tsee\tit.\tThis\tmeans\tany\trequests\tmade to\tour\tinventory\tnode\tin\tDC2\tsee\tpotentially\tstale\tdata.\tIn\tother\twords,\tour\tsystem\tis\tstill available\tin\tthat\tboth\tnodes\tare\table\tto\tserve\trequests,\tand\twe\thave\tkept\tthe\tsystem running\tdespite\tthe\tpartition,\tbut\twe\thave\tlost\tconsistency.\tThis\tis\toften\tcalled\ta\tAP system.\tWe\tdon’t\tget\tto\tkeep\tall\tthree.\n\nDuring\tthis\tpartition,\tif\twe\tkeep\taccepting\twrites\tthen\twe\taccept\tthe\tfact\tthat\tat\tsome point\tin\tthe\tfuture\tthey\thave\tto\tbe\tresynchronized.\tThe\tlonger\tthe\tpartition\tlasts,\tthe\tmore difficult\tthis\tresynchronization\tcan\tbecome.\n\nThe\treality\tis\tthat\teven\tif\twe\tdon’t\thave\ta\tnetwork\tfailure\tbetween\tour\tdatabase\tnodes, replication\tof\tdata\tis\tnot\tinstantaneous.\tAs\ttouched\ton\tearlier,\tsystems\tthat\tare\thappy\tto cede\tconsistency\tto\tkeep\tpartition\ttolerance\tand\tavailability\tare\tsaid\tto\tbe\teventually consistent;\tthat\tis,\twe\texpect\tat\tsome\tpoint\tin\tthe\tfuture\tthat\tall\tnodes\twill\tsee\tthe\tupdated data,\tbut\tit\twon’t\thappen\tat\tonce\tso\twe\thave\tto\tlive\twith\tthe\tpossibility\tthat\tusers\tsee\told data.\n\nSacrificing\tAvailability\n\nWhat\thappens\tif\twe\tneed\tto\tkeep\tconsistency\tand\twant\tto\tdrop\tsomething\telse\tinstead? Well,\tto\tkeep\tconsistency,\teach\tdatabase\tnode\tneeds\tto\tknow\tthe\tcopy\tof\tthe\tdata\tit\thas\tis the\tsame\tas\tthe\tother\tdatabase\tnode.\tNow\tin\tthe\tpartition,\tif\tthe\tdatabase\tnodes\tcan’t\ttalk to\teach\tother,\tthey\tcannot\tcoordinate\tto\tensure\tconsistency.\tWe\tare\tunable\tto\tguarantee consistency,\tso\tour\tonly\toption\tis\tto\trefuse\tto\trespond\tto\tthe\trequest.\tIn\tother\twords,\twe have\tsacrificed\tavailability.\tOur\tsystem\tis\tconsistent\tand\tpartition\ttolerant,\tor\tCP.\tIn\tthis mode\tour\tservice\twould\thave\tto\twork\tout\thow\tto\tdegrade\tfunctionality\tuntil\tthe\tpartition is\thealed\tand\tthe\tdatabase\tnodes\tcan\tbe\tresynchronized.\n\nConsistency\tacross\tmultiple\tnodes\tis\treally\thard.\tThere\tare\tfew\tthings\t(perhaps\tnothing) harder\tin\tdistributed\tsystems.\tThink\tabout\tit\tfor\ta\tmoment.\tImagine\tI\twant\tto\tread\ta record\tfrom\tthe\tlocal\tdatabase\tnode.\tHow\tdo\tI\tknow\tit\tis\tup\tto\tdate?\tI\thave\tto\tgo\tand\task the\tother\tnode.\tBut\tI\talso\thave\tto\task\tthat\tdatabase\tnode\tto\tnot\tallow\tit\tto\tbe\tupdated while\tthe\tread\tcompletes;\tin\tother\twords,\tI\tneed\tto\tinitiate\ta\ttransactional\tread\tacross multiple\tdatabase\tnodes\tto\tensure\tconsistency.\tBut\tin\tgeneral\tpeople\tdon’t\tdo transactional\treads,\tdo\tthey?\tBecause\ttransactional\treads\tare\tslow.\tThey\trequire\tlocks.\tA read\tcan\tblock\tan\tentire\tsystem\tup.\tAll\tconsistent\tsystems\trequire\tsome\tlevel\tof\tlocking\tto do\ttheir\tjob.\n\nAs\twe’ve\talready\tdiscussed,\tdistributed\tsystems\thave\tto\texpect\tfailure.\tConsider\tour transactional\tread\tacross\ta\tset\tof\tconsistent\tnodes.\tI\task\ta\tremote\tnode\tto\tlock\ta\tgiven record\twhile\tthe\tread\tis\tinitiated.\tI\tcomplete\tthe\tread,\tand\task\tthe\tremote\tnode\tto\trelease its\tlock,\tbut\tnow\tI\tcan’t\ttalk\tto\tit.\tWhat\thappens\tnow?\tLocks\tare\treally\thard\tto\tget\tright even\tin\ta\tsingle\tprocess\tsystem,\tand\tare\tsignificantly\tmore\tdifficult\tto\timplement\twell\tin\ta distributed\tsystem.\n\nRemember\twhen\twe\ttalked\tabout\tdistributed\ttransactions\tin\tChapter\t5?\tThe\tcore\treason they\tare\tchallenging\tis\tbecause\tof\tthis\tproblem\twith\tensuring\tconsistency\tacross\tmultiple nodes.\n\nGetting\tmultinode\tconsistency\tright\tis\tso\thard\tthat\tI\twould\tstrongly,\tstrongly\tsuggest\tthat if\tyou\tneed\tit,\tdon’t\ttry\tto\tinvent\tit\tyourself.\tInstead,\tpick\ta\tdata\tstore\tor\tlock\tservice\tthat offers\tthese\tcharacteristics.\tConsul,\tfor\texample,\twhich\twe’ll\tdiscuss\tshortly,\timplements a\tstrongly\tconsistent\tkey/value\tstore\tdesigned\tto\tshare\tconfiguration\tbetween\tmultiple nodes.\tAlong\twith\t“Friends\tdon’t\tlet\tfriends\twrite\ttheir\town\tcrypto”\tshould\tgo\t“Friends don’t\tlet\tfriends\twrite\ttheir\town\tdistributed\tconsistent\tdata\tstore.”\tIf\tyou\tthink\tyou\tneed\tto write\tyour\town\tCP\tdata\tstore,\tread\tall\tthe\tpapers\ton\tthe\tsubject\tfirst,\tthen\tget\ta\tPhD,\tand then\tlook\tforward\tto\tspending\ta\tfew\tyears\tgetting\tit\twrong.\tMeanwhile,\tI’ll\tbe\tusing something\toff\tthe\tshelf\tthat\tdoes\tit\tfor\tme,\tor\tmore\tlikely\ttrying\treally\thard\tto\tbuild eventually\tconsistent\tAP\tsystems\tinstead.\n\nSacrificing\tPartition\tTolerance?\n\nWe\tget\tto\tpick\ttwo,\tright?\tSo\twe’ve\tgot\tour\teventually\tconsistent\tAP\tsystem.\tWe\thave\tour consistent,\tbut\thard\tto\tbuild\tand\tscale,\tCP\tsystem.\tWhy\tnot\ta\tCA\tsystem?\tWell,\thow\tcan we\tsacrifice\tpartition\ttolerance?\tIf\tour\tsystem\thas\tno\tpartition\ttolerance,\tit\tcan’t\trun\tover\ta network.\tIn\tother\twords,\tit\tneeds\tto\tbe\ta\tsingle\tprocess\toperating\tlocally.\tCA\tsystems don’t\texist\tin\tdistributed\tsystems.\n\nAP\tor\tCP?\n\nWhich\tis\tright,\tAP\tor\tCP?\tWell,\tthe\treality\tis\tit\tdepends.\tAs\tthe\tpeople\tbuilding\tthe system,\twe\tknow\tthe\ttrade-off\texists.\tWe\tknow\tthat\tAP\tsystems\tscale\tmore\teasily\tand\tare simpler\tto\tbuild,\tand\twe\tknow\tthat\ta\tCP\tsystem\twill\trequire\tmore\twork\tdue\tto\tthe challenges\tin\tsupporting\tdistributed\tconsistency.\tBut\twe\tmay\tnot\tunderstand\tthe\tbusiness impact\tof\tthis\ttrade-off.\tFor\tour\tinventory\tsystem,\tif\ta\trecord\tis\tout\tof\tdate\tby\tfive minutes,\tis\tthat\tOK?\tIf\tthe\tanswer\tis\tyes,\tan\tAP\tsystem\tmight\tbe\tthe\tanswer.\tBut\twhat about\tthe\tbalance\theld\tfor\ta\tcustomer\tin\ta\tbank?\tCan\tthat\tbe\tout\tof\tdate?\tWithout knowing\tthe\tcontext\tin\twhich\tthe\toperation\tis\tbeing\tused,\twe\tcan’t\tknow\tthe\tright\tthing\tto do.\tKnowing\tabout\tthe\tCAP\ttheorem\tjust\thelps\tyou\tunderstand\tthat\tthis\ttrade-off\texists and\twhat\tquestions\tto\task.\n\nIt’s\tNot\tAll\tor\tNothing\n\nOur\tsystem\tas\ta\twhole\tdoesn’t\tneed\tto\tbe\teither\tAP\tor\tCP.\tOur\tcatalog\tcould\tbe\tAP,\tas\twe don’t\tmind\ttoo\tmuch\tabout\ta\tstale\trecord.\tBut\twe\tmight\tdecide\tthat\tour\tinventory\tservice needs\tto\tbe\tCP,\tas\twe\tdon’t\twant\tto\tsell\ta\tcustomer\tsomething\twe\tdon’t\thave\tand\tthen have\tto\tapologize\tlater.\n\nBut\tindividual\tservices\tdon’t\teven\tneed\tto\tbe\tCP\tor\tAP.\n\nLet’s\tthink\tabout\tour\tpoints\tbalance\tservice,\twhere\twe\tstore\trecords\tof\thow\tmany\tloyalty points\tour\tcustomers\thave\tbuilt\tup.\tWe\tcould\tdecide\tthat\twe\tdon’t\tcare\tif\tthe\tbalance\twe show\tfor\ta\tcustomer\tis\tstale,\tbut\tthat\twhen\tit\tcomes\tto\tupdating\ta\tbalance\twe\tneed\tit\tto\tbe consistent\tto\tensure\tthat\tcustomers\tdon’t\tuse\tmore\tpoints\tthan\tthey\thave\tavailable.\tIs\tthis microservice\tCP,\tor\tAP,\tor\tis\tit\tboth?\tReally,\twhat\twe\thave\tdone\tis\tpush\tthe\ttrade-offs around\tthe\tCAP\ttheorem\tdown\tto\tindividual\tservice\tcapabilities.\n\nAnother\tcomplexity\tis\tthat\tneither\tconsistency\tnor\tavailability\tis\tall\tor\tnothing.\tMany systems\tallow\tus\ta\tfar\tmore\tnuanced\ttrade-off.\tFor\texample,\twith\tCassandra\tI\tcan\tmake different\ttrade-offs\tfor\tindividual\tcalls.\tSo\tif\tI\tneed\tstrict\tconsistency,\tI\tcan\tperform\ta\tread that\tblocks\tuntil\tall\treplicas\thave\tresponded\tconfirming\tthe\tvalue\tis\tconsistent,\tor\tuntil\ta specific\tquorum\tof\treplicas\thave\tresponded,\tor\teven\tjust\ta\tsingle\tnode.\tObviously,\tif\tI block\twaiting\tfor\tall\treplicas\tto\treport\tback\tand\tone\tof\tthem\tis\tunavailable,\tI’ll\tbe blocking\tfor\ta\tlong\ttime.\tBut\tif\tI\tam\tsatisfied\twith\tjust\ta\tsimple\tquorum\tof\tnodes reporting\tback,\tI\tcan\taccept\tsome\tlack\tof\tconsistency\tto\tbe\tless\tvulnerable\tto\ta\tsingle replica\tbeing\tunavailable.\n\nYou’ll\toften\tsee\tposts\tabout\tpeople\tbeating\tthe\tCAP\ttheorem.\tThey\thaven’t.\tWhat\tthey have\tdone\tis\tcreate\ta\tsystem\twhere\tsome\tcapabilities\tare\tCP,\tand\tsome\tare\tAP.\tThe mathematical\tproof\tbehind\tthe\tCAP\ttheorem\tholds.\tDespite\tmany\tattempts\tat\tschool,\tI’ve learned\tthat\tyou\tdon’t\tbeat\tmath.\n\nAnd\tthe\tReal\tWorld\n\nMuch\tof\twhat\twe’ve\ttalked\tabout\tis\tthe\telectronic\tworld\t—\tbits\tand\tbytes\tstored\tin memory.\tWe\ttalk\tabout\tconsistency\tin\tan\talmost\tchild-like\tfashion;\twe\timagine\tthat\twithin the\tscope\tof\tthe\tsystem\twe\thave\tcreated,\twe\tcan\tstop\tthe\tworld\tand\thave\tit\tall\tmake\tsense. And\tyet\tso\tmuch\tof\twhat\twe\tbuild\tis\tjust\ta\treflection\tof\tthe\treal\tworld,\tand\twe\tdon’t\tget\tto control\tthat,\tdo\twe?\n\nLet’s\trevisit\tour\tinventory\tsystem.\tThis\tmaps\tto\treal-world,\tphysical\titems.\tWe\tkeep\ta count\tin\tour\tsystem\tof\thow\tmany\talbums\twe\thave.\tAt\tthe\tstart\tof\tthe\tday\twe\thad\t100 copies\tof\tGive\tBlood\tby\tThe\tBrakes.\tWe\tsold\tone.\tNow\twe\thave\t99\tcopies.\tEasy,\tright? By\twhat\thappens\tif\twhen\tthe\torder\twas\tbeing\tsent\tout,\tsomeone\tknocks\ta\tcopy\tof\tthe album\tonto\tthe\tfloor\tand\tit\tgets\tstepped\ton\tand\tbroken?\tWhat\thappens\tnow?\tOur\tsystems say\t99,\tbut\tthere\tare\t98\tcopies\ton\tthe\tshelf.\n\nWhat\tif\twe\tmade\tour\tinventory\tsystem\tAP\tinstead,\tand\toccasionally\thad\tto\tcontact\ta\tuser later\ton\tand\ttell\thim\tthat\tone\tof\this\titems\tis\tactually\tout\tof\tstock?\tWould\tthat\tbe\tthe\tworst thing\tin\tthe\tworld?\tIt\twould\tcertainly\tbe\tmuch\teasier\tto\tbuild,\tscale,\tand\tensure\tit\tis correct.\n\nWe\thave\tto\trecognize\tthat\tno\tmatter\thow\tconsistent\tour\tsystems\tmight\tbe\tin\tand\tof themselves,\tthey\tcannot\tknow\teverything\tthat\thappens,\tespecially\twhen\twe’re\tkeeping records\tof\tthe\treal\tworld.\tThis\tis\tone\tof\tthe\tmain\treasons\twhy\tAP\tsystems\tend\tup\tbeing the\tright\tcall\tin\tmany\tsituations.\tAside\tfrom\tthe\tcomplexity\tof\tbuilding\tCP\tsystems,\tthey can’t\tfix\tall\tour\tproblems\tanyway.\n\nService\tDiscovery\n\nOnce\tyou\thave\tmore\tthan\ta\tfew\tmicroservices\tlying\taround,\tyour\tattention\tinevitably turns\tto\tknowing\twhere\ton\tearth\teverything\tis.\tPerhaps\tyou\twant\tto\tknow\twhat\tis\trunning in\ta\tgiven\tenvironment\tso\tyou\tknow\twhat\tyou\tshould\tbe\tmonitoring.\tMaybe\tit’s\tas\tsimple as\tknowing\twhere\tyour\taccounts\tservice\tis\tso\tthat\tthose\tmicroservices\tthat\tuse\tit\tknow where\tto\tfind\tit.\tOr\tperhaps\tyou\tjust\twant\tto\tmake\tit\teasy\tfor\tdevelopers\tin\tyour organization\tto\tknow\twhat\tAPIs\tare\tavailable\tso\tthey\tdon’t\treinvent\tthe\twheel.\tBroadly speaking,\tall\tof\tthese\tuse\tcases\tfall\tunder\tthe\tbanner\tof\tservice\tdiscovery.\tAnd\tas\talways with\tmicroservices,\twe\thave\tquite\ta\tfew\tdifferent\toptions\tat\tour\tdisposal\tfor\tdealing\twith it.\n\nAll\tof\tthe\tsolutions\twe’ll\tlook\tat\thandle\tthings\tin\ttwo\tparts.\tFirst,\tthey\tprovide\tsome mechanism\tfor\tan\tinstance\tto\tregister\titself\tand\tsay,\t“I’m\there!”\tSecond,\tthey\tprovide\ta way\tto\tfind\tthe\tservice\tonce\tit’s\tregistered.\tService\tdiscovery\tgets\tmore\tcomplicated, though,\twhen\twe\tare\tconsidering\tan\tenvironment\twhere\twe\tare\tconstantly\tdestroying\tand deploying\tnew\tinstances\tof\tservices.\tIdeally,\twe’d\twant\twhatever\tsolution\twe\tpick\tto\tcope with\tthis.\n\nLet’s\tlook\tat\tsome\tof\tthe\tmost\tcommon\tsolutions\tto\tservice\tdelivery\tand\tconsider\tour options.\n\nDNS\n\nIt’s\tnice\tto\tstart\tsimple.\tDNS\tlets\tus\tassociate\ta\tname\twith\tthe\tIP\taddress\tof\tone\tor\tmore machines.\tWe\tcould\tdecide,\tfor\texample,\tthat\tour\taccounts\tservice\tis\talways\tfound\tat accounts.musiccorp.com.\tWe\twould\tthen\thave\tthat\tentry\tpoint\tto\tthe\tIP\taddress\tof\tthe\thost running\tthat\tservice,\tor\tperhaps\thave\tit\tresolve\tto\ta\tload\tbalancer\tthat\tis\tdistributing\tload across\ta\tnumber\tof\tinstances.\tThis\tmeans\twe’d\thave\tto\thandle\tupdating\tthese\tentries\tas part\tof\tdeploying\tour\tservice.\n\nWhen\tdealing\twith\tinstances\tof\ta\tservice\tin\tdifferent\tenvironments,\tI\thave\tseen\ta convention-based\tdomain\ttemplate\twork\twell.\tFor\texample,\twe\tmight\thave\ta\ttemplate defined\tas\t<servicename>-<environment>.musiccorp.com,\tgiving\tus\tentries\tlike accounts-uat.musiccorp.com\tor\taccounts-dev.musiccorp.com.\n\nA\tmore\tadvanced\tway\tof\thandling\tdifferent\tenvironments\tis\tto\thave\tdifferent\tdomain name\tservers\tfor\tdifferent\tenvironments.\tSo\tI\tcould\tassume\tthat\taccounts.musiccorp.com is\twhere\tI\talways\tfind\tthe\taccounts\tservice,\tbut\tit\tcould\tresolve\tto\tdifferent\thosts depending\ton\twhere\tI\tdo\tthe\tlookup.\tIf\tyou\talready\thave\tyour\tenvironments\tsitting\tin different\tnetwork\tsegments\tand\tare\tcomfortable\twith\tmanaging\tyour\town\tDNS\tservers and\tentries,\tthis\tcould\tbe\tquite\ta\tneat\tsolution,\tbut\tit\tis\ta\tlot\tof\twork\tif\tyou\taren’t\tgetting other\tbenefits\tfrom\tthis\tsetup.\n\nDNS\thas\ta\thost\tof\tadvantages,\tthe\tmain\tone\tbeing\tit\tis\tsuch\ta\twell-understood\tand\twell- used\tstandard\tthat\talmost\tany\ttechnology\tstack\twill\tsupport\tit.\tUnfortunately,\twhile\ta number\tof\tservices\texist\tfor\tmanaging\tDNS\tinside\tan\torganization,\tfew\tof\tthem\tseem designed\tfor\tan\tenvironment\twhere\twe\tare\tdealing\twith\thighly\tdisposable\thosts,\tmaking updating\tDNS\tentries\tsomewhat\tpainful.\tAmazon’s\tRoute53\tservice\tdoes\ta\tpretty\tgood job\tof\tthis,\tbut\tI\thaven’t\tseen\ta\tself-hosted\toption\tthat\tis\tas\tgood\tyet,\talthough\t(as\twe’ll discuss\tshortly)\tConsul\tmay\thelp\tus\there.\tAside\tfrom\tthe\tproblems\tin\tupdating\tDNS entries,\tthe\tDNS\tspecification\titself\tcan\tcause\tus\tsome\tissues.\n\nDNS\tentries\tfor\tdomain\tnames\thave\ta\ttime\tto\tlive\t(TTL).\tThis\tis\thow\tlong\ta\tclient\tcan consider\tthe\tentry\tfresh.\tWhen\twe\twant\tto\tchange\tthe\thost\tto\twhich\tthe\tdomain\tname refers,\twe\tupdate\tthat\tentry,\tbut\twe\thave\tto\tassume\tthat\tclients\twill\tbe\tholding\ton\tto\tthe old\tIP\tfor\tat\tleast\tas\tlong\tas\tthe\tTTL\tstates.\tDNS\tentries\tcan\tget\tcached\tin\tmultiple\tplaces (even\tthe\tJVM\twill\tcache\tDNS\tentries\tunless\tyou\ttell\tit\tnot\tto),\tand\tthe\tmore\tplaces\tthey are\tcached\tin,\tthe\tmore\tstale\tthe\tentry\tcan\tbe.\n\nOne\tway\tto\twork\taround\tthis\tproblem\tis\tto\thave\tthe\tdomain\tname\tentry\tfor\tyour\tservice point\tto\ta\tload\tbalancer,\twhich\tin\tturn\tpoints\tto\tthe\tinstances\tof\tyour\tservice,\tas\tshown\tin Figure\t11-9.\tWhen\tyou\tdeploy\ta\tnew\tinstance,\tyou\tcan\ttake\tthe\told\tone\tout\tof\tthe\tload- balancer\tentry\tand\tadd\tthe\tnew\tone.\tSome\tpeople\tuse\tDNS\tround-robining,\twhere\tthe DNS\tentries\tthemselves\trefer\tto\ta\tgroup\tof\tmachines.\tThis\ttechnique\tis\textremely problematic,\tas\tthe\tclient\tis\thidden\tfrom\tthe\tunderlying\thost,\tand\ttherefore\tcannot\teasily\n\nstop\trouting\ttraffic\tto\tone\tof\tthe\thosts\tshould\tit\tbecome\tsick.\n\nFigure\t11-9.\tUsing\tDNS\tto\tresolve\tto\ta\tload\tbalancer\tto\tavoid\tstale\tDNS\tentries\n\nAs\tmentioned,\tDNS\tis\twell\tunderstood\tand\twidely\tsupported.\tBut\tit\tdoes\thave\tone\tor\ttwo downsides.\tI\twould\tsuggest\tinvestigating\twhether\tit\tis\ta\tgood\tfit\tfor\tyou\tbefore\tpicking something\tmore\tcomplex.\tFor\ta\tsituation\twhere\tyou\thave\tonly\tsingle\tnodes,\thaving\tDNS refer\tdirectly\tto\thosts\tis\tprobably\tfine.\tBut\tfor\tthose\tsituations\twhere\tyou\tneed\tmore\tthan one\tinstance\tof\ta\thost,\thave\tDNS\tentries\tresolve\tto\tload\tbalancers\tthat\tcan\thandle\tputting individual\thosts\tinto\tand\tout\tof\tservice\tas\tappropriate.\n\nDynamic\tService\tRegistries\n\nThe\tdownsides\tof\tDNS\tas\ta\tway\tof\tfinding\tnodes\tin\ta\thighly\tdynamic\tenvironment\thave led\tto\ta\tnumber\tof\talternative\tsystems,\tmost\tof\twhich\tinvolve\tthe\tservice\tregistering\titself with\tsome\tcentral\tregistry,\twhich\tin\tturn\toffers\tthe\tability\tto\tlook\tup\tthese\tservices\tlater on.\tOften,\tthese\tsystems\tdo\tmore\tthan\tjust\tproviding\tservice\tregistration\tand\tdiscovery, which\tmay\tor\tmay\tnot\tbe\ta\tgood\tthing.\tThis\tis\ta\tcrowded\tfield,\tso\twe’ll\tjust\tlook\tat\ta\tfew options\tto\tgive\tyou\ta\tsense\tof\twhat\tis\tavailable.\n\nZookeeper\n\nZookeeper\twas\toriginally\tdeveloped\tas\tpart\tof\tthe\tHadoop\tproject.\tIt\tis\tused\tfor\tan\talmost bewildering\tarray\tof\tuse\tcases,\tincluding\tconfiguration\tmanagement,\tsynchronizing\tdata between\tservices,\tleader\telection,\tmessage\tqueues,\tand\t(usefully\tfor\tus)\tas\ta\tnaming service.\n\nLike\tmany\tsimilar\ttypes\tof\tsystems,\tZookeeper\trelies\ton\trunning\ta\tnumber\tof\tnodes\tin\ta cluster\tto\tprovide\tvarious\tguarantees.\tThis\tmeans\tyou\tshould\texpect\tto\tbe\trunning\tat\tleast three\tZookeeper\tnodes.\tMost\tof\tthe\tsmarts\tin\tZookeeper\tare\taround\tensuring\tthat\tdata\tis replicated\tsafely\tbetween\tthese\tnodes,\tand\tthat\tthings\tremain\tconsistent\twhen\tnodes\tfail.\n\nAt\tits\theart,\tZookeeper\tprovides\ta\thierarchical\tnamespace\tfor\tstoring\tinformation.\tClients can\tinsert\tnew\tnodes\tin\tthis\thierarchy,\tchange\tthem,\tor\tquery\tthem.\tFurthermore,\tthey\tcan add\twatches\tto\tnodes\tto\tbe\ttold\twhen\tthey\tchange.\tThis\tmeans\twe\tcould\tstore\tthe information\tabout\twhere\tour\tservices\tare\tlocated\tin\tthis\tstructure,\tand\tas\ta\tclient\tbe\ttold when\tthey\tchange.\tZookeeper\tis\toften\tused\tas\ta\tgeneral\tconfiguration\tstore,\tso\tyou\tcould also\tstore\tservice-specific\tconfiguration\tin\tit,\tallowing\tyou\tto\tdo\ttasks\tlike\tdynamically changing\tlog\tlevels\tor\tturning\toff\tfeatures\tof\ta\trunning\tsystem.\tPersonally,\tI\ttend\tto\tshy away\tfrom\tthe\tuse\tof\tsystems\tlike\tZookeeper\tas\ta\tconfiguration\tsource,\tas\tI\tthink\tit\tcan make\tit\tharder\tto\treason\tabout\tthe\tbehavior\tof\ta\tgiven\tservice.\n\nZookeeper\titself\tis\tfairly\tgeneric\tin\twhat\tit\toffers,\twhich\tis\twhy\tit\tis\tused\tfor\tso\tmany\tuse cases.\tYou\tcan\tthink\tof\tit\tjust\tas\ta\treplicated\ttree\tof\tinformation\tthat\tyou\tcan\tbe\talerted about\twhen\tit\tchanges.\tThis\tmeans\tthat\tyou’ll\ttypically\tbuild\tthings\ton\ttop\tof\tit\tto\tsuit your\tparticular\tuse\tcase.\tLuckily,\tclient\tlibraries\texist\tfor\tmost\tlanguages\tout\tthere.\n\nIn\tthe\tgrand\tscheme\tof\tthings,\tZookeeper\tcould\tbe\tconsidered\told\tby\tnow,\tand\tdoesn’t provide\tus\tthat\tmuch\tfunctionality\tout\tof\tthe\tbox\tto\thelp\twith\tservice\tdiscovery\tcompared to\tsome\tof\tthe\tnewer\talternatives.\tThat\tsaid,\tit\tis\tcertainly\ttried\tand\ttested,\tand\twidely used.\tThe\tunderlying\talgorithms\tZookeeper\timplements\tare\tquite\thard\tto\tget\tright.\tI\tknow one\tdatabase\tvendor,\tfor\texample,\tthat\twas\tusing\tZookeeper\tjust\tfor\tleader\telection\tin order\tto\tensure\tthat\ta\tprimary\tnode\tgot\tproperly\tpromoted\tduring\tfailure\tconditions.\tThe client\tfelt\tthat\tZookeeper\twas\ttoo\theavyweight\tand\tspent\ta\tlong\ttime\tironing\tout\tbugs\tin its\town\timplementation\tof\tthe\tPAXOS\talgorithm\tto\treplace\twhat\tZookeeper\tdid.\tPeople often\tsay\tyou\tshouldn’t\twrite\tyour\town\tcryptography\tlibraries.\tI’d\textend\tthat\tby\tsaying you\tshouldn’t\twrite\tyour\town\tdistributed\tcoordination\tsystems\teither.\tThere\tis\ta\tlot\tto\tbe said\tfor\tusing\texisting\tstuff\tthat\tjust\tworks.\n\nConsul\n\nLike\tZookeeper,\tConsul\tsupports\tboth\tconfiguration\tmanagement\tand\tservice\tdiscovery. But\tit\tgoes\tfurther\tthan\tZookeeper\tin\tproviding\tmore\tsupport\tfor\tthese\tkey\tuse\tcases.\tFor example,\tit\texposes\tan\tHTTP\tinterface\tfor\tservice\tdiscovery,\tand\tone\tof\tConsul’s\tkiller features\tis\tthat\tit\tactually\tprovides\ta\tDNS\tserver\tout\tof\tthe\tbox;\tspecifically,\tit\tcan\tserve SRV\trecords,\twhich\tgive\tyou\tboth\tan\tIP\tand\tport\tfor\ta\tgiven\tname.\tThis\tmeans\tif\tpart\tof your\tsystem\tuses\tDNS\talready\tand\tcan\tsupport\tSRV\trecords,\tyou\tcan\tjust\tdrop\tin\tConsul and\tstart\tusing\tit\twithout\tany\tchanges\tto\tyour\texisting\tsystem.\n\nConsul\talso\tbuilds\tin\tother\tcapabilities\tthat\tyou\tmight\tfind\tuseful,\tsuch\tas\tthe\tability\tto perform\thealth\tchecks\ton\tnodes.\tThis\tmeans\tthat\tConsul\tcould\twell\toverlap\tthe capabilities\tprovided\tby\tother\tdedicated\tmonitoring\ttools,\talthough\tyou\twould\tmore\tlikely use\tConsul\tas\ta\tsource\tof\tthis\tinformation\tand\tthen\tpull\tit\tinto\ta\tmore\tcomprehensive dashboard\tor\talerting\tsystem.\tConsul’s\thighly\tfault-tolerant\tdesign\tand\tfocus\ton\thandling systems\tthat\tmake\theavy\tuse\tof\tephemeral\tnodes\tdoes\tmake\tme\twonder,\tthough,\tif\tit\tmay end\tup\treplacing\tsystems\tlike\tNagios\tand\tSensu\tfor\tsome\tuse\tcases.\n\nConsul\tuses\ta\tRESTful\tHTTP\tinterface\tfor\teverything\tfrom\tregistering\ta\tservice,\tquerying the\tkey/value\tstore,\tor\tinserting\thealth\tchecks.\tThis\tmakes\tintegration\twith\tdifferent technology\tstacks\tvery\tstraightforward.\tOne\tof\tthe\tother\tthings\tI\treally\tlike\tabout\tConsul is\tthat\tthe\tteam\tbehind\tit\thas\tsplit\tout\tthe\tunderlying\tcluster\tmanagement\tpiece.\tSerf, which\tConsul\tsits\ton\ttop\tof,\thandles\tdetection\tof\tnodes\tin\ta\tcluster,\tfailure\tmanagement, and\talerting.\tConsul\tthen\tadds\tservice\tdiscovery\tand\tconfiguration\tmanagement.\tThis separation\tof\tconcerns\tappeals\tto\tme,\twhich\tshould\tbe\tno\tsurprise\tto\tyou\tgiven\tthe\tthemes that\trun\tthrough\tthis\tbook!\n\nConsul\tis\tvery\tnew,\tand\tgiven\tthe\tcomplexity\tof\tthe\talgorithms\tit\tuses,\tthis\twould normally\tmake\tme\thesitant\tin\trecommending\tit\tfor\tsuch\tan\timportant\tjob.\tThat\tsaid, Hashicorp,\tthe\tteam\tbehind\tit,\tcertainly\thas\ta\tgreat\ttrack\trecord\tin\tcreating\tvery\tuseful open\tsource\ttechnology\t(in\tthe\tform\tof\tboth\tPacker\tand\tVagrant),\tthe\tproject\tis\tbeing actively\tdeveloped,\tand\tI’ve\tspoken\tto\ta\tfew\tpeople\twho\tare\thappily\tusing\tit\tin production.\tGiven\tthat,\tI\tthink\tit\tis\twell\tworth\ta\tlook.\n\nEureka\n\nNetflix’s\topen\tsource\tEureka\tsystem\tbucks\tthe\ttrend\tof\tsystems\tlike\tConsul\tand Zookeeper\tin\tthat\tit\tdoesn’t\talso\ttry\tto\tbe\ta\tgeneral-purpose\tconfiguration\tstore.\tIt\tis actually\tvery\ttargeted\tin\tits\tuse\tcase.\n\nEureka\talso\tprovides\tbasic\tload-balancing\tcapabilities\tin\tthat\tit\tcan\tsupport\tbasic\tround- robin\tlookup\tof\tservice\tinstances.\tIt\tprovides\ta\tREST-based\tendpoint\tso\tyou\tcan\twrite your\town\tclients,\tor\tyou\tcan\tuse\tits\town\tJava\tclient.\tThe\tJava\tclient\tprovides\tadditional capabilities,\tsuch\tas\thealth\tchecking\tof\tinstances.\tObviously\tif\tyou\tbypass\tEureka’s\town client\tand\tgo\tdirectly\tto\tthe\tREST\tendpoint,\tyou’re\ton\tyour\town\tthere.\n\nBy\thaving\tthe\tclients\tdeal\twith\tservice\tdiscovery\tdirectly,\twe\tavoid\tthe\tneed\tfor\ta\tseparate process.\tHowever,\tyou\tdo\trequire\tthat\tevery\tclient\timplement\tservice\tdiscovery.\tNetflix, which\tstandardizes\ton\tthe\tJVM,\tachieves\tthis\tby\thaving\tall\tclients\tuse\tEureka.\tIf\tyou’re\tin a\tmore\tpolyglot\tenvironment,\tthis\tmay\tbe\tmore\tof\ta\tchallenge.\n\nRolling\tYour\tOwn\n\nOne\tapproach\tI\thave\tused\tmyself\tand\tseen\tdone\telsewhere\tis\tto\troll\tyour\town\tsystem.\tOn one\tproject\twe\twere\tmaking\theavy\tuse\tof\tAWS,\twhich\toffers\tthe\tability\tto\tadd\ttags\tto instances.\tWhen\tlaunching\tservice\tinstances,\tI\twould\tapply\ttags\tto\thelp\tdefine\twhat\tthe instance\twas\tand\twhat\tit\twas\tused\tfor.\tThese\tallowed\tfor\tsome\trich\tmetadata\tto\tbe associated\twith\ta\tgiven\thost,\tfor\texample:\n\nservice\t=\taccounts\n\nenvironment\t=\tproduction\n\nversion\t=\t154\n\nI\tcould\tthen\tuse\tthe\tAWS\tAPIs\tto\tquery\tall\tthe\tinstances\tassociated\twith\ta\tgiven\tAWS account\tto\tfind\tmachines\tI\tcared\tabout.\tHere,\tAWS\titself\tis\thandling\tthe\tstoring\tof\tthe metadata\tassociated\twith\teach\tinstance,\tand\tproviding\tus\twith\tthe\tability\tto\tquery\tit.\tI\tthen built\tcommand-line\ttools\tfor\tinteracting\twith\tthese\tinstances,\tand\tmaking\tdashboards\tfor status\tmonitoring\tbecomes\tfairly\teasy,\tespecially\tif\tyou\tadopt\tthe\tidea\tof\thaving\teach service\tinstance\texposing\thealth\tcheck\tdetails.\n\nThe\tlast\ttime\tI\tdid\tthis\twe\tdidn’t\tgo\tas\tfar\tas\thaving\tservices\tuse\tthe\tAWS\tAPIs\tto\tfind their\tservice\tdependencies,\tbut\tthere\tis\tno\treason\twhy\tyou\tcouldn’t.\tObviously,\tif\tyou want\tupstream\tservices\tto\tbe\talerted\twhen\tthe\tlocation\tof\ta\tdownstream\tservice\tchanges, you’re\ton\tyour\town.\n\nDon’t\tForget\tthe\tHumans!\n\nThe\tsystems\twe’ve\tlooked\tat\tso\tfar\tmake\tit\teasy\tfor\ta\tservice\tinstance\tto\tregister\titself\tand look\tup\tother\tservices\tit\tneeds\tto\ttalk\tto.\tBut\tas\thumans\twe\tsometimes\twant\tthis information\ttoo.\tWhatever\tsystem\tyou\tpick,\tmake\tsure\tyou\thave\ttools\tavailable\tthat\tlet you\tbuild\treports\tand\tdashboards\ton\ttop\tof\tthese\tregistries\tto\tcreate\tdisplays\tfor\thumans, not\tjust\tfor\tcomputers.\n\nDocumenting\tServices\n\nBy\tdecomposing\tour\tsystems\tinto\tfiner-grained\tmicroservices,\twe’re\thoping\tto\texpose\tlots of\tseams\tin\tthe\tform\tof\tAPIs\tthat\tpeople\tcan\tuse\tto\tdo\tmany,\thopefully\twonderful,\tthings. If\tyou\tget\tyour\tdiscovery\tright,\twe\tknow\twhere\tthings\tare.\tBut\thow\tdo\twe\tknow\twhat those\tthings\tdo,\tor\thow\tto\tuse\tthem?\tOne\toption\tis\tobviously\tto\thave\tdocumentation\tabout the\tAPIs.\tOf\tcourse,\tdocumentation\tcan\toften\tbe\tout\tof\tdate.\tIdeally,\twe’d\tensure\tthat\tour documentation\tis\talways\tup\tto\tdate\twith\tthe\tmicroservice\tAPI,\tand\tmake\tit\teasy\tto\tsee\tthis documentation\twhen\twe\tknow\twhere\ta\tservice\tendpoint\tis.\tTwo\tdifferent\tpieces\tof technology,\tSwagger\tand\tHAL,\ttry\tto\tmake\tthis\ta\treality,\tand\tboth\tare\tworth\tlooking\tat.\n\nSwagger\n\nSwagger\tlets\tyou\tdescribe\tyour\tAPI\tin\torder\tto\tgenerate\ta\tvery\tnice\tweb\tUI\tthat\tallows you\tto\tview\tthe\tdocumentation\tand\tinteract\twith\tthe\tAPI\tvia\ta\tweb\tbrowser.\tThe\tability\tto execute\trequests\tis\tvery\tnice:\tyou\tcan\tdefine\tPOST\ttemplates,\tfor\texample,\tmaking\tit clear\twhat\tsort\tof\tcontent\tthe\tserver\texpects.\n\nTo\tdo\tall\tof\tthis,\tSwagger\tneeds\tthe\tservice\tto\texpose\ta\tsidecar\tfile\tmatching\tthe\tSwagger format.\tSwagger\thas\ta\tnumber\tof\tlibraries\tfor\tdifferent\tlanguages\tthat\tdoes\tthis\tfor\tyou. For\texample,\tfor\tJava\tyou\tcan\tannotate\tmethods\tthat\tmatch\tyour\tAPI\tcalls,\tand\tthe\tfile gets\tgenerated\tfor\tyou.\n\nI\tlike\tthe\tend-user\texperience\tthat\tSwagger\tgives\tyou,\tbut\tit\tdoes\tlittle\tfor\tthe\tincremental exploration\tconcept\tat\tthe\theart\tof\thypermedia.\tStill,\tit’s\ta\tpretty\tnice\tway\tto\texpose documentation\tabout\tyour\tservices.\n\nHAL\tand\tthe\tHAL\tBrowser\n\nBy\titself,\tthe\tHypertext\tApplication\tLanguage\t(HAL)\tis\ta\tstandard\tthat\tdescribes standards\tfor\thypermedia\tcontrols\tthat\twe\texpose.\tAs\twe\tcovered\tin\tChapter\t4, hypermedia\tcontrols\tare\tthe\tmeans\tby\twhich\twe\tallow\tclients\tto\tprogressively\texplore\tour APIs\tto\tuse\tour\tservice’s\tcapabilities\tin\ta\tless\tcoupled\tfashion\tthan\tother\tintegration techniques.\tIf\tyou\tdecide\tto\tadopt\tHAL’s\thypermedia\tstandard,\tthen\tnot\tonly\tcan\tyou make\tuse\tof\ta\twide\tnumber\tof\tclient\tlibraries\tfor\tconsuming\tthe\tAPI\t(at\tthe\ttime\tof writing,\tthe\tHAL\twiki\tlisted\t50\tsupporting\tlibraries\tfor\ta\tnumber\tof\tdifferent\tlanguages), but\tyou\tcan\talso\tmake\tuse\tof\tthe\tHAL\tbrowser,\twhich\tgives\tyou\ta\tway\tto\texplore\tthe\tAPI via\ta\tweb\tbrowser.\n\nLike\tSwagger,\tthis\tUI\tcan\tbe\tused\tnot\tonly\tto\tact\tas\tliving\tdocumentation,\tbut\talso\tto execute\tcalls\tagainst\tthe\tservice\titself.\tExecuting\tcalls\tisn’t\tquite\tas\tslick,\tthough. Whereas\twith\tSwagger\tyou\tcan\tdefine\ttemplates\tto\tdo\tthings\tlike\tissue\ta\tPOST\trequest, with\tHAL\tyou’re\tmore\ton\tyour\town.\tThe\tflipside\tto\tthis\tis\tthat\tthe\tinherent\tpower\tof hypermedia\tcontrols\tlets\tyou\tmuch\tmore\teffectively\texplore\tthe\tAPI\texposed\tby\tthe service,\tas\tyou\tcan\tfollow\tlinks\taround\tvery\teasily.\tIt\tturns\tout\tthat\tweb\tbrowsers\tare pretty\tgood\tat\tthat\tsort\tof\tthing!\n\nUnlike\twith\tSwagger,\tall\tthe\tinformation\tneeded\tto\tdrive\tthis\tdocumentation\tand\tsandbox is\tembedded\tin\tthe\thypermedia\tcontrols.\tThis\tis\ta\tdouble-edged\tsword.\tIf\tyou\tare\talready using\thypermedia\tcontrols,\tit\ttakes\tlittle\teffort\tto\texpose\ta\tHAL\tbrowser\tand\thave\tclients explore\tyour\tAPI.\tHowever,\tif\tyou\taren’t\tusing\thypermedia,\tyou\teither\tcan’t\tuse\tHAL\tor have\tto\tretrofit\tyour\tAPI\tto\tuse\thypermedia,\twhich\tis\tlikely\tto\tbe\tan\texercise\tthat\tbreaks existing\tconsumers.\n\nThe\tfact\tthat\tHAL\talso\tdescribes\ta\thypermedia\tstandard\twith\tsome\tsupporting\tclient libraries\tis\tan\tadded\tbonus,\tand\tI\tsuspect\tis\ta\tbig\treason\twhy\tI’ve\tseen\tmore\tuptake\tof HAL\tas\ta\tway\tof\tdocumenting\tAPIs\tthan\tSwagger\tfor\tthose\tpeople\talready\tusing hypermedia\tcontrols.\tIf\tyou’re\tusing\thypermedia,\tmy\trecommendation\tis\tto\tgo\twith\tHAL over\tSwagger.\tBut\tif\tyou’re\tusing\thypermedia\tand\tcan’t\tjustify\tthe\tswitch,\tI’d\tdefinitely suggest\tgiving\tSwagger\ta\tgo.\n\nThe\tSelf-Describing\tSystem\n\nDuring\tthe\tearly\tevolution\tof\tSOA,\tstandards\tlike\tUniversal\tDescription,\tDiscovery,\tand Integration\t(UDDI)\temerged\tto\thelp\tpeople\tmake\tsense\tof\twhat\tservices\twere\trunning. These\tapproaches\twere\tfairly\theavyweight,\twhich\tled\tto\talternative\ttechniques\tto\ttry\tto make\tsense\tof\tour\tsystems.\tMartin\tFowler\tdiscussed\tthe\tconcept\tof\tthe\thumane\tregistry, where\ta\tmuch\tmore\tlightweight\tapproach\tis\tsimply\tto\thave\ta\tplace\twhere\thumans\tcan record\tinformation\tabout\tthe\tservices\tin\tthe\torganization\tin\tsomething\tas\tbasic\tas\ta\twiki.\n\nGetting\ta\tpicture\tof\tour\tsystem\tand\thow\tit\tis\tbehaving\tis\timportant,\tespecially\twhen\twe’re at\tscale.\tWe’ve\tcovered\ta\tnumber\tof\tdifferent\ttechniques\tthat\twill\thelp\tus\tgain understanding\tdirectly\tfrom\tour\tsystem.\tBy\ttracking\tthe\thealth\tof\tour\tdownstream services\ttogether\twith\tcorrelation\tIDs\tto\thelp\tus\tsee\tcall\tchains,\twe\tcan\tget\treal\tdata\tin terms\tof\thow\tour\tservices\tinterrelate.\tUsing\tservice\tdiscovery\tsystems\tlike\tConsul,\twe\tcan see\twhere\tour\tmicroservices\tare\trunning.\tHAL\tlets\tus\tsee\twhat\tcapabilities\tare\tbeing hosted\ton\tany\tgiven\tendpoint,\twhile\tour\thealth-check\tpages\tand\tmonitoring\tsystems\tlet\tus know\tthe\thealth\tof\tboth\tthe\toverall\tsystem\tand\tindividual\tservices.\n\nAll\tof\tthis\tinformation\tis\tavailable\tprogramatically.\tAll\tof\tthis\tdata\tallows\tus\tto\tmake\tour humane\tregistry\tmore\tpowerful\tthan\ta\tsimple\twiki\tpage\tthat\twill\tno\tdoubt\tget\tout\tof\tdate. Instead,\twe\tshould\tuse\tit\tto\tharness\tand\tdisplay\tall\tthe\tinformation\tour\tsystem\twill\tbe emitting.\tBy\tcreating\tcustom\tdashboards,\twe\tcan\tpull\ttogether\tthe\tvast\tarray\tof information\tthat\tis\tavailable\tto\thelp\tus\tmake\tsense\tof\tour\tecosystem.\n\nBy\tall\tmeans,\tstart\twith\tsomething\tas\tsimple\tas\ta\tstatic\tweb\tpage\tor\twiki\tthat\tperhaps scrapes\tin\ta\tbit\tof\tdata\tfrom\tthe\tlive\tsystem.\tBut\tlook\tto\tpull\tin\tmore\tand\tmore information\tover\ttime.\tMaking\tthis\tinformation\treadily\tavailable\tis\ta\tkey\ttool\tto\tmanaging the\temerging\tcomplexity\tthat\twill\tcome\tfrom\trunning\tthese\tsystems\tat\tscale.\n\nSummary\n\nAs\ta\tdesign\tapproach,\tmicroservices\tare\tstill\tfairly\tyoung,\tso\talthough\twe\thave\tsome notable\texperiences\tto\tdraw\tupon,\tI’m\tsure\tthe\tnext\tfew\tyears\twill\tyield\tmore\tuseful patterns\tin\thandling\tthem\tat\tscale.\tNonetheless,\tI\thope\tthis\tchapter\thas\toutlined\tsome steps\tyou\tcan\ttake\ton\tyour\tjourney\tto\tmicroservices\tat\tscale\tthat\twill\thold\tyou\tin\tgood stead.\n\nIn\taddition\tto\twhat\tI\thave\tcovered\there,\tI\trecommend\tMichael\tNygard’s\texcellent\tbook Release\tIt!.\tIn\tit\the\tshares\ta\tcollection\tof\tstories\tabout\tsystem\tfailure\tand\tsome\tpatterns\tto help\tdeal\twith\tit\twell.\tThe\tbook\tis\twell\tworth\ta\tread\t(in\tfact,\tI\twould\tgo\tso\tfar\tas\tto\tsay\tit should\tbe\tconsidered\tessential\treading\tfor\tanyone\tbuilding\tsystems\tat\tscale).\n\nWe’ve\tcovered\tquite\ta\tlot\tof\tground,\tand\twe’re\tnearing\tthe\tend.\tIn\tour\tnext\tand\tfinal chapter,\twe\twill\tlook\tto\tpull\teverything\tback\ttogether\tand\tsummarize\twhat\twe\thave learned\tin\tthe\tbook\toverall.\n\nChapter\t12.\tBringing\tIt\tAll\tTogether\n\nWe’ve\tcovered\ta\tfair\tamount\tin\tthe\tprevious\tchapters,\tfrom\twhat\tmicroservices\tare\tto\thow to\tdefine\ttheir\tboundaries,\tand\tfrom\tintegration\ttechnology\tto\tconcerns\tabout\tsecurity\tand monitoring.\tAnd\twe\teven\tfound\ttime\tto\twork\tout\thow\tthe\trole\tof\tthe\tarchitect\tfits\tin. There\tis\ta\tlot\tto\ttake\tin,\tas\talthough\tmicroservices\tthemselves\tmay\tbe\tsmall,\tthe\tbreadth and\timpact\tof\ttheir\tarchitecture\tare\tnot.\tSo\there\tI’ll\ttry\tto\tsummarize\tsome\tof\tthe\tkey points\tcovered\tthroughout\tthe\tbook.\n\nPrinciples\tof\tMicroservices\n\nWe\tdiscussed\tthe\trole\tthat\tprinciples\tcan\tplay\tin\tChapter\t2.\tThey\tare\tstatements\tabout\thow things\tshould\tbe\tdone,\tand\twhy\twe\tthink\tthey\tshould\tbe\tdone\tthat\tway.\tThey\thelp\tus frame\tthe\tvarious\tdecisions\twe\thave\tto\tmake\twhen\tbuilding\tour\tsystems.\tYou\tshould absolutely\tdefine\tyour\town\tprinciples,\tbut\tI\tthought\tit\tworth\tspelling\tout\twhat\tI\tsee\tas being\tthe\tkey\tprinciples\tfor\tmicroservice\tarchitectures,\twhich\tyou\tcan\tsee\tsummarized\tin Figure\t12-1.\tThese\tare\tthe\tprinciples\tthat\twill\thelp\tus\tcreate\tsmall\tautonomous\tservices that\twork\twell\ttogether.\tWe’ve\talready\tcovered\teverything\there\tat\tleast\tonce\tso\tfar,\tso nothing\tshould\tbe\tnew,\tbut\tthere\tis\tvalue\tin\tdistilling\tit\tdown\tto\tits\tcore\tessence.\n\nYou\tcan\tchoose\tto\tadopt\tthese\tprinciples\twholesale,\tor\tperhaps\ttweak\tthem\tto\tmake\tsense in\tyour\town\torganization.\tBut\tnote\tthe\tvalue\tthat\tcomes\tfrom\tusing\tthem\tin\tcombination: the\twhole\tshould\tbe\tgreater\tthan\tthe\tsum\tof\tthe\tparts.\tSo\tif\tyou\tdecide\tto\tdrop\tone\tof them,\tmake\tsure\tyou\tunderstand\twhat\tyou’ll\tbe\tmissing.\n\nFor\teach\tof\tthese\tprinciples,\tI’ve\ttried\tto\tpull\tout\tsome\tof\tthe\tsupporting\tpractices\tthat\twe have\tcovered\tin\tthe\tbook.\tAs\tthe\tsaying\tgoes,\tthere\tis\tmore\tthan\tone\tway\tto\tskin\ta\tcat: you\tmight\tfind\tyour\town\tpractices\tto\thelp\tdeliver\ton\tthese\tprinciples,\tbut\tthis\tshould\tget you\tstarted.\n\nFigure\t12-1.\tPrinciples\tof\tmicroservices",
      "page_number": 347
    },
    {
      "number": 12,
      "title": "Bringing\tIt\tAll\tTogether",
      "start_page": 411,
      "end_page": 473,
      "detection_method": "regex_chapter_title",
      "content": "Model\tAround\tBusiness\tConcepts\n\nExperience\thas\tshown\tus\tthat\tinterfaces\tstructured\taround\tbusiness-bounded\tcontexts\tare more\tstable\tthan\tthose\tstructured\taround\ttechnical\tconcepts.\tBy\tmodeling\tthe\tdomain\tin which\tour\tsystem\toperates,\tnot\tonly\tdo\twe\tattempt\tto\tform\tmore\tstable\tinterfaces,\tbut\twe also\tensure\tthat\twe\tare\tbetter\table\tto\treflect\tchanges\tin\tbusiness\tprocesses\teasily.\tUse bounded\tcontexts\tto\tdefine\tpotential\tdomain\tboundaries.\n\nAdopt\ta\tCulture\tof\tAutomation\n\nMicroservices\tadd\ta\tlot\tof\tcomplexity,\ta\tkey\tpart\tof\twhich\tcomes\tfrom\tthe\tsheer\tnumber of\tmoving\tparts\twe\thave\tto\tdeal\twith.\tEmbracing\ta\tculture\tof\tautomation\tis\tone\tkey\tway to\taddress\tthis,\tand\tfront-loading\teffort\tto\tcreate\tthe\ttooling\tto\tsupport\tmicroservices\tcan make\ta\tlot\tof\tsense.\tAutomated\ttesting\tis\tessential,\tas\tensuring\tour\tservices\tstill\twork\tis\ta more\tcomplex\tprocess\tthan\twith\tmonolithic\tsystems.\tHaving\ta\tuniform\tcommand-line\tcall to\tdeploy\tthe\tsame\tway\teverywhere\tcan\thelp,\tand\tthis\tcan\tbe\ta\tkey\tpart\tof\tadopting continuous\tdelivery\tto\tgive\tus\tfast\tfeedback\ton\tthe\tproduction\tquality\tof\teach\tcheck-in.\n\nConsider\tusing\tenvironment\tdefinitions\tto\thelp\tyou\tspecify\tthe\tdifferences\tfrom\tone environment\tto\tanother,\twithout\tsacrificing\tthe\tability\tto\tuse\ta\tuniform\tdeployment method.\tThink\tabout\tcreating\tcustom\timages\tto\tspeed\tup\tdeployment,\tand\tembracing\tthe creation\tof\tfully\tautomated\timmutable\tservers\tto\tmake\tit\teasier\tto\treason\tabout\tyour systems.\n\nHide\tInternal\tImplementation\tDetails\n\nTo\tmaximize\tthe\tability\tof\tone\tservice\tto\tevolve\tindependently\tof\tany\tothers,\tit\tis\tvital that\twe\thide\timplementation\tdetails.\tModeling\tbounded\tcontexts\tcan\thelp,\tas\tthis\thelps\tus focus\ton\tthose\tmodels\tthat\tshould\tbe\tshared,\tand\tthose\tthat\tshould\tbe\thidden.\tServices should\talso\thide\ttheir\tdatabases\tto\tavoid\tfalling\tinto\tone\tof\tthe\tmost\tcommon\tsorts\tof coupling\tthat\tcan\tappear\tin\ttraditional\tservice-oriented\tarchitectures,\tand\tuse\tdata\tpumps or\tevent\tdata\tpumps\tto\tconsolidate\tdata\tacross\tmultiple\tservices\tfor\treporting\tpurposes.\n\nWhere\tpossible,\tpick\ttechnology-agnostic\tAPIs\tto\tgive\tyou\tfreedom\tto\tuse\tdifferent technology\tstacks.\tConsider\tusing\tREST,\twhich\tformalizes\tthe\tseparation\tof\tinternal\tand external\timplementation\tdetails,\talthough\teven\tif\tusing\tremote\tprocedure\tcalls\t(RPCs), you\tcan\tstill\tembrace\tthese\tideas.\n\nDecentralize\tAll\tthe\tThings\n\nTo\tmaximize\tthe\tautonomy\tthat\tmicroservices\tmake\tpossible,\twe\tneed\tto\tconstantly\tbe looking\tfor\tthe\tchance\tto\tdelegate\tdecision\tmaking\tand\tcontrol\tto\tthe\tteams\tthat\town\tthe services\tthemselves.\tThis\tprocess\tstarts\twith\tembracing\tself-service\twherever\tpossible, allowing\tpeople\tto\tdeploy\tsoftware\ton\tdemand,\tmaking\tdevelopment\tand\ttesting\tas\teasy as\tpossible,\tand\tavoiding\tthe\tneed\tfor\tseparate\tteams\tto\tperform\tthese\tactivities.\n\nEnsuring\tthat\tteams\town\ttheir\tservices\tis\tan\timportant\tstep\ton\tthis\tjourney,\tmaking\tteams responsible\tfor\tthe\tchanges\tthat\tare\tmade,\tideally\teven\thaving\tthem\tdecide\twhen\tto release\tthose\tchanges.\tMaking\tuse\tof\tinternal\topen\tsource\tensures\tthat\tpeople\tcan\tmake changes\ton\tservices\towned\tby\tother\tteams,\talthough\tremember\tthat\tthis\trequires\twork\tto implement.\tAlign\tteams\tto\tthe\torganization\tto\tensure\tthat\tConway’s\tlaw\tworks\tfor\tyou, and\thelp\tyour\tteam\tbecome\tdomain\texperts\tin\tthe\tbusiness-focused\tservices\tthey\tare creating.\tWhere\tsome\toverarching\tguidance\tis\tneeded,\ttry\tto\tembrace\ta\tshared governance\tmodel\twhere\tpeople\tfrom\teach\tteam\tcollectively\tshare\tresponsibility\tfor evolving\tthe\ttechnical\tvision\tof\tthe\tsystem.\n\nThis\tprinciple\tcan\tapply\tto\tarchitecture\ttoo.\tAvoid\tapproaches\tlike\tenterprise\tservice\tbus or\torchestration\tsystems,\twhich\tcan\tlead\tto\tcentralization\tof\tbusiness\tlogic\tand\tdumb services.\tInstead,\tprefer\tchoreography\tover\torchestration\tand\tdumb\tmiddleware,\twith smart\tendpoints\tto\tensure\tthat\tyou\tkeep\tassociated\tlogic\tand\tdata\twithin\tservice boundaries,\thelping\tkeep\tthings\tcohesive.\n\nIndependently\tDeployable\n\nWe\tshould\talways\tstrive\tto\tensure\tthat\tour\tmicroservices\tcan\tand\tare\tdeployed\tby themselves.\tEven\twhen\tbreaking\tchanges\tare\trequired,\twe\tshould\tseek\tto\tcoexist versioned\tendpoints\tto\tallow\tour\tconsumers\tto\tchange\tover\ttime.\tThis\tallows\tus\tto optimize\tfor\tspeed\tof\trelease\tof\tnew\tfeatures,\tas\twell\tas\tincreasing\tthe\tautonomy\tof\tthe teams\towning\tthese\tmicroservices\tby\tensuring\tthat\tthey\tdon’t\thave\tto\tconstantly orchestrate\ttheir\tdeployments.\tWhen\tusing\tRPC-based\tintegration,\tavoid\ttightly\tbound client/server\tstub\tgeneration\tsuch\tas\tthat\tpromoted\tby\tJava\tRMI.\n\nBy\tadopting\ta\tone-service-per-host\tmodel,\tyou\treduce\tside\teffects\tthat\tcould\tcause deploying\tone\tservice\tto\timpact\tanother\tunrelated\tservice.\tConsider\tusing\tblue/green\tor canary\trelease\ttechniques\tto\tseparate\tdeployment\tfrom\trelease,\treducing\tthe\trisk\tof\ta release\tgoing\twrong.\tUse\tconsumer-driven\tcontracts\tto\tcatch\tbreaking\tchanges\tbefore they\thappen.\n\nRemember\tthat\tit\tshould\tbe\tthe\tnorm,\tnot\tthe\texception,\tthat\tyou\tcan\tmake\ta\tchange\tto\ta single\tservice\tand\trelease\tit\tinto\tproduction,\twithout\thaving\tto\tdeploy\tany\tother\tservices in\tlock-step.\tYour\tconsumers\tshould\tdecide\twhen\tthey\tupdate\tthemselves,\tand\tyou\tneed\tto accommodate\tthis.\n\nIsolate\tFailure\n\nA\tmicroservice\tarchitecture\tcan\tbe\tmore\tresilient\tthan\ta\tmonolithic\tsystem,\tbut\tonly\tif\twe understand\tand\tplan\tfor\tfailures\tin\tpart\tof\tour\tsystem.\tIf\twe\tdon’t\taccount\tfor\tthe\tfact\tthat a\tdownstream\tcall\tcan\tand\twill\tfail,\tour\tsystems\tmight\tsuffer\tcatastrophic\tcascading failure,\tand\twe\tcould\tfind\tourselves\twith\ta\tsystem\tthat\tis\tmuch\tmore\tfragile\tthan\tbefore.\n\nWhen\tusing\tnetwork\tcalls,\tdon’t\ttreat\tremote\tcalls\tlike\tlocal\tcalls,\tas\tthis\twill\thide different\tsorts\tof\tfailure\tmode.\tSo\tmake\tsure\tif\tyou’re\tusing\tclient\tlibraries\tthat\tthe abstraction\tof\tthe\tremote\tcall\tdoesn’t\tgo\ttoo\tfar.\n\nIf\twe\thold\tthe\ttenets\tof\tantifragility\tin\tmind,\tand\texpect\tfailure\twill\toccur\tanywhere\tand everywhere,\twe\tare\ton\tthe\tright\ttrack.\tMake\tsure\tyour\ttimeouts\tare\tset\tappropriately. Understand\twhen\tand\thow\tto\tuse\tbulkheads\tand\tcircuit\tbreakers\tto\tlimit\tthe\tfallout\tof\ta failing\tcomponent.\tUnderstand\twhat\tthe\tcustomer-facing\timpact\twill\tbe\tif\tonly\tone\tpart\tof the\tsystem\tis\tmisbehaving.\tKnow\twhat\tthe\timplications\tof\ta\tnetwork\tpartition\tmight\tbe, and\twhether\tsacrificing\tavailability\tor\tconsistency\tin\ta\tgiven\tsituation\tis\tthe\tright\tcall.\n\nHighly\tObservable\n\nWe\tcannot\trely\ton\tobserving\tthe\tbehavior\tof\ta\tsingle\tservice\tinstance\tor\tthe\tstatus\tof\ta single\tmachine\tto\tsee\tif\tthe\tsystem\tis\tfunctioning\tcorrectly.\tInstead,\twe\tneed\ta\tjoined-up view\tof\twhat\tis\thappening.\tUse\tsemantic\tmonitoring\tto\tsee\tif\tyour\tsystem\tis\tbehaving correctly,\tby\tinjecting\tsynthetic\ttransactions\tinto\tyour\tsystem\tto\tsimulate\treal-user behavior.\tAggregate\tyour\tlogs,\tand\taggregate\tyour\tstats,\tso\tthat\twhen\tyou\tsee\ta\tproblem you\tcan\tdrill\tdown\tto\tthe\tsource.\tAnd\twhen\tit\tcomes\tto\treproducing\tnasty\tissues\tor\tjust seeing\thow\tyour\tsystem\tis\tinteracting\tin\tproduction,\tuse\tcorrelation\tIDs\tto\tallow\tyou\tto trace\tcalls\tthrough\tthe\tsystem.\n\nWhen\tShouldn’t\tYou\tUse\tMicroservices?\n\nI\tget\tasked\tthis\tquestion\ta\tlot.\tMy\tfirst\tpiece\tof\tadvice\twould\tbe\tthat\tthe\tless\twell\tyou understand\ta\tdomain,\tthe\tharder\tit\twill\tbe\tfor\tyou\tto\tfind\tproper\tbounded\tcontexts\tfor\tyour services.\tAs\twe\tdiscussed\tpreviously,\tgetting\tservice\tboundaries\twrong\tcan\tresult\tin having\tto\tmake\tlots\tof\tchanges\tin\tservice-to-service\tcollaboration\t—\tan\texpensive operation.\tSo\tif\tyou’re\tcoming\tto\ta\tmonolithic\tsystem\tfor\twhich\tyou\tdon’t\tunderstand\tthe domain,\tspend\tsome\ttime\tlearning\twhat\tthe\tsystem\tdoes\tfirst,\tand\tthen\tlook\tto\tidentify clean\tmodule\tboundaries\tprior\tto\tsplitting\tout\tservices.\n\nGreenfield\tdevelopment\tis\talso\tquite\tchallenging.\tIt\tisn’t\tjust\tthat\tthe\tdomain\tis\talso\tlikely to\tbe\tnew;\tit’s\tthat\tit\tis\tmuch\teasier\tto\tchunk\tup\tsomething\tyou\thave\tthan\tsomething\tyou don’t!\tSo\tagain,\tconsider\tstarting\tmonolithic\tfirst\tand\tbreak\tthings\tout\twhen\tyou’re\tstable.\n\nMany\tof\tthe\tchallenges\tyou’re\tgoing\tto\tface\twith\tmicroservices\tget\tworse\twith\tscale.\tIf you\tmostly\tdo\tthings\tmanually,\tyou\tmight\tbe\tOK\twith\t1\tor\t2\tservices,\tbut\t5\tor\t10? Sticking\twith\told\tmonitoring\tpractices\twhere\tyou\tjust\tlook\tat\tstats\tlike\tCPU\tand\tmemory likewise\tmight\twork\tOK\tfor\ta\tfew\tservices,\tbut\tthe\tmore\tservice-to-service\tcollaboration you\tdo,\tthe\tmore\tpainful\tthis\twill\tbecome.\tYou’ll\tfind\tyourself\thitting\tthese\tpain\tpoints\tas you\tadd\tmore\tservices,\tand\tI\thope\tthe\tadvice\tin\tthis\tbook\twill\thelp\tyou\tsee\tsome\tof\tthese problems\tcoming,\tand\tgive\tyou\tsome\tconcrete\ttips\tfor\thow\tto\tdeal\twith\tthem.\tI\tspoke before\tabout\tREA\tand\tGilt\ttaking\ta\twhile\tto\tbuild\tthe\ttooling\tand\tpractices\tto\tmanage microservices\twell,\tprior\tto\tbeing\table\tto\tuse\tthem\tin\tany\tlarge\tquantity.\tThese\tstories\tjust reinforce\tto\tme\tthe\timportance\tof\tstarting\tgradually\tso\tyou\tunderstand\tyour\torganization’s appetite\tand\tability\tto\tchange,\twhich\twill\thelp\tyou\tproperly\tadopt\tmicroservices.\n\nParting\tWords\n\nMicroservice\tarchitectures\tgive\tyou\tmore\toptions,\tand\tmore\tdecisions\tto\tmake.\tMaking decisions\tin\tthis\tworld\tis\ta\tfar\tmore\tcommon\tactivity\tthan\tin\tsimpler,\tmonolithic\tsystems. You\twon’t\tget\tall\tof\tthese\tdecisions\tright,\tI\tcan\tguarantee\tthat.\tSo,\tknowing\twe\tare\tgoing to\tget\tsome\tthings\twrong,\twhat\tare\tour\toptions?\tWell,\tI\twould\tsuggest\tfinding\tways\tto make\teach\tdecision\tsmall\tin\tscope;\tthat\tway,\tif\tyou\tget\tit\twrong,\tyou\tonly\timpact\ta\tsmall part\tof\tyour\tsystem.\tLearn\tto\tembrace\tthe\tconcept\tof\tevolutionary\tarchitecture,\twhere your\tsystem\tbends\tand\tflexes\tand\tchanges\tover\ttime\tas\tyou\tlearn\tnew\tthings.\tThink\tnot\tof big-bang\trewrites,\tbut\tinstead\tof\ta\tseries\tof\tchanges\tmade\tto\tyour\tsystem\tover\ttime\tto keep\tit\tsupple.\n\nHopefully\tby\tnow\tI’ve\tshared\twith\tyou\tenough\tinformation\tand\texperiences\tto\thelp\tyou decide\tif\tmicroservices\tare\tfor\tyou.\tIf\tthey\tare,\tI\thope\tyou\tthink\tof\tthis\tas\ta\tjourney,\tnot\ta destination.\tGo\tincrementally.\tBreak\tyour\tsystem\tapart\tpiece\tby\tpiece,\tlearning\tas\tyou\tgo. And\tget\tused\tto\tit:\tin\tmany\tways,\tthe\tdiscipline\tto\tcontinually\tchange\tand\tevolve\tour systems\tis\ta\tfar\tmore\timportant\tlesson\tto\tlearn\tthan\tany\tother\tI\thave\tshared\twith\tyou through\tthis\tbook.\tChange\tis\tinevitable.\tEmbrace\tit.\n\nIndex\n\nA\n\nacceptance\ttesting,\tTypes\tof\tTests\n\naccess\tby\treference,\tAccess\tby\tReference\n\naccountability,\tPeople\n\nadaptability,\tSummary\n\nAegisthus\tproject,\tBackup\tData\tPump\n\naggregated\tlogs,\tLogs,\tLogs,\tand\tYet\tMore\tLogs…\n\nantifragile\tsystems,\tMicroservices,\tThe\tAntifragile\tOrganization-Isolation\n\nbulkheads,\tBulkheads\n\ncircuit\tbreakers,\tCircuit\tBreakers\n\nexamples\tof,\tThe\tAntifragile\tOrganization\n\nincreased\tuse\tof,\tMicroservices\n\nisolation,\tIsolation\n\nload\tshedding,\tBulkheads\n\ntimeouts,\tTimeouts\n\nAP\tsystem\n\ndefinition\tof\tterm,\tSacrificing\tConsistency\n\nvs.\tCP\tsystem,\tAP\tor\tCP?\n\nAPI\tkey-based\tauthentication,\tAPI\tKeys,\tIt’s\tAll\tAbout\tthe\tKeys\n\napplication\tcontainers,\tApplication\tContainers\n\narchitects\t(see\tsystems\tarchitects)\n\narchitectural\tprinciples\n\ndevelopment\tof,\tPrinciples\n\nHeroku’s\t12\tfactors,\tPrinciples\n\nkey\tmicroservices\tprinciples,\tBringing\tIt\tAll\tTogether\n\nreal-world\texample,\tA\tReal-World\tExample\n\narchitectural\tsafety,\tArchitectural\tSafety,\tArchitectural\tSafety\tMeasures\n\nartifacts\n\nimages,\tImages\tas\tArtifacts\n\noperating\tsystem,\tOperating\tSystem\tArtifacts\n\nplatform-specific,\tPlatform-Specific\tArtifacts\n\nasynchronous\tcollaboration\n\ncomplexities\tof,\tComplexities\tof\tAsynchronous\tArchitectures\n\nimplementing,\tImplementing\tAsynchronous\tEvent-Based\tCollaboration\n\nvs.\tsynchronous,\tSynchronous\tVersus\tAsynchronous\n\nATOM\tspecification,\tTechnology\tChoices\n\nauthentication/authorization,\tAuthentication\tand\tAuthorization-The\tDeputy Problem\n\ndefinition\tof\tterms,\tAuthentication\tand\tAuthorization\n\nfine-grained,\tFine-Grained\tAuthorization\n\nservice-to-service,\tService-to-Service\tAuthentication\tand\tAuthorization\n\nsingle\tsign-on\t(SSO),\tCommon\tSingle\tSign-On\tImplementations\n\nsingle\tsign-on\tgateway,\tSingle\tSign-On\tGateway\n\nterminology,\tCommon\tSingle\tSign-On\tImplementations\n\nautomation\n\nB\n\nbenefits\tfor\tdeployment,\tAutomation\n\ncase\tstudies\ton,\tTwo\tCase\tStudies\ton\tthe\tPower\tof\tAutomation\n\nautonomy\n\nmicroservices\tand,\tAutonomous\n\nrole\tof\tsystems\tarchitect\tin,\tSummary\n\nautoscaling,\tAutoscaling\n\navailability\n\nin\tCAP\ttheorem,\tCAP\tTheorem\n\nkey\tmicroservices\tprinciple\tof,\tHow\tMuch\tIs\tToo\tMuch?\n\nsacrificing,\tSacrificing\tAvailability\n\nbackends\tfor\tfrontends\t(BFFs),\tBackends\tfor\tFrontends\n\nbackup\tdata\tpumps,\tBackup\tData\tPump\n\nbackups,\tencryption\tof,\tEncrypt\tBackups\n\nblue/green\tdeployment,\tSeparating\tDeployment\tfrom\tRelease\n\nbottlenecks,\tDelivery\tBottlenecks\n\nbounded\tcontexts\n\nconcept\tof,\tThe\tBounded\tContext\n\nmodules\tand\tservices,\tModules\tand\tServices\n\nnested,\tTurtles\tAll\tthe\tWay\tDown\n\npremature\tdecomposition,\tPremature\tDecomposition\n\nshared\tvs.\thidden\tmodels,\tShared\tand\tHidden\tModels\n\nsystem\tdesign\tand,\tBounded\tContexts\tand\tTeam\tStructures\n\nC\n\nBrakeman,\tBaking\tSecurity\tIn\n\nbreaking\tchanges\n\navoiding,\tAvoid\tBreaking\tChanges\n\ndeferring,\tDefer\tIt\tfor\tas\tLong\tas\tPossible\n\nearly\tdetection\tof,\tCatch\tBreaking\tChanges\tEarly\n\nbrittle\ttests,\tFlaky\tand\tBrittle\tTests\n\nbrittleness,\tBrittleness\n\nbuild\tpipelines,\tBuild\tPipelines\tand\tContinuous\tDelivery\n\nbulkheads,\tBulkheads\n\nbundled\tservice\trelease,\tAnd\tthe\tInevitable\tExceptions\n\nbusiness\tcapabilities,\tBusiness\tCapabilities\n\nbusiness\tconcepts,\tCommunication\tin\tTerms\tof\tBusiness\tConcepts\n\nbusiness-facing\ttests,\tTypes\tof\tTests\n\ncaching\n\nbenefits\tof,\tCaching\n\ncache\tfailures,\tHiding\tthe\tOrigin\n\ncache\tpoisoning,\tCache\tPoisoning:\tA\tCautionary\tTale\n\nclient-side,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\nfor\twrites,\tCaching\tfor\tWrites\n\nin\tHTTP,\tCaching\tin\tHTTP\n\nproxy,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\nserver-side,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\ncanary\treleasing,\tCanary\tReleasing\n\nCAP\ttheorem,\tCAP\tTheorem-And\tthe\tReal\tWorld\n\nAP/CP\tsystems,\tIt’s\tNot\tAll\tor\tNothing\n\napplication\tof,\tAnd\tthe\tReal\tWorld\n\nbasics\tof,\tCAP\tTheorem\n\nsacrificing\tavailability,\tSacrificing\tAvailability\n\nsacrificing\tconsistency,\tSacrificing\tConsistency\n\nsacrificing\tpartition\ttolerance,\tSacrificing\tPartition\tTolerance?\n\ncascading\tfailures,\tThe\tCascade\n\ncertificate\tmanagement,\tClient\tCertificates\n\nChaos\tGorilla,\tThe\tAntifragile\tOrganization\n\nChaos\tMonkey,\tThe\tAntifragile\tOrganization\n\nchoreographed\tarchitecture,\tOrchestration\tVersus\tChoreography\n\ncircuit\tbreakers,\tTailored\tService\tTemplate,\tCircuit\tBreakers\n\ncircuit_breaker\tmixin\tfor\tRuby,\tBulkheads\n\nclass-responsibility-collaboration\t(CRC),\tCost\tof\tChange\n\nclient\tcertificates,\tClient\tCertificates\n\nclient\tlibraries,\tClient\tLibraries\n\nclient-side\tcaching,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\ncode\treuse,\tDRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta\tMicroservice\tWorld\n\ncoding\tarchitect,\tZoning\n\ncohesion,\tSmall,\tand\tFocused\ton\tDoing\tOne\tThing\tWell,\tHigh\tCohesion\n\nCohn’s\tTest\tPyramid,\tTest\tScope\n\ncollaboration,\tSummary\n\nevent-based,\tSynchronous\tVersus\tAsynchronous\n\nrequest/response,\tSynchronous\tVersus\tAsynchronous\n\nCommand-Query\tResponsibility\tSegregation\t(CQRS),\tCQRS\n\ncommits,\ttwo-phase,\tDistributed\tTransactions\n\ncommunication\n\nadapting\tto\tpathways,\tAdapting\tto\tCommunication\tPathways\n\nprotocols\tfor\t(SOAP),\tWhat\tAbout\tService-Oriented\tArchitecture?\n\nsynchronous\tvs.\tasynchronous,\tSynchronous\tVersus\tAsynchronous\n\ncompensating\ttransactions,\tAbort\tthe\tEntire\tOperation\n\ncomposability,\tComposability\n\nconfiguration\tdrift,\tImmutable\tServers\n\nconfiguration,\tservice,\tService\tConfiguration\n\nconfused\tdeputy\tproblem,\tThe\tDeputy\tProblem\n\nconsistency\n\nin\tCAP\ttheorem,\tCAP\tTheorem\n\nsacrificing,\tSacrificing\tConsistency\n\nconstraints,\tConstraints\n\nConsul,\tConsul\n\nconsumer-driven\tcontracts\t(CDCs),\tConsumer-Driven\tTests\tto\tthe\tRescue-It’s About\tConversations\n\ncontent\tdelivery\tnetwork\t(CDN),\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\ncontent\tmanagement\tsystems\t(CMS),\tExample:\tCMS\tas\ta\tservice\n\ncontinuous\tdelivery\t(CD),\tMicroservices,\tBuild\tPipelines\tand\tContinuous Delivery\n\ncontinuous\tintegration\t(CI)\n\nbasics,\tA\tBrief\tIntroduction\tto\tContinuous\tIntegration\n\nchecklist\tfor,\tAre\tYou\tReally\tDoing\tIt?\n\nmapping\tto\tmicroservices,\tMapping\tContinuous\tIntegration\tto Microservices\n\nConway’s\tlaw\n\nevidence\tof,\tEvidence\n\nin\treverse,\tConway’s\tLaw\tin\tReverse\n\nstatement\tof,\tConway’s\tLaw\tand\tSystem\tDesign\n\nsummary\tof,\tSummary\n\ncoordination\tprocess,\tDistributed\tTransactions\n\ncore\tteam,\tRole\tof\tthe\tCustodians\n\nCoreOS,\tDocker\n\ncorrelation\tIDs,\tCorrelation\tIDs\n\nCP\tsystem,\tAP\tor\tCP?\n\ncross-functional\trequirements\t(CFR),\tCross-Functional\tTesting,\tHow\tMuch\tIs Too\tMuch?\n\ncustodians,\tRole\tof\tthe\tCustodians\n\ncustom\timages,\tCustom\tImages\n\nCustomer\tRelationship\tManagement\t(CRM),\tExample:\tThe\tmultirole\tCRM system\n\nD\n\ncustomers,\tinterfacing\twith\n\nenrolling\tnew\tcustomers,\tInterfacing\twith\tCustomers,\tOrchestration Versus\tChoreography\n\nshared\tdatabases,\tThe\tShared\tDatabase\n\ndata\n\nbatch\tinsertion\tof,\tData\tRetrieval\tvia\tService\tCalls\n\ndurability\tof,\tHow\tMuch\tIs\tToo\tMuch?\n\nencryption\tof\tbackup,\tEncrypt\tBackups\n\nretrieval\tvia\tservice\tcalls,\tData\tRetrieval\tvia\tService\tCalls\n\nsecuring\tat\trest,\tSecuring\tData\tat\tRest\n\n(see\talso\tsecurity)\n\nshared,\tExample:\tShared\tData\n\nshared\tstatic,\tExample:\tShared\tStatic\tData\n\ndata\tencryption,\tGo\twith\tthe\tWell\tKnown\n\ndata\tpumps\n\nbackup,\tBackup\tData\tPump\n\ndata\tretrieval\tvia,\tData\tPumps\n\nevent,\tEvent\tData\tPump\n\nserial\tuse\tof,\tAlternative\tDestinations\n\ndatabase\tdecomposition,\tThe\tDatabase-Understanding\tRoot\tCauses\n\nbreaking\tforeign\tkey\trelationships,\tExample:\tBreaking\tForeign\tKey Relationships\n\nincremental\tapproach\tto,\tCost\tof\tChange\n\noverview\tof,\tSummary\n\nrefactoring\tdatabases,\tStaging\tthe\tBreak\n\nselecting\tseparation\tpoints,\tGetting\tto\tGrips\twith\tthe\tProblem\n\nselecting\tseparation\ttiming,\tUnderstanding\tRoot\tCauses\n\nshared\tdata,\tExample:\tShared\tData\n\nshared\tstatic\tdata,\tExample:\tShared\tStatic\tData\n\nshared\ttables,\tExample:\tShared\tTables\n\ntransactional\tboundaries,\tTransactional\tBoundaries\n\ndatabase\tintegration,\tThe\tShared\tDatabase\n\ndatabase\tscaling\n\nCommand-Query\tResponsibility\tSegregation\t(CQRS),\tCQRS\n\nfor\treads,\tScaling\tfor\tReads\n\nfor\twrites,\tScaling\tfor\tWrites\n\nservice\tavailability\tvs.\tdata\tdurability,\tAvailability\tof\tService\tVersus Durability\tof\tData\n\nshared\tinfrastructure,\tShared\tDatabase\tInfrastructure\n\ndecision-making\tguidelines,\tA\tPrincipled\tApproach-A\tReal-World\tExample\n\ncustomized\tapproach\tto,\tCombining\tPrinciples\tand\tPractices\n\npractices\tfor,\tPractices\n\nprinciples\tfor,\tPrinciples\n\nreal-world\texample,\tA\tReal-World\tExample\n\nstrategic\tgoals,\tStrategic\tGoals\n\ndecompositional\ttechniques\n\ndatabases\t(see\tdatabase\tdecomposition)\n\nidentifying/packaging\tcontexts,\tBreaking\tApart\tMusicCorp\n\nmodules,\tModules\n\nseam\tconcept,\tIt’s\tAll\tAbout\tSeams\n\nselecting\tseparation\tpoints,\tThe\tReasons\tto\tSplit\tthe\tMonolith\n\nselecting\tseparation\ttiming,\tUnderstanding\tRoot\tCauses\n\nshared\tlibraries,\tShared\tLibraries\n\ndecoupling,\tAutonomous,\tOrchestration\tVersus\tChoreography\n\ndegrading\tfunctionality,\tDegrading\tFunctionality\n\ndelivery\tbottlenecks,\tDelivery\tBottlenecks\n\ndeployment\n\nartifacts,\timages\tas,\tImages\tas\tArtifacts\n\nartifacts,\toperating\tsystem,\tOperating\tSystem\tArtifacts\n\nartifacts,\tplatform-specific,\tPlatform-Specific\tArtifacts\n\nautomation,\tAutomation\n\nblue/green\tdeployment,\tSeparating\tDeployment\tfrom\tRelease\n\nbuild\tpipeline,\tBuild\tPipelines\tand\tContinuous\tDelivery\n\nbundled\tservice\trelease,\tAnd\tthe\tInevitable\tExceptions\n\ncontinuous\tintegration\tbasics,\tA\tBrief\tIntroduction\tto\tContinuous Integration\n\ncontinuous\tintegration\tchecklist,\tAre\tYou\tReally\tDoing\tIt?\n\ncontinuous\tintegration\tin\tmicroservices,\tMapping\tContinuous Integration\tto\tMicroservices\n\ncustom\timages,\tCustom\tImages\n\nenvironment\tdefinition,\tEnvironment\tDefinition\n\nenvironments\tto\tconsider,\tEnvironments\n\nimmutable\tservers,\tImmutable\tServers\n\ninterfaces,\tA\tDeployment\tInterface\n\nmicroservices\tvs.\tmonolithic\tsystems,\tEase\tof\tDeployment,\tDeployment\n\noverview\tof,\tSummary\n\nseparating\tfrom\trelease,\tSeparating\tDeployment\tfrom\tRelease\n\nservice\tconfiguration,\tService\tConfiguration\n\nvirtualization\tapproach,\tFrom\tPhysical\tto\tVirtual\n\nvirtualization,\thypervisors,\tTraditional\tVirtualization\n\nvirtualization,\ttraditional,\tTraditional\tVirtualization\n\nvirtualization,\ttype\t2,\tTraditional\tVirtualization\n\ndeputy\tproblem,\tThe\tDeputy\tProblem\n\ndesign\tprinciples,\tPrinciples,\tBringing\tIt\tAll\tTogether-Highly\tObservable\n\n(see\talso\tarchitectural\tprinciples)\n\ndesign/delivery\tpractices\n\ndevelopment\tof,\tPractices\n\nreal-world\texample,\tA\tReal-World\tExample\n\ndirectory\tservice,\tCommon\tSingle\tSign-On\tImplementations\n\nDiRT\t(Disaster\tRecovery\tTest),\tThe\tAntifragile\tOrganization\n\ndistributed\tsystems\n\nfallacies\tof,\tLocal\tCalls\tAre\tNot\tLike\tRemote\tCalls,\tFailure\tIs Everywhere\n\nE\n\nkey\tpromises\tof,\tComposability\n\ndistributed\ttransactions,\tDistributed\tTransactions\n\nDNS\tservice,\tDNS\n\nDocker,\tDocker\n\ndocumentation\n\nHAL\t(Hypertext\tApplication\tLanguage),\tHAL\tand\tthe\tHAL\tBrowser\n\nimportance\tof,\tDocumenting\tServices\n\nself-describing\tsystems,\tHAL\tand\tthe\tHAL\tBrowser\n\nSwagger,\tSwagger\n\ndomain-driven\tdesign,\tMicroservices\n\nDropwizard,\tTailored\tService\tTemplate\n\nDRY\t(Don’t\tRepeat\tYourself),\tDRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta Microservice\tWorld\n\ndummies,\tMocking\tor\tStubbing\n\ndurability,\tHow\tMuch\tIs\tToo\tMuch?\n\ndynamic\tservice\tregistries\n\nbenefits\tof,\tDynamic\tService\tRegistries\n\nConsul,\tConsul\n\nEureka,\tEureka\n\nlaunching,\tRolling\tYour\tOwn\n\nZookeeper,\tZookeeper\n\nempathy,\tSummary\n\nencryption,\tGo\twith\tthe\tWell\tKnown\n\nend-to-end\ttests\n\nappropriate\tuses\tfor,\tTest\tJourneys,\tNot\tStories,\tSo\tShould\tYou\tUse\tEnd- to-End\tTests?\n\nCohn’s\tTest\tPyramid,\tTest\tScope\n\ncreation\tof,\tWho\tWrites\tThese\tTests?\n\ndrawbacks\tof,\tFlaky\tand\tBrittle\tTests\n\nfeedback\tcycle,\tThe\tGreat\tPile-up\n\nimplementation\tof,\tThose\tTricky\tEnd-to-End\tTests\n\nmetaversion,\tThe\tMetaversion\n\nscope\tof,\tEnd-to-End\tTests\n\ntiming\tof,\tHow\tLong?\n\nendpoints\n\ncoexisting\tdifferent,\tCoexist\tDifferent\tEndpoints\n\nserver-side\taggregation,\tBackends\tfor\tFrontends\n\nenvironments\n\ndefinition\tduring\tdeployment,\tEnvironment\tDefinition\n\ndeployment\tconsiderations,\tEnvironments\n\nmanaging,\tEnvironments\n\nErlang\tmodules,\tModules\n\nEureka,\tEureka\n\nevent\tdata\tpumps,\tEvent\tData\tPump\n\nevent\tsourcing,\tCQRS\n\nevent-based\tcollaboration,\tSynchronous\tVersus\tAsynchronous\n\nF\n\nG\n\neventual\tconsistency,\tTry\tAgain\tLater,\tSacrificing\tConsistency\n\nevolutionary\tarchitects\t(see\tsystems\tarchitects)\n\nexception\thandling,\tException\tHandling\n\nexemplars,\tExemplars\n\nexploratory\ttesting,\tTypes\tof\tTests\n\nfailure\tbots,\tThe\tAntifragile\tOrganization\n\nfailures\n\ncascading,\tThe\tCascade\n\n(see\talso\tmonitoring)\n\ndealing\twith,\tFailure\tIs\tEverywhere\n\nfakes,\tMocking\tor\tStubbing\n\nfeature-based\tteams,\tFeature\tTeams\n\nfirewalls,\tFirewalls\n\nflaky\ttests,\tFlaky\tand\tBrittle\tTests\n\nforeign\tkey\trelationships,\tbreaking,\tExample:\tBreaking\tForeign\tKey Relationships\n\nFPM\tpackage\tmanager\ttool,\tOperating\tSystem\tArtifacts\n\nfunctionality,\tdegrading,\tDegrading\tFunctionality\n\ngame\tdays,\tThe\tAntifragile\tOrganization\n\ngatekeepers,\tRole\tof\tthe\tCustodians\n\ngovernance\n\nconcept\tof,\tGovernance\tand\tLeading\tfrom\tthe\tCenter\n\nH\n\nrole\tof\tsystems\tarchitect\tin,\tSummary\n\ngranularity,\tWhat\tAbout\tService-Oriented\tArchitecture?\n\nGraphite,\tMetric\tTracking\tAcross\tMultiple\tServices\n\nhabitable\tsystems,\tAn\tEvolutionary\tVision\tfor\tthe\tArchitect\n\nHAL\t(Hypertext\tApplication\tLanguage),\tHAL\tand\tthe\tHAL\tBrowser\n\nhash-based\tmessaging\tcode\t(HMAC),\tHMAC\tOver\tHTTP\n\nHATEOS\tprinciple,\tHypermedia\tAs\tthe\tEngine\tof\tApplication\tState\n\nheterogeneity\n\nbenefits\tof,\tTechnology\tHeterogeneity\n\nshared\tlibraries\tand,\tShared\tLibraries\n\nhexagonal\tarchitecture,\tMicroservices\n\nhidden\tmodels,\tShared\tand\tHidden\tModels\n\nhigh\tcohesion,\tHigh\tCohesion\n\nHMAC\t(hash-based\tmessaging\tcode),\tHMAC\tOver\tHTTP\n\nHTTP\t(Hypertext\tTransfer\tProtocol)\n\ncaching\tin,\tCaching\tin\tHTTP\n\nHATEOS\tprinciple,\tHypermedia\tAs\tthe\tEngine\tof\tApplication\tState\n\nHTTP\tover\tREST\tbenefits,\tREST\tand\tHTTP\n\nHTTP\tover\tREST\tdrawbacks,\tDownsides\tto\tREST\tOver\tHTTP\n\nHTTP\ttermination,\tLoad\tBalancing\n\nHTTP(S)\tBasic\tAuthentication,\tHTTP(S)\tBasic\tAuthentication\n\nhumane\tregistry,\tHAL\tand\tthe\tHAL\tBrowser\n\nI\n\nhypermedia,\tHypermedia\tAs\tthe\tEngine\tof\tApplication\tState\n\nhypervisors,\tTraditional\tVirtualization\n\nHystrix\tlibrary,\tTailored\tService\tTemplate,\tBulkheads\n\nidempotent\toperations,\tIdempotency\n\nidentity\tprovider,\tCommon\tSingle\tSign-On\tImplementations\n\nimages\n\nas\tartifacts,\tImages\tas\tArtifacts\n\ncustom,\tCustom\tImages\n\nimmutable\tservers,\tImmutable\tServers\n\ninfrastructure\tautomation,\tMicroservices\n\nintegration\n\naccess\tby\treference,\tAccess\tby\tReference\n\nasynchronous\tevent-based\tcollaboration,\tImplementing\tAsynchronous Event-Based\tCollaboration\n\ncustomer\tinterface,\tInterfacing\twith\tCustomers\n\nDRY\t(Don’t\tRepeat\tYourself),\tDRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta Microservice\tWorld\n\ngoals\tfor,\tLooking\tfor\tthe\tIdeal\tIntegration\tTechnology\n\nguidelines\tfor,\tSummary\n\nimportance\tof,\tIntegration\n\norchestration\tvs.\tchoreography,\tOrchestration\tVersus\tChoreography\n\nreactive\textensions,\tReactive\tExtensions\n\nremote\tprocedure\tcalls,\tRemote\tProcedure\tCalls\n\nJ\n\nK\n\nREST\t(Representational\tState\tTransfer),\tREST\n\nservices\tas\tstate\tmachines,\tServices\tas\tState\tMachines\n\nshared\tdatabases,\tThe\tShared\tDatabase\n\nsynchronous\tvs.\tasynchronous\tcommunication,\tSynchronous\tVersus Asynchronous\n\nthird-party\tsoftware,\tIntegrating\twith\tThird-Party\tSoftware\n\nuser\tinterfaces,\tUser\tInterfaces\n\nversioning,\tVersioning\n\ninterfaces\n\ncoexisting\tnew\tand\told,\tCoexist\tDifferent\tEndpoints\n\ndeployment,\tA\tDeployment\tInterface\n\nstandards\testablishment\tfor,\tInterfaces\n\n(see\talso\tuser\tinterfaces)\n\ninternal\timplementation\tdetail,\tHide\tInternal\tImplementation\tDetail\n\ninternal\topen\tsource\tmodel,\tInternal\tOpen\tSource\n\nintrusion\tdetection\tsystems\t(IDS),\tIntrusion\tDetection\t(and\tPrevention)\tSystem\n\nintrusion\tprevention\tsystems\t(IPS),\tIntrusion\tDetection\t(and\tPrevention)\tSystem\n\nisolation,\tIsolation\n\nIT\tarchitects\t(see\tsystems\tarchitects)\n\nJSON,\tJSON,\tXML,\tor\tSomething\tElse?\n\nJSON\tweb\ttokens\t(JWT),\tHMAC\tOver\tHTTP\n\nKaryon,\tTailored\tService\tTemplate\n\nL\n\nM\n\nkey-based\tauthentication,\tAPI\tKeys\n\nKibana,\tLogs,\tLogs,\tand\tYet\tMore\tLogs…\n\nlatency,\tHow\tMuch\tIs\tToo\tMuch?\n\nLatency\tMonkey,\tThe\tAntifragile\tOrganization\n\nlayered\tarchitectures,\tMicroservices\n\nlibraries\n\nclient,\tClient\tLibraries\n\nservice\tmetrics,\tService\tMetrics\n\nshared,\tShared\tLibraries\n\nLinux\tcontainers,\tLinux\tContainers\n\nload\tbalancing,\tLoad\tBalancing\n\nload\tshedding,\tBulkheads\n\nlocal\tcalls,\tLocal\tCalls\tAre\tNot\tLike\tRemote\tCalls\n\nlogs\n\naggregated,\tLogs,\tLogs,\tand\tYet\tMore\tLogs…\n\n(see\talso\tmonitoring)\n\nsecurity\tissues,\tLogging\n\nstandardization\tof,\tStandardization\n\nlogstash,\tLogs,\tLogs,\tand\tYet\tMore\tLogs…\n\nloose\tcoupling,\tLoose\tCoupling,\tOrchestration\tVersus\tChoreography,\tLoose\tand Tightly\tCoupled\tOrganizations\n\nman-in-the-middle\tattacks,\tAllow\tEverything\tInside\tthe\tPerimeter\n\nMarick’s\tquadrant,\tTypes\tof\tTests\n\nmaturity,\tMaturity\n\nmean\ttime\tbetween\tfailures\t(MTBF),\tMean\tTime\tto\tRepair\tOver\tMean\tTime Between\tFailures?\n\nmean\ttime\tto\trepair\t(MTTR),\tMean\tTime\tto\tRepair\tOver\tMean\tTime\tBetween Failures?\n\nmessage\tbrokers,\tTechnology\tChoices\n\nmetrics\n\nlibraries\tfor,\tService\tMetrics\n\nservice\tmetrics,\tService\tMetrics\n\ntracking\tacross\tmultiple\tservices,\tMetric\tTracking\tAcross\tMultiple Services\n\nMetrics\tlibrary,\tTailored\tService\tTemplate\n\nmicroservices\n\nappropriate\tapplication\tof,\tWhen\tShouldn’t\tYou\tUse\tMicroservices?\n\nautonomy\tand,\tAutonomous,\tBuilding\ta\tTeam\n\nbenefits\tof,\tMicroservices\n\ncomposability\tof,\tComposability\n\ndefinition\tof\tterm,\tWhat\tAre\tMicroservices?\n\ndeployment\tease\tof,\tEase\tof\tDeployment\n\ndrawbacks\tof,\tNo\tSilver\tBullet,\tWhen\tShouldn’t\tYou\tUse\tMicroservices?\n\nkey\tprinciples\tof,\tBringing\tIt\tAll\tTogether\n\norganizational\talignment\tand,\tOrganizational\tAlignment\n\norigins\tof,\tMicroservices\n\nreplaceability\tand,\tOptimizing\tfor\tReplaceability\n\nresilience\tof,\tResilience\n\nscaling\tand,\tScaling\n\nsize\tand,\tSmall,\tand\tFocused\ton\tDoing\tOne\tThing\tWell\n\ntechnology\theterogeneity\tof,\tTechnology\tHeterogeneity\n\nvs.\tmodules,\tModules\n\nvs.\tservice-oriented\tarchitecture,\tWhat\tAbout\tService-Oriented Architecture?\n\nvs.\tshared\tlibraries,\tShared\tLibraries\n\nmicroservices\tat\tscale\n\nantifragile\tsystems,\tThe\tAntifragile\tOrganization\n\narchitectural\tsafety\tmeasures,\tArchitectural\tSafety\tMeasures\n\nautoscaling,\tAutoscaling\n\ncaching,\tCaching\n\ncaching\tfor\twrites,\tCaching\tfor\tWrites\n\nCAP\ttheorem,\tCAP\tTheorem\n\ncross-functional\trequirements\t(CFR),\tHow\tMuch\tIs\tToo\tMuch?\n\ndealing\twith\tfailures,\tFailure\tIs\tEverywhere\n\ndegrading\tfunctionality,\tDegrading\tFunctionality\n\ndocumenting\tservices,\tDocumenting\tServices\n\ndynamic\tservice\tregistries,\tDynamic\tService\tRegistries\n\nidempotent\toperations,\tIdempotency\n\nscaling,\tScaling\n\nscaling\tdatabases,\tScaling\tDatabases\n\nself-describing\tsystems,\tHAL\tand\tthe\tHAL\tBrowser\n\nservice\tdiscovery,\tService\tDiscovery\n\nmiddleware,\tTechnology\tChoices\n\nmocking\tvs.\tstubbing,\tMocking\tor\tStubbing\n\nmodeling\tservices\n\nbounded\tcontexts,\tThe\tBounded\tContext\n\nbusiness\tcapabilities,\tBusiness\tCapabilities\n\nbusiness\tconcepts,\tCommunication\tin\tTerms\tof\tBusiness\tConcepts\n\nkey\tconcepts,\tWhat\tMakes\ta\tGood\tService?\n\nmodules\tand\tservices,\tModules\tand\tServices\n\nnested\tbounded\tcontexts,\tTurtles\tAll\tthe\tWay\tDown\n\npremature\tdecomposition,\tPremature\tDecomposition\n\nshared\tvs.\thidden\tmodels,\tShared\tand\tHidden\tModels\n\ntechnical\tboundaries,\tThe\tTechnical\tBoundary\n\nmodular\tdecomposition,\tModules\n\nmodules,\tModules\tand\tServices\n\nmonitoring\n\ncascading\tfailures,\tThe\tCascade\n\ncentral\tlogging,\tLogs,\tLogs,\tand\tYet\tMore\tLogs…\n\ncomplexities\tof,\tMonitoring\n\ncorrelation\tIDs,\tCorrelation\tIDs\n\ndisplaying/sharing\tresults,\tConsider\tthe\tAudience\n\nmetric\ttracking\tacross\tmultiple\tservices,\tMetric\tTracking\tAcross Multiple\tServices\n\nmultiple\tservices/multiple\tservers,\tMultiple\tServices,\tMultiple\tServers\n\noverview\tof,\tSummary\n\nreal-time\treporting,\tThe\tFuture\n\nsemantic,\tImplementing\tSemantic\tMonitoring\n\nservice\tmetrics,\tService\tMetrics\n\nsingle\tservice/multiple\tservers,\tSingle\tService,\tMultiple\tServers\n\nsingle\tservice/single\tserver,\tSingle\tService,\tSingle\tServer\n\nstandardization\tof,\tStandardization\n\nstandards\testablishment\tand,\tMonitoring\n\nsynthetic,\tSynthetic\tMonitoring\n\nmonolithic\tsystems\n\ncodebases\tin,\tSmall,\tand\tFocused\ton\tDoing\tOne\tThing\tWell\n\nlack\tof\tcohesion/loose\tcoupling\tin,\tIt’s\tAll\tAbout\tSeams\n\nreporting\tdatabases\tin,\tThe\tReporting\tDatabase\n\nvs.\tservice-oriented\tarchitecture,\tWhat\tAbout\tService-Oriented Architecture?\n\nMoore’s\tlaw,\tConway’s\tLaw\tand\tSystem\tDesign\n\nMountebank,\tA\tSmarter\tStub\tService\n\nMTBF\t(mean\ttime\tbetween\tfailures),\tMean\tTime\tto\tRepair\tOver\tMean\tTime Between\tFailures?\n\nMTTR\t(mean\ttime\tto\trepair),\tMean\tTime\tto\tRepair\tOver\tMean\tTime\tBetween Failures?\n\nN\n\nO\n\nnested\tbounded\tcontexts,\tTurtles\tAll\tthe\tWay\tDown\n\nnetwork\tsegregation,\tNetwork\tSegregation\n\nnonfunctional\trequirements,\tCross-Functional\tTesting\n\nnormalization\tof\tdeviance,\tFlaky\tand\tBrittle\tTests\n\non-demand\tprovisioning\tsystems,\tScaling\n\non-demand\tvirtualization,\tMicroservices\n\nonion\tarchitecture,\tThe\tTechnical\tBoundary\n\nOpen\tWeb\tApplication\tSecurity\tProject\t(OWASP),\tBaking\tSecurity\tIn\n\nOpenID\tConnect,\tCommon\tSingle\tSign-On\tImplementations,\tUse\tSAML\tor OpenID\tConnect\n\noperating\tsystem\tartifacts,\tOperating\tSystem\tArtifacts\n\noperating\tsystems\tsecurity,\tOperating\tSystem\n\norchestration\tarchitecture,\tOrchestration\tVersus\tChoreography\n\norganizational\talignment,\tOrganizational\tAlignment\n\norganizational\tstructure\n\nConway’s\tlaw\tand,\tConway’s\tLaw\tand\tSystem\tDesign\n\neffect\ton\tsystems\tdesign,\tEvidence\n\nloose\tvs.\ttightly\tcoupled,\tLoose\tand\tTightly\tCoupled\tOrganizations\n\norphaned\tservices,\tThe\tOrphaned\tService?\n\nOSGI\t(Open\tSource\tGateway\tInitiative),\tModules\n\nownership\n\nshared,\tDrivers\tfor\tShared\tServices\n\nP\n\nR\n\nsystem\tdesign\tand,\tService\tOwnership\n\nPacker,\tCustom\tImages\n\nPact,\tPact\n\nPacto,\tPact\n\npartition\ttolerance\n\nin\tCAP\ttheorem,\tCAP\tTheorem\n\nsacrificing,\tSacrificing\tPartition\tTolerance?\n\npasswords,\tGo\twith\tthe\tWell\tKnown\n\nperformance\ttests,\tPerformance\tTests\n\nplatform\tas\ta\tservice\t(PaaS),\tPlatform\tas\ta\tService\n\nplatform-specific\tartifacts,\tPlatform-Specific\tArtifacts\n\nPolly\tfor\t.NET,\tBulkheads\n\nPostel’s\tLaw,\tDefer\tIt\tfor\tas\tLong\tas\tPossible\n\npredictive\tscaling,\tAutoscaling\n\nprincipal\tparty,\tAuthentication\tand\tAuthorization\n\nprivacy\tissues,\tBe\tFrugal\n\nproperty\ttesting,\tTypes\tof\tTests\n\nproxy\tcaching,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\nRabbitMQ,\tTechnology\tChoices\n\nRDBMS\t(relational\tdatabase\tmanagement\tsystems),\tScaling\tfor\tReads\n\nreactive\textensions\t(Rx),\tReactive\tExtensions\n\nreactive\tscaling,\tAutoscaling\n\nread\treplicas,\tScaling\tfor\tReads\n\nredesign,\tStarting\tAgain\n\nrefactoring\tdatabases,\tStaging\tthe\tBreak\n\nremote\tprocedure\tcalls,\tRemote\tProcedure\tCalls-Is\tRPC\tTerrible?\n\nbenefits\tand\tdrawbacks\tof,\tIs\tRPC\tTerrible?\n\nbrittleness,\tBrittleness\n\ndefinition\tof\tterm,\tRemote\tProcedure\tCalls\n\ntechnologies\tavailable,\tRemote\tProcedure\tCalls\n\ntechnology\tcoupling,\tTechnology\tCoupling\n\nvs.\tlocal\tcalls,\tLocal\tCalls\tAre\tNot\tLike\tRemote\tCalls\n\nreplaceability,\tOptimizing\tfor\tReplaceability\n\nreporting\tdatabases\n\nbackup\tdata\tpumps,\tBackup\tData\tPump\n\ndata\tpump\tguidelines,\tData\tPumps\n\ndata\tretrieval\tvia\tservice\tcalls,\tData\tRetrieval\tvia\tService\tCalls\n\nevent\tdata\tpumps,\tEvent\tData\tPump\n\ngeneric\teventing\tsystems,\tToward\tReal\tTime\n\nmonolithic\tapproach\tto,\tThe\tReporting\tDatabase\n\nthird-party\tsoftware,\tData\tRetrieval\tvia\tService\tCalls\n\nrequest/response\tcollaboration,\tSynchronous\tVersus\tAsynchronous\n\nresilience\tengineering,\tResilience,\tCaching\tfor\tResilience\n\nresources,\tREST\n\nS\n\nresponse\ttime,\tHow\tMuch\tIs\tToo\tMuch?\n\nREST\t(Representational\tState\tTransfer),\tREST-Downsides\tto\tREST\tOver HTTP\n\nATOM\tspecification,\tTechnology\tChoices\n\nconcept\tof,\tREST\n\nframeworks\tfor,\tBeware\tToo\tMuch\tConvenience\n\nHTTP\tover\tREST\tbenefits,\tREST\tand\tHTTP\n\nHTTP\tover\tREST\tdrawbacks,\tDownsides\tto\tREST\tOver\tHTTP\n\ntextual\tformats,\tJSON,\tXML,\tor\tSomething\tElse?\n\nreverse\tproxy,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\nRiemann,\tThe\tFuture\n\nrisk,\tspreading,\tSpreading\tYour\tRisk\n\nRobustness\tprinciple,\tDefer\tIt\tfor\tas\tLong\tas\tPossible\n\nRx\t(reactive\textensions),\tReactive\tExtensions\n\nSAML,\tCommon\tSingle\tSign-On\tImplementations,\tUse\tSAML\tor\tOpenID Connect\n\nSAN\t(storage\tarea\tnetworks),\tSpreading\tYour\tRisk\n\nscaling,\tScaling-Starting\tAgain\n\nautoscaling,\tAutoscaling\n\nbenefits\tof,\tScaling\n\ndatabases,\tScaling\tDatabases\n\nload\tbalancing,\tLoad\tBalancing\n\nreasons\tfor,\tScaling\n\nsplitting\tworkloads,\tSplitting\tWorkloads\n\nspreading\trisk,\tSpreading\tYour\tRisk\n\nvertical,\tGo\tBigger\n\nvs.\tredesign,\tStarting\tAgain\n\nworker-based\tsystems,\tWorker-Based\tSystems\n\nseams,\tconcept\tof,\tIt’s\tAll\tAbout\tSeams\n\nsecurity,\tSecurity-Summary\n\nattacks,\tdefending\tfrom,\tDefense\tin\tDepth\n\nauthentication/authorization,\tAuthentication\tand\tAuthorization\n\nbackups,\tBackup\tData\tPump,\tEncrypt\tBackups\n\neducation/awareness\tof,\tBaking\tSecurity\tIn\n\nencryption,\tGo\twith\tthe\tWell\tKnown\n\nexample\tsetup,\tA\tWorked\tExample\n\nexternal\tverification\tof,\tExternal\tVerification\n\nfirewalls,\tFirewalls\n\nhuman\telement\tof,\tThe\tHuman\tElement\n\nimportance\tof,\tSecurity\n\nintrusion\tdetection/prevention,\tIntrusion\tDetection\t(and\tPrevention) System\n\nkey\tstorage,\tIt’s\tAll\tAbout\tthe\tKeys\n\nlogs,\tLogging\n\nman-in-the-middle\tattacks,\tAllow\tEverything\tInside\tthe\tPerimeter\n\noperating\tsystems,\tOperating\tSystem\n\noverview\tof,\tSummary\n\npasswords,\tGo\twith\tthe\tWell\tKnown\n\nprivacy\tissues,\tBe\tFrugal\n\nsecuring\tdata\tat\trest,\tSecuring\tData\tat\tRest\n\nservice-to-service\tauthentication/authorization,\tService-to-Service Authentication\tand\tAuthorization\n\ntool\tselection,\tThe\tGolden\tRule\n\nvirtual\tprivate\tclouds,\tNetwork\tSegregation\n\nSecurity\tDevelopment\tLifecycle,\tBaking\tSecurity\tIn\n\nself-describing\tsystems,\tHAL\tand\tthe\tHAL\tBrowser\n\nsemantic\tmonitoring,\tSo\tShould\tYou\tUse\tEnd-to-End\tTests?,\tSynthetic Monitoring\n\nsemantic\tversioning,\tUse\tSemantic\tVersioning\n\nserver-side\tcaching,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\nservice\taccounts,\tUse\tSAML\tor\tOpenID\tConnect\n\nservice\tboundaries,\tZoning\n\n(see\talso\tmodeling\tservices)\n\nservice\tcalls,\tdata\tretrieval\tvia,\tData\tRetrieval\tvia\tService\tCalls\n\nservice\tconfiguration,\tService\tConfiguration\n\nservice\tdiscovery,\tService\tDiscovery\n\nservice\townership\n\ncomprehensive\tapproach,\tService\tOwnership\n\nshared,\tDrivers\tfor\tShared\tServices\n\nservice\tprovider,\tCommon\tSingle\tSign-On\tImplementations\n\nservice\tseparation,\tstaging,\tStaging\tthe\tBreak\n\n(see\talso\tdatabase\tdecomposition)\n\nservice\ttemplates,\tTailored\tService\tTemplate\n\nservice\ttests\n\nCohn’s\tTest\tPyramid,\tTest\tScope\n\nimplementation\tof,\tImplementing\tService\tTests\n\nmocking\tvs.\tstubbing,\tMocking\tor\tStubbing\n\nMountebank\tserver\tfor,\tA\tSmarter\tStub\tService\n\nscope\tof,\tService\tTests\n\nservice-oriented\tarchitectures\t(SOA)\n\nconcept\tof,\tWhat\tAbout\tService-Oriented\tArchitecture?\n\ndrawbacks\tof,\tWhat\tAbout\tService-Oriented\tArchitecture?\n\nreuse\tof\tfunctionality\tin,\tComposability\n\nvs.\tmicroservices,\tWhat\tAbout\tService-Oriented\tArchitecture?\n\nservice-to-host\tmapping,\tService-to-Host\tMapping-Platform\tas\ta\tService\n\napplication\tcontainers,\tApplication\tContainers\n\nmultiple\tservices\tper\thost,\tMultiple\tServices\tPer\tHost\n\nplatform\tas\ta\tservice\t(PaaS),\tPlatform\tas\ta\tService\n\nsingle\tservice\tper\thost,\tSingle\tService\tPer\tHost\n\nterminology,\tService-to-Host\tMapping\n\nservice-to-service\tauthentication/authorization,\tService-to-Service Authentication\tand\tAuthorization-The\tDeputy\tProblem\n\nAPI\tkeys,\tAPI\tKeys\n\nclient\tcertificates,\tClient\tCertificates\n\nconfused\tdeputy\tproblem,\tThe\tDeputy\tProblem\n\nHMAC\tover\tHTTP,\tHMAC\tOver\tHTTP\n\nHTTP(S)\tbasic,\tHTTP(S)\tBasic\tAuthentication\n\nman-in-the-middle\tattacks,\tAllow\tEverything\tInside\tthe\tPerimeter\n\nSAML/OpenID\tConnect,\tUse\tSAML\tor\tOpenID\tConnect\n\nsharding,\tScaling\tfor\tWrites\n\nshared\tcode,\tDRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta\tMicroservice\tWorld\n\nshared\tdata,\tExample:\tShared\tData\n\nshared\tlibraries,\tShared\tLibraries\n\nshared\tmodels,\tShared\tand\tHidden\tModels\n\nshared\tstatic\tdata,\tExample:\tShared\tStatic\tData\n\nshared\ttables,\tExample:\tShared\tTables\n\nsharing\tbehavior,\tThe\tShared\tDatabase\n\nsingle\tsign-on\t(SSO),\tCommon\tSingle\tSign-On\tImplementations-Single\tSign-On Gateway\n\nsmoke\ttest\tsuites,\tSeparating\tDeployment\tfrom\tRelease\n\nspies,\tMocking\tor\tStubbing\n\nSSH-multiplexing,\tSingle\tService,\tMultiple\tServers\n\nSSL\tcertificates,\tHTTP(S)\tBasic\tAuthentication\n\nSSL\ttermination,\tLoad\tBalancing\n\nstandards\tenforcement\n\nexemplars,\tExemplars\n\ntailored\tservice\ttemplates,\tTailored\tService\tTemplate\n\nstandards\testablishment,\tThe\tRequired\tStandard-Architectural\tSafety\n\narchitectural\tsafety,\tArchitectural\tSafety\n\nimportance\tof,\tThe\tRequired\tStandard\n\ninterfaces,\tInterfaces\n\nmonitoring,\tMonitoring\n\nstatic\tdata,\tExample:\tShared\tStatic\tData\n\nStrangler\tApplication\tPattern,\tThe\tStrangler\tPattern,\tArchitectural\tSafety Measures\n\nstrategic\tgoals\n\nreal-world\texample,\tA\tReal-World\tExample\n\nunderstanding,\tStrategic\tGoals\n\nstubbing\tvs.\tmocking,\tMocking\tor\tStubbing\n\nSuro,\tThe\tFuture\n\nSwagger,\tSwagger\n\nsynchronous\tcommunication,\tSynchronous\tVersus\tAsynchronous\n\nsynthetic\tmonitoring,\tSynthetic\tMonitoring\n\nsystem\tdesign\n\naccountability\tand,\tPeople\n\nadapting\tto\tcommunication\tpathways,\tAdapting\tto\tCommunication Pathways\n\nbounded\tcontexts,\tBounded\tContexts\tand\tTeam\tStructures\n\ncase\tstudy,\tCase\tStudy:\tRealEstate.com.au\n\nConway’s\tlaw\tof,\tConway’s\tLaw\tand\tSystem\tDesign\n\ndelivery\tbottlenecks,\tDelivery\tBottlenecks\n\neffect\ton\torganizational\tstructure,\tConway’s\tLaw\tin\tReverse\n\nfeature\tteams,\tFeature\tTeams\n\ninternal\topen\tsource\tmodel,\tInternal\tOpen\tSource\n\norganizational\tstructure\tand,\tEvidence\n\norphaned\tservices,\tThe\tOrphaned\tService?\n\noverview\tof,\tSummary\n\nrole\tof\tcustodians,\tRole\tof\tthe\tCustodians\n\nservice\tmaturity,\tMaturity\n\nservice\townership,\tService\tOwnership\n\nshared\tservice\townership,\tDrivers\tfor\tShared\tServices\n\ntooling,\tTooling\n\nsystems\tarchitects\n\nchallenges\tfaced\tby,\tSummary\n\ndecision-making\tguidelines\tfor,\tA\tPrincipled\tApproach\n\nexception\thandling,\tException\tHandling\n\ngovernance,\tGovernance\tand\tLeading\tfrom\tthe\tCenter\n\nresponsibilities\tof,\tInaccurate\tComparisons,\tTechnical\tDebt,\tSummary\n\nrole\tof,\tAn\tEvolutionary\tVision\tfor\tthe\tArchitect\n\nservice\tboundaries\tand,\tZoning\n\nstandards\tenforcement\tby,\tGovernance\tThrough\tCode-Tailored\tService Template\n\nstandards\testablishment\tby,\tThe\tRequired\tStandard\n\nteam\tbuilding\tby,\tBuilding\ta\tTeam\n\nT\n\nteam\tparticipation\tby,\tZoning\n\ntechnical\tdebt\tand,\tTechnical\tDebt\n\ntables,\tshared,\tExample:\tShared\tTables\n\ntailored\tservice\ttemplates,\tTailored\tService\tTemplate\n\nteam\tbuilding,\tBuilding\ta\tTeam\n\nteam\tstructures,\tBounded\tContexts\tand\tTeam\tStructures\n\ntechnical\tboundaries,\tThe\tTechnical\tBoundary\n\ntechnical\tdebt,\tTechnical\tDebt\n\ntechnology\theterogeneity,\tTechnology\tHeterogeneity\n\ntechnology-agnostic\tAPIs,\tKeep\tYour\tAPIs\tTechnology-Agnostic\n\ntechnology-facing\ttests,\tTypes\tof\tTests\n\ntemplates,\tTailored\tService\tTemplate\n\ntest\tdoubles,\tMocking\tor\tStubbing\n\nTest\tPyramid,\tTest\tScope,\tConsumer-Driven\tTests\tto\tthe\tRescue\n\ntest\tsnow\tcone,\tHow\tMany?\n\ntest-driven\tdesign\t(TDD),\tUnit\tTests\n\ntesting\n\ncanary\treleasing,\tCanary\tReleasing\n\nconsiderations\tfor,\tTrade-Offs\n\nconsumer-driven\ttests,\tConsumer-Driven\tTests\tto\tthe\tRescue\n\ncross-functional,\tCross-Functional\tTesting\n\nend-to-end\ttests,\tThose\tTricky\tEnd-to-End\tTests\n\nMTTR\tover\tMTBF,\tMean\tTime\tto\tRepair\tOver\tMean\tTime\tBetween Failures?\n\noverview\tof,\tSummary\n\nperformance\ttests,\tPerformance\tTests\n\npost-production,\tTesting\tAfter\tProduction\n\nscope\tof,\tTest\tScope\n\nselecting\tnumber\tof,\tHow\tMany?\n\nsemantic\tmonitoring,\tSo\tShould\tYou\tUse\tEnd-to-End\tTests?\n\nseparating\tdeployment\tfrom\trelease,\tSeparating\tDeployment\tfrom Release\n\nservice\ttest\timplementation,\tImplementing\tService\tTests\n\ntypes\tof\ttests,\tTypes\tof\tTests\n\nthird-party\tsoftware,\tIntegrating\twith\tThird-Party\tSoftware-The\tStrangler Pattern,\tData\tRetrieval\tvia\tService\tCalls\n\nbuilding\tvs.\tbuying,\tIntegrating\twith\tThird-Party\tSoftware\n\ncontent\tmanagement\tsystems\t(CMS),\tExample:\tCMS\tas\ta\tservice\n\nCustomer\tRelationship\tManagement\t(CRM),\tExample:\tThe\tmultirole CRM\tsystem\n\ncustomization\tof,\tCustomization\n\nintegration\tissues,\tIntegration\tSpaghetti\n\nlack\tof\tcontrol\tover,\tLack\tof\tControl\n\nreporting\tdatabases,\tData\tRetrieval\tvia\tService\tCalls\n\nStrangler\tApplication\tPattern,\tThe\tStrangler\tPattern\n\ntight\tcoupling,\tLoose\tCoupling,\tLoose\tand\tTightly\tCoupled\tOrganizations\n\nU\n\ntime\tto\tlive\t(TTL),\tDNS\n\ntimeouts,\tTimeouts\n\ntransaction\tmanagers,\tDistributed\tTransactions\n\ntransactional\tboundaries,\tTransactional\tBoundaries-So\tWhat\tto\tDo?\n\ntransactions\n\ncompensating,\tAbort\tthe\tEntire\tOperation\n\ndistributed,\tDistributed\tTransactions\n\nTransport\tLayer\tSecurity\t(TLS),\tClient\tCertificates\n\ntwo-phase\tcommits,\tDistributed\tTransactions\n\ntype\t2\tvirtualization,\tTraditional\tVirtualization\n\nUDDI\t(Universal\tDescription,\tDiscovery,\tand\tIntegration),\tHAL\tand\tthe\tHAL Browser\n\nunit\ttests\n\nCohn’s\tTest\tPyramid,\tTest\tScope\n\ngoals\tof,\tUnit\tTests\n\nMarick’s\tquadrant,\tTypes\tof\tTests\n\nscope\tof,\tUnit\tTests\n\nuser\tinterfaces,\tUser\tInterfaces-A\tHybrid\tApproach\n\nAPI\tcomposition,\tAPI\tComposition\n\nAPI\tgateways,\tBackends\tfor\tFrontends\n\nAPI\tgranularity,\tToward\tDigital\n\nCohn’s\tTest\tPyramid,\tTest\tScope\n\n(see\talso\tend-to-end\ttests)\n\nV\n\nconstraints,\tConstraints\n\nevolution\tof,\tUser\tInterfaces\n\nfragment\tcomposition,\tUI\tFragment\tComposition\n\nhybrid\tapproaches,\tA\tHybrid\tApproach\n\nVagrant,\tVagrant\n\nversioning,\tVersioning-Use\tMultiple\tConcurrent\tService\tVersions\n\ncatching\tbreaking\tchanges\tearly,\tCatch\tBreaking\tChanges\tEarly\n\ncoexisting\tdifferent\tendpoints,\tCoexist\tDifferent\tEndpoints\n\ndeferring\tbreaking\tchanges,\tDefer\tIt\tfor\tas\tLong\tas\tPossible\n\nmultiple\tconcurrent\tversions,\tUse\tMultiple\tConcurrent\tService\tVersions\n\nsemantic,\tUse\tSemantic\tVersioning\n\nvertical\tscaling,\tGo\tBigger\n\nvirtual\tprivate\tclouds\t(VPC),\tNetwork\tSegregation\n\nvirtualization\n\nhypervisors,\tTraditional\tVirtualization\n\ntraditional,\tTraditional\tVirtualization\n\ntype\t2,\tTraditional\tVirtualization\n\nvirtualization\tplatforms\n\nDocker,\tDocker\n\nLinux\tcontainers,\tLinux\tContainers\n\non-demand,\tMicroservices\n\nstorage\tarea\tnetworks\tin,\tSpreading\tYour\tRisk\n\nW\n\nX\n\nZ\n\nVagrant,\tVagrant\n\nvision,\tSummary\n\nworker-based\tsystems,\tWorker-Based\tSystems\n\nwrite-behind\tcaches,\tCaching\tfor\tResilience\n\nXML,\tJSON,\tXML,\tor\tSomething\tElse?\n\nZed\tAttack\tProxy\t(ZAP),\tBaking\tSecurity\tIn\n\nZipkin,\tCorrelation\tIDs\n\nZookeeper,\tZookeeper\n\nAbout\tthe\tAuthor\n\nSam\tNewman\tis\ta\ttechnologist\tat\tThoughtWorks,\twhere\the\tcurrently\tsplits\this\ttime between\thelping\tclients\tand\tworking\tas\tan\tarchitect\tfor\tThoughtWorks’\town\tinternal systems.\tHe\thas\tworked\twith\ta\tvariety\tof\tcompanies\tin\tmultiple\tdomains\taround\tthe world,\toften\twith\tone\tfoot\tin\tthe\tdeveloper\tworld,\tand\tanother\tin\tthe\tIT\toperations\tspace. If\tyou\tasked\thim\twhat\the\tdoes,\the’d\tsay,\t“I\twork\twith\tpeople\tto\tbuild\tbetter\tsoftware systems.”\tHe\thas\twritten\tarticles,\tpresented\tat\tconferences,\tand\tsporadically\tcommits\tto open\tsource\tprojects.\n\nColophon\n\nThe\tanimals\ton\tthe\tcover\tof\tBuilding\tMicroservices\tare\thoney\tbees\t(of\tthe\tgenus\tApis).\tOf 20,000\tknown\tspecies\tof\tbees,\tonly\tseven\tare\tconsidered\thoney\tbees.\tThey\tare\tdistinct because\tthey\tproduce\tand\tstore\thoney,\tas\twell\tas\tbuilding\thives\tfrom\twax.\tBeekeeping\tto collect\thoney\thas\tbeen\ta\thuman\tpursuit\tfor\tthousands\tof\tyears.\n\nHoney\tbees\tlive\tin\thives\twith\tthousands\tof\tindividuals\tand\thave\ta\tvery\torganized\tsocial structure.\tThere\tare\tthree\tcastes:\tqueen,\tdrone,\tand\tworker.\tEach\thive\thas\tone\tqueen,\twho remains\tfertile\tfor\t3–5\tyears\tafter\ther\tmating\tflight,\tand\tlays\tup\tto\t2,000\teggs\tper\tday. Drones\tare\tmale\tbees\twho\tmate\twith\tthe\tqueen\t(and\tdie\tin\tthe\tact\tbecause\tof\ttheir\tbarbed sex\torgans).\tWorker\tbees\tare\tsterile\tfemales\twho\tfill\tmany\troles\tduring\ttheir\tlifetime,\tsuch as\tnursemaid,\tconstruction\tworker,\tgrocer,\tguard,\tundertaker,\tand\tforager.\tForaging worker\tbees\tcommunicate\twith\tone\tanother\tby\t“dancing”\tin\tparticular\tpatterns\tto\tshare information\tabout\tnearby\tresources.\n\nAll\tthree\tcastes\tof\thoney\tbee\tare\tsimilar\tin\tappearance,\twith\twings,\tsix\tlegs,\tand\ta\tbody segmented\tinto\ta\thead,\tthorax,\tand\tabdomen.\tThey\thave\tshort\tfuzzy\thairs\tin\ta\tstriped yellow\tand\tblack\tpattern.\tTheir\tdiet\tis\tmade\tup\texclusively\tof\thoney,\twhich\tis\tcreated\tby\ta process\tof\tpartially\tdigesting\tand\tregurgitating\tsugar-rich\tflower\tnectar.\n\nBees\tare\tcrucial\tto\tagriculture,\tas\tthey\tpollinate\tcrops\tand\tother\tflowering\tplants\twhile they\tcollect\tpollen\tand\tnectar.\tOn\taverage,\teach\thive\tof\tbees\tgathers\t66\tpounds\tof\tpollen\ta year.\tIn\trecent\tyears,\tthe\tdecline\tof\tmany\tbee\tspecies\thas\tbeen\tcause\tfor\tconcern\tand\tis known\tas\t“colony\tcollapse\tdisorder.”\tIt\tis\tstill\tunclear\twhat\tis\tcausing\tthis\tdie-off:\tsome theories\tinclude\tparasites,\tinsecticide\tuse,\tor\tdisease,\tbut\tno\teffective\tpreventative measures\thave\tbeen\tfound\tto\tdate.\n\nMany\tof\tthe\tanimals\ton\tO’Reilly\tcovers\tare\tendangered;\tall\tof\tthem\tare\timportant\tto\tthe world.\tTo\tlearn\tmore\tabout\thow\tyou\tcan\thelp,\tgo\tto\tanimals.oreilly.com.\n\nThe\tcover\timage\tis\tfrom\tJohnson’s\tNatural\tHistory.\tThe\tcover\tfonts\tare\tURW\tTypewriter and\tGuardian\tSans.\tThe\ttext\tfont\tis\tAdobe\tMinion\tPro;\tthe\theading\tfont\tis\tAdobe\tMyriad Condensed;\tand\tthe\tcode\tfont\tis\tDalton\tMaag’s\tUbuntu\tMono.\n\nPreface\n\nWho\tShould\tRead\tThis\tBook\n\nWhy\tI\tWrote\tThis\tBook\n\nA\tWord\ton\tMicroservices\tToday\n\nNavigating\tThis\tBook\n\nConventions\tUsed\tin\tThis\tBook\n\nSafari®\tBooks\tOnline\n\nHow\tto\tContact\tUs\n\nAcknowledgments\n\n1.\tMicroservices\n\nWhat\tAre\tMicroservices?\n\nSmall,\tand\tFocused\ton\tDoing\tOne\tThing\tWell\n\nAutonomous\n\nKey\tBenefits\n\nTechnology\tHeterogeneity\n\nResilience\n\nScaling\n\nEase\tof\tDeployment\n\nOrganizational\tAlignment\n\nComposability\n\nOptimizing\tfor\tReplaceability\n\nWhat\tAbout\tService-Oriented\tArchitecture?\n\nOther\tDecompositional\tTechniques\n\nShared\tLibraries\n\nModules\n\nNo\tSilver\tBullet\n\nSummary\n\n2.\tThe\tEvolutionary\tArchitect\n\nInaccurate\tComparisons\n\nAn\tEvolutionary\tVision\tfor\tthe\tArchitect\n\nZoning\n\nA\tPrincipled\tApproach\n\nStrategic\tGoals\n\nPrinciples\n\nPractices\n\nCombining\tPrinciples\tand\tPractices\n\nA\tReal-World\tExample\n\nThe\tRequired\tStandard\n\nMonitoring\n\nInterfaces\n\nArchitectural\tSafety\n\nGovernance\tThrough\tCode\n\nExemplars\n\nTailored\tService\tTemplate\n\nTechnical\tDebt\n\nException\tHandling\n\nGovernance\tand\tLeading\tfrom\tthe\tCenter\n\nBuilding\ta\tTeam\n\nSummary\n\n3.\tHow\tto\tModel\tServices\n\nIntroducing\tMusicCorp\n\nWhat\tMakes\ta\tGood\tService?\n\nLoose\tCoupling\n\nHigh\tCohesion\n\nThe\tBounded\tContext\n\nShared\tand\tHidden\tModels\n\nModules\tand\tServices\n\nPremature\tDecomposition\n\nBusiness\tCapabilities\n\nTurtles\tAll\tthe\tWay\tDown\n\nCommunication\tin\tTerms\tof\tBusiness\tConcepts\n\nThe\tTechnical\tBoundary\n\nSummary\n\n4.\tIntegration\n\nLooking\tfor\tthe\tIdeal\tIntegration\tTechnology\n\nAvoid\tBreaking\tChanges\n\nKeep\tYour\tAPIs\tTechnology-Agnostic\n\nMake\tYour\tService\tSimple\tfor\tConsumers\n\nHide\tInternal\tImplementation\tDetail\n\nInterfacing\twith\tCustomers\n\nThe\tShared\tDatabase\n\nSynchronous\tVersus\tAsynchronous\n\nOrchestration\tVersus\tChoreography\n\nRemote\tProcedure\tCalls\n\nTechnology\tCoupling\n\nLocal\tCalls\tAre\tNot\tLike\tRemote\tCalls\n\nBrittleness\n\nIs\tRPC\tTerrible?\n\nREST\n\nREST\tand\tHTTP\n\nHypermedia\tAs\tthe\tEngine\tof\tApplication\tState\n\nJSON,\tXML,\tor\tSomething\tElse?\n\nBeware\tToo\tMuch\tConvenience\n\nDownsides\tto\tREST\tOver\tHTTP\n\nImplementing\tAsynchronous\tEvent-Based\tCollaboration\n\nTechnology\tChoices\n\nComplexities\tof\tAsynchronous\tArchitectures\n\nServices\tas\tState\tMachines\n\nReactive\tExtensions\n\nDRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta\tMicroservice\tWorld\n\nClient\tLibraries\n\nAccess\tby\tReference\n\nVersioning\n\nDefer\tIt\tfor\tas\tLong\tas\tPossible\n\nCatch\tBreaking\tChanges\tEarly\n\nUse\tSemantic\tVersioning\n\nCoexist\tDifferent\tEndpoints\n\nUse\tMultiple\tConcurrent\tService\tVersions\n\nUser\tInterfaces\n\nToward\tDigital\n\nConstraints\n\nAPI\tComposition\n\nUI\tFragment\tComposition\n\nBackends\tfor\tFrontends\n\nA\tHybrid\tApproach\n\nIntegrating\twith\tThird-Party\tSoftware\n\nLack\tof\tControl\n\nCustomization\n\nIntegration\tSpaghetti\n\nOn\tYour\tOwn\tTerms\n\nThe\tStrangler\tPattern\n\nSummary\n\n5.\tSplitting\tthe\tMonolith\n\nIt’s\tAll\tAbout\tSeams\n\nBreaking\tApart\tMusicCorp\n\nThe\tReasons\tto\tSplit\tthe\tMonolith\n\nPace\tof\tChange\n\nTeam\tStructure\n\nSecurity\n\nTechnology\n\nTangled\tDependencies\n\nThe\tDatabase\n\nGetting\tto\tGrips\twith\tthe\tProblem\n\nExample:\tBreaking\tForeign\tKey\tRelationships\n\nExample:\tShared\tStatic\tData\n\nExample:\tShared\tData\n\nExample:\tShared\tTables\n\nRefactoring\tDatabases\n\nStaging\tthe\tBreak\n\nTransactional\tBoundaries\n\nTry\tAgain\tLater\n\nAbort\tthe\tEntire\tOperation\n\nDistributed\tTransactions\n\nSo\tWhat\tto\tDo?\n\nReporting\n\nThe\tReporting\tDatabase\n\nData\tRetrieval\tvia\tService\tCalls\n\nData\tPumps\n\nAlternative\tDestinations\n\nEvent\tData\tPump\n\nBackup\tData\tPump\n\nToward\tReal\tTime\n\nCost\tof\tChange\n\nUnderstanding\tRoot\tCauses\n\nSummary\n\n6.\tDeployment\n\nA\tBrief\tIntroduction\tto\tContinuous\tIntegration\n\nAre\tYou\tReally\tDoing\tIt?\n\nMapping\tContinuous\tIntegration\tto\tMicroservices\n\nBuild\tPipelines\tand\tContinuous\tDelivery\n\nAnd\tthe\tInevitable\tExceptions\n\nPlatform-Specific\tArtifacts\n\nOperating\tSystem\tArtifacts\n\nCustom\tImages\n\nImages\tas\tArtifacts\n\nImmutable\tServers\n\nEnvironments\n\nService\tConfiguration\n\nService-to-Host\tMapping\n\nMultiple\tServices\tPer\tHost\n\nApplication\tContainers\n\nSingle\tService\tPer\tHost\n\nPlatform\tas\ta\tService\n\nAutomation\n\nTwo\tCase\tStudies\ton\tthe\tPower\tof\tAutomation\n\nFrom\tPhysical\tto\tVirtual\n\nTraditional\tVirtualization\n\nVagrant\n\nLinux\tContainers\n\nDocker\n\nA\tDeployment\tInterface\n\nEnvironment\tDefinition\n\nSummary\n\n7.\tTesting\n\nTypes\tof\tTests\n\nTest\tScope\n\nUnit\tTests\n\nService\tTests\n\nEnd-to-End\tTests\n\nTrade-Offs\n\nHow\tMany?\n\nImplementing\tService\tTests\n\nMocking\tor\tStubbing\n\nA\tSmarter\tStub\tService\n\nThose\tTricky\tEnd-to-End\tTests\n\nDownsides\tto\tEnd-to-End\tTesting\n\nFlaky\tand\tBrittle\tTests\n\nWho\tWrites\tThese\tTests?\n\nHow\tLong?\n\nThe\tGreat\tPile-up\n\nThe\tMetaversion\n\nTest\tJourneys,\tNot\tStories\n\nConsumer-Driven\tTests\tto\tthe\tRescue\n\nPact\n\nIt’s\tAbout\tConversations\n\nSo\tShould\tYou\tUse\tEnd-to-End\tTests?\n\nTesting\tAfter\tProduction\n\nSeparating\tDeployment\tfrom\tRelease\n\nCanary\tReleasing\n\nMean\tTime\tto\tRepair\tOver\tMean\tTime\tBetween\tFailures?\n\nCross-Functional\tTesting\n\nPerformance\tTests\n\nSummary\n\n8.\tMonitoring\n\nSingle\tService,\tSingle\tServer\n\nSingle\tService,\tMultiple\tServers\n\nMultiple\tServices,\tMultiple\tServers\n\nLogs,\tLogs,\tand\tYet\tMore\tLogs…\n\nMetric\tTracking\tAcross\tMultiple\tServices\n\nService\tMetrics\n\nSynthetic\tMonitoring\n\nImplementing\tSemantic\tMonitoring\n\nCorrelation\tIDs\n\nThe\tCascade\n\nStandardization\n\nConsider\tthe\tAudience\n\nThe\tFuture\n\nSummary\n\n9.\tSecurity\n\nAuthentication\tand\tAuthorization\n\nCommon\tSingle\tSign-On\tImplementations\n\nSingle\tSign-On\tGateway\n\nFine-Grained\tAuthorization\n\nService-to-Service\tAuthentication\tand\tAuthorization\n\nAllow\tEverything\tInside\tthe\tPerimeter\n\nHTTP(S)\tBasic\tAuthentication\n\nUse\tSAML\tor\tOpenID\tConnect\n\nClient\tCertificates\n\nHMAC\tOver\tHTTP\n\nAPI\tKeys\n\nThe\tDeputy\tProblem\n\nSecuring\tData\tat\tRest\n\nGo\twith\tthe\tWell\tKnown\n\nIt’s\tAll\tAbout\tthe\tKeys\n\nPick\tYour\tTargets\n\nDecrypt\ton\tDemand\n\nEncrypt\tBackups\n\nDefense\tin\tDepth\n\nFirewalls\n\nLogging\n\nIntrusion\tDetection\t(and\tPrevention)\tSystem\n\nNetwork\tSegregation\n\nOperating\tSystem\n\nA\tWorked\tExample\n\nBe\tFrugal\n\nThe\tHuman\tElement\n\nThe\tGolden\tRule\n\nBaking\tSecurity\tIn\n\nExternal\tVerification\n\nSummary\n\n10.\tConway’s\tLaw\tand\tSystem\tDesign\n\nEvidence\n\nLoose\tand\tTightly\tCoupled\tOrganizations\n\nWindows\tVista\n\nNetflix\tand\tAmazon\n\nWhat\tCan\tWe\tDo\twith\tThis?\n\nAdapting\tto\tCommunication\tPathways\n\nService\tOwnership\n\nDrivers\tfor\tShared\tServices\n\nToo\tHard\tto\tSplit\n\nFeature\tTeams\n\nDelivery\tBottlenecks\n\nInternal\tOpen\tSource\n\nRole\tof\tthe\tCustodians\n\nMaturity\n\nTooling\n\nBounded\tContexts\tand\tTeam\tStructures\n\nThe\tOrphaned\tService?\n\nCase\tStudy:\tRealEstate.com.au\n\nConway’s\tLaw\tin\tReverse\n\nPeople\n\nSummary\n\n11.\tMicroservices\tat\tScale\n\nFailure\tIs\tEverywhere\n\nHow\tMuch\tIs\tToo\tMuch?\n\nDegrading\tFunctionality\n\nArchitectural\tSafety\tMeasures\n\nThe\tAntifragile\tOrganization\n\nTimeouts\n\nCircuit\tBreakers\n\nBulkheads\n\nIsolation\n\nIdempotency\n\nScaling\n\nGo\tBigger\n\nSplitting\tWorkloads\n\nSpreading\tYour\tRisk\n\nLoad\tBalancing\n\nWorker-Based\tSystems\n\nStarting\tAgain\n\nScaling\tDatabases\n\nAvailability\tof\tService\tVersus\tDurability\tof\tData\n\nScaling\tfor\tReads\n\nScaling\tfor\tWrites\n\nShared\tDatabase\tInfrastructure\n\nCQRS\n\nCaching\n\nClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\nCaching\tin\tHTTP\n\nCaching\tfor\tWrites\n\nCaching\tfor\tResilience\n\nHiding\tthe\tOrigin\n\nKeep\tIt\tSimple\n\nCache\tPoisoning:\tA\tCautionary\tTale\n\nAutoscaling\n\nCAP\tTheorem\n\nSacrificing\tConsistency\n\nSacrificing\tAvailability\n\nSacrificing\tPartition\tTolerance?\n\nAP\tor\tCP?\n\nIt’s\tNot\tAll\tor\tNothing\n\nAnd\tthe\tReal\tWorld\n\nService\tDiscovery\n\nDNS\n\nDynamic\tService\tRegistries\n\nZookeeper\n\nConsul\n\nEureka\n\nRolling\tYour\tOwn\n\nDon’t\tForget\tthe\tHumans!\n\nDocumenting\tServices\n\nSwagger\n\nHAL\tand\tthe\tHAL\tBrowser\n\nThe\tSelf-Describing\tSystem\n\nSummary\n\n12.\tBringing\tIt\tAll\tTogether\n\nPrinciples\tof\tMicroservices\n\nModel\tAround\tBusiness\tConcepts\n\nAdopt\ta\tCulture\tof\tAutomation\n\nHide\tInternal\tImplementation\tDetails\n\nDecentralize\tAll\tthe\tThings\n\nIndependently\tDeployable\n\nIsolate\tFailure\n\nHighly\tObservable\n\nWhen\tShouldn’t\tYou\tUse\tMicroservices?\n\nParting\tWords\n\nIndex",
      "page_number": 411
    }
  ],
  "pages": [
    {
      "page_number": 2,
      "content": "Sam\tNewman\n\nBuilding\tMicroservices",
      "content_length": 34,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 3,
      "content": "Building\tMicroservices\n\nby\tSam\tNewman\n\nCopyright\t©\t2015\tSam\tNewman.\tAll\trights\treserved.\n\nPrinted\tin\tthe\tUnited\tStates\tof\tAmerica.\n\nPublished\tby\tO’Reilly\tMedia,\tInc.,\t1005\tGravenstein\tHighway\tNorth,\tSebastopol,\tCA 95472.\n\nO’Reilly\tbooks\tmay\tbe\tpurchased\tfor\teducational,\tbusiness,\tor\tsales\tpromotional\tuse. Online\teditions\tare\talso\tavailable\tfor\tmost\ttitles\t(http://safaribooksonline.com).\tFor\tmore information,\tcontact\tour\tcorporate/institutional\tsales\tdepartment:\t800-998-9938\tor corporate@oreilly.com.\n\nEditors:\tMike\tLoukides\tand\tBrian\tMacDonald\n\nProduction\tEditor:\tKristen\tBrown\n\nCopyeditor:\tRachel\tMonaghan\n\nProofreader:\tJasmine\tKwityn\n\nIndexer:\tJudith\tMcConville\n\nInterior\tDesigner:\tDavid\tFutato\n\nCover\tDesigner:\tEllie\tVolckhausen\n\nIllustrator:\tRebecca\tDemarest\n\nFebruary\t2015:\tFirst\tEdition",
      "content_length": 797,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 4,
      "content": "Revision\tHistory\tfor\tthe\tFirst\tEdition\n\n2014-01-30:\tFirst\tRelease\n\nSee\thttp://oreilly.com/catalog/errata.csp?isbn=9781491950357\tfor\trelease\tdetails.\n\nThe\tO’Reilly\tlogo\tis\ta\tregistered\ttrademark\tof\tO’Reilly\tMedia,\tInc.\tBuilding Microservices,\tthe\tcover\timage\tof\thoney\tbees,\tand\trelated\ttrade\tdress\tare\ttrademarks\tof O’Reilly\tMedia,\tInc.\n\nWhile\tthe\tpublisher\tand\tthe\tauthor\thave\tused\tgood\tfaith\tefforts\tto\tensure\tthat\tthe information\tand\tinstructions\tcontained\tin\tthis\twork\tare\taccurate,\tthe\tpublisher\tand\tthe author\tdisclaim\tall\tresponsibility\tfor\terrors\tor\tomissions,\tincluding\twithout\tlimitation responsibility\tfor\tdamages\tresulting\tfrom\tthe\tuse\tof\tor\treliance\ton\tthis\twork.\tUse\tof\tthe information\tand\tinstructions\tcontained\tin\tthis\twork\tis\tat\tyour\town\trisk.\tIf\tany\tcode samples\tor\tother\ttechnology\tthis\twork\tcontains\tor\tdescribes\tis\tsubject\tto\topen\tsource licenses\tor\tthe\tintellectual\tproperty\trights\tof\tothers,\tit\tis\tyour\tresponsibility\tto\tensure\tthat your\tuse\tthereof\tcomplies\twith\tsuch\tlicenses\tand/or\trights.\n\n978-1-491-95035-7\n\n[LSI]",
      "content_length": 1040,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 5,
      "content": "Preface\n\nMicroservices\tare\tan\tapproach\tto\tdistributed\tsystems\tthat\tpromote\tthe\tuse\tof\tfinely grained\tservices\twith\ttheir\town\tlifecycles,\twhich\tcollaborate\ttogether.\tBecause microservices\tare\tprimarily\tmodeled\taround\tbusiness\tdomains,\tthey\tavoid\tthe\tproblems\tof traditional\ttiered\tarchitectures.\tMicroservices\talso\tintegrate\tnew\ttechnologies\tand techniques\tthat\thave\temerged\tover\tthe\tlast\tdecade,\twhich\thelps\tthem\tavoid\tthe\tpitfalls\tof many\tservice-oriented\tarchitecture\timplementations.\n\nThis\tbook\tis\tfull\tof\tconcrete\texamples\tof\tmicroservice\tuse\taround\tthe\tworld,\tincluding\tin organizations\tlike\tNetflix,\tAmazon,\tGilt,\tand\tthe\tREA\tgroup,\twho\thave\tall\tfound\tthat\tthe increased\tautonomy\tthis\tarchitecture\tgives\ttheir\tteams\tis\ta\thuge\tadvantage.",
      "content_length": 742,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 6,
      "content": "Who\tShould\tRead\tThis\tBook\n\nThe\tscope\tof\tthis\tbook\tis\tbroad,\tas\tthe\timplications\tof\tfine-grained\tmicroservice architectures\tare\talso\tbroad.\tAs\tsuch,\tit\tshould\tappeal\tto\tpeople\tinterested\tin\taspects\tof design,\tdevelopment,\tdeployment,\ttesting,\tand\tmaintenance\tof\tsystems.\tThose\tof\tyou\twho have\talready\tembarked\ton\tthe\tjourney\ttoward\tfiner-grained\tarchitectures,\twhether\tfor\ta greenfield\tapplication\tor\tas\tpart\tof\tdecomposing\tan\texisting,\tmore\tmonolithic\tsystem,\twill find\tplenty\tof\tpractical\tadvice\tto\thelp\tyou.\tIt\twill\talso\thelp\tthose\tof\tyou\twho\twant\tto\tknow what\tall\tthe\tfuss\tis\tabout,\tso\tthat\tyou\tcan\tdetermine\twhether\tmicroservices\tare\tright\tfor you.",
      "content_length": 652,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 7,
      "content": "Why\tI\tWrote\tThis\tBook\n\nI\tstarted\tthinking\tabout\tthe\ttopic\tof\tapplication\tarchitectures\tmany\tyears\tago,\twhen working\tto\thelp\tpeople\tdeliver\ttheir\tsoftware\tfaster.\tI\trealized\tthat\twhile\tinfrastructure automation,\ttesting,\tand\tcontinuous\tdelivery\ttechniques\tcould\thelp,\tif\tthe\tfundamental design\tof\tthe\tsystem\tdoesn’t\tmake\tit\teasy\tto\tmake\tchanges,\tthen\tthere\tare\tlimits\tto\twhat can\tbe\taccomplished.\n\nAt\tthe\tsame\ttime,\tmany\torganizations\twere\texperimenting\twith\tfiner-grained\tarchitectures to\taccomplish\tsimilar\tgoals,\tbut\talso\tto\tachieve\tthings\tlike\timproved\tscaling,\tincreasing autonomy\tof\tteams,\tor\tto\tmore\teasily\tembrace\tnew\ttechnologies.\tMy\town\texperiences,\tas well\tas\tthose\tof\tmy\tcolleagues\tat\tThoughtWorks\tand\telsewhere,\treinforced\tthe\tfact\tthat using\tlarger\tnumbers\tof\tservices\twith\ttheir\town\tindependent\tlifecycles\tresulted\tin\tmore headaches\tthat\thad\tto\tbe\tdealt\twith.\tIn\tmany\tways,\tthis\tbook\twas\timagined\tas\ta\tone-stop shop\tthat\twould\thelp\tencompass\tthe\twide\tvariety\tof\ttopics\tthat\tare\tnecessary\tfor understanding\tmicroservices\t—\tsomething\tthat\twould\thave\thelped\tme\tgreatly\tin\tthe\tpast!",
      "content_length": 1092,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 8,
      "content": "A\tWord\ton\tMicroservices\tToday\n\nMicroservices\tis\ta\tfast-moving\ttopic.\tAlthough\tthe\tidea\tis\tnot\tnew\t(even\tif\tthe\tterm\titself is),\texperiences\tfrom\tpeople\tall\tover\tthe\tworld,\talong\twith\tthe\temergence\tof\tnew technologies,\tare\thaving\ta\tprofound\teffect\ton\thow\tthey\tare\tused.\tDue\tto\tthe\tfast\tpace\tof change,\tI\thave\ttried\tto\tfocus\tthis\tbook\ton\tideas\tmore\tthan\tspecific\ttechnologies,\tknowing that\timplementation\tdetails\talways\tchange\tfaster\tthan\tthe\tthoughts\tbehind\tthem. Nonetheless,\tI\tfully\texpect\tthat\tin\ta\tfew\tyears\tfrom\tnow\twe’ll\thave\tlearned\teven\tmore about\twhere\tmicroservices\tfit,\tand\thow\tto\tuse\tthem\twell.\n\nSo\twhile\tI\thave\tdone\tmy\tbest\tto\tdistill\tout\tthe\tessence\tof\tthe\ttopic\tin\tthis\tbook,\tif\tthis topic\tinterests\tyou,\tbe\tprepared\tfor\tmany\tyears\tof\tcontinuous\tlearning\tto\tkeep\ton\ttop\tof the\tstate\tof\tthe\tart!",
      "content_length": 808,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 9,
      "content": "Navigating\tThis\tBook\n\nThis\tbook\tis\tprimarily\torganized\tin\ta\ttopic-based\tformat.\tAs\tsuch,\tyou\tmay\twant\tto\tjump into\tthe\tspecific\ttopics\tthat\tinterest\tyou\tthe\tmost.\tWhile\tI\thave\tdone\tmy\tbest\tto\treference terms\tand\tideas\tin\tthe\tearlier\tchapters,\tI’d\tlike\tto\tthink\tthat\teven\tpeople\twho\tconsider themselves\tfairly\texperienced\twill\tfind\tsomething\tof\tinterest\tin\tall\tchapters\there.\tI\twould certainly\tsuggest\tthat\tyou\ttake\ta\tlook\tat\tChapter\t2,\twhich\ttouches\ton\tthe\tbreadth\tof\tthe topic\tas\twell\tas\tproviding\tsome\tframing\tfor\thow\tI\tgo\tabout\tthings\tin\tcase\tif\tyou\twant\tto dive\tdeeper\tinto\tsome\tof\tthe\tlater\ttopics.\n\nFor\tpeople\tnew\tto\tthe\tsubject,\tI’ve\tstructured\tthe\tchapters\tin\ta\tway\tthat\tI\thope\twill\tmake sense\tto\tread\tfrom\tbeginning\tto\tend.\n\nHere\tis\tan\toverview\tof\twhat\twe\tcover:\n\nChapter\t1,\tMicroservices\n\nWe’ll\tbegin\twith\tan\tintroduction\tto\tmicroservices,\tincluding\tthe\tkey\tbenefits\tas\twell as\tsome\tof\tthe\tdownsides.\n\nChapter\t2,\tThe\tEvolutionary\tArchitect\n\nThis\tchapter\tdiscusses\tthe\tdifficulties\twe\tface\tin\tterms\tof\tmaking\ttrade-offs\tas architects,\tand\tcovers\tspecifically\tjust\thow\tmany\tthings\twe\tneed\tto\tthink\tabout\twith microservices.\n\nChapter\t3,\tHow\tto\tModel\tServices\n\nHere\twe’ll\tstart\tto\tdefine\tthe\tboundary\tof\tmicroservices,\tusing\ttechniques\tfrom domain-driven\tdesign\tto\thelp\tfocus\tour\tthinking.\n\nChapter\t4,\tIntegration\n\nThis\tis\twhere\twe\tstart\tgetting\ta\tbit\tdeeper\tinto\tspecific\ttechnology\timplications,\tas we\tdiscuss\twhat\tsorts\tof\tservice\tcollaboration\ttechniques\twill\thelp\tus\tmost.\tWe’ll also\tdelve\tinto\tthe\ttopic\tof\tuser\tinterfaces\tand\tintegrating\twith\tlegacy\tand commercial\toff-the-shelf\t(COTS)\tproducts.\n\nChapter\t5,\tSplitting\tthe\tMonolith\n\nMany\tpeople\tget\tinterested\tin\tmicroservices\tas\tan\tantidote\tto\tlarge,\thard-to-change monolithic\tsystems,\tand\tthis\tis\texactly\twhat\twe’ll\tcover\tin\tdetail\tin\tthis\tchapter.\n\nChapter\t6,\tDeployment\n\nAlthough\tthis\tbook\tis\tprimarily\ttheoretical,\tfew\ttopics\tin\tthe\tbook\thave\tbeen\tas impacted\tby\trecent\tchanges\tin\ttechnology\tas\tdeployment,\twhich\twe’ll\texplore\there.\n\nChapter\t7,\tTesting",
      "content_length": 2019,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 10,
      "content": "This\tchapter\tgoes\tdeep\tinto\tthe\ttopic\tof\ttesting,\tan\tarea\tof\tparticular\tconcern\twhen handling\tthe\tdeployment\tof\tmultiple\tdiscrete\tservices.\tOf\tparticular\tnote\twill\tbe\tthe role\tthat\tconsumer-driven\tcontracts\tcan\tplay\tin\thelping\tus\tensure\tthe\tquality\tof\tour software.\n\nChapter\t8,\tMonitoring\n\nTesting\tour\tsoftware\tbefore\tproduction\tdoesn’t\thelp\tif\tproblems\toccur\tonce\twe\tgo live,\tand\tthis\tchapter\texplores\thow\twe\tcan\tmonitor\tour\tfine-grained\tsystems\tand\tdeal with\tsome\tof\tthe\temergent\tcomplexity\tof\tdistributed\tsystems.\n\nChapter\t9,\tSecurity\n\nHere\twe’ll\texamine\tthe\tsecurity\taspects\tof\tmicroservices\tand\tconsider\thow\tto\thandle user-to-service\tand\tservice-to-service\tauthentication\tand\tauthorization.\tSecurity\tis\ta very\timportant\ttopic\tin\tcomputing,\tone\tthat\tis\tall\ttoo\treadily\tignored.\tAlthough\tI\tam in\tno\tway\ta\tsecurity\texpert,\tI\thope\tthat\tthis\tchapter\twill\tat\tleast\thelp\tyou\tconsider some\tof\tthe\taspects\tyou\tneed\tto\tbe\taware\tof\twhen\tbuilding\tsystems,\tand microservice\tsystems\tin\tparticular.\n\nChapter\t10,\tConway’s\tLaw\tand\tSystem\tDesign\n\nThis\tchapter\tfocuses\ton\tthe\tinterplay\tof\torganizational\tstructure\tand\tarchitecture. Many\torganizations\thave\trealized\tthat\ttrouble\twill\toccur\tif\tyou\tdon’t\tkeep\tthe\ttwo\tin harmony.\tWe’ll\tattempt\tto\tget\tto\tthe\tbottom\tof\tthis\tdilemma,\tand\tconsider\tsome different\tways\tto\talign\tsystem\tdesign\twith\tthe\tstructure\tof\tyour\tteams.\n\nChapter\t11,\tMicroservices\tat\tScale\n\nThis\tis\twhere\twe\tstart\tlooking\tat\tdoing\tall\tof\tthis\tat\tscale,\tso\tthat\twe\tcan\thandle\tthe increased\tchance\tof\tfailure\tthat\tcan\thappen\twith\tlarge\tnumbers\tof\tservices,\tas\twell\tas large\tvolumes\tof\ttraffic.\n\nChapter\t12,\tBringing\tIt\tAll\tTogether\n\nThe\tfinal\tchapter\tattempts\tto\tdistill\tdown\tthe\tcore\tessence\tof\twhat\tmakes microservices\tdifferent.\tIt\tincludes\ta\tlist\tof\tseven\tmicroservices\tprinciples,\tas\twell\tas a\twrap-up\tof\tthe\tkey\tpoints\tof\tthe\tbook.",
      "content_length": 1836,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 11,
      "content": "Conventions\tUsed\tin\tThis\tBook\n\nThe\tfollowing\ttypographical\tconventions\tare\tused\tin\tthis\tbook:\n\nItalic\n\nIndicates\tnew\tterms,\tURLs,\temail\taddresses,\tfilenames,\tand\tfile\textensions.\n\nConstant\twidth\n\nUsed\tfor\tprogram\tlistings,\tas\twell\tas\twithin\tparagraphs\tto\trefer\tto\tprogram\telements such\tas\tvariable\tor\tfunction\tnames,\tdatabases,\tdata\ttypes,\tenvironment\tvariables, statements,\tand\tkeywords.\n\nConstant\twidth\tbold\n\nShows\tcommands\tor\tother\ttext\tthat\tshould\tbe\ttyped\tliterally\tby\tthe\tuser.\n\nConstant\twidth\titalic\n\nShows\ttext\tthat\tshould\tbe\treplaced\twith\tuser-supplied\tvalues\tor\tby\tvalues\tdetermined by\tcontext.",
      "content_length": 604,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 12,
      "content": "Safari®\tBooks\tOnline\n\nNOTE\n\nSafari\tBooks\tOnline\tis\tan\ton-demand\tdigital\tlibrary\tthat\tdelivers\texpert\tcontent\tin\tboth book\tand\tvideo\tform\tfrom\tthe\tworld’s\tleading\tauthors\tin\ttechnology\tand\tbusiness.\n\nTechnology\tprofessionals,\tsoftware\tdevelopers,\tweb\tdesigners,\tand\tbusiness\tand\tcreative professionals\tuse\tSafari\tBooks\tOnline\tas\ttheir\tprimary\tresource\tfor\tresearch,\tproblem solving,\tlearning,\tand\tcertification\ttraining.\n\nSafari\tBooks\tOnline\toffers\ta\trange\tof\tplans\tand\tpricing\tfor\tenterprise,\tgovernment, education,\tand\tindividuals.\n\nMembers\thave\taccess\tto\tthousands\tof\tbooks,\ttraining\tvideos,\tand\tprepublication manuscripts\tin\tone\tfully\tsearchable\tdatabase\tfrom\tpublishers\tlike\tO’Reilly\tMedia, Prentice\tHall\tProfessional,\tAddison-Wesley\tProfessional,\tMicrosoft\tPress,\tSams,\tQue, Peachpit\tPress,\tFocal\tPress,\tCisco\tPress,\tJohn\tWiley\t&\tSons,\tSyngress,\tMorgan Kaufmann,\tIBM\tRedbooks,\tPackt,\tAdobe\tPress,\tFT\tPress,\tApress,\tManning,\tNew\tRiders, McGraw-Hill,\tJones\t&\tBartlett,\tCourse\tTechnology,\tand\thundreds\tmore.\tFor\tmore information\tabout\tSafari\tBooks\tOnline,\tplease\tvisit\tus\tonline.",
      "content_length": 1081,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 13,
      "content": "How\tto\tContact\tUs\n\nPlease\taddress\tcomments\tand\tquestions\tconcerning\tthis\tbook\tto\tthe\tpublisher:\n\nO’Reilly\tMedia,\tInc.\n\n1005\tGravenstein\tHighway\tNorth\n\nSebastopol,\tCA\t95472\n\n800-998-9938\t(in\tthe\tUnited\tStates\tor\tCanada)\n\n707-829-0515\t(international\tor\tlocal)\n\n707-829-0104\t(fax)\n\nWe\thave\ta\tweb\tpage\tfor\tthis\tbook,\twhere\twe\tlist\terrata,\texamples,\tand\tany\tadditional information.\tYou\tcan\taccess\tthis\tpage\tat\thttp://bit.ly/building-microservices.\n\nTo\tcomment\tor\task\ttechnical\tquestions\tabout\tthis\tbook,\tsend\temail\tto bookquestions@oreilly.com.\n\nFor\tmore\tinformation\tabout\tour\tbooks,\tcourses,\tconferences,\tand\tnews,\tsee\tour\twebsite\tat http://www.oreilly.com.\n\nFind\tus\ton\tFacebook:\thttp://facebook.com/oreilly\n\nFollow\tus\ton\tTwitter:\thttp://twitter.com/oreillymedia\n\nWatch\tus\ton\tYouTube:\thttp://www.youtube.com/oreillymedia",
      "content_length": 816,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 14,
      "content": "Acknowledgments\n\nThis\tbook\tis\tdedicated\tto\tLindy\tStephens,\twithout\twhom\tit\twouldn’t\texist.\tShe encouraged\tme\tto\tstart\ton\tthis\tjourney,\tsupported\tme\tthroughout\tthe\toften\tstressful process\tof\twriting,\tand\tis\tthe\tbest\tpartner\tI\tcould\thave\tever\tasked\tfor.\tI\twould\talso\tlike\tto dedicate\tthis\tto\tmy\tdad,\tHoward\tNewman,\twho\thas\talways\tbeen\tthere\tfor\tme.\tThis\tis\tfor both\tof\tyou.\n\nI\twould\tlike\tto\tsingle\tout\tBen\tChristensen,\tVivek\tSubramaniam,\tand\tMartin\tFowler\tfor providing\tdetailed\tfeedback\tthroughout\tthe\twriting\tprocess,\thelping\tshape\twhat\tthis\tbook became.\tI’d\talso\tlike\tto\tthank\tJames\tLewis,\twith\twhom\tI\thave\tconsumed\tmany\tbeers discussing\tthe\tideas\tpresented\tin\tthis\tbook.\tThis\tbook\twould\tbe\ta\tshadow\tof\titself\twithout their\thelp\tand\tguidance.\n\nIn\taddition,\tmany\tothers\tprovided\thelp\tand\tfeedback\ton\tearly\tversions\tof\tthe\tbook. Specifically,\tI\twould\tlike\tto\tthank\t(in\tno\tparticular\torder)\tKane\tVenables,\tAnand Krishnaswamy,\tKent\tMcNeil,\tCharles\tHaynes,\tChris\tFord,\tAidy\tLewis,\tWill\tThames,\tJon Eaves,\tRolf\tRussell,\tBadrinath\tJanakiraman,\tDaniel\tBryant,\tIan\tRobinson,\tJim\tWebber, Stewart\tGleadow,\tEvan\tBottcher,\tEric\tSword,\tOlivia\tLeonard,\tand\tall\tmy\tother\tcolleagues at\tThoughtWorks\tand\tacross\tthe\tindustry\twho\thave\thelped\tme\tget\tthis\tfar.\n\nFinally,\tI\twould\tlike\tto\tthank\tall\tthe\tpeople\tat\tO’Reilly,\tincluding\tMike\tLoukides\tfor getting\tme\ton\tboard,\tmy\teditor\tBrian\tMacDonald,\tRachel\tMonaghan,\tKristen\tBrown, Betsy\tWaliszewski,\tand\tall\tthe\tother\tpeople\twho\thave\thelped\tin\tways\tI\tmay\tnever\tknow about.",
      "content_length": 1499,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 15,
      "content": "Chapter\t1.\tMicroservices\n\nFor\tmany\tyears\tnow,\twe\thave\tbeen\tfinding\tbetter\tways\tto\tbuild\tsystems.\tWe\thave\tbeen learning\tfrom\twhat\thas\tcome\tbefore,\tadopting\tnew\ttechnologies,\tand\tobserving\thow\ta new\twave\tof\ttechnology\tcompanies\toperate\tin\tdifferent\tways\tto\tcreate\tIT\tsystems\tthat help\tmake\tboth\ttheir\tcustomers\tand\ttheir\town\tdevelopers\thappier.\n\nEric\tEvans’s\tbook\tDomain-Driven\tDesign\t(Addison-Wesley)\thelped\tus\tunderstand\tthe importance\tof\trepresenting\tthe\treal\tworld\tin\tour\tcode,\tand\tshowed\tus\tbetter\tways\tto\tmodel our\tsystems.\tThe\tconcept\tof\tcontinuous\tdelivery\tshowed\thow\twe\tcan\tmore\teffectively\tand efficiently\tget\tour\tsoftware\tinto\tproduction,\tinstilling\tin\tus\tthe\tidea\tthat\twe\tshould\ttreat every\tcheck-in\tas\ta\trelease\tcandidate.\tOur\tunderstanding\tof\thow\tthe\tWeb\tworks\thas\tled\tus to\tdevelop\tbetter\tways\tof\thaving\tmachines\ttalk\tto\tother\tmachines.\tAlistair\tCockburn’s concept\tof\thexagonal\tarchitecture\tguided\tus\taway\tfrom\tlayered\tarchitectures\twhere business\tlogic\tcould\thide.\tVirtualization\tplatforms\tallowed\tus\tto\tprovision\tand\tresize\tour machines\tat\twill,\twith\tinfrastructure\tautomation\tgiving\tus\ta\tway\tto\thandle\tthese\tmachines at\tscale.\tSome\tlarge,\tsuccessful\torganizations\tlike\tAmazon\tand\tGoogle\tespoused\tthe\tview of\tsmall\tteams\towning\tthe\tfull\tlifecycle\tof\ttheir\tservices.\tAnd,\tmore\trecently,\tNetflix\thas shared\twith\tus\tways\tof\tbuilding\tantifragile\tsystems\tat\ta\tscale\tthat\twould\thave\tbeen\thard\tto comprehend\tjust\t10\tyears\tago.\n\nDomain-driven\tdesign.\tContinuous\tdelivery.\tOn-demand\tvirtualization.\tInfrastructure automation.\tSmall\tautonomous\tteams.\tSystems\tat\tscale.\tMicroservices\thave\temerged\tfrom this\tworld.\tThey\tweren’t\tinvented\tor\tdescribed\tbefore\tthe\tfact;\tthey\temerged\tas\ta\ttrend,\tor a\tpattern,\tfrom\treal-world\tuse.\tBut\tthey\texist\tonly\tbecause\tof\tall\tthat\thas\tgone\tbefore. Throughout\tthis\tbook,\tI\twill\tpull\tstrands\tout\tof\tthis\tprior\twork\tto\thelp\tpaint\ta\tpicture\tof how\tto\tbuild,\tmanage,\tand\tevolve\tmicroservices.\n\nMany\torganizations\thave\tfound\tthat\tby\tembracing\tfine-grained,\tmicroservice architectures,\tthey\tcan\tdeliver\tsoftware\tfaster\tand\tembrace\tnewer\ttechnologies. Microservices\tgive\tus\tsignificantly\tmore\tfreedom\tto\treact\tand\tmake\tdifferent\tdecisions, allowing\tus\tto\trespond\tfaster\tto\tthe\tinevitable\tchange\tthat\timpacts\tall\tof\tus.",
      "content_length": 2249,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 16,
      "content": "What\tAre\tMicroservices?\n\nMicroservices\tare\tsmall,\tautonomous\tservices\tthat\twork\ttogether.\tLet’s\tbreak\tthat definition\tdown\ta\tbit\tand\tconsider\tthe\tcharacteristics\tthat\tmake\tmicroservices\tdifferent.",
      "content_length": 196,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 17,
      "content": "Small,\tand\tFocused\ton\tDoing\tOne\tThing\tWell\n\nCodebases\tgrow\tas\twe\twrite\tcode\tto\tadd\tnew\tfeatures.\tOver\ttime,\tit\tcan\tbe\tdifficult\tto know\twhere\ta\tchange\tneeds\tto\tbe\tmade\tbecause\tthe\tcodebase\tis\tso\tlarge.\tDespite\ta\tdrive for\tclear,\tmodular\tmonolithic\tcodebases,\tall\ttoo\toften\tthese\tarbitrary\tin-process boundaries\tbreak\tdown.\tCode\trelated\tto\tsimilar\tfunctions\tstarts\tto\tbecome\tspread\tall\tover, making\tfixing\tbugs\tor\timplementations\tmore\tdifficult.\n\nWithin\ta\tmonolithic\tsystem,\twe\tfight\tagainst\tthese\tforces\tby\ttrying\tto\tensure\tour\tcode\tis more\tcohesive,\toften\tby\tcreating\tabstractions\tor\tmodules.\tCohesion\t—\tthe\tdrive\tto\thave related\tcode\tgrouped\ttogether\t—\tis\tan\timportant\tconcept\twhen\twe\tthink\tabout microservices.\tThis\tis\treinforced\tby\tRobert\tC.\tMartin’s\tdefinition\tof\tthe\tSingle Responsibility\tPrinciple,\twhich\tstates\t“Gather\ttogether\tthose\tthings\tthat\tchange\tfor\tthe same\treason,\tand\tseparate\tthose\tthings\tthat\tchange\tfor\tdifferent\treasons.”\n\nMicroservices\ttake\tthis\tsame\tapproach\tto\tindependent\tservices.\tWe\tfocus\tour\tservice boundaries\ton\tbusiness\tboundaries,\tmaking\tit\tobvious\twhere\tcode\tlives\tfor\ta\tgiven\tpiece of\tfunctionality.\tAnd\tby\tkeeping\tthis\tservice\tfocused\ton\tan\texplicit\tboundary,\twe\tavoid the\ttemptation\tfor\tit\tto\tgrow\ttoo\tlarge,\twith\tall\tthe\tassociated\tdifficulties\tthat\tthis\tcan introduce.\n\nThe\tquestion\tI\tam\toften\tasked\tis\thow\tsmall\tis\tsmall?\tGiving\ta\tnumber\tfor\tlines\tof\tcode\tis problematic,\tas\tsome\tlanguages\tare\tmore\texpressive\tthan\tothers\tand\tcan\ttherefore\tdo more\tin\tfewer\tlines\tof\tcode.\tWe\tmust\talso\tconsider\tthe\tfact\tthat\twe\tcould\tbe\tpulling\tin multiple\tdependencies,\twhich\tthemselves\tcontain\tmany\tlines\tof\tcode.\tIn\taddition,\tsome part\tof\tyour\tdomain\tmay\tbe\tlegitimately\tcomplex,\trequiring\tmore\tcode.\tJon\tEaves\tat RealEstate.com.au\tin\tAustralia\tcharacterizes\ta\tmicroservice\tas\tsomething\tthat\tcould\tbe rewritten\tin\ttwo\tweeks,\ta\trule\tof\tthumb\tthat\tmakes\tsense\tfor\this\tparticular\tcontext.\n\nAnother\tsomewhat\ttrite\tanswer\tI\tcan\tgive\tis\tsmall\tenough\tand\tno\tsmaller.\tWhen\tspeaking at\tconferences,\tI\tnearly\talways\task\tthe\tquestion\twho\thas\ta\tsystem\tthat\tis\ttoo\tbig\tand\tthat you’d\tlike\tto\tbreak\tdown?\tNearly\teveryone\traises\ttheir\thands.\tWe\tseem\tto\thave\ta\tvery good\tsense\tof\twhat\tis\ttoo\tbig,\tand\tso\tit\tcould\tbe\targued\tthat\tonce\ta\tpiece\tof\tcode\tno longer\tfeels\ttoo\tbig,\tit’s\tprobably\tsmall\tenough.\n\nA\tstrong\tfactor\tin\thelping\tus\tanswer\thow\tsmall?\tis\thow\twell\tthe\tservice\taligns\tto\tteam structures.\tIf\tthe\tcodebase\tis\ttoo\tbig\tto\tbe\tmanaged\tby\ta\tsmall\tteam,\tlooking\tto\tbreak\tit down\tis\tvery\tsensible.\tWe’ll\ttalk\tmore\tabout\torganizational\talignment\tlater\ton.\n\nWhen\tit\tcomes\tto\thow\tsmall\tis\tsmall\tenough,\tI\tlike\tto\tthink\tin\tthese\tterms:\tthe\tsmaller\tthe service,\tthe\tmore\tyou\tmaximize\tthe\tbenefits\tand\tdownsides\tof\tmicroservice\tarchitecture. As\tyou\tget\tsmaller,\tthe\tbenefits\taround\tinterdependence\tincrease.\tBut\tso\ttoo\tdoes\tsome\tof the\tcomplexity\tthat\temerges\tfrom\thaving\tmore\tand\tmore\tmoving\tparts,\tsomething\tthat\twe will\texplore\tthroughout\tthis\tbook.\tAs\tyou\tget\tbetter\tat\thandling\tthis\tcomplexity,\tyou\tcan strive\tfor\tsmaller\tand\tsmaller\tservices.",
      "content_length": 3057,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 18,
      "content": "Autonomous\n\nOur\tmicroservice\tis\ta\tseparate\tentity.\tIt\tmight\tbe\tdeployed\tas\tan\tisolated\tservice\ton\ta platform\tas\ta\tservice\t(PAAS),\tor\tit\tmight\tbe\tits\town\toperating\tsystem\tprocess.\tWe\ttry\tto avoid\tpacking\tmultiple\tservices\tonto\tthe\tsame\tmachine,\talthough\tthe\tdefinition\tof machine\tin\ttoday’s\tworld\tis\tpretty\thazy!\tAs\twe’ll\tdiscuss\tlater,\talthough\tthis\tisolation\tcan add\tsome\toverhead,\tthe\tresulting\tsimplicity\tmakes\tour\tdistributed\tsystem\tmuch\teasier\tto reason\tabout,\tand\tnewer\ttechnologies\tare\table\tto\tmitigate\tmany\tof\tthe\tchallenges associated\twith\tthis\tform\tof\tdeployment.\n\nAll\tcommunication\tbetween\tthe\tservices\tthemselves\tare\tvia\tnetwork\tcalls,\tto\tenforce separation\tbetween\tthe\tservices\tand\tavoid\tthe\tperils\tof\ttight\tcoupling.\n\nThese\tservices\tneed\tto\tbe\table\tto\tchange\tindependently\tof\teach\tother,\tand\tbe\tdeployed\tby themselves\twithout\trequiring\tconsumers\tto\tchange.\tWe\tneed\tto\tthink\tabout\twhat\tour services\tshould\texpose,\tand\twhat\tthey\tshould\tallow\tto\tbe\thidden.\tIf\tthere\tis\ttoo\tmuch sharing,\tour\tconsuming\tservices\tbecome\tcoupled\tto\tour\tinternal\trepresentations.\tThis decreases\tour\tautonomy,\tas\tit\trequires\tadditional\tcoordination\twith\tconsumers\twhen making\tchanges.\n\nOur\tservice\texposes\tan\tapplication\tprogramming\tinterface\t(API),\tand\tcollaborating services\tcommunicate\twith\tus\tvia\tthose\tAPIs.\tWe\talso\tneed\tto\tthink\tabout\twhat technology\tis\tappropriate\tto\tensure\tthat\tthis\titself\tdoesn’t\tcouple\tconsumers.\tThis\tmay mean\tpicking\ttechnology-agnostic\tAPIs\tto\tensure\tthat\twe\tdon’t\tconstrain\ttechnology choices.\tWe’ll\tcome\tback\ttime\tand\tagain\tto\tthe\timportance\tof\tgood,\tdecoupled\tAPIs throughout\tthis\tbook.\n\nWithout\tdecoupling,\teverything\tbreaks\tdown\tfor\tus.\tThe\tgolden\trule:\tcan\tyou\tmake\ta change\tto\ta\tservice\tand\tdeploy\tit\tby\titself\twithout\tchanging\tanything\telse?\tIf\tthe\tanswer\tis no,\tthen\tmany\tof\tthe\tadvantages\twe\tdiscuss\tthroughout\tthis\tbook\twill\tbe\thard\tfor\tyou\tto achieve.\n\nTo\tdo\tdecoupling\twell,\tyou’ll\tneed\tto\tmodel\tyour\tservices\tright\tand\tget\tthe\tAPIs\tright.\tI’ll be\ttalking\tabout\tthat\ta\tlot.",
      "content_length": 2005,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 19,
      "content": "Key\tBenefits\n\nThe\tbenefits\tof\tmicroservices\tare\tmany\tand\tvaried.\tMany\tof\tthese\tbenefits\tcan\tbe\tlaid\tat the\tdoor\tof\tany\tdistributed\tsystem.\tMicroservices,\thowever,\ttend\tto\tachieve\tthese\tbenefits to\ta\tgreater\tdegree\tprimarily\tdue\tto\thow\tfar\tthey\ttake\tthe\tconcepts\tbehind\tdistributed systems\tand\tservice-oriented\tarchitecture.",
      "content_length": 323,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 20,
      "content": "Technology\tHeterogeneity\n\nWith\ta\tsystem\tcomposed\tof\tmultiple,\tcollaborating\tservices,\twe\tcan\tdecide\tto\tuse\tdifferent technologies\tinside\teach\tone.\tThis\tallows\tus\tto\tpick\tthe\tright\ttool\tfor\teach\tjob,\trather\tthan having\tto\tselect\ta\tmore\tstandardized,\tone-size-fits-all\tapproach\tthat\toften\tends\tup\tbeing the\tlowest\tcommon\tdenominator.\n\nIf\tone\tpart\tof\tour\tsystem\tneeds\tto\timprove\tits\tperformance,\twe\tmight\tdecide\tto\tuse\ta different\ttechnology\tstack\tthat\tis\tbetter\table\tto\tachieve\tthe\tperformance\tlevels\trequired. We\tmay\talso\tdecide\tthat\thow\twe\tstore\tour\tdata\tneeds\tto\tchange\tfor\tdifferent\tparts\tof\tour system.\tFor\texample,\tfor\ta\tsocial\tnetwork,\twe\tmight\tstore\tour\tusers’\tinteractions\tin\ta graph-oriented\tdatabase\tto\treflect\tthe\thighly\tinterconnected\tnature\tof\ta\tsocial\tgraph,\tbut perhaps\tthe\tposts\tthe\tusers\tmake\tcould\tbe\tstored\tin\ta\tdocument-oriented\tdata\tstore,\tgiving rise\tto\ta\theterogeneous\tarchitecture\tlike\tthe\tone\tshown\tin\tFigure\t1-1.\n\nFigure\t1-1.\tMicroservices\tcan\tallow\tyou\tto\tmore\teasily\tembrace\tdifferent\ttechnologies\n\nWith\tmicroservices,\twe\tare\talso\table\tto\tadopt\ttechnology\tmore\tquickly,\tand\tunderstand how\tnew\tadvancements\tmay\thelp\tus.\tOne\tof\tthe\tbiggest\tbarriers\tto\ttrying\tout\tand adopting\tnew\ttechnology\tis\tthe\trisks\tassociated\twith\tit.\tWith\ta\tmonolithic\tapplication,\tif\tI want\tto\ttry\ta\tnew\tprogramming\tlanguage,\tdatabase,\tor\tframework,\tany\tchange\twill\timpact a\tlarge\tamount\tof\tmy\tsystem.\tWith\ta\tsystem\tconsisting\tof\tmultiple\tservices,\tI\thave multiple\tnew\tplaces\tin\twhich\tto\ttry\tout\ta\tnew\tpiece\tof\ttechnology.\tI\tcan\tpick\ta\tservice\tthat is\tperhaps\tlowest\trisk\tand\tuse\tthe\ttechnology\tthere,\tknowing\tthat\tI\tcan\tlimit\tany\tpotential negative\timpact.\tMany\torganizations\tfind\tthis\tability\tto\tmore\tquickly\tabsorb\tnew technologies\tto\tbe\ta\treal\tadvantage\tfor\tthem.\n\nEmbracing\tmultiple\ttechnologies\tdoesn’t\tcome\twithout\tan\toverhead,\tof\tcourse.\tSome organizations\tchoose\tto\tplace\tsome\tconstraints\ton\tlanguage\tchoices.\tNetflix\tand\tTwitter, for\texample,\tmostly\tuse\tthe\tJava\tVirtual\tMachine\t(JVM)\tas\ta\tplatform,\tas\tthey\thave\ta very\tgood\tunderstanding\tof\tthe\treliability\tand\tperformance\tof\tthat\tsystem.\tThey\talso develop\tlibraries\tand\ttooling\tfor\tthe\tJVM\tthat\tmake\toperating\tat\tscale\tmuch\teasier,\tbut make\tit\tmore\tdifficult\tfor\tnon-Java-based\tservices\tor\tclients.\tBut\tneither\tTwitter\tnor Netflix\tuse\tonly\tone\ttechnology\tstack\tfor\tall\tjobs,\teither.\tAnother\tcounterpoint\tto\tconcerns",
      "content_length": 2376,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 21,
      "content": "about\tmixing\tin\tdifferent\ttechnologies\tis\tthe\tsize.\tIf\tI\treally\tcan\trewrite\tmy\tmicroservice in\ttwo\tweeks,\tyou\tmay\twell\tmitigate\tthe\trisks\tof\tembracing\tnew\ttechnology.\n\nAs\tyou’ll\tfind\tthroughout\tthis\tbook,\tjust\tlike\tmany\tthings\tconcerning\tmicroservices,\tit’s all\tabout\tfinding\tthe\tright\tbalance.\tWe’ll\tdiscuss\thow\tto\tmake\ttechnology\tchoices\tin Chapter\t2,\twhich\tfocuses\ton\tevolutionary\tarchitecture;\tand\tin\tChapter\t4,\twhich\tdeals\twith integration,\tyou’ll\tlearn\thow\tto\tensure\tthat\tyour\tservices\tcan\tevolve\ttheir\ttechnology independently\tof\teach\tother\twithout\tundue\tcoupling.",
      "content_length": 571,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 22,
      "content": "Resilience\n\nA\tkey\tconcept\tin\tresilience\tengineering\tis\tthe\tbulkhead.\tIf\tone\tcomponent\tof\ta\tsystem fails,\tbut\tthat\tfailure\tdoesn’t\tcascade,\tyou\tcan\tisolate\tthe\tproblem\tand\tthe\trest\tof\tthe system\tcan\tcarry\ton\tworking.\tService\tboundaries\tbecome\tyour\tobvious\tbulkheads.\tIn\ta monolithic\tservice,\tif\tthe\tservice\tfails,\teverything\tstops\tworking.\tWith\ta\tmonolithic system,\twe\tcan\trun\ton\tmultiple\tmachines\tto\treduce\tour\tchance\tof\tfailure,\tbut\twith microservices,\twe\tcan\tbuild\tsystems\tthat\thandle\tthe\ttotal\tfailure\tof\tservices\tand\tdegrade functionality\taccordingly.\n\nWe\tdo\tneed\tto\tbe\tcareful,\thowever.\tTo\tensure\tour\tmicroservice\tsystems\tcan\tproperly embrace\tthis\timproved\tresilience,\twe\tneed\tto\tunderstand\tthe\tnew\tsources\tof\tfailure\tthat distributed\tsystems\thave\tto\tdeal\twith.\tNetworks\tcan\tand\twill\tfail,\tas\twill\tmachines.\tWe need\tto\tknow\thow\tto\thandle\tthis,\tand\twhat\timpact\t(if\tany)\tit\tshould\thave\ton\tthe\tend\tuser of\tour\tsoftware.\n\nWe’ll\ttalk\tmore\tabout\tbetter\thandling\tresilience,\tand\thow\tto\thandle\tfailure\tmodes,\tin Chapter\t11.",
      "content_length": 1020,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 23,
      "content": "Scaling\n\nWith\ta\tlarge,\tmonolithic\tservice,\twe\thave\tto\tscale\teverything\ttogether.\tOne\tsmall\tpart\tof our\toverall\tsystem\tis\tconstrained\tin\tperformance,\tbut\tif\tthat\tbehavior\tis\tlocked\tup\tin\ta giant\tmonolithic\tapplication,\twe\thave\tto\thandle\tscaling\teverything\tas\ta\tpiece.\tWith smaller\tservices,\twe\tcan\tjust\tscale\tthose\tservices\tthat\tneed\tscaling,\tallowing\tus\tto\trun other\tparts\tof\tthe\tsystem\ton\tsmaller,\tless\tpowerful\thardware,\tlike\tin\tFigure\t1-2.\n\nFigure\t1-2.\tYou\tcan\ttarget\tscaling\tat\tjust\tthose\tmicroservices\tthat\tneed\tit\n\nGilt,\tan\tonline\tfashion\tretailer,\tadopted\tmicroservices\tfor\tthis\texact\treason.\tStarting\tin 2007\twith\ta\tmonolithic\tRails\tapplication,\tby\t2009\tGilt’s\tsystem\twas\tunable\tto\tcope\twith the\tload\tbeing\tplaced\ton\tit.\tBy\tsplitting\tout\tcore\tparts\tof\tits\tsystem,\tGilt\twas\tbetter\table\tto deal\twith\tits\ttraffic\tspikes,\tand\ttoday\thas\tover\t450\tmicroservices,\teach\tone\trunning\ton multiple\tseparate\tmachines.\n\nWhen\tembracing\ton-demand\tprovisioning\tsystems\tlike\tthose\tprovided\tby\tAmazon\tWeb Services,\twe\tcan\teven\tapply\tthis\tscaling\ton\tdemand\tfor\tthose\tpieces\tthat\tneed\tit.\tThis allows\tus\tto\tcontrol\tour\tcosts\tmore\teffectively.\tIt’s\tnot\toften\tthat\tan\tarchitectural\tapproach can\tbe\tso\tclosely\tcorrelated\tto\tan\talmost\timmediate\tcost\tsavings.",
      "content_length": 1240,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 24,
      "content": "Ease\tof\tDeployment\n\nA\tone-line\tchange\tto\ta\tmillion-line-long\tmonolithic\tapplication\trequires\tthe\twhole application\tto\tbe\tdeployed\tin\torder\tto\trelease\tthe\tchange.\tThat\tcould\tbe\ta\tlarge-impact, high-risk\tdeployment.\tIn\tpractice,\tlarge-impact,\thigh-risk\tdeployments\tend\tup\thappening infrequently\tdue\tto\tunderstandable\tfear.\tUnfortunately,\tthis\tmeans\tthat\tour\tchanges\tbuild up\tand\tbuild\tup\tbetween\treleases,\tuntil\tthe\tnew\tversion\tof\tour\tapplication\thitting production\thas\tmasses\tof\tchanges.\tAnd\tthe\tbigger\tthe\tdelta\tbetween\treleases,\tthe\thigher the\trisk\tthat\twe’ll\tget\tsomething\twrong!\n\nWith\tmicroservices,\twe\tcan\tmake\ta\tchange\tto\ta\tsingle\tservice\tand\tdeploy\tit\tindependently of\tthe\trest\tof\tthe\tsystem.\tThis\tallows\tus\tto\tget\tour\tcode\tdeployed\tfaster.\tIf\ta\tproblem\tdoes occur,\tit\tcan\tbe\tisolated\tquickly\tto\tan\tindividual\tservice,\tmaking\tfast\trollback\teasy\tto achieve.\tIt\talso\tmeans\twe\tcan\tget\tour\tnew\tfunctionality\tout\tto\tcustomers\tfaster.\tThis\tis one\tof\tthe\tmain\treasons\twhy\torganizations\tlike\tAmazon\tand\tNetflix\tuse\tthese architectures\t—\tto\tensure\tthey\tremove\tas\tmany\timpediments\tas\tpossible\tto\tgetting software\tout\tthe\tdoor.\n\nThe\ttechnology\tin\tthis\tspace\thas\tchanged\tgreatly\tin\tthe\tlast\tcouple\tof\tyears,\tand\twe’ll\tbe looking\tmore\tdeeply\tinto\tthe\ttopic\tof\tdeployment\tin\ta\tmicroservice\tworld\tin\tChapter\t6.",
      "content_length": 1301,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 25,
      "content": "Organizational\tAlignment\n\nMany\tof\tus\thave\texperienced\tthe\tproblems\tassociated\twith\tlarge\tteams\tand\tlarge codebases.\tThese\tproblems\tcan\tbe\texacerbated\twhen\tthe\tteam\tis\tdistributed.\tWe\talso know\tthat\tsmaller\tteams\tworking\ton\tsmaller\tcodebases\ttend\tto\tbe\tmore\tproductive.\n\nMicroservices\tallow\tus\tto\tbetter\talign\tour\tarchitecture\tto\tour\torganization,\thelping\tus minimize\tthe\tnumber\tof\tpeople\tworking\ton\tany\tone\tcodebase\tto\thit\tthe\tsweet\tspot\tof\tteam size\tand\tproductivity.\tWe\tcan\talso\tshift\townership\tof\tservices\tbetween\tteams\tto\ttry\tto\tkeep people\tworking\ton\tone\tservice\tcolocated.\tWe\twill\tgo\tinto\tmuch\tmore\tdetail\ton\tthis\ttopic when\twe\tdiscuss\tConway’s\tlaw\tin\tChapter\t10.",
      "content_length": 669,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 26,
      "content": "Composability\n\nOne\tof\tthe\tkey\tpromises\tof\tdistributed\tsystems\tand\tservice-oriented\tarchitectures\tis\tthat we\topen\tup\topportunities\tfor\treuse\tof\tfunctionality.\tWith\tmicroservices,\twe\tallow\tfor\tour functionality\tto\tbe\tconsumed\tin\tdifferent\tways\tfor\tdifferent\tpurposes.\tThis\tcan\tbe especially\timportant\twhen\twe\tthink\tabout\thow\tour\tconsumers\tuse\tour\tsoftware.\tGone\tis the\ttime\twhen\twe\tcould\tthink\tnarrowly\tabout\teither\tour\tdesktop\twebsite\tor\tmobile application.\tNow\twe\tneed\tto\tthink\tof\tthe\tmyriad\tways\tthat\twe\tmight\twant\tto\tweave together\tcapabilities\tfor\tthe\tWeb,\tnative\tapplication,\tmobile\tweb,\ttablet\tapp,\tor\twearable device.\tAs\torganizations\tmove\taway\tfrom\tthinking\tin\tterms\tof\tnarrow\tchannels\tto\tmore holistic\tconcepts\tof\tcustomer\tengagement,\twe\tneed\tarchitectures\tthat\tcan\tkeep\tup.\n\nWith\tmicroservices,\tthink\tof\tus\topening\tup\tseams\tin\tour\tsystem\tthat\tare\taddressable\tby outside\tparties.\tAs\tcircumstances\tchange,\twe\tcan\tbuild\tthings\tin\tdifferent\tways.\tWith\ta monolithic\tapplication,\tI\toften\thave\tone\tcoarse-grained\tseam\tthat\tcan\tbe\tused\tfrom\tthe outside.\tIf\tI\twant\tto\tbreak\tthat\tup\tto\tget\tsomething\tmore\tuseful,\tI’ll\tneed\ta\thammer!\tIn Chapter\t5,\tI’ll\tdiscuss\tways\tfor\tyou\tto\tbreak\tapart\texisting\tmonolithic\tsystems,\tand hopefully\tchange\tthem\tinto\tsome\treusable,\tre-composable\tmicroservices.",
      "content_length": 1290,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 27,
      "content": "Optimizing\tfor\tReplaceability\n\nIf\tyou\twork\tat\ta\tmedium-size\tor\tbigger\torganization,\tchances\tare\tyou\tare\taware\tof\tsome big,\tnasty\tlegacy\tsystem\tsitting\tin\tthe\tcorner.\tThe\tone\tno\tone\twants\tto\ttouch.\tThe\tone\tthat is\tvital\tto\thow\tyour\tcompany\truns,\tbut\tthat\thappens\tto\tbe\twritten\tin\tsome\todd\tFortran variant\tand\truns\tonly\ton\thardware\tthat\treached\tend\tof\tlife\t25\tyears\tago.\tWhy\thasn’t\tit been\treplaced?\tYou\tknow\twhy:\tit’s\ttoo\tbig\tand\trisky\ta\tjob.\n\nWith\tour\tindividual\tservices\tbeing\tsmall\tin\tsize,\tthe\tcost\tto\treplace\tthem\twith\ta\tbetter implementation,\tor\teven\tdelete\tthem\taltogether,\tis\tmuch\teasier\tto\tmanage.\tHow\toften\thave you\tdeleted\tmore\tthan\ta\thundred\tlines\tof\tcode\tin\ta\tsingle\tday\tand\tnot\tworried\ttoo\tmuch about\tit?\tWith\tmicroservices\toften\tbeing\tof\tsimilar\tsize,\tthe\tbarriers\tto\trewriting\tor removing\tservices\tentirely\tare\tvery\tlow.\n\nTeams\tusing\tmicroservice\tapproaches\tare\tcomfortable\twith\tcompletely\trewriting\tservices when\trequired,\tand\tjust\tkilling\ta\tservice\twhen\tit\tis\tno\tlonger\tneeded.\tWhen\ta\tcodebase\tis just\ta\tfew\thundred\tlines\tlong,\tit\tis\tdifficult\tfor\tpeople\tto\tbecome\temotionally\tattached\tto it,\tand\tthe\tcost\tof\treplacing\tit\tis\tpretty\tsmall.",
      "content_length": 1155,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 28,
      "content": "What\tAbout\tService-Oriented\tArchitecture?\n\nService-oriented\tarchitecture\t(SOA)\tis\ta\tdesign\tapproach\twhere\tmultiple\tservices collaborate\tto\tprovide\tsome\tend\tset\tof\tcapabilities.\tA\tservice\there\ttypically\tmeans\ta completely\tseparate\toperating\tsystem\tprocess.\tCommunication\tbetween\tthese\tservices occurs\tvia\tcalls\tacross\ta\tnetwork\trather\tthan\tmethod\tcalls\twithin\ta\tprocess\tboundary.\n\nSOA\temerged\tas\tan\tapproach\tto\tcombat\tthe\tchallenges\tof\tthe\tlarge\tmonolithic applications.\tIt\tis\tan\tapproach\tthat\taims\tto\tpromote\tthe\treusability\tof\tsoftware;\ttwo\tor more\tend-user\tapplications,\tfor\texample,\tcould\tboth\tuse\tthe\tsame\tservices.\tIt\taims\tto make\tit\teasier\tto\tmaintain\tor\trewrite\tsoftware,\tas\ttheoretically\twe\tcan\treplace\tone\tservice with\tanother\twithout\tanyone\tknowing,\tas\tlong\tas\tthe\tsemantics\tof\tthe\tservice\tdon’t change\ttoo\tmuch.\n\nSOA\tat\tits\theart\tis\ta\tvery\tsensible\tidea.\tHowever,\tdespite\tmany\tefforts,\tthere\tis\ta\tlack\tof good\tconsensus\ton\thow\tto\tdo\tSOA\twell.\tIn\tmy\topinion,\tmuch\tof\tthe\tindustry\thas\tfailed\tto look\tholistically\tenough\tat\tthe\tproblem\tand\tpresent\ta\tcompelling\talternative\tto\tthe narrative\tset\tout\tby\tvarious\tvendors\tin\tthis\tspace.\n\nMany\tof\tthe\tproblems\tlaid\tat\tthe\tdoor\tof\tSOA\tare\tactually\tproblems\twith\tthings\tlike communication\tprotocols\t(e.g.,\tSOAP),\tvendor\tmiddleware,\ta\tlack\tof\tguidance\tabout service\tgranularity,\tor\tthe\twrong\tguidance\ton\tpicking\tplaces\tto\tsplit\tyour\tsystem.\tWe’ll tackle\teach\tof\tthese\tin\tturn\tthroughout\tthe\trest\tof\tthe\tbook.\tA\tcynic\tmight\tsuggest\tthat vendors\tco-opted\t(and\tin\tsome\tcases\tdrove)\tthe\tSOA\tmovement\tas\ta\tway\tto\tsell\tmore products,\tand\tthose\tselfsame\tproducts\tin\tthe\tend\tundermined\tthe\tgoal\tof\tSOA.\n\nMuch\tof\tthe\tconventional\twisdom\taround\tSOA\tdoesn’t\thelp\tyou\tunderstand\thow\tto\tsplit something\tbig\tinto\tsomething\tsmall.\tIt\tdoesn’t\ttalk\tabout\thow\tbig\tis\ttoo\tbig.\tIt\tdoesn’t\ttalk enough\tabout\treal-world,\tpractical\tways\tto\tensure\tthat\tservices\tdo\tnot\tbecome\toverly coupled.\tThe\tnumber\tof\tthings\tthat\tgo\tunsaid\tis\twhere\tmany\tof\tthe\tpitfalls\tassociated\twith SOA\toriginate.\n\nThe\tmicroservice\tapproach\thas\temerged\tfrom\treal-world\tuse,\ttaking\tour\tbetter understanding\tof\tsystems\tand\tarchitecture\tto\tdo\tSOA\twell.\tSo\tyou\tshould\tinstead\tthink\tof microservices\tas\ta\tspecific\tapproach\tfor\tSOA\tin\tthe\tsame\tway\tthat\tXP\tor\tScrum\tare specific\tapproaches\tfor\tAgile\tsoftware\tdevelopment.",
      "content_length": 2314,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 29,
      "content": "Other\tDecompositional\tTechniques\n\nWhen\tyou\tget\tdown\tto\tit,\tmany\tof\tthe\tadvantages\tof\ta\tmicroservice-based\tarchitecture come\tfrom\tits\tgranular\tnature\tand\tthe\tfact\tthat\tit\tgives\tyou\tmany\tmore\tchoices\tas\tto\thow to\tsolve\tproblems.\tBut\tcould\tsimilar\tdecompositional\ttechniques\tachieve\tthe\tsame benefits?",
      "content_length": 298,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 30,
      "content": "Shared\tLibraries\n\nA\tvery\tstandard\tdecompositional\ttechnique\tthat\tis\tbuilt\tinto\tvirtually\tany\tlanguage\tis breaking\tdown\ta\tcodebase\tinto\tmultiple\tlibraries.\tThese\tlibraries\tmay\tbe\tprovided\tby\tthird parties,\tor\tcreated\tin\tyour\town\torganization.\n\nLibraries\tgive\tyou\ta\tway\tto\tshare\tfunctionality\tbetween\tteams\tand\tservices.\tI\tmight\tcreate a\tset\tof\tuseful\tcollection\tutilities,\tfor\texample,\tor\tperhaps\ta\tstatistics\tlibrary\tthat\tcan\tbe reused.\n\nTeams\tcan\torganize\tthemselves\taround\tthese\tlibraries,\tand\tthe\tlibraries\tthemselves\tcan\tbe reused.\tBut\tthere\tare\tsome\tdrawbacks.\n\nFirst,\tyou\tlose\ttrue\ttechnology\theterogeneity.\tThe\tlibrary\ttypically\thas\tto\tbe\tin\tthe\tsame language,\tor\tat\tthe\tvery\tleast\trun\ton\tthe\tsame\tplatform.\tSecond,\tthe\tease\twith\twhich\tyou can\tscale\tparts\tof\tyour\tsystem\tindependently\tfrom\teach\tother\tis\tcurtailed.\tNext,\tunless you’re\tusing\tdynamically\tlinked\tlibraries,\tyou\tcannot\tdeploy\ta\tnew\tlibrary\twithout redeploying\tthe\tentire\tprocess,\tso\tyour\tability\tto\tdeploy\tchanges\tin\tisolation\tis\treduced. And\tperhaps\tthe\tkicker\tis\tthat\tyou\tlack\tthe\tobvious\tseams\taround\twhich\tto\terect architectural\tsafety\tmeasures\tto\tensure\tsystem\tresiliency.\n\nShared\tlibraries\tdo\thave\ttheir\tplace.\tYou’ll\tfind\tyourself\tcreating\tcode\tfor\tcommon\ttasks that\taren’t\tspecific\tto\tyour\tbusiness\tdomain\tthat\tyou\twant\tto\treuse\tacross\tthe\torganization, which\tis\tan\tobvious\tcandidate\tfor\tbecoming\ta\treusable\tlibrary.\tYou\tdo\tneed\tto\tbe\tcareful, though.\tShared\tcode\tused\tto\tcommunicate\tbetween\tservices\tcan\tbecome\ta\tpoint\tof coupling,\tsomething\twe’ll\tdiscuss\tin\tChapter\t4.\n\nServices\tcan\tand\tshould\tmake\theavy\tuse\tof\tthird-party\tlibraries\tto\treuse\tcommon\tcode. But\tthey\tdon’t\tget\tus\tall\tthe\tway\tthere.",
      "content_length": 1676,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 31,
      "content": "Modules\n\nSome\tlanguages\tprovide\ttheir\town\tmodular\tdecomposition\ttechniques\tthat\tgo\tbeyond simple\tlibraries.\tThey\tallow\tsome\tlifecycle\tmanagement\tof\tthe\tmodules,\tsuch\tthat\tthey can\tbe\tdeployed\tinto\ta\trunning\tprocess,\tallowing\tyou\tto\tmake\tchanges\twithout\ttaking\tthe whole\tprocess\tdown.\n\nThe\tOpen\tSource\tGateway\tInitiative\t(OSGI)\tis\tworth\tcalling\tout\tas\tone\ttechnology- specific\tapproach\tto\tmodular\tdecomposition.\tJava\titself\tdoesn’t\thave\ta\ttrue\tconcept\tof modules,\tand\twe’ll\thave\tto\twait\tat\tleast\tuntil\tJava\t9\tto\tsee\tthis\tadded\tto\tthe\tlanguage. OSGI,\twhich\temerged\tas\ta\tframework\tto\tallow\tplug-ins\tto\tbe\tinstalled\tin\tthe\tEclipse\tJava IDE,\tis\tnow\tused\tas\ta\tway\tto\tretrofit\ta\tmodule\tconcept\tin\tJava\tvia\ta\tlibrary.\n\nThe\tproblem\twith\tOSGI\tis\tthat\tit\tis\ttrying\tto\tenforce\tthings\tlike\tmodule\tlifecycle management\twithout\tenough\tsupport\tin\tthe\tlanguage\titself.\tThis\tresults\tin\tmore\twork having\tto\tbe\tdone\tby\tmodule\tauthors\tto\tdeliver\ton\tproper\tmodule\tisolation.\tWithin\ta process\tboundary,\tit\tis\talso\tmuch\teasier\tto\tfall\tinto\tthe\ttrap\tof\tmaking\tmodules\toverly coupled\tto\teach\tother,\tcausing\tall\tsorts\tof\tproblems.\tMy\town\texperience\twith\tOSGI, which\tis\tmatched\tby\tthat\tof\tcolleagues\tin\tthe\tindustry,\tis\tthat\teven\twith\tgood\tteams\tit\tis easy\tfor\tOSGI\tto\tbecome\ta\tmuch\tbigger\tsource\tof\tcomplexity\tthan\tits\tbenefits\twarrant.\n\nErlang\tfollows\ta\tdifferent\tapproach,\tin\twhich\tmodules\tare\tbaked\tinto\tthe\tlanguage runtime.\tThus,\tErlang\tis\ta\tvery\tmature\tapproach\tto\tmodular\tdecomposition.\tErlang modules\tcan\tbe\tstopped,\trestarted,\tand\tupgraded\twithout\tissue.\tErlang\teven\tsupports running\tmore\tthan\tone\tversion\tof\tthe\tmodule\tat\ta\tgiven\ttime,\tallowing\tfor\tmore\tgraceful module\tupgrading.\n\nThe\tcapabilities\tof\tErlang’s\tmodules\tare\timpressive\tindeed,\tbut\teven\tif\twe\tare\tlucky enough\tto\tuse\ta\tplatform\twith\tthese\tcapabilities,\twe\tstill\thave\tthe\tsame\tshortcomings\tas we\tdo\twith\tnormal\tshared\tlibraries.\tWe\tare\tstrictly\tlimited\tin\tour\tability\tto\tuse\tnew technologies,\tlimited\tin\thow\twe\tcan\tscale\tindependently,\tcan\tdrift\ttoward\tintegration techniques\tthat\tare\toverly\tcoupling,\tand\tlack\tseams\tfor\tarchitectural\tsafety\tmeasures.\n\nThere\tis\tone\tfinal\tobservation\tworth\tsharing.\tTechnically,\tit\tshould\tbe\tpossible\tto\tcreate well-factored,\tindependent\tmodules\twithin\ta\tsingle\tmonolithic\tprocess.\tAnd\tyet\twe\trarely see\tthis\thappen.\tThe\tmodules\tthemselves\tsoon\tbecome\ttightly\tcoupled\twith\tthe\trest\tof\tthe code,\tsurrendering\tone\tof\ttheir\tkey\tbenefits.\tHaving\ta\tprocess\tboundary\tseparation\tdoes enforce\tclean\thygiene\tin\tthis\trespect\t(or\tat\tleast\tmakes\tit\tharder\tto\tdo\tthe\twrong\tthing!).\tI wouldn’t\tsuggest\tthat\tthis\tshould\tbe\tthe\tmain\tdriver\tfor\tprocess\tseparation,\tof\tcourse,\tbut it\tis\tinteresting\tthat\tthe\tpromises\tof\tmodular\tseparation\twithin\tprocess\tboundaries\trarely deliver\tin\tthe\treal\tworld.\n\nSo\twhile\tmodular\tdecomposition\twithin\ta\tprocess\tboundary\tmay\tbe\tsomething\tyou\twant to\tdo\tas\twell\tas\tdecomposing\tyour\tsystem\tinto\tservices,\tby\titself\tit\twon’t\thelp\tsolve everything.\tIf\tyou\tare\ta\tpure\tErlang\tshop,\tthe\tquality\tof\tErlang’s\tmodule\timplementation",
      "content_length": 3018,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 32,
      "content": "may\tget\tyou\ta\tvery\tlong\tway,\tbut\tI\tsuspect\tmany\tof\tyou\tare\tnot\tin\tthat\tsituation.\tFor\tthe rest\tof\tus,\twe\tshould\tsee\tmodules\tas\toffering\tthe\tsame\tsorts\tof\tbenefits\tas\tshared\tlibraries.",
      "content_length": 183,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 33,
      "content": "No\tSilver\tBullet\n\nBefore\twe\tfinish,\tI\tshould\tcall\tout\tthat\tmicroservices\tare\tno\tfree\tlunch\tor\tsilver\tbullet,\tand make\tfor\ta\tbad\tchoice\tas\ta\tgolden\thammer.\tThey\thave\tall\tthe\tassociated\tcomplexities\tof distributed\tsystems,\tand\twhile\twe\thave\tlearned\ta\tlot\tabout\thow\tto\tmanage\tdistributed systems\twell\t(which\twe’ll\tdiscuss\tthroughout\tthe\tbook)\tit\tis\tstill\thard.\tIf\tyou’re\tcoming from\ta\tmonolithic\tsystem\tpoint\tof\tview,\tyou’ll\thave\tto\tget\tmuch\tbetter\tat\thandling deployment,\ttesting,\tand\tmonitoring\tto\tunlock\tthe\tbenefits\twe’ve\tcovered\tso\tfar.\tYou’ll also\tneed\tto\tthink\tdifferently\tabout\thow\tyou\tscale\tyour\tsystems\tand\tensure\tthat\tthey\tare resilient.\tDon’t\talso\tbe\tsurprised\tif\tthings\tlike\tdistributed\ttransactions\tor\tCAP\ttheorem start\tgiving\tyou\theadaches,\teither!\n\nEvery\tcompany,\torganization,\tand\tsystem\tis\tdifferent.\tA\tnumber\tof\tfactors\twill\tplay\tinto whether\tor\tnot\tmicroservices\tare\tright\tfor\tyou,\tand\thow\taggressive\tyou\tcan\tbe\tin\tadopting them.\tThroughout\teach\tchapter\tin\tthis\tbook\tI’ll\tattempt\tto\tgive\tyou\tguidance\thighlighting the\tpotential\tpitfalls,\twhich\tshould\thelp\tyou\tchart\ta\tsteady\tpath.",
      "content_length": 1097,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 34,
      "content": "Summary\n\nHopefully\tby\tnow\tyou\tknow\twhat\ta\tmicroservice\tis,\twhat\tmakes\tit\tdifferent\tfrom\tother compositional\ttechniques,\tand\twhat\tsome\tof\tthe\tkey\tadvantages\tare.\tIn\teach\tof\tthe following\tchapters\twe\twill\tgo\tinto\tmore\tdetail\ton\thow\tto\tachieve\tthese\tbenefits\tand\thow to\tavoid\tsome\tof\tthe\tcommon\tpitfalls.\n\nThere\tare\ta\tnumber\tof\ttopics\tto\tcover,\tbut\twe\tneed\tto\tstart\tsomewhere.\tOne\tof\tthe\tmain challenges\tthat\tmicroservices\tintroduce\tis\ta\tshift\tin\tthe\trole\tof\tthose\twho\toften\tguide\tthe evolution\tof\tour\tsystems:\tthe\tarchitects.\tWe’ll\tlook\tnext\tat\tsome\tdifferent\tapproaches\tto this\trole\tthat\tcan\tensure\twe\tget\tthe\tmost\tout\tof\tthis\tnew\tarchitecture.",
      "content_length": 643,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 35,
      "content": "Chapter\t2.\tThe\tEvolutionary\tArchitect\n\nAs\twe\thave\tseen\tso\tfar,\tmicroservices\tgive\tus\ta\tlot\tof\tchoice,\tand\taccordingly\ta\tlot\tof decisions\tto\tmake.\tFor\texample,\thow\tmany\tdifferent\ttechnologies\tshould\twe\tuse,\tshould we\tlet\tdifferent\tteams\tuse\tdifferent\tprogramming\tidioms,\tand\tshould\twe\tsplit\tor\tmerge\ta service?\tHow\tdo\twe\tgo\tabout\tmaking\tthese\tdecisions?\tWith\tthe\tfaster\tpace\tof\tchange,\tand the\tmore\tfluid\tenvironment\tthat\tthese\tarchitectures\tallow,\tthe\trole\tof\tthe\tarchitect\talso\thas to\tchange.\tIn\tthis\tchapter,\tI’ll\ttake\ta\tfairly\topinionated\tview\tof\twhat\tthe\trole\tof\tan architect\tis,\tand\thopefully\tlaunch\tone\tfinal\tassault\ton\tthe\tivory\ttower.",
      "content_length": 642,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 36,
      "content": "Inaccurate\tComparisons\n\nYou\tkeep\tusing\tthat\tword.\tI\tdo\tnot\tthink\tit\tmeans\twhat\tyou\tthink\tit\tmeans.\n\nInigo\tMontoya,\tfrom\tThe\tPrincess\tBride\n\nArchitects\thave\tan\timportant\tjob.\tThey\tare\tin\tcharge\tof\tmaking\tsure\twe\thave\ta\tjoined-up technical\tvision,\tone\tthat\tshould\thelp\tus\tdeliver\tthe\tsystem\tour\tcustomers\tneed.\tIn\tsome places,\tthey\tmay\tonly\thave\tto\twork\twith\tone\tteam,\tin\twhich\tcase\tthe\trole\tof\tthe\tarchitect and\ttechnical\tlead\tis\toften\tthe\tsame.\tIn\tothers,\tthey\tmay\tbe\tdefining\tthe\tvision\tfor\tan entire\tprogram\tof\twork,\tcoordinating\twith\tmultiple\tteams\tacross\tthe\tworld,\tor\tperhaps even\tan\tentire\torganization.\tAt\twhatever\tlevel\tthey\toperate,\tthe\trole\tis\ta\ttricky\tone\tto\tpin down,\tand\tdespite\tit\toften\tbeing\tthe\tobvious\tcareer\tprogression\tfor\tdevelopers\tin enterprise\torganizations,\tit\tis\talso\ta\trole\tthat\tgets\tmore\tcriticism\tthan\tvirtually\tany\tother. More\tthan\tany\tother\trole,\tarchitects\tcan\thave\ta\tdirect\timpact\ton\tthe\tquality\tof\tthe\tsystems built,\ton\tthe\tworking\tconditions\tof\ttheir\tcolleagues,\tand\ton\ttheir\torganization’s\tability\tto respond\tto\tchange,\tand\tyet\twe\tso\tfrequently\tseem\tto\tget\tthis\trole\twrong.\tWhy\tis\tthat?\n\nOur\tindustry\tis\ta\tyoung\tone.\tThis\tis\tsomething\twe\tseem\tto\tforget,\tand\tyet\twe\thave\tonly been\tcreating\tprograms\tthat\trun\ton\twhat\twe\trecognize\tas\tcomputers\tfor\taround\t70\tyears. Therefore,\twe\tare\tconstantly\tlooking\tto\tother\tprofessions\tin\tan\tattempt\tto\texplain\twhat\twe do.\tWe\taren’t\tmedical\tdoctors\tor\tengineers,\tbut\tnor\tare\twe\tplumbers\tor\telectricians. Instead,\twe\tfall\tinto\tsome\tmiddle\tground,\twhich\tmakes\tit\thard\tfor\tsociety\tto\tunderstand us,\tor\tfor\tus\tto\tunderstand\twhere\twe\tfit.\n\nSo\twe\tborrow\tfrom\tother\tprofessions.\tWe\tcall\tourselves\tsoftware\t“engineers,”\tor “architects.”\tBut\twe\taren’t,\tare\twe?\tArchitects\tand\tengineers\thave\ta\trigor\tand\tdiscipline we\tcould\tonly\tdream\tof,\tand\ttheir\timportance\tin\tsociety\tis\twell\tunderstood.\tI\tremember talking\tto\ta\tfriend\tof\tmine,\tthe\tday\tbefore\the\tbecame\ta\tqualified\tarchitect.\t“Tomorrow,”\the said,\t“if\tI\tgive\tyou\tadvice\tdown\tat\tthe\tpub\tabout\thow\tto\tbuild\tsomething\tand\tit’s\twrong,\tI get\theld\tto\taccount.\tI\tcould\tget\tsued,\tas\tin\tthe\teyes\tof\tthe\tlaw\tI\tam\tnow\ta\tqualified architect\tand\tI\tshould\tbe\theld\tresponsible\tif\tI\tget\tit\twrong.”\tThe\timportance\tof\tthese\tjobs to\tsociety\tmeans\tthat\tthere\tare\trequired\tqualifications\tpeople\thave\tto\tmeet.\tIn\tthe\tUK,\tfor example,\ta\tminimum\tof\tseven\tyears\tstudy\tis\trequired\tbefore\tyou\tcan\tbe\tcalled\tan architect.\tBut\tthese\tjobs\tare\talso\tbased\ton\ta\tbody\tof\tknowledge\tgoing\tback\tthousands\tof years.\tAnd\tus?\tNot\tquite.\tWhich\tis\talso\twhy\tI\tview\tmost\tforms\tof\tIT\tcertification\tas worthless,\tas\twe\tknow\tso\tlittle\tabout\twhat\tgood\tlooks\tlike.\n\nPart\tof\tus\twants\trecognition,\tso\twe\tborrow\tnames\tfrom\tother\tprofessions\tthat\talready\thave the\trecognition\twe\tas\tan\tindustry\tcrave.\tBut\tthis\tcan\tbe\tdoubly\tharmful.\tFirst,\tit\timplies we\tknow\twhat\twe\tare\tdoing,\twhen\twe\tplainly\tdon’t.\tI\twouldn’t\tsay\tthat\tbuildings\tand bridges\tnever\tfall\tdown,\tbut\tthey\tfall\tdown\tmuch\tless\tthan\tthe\tnumber\tof\ttimes\tour programs\twill\tcrash,\tmaking\tcomparisons\twith\tengineers\tquite\tunfair.\tSecond,\tthe analogies\tbreak\tdown\tvery\tquickly\twhen\tgiven\teven\ta\tcursory\tglance.\tTo\tturn\tthings",
      "content_length": 3139,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 37,
      "content": "around,\tif\tbridge\tbuilding\twere\tlike\tprogramming,\thalfway\tthrough\twe’d\tfind\tout\tthat\tthe far\tbank\twas\tnow\t50\tmeters\tfarther\tout,\tthat\tit\twas\tactually\tmud\trather\tthan\tgranite,\tand that\trather\tthan\tbuilding\ta\tfootbridge\twe\twere\tinstead\tbuilding\ta\troad\tbridge.\tOur\tsoftware isn’t\tconstrained\tby\tthe\tsame\tphysical\trules\tthat\treal\tarchitects\tor\tengineers\thave\tto\tdeal with,\tand\twhat\twe\tcreate\tis\tdesigned\tto\tflex\tand\tadapt\tand\tevolve\twith\tuser\trequirements.\n\nPerhaps\tthe\tterm\tarchitect\thas\tdone\tthe\tmost\tharm.\tThe\tidea\tof\tsomeone\twho\tdraws\tup detailed\tplans\tfor\tothers\tto\tinterpret,\tand\texpects\tthis\tto\tbe\tcarried\tout.\tThe\tbalance\tof\tpart artist,\tpart\tengineer,\toverseeing\tthe\tcreation\tof\twhat\tis\tnormally\ta\tsingular\tvision,\twith\tall other\tviewpoints\tbeing\tsubservient,\texcept\tfor\tthe\toccasional\tobjection\tfrom\tthe\tstructural engineer\tregarding\tthe\tlaws\tof\tphysics.\tIn\tour\tindustry,\tthis\tview\tof\tthe\tarchitect\tleads\tto some\tterrible\tpractices.\tDiagram\tafter\tdiagram,\tpage\tafter\tpage\tof\tdocumentation,\tcreated with\ta\tview\tto\tinform\tthe\tconstruction\tof\tthe\tperfect\tsystem,\twithout\ttaking\tinto\taccount the\tfundamentally\tunknowable\tfuture.\tUtterly\tdevoid\tof\tany\tunderstanding\tas\tto\thow\thard it\twill\tbe\tto\timplement,\tor\twhether\tor\tnot\tit\twill\tactually\twork,\tlet\talone\thaving\tany\tability to\tchange\tas\twe\tlearn\tmore.\n\nWhen\twe\tcompare\tourselves\tto\tengineers\tor\tarchitects,\twe\tare\tin\tdanger\tof\tdoing everyone\ta\tdisservice.\tUnfortunately,\twe\tare\tstuck\twith\tthe\tword\tarchitect\tfor\tnow.\tSo\tthe best\twe\tcan\tdo\tis\tto\tredefine\twhat\tit\tmeans\tin\tour\tcontext.",
      "content_length": 1536,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 38,
      "content": "An\tEvolutionary\tVision\tfor\tthe\tArchitect\n\nOur\trequirements\tshift\tmore\trapidly\tthan\tthey\tdo\tfor\tpeople\twho\tdesign\tand\tbuild buildings\t—\tas\tdo\tthe\ttools\tand\ttechniques\tat\tour\tdisposal.\tThe\tthings\twe\tcreate\tare\tnot fixed\tpoints\tin\ttime.\tOnce\tlaunched\tinto\tproduction,\tour\tsoftware\twill\tcontinue\tto\tevolve as\tthe\tway\tit\tis\tused\tchanges.\tFor\tmost\tthings\twe\tcreate,\twe\thave\tto\taccept\tthat\tonce\tthe software\tgets\tinto\tthe\thands\tof\tour\tcustomers\twe\twill\thave\tto\treact\tand\tadapt,\trather\tthan it\tbeing\ta\tnever-changing\tartifact.\tThus,\tour\tarchitects\tneed\tto\tshift\ttheir\tthinking\taway from\tcreating\tthe\tperfect\tend\tproduct,\tand\tinstead\tfocus\ton\thelping\tcreate\ta\tframework\tin which\tthe\tright\tsystems\tcan\temerge,\tand\tcontinue\tto\tgrow\tas\twe\tlearn\tmore.\n\nAlthough\tI\thave\tspent\tmuch\tof\tthe\tchapter\tso\tfar\twarning\tyou\toff\tcomparing\tourselves\ttoo much\tto\tother\tprofessions,\tthere\tis\tone\tanalogy\tthat\tI\tlike\twhen\tit\tcomes\tto\tthe\trole\tof\tthe IT\tarchitect\tand\tthat\tI\tthink\tbetter\tencapsulates\twhat\twe\twant\tthis\trole\tto\tbe.\tErik Doernenburg\tfirst\tshared\twith\tme\tthe\tidea\tthat\twe\tshould\tthink\tof\tour\trole\tmore\tas\ttown planners\tthan\tarchitects\tfor\tthe\tbuilt\tenvironment.\tThe\trole\tof\tthe\ttown\tplanner\tshould\tbe familiar\tto\tany\tof\tyou\twho\thave\tplayed\tSimCity\tbefore.\tA\ttown\tplanner’s\trole\tis\tto\tlook\tat a\tmultitude\tof\tsources\tof\tinformation,\tand\tthen\tattempt\tto\toptimize\tthe\tlayout\tof\ta\tcity\tto best\tsuit\tthe\tneeds\tof\tthe\tcitizens\ttoday,\ttaking\tinto\taccount\tfuture\tuse.\tThe\tway\the influences\thow\tthe\tcity\tevolves,\tthough,\tis\tinteresting.\tHe\tdoes\tnot\tsay,\t“build\tthis specific\tbuilding\tthere”;\tinstead,\the\tzones\ta\tcity.\tSo\tas\tin\tSimCity,\tyou\tmight\tdesignate part\tof\tyour\tcity\tas\tan\tindustrial\tzone,\tand\tanother\tpart\tas\ta\tresidential\tzone.\tIt\tis\tthen\tup to\tother\tpeople\tto\tdecide\twhat\texact\tbuildings\tget\tcreated,\tbut\tthere\tare\trestrictions:\tif\tyou want\tto\tbuild\ta\tfactory,\tit\twill\tneed\tto\tbe\tin\tan\tindustrial\tzone.\tRather\tthan\tworrying\ttoo much\tabout\twhat\thappens\tin\tone\tzone,\tthe\ttown\tplanner\twill\tinstead\tspend\tfar\tmore\ttime working\tout\thow\tpeople\tand\tutilities\tmove\tfrom\tone\tzone\tto\tanother.\n\nMore\tthan\tone\tperson\thas\tlikened\ta\tcity\tto\ta\tliving\tcreature.\tThe\tcity\tchanges\tover\ttime.\tIt shifts\tand\tevolves\tas\tits\toccupants\tuse\tit\tin\tdifferent\tways,\tor\tas\texternal\tforces\tshape\tit. The\ttown\tplanner\tdoes\this\tbest\tto\tanticipate\tthese\tchanges,\tbut\taccepts\tthat\ttrying\tto\texert direct\tcontrol\tover\tall\taspects\tof\twhat\thappens\tis\tfutile.\n\nThe\tcomparison\twith\tsoftware\tshould\tbe\tobvious.\tAs\tour\tusers\tuse\tour\tsoftware,\twe\tneed to\treact\tand\tchange.\tWe\tcannot\tforesee\teverything\tthat\twill\thappen,\tand\tso\trather\tthan plan\tfor\tany\teventuality,\twe\tshould\tplan\tto\tallow\tfor\tchange\tby\tavoiding\tthe\turge\tto overspecify\tevery\tlast\tthing.\tOur\tcity\t—\tthe\tsystem\t—\tneeds\tto\tbe\ta\tgood,\thappy\tplace\tfor everyone\twho\tuses\tit.\tOne\tthing\tthat\tpeople\toften\tforget\tis\tthat\tour\tsystem\tdoesn’t\tjust accommodate\tusers;\tit\talso\taccommodates\tdevelopers\tand\toperations\tpeople\twho\talso have\tto\twork\tthere,\tand\twho\thave\tthe\tjob\tof\tmaking\tsure\tit\tcan\tchange\tas\trequired.\tTo borrow\ta\tterm\tfrom\tFrank\tBuschmann,\tarchitects\thave\ta\tduty\tto\tensure\tthat\tthe\tsystem\tis habitable\tfor\tdevelopers\ttoo.\n\nA\ttown\tplanner,\tjust\tlike\tan\tarchitect,\talso\tneeds\tto\tknow\twhen\this\tplan\tisn’t\tbeing",
      "content_length": 3218,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 39,
      "content": "followed.\tAs\the\tis\tless\tprescriptive,\tthe\tnumber\tof\ttimes\the\tneeds\tto\tget\tinvolved\tto correct\tdirection\tshould\tbe\tminimal,\tbut\tif\tsomeone\tdecides\tto\tbuild\ta\tsewage\tplant\tin\ta residential\tarea,\the\tneeds\tto\tbe\table\tto\tshut\tit\tdown.\n\nSo\tour\tarchitects\tas\ttown\tplanners\tneed\tto\tset\tdirection\tin\tbroad\tstrokes,\tand\tonly\tget involved\tin\tbeing\thighly\tspecific\tabout\timplementation\tdetail\tin\tlimited\tcases.\tThey\tneed to\tensure\tthat\tthe\tsystem\tis\tfit\tfor\tpurpose\tnow,\tbut\talso\ta\tplatform\tfor\tthe\tfuture.\tAnd they\tneed\tto\tensure\tthat\tit\tis\ta\tsystem\tthat\tmakes\tusers\tand\tdevelopers\tequally\thappy.\tThis sounds\tlike\ta\tpretty\ttall\torder.\tWhere\tdo\twe\tstart?",
      "content_length": 642,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 40,
      "content": "Zoning\n\nSo,\tto\tcontinue\tthe\tmetaphor\tof\tthe\tarchitect\tas\ttown\tplanner\tfor\ta\tmoment,\twhat\tare\tour zones?\tThese\tare\tour\tservice\tboundaries,\tor\tperhaps\tcoarse-grained\tgroups\tof\tservices.\tAs architects,\twe\tneed\tto\tworry\tmuch\tless\tabout\twhat\thappens\tinside\tthe\tzone\tthan\twhat happens\tbetween\tthe\tzones.\tThat\tmeans\twe\tneed\tto\tspend\ttime\tthinking\tabout\thow\tour services\ttalk\tto\teach\tother,\tor\tensuring\tthat\twe\tcan\tproperly\tmonitor\tthe\toverall\thealth\tof our\tsystem.\tHow\tinvolved\twe\tget\tinside\tthe\tzone\twill\tvary\tsomewhat.\tMany\torganizations have\tadopted\tmicroservices\tin\torder\tto\tmaximize\tfor\tautonomy\tof\tteams,\tsomething\twe’ll expand\ton\tin\tChapter\t10.\tIf\tyou\tare\tin\tsuch\tan\torganization,\tyou\twill\trely\tmore\ton\tthe team\tto\tmake\tthe\tright\tlocal\tdecision.\n\nBut\tbetween\tthe\tzones,\tor\tthe\tboxes\ton\tour\ttraditional\tarchitecture\tdiagram,\twe\tneed\tto\tbe careful;\tgetting\tthings\twrong\there\tleads\tto\tall\tsorts\tof\tproblems\tand\tcan\tbe\tvery\thard\tto correct.\n\nWithin\teach\tservice,\tyou\tmay\tbe\tOK\twith\tthe\tteam\twho\towns\tthat\tzone\tpicking\ta\tdifferent technology\tstack\tor\tdata\tstore.\tOther\tconcerns\tmay\tkick\tin\there,\tof\tcourse.\tYour inclination\tto\tlet\tteams\tpick\tthe\tright\ttool\tfor\tthe\tjob\tmay\tbe\ttempered\tby\tthe\tfact\tthat\tit becomes\tharder\tto\thire\tpeople\tor\tmove\tthem\tbetween\tteams\tif\tyou\thave\t10\tdifferent technology\tstacks\tto\tsupport.\tSimilarly,\tif\teach\tteam\tpicks\ta\tcompletely\tdifferent\tdata store,\tyou\tmay\tfind\tyourself\tlacking\tenough\texperience\tto\trun\tany\tof\tthem\tat\tscale. Netflix,\tfor\texample,\thas\tmostly\tstandardized\ton\tCassandra\tas\ta\tdata-store\ttechnology. Although\tit\tmay\tnot\tbe\tthe\tbest\tfit\tfor\tall\tof\tits\tcases,\tNetflix\tfeels\tthat\tthe\tvalue\tgained\tby building\ttooling\tand\texpertise\taround\tCassandra\tis\tmore\timportant\tthan\thaving\tto\tsupport and\toperate\tat\tscale\tmultiple\tother\tplatforms\tthat\tmay\tbe\ta\tbetter\tfit\tfor\tcertain\ttasks. Netflix\tis\tan\textreme\texample,\twhere\tscale\tis\tlikely\tthe\tstrongest\toverriding\tfactor,\tbut you\tget\tthe\tidea.\n\nBetween\tservices\tis\twhere\tthings\tcan\tget\tmessy,\thowever.\tIf\tone\tservice\tdecides\tto\texpose REST\tover\tHTTP,\tanother\tmakes\tuse\tof\tprotocol\tbuffers,\tand\ta\tthird\tuses\tJava\tRMI,\tthen integration\tcan\tbecome\ta\tnightmare\tas\tconsuming\tservices\thave\tto\tunderstand\tand\tsupport multiple\tstyles\tof\tinterchange.\tThis\tis\twhy\tI\ttry\tto\tstick\tto\tthe\tguideline\tthat\twe\tshould\t“be worried\tabout\twhat\thappens\tbetween\tthe\tboxes,\tand\tbe\tliberal\tin\twhat\thappens\tinside.”",
      "content_length": 2371,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 41,
      "content": "THE\tCODING\tARCHITECT\n\nIf\twe\tare\tto\tensure\tthat\tthe\tsystems\twe\tcreate\tare\thabitable\tfor\tour\tdevelopers,\tthen\tour\tarchitects\tneed\tto understand\tthe\timpact\tof\ttheir\tdecisions.\tAt\tthe\tvery\tleast,\tthis\tmeans\tspending\ttime\twith\tthe\tteam,\tand\tideally\tit should\tmean\tthat\tthese\tdevelopers\tactually\tspend\ttime\tcoding\twith\tthe\tteam\ttoo.\tFor\tthose\tof\tyou\twho\tpractice\tpair programming,\tit\tbecomes\ta\tsimple\tmatter\tfor\tan\tarchitect\tto\tjoin\ta\tteam\tfor\ta\tshort\tperiod\tas\tone\tmember\tof\tthe pair.\tIdeally,\tyou\tshould\twork\ton\tnormal\tstories,\tto\treally\tunderstand\twhat\tnormal\twork\tis\tlike.\tI\tcannot\temphasize how\timportant\tit\tis\tfor\tthe\tarchitect\tto\tactually\tsit\twith\tthe\tteam!\tThis\tis\tsignificantly\tmore\teffective\tthan\thaving\ta call\tor\tjust\tlooking\tat\ther\tcode.\n\nAs\tfor\thow\toften\tyou\tshould\tdo\tthis,\tthat\tdepends\tgreatly\ton\tthe\tsize\tof\tthe\tteam(s)\tyou\tare\tworking\twith.\tBut\tthe key\tis\tthat\tit\tshould\tbe\ta\troutine\tactivity.\tIf\tyou\tare\tworking\twith\tfour\tteams,\tfor\texample,\tspending\thalf\ta\tday\twith each\tteam\tevery\tfour\tweeks\tensures\tyou\tbuild\tan\tawareness\tand\timproved\tcommunications\twith\tthe\tteams\tyou\tare working\twith.",
      "content_length": 1101,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 42,
      "content": "A\tPrincipled\tApproach\n\nRules\tare\tfor\tthe\tobedience\tof\tfools\tand\tthe\tguidance\tof\twise\tmen.\n\nGenerally\tattributed\tto\tDouglas\tBader\n\nMaking\tdecisions\tin\tsystem\tdesign\tis\tall\tabout\ttrade-offs,\tand\tmicroservice\tarchitectures give\tus\tlots\tof\ttrade-offs\tto\tmake!\tWhen\tpicking\ta\tdatastore,\tdo\twe\tpick\ta\tplatform\tthat we\thave\tless\texperience\twith,\tbut\tthat\tgives\tus\tbetter\tscaling?\tIs\tit\tOK\tfor\tus\tto\thave\ttwo different\ttechnology\tstacks\tin\tour\tsystem?\tWhat\tabout\tthree?\tSome\tdecisions\tcan\tbe\tmade completely\ton\tthe\tspot\twith\tinformation\tavailable\tto\tus,\tand\tthese\tare\tthe\teasiest\tto\tmake. But\twhat\tabout\tthose\tdecisions\tthat\tmight\thave\tto\tbe\tmade\ton\tincomplete\tinformation?\n\nFraming\there\tcan\thelp,\tand\ta\tgreat\tway\tto\thelp\tframe\tour\tdecision\tmaking\tis\tto\tdefine\ta set\tof\tprinciples\tand\tpractices\tthat\tguide\tit,\tbased\ton\tgoals\tthat\twe\tare\ttrying\tto\tachieve. Let’s\tlook\tat\teach\tin\tturn.",
      "content_length": 875,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 43,
      "content": "Strategic\tGoals\n\nThe\trole\tof\tthe\tarchitect\tis\talready\tdaunting\tenough,\tso\tluckily\twe\tusually\tdon’t\thave\tto also\tdefine\tstrategic\tgoals!\tStrategic\tgoals\tshould\tspeak\tto\twhere\tyour\tcompany\tis\tgoing, and\thow\tit\tsees\titself\tas\tbest\tmaking\tits\tcustomers\thappy.\tThese\twill\tbe\thigh-level\tgoals, and\tmay\tnot\tinclude\ttechnology\tat\tall.\tThey\tcould\tbe\tdefined\tat\ta\tcompany\tlevel\tor\ta division\tlevel.\tThey\tmight\tbe\tthings\tlike\t“Expand\tinto\tSoutheast\tAsia\tto\tunlock\tnew markets,”\tor\t“Let\tthe\tcustomer\tachieve\tas\tmuch\tas\tpossible\tusing\tself-service.”\tThe\tkey\tis that\tthis\tis\twhere\tyour\torganization\tis\theaded,\tso\tyou\tneed\tto\tmake\tsure\tthe\ttechnology\tis aligned\tto\tit.\n\nIf\tyou’re\tthe\tperson\tdefining\tthe\tcompany’s\ttechnical\tvision,\tthis\tmay\tmean\tyou’ll\tneed\tto spend\tmore\ttime\twith\tthe\tnontechnical\tparts\tof\tyour\torganization\t(or\tthe\tbusiness,\tas\tthey are\toften\tcalled).\tWhat\tis\tthe\tdriving\tvision\tfor\tthe\tbusiness?\tAnd\thow\tdoes\tit\tchange?",
      "content_length": 924,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 44,
      "content": "Principles\n\nPrinciples\tare\trules\tyou\thave\tmade\tin\torder\tto\talign\twhat\tyou\tare\tdoing\tto\tsome\tlarger goal,\tand\twill\tsometimes\tchange.\tFor\texample,\tif\tone\tof\tyour\tstrategic\tgoals\tas\tan organization\tis\tto\tdecrease\tthe\ttime\tto\tmarket\tfor\tnew\tfeatures,\tyou\tmay\tdefine\ta\tprinciple that\tsays\tthat\tdelivery\tteams\thave\tfull\tcontrol\tover\tthe\tlifecycle\tof\ttheir\tsoftware\tto\tship whenever\tthey\tare\tready,\tindependently\tof\tany\tother\tteam.\tIf\tanother\tgoal\tis\tthat\tyour organization\tis\tmoving\tto\taggressively\tgrow\tits\toffering\tin\tother\tcountries,\tyou\tmay decide\tto\timplement\ta\tprinciple\tthat\tthe\tentire\tsystem\tmust\tbe\tportable\tto\tallow\tfor\tit\tto\tbe deployed\tlocally\tin\torder\tto\trespect\tsovereignty\tof\tdata.\n\nYou\tprobably\tdon’t\twant\tloads\tof\tthese.\tFewer\tthan\t10\tis\ta\tgood\tnumber\t—\tsmall\tenough that\tpeople\tcan\tremember\tthem,\tor\tto\tfit\ton\tsmall\tposters.\tThe\tmore\tprinciples\tyou\thave, the\tgreater\tthe\tchance\tthat\tthey\toverlap\tor\tcontradict\teach\tother.\n\nHeroku’s\t12\tFactors\tare\ta\tset\tof\tdesign\tprinciples\tstructured\taround\tthe\tgoal\tof\thelping you\tcreate\tapplications\tthat\twork\twell\ton\tthe\tHeroku\tplatform.\tThey\talso\tmay\twell\tmake sense\tin\tother\tcontexts.\tSome\tof\tthe\tprinciples\tare\tactually\tconstraints\tbased\ton\tbehaviors your\tapplication\tneeds\tto\texhibit\tin\torder\tto\twork\ton\tHeroku.\tA\tconstraint\tis\treally something\tthat\tis\tvery\thard\t(or\tvirtually\timpossible)\tto\tchange,\twhereas\tprinciples\tare things\twe\tdecide\tto\tchoose.\tYou\tmay\tdecide\tto\texplicitly\tcall\tout\tthose\tthings\tthat\tare principles\tversus\tthose\tthat\tare\tconstraints,\tto\thelp\tindicate\tthose\tthings\tyou\treally\tcan’t change.\tPersonally,\tI\tthink\tthere\tcan\tbe\tsome\tvalue\tin\tkeeping\tthem\tin\tthe\tsame\tlist\tto encourage\tchallenging\tconstraints\tevery\tnow\tand\tthen\tand\tsee\tif\tthey\treally\tare immovable!",
      "content_length": 1735,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 45,
      "content": "Practices\n\nOur\tpractices\tare\thow\twe\tensure\tour\tprinciples\tare\tbeing\tcarried\tout.\tThey\tare\ta\tset\tof detailed,\tpractical\tguidance\tfor\tperforming\ttasks.\tThey\twill\toften\tbe\ttechnology-specific, and\tshould\tbe\tlow\tlevel\tenough\tthat\tany\tdeveloper\tcan\tunderstand\tthem.\tPractices\tcould include\tcoding\tguidelines,\tthe\tfact\tthat\tall\tlog\tdata\tneeds\tto\tbe\tcaptured\tcentrally,\tor\tthat HTTP/REST\tis\tthe\tstandard\tintegration\tstyle.\tDue\tto\ttheir\ttechnical\tnature,\tpractices\twill often\tchange\tmore\toften\tthan\tprinciples.\n\nAs\twith\tprinciples,\tsometimes\tpractices\treflect\tconstraints\tin\tyour\torganization.\tFor example,\tif\tyou\tsupport\tonly\tCentOS,\tthis\twill\tneed\tto\tbe\treflected\tin\tyour\tpractices.\n\nPractices\tshould\tunderpin\tour\tprinciples.\tA\tprinciple\tstating\tthat\tdelivery\tteams\tcontrol the\tfull\tlifecycle\tof\ttheir\tsystems\tmay\tmean\tyou\thave\ta\tpractice\tstating\tthat\tall\tservices are\tdeployed\tinto\tisolated\tAWS\taccounts,\tproviding\tself-service\tmanagement\tof\tthe resources\tand\tisolation\tfrom\tother\tteams.",
      "content_length": 982,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 46,
      "content": "Combining\tPrinciples\tand\tPractices\n\nOne\tperson’s\tprinciples\tare\tanother’s\tpractices.\tYou\tmight\tdecide\tto\tcall\tthe\tuse\tof HTTP/REST\ta\tprinciple\trather\tthan\ta\tpractice,\tfor\texample.\tAnd\tthat\twould\tbe\tfine.\tThe key\tpoint\tis\tthat\tthere\tis\tvalue\tin\thaving\toverarching\tideas\tthat\tguide\thow\tthe\tsystem evolves,\tand\tin\thaving\tenough\tdetail\tso\tthat\tpeople\tknow\thow\tto\timplement\tthose\tideas. For\ta\tsmall\tenough\tgroup,\tperhaps\ta\tsingle\tteam,\tcombining\tprinciples\tand\tpractices might\tbe\tOK.\tHowever,\tfor\tlarger\torganizations,\twhere\tthe\ttechnology\tand\tworking practices\tmay\tdiffer,\tyou\tmay\twant\ta\tdifferent\tset\tof\tpractices\tin\tdifferent\tplaces,\tas\tlong as\tthey\tboth\tmap\tto\ta\tcommon\tset\tof\tprinciples.\tA\t.NET\tteam,\tfor\texample,\tmight\thave one\tset\tof\tpractices,\tand\ta\tJava\tteam\tanother,\twith\ta\tset\tof\tpractices\tcommon\tto\tboth.\tThe principles,\tthough,\tcould\tbe\tthe\tsame\tfor\tboth.",
      "content_length": 863,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 47,
      "content": "A\tReal-World\tExample\n\nMy\tcolleague\tEvan\tBottcher\tdeveloped\tthe\tdiagram\tshown\tin\tFigure\t2-1\tin\tthe\tcourse\tof working\twith\tone\tof\tour\tclients.\tThe\tfigure\tshows\tthe\tinterplay\tof\tgoals,\tprinciples,\tand practices\tin\ta\tvery\tclear\tformat.\tOver\tthe\tcourse\tof\ta\tcouple\tyears,\tthe\tpractices\ton\tthe\tfar right\twill\tchange\tfairly\tregularly,\twhereas\tthe\tprinciples\tremain\tfairly\tstatic.\tA\tdiagram such\tas\tthis\tcan\tbe\tprinted\tnicely\ton\ta\tsingle\tsheet\tof\tpaper\tand\tshared,\tand\teach\tidea\tis simple\tenough\tfor\tthe\taverage\tdeveloper\tto\tremember.\tThere\tis,\tof\tcourse,\tmore\tdetail behind\teach\tpoint\there,\tbut\tbeing\table\tto\tarticulate\tthis\tin\tsummary\tform\tis\tvery\tuseful.\n\nFigure\t2-1.\tA\treal-world\texample\tof\tprinciples\tand\tpractices\n\nIt\tmakes\tsense\tto\thave\tdocumentation\tsupporting\tsome\tof\tthese\titems.\tIn\tthe\tmain, though,\tI\tlike\tthe\tidea\tof\thaving\texample\tcode\tthat\tyou\tcan\tlook\tat,\tinspect,\tand\trun, which\tembodies\tthese\tideas.\tEven\tbetter,\twe\tcan\tcreate\ttooling\tthat\tdoes\tthe\tright\tthing out\tof\tthe\tbox.\tWe’ll\tdiscuss\tthat\tin\tmore\tdepth\tmomentarily.",
      "content_length": 1032,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 48,
      "content": "The\tRequired\tStandard\n\nWhen\tyou’re\tworking\tthrough\tyour\tpractices\tand\tthinking\tabout\tthe\ttrade-offs\tyou\tneed\tto make,\tone\tof\tthe\tcore\tbalances\tto\tfind\tis\thow\tmuch\tvariability\tto\tallow\tin\tyour\tsystem. One\tof\tthe\tkey\tways\tto\tidentify\twhat\tshould\tbe\tconstant\tfrom\tservice\tto\tservice\tis\tto define\twhat\ta\twell-behaved,\tgood\tservice\tlooks\tlike.\tWhat\tis\ta\t“good\tcitizen”\tservice\tin your\tsystem?\tWhat\tcapabilities\tdoes\tit\tneed\tto\thave\tto\tensure\tthat\tyour\tsystem\tis manageable\tand\tthat\tone\tbad\tservice\tdoesn’t\tbring\tdown\tthe\twhole\tsystem?\tAnd,\tas\twith people,\twhat\ta\tgood\tcitizen\tis\tin\tone\tcontext\tdoes\tnot\treflect\twhat\tit\tlooks\tlike\tsomewhere else.\tNonetheless,\tthere\tare\tsome\tcommon\tcharacteristics\tof\twell-behaved\tservices\tthat\tI think\tare\tfairly\timportant\tto\tobserve.\tThese\tare\tthe\tfew\tkey\tareas\twhere\tallowing\ttoo much\tdivergence\tcan\tresult\tin\ta\tpretty\ttorrid\ttime.\tAs\tBen\tChristensen\tfrom\tNetflix\tputs it,\twhen\twe\tthink\tabout\tthe\tbigger\tpicture,\t“it\tneeds\tto\tbe\ta\tcohesive\tsystem\tmade\tof many\tsmall\tparts\twith\tautonomous\tlifecycles\tbut\tall\tcoming\ttogether.”\tSo\twe\tneed\tto\tfind the\tbalance\tbetween\toptimizing\tfor\tautonomy\tof\tthe\tindividual\tmicroservice\twithout losing\tsight\tof\tthe\tbigger\tpicture.\tDefining\tclear\tattributes\tthat\teach\tservice\tshould\thave\tis one\tway\tof\tbeing\tclear\tas\tto\twhere\tthat\tbalance\tsits.",
      "content_length": 1305,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 49,
      "content": "Monitoring\n\nIt\tis\tessential\tthat\twe\tare\table\tto\tdraw\tup\tcoherent,\tcross-service\tviews\tof\tour\tsystem health.\tThis\thas\tto\tbe\ta\tsystem-wide\tview,\tnot\ta\tservice-specific\tview.\tAs\twe’ll\tdiscuss\tin Chapter\t8,\tknowing\tthe\thealth\tof\tan\tindividual\tservice\tis\tuseful,\tbut\toften\tonly\twhen you’re\ttrying\tto\tdiagnose\ta\twider\tproblem\tor\tunderstand\ta\tlarger\ttrend.\tTo\tmake\tthis\tas easy\tas\tpossible,\tI\twould\tsuggest\tensuring\tthat\tall\tservices\temit\thealth\tand\tgeneral monitoring-related\tmetrics\tin\tthe\tsame\tway.\n\nYou\tmight\tchoose\tto\tadopt\ta\tpush\tmechanism,\twhere\teach\tservice\tneeds\tto\tpush\tthis\tdata into\ta\tcentral\tlocation.\tFor\tyour\tmetrics\tthis\tmight\tbe\tGraphite,\tand\tfor\tyour\thealth\tit might\tbe\tNagios.\tOr\tyou\tmight\tdecide\tto\tuse\tpolling\tsystems\tthat\tscrape\tdata\tfrom\tthe nodes\tthemselves.\tBut\twhatever\tyou\tpick,\ttry\tto\tkeep\tit\tstandardized.\tMake\tthe technology\tinside\tthe\tbox\topaque,\tand\tdon’t\trequire\tthat\tyour\tmonitoring\tsystems\tchange in\torder\tto\tsupport\tit.\tLogging\tfalls\tinto\tthe\tsame\tcategory\there:\twe\tneed\tit\tin\tone\tplace.",
      "content_length": 1016,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 50,
      "content": "Interfaces\n\nPicking\ta\tsmall\tnumber\tof\tdefined\tinterface\ttechnologies\thelps\tintegrate\tnew\tconsumers. Having\tone\tstandard\tis\ta\tgood\tnumber.\tTwo\tisn’t\ttoo\tbad,\teither.\tHaving\t20\tdifferent styles\tof\tintegration\tis\tbad.\tThis\tisn’t\tjust\tabout\tpicking\tthe\ttechnology\tand\tthe\tprotocol.\tIf you\tpick\tHTTP/REST,\tfor\texample,\twill\tyou\tuse\tverbs\tor\tnouns?\tHow\twill\tyou\thandle pagination\tof\tresources?\tHow\twill\tyou\thandle\tversioning\tof\tend\tpoints?",
      "content_length": 433,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 51,
      "content": "Architectural\tSafety\n\nWe\tcannot\tafford\tfor\tone\tbadly\tbehaved\tservice\tto\truin\tthe\tparty\tfor\teveryone.\tWe\thave\tto ensure\tthat\tour\tservices\tshield\tthemselves\taccordingly\tfrom\tunhealthy,\tdownstream\tcalls. The\tmore\tservices\twe\thave\tthat\tdo\tnot\tproperly\thandle\tthe\tpotential\tfailure\tof\tdownstream calls,\tthe\tmore\tfragile\tour\tsystems\twill\tbe.\tThis\tmeans\tyou\twill\tprobably\twant\tto\tmandate as\ta\tminimum\tthat\teach\tdownstream\tservice\tgets\tits\town\tconnection\tpool,\tand\tyou\tmay even\tgo\tas\tfar\tas\tto\tsay\tthat\teach\talso\tuses\ta\tcircuit\tbreaker.\tThis\twill\tget\tcovered\tin\tmore depth\twhen\twe\tdiscuss\tmicroservices\tat\tscale\tin\tChapter\t11.\n\nPlaying\tby\tthe\trules\tis\timportant\twhen\tit\tcomes\tto\tresponse\tcodes,\ttoo.\tIf\tyour\tcircuit breakers\trely\ton\tHTTP\tcodes,\tand\tone\tservice\tdecides\tto\tsend\tback\t2XX\tcodes\tfor\terrors, or\tconfuses\t4XX\tcodes\twith\t5XX\tcodes,\tthen\tthese\tsafety\tmeasures\tcan\tfall\tapart.\tSimilar concerns\twould\tapply\teven\tif\tyou’re\tnot\tusing\tHTTP;\tknowing\tthe\tdifference\tbetween\ta request\tthat\twas\tOK\tand\tprocessed\tcorrectly,\ta\trequest\tthat\twas\tbad\tand\tthus\tprevented the\tservice\tfrom\tdoing\tanything\twith\tit,\tand\ta\trequest\tthat\tmight\tbe\tOK\tbut\twe\tcan’t\ttell because\tthe\tserver\twas\tdown\tis\tkey\tto\tensuring\twe\tcan\tfail\tfast\tand\ttrack\tdown\tissues.\tIf our\tservices\tplay\tfast\tand\tloose\twith\tthese\trules,\twe\tend\tup\twith\ta\tmore\tvulnerable system.",
      "content_length": 1328,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 52,
      "content": "Governance\tThrough\tCode\n\nGetting\ttogether\tand\tagreeing\ton\thow\tthings\tcan\tbe\tdone\tis\ta\tgood\tidea.\tBut\tspending time\tmaking\tsure\tpeople\tare\tfollowing\tthese\tguidelines\tis\tless\tfun,\tas\tis\tplacing\ta\tburden on\tdevelopers\tto\timplement\tall\tthese\tstandard\tthings\tyou\texpect\teach\tservice\tto\tdo.\tI\tam\ta great\tbeliever\tin\tmaking\tit\teasy\tto\tdo\tthe\tright\tthing.\tTwo\ttechniques\tI\thave\tseen\twork well\there\tare\tusing\texemplars\tand\tproviding\tservice\ttemplates.",
      "content_length": 442,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 53,
      "content": "Exemplars\n\nWritten\tdocumentation\tis\tgood,\tand\tuseful.\tI\tclearly\tsee\tthe\tvalue;\tafter\tall,\tI’ve\twritten this\tbook.\tBut\tdevelopers\talso\tlike\tcode,\tand\tcode\tthey\tcan\trun\tand\texplore.\tIf\tyou\thave\ta set\tof\tstandards\tor\tbest\tpractices\tyou\twould\tlike\tto\tencourage,\tthen\thaving\texemplars\tthat you\tcan\tpoint\tpeople\tto\tis\tuseful.\tThe\tidea\tis\tthat\tpeople\tcan’t\tgo\tfar\twrong\tjust\tby imitating\tsome\tof\tthe\tbetter\tparts\tof\tyour\tsystem.\n\nIdeally,\tthese\tshould\tbe\treal-world\tservices\tyou\thave\tthat\tget\tthings\tright,\trather\tthan isolated\tservices\tthat\tare\tjust\timplemented\tto\tbe\tperfect\texamples.\tBy\tensuring\tyour exemplars\tare\tactually\tbeing\tused,\tyou\tensure\tthat\tall\tthe\tprinciples\tyou\thave\tactually make\tsense.",
      "content_length": 696,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 54,
      "content": "Tailored\tService\tTemplate\n\nWouldn’t\tit\tbe\tgreat\tif\tyou\tcould\tmake\tit\treally\teasy\tfor\tall\tdevelopers\tto\tfollow\tmost\tof the\tguidelines\tyou\thave\twith\tvery\tlittle\twork?\tWhat\tif,\tout\tof\tthe\tbox,\tthe\tdevelopers\thad most\tof\tthe\tcode\tin\tplace\tto\timplement\tthe\tcore\tattributes\tthat\teach\tservice\tneeds?\n\nDropwizard\tand\tKaryon\tare\ttwo\topen\tsource,\tJVM-based\tmicrocontainers.\tThey\twork\tin similar\tways,\tpulling\ttogether\ta\tset\tof\tlibraries\tto\tprovide\tfeatures\tlike\thealth\tchecking, serving\tHTTP,\tor\texposing\tmetrics.\tSo,\tout\tof\tthe\tbox,\tyou\thave\ta\tservice\tcomplete\twith an\tembedded\tservlet\tcontainer\tthat\tcan\tbe\tlaunched\tfrom\tthe\tcommand\tline.\tThis\tis\ta great\tway\tto\tget\tgoing,\tbut\twhy\tstop\tthere?\tWhile\tyou’re\tat\tit,\twhy\tnot\ttake\tsomething like\ta\tDropwizard\tor\tKaryon,\tand\tadd\tmore\tfeatures\tso\tthat\tit\tbecomes\tcompliant\tfor\tyour context?\n\nFor\texample,\tyou\tmight\twant\tto\tmandate\tthe\tuse\tof\tcircuit\tbreakers.\tIn\tthat\tcase,\tyou might\tintegrate\ta\tcircuit\tbreaker\tlibrary\tlike\tHystrix.\tOr\tyou\tmight\thave\ta\tpractice\tthat\tall your\tmetrics\tneed\tto\tbe\tsent\tto\ta\tcentral\tGraphite\tserver,\tso\tperhaps\tpull\tin\tan\topen\tsource library\tlike\tDropwizard’s\tMetrics\tand\tconfigure\tit\tso\tthat,\tout\tof\tthe\tbox,\tresponse\ttimes and\terror\trates\tare\tpushed\tautomatically\tto\ta\tknown\tlocation.\n\nBy\ttailoring\tsuch\ta\tservice\ttemplate\tfor\tyour\town\tset\tof\tdevelopment\tpractices,\tyou\tensure that\tteams\tcan\tget\tgoing\tfaster,\tand\talso\tthat\tdevelopers\thave\tto\tgo\tout\tof\ttheir\tway\tto make\ttheir\tservices\tbadly\tbehaved.\n\nOf\tcourse,\tif\tyou\tembraced\tmultiple\tdisparate\ttechnology\tstacks,\tyou’d\tneed\ta\tmatching service\ttemplate\tfor\teach.\tThis\tmay\tbe\ta\tway\tyou\tsubtly\tconstrain\tlanguage\tchoices\tin your\tteams,\tthough.\tIf\tthe\tin-house\tservice\ttemplate\tsupports\tonly\tJava,\tthen\tpeople\tmay be\tdiscouraged\tfrom\tpicking\talternative\tstacks\tif\tthey\thave\tto\tdo\tlots\tmore\twork themselves.\tNetflix,\tfor\texample,\tis\tespecially\tconcerned\twith\taspects\tlike\tfault\ttolerance, to\tensure\tthat\tthe\toutage\tof\tone\tpart\tof\tits\tsystem\tcannot\ttake\teverything\tdown.\tTo\thandle this,\ta\tlarge\tamount\tof\twork\thas\tbeen\tdone\tto\tensure\tthat\tthere\tare\tclient\tlibraries\ton\tthe JVM\tto\tprovide\tteams\twith\tthe\ttools\tthey\tneed\tto\tkeep\ttheir\tservices\twell\tbehaved. Anyone\tintroducing\ta\tnew\ttechnology\tstack\twould\tmean\thaving\tto\treproduce\tall\tthis effort.\tThe\tmain\tconcern\tfor\tNetflix\tis\tless\tabout\tthe\tduplicated\teffort,\tand\tmore\tabout\tthe fact\tthat\tit\tis\tso\teasy\tto\tget\tthis\twrong.\tThe\trisk\tof\ta\tservice\tgetting\tnewly\timplemented fault\ttolerance\twrong\tis\thigh\tif\tit\tcould\timpact\tmore\tof\tthe\tsystem.\tNetflix\tmitigates\tthis by\tusing\tsidecar\tservices,\twhich\tcommunicate\tlocally\twith\ta\tJVM\tthat\tis\tusing\tthe appropriate\tlibraries.\n\nYou\tdo\thave\tto\tbe\tcareful\tthat\tcreating\tthe\tservice\ttemplate\tdoesn’t\tbecome\tthe\tjob\tof\ta central\ttools\tor\tarchitecture\tteam\twho\tdictates\thow\tthings\tshould\tbe\tdone,\talbeit\tvia\tcode. Defining\tthe\tpractices\tyou\tuse\tshould\tbe\ta\tcollective\tactivity,\tso\tideally\tyour\tteam(s) should\ttake\tjoint\tresponsibility\tfor\tupdating\tthis\ttemplate\t(an\tinternal\topen\tsource approach\tworks\twell\there).",
      "content_length": 3016,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 55,
      "content": "I\thave\talso\tseen\tmany\ta\tteam’s\tmorale\tand\tproductivity\tdestroyed\tby\thaving\ta\tmandated framework\tthrust\tupon\tthem.\tIn\ta\tdrive\tto\timprove\tcode\treuse,\tmore\tand\tmore\twork\tis placed\tinto\ta\tcentralized\tframework\tuntil\tit\tbecomes\tan\toverwhelming\tmonstrosity.\tIf\tyou decide\tto\tuse\ta\ttailored\tservice\ttemplate,\tthink\tvery\tcarefully\tabout\twhat\tits\tjob\tis.\tIdeally, its\tuse\tshould\tbe\tpurely\toptional,\tbut\tif\tyou\tare\tgoing\tto\tbe\tmore\tforceful\tin\tits\tadoption you\tneed\tto\tunderstand\tthat\tease\tof\tuse\tfor\tthe\tdevelopers\thas\tto\tbe\ta\tprime\tguiding\tforce.\n\nAlso\tbe\taware\tof\tthe\tperils\tof\tshared\tcode.\tIn\tour\tdesire\tto\tcreate\treusable\tcode,\twe\tcan introduce\tsources\tof\tcoupling\tbetween\tservices.\tAt\tleast\tone\torganization\tI\tspoke\tto\tis\tso worried\tabout\tthis\tthat\tit\tactually\tcopies\tits\tservice\ttemplate\tcode\tmanually\tinto\teach service.\tThis\tmeans\tthat\tan\tupgrade\tto\tthe\tcore\tservice\ttemplate\ttakes\tlonger\tto\tbe\tapplied across\tits\tsystem,\tbut\tthis\tis\tless\tconcerning\tto\tit\tthan\tthe\tdanger\tof\tcoupling.\tOther\tteams I\thave\tspoken\tto\thave\tsimply\ttreated\tthe\tservice\ttemplate\tas\ta\tshared\tbinary\tdependency, although\tthey\thave\tto\tbe\tvery\tdiligent\tin\tnot\tletting\tthe\ttendency\tfor\tDRY\t(don’t\trepeat yourself)\tresult\tin\tan\toverly\tcoupled\tsystem!\tThis\tis\ta\tnuanced\ttopic,\tso\twe’ll\texplore\tit\tin more\tdetail\tin\tChapter\t4.",
      "content_length": 1292,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 56,
      "content": "Technical\tDebt\n\nWe\tare\toften\tput\tin\tsituations\twhere\twe\tcannot\tfollow\tthrough\tto\tthe\tletter\ton\tour technical\tvision.\tOften,\twe\tneed\tto\tmake\ta\tchoice\tto\tcut\ta\tfew\tcorners\tto\tget\tsome\turgent features\tout.\tThis\tis\tjust\tone\tmore\ttrade-off\tthat\twe’ll\tfind\tourselves\thaving\tto\tmake.\tOur technical\tvision\texists\tfor\ta\treason.\tIf\twe\tdeviate\tfrom\tthis\treason,\tit\tmight\thave\ta\tshort- term\tbenefit\tbut\ta\tlong-term\tcost.\tA\tconcept\tthat\thelps\tus\tunderstand\tthis\ttrade-off\tis technical\tdebt.\tWhen\twe\taccrue\ttechnical\tdebt,\tjust\tlike\tdebt\tin\tthe\treal\tworld\tit\thas\tan ongoing\tcost,\tand\tis\tsomething\twe\twant\tto\tpay\tdown.\n\nSometimes\ttechnical\tdebt\tisn’t\tjust\tsomething\twe\tcause\tby\ttaking\tshortcuts.\tWhat\thappens if\tour\tvision\tfor\tthe\tsystem\tchanges,\tbut\tnot\tall\tof\tour\tsystem\tmatches?\tIn\tthis\tsituation, too,\twe\thave\tcreated\tnew\tsources\tof\ttechnical\tdebt.\n\nThe\tarchitect’s\tjob\tis\tto\tlook\tat\tthe\tbigger\tpicture,\tand\tunderstand\tthis\tbalance.\tHaving some\tview\tas\tto\tthe\tlevel\tof\tdebt,\tand\twhere\tto\tget\tinvolved,\tis\timportant.\tDepending\ton your\torganization,\tyou\tmight\tbe\table\tto\tprovide\tgentle\tguidance,\tbut\thave\tthe\tteams themselves\tdecide\thow\tto\ttrack\tand\tpay\tdown\tthe\tdebt.\tFor\tother\torganizations,\tyou\tmay need\tto\tbe\tmore\tstructured,\tperhaps\tmaintaining\ta\tdebt\tlog\tthat\tis\treviewed\tregularly.",
      "content_length": 1275,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 57,
      "content": "Exception\tHandling\n\nSo\tour\tprinciples\tand\tpractices\tguide\thow\tour\tsystems\tshould\tbe\tbuilt.\tBut\twhat\thappens when\tour\tsystem\tdeviates\tfrom\tthis?\tSometimes\twe\tmake\ta\tdecision\tthat\tis\tjust\tan exception\tto\tthe\trule.\tIn\tthese\tcases,\tit\tmight\tbe\tworth\tcapturing\tsuch\ta\tdecision\tin\ta\tlog somewhere\tfor\tfuture\treference.\tIf\tenough\texceptions\tare\tfound,\tit\tmay\teventually\tmake sense\tto\tchange\tthe\tprinciple\tor\tpractice\tto\treflect\ta\tnew\tunderstanding\tof\tthe\tworld.\tFor example,\twe\tmight\thave\ta\tpractice\tthat\tstates\tthat\twe\twill\talways\tuse\tMySQL\tfor\tdata storage.\tBut\tthen\twe\tsee\tcompelling\treasons\tto\tuse\tCassandra\tfor\thighly\tscalable\tstorage, at\twhich\tpoint\twe\tchange\tour\tpractice\tto\tsay,\t“Use\tMySQL\tfor\tmost\tstorage\trequirements, unless\tyou\texpect\tlarge\tgrowth\tin\tvolumes,\tin\twhich\tcase\tuse\tCassandra.”\n\nIt’s\tprobably\tworth\treiterating,\tthough,\tthat\tevery\torganization\tis\tdifferent.\tI’ve\tworked with\tsome\tcompanies\twhere\tthe\tdevelopment\tteams\thave\ta\thigh\tdegree\tof\ttrust\tand autonomy,\tand\tthere\tthe\tprinciples\tare\tlightweight\t(and\tthe\tneed\tfor\tovert\texception handling\tis\tgreatly\treduced\tif\tnot\teliminated).\tIn\tmore\tstructured\torganizations\tin\twhich developers\thave\tless\tfreedom,\ttracking\texceptions\tmay\tbe\tvital\tto\tensure\tthat\tthe\trules\tput in\tplace\tproperly\treflect\tthe\tchallenges\tpeople\tare\tfacing.\tWith\tall\tthat\tsaid,\tI\tam\ta\tfan\tof microservices\tas\ta\tway\tof\toptimizing\tfor\tautonomy\tof\tteams,\tgiving\tthem\tas\tmuch freedom\tas\tpossible\tto\tsolve\tthe\tproblem\tat\thand.\tIf\tyou\tare\tworking\tin\tan\torganization that\tplaces\tlots\tof\trestrictions\ton\thow\tdevelopers\tcan\tdo\ttheir\twork,\tthen\tmicroservices may\tnot\tbe\tfor\tyou.",
      "content_length": 1604,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 58,
      "content": "Governance\tand\tLeading\tfrom\tthe\tCenter\n\nPart\tof\twhat\tarchitects\tneed\tto\thandle\tis\tgovernance.\tWhat\tdo\tI\tmean\tby\tgovernance?\tIt turns\tout\tthe\tControl\tObjectives\tfor\tInformation\tand\tRelated\tTechnology\t(COBIT)\thas\ta pretty\tgood\tdefinition:\n\nGovernance\tensures\tthat\tenterprise\tobjectives\tare\tachieved\tby\tevaluating\tstakeholder needs,\tconditions\tand\toptions;\tsetting\tdirection\tthrough\tprioritisation\tand\tdecision making;\tand\tmonitoring\tperformance,\tcompliance\tand\tprogress\tagainst\tagreed-on direction\tand\tobjectives.\n\nCOBIT\t5\n\nGovernance\tcan\tapply\tto\tmultiple\tthings\tin\tthe\tforum\tof\tIT.\tWe\twant\tto\tfocus\ton\tthe aspect\tof\ttechnical\tgovernance,\tsomething\tI\tfeel\tis\tthe\tjob\tof\tthe\tarchitect.\tIf\tone\tof\tthe architect’s\tjobs\tis\tensuring\tthere\tis\ta\ttechnical\tvision,\tthen\tgovernance\tis\tabout\tensuring what\twe\tare\tbuilding\tmatches\tthis\tvision,\tand\tevolving\tthe\tvision\tif\tneeded.\n\nArchitects\tare\tresponsible\tfor\ta\tlot\tof\tthings.\tThey\tneed\tto\tensure\tthere\tis\ta\tset\tof principles\tthat\tcan\tguide\tdevelopment,\tand\tthat\tthese\tprinciples\tmatch\tthe\torganization’s strategy.\tThey\tneed\tto\tmake\tsure\tas\twell\tthat\tthese\tprinciples\tdon’t\trequire\tworking practices\tthat\tmake\tdevelopers\tmiserable.\tThey\tneed\tto\tkeep\tup\tto\tdate\twith\tnew technology,\tand\tknow\twhen\tto\tmake\tthe\tright\ttrade-offs.\tThis\tis\tan\tawful\tlot\tof responsibility.\tAll\tthat,\tand\tthey\talso\tneed\tto\tcarry\tpeople\twith\tthem\t—\tthat\tis,\tto\tensure that\tthe\tcolleagues\tthey\tare\tworking\twith\tunderstand\tthe\tdecisions\tbeing\tmade\tand\tare brought\tin\tto\tcarry\tthem\tout.\tOh,\tand\tas\twe’ve\talready\tmentioned:\tthey\tneed\tto\tspend some\ttime\twith\tthe\tteams\tto\tunderstand\tthe\timpact\tof\ttheir\tdecisions,\tand\tperhaps\teven code\ttoo.\n\nA\ttall\torder?\tAbsolutely.\tBut\tI\tam\tfirmly\tof\tthe\topinion\tthat\tthey\tshouldn’t\tdo\tthis\talone. A\tproperly\tfunctioning\tgovernance\tgroup\tcan\twork\ttogether\tto\tshare\tthe\twork\tand\tshape the\tvision.\n\nNormally,\tgovernance\tis\ta\tgroup\tactivity.\tIt\tcould\tbe\tan\tinformal\tchat\twith\ta\tsmall\tenough team,\tor\ta\tmore\tstructured\tregular\tmeeting\twith\tformal\tgroup\tmembership\tfor\ta\tlarger scope.\tThis\tis\twhere\tI\tthink\tthe\tprinciples\twe\tcovered\tearlier\tshould\tbe\tdiscussed\tand changed\tas\trequired.\tThis\tgroup\tneeds\tto\tbe\tled\tby\ta\ttechnologist,\tand\tto\tconsist predominantly\tof\tpeople\twho\tare\texecuting\tthe\twork\tbeing\tgoverned.\tThis\tgroup\tshould also\tbe\tresponsible\tfor\ttracking\tand\tmanaging\ttechnical\trisks.\n\nA\tmodel\tI\tgreatly\tfavor\tis\thaving\tthe\tarchitect\tchair\tthe\tgroup,\tbut\thaving\tthe\tbulk\tof\tthe group\tdrawn\tfrom\tthe\ttechnologists\tof\teach\tdelivery\tteam\t—\tthe\tleads\tof\teach\tteam\tat\ta minimum.\tThe\tarchitect\tis\tresponsible\tfor\tmaking\tsure\tthe\tgroup\tworks,\tbut\tthe\tgroup\tas\ta whole\tis\tresponsible\tfor\tgovernance.\tThis\tshares\tthe\tload,\tand\tensures\tthat\tthere\tis\ta higher\tlevel\tof\tbuy-in.\tIt\talso\tensures\tthat\tinformation\tflows\tfreely\tfrom\tthe\tteams\tinto\tthe group,\tand\tas\ta\tresult,\tthe\tdecision\tmaking\tis\tmuch\tmore\tsensible\tand\tinformed.",
      "content_length": 2864,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 59,
      "content": "Sometimes,\tthe\tgroup\tmay\tmake\tdecisions\twith\twhich\tthe\tarchitect\tdisagrees.\tAt\tthis point,\twhat\tis\tthe\tarchitect\tto\tdo?\tHaving\tbeen\tin\tthis\tposition\tbefore,\tI\tcan\ttell\tyou\tthis\tis one\tof\tthe\tmost\tchallenging\tsituations\tto\tface.\tOften,\tI\ttake\tthe\tapproach\tthat\tI\tshould\tgo with\tthe\tgroup\tdecision.\tI\ttake\tthe\tview\tthat\tI’ve\tdone\tmy\tbest\tto\tconvince\tpeople,\tbut ultimately\tI\twasn’t\tconvincing\tenough.\tThe\tgroup\tis\toften\tmuch\twiser\tthan\tthe\tindividual, and\tI’ve\tbeen\tproven\twrong\tmore\tthan\tonce!\tAnd\timagine\thow\tdisempowering\tit\tcan\tbe for\ta\tgroup\tto\thave\tbeen\tgiven\tspace\tto\tcome\tup\twith\ta\tdecision,\tand\tthen\tultimately\tbe ignored.\tBut\tsometimes\tI\thave\toverruled\tthe\tgroup.\tBut\twhy,\tand\twhen?\tHow\tdo\tyou\tpick the\tlines?\n\nThink\tabout\tteaching\tchildren\tto\tride\ta\tbike.\tYou\tcan’t\tride\tit\tfor\tthem.\tYou\twatch\tthem wobble,\tbut\tif\tyou\tstepped\tin\tevery\ttime\tit\tlooked\tlike\tthey\tmight\tfall\toff,\tthen\tthey’d never\tlearn,\tand\tin\tany\tcase\tthey\tfall\toff\tfar\tless\tthan\tyou\tthink\tthey\twill!\tBut\tif\tyou\tsee them\tabout\tto\tveer\tinto\ttraffic,\tor\tinto\ta\tnearby\tduck\tpond,\tthen\tyou\thave\tto\tstep\tin. Likewise,\tas\tan\tarchitect,\tyou\tneed\tto\thave\ta\tfirm\tgrasp\tof\twhen,\tfiguratively,\tyour\tteam\tis steering\tinto\ta\tduck\tpond.\tYou\talso\tneed\tto\tbe\taware\tthat\teven\tif\tyou\tknow\tyou\tare\tright and\toverrule\tthe\tteam,\tthis\tcan\tundermine\tyour\tposition\tand\talso\tmake\tthe\tteam\tfeel\tthat they\tdon’t\thave\ta\tsay.\tSometimes\tthe\tright\tthing\tis\tto\tgo\talong\twith\ta\tdecision\tyou\tdon’t agree\twith.\tKnowing\twhen\tto\tdo\tthis\tand\twhen\tnot\tto\tis\ttough,\tbut\tis\tsometimes\tvital.",
      "content_length": 1523,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 60,
      "content": "Building\ta\tTeam\n\nBeing\tthe\tmain\tpoint\tperson\tresponsible\tfor\tthe\ttechnical\tvision\tof\tyour\tsystem\tand ensuring\tthat\tyou’re\texecuting\ton\tthis\tvision\tisn’t\tjust\tabout\tmaking\ttechnology\tdecisions. It’s\tthe\tpeople\tyou\twork\twith\twho\twill\tbe\tdoing\tthe\twork.\tMuch\tof\tthe\trole\tof\tthe technical\tleader\tis\tabout\thelping\tgrow\tthem\t—\tto\thelp\tthem\tunderstand\tthe\tvision themselves\t—\tand\talso\tensuring\tthat\tthey\tcan\tbe\tactive\tparticipants\tin\tshaping\tand implementing\tthe\tvision\ttoo.\n\nHelping\tthe\tpeople\taround\tyou\ton\ttheir\town\tcareer\tgrowth\tcan\ttake\tmany\tforms,\tmost\tof which\tare\toutside\tthe\tscope\tof\tthis\tbook.\tThere\tis\tone\taspect,\tthough,\twhere\ta microservice\tarchitecture\tis\tespecially\trelevant.\tWith\tlarger,\tmonolithic\tsystems,\tthere\tare fewer\topportunities\tfor\tpeople\tto\tstep\tup\tand\town\tsomething.\tWith\tmicroservices,\ton\tthe other\thand,\twe\thave\tmultiple\tautonomous\tcodebases\tthat\twill\thave\ttheir\town\tindependent lifecycles.\tHelping\tpeople\tstep\tup\tby\thaving\tthem\ttake\townership\tof\tindividual\tservices before\taccepting\tmore\tresponsibility\tcan\tbe\ta\tgreat\tway\tto\thelp\tthem\tachieve\ttheir\town career\tgoals,\tand\tat\tthe\tsame\ttime\tlightens\tthe\tload\ton\twhoever\tis\tin\tcharge!\n\nI\tam\ta\tstrong\tbeliever\tthat\tgreat\tsoftware\tcomes\tfrom\tgreat\tpeople.\tIf\tyou\tworry\tonly about\tthe\ttechnology\tside\tof\tthe\tequation,\tyou’re\tmissing\tway\tmore\tthan\thalf\tof\tthe picture.",
      "content_length": 1334,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 61,
      "content": "Summary\n\nTo\tsummarize\tthis\tchapter,\there\tare\twhat\tI\tsee\tas\tthe\tcore\tresponsibilities\tof\tthe evolutionary\tarchitect:\n\nVision\n\nEnsure\tthere\tis\ta\tclearly\tcommunicated\ttechnical\tvision\tfor\tthe\tsystem\tthat\twill\thelp your\tsystem\tmeet\tthe\trequirements\tof\tyour\tcustomers\tand\torganization\n\nEmpathy\n\nUnderstand\tthe\timpact\tof\tyour\tdecisions\ton\tyour\tcustomers\tand\tcolleagues\n\nCollaboration\n\nEngage\twith\tas\tmany\tof\tyour\tpeers\tand\tcolleagues\tas\tpossible\tto\thelp\tdefine,\trefine, and\texecute\tthe\tvision\n\nAdaptability\n\nMake\tsure\tthat\tthe\ttechnical\tvision\tchanges\tas\tyour\tcustomers\tor\torganization requires\tit\n\nAutonomy\n\nFind\tthe\tright\tbalance\tbetween\tstandardizing\tand\tenabling\tautonomy\tfor\tyour\tteams\n\nGovernance\n\nEnsure\tthat\tthe\tsystem\tbeing\timplemented\tfits\tthe\ttechnical\tvision\n\nThe\tevolutionary\tarchitect\tis\tone\twho\tunderstands\tthat\tpulling\toff\tthis\tfeat\tis\ta\tconstant balancing\tact.\tForces\tare\talways\tpushing\tyou\tone\tway\tor\tanother,\tand\tunderstanding where\tto\tpush\tback\tor\twhere\tto\tgo\twith\tthe\tflow\tis\toften\tsomething\tthat\tcomes\tonly\twith experience.\tBut\tthe\tworst\treaction\tto\tall\tthese\tforces\tthat\tpush\tus\ttoward\tchange\tis\tto become\tmore\trigid\tor\tfixed\tin\tour\tthinking.\n\nWhile\tmuch\tof\tthe\tadvice\tin\tthis\tchapter\tcan\tapply\tto\tany\tsystems\tarchitect,\tmicroservices give\tus\tmany\tmore\tdecisions\tto\tmake.\tTherefore,\tbeing\tbetter\table\tto\tbalance\tall\tof\tthese trade-offs\tis\tessential.\n\nIn\tthe\tnext\tchapter,\twe’ll\ttake\tsome\tof\tour\tnewfound\tawareness\tof\tthe\tarchitect’s\trole\twith us\tas\twe\tstart\tthinking\tabout\thow\tto\tfind\tthe\tright\tboundaries\tfor\tour\tmicroservices.",
      "content_length": 1545,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 62,
      "content": "Chapter\t3.\tHow\tto\tModel\tServices\n\nMy\topponent’s\treasoning\treminds\tme\tof\tthe\theathen,\twho,\tbeing\tasked\ton\twhat\tthe world\tstood,\treplied,\t“On\ta\ttortoise.”\tBut\ton\twhat\tdoes\tthe\ttortoise\tstand?\t“On another\ttortoise.”\n\nJoseph\tBarker\t(1854)\n\nSo\tyou\tknow\twhat\tmicroservices\tare,\tand\thopefully\thave\ta\tsense\tof\ttheir\tkey\tbenefits. You’re\tprobably\teager\tnow\tto\tgo\tand\tstart\tmaking\tthem,\tright?\tBut\twhere\tto\tstart?\tIn\tthis chapter,\twe’ll\tlook\tat\thow\tto\tthink\tabout\tthe\tboundaries\tof\tyour\tmicroservices\tthat\twill hopefully\tmaximize\tthe\tupsides\tand\tavoid\tsome\tof\tthe\tpotential\tdownsides.\tBut\tfirst,\twe need\tsomething\tto\twork\twith.",
      "content_length": 617,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 63,
      "content": "Introducing\tMusicCorp\n\nBooks\tabout\tideas\twork\tbetter\twith\texamples.\tWhere\tpossible,\tI’ll\tbe\tsharing\tstories\tfrom real-world\tsituations,\tbut\tI’ve\tfound\tit’s\talso\tuseful\tto\thave\ta\tfictional\tdomain\twith\twhich to\twork.\tThroughout\tthe\tbook,\twe’ll\tbe\treturning\tto\tthis\tdomain,\tseeing\thow\tthe\tconcept of\tmicroservices\tworks\twithin\tthis\tworld.\n\nSo\tlet’s\tturn\tour\tattention\tto\tthe\tcutting-edge\tonline\tretailer\tMusicCorp.\tMusicCorp\twas recently\ta\tbrick-and-mortar\tretailer,\tbut\tafter\tthe\tbottom\tdropped\tout\tof\tthe\tgramophone record\tbusiness\tit\tfocused\tmore\tand\tmore\tof\tits\tefforts\tonline.\tThe\tcompany\thas\ta\twebsite, but\tfeels\tthat\tnow\tis\tthe\ttime\tto\tdouble-down\ton\tthe\tonline\tworld.\tAfter\tall,\tthose\tiPods are\tjust\ta\tpassing\tfad\t(Zunes\tare\tway\tbetter,\tobviously)\tand\tmusic\tfans\tare\tquite\thappy\tto wait\tfor\tCDs\tto\tarrive\tat\ttheir\tdoorsteps.\tQuality\tover\tconvenience,\tright?\tAnd\twhile we’re\tat\tit,\twhat’s\tthis\tSpotify\tthing\tpeople\tkeep\ttalking\tabout\t—\tsome\tsort\tof\tskin treatment\tfor\tteenagers?\n\nDespite\tbeing\ta\tlittle\tbehind\tthe\tcurve,\tMusicCorp\thas\tgrand\tambitions.\tLuckily,\tit\thas decided\tthat\tits\tbest\tchance\tof\ttaking\tover\tthe\tworld\tis\tby\tmaking\tsure\tit\tcan\tmake changes\tas\teasily\tas\tpossible.\tMicroservices\tfor\tthe\twin!",
      "content_length": 1213,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 64,
      "content": "What\tMakes\ta\tGood\tService?\n\nBefore\tthe\tteam\tfrom\tMusicCorp\ttears\toff\tinto\tthe\tdistance,\tcreating\tservice\tafter\tservice in\tan\tattempt\tto\tdeliver\teight-track\ttapes\tto\tall\tand\tsundry,\tlet’s\tput\tthe\tbrakes\ton\tand\ttalk a\tbit\tabout\tthe\tmost\timportant\tunderlying\tidea\twe\tneed\tto\tkeep\tin\tmind.\tWhat\tmakes\ta good\tservice?\tIf\tyou’ve\tsurvived\ta\tfailed\tSOA\timplementation,\tyou\tmay\thave\tsome\tidea where\tI’m\tgoing\tnext.\tBut\tjust\tin\tcase\tyou\taren’t\tthat\t(un)fortunate,\tI\twant\tyou\tto\tfocus\ton two\tkey\tconcepts:\tloose\tcoupling\tand\thigh\tcohesion.\tWe’ll\ttalk\tin\tdetail\tthroughout\tthe book\tabout\tother\tideas\tand\tpractices,\tbut\tthey\tare\tall\tfor\tnaught\tif\twe\tget\tthese\ttwo\tthing wrong.\n\nDespite\tthe\tfact\tthat\tthese\ttwo\tterms\tare\tused\ta\tlot,\tespecially\tin\tthe\tcontext\tof\tobject- oriented\tsystems,\tit\tis\tworth\tdiscussing\twhat\tthey\tmean\tin\tterms\tof\tmicroservices.",
      "content_length": 838,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 65,
      "content": "Loose\tCoupling\n\nWhen\tservices\tare\tloosely\tcoupled,\ta\tchange\tto\tone\tservice\tshould\tnot\trequire\ta\tchange\tto another.\tThe\twhole\tpoint\tof\ta\tmicroservice\tis\tbeing\table\tto\tmake\ta\tchange\tto\tone\tservice and\tdeploy\tit,\twithout\tneeding\tto\tchange\tany\tother\tpart\tof\tthe\tsystem.\tThis\tis\treally\tquite important.\n\nWhat\tsort\tof\tthings\tcause\ttight\tcoupling?\tA\tclassic\tmistake\tis\tto\tpick\tan\tintegration\tstyle that\ttightly\tbinds\tone\tservice\tto\tanother,\tcausing\tchanges\tinside\tthe\tservice\tto\trequire\ta change\tto\tconsumers.\tWe’ll\tdiscuss\thow\tto\tavoid\tthis\tin\tmore\tdepth\tin\tChapter\t4.\n\nA\tloosely\tcoupled\tservice\tknows\tas\tlittle\tas\tit\tneeds\tto\tabout\tthe\tservices\twith\twhich\tit collaborates.\tThis\talso\tmeans\twe\tprobably\twant\tto\tlimit\tthe\tnumber\tof\tdifferent\ttypes\tof calls\tfrom\tone\tservice\tto\tanother,\tbecause\tbeyond\tthe\tpotential\tperformance\tproblem, chatty\tcommunication\tcan\tlead\tto\ttight\tcoupling.",
      "content_length": 876,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 66,
      "content": "High\tCohesion\n\nWe\twant\trelated\tbehavior\tto\tsit\ttogether,\tand\tunrelated\tbehavior\tto\tsit\telsewhere.\tWhy? Well,\tif\twe\twant\tto\tchange\tbehavior,\twe\twant\tto\tbe\table\tto\tchange\tit\tin\tone\tplace,\tand release\tthat\tchange\tas\tsoon\tas\tpossible.\tIf\twe\thave\tto\tchange\tthat\tbehavior\tin\tlots\tof different\tplaces,\twe’ll\thave\tto\trelease\tlots\tof\tdifferent\tservices\t(perhaps\tat\tthe\tsame\ttime) to\tdeliver\tthat\tchange.\tMaking\tchanges\tin\tlots\tof\tdifferent\tplaces\tis\tslower,\tand\tdeploying lots\tof\tservices\tat\tonce\tis\trisky\t—\tboth\tof\twhich\twe\twant\tto\tavoid.\n\nSo\twe\twant\tto\tfind\tboundaries\twithin\tour\tproblem\tdomain\tthat\thelp\tensure\tthat\trelated behavior\tis\tin\tone\tplace,\tand\tthat\tcommunicate\twith\tother\tboundaries\tas\tloosely\tas possible.",
      "content_length": 710,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 67,
      "content": "The\tBounded\tContext\n\nEric\tEvans’s\tbook\tDomain-Driven\tDesign\t(Addison-Wesley)\tfocuses\ton\thow\tto\tcreate systems\tthat\tmodel\treal-world\tdomains.\tThe\tbook\tis\tfull\tof\tgreat\tideas\tlike\tusing ubiquitous\tlanguage,\trepository\tabstractions,\tand\tthe\tlike,\tbut\tthere\tis\tone\tvery\timportant concept\tEvans\tintroduces\tthat\tcompletely\tpassed\tme\tby\tat\tfirst:\tbounded\tcontext.\tThe\tidea is\tthat\tany\tgiven\tdomain\tconsists\tof\tmultiple\tbounded\tcontexts,\tand\tresiding\twithin\teach are\tthings\t(Eric\tuses\tthe\tword\tmodel\ta\tlot,\twhich\tis\tprobably\tbetter\tthan\tthings)\tthat\tdo\tnot need\tto\tbe\tcommunicated\toutside\tas\twell\tas\tthings\tthat\tare\tshared\texternally\twith\tother bounded\tcontexts.\tEach\tbounded\tcontext\thas\tan\texplicit\tinterface,\twhere\tit\tdecides\twhat models\tto\tshare\twith\tother\tcontexts.\n\nAnother\tdefinition\tof\tbounded\tcontexts\tI\tlike\tis\t“a\tspecific\tresponsibility\tenforced\tby explicit\tboundaries.”1\tIf\tyou\twant\tinformation\tfrom\ta\tbounded\tcontext,\tor\twant\tto\tmake requests\tof\tfunctionality\twithin\ta\tbounded\tcontext,\tyou\tcommunicate\twith\tits\texplicit boundary\tusing\tmodels.\tIn\this\tbook,\tEvans\tuses\tthe\tanalogy\tof\tcells,\twhere\t“[c]ells\tcan exist\tbecause\ttheir\tmembranes\tdefine\twhat\tis\tin\tand\tout\tand\tdetermine\twhat\tcan\tpass.”\n\nLet’s\treturn\tfor\ta\tmoment\tto\tthe\tMusicCorp\tbusiness.\tOur\tdomain\tis\tthe\twhole\tbusiness\tin which\twe\tare\toperating.\tIt\tcovers\teverything\tfrom\tthe\twarehouse\tto\tthe\treception\tdesk, from\tfinance\tto\tordering.\tWe\tmay\tor\tmay\tnot\tmodel\tall\tof\tthat\tin\tour\tsoftware,\tbut\tthat\tis nonetheless\tthe\tdomain\tin\twhich\twe\tare\toperating.\tLet’s\tthink\tabout\tparts\tof\tthat\tdomain that\tlook\tlike\tthe\tbounded\tcontexts\tthat\tEvans\trefers\tto.\tAt\tMusicCorp,\tour\twarehouse\tis\ta hive\tof\tactivity\t—\tmanaging\torders\tbeing\tshipped\tout\t(and\tthe\todd\treturn),\ttaking\tdelivery of\tnew\tstock,\thaving\tforklift\ttruck\traces,\tand\tso\ton.\tElsewhere,\tthe\tfinance\tdepartment\tis perhaps\tless\tfun-loving,\tbut\tstill\thas\ta\tvery\timportant\tfunction\tinside\tour\torganization. These\temployees\tmanage\tpayroll,\tkeep\tthe\tcompany\taccounts,\tand\tproduce\timportant reports.\tLots\tof\treports.\tThey\tprobably\talso\thave\tinteresting\tdesk\ttoys.",
      "content_length": 2071,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 68,
      "content": "Shared\tand\tHidden\tModels\n\nFor\tMusicCorp,\twe\tcan\tthen\tconsider\tthe\tfinance\tdepartment\tand\tthe\twarehouse\tto\tbe\ttwo separate\tbounded\tcontexts.\tThey\tboth\thave\tan\texplicit\tinterface\tto\tthe\toutside\tworld\t(in terms\tof\tinventory\treports,\tpay\tslips,\tetc.),\tand\tthey\thave\tdetails\tthat\tonly\tthey\tneed\tto know\tabout\t(forklift\ttrucks,\tcalculators).\n\nNow\tthe\tfinance\tdepartment\tdoesn’t\tneed\tto\tknow\tabout\tthe\tdetailed\tinner\tworkings\tof\tthe warehouse.\tIt\tdoes\tneed\tto\tknow\tsome\tthings,\tthough\t—\tfor\texample\tit\tneeds\tto\tknow about\tstock\tlevels\tto\tkeep\tthe\taccounts\tup\tto\tdate.\tFigure\t3-1\tshows\tan\texample\tcontext diagram.\tWe\tsee\tconcepts\tthat\tare\tinternal\tto\tthe\twarehouse,\tlike\tPicker\t(people\twho\tpick orders),\tshelves\tthat\trepresent\tstock\tlocations,\tand\tso\ton.\tLikewise,\tthe\tcompany’s\tgeneral ledger\tis\tintegral\tto\tfinance\tbut\tis\tnot\tshared\texternally\there.\n\nFigure\t3-1.\tA\tshared\tmodel\tbetween\tthe\tfinance\tdepartment\tand\tthe\twarehouse\n\nTo\tbe\table\tto\twork\tout\tthe\tvaluation\tof\tthe\tcompany,\tthough,\tthe\tfinance\temployees\tneed information\tabout\tthe\tstock\twe\thold.\tThe\tstock\titem\tthen\tbecomes\ta\tshared\tmodel between\tthe\ttwo\tcontexts.\tHowever,\tnote\tthat\twe\tdon’t\tneed\tto\tblindly\texpose\teverything about\tthe\tstock\titem\tfrom\tthe\twarehouse\tcontext.\tFor\texample,\talthough\tinternally\twe keep\ta\trecord\ton\ta\tstock\titem\tas\tto\twhere\tit\tshould\tlive\twithin\tthe\twarehouse,\tthat\tdoesn’t need\tto\tbe\texposed\tin\tthe\tshared\tmodel.\tSo\tthere\tis\tthe\tinternal-only\trepresentation,\tand the\texternal\trepresentation\twe\texpose.\tIn\tmany\tways,\tthis\tforeshadows\tthe\tdiscussion around\tREST\tin\tChapter\t4.\n\nSometimes\twe\tmay\tencounter\tmodels\twith\tthe\tsame\tname\tthat\thave\tvery\tdifferent meanings\tin\tdifferent\tcontexts\ttoo.\tFor\texample,\twe\tmight\thave\tthe\tconcept\tof\ta\treturn, which\trepresents\ta\tcustomer\tsending\tsomething\tback.\tWithin\tthe\tcontext\tof\tthe\tcustomer, a\treturn\tis\tall\tabout\tprinting\ta\tshipping\tlabel,\tdispatching\ta\tpackage,\tand\twaiting\tfor\ta refund.\tFor\tthe\twarehouse,\tthis\tcould\trepresent\ta\tpackage\tthat\tis\tabout\tto\tarrive,\tand\ta stock\titem\tthat\tneeds\tto\tbe\trestocked.\tIt\tfollows\tthat\twithin\tthe\twarehouse\twe\tstore additional\tinformation\tassociated\twith\tthe\treturn\tthat\trelates\tto\tthe\ttasks\tto\tbe\tcarried\tout;",
      "content_length": 2169,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 69,
      "content": "for\texample,\twe\tmay\tgenerate\ta\trestock\trequest.\tThe\tshared\tmodel\tof\tthe\treturn\tbecomes associated\twith\tdifferent\tprocesses\tand\tsupporting\tentities\twithin\teach\tbounded\tcontext, but\tthat\tis\tvery\tmuch\tan\tinternal\tconcern\twithin\tthe\tcontext\titself.",
      "content_length": 244,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 70,
      "content": "Modules\tand\tServices\n\nBy\tthinking\tclearly\tabout\twhat\tmodels\tshould\tbe\tshared,\tand\tnot\tsharing\tour\tinternal representations,\twe\tavoid\tone\tof\tthe\tpotential\tpitfalls\tthat\tcan\tresult\tin\ttight\tcoupling\t(the opposite\tof\twhat\twe\twant).\tWe\thave\talso\tidentified\ta\tboundary\twithin\tour\tdomain\twhere all\tlike-minded\tbusiness\tcapabilities\tshould\tlive,\tgiving\tus\tthe\thigh\tcohesion\twe\twant. These\tbounded\tcontexts,\tthen,\tlend\tthemselves\textremely\twell\tto\tbeing\tcompositional boundaries.\n\nAs\twe\tdiscussed\tin\tChapter\t1,\twe\thave\tthe\toption\tof\tusing\tmodules\twithin\ta\tprocess boundary\tto\tkeep\trelated\tcode\ttogether\tand\tattempt\tto\treduce\tthe\tcoupling\tto\tother modules\tin\tthe\tsystem.\tWhen\tyou’re\tstarting\tout\ton\ta\tnew\tcodebase,\tthis\tis\tprobably\ta good\tplace\tto\tbegin.\tSo\tonce\tyou\thave\tfound\tyour\tbounded\tcontexts\tin\tyour\tdomain, make\tsure\tthey\tare\tmodeled\twithin\tyour\tcodebase\tas\tmodules,\twith\tshared\tand\thidden models.\n\nThese\tmodular\tboundaries\tthen\tbecome\texcellent\tcandidates\tfor\tmicroservices.\tIn\tgeneral, microservices\tshould\tcleanly\talign\tto\tbounded\tcontexts.\tOnce\tyou\tbecome\tvery\tproficient, you\tmay\tdecide\tto\tskip\tthe\tstep\tof\tkeeping\tthe\tbounded\tcontext\tmodeled\tas\ta\tmodule within\ta\tmore\tmonolithic\tsystem,\tand\tjump\tstraight\tfor\ta\tseparate\tservice.\tWhen\tstarting out,\thowever,\tkeep\ta\tnew\tsystem\ton\tthe\tmore\tmonolithic\tside;\tgetting\tservice\tboundaries wrong\tcan\tbe\tcostly,\tso\twaiting\tfor\tthings\tto\tstabilize\tas\tyou\tget\tto\tgrips\twith\ta\tnew domain\tis\tsensible.\tWe’ll\tdiscuss\tthis\tmore\tin\tChapter\t5,\talong\twith\ttechniques\tto\thelp break\tapart\texisting\tsystems\tinto\tmicroservices.\n\nSo,\tif\tour\tservice\tboundaries\talign\tto\tthe\tbounded\tcontexts\tin\tour\tdomain,\tand\tour microservices\trepresent\tthose\tbounded\tcontexts,\twe\tare\toff\tto\tan\texcellent\tstart\tin ensuring\tthat\tour\tmicroservices\tare\tloosely\tcoupled\tand\tstrongly\tcohesive.",
      "content_length": 1803,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 71,
      "content": "Premature\tDecomposition\n\nAt\tThoughtWorks,\twe\tourselves\texperienced\tthe\tchallenges\tof\tsplitting\tout\tmicroservices too\tquickly.\tAside\tfrom\tconsulting,\twe\talso\tcreate\ta\tfew\tproducts.\tOne\tof\tthem\tis\tSnapCI, a\thosted\tcontinuous\tintegration\tand\tcontinuous\tdelivery\ttool\t(we’ll\tdiscuss\tthose\tconcepts later\tin\tChapter\t6).\tThe\tteam\thad\tpreviously\tworked\ton\tanother\tsimilar\ttool,\tGo-CD,\ta now\topen\tsource\tcontinuous\tdelivery\ttool\tthat\tcan\tbe\tdeployed\tlocally\trather\tthan\tbeing hosted\tin\tthe\tcloud.\n\nAlthough\tthere\twas\tsome\tcode\treuse\tvery\tearly\ton\tbetween\tthe\tSnapCI\tand\tGo-CD projects,\tin\tthe\tend\tSnapCI\tturned\tout\tto\tbe\ta\tcompletely\tnew\tcodebase.\tNonetheless,\tthe previous\texperience\tof\tthe\tteam\tin\tthe\tdomain\tof\tCD\ttooling\temboldened\tthem\tto\tmove more\tquickly\tin\tidentifying\tboundaries,\tand\tbuilding\ttheir\tsystem\tas\ta\tset\tof microservices.\n\nAfter\ta\tfew\tmonths,\tthough,\tit\tbecame\tclear\tthat\tthe\tuse\tcases\tof\tSnapCI\twere\tsubtly different\tenough\tthat\tthe\tinitial\ttake\ton\tthe\tservice\tboundaries\twasn’t\tquite\tright.\tThis\tled to\tlots\tof\tchanges\tbeing\tmade\tacross\tservices,\tand\tan\tassociated\thigh\tcost\tof\tchange. Eventually\tthe\tteam\tmerged\tthe\tservices\tback\tinto\tone\tmonolithic\tsystem,\tgiving\tthem time\tto\tbetter\tunderstand\twhere\tthe\tboundaries\tshould\texist.\tA\tyear\tlater,\tthe\tteam\twas then\table\tto\tsplit\tthe\tmonolithic\tsystem\tapart\tinto\tmicroservices,\twhose\tboundaries\tproved to\tbe\tmuch\tmore\tstable.\tThis\tis\tfar\tfrom\tthe\tonly\texample\tof\tthis\tsituation\tI\thave\tseen. Prematurely\tdecomposing\ta\tsystem\tinto\tmicroservices\tcan\tbe\tcostly,\tespecially\tif\tyou\tare new\tto\tthe\tdomain.\tIn\tmany\tways,\thaving\tan\texisting\tcodebase\tyou\twant\tto\tdecompose into\tmicroservices\tis\tmuch\teasier\tthan\ttrying\tto\tgo\tto\tmicroservices\tfrom\tthe\tbeginning.",
      "content_length": 1713,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 72,
      "content": "Business\tCapabilities\n\nWhen\tyou\tstart\tto\tthink\tabout\tthe\tbounded\tcontexts\tthat\texist\tin\tyour\torganization,\tyou should\tbe\tthinking\tnot\tin\tterms\tof\tdata\tthat\tis\tshared,\tbut\tabout\tthe\tcapabilities\tthose contexts\tprovide\tthe\trest\tof\tthe\tdomain.\tThe\twarehouse\tmay\tprovide\tthe\tcapability\tto\tget\ta current\tstock\tlist,\tfor\texample,\tor\tthe\tfinance\tcontext\tmay\twell\texpose\tthe\tend-of-month accounts\tor\tlet\tyou\tset\tup\tpayroll\tfor\ta\tnew\trecruit.\tThese\tcapabilities\tmay\trequire\tthe interchange\tof\tinformation\t—\tshared\tmodels\t—\tbut\tI\thave\tseen\ttoo\toften\tthat\tthinking about\tdata\tleads\tto\tanemic,\tCRUD-based\t(create,\tread,\tupdate,\tdelete)\tservices.\tSo\task first\t“What\tdoes\tthis\tcontext\tdo?”,\tand\tthen\t“So\twhat\tdata\tdoes\tit\tneed\tto\tdo\tthat?”\n\nWhen\tmodeled\tas\tservices,\tthese\tcapabilities\tbecome\tthe\tkey\toperations\tthat\twill\tbe exposed\tover\tthe\twire\tto\tother\tcollaborators.",
      "content_length": 856,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 73,
      "content": "Turtles\tAll\tthe\tWay\tDown\n\nAt\tthe\tstart,\tyou\twill\tprobably\tidentify\ta\tnumber\tof\tcoarse-grained\tbounded\tcontexts.\tBut these\tbounded\tcontexts\tcan\tin\tturn\tcontain\tfurther\tbounded\tcontexts.\tFor\texample,\tyou could\tdecompose\tthe\twarehouse\tinto\tcapabilities\tassociated\twith\torder\tfulfillment, inventory\tmanagement,\tor\tgoods\treceiving.\tWhen\tconsidering\tthe\tboundaries\tof\tyour microservices,\tfirst\tthink\tin\tterms\tof\tthe\tlarger,\tcoarser-grained\tcontexts,\tand\tthen subdivide\talong\tthese\tnested\tcontexts\twhen\tyou’re\tlooking\tfor\tthe\tbenefits\tof\tsplitting\tout these\tseams.\n\nI\thave\tseen\tthese\tnested\tcontexts\tremaining\thidden\tto\tother,\tcollaborating\tmicroservices to\tgreat\teffect.\tTo\tthe\toutside\tworld,\tthey\tare\tstill\tmaking\tuse\tof\tbusiness\tcapabilities\tin the\twarehouse,\tbut\tthey\tare\tunaware\tthat\ttheir\trequests\tare\tactually\tbeing\tmapped transparently\tto\ttwo\tor\tmore\tseparate\tservices,\tas\tyou\tcan\tsee\tin\tFigure\t3-2.\tSometimes, you\twill\tdecide\tit\tmakes\tmore\tsense\tfor\tthe\thigher-level\tbounded\tcontext\tto\tnot\tbe explicitly\tmodeled\tas\ta\tservice\tboundary,\tas\tin\tFigure\t3-3,\tso\trather\tthan\ta\tsingle warehouse\tboundary,\tyou\tmight\tinstead\tsplit\tout\tinventory,\torder\tfulfillment,\tand\tgoods receiving.\n\nFigure\t3-2.\tMicroservices\trepresenting\tnested\tbounded\tcontexts\thidden\tinside\tthe\twarehouse",
      "content_length": 1269,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 74,
      "content": "Figure\t3-3.\tThe\tbounded\tcontexts\tinside\tthe\twarehouse\tbeing\tpopped\tup\tinto\ttheir\town\ttop-level\tcontexts\n\nIn\tgeneral,\tthere\tisn’t\ta\thard-and-fast\trule\tas\tto\twhat\tapproach\tmakes\tthe\tmost\tsense. However,\twhether\tyou\tchoose\tthe\tnested\tapproach\tover\tthe\tfull\tseparation\tapproach should\tbe\tbased\ton\tyour\torganizational\tstructure.\tIf\torder\tfulfillment,\tinventory management,\tand\tgoods\treceiving\tare\tmanaged\tby\tdifferent\tteams,\tthey\tprobably\tdeserve their\tstatus\tas\ttop-level\tmicroservices.\tIf,\ton\tthe\tother\thand,\tall\tof\tthem\tare\tmanaged\tby one\tteam,\tthen\tthe\tnested\tmodel\tmakes\tmore\tsense.\tThis\tis\tbecause\tof\tthe\tinterplay\tof organizational\tstructures\tand\tsoftware\tarchitecture,\twhich\twe\twill\tdiscuss\ttoward\tthe\tend of\tthe\tbook\tin\tChapter\t10.\n\nAnother\treason\tto\tprefer\tthe\tnested\tapproach\tcould\tbe\tto\tchunk\tup\tyour\tarchitecture\tto simplify\ttesting.\tFor\texample,\twhen\ttesting\tservices\tthat\tconsume\tthe\twarehouse,\tI\tdon’t have\tto\tstub\teach\tservice\tinside\tthe\twarehouse\tcontext,\tjust\tthe\tmore\tcoarse-grained\tAPI. This\tcan\talso\tgive\tyou\ta\tunit\tof\tisolation\twhen\tconsidering\tlarger-scoped\ttests.\tI\tmay,\tfor example,\tdecide\tto\thave\tend-to-end\ttests\twhere\tI\tlaunch\tall\tservices\tinside\tthe\twarehouse context,\tbut\tfor\tall\tother\tcollaborators\tI\tmight\tstub\tthem\tout.\tWe’ll\texplore\tmore\tabout testing\tand\tisolation\tin\tChapter\t7.",
      "content_length": 1309,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 75,
      "content": "Communication\tin\tTerms\tof\tBusiness\tConcepts\n\nThe\tchanges\twe\timplement\tto\tour\tsystem\tare\toften\tabout\tchanges\tthe\tbusiness\twants\tto make\tto\thow\tthe\tsystem\tbehaves.\tWe\tare\tchanging\tfunctionality\t—\tcapabilities\t—\tthat\tare exposed\tto\tour\tcustomers.\tIf\tour\tsystems\tare\tdecomposed\talong\tthe\tbounded\tcontexts\tthat represent\tour\tdomain,\tthe\tchanges\twe\twant\tto\tmake\tare\tmore\tlikely\tto\tbe\tisolated\tto\tone, single\tmicroservice\tboundary.\tThis\treduces\tthe\tnumber\tof\tplaces\twe\tneed\tto\tmake\ta change,\tand\tallows\tus\tto\tdeploy\tthat\tchange\tquickly.\n\nIt’s\talso\timportant\tto\tthink\tof\tthe\tcommunication\tbetween\tthese\tmicroservices\tin\tterms\tof the\tsame\tbusiness\tconcepts.\tThe\tmodeling\tof\tyour\tsoftware\tafter\tyour\tbusiness\tdomain shouldn’t\tstop\tat\tthe\tidea\tof\tbounded\tcontexts.\tThe\tsame\tterms\tand\tideas\tthat\tare\tshared between\tparts\tof\tyour\torganization\tshould\tbe\treflected\tin\tyour\tinterfaces.\tIt\tcan\tbe\tuseful to\tthink\tof\tforms\tbeing\tsent\tbetween\tthese\tmicroservices,\tmuch\tas\tforms\tare\tsent\taround an\torganization.",
      "content_length": 991,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 76,
      "content": "The\tTechnical\tBoundary\n\nIt\tcan\tbe\tuseful\tto\tlook\tat\twhat\tcan\tgo\twrong\twhen\tservices\tare\tmodeled\tincorrectly.\tA while\tback,\ta\tfew\tcolleagues\tand\tI\twere\tworking\twith\ta\tclient\tin\tCalifornia,\thelping\tthe company\tadopt\tsome\tcleaner\tcode\tpractices\tand\tmove\tmore\ttoward\tautomated\ttesting. We’d\tstarted\twith\tsome\tof\tthe\tlow-hanging\tfruit,\tsuch\tas\tservice\tdecomposition,\twhen\twe noticed\tsomething\tmuch\tmore\tworrying.\tI\tcan’t\tgo\tinto\ttoo\tmuch\tdetail\tas\tto\twhat\tthe application\tdid,\tbut\tit\twas\ta\tpublic-facing\tapplication\twith\ta\tlarge,\tglobal\tcustomer\tbase.\n\nThe\tteam,\tand\tsystem,\thad\tgrown.\tOriginally\tone\tperson’s\tvision,\tthe\tsystem\thad\ttaken\ton more\tand\tmore\tfeatures,\tand\tmore\tand\tmore\tusers.\tEventually,\tthe\torganization\tdecided\tto increase\tthe\tcapacity\tof\tthe\tteam\tby\thaving\ta\tnew\tgroup\tof\tdevelopers\tbased\tin\tBrazil\ttake on\tsome\tof\tthe\twork.\tThe\tsystem\tgot\tsplit\tup,\twith\tthe\tfront\thalf\tof\tthe\tapplication\tbeing essentially\tstateless,\timplementing\tthe\tpublic-facing\twebsite,\tas\tshown\tin\tFigure\t3-4.\tThe back\thalf\tof\tthe\tsystem\twas\tsimply\ta\tremote\tprocedure\tcall\t(RPC)\tinterface\tover\ta\tdata store.\tEssentially,\timagine\tyou’d\ttaken\ta\trepository\tlayer\tin\tyour\tcodebase\tand\tmade\tthis\ta separate\tservice.",
      "content_length": 1195,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 77,
      "content": "Figure\t3-4.\tA\tservice\tboundary\tsplit\tacross\ta\ttechnical\tseam\n\nChanges\tfrequently\thad\tto\tbe\tmade\tto\tboth\tservices.\tBoth\tservices\tspoke\tin\tterms\tof\tlow- level,\tRPC-style\tmethod\tcalls,\twhich\twere\toverly\tbrittle\t(we’ll\tdiscuss\tthis\tfuther\tin Chapter\t4).\tThe\tservice\tinterface\twas\talso\tvery\tchatty\ttoo,\tresulting\tin\tperformance\tissues. This\tresulted\tin\tthe\tneed\tfor\telaborate\tRPC-batching\tmechanisms.\tI\tcalled\tthis\tonion architecture,\tas\tit\thad\tlots\tof\tlayers\tand\tmade\tme\tcry\twhen\twe\thad\tto\tcut\tthrough\tit.\n\nNow\ton\tthe\tface\tof\tit,\tthe\tidea\tof\tsplitting\tthe\tpreviously\tmonolithic\tsystem\talong geographical/organizational\tlines\tmakes\tperfect\tsense,\tas\twe’ll\texpand\ton\tin\tChapter\t10. Here,\thowever,\trather\tthan\ttaking\ta\tvertical,\tbusiness-focused\tslice\tthrough\tthe\tstack,\tthe team\tpicked\twhat\twas\tpreviously\tan\tin-process\tAPI\tand\tmade\ta\thorizontal\tslice.\n\nMaking\tdecisions\tto\tmodel\tservice\tboundaries\talong\ttechnical\tseams\tisn’t\talways\twrong.\tI have\tcertainly\tseen\tthis\tmake\tlots\tof\tsense\twhen\tan\torganization\tis\tlooking\tto\tachieve certain\tperformance\tobjectives,\tfor\texample.\tHowever,\tit\tshould\tbe\tyour\tsecondary\tdriver",
      "content_length": 1112,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 78,
      "content": "for\tfinding\tthese\tseams,\tnot\tyour\tprimary\tone.",
      "content_length": 46,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 79,
      "content": "Summary\n\nIn\tthis\tchapter,\tyou’ve\tlearned\ta\tbit\tabout\twhat\tmakes\ta\tgood\tservice,\tand\thow\tto\tfind seams\tin\tour\tproblem\tspace\tthat\tgive\tus\tthe\tdual\tbenefits\tof\tboth\tloose\tcoupling\tand\thigh cohesion.\tBounded\tcontexts\tare\ta\tvital\ttool\tin\thelping\tus\tfind\tthese\tseams,\tand\tby\taligning our\tmicroservices\tto\tthese\tboundaries\twe\tensure\tthat\tthe\tresulting\tsystem\thas\tevery chance\tof\tkeeping\tthose\tvirtues\tintact.\tWe’ve\talso\tgot\ta\thint\tabout\thow\twe\tcan\tsubdivide our\tmicroservices\tfurther,\tsomething\twe’ll\texplore\tin\tmore\tdepth\tlater.\tAnd\twe\talso introduced\tMusicCorp,\tthe\texample\tdomain\tthat\twe\twill\tuse\tthroughout\tthis\tbook.\n\nThe\tideas\tpresented\tin\tEric\tEvans’s\tDomain-Driven\tDesign\tare\tvery\tuseful\tto\tus\tin finding\tsensible\tboundaries\tfor\tour\tservices,\tand\tI’ve\tjust\tscratched\tthe\tsurface\there.\tI recommend\tVaughn\tVernon’s\tbook\tImplementing\tDomain-Driven\tDesign\t(Addison- Wesley)\tto\thelp\tyou\tunderstand\tthe\tpracticalities\tof\tthis\tapproach.\n\nAlthough\tthis\tchapter\thas\tbeen\tmostly\thigh-level,\twe\tneed\tto\tget\tmuch\tmore\ttechnical\tin the\tnext.\tThere\tare\tmany\tpitfalls\tassociated\twith\timplementing\tinterfaces\tbetween services\tthat\tcan\tlead\tto\tall\tsorts\tof\ttrouble,\tand\twe\twill\thave\tto\ttake\ta\tdeep\tdive\tinto\tthis topic\tif\twe\tare\tto\tkeep\tour\tsystems\tfrom\tbecoming\ta\tgiant,\ttangled\tmess.\n\n1\thttp://bit.ly/bounded-context-explained",
      "content_length": 1312,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 80,
      "content": "Chapter\t4.\tIntegration\n\nGetting\tintegration\tright\tis\tthe\tsingle\tmost\timportant\taspect\tof\tthe\ttechnology\tassociated with\tmicroservices\tin\tmy\topinion.\tDo\tit\twell,\tand\tyour\tmicroservices\tretain\ttheir autonomy,\tallowing\tyou\tto\tchange\tand\trelease\tthem\tindependent\tof\tthe\twhole.\tGet\tit wrong,\tand\tdisaster\tawaits.\tHopefully\tonce\tyou’ve\tread\tthis\tchapter\tyou’ll\tlearn\thow\tto avoid\tsome\tof\tthe\tbiggest\tpitfalls\tthat\thave\tplagued\tother\tattempts\tat\tSOA\tand\tcould\tyet await\tyou\tin\tyour\tjourney\tto\tmicroservices.",
      "content_length": 500,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 81,
      "content": "Looking\tfor\tthe\tIdeal\tIntegration\tTechnology\n\nThere\tis\ta\tbewildering\tarray\tof\toptions\tout\tthere\tfor\thow\tone\tmicroservice\tcan\ttalk\tto another.\tBut\twhich\tis\tthe\tright\tone:\tSOAP?\tXML-RPC?\tREST?\tProtocol\tbuffers?\tWe’ll dive\tinto\tthose\tin\ta\tmoment,\tbut\tbefore\twe\tdo,\tlet’s\tthink\tabout\twhat\twe\twant\tout\tof whatever\ttechnology\twe\tpick.",
      "content_length": 328,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 82,
      "content": "Avoid\tBreaking\tChanges\n\nEvery\tnow\tand\tthen,\twe\tmay\tmake\ta\tchange\tthat\trequires\tour\tconsumers\tto\talso\tchange. We’ll\tdiscuss\thow\tto\thandle\tthis\tlater,\tbut\twe\twant\tto\tpick\ttechnology\tthat\tensures\tthis happens\tas\trarely\tas\tpossible.\tFor\texample,\tif\ta\tmicroservice\tadds\tnew\tfields\tto\ta\tpiece\tof data\tit\tsends\tout,\texisting\tconsumers\tshouldn’t\tbe\timpacted.",
      "content_length": 350,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 83,
      "content": "Keep\tYour\tAPIs\tTechnology-Agnostic\n\nIf\tyou\thave\tbeen\tin\tthe\tIT\tindustry\tfor\tmore\tthan\t15\tminutes,\tyou\tdon’t\tneed\tme\tto\ttell you\tthat\twe\twork\tin\ta\tspace\tthat\tis\tchanging\trapidly.\tThe\tone\tcertainty\tis\tchange.\tNew tools,\tframeworks,\tand\tlanguages\tare\tcoming\tout\tall\tthe\ttime,\timplementing\tnew\tideas that\tcan\thelp\tus\twork\tfaster\tand\tmore\teffectively.\tRight\tnow,\tyou\tmight\tbe\ta\t.NET\tshop. But\twhat\tabout\tin\ta\tyear\tfrom\tnow,\tor\tfive\tyears\tfrom\tnow?\tWhat\tif\tyou\twant\tto experiment\twith\tan\talternative\ttechnology\tstack\tthat\tmight\tmake\tyou\tmore\tproductive?\n\nI\tam\ta\tbig\tfan\tof\tkeeping\tmy\toptions\topen,\twhich\tis\twhy\tI\tam\tsuch\ta\tfan\tof\tmicroservices. It\tis\talso\twhy\tI\tthink\tit\tis\tvery\timportant\tto\tensure\tthat\tyou\tkeep\tthe\tAPIs\tused\tfor communication\tbetween\tmicroservices\ttechnology-agnostic.\tThis\tmeans\tavoiding integration\ttechnology\tthat\tdictates\twhat\ttechnology\tstacks\twe\tcan\tuse\tto\timplement\tour microservices.",
      "content_length": 904,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 84,
      "content": "Make\tYour\tService\tSimple\tfor\tConsumers\n\nWe\twant\tto\tmake\tit\teasy\tfor\tconsumers\tto\tuse\tour\tservice.\tHaving\ta\tbeautifully\tfactored microservice\tdoesn’t\tcount\tfor\tmuch\tif\tthe\tcost\tof\tusing\tit\tas\ta\tconsumer\tis\tsky\thigh!\tSo let’s\tthink\tabout\twhat\tmakes\tit\teasy\tfor\tconsumers\tto\tuse\tour\twonderful\tnew\tservice. Ideally,\twe’d\tlike\tto\tallow\tour\tclients\tfull\tfreedom\tin\ttheir\ttechnology\tchoice,\tbut\ton\tthe other\thand,\tproviding\ta\tclient\tlibrary\tcan\tease\tadoption.\tOften,\thowever,\tsuch\tlibraries\tare incompatible\twith\tother\tthings\twe\twant\tto\tachieve.\tFor\texample,\twe\tmight\tuse\tclient libraries\tto\tmake\tit\teasy\tfor\tconsumers,\tbut\tthis\tcan\tcome\tat\tthe\tcost\tof\tincreased coupling.",
      "content_length": 665,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 85,
      "content": "Hide\tInternal\tImplementation\tDetail\n\nWe\tdon’t\twant\tour\tconsumers\tto\tbe\tbound\tto\tour\tinternal\timplementation.\tThis\tleads\tto increased\tcoupling.\tThis\tmeans\tthat\tif\twe\twant\tto\tchange\tsomething\tinside\tour microservice,\twe\tcan\tbreak\tour\tconsumers\tby\trequiring\tthem\tto\talso\tchange.\tThat increases\tthe\tcost\tof\tchange\t—\tthe\texact\tresult\twe\tare\ttrying\tto\tavoid.\tIt\talso\tmeans\twe are\tless\tlikely\tto\twant\tto\tmake\ta\tchange\tfor\tfear\tof\thaving\tto\tupgrade\tour\tconsumers, which\tcan\tlead\tto\tincreased\ttechnical\tdebt\twithin\tthe\tservice.\tSo\tany\ttechnology\tthat pushes\tus\tto\texpose\tinternal\trepresentation\tdetail\tshould\tbe\tavoided.",
      "content_length": 611,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 86,
      "content": "Interfacing\twith\tCustomers\n\nNow\tthat\twe’ve\tgot\ta\tfew\tguidelines\tthat\tcan\thelp\tus\tselect\ta\tgood\ttechnology\tto\tuse\tfor integration\tbetween\tservices,\tlet’s\tlook\tat\tsome\tof\tthe\tmost\tcommon\toptions\tout\tthere\tand try\tto\twork\tout\twhich\tone\tworks\tbest\tfor\tus.\tTo\thelp\tus\tthink\tthis\tthrough,\tlet’s\tpick\ta real-world\texample\tfrom\tMusicCorp.\n\nCustomer\tcreation\tat\tfirst\tglance\tcould\tbe\tconsidered\ta\tsimple\tset\tof\tCRUD\toperations, but\tfor\tmost\tsystems\tit\tis\tmore\tcomplex\tthan\tthat.\tEnrolling\ta\tnew\tcustomer\tmay\tneed\tto kick\toff\tadditional\tprocesses,\tlike\tsetting\tup\tfinancial\tpayments\tor\tsending\tout\twelcome emails.\tAnd\twhen\twe\tchange\tor\tdelete\ta\tcustomer,\tother\tbusiness\tprocesses\tmight\tget triggered\tas\twell.\n\nSo\twith\tthat\tin\tmind,\twe\tshould\tlook\tat\tsome\tdifferent\tways\tin\twhich\twe\tmight\twant\tto work\twith\tcustomers\tin\tour\tMusicCorp\tsystem.",
      "content_length": 830,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 87,
      "content": "The\tShared\tDatabase\n\nBy\tfar\tthe\tmost\tcommon\tform\tof\tintegration\tthat\tI\tor\tany\tof\tmy\tcolleagues\tsee\tin\tthe industry\tis\tdatabase\t(DB)\tintegration.\tIn\tthis\tworld,\tif\tother\tservices\twant\tinformation from\ta\tservice,\tthey\treach\tinto\tthe\tdatabase.\tAnd\tif\tthey\twant\tto\tchange\tit,\tthey\treach\tinto the\tdatabase!\tThis\tis\treally\tsimple\twhen\tyou\tfirst\tthink\tabout\tit,\tand\tis\tprobably\tthe\tfastest form\tof\tintegration\tto\tstart\twith\t—\twhich\tprobably\texplains\tits\tpopularity.\n\nFigure\t4-1\tshows\tour\tregistration\tUI,\twhich\tcreates\tcustomers\tby\tperforming\tSQL operations\tdirectly\ton\tthe\tdatabase.\tIt\talso\tshows\tour\tcall\tcenter\tapplication\tthat\tviews\tand edits\tcustomer\tdata\tby\trunning\tSQL\ton\tthe\tdatabase.\tAnd\tthe\twarehouse\tupdates information\tabout\tcustomer\torders\tby\tquerying\tthe\tdatabase.\tThis\tis\ta\tcommon\tenough pattern,\tbut\tit’s\tone\tfraught\twith\tdifficulties.\n\nFigure\t4-1.\tUsing\tDB\tintegration\tto\taccess\tand\tchange\tcustomer\tinformation\n\nFirst,\twe\tare\tallowing\texternal\tparties\tto\tview\tand\tbind\tto\tinternal\timplementation\tdetails. The\tdata\tstructures\tI\tstore\tin\tthe\tDB\tare\tfair\tgame\tto\tall;\tthey\tare\tshared\tin\ttheir\tentirety with\tall\tother\tparties\twith\taccess\tto\tthe\tdatabase.\tIf\tI\tdecide\tto\tchange\tmy\tschema\tto\tbetter represent\tmy\tdata,\tor\tmake\tmy\tsystem\teasier\tto\tmaintain,\tI\tcan\tbreak\tmy\tconsumers.\tThe DB\tis\teffectively\ta\tvery\tlarge,\tshared\tAPI\tthat\tis\talso\tquite\tbrittle.\tIf\tI\twant\tto\tchange\tthe logic\tassociated\twith,\tsay,\thow\tthe\thelpdesk\tmanages\tcustomers\tand\tthis\trequires\ta\tchange to\tthe\tdatabase,\tI\thave\tto\tbe\textremely\tcareful\tthat\tI\tdon’t\tbreak\tparts\tof\tthe\tschema\tused by\tother\tservices.\tThis\tsituation\tnormally\tresults\tin\trequiring\ta\tlarge\tamount\tof\tregression testing.\n\nSecond,\tmy\tconsumers\tare\ttied\tto\ta\tspecific\ttechnology\tchoice.\tPerhaps\tright\tnow\tit makes\tsense\tto\tstore\tcustomers\tin\ta\trelational\tdatabase,\tso\tmy\tconsumers\tuse\tan appropriate\t(potentially\tDB-specific)\tdriver\tto\ttalk\tto\tit.\tWhat\tif\tover\ttime\twe\trealize\twe would\tbe\tbetter\toff\tstoring\tdata\tin\ta\tnonrelational\tdatabase?\tCan\tit\tmake\tthat\tdecision?\tSo consumers\tare\tintimately\ttied\tto\tthe\timplementation\tof\tthe\tcustomer\tservice.\tAs\twe discussed\tearlier,\twe\treally\twant\tto\tensure\tthat\timplementation\tdetail\tis\thidden\tfrom consumers\tto\tallow\tour\tservice\ta\tlevel\tof\tautonomy\tin\tterms\tof\thow\tit\tchanges\tits internals\tover\ttime.\tGoodbye,\tloose\tcoupling.",
      "content_length": 2314,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 88,
      "content": "Finally,\tlet’s\tthink\tabout\tbehavior\tfor\ta\tmoment.\tThere\tis\tgoing\tto\tbe\tlogic\tassociated\twith how\ta\tcustomer\tis\tchanged.\tWhere\tis\tthat\tlogic?\tIf\tconsumers\tare\tdirectly\tmanipulating the\tDB,\tthen\tthey\thave\tto\town\tthe\tassociated\tlogic.\tThe\tlogic\tto\tperform\tthe\tsame\tsorts\tof manipulation\tto\ta\tcustomer\tmay\tnow\tbe\tspread\tamong\tmultiple\tconsumers.\tIf\tthe warehouse,\tregistration\tUI,\tand\tcall\tcenter\tUI\tall\tneed\tto\tedit\tcustomer\tinformation,\tI\tneed to\tfix\ta\tbug\tor\tchange\tthe\tbehavior\tin\tthree\tdifferent\tplaces,\tand\tdeploy\tthose\tchanges\ttoo. Goodbye,\tcohesion.\n\nRemember\twhen\twe\ttalked\tabout\tthe\tcore\tprinciples\tbehind\tgood\tmicroservices?\tStrong cohesion\tand\tloose\tcoupling\t—\twith\tdatabase\tintegration,\twe\tlose\tboth\tthings.\tDatabase integration\tmakes\tit\teasy\tfor\tservices\tto\tshare\tdata,\tbut\tdoes\tnothing\tabout\tsharing behavior.\tOur\tinternal\trepresentation\tis\texposed\tover\tthe\twire\tto\tour\tconsumers,\tand\tit\tcan be\tvery\tdifficult\tto\tavoid\tmaking\tbreaking\tchanges,\twhich\tinevitably\tleads\tto\ta\tfear\tof\tany change\tat\tall.\tAvoid\tat\t(nearly)\tall\tcosts.\n\nFor\tthe\trest\tof\tthe\tchapter,\twe’ll\texplore\tdifferent\tstyles\tof\tintegration\tthat\tinvolve collaborating\tservices,\twhich\tthemselves\thide\ttheir\town\tinternal\trepresentations.",
      "content_length": 1209,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 89,
      "content": "Synchronous\tVersus\tAsynchronous\n\nBefore\twe\tstart\tdiving\tinto\tthe\tspecifics\tof\tdifferent\ttechnology\tchoices,\twe\tshould\tdiscuss one\tof\tthe\tmost\timportant\tdecisions\twe\tcan\tmake\tin\tterms\tof\thow\tservices\tcollaborate. Should\tcommunication\tbe\tsynchronous\tor\tasynchronous?\tThis\tfundamental\tchoice inevitably\tguides\tus\ttoward\tcertain\timplementation\tdetail.\n\nWith\tsynchronous\tcommunication,\ta\tcall\tis\tmade\tto\ta\tremote\tserver,\twhich\tblocks\tuntil the\toperation\tcompletes.\tWith\tasynchronous\tcommunication,\tthe\tcaller\tdoesn’t\twait\tfor the\toperation\tto\tcomplete\tbefore\treturning,\tand\tmay\tnot\teven\tcare\twhether\tor\tnot\tthe operation\tcompletes\tat\tall.\n\nSynchronous\tcommunication\tcan\tbe\teasier\tto\treason\tabout.\tWe\tknow\twhen\tthings\thave completed\tsuccessfully\tor\tnot.\tAsynchronous\tcommunication\tcan\tbe\tvery\tuseful\tfor\tlong- running\tjobs,\twhere\tkeeping\ta\tconnection\topen\tfor\ta\tlong\tperiod\tof\ttime\tbetween\tthe client\tand\tserver\tis\timpractical.\tIt\talso\tworks\tvery\twell\twhen\tyou\tneed\tlow\tlatency,\twhere blocking\ta\tcall\twhile\twaiting\tfor\tthe\tresult\tcan\tslow\tthings\tdown.\tDue\tto\tthe\tnature\tof mobile\tnetworks\tand\tdevices,\tfiring\toff\trequests\tand\tassuming\tthings\thave\tworked\t(unless told\totherwise)\tcan\tensure\tthat\tthe\tUI\tremains\tresponsive\teven\tif\tthe\tnetwork\tis\thighly laggy.\tOn\tthe\tflipside,\tthe\ttechnology\tto\thandle\tasynchronous\tcommunication\tcan\tbe\ta\tbit more\tinvolved,\tas\twe’ll\tdiscuss\tshortly.\n\nThese\ttwo\tdifferent\tmodes\tof\tcommunication\tcan\tenable\ttwo\tdifferent\tidiomatic\tstyles\tof collaboration:\trequest/response\tor\tevent-based.\tWith\trequest/response,\ta\tclient\tinitiates\ta request\tand\twaits\tfor\tthe\tresponse.\tThis\tmodel\tclearly\taligns\twell\tto\tsynchronous communication,\tbut\tcan\twork\tfor\tasynchronous\tcommunication\ttoo.\tI\tmight\tkick\toff\tan operation\tand\tregister\ta\tcallback,\tasking\tthe\tserver\tto\tlet\tme\tknow\twhen\tmy\toperation\thas completed.\n\nWith\tan\tevent-based\tcollaboration,\twe\tinvert\tthings.\tInstead\tof\ta\tclient\tinitiating\trequests asking\tfor\tthings\tto\tbe\tdone,\tit\tinstead\tsays\tthis\tthing\thappened\tand\texpects\tother\tparties to\tknow\twhat\tto\tdo.\tWe\tnever\ttell\tanyone\telse\twhat\tto\tdo.\tEvent-based\tsystems\tby\ttheir nature\tare\tasynchronous.\tThe\tsmarts\tare\tmore\tevenly\tdistributed\t—\tthat\tis,\tthe\tbusiness logic\tis\tnot\tcentralized\tinto\tcore\tbrains,\tbut\tinstead\tpushed\tout\tmore\tevenly\tto\tthe\tvarious collaborators.\tEvent-based\tcollaboration\tis\talso\thighly\tdecoupled.\tThe\tclient\tthat\temits\tan event\tdoesn’t\thave\tany\tway\tof\tknowing\twho\tor\twhat\twill\treact\tto\tit,\twhich\talso\tmeans\tthat you\tcan\tadd\tnew\tsubscribers\tto\tthese\tevents\twithout\tthe\tclient\tever\tneeding\tto\tknow.\n\nSo\tare\tthere\tany\tother\tdrivers\tthat\tmight\tpush\tus\tto\tpick\tone\tstyle\tover\tanother?\tOne important\tfactor\tto\tconsider\tis\thow\twell\tthese\tstyles\tare\tsuited\tfor\tsolving\tan\toften- complex\tproblem:\thow\tdo\twe\thandle\tprocesses\tthat\tspan\tservice\tboundaries\tand\tmay\tbe long\trunning?",
      "content_length": 2814,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 90,
      "content": "Orchestration\tVersus\tChoreography\n\nAs\twe\tstart\tto\tmodel\tmore\tand\tmore\tcomplex\tlogic,\twe\thave\tto\tdeal\twith\tthe\tproblem\tof managing\tbusiness\tprocesses\tthat\tstretch\tacross\tthe\tboundary\tof\tindividual\tservices.\tAnd with\tmicroservices,\twe’ll\thit\tthis\tlimit\tsooner\tthan\tusual.\tLet’s\ttake\tan\texample\tfrom MusicCorp,\tand\tlook\tat\twhat\thappens\twhen\twe\tcreate\ta\tcustomer:\n\n1.\t A\tnew\trecord\tis\tcreated\tin\tthe\tloyalty\tpoints\tbank\tfor\tthe\tcustomer.\n\n2.\t Our\tpostal\tsystem\tsends\tout\ta\twelcome\tpack.\n\n3.\t We\tsend\ta\twelcome\temail\tto\tthe\tcustomer.\n\nThis\tis\tvery\teasy\tto\tmodel\tconceptually\tas\ta\tflowchart,\tas\twe\tdo\tin\tFigure\t4-2.\n\nWhen\tit\tcomes\tto\tactually\timplementing\tthis\tflow,\tthere\tare\ttwo\tstyles\tof\tarchitecture\twe could\tfollow.\tWith\torchestration,\twe\trely\ton\ta\tcentral\tbrain\tto\tguide\tand\tdrive\tthe\tprocess, much\tlike\tthe\tconductor\tin\tan\torchestra.\tWith\tchoreography,\twe\tinform\teach\tpart\tof\tthe system\tof\tits\tjob,\tand\tlet\tit\twork\tout\tthe\tdetails,\tlike\tdancers\tall\tfinding\ttheir\tway\tand reacting\tto\tothers\taround\tthem\tin\ta\tballet.\n\nFigure\t4-2.\tThe\tprocess\tfor\tcreating\ta\tnew\tcustomer\n\nLet’s\tthink\tabout\twhat\tan\torchestration\tsolution\twould\tlook\tlike\tfor\tthis\tflow.\tHere, probably\tthe\tsimplest\tthing\tto\tdo\twould\tbe\tto\thave\tour\tcustomer\tservice\tact\tas\tthe\tcentral brain.\tOn\tcreation,\tit\ttalks\tto\tthe\tloyalty\tpoints\tbank,\temail\tservice,\tand\tpostal\tservice\tas we\tsee\tin\tFigure\t4-3,\tthrough\ta\tseries\tof\trequest/response\tcalls.\tThe\tcustomer\tservice",
      "content_length": 1427,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 91,
      "content": "itself\tcan\tthen\ttrack\twhere\ta\tcustomer\tis\tin\tthis\tprocess.\tIt\tcan\tcheck\tto\tsee\tif\tthe customer’s\taccount\thas\tbeen\tset\tup,\tor\tthe\temail\tsent,\tor\tthe\tpost\tdelivered.\tWe\tget\tto\ttake the\tflowchart\tin\tFigure\t4-2\tand\tmodel\tit\tdirectly\tinto\tcode.\tWe\tcould\teven\tuse\ttooling\tthat implements\tthis\tfor\tus,\tperhaps\tusing\tan\tappropriate\trules\tengine.\tCommercial\ttools\texist for\tthis\tvery\tpurpose\tin\tthe\tform\tof\tbusiness\tprocess\tmodeling\tsoftware.\tAssuming\twe\tuse synchronous\trequest/response,\twe\tcould\teven\tknow\tif\teach\tstage\thas\tworked.\n\nFigure\t4-3.\tHandling\tcustomer\tcreation\tvia\torchestration\n\nThe\tdownside\tto\tthis\torchestration\tapproach\tis\tthat\tthe\tcustomer\tservice\tcan\tbecome\ttoo much\tof\ta\tcentral\tgoverning\tauthority.\tIt\tcan\tbecome\tthe\thub\tin\tthe\tmiddle\tof\ta\tweb,\tand\ta central\tpoint\twhere\tlogic\tstarts\tto\tlive.\tI\thave\tseen\tthis\tapproach\tresult\tin\ta\tsmall\tnumber of\tsmart\t“god”\tservices\ttelling\tanemic\tCRUD-based\tservices\twhat\tto\tdo.\n\nWith\ta\tchoreographed\tapproach,\twe\tcould\tinstead\tjust\thave\tthe\tcustomer\tservice\temit\tan event\tin\tan\tasynchronous\tmanner,\tsaying\tCustomer\tcreated.\tThe\temail\tservice,\tpostal service,\tand\tloyalty\tpoints\tbank\tthen\tjust\tsubscribe\tto\tthese\tevents\tand\treact\taccordingly, as\tin\tFigure\t4-4.\tThis\tapproach\tis\tsignificantly\tmore\tdecoupled.\tIf\tsome\tother\tservice needed\tto\treach\tto\tthe\tcreation\tof\ta\tcustomer,\tit\tjust\tneeds\tto\tsubscribe\tto\tthe\tevents\tand do\tits\tjob\twhen\tneeded.\tThe\tdownside\tis\tthat\tthe\texplicit\tview\tof\tthe\tbusiness\tprocess\twe see\tin\tFigure\t4-2\tis\tnow\tonly\timplicitly\treflected\tin\tour\tsystem.",
      "content_length": 1525,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 92,
      "content": "Figure\t4-4.\tHandling\tcustomer\tcreation\tvia\tchoreography\n\nThis\tmeans\tadditional\twork\tis\tneeded\tto\tensure\tthat\tyou\tcan\tmonitor\tand\ttrack\tthat\tthe right\tthings\thave\thappened.\tFor\texample,\twould\tyou\tknow\tif\tthe\tloyalty\tpoints\tbank\thad\ta bug\tand\tfor\tsome\treason\tdidn’t\tset\tup\tthe\tcorrect\taccount?\tOne\tapproach\tI\tlike\tfor\tdealing with\tthis\tis\tto\tbuild\ta\tmonitoring\tsystem\tthat\texplicitly\tmatches\tthe\tview\tof\tthe\tbusiness process\tin\tFigure\t4-2,\tbut\tthen\ttracks\twhat\teach\tof\tthe\tservices\tdoes\tas\tindependent entities,\tletting\tyou\tsee\todd\texceptions\tmapped\tonto\tthe\tmore\texplicit\tprocess\tflow.\tThe flowchart\twe\tsaw\tearlier\tisn’t\tthe\tdriving\tforce,\tbut\tjust\tone\tlens\tthrough\twhich\twe\tcan see\thow\tthe\tsystem\tis\tbehaving.\n\nIn\tgeneral,\tI\thave\tfound\tthat\tsystems\tthat\ttend\tmore\ttoward\tthe\tchoreographed\tapproach are\tmore\tloosely\tcoupled,\tand\tare\tmore\tflexible\tand\tamenable\tto\tchange.\tYou\tdo\tneed\tto do\textra\twork\tto\tmonitor\tand\ttrack\tthe\tprocesses\tacross\tsystem\tboundaries,\thowever.\tI have\tfound\tmost\theavily\torchestrated\timplementations\tto\tbe\textremely\tbrittle,\twith\ta higher\tcost\tof\tchange.\tWith\tthat\tin\tmind,\tI\tstrongly\tprefer\taiming\tfor\ta\tchoreographed system,\twhere\teach\tservice\tis\tsmart\tenough\tto\tunderstand\tits\trole\tin\tthe\twhole\tdance.\n\nThere\tare\tquite\ta\tfew\tfactors\tto\tunpack\there.\tSynchronous\tcalls\tare\tsimpler,\tand\twe\tget\tto know\tif\tthings\tworked\tstraightaway.\tIf\twe\tlike\tthe\tsemantics\tof\trequest/response\tbut\tare dealing\twith\tlonger-lived\tprocesses,\twe\tcould\tjust\tinitiate\tasynchronous\trequests\tand\twait for\tcallbacks.\tOn\tthe\tother\thand,\tasynchronous\tevent\tcollaboration\thelps\tus\tadopt\ta choreographed\tapproach,\twhich\tcan\tyield\tsignificantly\tmore\tdecoupled\tservices\t— something\twe\twant\tto\tstrive\tfor\tto\tensure\tour\tservices\tare\tindependently\treleasable.\n\nWe\tare,\tof\tcourse,\tfree\tto\tmix\tand\tmatch.\tSome\ttechnologies\twill\tfit\tmore\tnaturally\tinto one\tstyle\tor\tanother.\tWe\tdo,\thowever,\tneed\tto\tappreciate\tsome\tof\tthe\tdifferent\ttechnical implementation\tdetails\tthat\twill\tfurther\thelp\tus\tmake\tthe\tright\tcall.\n\nTo\tstart\twith,\tlet’s\tlook\tat\ttwo\ttechnologies\tthat\tfit\twell\twhen\twe\tare\tconsidering request/response:\tremote\tprocedure\tcall\t(RPC)\tand\tREpresentational\tState\tTransfer (REST).",
      "content_length": 2173,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 93,
      "content": "Remote\tProcedure\tCalls\n\nRemote\tprocedure\tcall\trefers\tto\tthe\ttechnique\tof\tmaking\ta\tlocal\tcall\tand\thaving\tit\texecute on\ta\tremote\tservice\tsomewhere.\tThere\tare\ta\tnumber\tof\tdifferent\ttypes\tof\tRPC\ttechnology out\tthere.\tSome\tof\tthis\ttechnology\trelies\ton\thaving\tan\tinterface\tdefinition\t(SOAP,\tThrift, protocol\tbuffers).\tThe\tuse\tof\ta\tseparate\tinterface\tdefinition\tcan\tmake\tit\teasier\tto\tgenerate client\tand\tserver\tstubs\tfor\tdifferent\ttechnology\tstacks,\tso,\tfor\texample,\tI\tcould\thave\ta\tJava server\texposing\ta\tSOAP\tinterface,\tand\ta\t.NET\tclient\tgenerated\tfrom\tthe\tWeb\tService Definition\tLanguage\t(WSDL)\tdefinition\tof\tthe\tinterface.\tOther\ttechnology,\tlike\tJava\tRMI, calls\tfor\ta\ttighter\tcoupling\tbetween\tthe\tclient\tand\tserver,\trequiring\tthat\tboth\tuse\tthe\tsame underlying\ttechnology\tbut\tavoid\tthe\tneed\tfor\ta\tshared\tinterface\tdefinition.\tAll\tthese technologies,\thowever,\thave\tthe\tsame,\tcore\tcharacteristic\tin\tthat\tthey\tmake\ta\tlocal\tcall look\tlike\ta\tremote\tcall.\n\nMany\tof\tthese\ttechnologies\tare\tbinary\tin\tnature,\tlike\tJava\tRMI,\tThrift,\tor\tprotocol\tbuffers, while\tSOAP\tuses\tXML\tfor\tits\tmessage\tformats.\tSome\timplementations\tare\ttied\tto\ta specific\tnetworking\tprotocol\t(like\tSOAP,\twhich\tmakes\tnominal\tuse\tof\tHTTP),\twhereas others\tmight\tallow\tyou\tto\tuse\tdifferent\ttypes\tof\tnetworking\tprotocols,\twhich\tthemselves can\tprovide\tadditional\tfeatures.\tFor\texample,\tTCP\toffers\tguarantees\tabout\tdelivery, whereas\tUDP\tdoesn’t\tbut\thas\ta\tmuch\tlower\toverhead.\tThis\tcan\tallow\tyou\tto\tuse\tdifferent networking\ttechnology\tfor\tdifferent\tuse\tcases.\n\nThose\tRPC\timplementations\tthat\tallow\tyou\tto\tgenerate\tclient\tand\tserver\tstubs\thelp\tyou get\tstarted\tvery,\tvery\tfast.\tI\tcan\tbe\tsending\tcontent\tover\ta\tnetwork\tboundary\tin\tno\ttime\tat all.\tThis\tis\toften\tone\tof\tthe\tmain\tselling\tpoints\tof\tRPC:\tits\tease\tof\tuse.\tThe\tfact\tthat\tI\tcan just\tmake\ta\tnormal\tmethod\tcall\tand\ttheoretically\tignore\tthe\trest\tis\ta\thuge\tboon.\n\nSome\tRPC\timplementations,\tthough,\tdo\tcome\twith\tsome\tdownsides\tthat\tcan\tcause\tissues. These\tissues\taren’t\talways\tapparent\tinitially,\tbut\tnonetheless\tthey\tcan\tbe\tsevere\tenough\tto outweigh\tthe\tbenefits\tof\tbeing\tso\teasy\tto\tget\tup\tand\trunning\tquickly.",
      "content_length": 2110,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 94,
      "content": "Technology\tCoupling\n\nSome\tRPC\tmechanisms,\tlike\tJava\tRMI,\tare\theavily\ttied\tto\ta\tspecific\tplatform,\twhich\tcan limit\twhich\ttechnology\tcan\tbe\tused\tin\tthe\tclient\tand\tserver.\tThrift\tand\tprotocol\tbuffers have\tan\timpressive\tamount\tof\tsupport\tfor\talternative\tlanguages,\twhich\tcan\treduce\tthis downside\tsomewhat,\tbut\tbe\taware\tthat\tsometimes\tRPC\ttechnology\tcomes\twith restrictions\ton\tinteroperability.\n\nIn\ta\tway,\tthis\ttechnology\tcoupling\tcan\tbe\ta\tform\tof\texposing\tinternal\ttechnical implementation\tdetails.\tFor\texample,\tthe\tuse\tof\tRMI\tties\tnot\tonly\tthe\tclient\tto\tthe\tJVM, but\tthe\tserver\ttoo.",
      "content_length": 579,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 95,
      "content": "Local\tCalls\tAre\tNot\tLike\tRemote\tCalls\n\nThe\tcore\tidea\tof\tRPC\tis\tto\thide\tthe\tcomplexity\tof\ta\tremote\tcall.\tMany\timplementations\tof RPC,\tthough,\thide\ttoo\tmuch.\tThe\tdrive\tin\tsome\tforms\tof\tRPC\tto\tmake\tremote\tmethod calls\tlook\tlike\tlocal\tmethod\tcalls\thides\tthe\tfact\tthat\tthese\ttwo\tthings\tare\tvery\tdifferent.\tI can\tmake\tlarge\tnumbers\tof\tlocal,\tin-process\tcalls\twithout\tworrying\toverly\tabout\tthe performance.\tWith\tRPC,\tthough,\tthe\tcost\tof\tmarshalling\tand\tun-marshalling\tpayloads\tcan be\tsignificant,\tnot\tto\tmention\tthe\ttime\ttaken\tto\tsend\tthings\tover\tthe\tnetwork.\tThis\tmeans you\tneed\tto\tthink\tdifferently\tabout\tAPI\tdesign\tfor\tremote\tinterfaces\tversus\tlocal interfaces.\tJust\ttaking\ta\tlocal\tAPI\tand\ttrying\tto\tmake\tit\ta\tservice\tboundary\twithout\tany more\tthought\tis\tlikely\tto\tget\tyou\tin\ttrouble.\tIn\tsome\tof\tthe\tworst\texamples,\tdevelopers may\tbe\tusing\tremote\tcalls\twithout\tknowing\tit\tif\tthe\tabstraction\tis\toverly\topaque.\n\nYou\tneed\tto\tthink\tabout\tthe\tnetwork\titself.\tFamously,\tthe\tfirst\tof\tthe\tfallacies\tof distributed\tcomputing\tis\t“The\tnetwork\tis\treliable”.\tNetworks\taren’t\treliable.\tThey\tcan\tand will\tfail,\teven\tif\tyour\tclient\tand\tthe\tserver\tyou\tare\tspeaking\tto\tare\tfine.\tThey\tcan\tfail\tfast, they\tcan\tfail\tslow,\tand\tthey\tcan\teven\tmalform\tyour\tpackets.\tYou\tshould\tassume\tthat\tyour networks\tare\tplagued\twith\tmalevolent\tentities\tready\tto\tunleash\ttheir\tire\ton\ta\twhim. Therefore,\tthe\tfailure\tmodes\tyou\tcan\texpect\tare\tdifferent.\tA\tfailure\tcould\tbe\tcaused\tby\tthe remote\tserver\treturning\tan\terror,\tor\tby\tyou\tmaking\ta\tbad\tcall.\tCan\tyou\ttell\tthe\tdifference, and\tif\tso,\tcan\tyou\tdo\tanything\tabout\tit?\tAnd\twhat\tdo\tyou\tdo\twhen\tthe\tremote\tserver\tjust starts\tresponding\tslowly?\tWe’ll\tcover\tthis\ttopic\twhen\twe\ttalk\tabout\tresiliency\tin Chapter\t11.",
      "content_length": 1714,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 96,
      "content": "Brittleness\n\nSome\tof\tthe\tmost\tpopular\timplementations\tof\tRPC\tcan\tlead\tto\tsome\tnasty\tforms\tof brittleness,\tJava’s\tRMI\tbeing\ta\tvery\tgood\texample.\tLet’s\tconsider\ta\tvery\tsimple\tJava interface\tthat\twe\thave\tdecided\tto\tmake\ta\tremote\tAPI\tfor\tour\tcustomer\tservice.\tExample\t4- 1\tdeclares\tthe\tmethods\twe\tare\tgoing\tto\texpose\tremotely.\tJava\tRMI\tthen\tgenerates\tthe client\tand\tserver\tstubs\tfor\tour\tmethod.\n\nExample\t4-1.\tDefining\ta\tservice\tendpoint\tusing\tJava\tRMI import\tjava.rmi.Remote; import\tjava.rmi.RemoteException;\n\npublic\tinterface\tCustomerRemote\textends\tRemote\t{ \t\tpublic\tCustomer\tfindCustomer(String\tid)\tthrows\tRemoteException;\n\npublic\tCustomer\tcreateCustomer(String\tfirstname,\tString\tsurname,\tString\temailAddress) \t\t\t\t\t\tthrows\tRemoteException; }\n\nIn\tthis\tinterface,\tfindCustomer\ttakes\tthe\tfirst\tname,\tsurname,\tand\temail\taddress.\tWhat happens\tif\twe\tdecide\tto\tallow\tthe\tCustomer\tobject\tto\talso\tbe\tcreated\twith\tjust\tan\temail address?\tWe\tcould\tadd\ta\tnew\tmethod\tat\tthis\tpoint\tpretty\teasily,\tlike\tso:\n\n... public\tCustomer\tcreateCustomer(String\temailAddress)\tthrows\tRemoteException; ...\n\nThe\tproblem\tis\tthat\tnow\twe\tneed\tto\tregenerate\tthe\tclient\tstubs\ttoo.\tClients\tthat\twant\tto consume\tthe\tnew\tmethod\tneed\tthe\tnew\tstubs,\tand\tdepending\ton\tthe\tnature\tof\tthe\tchanges to\tthe\tspecification,\tconsumers\tthat\tdon’t\tneed\tthe\tnew\tmethod\tmay\talso\tneed\tto\thave their\tstubs\tupgraded\ttoo.\tThis\tis\tmanageable,\tof\tcourse,\tbut\tto\ta\tpoint.\tThe\treality\tis\tthat changes\tlike\tthis\tare\tfairly\tcommon.\tRPC\tendpoints\toften\tend\tup\thaving\ta\tlarge\tnumber\tof methods\tfor\tdifferent\tways\tof\tcreating\tor\tinteracting\twith\tobjects.\tThis\tis\tdue\tin\tpart\tto\tthe fact\tthat\twe\tare\tstill\tthinking\tof\tthese\tremote\tcalls\tas\tlocal\tones.\n\nThere\tis\tanother\tsort\tof\tbrittleness,\tthough.\tLet’s\ttake\ta\tlook\tat\twhat\tour\tCustomer\tobject looks\tlike:\n\npublic\tclass\tCustomer\timplements\tSerializable\t{ \t\tprivate\tString\tfirstName; \t\tprivate\tString\tsurname; \t\tprivate\tString\temailAddress; \t\tprivate\tString\tage; }\n\nNow,\twhat\tif\tit\tturns\tout\tthat\talthough\twe\texpose\tthe\tage\tfield\tin\tour\tCustomer\tobjects, none\tof\tour\tconsumers\tever\tuse\tit?\tWe\tdecide\twe\twant\tto\tremove\tthis\tfield.\tBut\tif\tthe server\timplementation\tremoves\tage\tfrom\tits\tdefinition\tof\tthis\ttype,\tand\twe\tdon’t\tdo\tthe same\tto\tall\tthe\tconsumers,\tthen\teven\tthough\tthey\tnever\tused\tthe\tfield,\tthe\tcode\tassociated with\tdeserializing\tthe\tCustomer\tobject\ton\tthe\tconsumer\tside\twill\tbreak.\tTo\troll\tout\tthis change,\tI\twould\thave\tto\tdeploy\tboth\ta\tnew\tserver\tand\tclients\tat\tthe\tsame\ttime.\tThis\tis\ta",
      "content_length": 2476,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 97,
      "content": "key\tchallenge\twith\tany\tRPC\tmechanism\tthat\tpromotes\tthe\tuse\tof\tbinary\tstub\tgeneration: you\tdon’t\tget\tto\tseparate\tclient\tand\tserver\tdeployments.\tIf\tyou\tuse\tthis\ttechnology,\tlock- step\treleases\tmay\tbe\tin\tyour\tfuture.\n\nSimilar\tproblems\toccur\tif\tI\twant\tto\trestructure\tthe\tCustomer\tobject\teven\tif\tI\tdidn’t\tremove fields\t—\tfor\texample,\tif\tI\twanted\tto\tencapsulate\tfirstName\tand\tsurname\tinto\ta\tnew naming\ttype\tto\tmake\tit\teasier\tto\tmanage.\tI\tcould,\tof\tcourse,\tfix\tthis\tby\tpassing\taround dictionary\ttypes\tas\tthe\tparameters\tof\tmy\tcalls,\tbut\tat\tthat\tpoint,\tI\tlose\tmany\tof\tthe\tbenefits of\tthe\tgenerated\tstubs\tbecause\tI’ll\tstill\thave\tto\tmanually\tmatch\tand\textract\tthe\tfields\tI want.\n\nIn\tpractice,\tobjects\tused\tas\tpart\tof\tbinary\tserialization\tacross\tthe\twire\tcan\tbe\tthought\tof\tas expand-only\ttypes.\tThis\tbrittleness\tresults\tin\tthe\ttypes\tbeing\texposed\tover\tthe\twire\tand becoming\ta\tmass\tof\tfields,\tsome\tof\twhich\tare\tno\tlonger\tused\tbut\tcan’t\tbe\tsafely\tremoved.",
      "content_length": 941,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 98,
      "content": "Is\tRPC\tTerrible?\n\nDespite\tits\tshortcomings,\tI\twouldn’t\tgo\tso\tfar\tas\tto\tcall\tRPC\tterrible.\tSome\tof\tthe common\timplementations\tthat\tI\thave\tencountered\tcan\tlead\tto\tthe\tsorts\tof\tproblems\tI\thave outlined\there.\tDue\tto\tthe\tchallenges\tof\tusing\tRMI,\tI\twould\tcertainly\tgive\tthat\ttechnology a\twide\tberth.\tMany\toperations\tfall\tquite\tnicely\tinto\tthe\tRPC-based\tmodel,\tand\tmore modern\tmechanisms\tlike\tprotocol\tbuffers\tor\tThrift\tmitigate\tsome\tof\tsins\tof\tthe\tpast\tby avoiding\tthe\tneed\tfor\tlock-step\treleases\tof\tclient\tand\tserver\tcode.\n\nJust\tbe\taware\tof\tsome\tof\tthe\tpotential\tpitfalls\tassociated\twith\tRPC\tif\tyou’re\tgoing\tto\tpick this\tmodel.\tDon’t\tabstract\tyour\tremote\tcalls\tto\tthe\tpoint\twhere\tthe\tnetwork\tis\tcompletely hidden,\tand\tensure\tthat\tyou\tcan\tevolve\tthe\tserver\tinterface\twithout\thaving\tto\tinsist\ton lock-step\tupgrades\tfor\tclients.\tFinding\tthe\tright\tbalance\tfor\tyour\tclient\tcode\tis\timportant, for\texample.\tMake\tsure\tyour\tclients\taren’t\toblivious\tto\tthe\tfact\tthat\ta\tnetwork\tcall\tis\tgoing to\tbe\tmade.\tClient\tlibraries\tare\toften\tused\tin\tthe\tcontext\tof\tRPC,\tand\tif\tnot\tstructured\tright they\tcan\tbe\tproblematic.\tWe’ll\ttalk\tmore\tabout\tthem\tshortly.\n\nCompared\tto\tdatabase\tintegration,\tRPC\tis\tcertainly\tan\timprovement\twhen\twe\tthink\tabout options\tfor\trequest/response\tcollaboration.\tBut\tthere’s\tanother\toption\tto\tconsider.",
      "content_length": 1302,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 99,
      "content": "REST\n\nREpresentational\tState\tTransfer\t(REST)\tis\tan\tarchitectural\tstyle\tinspired\tby\tthe\tWeb. There\tare\tmany\tprinciples\tand\tconstraints\tbehind\tthe\tREST\tstyle,\tbut\twe\tare\tgoing\tto focus\ton\tthose\tthat\treally\thelp\tus\twhen\twe\tface\tintegration\tchallenges\tin\ta\tmicroservices world,\tand\twhen\twe’re\tlooking\tfor\tan\talternative\tstyle\tto\tRPC\tfor\tour\tservice\tinterfaces.\n\nMost\timportant\tis\tthe\tconcept\tof\tresources.\tYou\tcan\tthink\tof\ta\tresource\tas\ta\tthing\tthat\tthe service\titself\tknows\tabout,\tlike\ta\tCustomer.\tThe\tserver\tcreates\tdifferent\trepresentations\tof this\tCustomer\ton\trequest.\tHow\ta\tresource\tis\tshown\texternally\tis\tcompletely\tdecoupled from\thow\tit\tis\tstored\tinternally.\tA\tclient\tmight\task\tfor\ta\tJSON\trepresentation\tof\ta Customer,\tfor\texample,\teven\tif\tit\tis\tstored\tin\ta\tcompletely\tdifferent\tformat.\tOnce\ta\tclient has\ta\trepresentation\tof\tthis\tCustomer,\tit\tcan\tthen\tmake\trequests\tto\tchange\tit,\tand\tthe server\tmay\tor\tmay\tnot\tcomply\twith\tthem.\n\nThere\tare\tmany\tdifferent\tstyles\tof\tREST,\tand\tI\ttouch\tonly\tbriefly\ton\tthem\there.\tI\tstrongly recommend\tyou\ttake\ta\tlook\tat\tthe\tRichardson\tMaturity\tModel,\twhere\tthe\tdifferent\tstyles of\tREST\tare\tcompared.\n\nREST\titself\tdoesn’t\treally\ttalk\tabout\tunderlying\tprotocols,\talthough\tit\tis\tmost\tcommonly used\tover\tHTTP.\tI\thave\tseen\timplementations\tof\tREST\tusing\tvery\tdifferent\tprotocols before,\tsuch\tas\tserial\tor\tUSB,\talthough\tthis\tcan\trequire\ta\tlot\tof\twork.\tSome\tof\tthe\tfeatures that\tHTTP\tgives\tus\tas\tpart\tof\tthe\tspecification,\tsuch\tas\tverbs,\tmake\timplementing\tREST over\tHTTP\teasier,\twhereas\twith\tother\tprotocols\tyou’ll\thave\tto\thandle\tthese\tfeatures yourself.",
      "content_length": 1578,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 100,
      "content": "REST\tand\tHTTP\n\nHTTP\titself\tdefines\tsome\tuseful\tcapabilities\tthat\tplay\tvery\twell\twith\tthe\tREST\tstyle.\tFor example,\tthe\tHTTP\tverbs\t(e.g.,\tGET,\tPOST,\tand\tPUT)\talready\thave\twell-understood meanings\tin\tthe\tHTTP\tspecification\tas\tto\thow\tthey\tshould\twork\twith\tresources.\tThe REST\tarchitectural\tstyle\tactually\ttells\tus\tthat\tmethods\tshould\tbehave\tthe\tsame\tway\ton\tall resources,\tand\tthe\tHTTP\tspecification\thappens\tto\tdefine\ta\tbunch\tof\tmethods\twe\tcan\tuse. GET\tretrieves\ta\tresource\tin\tan\tidempotent\tway,\tand\tPOST\tcreates\ta\tnew\tresource.\tThis means\twe\tcan\tavoid\tlots\tof\tdifferent\tcreateCustomer\tor\teditCustomer\tmethods.\tInstead, we\tcan\tsimply\tPOST\ta\tcustomer\trepresentation\tto\trequest\tthat\tthe\tserver\tcreate\ta\tnew resource,\tand\tinitiate\ta\tGET\trequest\tto\tretrieve\ta\trepresentation\tof\ta\tresource. Conceptually,\tthere\tis\tone\tendpoint\tin\tthe\tform\tof\ta\tCustomer\tresource\tin\tthese\tcases,\tand the\toperations\twe\tcan\tcarry\tout\tupon\tit\tare\tbaked\tinto\tthe\tHTTP\tprotocol.\n\nHTTP\talso\tbrings\ta\tlarge\tecosystem\tof\tsupporting\ttools\tand\ttechnology.\tWe\tget\tto\tuse HTTP\tcaching\tproxies\tlike\tVarnish\tand\tload\tbalancers\tlike\tmod_proxy,\tand\tmany monitoring\ttools\talready\thave\tlots\tof\tsupport\tfor\tHTTP\tout\tof\tthe\tbox.\tThese\tbuilding blocks\tallow\tus\tto\thandle\tlarge\tvolumes\tof\tHTTP\ttraffic\tand\troute\tthem\tsmartly,\tin\ta\tfairly transparent\tway.\tWe\talso\tget\tto\tuse\tall\tthe\tavailable\tsecurity\tcontrols\twith\tHTTP\tto\tsecure our\tcommunications.\tFrom\tbasic\tauth\tto\tclient\tcerts,\tthe\tHTTP\tecosystem\tgives\tus\tlots\tof tools\tto\tmake\tthe\tsecurity\tprocess\teasier,\tand\twe’ll\texplore\tthat\ttopic\tmore\tin\tChapter\t9. That\tsaid,\tto\tget\tthese\tbenefits,\tyou\thave\tto\tuse\tHTTP\twell.\tUse\tit\tbadly,\tand\tit\tcan\tbe\tas insecure\tand\thard\tto\tscale\tas\tany\tother\ttechnology\tout\tthere.\tUse\tit\tright,\tthough,\tand\tyou get\ta\tlot\tof\thelp.\n\nNote\tthat\tHTTP\tcan\tbe\tused\tto\timplement\tRPC\ttoo.\tSOAP,\tfor\texample,\tgets\trouted\tover HTTP,\tbut\tunfortunately\tuses\tvery\tlittle\tof\tthe\tspecification.\tVerbs\tare\tignored,\tas\tare simple\tthings\tlike\tHTTP\terror\tcodes.\tAll\ttoo\toften,\tit\tseems,\tthe\texisting,\twell-understood standards\tand\ttechnology\tare\tignored\tin\tfavor\tof\tnew\tstandards\tthat\tcan\tonly\tbe implemented\tusing\tbrand-new\ttechnology\t—\tconveniently\tprovided\tby\tthe\tsame companies\tthat\thelp\tdesign\tthe\tnew\tstandards\tin\tthe\tfirst\tplace!",
      "content_length": 2249,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 101,
      "content": "Hypermedia\tAs\tthe\tEngine\tof\tApplication\tState\n\nAnother\tprinciple\tintroduced\tin\tREST\tthat\tcan\thelp\tus\tavoid\tthe\tcoupling\tbetween\tclient and\tserver\tis\tthe\tconcept\tof\thypermedia\tas\tthe\tengine\tof\tapplication\tstate\t(often abbreviated\tas\tHATEOAS,\tand\tboy,\tdid\tit\tneed\tan\tabbreviation).\tThis\tis\tfairly\tdense wording\tand\ta\tfairly\tinteresting\tconcept,\tso\tlet’s\tbreak\tit\tdown\ta\tbit.\n\nHypermedia\tis\ta\tconcept\twhereby\ta\tpiece\tof\tcontent\tcontains\tlinks\tto\tvarious\tother\tpieces of\tcontent\tin\ta\tvariety\tof\tformats\t(e.g.,\ttext,\timages,\tsounds).\tThis\tshould\tbe\tpretty familiar\tto\tyou,\tas\tit’s\twhat\tthe\taverage\tweb\tpage\tdoes:\tyou\tfollow\tlinks,\twhich\tare\ta\tform of\thypermedia\tcontrols,\tto\tsee\trelated\tcontent.\tThe\tidea\tbehind\tHATEOAS\tis\tthat\tclients should\tperform\tinteractions\t(potentially\tleading\tto\tstate\ttransitions)\twith\tthe\tserver\tvia these\tlinks\tto\tother\tresources.\tIt\tdoesn’t\tneed\tto\tknow\twhere\texactly\tcustomers\tlive\ton\tthe server\tby\tknowing\twhich\tURI\tto\thit;\tinstead,\tthe\tclient\tlooks\tfor\tand\tnavigates\tlinks\tto find\twhat\tit\tneeds.\n\nThis\tis\ta\tbit\tof\tan\todd\tconcept,\tso\tlet’s\tfirst\tstep\tback\tand\tconsider\thow\tpeople\tinteract with\ta\tweb\tpage,\twhich\twe’ve\talready\testablished\tis\trich\twith\thypermedia\tcontrols.\n\nThink\tof\tthe\tAmazon.com\tshopping\tsite.\tThe\tlocation\tof\tthe\tshopping\tcart\thas\tchanged over\ttime.\tThe\tgraphic\thas\tchanged.\tThe\tlink\thas\tchanged.\tBut\tas\thumans\twe\tare\tsmart enough\tto\tstill\tsee\ta\tshopping\tcart,\tknow\twhat\tit\tis,\tand\tinteract\twith\tit.\tWe\thave\tan understanding\tof\twhat\ta\tshopping\tcart\tmeans,\teven\tif\tthe\texact\tform\tand\tunderlying control\tused\tto\trepresent\tit\thas\tchanged.\tWe\tknow\tthat\tif\twe\twant\tto\tview\tthe\tcart,\tthis\tis the\tcontrol\twe\twant\tto\tinteract\twith.\tThis\tis\twhy\tweb\tpages\tcan\tchange\tincrementally\tover time.\tAs\tlong\tas\tthese\timplicit\tcontracts\tbetween\tthe\tcustomer\tand\tthe\twebsite\tare\tstill met,\tchanges\tdon’t\tneed\tto\tbe\tbreaking\tchanges.\n\nWith\thypermedia\tcontrols,\twe\tare\ttrying\tto\tachieve\tthe\tsame\tlevel\tof\tsmarts\tfor\tour electronic\tconsumers.\tLet’s\tlook\tat\ta\thypermedia\tcontrol\tthat\twe\tmight\thave\tfor MusicCorp.\tWe’ve\taccessed\ta\tresource\trepresenting\ta\tcatalog\tentry\tfor\ta\tgiven\talbum\tin Example\t4-2.\tAlong\twith\tinformation\tabout\tthe\talbum,\twe\tsee\ta\tnumber\tof\thypermedia controls.\n\nExample\t4-2.\tHypermedia\tcontrols\tused\ton\tan\talbum\tlisting <album> \t\t<name>Give\tBlood</name> \t\t<link\trel=\"/artist\"\thref=\"/artist/theBrakes\"\t/>\t \t\t<description> \t\t\t\tAwesome,\tshort,\tbrutish,\tfunny\tand\tloud.\tMust\tbuy! \t\t</description> \t\t<link\trel=\"/instantpurchase\"\thref=\"/instantPurchase/1234\"\t/>\t </album>\n\nThis\thypermedia\tcontrol\tshows\tus\twhere\tto\tfind\tinformation\tabout\tthe\tartist.\n\nAnd\tif\twe\twant\tto\tpurchase\tthe\talbum,\twe\tnow\tknow\twhere\tto\tgo.",
      "content_length": 2649,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 102,
      "content": "In\tthis\tdocument,\twe\thave\ttwo\thypermedia\tcontrols.\tThe\tclient\treading\tsuch\ta\tdocument needs\tto\tknow\tthat\ta\tcontrol\twith\ta\trelation\tof\tartist\tis\twhere\tit\tneeds\tto\tnavigate\tto\tget information\tabout\tthe\tartist,\tand\tthat\tinstantpurchase\tis\tpart\tof\tthe\tprotocol\tused\tto purchase\tthe\talbum.\tThe\tclient\thas\tto\tunderstand\tthe\tsemantics\tof\tthe\tAPI\tin\tmuch\tthe same\tway\tas\ta\thuman\tbeing\tneeds\tto\tunderstand\tthat\ton\ta\tshopping\twebsite\tthe\tcart\tis where\tthe\titems\tto\tbe\tpurchased\twill\tbe.\n\nAs\ta\tclient,\tI\tdon’t\tneed\tto\tknow\twhich\tURI\tscheme\tto\taccess\tto\tbuy\tthe\talbum,\tI\tjust need\tto\taccess\tthe\tresource,\tfind\tthe\tbuy\tcontrol,\tand\tnavigate\tto\tthat.\tThe\tbuy\tcontrol could\tchange\tlocation,\tthe\tURI\tcould\tchange,\tor\tthe\tsite\tcould\teven\tsend\tme\tto\tanother service\taltogether,\tand\tas\ta\tclient\tI\twouldn’t\tcare.\tThis\tgives\tus\ta\thuge\tamount\tof decoupling\tbetween\tthe\tclient\tand\tserver.\n\nWe\tare\tgreatly\tabstracted\tfrom\tthe\tunderlying\tdetail\there.\tWe\tcould\tcompletely\tchange\tthe implementation\tof\thow\tthe\tcontrol\tis\tpresented\tas\tlong\tas\tthe\tclient\tcan\tstill\tfind\ta\tcontrol that\tmatches\tits\tunderstanding\tof\tthe\tprotocol,\tin\tthe\tsame\tway\tthat\ta\tshopping\tcart control\tmight\tgo\tfrom\tbeing\ta\tsimple\tlink\tto\ta\tmore\tcomplex\tJavaScript\tcontrol.\tWe\tare also\tfree\tto\tadd\tnew\tcontrols\tto\tthe\tdocument,\tperhaps\trepresenting\tnew\tstate\ttransitions that\twe\tcan\tperform\ton\tthe\tresource\tin\tquestion.\tWe\twould\tend\tup\tbreaking\tour consumers\tonly\tif\twe\tfundamentally\tchanged\tthe\tsemantics\tof\tone\tof\tthe\tcontrols\tso\tit behaved\tvery\tdifferently,\tor\tif\twe\tremoved\ta\tcontrol\taltogether.\n\nUsing\tthese\tcontrols\tto\tdecouple\tthe\tclient\tand\tserver\tyields\tsignificant\tbenefits\tover\ttime that\tgreatly\toffset\tthe\tsmall\tincrease\tin\tthe\ttime\tit\ttakes\tto\tget\tthese\tprotocols\tup\tand running.\tBy\tfollowing\tthe\tlinks,\tthe\tclient\tgets\tto\tprogressively\tdiscover\tthe\tAPI,\twhich can\tbe\ta\treally\thandy\tcapability\twhen\twe\tare\timplementing\tnew\tclients.\n\nOne\tof\tthe\tdownsides\tis\tthat\tthis\tnavigation\tof\tcontrols\tcan\tbe\tquite\tchatty,\tas\tthe\tclient needs\tto\tfollow\tlinks\tto\tfind\tthe\toperation\tit\twants\tto\tperform.\tUltimately,\tthis\tis\ta\ttrade- off.\tI\twould\tsuggest\tyou\tstart\twith\thaving\tyour\tclients\tnavigate\tthese\tcontrols\tfirst,\tthen optimize\tlater\tif\tnecessary.\tRemember\tthat\twe\thave\ta\tlarge\tamount\tof\thelp\tout\tof\tthe\tbox by\tusing\tHTTP,\twhich\twe\tdiscussed\tearlier.\tThe\tevils\tof\tpremature\toptimization\thave been\twell\tdocumented\tbefore,\tso\tI\tdon’t\tneed\tto\texpand\tupon\tthem\there.\tAlso\tnote\tthat\ta lot\tof\tthese\tapproaches\twere\tdeveloped\tto\tcreate\tdistributed\thypertext\tsystems,\tand\tnot\tall of\tthem\tfit!\tSometimes\tyou’ll\tfind\tyourself\tjust\twanting\tgood\told-fashioned\tRPC.\n\nPersonally,\tI\tam\ta\tfan\tof\tusing\tlinks\tto\tallow\tconsumers\tto\tnavigate\tAPI\tendpoints.\tThe benefits\tof\tprogressive\tdiscovery\tof\tthe\tAPI\tand\treduced\tcoupling\tcan\tbe\tsignificant. However,\tit\tis\tclear\tthat\tnot\teveryone\tis\tsold,\tas\tI\tdon’t\tsee\tit\tbeing\tused\tanywhere\tnear\tas much\tas\tI\twould\tlike.\tI\tthink\ta\tlarge\tpart\tof\tthis\tis\tthat\tthere\tis\tsome\tinitial\tupfront\twork required,\tbut\tthe\trewards\toften\tcome\tlater.",
      "content_length": 3006,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 103,
      "content": "JSON,\tXML,\tor\tSomething\tElse?\n\nThe\tuse\tof\tstandard\ttextual\tformats\tgives\tclients\ta\tlot\tof\tflexibility\tas\tto\thow\tthey consume\tresources,\tand\tREST\tover\tHTTP\tlets\tus\tuse\ta\tvariety\tof\tformats.\tThe\texamples\tI have\tgiven\tso\tfar\tused\tXML,\tbut\tat\tthis\tstage,\tJSON\tis\ta\tmuch\tmore\tpopular\tcontent\ttype for\tservices\tthat\twork\tover\tHTTP.\n\nThe\tfact\tthat\tJSON\tis\ta\tmuch\tsimpler\tformat\tmeans\tthat\tconsumption\tis\talso\teasier.\tSome proponents\talso\tcite\tits\trelative\tcompactness\twhen\tcompared\tto\tXML\tas\tanother\twinning factor,\talthough\tthis\tisn’t\toften\ta\treal-world\tissue.\n\nJSON\tdoes\thave\tsome\tdownsides,\tthough.\tXML\tdefines\tthe\tlink\tcontrol\twe\tused\tearlier as\ta\thypermedia\tcontrol.\tThe\tJSON\tstandard\tdoesn’t\tdefine\tanything\tsimilar,\tso\tin-house styles\tare\tfrequently\tused\tto\tshoe-horn\tthis\tconcept\tin.\tThe\tHypertext\tApplication Language\t(HAL)\tattempts\tto\tfix\tthis\tby\tdefining\tsome\tcommon\tstandards\tfor hyperlinking\tfor\tJSON\t(and\tXML\ttoo,\talthough\targuably\tXML\tneeds\tless\thelp).\tIf\tyou follow\tthe\tHAL\tstandard,\tyou\tcan\tuse\ttools\tlike\tthe\tweb-based\tHAL\tbrowser\tfor exploring\thypermedia\tcontrols,\twhich\tcan\tmake\tthe\ttask\tof\tcreating\ta\tclient\tmuch\teasier.\n\nWe\taren’t\tlimited\tto\tthese\ttwo\tformats,\tof\tcourse.\tWe\tcan\tsend\tpretty\tmuch\tanything\tover HTTP\tif\twe\twant,\teven\tbinary.\tI\tam\tseeing\tmore\tand\tmore\tpeople\tjust\tusing\tHTML\tas\ta format\tinstead\tof\tXML.\tFor\tsome\tinterfaces,\tthe\tHTML\tcan\tdo\tdouble\tduty\tas\ta\tUI\tand\tan API,\talthough\tthere\tare\tpitfalls\tto\tbe\tavoided\there,\tas\tthe\tinteractions\tof\ta\thuman\tand\ta computer\tare\tquite\tdifferent!\tBut\tit\tis\tcertainly\tan\tattractive\tidea.\tThere\tare\tlots\tof\tHTML parsers\tout\tthere,\tafter\tall.\n\nPersonally,\tthough,\tI\tam\tstill\ta\tfan\tof\tXML.\tSome\tof\tthe\ttool\tsupport\tis\tbetter.\tFor example,\tif\tI\twant\tto\textract\tonly\tcertain\tparts\tof\tthe\tpayload\t(a\ttechnique\twe’ll\tdiscuss more\tin\t“Versioning”)\tI\tcan\tuse\tXPATH,\twhich\tis\ta\twell-understood\tstandard\twith\tlots\tof tool\tsupport,\tor\teven\tCSS\tselectors,\twhich\tmany\tfind\teven\teasier.\tWith\tJSON,\tI\thave JSONPATH,\tbut\tthis\tis\tnot\twidely\tsupported.\tI\tfind\tit\todd\tthat\tpeople\tpick\tJSON\tbecause it\tis\tnice\tand\tlightweight,\tthen\ttry\tand\tpush\tconcepts\tinto\tit\tlike\thypermedia\tcontrols\tthat already\texist\tin\tXML.\tI\taccept,\tthough,\tthat\tI\tam\tprobably\tin\tthe\tminority\there\tand\tthat JSON\tis\tthe\tformat\tof\tchoice\tfor\tmost\tpeople!",
      "content_length": 2273,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 104,
      "content": "Beware\tToo\tMuch\tConvenience\n\nAs\tREST\thas\tbecome\tmore\tpopular,\tso\ttoo\thave\tthe\tframeworks\tthat\thelp\tus\tcreate RESTFul\tweb\tservices.\tHowever,\tsome\tof\tthese\ttools\ttrade\toff\ttoo\tmuch\tin\tterms\tof\tshort- term\tgain\tfor\tlong-term\tpain;\tin\ttrying\tto\tget\tyou\tgoing\tfast,\tthey\tcan\tencourage\tsome\tbad behaviors.\tFor\texample,\tsome\tframeworks\tactually\tmake\tit\tvery\teasy\tto\tsimply\ttake database\trepresentations\tof\tobjects,\tdeserialize\tthem\tinto\tin-process\tobjects,\tand\tthen directly\texpose\tthese\texternally.\tI\tremember\tat\ta\tconference\tseeing\tthis\tdemonstrated using\tSpring\tBoot\tand\tcited\tas\ta\tmajor\tadvantage.\tThe\tinherent\tcoupling\tthat\tthis\tsetup promotes\twill\tin\tmost\tcases\tcause\tfar\tmore\tpain\tthan\tthe\teffort\trequired\tto\tproperly decouple\tthese\tconcepts.\n\nThere\tis\ta\tmore\tgeneral\tproblem\tat\tplay\there.\tHow\twe\tdecide\tto\tstore\tour\tdata,\tand\thow we\texpose\tit\tto\tour\tconsumers,\tcan\teasily\tdominate\tour\tthinking.\tOne\tpattern\tI\tsaw\tused effectively\tby\tone\tof\tour\tteams\twas\tto\tdelay\tthe\timplementation\tof\tproper\tpersistence\tfor the\tmicroservice,\tuntil\tthe\tinterface\thad\tstabilized\tenough.\tFor\tan\tinterim\tperiod,\tentities were\tjust\tpersisted\tin\ta\tfile\ton\tlocal\tdisk,\twhich\tis\tobviously\tnot\ta\tsuitable\tlong-term solution.\tThis\tensured\tthat\thow\tthe\tconsumers\twanted\tto\tuse\tthe\tservice\tdrove\tthe\tdesign and\timplementation\tdecisions.\tThe\trationale\tgiven,\twhich\twas\tborne\tout\tin\tthe\tresults, was\tthat\tit\tis\ttoo\teasy\tfor\tthe\tway\twe\tstore\tdomain\tentities\tin\ta\tbacking\tstore\tto\tovertly influence\tthe\tmodels\twe\tsend\tover\tthe\twire\tto\tcollaborators.\tOne\tof\tthe\tdownsides\twith this\tapproach\tis\tthat\twe\tare\tdeferring\tthe\twork\trequired\tto\twire\tup\tour\tdata\tstore.\tI\tthink for\tnew\tservice\tboundaries,\thowever,\tthis\tis\tan\tacceptable\ttrade-off.",
      "content_length": 1706,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 105,
      "content": "Downsides\tto\tREST\tOver\tHTTP\n\nIn\tterms\tof\tease\tof\tconsumption,\tyou\tcannot\teasily\tgenerate\ta\tclient\tstub\tfor\tyour\tREST over\tHTTP\tapplication\tprotocol\tlike\tyou\tcan\twith\tRPC.\tSure,\tthe\tfact\tthat\tHTTP\tis\tbeing used\tmeans\tthat\tyou\tget\tto\ttake\tadvantage\tof\tall\tthe\texcellent\tHTTP\tclient\tlibraries\tout there,\tbut\tif\tyou\twant\tto\timplement\tand\tuse\thypermedia\tcontrols\tas\ta\tclient\tyou\tare\tpretty much\ton\tyour\town.\tPersonally,\tI\tthink\tclient\tlibraries\tcould\tdo\tmuch\tbetter\tat\tthis\tthan they\tdo,\tand\tthey\tare\tcertainly\tbetter\tnow\tthan\tin\tthe\tpast,\tbut\tI\thave\tseen\tthis\tapparent increased\tcomplexity\tresult\tin\tpeople\tbacksliding\tinto\tsmuggling\tRPC\tover\tHTTP\tor building\tshared\tclient\tlibraries.\tShared\tcode\tbetween\tclient\tand\tserver\tcan\tbe\tvery dangerous,\tas\twe’ll\tdiscuss\tin\t“DRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta\tMicroservice World”.\n\nA\tmore\tminor\tpoint\tis\tthat\tsome\tweb\tserver\tframeworks\tdon’t\tactually\tsupport\tall\tthe HTTP\tverbs\twell.\tThat\tmeans\tthat\tit\tmight\tbe\teasy\tfor\tyou\tto\tcreate\ta\thandler\tfor\tGET\tor POST\trequests,\tbut\tyou\tmay\thave\tto\tjump\tthrough\thoops\tto\tget\tPUT\tor\tDELETE\trequests to\twork.\tProper\tREST\tframeworks\tlike\tJersey\tdon’t\thave\tthis\tproblem,\tand\tyou\tcan normally\twork\taround\tthis,\tbut\tif\tyou\tare\tlocked\tinto\tcertain\tframework\tchoices\tthis\tmight limit\twhat\tstyle\tof\tREST\tyou\tcan\tuse.\n\nPerformance\tmay\talso\tbe\tan\tissue.\tREST\tover\tHTTP\tpayloads\tcan\tactually\tbe\tmore compact\tthan\tSOAP\tbecause\tit\tsupports\talternative\tformats\tlike\tJSON\tor\teven\tbinary,\tbut it\twill\tstill\tbe\tnowhere\tnear\tas\tlean\ta\tbinary\tprotocol\tas\tThrift\tmight\tbe.\tThe\toverhead\tof HTTP\tfor\teach\trequest\tmay\talso\tbe\ta\tconcern\tfor\tlow-latency\trequirements.\n\nHTTP,\twhile\tit\tcan\tbe\tsuited\twell\tto\tlarge\tvolumes\tof\ttraffic,\tisn’t\tgreat\tfor\tlow-latency communications\twhen\tcompared\tto\talternative\tprotocols\tthat\tare\tbuilt\ton\ttop\tof Transmission\tControl\tProtocol\t(TCP)\tor\tother\tnetworking\ttechnology.\tDespite\tthe\tname, WebSockets,\tfor\texample,\thas\tvery\tlittle\tto\tdo\twith\tthe\tWeb.\tAfter\tthe\tinitial\tHTTP handshake,\tit’s\tjust\ta\tTCP\tconnection\tbetween\tclient\tand\tserver,\tbut\tit\tcan\tbe\ta\tmuch\tmore efficient\tway\tfor\tyou\tto\tstream\tdata\tfor\ta\tbrowser.\tIf\tthis\tis\tsomething\tyou’re\tinterested\tin, note\tthat\tyou\taren’t\treally\tusing\tmuch\tof\tHTTP,\tlet\talone\tanything\tto\tdo\twith\tREST.\n\nFor\tserver-to-server\tcommunications,\tif\textremely\tlow\tlatency\tor\tsmall\tmessage\tsize\tis important,\tHTTP\tcommunications\tin\tgeneral\tmay\tnot\tbe\ta\tgood\tidea.\tYou\tmay\tneed\tto pick\tdifferent\tunderlying\tprotocols,\tlike\tUser\tDatagram\tProtocol\t(UDP),\tto\tachieve\tthe performance\tyou\twant,\tand\tmany\tRPC\tframeworks\twill\tquite\thappily\trun\ton\ttop\tof networking\tprotocols\tother\tthan\tTCP.\n\nConsumption\tof\tthe\tpayloads\tthemselves\trequires\tmore\twork\tthan\tis\tprovided\tby\tsome RPC\timplementations\tthat\tsupport\tadvanced\tserialization\tand\tdeserialization\tmechanisms. These\tcan\tbecome\ta\tcoupling\tpoint\tin\ttheir\town\tright\tbetween\tclient\tand\tserver,\tas implementing\ttolerant\treaders\tis\ta\tnontrivial\tactivity\t(we’ll\tdiscuss\tthis\tshortly),\tbut\tfrom the\tpoint\tof\tview\tof\tgetting\tup\tand\trunning,\tthey\tcan\tbe\tvery\tattractive.",
      "content_length": 3031,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 106,
      "content": "Despite\tthese\tdisadvantages,\tREST\tover\tHTTP\tis\ta\tsensible\tdefault\tchoice\tfor\tservice-to- service\tinteractions.\tIf\tyou\twant\tto\tknow\tmore,\tI\trecommend\tREST\tin\tPractice\t(O’Reilly), which\tcovers\tthe\ttopic\tof\tREST\tover\tHTTP\tin\tdepth.",
      "content_length": 228,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 107,
      "content": "Implementing\tAsynchronous\tEvent-Based\tCollaboration\n\nWe’ve\ttalked\tfor\ta\tbit\tabout\tsome\ttechnologies\tthat\tcan\thelp\tus\timplement request/response\tpatterns.\tWhat\tabout\tevent-based,\tasynchronous\tcommunication?",
      "content_length": 205,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 108,
      "content": "Technology\tChoices\n\nThere\tare\ttwo\tmain\tparts\twe\tneed\tto\tconsider\there:\ta\tway\tfor\tour\tmicroservices\tto\temit events,\tand\ta\tway\tfor\tour\tconsumers\tto\tfind\tout\tthose\tevents\thave\thappened.\n\nTraditionally,\tmessage\tbrokers\tlike\tRabbitMQ\ttry\tto\thandle\tboth\tproblems.\tProducers\tuse an\tAPI\tto\tpublish\tan\tevent\tto\tthe\tbroker.\tThe\tbroker\thandles\tsubscriptions,\tallowing consumers\tto\tbe\tinformed\twhen\tan\tevent\tarrives.\tThese\tbrokers\tcan\teven\thandle\tthe\tstate of\tconsumers,\tfor\texample\tby\thelping\tkeep\ttrack\tof\twhat\tmessages\tthey\thave\tseen\tbefore. These\tsystems\tare\tnormally\tdesigned\tto\tbe\tscalable\tand\tresilient,\tbut\tthat\tdoesn’t\tcome\tfor free.\tIt\tcan\tadd\tcomplexity\tto\tthe\tdevelopment\tprocess,\tbecause\tit\tis\tanother\tsystem\tyou may\tneed\tto\trun\tto\tdevelop\tand\ttest\tyour\tservices.\tAdditional\tmachines\tand\texpertise\tmay also\tbe\trequired\tto\tkeep\tthis\tinfrastructure\tup\tand\trunning.\tBut\tonce\tit\tdoes,\tit\tcan\tbe\tan incredibly\teffective\tway\tto\timplement\tloosely\tcoupled,\tevent-driven\tarchitectures.\tIn general,\tI’m\ta\tfan.\n\nDo\tbe\twary,\tthough,\tabout\tthe\tworld\tof\tmiddleware,\tof\twhich\tthe\tmessage\tbroker\tis\tjust\ta small\tpart.\tQueues\tin\tand\tof\tthemselves\tare\tperfectly\tsensible,\tuseful\tthings.\tHowever, vendors\ttend\tto\twant\tto\tpackage\tlots\tof\tsoftware\twith\tthem,\twhich\tcan\tlead\tto\tmore\tand more\tsmarts\tbeing\tpushed\tinto\tthe\tmiddleware,\tas\tevidenced\tby\tthings\tlike\tthe\tEnterprise Service\tBus.\tMake\tsure\tyou\tknow\twhat\tyou’re\tgetting:\tkeep\tyour\tmiddleware\tdumb,\tand keep\tthe\tsmarts\tin\tthe\tendpoints.\n\nAnother\tapproach\tis\tto\ttry\tto\tuse\tHTTP\tas\ta\tway\tof\tpropagating\tevents.\tATOM\tis\ta\tREST- compliant\tspecification\tthat\tdefines\tsemantics\t(among\tother\tthings)\tfor\tpublishing\tfeeds of\tresources.\tMany\tclient\tlibraries\texist\tthat\tallow\tus\tto\tcreate\tand\tconsume\tthese\tfeeds. So\tour\tcustomer\tservice\tcould\tjust\tpublish\tan\tevent\tto\tsuch\ta\tfeed\twhen\tour\tcustomer service\tchanges.\tOur\tconsumers\tjust\tpoll\tthe\tfeed,\tlooking\tfor\tchanges.\tOn\tone\thand,\tthe fact\tthat\twe\tcan\treuse\tthe\texisting\tATOM\tspecification\tand\tany\tassociated\tlibraries\tis useful,\tand\twe\tknow\tthat\tHTTP\thandles\tscale\tvery\twell.\tHowever,\tHTTP\tis\tnot\tgood\tat low\tlatency\t(where\tsome\tmessage\tbrokers\texcel),\tand\twe\tstill\tneed\tto\tdeal\twith\tthe\tfact that\tthe\tconsumers\tneed\tto\tkeep\ttrack\tof\twhat\tmessages\tthey\thave\tseen\tand\tmanage\ttheir own\tpolling\tschedule.\n\nI\thave\tseen\tpeople\tspend\tan\tage\timplementing\tmore\tand\tmore\tof\tthe\tbehaviors\tthat\tyou get\tout\tof\tthe\tbox\twith\tan\tappropriate\tmessage\tbroker\tto\tmake\tATOM\twork\tfor\tsome\tuse cases.\tFor\texample,\tthe\tCompeting\tConsumer\tpattern\tdescribes\ta\tmethod\twhereby\tyou bring\tup\tmultiple\tworker\tinstances\tto\tcompete\tfor\tmessages,\twhich\tworks\twell\tfor\tscaling up\tthe\tnumber\tof\tworkers\tto\thandle\ta\tlist\tof\tindependent\tjobs.\tHowever,\twe\twant\tto\tavoid the\tcase\twhere\ttwo\tor\tmore\tworkers\tsee\tthe\tsame\tmessage,\tas\twe’ll\tend\tup\tdoing\tthe\tsame task\tmore\tthan\twe\tneed\tto.\tWith\ta\tmessage\tbroker,\ta\tstandard\tqueue\twill\thandle\tthis.\tWith ATOM,\twe\tnow\tneed\tto\tmanage\tour\town\tshared\tstate\tamong\tall\tthe\tworkers\tto\ttry\tto reduce\tthe\tchances\tof\treproducing\teffort.",
      "content_length": 3014,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 109,
      "content": "If\tyou\talready\thave\ta\tgood,\tresilient\tmessage\tbroker\tavailable\tto\tyou,\tconsider\tusing\tit\tto handle\tpublishing\tand\tsubscribing\tto\tevents.\tBut\tif\tyou\tdon’t\talready\thave\tone,\tgive ATOM\ta\tlook,\tbut\tbe\taware\tof\tthe\tsunk-cost\tfallacy.\tIf\tyou\tfind\tyourself\twanting\tmore and\tmore\tof\tthe\tsupport\tthat\ta\tmessage\tbroker\tgives\tyou,\tat\ta\tcertain\tpoint\tyou\tmight\twant to\tchange\tyour\tapproach.\n\nIn\tterms\tof\twhat\twe\tactually\tsend\tover\tthese\tasynchronous\tprotocols,\tthe\tsame considerations\tapply\tas\twith\tsynchronous\tcommunication.\tIf\tyou\tare\tcurrently\thappy\twith encoding\trequests\tand\tresponses\tusing\tJSON,\tstick\twith\tit.",
      "content_length": 604,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 110,
      "content": "Complexities\tof\tAsynchronous\tArchitectures\n\nSome\tof\tthis\tasynchronous\tstuff\tseems\tfun,\tright?\tEvent-driven\tarchitectures\tseem\tto\tlead to\tsignificantly\tmore\tdecoupled,\tscalable\tsystems.\tAnd\tthey\tcan.\tBut\tthese\tprogramming styles\tdo\tlead\tto\tan\tincrease\tin\tcomplexity.\tThis\tisn’t\tjust\tthe\tcomplexity\trequired\tto manage\tpublishing\tand\tsubscribing\tto\tmessages\tas\twe\tjust\tdiscussed,\tbut\talso\tin\tthe\tother problems\twe\tmight\tface.\tFor\texample,\twhen\tconsidering\tlong-running\tasync request/response,\twe\thave\tto\tthink\tabout\twhat\tto\tdo\twhen\tthe\tresponse\tcomes\tback.\tDoes it\tcome\tback\tto\tthe\tsame\tnode\tthat\tinitiated\tthe\trequest?\tIf\tso,\twhat\tif\tthat\tnode\tis\tdown? If\tnot,\tdo\tI\tneed\tto\tstore\tinformation\tsomewhere\tso\tI\tcan\treact\taccordingly?\tShort-lived async\tcan\tbe\teasier\tto\tmanage\tif\tyou’ve\tgot\tthe\tright\tAPIs,\tbut\teven\tso,\tit\tis\ta\tdifferent way\tof\tthinking\tfor\tprogrammers\twho\tare\taccustomed\tto\tintra-process\tsynchronous message\tcalls.\n\nTime\tfor\ta\tcautionary\ttale.\tBack\tin\t2006,\tI\twas\tworking\ton\tbuilding\ta\tpricing\tsystem\tfor\ta bank.\tWe\twould\tlook\tat\tmarket\tevents,\tand\twork\tout\twhich\titems\tin\ta\tportfolio\tneeded\tto be\trepriced.\tOnce\twe\tdetermined\tthe\tlist\tof\tthings\tto\twork\tthrough,\twe\tput\tthese\tall\tonto\ta message\tqueue.\tWe\twere\tmaking\tuse\tof\ta\tgrid\tto\tcreate\ta\tpool\tof\tpricing\tworkers, allowing\tus\tto\tscale\tup\tand\tdown\tthe\tpricing\tfarm\ton\trequest.\tThese\tworkers\tused\tthe competing\tconsumer\tpattern,\teach\tone\tgobbling\tmessages\tas\tfast\tas\tpossible\tuntil\tthere was\tnothing\tleft\tto\tprocess.\n\nThe\tsystem\twas\tup\tand\trunning,\tand\twe\twere\tfeeling\trather\tsmug.\tOne\tday,\tthough,\tjust after\twe\tpushed\ta\trelease\tout,\twe\thit\ta\tnasty\tproblem.\tOur\tworkers\tkept\tdying.\tAnd\tdying. And\tdying.\n\nEventually,\twe\ttracked\tdown\tthe\tproblem.\tA\tbug\thad\tcrept\tin\twhereby\ta\tcertain\ttype\tof pricing\trequest\twould\tcause\ta\tworker\tto\tcrash.\tWe\twere\tusing\ta\ttransacted\tqueue:\tas\tthe worker\tdied,\tits\tlock\ton\tthe\trequest\ttimed\tout,\tand\tthe\tpricing\trequest\twas\tput\tback\ton\tthe queue\t—\tonly\tfor\tanother\tworker\tto\tpick\tit\tup\tand\tdie.\tThis\twas\ta\tclassic\texample\tof\twhat Martin\tFowler\tcalls\ta\tcatastrophic\tfailover.\n\nAside\tfrom\tthe\tbug\titself,\twe’d\tfailed\tto\tspecify\ta\tmaximum\tretry\tlimit\tfor\tthe\tjob\ton\tthe queue.\tWe\tfixed\tthe\tbug\titself,\tand\talso\tconfigured\ta\tmaximum\tretry.\tBut\twe\talso\trealized we\tneeded\ta\tway\tto\tview,\tand\tpotentially\treplay,\tthese\tbad\tmessages.\tWe\tended\tup\thaving to\timplement\ta\tmessage\thospital\t(or\tdead\tletter\tqueue),\twhere\tmessages\tgot\tsent\tif\tthey failed.\tWe\talso\tcreated\ta\tUI\tto\tview\tthose\tmessages\tand\tretry\tthem\tif\tneeded.\tThese\tsorts of\tproblems\taren’t\timmediately\tobvious\tif\tyou\tare\tonly\tfamiliar\twith\tsynchronous\tpoint- to-point\tcommunication.\n\nThe\tassociated\tcomplexity\twith\tevent-driven\tarchitectures\tand\tasynchronous programming\tin\tgeneral\tleads\tme\tto\tbelieve\tthat\tyou\tshould\tbe\tcautious\tin\thow\teagerly you\tstart\tadopting\tthese\tideas.\tEnsure\tyou\thave\tgood\tmonitoring\tin\tplace,\tand\tstrongly consider\tthe\tuse\tof\tcorrelation\tIDs,\twhich\tallow\tyou\tto\ttrace\trequests\tacross\tprocess",
      "content_length": 2964,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 111,
      "content": "boundaries,\tas\twe’ll\tcover\tin\tdepth\tin\tChapter\t8.\n\nI\talso\tstrongly\trecommend\tEnterprise\tIntegration\tPatterns\t(Addison-Wesley),\twhich contains\ta\tlot\tmore\tdetail\ton\tthe\tdifferent\tprogramming\tpatterns\tthat\tyou\tmay\tneed\tto consider\tin\tthis\tspace.",
      "content_length": 242,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 112,
      "content": "Services\tas\tState\tMachines\n\nWhether\tyou\tchoose\tto\tbecome\ta\tREST\tninja,\tor\tstick\twith\tan\tRPC-based\tmechanism\tlike SOAP,\tthe\tcore\tconcept\tof\tthe\tservice\tas\ta\tstate\tmachine\tis\tpowerful.\tWe’ve\tspoken before\t(probably\tad\tnauseum\tby\tthis\tpoint)\tabout\tour\tservices\tbeing\tfashioned\taround bounded\tcontexts.\tOur\tcustomer\tmicroservice\towns\tall\tlogic\tassociated\twith\tbehavior\tin this\tcontext.\n\nWhen\ta\tconsumer\twants\tto\tchange\ta\tcustomer,\tit\tsends\tan\tappropriate\trequest\tto\tthe customer\tservice.\tThe\tcustomer\tservice,\tbased\ton\tits\tlogic,\tgets\tto\tdecide\tif\tit\taccepts\tthat request\tor\tnot.\tOur\tcustomer\tservice\tcontrols\tall\tlifecycle\tevents\tassociated\twith\tthe customer\titself.\tWe\twant\tto\tavoid\tdumb,\tanemic\tservices\tthat\tare\tlittle\tmore\tthan\tCRUD wrappers.\tIf\tthe\tdecision\tabout\twhat\tchanges\tare\tallowed\tto\tbe\tmade\tto\ta\tcustomer\tleak out\tof\tthe\tcustomer\tservice\titself,\twe\tare\tlosing\tcohesion.\n\nHaving\tthe\tlifecycle\tof\tkey\tdomain\tconcepts\texplicitly\tmodeled\tlike\tthis\tis\tpretty powerful.\tNot\tonly\tdo\twe\thave\tone\tplace\tto\tdeal\twith\tcollisions\tof\tstate\t(e.g.,\tsomeone trying\tto\tupdate\ta\tcustomer\tthat\thas\talready\tbeen\tremoved),\tbut\twe\talso\thave\ta\tplace\tto attach\tbehavior\tbased\ton\tthose\tstate\tchanges.\n\nI\tstill\tthink\tthat\tREST\tover\tHTTP\tmakes\tfor\ta\tmuch\tmore\tsensible\tintegration\ttechnology than\tmany\tothers,\tbut\twhatever\tyou\tpick,\tkeep\tthis\tidea\tin\tmind.",
      "content_length": 1340,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 113,
      "content": "Reactive\tExtensions\n\nReactive\textensions,\toften\tshortened\tto\tRx,\tare\ta\tmechanism\tto\tcompose\tthe\tresults\tof multiple\tcalls\ttogether\tand\trun\toperations\ton\tthem.\tThe\tcalls\tthemselves\tcould\tbe blocking\tor\tnonblocking\tcalls.\tAt\tits\theart,\tRx\tinverts\ttraditional\tflows.\tRather\tthan\tasking for\tsome\tdata,\tthen\tperforming\toperations\ton\tit,\tyou\tobserve\tthe\toutcome\tof\tan\toperation (or\tset\tof\toperations)\tand\treact\twhen\tsomething\tchanges.\tSome\timplementations\tof\tRx allow\tyou\tto\tperform\tfunctions\ton\tthese\tobservables,\tsuch\tas\tRxJava,\twhich\tallows traditional\tfunctions\tlike\tmap\tor\tfilter\tto\tbe\tused.\n\nThe\tvarious\tRx\timplementations\thave\tfound\ta\tvery\thappy\thome\tin\tdistributed\tsystems. They\tallow\tus\tto\tabstract\tout\tthe\tdetails\tof\thow\tcalls\tare\tmade,\tand\treason\tabout\tthings more\teasily.\tI\tobserve\tthe\tresult\tof\ta\tcall\tto\ta\tdownstream\tservice.\tI\tdon’t\tcare\tif\tit\twas\ta blocking\tor\tnonblocking\tcall,\tI\tjust\twait\tfor\tthe\tresponse\tand\treact.\tThe\tbeauty\tis\tthat\tI can\tcompose\tmultiple\tcalls\ttogether,\tmaking\thandling\tconcurrent\tcalls\tto\tdownstream services\tmuch\teasier.\n\nAs\tyou\tfind\tyourself\tmaking\tmore\tservice\tcalls,\tespecailly\twhen\tmaking\tmultiple\tcalls\tto perform\ta\tsingle\toperation,\ttake\ta\tlook\tat\tthe\treactive\textensions\tfor\tyour\tchosen technology\tstack.\tYou\tmay\tbe\tsurprised\thow\tmuch\tsimpler\tyour\tlife\tcan\tbecome.",
      "content_length": 1306,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 114,
      "content": "DRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta\tMicroservice\tWorld\n\nOne\tof\tthe\tacronyms\twe\tdevelopers\thear\ta\tlot\tis\tDRY:\tdon’t\trepeat\tyourself.\tThough\tits definition\tis\tsometimes\tsimplified\tas\ttrying\tto\tavoid\tduplicating\tcode,\tDRY\tmore accurately\tmeans\tthat\twe\twant\tto\tavoid\tduplicating\tour\tsystem\tbehavior\tand\tknowledge. This\tis\tvery\tsensible\tadvice\tin\tgeneral.\tHaving\tlots\tof\tlines\tof\tcode\tthat\tdo\tthe\tsame\tthing makes\tyour\tcodebase\tlarger\tthan\tneeded,\tand\ttherefore\tharder\tto\treason\tabout.\tWhen\tyou want\tto\tchange\tbehavior,\tand\tthat\tbehavior\tis\tduplicated\tin\tmany\tparts\tof\tyour\tsystem,\tit is\teasy\tto\tforget\teverywhere\tyou\tneed\tto\tmake\ta\tchange,\twhich\tcan\tlead\tto\tbugs.\tSo\tusing DRY\tas\ta\tmantra,\tin\tgeneral,\tmakes\tsense.\n\nDRY\tis\twhat\tleads\tus\tto\tcreate\tcode\tthat\tcan\tbe\treused.\tWe\tpull\tduplicated\tcode\tinto abstractions\tthat\twe\tcan\tthen\tcall\tfrom\tmultiple\tplaces.\tPerhaps\twe\tgo\tas\tfar\tas\tmaking\ta shared\tlibrary\tthat\twe\tcan\tuse\teverywhere!\tThis\tapproach,\thowever,\tcan\tbe\tdeceptively dangerous\tin\ta\tmicroservice\tarchitecture.\n\nOne\tof\tthe\tthings\twe\twant\tto\tavoid\tat\tall\tcosts\tis\toverly\tcoupling\ta\tmicroservice\tand consumers\tsuch\tthat\tany\tsmall\tchange\tto\tthe\tmicroservice\titself\tcan\tcause\tunnecessary changes\tto\tthe\tconsumer.\tSometimes,\thowever,\tthe\tuse\tof\tshared\tcode\tcan\tcreate\tthis\tvery coupling.\tFor\texample,\tat\tone\tclient\twe\thad\ta\tlibrary\tof\tcommon\tdomain\tobjects\tthat represented\tthe\tcore\tentities\tin\tuse\tin\tour\tsystem.\tThis\tlibrary\twas\tused\tby\tall\tthe\tservices we\thad.\tBut\twhen\ta\tchange\twas\tmade\tto\tone\tof\tthem,\tall\tservices\thad\tto\tbe\tupdated.\tOur system\tcommunicated\tvia\tmessage\tqueues,\twhich\talso\thad\tto\tbe\tdrained\tof\ttheir\tnow invalid\tcontents,\tand\twoe\tbetide\tyou\tif\tyou\tforgot.\n\nIf\tyour\tuse\tof\tshared\tcode\tever\tleaks\toutside\tyour\tservice\tboundary,\tyou\thave\tintroduced\ta potential\tform\tof\tcoupling.\tUsing\tcommon\tcode\tlike\tlogging\tlibraries\tis\tfine,\tas\tthey\tare internal\tconcepts\tthat\tare\tinvisible\tto\tthe\toutside\tworld.\tRealEstate.com.au\tmakes\tuse\tof\ta tailored\tservice\ttemplate\tto\thelp\tbootstrap\tnew\tservice\tcreation.\tRather\tthan\tmake\tthis code\tshared,\tthe\tcompany\tcopies\tit\tfor\tevery\tnew\tservice\tto\tensure\tthat\tcoupling\tdoesn’t leak\tin.\n\nMy\tgeneral\trule\tof\tthumb:\tdon’t\tviolate\tDRY\twithin\ta\tmicroservice,\tbut\tbe\trelaxed\tabout violating\tDRY\tacross\tall\tservices.\tThe\tevils\tof\ttoo\tmuch\tcoupling\tbetween\tservices\tare\tfar worse\tthan\tthe\tproblems\tcaused\tby\tcode\tduplication.\tThere\tis\tone\tspecific\tuse\tcase\tworth exploring\tfurther,\tthough.",
      "content_length": 2433,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 115,
      "content": "Client\tLibraries\n\nI’ve\tspoken\tto\tmore\tthan\tone\tteam\twho\thas\tinsisted\tthat\tcreating\tclient\tlibraries\tfor\tyour services\tis\tan\tessential\tpart\tof\tcreating\tservices\tin\tthe\tfirst\tplace.\tThe\targument\tis\tthat\tthis makes\tit\teasy\tto\tuse\tyour\tservice,\tand\tavoids\tthe\tduplication\tof\tcode\trequired\tto\tconsume the\tservice\titself.\n\nThe\tproblem,\tof\tcourse,\tis\tthat\tif\tthe\tsame\tpeople\tcreate\tboth\tthe\tserver\tAPI\tand\tthe\tclient API,\tthere\tis\tthe\tdanger\tthat\tlogic\tthat\tshould\texist\ton\tthe\tserver\tstarts\tleaking\tinto\tthe client.\tI\tshould\tknow:\tI’ve\tdone\tthis\tmyself.\tThe\tmore\tlogic\tthat\tcreeps\tinto\tthe\tclient library,\tthe\tmore\tcohesion\tstarts\tto\tbreak\tdown,\tand\tyou\tfind\tyourself\thaving\tto\tchange multiple\tclients\tto\troll\tout\tfixes\tto\tyour\tserver.\tYou\talso\tlimit\ttechnology\tchoices, especially\tif\tyou\tmandate\tthat\tthe\tclient\tlibrary\thas\tto\tbe\tused.\n\nA\tmodel\tfor\tclient\tlibraries\tI\tlike\tis\tthe\tone\tfor\tAmazon\tWeb\tServices\t(AWS).\tThe underlying\tSOAP\tor\tREST\tweb\tservice\tcalls\tcan\tbe\tmade\tdirectly,\tbut\teveryone\tends\tup using\tjust\tone\tof\tthe\tvarious\tsoftware\tdevelopment\tkits\t(SDKs)\tthat\texist,\twhich\tprovide abstractions\tover\tthe\tunderlying\tAPI.\tThese\tSDKs,\tthough,\tare\twritten\tby\tthe\tcommunity or\tAWS\tpeople\tother\tthan\tthose\twho\twork\ton\tthe\tAPI\titself.\tThis\tdegree\tof\tseparation seems\tto\twork,\tand\tavoids\tsome\tof\tthe\tpitfalls\tof\tclient\tlibraries.\tPart\tof\tthe\treason\tthis works\tso\twell\tis\tthat\tthe\tclient\tis\tin\tcharge\tof\twhen\tthe\tupgrade\thappens.\tIf\tyou\tgo\tdown the\tpath\tof\tclient\tlibraries\tyourself,\tmake\tsure\tthis\tis\tthe\tcase.\n\nNetflix\tin\tparticular\tplaces\tspecial\temphasis\ton\tthe\tclient\tlibrary,\tbut\tI\tworry\tthat\tpeople view\tthat\tpurely\tthrough\tthe\tlens\tof\tavoiding\tcode\tduplication.\tIn\tfact,\tthe\tclient\tlibraries used\tby\tNetflix\tare\tas\tmuch\t(if\tnot\tmore)\tabout\tensuring\treliability\tand\tscalability\tof\ttheir systems.\tThe\tNetflix\tclient\tlibraries\thandle\tservice\tdiscovery,\tfailure\tmodes,\tlogging,\tand other\taspects\tthat\taren’t\tactually\tabout\tthe\tnature\tof\tthe\tservice\titself.\tWithout\tthese shared\tclients,\tit\twould\tbe\thard\tto\tensure\tthat\teach\tpiece\tof\tclient/server\tcommunications behaved\twell\tat\tthe\tmassive\tscale\tat\twhich\tNetflix\toperates.\tTheir\tuse\tat\tNetflix\thas certainly\tmade\tit\teasy\tto\tget\tup\tand\trunning\tand\tincreased\tproductivity\twhile\talso ensuring\tthe\tsystem\tbehaves\twell.\tHowever,\taccording\tto\tat\tleast\tone\tperson\tat\tNetflix, over\ttime\tthis\thas\tled\tto\ta\tdegree\tof\tcoupling\tbetween\tclient\tand\tserver\tthat\thas\tbeen problematic.\n\nIf\tthe\tclient\tlibrary\tapproach\tis\tsomething\tyou’re\tthinking\tabout,\tit\tcan\tbe\timportant\tto separate\tout\tclient\tcode\tto\thandle\tthe\tunderlying\ttransport\tprotocol,\twhich\tcan\tdeal\twith things\tlike\tservice\tdiscovery\tand\tfailure,\tfrom\tthings\trelated\tto\tthe\tdestination\tservice itself.\tDecide\twhether\tor\tnot\tyou\tare\tgoing\tto\tinsist\ton\tthe\tclient\tlibrary\tbeing\tused,\tor\tif you’ll\tallow\tpeople\tusing\tdifferent\ttechnology\tstacks\tto\tmake\tcalls\tto\tthe\tunderlying\tAPI. And\tfinally,\tmake\tsure\tthat\tthe\tclients\tare\tin\tcharge\tof\twhen\tto\tupgrade\ttheir\tclient libraries:\twe\tneed\tto\tensure\twe\tmaintain\tthe\tability\tto\trelease\tour\tservices\tindependently of\teach\tother!",
      "content_length": 3067,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 116,
      "content": "Access\tby\tReference\n\nOne\tconsideration\tI\twant\tto\ttouch\ton\tis\thow\twe\tpass\taround\tinformation\tabout\tour domain\tentities.\tWe\tneed\tto\tembrace\tthe\tidea\tthat\ta\tmicroservice\twill\tencompass\tthe lifecycle\tof\tour\tcore\tdomain\tentities,\tlike\tthe\tCustomer.\tWe’ve\talready\ttalked\tabout\tthe importance\tof\tthe\tlogic\tassociated\twith\tchanging\tthis\tCustomer\tbeing\theld\tin\tthe\tcustomer service,\tand\tthat\tif\twe\twant\tto\tchange\tit\twe\thave\tto\tissue\ta\trequest\tto\tthe\tcustomer\tservice. But\tit\talso\tfollows\tthat\twe\tshould\tconsider\tthe\tcustomer\tservice\tas\tbeing\tthe\tsource\tof truth\tfor\tCustomers.\n\nWhen\twe\tretrieve\ta\tgiven\tCustomer\tresource\tfrom\tthe\tcustomer\tservice,\twe\tget\tto\tsee what\tthat\tresource\tlooked\tlike\twhen\twe\tmade\tthe\trequest.\tIt\tis\tpossible\tthat\tafter\twe requested\tthat\tCustomer\tresource,\tsomething\telse\thas\tchanged\tit.\tWhat\twe\thave\tin\teffect is\ta\tmemory\tof\twhat\tthe\tCustomer\tresource\tonce\tlooked\tlike.\tThe\tlonger\twe\thold\ton\tto this\tmemory,\tthe\thigher\tthe\tchance\tthat\tthis\tmemory\twill\tbe\tfalse.\tOf\tcourse,\tif\twe\tavoid requesting\tdata\tmore\tthan\twe\tneed\tto,\tour\tsystems\tcan\tbecome\tmuch\tmore\tefficient.\n\nSometimes\tthis\tmemory\tis\tgood\tenough.\tOther\ttimes\tyou\tneed\tto\tknow\tif\tit\thas\tchanged. So\twhether\tyou\tdecide\tto\tpass\taround\ta\tmemory\tof\twhat\tan\tentity\tonce\tlooked\tlike,\tmake sure\tyou\talso\tinclude\ta\treference\tto\tthe\toriginal\tresource\tso\tthat\tthe\tnew\tstate\tcan\tbe retrieved.\n\nLet’s\tconsider\tthe\texample\twhere\twe\task\tthe\temail\tservice\tto\tsend\tan\temail\twhen\tan\torder has\tbeen\tshipped.\tNow\twe\tcould\tsend\tin\tthe\trequest\tto\tthe\temail\tservice\twith\tthe customer’s\temail\taddress,\tname,\tand\torder\tdetails.\tHowever,\tif\tthe\temail\tservice\tis actually\tqueuing\tup\tthese\trequests,\tor\tpulling\tthem\tfrom\ta\tqueue,\tthings\tcould\tchange\tin the\tmeantime.\tIt\tmight\tmake\tmore\tsense\tto\tjust\tsend\ta\tURI\tfor\tthe\tCustomer\tand\tOrder resources,\tand\tlet\tthe\temail\tserver\tgo\tlook\tthem\tup\twhen\tit\tis\ttime\tto\tsend\tthe\temail.\n\nA\tgreat\tcounterpoint\tto\tthis\temerges\twhen\twe\tconsider\tevent-based\tcollaboration.\tWith events,\twe’re\tsaying\tthis\thappened,\tbut\twe\tneed\tto\tknow\twhat\thappened.\tIf\twe’re receiving\tupdates\tdue\tto\ta\tCustomer\tresource\tchanging,\tfor\texample,\tit\tcould\tbe\tvaluable to\tus\tto\tknow\twhat\tthe\tCustomer\tlooked\tlike\twhen\tthe\tevent\toccurred.\tAs\tlong\tas\twe\talso get\ta\treference\tto\tthe\tentity\titself\tso\twe\tcan\tlook\tup\tits\tcurrent\tstate,\tthen\twe\tcan\tget\tthe best\tof\tboth\tworlds.\n\nThere\tare\tother\ttrade-offs\tto\tbe\tmade\there,\tof\tcourse,\twhen\twe’re\taccessing\tby\treference. If\twe\talways\tgo\tto\tthe\tcustomer\tservice\tto\tlook\tat\tthe\tinformation\tassociated\twith\ta\tgiven Customer,\tthe\tload\ton\tthe\tcustomer\tservice\tcan\tbe\ttoo\tgreat.\tIf\twe\tprovide\tadditional information\twhen\tthe\tresource\tis\tretrieved,\tletting\tus\tknow\tat\twhat\ttime\tthe\tresource\twas in\tthe\tgiven\tstate\tand\tperhaps\thow\tlong\twe\tcan\tconsider\tthis\tinformation\tto\tbe\tfresh,\tthen we\tcan\tdo\ta\tlot\twith\tcaching\tto\treduce\tload.\tHTTP\tgives\tus\tmuch\tof\tthis\tsupport\tout\tof the\tbox\twith\ta\twide\tvariety\tof\tcache\tcontrols,\tsome\tof\twhich\twe’ll\tdiscuss\tin\tmore\tdetail",
      "content_length": 2957,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 117,
      "content": "in\tChapter\t11.\n\nAnother\tproblem\tis\tthat\tsome\tof\tour\tservices\tmight\tnot\tneed\tto\tknow\tabout\tthe\twhole Customer\tresource,\tand\tby\tinsisting\tthat\tthey\tgo\tlook\tit\tup\twe\tare\tpotentially\tincreasing coupling.\tIt\tcould\tbe\targued,\tfor\texample,\tthat\tour\temail\tservice\tshould\tbe\tmore\tdumb, and\tthat\twe\tshould\tjust\tsend\tit\tthe\temail\taddress\tand\tname\tof\tthe\tcustomer.\tThere\tisn’t\ta hard-and-fast\trule\there,\tbut\tbe\tvery\twary\tof\tpassing\taround\tdata\tin\trequests\twhen\tyou don’t\tknow\tits\tfreshness.",
      "content_length": 478,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 118,
      "content": "Versioning\n\nIn\tevery\tsingle\ttalk\tI\thave\tever\tdone\tabout\tmicroservices,\tI\tget\tasked\thow\tdo\tyou\tdo versioning?\tPeople\thave\tthe\tlegitimate\tconcern\tthat\teventually\tthey\twill\thave\tto\tmake\ta change\tto\tthe\tinterface\tof\ta\tservice,\tand\tthey\twant\tto\tunderstand\thow\tto\tmanage\tthat.\tLet’s break\tdown\tthe\tproblem\ta\tbit\tand\tlook\tat\tthe\tvarious\tsteps\twe\tcan\ttake\tto\thandle\tit.",
      "content_length": 361,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 119,
      "content": "Defer\tIt\tfor\tas\tLong\tas\tPossible\n\nThe\tbest\tway\tto\treduce\tthe\timpact\tof\tmaking\tbreaking\tchanges\tis\tto\tavoid\tmaking\tthem\tin the\tfirst\tplace.\tYou\tcan\tachieve\tmuch\tof\tthis\tby\tpicking\tthe\tright\tintegration\ttechnology, as\twe’ve\tdiscussed\tthroughout\tthis\tchapter.\tDatabase\tintegration\tis\ta\tgreat\texample\tof technology\tthat\tcan\tmake\tit\tvery\thard\tto\tavoid\tbreaking\tchanges.\tREST,\ton\tthe\tother hand,\thelps\tbecause\tchanges\tto\tinternal\timplementation\tdetail\tare\tless\tlikely\tto\tresult\tin\ta change\tto\tthe\tservice\tinterface.\n\nAnother\tkey\tto\tdeferring\ta\tbreaking\tchange\tis\tto\tencourage\tgood\tbehavior\tin\tyour\tclients, and\tavoid\tthem\tbinding\ttoo\ttightly\tto\tyour\tservices\tin\tthe\tfirst\tplace.\tLet’s\tconsider\tour email\tservice,\twhose\tjob\tit\tis\tto\tsend\tout\temails\tto\tour\tcustomers\tfrom\ttime\tto\ttime.\tIt\tgets asked\tto\tsend\tan\torder\tshipped\temail\tto\tcustomer\twith\tthe\tID\t1234.\tIt\tgoes\toff\tand retrieves\tthe\tcustomer\twith\tthat\tID,\tand\tgets\tback\tsomething\tlike\tthe\tresponse\tshown\tin Example\t4-3.\n\nExample\t4-3.\tSample\tresponse\tfrom\tthe\tcustomer\tservice <customer> \t\t<firstname>Sam</firstname> \t\t<lastname>Newman</lastname> \t\t<email>sam@magpiebrain.com</email> \t\t<telephoneNumber>555-1234-5678</telephoneNumber> </customer>\n\nNow\tto\tsend\tthe\temail,\twe\tneed\tonly\tthe\tfirstname,\tlastname,\tand\temail\tfields.\tWe don’t\tneed\tto\tknow\tthe\ttelephoneNumber.\tWe\twant\tto\tsimply\tpull\tout\tthose\tfields\twe\tcare about,\tand\tignore\tthe\trest.\tSome\tbinding\ttechnology,\tespecially\tthat\tused\tby\tstrongly typed\tlanguages,\tcan\tattempt\tto\tbind\tall\tfields\twhether\tthe\tconsumer\twants\tthem\tor\tnot. What\thappens\tif\twe\trealize\tthat\tno\tone\tis\tusing\tthe\ttelephoneNumber\tand\twe\tdecide\tto remove\tit?\tThis\tcould\tcause\tconsumers\tto\tbreak\tneedlessly.\n\nLikewise,\twhat\tif\twe\twanted\tto\trestructure\tour\tCustomer\tobject\tto\tsupport\tmore\tdetails, perhaps\tadding\tsome\tfurther\tstructure\tas\tin\tExample\t4-4?\tThe\tdata\tour\temail\tservice wants\tis\tstill\tthere,\tand\tstill\twith\tthe\tsame\tname,\tbut\tif\tour\tcode\tmakes\tvery\texplicit assumptions\tas\tto\twhere\tthe\tfirstname\tand\tlastname\tfields\twill\tbe\tstored,\tthen\tit\tcould break\tagain.\tIn\tthis\tinstance,\twe\tcould\tinstead\tuse\tXPath\tto\tpull\tout\tthe\tfields\twe\tcare about,\tallowing\tus\tto\tbe\tambivalent\tabout\twhere\tthe\tfields\tare,\tas\tlong\tas\twe\tcan\tfind them.\tThis\tpattern\t—\tof\timplementing\ta\treader\table\tto\tignore\tchanges\twe\tdon’t\tcare\tabout —\tis\twhat\tMartin\tFowler\tcalls\ta\tTolerant\tReader.\n\nExample\t4-4.\tA\trestructured\tCustomer\tresource:\tthe\tdata\tis\tall\tstill\tthere,\tbut\tcan\tour consumers\tfind\tit? <customer> \t\t<naming> \t\t\t\t<firstname>Sam</firstname> \t\t\t\t<lastname>Newman</lastname> \t\t\t\t<nickname>Magpiebrain</nickname> \t\t\t\t<fullname>Sam\t\"Magpiebrain\"\tNewman</fullname> \t\t</naming> \t\t<email>sam@magpiebrain.com</email>",
      "content_length": 2676,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 120,
      "content": "</customer>\n\nThe\texample\tof\ta\tclient\ttrying\tto\tbe\tas\tflexible\tas\tpossible\tin\tconsuming\ta\tservice demonstrates\tPostel’s\tLaw\t(otherwise\tknown\tas\tthe\trobustness\tprinciple),\twhich\tstates: “Be\tconservative\tin\twhat\tyou\tdo,\tbe\tliberal\tin\twhat\tyou\taccept\tfrom\tothers.”\tThe\toriginal context\tfor\tthis\tpiece\tof\twisdom\twas\tthe\tinteraction\tof\tdevices\tover\tnetworks,\twhere\tyou should\texpect\tall\tsorts\tof\todd\tthings\tto\thappen.\tIn\tthe\tcontext\tof\tour\trequest/response interaction,\tit\tcan\tlead\tus\tto\ttry\tour\tbest\tto\tallow\tthe\tservice\tbeing\tconsumed\tto\tchange without\trequiring\tus\tto\tchange.",
      "content_length": 572,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 121,
      "content": "Catch\tBreaking\tChanges\tEarly\n\nIt’s\tcrucial\tto\tmake\tsure\twe\tpick\tup\tchanges\tthat\twill\tbreak\tconsumers\tas\tsoon\tas\tpossible, because\teven\tif\twe\tchoose\tthe\tbest\tpossible\ttechnology,\tbreaks\tcan\tstill\thappen.\tI\tam strongly\tin\tfavor\tof\tusing\tconsumer-driven\tcontracts,\twhich\twe’ll\tcover\tin\tChapter\t7,\tto help\tspot\tthese\tproblems\tearly\ton.\tIf\tyou’re\tsupporting\tmultiple\tdifferent\tclient\tlibraries, running\ttests\tusing\teach\tlibrary\tyou\tsupport\tagainst\tthe\tlatest\tservice\tis\tanother\ttechnique that\tcan\thelp.\tOnce\tyou\trealize\tyou\tare\tgoing\tto\tbreak\ta\tconsumer,\tyou\thave\tthe\tchoice\tto either\ttry\tto\tavoid\tthe\tbreak\taltogether\tor\telse\tembrace\tit\tand\tstart\thaving\tthe\tright conversations\twith\tthe\tpeople\tlooking\tafter\tthe\tconsuming\tservices.",
      "content_length": 727,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 122,
      "content": "Use\tSemantic\tVersioning\n\nWouldn’t\tit\tbe\tgreat\tif\tas\ta\tclient\tyou\tcould\tlook\tjust\tat\tthe\tversion\tnumber\tof\ta\tservice and\tknow\tif\tyou\tcan\tintegrate\twith\tit?\tSemantic\tversioning\tis\ta\tspecification\tthat\tallows just\tthat.\tWith\tsemantic\tversioning,\teach\tversion\tnumber\tis\tin\tthe\tform MAJOR.MINOR.PATCH.\tWhen\tthe\tMAJOR\tnumber\tincrements,\tit\tmeans\tthat\tbackward incompatible\tchanges\thave\tbeen\tmade.\tWhen\tMINOR\tincrements,\tnew\tfunctionality\thas been\tadded\tthat\tshould\tbe\tbackward\tcompatible.\tFinally,\ta\tchange\tto\tPATCH\tstates\tthat\tbug fixes\thave\tbeen\tmade\tto\texisting\tfunctionality.\n\nTo\tsee\thow\tuseful\tsemantic\tversioning\tcan\tbe,\tlet’s\tlook\tat\ta\tsimple\tuse\tcase.\tOur helpdesk\tapplication\tis\tbuilt\tto\twork\tagainst\tversion\t1.2.0\tof\tthe\tcustomer\tservice.\tIf\ta new\tfeature\tis\tadded,\tcausing\tthe\tcustomer\tservice\tto\tchange\tto\t1.3.0,\tour\thelpdesk application\tshould\tsee\tno\tchange\tin\tbehavior\tand\tshouldn’t\tbe\texpected\tto\tmake\tany changes.\tWe\tcouldn’t\tguarantee\tthat\twe\tcould\twork\tagainst\tversion\t1.1.0\tof\tthe\tcustomer service,\tthough,\tas\twe\tmay\trely\ton\tfunctionality\tadded\tin\tthe\t1.2.0\trelease.\tWe\tcould\talso expect\tto\thave\tto\tmake\tchanges\tto\tour\tapplication\tif\ta\tnew\t2.0.0\trelease\tof\tthe\tcustomer service\tcomes\tout.\n\nYou\tmay\tdecide\tto\thave\ta\tsemantic\tversion\tfor\tthe\tservice,\tor\teven\tfor\tan\tindividual endpoint\ton\ta\tservice\tif\tyou\tare\tcoexisting\tthem\tas\tdetailed\tin\tthe\tnext\tsection.\n\nThis\tversioning\tscheme\tallows\tus\tto\tpack\ta\tlot\tof\tinformation\tand\texpectations\tinto\tjust three\tfields.\tThe\tfull\tspecification\toutlines\tin\tvery\tsimple\tterms\tthe\texpectations\tclients can\thave\tof\tchanges\tto\tthese\tnumbers,\tand\tcan\tsimplify\tthe\tprocess\tof\tcommunicating about\twhether\tchanges\tshould\timpact\tconsumers.\tUnfortunately,\tI\thaven’t\tsee\tthis approach\tused\tenough\tin\tthe\tcontext\tof\tdistributed\tsystems.",
      "content_length": 1776,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 123,
      "content": "Coexist\tDifferent\tEndpoints\n\nIf\twe’ve\tdone\tall\twe\tcan\tto\tavoid\tintroducing\ta\tbreaking\tinterface\tchange,\tour\tnext\tjob\tis to\tlimit\tthe\timpact.\tThe\tthing\twe\twant\tto\tavoid\tis\tforcing\tconsumers\tto\tupgrade\tin\tlock- step\twith\tus,\tas\twe\talways\twant\tto\tmaintain\tthe\tability\tto\trelease\tmicroservices independently\tof\teach\tother.\tOne\tapproach\tI\thave\tused\tsuccessfully\tto\thandle\tthis\tis\tto coexist\tboth\tthe\told\tand\tnew\tinterfaces\tin\tthe\tsame\trunning\tservice.\tSo\tif\twe\twant\tto release\ta\tbreaking\tchange,\twe\tdeploy\ta\tnew\tversion\tof\tthe\tservice\tthat\texposes\tboth\tthe old\tand\tnew\tversions\tof\tthe\tendpoint.\n\nThis\tallows\tus\tto\tget\tthe\tnew\tmicroservice\tout\tas\tsoon\tas\tpossible,\talong\twith\tthe\tnew interface,\tbut\tgive\ttime\tfor\tconsumers\tto\tmove\tover.\tOnce\tall\tof\tthe\tconsumers\tare\tno longer\tusing\tthe\told\tendpoint,\tyou\tcan\tremove\tit\talong\twith\tany\tassociated\tcode,\tas\tshown in\tFigure\t4-5.\n\nFigure\t4-5.\tCoexisting\tdifferent\tendpoint\tversions\tallows\tconsumers\tto\tmigrate\tgradually\n\nWhen\tI\tlast\tused\tthis\tapproach,\twe\thad\tgotten\tourselves\tinto\ta\tbit\tof\ta\tmess\twith\tthe number\tof\tconsumers\twe\thad\tand\tthe\tnumber\tof\tbreaking\tchanges\twe\thad\tmade.\tThis meant\tthat\twe\twere\tactually\tcoexisting\tthree\tdifferent\tversions\tof\tthe\tendpoint.\tThis\tis\tnot something\tI’d\trecommend!\tKeeping\tall\tthe\tcode\taround\tand\tthe\tassociated\ttesting required\tto\tensure\tthey\tall\tworked\twas\tabsolutely\tan\tadditional\tburden.\tTo\tmake\tthis\tmore manageable,\twe\tinternally\ttransformed\tall\trequests\tto\tthe\tV1\tendpoint\tto\ta\tV2\trequest, and\tthen\tV2\trequests\tto\tthe\tV3\tendpoint.\tThis\tmeant\twe\tcould\tclearly\tdelineate\twhat\tcode was\tgoing\tto\tbe\tretired\twhen\tthe\told\tendpoint(s)\tdied.\n\nThis\tis\tin\teffect\tan\texample\tof\tthe\texpand\tand\tcontract\tpattern,\twhich\tallows\tus\tto\tphase breaking\tchanges\tin.\tWe\texpand\tthe\tcapabilities\twe\toffer,\tsupporting\tboth\told\tand\tnew",
      "content_length": 1796,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 124,
      "content": "ways\tof\tdoing\tsomething.\tOnce\tthe\told\tconsumers\tdo\tthings\tin\tthe\tnew\tway,\twe\tcontract our\tAPI,\tremoving\tthe\told\tfunctionality.\n\nIf\tyou\tare\tgoing\tto\tcoexist\tendpoints,\tyou\tneed\ta\tway\tfor\tcallers\tto\troute\ttheir\trequests accordingly.\tFor\tsystems\tmaking\tuse\tof\tHTTP,\tI\thave\tseen\tthis\tdone\twith\tboth\tversion numbers\tin\trequest\theaders\tand\talso\tin\tthe\tURI\titself\t—\tfor\texample,\t/v1/customer/\tor /v2/customer/.\tI’m\ttorn\tas\tto\twhich\tapproach\tmakes\tthe\tmost\tsense.\tOn\tthe\tone\thand,\tI like\tURIs\tbeing\topaque\tto\tdiscourage\tclients\tfrom\thardcoding\tURI\ttemplates,\tbut\ton\tthe other\thand,\tthis\tapproach\tdoes\tmake\tthings\tvery\tobvious\tand\tcan\tsimplify\trequest\trouting.\n\nFor\tRPC,\tthings\tcan\tbe\ta\tlittle\ttrickier.\tI\thave\thandled\tthis\twith\tprotocol\tbuffers\tby\tputting my\tmethods\tin\tdifferent\tnamespaces\t—\tfor\texample,\tv1.createCustomer\tand v2.createCustomer\t—\tbut\twhen\tyou\tare\ttrying\tto\tsupport\tdifferent\tversions\tof\tthe\tsame types\tbeing\tsent\tover\tthe\tnetwork,\tthis\tcan\tbecome\treally\tpainful.",
      "content_length": 972,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 125,
      "content": "Use\tMultiple\tConcurrent\tService\tVersions\n\nAnother\tversioning\tsolution\toften\tcited\tis\tto\thave\tdifferent\tversions\tof\tthe\tservice\tlive\tat once,\tand\tfor\tolder\tconsumers\tto\troute\ttheir\ttraffic\tto\tthe\tolder\tversion,\twith\tnewer versions\tseeing\tthe\tnew\tone,\tas\tshown\tin\tFigure\t4-6.\tThis\tis\tthe\tapproach\tused\tsparingly by\tNetflix\tin\tsituations\twhere\tthe\tcost\tof\tchanging\tolder\tconsumers\tis\ttoo\thigh,\tespecially in\trare\tcases\twhere\tlegacy\tdevices\tare\tstill\ttied\tto\tolder\tversions\tof\tthe\tAPI.\tPersonally,\tI am\tnot\ta\tfan\tof\tthis\tidea,\tand\tunderstand\twhy\tNetflix\tuses\tit\trarely.\tFirst,\tif\tI\tneed\tto\tfix\tan internal\tbug\tin\tmy\tservice,\tI\tnow\thave\tto\tfix\tand\tdeploy\ttwo\tdifferent\tsets\tof\tservices. This\twould\tprobably\tmean\tI\thave\tto\tbranch\tthe\tcodebase\tfor\tmy\tservice,\tand\tthis\tis always\tproblematic.\tSecond,\tit\tmeans\tI\tneed\tsmarts\tto\thandle\tdirecting\tconsumers\tto\tthe right\tmicroservice.\tThis\tbehavior\tinevitably\tends\tup\tsitting\tin\tmiddleware\tsomewhere\tor\ta bunch\tof\tnginx\tscripts,\tmaking\tit\tharder\tto\treason\tabout\tthe\tbehavior\tof\tthe\tsystem. Finally,\tconsider\tany\tpersistent\tstate\tour\tservice\tmight\tmanage.\tCustomers\tcreated\tby either\tversion\tof\tthe\tservice\tneed\tto\tbe\tstored\tand\tmade\tvisible\tto\tall\tservices,\tno\tmatter which\tversion\twas\tused\tto\tcreate\tthe\tdata\tin\tthe\tfirst\tplace.\tThis\tcan\tbe\tan\tadditional source\tof\tcomplexity.",
      "content_length": 1315,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 126,
      "content": "Figure\t4-6.\tRunning\tmultiple\tversions\tof\tthe\tsame\tservice\tto\tsupport\told\tendpoints\n\nCoexisting\tconcurrent\tservice\tversions\tfor\ta\tshort\tperiod\tof\ttime\tcan\tmake\tperfect\tsense, especially\twhen\tyou’re\tdoing\tthings\tlike\tblue/green\tdeployments\tor\tcanary\treleases\t(we’ll be\tdiscussing\tthese\tpatterns\tmore\tin\tChapter\t7).\tIn\tthese\tsituations,\twe\tmay\tbe\tcoexisting versions\tonly\tfor\ta\tfew\tminutes\tor\tperhaps\thours,\tand\tnormally\twill\thave\tonly\ttwo different\tversions\tof\tthe\tservice\tpresent\tat\tthe\tsame\ttime.\tThe\tlonger\tit\ttakes\tfor\tyou\tto\tget consumers\tupgraded\tto\tthe\tnewer\tversion\tand\treleased,\tthe\tmore\tyou\tshould\tlook\tto coexist\tdifferent\tendpoints\tin\tthe\tsame\tmicroservice\trather\tthan\tcoexist\tentirely\tdifferent versions.\tI\tremain\tunconvinced\tthat\tthis\twork\tis\tworthwhile\tfor\tthe\taverage\tproject.",
      "content_length": 790,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 127,
      "content": "User\tInterfaces\n\nSo\tfar,\twe\thaven’t\treally\ttouched\ton\tthe\tworld\tof\tthe\tuser\tinterface.\tA\tfew\tof\tyou\tout\tthere might\tjust\tbe\tproviding\ta\tcold,\thard,\tclinical\tAPI\tto\tyour\tcustomers,\tbut\tmany\tof\tus\tfind ourselves\twanting\tto\tcreate\tbeautiful,\tfunctional\tuser\tinterfaces\tthat\twill\tdelight\tour customers.\tBut\twe\treally\tdo\tneed\tto\tthink\tabout\tthem\tin\tthe\tcontext\tof\tintegration.\tThe user\tinterface,\tafter\tall,\tis\twhere\twe’ll\tbe\tpulling\tall\tthese\tmicroservices\ttogether\tinto something\tthat\tmakes\tsense\tto\tour\tcustomers.\n\nIn\tthe\tpast,\twhen\tI\tfirst\tstarted\tcomputing,\twe\twere\tmostly\ttalking\tabout\tbig,\tfat\tclients that\tran\ton\tour\tdesktops.\tI\tspent\tmany\thours\twith\tMotif\tand\tthen\tSwing\ttrying\tto\tmake my\tsoftware\tas\tnice\tto\tuse\tas\tpossible.\tOften\tthese\tsystems\twere\tjust\tfor\tthe\tcreation\tand manipulation\tof\tlocal\tfiles,\tbut\tmany\tof\tthem\thad\ta\tserver-side\tcomponent.\tMy\tfirst\tjob\tat ThoughtWorks\tinvolved\tcreating\ta\tSwing-based\telectronic\tpoint-of-sale\tsystem\tthat\twas just\tpart\tof\ta\tlarge\tnumber\tof\tmoving\tparts,\tmost\tof\twhich\twere\ton\tthe\tserver.\n\nThen\tcame\tthe\tWeb.\tWe\tstarted\tthinking\tof\tour\tUIs\tas\tbeing\tthin\tinstead,\twith\tmore\tlogic on\tthe\tserver\tside.\tIn\tthe\tbeginning,\tour\tserver-side\tprograms\trendered\tthe\tentire\tpage\tand sent\tit\tto\tthe\tclient\tbrowser,\twhich\tdid\tvery\tlittle.\tAny\tinteractions\twere\thandled\ton\tthe server\tside,\tvia\tGETs\tand\tPOSTs\ttriggered\tby\tthe\tuser\tclicking\ton\tlinks\tor\tfilling\tin\tforms. Over\ttime,\tJavaScript\tbecame\ta\tmore\tpopular\toption\tto\tadd\tdynamic\tbehavior\tto\tthe browser-based\tUI,\tand\tsome\tapplications\tcould\tnow\tbe\targued\tto\tbe\tas\tfat\tas\tthe\told desktop\tclients.",
      "content_length": 1585,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 128,
      "content": "Toward\tDigital\n\nOver\tthe\tlast\tcouple\tof\tyears,\torganizations\thave\tstarted\tto\tmove\taway\tfrom\tthinking\tthat web\tor\tmobile\tshould\tbe\ttreated\tdifferently;\tthey\tare\tinstead\tthinking\tabout\tdigital\tmore holistically.\tWhat\tis\tthe\tbest\tway\tfor\tour\tcustomers\tto\tuse\tthe\tservices\twe\toffer?\tAnd\twhat does\tthat\tdo\tto\tour\tsystem\tarchitecture?\tThe\tunderstanding\tthat\twe\tcannot\tpredict\texactly how\ta\tcustomer\tmight\tend\tup\tinteracting\twith\tour\tcompany\thas\tdriven\tadoption\tof\tmore granular\tAPIs,\tlike\tthose\tdelivered\tby\tmicroservices.\tBy\tcombining\tthe\tcapabilities\tour services\texpose\tin\tdifferent\tways,\twe\tcan\tcurate\tdifferent\texperiences\tfor\tour\tcustomers on\ttheir\tdesktop\tapplication,\tmobile\tdevice,\twearable\tdevice,\tor\teven\tin\tphysical\tform\tif they\tvisit\tour\tbrick-and-mortar\tstore.\n\nSo\tthink\tof\tuser\tinterfaces\tas\tcompositional\tlayers\t—\tplaces\twhere\twe\tweave\ttogether\tthe various\tstrands\tof\tthe\tcapabilities\twe\toffer.\tSo\twith\tthat\tin\tmind,\thow\tdo\twe\tpull\tall\tthese strands\ttogether?",
      "content_length": 969,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 129,
      "content": "Constraints\n\nConstraints\tare\tthe\tdifferent\tforms\tin\twhich\tour\tusers\tinteract\twith\tour\tsystem.\tOn\ta desktop\tweb\tapplication,\tfor\texample,\twe\tconsider\tconstraints\tsuch\tas\twhat\tbrowser visitors\tare\tusing,\tor\ttheir\tresolution.\tBut\tmobile\thas\tbrought\ta\twhole\thost\tof\tnew constraints.\tThe\tway\tour\tmobile\tapplications\tcommunicate\twith\tthe\tserver\tcan\thave\tan impact.\tIt\tisn’t\tjust\tabout\tpure\tbandwidth\tconcerns,\twhere\tthe\tlimitations\tof\tmobile networks\tcan\tplay\ta\tpart.\tDifferent\tsorts\tof\tinteractions\tcan\tdrain\tbattery\tlife,\tleading\tto some\tcross\tcustomers.\n\nThe\tnature\tof\tinteractions\tchanges,\ttoo.\tI\tcan’t\teasily\tright-click\ton\ta\ttablet.\tOn\ta\tmobile phone,\tI\tmay\twant\tto\tdesign\tmy\tinterface\tto\tbe\tused\tmostly\tone-handed,\twith\tmost operations\tbeing\tcontrolled\tby\ta\tthumb.\tElsewhere,\tI\tmight\tallow\tpeople\tto\tinteract\twith services\tvia\tSMS\tin\tplaces\twhere\tbandwidth\tis\tat\ta\tpremium\t—\tthe\tuse\tof\tSMS\tas\tan interface\tis\thuge\tin\tthe\tglobal\tsouth,\tfor\texample.\n\nSo,\talthough\tour\tcore\tservices\t—\tour\tcore\toffering\t—\tmight\tbe\tthe\tsame,\twe\tneed\ta\tway to\tadapt\tthem\tfor\tthe\tdifferent\tconstraints\tthat\texist\tfor\teach\ttype\tof\tinterface.\tWhen\twe look\tat\tdifferent\tstyles\tof\tuser\tinterface\tcomposition,\twe\tneed\tto\tensure\tthat\tthey\taddress this\tchallenge.\tLet’s\tlook\tat\ta\tfew\tmodels\tof\tuser\tinterfaces\tto\tsee\thow\tthis\tmight\tbe achieved.",
      "content_length": 1315,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 130,
      "content": "API\tComposition\n\nAssuming\tthat\tour\tservices\talready\tspeak\tXML\tor\tJSON\tto\teach\tother\tvia\tHTTP,\tan obvious\toption\tavailable\tto\tus\tis\tto\thave\tour\tuser\tinterface\tinteract\tdirectly\twith\tthese APIs,\tas\tin\tFigure\t4-7.\tA\tweb-based\tUI\tcould\tuse\tJavaScript\tGET\trequests\tto\tretrieve data,\tor\tPOST\trequests\tto\tchange\tit.\tEven\tfor\tnative\tmobile\tapplications,\tinitiating\tHTTP communications\tis\tfairly\tstraightforward.\tThe\tUI\twould\tthen\tneed\tto\tcreate\tthe\tvarious components\tthat\tmake\tup\tthe\tinterface,\thandling\tsynchronization\tof\tstate\tand\tthe\tlike\twith the\tserver.\tIf\twe\twere\tusing\ta\tbinary\tprotocol\tfor\tservice-to-service\tcommunication,\tthis would\tbe\tmore\tdifficult\tfor\tweb-based\tclients,\tbut\tcould\tbe\tfine\tfor\tnative\tmobile\tdevices.\n\nThere\tare\ta\tcouple\tof\tdownsides\twith\tthis\tapproach.\tFirst,\twe\thave\tlittle\tability\tto\ttailor the\tresponses\tfor\tdifferent\tsorts\tof\tdevices.\tFor\texample,\twhen\tI\tretrieve\ta\tcustomer record,\tdo\tI\tneed\tto\tpull\tback\tall\tthe\tsame\tdata\tfor\ta\tmobile\tshop\tas\tI\tdo\tfor\ta\thelpdesk application?\tOne\tsolution\tto\tthis\tapproach\tis\tto\tallow\tconsumers\tto\tspecify\twhat\tfields\tto pull\tback\twhen\tthey\tmake\ta\trequest,\tbut\tthis\tassumes\tthat\teach\tservice\tsupports\tthis\tform of\tinteraction.\n\nAnother\tkey\tquestion:\twho\tcreates\tthe\tuser\tinterface?\tThe\tpeople\twho\tlook\tafter\tthe services\tare\tremoved\tfrom\thow\ttheir\tservices\tare\tsurfaced\tto\tthe\tusers\t—\tfor\texample,\tif another\tteam\tis\tcreating\tthe\tUI,\twe\tcould\tbe\tdrifting\tback\tinto\tthe\tbad\told\tdays\tof\tlayered architecture\twhere\tmaking\teven\tsmall\tchanges\trequires\tchange\trequests\tto\tmultiple\tteams.\n\nFigure\t4-7.\tUsing\tmultiple\tAPIs\tto\tpresent\ta\tuser\tinterface\n\nThis\tcommunication\tcould\talso\tbe\tfairly\tchatty.\tOpening\tlots\tof\tcalls\tdirectly\tto\tservices can\tbe\tquite\tintensive\tfor\tmobile\tdevices,\tand\tcould\tbe\ta\tvery\tinefficient\tuse\tof\ta customer’s\tmobile\tplan!\tHaving\tan\tAPI\tgateway\tcan\thelp\there,\tas\tyou\tcould\texpose\tcalls that\taggregate\tmultiple\tunderlying\tcalls,\talthough\tthat\titself\tcan\thave\tsome\tdownsides\tthat we’ll\texplore\tshortly.",
      "content_length": 1981,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 131,
      "content": "UI\tFragment\tComposition\n\nRather\tthan\thaving\tour\tUI\tmake\tAPI\tcalls\tand\tmap\teverything\tback\tto\tUI\tcontrols,\twe could\thave\tour\tservices\tprovide\tparts\tof\tthe\tUI\tdirectly,\tand\tthen\tjust\tpull\tthese\tfragments in\tto\tcreate\ta\tUI,\tas\tin\tFigure\t4-8.\tImagine,\tfor\texample,\tthat\tthe\trecommendation\tservice provides\ta\trecommendation\twidget\tthat\tis\tcombined\twith\tother\tcontrols\tor\tUI\tfragments to\tcreate\tan\toverall\tUI.\tIt\tmight\tget\trendered\tas\ta\tbox\ton\ta\tweb\tpage\talong\twith\tother content.\n\nA\tvariation\tof\tthis\tapproach\tthat\tcan\twork\twell\tis\tto\tassemble\ta\tseries\tof\tcoarser-grained parts\tof\ta\tUI.\tSo\trather\tthan\tcreating\tsmall\twidgets,\tyou\tare\tassembling\tentire\tpanes\tof\ta thick\tclient\tapplication,\tor\tperhaps\ta\tset\tof\tpages\tfor\ta\twebsite.\n\nThese\tcoarser-grained\tfragments\tare\tserved\tup\tfrom\tserver-side\tapps\tthat\tare\tin\tturn making\tthe\tappropriate\tAPI\tcalls.\tThis\tmodel\tworks\tbest\twhen\tthe\tfragments\talign\twell\tto team\townership.\tFor\texample,\tperhaps\tthe\tteam\tthat\tlooks\tafter\torder\tmanagement\tin\tthe music\tshop\tserves\tup\tall\tthe\tpages\tassociated\twith\torder\tmanagement.\n\nFigure\t4-8.\tServices\tdirectly\tserving\tup\tUI\tcomponents\tfor\tassembly\n\nYou\tstill\tneed\tsome\tsort\tof\tassembly\tlayer\tto\tpull\tthese\tparts\ttogether.\tThis\tcould\tbe\tas simple\tas\tsome\tserver-side\ttemplating,\tor,\twhere\teach\tset\tof\tpages\tcomes\tfrom\ta\tdifferent app,\tperhaps\tyou’ll\tneed\tsome\tsmart\tURI\trouting.\n\nOne\tof\tthe\tkey\tadvantages\tof\tthis\tapproach\tis\tthat\tthe\tsame\tteam\tthat\tmakes\tchanges\tto the\tservices\tcan\talso\tbe\tin\tcharge\tof\tmaking\tchanges\tto\tthose\tparts\tof\tthe\tUI.\tIt\tallows\tus to\tget\tchanges\tout\tfaster.\tBut\tthere\tare\tsome\tproblems\twith\tthis\tapproach.\n\nFirst,\tensuring\tconsistency\tof\tthe\tuser\texperience\tis\tsomething\twe\tneed\tto\taddress.\tUsers",
      "content_length": 1700,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 132,
      "content": "want\tto\thave\ta\tseamless\texperience,\tnot\tto\tfeel\tthat\tdifferent\tparts\tof\tthe\tinterface\twork\tin different\tways,\tor\tpresent\ta\tdifferent\tdesign\tlanguage.\tThere\tare\ttechniques\tto\tavoid\tthis problem,\tthough,\tsuch\tas\tliving\tstyle\tguides,\twhere\tassets\tlike\tHTML\tcomponents,\tCSS, and\timages\tcan\tbe\tshared\tto\thelp\tgive\tsome\tlevel\tof\tconsistency.\n\nAnother\tprobem\tis\tharder\tto\tdeal\twith.\tWhat\thappens\twith\tnative\tapplications\tor\tthick clients?\tWe\tcan’t\tserve\tup\tUI\tcomponents.\tWe\tcould\tuse\ta\thybrid\tapproach\tand\tuse\tnative applications\tto\tserve\tup\tHTML\tcomponents,\tbut\tthis\tapproach\thas\tbeen\tshown\ttime\tand again\tto\thave\tdownsides.\tSo\tif\tyou\tneed\ta\tnative\texperience,\twe\twill\thave\tto\tfall\tback\tto an\tapproach\twhere\tthe\tfrontend\tapplication\tmakes\tAPI\tcalls\tand\thandles\tthe\tUI\titself.\tBut even\tif\twe\tconsider\tweb-only\tUIs,\twe\tstill\tmay\twant\tvery\tdifferent\ttreatments\tfor\tdifferent types\tof\tdevices.\tBuilding\tresponsive\tcomponents\tcan\thelp,\tof\tcourse.\n\nThere\tis\tone\tkey\tproblem\twith\tthis\tapproach\tthat\tI’m\tnot\tsure\tcan\tbe\tsolved.\tSometimes the\tcapabilities\toffered\tby\ta\tservice\tdo\tnot\tfit\tneatly\tinto\ta\twidget\tor\ta\tpage.\tSure,\tI\tmight want\tto\tsurface\trecommendations\tin\ta\tbox\ton\ta\tpage\ton\tour\twebsite,\tbut\twhat\tif\tI\twant\tto weave\tin\tdynamic\trecommendations\telsewhere?\tWhen\tI\tsearch,\tI\twant\tthe\ttype\tahead\tto automatically\ttrigger\tfresh\trecommendations,\tfor\texample.\tThe\tmore\tcross-cutting\ta\tform of\tinteraction\tis,\tthe\tless\tlikely\tthis\tmodel\twill\tfit\tand\tthe\tmore\tlikely\tit\tis\tthat\twe’ll\tfall back\tto\tjust\tmaking\tAPI\tcalls.",
      "content_length": 1508,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 133,
      "content": "Backends\tfor\tFrontends\n\nA\tcommon\tsolution\tto\tthe\tproblem\tof\tchatty\tinterfaces\twith\tbackend\tservices,\tor\tthe\tneed to\tvary\tcontent\tfor\tdifferent\ttypes\tof\tdevices,\tis\tto\thave\ta\tserver-side\taggregation endpoint,\tor\tAPI\tgateway.\tThis\tcan\tmarshal\tmultiple\tbackend\tcalls,\tvary\tand\taggregate content\tif\tneeded\tfor\tdifferent\tdevices,\tand\tserve\tit\tup,\tas\twe\tsee\tin\tFigure\t4-9.\tI’ve\tseen this\tapproach\tlead\tto\tdisaster\twhen\tthese\tserver-side\tendpoints\tbecome\tthick\tlayers\twith too\tmuch\tbehavior.\tThey\tend\tup\tgetting\tmanaged\tby\tseparate\tteams,\tand\tbeing\tanother place\twhere\tlogic\thas\tto\tchange\twhenever\tsome\tfunctionality\tchanges.\n\nFigure\t4-9.\tUsing\ta\tsingle\tmonolithic\tgateway\tto\thandle\tcalls\tto/from\tUIs",
      "content_length": 693,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 134,
      "content": "The\tproblem\tthat\tcan\toccur\tis\tthat\tnormally\twe’ll\thave\tone\tgiant\tlayer\tfor\tall\tour\tservices. This\tleads\tto\teverything\tbeing\tthrown\tin\ttogether,\tand\tsuddenly\twe\tstart\tto\tlose\tisolation of\tour\tvarious\tuser\tinterfaces,\tlimiting\tour\tability\tto\trelease\tthem\tindependently.\tA\tmodel I\tprefer\tand\tthat\tI’ve\tseen\twork\twell\tis\tto\trestrict\tthe\tuse\tof\tthese\tbackends\tto\tone\tspecific user\tinterface\tor\tapplication,\tas\twe\tsee\tin\tFigure\t4-10.\n\nFigure\t4-10.\tUsing\tdedicated\tbackends\tfor\tfrontends\n\nThis\tpattern\tis\tsometimes\treferred\tto\tas\tbackends\tfor\tfrontends\t(BFFs).\tIt\tallows\tthe\tteam focusing\ton\tany\tgiven\tUI\tto\talso\thandle\tits\town\tserver-side\tcomponents.\tYou\tcan\tsee these\tbackends\tas\tparts\tof\tthe\tuser\tinterface\tthat\thappen\tto\tbe\tembedded\tin\tthe\tserver. Some\ttypes\tof\tUI\tmay\tneed\ta\tminimal\tserver-side\tfootprint,\twhile\tothers\tmay\tneed\ta\tlot more.\tIf\tyou\tneed\tan\tAPI\tauthentication\tand\tauthorization\tlayer,\tthis\tcan\tsit\tbetween\tour BFFs\tand\tour\tUIs.\tWe’ll\texplore\tthis\tmore\tin\tChapter\t9.\n\nThe\tdanger\twith\tthis\tapproach\tis\tthe\tsame\tas\twith\tany\taggregating\tlayer;\tit\tcan\ttake\ton logic\tit\tshouldn’t.\tThe\tbusiness\tlogic\tfor\tthe\tvarious\tcapabilities\tthese\tbackends\tuse should\tstay\tin\tthe\tservices\tthemselves.\tThese\tBFFs\tshould\tonly\tcontain\tbehavior\tspecific to\tdelivering\ta\tparticular\tuser\texperience.",
      "content_length": 1286,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 135,
      "content": "A\tHybrid\tApproach\n\nMany\tof\tthe\taforementioned\toptions\tdon’t\tneed\tto\tbe\tone-size-fits-all.\tI\tcould\tsee\tan organization\tadopting\tthe\tapproach\tof\tfragment-based\tassembly\tto\tcreate\ta\twebsite,\tbut using\ta\tbackends-for-frontends\tapproach\twhen\tit\tcomes\tto\tits\tmobile\tapplication.\tThe\tkey point\tis\tthat\twe\tneed\tto\tretain\tcohesion\tof\tthe\tunderlying\tcapabilities\tthat\twe\toffer\tour users.\tWe\tneed\tto\tensure\tthat\tlogic\tassociated\twith\tordering\tmusic\tor\tchanging\tcustomer details\tlives\tinside\tthose\tservices\tthat\thandle\tthose\toperations,\tand\tdoesn’t\tget\tsmeared\tall over\tour\tsystem.\tAvoiding\tthe\ttrap\tof\tputting\ttoo\tmuch\tbehavior\tinto\tany\tintermediate layers\tis\ta\ttricky\tbalancing\tact.",
      "content_length": 672,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 136,
      "content": "Integrating\twith\tThird-Party\tSoftware\n\nWe’ve\tlooked\tat\tapproaches\tto\tbreaking\tapart\texisting\tsystems\tthat\tare\tunder\tour\tcontrol, but\twhat\tabout\twhen\twe\tcan’t\tchange\tthe\tthings\twe\ttalk\tto?\tFor\tmany\tvalid\treasons,\tthe organizations\twe\twork\tfor\tbuy\tcommercial\toff-the-shelf\tsoftware\t(COTS)\tor\tmake\tuse\tof software\tas\ta\tservice\t(SaaS)\tofferings\tover\twhich\twe\thave\tlittle\tcontrol.\tSo\thow\tdo\twe integrate\twith\tthem\tsensibly?\n\nIf\tyou’re\treading\tthis\tbook,\tyou\tprobably\twork\tat\tan\torganization\tthat\twrites\tcode.\tYou might\twrite\tsoftware\tfor\tyour\town\tinternal\tpurposes\tor\tfor\tan\texternal\tclient,\tor\tboth. Nonetheless,\teven\tif\tyou\tare\tan\torganization\twith\tthe\tability\tto\tcreate\ta\tsignificant\tamount of\tcustom\tsoftware,\tyou’ll\tstill\tuse\tsoftware\tproducts\tprovided\tby\texternal\tparties,\tbe\tthey commercial\tor\topen\tsource.\tWhy\tis\tthis?\n\nFirst,\tyour\torganization\talmost\tcertainly\thas\ta\tgreater\tdemand\tfor\tsoftware\tthan\tcan\tbe satisfied\tinternally.\tThink\tof\tall\tthe\tproducts\tyou\tuse,\tfrom\toffice\tproductivity\ttools\tlike Excel\tto\toperating\tsystems\tto\tpayroll\tsystems.\tCreating\tall\tof\tthose\tfor\tyour\town\tuse would\tbe\ta\tmammoth\tundertaking.\tSecond,\tand\tmost\timportant,\tit\twouldn’t\tbe\tcost effective!\tThe\tcost\tfor\tyou\tto\tbuild\tyour\town\temail\tsystem,\tfor\texample,\tis\tlikely\tto\tdwarf the\tcost\tof\tusing\tan\texisting\tcombination\tof\tmail\tserver\tand\tclient,\teven\tif\tyou\tgo\tfor commercial\toptions.\n\nMy\tclients\toften\tstruggle\twith\tthe\tquestion\t“Should\tI\tbuild,\tor\tshould\tI\tbuy?”\tIn\tgeneral, the\tadvice\tI\tand\tmy\tcolleagues\tgive\twhen\thaving\tthis\tconversation\twith\tthe\taverage enterprise\torganization\tboils\tdown\tto\t“Build\tif\tit\tis\tunique\tto\twhat\tyou\tdo,\tand\tcan\tbe considered\ta\tstrategic\tasset;\tbuy\tif\tyour\tuse\tof\tthe\ttool\tisn’t\tthat\tspecial.”\n\nFor\texample,\tthe\taverage\torganization\twould\tnot\tconsider\tits\tpayroll\tsystem\tto\tbe\ta strategic\tasset.\tPeople\ton\tthe\twhole\tget\tpaid\tthe\tsame\tthe\tworld\tover.\tLikewise,\tmost organizations\ttend\tto\tbuy\tcontent\tmanagement\tsystems\t(CMSes)\toff\tthe\tshelf,\tas\ttheir\tuse of\tsuch\ta\ttool\tisn’t\tconsidered\tsomething\tthat\tis\tkey\tto\ttheir\tbusiness.\tOn\tthe\tother\thand,\tI was\tinvolved\tearly\ton\tin\trebuilding\tthe\tGuardian’s\twebsite,\tand\tthere\tthe\tdecision\twas made\tto\tbuild\ta\tbespoke\tcontent\tmanagement\tsystem,\tas\tit\twas\tcore\tto\tthe\tnewspaper’s business.\n\nSo\tthe\tnotion\tthat\twe\twill\toccasionally\tencounter\tcommercial,\tthird-party\tsoftware\tis sensible,\tand\tto\tbe\twelcomed.\tHowever,\tmany\tof\tus\tend\tup\tcursing\tsome\tof\tthese systems.\tWhy\tis\tthat?",
      "content_length": 2435,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 137,
      "content": "Lack\tof\tControl\n\nOne\tchallenge\tassociated\twith\tintegrating\twith\tand\textending\tthe\tcapabilities\tof\tCOTS products\tlike\tCMS\tor\tSaaS\ttools\tis\tthat\ttypically\tmany\tof\tthe\ttechnical\tdecisions\thave been\tmade\tfor\tyou.\tHow\tdo\tyou\tintegrate\twith\tthe\ttool?\tThat’s\ta\tvendor\tdecision.\tWhich programming\tlanguage\tcan\tyou\tuse\tto\textend\tthe\ttool?\tUp\tto\tthe\tvendor.\tCan\tyou\tstore the\tconfiguration\tfor\tthe\ttool\tin\tversion\tcontrol,\tand\trebuild\tfrom\tscratch,\tso\tas\tto\tenable continuous\tintegration\tof\tcustomizations?\tIt\tdepends\ton\tchoices\tthe\tvendor\tmakes.\n\nIf\tyou\tare\tlucky,\thow\teasy\t—\tor\thard\t—\tit\tis\tto\twork\twith\tthe\ttool\tfrom\ta\tdevelopment point\tof\tview\thas\tbeen\tconsidered\tas\tpart\tof\tthe\ttool\tselection\tprocess.\tBut\teven\tthen,\tyou are\teffectively\tceding\tsome\tlevel\tof\tcontrol\tto\tan\toutside\tparty.\tThe\ttrick\tis\tto\tbring\tthe integration\tand\tcustomization\twork\tback\ton\tto\tyour\tterms.",
      "content_length": 865,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 138,
      "content": "Customization\n\nMany\ttools\tthat\tenterprise\torganizations\tpurchase\tsell\tthemselves\ton\ttheir\tability\tto\tbe heavily\tcustomized\tjust\tfor\tyou.\tBeware!\tOften,\tdue\tto\tthe\tnature\tof\tthe\ttool\tchain\tyou have\taccess\tto,\tthe\tcost\tof\tcustomization\tcan\tbe\tmore\texpensive\tthan\tbuilding\tsomething bespoke\tfrom\tscratch!\tIf\tyou’ve\tdecided\tto\tbuy\ta\tproduct\tbut\tthe\tparticular\tcapabilities\tit provides\taren’t\tthat\tspecial\tto\tyou,\tit\tmight\tmake\tmore\tsense\tto\tchange\thow\tyour organization\tworks\trather\tthan\tembark\ton\tcomplex\tcustomization.\n\nContent\tmanagement\tsystems\tare\ta\tgreat\texample\tof\tthis\tdanger.\tI\thave\tworked\twith multiple\tCMSes\tthat\tby\tdesign\tdo\tnot\tsupport\tcontinuous\tintegration,\tthat\thave\tterrible APIs,\tand\tfor\twhich\teven\ta\tminor-point\tupgrade\tin\tthe\tunderlying\ttool\tcan\tbreak\tany customizations\tyou\thave\tmade.\n\nSalesforce\tis\tespecially\ttroublesome\tin\tthis\tregard.\tFor\tmany\tyears\tit\thas\tpushed\tits Force.com\tplatform,\twhich\trequires\tthe\tuse\tof\ta\tprogramming\tlanguage,\tApex,\tthat\texists only\twithin\tthe\tForce.com\tecosystem!",
      "content_length": 1013,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 139,
      "content": "Integration\tSpaghetti\n\nAnother\tchallenge\tis\thow\tyou\tintegrate\twith\tthe\ttool.\tAs\twe\tdiscussed\tearlier,\tthinking carefully\tabout\thow\tyou\tintegrate\tbetween\tservices\tis\timportant,\tand\tideally\tyou\twant\tto standardize\ton\ta\tsmall\tnumber\tof\ttypes\tof\tintegration.\tBut\tif\tone\tproduct\tdecides\tto\tuse\ta proprietary\tbinary\tprotocol,\tanother\tsome\tflavor\tof\tSOAP,\tand\tanother\tXML-RPC,\twhat are\tyou\tleft\twith?\tEven\tworse\tare\tthe\ttools\tthat\tallow\tyou\tto\treach\tright\tinside\ttheir underlying\tdata\tstores,\tleading\tto\tall\tthe\tsame\tcoupling\tissues\twe\tdiscussed\tearlier.",
      "content_length": 547,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 140,
      "content": "On\tYour\tOwn\tTerms\n\nCOTS\tand\tSAAS\tproducts\tabsolutely\thave\ttheir\tplace,\tand\tit\tisn’t\tfeasible\t(or\tsensible) for\tmost\tof\tus\tto\tbuild\teverything\tfrom\tscratch.\tSo\thow\tdo\twe\tresolve\tthese\tchallenges? The\tkey\tis\tto\tmove\tthings\tback\ton\tto\tyour\town\tterms.\n\nThe\tcore\tidea\there\tis\tto\tdo\tany\tcustomizations\ton\ta\tplatform\tyou\tcontrol,\tand\tto\tlimit\tthe number\tof\tdifferent\tconsumers\tof\tthe\ttool\titself.\tTo\texplore\tthis\tidea\tin\tdetail,\tlet’s\tlook\tat a\tcouple\tof\texamples.\n\nExample:\tCMS\tas\ta\tservice\n\nIn\tmy\texperience,\tthe\tCMS\tis\tone\tof\tthe\tmost\tcommonly\tused\tproduct\tthat\tneeds\tto\tbe customized\tor\tintegrated\twith.\tThe\treason\tfor\tthis\tis\tthat\tunless\tyou\twant\ta\tbasic\tstatic site,\tthe\taverage\tenterprise\torganization\twants\tto\tenrich\tthe\tfunctionality\tof\tits\twebsite with\tdynamic\tcontent\tlike\tcustomer\trecords\tor\tthe\tlatest\tproduct\tofferings.\tThe\tsource\tof this\tdynamic\tcontent\tis\ttypically\tother\tservices\tinside\tthe\torganization,\twhich\tyou\tmay have\tactually\tbuilt\tyourself.\n\nThe\ttemptation\t—\tand\toften\tthe\tselling\tpoint\tof\tthe\tCMS\t—\tis\tthat\tyou\tcan\tcustomize\tthe CMS\tto\tpull\tin\tall\tthis\tspecial\tcontent\tand\tdisplay\tit\tto\tthe\toutside\tworld.\tHowever,\tthe development\tenvironment\tfor\tthe\taverage\tCMS\tis\tterrible.\n\nLet’s\tlook\tat\twhat\tthe\taverage\tCMS\tspecializes\tin,\tand\twhat\twe\tprobably\tbought\tit\tfor: content\tcreation\tand\tcontent\tmanagement.\tMost\tCMSes\tare\tpretty\tbad\teven\tat\tdoing\tpage layout,\ttypically\tproviding\tdrag-and-drop\ttools\tthat\tdon’t\tcut\tthe\tmustard.\tAnd\teven\tthen, you\tend\tup\tneeding\tto\thave\tsomeone\twho\tunderstands\tHTML\tand\tCSS\tto\tfine-tune\tthe CMS\ttemplates.\tThey\ttend\tto\tbe\tterrible\tplatforms\ton\twhich\tto\tbuild\tcustom\tcode.\n\nThe\tanswer?\tFront\tthe\tCMS\twith\tyour\town\tservice\tthat\tprovides\tthe\twebsite\tto\tthe\toutside world,\tas\tshown\tin\tFigure\t4-11.\tTreat\tthe\tCMS\tas\ta\tservice\twhose\trole\tis\tto\tallow\tfor\tthe creation\tand\tretrieval\tof\tcontent.\tIn\tyour\town\tservice,\tyou\twrite\tthe\tcode\tand\tintegrate with\tservices\thow\tyou\twant.\tYou\thave\tcontrol\tover\tscaling\tthe\twebsite\t(many\tcommercial CMSes\tprovide\ttheir\town\tproprietary\tadd-ons\tto\thandle\tload),\tand\tyou\tcan\tpick\tthe templating\tsystem\tthat\tmakes\tsense.\n\nMost\tCMSes\talso\tprovide\tAPIs\tto\tallow\tfor\tcontent\tcreation,\tso\tyou\talso\thave\tthe\tability to\tfront\tthat\twith\tyour\town\tservice\tfaçade.\tFor\tsome\tsituations,\twe’ve\teven\tused\tsuch\ta façade\tto\tabstract\tout\tthe\tAPIs\tfor\tretrieving\tcontent.",
      "content_length": 2329,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 141,
      "content": "Figure\t4-11.\tHiding\ta\tCMS\tusing\tyour\town\tservice\n\nWe’ve\tused\tthis\tpattern\tmultiple\ttimes\tacross\tThoughtWorks\tin\tthe\tlast\tfew\tyears,\tand I’ve\tdone\tthis\tmore\tthan\tonce\tmyself.\tOne\tnotable\texample\twas\ta\tclient\tthat\twas\tlooking to\tpush\tout\ta\tnew\twebsite\tfor\tits\tproducts.\tInitially,\tit\twanted\tto\tbuild\tthe\tentire\tsolution on\tthe\tCMS,\tbut\tit\thad\tyet\tto\tpick\tone.\tWe\tinstead\tsuggested\tthis\tapproach,\tand\tstarted development\tof\tthe\tfronting\twebsite.\tWhile\twaiting\tfor\tthe\tCMS\ttool\tto\tbe\tselected,\twe faked\tit\tby\thaving\ta\tweb\tservice\tthat\tjust\tsurfaced\tstatic\tcontent.\tWe\tended\tup\tgoing\tlive with\tthe\tsite\twell\tbefore\tthe\tCMS\twas\tselected\tby\tusing\tour\tfake\tcontent\tservice\tin production\tto\tsurface\tcontent\tto\tthe\tlive\tsite.\tLater\ton,\twe\twere\table\tto\tjust\tdrop\tin\tthe eventually\tselected\ttool\twithout\tany\tchange\tto\tthe\tfronting\tapplication.\n\nUsing\tthis\tapproach,\twe\tkeep\tthe\tscope\tof\twhat\tthe\tCMS\tdoes\tdown\tto\ta\tminimum\tand move\tcustomizations\tonto\tour\town\ttechnology\tstack.\n\nExample:\tThe\tmultirole\tCRM\tsystem\n\nThe\tCRM\t—\tor\tCustomer\tRelationship\tManagement\t—\ttool\tis\tan\toften-encountered\tbeast that\tcan\tinstill\tfear\tin\tthe\theart\tof\teven\tthe\thardiest\tarchitect.\tThis\tsector,\tas\ttypified\tby vendors\tlike\tSalesforce\tor\tSAP,\tis\trife\twith\texamples\tof\ttools\tthat\ttry\tto\tdo\teverything\tfor you.\tThis\tcan\tlead\tto\tthe\ttool\titself\tbecoming\ta\tsingle\tpoint\tof\tfailure,\tand\ta\ttangled\tknot of\tdependencies.\tMany\timplementations\tof\tCRM\ttools\tI\thave\tseen\tare\tamong\tthe\tbest examples\tof\tadhesive\t(as\topposed\tto\tcohesive)\tservices.\n\nThe\tscope\tof\tsuch\ta\ttool\ttypically\tstarts\tsmall,\tbut\tover\ttime\tit\tbecomes\tan\tincreasingly important\tpart\tof\thow\tyour\torganization\tworks.\tThe\tproblem\tis\tthat\tthe\tdirection\tand choices\tmade\taround\tthis\tnow-vital\tsystem\tare\toften\tmade\tby\tthe\ttool\tvendor\titself,\tnot\tby you.\n\nI\twas\tinvolved\trecently\tin\tan\texercise\tto\ttry\tto\twrest\tsome\tcontrol\tback.\tThe\torganization I\twas\tworking\twith\trealized\tthat\talthough\tit\twas\tusing\tthe\tCRM\ttool\tfor\ta\tlot\tof\tthings,\tit",
      "content_length": 1959,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 142,
      "content": "wasn’t\tgetting\tthe\tvalue\tof\tthe\tincreasing\tcosts\tassociated\twith\tthe\tplatform.\tAt\tthe\tsame time,\tmultiple\tinternal\tsystems\twere\tusing\tthe\tless-than-ideal\tCRM\tAPIs\tfor\tintegration. We\twanted\tto\tmove\tthe\tsystem\tarchitecture\ttoward\ta\tplace\twhere\twe\thad\tservices\tthat modeled\tour\tbusinesses\tdomain,\tand\talso\tlay\tthe\tgroundwork\tfor\ta\tpotential\tmigration.\n\nThe\tfirst\tthing\twe\tdid\twas\tidentify\tthe\tcore\tconcepts\tto\tour\tdomain\tthat\tthe\tCRM\tsystem currently\towned.\tOne\tof\tthese\twas\tthe\tconcept\tof\ta\tproject\t—\tthat\tis,\tsomething\tto\twhich a\tmember\tof\tstaff\tcould\tbe\tassigned.\tMultiple\tother\tsystems\tneeded\tproject\tinformation. What\twe\tdid\twas\tinstead\tcreate\ta\tproject\tservice.\tThis\tservice\texposed\tprojects\tas RESTful\tresources,\tand\tthe\texternal\tsystems\tcould\tmove\ttheir\tintegration\tpoints\tover\tto the\tnew,\teasier-to-work-with\tservice.\tInternally,\tthe\tproject\tservice\twas\tjust\ta\tfaçade, hiding\tthe\tdetail\tof\tthe\tunderlying\tintegration.\tYou\tcan\tsee\tthis\tin\tFigure\t4-12.\n\nFigure\t4-12.\tUsing\tfaçade\tservices\tto\tmask\tthe\tunderlying\tCRM\n\nThe\twork,\twhich\tat\tthe\ttime\tof\tthis\twriting\twas\tstill\tunder\tway,\twas\tto\tidentify\tother domain\tconcepts\tthat\tthe\tCRM\twas\thandling,\tand\tcreate\tmore\tfaçades\tfor\tthem.\tWhen\tthe time\tcomes\tfor\tmigration\taway\tfrom\tthe\tunderlying\tCRM,\twe\tcould\tthen\tlook\tat\teach façade\tin\tturn\tto\tdecide\tif\tan\tinternal\tsoftware\tsolution\tor\tsomething\toff\tthe\tshelf\tcould\tfit the\tbill.",
      "content_length": 1381,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 143,
      "content": "The\tStrangler\tPattern\n\nWhen\tit\tcomes\tto\tlegacy\tor\teven\tCOTS\tplatforms\tthat\taren’t\ttotally\tunder\tour\tcontrol,\twe also\thave\tto\tdeal\twith\twhat\thappens\twhen\twe\twant\tto\tremove\tthem\tor\tat\tleast\tmove\taway from\tthem.\tA\tuseful\tpattern\there\tis\tthe\tStrangler\tApplication\tPattern.\tMuch\tlike\twith\tour example\tof\tfronting\tthe\tCMS\tsystem\twith\tour\town\tcode,\twith\ta\tstrangler\tyou\tcapture\tand intercept\tcalls\tto\tthe\told\tsystem.\tThis\tallows\tyou\tto\tdecide\tif\tyou\troute\tthese\tcalls\tto existing,\tlegacy\tcode,\tor\tdirect\tthem\tto\tnew\tcode\tyou\tmay\thave\twritten.\tThis\tallows\tyou to\treplace\tfunctionality\tover\ttime\twithout\trequiring\ta\tbig\tbang\trewrite.\n\nWhen\tit\tcomes\tto\tmicroservices,\trather\tthan\thaving\ta\tsingle\tmonolithic\tapplication intercepting\tall\tcalls\tto\tthe\texisting\tlegacy\tsystem,\tyou\tmay\tinstead\tuse\ta\tseries\tof microservices\tto\tperform\tthis\tinterception.\tCapturing\tand\tredirecting\tthe\toriginal\tcalls\tcan become\tmore\tcomplex\tin\tthis\tsituation,\tand\tyou\tmay\trequire\tthe\tuse\tof\ta\tproxy\tto\tdo\tthis for\tyou.",
      "content_length": 985,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 144,
      "content": "Summary\n\nWe’ve\tlooked\tat\ta\tnumber\tof\tdifferent\toptions\taround\tintegration,\tand\tI’ve\tshared\tmy thoughts\ton\twhat\tchoices\tare\tmost\tlikely\tto\tensure\tour\tmicroservices\tremain\tas\tdecoupled as\tpossible\tfrom\ttheir\tother\tcollaborators:\n\nAvoid\tdatabase\tintegration\tat\tall\tcosts.\n\nUnderstand\tthe\ttrade-offs\tbetween\tREST\tand\tRPC,\tbut\tstrongly\tconsider\tREST\tas\ta good\tstarting\tpoint\tfor\trequest/response\tintegration.\n\nPrefer\tchoreography\tover\torchestration.\n\nAvoid\tbreaking\tchanges\tand\tthe\tneed\tto\tversion\tby\tunderstanding\tPostel’s\tLaw\tand using\ttolerant\treaders.\n\nThink\tof\tuser\tinterfaces\tas\tcompositional\tlayers.\n\nWe\tcovered\tquite\ta\tlot\there,\tand\tweren’t\table\tto\tgo\tinto\tdepth\ton\tall\tof\tthese\ttopics. Nonetheless,\tthis\tshould\tbe\ta\tgood\tfoundation\tto\tget\tyou\tgoing\tand\tpoint\tyou\tin\tthe\tright direction\tif\tyou\twant\tto\tlearn\tmore.\n\nWe\talso\tspent\tsome\ttime\tlooking\tat\thow\tto\twork\twith\tsystems\tthat\taren’t\tcompletely under\tour\tcontrol\tin\tthe\tform\tof\tCOTS\tproducts.\tIt\tturns\tout\tthat\tthis\tdescription\tcan\tjust as\teasily\tapply\tto\tsoftware\twe\twrote!\n\nSome\tof\tthe\tapproaches\toutlined\there\tapply\tequally\twell\tto\tlegacy\tsoftware,\tbut\twhat\tif we\twant\tto\ttackle\tthe\toften-monumental\ttask\tof\tbringing\tthese\tolder\tsystems\tto\theel\tand decomposing\tthem\tinto\tmore\tusable\tparts?\tWe’ll\tdiscuss\tthat\tin\tdetail\tin\tthe\tnext\tchapter.",
      "content_length": 1298,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 145,
      "content": "Chapter\t5.\tSplitting\tthe\tMonolith\n\nWe’ve\tdiscussed\twhat\ta\tgood\tservice\tlooks\tlike,\tand\twhy\tsmaller\tservers\tmay\tbe\tbetter\tfor us.\tWe\talso\tpreviously\tdiscussed\tthe\timportance\tof\tbeing\table\tto\tevolve\tthe\tdesign\tof\tour systems.\tBut\thow\tdo\twe\thandle\tthe\tfact\tthat\twe\tmay\talready\thave\ta\tlarge\tnumber\tof codebases\tlying\tabout\tthat\tdon’t\tfollow\tthese\tpatterns?\tHow\tdo\twe\tgo\tabout\tdecomposing these\tmonolithic\tapplications\twithout\thaving\tto\tembark\ton\ta\tbig-bang\trewrite?\n\nThe\tmonolith\tgrows\tover\ttime.\tIt\tacquires\tnew\tfunctionality\tand\tlines\tof\tcode\tat\tan alarming\trate.\tBefore\tlong\tit\tbecomes\ta\tbig,\tscary\tgiant\tpresence\tin\tour\torganization\tthat people\tare\tscared\tto\ttouch\tor\tchange.\tBut\tall\tis\tnot\tlost!\tWith\tthe\tright\ttools\tat\tour disposal,\twe\tcan\tslay\tthis\tbeast.",
      "content_length": 758,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 146,
      "content": "It’s\tAll\tAbout\tSeams\n\nWe\tdiscussed\tin\tChapter\t3\tthat\twe\twant\tour\tservices\tto\tbe\thighly\tcohesive\tand\tloosely coupled.\tThe\tproblem\twith\tthe\tmonolith\tis\tthat\tall\ttoo\toften\tit\tis\tthe\topposite\tof\tboth. Rather\tthan\ttend\ttoward\tcohesion,\tand\tkeep\tthings\ttogether\tthat\ttend\tto\tchange\ttogether, we\tacquire\tand\tstick\ttogether\tall\tsorts\tof\tunrelated\tcode.\tLikewise,\tloose\tcoupling\tdoesn’t really\texist:\tif\tI\twant\tto\tmake\ta\tchange\tto\ta\tline\tof\tcode,\tI\tmay\tbe\table\tto\tdo\tthat\teasily enough,\tbut\tI\tcannot\tdeploy\tthat\tchange\twithout\tpotentially\timpacting\tmuch\tof\tthe\trest\tof the\tmonolith,\tand\tI’ll\tcertainly\thave\tto\tredeploy\tthe\tentire\tsystem.\n\nIn\this\tbook\tWorking\tEffectively\twith\tLegacy\tCode\t(Prentice-Hall),\tMichael\tFeathers defines\tthe\tconcept\tof\ta\tseam\t—\tthat\tis,\ta\tportion\tof\tthe\tcode\tthat\tcan\tbe\ttreated\tin isolation\tand\tworked\ton\twithout\timpacting\tthe\trest\tof\tthe\tcodebase.\tWe\talso\twant\tto identify\tseams.\tBut\trather\tthan\tfinding\tthem\tfor\tthe\tpurpose\tof\tcleaning\tup\tour\tcodebase, we\twant\tto\tidentify\tseams\tthat\tcan\tbecome\tservice\tboundaries.\n\nSo\twhat\tmakes\ta\tgood\tseam?\tWell,\tas\twe\tdiscussed\tpreviously,\tbounded\tcontexts\tmake excellent\tseams,\tbecause\tby\tdefinition\tthey\trepresent\tcohesive\tand\tyet\tloosely\tcoupled boundaries\tin\tan\torganization.\tSo\tthe\tfirst\tstep\tis\tto\tstart\tidentifying\tthese\tboundaries\tin our\tcode.\n\nMost\tprogramming\tlanguages\tprovide\tnamespace\tconcepts\tthat\tallow\tus\tto\tgroup\tsimilar code\ttogether.\tJava’s\tpackage\tconcept\tis\ta\tfairly\tweak\texample,\tbut\tgives\tus\tmuch\tof\twhat we\tneed.\tAll\tother\tmainstream\tprogramming\tlanguages\thave\tsimilar\tconcepts\tbuilt\tin, with\tJavaScript\tvery\targuably\tbeing\tan\texception.",
      "content_length": 1618,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 147,
      "content": "Breaking\tApart\tMusicCorp\n\nImagine\twe\thave\ta\tlarge\tbackend\tmonolithic\tservice\tthat\trepresents\ta\tsubstantial\tamount of\tthe\tbehavior\tof\tMusicCorp’s\tonline\tsystems.\tTo\tstart,\twe\tshould\tidentify\tthe\thigh-level bounded\tcontexts\tthat\twe\tthink\texist\tin\tour\torganization,\tas\twe\tdiscussed\tin\tChapter\t3. Then\twe\twant\tto\ttry\tto\tunderstand\twhat\tbounded\tcontexts\tthe\tmonolith\tmaps\tto.\tLet’s imagine\tthat\tinitially\twe\tidentify\tfour\tcontexts\twe\tthink\tour\tmonolithic\tbackend\tcovers:\n\nCatalog\n\nEverything\tto\tdo\twith\tmetadata\tabout\tthe\titems\twe\toffer\tfor\tsale\n\nFinance\n\nReporting\tfor\taccounts,\tpayments,\trefunds,\tetc.\n\nWarehouse\n\nDispatching\tand\treturning\tof\tcustomer\torders,\tmanaging\tinventory\tlevels,\tetc.\n\nRecommendation\n\nOur\tpatent-pending,\trevolutionary\trecommendation\tsystem,\twhich\tis\thighly\tcomplex code\twritten\tby\ta\tteam\twith\tmore\tPhDs\tthan\tthe\taverage\tscience\tlab\n\nThe\tfirst\tthing\tto\tdo\tis\tto\tcreate\tpackages\trepresenting\tthese\tcontexts,\tand\tthen\tmove\tthe existing\tcode\tinto\tthem.\tWith\tmodern\tIDEs,\tcode\tmovement\tcan\tbe\tdone\tautomatically via\trefactorings,\tand\tcan\tbe\tdone\tincrementally\twhile\twe\tare\tdoing\tother\tthings.\tYou’ll still\tneed\ttests\tto\tcatch\tany\tbreakages\tmade\tby\tmoving\tcode,\thowever,\tespecially\tif\tyou’re using\ta\tdynamically\ttyped\tlanguage\twhere\tthe\tIDEs\thave\ta\tharder\ttime\tof\tperforming refactoring.\tOver\ttime,\twe\tstart\tto\tsee\twhat\tcode\tfits\twell,\tand\twhat\tcode\tis\tleft\tover\tand doesn’t\treally\tfit\tanywhere.\tThis\tremaining\tcode\twill\toften\tidentify\tbounded\tcontexts\twe might\thave\tmissed!\n\nDuring\tthis\tprocess\twe\tcan\tuse\tcode\tto\tanalyze\tthe\tdependencies\tbetween\tthese\tpackages too.\tOur\tcode\tshould\trepresent\tour\torganization,\tso\tour\tpackages\trepresenting\tthe bounded\tcontexts\tin\tour\torganization\tshould\tinteract\tin\tthe\tsame\tway\tthe\treal-life organizational\tgroups\tin\tour\tdomain\tinteract.\tFor\texample,\ttools\tlike\tStructure\t101\tallow us\tto\tsee\tthe\tdependencies\tbetween\tpackages\tgraphically.\tIf\twe\tspot\tthings\tthat\tlook wrong\t—\tfor\texample,\tthe\twarehouse\tpackage\tdepends\ton\tcode\tin\tthe\tfinance\tpackage when\tno\tsuch\tdependency\texists\tin\tthe\treal\torganization\t—\tthen\twe\tcan\tinvestigate\tthis problem\tand\ttry\tto\tresolve\tit.\n\nThis\tprocess\tcould\ttake\tan\tafternoon\ton\ta\tsmall\tcodebase,\tor\tseveral\tweeks\tor\tmonths when\tyou’re\tdealing\twith\tmillions\tof\tlines\tof\tcode.\tYou\tmay\tnot\tneed\tto\tsort\tall\tcode\tinto domain-oriented\tpackages\tbefore\tsplitting\tout\tyour\tfirst\tservice,\tand\tindeed\tit\tcan\tbe\tmore valuable\tto\tconcentrate\tyour\teffort\tin\tone\tplace.\tThere\tis\tno\tneed\tfor\tthis\tto\tbe\ta\tbig-bang approach.\tIt\tis\tsomething\tthat\tcan\tbe\tdone\tbit\tby\tbit,\tday\tby\tday,\tand\twe\thave\ta\tlot\tof\ttools",
      "content_length": 2574,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 148,
      "content": "at\tour\tdisposal\tto\ttrack\tour\tprogress.\n\nSo\tnow\tthat\twe\thave\tour\tcodebase\torganized\taround\tthese\tseams,\twhat\tnext?",
      "content_length": 113,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 149,
      "content": "The\tReasons\tto\tSplit\tthe\tMonolith\n\nDeciding\tthat\tyou’d\tlike\ta\tmonolithic\tservice\tor\tapplication\tto\tbe\tsmaller\tis\ta\tgood\tstart. But\tI\twould\tstrongly\tadvise\tyou\tto\tchip\taway\tat\tthese\tsystems.\tAn\tincremental\tapproach will\thelp\tyou\tlearn\tabout\tmicroservices\tas\tyou\tgo,\tand\twill\talso\tlimit\tthe\timpact\tof\tgetting something\twrong\t(and\tyou\twill\tget\tthings\twrong!).\tThink\tof\tour\tmonolith\tas\ta\tblock\tof marble.\tWe\tcould\tblow\tthe\twhole\tthing\tup,\tbut\tthat\trarely\tends\twell.\tIt\tmakes\tmuch\tmore sense\tto\tjust\tchip\taway\tat\tit\tincrementally.\n\nSo\tif\twe\tare\tgoing\tto\tbreak\tapart\tthe\tmonolith\ta\tpiece\tat\ta\ttime,\twhere\tshould\twe\tstart? We\thave\tour\tseams\tnow,\tbut\twhich\tone\tshould\twe\tpull\tout\tfirst?\tIt’s\tbest\tto\tthink\tabout where\tyou\tare\tgoing\tto\tget\tthe\tmost\tbenefit\tfrom\tsome\tpart\tof\tyour\tcodebase\tbeing separated,\trather\tthan\tjust\tsplitting\tthings\tfor\tthe\tsake\tof\tit.\tLet’s\tconsider\tsome\tdrivers that\tmight\thelp\tguide\tour\tchisel.",
      "content_length": 912,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 150,
      "content": "Pace\tof\tChange\n\nPerhaps\twe\tknow\tthat\twe\thave\ta\tload\tof\tchanges\tcoming\tup\tsoon\tin\thow\twe\tmanage inventory.\tIf\twe\tsplit\tout\tthe\twarehouse\tseam\tas\ta\tservice\tnow,\twe\tcould\tchange\tthat service\tfaster,\tas\tit\tis\ta\tseparate\tautonomous\tunit.",
      "content_length": 232,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 151,
      "content": "Team\tStructure\n\nMusicCorp’s\tdelivery\tteam\tis\tactually\tsplit\tacross\ttwo\tgeographical\tregions.\tOne\tteam\tis in\tLondon,\tthe\tother\tin\tHawaii\t(some\tpeople\thave\tit\teasy!).\tIt\twould\tbe\tgreat\tif\twe\tcould split\tout\tthe\tcode\tthat\tthe\tHawaii\tteam\tworks\ton\tthe\tmost,\tso\tit\tcan\ttake\tfull\townership. We’ll\texplore\tthis\tidea\tfurther\tin\tChapter\t10.",
      "content_length": 331,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 152,
      "content": "Security\n\nMusicCorp\thas\thad\ta\tsecurity\taudit,\tand\thas\tdecided\tto\ttighten\tup\tits\tprotection\tof sensitive\tinformation.\tCurrently,\tall\tof\tthis\tis\thandled\tby\tthe\tfinance-related\tcode.\tIf\twe split\tthis\tservice\tout,\twe\tcan\tprovide\tadditional\tprotections\tto\tthis\tindividual\tservice\tin terms\tof\tmonitoring,\tprotection\tof\tdata\tat\ttransit,\tand\tprotection\tof\tdata\tat\trest\t—\tideas we’ll\tlook\tat\tin\tmore\tdetail\tin\tChapter\t9.",
      "content_length": 411,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 153,
      "content": "Technology\n\nThe\tteam\tlooking\tafter\tour\trecommendation\tsystem\thas\tbeen\tspiking\tout\tsome\tnew algorithms\tusing\ta\tlogic\tprogramming\tlibrary\tin\tthe\tlanguage\tClojure.\tThe\tteam\tthinks this\tcould\tbenefit\tour\tcustomers\tby\timproving\twhat\twe\toffer\tthem.\tIf\twe\tcould\tsplit\tout the\trecommendation\tcode\tinto\ta\tseparate\tservice,\tit\twould\tbe\teasy\tto\tconsider\tbuilding\tan alternative\timplementation\tthat\twe\tcould\ttest\tagainst.",
      "content_length": 409,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 154,
      "content": "Tangled\tDependencies\n\nThe\tother\tpoint\tto\tconsider\twhen\tyou’ve\tidentified\ta\tcouple\tof\tseams\tto\tseparate\tis\thow entangled\tthat\tcode\tis\twith\tthe\trest\tof\tthe\tsystem.\tWe\twant\tto\tpull\tout\tthe\tseam\tthat\tis\tleast depended\ton\tif\twe\tcan.\tIf\tyou\tcan\tview\tthe\tvarious\tseams\tyou\thave\tfound\tas\ta\tdirected acyclical\tgraph\tof\tdependencies\t(something\tthe\tpackage\tmodeling\ttools\tI\tmentioned earlier\tare\tvery\tgood\tat),\tthis\tcan\thelp\tyou\tspot\tthe\tseams\tthat\tare\tlikely\tgoing\tto\tbe\tharder to\tdisentangle.\n\nThis\tbrings\tus\tto\twhat\tis\toften\tthe\tmother\tof\tall\ttangled\tdependencies:\tthe\tdatabase.",
      "content_length": 570,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 155,
      "content": "The\tDatabase\n\nWe’ve\talready\tdiscussed\tat\tlength\tthe\tchallenges\tof\tusing\tdatabases\tas\ta\tmethod\tof integrating\tmultiple\tservices.\tAs\tI\tmade\tit\tpretty\tclear\tearlier,\tI\tam\tnot\ta\tfan!\tThis\tmeans we\tneed\tto\tfind\tseams\tin\tour\tdatabases\ttoo\tso\twe\tcan\tsplit\tthem\tout\tcleanly.\tDatabases, however,\tare\ttricky\tbeasts.",
      "content_length": 305,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 156,
      "content": "Getting\tto\tGrips\twith\tthe\tProblem\n\nThe\tfirst\tstep\tis\tto\ttake\ta\tlook\tat\tthe\tcode\titself\tand\tsee\twhich\tparts\tof\tit\tread\tto\tand\twrite from\tthe\tdatabase.\tA\tcommon\tpractice\tis\tto\thave\ta\trepository\tlayer,\tbacked\tby\tsome\tsort of\tframework\tlike\tHibernate,\tto\tbind\tyour\tcode\tto\tthe\tdatabase,\tmaking\tit\teasy\tto\tmap objects\tor\tdata\tstructures\tto\tand\tfrom\tthe\tdatabase.\tIf\tyou\thave\tbeen\tfollowing\talong\tso far,\tyou’ll\thave\tgrouped\tour\tcode\tinto\tpackages\trepresenting\tour\tbounded\tcontexts;\twe want\tto\tdo\tthe\tsame\tfor\tour\tdatabase\taccess\tcode.\tThis\tmay\trequire\tsplitting\tup\tthe repository\tlayer\tinto\tseveral\tparts,\tas\tshown\tin\tFigure\t5-1.\n\nFigure\t5-1.\tSplitting\tout\tour\trepository\tlayers\n\nHaving\tthe\tdatabase\tmapping\tcode\tcolocated\tinside\tthe\tcode\tfor\ta\tgiven\tcontext\tcan\thelp us\tunderstand\twhat\tparts\tof\tthe\tdatabase\tare\tused\tby\twhat\tbits\tof\tcode.\tHibernate,\tfor example,\tcan\tmake\tthis\tvery\tclear\tif\tyou\tare\tusing\tsomething\tlike\ta\tmapping\tfile\tper bounded\tcontext.\n\nThis\tdoesn’t\tgive\tus\tthe\twhole\tstory,\thowever.\tFor\texample,\twe\tmay\tbe\table\tto\ttell\tthat\tthe finance\tcode\tuses\tthe\tledger\ttable,\tand\tthat\tthe\tcatalog\tcode\tuses\tthe\tline\titem\ttable,\tbut\tit might\tnot\tbe\tclear\tthat\tthe\tdatabase\tenforces\ta\tforeign\tkey\trelationship\tfrom\tthe\tledger table\tto\tthe\tline\titem\ttable.\tTo\tsee\tthese\tdatabase-level\tconstraints,\twhich\tmay\tbe\ta stumbling\tblock,\twe\tneed\tto\tuse\tanother\ttool\tto\tvisualize\tthe\tdata.\tA\tgreat\tplace\tto\tstart\tis to\tuse\ta\ttool\tlike\tthe\tfreely\tavailable\tSchemaSpy,\twhich\tcan\tgenerate\tgraphical representations\tof\tthe\trelationships\tbetween\ttables.\n\nAll\tthis\thelps\tyou\tunderstand\tthe\tcoupling\tbetween\ttables\tthat\tmay\tspan\twhat\twill eventually\tbecome\tservice\tboundaries.\tBut\thow\tdo\tyou\tcut\tthose\tties?\tAnd\twhat\tabout cases\twhere\tthe\tsame\ttables\tare\tused\tfrom\tmultiple\tdifferent\tbounded\tcontexts?\tHandling problems\tlike\tthese\tis\tnot\teasy,\tand\tthere\tare\tmany\tanswers,\tbut\tit\tis\tdoable.",
      "content_length": 1875,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 157,
      "content": "Coming\tback\tto\tsome\tconcrete\texamples,\tlet’s\tconsider\tour\tmusic\tshop\tagain.\tWe\thave identified\tfour\tbounded\tcontexts,\tand\twant\tto\tmove\tforward\twith\tmaking\tthem\tfour distinct,\tcollaborating\tservices.\tWe’re\tgoing\tto\tlook\tat\ta\tfew\tconcrete\texamples\tof problems\twe\tmight\tface,\tand\ttheir\tpotential\tsolutions.\tAnd\twhile\tsome\tof\tthese\texamples talk\tspecifically\tabout\tchallenges\tencountered\tin\tstandard\trelational\tdatabases,\tyou\twill find\tsimilar\tproblems\tin\tother\talternative\tNOSQL\tstores.",
      "content_length": 483,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 158,
      "content": "Example:\tBreaking\tForeign\tKey\tRelationships\n\nIn\tthis\texample,\tour\tcatalog\tcode\tuses\ta\tgeneric\tline\titem\ttable\tto\tstore\tinformation\tabout an\talbum.\tOur\tfinance\tcode\tuses\ta\tledger\ttable\tto\ttrack\tfinancial\ttransactions.\tAt\tthe\tend of\teach\tmonth\twe\tneed\tto\tgenerate\treports\tfor\tvarious\tpeople\tin\tthe\torganization\tso\tthey can\tsee\thow\twe’re\tdoing.\tWe\twant\tto\tmake\tthe\treports\tnice\tand\teasy\tto\tread,\tso\trather than\tsaying,\t“We\tsold\t400\tcopies\tof\tSKU\t12345\tand\tmade\t$1,300,”\twe’d\tlike\tto\tadd\tmore information\tabout\twhat\twas\tsold\t(i.e.,\t“We\tsold\t400\tcopies\tof\tBruce\tSpringsteen’s Greatest\tHits\tand\tmade\t$1,300”).\tTo\tdo\tthis,\tour\treporting\tcode\tin\tthe\tfinance\tpackage will\treach\tinto\tthe\tline\titem\ttable\tto\tpull\tout\tthe\ttitle\tfor\tthe\tSKU.\tIt\tmay\talso\thave\ta foreign\tkey\tconstraint\tfrom\tthe\tledger\tto\tthe\tline\titem\ttable,\tas\twe\tsee\tin\tFigure\t5-2.\n\nFigure\t5-2.\tForeign\tkey\trelationship\n\nSo\thow\tdo\twe\tfix\tthings\there?\tWell,\twe\tneed\tto\tmake\ta\tchange\tin\ttwo\tplaces.\tFirst,\twe need\tto\tstop\tthe\tfinance\tcode\tfrom\treaching\tinto\tthe\tline\titem\ttable,\tas\tthis\ttable\treally belongs\tto\tthe\tcatalog\tcode,\tand\twe\tdon’t\twant\tdatabase\tintegration\thappening\tonce catalog\tand\tfinance\tare\tservices\tin\ttheir\town\trights.\tThe\tquickest\tway\tto\taddress\tthis\tis rather\tthan\thaving\tthe\tcode\tin\tfinance\treach\tinto\tthe\tline\titem\ttable,\twe’ll\texpose\tthe\tdata via\tan\tAPI\tcall\tin\tthe\tcatalog\tpackage\tthat\tthe\tfinance\tcode\tcan\tcall.\tThis\tAPI\tcall\twill\tbe the\tforerunner\tof\ta\tcall\twe\twill\tmake\tover\tthe\twire,\tas\twe\tsee\tin\tFigure\t5-3.",
      "content_length": 1488,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 159,
      "content": "Figure\t5-3.\tPost\tremoval\tof\tthe\tforeign\tkey\trelationship\n\nAt\tthis\tpoint\tit\tbecomes\tclear\tthat\twe\tmay\twell\tend\tup\thaving\tto\tmake\ttwo\tdatabase\tcalls to\tgenerate\tthe\treport.\tThis\tis\tcorrect.\tAnd\tthe\tsame\tthing\twill\thappen\tif\tthese\tare\ttwo separate\tservices.\tTypically\tconcerns\taround\tperformance\tare\tnow\traised.\tI\thave\ta\tfairly easy\tanswer\tto\tthose:\thow\tfast\tdoes\tyour\tsystem\tneed\tto\tbe?\tAnd\thow\tfast\tis\tit\tnow?\tIf you\tcan\ttest\tits\tcurrent\tperformance\tand\tknow\twhat\tgood\tperformance\tlooks\tlike,\tthen you\tshould\tfeel\tconfident\tin\tmaking\ta\tchange.\tSometimes\tmaking\tone\tthing\tslower\tin exchange\tfor\tother\tthings\tis\tthe\tright\tthing\tto\tdo,\tespecially\tif\tslower\tis\tstill\tperfectly acceptable.\n\nBut\twhat\tabout\tthe\tforeign\tkey\trelationship?\tWell,\twe\tlose\tthis\taltogether.\tThis\tbecomes\ta constraint\twe\tneed\tto\tnow\tmanage\tin\tour\tresulting\tservices\trather\tthan\tin\tthe\tdatabase level.\tThis\tmay\tmean\tthat\twe\tneed\tto\timplement\tour\town\tconsistency\tcheck\tacross services,\tor\telse\ttrigger\tactions\tto\tclean\tup\trelated\tdata.\tWhether\tor\tnot\tthis\tis\tneeded\tis often\tnot\ta\ttechnologist’s\tchoice\tto\tmake.\tFor\texample,\tif\tour\torder\tservice\tcontains\ta\tlist of\tIDs\tfor\tcatalog\titems,\twhat\thappens\tif\ta\tcatalog\titem\tis\tremoved\tand\tan\torder\tnow refers\tto\tan\tinvalid\tcatalog\tID?\tShould\twe\tallow\tit?\tIf\twe\tdo,\tthen\thow\tis\tthis\trepresented in\tthe\torder\twhen\tit\tis\tdisplayed?\tIf\twe\tdon’t,\tthen\thow\tcan\twe\tcheck\tthat\tthis\tisn’t violated?\tThese\tare\tquestions\tyou’ll\tneed\tto\tget\tanswered\tby\tthe\tpeople\twho\tdefine\thow your\tsystem\tshould\tbehave\tfor\tits\tusers.",
      "content_length": 1519,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 160,
      "content": "Example:\tShared\tStatic\tData\n\nI\thave\tseen\tperhaps\tas\tmany\tcountry\tcodes\tstored\tin\tdatabases\t(shown\tin\tFigure\t5-4)\tas\tI have\twritten\tStringUtils\tclasses\tfor\tin-house\tJava\tprojects.\tThis\tseems\tto\timply\tthat\twe plan\tto\tchange\tthe\tcountries\tour\tsystem\tsupports\tway\tmore\tfrequently\tthan\twe’ll\tdeploy new\tcode,\tbut\twhatever\tthe\treal\treason,\tthese\texamples\tof\tshared\tstatic\tdata\tbeing\tstored in\tdatabases\tcome\tup\ta\tlot.\tSo\twhat\tdo\twe\tdo\tin\tour\tmusic\tshop\tif\tall\tour\tpotential services\tread\tfrom\tthe\tsame\ttable\tlike\tthis?\n\nFigure\t5-4.\tCountry\tcodes\tin\tthe\tdatabase\n\nWell,\twe\thave\ta\tfew\toptions.\tOne\tis\tto\tduplicate\tthis\ttable\tfor\teach\tof\tour\tpackages,\twith the\tlong-term\tview\tthat\tit\twill\tbe\tduplicated\twithin\teach\tservice\talso.\tThis\tleads\tto\ta potential\tconsistency\tchallenge,\tof\tcourse:\twhat\thappens\tif\tI\tupdate\tone\ttable\tto\treflect\tthe creation\tof\tNewmantopia\toff\tthe\teast\tcoast\tof\tAustralia,\tbut\tnot\tanother?\n\nA\tsecond\toption\tis\tto\tinstead\ttreat\tthis\tshared,\tstatic\tdata\tas\tcode.\tPerhaps\tit\tcould\tbe\tin\ta property\tfile\tdeployed\tas\tpart\tof\tthe\tservice,\tor\tperhaps\tjust\tas\tan\tenumeration.\tThe problems\taround\tthe\tconsistency\tof\tdata\tremain,\talthough\texperience\thas\tshown\tthat\tit\tis far\teasier\tto\tpush\tout\tchanges\tto\tconfiguration\tfiles\tthan\talter\tlive\tdatabase\ttables.\tThis\tis often\ta\tvery\tsensible\tapproach.\n\nA\tthird\toption,\twhich\tmay\twell\tbe\textreme,\tis\tto\tpush\tthis\tstatic\tdata\tinto\ta\tservice\tof\tits own\tright.\tIn\ta\tcouple\tof\tsituations\tI\thave\tencountered,\tthe\tvolume,\tcomplexity,\tand\trules associated\twith\tthe\tstatic\treference\tdata\twere\tsufficient\tthat\tthis\tapproach\twas\twarranted, but\tit’s\tprobably\toverkill\tif\twe\tare\tjust\ttalking\tabout\tcountry\tcodes!\n\nPersonally,\tin\tmost\tsituations\tI’d\ttry\tto\tpush\tfor\tkeeping\tthis\tdata\tin\tconfiguration\tfiles\tor directly\tin\tcode,\tas\tit\tis\tthe\tsimple\toption\tfor\tmost\tcases.",
      "content_length": 1806,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 162,
      "content": "Example:\tShared\tData\n\nNow\tlet’s\tdive\tinto\ta\tmore\tcomplex\texample,\tbut\tone\tthat\tcan\tbe\ta\tcommon\tproblem when\tyou’re\ttrying\tto\ttease\tapart\tsystems:\tshared\tmutable\tdata.\tOur\tfinance\tcode\ttracks payments\tmade\tby\tcustomers\tfor\ttheir\torders,\tand\talso\ttracks\trefunds\tgiven\tto\tthem\twhen they\treturn\titems.\tMeanwhile,\tthe\twarehouse\tcode\tupdates\trecords\tto\tshow\tthat\torders\tfor customers\thave\tbeen\tdispatched\tor\treceived.\tAll\tof\tthis\tdata\tis\tdisplayed\tin\tone convenient\tplace\ton\tthe\twebsite\tso\tthat\tcustomers\tcan\tsee\twhat\tis\tgoing\ton\twith\ttheir account.\tTo\tkeep\tthings\tsimple,\twe\thave\tstored\tall\tthis\tinformation\tin\ta\tfairly\tgeneric customer\trecord\ttable,\tas\tshown\tin\tFigure\t5-5.\n\nFigure\t5-5.\tAccessing\tcustomer\tdata:\tare\twe\tmissing\tsomething?\n\nSo\tboth\tthe\tfinance\tand\tthe\twarehouse\tcode\tare\twriting\tto,\tand\tprobably\toccasionally reading\tfrom,\tthe\tsame\ttable.\tHow\tcan\twe\ttease\tthis\tapart?\tWhat\twe\tactually\thave\there\tis something\tyou’ll\tsee\toften\t—\ta\tdomain\tconcept\tthat\tisn’t\tmodeled\tin\tthe\tcode,\tand\tis\tin fact\timplicitly\tmodeled\tin\tthe\tdatabase.\tHere,\tthe\tdomain\tconcept\tthat\tis\tmissing\tis\tthat\tof Customer.\n\nWe\tneed\tto\tmake\tthe\tcurrent\tabstract\tconcept\tof\tthe\tcustomer\tconcrete.\tAs\ta\ttransient step,\twe\tcreate\ta\tnew\tpackage\tcalled\tCustomer.\tWe\tcan\tthen\tuse\tan\tAPI\tto\texpose Customer\tcode\tto\tother\tpackages,\tsuch\tas\tfinance\tor\twarehouse.\tRolling\tthis\tall\tthe\tway forward,\twe\tmay\tnow\tend\tup\twith\ta\tdistinct\tcustomer\tservice\t(Figure\t5-6).",
      "content_length": 1428,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 163,
      "content": "Figure\t5-6.\tRecognizing\tthe\tbounded\tcontext\tof\tthe\tcustomer",
      "content_length": 59,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 164,
      "content": "Example:\tShared\tTables\n\nFigure\t5-7\tshows\tour\tlast\texample.\tOur\tcatalog\tneeds\tto\tstore\tthe\tname\tand\tprice\tof\tthe records\twe\tsell,\tand\tthe\twarehouse\tneeds\tto\tkeep\tan\telectronic\trecord\tof\tinventory.\tWe decide\tto\tkeep\tthese\ttwo\tthings\tin\tthe\tsame\tplace\tin\ta\tgeneric\tline\titem\ttable.\tBefore,\twith all\tthe\tcode\tmerged\tin\ttogether,\tit\twasn’t\tclear\tthat\twe\tare\tactually\tconflating\tconcerns, but\tnow\twe\tcan\tsee\tthat\tin\tfact\twe\thave\ttwo\tseparate\tconcepts\tthat\tcould\tbe\tstored differently.\n\nFigure\t5-7.\tTables\tbeing\tshared\tbetween\tdifferent\tcontexts\n\nThe\tanswer\there\tis\tto\tsplit\tthe\ttable\tin\ttwo\tas\twe\thave\tin\tFigure\t5-8,\tperhaps\tcreating\ta stock\tlist\ttable\tfor\tthe\twarehouse,\tand\ta\tcatalog\tentry\ttable\tfor\tthe\tcatalog\tdetails.\n\nFigure\t5-8.\tPulling\tapart\tthe\tshared\ttable",
      "content_length": 760,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 165,
      "content": "Refactoring\tDatabases\n\nWhat\twe\thave\tcovered\tin\tthe\tpreceding\texamples\tare\ta\tfew\tdatabase\trefactorings\tthat\tcan help\tyou\tseparate\tyour\tschemas.\tFor\ta\tmore\tdetailed\tdiscussion\tof\tthe\tsubject,\tyou\tmay want\tto\ttake\ta\tlook\tat\tRefactoring\tDatabases\tby\tScott\tJ.\tAmbler\tand\tPramod\tJ.\tSadalage (Addison-Wesley).",
      "content_length": 302,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 166,
      "content": "Staging\tthe\tBreak\n\nSo\twe’ve\tfound\tseams\tin\tour\tapplication\tcode,\tgrouping\tit\taround\tbounded\tcontexts. We’ve\tused\tthis\tto\tidentify\tseams\tin\tthe\tdatabase,\tand\twe’ve\tdone\tour\tbest\tto\tsplit\tthose out.\tWhat\tnext?\tDo\tyou\tdo\ta\tbig-bang\trelease,\tgoing\tfrom\tone\tmonolithic\tservice\twith\ta single\tschema\tto\ttwo\tservices,\teach\twith\tits\town\tschema?\tI\twould\tactually\trecommend that\tyou\tsplit\tout\tthe\tschema\tbut\tkeep\tthe\tservice\ttogether\tbefore\tsplitting\tthe\tapplication code\tout\tinto\tseparate\tmicroservices,\tas\tshown\tin\tFigure\t5-9.\n\nFigure\t5-9.\tStaging\ta\tservice\tseparation\n\nWith\ta\tseparate\tschema,\twe’ll\tbe\tpotentially\tincreasing\tthe\tnumber\tof\tdatabase\tcalls\tto perform\ta\tsingle\taction.\tWhere\tbefore\twe\tmight\thave\tbeen\table\tto\thave\tall\tthe\tdata\twe wanted\tin\ta\tsingle\tSELECT\tstatement,\tnow\twe\tmay\tneed\tto\tpull\tthe\tdata\tback\tfrom\ttwo locations\tand\tjoin\tin\tmemory.\tAlso,\twe\tend\tup\tbreaking\ttransactional\tintegrity\twhen\twe move\tto\ttwo\tschemas,\twhich\tcould\thave\tsignificant\timpact\ton\tour\tapplications;\twe’ll\tbe discussing\tthis\tnext.\tBy\tsplitting\tthe\tschemas\tout\tbut\tkeeping\tthe\tapplication\tcode together,\twe\tgive\tourselves\tthe\tability\tto\trevert\tour\tchanges\tor\tcontinue\tto\ttweak\tthings without\timpacting\tany\tconsumers\tof\tour\tservice.\tOnce\twe\tare\tsatisfied\tthat\tthe\tDB separation\tmakes\tsense,\twe\tcan\tthen\tthink\tabout\tsplitting\tout\tthe\tapplication\tcode\tinto\ttwo services.",
      "content_length": 1350,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 167,
      "content": "Transactional\tBoundaries\n\nTransactions\tare\tuseful\tthings.\tThey\tallow\tus\tto\tsay\tthese\tevents\teither\tall\thappen together,\tor\tnone\tof\tthem\thappen.\tThey\tare\tvery\tuseful\twhen\twe’re\tinserting\tdata\tinto\ta database;\tthey\tlet\tus\tupdate\tmultiple\ttables\tat\tonce,\tknowing\tthat\tif\tanything\tfails, everything\tgets\trolled\tback,\tensuring\tour\tdata\tdoesn’t\tget\tinto\tan\tinconsistent\tstate. Simply\tput,\ta\ttransaction\tallows\tus\tto\tgroup\ttogether\tmultiple\tdifferent\tactivities\tthat\ttake our\tsystem\tfrom\tone\tconsistent\tstate\tto\tanother\t—\teverything\tworks,\tor\tnothing\tchanges.\n\nTransactions\tdon’t\tjust\tapply\tto\tdatabases,\talthough\twe\tmost\toften\tuse\tthem\tin\tthat context.\tMessage\tbrokers,\tfor\texample,\thave\tlong\tallowed\tyou\tto\tpost\tand\treceive messages\twithin\ttransactions\ttoo.\n\nWith\ta\tmonolithic\tschema,\tall\tour\tcreate\tor\tupdates\twill\tprobably\tbe\tdone\twithin\ta\tsingle transactional\tboundary.\tWhen\twe\tsplit\tapart\tour\tdatabases,\twe\tlose\tthe\tsafety\tafforded\tto us\tby\thaving\ta\tsingle\ttransaction.\tConsider\ta\tsimple\texample\tin\tthe\tMusicCorp\tcontext. When\tcreating\tan\torder,\tI\twant\tto\tupdate\tthe\torder\ttable\tstating\tthat\ta\tcustomer\torder\thas been\tcreated,\tand\talso\tput\tan\tentry\tinto\ta\ttable\tfor\tthe\twarehouse\tteam\tso\tit\tknows\tthere\tis an\torder\tthat\tneeds\tto\tbe\tpicked\tfor\tdispatch.\tWe’ve\tgotten\tas\tfar\tas\tgrouping\tour application\tcode\tinto\tseparate\tpackages,\tand\thave\talso\tseparated\tthe\tcustomer\tand warehouse\tparts\tof\tthe\tschema\twell\tenough\tthat\twe\tare\tready\tto\tput\tthem\tinto\ttheir\town schemas\tprior\tto\tseparating\tthe\tapplication\tcode.\n\nWithin\ta\tsingle\ttransaction\tin\tour\texisting\tmonolithic\tschema,\tcreating\tthe\torder\tand inserting\tthe\trecord\tfor\tthe\twarehouse\tteam\ttakes\tplace\twithin\ta\tsingle\ttransaction,\tas shown\tin\tFigure\t5-10.",
      "content_length": 1703,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 168,
      "content": "Figure\t5-10.\tUpdating\ttwo\ttables\tin\ta\tsingle\ttransaction\n\nBut\tif\twe\thave\tpulled\tapart\tthe\tschema\tinto\ttwo\tseparate\tschemas,\tone\tfor\tcustomer- related\tdata\tincluding\tour\torder\ttable,\tand\tanother\tfor\tthe\twarehouse,\twe\thave\tlost\tthis transactional\tsafety.\tThe\torder\tplacing\tprocess\tnow\tspans\ttwo\tseparate\ttransactional boundaries,\tas\twe\tsee\tin\tFigure\t5-11.\tIf\tour\tinsert\tinto\tthe\torder\ttable\tfails,\twe\tcan\tclearly stop\teverything,\tleaving\tus\tin\ta\tconsistent\tstate.\tBut\twhat\thappens\twhen\tthe\tinsert\tinto\tthe order\ttable\tworks,\tbut\tthe\tinsert\tinto\tthe\tpicking\ttable\tfails?",
      "content_length": 567,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 169,
      "content": "Figure\t5-11.\tSpanning\ttransactional\tboundaries\tfor\ta\tsingle\toperation",
      "content_length": 69,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 170,
      "content": "Try\tAgain\tLater\n\nThe\tfact\tthat\tthe\torder\twas\tcaptured\tand\tplaced\tmight\tbe\tenough\tfor\tus,\tand\twe\tmay decide\tto\tretry\tthe\tinsertion\tinto\tthe\twarehouse’s\tpicking\ttable\tat\ta\tlater\tdate.\tWe\tcould queue\tup\tthis\tpart\tof\tthe\toperation\tin\ta\tqueue\tor\tlogfile,\tand\ttry\tagain\tlater.\tFor\tsome\tsorts of\toperations\tthis\tmakes\tsense,\tbut\twe\thave\tto\tassume\tthat\ta\tretry\twould\tfix\tit.\n\nIn\tmany\tways,\tthis\tis\tanother\tform\tof\twhat\tis\tcalled\teventual\tconsistency.\tRather\tthan using\ta\ttransactional\tboundary\tto\tensure\tthat\tthe\tsystem\tis\tin\ta\tconsistent\tstate\twhen\tthe transaction\tcompletes,\tinstead\twe\taccept\tthat\tthe\tsystem\twill\tget\titself\tinto\ta\tconsistent state\tat\tsome\tpoint\tin\tthe\tfuture.\tThis\tapproach\tis\tespecially\tuseful\twith\tbusiness operations\tthat\tmight\tbe\tlong-lived.\tWe’ll\tdiscuss\tthis\tidea\tin\tmore\tdepth\tin\tChapter\t11 when\twe\tcover\tscaling\tpatterns.",
      "content_length": 841,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 171,
      "content": "Abort\tthe\tEntire\tOperation\n\nAnother\toption\tis\tto\treject\tthe\tentire\toperation.\tIn\tthis\tcase,\twe\thave\tto\tput\tthe\tsystem back\tinto\ta\tconsistent\tstate.\tThe\tpicking\ttable\tis\teasy,\tas\tthat\tinsert\tfailed,\tbut\twe\thave\ta committed\ttransaction\tin\tthe\torder\ttable.\tWe\tneed\tto\tunwind\tthis.\tWhat\twe\thave\tto\tdo\tis issue\ta\tcompensating\ttransaction,\tkicking\toff\ta\tnew\ttransaction\tto\twind\tback\twhat\tjust happened.\tFor\tus,\tthat\tcould\tbe\tsomething\tas\tsimple\tas\tissuing\ta\tDELETE\tstatement\tto remove\tthe\torder\tfrom\tthe\tdatabase.\tThen\twe’d\talso\tneed\tto\treport\tback\tvia\tthe\tUI\tthat\tthe operation\tfailed.\tOur\tapplication\tcould\thandle\tboth\taspects\twithin\ta\tmonolithic\tsystem, but\twe’d\thave\tto\tconsider\twhat\twe\tcould\tdo\twhen\twe\tsplit\tup\tthe\tapplication\tcode.\tDoes the\tlogic\tto\thandle\tthe\tcompensating\ttransaction\tlive\tin\tthe\tcustomer\tservice,\tthe\torder service,\tor\tsomewhere\telse?\n\nBut\twhat\thappens\tif\tour\tcompensating\ttransaction\tfails?\tIt’s\tcertainly\tpossible.\tThen\twe’d have\tan\torder\tin\tthe\torder\ttable\twith\tno\tmatching\tpick\tinstruction.\tIn\tthis\tsituation,\tyou’d either\tneed\tto\tretry\tthe\tcompensating\ttransaction,\tor\tallow\tsome\tbackend\tprocess\tto\tclean up\tthe\tinconsistency\tlater\ton.\tThis\tcould\tbe\tsomething\tas\tsimple\tas\ta\tmaintenance\tscreen that\tadmin\tstaff\thad\taccess\tto,\tor\tan\tautomated\tprocess.\n\nNow\tthink\tabout\twhat\thappens\tif\twe\thave\tnot\tone\tor\ttwo\toperations\twe\twant\tto\tbe consistent,\tbut\tthree,\tfour,\tor\tfive.\tHandling\tcompensating\ttransactions\tfor\teach\tfailure mode\tbecomes\tquite\tchallenging\tto\tcomprehend,\tlet\talone\timplement.",
      "content_length": 1513,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 172,
      "content": "Distributed\tTransactions\n\nAn\talternative\tto\tmanually\torchestrating\tcompensating\ttransactions\tis\tto\tuse\ta\tdistributed transaction.\tDistributed\ttransactions\ttry\tto\tspan\tmultiple\ttransactions\twithin\tthem,\tusing some\toverall\tgoverning\tprocess\tcalled\ta\ttransaction\tmanager\tto\torchestrate\tthe\tvarious transactions\tbeing\tdone\tby\tunderlying\tsystems.\tJust\tas\twith\ta\tnormal\ttransaction,\ta distributed\ttransaction\ttries\tto\tensure\tthat\teverything\tremains\tin\ta\tconsistent\tstate,\tonly\tin this\tcase\tit\ttries\tto\tdo\tso\tacross\tmultiple\tdifferent\tsystems\trunning\tin\tdifferent\tprocesses, often\tcommunicating\tacross\tnetwork\tboundaries.\n\nThe\tmost\tcommon\talgorithm\tfor\thandling\tdistributed\ttransactions\t—\tespecially\tshort- lived\ttransactions,\tas\tin\tthe\tcase\tof\thandling\tour\tcustomer\torder\t—\tis\tto\tuse\ta\ttwo-phase commit.\tWith\ta\ttwo-phase\tcommit,\tfirst\tcomes\tthe\tvoting\tphase.\tThis\tis\twhere\teach participant\t(also\tcalled\ta\tcohort\tin\tthis\tcontext)\tin\tthe\tdistributed\ttransaction\ttells\tthe transaction\tmanager\twhether\tit\tthinks\tits\tlocal\ttransaction\tcan\tgo\tahead.\tIf\tthe\ttransaction manager\tgets\ta\tyes\tvote\tfrom\tall\tparticipants,\tthen\tit\ttells\tthem\tall\tto\tgo\tahead\tand\tperform their\tcommits.\tA\tsingle\tno\tvote\tis\tenough\tfor\tthe\ttransaction\tmanager\tto\tsend\tout\ta rollback\tto\tall\tparties.\n\nThis\tapproach\trelies\ton\tall\tparties\thalting\tuntil\tthe\tcentral\tcoordinating\tprocess\ttells\tthem to\tproceed.\tThis\tmeans\twe\tare\tvulnerable\tto\toutages.\tIf\tthe\ttransaction\tmanager\tgoes down,\tthe\tpending\ttransactions\tnever\tcomplete.\tIf\ta\tcohort\tfails\tto\trespond\tduring\tvoting, everything\tblocks.\tAnd\tthere\tis\talso\tthe\tcase\tof\twhat\thappens\tif\ta\tcommit\tfails\tafter voting.\tThere\tis\tan\tassumption\timplicit\tin\tthis\talgorithm\tthat\tthis\tcannot\thappen:\tif\ta cohort\tsays\tyes\tduring\tthe\tvoting\tperiod,\tthen\twe\thave\tto\tassume\tit\twill\tcommit.\tCohorts need\ta\tway\tof\tmaking\tthis\tcommit\twork\tat\tsome\tpoint.\tThis\tmeans\tthis\talgorithm\tisn’t foolproof\t—\trather,\tit\tjust\ttries\tto\tcatch\tmost\tfailure\tcases.\n\nThis\tcoordination\tprocess\talso\tmean\tlocks;\tthat\tis,\tpending\ttransactions\tcan\thold\tlocks\ton resources.\tLocks\ton\tresources\tcan\tlead\tto\tcontention,\tmaking\tscaling\tsystems\tmuch\tmore difficult,\tespecially\tin\tthe\tcontext\tof\tdistributed\tsystems.\n\nDistributed\ttransactions\thave\tbeen\timplemented\tfor\tspecific\ttechnology\tstacks,\tsuch\tas Java’s\tTransaction\tAPI,\tallowing\tfor\tdisparate\tresources\tlike\ta\tdatabase\tand\ta\tmessage queue\tto\tall\tparticipate\tin\tthe\tsame,\toverarching\ttransaction.\tThe\tvarious\talgorithms\tare hard\tto\tget\tright,\tso\tI’d\tsuggest\tyou\tavoid\ttrying\tto\tcreate\tyour\town.\tInstead,\tdo\tlots\tof research\ton\tthis\ttopic\tif\tthis\tseems\tlike\tthe\troute\tyou\twant\tto\ttake,\tand\tsee\tif\tyou\tcan\tuse an\texisting\timplementation.",
      "content_length": 2658,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 173,
      "content": "So\tWhat\tto\tDo?\n\nAll\tof\tthese\tsolutions\tadd\tcomplexity.\tAs\tyou\tcan\tsee,\tdistributed\ttransactions\tare\thard\tto get\tright\tand\tcan\tactually\tinhibit\tscaling.\tSystems\tthat\teventually\tconverge\tthrough compensating\tretry\tlogic\tcan\tbe\tharder\tto\treason\tabout,\tand\tmay\tneed\tother\tcompensating behavior\tto\tfix\tup\tinconsistencies\tin\tdata.\n\nWhen\tyou\tencounter\tbusiness\toperations\tthat\tcurrently\toccur\twithin\ta\tsingle\ttransaction, ask\tyourself\tif\tthey\treally\tneed\tto.\tCan\tthey\thappen\tin\tdifferent,\tlocal\ttransactions,\tand rely\ton\tthe\tconcept\tof\teventual\tconsistency?\tThese\tsystems\tare\tmuch\teasier\tto\tbuild\tand scale\t(we’ll\tdiscuss\tthis\tmore\tin\tChapter\t11).\n\nIf\tyou\tdo\tencounter\tstate\tthat\treally,\treally\twants\tto\tbe\tkept\tconsistent,\tdo\teverything\tyou can\tto\tavoid\tsplitting\tit\tup\tin\tthe\tfirst\tplace.\tTry\treally\thard.\tIf\tyou\treally\tneed\tto\tgo\tahead with\tthe\tsplit,\tthink\tabout\tmoving\tfrom\ta\tpurely\ttechnical\tview\tof\tthe\tprocess\t(e.g.,\ta database\ttransaction)\tand\tactually\tcreate\ta\tconcrete\tconcept\tto\trepresent\tthe\ttransaction itself.\tThis\tgives\tyou\ta\thandle,\tor\ta\thook,\ton\twhich\tto\trun\tother\toperations\tlike compensating\ttransactions,\tand\ta\tway\tto\tmonitor\tand\tmanage\tthese\tmore\tcomplex concepts\tin\tyour\tsystem.\tFor\texample,\tyou\tmight\tcreate\tthe\tidea\tof\tan\t“in-process-order” that\tgives\tyou\ta\tnatural\tplace\tto\tfocus\tall\tlogic\taround\tprocessing\tthe\torder\tend\tto\tend (and\tdealing\twith\texceptions).",
      "content_length": 1378,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 174,
      "content": "Reporting\n\nAs\twe’ve\talready\tseen,\tin\tsplitting\ta\tservice\tinto\tsmaller\tparts,\twe\tneed\tto\talso\tpotentially split\tup\thow\tand\twhere\tdata\tis\tstored.\tThis\tcreates\ta\tproblem,\thowever,\twhen\tit\tcomes\tto one\tvital\tand\tcommon\tuse\tcase:\treporting.\n\nA\tchange\tin\tarchitecture\tas\tfundamental\tas\tmoving\tto\ta\tmicroservices\tarchitecture\twill cause\ta\tlot\tof\tdisruption,\tbut\tit\tdoesn’t\tmean\twe\thave\tto\tabandon\teverything\twe\tdo.\tThe audience\tof\tour\treporting\tsystems\tare\tusers\tlike\tany\tother,\tand\twe\tneed\tto\tconsider\ttheir needs.\tIt\twould\tbe\tarrogant\tto\tfundamentally\tchange\tour\tarchitecture\tand\tjust\task\tthem\tto adapt.\tWhile\tI’m\tnot\tsuggesting\tthat\tthe\tspace\tof\treporting\tisn’t\tripe\tfor\tdisruption\t—\tit certainly\tis\t—\tthere\tis\tvalue\tin\tdetermining\thow\tto\twork\twith\texisting\tprocesses\tfirst. Sometimes\twe\thave\tto\tpick\tour\tbattles.",
      "content_length": 809,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 175,
      "content": "The\tReporting\tDatabase\n\nReporting\ttypically\tneeds\tto\tgroup\ttogether\tdata\tfrom\tacross\tmultiple\tparts\tof\tour organization\tin\torder\tto\tgenerate\tuseful\toutput.\tFor\texample,\twe\tmight\twant\tto\tenrich\tthe data\tfrom\tour\tgeneral\tledger\twith\tdescriptions\tof\twhat\twas\tsold,\twhich\twe\tget\tfrom\ta catalog.\tOr\twe\tmight\twant\tto\tlook\tat\tthe\tshopping\tbehavior\tof\tspecific,\thigh-value customers,\twhich\tcould\trequire\tinformation\tfrom\ttheir\tpurchase\thistory\tand\ttheir\tcustomer profile.\n\nIn\ta\tstandard,\tmonolithic\tservice\tarchitecture,\tall\tour\tdata\tis\tstored\tin\tone\tbig\tdatabase. This\tmeans\tall\tthe\tdata\tis\tin\tone\tplace,\tso\treporting\tacross\tall\tthe\tinformation\tis\tactually pretty\teasy,\tas\twe\tcan\tsimply\tjoin\tacross\tthe\tdata\tvia\tSQL\tqueries\tor\tthe\tlike.\tTypically\twe won’t\trun\tthese\treports\ton\tthe\tmain\tdatabase\tfor\tfear\tof\tthe\tload\tgenerated\tby\tour\tqueries impacting\tthe\tperformance\tof\tthe\tmain\tsystem,\tso\toften\tthese\treporting\tsystems\thang\ton\ta read\treplica\tas\tshown\tin\tFigure\t5-12.\n\nFigure\t5-12.\tStandard\tread\treplication\n\nWith\tthis\tapproach\twe\thave\tone\tsizeable\tupside\t—\tthat\tall\tthe\tdata\tis\talready\tin\tone\tplace, so\twe\tcan\tuse\tfairly\tstraightforward\ttools\tto\tquery\tit.\tBut\tthere\tare\talso\ta\tcouple\tof downsides\twith\tthis\tapproach.\tFirst,\tthe\tschema\tof\tthe\tdatabase\tis\tnow\teffectively\ta\tshared API\tbetween\tthe\trunning\tmonolithic\tservices\tand\tany\treporting\tsystem.\tSo\ta\tchange\tin schema\thas\tto\tbe\tcarefully\tmanaged.\tIn\treality,\tthis\tis\tanother\timpediment\tthat\treduces\tthe chances\tof\tanyone\twanting\tto\ttake\ton\tthe\ttask\tof\tmaking\tand\tcoordinating\tsuch\ta\tchange.\n\nSecond,\twe\thave\tlimited\toptions\tas\tto\thow\tthe\tdatabase\tcan\tbe\toptimized\tfor\teither\tuse case\t—\tbacking\tthe\tlive\tsystem\tor\tthe\treporting\tsystem.\tSome\tdatabases\tlet\tus\tmake",
      "content_length": 1708,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 176,
      "content": "optimizations\ton\tread\treplicas\tto\tenable\tfaster,\tmore\tefficient\treporting;\tfor\texample, MySQL\twould\tallow\tus\tto\trun\ta\tdifferent\tbackend\tthat\tdoesn’t\thave\tthe\toverhead\tof managing\ttransactions.\tHowever,\twe\tcannot\tstructure\tthe\tdata\tdifferently\tto\tmake reporting\tfaster\tif\tthat\tchange\tin\tdata\tstructure\thas\ta\tbad\timpact\ton\tthe\trunning\tsystem. What\toften\thappens\tis\tthat\tthe\tschema\teither\tends\tup\tbeing\tgreat\tfor\tone\tuse\tcase\tand lousy\tfor\tthe\tother,\tor\telse\tbecomes\tthe\tlowest\tcommon\tdenominator,\tgreat\tfor\tneither purpose.\n\nFinally,\tthe\tdatabase\toptions\tavailable\tto\tus\thave\texploded\trecently.\tWhile\tstandard relational\tdatabases\texpose\tSQL\tquery\tinterfaces\tthat\twork\twith\tmany\treporting\ttools, they\taren’t\talways\tthe\tbest\toption\tfor\tstoring\tdata\tfor\tour\trunning\tservices.\tWhat\tif\tour application\tdata\tis\tbetter\tmodeled\tas\ta\tgraph,\tas\tin\tNeo4j?\tOr\twhat\tif\twe’d\trather\tuse\ta document\tstore\tlike\tMongoDB?\tLikewise,\twhat\tif\twe\twanted\tto\texplore\tusing\ta\tcolumn- oriented\tdatabase\tlike\tCassandra\tfor\tour\treporting\tsystem,\twhich\tmakes\tit\tmuch\teasier\tto scale\tfor\tlarger\tvolumes?\tBeing\tconstrained\tin\thaving\tto\thave\tone\tdatabase\tfor\tboth purposes\tresults\tin\tus\toften\tnot\tbeing\table\tto\tmake\tthese\tchoices\tand\texplore\tnew\toptions.\n\nSo\tit’s\tnot\tperfect,\tbut\tit\tworks\t(mostly).\tNow\tif\tour\tinformation\tis\tstored\tin\tmultiple different\tsystems,\twhat\tdo\twe\tdo?\tIs\tthere\ta\tway\tfor\tus\tto\tbring\tall\tthe\tdata\ttogether\tto\trun our\treports?\tAnd\tcould\twe\talso\tpotentially\tfind\ta\tway\tto\teliminate\tsome\tof\tthe\tdownsides associated\twith\tthe\tstandard\treporting\tdatabase\tmodel?\n\nIt\tturns\tout\twe\thave\ta\tnumber\tof\tviable\talternatives\tto\tthis\tapproach.\tWhich\tsolution makes\tthe\tmost\tsense\tto\tyou\twill\tdepend\ton\ta\tnumber\tof\tfactors,\tbut\twe’ll\texplore\ta\tfew different\toptions\tthat\tI\thave\tseen\tin\tpractice.",
      "content_length": 1771,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 177,
      "content": "Data\tRetrieval\tvia\tService\tCalls\n\nThere\tare\tmany\tvariants\tof\tthis\tmodel,\tbut\tthey\tall\trely\ton\tpulling\tthe\trequired\tdata\tfrom the\tsource\tsystems\tvia\tAPI\tcalls.\tFor\ta\tvery\tsimple\treporting\tsystem,\tlike\ta\tdashboard\tthat might\tjust\twant\tto\tshow\tthe\tnumber\tof\torders\tplaced\tin\tthe\tlast\t15\tminutes,\tthis\tmight\tbe fine.\tTo\treport\tacross\tdata\tfrom\ttwo\tor\tmore\tsystems,\tyou\tneed\tto\tmake\tmultiple\tcalls\tto assemble\tthis\tdata.\n\nThis\tapproach\tbreaks\tdown\trapidly\twith\tuse\tcases\tthat\trequire\tlarger\tvolumes\tof\tdata, however.\tImagine\ta\tuse\tcase\twhere\twe\twant\tto\treport\ton\tcustomer\tpurchasing\tbehavior\tfor our\tmusic\tshop\tover\tthe\tlast\t24\tmonths,\tlooking\tat\tvarious\ttrends\tin\tcustomer\tbehavior and\thow\tthis\thas\timpacted\ton\trevenue.\tWe\tneed\tto\tpull\tlarge\tvolumes\tof\tdata\tfrom\tat\tleast the\tcustomer\tand\tfinance\tsystems.\tKeeping\ta\tlocal\tcopy\tof\tthis\tdata\tin\tthe\treporting system\tis\tdangerous,\tas\twe\tmay\tnot\tknow\tif\tit\thas\tchanged\t(even\thistoric\tdata\tmay\tbe changed\tafter\tthe\tfact),\tso\tto\tgenerate\tan\taccurate\treport\twe\tneed\tall\tof\tthe\tfinance\tand customer\trecords\tfor\tthe\tlast\ttwo\tyears.\tWith\teven\tmodest\tnumbers\tof\tcustomers,\tyou\tcan see\tthat\tthis\tquickly\twill\tbecome\ta\tvery\tslow\toperation.\n\nReporting\tsystems\talso\toften\trely\ton\tthird-party\ttools\tthat\texpect\tto\tretrieve\tdata\tin\ta certain\tway,\tand\there\tproviding\ta\tSQL\tinterface\tis\tthe\tfastest\tway\tto\tensure\tyour\treporting tool\tchain\tis\tas\teasy\tto\tintegrate\twith\tas\tpossible.\tWe\tcould\tstill\tuse\tthis\tapproach\tto\tpull data\tperiodically\tinto\ta\tSQL\tdatabase,\tof\tcourse,\tbut\tthis\tstill\tpresents\tus\twith\tsome challenges.\n\nOne\tof\tthe\tkey\tchallenges\tis\tthat\tthe\tAPIs\texposed\tby\tthe\tvarious\tmicroservices\tmay\twell not\tbe\tdesigned\tfor\treporting\tuse\tcases.\tFor\texample,\ta\tcustomer\tservice\tmay\tallow\tus\tto find\ta\tcustomer\tby\tan\tID,\tor\tsearch\tfor\ta\tcustomer\tby\tvarious\tfields,\tbut\twouldn’t necessarily\texpose\tan\tAPI\tto\tretrieve\tall\tcustomers.\tThis\tcould\tlead\tto\tmany\tcalls\tbeing made\tto\tretrieve\tall\tthe\tdata\t—\tfor\texample,\thaving\tto\titerate\tthrough\ta\tlist\tof\tall\tthe customers,\tmaking\ta\tseparate\tcall\tfor\teach\tone.\tNot\tonly\tcould\tthis\tbe\tinefficient\tfor\tthe reporting\tsystem,\tit\tcould\tgenerate\tload\tfor\tthe\tservice\tin\tquestion\ttoo.\n\nWhile\twe\tcould\tspeed\tup\tsome\tof\tthe\tdata\tretrieval\tby\tadding\tcache\theaders\tto\tthe resources\texposed\tby\tour\tservice,\tand\thave\tthis\tdata\tcached\tin\tsomething\tlike\ta\treverse proxy,\tthe\tnature\tof\treporting\tis\toften\tthat\twe\taccess\tthe\tlong\ttail\tof\tdata.\tThis\tmeans\tthat we\tmay\twell\trequest\tresources\tthat\tno\tone\telse\thas\trequested\tbefore\t(or\tat\tleast\tnot\tfor\ta sufficiently\tlong\ttime),\tresulting\tin\ta\tpotentially\texpensive\tcache\tmiss.\n\nYou\tcould\tresolve\tthis\tby\texposing\tbatch\tAPIs\tto\tmake\treporting\teasier.\tFor\texample,\tour customer\tservice\tcould\tallow\tyou\tto\tpass\ta\tlist\tof\tcustomer\tIDs\tto\tit\tto\tretrieve\tthem\tin batches,\tor\tmay\teven\texpose\tan\tinterface\tthat\tlets\tyou\tpage\tthrough\tall\tthe\tcustomers.\tA more\textreme\tversion\tof\tthis\tis\tto\tmodel\tthe\tbatch\trequest\tas\ta\tresource\tin\tits\town\tright. For\texample,\tthe\tcustomer\tservice\tmight\texpose\tsomething\tlike\ta\tBatchCustomerExport resource\tendpoint.\tThe\tcalling\tsystem\twould\tPOST\ta\tBatchRequest,\tperhaps\tpassing\tin\ta",
      "content_length": 3112,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 178,
      "content": "location\twhere\ta\tfile\tcan\tbe\tplaced\twith\tall\tthe\tdata.\tThe\tcustomer\tservice\twould\treturn\tan HTTP\t202\tresponse\tcode,\tindicating\tthat\tthe\trequest\twas\taccepted\tbut\thas\tnot\tyet\tbeen processed.\tThe\tcalling\tsystem\tcould\tthen\tpoll\tthe\tresource\twaiting\tuntil\tit\tretrieves\ta\t201 Created\tstatus,\tindicating\tthat\tthe\trequest\thas\tbeen\tfulfilled,\tand\tthen\tthe\tcalling\tsystem could\tgo\tand\tfetch\tthe\tdata.\tThis\twould\tallow\tpotentially\tlarge\tdata\tfiles\tto\tbe\texported without\tthe\toverhead\tof\tbeing\tsent\tover\tHTTP;\tinstead,\tthe\tsystem\tcould\tsimply\tsave\ta CSV\tfile\tto\ta\tshared\tlocation.\n\nI\thave\tseen\tthe\tpreceding\tapproach\tused\tfor\tbatch\tinsertion\tof\tdata,\twhere\tit\tworked\twell. I\tam\tless\tin\tfavor\tof\tit\tfor\treporting\tsystems,\thowever,\tas\tI\tfeel\tthat\tthere\tare\tother, potentially\tsimpler\tsolutions\tthat\tcan\tscale\tmore\teffectively\twhen\tyou’re\tdealing\twith traditional\treporting\tneeds.",
      "content_length": 865,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 179,
      "content": "Data\tPumps\n\nRather\tthan\thave\tthe\treporting\tsystem\tpull\tthe\tdata,\twe\tcould\tinstead\thave\tthe\tdata\tpushed to\tthe\treporting\tsystem.\tOne\tof\tthe\tdownsides\tof\tretrieving\tthe\tdata\tby\tstandard\tHTTP calls\tis\tthe\toverhead\tof\tHTTP\twhen\twe’re\tmaking\ta\tlarge\tnumber\tof\tcalls,\ttogether\twith the\toverhead\tof\thaving\tto\tcreate\tAPIs\tthat\tmay\texist\tonly\tfor\treporting\tpurposes.\tAn alternative\toption\tis\tto\thave\ta\tstandalone\tprogram\tthat\tdirectly\taccesses\tthe\tdatabase\tof the\tservice\tthat\tis\tthe\tsource\tof\tdata,\tand\tpumps\tit\tinto\ta\treporting\tdatabase,\tas\tshown\tin Figure\t5-13.\n\nFigure\t5-13.\tUsing\ta\tdata\tpump\tto\tperiodically\tpush\tdata\tto\ta\tcentral\treporting\tdatabase\n\nAt\tthis\tpoint\tyou’ll\tbe\tsaying,\t“But\tSam,\tyou\tsaid\thaving\tlots\tof\tprograms\tintegrating\ton the\tsame\tdatabase\tis\ta\tbad\tidea!”\tAt\tleast\tI\thope\tyou’ll\tbe\tsaying\tthat,\tgiven\thow\tfirmly\tI made\tthe\tpoint\tearlier!\tThis\tapproach,\tif\timplemented\tproperly,\tis\ta\tnotable\texception, where\tthe\tdownsides\tof\tthe\tcoupling\tare\tmore\tthan\tmitigated\tby\tmaking\tthe\treporting easier.\n\nTo\tstart\twith,\tthe\tdata\tpump\tshould\tbe\tbuilt\tand\tmanaged\tby\tthe\tsame\tteam\tthat\tmanages the\tservice.\tThis\tcan\tbe\tsomething\tas\tsimple\tas\ta\tcommand-line\tprogram\ttriggered\tvia Cron.\tThis\tprogram\tneeds\tto\thave\tintimate\tknowledge\tof\tboth\tthe\tinternal\tdatabase\tfor\tthe service,\tand\talso\tthe\treporting\tschema.\tThe\tpump’s\tjob\tis\tto\tmap\tone\tfrom\tthe\tother.\tWe try\tto\treduce\tthe\tproblems\twith\tcoupling\tto\tthe\tservice’s\tschema\tby\thaving\tthe\tsame\tteam that\tmanages\tthe\tservice\talso\tmanage\tthe\tpump.\tI\twould\tsuggest,\tin\tfact,\tthat\tyou\tversion- control\tthese\ttogether,\tand\thave\tbuilds\tof\tthe\tdata\tpump\tcreated\tas\tan\tadditional\tartifact\tas part\tof\tthe\tbuild\tof\tthe\tservice\titself,\twith\tthe\tassumption\tthat\twhenever\tyou\tdeploy\tone\tof them,\tyou\tdeploy\tthem\tboth.\tAs\twe\texplicitly\tstate\tthat\twe\tdeploy\tthese\ttogether,\tand don’t\topen\tup\taccess\tto\tthe\tschema\tto\tanyone\toutside\tof\tthe\tservice\tteam,\tmany\tof\tthe traditional\tDB\tintegration\tchallenges\tare\tlargely\tmitigated.\n\nThe\tcoupling\ton\tthe\treporting\tschema\titself\tremains,\tbut\twe\thave\tto\ttreat\tit\tas\ta\tpublished API\tthat\tis\thard\tto\tchange.\tSome\tdatabases\tgive\tus\ttechniques\twhere\twe\tcould\tfurther mitigate\tthis\tcost.\tFigure\t5-14\tshows\tan\texample\tof\tthis\tfor\trelational\tdatabases,\twhere\twe could\thave\tone\tschema\tin\tthe\treporting\tdatabase\tfor\teach\tservice,\tusing\tthings\tlike",
      "content_length": 2313,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 180,
      "content": "materialized\tviews\tto\tcreate\tthe\taggregated\tview.\tThat\tway,\twe\texpose\tonly\tthe\treporting schema\tfor\tthe\tcustomer\tdata\tto\tthe\tcustomer\tdata\tpump.\tWhether\tthis\tis\tsomething\tthat you\tcan\tdo\tin\ta\tperformant\tmanner,\thowever,\twill\tdepend\ton\tthe\tcapabilities\tof\tthe database\tyou\tpicked\tfor\treporting.\n\nFigure\t5-14.\tUtilizing\tmaterialized\tviews\tto\tform\ta\tsingle\tmonolithic\treporting\tschema\n\nHere,\tof\tcourse,\tthe\tcomplexity\tof\tintegration\tis\tpushed\tdeeper\tinto\tthe\tschema,\tand\twill rely\ton\tcapabilities\tin\tthe\tdatabase\tto\tmake\tsuch\ta\tsetup\tperformant.\tWhile\tI\tthink\tdata pumps\tin\tgeneral\tare\ta\tsensible\tand\tworkable\tsuggestion,\tI\tam\tless\tconvinced\tthat\tthe complexity\tof\ta\tsegmented\tschema\tis\tworthwhile,\tespecially\tgiven\tthe\tchallenges\tin managing\tchange\tin\tthe\tdatabase.",
      "content_length": 763,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 181,
      "content": "Alternative\tDestinations\n\nOn\tone\tproject\tI\twas\tinvolved\twith,\twe\tused\ta\tseries\tof\tdata\tpumps\tto\tpopulate\tJSON\tfiles in\tAWS\tS3,\teffectively\tusing\tS3\tto\tmasquerade\tas\ta\tgiant\tdata\tmart!\tThis\tapproach worked\tvery\twell\tuntil\twe\tneeded\tto\tscale\tour\tsolution,\tand\tat\tthe\ttime\tof\twriting\twe\tare looking\tto\tchange\tthese\tpumps\tto\tinstead\tpopulate\ta\tcube\tthat\tcan\tbe\tintegrated\twith standard\treporting\ttools\tlike\tExcel\tand\tTableau.",
      "content_length": 421,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 182,
      "content": "Event\tData\tPump\n\nIn\tChapter\t4,\twe\ttouched\ton\tthe\tidea\tof\tmicroservices\temitting\tevents\tbased\ton\tthe\tstate change\tof\tentities\tthat\tthey\tmanage.\tFor\texample,\tour\tcustomer\tservice\tmay\temit\tan\tevent when\ta\tgiven\tcustomer\tis\tcreated,\tor\tupdated,\tor\tdeleted.\tFor\tthose\tmicroservices\tthat expose\tsuch\tevent\tfeeds,\twe\thave\tthe\toption\tof\twriting\tour\town\tevent\tsubscriber\tthat pumps\tdata\tinto\tthe\treporting\tdatabase,\tas\tshown\tin\tFigure\t5-15.\n\nFigure\t5-15.\tAn\tevent\tdata\tpump\tusing\tstate\tchange\tevents\tto\tpopulate\ta\treporting\tdatabase\n\nThe\tcoupling\ton\tthe\tunderlying\tdatabase\tof\tthe\tsource\tmicroservice\tis\tnow\tavoided. Instead,\twe\tare\tjust\tbinding\tto\tthe\tevents\temitted\tby\tthe\tservice,\twhich\tare\tdesigned\tto\tbe exposed\tto\texternal\tconsumers.\tGiven\tthat\tevents\tare\ttemporal\tin\tnature,\tit\talso\tmakes\tit easier\tfor\tus\tto\tbe\tsmarter\tin\twhat\tdata\twe\tsent\tto\tour\tcentral\treporting\tstore;\twe\tcan\tsend data\tto\tthe\treporting\tsystem\tas\twe\tsee\tan\tevent,\tallowing\tdata\tto\tflow\tfaster\tto\tour reporting\tsystem,\trather\tthan\trelying\ton\ta\tregular\tschedule\tas\twith\tthe\tdata\tpump.\n\nAlso,\tif\twe\tstore\twhich\tevents\thave\talready\tbeen\tprocessed,\twe\tcan\tjust\tprocess\tthe\tnew events\tas\tthey\tarrive,\tassuming\tthe\told\tevents\thave\talready\tbeen\tmapped\tinto\tthe\treporting system.\tThis\tmeans\tour\tinsertion\twill\tbe\tmore\tefficient,\tas\twe\tonly\tneed\tto\tsend\tdeltas. We\tcan\tdo\tsimilar\tthings\twith\ta\tdata\tpump,\tbut\twe\thave\tto\tmanage\tthis\tourselves,\twhereas the\tfundamentally\ttemporal\tnature\tof\tthe\tstream\tof\tevents\t(x\thappens\tat\ttimestamp\ty) helps\tus\tgreatly.\n\nAs\tour\tevent\tdata\tpump\tis\tless\tcoupled\tto\tthe\tinternals\tof\tthe\tservice,\tit\tis\talso\teasier\tto consider\tthis\tbeing\tmanaged\tby\ta\tseparate\tgroup\tfrom\tthe\tteam\tlooking\tafter\tthe microservice\titself.\tAs\tlong\tas\tthe\tnature\tof\tour\tevent\tstream\tdoesn’t\toverly\tcouple subscribers\tto\tchanges\tin\tthe\tservice,\tthis\tevent\tmapper\tcan\tevolve\tindependently\tof\tthe service\tit\tsubscribes\tto.\n\nThe\tmain\tdownsides\tto\tthis\tapproach\tare\tthat\tall\tthe\trequired\tinformation\tmust\tbe broadcast\tas\tevents,\tand\tit\tmay\tnot\tscale\tas\twell\tas\ta\tdata\tpump\tfor\tlarger\tvolumes\tof\tdata that\thas\tthe\tbenefit\tof\toperating\tdirectly\tat\tthe\tdatabase\tlevel.\tNonetheless,\tthe\tlooser coupling\tand\tfresher\tdata\tavailable\tvia\tsuch\tan\tapproach\tmakes\tit\tstrongly\tworth considering\tif\tyou\tare\talready\texposing\tthe\tappropriate\tevents.",
      "content_length": 2295,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 183,
      "content": "Backup\tData\tPump\n\nThis\toption\tis\tbased\ton\tan\tapproach\tused\tat\tNetflix,\twhich\ttakes\tadvantage\tof\texisting backup\tsolutions\tand\talso\tresolves\tsome\tscale\tissues\tthat\tNetflix\thas\tto\tdeal\twith.\tIn\tsome ways,\tyou\tcan\tconsider\tthis\ta\tspecial\tcase\tof\ta\tdata\tpump,\tbut\tit\tseemed\tlike\tsuch\tan interesting\tsolution\tthat\tit\tdeserves\tinclusion.\n\nNetflix\thas\tdecided\tto\tstandardize\ton\tCassandra\tas\tthe\tbacking\tstore\tfor\tits\tservices,\tof which\tthere\tare\tmany.\tNetflix\thas\tinvested\tsignificant\ttime\tin\tbuilding\ttools\tto\tmake Cassandra\teasy\tto\twork\twith,\tmuch\tof\twhich\tthe\tcompany\thas\tshared\twith\tthe\trest\tof\tthe world\tvia\tnumerous\topen\tsource\tprojects.\tObviously\tit\tis\tvery\timportant\tthat\tthe\tdata Netflix\tstores\tis\tproperly\tbacked\tup.\tTo\tback\tup\tCassandra\tdata,\tthe\tstandard\tapproach\tis to\tmake\ta\tcopy\tof\tthe\tdata\tfiles\tthat\tback\tit\tand\tstore\tthem\tsomewhere\tsafe.\tNetflix\tstores these\tfiles,\tknown\tas\tSSTables,\tin\tAmazon’s\tS3\tobject\tstore,\twhich\tprovides\tsignificant data\tdurability\tguarantees.\n\nNetflix\tneeds\tto\treport\tacross\tall\tthis\tdata,\tbut\tgiven\tthe\tscale\tinvolved\tthis\tis\ta\tnontrivial challenge.\tIts\tapproach\tis\tto\tuse\tHadoop\tthat\tuses\tSSTable\tbackup\tas\tthe\tsource\tof\tits jobs.\tIn\tthe\tend,\tNetflix\tended\tup\timplementing\ta\tpipeline\tcapable\tof\tprocessing\tlarge amounts\tof\tdata\tusing\tthis\tapproach,\twhich\tit\tthen\topen\tsourced\tas\tthe\tAegisthus\tproject. Like\tdata\tpumps,\tthough,\twith\tthis\tpattern\twe\tstill\thave\ta\tcoupling\tto\tthe\tdestination reporting\tschema\t(or\ttarget\tsystem).\n\nIt\tis\tconceivable\tthat\tusing\ta\tsimilar\tapproach\t—\tthat\tis,\tusing\tmappers\tthat\twork\toff backups\t—\twould\twork\tin\tother\tcontexts\tas\twell.\tAnd\tif\tyou’re\talready\tusing\tCassandra, Netflix\thas\talready\tdone\tmuch\tof\tthe\twork\tfor\tyou!",
      "content_length": 1690,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 184,
      "content": "Toward\tReal\tTime\n\nMany\tof\tthe\tpatterns\tpreviously\toutlined\tare\tdifferent\tways\tof\tgetting\ta\tlot\tof\tdata\tfrom many\tdifferent\tplaces\tto\tone\tplace.\tBut\tdoes\tthe\tidea\tthat\tall\tour\treporting\twill\tbe\tdone from\tone\tlocation\treally\tstack\tup\tanymore?\tWe\thave\tdashboards,\talerting,\tfinancial reports,\tuser\tanalytics\t—\tall\tof\tthese\tuse\tcases\thave\tdifferent\ttolerances\tfor\taccuracy\tand timeliness,\twhich\tmay\tresult\tin\tdifferent\ttechnical\toptions\tcoming\tto\tbear.\tAs\tI\twill\tdetail in\tChapter\t8,\twe\tare\tmoving\tmore\tand\tmore\ttoward\tgeneric\teventing\tsystems\tcapable\tof routing\tour\tdata\tto\tmultiple\tdifferent\tplaces\tdepending\ton\tneed.",
      "content_length": 615,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 185,
      "content": "Cost\tof\tChange\n\nThere\tare\tmany\treasons\twhy,\tthroughout\tthe\tbook,\tI\tpromote\tthe\tneed\tto\tmake\tsmall, incremental\tchanges,\tbut\tone\tof\tthe\tkey\tdrivers\tis\tto\tunderstand\tthe\timpact\tof\teach alteration\twe\tmake\tand\tchange\tcourse\tif\trequired.\tThis\tallows\tus\tto\tbetter\tmitigate\tthe cost\tof\tmistakes,\tbut\tdoesn’t\tremove\tthe\tchance\tof\tmistakes\tentirely.\tWe\tcan\t—\tand\twill —\tmake\tmistakes,\tand\twe\tshould\tembrace\tthat.\tWhat\twe\tshould\talso\tdo,\tthough,\tis understand\thow\tbest\tto\tmitigate\tthe\tcosts\tof\tthose\tmistakes.\n\nAs\twe\thave\tseen,\tthe\tcost\tinvolved\tin\tmoving\tcode\taround\twithin\ta\tcodebase\tis\tpretty small.\tWe\thave\tlots\tof\ttools\tthat\tsupport\tus,\tand\tif\twe\tcause\ta\tproblem,\tthe\tfix\tis\tgenerally quick.\tSplitting\tapart\ta\tdatabase,\thowever,\tis\tmuch\tmore\twork,\tand\trolling\tback\ta\tdatabase change\tis\tjust\tas\tcomplex.\tLikewise,\tuntangling\tan\toverly\tcoupled\tintegration\tbetween services,\tor\thaving\tto\tcompletely\trewrite\tan\tAPI\tthat\tis\tused\tby\tmultiple\tconsumers,\tcan be\ta\tsizeable\tundertaking.\tThe\tlarge\tcost\tof\tchange\tmeans\tthat\tthese\toperations\tare increasingly\trisky.\tHow\tcan\twe\tmanage\tthis\trisk?\tMy\tapproach\tis\tto\ttry\tto\tmake\tmistakes where\tthe\timpact\twill\tbe\tlowest.\n\nI\ttend\tto\tdo\tmuch\tof\tmy\tthinking\tin\tthe\tplace\twhere\tthe\tcost\tof\tchange\tand\tthe\tcost\tof mistakes\tis\tas\tlow\tas\tit\tcan\tbe:\tthe\twhiteboard.\tSketch\tout\tyour\tproposed\tdesign.\tSee\twhat happens\twhen\tyou\trun\tuse\tcases\tacross\twhat\tyou\tthink\tyour\tservice\tboundaries\twill\tbe. For\tour\tmusic\tshop,\tfor\texample,\timagine\twhat\thappens\twhen\ta\tcustomer\tsearches\tfor\ta record,\tregisters\twith\tthe\twebsite,\tor\tpurchases\tan\talbum.\tWhat\tcalls\tget\tmade?\tDo\tyou start\tseeing\todd\tcircular\treferences?\tDo\tyou\tsee\ttwo\tservices\tthat\tare\toverly\tchatty,\twhich might\tindicate\tthey\tshould\tbe\tone\tthing?\n\nA\tgreat\ttechnique\there\tis\tto\tadapt\tan\tapproach\tmore\ttypically\ttaught\tfor\tthe\tdesign\tof object-oriented\tsystems:\tclass-responsibility-collaboration\t(CRC)\tcards.\tWith\tCRC\tcards, you\twrite\ton\tone\tindex\tcard\tthe\tname\tof\tthe\tclass,\twhat\tits\tresponsibilities\tare,\tand\twho\tit collaborates\twith.\tWhen\tworking\tthrough\ta\tproposed\tdesign,\tfor\teach\tservice\tI\tlist\tits responsibilities\tin\tterms\tof\tthe\tcapabilities\tit\tprovides,\twith\tthe\tcollaborators\tspecified\tin the\tdiagram.\tAs\tyou\twork\tthrough\tmore\tuse\tcases,\tyou\tstart\tto\tget\ta\tsense\tas\tto\twhether all\tof\tthis\thangs\ttogether\tproperly.",
      "content_length": 2297,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 186,
      "content": "Understanding\tRoot\tCauses\n\nWe\thave\tdiscussed\thow\tto\tsplit\tapart\tlarger\tservices\tinto\tsmaller\tones,\tbut\twhy\tdid\tthese services\tgrow\tso\tlarge\tin\tthe\tfirst\tplace?\tThe\tfirst\tthing\tto\tunderstand\tis\tthat\tgrowing\ta service\tto\tthe\tpoint\tthat\tit\tneeds\tto\tbe\tsplit\tis\tcompletely\tOK.\tWe\twant\tthe\tarchitecture\tof our\tsystem\tto\tchange\tover\ttime\tin\tan\tincremental\tfashion.\tThe\tkey\tis\tknowing\tit\tneeds\tto be\tsplit\tbefore\tthe\tsplit\tbecomes\ttoo\texpensive.\n\nBut\tin\tpractice\tmany\tof\tus\twill\thave\tseen\tservices\tgrow\twell\tbeyond\tthe\tpoint\tof\tsanity. Despite\tknowing\tthat\ta\tsmaller\tset\tof\tservices\twould\tbe\teasier\tto\tdeal\twith\tthan\tthe\thuge monstrosity\twe\tcurrently\thave,\twe\tstill\tplow\ton\twith\tgrowing\tthe\tbeast.\tWhy?\n\nPart\tof\tthe\tproblem\tis\tknowing\twhere\tto\tstart,\tand\tI’m\thoping\tthis\tchapter\thas\thelped.\tBut another\tchallenge\tis\tthe\tcost\tassociated\twith\tsplitting\tout\tservices.\tFinding\tsomewhere\tto run\tthe\tservice,\tspinning\tup\ta\tnew\tservice\tstack,\tand\tso\ton,\tare\tnontrivial\ttasks.\tSo\thow\tdo we\taddress\tthis?\tWell,\tif\tdoing\tsomething\tis\tright\tbut\tdifficult,\twe\tshould\tstrive\tto\tmake things\teasier.\tInvestment\tin\tlibraries\tand\tlightweight\tservice\tframeworks\tcan\treduce\tthe cost\tassociated\twith\tcreating\tthe\tnew\tservice.\tGiving\tpeople\taccess\tto\tself-service provision\tvirtual\tmachines\tor\teven\tmaking\ta\tplatform\tas\ta\tservice\t(PaaS)\tavailable\twill make\tit\teasier\tto\tprovision\tsystems\tand\ttest\tthem.\tThroughout\tthe\trest\tof\tthe\tbook,\twe’ll be\tdiscussing\ta\tnumber\tof\tways\tto\thelp\tyou\tkeep\tthis\tcost\tdown.",
      "content_length": 1477,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 187,
      "content": "Summary\n\nWe\tdecompose\tour\tsystem\tby\tfinding\tseams\talong\twhich\tservice\tboundaries\tcan\temerge, and\tthis\tcan\tbe\tan\tincremental\tapproach.\tBy\tgetting\tgood\tat\tfinding\tthese\tseams\tand working\tto\treduce\tthe\tcost\tof\tsplitting\tout\tservices\tin\tthe\tfirst\tplace,\twe\tcan\tcontinue\tto grow\tand\tevolve\tour\tsystems\tto\tmeet\twhatever\trequirements\tcome\tdown\tthe\troad.\tAs\tyou can\tsee,\tsome\tof\tthis\twork\tcan\tbe\tpainstaking.\tBut\tthe\tvery\tfact\tthat\tit\tcan\tbe\tdone incrementally\tmeans\tthere\tis\tno\tneed\tto\tfear\tthis\twork.\n\nSo\tnow\twe\tcan\tsplit\tour\tservices\tout,\tbut\twe’ve\tintroduced\tsome\tnew\tproblems\ttoo.\tWe have\tmany\tmore\tmoving\tparts\tto\tget\tinto\tproduction\tnow!\tSo\tnext\tup\twe’ll\tdive\tinto\tthe world\tof\tdeployment.",
      "content_length": 688,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 188,
      "content": "Chapter\t6.\tDeployment\n\nDeploying\ta\tmonolithic\tapplication\tis\ta\tfairly\tstraightforward\tprocess.\tMicroservices,\twith their\tinterdependence,\tare\ta\tdifferent\tkettle\tof\tfish\taltogether.\tIf\tyou\tdon’t\tapproach deployment\tright,\tit’s\tone\tof\tthose\tareas\twhere\tthe\tcomplexity\tcan\tmake\tyour\tlife\ta misery.\tIn\tthis\tchapter,\twe’re\tgoing\tto\tlook\tat\tsome\ttechniques\tand\ttechnology\tthat\tcan help\tus\twhen\tdeploying\tmicroservices\tinto\tfine-grained\tarchitectures.\n\nWe’re\tgoing\tto\tstart\toff,\tthough,\tby\ttaking\ta\tlook\tat\tcontinuous\tintegration\tand\tcontinuous delivery.\tThese\trelated\tbut\tdifferent\tconcepts\twill\thelp\tshape\tthe\tother\tdecisions\twe’ll make\twhen\tthinking\tabout\twhat\tto\tbuild,\thow\tto\tbuild\tit,\tand\thow\tto\tdeploy\tit.",
      "content_length": 705,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 189,
      "content": "A\tBrief\tIntroduction\tto\tContinuous\tIntegration\n\nContinuous\tintegration\t(CI)\thas\tbeen\taround\tfor\ta\tnumber\tof\tyears\tat\tthis\tpoint.\tIt’s\tworth spending\ta\tbit\tof\ttime\tgoing\tover\tthe\tbasics,\thowever,\tas\tespecially\twhen\twe\tthink\tabout the\tmapping\tbetween\tmicroservices,\tbuilds,\tand\tversion\tcontrol\trepositories,\tthere\tare some\tdifferent\toptions\tto\tconsider.\n\nWith\tCI,\tthe\tcore\tgoal\tis\tto\tkeep\teveryone\tin\tsync\twith\teach\tother,\twhich\twe\tachieve\tby making\tsure\tthat\tnewly\tchecked-in\tcode\tproperly\tintegrates\twith\texisting\tcode.\tTo\tdo\tthis, a\tCI\tserver\tdetects\tthat\tthe\tcode\thas\tbeen\tcommitted,\tchecks\tit\tout,\tand\tcarries\tout\tsome verification\tlike\tmaking\tsure\tthe\tcode\tcompiles\tand\tthat\ttests\tpass.\n\nAs\tpart\tof\tthis\tprocess,\twe\toften\tcreate\tartifact(s)\tthat\tare\tused\tfor\tfurther\tvalidation,\tsuch as\tdeploying\ta\trunning\tservice\tto\trun\ttests\tagainst\tit.\tIdeally,\twe\twant\tto\tbuild\tthese artifacts\tonce\tand\tonce\tonly,\tand\tuse\tthem\tfor\tall\tdeployments\tof\tthat\tversion\tof\tthe\tcode. This\tis\tin\torder\tto\tavoid\tdoing\tthe\tsame\tthing\tover\tand\tover\tagain,\tand\tso\tthat\twe\tcan confirm\tthat\tthe\tartifact\twe\tdeployed\tis\tthe\tone\twe\ttested.\tTo\tenable\tthese\tartifacts\tto\tbe reused,\twe\tplace\tthem\tin\ta\trepository\tof\tsome\tsort,\teither\tprovided\tby\tthe\tCI\ttool\titself\tor on\ta\tseparate\tsystem.\n\nWe’ll\tbe\tlooking\tat\twhat\tsorts\tof\tartifacts\twe\tcan\tuse\tfor\tmicroservices\tshortly,\tand\twe’ll look\tin\tdepth\tat\ttesting\tin\tChapter\t7.\n\nCI\thas\ta\tnumber\tof\tbenefits.\tWe\tget\tsome\tlevel\tof\tfast\tfeedback\tas\tto\tthe\tquality\tof\tour code.\tIt\tallows\tus\tto\tautomate\tthe\tcreation\tof\tour\tbinary\tartifacts.\tAll\tthe\tcode\trequired\tto build\tthe\tartifact\tis\titself\tversion\tcontrolled,\tso\twe\tcan\tre-create\tthe\tartifact\tif\tneeded.\tWe also\tget\tsome\tlevel\tof\ttraceability\tfrom\ta\tdeployed\tartifact\tback\tto\tthe\tcode,\tand depending\ton\tthe\tcapabilities\tof\tthe\tCI\ttool\titself,\tcan\tsee\twhat\ttests\twere\trun\ton\tthe\tcode and\tartifact\ttoo.\tIt’s\tfor\tthese\treasons\tthat\tCI\thas\tbeen\tso\tsuccessful.",
      "content_length": 1922,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 190,
      "content": "Are\tYou\tReally\tDoing\tIt?\n\nI\tsuspect\tyou\tare\tprobably\tusing\tcontinuous\tintegration\tin\tyour\town\torganization.\tIf\tnot, you\tshould\tstart.\tIt\tis\ta\tkey\tpractice\tthat\tallows\tus\tto\tmake\tchanges\tquickly\tand\teasily,\tand without\twhich\tthe\tjourney\tinto\tmicroservices\twill\tbe\tpainful.\tThat\tsaid,\tI\thave\tworked with\tmany\tteams\twho,\tdespite\tsaying\tthat\tthey\tdo\tCI,\taren’t\tactually\tdoing\tit\tat\tall.\tThey confuse\tthe\tuse\tof\ta\tCI\ttool\twith\tadopting\tthe\tpractice\tof\tCI.\tThe\ttool\tis\tjust\tsomething that\tenables\tthe\tapproach.\n\nI\treally\tlike\tJez\tHumble’s\tthree\tquestions\the\tasks\tpeople\tto\ttest\tif\tthey\treally\tunderstand what\tCI\tis\tabout:\n\nDo\tyou\tcheck\tin\tto\tmainline\tonce\tper\tday?\n\nYou\tneed\tto\tmake\tsure\tyour\tcode\tintegrates.\tIf\tyou\tdon’t\tcheck\tyour\tcode\ttogether with\teveryone\telse’s\tchanges\tfrequently,\tyou\tend\tup\tmaking\tfuture\tintegration\tharder. Even\tif\tyou\tare\tusing\tshort-lived\tbranches\tto\tmanage\tchanges,\tintegrate\tas\tfrequently as\tyou\tcan\tinto\ta\tsingle\tmainline\tbranch.\n\nDo\tyou\thave\ta\tsuite\tof\ttests\tto\tvalidate\tyour\tchanges?\n\nWithout\ttests,\twe\tjust\tknow\tthat\tsyntactically\tour\tintegration\thas\tworked,\tbut\twe don’t\tknow\tif\twe\thave\tbroken\tthe\tbehavior\tof\tthe\tsystem.\tCI\twithout\tsome verification\tthat\tour\tcode\tbehaves\tas\texpected\tisn’t\tCI.\n\nWhen\tthe\tbuild\tis\tbroken,\tis\tit\tthe\t#1\tpriority\tof\tthe\tteam\tto\tfix\tit?\n\nA\tpassing\tgreen\tbuild\tmeans\tour\tchanges\thave\tsafely\tbeen\tintegrated.\tA\tred\tbuild means\tthe\tlast\tchange\tpossibly\tdid\tnot\tintegrate.\tYou\tneed\tto\tstop\tall\tfurther\tcheck- ins\tthat\taren’t\tinvolved\tin\tfixing\tthe\tbuilds\tto\tget\tit\tpassing\tagain.\tIf\tyou\tlet\tmore changes\tpile\tup,\tthe\ttime\tit\ttakes\tto\tfix\tthe\tbuild\twill\tincrease\tdrastically.\tI’ve\tworked with\tteams\twhere\tthe\tbuild\thas\tbeen\tbroken\tfor\tdays,\tresulting\tin\tsubstantial\tefforts to\teventually\tget\ta\tpassing\tbuild.",
      "content_length": 1763,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 191,
      "content": "Mapping\tContinuous\tIntegration\tto\tMicroservices\n\nWhen\tthinking\tabout\tmicroservices\tand\tcontinuous\tintegration,\twe\tneed\tto\tthink\tabout how\tour\tCI\tbuilds\tmap\tto\tindividual\tmicroservices.\tAs\tI\thave\tsaid\tmany\ttimes,\twe\twant\tto ensure\tthat\twe\tcan\tmake\ta\tchange\tto\ta\tsingle\tservice\tand\tdeploy\tit\tindependently\tof\tthe rest.\tWith\tthis\tin\tmind,\thow\tshould\twe\tmap\tindividual\tmicroservices\tto\tCI\tbuilds\tand source\tcode?\n\nIf\twe\tstart\twith\tthe\tsimplest\toption,\twe\tcould\tlump\teverything\tin\ttogether.\tWe\thave\ta single,\tgiant\trepository\tstoring\tall\tour\tcode,\tand\thave\tone\tsingle\tbuild,\tas\twe\tsee\tin Figure\t6-1.\tAny\tcheck-in\tto\tthis\tsource\tcode\trepository\twill\tcause\tour\tbuild\tto\ttrigger, where\twe\twill\trun\tall\tthe\tverification\tsteps\tassociated\twith\tall\tour\tmicroservices,\tand produce\tmultiple\tartifacts,\tall\ttied\tback\tto\tthe\tsame\tbuild.\n\nFigure\t6-1.\tUsing\ta\tsingle\tsource\tcode\trepository\tand\tCI\tbuild\tfor\tall\tmicroservices\n\nThis\tseems\tmuch\tsimpler\ton\tthe\tsurface\tthan\tother\tapproaches:\tfewer\trepositories\tto worry\tabout,\tand\ta\tconceptually\tsimpler\tbuild.\tFrom\ta\tdeveloper\tpoint\tof\tview,\tthings\tare pretty\tstraightforward\ttoo.\tI\tjust\tcheck\tcode\tin.\tIf\tI\thave\tto\twork\ton\tmultiple\tservices\tat once,\tI\tjust\thave\tto\tworry\tabout\tone\tcommit.\n\nThis\tmodel\tcan\twork\tperfectly\twell\tif\tyou\tbuy\tinto\tthe\tidea\tof\tlock-step\treleases,\twhere you\tdon’t\tmind\tdeploying\tmultiple\tservices\tat\tonce.\tIn\tgeneral,\tthis\tis\tabsolutely\ta\tpattern to\tavoid,\tbut\tvery\tearly\ton\tin\ta\tproject,\tespecially\tif\tonly\tone\tteam\tis\tworking\ton everything,\tthis\tmight\tmake\tsense\tfor\tshort\tperiods\tof\ttime.\n\nHowever,\tthere\tare\tsome\tsignificant\tdownsides.\tIf\tI\tmake\ta\tone-line\tchange\tto\ta\tsingle service\t—\tfor\texample,\tchanging\tthe\tbehavior\tin\tthe\tuser\tservice\tin\tFigure\t6-1\t—\tall\tthe other\tservices\tget\tverified\tand\tbuilt.\tThis\tcould\ttake\tmore\ttime\tthan\tneeded\t—\tI’m waiting\tfor\tthings\tthat\tprobably\tdon’t\tneed\tto\tbe\ttested.\tThis\timpacts\tour\tcycle\ttime,\tthe speed\tat\twhich\twe\tcan\tmove\ta\tsingle\tchange\tfrom\tdevelopment\tto\tlive.\tMore\ttroubling, though,\tis\tknowing\twhat\tartifacts\tshould\tor\tshouldn’t\tbe\tdeployed.\tDo\tI\tnow\tneed\tto deploy\tall\tthe\tbuild\tservices\tto\tpush\tmy\tsmall\tchange\tinto\tproduction?\tIt\tcan\tbe\thard\tto tell;\ttrying\tto\tguess\twhich\tservices\treally\tchanged\tjust\tby\treading\tthe\tcommit\tmessages\tis",
      "content_length": 2246,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 192,
      "content": "difficult.\tOrganizations\tusing\tthis\tapproach\toften\tfall\tback\tto\tjust\tdeploying\teverything together,\twhich\twe\treally\twant\tto\tavoid.\n\nFurthermore,\tif\tmy\tone-line\tchange\tto\tthe\tuser\tservice\tbreaks\tthe\tbuild,\tno\tother\tchanges can\tbe\tmade\tto\tthe\tother\tservices\tuntil\tthat\tbreak\tis\tfixed.\tAnd\tthink\tabout\ta\tscenario where\tyou\thave\tmultiple\tteams\tall\tsharing\tthis\tgiant\tbuild.\tWho\tis\tin\tcharge?\n\nA\tvariation\tof\tthis\tapproach\tis\tto\thave\tone\tsingle\tsource\ttree\twith\tall\tof\tthe\tcode\tin\tit,\twith multiple\tCI\tbuilds\tmapping\tto\tparts\tof\tthis\tsource\ttree,\tas\twe\tsee\tin\tFigure\t6-2.\tWith\twell- defined\tstructure,\tyou\tcan\teasily\tmap\tthe\tbuilds\tto\tcertain\tparts\tof\tthe\tsource\ttree.\tIn general,\tI\tam\tnot\ta\tfan\tof\tthis\tapproach,\tas\tthis\tmodel\tcan\tbe\ta\tmixed\tblessing.\tOn\tthe\tone hand,\tmy\tcheck-in/check-out\tprocess\tcan\tbe\tsimpler\tas\tI\thave\tonly\tone\trepository\tto worry\tabout.\tOn\tthe\tother\thand,\tit\tbecomes\tvery\teasy\tto\tget\tinto\tthe\thabit\tof\tchecking\tin source\tcode\tfor\tmultiple\tservices\tat\tonce,\twhich\tcan\tmake\tit\tequally\teasy\tto\tslip\tinto making\tchanges\tthat\tcouple\tservices\ttogether.\tI\twould\tgreatly\tprefer\tthis\tapproach, however,\tover\thaving\ta\tsingle\tbuild\tfor\tmultiple\tservices.\n\nFigure\t6-2.\tA\tsingle\tsource\trepo\twith\tsubdirectories\tmapped\tto\tindependent\tbuilds\n\nSo\tis\tthere\tanother\talternative?\tThe\tapproach\tI\tprefer\tis\tto\thave\ta\tsingle\tCI\tbuild\tper microservice,\tto\tallow\tus\tto\tquickly\tmake\tand\tvalidate\ta\tchange\tprior\tto\tdeployment\tinto production,\tas\tshown\tin\tFigure\t6-3.\tHere\teach\tmicroservice\thas\tits\town\tsource\tcode repository,\tmapped\tto\tits\town\tCI\tbuild.\tWhen\tmaking\ta\tchange,\tI\trun\tonly\tthe\tbuild\tand tests\tI\tneed\tto.\tI\tget\ta\tsingle\tartifact\tto\tdeploy.\tAlignment\tto\tteam\townership\tis\tmore\tclear too.\tIf\tyou\town\tthe\tservice,\tyou\town\tthe\trepository\tand\tthe\tbuild.\tMaking\tchanges\tacross repositories\tcan\tbe\tmore\tdifficult\tin\tthis\tworld,\tbut\tI’d\tmaintain\tthis\tis\teasier\tto\tresolve (e.g.,\tby\tusing\tcommand-line\tscripts)\tthan\tthe\tdownside\tof\tthe\tmonolithic\tsource\tcontrol and\tbuild\tprocess.",
      "content_length": 1977,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 193,
      "content": "Figure\t6-3.\tUsing\tone\tsource\tcode\trepository\tand\tCI\tbuild\tper\tmicroservice\n\nThe\ttests\tfor\ta\tgiven\tmicroservice\tshould\tlive\tin\tsource\tcontrol\twith\tthe\tmicroservice’s source\tcode\ttoo,\tto\tensure\twe\talways\tknow\twhat\ttests\tshould\tbe\trun\tagainst\ta\tgiven service.\n\nSo,\teach\tmicroservice\twill\tlive\tin\tits\town\tsource\tcode\trepository,\tand\tits\town\tCI\tbuild process.\tWe’ll\tuse\tthe\tCI\tbuild\tprocess\tto\tcreate\tour\tdeployable\tartifacts\ttoo\tin\ta\tfully automated\tfashion.\tNow\tlets\tlook\tbeyond\tCI\tto\tsee\thow\tcontinuous\tdelivery\tfits\tin.",
      "content_length": 518,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 194,
      "content": "Build\tPipelines\tand\tContinuous\tDelivery\n\nVery\tearly\ton\tin\tusing\tcontinuous\tintegration,\twe\trealized\tthe\tvalue\tin\tsometimes\thaving multiple\tstages\tinside\ta\tbuild.\tTests\tare\ta\tvery\tcommon\tcase\twhere\tthis\tcomes\tinto\tplay.\tI may\thave\ta\tlot\tof\tfast,\tsmall-scoped\ttests,\tand\ta\tsmall\tnumber\tof\tlarge-scoped,\tslow\ttests. If\twe\trun\tall\tthe\ttests\ttogether,\twe\tmay\tnot\tbe\table\tto\tget\tfast\tfeedback\twhen\tour\tfast\ttests fail\tif\twe’re\twaiting\tfor\tour\tlong-scoped\tslow\ttests\tto\tfinally\tfinish.\tAnd\tif\tthe\tfast\ttests fail,\tthere\tprobably\tisn’t\tmuch\tsense\tin\trunning\tthe\tslower\ttests\tanyway!\tA\tsolution\tto\tthis problem\tis\tto\thave\tdifferent\tstages\tin\tour\tbuild,\tcreating\twhat\tis\tknown\tas\ta\tbuild\tpipeline. One\tstage\tfor\tthe\tfaster\ttests,\tone\tfor\tthe\tslower\ttests.\n\nThis\tbuild\tpipeline\tconcept\tgives\tus\ta\tnice\tway\tof\ttracking\tthe\tprogress\tof\tour\tsoftware\tas it\tclears\teach\tstage,\thelping\tgive\tus\tinsight\tinto\tthe\tquality\tof\tour\tsoftware.\tWe\tbuild\tour artifact,\tand\tthat\tartifact\tis\tused\tthroughout\tthe\tpipeline.\tAs\tour\tartifact\tmoves\tthrough these\tstages,\twe\tfeel\tmore\tand\tmore\tconfident\tthat\tthe\tsoftware\twill\twork\tin\tproduction.\n\nContinuous\tdelivery\t(CD)\tbuilds\ton\tthis\tconcept,\tand\tthen\tsome.\tAs\toutlined\tin\tJez Humble\tand\tDave\tFarley’s\tbook\tof\tthe\tsame\tname,\tcontinuous\tdelivery\tis\tthe\tapproach whereby\twe\tget\tconstant\tfeedback\ton\tthe\tproduction\treadiness\tof\teach\tand\tevery\tcheck-in, and\tfurthermore\ttreat\teach\tand\tevery\tcheck-in\tas\ta\trelease\tcandidate.\n\nTo\tfully\tembrace\tthis\tconcept,\twe\tneed\tto\tmodel\tall\tthe\tprocesses\tinvolved\tin\tgetting\tour software\tfrom\tcheck-in\tto\tproduction,\tand\tknow\twhere\tany\tgiven\tversion\tof\tthe\tsoftware is\tin\tterms\tof\tbeing\tcleared\tfor\trelease.\tIn\tCD,\twe\tdo\tthis\tby\textending\tthe\tidea\tof\tthe multistage\tbuild\tpipeline\tto\tmodel\teach\tand\tevery\tstage\tour\tsoftware\thas\tto\tgo\tthrough, both\tmanual\tand\tautomated.\tIn\tFigure\t6-4,\twe\tsee\ta\tsample\tpipeline\tthat\tmay\tbe\tfamiliar.\n\nFigure\t6-4.\tA\tstandard\trelease\tprocess\tmodeled\tas\ta\tbuild\tpipeline\n\nHere\twe\treally\twant\ta\ttool\tthat\tembraces\tCD\tas\ta\tfirst-class\tconcept.\tI\thave\tseen\tmany people\ttry\tto\thack\tand\textend\tCI\ttools\tto\tmake\tthem\tdo\tCD,\toften\tresulting\tin\tcomplex systems\tthat\tare\tnowhere\tas\teasy\tto\tuse\tas\ttools\tthat\tbuild\tin\tCD\tfrom\tthe\tbeginning. Tools\tthat\tfully\tsupport\tCD\tallow\tyou\tto\tdefine\tand\tvisualize\tthese\tpipelines,\tmodeling the\tentire\tpath\tto\tproduction\tfor\tyour\tsoftware.\tAs\ta\tversion\tof\tour\tcode\tmoves\tthrough the\tpipeline,\tif\tit\tpasses\tone\tof\tthese\tautomated\tverification\tsteps\tit\tmoves\tto\tthe\tnext stage.\tOther\tstages\tmay\tbe\tmanual.\tFor\texample,\tif\twe\thave\ta\tmanual\tuser\tacceptance testing\t(UAT)\tprocess\tI\tshould\tbe\table\tto\tuse\ta\tCD\ttool\tto\tmodel\tit.\tI\tcan\tsee\tthe\tnext available\tbuild\tready\tto\tbe\tdeployed\tinto\tour\tUAT\tenvironment,\tdeploy\tit,\tand\tif\tit\tpasses our\tmanual\tchecks,\tmark\tthat\tstage\tas\tbeing\tsuccessful\tso\tit\tcan\tmove\tto\tthe\tnext.\n\nBy\tmodeling\tthe\tentire\tpath\tto\tproduction\tfor\tour\tsoftware,\twe\tgreatly\timprove\tvisibility of\tthe\tquality\tof\tour\tsoftware,\tand\tcan\talso\tgreatly\treduce\tthe\ttime\ttaken\tbetween\treleases,",
      "content_length": 3006,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 195,
      "content": "as\twe\thave\tone\tplace\tto\tobserve\tour\tbuild\tand\trelease\tprocess,\tand\tan\tobvious\tfocal\tpoint for\tintroducing\timprovements.\n\nIn\ta\tmicroservices\tworld,\twhere\twe\twant\tto\tensure\twe\tcan\trelease\tour\tservices independently\tof\teach\tother,\tit\tfollows\tthat\tas\twith\tCI,\twe’ll\twant\tone\tpipeline\tper\tservice. In\tour\tpipelines,\tit\tis\tan\tartifact\tthat\twe\twant\tto\tcreate\tand\tmove\tthrough\tour\tpath\tto production.\tAs\talways,\tit\tturns\tout\tour\tartifacts\tcan\tcome\tin\tlots\tof\tsizes\tand\tshapes.\tWe’ll look\tat\tsome\tof\tthe\tmost\tcommon\toptions\tavailable\tto\tus\tin\ta\tmoment.",
      "content_length": 543,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 196,
      "content": "And\tthe\tInevitable\tExceptions\n\nAs\twith\tall\tgood\trules,\tthere\tare\texceptions\twe\tneed\tto\tconsider\ttoo.\tThe\t“one microservice\tper\tbuild”\tapproach\tis\tabsolutely\tsomething\tyou\tshould\taim\tfor,\tbut\tare\tthere times\twhen\tsomething\telse\tmakes\tsense?\tWhen\ta\tteam\tis\tstarting\tout\twith\ta\tnew\tproject, especially\ta\tgreenfield\tone\twhere\tthey\tare\tworking\twith\ta\tblank\tsheet\tof\tpaper,\tit\tis\tquite likely\tthat\tthere\twill\tbe\ta\tlarge\tamount\tof\tchurn\tin\tterms\tof\tworking\tout\twhere\tthe\tservice boundaries\tlie.\tThis\tis\ta\tgood\treason,\tin\tfact,\tfor\tkeeping\tyour\tinitial\tservices\ton\tthe\tlarger side\tuntil\tyour\tunderstanding\tof\tthe\tdomain\tstabilizes.\n\nDuring\tthis\ttime\tof\tchurn,\tchanges\tacross\tservice\tboundaries\tare\tmore\tlikely,\tand\twhat\tis in\tor\tnot\tin\ta\tgiven\tservice\tis\tlikely\tto\tchange\tfrequently.\tDuring\tthis\tperiod,\thaving\tall services\tin\ta\tsingle\tbuild\tto\treduce\tthe\tcost\tof\tcross-service\tchanges\tmay\tmake\tsense.\n\nIt\tdoes\tfollow,\tthough,\tthat\tin\tthis\tcase\tyou\tneed\tto\tbuy\tinto\treleasing\tall\tthe\tservices\tas\ta bundle.\tIt\talso\tabsolutely\tneeds\tto\tbe\ta\ttransitionary\tstep.\tAs\tservice\tAPIs\tstabilize,\tstart moving\tthem\tout\tinto\ttheir\town\tbuilds.\tIf\tafter\ta\tfew\tweeks\t(or\ta\tvery\tsmall\tnumber\tof months)\tyou\tare\tunable\tto\tget\tstability\tin\tservice\tboundaries\tin\torder\tto\tproperly\tseparate them,\tmerge\tthem\tback\tinto\ta\tmore\tmonolithic\tservice\t(albeit\tretaining\tmodular separation\twithin\tthe\tboundary)\tand\tgive\tyourself\ttime\tto\tget\tto\tgrips\twith\tthe\tdomain. This\treflects\tthe\texperiences\tof\tour\town\tSnapCI\tteam,\tas\twe\tdiscussed\tin\tChapter\t3.",
      "content_length": 1513,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 197,
      "content": "Platform-Specific\tArtifacts\n\nMost\ttechnology\tstacks\thave\tsome\tsort\tof\tfirst-class\tartifact,\talong\twith\ttools\tto\tsupport creating\tand\tinstalling\tthem.\tRuby\thas\tgems,\tJava\thas\tJAR\tfiles\tand\tWAR\tfiles,\tand Python\thas\teggs.\tDevelopers\twith\texperience\tin\tone\tof\tthese\tstacks\twill\tbe\twell\tversed\tin working\twith\t(and\thopefully\tcreating)\tthese\tartifacts.\n\nFrom\tthe\tpoint\tof\tview\tof\ta\tmicroservice,\tthough,\tdepending\ton\tyour\ttechnology\tstack, this\tartifact\tmay\tnot\tbe\tenough\tby\titself.\tWhile\ta\tJava\tJAR\tfile\tcan\tbe\tmade\tto\tbe executable\tand\trun\tan\tembedded\tHTTP\tprocess,\tfor\tthings\tlike\tRuby\tand\tPython applications,\tyou’ll\texpect\tto\tuse\ta\tprocess\tmanager\trunning\tinside\tApache\tor\tNginx.\tSo we\tmay\tneed\tsome\tway\tof\tinstalling\tand\tconfiguring\tother\tsoftware\tthat\twe\tneed\tin\torder to\tdeploy\tand\tlaunch\tour\tartifacts.\tThis\tis\twhere\tautomated\tconfiguration\tmanagement tools\tlike\tPuppet\tand\tChef\tcan\thelp.\n\nAnother\tdownfall\there\tis\tthat\tthese\tartifacts\tare\tspecific\tto\ta\tcertain\ttechnology\tstack, which\tmay\tmake\tdeployment\tmore\tdifficult\twhen\twe\thave\ta\tmix\tof\ttechnologies\tin\tplay. Think\tof\tit\tfrom\tthe\tpoint\tof\tview\tof\tsomeone\ttrying\tto\tdeploy\tmultiple\tservices\ttogether. They\tcould\tbe\ta\tdeveloper\tor\ttester\twanting\tto\ttest\tsome\tfunctionality,\tor\tit\tcould\tbe someone\tmanaging\ta\tproduction\tdeployment.\tNow\timagine\tthat\tthose\tservices\tuse\tthree completely\tdifferent\tdeployment\tmechanisms.\tPerhaps\twe\thave\ta\tRuby\tGem,\ta\tJAR\tfile, and\ta\tnodeJS\tNPM\tpackage.\tWould\tthey\tthank\tyou?\n\nAutomation\tcan\tgo\ta\tlong\tway\ttoward\thiding\tthe\tdifferences\tin\tthe\tdeployment mechanisms\tof\tthe\tunderlying\tartifacts.\tChef,\tPuppet,\tand\tAnsible\tall\tsupport\tmultiple different\tcommon\ttechnology-specific\tbuild\tartifacts\ttoo.\tBut\tthere\tare\tdifferent\ttypes\tof artifacts\tthat\tmight\tbe\teven\teasier\tto\twork\twith.",
      "content_length": 1768,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 198,
      "content": "Operating\tSystem\tArtifacts\n\nOne\tway\tto\tavoid\tthe\tproblems\tassociated\twith\ttechnology-specific\tartifacts\tis\tto\tcreate artifacts\tthat\tare\tnative\tto\tthe\tunderlying\toperating\tsystem.\tFor\texample,\tfor\ta\tRedHat–\tor CentOS-based\tsystem,\tI\tmight\tbuild\tRPMs;\tfor\tUbuntu,\tI\tmight\tbuild\ta\tdeb\tpackage;\tor for\tWindows,\tan\tMSI.\n\nThe\tadvantage\tof\tusing\tOS-specific\tartifacts\tis\tthat\tfrom\ta\tdeployment\tpoint\tof\tview\twe don’t\tcare\twhat\tthe\tunderlying\ttechnology\tis.\tWe\tjust\tuse\tthe\ttools\tnative\tto\tthe\tOS\tto install\tthe\tpackage.\tThe\tOS\ttools\tcan\talso\thelp\tus\tuninstall\tand\tget\tinformation\tabout\tthe packages\ttoo,\tand\tmay\teven\tprovide\tpackage\trepositories\tthat\tour\tCI\ttools\tcan\tpush\tto. Much\tof\tthe\twork\tdone\tby\tthe\tOS\tpackage\tmanager\tcan\talso\toffset\twork\tthat\tyou\tmight otherwise\tdo\tin\ta\ttool\tlike\tPuppet\tor\tChef.\tOn\tall\tLinux\tplatforms\tI\thave\tused,\tfor example,\tyou\tcan\tdefine\tdependencies\tfrom\tyour\tpackages\tto\tother\tpackages\tyou\trely\ton, and\tthe\tOS\ttools\twill\tautomatically\tinstall\tthem\tfor\tyou\ttoo.\n\nThe\tdownside\tcan\tbe\tthe\tdifficulty\tin\tcreating\tthe\tpackages\tin\tthe\tfirst\tplace.\tFor\tLinux, the\tFPM\tpackage\tmanager\ttool\tgives\ta\tnicer\tabstraction\tfor\tcreating\tLinux\tOS\tpackages, and\tconverting\tfrom\ta\ttarball-based\tdeployment\tto\tan\tOS-based\tdeployment\tcan\tbe\tfairly straightforward.\tThe\tWindows\tspace\tis\tsomewhat\ttrickier.\tThe\tnative\tpackaging\tsystem\tin the\tform\tof\tMSI\tinstallers\tand\tthe\tlike\tleave\ta\tlot\tto\tbe\tdesired\twhen\tcompared\tto\tthe capabilities\tin\tthe\tLinux\tspace.\tThe\tNuGet\tpackage\tsystem\thas\tstarted\tto\thelp\taddress this,\tat\tleast\tin\tterms\tof\thelping\tmanage\tdevelopment\tlibraries.\tMore\trecently,\tChocolatey NuGet\thas\textended\tthese\tideas,\tproviding\ta\tpackage\tmanager\tfor\tWindows\tdesigned\tfor deploying\ttools\tand\tservices,\twhich\tis\tmuch\tmore\tlike\tthe\tpackage\tmanagers\tin\tthe\tLinux space.\tThis\tis\tcertainly\ta\tstep\tin\tthe\tright\tdirection,\talthough\tthe\tfact\tthat\tthe\tidiomatic style\tin\tWindows\tis\tstill\tdeploy\tsomething\tin\tIIS\tmeans\tthat\tthis\tapproach\tmay\tbe unappealing\tfor\tsome\tWindows\tteams.\n\nAnother\tdownside,\tof\tcourse,\tcould\tbe\tif\tyou\tare\tdeploying\tonto\tmultiple\tdifferent operating\tsystems.\tThe\toverhead\tof\tmanaging\tartifacts\tfor\tdifferent\tOSes\tcould\tbe\tpretty steep.\tIf\tyou’re\tcreating\tsoftware\tfor\tother\tpeople\tto\tinstall,\tyou\tmay\tnot\thave\ta\tchoice.\tIf you\tare\tinstalling\tsoftware\tonto\tmachines\tyou\tcontrol,\thowever,\tI\twould\tsuggest\tyou\tlook at\tunifying\tor\tat\tleast\treducing\tthe\tnumber\tof\tdifferent\toperating\tsystems\tyou\tuse.\tIt\tcan greatly\treduce\tvariations\tin\tbehavior\tfrom\tone\tmachine\tto\tthe\tnext,\tand\tsimplify deployment\tand\tmaintenance\ttasks.\n\nIn\tgeneral,\tthose\tteams\tI’ve\tseen\tthat\thave\tmoved\tto\tOS-based\tpackage\tmanagement\thave simplified\ttheir\tdeployment\tapproach,\tand\ttend\tto\tavoid\tthe\ttrap\tof\tbig,\tcomplex deployment\tscripts.\tEspecially\tif\tyou’re\ton\tLinux,\tthis\tcan\tbe\ta\tgood\tway\tto\tsimplify deployment\tof\tmicroservices\tusing\tdisparate\ttechnology\tstacks.",
      "content_length": 2867,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 199,
      "content": "Custom\tImages\n\nOne\tof\tthe\tchallenges\twith\tautomated\tconfiguration\tmanagement\tsystems\tlike\tPuppet, Chef,\tand\tAnsible\tcan\tbe\tthe\ttime\ttaken\tto\trun\tthe\tscripts\ton\ta\tmachine.\tLet’s\ttake\ta simple\texample\tof\ta\tserver\tbeing\tprovisioned\tand\tconfigured\tto\tallow\tfor\tthe\tdeployment of\ta\tJava\tapplication.\tLet’s\tassume\tI’m\tusing\tAWS\tto\tprovision\tthe\tserver,\tusing\tthe standard\tUbuntu\timage.\tThe\tfirst\tthing\tI\tneed\tto\tdo\tis\tinstall\tthe\tOracle\tJVM\tto\trun\tmy Java\tapplication.\tI’ve\tseen\tthis\tsimple\tprocess\ttake\taround\tfive\tminutes,\twith\ta\tcouple\tof minutes\ttaken\tup\tby\tthe\tmachine\tbeing\tprovisioned,\tand\ta\tfew\tmore\tto\tinstall\tthe\tJVM. Then\twe\tcan\tthink\tabout\tactually\tputting\tour\tsoftware\ton\tit.\n\nThis\tis\tactually\ta\tfairly\ttrivial\texample.\tWe\twill\toften\twant\tto\tinstall\tother\tcommon\tbits\tof software.\tFor\texample,\twe\tmight\twant\tto\tuse\tcollectd\tfor\tgathering\tOS\tstats,\tuse\tlogstash for\tlog\taggregation,\tand\tperhaps\tinstall\tthe\tappropriate\tbits\tof\tnagios\tfor\tmonitoring\t(we’ll talk\tmore\tabout\tthis\tsoftware\tin\tChapter\t8).\tOver\ttime,\tmore\tthings\tmight\tget\tadded, leading\tto\tlonger\tand\tlonger\tamounts\tof\ttime\tneeded\tfor\tprovisioning\tof\tthese dependencies.\n\nPuppet,\tChef,\tAnsible,\tand\ttheir\tilk\tcan\tbe\tsmart\tand\twill\tavoid\tinstalling\tsoftware\tthat\tis already\tpresent.\tThis\tdoes\tnot\tmean\tthat\trunning\tthe\tscripts\ton\texisting\tmachines\twill always\tbe\tfast,\tunfortunately,\tas\trunning\tall\tthe\tchecks\ttakes\ttime.\tWe\talso\twant\tto\tavoid keeping\tour\tmachines\taround\tfor\ttoo\tlong,\tas\twe\tdon’t\twant\tto\tallow\tfor\ttoo\tmuch configuration\tdrift\t(which\twe’ll\texplore\tin\tmore\tdepth\tshortly).\tAnd\tif\twe’re\tusing\tan\ton- demand\tcompute\tplatform\twe\tmight\tbe\tconstantly\tshutting\tdown\tand\tspinning\tup\tnew instances\ton\ta\tdaily\tbasis\t(if\tnot\tmore\tfrequently),\tso\tthe\tdeclarative\tnature\tof\tthese configuration\tmanagement\ttools\tmay\tbe\tof\tlimited\tuse.\n\nOver\ttime,\twatching\tthe\tsame\ttools\tget\tinstalled\tover\tand\tover\tagain\tcan\tbecome\ta\treal drag.\tIf\tyou\tare\ttrying\tto\tdo\tthis\tmultiple\ttimes\tper\tday\t—\tperhaps\tas\tpart\tof\tdevelopment or\tCI\t—\tthis\tbecomes\ta\treal\tproblem\tin\tterms\tof\tproviding\tfast\tfeedback.\tIt\tcan\talso\tlead to\tincreased\tdowntime\twhen\tdeploying\tin\tproduction\tif\tyour\tsystems\tdon’t\tallow\tfor\tzero- downtime\tdeployment,\tas\tyou’re\twaiting\tto\tinstall\tall\tthe\tpre-requisites\ton\tyour\tmachines even\tbefore\tyou\tget\tto\tinstalling\tyour\tsoftware.\tModels\tlike\tblue/green\tdeployment (which\twe’ll\tdiscuss\tin\tChapter\t7)\tcan\thelp\tmitigate\tthis,\tas\tthey\tallow\tus\tto\tdeploy\ta\tnew version\tof\tour\tservice\twithout\ttaking\tthe\told\tone\toffline.\n\nOne\tapproach\tto\treducing\tthis\tspin-up\ttime\tis\tto\tcreate\ta\tvirtual\tmachine\timage\tthat\tbakes in\tsome\tof\tthe\tcommon\tdependencies\twe\tuse,\tas\tshown\tin\tFigure\t6-5.\tAll\tvirtualization platforms\tI’ve\tused\tallow\tyou\tto\tbuild\tyour\town\timages,\tand\tthe\ttools\tto\tdo\tso\tare\tmuch more\tadvanced\tthan\tthey\twere\teven\ta\tfew\tyears\tago.\tThis\tshifts\tthings\tsomewhat.\tNow we\tcould\tbake\tthe\tcommon\ttools\tinto\tour\town\timage.\tWhen\twe\twant\tto\tdeploy\tour software,\twe\tspin\tup\tan\tinstance\tof\tthis\tcustom\timage,\tand\tall\twe\thave\tto\tdo\tis\tinstall\tthe latest\tversion\tof\tour\tservice.",
      "content_length": 3038,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 200,
      "content": "Figure\t6-5.\tCreating\ta\tcustom\tVM\timage\n\nOf\tcourse,\tbecause\tyou\tbuild\tthe\timage\tonly\tonce,\twhen\tyou\tsubsequently\tlaunch\tcopies of\tthis\timage\tyou\tdon’t\tneed\tto\tspend\ttime\tinstalling\tyour\tdependencies,\tas\tthey\tare already\tthere.\tThis\tcan\tresult\tin\ta\tsignificant\ttime\tsavings.\tIf\tyour\tcore\tdependencies\tdon’t change,\tnew\tversions\tof\tyour\tservice\tcan\tcontinue\tto\tuse\tthe\tsame\tbase\timage.\n\nThere\tare\tsome\tdrawbacks\twith\tthis\tapproach,\tthough.\tBuilding\timages\tcan\ttake\ta\tlong time.\tThis\tmeans\tthat\tfor\tdevelopers\tyou\tmay\twant\tto\tsupport\tother\tways\tof\tdeploying services\tto\tensure\tthey\tdon’t\thave\tto\twait\thalf\tan\thour\tjust\tto\tcreate\ta\tbinary\tdeployment. Second,\tsome\tof\tthe\tresulting\timages\tcan\tbe\tlarge.\tThis\tcould\tbe\ta\treal\tproblem\tif\tyou’re creating\tyour\town\tVMWare\timages,\tfor\texample,\tas\tmoving\ta\t20GB\timage\taround\ta network\tisn’t\talways\ta\tsimple\tactivity.\tWe’ll\tbe\tlooking\tat\tcontainer\ttechnology\tshortly, and\tspecifically\tDocker,\twhich\tcan\tavoid\tsome\tof\tthese\tdrawbacks.\n\nHistorically,\tone\tof\tthe\tchallenges\tis\tthat\tthe\ttool\tchain\trequired\tto\tbuild\tsuch\tan\timage varied\tfrom\tplatform\tto\tplatform.\tBuilding\ta\tVMWare\timage\tis\tdifferent\tfrom\tbuilding\tan AWS\tAMI,\ta\tVagrant\timage,\tor\ta\tRackspace\timage.\tThis\tmay\tnot\thave\tbeen\ta\tproblem\tif you\thad\tthe\tsame\tplatform\teverywhere,\tbut\tnot\tall\torganizations\twere\tthis\tlucky.\tAnd even\tif\tthey\twere,\tthe\ttools\tin\tthis\tspace\twere\toften\tdifficult\tto\twork\twith,\tand\tthey\tdidn’t play\tnicely\twith\tother\ttools\tyou\tmight\tbe\tusing\tfor\tmachine\tconfiguration.",
      "content_length": 1487,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 201,
      "content": "Packer\tis\ta\ttool\tdesigned\tto\tmake\tcreation\tof\timages\tmuch\teasier.\tUsing\tconfiguration scripts\tof\tyour\tchoice\t(Chef,\tAnsible,\tPuppet,\tand\tmore\tare\tsupported),\tit\tallows\tus\tto create\timages\tfor\tdifferent\tplatforms\tfrom\tthe\tsame\tconfiguration.\tAt\tthe\ttime\tof\twriting, it\thas\tsupport\tfor\tVMWare,\tAWS,\tRackspace\tCloud,\tDigital\tOcean,\tand\tVagrant,\tand\tI’ve seen\tteams\tuse\tit\tsuccessfully\tfor\tbuilding\tLinux\tand\tWindows\timages.\tThis\tmeans\tyou could\tcreate\tan\timage\tfor\tdeployment\ton\tyour\tproduction\tAWS\tenvironment\tand\ta matching\tVagrant\timage\tfor\tlocal\tdevelopment\tand\ttest,\tall\tfrom\tthe\tsame\tconfiguration.",
      "content_length": 601,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 202,
      "content": "Images\tas\tArtifacts\n\nSo\twe\tcan\tcreate\tvirtual\tmachine\timages\tthat\tbake\tin\tdependencies\tto\tspeed\tup\tfeedback, but\twhy\tstop\tthere?\tWe\tcould\tgo\tfurther,\tbake\tour\tservice\tinto\tthe\timage\titself,\tand\tadopt the\tmodel\tof\tour\tservice\tartifact\tbeing\tan\timage.\tNow,\twhen\twe\tlaunch\tour\timage,\tour service\tis\tthere\tready\tto\tgo.\tThis\treally\tfast\tspin-up\ttime\tis\tthe\treason\tthat\tNetflix\thas adopted\tthe\tmodel\tof\tbaking\tits\town\tservices\tas\tAWS\tAMIs.\n\nJust\tas\twith\tOS-specific\tpackages,\tthese\tVM\timages\tbecome\ta\tnice\tway\tof\tabstracting\tout the\tdifferences\tin\tthe\ttechnology\tstacks\tused\tto\tcreate\tthe\tservices.\tDo\twe\tcare\tif\tthe service\trunning\ton\tthe\timage\tis\twritten\tin\tRuby\tor\tJava,\tand\tuses\ta\tgem\tor\tJAR\tfile?\tAll we\tcare\tabout\tis\tthat\tit\tworks.\tWe\tcan\tfocus\tour\tefforts,\tthen,\ton\tautomating\tthe\tcreation and\tdeployment\tof\tthese\timages.\tThis\talso\tbecomes\ta\treally\tneat\tway\tto\timplement another\tdeployment\tconcept,\tthe\timmutable\tserver.",
      "content_length": 921,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 203,
      "content": "Immutable\tServers\n\nBy\tstoring\tall\tour\tconfiguration\tin\tsource\tcontrol,\twe\tare\ttrying\tto\tensure\tthat\twe\tcan automatically\treproduce\tservices\tand\thopefully\tentire\tenvironments\tat\twill.\tBut\tonce\twe run\tour\tdeployment\tprocess,\twhat\thappens\tif\tsomeone\tcomes\talong,\tlogs\tinto\tthe\tbox,\tand changes\tthings\tindependently\tof\twhat\tis\tin\tsource\tcontrol?\tThis\tproblem\tis\toften\tcalled configuration\tdrift\t—\tthe\tcode\tin\tsource\tcontrol\tno\tlonger\treflects\tthe\tconfiguration\tof\tthe running\thost.\n\nTo\tavoid\tthis,\twe\tcan\tensure\tthat\tno\tchanges\tare\tever\tmade\tto\ta\trunning\tserver.\tInstead, any\tchange,\tno\tmatter\thow\tsmall,\thas\tto\tgo\tthrough\ta\tbuild\tpipeline\tin\torder\tto\tcreate\ta new\tmachine.\tYou\tcan\timplement\tthis\tpattern\twithout\tusing\timage-based\tdeployments, but\tit\tis\talso\ta\tlogical\textension\tof\tusing\timages\tas\tartifacts.\tDuring\tour\timage\tcreation, for\texample,\twe\tcould\tactually\tdisable\tSSH,\tensuring\tthat\tno\tone\tcould\teven\tlog\tonto\tthe box\tto\tmake\ta\tchange!\n\nThe\tsame\tcaveats\twe\tdiscussed\tearlier\tabout\tcycle\ttime\tstill\tapply,\tof\tcourse.\tAnd\twe\talso need\tto\tensure\tthat\tany\tdata\twe\tcare\tabout\tthat\tis\tstored\ton\tthe\tbox\tis\tstored\telsewhere. These\tcomplexities\taside,\tI’ve\tseen\tadopting\tthis\tpattern\tlead\tto\tmuch\tmore straightforward\tdeployments,\tand\teasier-to-reason-about\tenvironments.\tAnd\tas\tI’ve already\tsaid,\tanything\twe\tcan\tdo\tto\tsimplify\tthings\tshould\tbe\tpursued!",
      "content_length": 1353,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 204,
      "content": "Environments\n\nAs\tour\tsoftware\tmoves\tthrough\tour\tCD\tpipeline\tstages,\tit\twill\talso\tbe\tdeployed\tinto different\ttypes\tof\tenvironments.\tIf\twe\tthink\tof\tthe\texample\tbuild\tpipeline\tin\tFigure\t6-4, we\tprobably\thave\tto\tconsider\tat\tleast\tfour\tdistinct\tenvironments:\tone\tenvironment\twhere we\trun\tour\tslow\ttests,\tanother\tfor\tUAT,\tanother\tfor\tperformance,\tand\ta\tfinal\tone\tfor production.\tOur\tmicroservice\tshould\tbe\tthe\tsame\tthroughout,\tbut\tthe\tenvironment\twill\tbe different.\tAt\tthe\tvery\tleast,\tthey’ll\tbe\tseparate,\tdistinct\tcollections\tof\tconfiguration\tand hosts.\tBut\toften\tthey\tcan\tvary\tmuch\tmore\tthan\tthat.\tFor\texample,\tour\tproduction environment\tfor\tour\tservice\tmight\tconsist\tof\tmultiple\tload-balanced\thosts\tspread\tacross two\tdata\tcenters,\twhereas\tour\ttest\tenvironment\tmight\tjust\thave\teverything\trunning\ton\ta single\thost.\tThese\tdifferences\tin\tenvironments\tcan\tintroduce\ta\tfew\tproblems.\n\nI\twas\tbitten\tby\tthis\tpersonally\tmany\tyears\tago.\tWe\twere\tdeploying\ta\tJava\tweb\tservice\tinto a\tclustered\tWebLogic\tapplication\tcontainer\tin\tproduction.\tThis\tWebLogic\tcluster replicated\tsession\tstate\tbetween\tmultiple\tnodes,\tgiving\tus\tsome\tlevel\tof\tresilience\tif\ta single\tnode\tfailed.\tHowever,\tthe\tWebLogic\tlicenses\twere\texpensive,\tas\twere\tthe\tmachines our\tsoftware\twas\tdeployed\tonto.\tThis\tmeant\tthat\tin\tour\ttest\tenvironment,\tour\tsoftware was\tdeployed\ton\ta\tsingle\tmachine,\tin\ta\tnonclustered\tconfiguration.\n\nThis\thurt\tus\tbadly\tduring\tone\trelease.\tFor\tWebLogic\tto\tbe\table\tto\tcopy\tsession\tstate between\tnodes,\tthe\tsession\tdata\tneeds\tto\tbe\tproperly\tserializable.\tUnfortunately,\tone\tof our\tcommits\tbroke\tthis,\tso\twhen\twe\tdeployed\tinto\tproduction\tour\tsession\treplication failed.\tWe\tended\tup\tresolving\tthis\tby\tpushing\thard\tto\treplicate\ta\tclustered\tsetup\tin\tour\ttest environment.\n\nThe\tservice\twe\twant\tto\tdeploy\tis\tthe\tsame\tin\tall\tthese\tdifferent\tenvironments,\tbut\teach\tof the\tenvironments\tserves\ta\tdifferent\tpurpose.\tOn\tmy\tdeveloper\tlaptop\tI\twant\tto\tquickly deploy\tthe\tservice,\tpotentially\tagainst\tstubbed\tcollaborators,\tto\trun\ttests\tor\tcarry\tout\tsome manual\tvalidation\tof\tbehavior,\twhereas\twhen\tI\tdeploy\tinto\ta\tproduction\tenvironment\tI may\twant\tto\tdeploy\tmultiple\tcopies\tof\tmy\tservice\tin\ta\tload-balanced\tfashion,\tperhaps\tsplit across\tone\tor\tmore\tdata\tcenters\tfor\tdurability\treasons.\n\nAs\tyou\tmove\tfrom\tyour\tlaptop\tto\tbuild\tserver\tto\tUAT\tenvironment\tall\tthe\tway\tto production,\tyou’ll\twant\tto\tensure\tthat\tyour\tenvironments\tare\tmore\tand\tmore\tproduction- like\tto\tcatch\tany\tproblems\tassociated\twith\tthese\tenvironmental\tdifferences\tsooner.\tThis will\tbe\ta\tconstant\tbalance.\tSometimes\tthe\ttime\tand\tcost\tto\treproduce\tproduction-like environments\tcan\tbe\tprohibitive,\tso\tyou\thave\tto\tmake\tcompromises.\tAdditionally, sometimes\tusing\ta\tproduction-like\tenvironment\tcan\tslow\tdown\tfeedback\tloops;\twaiting for\t25\tmachines\tto\tinstall\tyour\tsoftware\tin\tAWS\tmight\tbe\tmuch\tslower\tthan\tsimply deploying\tyour\tservice\tinto\ta\tlocal\tVagrant\tinstance,\tfor\texample.\n\nThis\tbalance,\tbetween\tproduction-like\tenvironments\tand\tfast\tfeedback,\twon’t\tbe\tstatic. Keep\tan\teye\ton\tthe\tbugs\tyou\tfind\tfurther\tdownstream\tand\tyour\tfeedback\ttimes,\tand\tadjust",
      "content_length": 3072,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 205,
      "content": "this\tbalance\tas\trequired.\n\nManaging\tenvironments\tfor\tsingle-artfact\tmonolithic\tsystems\tcan\tbe\tchallenging, especially\tif\tyou\tdon’t\thave\taccess\tto\tsystems\tthat\tare\teasily\tautomatable.\tWhen\tyou\tthink about\tmultiple\tenvironments\tper\tmicroservice,\tthis\tcan\tbe\teven\tmore\tdaunting.\tWe’ll\tlook shortly\tat\tsome\tdifferent\tdeployment\tplatforms\tthat\tcan\tmake\tthis\tmuch\teasier\tfor\tus.",
      "content_length": 372,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 206,
      "content": "Service\tConfiguration\n\nOur\tservices\tneed\tsome\tconfiguration.\tIdeally,\tthis\tshould\tbe\ta\tsmall\tamount,\tand\tlimited to\tthose\tfeatures\tthat\tchange\tfrom\tone\tenvironment\tto\tanother,\tsuch\tas\twhat\tusername\tand password\tshould\tI\tuse\tto\tconnect\tto\tmy\tdatabase?\tConfiguration\tthat\tchanges\tfrom\tone environment\tto\tanother\tshould\tbe\tkept\tto\tan\tabsolute\tminimum.\tThe\tmore\tyour configuration\tchanges\tfundamental\tservice\tbehavior,\tand\tthe\tmore\tthat\tconfiguration varies\tfrom\tone\tenvironment\tto\tanother,\tthe\tmore\tyou\twill\tfind\tproblems\tonly\tin\tcertain environments,\twhich\tis\tpainful\tin\tthe\textreme.\n\nSo\tif\twe\thave\tsome\tconfiguration\tfor\tour\tservice\tthat\tdoes\tchange\tfrom\tone\tenvironment to\tanother,\thow\tshould\twe\thandle\tthis\tas\tpart\tof\tour\tdeployment\tprocess?\tOne\toption\tis\tto build\tone\tartifact\tper\tenvironment,\twith\tconfiguration\tinside\tthe\tartifact\titself.\tInitially this\tseems\tsensible.\tThe\tconfiguration\tis\tbuilt\tright\tin;\tjust\tdeploy\tit\tand\teverything\tshould work\tfine,\tright?\tThis\tis\tproblematic.\tRemember\tthe\tconcept\tof\tcontinuous\tdelivery.\tWe want\tto\tcreate\tan\tartifact\tthat\trepresents\tour\trelease\tcandidate,\tand\tmove\tit\tthrough\tour pipeline,\tconfirming\tthat\tit\tis\tgood\tenough\tto\tgo\tinto\tproduction.\tLet’s\timagine\tI\tbuild\ta Customer-Service-Test\tand\tCustomer-Service-Prod\tartifacts.\tIf\tmy\tCustomer-Service-Test artifact\tpasses\tthe\ttests,\tbut\tit’s\tthe\tCustomer-Service-Prod\tartifact\tthat\tI\tactually\tdeploy, can\tI\tbe\tsure\tthat\tI\thave\tverified\tthe\tsoftware\tthat\tactually\tends\tup\tin\tproduction?\n\nThere\tare\tother\tchallenges\tas\twell.\tFirst,\tthere\tis\tthe\tadditional\ttime\ttaken\tto\tbuild\tthese artifacts.\tNext,\tthe\tfact\tthat\tyou\tneed\tto\tknow\tat\tbuild\ttime\twhat\tenvironments\texist.\tAnd how\tdo\tyou\thandle\tsensitive\tconfiguration\tdata?\tI\tdon’t\twant\tinformation\tabout production\tpasswords\tchecked\tin\twith\tmy\tsource\tcode,\tbut\tif\tit\tis\tneeded\tat\tbuild\ttime\tto create\tall\tthose\tartifacts,\tthis\tis\toften\tdifficult\tto\tavoid.\n\nA\tbetter\tapproach\tis\tto\tcreate\tone\tsingle\tartifact,\tand\tmanage\tconfiguration\tseparately. This\tcould\tbe\ta\tproperties\tfile\tthat\texists\tfor\teach\tenvironment,\tor\tdifferent\tparameters passed\tin\tto\tan\tinstall\tprocess.\tAnother\tpopular\toption,\tespecially\twhen\tdealing\twith\ta larger\tnumber\tof\tmicroservices,\tis\tto\tuse\ta\tdedicated\tsystem\tfor\tproviding\tconfiguration, which\twe’ll\texplore\tmore\tin\tChapter\t11.",
      "content_length": 2296,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 207,
      "content": "Service-to-Host\tMapping\n\nOne\tof\tthe\tquestions\tthat\tcomes\tup\tquite\tearly\ton\tin\tthe\tdiscussion\taround\tmicroservices is\t“How\tmany\tservices\tper\tmachine?”\tBefore\twe\tgo\ton,\twe\tshould\tpick\ta\tbetter\tterm\tthan machine,\tor\teven\tthe\tmore\tgeneric\tbox\tthat\tI\tused\tearlier.\tIn\tthis\tera\tof\tvirtualization,\tthe mapping\tbetween\ta\tsingle\thost\trunning\tan\toperating\tsystem\tand\tthe\tunderlying\tphysical infrastructure\tcan\tvary\tto\ta\tgreat\textent.\tThus,\tI\ttend\tto\ttalk\tabout\thosts,\tusing\tthem\tas\ta generic\tunit\tof\tisolation\t—\tnamely,\tan\toperating\tsystem\tonto\twhich\tI\tcan\tinstall\tand\trun my\tservices.\tIf\tyou\tare\tdeploying\tdirectly\ton\tto\tphysical\tmachines,\tthen\tone\tphysical server\tmaps\tto\tone\thost\t(which\tis\tperhaps\tnot\tcompletely\tcorrect\tterminology\tin\tthis context,\tbut\tin\tthe\tabsence\tof\tbetter\tterms\tmay\thave\tto\tsuffice).\tIf\tyou’re\tusing virtualization,\ta\tsingle\tphysical\tmachine\tcan\tmap\tto\tmultiple\tindependent\thosts,\teach\tof which\tcould\thold\tone\tor\tmore\tservices.\n\nSo\twhen\tthinking\tof\tdifferent\tdeployment\tmodels,\twe’ll\ttalk\tabout\thosts.\tSo,\tthen,\thow many\tservices\tper\thost\tshould\twe\thave?\n\nI\thave\ta\tdefinite\tview\tas\tto\twhich\tmodel\tis\tpreferable,\tbut\tthere\tare\ta\tnumber\tof\tfactors\tto consider\twhen\tworking\tout\twhich\tmodel\twill\tbe\tright\tfor\tyou.\tIt’s\talso\timportant\tto understand\tthat\tsome\tchoices\twe\tmake\tin\tthis\tregard\twill\tlimit\tsome\tof\tthe\tdeployment options\tavailable\tto\tus.",
      "content_length": 1359,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 208,
      "content": "Multiple\tServices\tPer\tHost\n\nHaving\tmultiple\tservices\tper\thost,\tas\tshown\tin\tFigure\t6-6,\tis\tattractive\tfor\ta\tnumber\tof reasons.\tFirst,\tpurely\tfrom\ta\thost\tmanagement\tpoint\tof\tview,\tit\tis\tsimpler.\tIn\ta\tworld where\tone\tteam\tmanages\tthe\tinfrastructure\tand\tanother\tteam\tmanages\tthe\tsoftware,\tthe infrastructure\tteam’s\tworkload\tis\toften\ta\tfunction\tof\tthe\tnumber\tof\thosts\tit\thas\tto\tmanage. If\tmore\tservices\tare\tpacked\ton\tto\ta\tsingle\thost,\tthe\thost\tmanagement\tworkload\tdoesn’t increase\tas\tthe\tnumber\tof\tservices\tincreases.\tSecond\tis\tcost.\tEven\tif\tyou\thave\taccess\tto\ta virtualization\tplatform\tthat\tallows\tyou\tto\tprovision\tand\tresize\tvirtual\thosts,\tthe virtualization\tcan\tadd\tan\toverhead\tthat\treduces\tthe\tunderlying\tresources\tavailable\tto\tyour services.\tIn\tmy\topinion,\tboth\tthese\tproblems\tcan\tbe\taddressed\twith\tnew\tworking\tpractices and\ttechnology,\tand\twe’ll\texplore\tthat\tshortly.\n\nThis\tmodel\tis\talso\tfamiliar\tto\tthose\twho\tdeploy\tinto\tsome\tform\tof\tan\tapplication container.\tIn\tsome\tways,\tthe\tuse\tof\tan\tapplication\tcontainer\tis\ta\tspecial\tcase\tof\tthe multiple-services-per-host\tmodel,\tso\twe’ll\tlook\tinto\tthat\tseparately.\tThis\tmodel\tcan\talso simplify\tthe\tlife\tof\tthe\tdeveloper.\tDeploying\tmultiple\tservices\tto\ta\tsingle\thost\tin production\tis\tsynonymous\twith\tdeploying\tmultiple\tservices\tto\ta\tlocal\tdev\tworkstation\tor laptop.\tIf\twe\twant\tto\tlook\tat\tan\talternative\tmodel,\twe\twant\tto\tfind\ta\tway\tto\tkeep\tthis conceptually\tsimple\tfor\tdevelopers.\n\nFigure\t6-6.\tMultiple\tmicroservices\tper\thost\n\nThere\tare\tsome\tchallenges\twith\tthis\tmodel,\tthough.\tFirst,\tit\tcan\tmake\tmonitoring\tmore difficult.\tFor\texample,\twhen\ttracking\tCPU,\tdo\tI\tneed\tto\ttrack\tthe\tCPU\tof\tone\tservice independent\tof\tthe\tothers?\tOr\tdo\tI\tcare\tabout\tthe\tCPU\tof\tthe\tbox\tas\ta\twhole?\tSide\teffects",
      "content_length": 1728,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 209,
      "content": "can\talso\tbe\thard\tto\tavoid.\tIf\tone\tservice\tis\tunder\tsignificant\tload,\tit\tcan\tend\tup\treducing the\tresources\tavailable\tto\tother\tparts\tof\tthe\tsystem.\tGilt,\twhen\tscaling\tout\tthe\tnumber\tof services\tit\tran,\thit\tthis\tproblem.\tInitially\tit\tcoexisted\tmany\tservices\ton\ta\tsingle\tbox,\tbut uneven\tload\ton\tone\tof\tthe\tservices\twould\thave\tan\tadverse\timpact\ton\teverything\telse running\ton\tthat\thost.\tThis\tmakes\timpact\tanalysis\tof\thost\tfailures\tmore\tcomplex\tas\twell\t— taking\ta\tsingle\thost\tout\tof\tcommission\tcan\thave\ta\tlarge\tripple\teffect.\n\nDeployment\tof\tservices\tcan\tbe\tsomewhat\tmore\tcomplex\ttoo,\tas\tensuring\tone\tdeployment doesn’t\taffect\tanother\tleads\tto\tadditional\theadaches.\tFor\texample,\tif\tI\tuse\tPuppet\tto prepare\ta\thost,\tbut\teach\tservice\thas\tdifferent\t(and\tpotentially\tcontradictory)\tdependencies, how\tcan\tI\tmake\tthat\twork?\tIn\tthe\tworst-case\tscenario,\tI\thave\tseen\tpeople\ttie\tmultiple service\tdeployments\ttogether,\tdeploying\tmultiple\tdifferent\tservices\tto\ta\tsingle\thost\tin\tone step,\tto\ttry\tto\tsimplify\tthe\tdeployment\tof\tmultiple\tservices\tto\tone\thost.\tIn\tmy\topinion,\tthe small\tupside\tin\timproving\tsimplicity\tis\tmore\tthan\toutweighed\tby\tthe\tfact\tthat\twe\thave given\tup\tone\tof\tthe\tkey\tbenefits\tof\tmicroservices:\tstriving\tfor\tindependent\trelease\tof\tour software.\tIf\tyou\tdo\tadopt\tthe\tmultiple-services-per-host\tmodel,\tmake\tsure\tyou\tkeep\thold of\tthe\tidea\tthat\teach\tservice\tshould\tbe\tdeployed\tindependently.\n\nThis\tmodel\tcan\talso\tinhibit\tautonomy\tof\tteams.\tIf\tservices\tfor\tdifferent\tteams\tare\tinstalled on\tthe\tsame\thost,\twho\tgets\tto\tconfigure\tthe\thost\tfor\ttheir\tservices?\tIn\tall\tlikelihood,\tthis ends\tup\tgetting\thandled\tby\ta\tcentralized\tteam,\tmeaning\tit\ttakes\tmore\tcoordination\tto\tget services\tdeployed.\n\nAnother\tissue\tis\tthat\tthis\toption\tcan\tlimit\tour\tdeployment\tartifact\toptions.\tImage-based deployments\tare\tout,\tas\tare\timmutable\tservers\tunless\tyou\ttie\tmultiple\tdifferent\tservices together\tin\ta\tsingle\tartifact,\twhich\twe\treally\twant\tto\tavoid.\n\nThe\tfact\tthat\twe\thave\tmultiple\tservices\ton\ta\tsingle\thost\tmeans\tthat\tefforts\tto\ttarget\tscaling to\tthe\tservice\tmost\tin\tneed\tof\tit\tcan\tbe\tcomplicated.\tLikewise,\tif\tone\tmicroservice\thandles data\tand\toperations\tthat\tare\tespecially\tsensitive,\twe\tmight\twant\tto\tset\tup\tthe\tunderlying host\tdifferently,\tor\tperhaps\teven\tplace\tthe\thost\titself\tin\ta\tseparate\tnetwork\tsegment. Having\teverything\ton\tone\thost\tmeans\twe\tmight\tend\tup\thaving\tto\ttreat\tall\tservices\tthe same\tway\teven\tif\ttheir\tneeds\tare\tdifferent.\n\nAs\tmy\tcolleague\tNeal\tFord\tputs\tit,\tmany\tof\tour\tworking\tpractices\taround\tdeployment\tand host\tmanagement\tare\tan\tattempt\tto\toptimize\tfor\tscarcity\tof\tresources.\tIn\tthe\tpast,\tthe\tonly option\tif\twe\twanted\tanother\thost\twas\tto\tbuy\tor\trent\tanother\tphysical\tmachine.\tThis\toften had\ta\tlarge\tlead\ttime\tto\tit\tand\tresulted\tin\ta\tlong-term\tfinancial\tcommitment.\tIt\twasn’t uncommon\tfor\tclients\tI\thave\tworked\twith\tto\tprovision\tnew\tservers\tonly\tevery\ttwo\tto\tthree years,\tand\ttrying\tto\tget\tadditional\tmachines\toutside\tof\tthese\ttimelines\twas\tdifficult.\tBut on-demand\tcomputing\tplatforms\thave\tdrastically\treduced\tthe\tcosts\tof\tcomputing resources,\tand\timprovements\tin\tvirtualization\ttechnology\tmean\teven\tfor\tin-house\thosted infrastructure\tthere\tis\tmore\tflexibility.",
      "content_length": 3155,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 210,
      "content": "Application\tContainers\n\nIf\tyou’re\tfamiliar\twith\tdeploying\t.NET\tapplications\tbehind\tIIS\tor\tJava\tapplications\tinto\ta servlet\tcontainer,\tyou\twill\tbe\twell\tacquainted\twith\tthe\tmodel\twhere\tmultiple\tdistinct services\tor\tapplications\tsit\tinside\ta\tsingle\tapplication\tcontainer,\twhich\tin\tturn\tsits\ton\ta single\thost,\tas\twe\tsee\tin\tFigure\t6-7.\tThe\tidea\tis\tthat\tthe\tapplication\tcontainer\tyour services\tlive\tin\tgives\tyou\tbenefits\tin\tterms\tof\timproved\tmanageability,\tsuch\tas\tclustering support\tto\thandle\tgrouping\tmultiple\tinstances\ttogether,\tmonitoring\ttools,\tand\tthe\tlike.\n\nFigure\t6-7.\tMultiple\tmicroservices\tper\thost\n\nThis\tsetup\tcan\talso\tyield\tbenefits\tin\tterms\tof\treducing\toverhead\tof\tlanguage\truntimes. Consider\trunning\tfive\tJava\tservices\tin\ta\tsingle\tJava\tservlet\tcontainer.\tI\tonly\thave\tthe overhead\tof\tone\tsingle\tJVM.\tCompare\tthis\twith\trunning\tfive\tindependent\tJVMs\ton\tthe same\thost\twhen\tusing\tembedded\tcontainers.\tThat\tsaid,\tI\tstill\tfeel\tthat\tthese\tapplication containers\thave\tenough\tdownsides\tthat\tyou\tshould\tchallenge\tyourself\tto\tsee\tif\tthey\tare really\trequired.\n\nFirst\tamong\tthe\tdownsides\tis\tthat\tthey\tinevitably\tconstrain\ttechnology\tchoice.\tYou\thave to\tbuy\tinto\ta\ttechnology\tstack.\tThis\tcan\tlimit\tnot\tonly\tthe\ttechnology\tchoices\tfor\tthe implementation\tof\tthe\tservice\titself,\tbut\talso\tthe\toptions\tyou\thave\tin\tterms\tof\tautomation and\tmanagement\tof\tyour\tsystems.\tAs\twe’ll\tdiscuss\tshortly,\tone\tof\tthe\tways\twe\tcan address\tthe\toverhead\tof\tmanaging\tmultiple\thosts\tis\taround\tautomation,\tand\tso",
      "content_length": 1479,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 211,
      "content": "constraining\tour\toptions\tfor\tresolving\tthis\tmay\twell\tbe\tdoubly\tdamaging.\n\nI\twould\talso\tquestion\tsome\tof\tthe\tvalue\tof\tthe\tcontainer\tfeatures.\tMany\tof\tthem\ttout\tthe ability\tto\tmanage\tclusters\tto\tsupport\tshared\tin-memory\tsession\tstate,\tsomething\twe absolutely\twant\tto\tavoid\tin\tany\tcase\tdue\tto\tthe\tchallenges\tthis\tcreates\twhen\tscaling\tour services.\tAnd\tthe\tmonitoring\tcapabilities\tthey\tprovide\twon’t\tbe\tsufficient\twhen\twe consider\tthe\tsorts\tof\tjoined-up\tmonitoring\twe\twant\tto\tdo\tin\ta\tmicroservices\tworld,\tas we’ll\tsee\tin\tChapter\t8.\tMany\tof\tthem\talso\thave\tquite\tslow\tspin-up\ttimes,\timpacting developer\tfeedback\tcycles.\n\nThere\tare\tother\tsets\tof\tproblems\ttoo.\tAttempting\tto\tdo\tproper\tlifecycle\tmanagement\tof applications\ton\ttop\tof\tplatforms\tlike\tthe\tJVM\tcan\tbe\tproblematic,\tand\tmore\tcomplex\tthan simply\trestarting\ta\tJVM.\tAnalyzing\tresource\tuse\tand\tthreads\tis\talso\tmuch\tmore\tcomplex, as\tyou\thave\tmultiple\tapplications\tsharing\tthe\tsame\tprocess.\tAnd\tremember,\teven\tif\tyou\tdo get\tvalue\tfrom\ta\ttechnology-specific\tcontainer,\tthey\taren’t\tfree.\tAside\tfrom\tthe\tfact\tthat many\tof\tthem\tare\tcommercial\tand\tso\thave\ta\tcost\timplication,\tthey\tadd\ta\tresource overhead\tin\tand\tof\tthemselves.\n\nUltimately,\tthis\tapproach\tis\tagain\tan\tattempt\tto\toptimize\tfor\tscarcity\tof\tresources\tthat simply\tmay\tnot\thold\tup\tanymore.\tWhether\tyou\tdecide\tto\thave\tmultiple\tservices\tper\thost as\ta\tdeployment\tmodel,\tI\twould\tstrongly\tsuggest\tlooking\tat\tself-contained\tdeployable microservices\tas\tartifacts.\tFor\t.NET,\tthis\tis\tpossible\twith\tthings\tlike\tNancy,\tand\tJava\thas supported\tthis\tmodel\tfor\tyears.\tFor\texample,\tthe\tvenerable\tJetty\tembedded\tcontainer makes\tfor\ta\tvery\tlightweight\tself-contained\tHTTP\tserver,\twhich\tis\tthe\tcore\tof\tthe Dropwizard\tstack.\tGoogle\thas\tbeen\tknown\tto\tquite\thappily\tuse\tembedded\tJetty\tcontainers for\tserving\tstatic\tcontent\tdirectly,\tso\twe\tknow\tthese\tthings\tcan\toperate\tat\tscale.",
      "content_length": 1855,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 212,
      "content": "Single\tService\tPer\tHost\n\nWith\ta\tsingle-service-per-host\tmodel\tshown\tin\tFigure\t6-8,\twe\tavoid\tside\teffects\tof multiple\thosts\tliving\ton\ta\tsingle\thost,\tmaking\tmonitoring\tand\tremediation\tmuch\tsimpler. We\thave\tpotentially\treduced\tour\tsingle\tpoints\tof\tfailure.\tAn\toutage\tto\tone\thost\tshould impact\tonly\ta\tsingle\tservice,\talthough\tthat\tisn’t\talways\tclear\twhen\tyou’re\tusing\ta virtualized\tplatform.\tWe’ll\tcover\tdesigning\tfor\tscale\tand\tfailure\tmore\tin\tChapter\t11.\tWe also\tcan\tmore\teasily\tscale\tone\tservice\tindependent\tfrom\tothers,\tand\tdeal\twith\tsecurity concerns\tmore\teasily\tby\tfocusing\tour\tattention\tonly\ton\tthe\tservice\tand\thost\tthat\trequires it.\n\nFigure\t6-8.\tA\tsingle\tmicroservice\tper\thost\n\nJust\tas\timportant\tis\tthat\twe\thave\topened\tup\tthe\tpotential\tto\tuse\talternative\tdeployment techniques\tsuch\tas\timage-based\tdeployments\tor\tthe\timmutable\tserver\tpattern,\twhich\twe discussed\tearlier.\n\nWe’ve\tadded\ta\tlot\tof\tcomplexity\tin\tadopting\ta\tmicroservice\tarchitecture.\tThe\tlast\tthing\twe want\tto\tdo\tis\tgo\tlooking\tfor\tmore\tsources\tof\tcomplexity.\tIn\tmy\topinion,\tif\tyou\tdon’t\thave a\tviable\tPaaS\tavailable,\tthen\tthis\tmodel\tdoes\ta\tvery\tgood\tjob\tof\treducing\ta\tsystem’s overall\tcomplexity.\tHaving\ta\tsingle-service-per-host\tmodel\tis\tsignificantly\teasier\tto",
      "content_length": 1225,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 213,
      "content": "reason\tabout\tand\tcan\thelp\treduce\tcomplexity.\tIf\tyou\tcan’t\tembrace\tthis\tmodel\tyet,\tI\twon’t say\tmicroservices\taren’t\tfor\tyou.\tBut\tI\twould\tsuggest\tthat\tyou\tlook\tto\tmove\ttoward\tthis model\tover\ttime\tas\ta\tway\tof\treducing\tthe\tcomplexity\tthat\ta\tmicroservice\tarchitecture\tcan bring.\n\nHaving\tan\tincreased\tnumber\tof\thosts\thas\tpotential\tdownsides,\tthough.\tWe\thave\tmore servers\tto\tmanage,\tand\tthere\tmight\talso\tbe\ta\tcost\timplication\tof\trunning\tmore\tdistinct hosts.\tDespite\tthese\tproblems,\tthis\tis\tstill\tthe\tmodel\tI\tprefer\tfor\tmicroservice architectures.\tAnd\twe’ll\ttalk\tabout\ta\tfew\tthings\twe\tcan\tdo\tto\treduce\tthe\toverhead\tof handling\tlarge\tnumbers\tof\thosts\tshortly.",
      "content_length": 650,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 214,
      "content": "Platform\tas\ta\tService\n\nWhen\tusing\ta\tplatform\tas\ta\tservice\t(PaaS),\tyou\tare\tworking\tat\ta\thigher-level\tabstraction than\tat\ta\tsingle\thost.\tMost\tof\tthese\tplatforms\trely\ton\ttaking\ta\ttechnology-specific\tartifact, such\tas\ta\tJava\tWAR\tfile\tor\tRuby\tgem,\tand\tautomatically\tprovisioning\tand\trunning\tit\tfor you.\tSome\tof\tthese\tplatforms\twill\ttransparently\tattempt\tto\thandle\tscaling\tthe\tsystem\tup and\tdown\tfor\tyou,\talthough\ta\tmore\tcommon\t(and\tin\tmy\texperience\tless\terror-prone)\tway will\tallow\tyou\tsome\tcontrol\tover\thow\tmany\tnodes\tyour\tservice\tmight\trun\ton,\tbut\tit handles\tthe\trest.\n\nAt\tthe\ttime\tof\twriting,\tmost\tof\tthe\tbest,\tmost\tpolished\tPaaS\tsolutions\tare\thosted.\tHeroku comes\tto\tmind\tas\tbeing\tprobably\tthe\tgold\tclass\tof\tPaaS.\tIt\tdoesn’t\tjust\thandle\trunning your\tservice,\tit\talso\tsupports\tservices\tlike\tdatabases\tin\ta\tvery\tsimple\tfashion.\tSelf-hosted solutions\tdo\texist\tin\tthis\tspace,\talthough\tthey\tare\tmore\timmature\tthan\tthe\thosted solutions.\n\nWhen\tPaaS\tsolutions\twork\twell,\tthey\twork\tvery\twell\tindeed.\tHowever,\twhen\tthey\tdon’t quite\twork\tfor\tyou,\tyou\toften\tdon’t\thave\tmuch\tcontrol\tin\tterms\tof\tgetting\tunder\tthe\thood to\tfix\tthings.\tThis\tis\tpart\tof\tthe\ttrade-off\tyou\tmake.\tI\twould\tsay\tthat\tin\tmy\texperience\tthe smarter\tthe\tPaaS\tsolutions\ttry\tto\tbe,\tthe\tmore\tthey\tgo\twrong.\tI’ve\tused\tmore\tthan\tone PaaS\tthat\tattempts\tto\tautoscale\tbased\ton\tapplication\tuse,\tbut\tdoes\tit\tbadly.\tInvariably\tthe heuristics\tthat\tdrive\tthese\tsmarts\ttend\tto\tbe\ttailored\tfor\tthe\taverage\tapplication\trather\tthan your\tspecific\tuse\tcase.\tThe\tmore\tnonstandard\tyour\tapplication,\tthe\tmore\tlikely\tit\tis\tthat\tit might\tnot\tplay\tnicely\twith\ta\tPaaS.\n\nAs\tthe\tgood\tPaaS\tsolutions\thandle\tso\tmuch\tfor\tyou,\tthey\tcan\tbe\tan\texcellent\tway\tof handling\tthe\tincreased\toverhead\twe\tget\twith\thaving\tmany\tmore\tmoving\tparts.\tThat\tsaid, I’m\tstill\tnot\tsure\tthat\twe\thave\tall\tthe\tmodels\tright\tin\tthis\tspace\tyet,\tand\tthe\tlimited\tself- hosted\toptions\tmean\tthat\tthis\tapproach\tmight\tnot\twork\tfor\tyou.\tIn\tthe\tcoming\tdecade though\tI\texpect\twe’ll\tbe\ttargeting\tPaaS\tfor\tdeployment\tmore\tthan\thaving\tto\tself-manage hosts\tand\tdeployments\tof\tindividual\tservices.",
      "content_length": 2078,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 215,
      "content": "Automation\n\nThe\tanswer\tto\tso\tmany\tproblems\twe\thave\traised\tso\tfar\tcomes\tdown\tto\tautomation.\tWith\ta small\tnumber\tof\tmachines,\tit\tis\tpossible\tto\tmanage\teverything\tmanually.\tI\tused\tto\tdo\tthis. I\tremember\trunning\ta\tsmall\tset\tof\tproduction\tmachines,\tand\tI\twould\tcollect\tlogs,\tdeploy software,\tand\tcheck\tprocesses\tby\tmanually\tlogging\tin\tto\tthe\tbox.\tMy\tproductivity\tseemed to\tbe\tconstrained\tby\tthe\tnumber\tof\tterminal\twindows\tI\tcould\thave\topen\tat\tonce\t—\ta second\tmonitor\twas\ta\thuge\tstep\tup.\tThis\tbreaks\tdown\treally\tfast,\tthough.\n\nOne\tof\tthe\tpushbacks\tagainst\tthe\tsingle-service-per-host\tsetup\tis\tthe\tperception\tthat\tthe amount\tof\toverhead\tto\tmanage\tthese\thosts\twill\tincrease.\tThis\tis\tcertainly\ttrue\tif\tyou\tare doing\teverything\tmanually.\tDouble\tthe\tservers,\tdouble\tthe\twork!\tBut\tif\twe\tautomate control\tof\tour\thosts,\tand\tdeployment\tof\tthe\tservices,\tthen\tthere\tis\tno\treason\twhy\tadding more\thosts\tshould\tincrease\tour\tworkload\tin\ta\tlinear\tfashion.\n\nBut\teven\tif\twe\tkeep\tthe\tnumber\tof\thosts\tsmall,\twe\tstill\tare\tgoing\tto\thave\tlots\tof\tservices. That\tmeans\tmultiple\tdeployments\tto\thandle,\tservices\tto\tmonitor,\tlogs\tto\tcollect. Automation\tis\tessential.\n\nAutomation\tis\talso\thow\twe\tcan\tmake\tsure\tthat\tour\tdevelopers\tstill\tremain\tproductive. Giving\tthem\tthe\tability\tto\tself-service-provision\tindividual\tservices\tor\tgroups\tof\tservices is\tkey\tto\tmaking\tdevelopers’\tlives\teasier.\tIdeally,\tdevelopers\tshould\thave\taccess\tto\texactly the\tsame\ttool\tchain\tas\tis\tused\tfor\tdeployment\tof\tour\tproduction\tservices\tso\tas\tto\tensure that\twe\tcan\tspot\tproblems\tearly\ton.\tWe’ll\tbe\tlooking\tat\ta\tlot\tof\ttechnology\tin\tthis\tchapter that\tembraces\tthis\tview.\n\nPicking\ttechnology\tthat\tenables\tautomation\tis\thighly\timportant.\tThis\tstarts\twith\tthe\ttools used\tto\tmanage\thosts.\tCan\tyou\twrite\ta\tline\tof\tcode\tto\tlaunch\ta\tvirtual\tmachine,\tor\tshut one\tdown?\tCan\tyou\tdeploy\tthe\tsoftware\tyou\thave\twritten\tautomatically?\tCan\tyou\tdeploy database\tchanges\twithout\tmanual\tintervention?\tEmbracing\ta\tculture\tof\tautomation\tis\tkey if\tyou\twant\tto\tkeep\tthe\tcomplexities\tof\tmicroservice\tarchitectures\tin\tcheck.",
      "content_length": 2038,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 216,
      "content": "Two\tCase\tStudies\ton\tthe\tPower\tof\tAutomation\n\nIt\tis\tprobably\thelpful\tto\tgive\tyou\ta\tcouple\tof\tconcrete\texamples\tthat\texplain\tthe\tpower\tof good\tautomation.\tOne\tof\tour\tclients\tin\tAustralia\tis\tRealEstate.com.au\t(REA).\tAmong other\tthings,\tthe\tcompany\tprovides\treal\testate\tlistings\tfor\tretail\tand\tcommercial\tcustomers in\tAustralia\tand\telsewhere\tin\tthe\tAsia-Pacific\tregion.\tOver\ta\tnumber\tof\tyears,\tit\thas\tbeen moving\tits\tplatform\ttoward\ta\tdistributed,\tmicroservices\tdesign.\tWhen\tit\tstarted\ton\tthis journey\tit\thad\tto\tspend\ta\tlot\tof\ttime\tgetting\tthe\ttooling\taround\tthe\tservices\tjust\tright\t— making\tit\teasy\tfor\tdevelopers\tto\tprovision\tmachines,\tto\tdeploy\ttheir\tcode,\tor\tmonitor them.\tThis\tcaused\ta\tfront-loading\tof\twork\tto\tget\tthings\tstarted.\n\nIn\tthe\tfirst\tthree\tmonths\tof\tthis\texercise,\tREA\twas\table\tto\tmove\tjust\ttwo\tnew microservices\tinto\tproduction,\twith\tthe\tdevelopment\tteam\ttaking\tfull\tresponsibility\tfor\tthe entire\tbuild,\tdeployment,\tand\tsupport\tof\tthe\tservices.\tIn\tthe\tnext\tthree\tmonths,\tbetween 10–15\tservices\twent\tlive\tin\ta\tsimilar\tmanner.\tBy\tthe\tend\tof\tthe\t18-month\tperiod,\tREA\thad over\t60–70\tservices.\n\nThis\tsort\tof\tpattern\tis\talso\tborne\tout\tby\tthe\texperiences\tof\tGilt,\tan\tonline\tfashion\tretailer that\tstarted\tin\t2007.\tGilt’s\tmonolithic\tRails\tapplication\twas\tstarting\tto\tbecome\tdifficult\tto scale,\tand\tthe\tcompany\tdecided\tin\t2009\tto\tstart\tdecomposing\tthe\tsystem\tinto microservices.\tAgain\tautomation,\tespecially\ttooling\tto\thelp\tdevelopers,\twas\tgiven\tas\ta key\treason\tto\tdrive\tGilt’s\texplosion\tin\tthe\tuse\tof\tmicroservices.\tA\tyear\tlater,\tGilt\thad around\t10\tmicroservices\tlive;\tby\t2012,\tover\t100;\tand\tin\t2014,\tover\t450\tmicroservices\tby Gilt’s\town\tcount\t—\tin\tother\twords,\taround\tthree\tservices\tfor\tevery\tdeveloper\tin\tGilt.",
      "content_length": 1716,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 217,
      "content": "From\tPhysical\tto\tVirtual\n\nOne\tof\tthe\tkey\ttools\tavailable\tto\tus\tin\tmanaging\ta\tlarge\tnumber\tof\thosts\tis\tfinding\tways of\tchunking\tup\texisting\tphysical\tmachines\tinto\tsmaller\tparts.\tTraditional\tvirtualization like\tVMWare\tor\tthat\tused\tby\tAWS\thas\tyielded\thuge\tbenefits\tin\treducing\tthe\toverhead\tof host\tmanagement.\tHowever,\tthere\thave\tbeen\tsome\tnew\tadvances\tin\tthis\tspace\tthat\tare well\tworth\texploring,\tas\tthey\tcan\topen\tup\teven\tmore\tinteresting\tpossibilities\tfor\tdealing with\tour\tmicroservice\tarchitecture.",
      "content_length": 498,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 218,
      "content": "Traditional\tVirtualization\n\nWhy\tis\thaving\tlots\tof\thosts\texpensive?\tWell,\tif\tyou\tneed\ta\tphysical\tserver\tper\thost,\tthe answer\tis\tfairly\tobvious.\tIf\tthis\tis\tthe\tworld\tyou\tare\toperating\tin,\tthen\tthe\tmultiple- service-per-host\tmodel\tis\tprobably\tright\tfor\tyou,\talthough\tdon’t\tbe\tsurprised\tif\tthis becomes\tan\tever\tmore\tchallenging\tconstraint.\tI\tsuspect,\thowever,\tthat\tmost\tof\tyou\tare using\tvirtualization\tof\tsome\tsort.\tVirtualization\tallows\tus\tto\tslice\tup\ta\tphysical\tserver\tinto separate\thosts,\teach\tof\twhich\tcan\trun\tdifferent\tthings.\tSo\tif\twe\twant\tone\tservice\tper\thost, can’t\twe\tjust\tslice\tup\tour\tphysical\tinfrastructure\tinto\tsmaller\tand\tsmaller\tpieces?\n\nWell,\tfor\tsome\tpeople,\tyou\tcan.\tHowever,\tslicing\tup\tthe\tmachine\tinto\tever\tincreasing VMs\tisn’t\tfree.\tThink\tof\tour\tphysical\tmachine\tas\ta\tsock\tdrawer.\tIf\twe\tput\tlots\tof\twooden dividers\tinto\tour\tdrawer,\tcan\twe\tstore\tmore\tsocks\tor\tfewer?\tThe\tanswer\tis\tfewer:\tthe dividers\tthemselves\ttake\tup\troom\ttoo!\tOur\tdrawer\tmight\tbe\teasier\tto\tdeal\twith\tand organize,\tand\tperhaps\twe\tcould\tdecide\tto\tput\tT-shirts\tin\tone\tof\tthe\tspaces\tnow\trather\tthan just\tsocks,\tbut\tmore\tdividers\tmeans\tless\toverall\tspace.\n\nIn\tthe\tworld\tof\tvirtualization,\twe\thave\ta\tsimilar\toverhead\tas\tour\tsock\tdrawer\tdividers.\tTo understand\twhere\tthis\toverhead\tcomes\tfrom,\tlet’s\tlook\tat\thow\tmost\tvirtualization\tis\tdone. Figure\t6-9\tshows\ta\tcomparison\tof\ttwo\ttypes\tof\tvirtualization.\tOn\tthe\tleft,\twe\tsee\tthe various\tlayers\tinvolved\tin\twhat\tis\tcalled\ttype\t2\tvirtualization,\twhich\tis\tthe\tsort implemented\tby\tAWS,\tVMWare,\tVSphere,\tXen,\tand\tKVM.\t(Type\t1\tvirtualization\trefers to\ttechnology\twhere\tthe\tVMs\trun\tdirectly\ton\thardware,\tnot\ton\ttop\tof\tanother\toperating system.)\tOn\tour\tphysical\tinfrastructure\twe\thave\ta\thost\toperating\tsystem.\tOn\tthis\tOS\twe run\tsomething\tcalled\ta\thypervisor,\twhich\thas\ttwo\tkey\tjobs.\tFirst,\tit\tmaps\tresources\tlike CPU\tand\tmemory\tfrom\tthe\tvirtual\thost\tto\tthe\tphysical\thost.\tSecond,\tit\tacts\tas\ta\tcontrol layer,\tallowing\tus\tto\tmanipulate\tthe\tvirtual\tmachines\tthemselves.\n\nFigure\t6-9.\tA\tcomparison\tof\tstandard\tType\t2\tvirtualization,\tand\tlightweight\tcontainers\n\nInside\tthe\tVMs,\twe\tget\twhat\tlooks\tlike\tcompletely\tdifferent\thosts.\tThey\tcan\trun\ttheir\town",
      "content_length": 2163,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 219,
      "content": "operating\tsystems,\twith\ttheir\town\tkernels.\tThey\tcan\tbe\tconsidered\talmost\thermetically sealed\tmachines,\tkept\tisolated\tfrom\tthe\tunderlying\tphysical\thost\tand\tthe\tother\tvirtual machines\tby\tthe\thypervisor.\n\nThe\tproblem\tis\tthat\tthe\thypervisor\there\tneeds\tto\tset\taside\tresources\tto\tdo\tits\tjob.\tThis takes\taway\tCPU,\tI/O,\tand\tmemory\tthat\tcould\tbe\tused\telsewhere.\tThe\tmore\thosts\tthe hypervisor\tmanages,\tthe\tmore\tresources\tit\tneeds.\tAt\ta\tcertain\tpoint,\tthis\toverhead becomes\ta\tconstraint\tin\tslicing\tup\tyour\tphysical\tinfrastructure\tany\tfurther.\tIn\tpractice,\tthis means\tthat\tthere\tare\toften\tdiminishing\treturns\tin\tslicing\tup\ta\tphysical\tbox\tinto\tsmaller\tand smaller\tparts,\tas\tproportionally\tmore\tand\tmore\tresources\tgo\tinto\tthe\toverhead\tof\tthe hypervisor.",
      "content_length": 739,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 220,
      "content": "Vagrant\n\nVagrant\tis\ta\tvery\tuseful\tdeployment\tplatform,\twhich\tis\tnormally\tused\tfor\tdev\tand\ttest rather\tthan\tproduction.\tVagrant\tprovides\tyou\twith\ta\tvirtual\tcloud\ton\tyour\tlaptop. Underneath,\tit\tuses\ta\tstandard\tvirtualization\tsystem\t(typically\tVirtualBox,\talthough\tit\tcan use\tother\tplatforms).\tIt\tallows\tyou\tto\tdefine\ta\tset\tof\tVMs\tin\ta\ttext\tfile,\talong\twith\thow\tthe VMs\tare\tnetworked\ttogether\tand\twhich\timages\tthe\tVMs\tshould\tbe\tbased\ton.\tThis\ttext\tfile can\tbe\tchecked\tin\tand\tshared\tbetween\tteam\tmembers.\n\nThis\tmakes\tit\teasier\tfor\tyou\tto\tcreate\tproduction-like\tenvironments\ton\tyour\tlocal\tmachine. You\tcan\tspin\tup\tmultiple\tVMs\tat\ta\ttime,\tshut\tindividual\tones\tto\ttest\tfailure\tmodes,\tand have\tthe\tVMs\tmapped\tthrough\tto\tlocal\tdirectories\tso\tyou\tcan\tmake\tchanges\tand\tsee\tthem reflected\timmediately.\tEven\tfor\tteams\tusing\ton-demand\tcloud\tplatforms\tlike\tAWS,\tthe faster\tturnaround\tof\tusing\tVagrant\tcan\tbe\ta\thuge\tboon\tfor\tdevelopment\tteams.\n\nOne\tof\tthe\tdownsides,\tthough,\tis\tthat\trunning\tlots\tof\tVMs\tcan\ttax\tthe\taverage development\tmachine.\tIf\twe\thave\tone\tservice\tto\tone\tVM,\tyou\tmay\tnot\tbe\table\tto\tbring\tup your\tentire\tsystem\ton\tyour\tlocal\tmachine.\tThis\tcan\tresult\tin\tthe\tneed\tto\tstub\tout\tsome dependencies\tto\tmake\tthings\tmanageable,\twhich\tis\tone\tmore\tthing\tyou’ll\thave\tto\thandle to\tensure\tthat\tthe\tdevelopment\tand\ttest\texperience\tis\ta\tgood\tone.",
      "content_length": 1332,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 221,
      "content": "Linux\tContainers\n\nFor\tLinux\tusers,\tthere\tis\tan\talternative\tto\tvirtualization.\tRather\tthan\thaving\ta\thypervisor to\tsegment\tand\tcontrol\tseparate\tvirtual\thosts,\tLinux\tcontainers\tinstead\tcreate\ta\tseparate process\tspace\tin\twhich\tother\tprocesses\tlive.\n\nOn\tLinux,\tprocess\tare\trun\tby\ta\tgiven\tuser,\tand\thave\tcertain\tcapabilities\tbased\ton\thow\tthe permissions\tare\tset.\tProcesses\tcan\tspawn\tother\tprocesses.\tFor\texample,\tif\tI\tlaunch\ta process\tin\ta\tterminal,\tthat\tchild\tprocess\tis\tgenerally\tconsidered\ta\tchild\tof\tthe\tterminal process.\tThe\tLinux\tkernel’s\tjob\tis\tmaintaining\tthis\ttree\tof\tprocesses.\n\nLinux\tcontainers\textend\tthis\tidea.\tEach\tcontainer\tis\teffectively\ta\tsubtree\tof\tthe\toverall system\tprocess\ttree.\tThese\tcontainers\tcan\thave\tphysical\tresources\tallocated\tto\tthem, something\tthe\tkernel\thandles\tfor\tus.\tThis\tgeneral\tapproach\thas\tbeen\taround\tin\tmany forms,\tsuch\tas\tSolaris\tZones\tand\tOpenVZ,\tbut\tit\tis\tLXC\tthat\thas\tbecome\tmost\tpopular. LXC\tis\tnow\tavailable\tout\tof\tthe\tbox\tin\tany\tmodern\tLinux\tkernel.\n\nIf\twe\tlook\tat\ta\tstack\tdiagram\tfor\ta\thost\trunning\tLXC\tin\tFigure\t6-9,\twe\tsee\ta\tfew differences.\tFirst,\twe\tdon’t\tneed\ta\thypervisor.\tSecond,\talthough\teach\tcontainer\tcan\trun\tits own\toperating\tsystem\tdistribution,\tit\thas\tto\tshare\tthe\tsame\tkernel\t(because\tthe\tkernel\tis where\tthe\tprocess\ttree\tlives).\tThis\tmeans\tthat\tour\thost\toperating\tsystem\tcould\trun\tUbuntu, and\tour\tcontainers\tCentOS,\tas\tlong\tas\tthey\tcould\tboth\tshare\tthe\tsame\tkernel.\n\nWe\tdon’t\tjust\tbenefit\tfrom\tthe\tresources\tsaved\tby\tnot\tneeding\ta\thypervisor.\tWe\talso\tgain in\tterms\tof\tfeedback.\tLinux\tcontainers\tare\tmuch\tfaster\tto\tprovision\tthan\tfull-fat\tvirtual machines.\tIt\tisn’t\tuncommon\tfor\ta\tVM\tto\ttake\tmany\tminutes\tto\tstart\t—\tbut\twith\tLinux containers,\tstartup\tcan\ttake\ta\tfew\tseconds.\tYou\talso\thave\tfiner-grained\tcontrol\tover\tthe containers\tthemselves\tin\tterms\tof\tassigning\tresources\tto\tthem,\twhich\tmakes\tit\tmuch\teasier to\ttweak\tthe\tsettings\tto\tget\tthe\tmost\tout\tof\tthe\tunderlying\thardware.\n\nDue\tto\tthe\tlighter-weight\tnature\tof\tcontainers,\twe\tcan\thave\tmany\tmore\tof\tthem\trunning on\tthe\tsame\thardware\tthan\twould\tbe\tpossible\twith\tVMs.\tBy\tdeploying\tone\tservice\tper container,\tas\tin\tFigure\t6-10,\twe\tget\ta\tdegree\tof\tisolation\tfrom\tother\tcontainers\t(although this\tisn’t\tperfect),\tand\tcan\tdo\tso\tmuch\tmore\tcost\teffectively\tthan\twould\tbe\tpossible\tif\twe wanted\tto\trun\teach\tservice\tin\tits\town\tVM.",
      "content_length": 2328,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 222,
      "content": "Figure\t6-10.\tRunning\tservices\tin\tseparate\tcontainers\n\nContainers\tcan\tbe\tused\twell\twith\tfull-fat\tvirtualization\ttoo.\tI’ve\tseen\tmore\tthan\tone project\tprovision\ta\tlarge\tAWS\tEC2\tinstance\tand\trun\tLXC\tcontainers\ton\tit\tto\tget\tthe\tbest of\tboth\tworlds:\tan\ton-demand\tephemeral\tcompute\tplatform\tin\tthe\tform\tof\tEC2,\tcoupled with\thighly\tflexible\tand\tfast\tcontainers\trunning\ton\ttop\tof\tit.\n\nLinux\tcontainers\taren’t\twithout\tsome\tproblems,\thowever.\tImagine\tI\thave\tlots\tof microservices\trunning\tin\ttheir\town\tcontainers\ton\ta\thost.\tHow\tdoes\tthe\toutside\tworld\tsee them?\tYou\tneed\tsome\tway\tto\troute\tthe\toutside\tworld\tthrough\tto\tthe\tunderlying\tcontainers, something\tmany\tof\tthe\thypervisors\tdo\tfor\tyou\twith\tnormal\tvirtualization.\tI’ve\tseen\tmany a\tperson\tsink\tinordinate\tamounts\tof\ttime\tinto\tconfiguring\tport\tforwarding\tusing\tIPTables to\texpose\tcontainers\tdirectly.\tAnother\tpoint\tto\tbear\tin\tmind\tis\tthat\tthese\tcontainers\tcannot be\tconsidered\tcompletely\tsealed\tfrom\teach\tother.\tThere\tare\tmany\tdocumented\tand\tknown ways\tin\twhich\ta\tprocess\tfrom\tone\tcontainer\tcan\tbust\tout\tand\tinteract\twith\tother\tcontainers or\tthe\tunderlying\thost.\tSome\tof\tthese\tproblems\tare\tby\tdesign\tand\tsome\tare\tbugs\tthat\tare",
      "content_length": 1165,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 223,
      "content": "being\taddressed,\tbut\teither\tway\tif\tyou\tdon’t\ttrust\tthe\tcode\tyou\tare\trunning,\tdon’t\texpect that\tyou\tcan\trun\tit\tin\ta\tcontainer\tand\tbe\tsafe.\tIf\tyou\tneed\tthat\tsort\tof\tisolation,\tyou’ll\tneed to\tconsider\tusing\tvirtual\tmachines\tinstead.",
      "content_length": 229,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 224,
      "content": "Docker\n\nDocker\tis\ta\tplatform\tbuilt\ton\ttop\tof\tlightweight\tcontainers.\tIt\thandles\tmuch\tof\tthe\twork around\thandling\tcontainers\tfor\tyou.\tIn\tDocker,\tyou\tcreate\tand\tdeploy\tapps,\twhich\tare synonymous\twith\timages\tin\tthe\tVM\tworld,\talbeit\tfor\ta\tcontainer-based\tplatform.\tDocker manages\tthe\tcontainer\tprovisioning,\thandles\tsome\tof\tthe\tnetworking\tproblems\tfor\tyou, and\teven\tprovides\tits\town\tregistry\tconcept\tthat\tallows\tyou\tto\tstore\tand\tversion\tDocker applications.\n\nThe\tDocker\tapp\tabstraction\tis\ta\tuseful\tone\tfor\tus,\tbecause\tjust\tas\twith\tVM\timages\tthe underlying\ttechnology\tused\tto\timplement\tthe\tservice\tis\thidden\tfrom\tus.\tWe\thave\tour builds\tfor\tour\tservices\tcreate\tDocker\tapplications,\tand\tstore\tthem\tin\tthe\tDocker\tregistry, and\taway\twe\tgo.\n\nDocker\tcan\talso\talleviate\tsome\tof\tthe\tdownsides\tof\trunning\tlots\tof\tservices\tlocally\tfor\tdev and\ttest\tpurposes.\tRather\tthan\tusing\tVagrant\tto\thost\tmultiple\tindependent\tVMs,\teach\tone containing\tits\town\tservice,\twe\tcan\thost\ta\tsingle\tVM\tin\tVagrant\tthat\truns\ta\tDocker instance.\tWe\tthen\tuse\tVagrant\tto\tset\tup\tand\ttear\tdown\tthe\tDocker\tplatform\titself,\tand\tuse Docker\tfor\tfast\tprovisioning\tof\tindividual\tservices.\n\nA\tnumber\tof\tdifferent\ttechnologies\tare\tbeing\tdeveloped\tto\ttake\tadvantage\tof\tDocker. CoreOS\tis\ta\tvery\tinteresting\toperating\tsystem\tdesigned\twith\tDocker\tin\tmind.\tIt\tis\ta stripped-down\tLinux\tOS\tthat\tprovides\tonly\tthe\tessential\tservices\tto\tallow\tDocker\tto\trun. This\tmeans\tit\tconsumes\tfewer\tresources\tthan\tother\toperating\tsystems,\tmaking\tit\tpossible to\tdedicate\teven\tmore\tresources\tof\tthe\tunderlying\tmachine\tto\tour\tcontainers.\tRather\tthan using\ta\tpackage\tmanager\tlike\tdebs\tor\tRPMs,\tall\tsoftware\tis\tinstalled\tas\tindependent Docker\tapps,\teach\trunning\tin\tits\town\tcontainer.\n\nDocker\titself\tdoesn’t\tsolve\tall\tproblems\tfor\tus.\tThink\tof\tit\tas\ta\tsimple\tPaaS\tthat\tworks\ton a\tsingle\tmachine.\tIf\tyou\twant\ttools\tto\thelp\tyou\tmanage\tservices\tacross\tmultiple\tDocker instances\tacross\tmultiple\tmachines,\tyou’ll\tneed\tto\tlook\tat\tother\tsoftware\tthat\tadds\tthese capabilities.\tThere\tis\ta\tkey\tneed\tfor\ta\tscheduling\tlayer\tthat\tlets\tyou\trequest\ta\tcontainer and\tthen\tfinds\ta\tDocker\tcontainer\tthat\tcan\trun\tit\tfor\tyou.\tIn\tthis\tspace,\tGoogle’s\trecently open\tsourced\tKubernetes\tand\tCoreOS’s\tcluster\ttechnology\tcan\thelp,\tand\tit\tseems\tevery month\tthere\tis\ta\tnew\tentrant\tin\tthis\tspace.\tDeis\tis\tanother\tinteresting\ttool\tbased\ton Docker,\twhich\tis\tattempting\tto\tprovide\ta\tHeroku-like\tPaaS\ton\ttop\tof\tDocker.\n\nI\ttalked\tearlier\tabout\tPaaS\tsolutions.\tMy\tstruggle\twith\tthem\thas\talways\tbeen\tthat\tthey often\tget\tthe\tabstraction\tlevel\twrong,\tand\tthat\tself-hosted\tsolutions\tlag\tsignificantly behind\thosted\tsolutions\tlike\tHeroku.\tDocker\tgets\tmuch\tmore\tof\tthis\tright,\tand\tthe explosion\tof\tinterest\tin\tthis\tspace\tmeans\tI\tsuspect\tit\twill\tbecome\ta\tmuch\tmore\tviable platform\tfor\tall\tsorts\tof\tdeployments\tover\tthe\tnext\tfew\tyears\tfor\tall\tsorts\tof\tdifferent\tuse cases.\tIn\tmany\tways,\tDocker\twith\tan\tappropriate\tscheduling\tlayer\tsits\tbetween\tIaaS\tand PaaS\tsolutions\t—\tthe\tterm\tcontainers\tas\ta\tservice\t(CaaS)\tis\talready\tbeing\tused\tto",
      "content_length": 3009,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 225,
      "content": "describe\tit.\n\nDocker\tis\tbeing\tused\tin\tproduction\tby\tmultiple\tcompanies.\tIt\tprovides\tmany\tof\tthe benefits\tof\tlightweight\tcontainers\tin\tterms\tof\tefficiency\tand\tspeed\tof\tprovisioning, together\twith\tthe\ttools\tto\tavoid\tmany\tof\tthe\tdownsides.\tIf\tyou\tare\tinterested\tin\tlooking\tat alternative\tdeployment\tplatforms,\tI’d\tstrongly\tsuggest\tyou\tgive\tDocker\ta\tlook.",
      "content_length": 351,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 226,
      "content": "A\tDeployment\tInterface\n\nWhatever\tunderlying\tplatform\tor\tartifacts\tyou\tuse,\thaving\ta\tuniform\tinterface\tto\tdeploy\ta given\tservice\tis\tvital.\tWe’ll\twant\tto\ttrigger\tdeployment\tof\ta\tmicroservice\ton\tdemand\tin\ta variety\tof\tdifferent\tsituations,\tfrom\tdeployments\tlocally\tfor\tdev\tand\ttest\tto\tproduction deployments.\tWe’ll\talso\twant\tto\tkeep\tour\tdeployment\tmechanisms\tas\tsimilar\tas\tpossible from\tdev\tto\tproduction,\tas\tthe\tlast\tthing\twe\twant\tis\tto\tfind\tourselves\thitting\tproblems\tin production\tbecause\tdeployment\tuses\ta\tcompletely\tdifferent\tprocess!\n\nAfter\tmany\tyears\tof\tworking\tin\tthis\tspace,\tI\tam\tconvinced\tthat\tthe\tmost\tsensible\tway\tto trigger\tany\tdeployment\tis\tvia\ta\tsingle,\tparameterizable\tcommand-line\tcall.\tThis\tcan\tbe triggered\tby\tscripts,\tlaunched\tby\tyour\tCI\ttool,\tor\ttyped\tin\tby\thand.\tI’ve\tbuilt\twrapper scripts\tin\ta\tvariety\tof\ttechnology\tstacks\tto\tmake\tthis\twork,\tfrom\tWindows\tbatch,\tto\tbash, to\tPython\tFabric\tscripts,\tand\tmore,\tbut\tall\tof\tthe\tcommand\tlines\tshare\tthe\tsame\tbasic format.\n\nWe\tneed\tto\tknow\twhat\twe\tare\tdeploying,\tso\twe\tneed\tto\tprovide\tthe\tname\tof\ta\tknown entity,\tor\tin\tour\tcase\ta\tmicroservice.\tWe\talso\tneed\tto\tknow\twhat\tversion\tof\tthe\tentity\twe want.\tThe\tanswer\tto\twhat\tversion\ttends\tto\tbe\tone\tof\tthree\tpossibilities.\tWhen\tyou’re working\tlocally,\tit’ll\tbe\twhatever\tversion\tis\ton\tyour\tlocal\tmachine.\tWhen\ttesting,\tyou’ll want\tthe\tlatest\tgreen\tbuild,\twhich\tcould\tjust\tbe\tthe\tmost\trecent\tblessed\tartifact\tin\tour artifact\trepository.\tOr\twhen\ttesting/diagnosing\tissues,\twe\tmay\twant\tto\tdeploy\tan\texact build.\n\nThe\tthird\tand\tfinal\tthing\twe’ll\tneed\tto\tknow\tis\twhat\tenvironment\twe\twant\tthe microservice\tdeployed\tinto.\tAs\twe\tdiscussed\tearlier,\tour\tmicroservice’s\ttopology\tmay differ\tfrom\tone\tenvironment\tto\tthe\tnext,\tbut\tthat\tshould\tbe\thidden\tfrom\tus\there.\n\nSo,\timagine\twe\tcreate\ta\tsimple\tdeploy\tscript\tthat\ttakes\tthese\tthree\tparameters.\tSay\twe’re developing\tlocally\tand\twant\tto\tdeploy\tour\tcatalog\tservice\tinto\tour\tlocal\tenvironment.\tI might\ttype:\n\n$\tdeploy\tartifact=catalog\tenvironment=local\tversion=local\n\nOnce\tI’ve\tchecked\tin,\tour\tCI\tbuild\tservice\tpicks\tup\tthe\tchange\tand\tcreates\ta\tnew\tbuild artifact,\tgiving\tit\tthe\tbuild\tnumber\tb456.\tAs\tis\tstandard\tin\tmost\tCI\ttools,\tthis\tvalue\tgets passed\talong\tthe\tpipeline.\tWhen\tour\ttest\tstage\tgets\ttriggered,\tthe\tCI\tstage\twill\trun:\n\n$\tdeploy\tartifact=catalog\tenvironment=ci\tversion=b456\n\nMeanwhile,\tour\tQA\twants\tto\tpull\tthe\tlatest\tversion\tof\tthe\tcatalog\tservice\tinto\tan integrated\ttest\tenvironment\tto\tdo\tsome\texploratory\ttesting,\tand\tto\thelp\twith\ta\tshowcase. That\tteam\truns:\n\n$\tdeploy\tartifact=catalog\tenvironment=integrated_qa\tversion=latest",
      "content_length": 2585,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 227,
      "content": "The\ttool\tI’ve\tused\tthe\tmost\tfor\tthis\tis\tFabric,\ta\tPython\tlibrary\tdesigned\tto\tmap\tcommand- line\tcalls\tto\tfunctions,\talong\twith\tgood\tsupport\tfor\thandling\ttasks\tlike\tSSH\tinto\tremote machines.\tPair\tit\twith\tan\tAWS\tclient\tlibrary\tlike\tBoto,\tand\tyou\thave\teverything\tyou\tneed to\tfully\tautomate\tvery\tlarge\tAWS\tenvironments.\tFor\tRuby,\tCapistrano\tis\tsimilar\tin\tsome ways\tto\tFabric,\tand\ton\tWindows\tyou\tcould\tgo\ta\tlong\tway\tusing\tPowerShell.",
      "content_length": 427,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 228,
      "content": "Environment\tDefinition\n\nClearly,\tfor\tthis\tto\twork,\twe\tneed\tto\thave\tsome\tway\tof\tdefining\twhat\tour\tenvironments look\tlike,\tand\twhat\tour\tservice\tlooks\tlike\tin\ta\tgiven\tenvironment.\tYou\tcan\tthink\tof\tan environment\tdefinition\tas\ta\tmapping\tfrom\ta\tmicroservice\tto\tcompute,\tnetwork,\tand storage\tresources.\tI’ve\tdone\tthis\twith\tYAML\tfiles\tbefore,\tand\tused\tmy\tscripts\tto\tpull\tthis data\tin.\tExample\t6-1\tis\ta\tsimplified\tversion\tof\tsome\twork\tI\tdid\ta\tcouple\tof\tyears\tago\tfor\ta project\tthat\tused\tAWS.\n\nExample\t6-1.\tAn\texample\tenvironment\tdefinition development: \t\tnodes: \t\t-\tami_id:\tami-e1e1234 \t\t\t\tsize:\t\t\tt1.micro\t \t\t\t\tcredentials_name:\teu-west-ssh\t \t\t\t\tservices:\t[catalog-service] \t\t\t\tregion:\teu-west-1\n\nproduction: \t\tnodes: \t\t-\tami_id:\tami-e1e1234 \t\t\t\tsize:\t\t\tm3.xlarge\t \t\t\t\tcredentials_name:\tprod-credentials\t \t\t\t\tservices:\t[catalog-service] \t\t\t\tnumber:\t5\n\nWe\tvaried\tthe\tsize\tof\tthe\tinstances\twe\tused\tto\tbe\tmore\tcost\teffective.\tYou\tdon’t\tneed a\t16-core\tbox\twith\t64GB\tof\tRAM\tfor\texploratory\ttesting!\n\nBeing\table\tto\tspecify\tdifferent\tcredentials\tfor\tdifferent\tenvironments\tis\tkey. Credentials\tfor\tsensitive\tenvironments\twere\tstored\tin\tdifferent\tsource\tcode\trepos\tthat only\tselect\tpeople\twould\thave\taccess\tto.\n\nWe\tdecided\tthat\tby\tdefault\tif\ta\tservice\thad\tmore\tthan\tone\tnode\tconfigured,\twe\twould automatically\tcreate\ta\tload\tbalancer\tfor\tit.\n\nI\thave\tremoved\tsome\tdetail\tfor\tthe\tsake\tof\tbrevity.\n\nThe\tcatalog-service\tinformation\twas\tstored\telsewhere.\tIt\tdidn’t\tdiffer\tfrom\tone environment\tto\tthe\tnext,\tas\tyou\tcan\tsee\tin\tExample\t6-2.\n\nExample\t6-2.\tAn\texample\tenvironment\tdefinition catalog-service: \t\tpuppet_manifest\t:\tcatalog.pp\t \t\tconnectivity: \t\t\t\t-\tprotocol:\ttcp \t\t\t\t\t\tports:\t[\t8080,\t8081\t] \t\t\t\t\t\tallowed:\t[\tWORLD\t]\n\nThis\twas\tthe\tname\tof\tthe\tPuppet\tfile\tto\trun\t—\twe\thappened\tto\tuse\tPuppet\tsolo\tin\tthis situation,\tbut\ttheoretically\tcould\thave\tsupported\talternative\tconfiguration\tsystems.",
      "content_length": 1871,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 229,
      "content": "Obviously,\ta\tlot\tof\tthe\tbehavior\there\twas\tconvention\tbased.\tFor\texample,\twe\tdecided\tto normalize\twhich\tports\tservices\tused\twherever\tthey\tran,\tand\tautomatically\tconfigured\tload balancers\tif\ta\tservice\thad\tmore\tthan\tone\tinstance\t(something\tthat\tAWS’s\tELBs\tmake fairly\teasy).\n\nBuilding\ta\tsystem\tlike\tthis\trequired\ta\tsignificant\tamount\tof\twork.\tThe\teffort\tis\toften\tfront- loaded,\tbut\tcan\tbe\tessential\tto\tmanage\tthe\tdeployment\tcomplexity\tyou\thave.\tI\thope\tin\tthe future\tyou\twon’t\thave\tto\tdo\tthis\tyourself.\tTerraform\tis\ta\tvery\tnew\ttool\tfrom\tHashicorp, which\tworks\tin\tthis\tspace.\tI’d\tgenerally\tshy\taway\tfrom\tmentioning\tsuch\ta\tnew\ttool\tin\ta book\tthat\tis\tmore\tabout\tideas\tthan\ttechnology,\tbut\tit\tis\tattempting\tto\tcreate\tan\topen\tsource tool\talong\tthese\tlines.\tIt’s\tearly\tdays\tyet,\tbut\talready\tits\tcapabilities\tseem\treally interesting.\tWith\tthe\tability\tto\ttarget\tdeployments\ton\ta\tnumber\tof\tdifferent\tplatforms,\tin the\tfuture\tit\tcould\tbe\tjust\tthe\ttool\tfor\tthe\tjob.",
      "content_length": 950,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 230,
      "content": "Summary\n\nWe’ve\tcovered\ta\tlot\tof\tground\there,\tso\ta\trecap\tis\tin\torder.\tFirst,\tfocus\ton\tmaintaining\tthe ability\tto\trelease\tone\tservice\tindependently\tfrom\tanother,\tand\tmake\tsure\tthat\twhatever technology\tyou\tselect\tsupports\tthis.\tI\tgreatly\tprefer\thaving\ta\tsingle\trepository\tper microservice,\tbut\tam\tfirmer\tstill\tthat\tyou\tneed\tone\tCI\tbuild\tper\tmicroservice\tif\tyou\twant to\tdeploy\tthem\tseparately.\n\nNext,\tif\tpossible,\tmove\tto\ta\tsingle-service\tper\thost/container.\tLook\tat\talternative technologies\tlike\tLXC\tor\tDocker\tto\tmake\tmanaging\tthe\tmoving\tparts\tcheaper\tand\teasier, but\tunderstand\tthat\twhatever\ttechnology\tyou\tadopt,\ta\tculture\tof\tautomation\tis\tkey\tto managing\teverything.\tAutomate\teverything,\tand\tif\tthe\ttechnology\tyou\thave\tdoesn’t\tallow this,\tget\tsome\tnew\ttechnology!\tBeing\table\tto\tuse\ta\tplatform\tlike\tAWS\twill\tgive\tyou\thuge benefits\twhen\tit\tcomes\tto\tautomation.\n\nMake\tsure\tyou\tunderstand\tthe\timpact\tyour\tdeployment\tchoices\thave\ton\tdevelopers,\tand make\tsure\tthey\tfeel\tthe\tlove\ttoo.\tCreating\ttools\tthat\tlet\tyou\tself-service-deploy\tany\tgiven service\tinto\ta\tnumber\tof\tdifferent\tenvironments\tis\treally\timportant,\tand\twill\thelp developers,\ttesters,\tand\toperations\tpeople\talike.\n\nFinally,\tif\tyou\twant\tto\tgo\tdeeper\tinto\tthis\ttopic,\tI\tthoroughly\trecommend\tyou\tread\tJez Humble\tand\tDavid\tFarley’s\tContinuous\tDelivery\t(Addison-Wesley),\twhich\tgoes\tinto much\tmore\tdetail\ton\tsubjects\tlike\tpipeline\tdesign\tand\tartifact\tmanagement.\n\nIn\tthe\tnext\tchapter,\twe’ll\tbe\tgoing\tdeeper\tinto\ta\ttopic\twe\ttouched\ton\tbriefly\there.\tNamely, how\tdo\twe\ttest\tour\tmicroservices\tto\tmake\tsure\tthey\tactually\twork?",
      "content_length": 1570,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 231,
      "content": "Chapter\t7.\tTesting\n\nThe\tworld\tof\tautomated\ttesting\thas\tadvanced\tsignificantly\tsince\tI\tfirst\tstarted\twriting code,\tand\tevery\tmonth\tthere\tseems\tto\tbe\tsome\tnew\ttool\tor\ttechnique\tto\tmake\tit\teven better.\tBut\tchallenges\tremain\tas\thow\tto\teffectively\tand\tefficiently\ttest\tour\tfunctionality when\tit\tspans\ta\tdistributed\tsystem.\tThis\tchapter\tbreaks\tdown\tthe\tproblems\tassociated\twith testing\tfiner-grained\tsystems\tand\tpresents\tsome\tsolutions\tto\thelp\tyou\tmake\tsure\tyou\tcan release\tyour\tnew\tfunctionality\twith\tconfidence.\n\nTesting\tcovers\ta\tlot\tof\tground.\tEven\twhen\twe\tare\tjust\ttalking\tabout\tautomated\ttests,\tthere are\ta\tlarge\tnumber\tto\tconsider.\tWith\tmicroservices,\twe\thave\tadded\tanother\tlevel\tof complexity.\tUnderstanding\twhat\tdifferent\ttypes\tof\ttests\twe\tcan\trun\tis\timportant\tto\thelp\tus balance\tthe\tsometimes-opposing\tforces\tof\tgetting\tour\tsoftware\tinto\tproduction\tas\tquickly as\tpossible\tversus\tmaking\tsure\tour\tsoftware\tis\tof\tsufficient\tquality.",
      "content_length": 932,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 232,
      "content": "Types\tof\tTests\n\nAs\ta\tconsultant,\tI\tlike\tpulling\tout\tthe\todd\tquadrant\tas\ta\tway\tof\tcategorizing\tthe\tworld,\tand I\twas\tstarting\tto\tworry\tthis\tbook\twouldn’t\thave\tone.\tLuckily,\tBrian\tMarick\tcame\tup\twith a\tfantastic\tcategorization\tsystem\tfor\ttests\tthat\tfits\tright\tin.\tFigure\t7-1\tshows\ta\tvariation\tof Marick’s\tquadrant\tfrom\tLisa\tCrispin\tand\tJanet\tGregory’s\tbook\tAgile\tTesting\t(Addison- Wesley)\tthat\thelps\tcategorize\tthe\tdifferent\ttypes\tof\ttests.\n\nFigure\t7-1.\tBrian\tMarick’s\ttesting\tquadrant.\tCrispin,\tLisa;\tGregory,\tJanet,\tAgile\tTesting:\tA\tPractical\tGuide\tfor\tTesters and\tAgile\tTeams,\t1st\tEdition,\t©\t2009.\tAdapted\tby\tpermission\tof\tPearson\tEducation,\tInc.,\tUpper\tSaddle\tRiver,\tNJ.\n\nAt\tthe\tbottom,\twe\thave\ttests\tthat\tare\ttechnology-facing\t—\tthat\tis,\ttests\tthat\taid\tthe developers\tin\tcreating\tthe\tsystem\tin\tthe\tfirst\tplace.\tPerformance\ttests\tand\tsmall-scoped unit\ttests\tfall\tinto\tthis\tcategory\t—\tall\ttypically\tautomated.\tThis\tis\tcompared\twith\tthe\ttop half\tof\tthe\tquadrant,\twhere\ttests\thelp\tthe\tnontechnical\tstakeholders\tunderstand\thow\tyour system\tworks.\tThese\tcould\tbe\tlarge-scoped,\tend-to-end\ttests,\tas\tshown\tin\tthe\ttop-left Acceptance\tTest\tsquare,\tor\tmanual\ttesting\tas\ttypified\tby\tuser\ttesting\tdone\tagainst\ta\tUAT system,\tas\tshown\tin\tthe\tExploratory\tTesting\tsquare.\n\nEach\ttype\tof\ttest\tshown\tin\tthis\tquadrant\thas\ta\tplace.\tExactly\thow\tmuch\tof\teach\ttest\tyou want\tto\tdo\twill\tdepend\ton\tthe\tnature\tof\tyour\tsystem,\tbut\tthe\tkey\tpoint\tto\tunderstand\tis that\tyou\thave\tmultiple\tchoices\tin\tterms\tof\thow\tto\ttest\tyour\tsystem.\tThe\ttrend\trecently\thas been\taway\tfrom\tany\tlarge-scale\tmanual\ttesting,\tin\tfavor\tof\tautomating\tas\tmuch\tas possible,\tand\tI\tcertainly\tagree\twith\tthis\tapproach.\tIf\tyou\tcurrently\tcarry\tout\tlarge\tamounts of\tmanual\ttesting,\tI\twould\tsuggest\tyou\taddress\tthat\tbefore\tproceeding\ttoo\tfar\tdown\tthe path\tof\tmicroservices,\tas\tyou\twon’t\tget\tmany\tof\ttheir\tbenefits\tif\tyou\tare\tunable\tto\tvalidate your\tsoftware\tquickly\tand\tefficiently.\n\nFor\tthe\tpurposes\tof\tthis\tchapter,\twe\twill\tignore\tmanual\ttesting.\tAlthough\tthis\tsort\tof testing\tcan\tbe\tvery\tuseful\tand\tcertainly\thas\tits\tpart\tto\tplay,\tthe\tdifferences\twith\ttesting\ta microservice\tarchitecture\tmostly\tplay\tout\tin\tthe\tcontext\tof\tvarious\ttypes\tof\tautomated tests,\tso\tthat\tis\twhere\twe\twill\tfocus\tour\ttime.",
      "content_length": 2233,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 233,
      "content": "But\twhen\tit\tcomes\tto\tautomated\ttests,\thow\tmany\tof\teach\ttest\tdo\twe\twant?\tAnother\tmodel will\tcome\tin\tvery\thandy\tto\thelp\tus\tanswer\tthis\tquestion,\tand\tunderstand\twhat\tthe\tdifferent trade-offs\tmight\tbe.",
      "content_length": 197,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 234,
      "content": "Test\tScope\n\nIn\this\tbook\tSucceeding\twith\tAgile\t(Addison-Wesley),\tMike\tCohn\toutlines\ta\tmodel\tcalled the\tTest\tPyramid\tto\thelp\texplain\twhat\ttypes\tof\tautomated\ttests\tyou\tneed.\tThe\tpyramid helps\tus\tthink\tabout\tthe\tscopes\tthe\ttests\tshould\tcover,\tbut\talso\tthe\tproportions\tof\tdifferent types\tof\ttests\twe\tshould\taim\tfor.\tCohn’s\toriginal\tmodel\tsplit\tautomated\ttests\tinto\tUnit, Service,\tand\tUI,\twhich\tyou\tcan\tsee\tin\tFigure\t7-2.\n\nFigure\t7-2.\tMike\tCohn’s\tTest\tPyramid.\tCohn,\tMike,\tSucceeding\twith\tAgile:\tSoftware\tDevelopment\tUsing\tScrum,\t1st Edition,\t©\t2010.\tAdapted\tby\tpermission\tof\tPearson\tEducation,\tInc.,\tUpper\tSaddle\tRiver,\tNJ.\n\nThe\tproblem\twith\tthis\tmodel\tis\tthat\tall\tthese\tterms\tmean\tdifferent\tthings\tto\tdifferent people.\t“Service”\tis\tespecially\toverloaded,\tand\tthere\tare\tmany\tdefinitions\tof\ta\tunit\ttest\tout there.\tIs\ta\ttest\ta\tunit\ttest\tif\tI\tonly\ttest\tone\tline\tof\tcode?\tI’d\tsay\tyes.\tIs\tit\tstill\ta\tunit\ttest\tif\tI test\tmultiple\tfunctions\tor\tclasses?\tI’d\tsay\tno,\tbut\tmany\twould\tdisagree!\tI\ttend\tto\tstick with\tthe\tUnit\tand\tService\tnames\tdespite\ttheir\tambiguity,\tbut\tmuch\tprefer\tcalling\tUI\ttests end-to-end\ttests,\twhich\twe’ll\tdo\tfrom\tnow\ton.\n\nGiven\tthe\tconfusion,\tit’s\tworth\tus\tlooking\tat\twhat\tthese\tdifferent\tlayers\tmean.\n\nLet’s\tlook\tat\ta\tworked\texample.\tIn\tFigure\t7-3,\twe\thave\tour\thelpdesk\tapplication\tand\tour main\twebsite,\tboth\tof\twhich\tare\tinteracting\twith\tour\tcustomer\tservice\tto\tretrieve,\treview, and\tedit\tcustomer\tdetails.\tOur\tcustomer\tservice\tin\tturn\tis\ttalking\tto\tour\tloyalty\tpoints bank,\twhere\tour\tcustomers\taccrue\tpoints\tby\tbuying\tJustin\tBieber\tCDs.\tProbably.\tThis\tis obviously\ta\tsliver\tof\tour\toverall\tmusic\tshop\tsystem,\tbut\tit\tis\ta\tgood\tenough\tslice\tfor\tus\tto",
      "content_length": 1659,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 235,
      "content": "dive\tinto\ta\tfew\tdifferent\tscenarios\twe\tmay\twant\tto\ttest.\n\nFigure\t7-3.\tPart\tof\tour\tmusic\tshop\tunder\ttest",
      "content_length": 103,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 236,
      "content": "Unit\tTests\n\nThese\tare\ttests\tthat\ttypically\ttest\ta\tsingle\tfunction\tor\tmethod\tcall.\tThe\ttests\tgenerated\tas\ta side\teffect\tof\ttest-driven\tdesign\t(TDD)\twill\tfall\tinto\tthis\tcategory,\tas\tdo\tthe\tsorts\tof\ttests generated\tby\ttechniques\tsuch\tas\tproperty-based\ttesting.\tWe’re\tnot\tlaunching\tservices\there, and\tare\tlimiting\tthe\tuse\tof\texternal\tfiles\tor\tnetwork\tconnections.\tIn\tgeneral,\tyou\twant\ta large\tnumber\tof\tthese\tsorts\tof\ttests.\tDone\tright,\tthey\tare\tvery,\tvery\tfast,\tand\ton\tmodern hardware\tyou\tcould\texpect\tto\trun\tmany\tthousands\tof\tthese\tin\tless\tthan\ta\tminute.\n\nThese\tare\ttests\tthat\thelp\tus\tdevelopers\tand\tso\twould\tbe\ttechnology-facing,\tnot\tbusiness- facing,\tin\tMarick’s\tterminology.\tThey\tare\talso\twhere\twe\thope\tto\tcatch\tmost\tof\tour\tbugs. So,\tin\tour\texample,\twhen\twe\tthink\tabout\tthe\tcustomer\tservice,\tunit\ttests\twould\tcover small\tparts\tof\tthe\tcode\tin\tisolation,\tas\tshown\tin\tFigure\t7-4.\n\nFigure\t7-4.\tScope\tof\tunit\ttests\ton\tour\texample\tsystem\n\nThe\tprime\tgoal\tof\tthese\ttests\tis\tto\tgive\tus\tvery\tfast\tfeedback\tabout\twhether\tour functionality\tis\tgood.\tTests\tcan\tbe\timportant\tto\tsupport\trefactoring\tof\tcode,\tallowing\tus\tto restructure\tour\tcode\tas\twe\tgo,\tknowing\tthat\tour\tsmall-scoped\ttests\twill\tcatch\tus\tif\twe make\ta\tmistake.",
      "content_length": 1210,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 237,
      "content": "Service\tTests\n\nService\ttests\tare\tdesigned\tto\tbypass\tthe\tuser\tinterface\tand\ttest\tservices\tdirectly.\tIn\ta monolithic\tapplication,\twe\tmight\tjust\tbe\ttesting\ta\tcollection\tof\tclasses\tthat\tprovide\ta service\tto\tthe\tUI.\tFor\ta\tsystem\tcomprising\ta\tnumber\tof\tservices,\ta\tservice\ttest\twould\ttest an\tindividual\tservice’s\tcapabilities.\n\nThe\treason\twe\twant\tto\ttest\ta\tsingle\tservice\tby\titself\tis\tto\timprove\tthe\tisolation\tof\tthe\ttest to\tmake\tfinding\tand\tfixing\tproblems\tfaster.\tTo\tachieve\tthis\tisolation,\twe\tneed\tto\tstub\tout all\texternal\tcollaborators\tso\tonly\tthe\tservice\titself\tis\tin\tscope,\tas\tFigure\t7-5\tshows.\n\nFigure\t7-5.\tScope\tof\tservice\ttests\ton\tour\texample\tsystem\n\nSome\tof\tthese\ttests\tcould\tbe\tas\tfast\tas\tsmall\ttests,\tbut\tif\tyou\tdecide\tto\ttest\tagainst\ta\treal database,\tor\tgo\tover\tnetworks\tto\tstubbed\tdownstream\tcollaborators,\ttest\ttimes\tcan increase.\tThey\talso\tcover\tmore\tscope\tthan\ta\tsimple\tunit\ttest,\tso\tthat\twhen\tthey\tfail\tit\tcan be\tharder\tto\tdetect\twhat\tis\tbroken\tthan\twith\ta\tunit\ttest.\tHowever,\tthey\thave\tmuch\tfewer moving\tparts\tand\tare\ttherefore\tless\tbrittle\tthan\tlarger-scoped\ttests.",
      "content_length": 1079,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 238,
      "content": "End-to-End\tTests\n\nEnd-to-end\ttests\tare\ttests\trun\tagainst\tyour\tentire\tsystem.\tOften\tthey\twill\tbe\tdriving\ta\tGUI through\ta\tbrowser,\tbut\tcould\teasily\tbe\tmimicking\tother\tsorts\tof\tuser\tinteraction,\tlike uploading\ta\tfile.\n\nThese\ttests\tcover\ta\tlot\tof\tproduction\tcode,\tas\twe\tsee\tin\tFigure\t7-6\t.\tSo\twhen\tthey\tpass, you\tfeel\tgood:\tyou\thave\ta\thigh\tdegree\tof\tconfidence\tthat\tthe\tcode\tbeing\ttested\twill\twork in\tproduction.\tBut\tthis\tincreased\tscope\tcomes\twith\tdownsides,\tand\tas\twe’ll\tsee\tshortly, they\tcan\tbe\tvery\ttricky\tto\tdo\twell\tin\ta\tmicroservices\tcontext.\n\nFigure\t7-6.\tScope\tof\tend-to-end\ttests\ton\tour\texample\tsystem",
      "content_length": 605,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 239,
      "content": "Trade-Offs\n\nWhen\tyou’re\treading\tthe\tpyramid,\tthe\tkey\tthing\tto\ttake\taway\tis\tthat\tas\tyou\tgo\tup\tthe pyramid,\tthe\ttest\tscope\tincreases,\tas\tdoes\tour\tconfidence\tthat\tthe\tfunctionality\tbeing tested\tworks.\tOn\tthe\tother\thand,\tthe\tfeedback\tcycle\ttime\tincreases\tas\tthe\ttests\ttake\tlonger to\trun,\tand\twhen\ta\ttest\tfails\tit\tcan\tbe\tharder\tto\tdetermine\twhich\tfunctionality\thas\tbroken. As\tyou\tgo\tdown\tthe\tpyramid,\tin\tgeneral\tthe\ttests\tbecome\tmuch\tfaster,\tso\twe\tget\tmuch faster\tfeedback\tcycles.\tWe\tfind\tbroken\tfunctionality\tfaster,\tour\tcontinuous\tintegration builds\tare\tfaster,\tand\twe\tare\tless\tlikely\tto\tmove\ton\tto\ta\tnew\ttask\tbefore\tfinding\tout\twe have\tbroken\tsomething.\tWhen\tthose\tsmaller-scoped\ttests\tfail,\twe\talso\ttend\tto\tknow\twhat broke,\toften\texactly\twhat\tline\tof\tcode.\tOn\tthe\tflipside,\twe\tdon’t\tget\ta\tlot\tof\tconfidence that\tour\tsystem\tas\ta\twhole\tworks\tif\twe’ve\tonly\ttested\tone\tline\tof\tcode!\n\nWhen\tbroader-scoped\ttests\tlike\tour\tservice\tor\tend-to-end\ttests\tfail,\twe\twill\ttry\tto\twrite\ta fast\tunit\ttest\tto\tcatch\tthat\tproblem\tin\tthe\tfuture.\tIn\tthat\tway,\twe\tare\tconstantly\ttrying\tto improve\tour\tfeedback\tcycles.\n\nVirtually\tevery\tteam\tI’ve\tworked\ton\thas\tused\tdifferent\tnames\tthan\tthe\tones\tthat\tCohn uses\tin\tthe\tpyramid.\tWhatever\tyou\tcall\tthem,\tthe\tkey\ttakeaway\tis\tthat\tyou\twill\twant\ttests of\tdifferent\tscope\tfor\tdifferent\tpurposes.",
      "content_length": 1311,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 240,
      "content": "How\tMany?\n\nSo\tif\tthese\ttests\tall\thave\ttrade-offs,\thow\tmany\tof\teach\ttype\tdo\tyou\twant?\tA\tgood\trule\tof thumb\tis\tthat\tyou\tprobably\twant\tan\torder\tof\tmagnitude\tmore\ttests\tas\tyou\tdescend\tthe pyramid,\tbut\tthe\timportant\tthing\tis\tknowing\tthat\tyou\tdo\thave\tdifferent\ttypes\tof\tautomated tests\tand\tunderstanding\tif\tyour\tcurrent\tbalance\tgives\tyou\ta\tproblem!\n\nI\tworked\ton\tone\tmonolithic\tsystem,\tfor\texample,\twhere\twe\thad\t4,000\tunit\ttests,\t1,000 service\ttests,\tand\t60\tend-to-end\ttests.\tWe\tdecided\tthat\tfrom\ta\tfeedback\tpoint\tof\tview\twe had\tway\ttoo\tmany\tservice\tand\tend-to-end\ttests\t(the\tlatter\tof\twhich\twere\tthe\tworst offenders\tin\timpacting\tfeedback\tloops),\tso\twe\tworked\thard\tto\treplace\tthe\ttest\tcoverage with\tsmaller-scoped\ttests.\n\nA\tcommon\tanti-pattern\tis\twhat\tis\toften\treferred\tto\tas\ta\ttest\tsnow\tcone,\tor\tinverted pyramid.\tHere,\tthere\tare\tlittle\tto\tno\tsmall-scoped\ttests,\twith\tall\tthe\tcoverage\tin\tlarge- scoped\ttests.\tThese\tprojects\toften\thave\tglacially\tslow\ttest\truns,\tand\tvery\tlong\tfeedback cycles.\tIf\tthese\ttests\tare\trun\tas\tpart\tof\tcontinuous\tintegration,\tyou\twon’t\tget\tmany\tbuilds, and\tthe\tnature\tof\tthe\tbuild\ttimes\tmeans\tthat\tthe\tbuild\tcan\tstay\tbroken\tfor\ta\tlong\tperiod when\tsomething\tdoes\tbreak.",
      "content_length": 1186,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 241,
      "content": "Implementing\tService\tTests\n\nImplementing\tunit\ttests\tis\ta\tfairly\tsimple\taffair\tin\tthe\tgrand\tscheme\tof\tthings,\tand\tthere\tis plenty\tof\tdocumentation\tout\tthere\texplaining\thow\tto\twrite\tthem.\tThe\tservice\tand\tend-to- end\ttests\tare\tthe\tones\tthat\tare\tmore\tinteresting.\n\nOur\tservice\ttests\twant\tto\ttest\ta\tslice\tof\tfunctionality\tacross\tthe\twhole\tservice,\tbut\tto isolate\tourselves\tfrom\tother\tservices\twe\tneed\tto\tfind\tsome\tway\tto\tstub\tout\tall\tof\tour collaborators.\tSo,\tif\twe\twanted\tto\twrite\ta\ttest\tlike\tthis\tfor\tthe\tcustomer\tservice\tfrom Figure\t7-3,\twe\twould\tdeploy\tan\tinstance\tof\tthe\tcustomer\tservice,\tand\tas\tdiscussed\tearlier we\twould\twant\tto\tstub\tout\tany\tdownstream\tservices.\n\nOne\tof\tthe\tfirst\tthings\tour\tcontinuous\tintegration\tbuild\twill\tdo\tis\tcreate\ta\tbinary\tartifact for\tour\tservice,\tso\tdeploying\tthat\tis\tpretty\tstraightforward.\tBut\thow\tdo\twe\thandle\tfaking the\tdownstream\tcollaborators?\n\nOur\tservice\ttest\tsuite\tneeds\tto\tlaunch\tstub\tservices\tfor\tany\tdownstream\tcollaborators\t(or ensure\tthey\tare\trunning),\tand\tconfigure\tthe\tservice\tunder\ttest\tto\tconnect\tto\tthe\tstub services.\tWe\tthen\tneed\tto\tconfigure\tthe\tstubs\tto\tsend\tresponses\tback\tto\tmimic\tthe\treal- world\tservices.\tFor\texample,\twe\tmight\tconfigure\tthe\tstub\tfor\tthe\tloyalty\tpoints\tbank\tto return\tknown\tpoints\tbalances\tfor\tcertain\tcustomers.",
      "content_length": 1283,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 242,
      "content": "Mocking\tor\tStubbing\n\nWhen\tI\ttalk\tabout\tstubbing\tdownstream\tcollaborators,\tI\tmean\tthat\twe\tcreate\ta\tstub\tservice that\tresponds\twith\tcanned\tresponses\tto\tknown\trequests\tfrom\tthe\tservice\tunder\ttest.\tFor example,\tI\tmight\ttell\tmy\tstub\tpoints\tbank\tthat\twhen\tasked\tfor\tthe\tbalance\tof\tcustomer 123,\tit\tshould\treturn\t15,000.\tThe\ttest\tdoesn’t\tcare\tif\tthe\tstub\tis\tcalled\t0,\t1,\tor\t100\ttimes.\tA variation\ton\tthis\tis\tto\tuse\ta\tmock\tinstead\tof\ta\tstub.\n\nWhen\tusing\ta\tmock,\tI\tactually\tgo\tfurther\tand\tmake\tsure\tthe\tcall\twas\tmade.\tIf\tthe\texpected call\tis\tnot\tmade,\tthe\ttest\tfails.\tImplementing\tthis\tapproach\trequires\tmore\tsmarts\tin\tthe fake\tcollaborators\tthat\twe\tcreate,\tand\tif\toverused\tcan\tcause\ttests\tto\tbecome\tbrittle.\tAs noted,\thowever,\ta\tstub\tdoesn’t\tcare\tif\tit\tis\tcalled\t0,\t1,\tor\tmany\ttimes.\n\nSometimes,\tthough,\tmocks\tcan\tbe\tvery\tuseful\tto\tensure\tthat\tthe\texpected\tside\teffects happen.\tFor\texample,\tI\tmight\twant\tto\tcheck\tthat\twhen\tI\tcreate\ta\tcustomer,\ta\tnew\tpoints balance\tis\tset\tup\tfor\tthat\tcustomer.\tThe\tbalance\tbetween\tstubbing\tand\tmocking\tcalls\tis\ta delicate\tone,\tand\tis\tjust\tas\tfraught\tin\tservice\ttests\tas\tin\tunit\ttests.\tIn\tgeneral,\tthough,\tI\tuse stubs\tfar\tmore\tthan\tmocks\tfor\tservice\ttests.\tFor\ta\tmore\tin-depth\tdiscussion\tof\tthis\ttrade- off,\ttake\ta\tlook\tat\tGrowing\tObject-Oriented\tSoftware,\tGuided\tby\tTests,\tby\tSteve\tFreeman and\tNat\tPryce\t(Addison-Wesley).\n\nIn\tgeneral,\tI\trarely\tuse\tmocks\tfor\tthis\tsort\tof\ttesting.\tBut\thaving\ta\ttool\tthat\tcan\tdo\tboth\tis useful.\n\nWhile\tI\tfeel\tthat\tstubs\tand\tmocks\tare\tactually\tfairly\twell\tdifferentiated,\tI\tknow\tthe distinction\tcan\tbe\tconfusing\tto\tsome,\tespecially\twhen\tsome\tpeople\tthrow\tin\tother\tterms like\tfakes,\tspies,\tand\tdummies.\tMartin\tFowler\tcalls\tall\tof\tthese\tthings,\tincluding\tstubs\tand mocks,\ttest\tdoubles.",
      "content_length": 1738,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 243,
      "content": "A\tSmarter\tStub\tService\n\nNormally\tfor\tstub\tservices\tI’ve\trolled\tthem\tmyself.\tI’ve\tused\teverything\tfrom\tApache\tor Nginx\tto\tembedded\tJetty\tcontainers\tor\teven\tcommand-line-launched\tPython\tweb\tservers used\tto\tlaunch\tstub\tservers\tfor\tsuch\ttest\tcases.\tI’ve\tprobably\treproduced\tthe\tsame\twork time\tand\ttime\tagain\tin\tcreating\tthese\tstubs.\tMy\tThoughtWorks\tcolleague\tBrandon\tBryars has\tpotentially\tsaved\tmany\tof\tus\ta\tchunk\tof\twork\twith\this\tstub/mock\tserver\tcalled Mountebank.\n\nYou\tcan\tthink\tof\tMountebank\tas\ta\tsmall\tsoftware\tappliance\tthat\tis\tprogrammable\tvia HTTP.\tThe\tfact\tthat\tit\thappens\tto\tbe\twritten\tin\tNodeJS\tis\tcompletely\topaque\tto\tany calling\tservice.\tWhen\tit\tlaunches,\tyou\tsend\tit\tcommands\ttelling\tit\twhat\tport\tto\tstub\ton, what\tprotocol\tto\thandle\t(currently\tTCP,\tHTTP,\tand\tHTTPS\tare\tsupported,\twith\tmore planned),\tand\twhat\tresponses\tit\tshould\tsend\twhen\trequests\tare\tsent.\tIt\talso\tsupports setting\texpectations\tif\tyou\twant\tto\tuse\tit\tas\ta\tmock.\tYou\tcan\tadd\tor\tremove\tthese\tstub endpoints\tat\twill,\tmaking\tit\tpossible\tfor\ta\tsingle\tMountebank\tinstance\tto\tstub\tmore\tthan one\tdownstream\tdependency.\n\nSo,\tif\twe\twant\tto\trun\tour\tservice\ttests\tfor\tjust\tour\tcustomer\tservice\twe\tcan\tlaunch\tthe customer\tservice,\tand\ta\tMountebank\tinstance\tthat\tacts\tas\tour\tloyalty\tpoints\tbank.\tAnd\tif those\ttests\tpass,\tI\tcan\tdeploy\tthe\tcustomer\tservice\tstraightaway!\tOr\tcan\tI?\tWhat\tabout\tthe services\tthat\tcall\tthe\tcustomer\tservice\t—\tthe\thelpdesk\tand\tthe\tweb\tshop?\tDo\twe\tknow\tif we\thave\tmade\ta\tchange\tthat\tmay\tbreak\tthem?\tOf\tcourse,\twe\thave\tforgotten\tthe\timportant tests\tat\tthe\ttop\tof\tthe\tpyramid:\tthe\tend-to-end\ttests.",
      "content_length": 1585,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 244,
      "content": "Those\tTricky\tEnd-to-End\tTests\n\nIn\ta\tmicroservice\tsystem,\tthe\tcapabilities\twe\texpose\tvia\tour\tuser\tinterfaces\tare\tdelivered by\ta\tnumber\tof\tservices.\tThe\tpoint\tof\tthe\tend-to-end\ttests\tas\toutlined\tin\tMike\tCohn’s pyramid\tis\tto\tdrive\tfunctionality\tthrough\tthese\tuser\tinterfaces\tagainst\teverything underneath\tto\tgive\tus\tan\toverview\tof\ta\tlarge\tamount\tof\tour\tsystem.\n\nSo,\tto\timplement\tan\tend-to-end\ttest\twe\tneed\tto\tdeploy\tmultiple\tservices\ttogether,\tthen\trun a\ttest\tagainst\tall\tof\tthem.\tObviously,\tthis\ttest\thas\tmuch\tmore\tscope,\tresulting\tin\tmore confidence\tthat\tour\tsystem\tworks!\tOn\tthe\tother\thand,\tthese\ttests\tare\tliable\tto\tbe\tslower and\tmake\tit\tharder\tto\tdiagnose\tfailure.\tLet’s\tdig\tinto\tthem\ta\tbit\tmore\tusing\tour\tprevious example\tto\tsee\thow\tthese\ttests\tcan\tfit\tin.\n\nImagine\twe\twant\tto\tpush\tout\ta\tnew\tversion\tof\tthe\tcustomer\tservice.\tWe\twant\tto\tdeploy our\tchanges\tinto\tproduction\tas\tsoon\tas\tpossible,\tbut\tare\tconcerned\tthat\twe\tmay\thave introduced\ta\tchange\tthat\tcould\tbreak\teither\tthe\thelpdesk\tor\tthe\tweb\tshop.\tNo\tproblem\t— let’s\tdeploy\tall\tof\tour\tservices\ttogether,\tand\trun\tsome\ttests\tagainst\tthe\thelpdesk\tand\tweb shop\tto\tsee\tif\twe’ve\tintroduced\ta\tbug.\tNow\ta\tnaive\tapproach\twould\tbe\tto\tjust\tadd\tthese tests\tonto\tthe\tend\tof\tour\tcustomer\tservice\tpipeline,\tas\tin\tFigure\t7-7.\n\nFigure\t7-7.\tAdding\tour\tend-to-end\ttests\tstage:\tthe\tright\tapproach?\n\nSo\tfar,\tso\tgood.\tBut\tthe\tfirst\tquestion\twe\thave\tto\task\tourselves\tis\twhich\tversion\tof\tthe other\tservices\tshould\twe\tuse?\tShould\twe\trun\tour\ttests\tagainst\tthe\tversions\tof\thelpdesk\tand web\tshop\tthat\tare\tin\tproduction?\tIt’s\ta\tsensible\tassumption,\tbut\twhat\tif\tthere\tis\ta\tnew version\tof\teither\tthe\thelpdesk\tor\tweb\tshop\tqueued\tup\tto\tgo\tlive;\twhat\tshould\twe\tdo\tthen?\n\nAnother\tproblem:\tif\twe\thave\ta\tset\tof\tcustomer\tservice\ttests\tthat\tdeploy\tlots\tof\tservices and\trun\ttests\tagainst\tthem,\twhat\tabout\tthe\tend-to-end\ttests\tthat\tthe\tother\tservices\trun?\tIf they\tare\ttesting\tthe\tsame\tthing,\twe\tmay\tfind\tourselves\tcovering\tlots\tof\tthe\tsame\tground, and\tmay\tduplicate\ta\tlot\tof\tthe\teffort\tto\tdeploy\tall\tthose\tservices\tin\tthe\tfirst\tplace.\n\nWe\tcan\tdeal\twith\tboth\tof\tthese\tproblems\telegantly\tby\thaving\tmultiple\tpipelines\tfan\tin\tto\ta single,\tend-to-end\ttest\tstage.\tHere,\twhenever\ta\tnew\tbuild\tof\tone\tof\tour\tservices\tis triggered,\twe\trun\tour\tend-to-end\ttests,\tan\texample\tof\twhich\twe\tcan\tsee\tin\tFigure\t7-8. Some\tCI\ttools\twith\tbetter\tbuild\tpipeline\tsupport\twill\tenable\tfan-in\tmodels\tlike\tthis\tout\tof the\tbox.",
      "content_length": 2412,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 245,
      "content": "Figure\t7-8.\tA\tstandard\tway\tto\thandle\tend-to-end\ttests\tacross\tservices\n\nSo\tany\ttime\tany\tof\tour\tservices\tchanges,\twe\trun\tthe\ttests\tlocal\tto\tthat\tservice.\tIf\tthose tests\tpass,\twe\ttrigger\tour\tintegration\ttests.\tGreat,\teh?\tWell,\tthere\tare\ta\tfew\tproblems.",
      "content_length": 249,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 246,
      "content": "Downsides\tto\tEnd-to-End\tTesting\n\nThere\tare,\tunfortunately,\tmany\tdisadvantages\tto\tend-to-end\ttesting.",
      "content_length": 100,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 247,
      "content": "Flaky\tand\tBrittle\tTests\n\nAs\ttest\tscope\tincreases,\tso\ttoo\tdo\tthe\tnumber\tof\tmoving\tparts.\tThese\tmoving\tparts\tcan introduce\ttest\tfailures\tthat\tdo\tnot\tshow\tthat\tthe\tfunctionality\tunder\ttest\tis\tbroken,\tbut\tthat some\tother\tproblem\thas\toccurred.\tAs\tan\texample,\tif\twe\thave\ta\ttest\tto\tverify\tthat\twe\tcan place\tan\torder\tfor\ta\tsingle\tCD,\tbut\twe\tare\trunning\tthat\ttest\tagainst\tfour\tor\tfive\tservices,\tif any\tof\tthem\tis\tdown\twe\tcould\tget\ta\tfailure\tthat\thas\tnothing\tto\tdo\twith\tthe\tnature\tof\tthe test\titself.\tLikewise,\ta\ttemporary\tnetwork\tglitch\tcould\tcause\ta\ttest\tto\tfail\twithout\tsaying anything\tabout\tthe\tfunctionality\tunder\ttest.\n\nThe\tmore\tmoving\tparts,\tthe\tmore\tbrittle\tour\ttests\tmay\tbe,\tand\tthe\tless\tdeterministic\tthey are.\tIf\tyou\thave\ttests\tthat\tsometimes\tfail,\tbut\teveryone\tjust\tre-runs\tthem\tbecause\tthey\tmay pass\tagain\tlater,\tthen\tyou\thave\tflaky\ttests.\tIt\tisn’t\tonly\ttests\tcovering\tlots\tof\tdifferent process\tthat\tare\tthe\tculprit\there.\tTests\tthat\tcover\tfunctionality\tbeing\texercised\ton\tmultiple threads\tare\toften\tproblematic,\twhere\ta\tfailure\tcould\tmean\ta\trace\tcondition,\ta\ttimeout,\tor that\tthe\tfunctionality\tis\tactually\tbroken.\tFlaky\ttests\tare\tthe\tenemy.\tWhen\tthey\tfail,\tthey don’t\ttell\tus\tmuch.\tWe\tre-run\tour\tCI\tbuilds\tin\tthe\thope\tthat\tthey\twill\tpass\tagain\tlater,\tonly to\tsee\tcheck-ins\tpile\tup,\tand\tsuddenly\twe\tfind\tourselves\twith\ta\tload\tof\tbroken functionality.\n\nWhen\twe\tdetect\tflaky\ttests,\tit\tis\tessential\tthat\twe\tdo\tour\tbest\tto\tremove\tthem.\tOtherwise, we\tstart\tto\tlose\tfaith\tin\ta\ttest\tsuite\tthat\t“always\tfails\tlike\tthat.”\tA\ttest\tsuite\twith\tflaky\ttests can\tbecome\ta\tvictim\tof\twhat\tDiane\tVaughan\tcalls\tthe\tnormalization\tof\tdeviance\t—\tthe idea\tthat\tover\ttime\twe\tcan\tbecome\tso\taccustomed\tto\tthings\tbeing\twrong\tthat\twe\tstart\tto accept\tthem\tas\tbeing\tnormal\tand\tnot\ta\tproblem.2\tThis\tvery\thuman\ttendency\tmeans\twe need\tto\tfind\tand\teliminate\tthese\ttests\tas\tsoon\tas\twe\tcan\tbefore\twe\tstart\tto\tassume\tthat failing\ttests\tare\tOK.\n\nIn\t“Eradicating\tNon-Determinism\tin\tTests”,\tMartin\tFowler\tadvocates\tthe\tapproach\tthat\tif you\thave\tflaky\ttests,\tyou\tshould\ttrack\tthem\tdown\tand\tif\tyou\tcan’t\timmediately\tfix\tthem, remove\tthem\tfrom\tthe\tsuite\tso\tyou\tcan\ttreat\tthem.\tSee\tif\tyou\tcan\trewrite\tthem\tto\tavoid testing\tcode\trunning\ton\tmultiple\tthreads.\tSee\tif\tyou\tcan\tmake\tthe\tunderlying\tenvironment more\tstable.\tBetter\tyet,\tsee\tif\tyou\tcan\treplace\tthe\tflaky\ttest\twith\ta\tsmaller-scoped\ttest\tthat is\tless\tlikely\tto\texhibit\tproblems.\tIn\tsome\tcases,\tchanging\tthe\tsoftware\tunder\ttest\tto\tmake it\teasier\tto\ttest\tcan\talso\tbe\tthe\tright\tway\tforward.",
      "content_length": 2500,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 248,
      "content": "Who\tWrites\tThese\tTests?\n\nWith\tthe\ttests\tthat\trun\tas\tpart\tof\tthe\tpipeline\tfor\ta\tspecific\tservice,\tthe\tsensible\tstarting point\tis\tthat\tthe\tteam\tthat\towns\tthat\tservice\tshould\twrite\tthose\ttests\t(we’ll\ttalk\tmore\tabout service\townership\tin\tChapter\t10).\tBut\tif\twe\tconsider\tthat\twe\tmight\thave\tmultiple\tteams involved,\tand\tthe\tend-to-end-tests\tstep\tis\tnow\teffectively\tshared\tbetween\tthe\tteams,\twho writes\tand\tlooks\tafter\tthese\ttests?\n\nI\thave\tseen\ta\tnumber\tof\tanti-patterns\tcaused\there.\tThese\ttests\tbecome\ta\tfree-for-all,\twith all\tteams\tgranted\taccess\tto\tadd\ttests\twithout\tany\tunderstanding\tof\tthe\thealth\tof\tthe\twhole suite.\tThis\tcan\toften\tresult\tin\tan\texplosion\tof\ttest\tcases,\tsometimes\tresulting\tin\tthe\ttest snow\tcone\twe\ttalked\tabout\tearlier.\tI\thave\tseen\tsituations\twhere,\tbecause\tthere\twas\tno\treal obvious\townership\tof\tthese\ttests,\ttheir\tresults\tget\tignored.\tWhen\tthey\tbreak,\teveryone assumes\tit\tis\tsomeone\telse’s\tproblem,\tso\tthey\tdon’t\tcare\twhether\tthe\ttests\tare\tpassing.\n\nSometimes\torganizations\treact\tby\thaving\ta\tdedicated\tteam\twrite\tthese\ttests.\tThis\tcan\tbe disastrous.\tThe\tteam\tdeveloping\tthe\tsoftware\tbecomes\tincreasingly\tdistant\tfrom\tthe\ttests for\tits\tcode.\tCycle\ttimes\tincrease,\tas\tservice\towners\tend\tup\twaiting\tfor\tthe\ttest\tteam\tto write\tend-to-end\ttests\tfor\tthe\tfunctionality\tthey\tjust\twrote.\tBecause\tanother\tteam\twrites these\ttests,\tthe\tteam\tthat\twrote\tthe\tservice\tis\tless\tinvolved\twith,\tand\ttherefore\tless\tlikely to\tknow,\thow\tto\trun\tand\tfix\tthese\ttests.\tAlthough\tit\tis\tunfortunately\tstill\ta\tcommon organizational\tpattern,\tI\tsee\tsignificant\tharm\tdone\twhenever\ta\tteam\tis\tdistanced\tfrom writing\ttests\tfor\tthe\tcode\tit\twrote\tin\tthe\tfirst\tplace.\n\nGetting\tthis\taspect\tright\tis\treally\thard.\tWe\tdon’t\twant\tto\tduplicate\teffort,\tnor\tdo\twe\twant to\tcompletely\tcentralize\tthis\tto\tthe\textent\tthat\tthe\tteams\tbuilding\tservices\tare\ttoo\tfar removed\tfrom\tthings.\tThe\tbest\tbalance\tI\thave\tfound\tis\tto\ttreat\tthe\tend-to-end\ttest\tsuite\tas a\tshared\tcodebase,\tbut\twith\tjoint\townership.\tTeams\tare\tfree\tto\tcheck\tin\tto\tthis\tsuite,\tbut the\townership\tof\tthe\thealth\tof\tthe\tsuite\thas\tto\tbe\tshared\tbetween\tthe\tteams\tdeveloping\tthe services\tthemselves.\tIf\tyou\twant\tto\tmake\textensive\tuse\tof\tend-to-end\ttests\twith\tmultiple teams\tI\tthink\tthis\tapproach\tis\tessential,\tand\tyet\tI\thave\tseen\tit\tdone\tvery\trarely,\tand\tnever without\tissue.",
      "content_length": 2297,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 249,
      "content": "How\tLong?\n\nThese\tend-to-end\ttests\tcan\ttake\ta\twhile.\tI\thave\tseen\tthem\ttake\tup\tto\ta\tday\tto\trun,\tif\tnot more,\tand\ton\tone\tproject\tI\tworked\ton,\ta\tfull\tregression\tsuite\ttook\tsix\tweeks!\tI\trarely\tsee teams\tactually\tcurate\ttheir\tend-to-end\ttest\tsuites\tto\treduce\toverlap\tin\ttest\tcoverage,\tor spend\tenough\ttime\tin\tmaking\tthem\tfast.\n\nThis\tslowness,\tcombined\twith\tthe\tfact\tthat\tthese\ttests\tcan\toften\tbe\tflaky,\tcan\tbe\ta\tmajor problem.\tA\ttest\tsuite\tthat\ttakes\tall\tday\tand\toften\thas\tbreakages\tthat\thave\tnothing\tto\tdo with\tbroken\tfunctionality\tare\ta\tdisaster.\tEven\tif\tyour\tfunctionality\tis\tbroken,\tit\tcould\ttake you\tmany\thours\tto\tfind\tout\t—\tat\twhich\tpoint\tmany\tof\tus\twould\talready\thave\tmoved\ton\tto other\tactivities,\tand\tthe\tcontext\tswitch\tin\tshifting\tour\tbrains\tback\tto\tfix\tthe\tissue\tis painful.\n\nWe\tcan\tameliorate\tsome\tof\tthis\tby\trunning\ttests\tin\tparallel\t—\tfor\texample,\tmaking\tuse\tof tools\tlike\tSelenium\tGrid.\tHowever,\tthis\tapproach\tis\tnot\ta\tsubstitute\tfor\tactually understanding\twhat\tneeds\tto\tbe\ttested\tand\tactively\tremoving\ttests\tthat\tare\tno\tlonger needed.\n\nRemoving\ttests\tis\tsometimes\ta\tfraught\texercise,\tand\tI\tsuspect\tshares\tmuch\tin\tcommon with\tpeople\twho\twant\tto\tremove\tcertain\tairport\tsecurity\tmeasures.\tNo\tmatter\thow ineffective\tthe\tsecurity\tmeasures\tmight\tbe,\tany\tconversation\tabout\tremoving\tthem\tis\toften countered\twith\tknee-jerk\treactions\tabout\tnot\tcaring\tabout\tpeople’s\tsafety\tor\twanting terrorists\tto\twin.\tIt\tis\thard\tto\thave\ta\tbalanced\tconversation\tabout\tthe\tvalue\tsomething\tadds versus\tthe\tburden\tit\tentails.\tIt\tcan\talso\tbe\ta\tdifficult\trisk/reward\ttrade-off.\tDo\tyou\tget thanked\tif\tyou\tremove\ta\ttest?\tMaybe.\tBut\tyou’ll\tcertainly\tget\tblamed\tif\ta\ttest\tyou removed\tlets\ta\tbug\tthrough.\tWhen\tit\tcomes\tto\tthe\tlarger-scoped\ttest\tsuites,\thowever,\tthis is\texactly\twhat\twe\tneed\tto\tbe\table\tto\tdo.\tIf\tthe\tsame\tfeature\tis\tcovered\tin\t20\tdifferent tests,\tperhaps\twe\tcan\tget\trid\tof\thalf\tof\tthem,\tas\tthose\t20\ttests\ttake\t10\tminutes\tto\trun! What\tthis\trequires\tis\ta\tbetter\tunderstanding\tof\trisk,\twhich\tsomething\thumans\tare famously\tbad\tat.\tAs\ta\tresult,\tthis\tintelligent\tcuration\tand\tmanagement\tof\tlarger-scoped, high-burden\ttests\thappens\tincredibly\tinfrequently.\tWishing\tpeople\tdid\tthis\tmore\tisn’t\tthe same\tthing\tas\tmaking\tit\thappen.",
      "content_length": 2210,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 250,
      "content": "The\tGreat\tPile-up\n\nThe\tlong\tfeedback\tcycles\tassociated\twith\tend-to-end\ttests\taren’t\tjust\ta\tproblem\twhen\tit comes\tto\tdeveloper\tproductivity.\tWith\ta\tlong\ttest\tsuite,\tany\tbreaks\ttake\ta\twhile\tto\tfix, which\treduces\tthe\tamount\tof\ttime\tthat\tthe\tend-to-end\ttests\tcan\tbe\texpected\tto\tbe\tpassing. If\twe\tdeploy\tonly\tsoftware\tthat\thas\tpassed\tthrough\tall\tour\ttests\tsuccessfully\t(which\twe should!),\tthis\tmeans\tfewer\tof\tour\tservices\tget\tthrough\tto\tthe\tpoint\tof\tbeing\tdeployable into\tproduction.\n\nThis\tcan\tlead\tto\ta\tpile-up.\tWhile\ta\tbroken\tintegration\ttest\tstage\tis\tbeing\tfixed,\tmore changes\tfrom\tupstream\tteams\tcan\tpile\tin.\tAside\tfrom\tthe\tfact\tthat\tthis\tcan\tmake\tfixing\tthe build\tharder,\tit\tmeans\tthe\tscope\tof\tchanges\tto\tbe\tdeployed\tincreases.\tOne\tway\tto\tresolve this\tis\tto\tnot\tlet\tpeople\tcheck\tin\tif\tthe\tend-to-end\ttests\tare\tfailing,\tbut\tgiven\ta\tlong\ttest suite\ttime\tthis\tis\toften\timpractical.\tTry\tsaying,\t“You\t30\tdevelopers:\tno\tcheck-ins\ttil\twe\tfix this\tseven-hour-long\tbuild!”\n\nThe\tlarger\tthe\tscope\tof\ta\tdeployment\tand\tthe\thigher\tthe\trisk\tof\ta\trelease,\tthe\tmore\tlikely we\tare\tto\tbreak\tsomething.\tA\tkey\tdriver\tto\tensuring\twe\tcan\trelease\tour\tsoftware frequently\tis\tbased\ton\tthe\tidea\tthat\twe\trelease\tsmall\tchanges\tas\tsoon\tas\tthey\tare\tready.",
      "content_length": 1224,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 251,
      "content": "The\tMetaversion\n\nWith\tthe\tend-to-end\ttest\tstep,\tit\tis\teasy\tto\tstart\tthinking,\tSo,\tI\tknow\tall\tthese\tservices\tat these\tversions\twork\ttogether,\tso\twhy\tnot\tdeploy\tthem\tall\ttogether?\tThis\tvery\tquickly becomes\ta\tconversation\talong\tthe\tlines\tof,\tSo\twhy\tnot\tuse\ta\tversion\tnumber\tfor\tthe\twhole system?\tTo\tquote\tBrandon\tBryars,\t“Now\tyou\thave\t2.1.0\tproblems.”\n\nBy\tversioning\ttogether\tchanges\tmade\tto\tmultiple\tservices,\twe\teffectively\tembrace\tthe\tidea that\tchanging\tand\tdeploying\tmultiple\tservices\tat\tonce\tis\tacceptable.\tIt\tbecomes\tthe\tnorm, it\tbecomes\tOK.\tIn\tdoing\tso,\twe\tcede\tone\tof\tthe\tmain\tadvantages\tof\tmicroservices:\tthe ability\tto\tdeploy\tone\tservice\tby\titself,\tindependently\tof\tother\tservices.\n\nAll\ttoo\toften,\tthe\tapproach\tof\taccepting\tmultiple\tservices\tbeing\tdeployed\ttogether\tdrifts into\ta\tsituation\twhere\tservices\tbecome\tcoupled.\tBefore\tlong,\tnicely\tseparate\tservices become\tincreasingly\ttangled\twith\tothers,\tand\tyou\tnever\tnotice\tas\tyou\tnever\ttry\tto\tdeploy them\tby\tthemselves.\tYou\tend\tup\twith\ta\ttangled\tmess\twhere\tyou\thave\tto\torchestrate\tthe deployment\tof\tmultiple\tservices\tat\tonce,\tand\tas\twe\tdiscussed\tpreviously,\tthis\tsort\tof coupling\tcan\tleave\tus\tin\ta\tworse\tplace\tthan\twe\twould\tbe\twith\ta\tsingle,\tmonolithic application.\n\nThis\tis\tbad.",
      "content_length": 1234,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 252,
      "content": "Test\tJourneys,\tNot\tStories\n\nDespite\tthe\tdisadvantages\tjust\toutlined,\tfor\tmany\tusers\tend-to-end\ttests\tcan\tstill\tbe manageable\twith\tone\tor\ttwo\tservices,\tand\tin\tthese\tsituations\tstill\tmake\ta\tlot\tof\tsense.\tBut what\thappens\twith\t3,\t4,\t10,\tor\t20\tservices?\tVery\tquickly\tthese\ttest\tsuites\tbecome\thugely bloated,\tand\tin\tthe\tworst\tcase\tcan\tresult\tin\tCartesian-like\texplosion\tin\tthe\tscenarios\tunder test.\n\nThis\tsituation\tworsens\tif\twe\tfall\tinto\tthe\ttrap\tof\tadding\ta\tnew\tend-to-end\ttest\tfor\tevery piece\tof\tfunctionality\twe\tadd.\tShow\tme\ta\tcodebase\twhere\tevery\tnew\tstory\tresults\tin\ta\tnew end-to-end\ttest,\tand\tI’ll\tshow\tyou\ta\tbloated\ttest\tsuite\tthat\thas\tpoor\tfeedback\tcycles\tand huge\toverlaps\tin\ttest\tcoverage.\n\nThe\tbest\tway\tto\tcounter\tthis\tis\tto\tfocus\ton\ta\tsmall\tnumber\tof\tcore\tjourneys\tto\ttest\tfor\tthe whole\tsystem.\tAny\tfunctionality\tnot\tcovered\tin\tthese\tcore\tjourneys\tneeds\tto\tbe\tcovered\tin tests\tthat\tanalyze\tservices\tin\tisolation\tfrom\teach\tother.\tThese\tjourneys\tneed\tto\tbe\tmutually agreed\tupon,\tand\tjointly\towned.\tFor\tour\tmusic\tshop,\twe\tmight\tfocus\ton\tactions\tlike ordering\ta\tCD,\treturning\ta\tproduct,\tor\tperhaps\tcreating\ta\tnew\tcustomer\t—\thigh-value interactions\tand\tvery\tfew\tin\tnumber.\n\nBy\tfocusing\ton\ta\tsmall\tnumber\t(and\tI\tmean\tsmall:\tvery\tlow\tdouble\tdigits\teven\tfor complex\tsystems)\tof\ttests\twe\tcan\treduce\tthe\tdownsides\tof\tintegration\ttests,\tbut\twe\tcannot avoid\tall\tof\tthem.\tIs\tthere\ta\tbetter\tway?",
      "content_length": 1389,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 253,
      "content": "Consumer-Driven\tTests\tto\tthe\tRescue\n\nWhat\tis\tone\tof\tthe\tkey\tproblems\twe\tare\ttrying\tto\taddress\twhen\twe\tuse\tthe\tintegration\ttests outlined\tpreviously?\tWe\tare\ttrying\tto\tensure\tthat\twhen\twe\tdeploy\ta\tnew\tservice\tto production,\tour\tchanges\twon’t\tbreak\tconsumers.\tOne\tway\twe\tcan\tdo\tthis\twithout requiring\ttesting\tagainst\tthe\treal\tconsumer\tis\tby\tusing\ta\tconsumer-driven\tcontract\t(CDC).\n\nWith\tCDCs,\twe\tare\tdefining\tthe\texpectations\tof\ta\tconsumer\ton\ta\tservice\t(or\tproducer). The\texpectations\tof\tthe\tconsumers\tare\tcaptured\tin\tcode\tform\tas\ttests,\twhich\tare\tthen\trun against\tthe\tproducer.\tIf\tdone\tright,\tthese\tCDCs\tshould\tbe\trun\tas\tpart\tof\tthe\tCI\tbuild\tof\tthe producer,\tensuring\tthat\tit\tnever\tgets\tdeployed\tif\tit\tbreaks\tone\tof\tthese\tcontracts.\tVery importantly\tfrom\ta\ttest\tfeedback\tpoint\tof\tview,\tthese\ttests\tneed\tto\tbe\trun\tonly\tagainst\ta single\tproducer\tin\tisolation,\tso\tcan\tbe\tfaster\tand\tmore\treliable\tthan\tthe\tend-to-end\ttests they\tmight\treplace.\n\nAs\tan\texample,\tlet’s\trevisit\tour\tcustomer\tservice\tscenario.\tThe\tcustomer\tservice\thas\ttwo separate\tconsumers:\tthe\thelpdesk\tand\tweb\tshop.\tBoth\tthese\tconsuming\tservices\thave expectations\tfor\thow\tthe\tcustomer\tservice\twill\tbehave.\tIn\tthis\texample,\tyou\tcreate\ttwo sets\tof\ttests:\tone\tfor\teach\tconsumer\trepresenting\tthe\thelpdesk’s\tand\tweb\tshop’s\tuse\tof\tthe customer\tservice.\tA\tgood\tpractice\there\tis\tto\thave\tsomeone\tfrom\tthe\tproducer\tand consumer\tteams\tcollaborate\ton\tcreating\tthe\ttests,\tso\tperhaps\tpeople\tfrom\tthe\tweb\tshop and\thelpdesk\tteams\tpair\twith\tpeople\tfrom\tthe\tcustomer\tservice\tteam.\n\nBecause\tthese\tCDCs\tare\texpectations\ton\thow\tthe\tcustomer\tservice\tshould\tbehave,\tthey can\tbe\trun\tagainst\tthe\tcustomer\tservice\tby\titself\twith\tany\tof\tits\tdownstream\tdependencies stubbed\tout,\tas\tFigure\t7-9\tshows.\tFrom\ta\tscope\tpoint\tof\tview,\tthey\tsit\tat\tthe\tsame\tlevel\tin the\ttest\tpyramid\tas\tservice\ttests,\talbeit\twith\ta\tvery\tdifferent\tfocus,\tas\tshown\tin\tFigure\t7- 10.\tThese\ttests\tare\tfocused\ton\thow\ta\tconsumer\twill\tuse\tthe\tservice,\tand\tthe\ttrigger\tif\tthey break\tis\tvery\tdifferent\twhen\tcompared\twith\tservice\ttests.\tIf\tone\tof\tthese\tCDCs\tbreaks during\ta\tbuild\tof\tthe\tcustomer\tservice,\tit\tbecomes\tobvious\twhich\tconsumer\twould\tbe impacted.\tAt\tthis\tpoint,\tyou\tcan\teither\tfix\tthe\tproblem\tor\telse\tstart\tthe\tdiscussion\tabout introducing\ta\tbreaking\tchange\tin\tthe\tmanner\twe\tdiscussed\tin\tChapter\t4.\tSo\twith\tCDCs, we\tcan\tidentify\ta\tbreaking\tchange\tprior\tto\tour\tsoftware\tgoing\tinto\tproduction\twithout having\tto\tuse\ta\tpotentially\texpensive\tend-to-end\ttest.",
      "content_length": 2458,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 254,
      "content": "Figure\t7-9.\tConsumer-driven\ttesting\tin\tthe\tcontext\tof\tour\tcustomer\tservice\texample\n\nFigure\t7-10.\tIntegrating\tconsumer-driven\ttests\tinto\tthe\ttest\tpyramid",
      "content_length": 152,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 255,
      "content": "Pact\n\nPact\tis\ta\tconsumer-driven\ttesting\ttool\tthat\twas\toriginally\tdeveloped\tin-house\tat RealEstate.com.au,\tbut\tis\tnow\topen\tsource,\twith\tBeth\tSkurrie\tdriving\tmost\tof\tthe development.\tOriginally\tjust\tfor\tRuby,\tPact\tnow\tincludes\tJVM\tand\t.NET\tports.\n\nPact\tworks\tin\ta\tvery\tinteresting\tway,\tas\tsummarized\tin\tFigure\t7-11.\tThe\tconsumer\tstarts by\tdefining\tthe\texpectations\tof\tthe\tproducer\tusing\ta\tRuby\tDSL.\tThen,\tyou\tlaunch\ta\tlocal mock\tserver,\tand\trun\tthis\texpectation\tagainst\tit\tto\tcreate\tthe\tPact\tspecification\tfile.\tThe Pact\tfile\tis\tjust\ta\tformal\tJSON\tspecification;\tyou\tcould\tobviously\thandcode\tthese,\tbut using\tthe\tlanguage\tAPI\tis\tmuch\teasier.\tThis\talso\tgives\tyou\ta\trunning\tmock\tserver\tthat\tcan be\tused\tfor\tfurther\tisolated\ttests\tof\tthe\tconsumer.\n\nFigure\t7-11.\tAn\toverview\tof\thow\tPact\tdoes\tconsumer-driven\ttesting\n\nOn\tthe\tproducer\tside,\tyou\tthen\tverify\tthat\tthis\tconsumer\tspecification\tis\tmet\tby\tusing\tthe JSON\tPact\tspecification\tto\tdrive\tcalls\tagainst\tyour\tAPI\tand\tverify\tresponses.\tFor\tthis\tto work,\tthe\tproducer\tcodebase\tneeds\taccess\tto\tthe\tPact\tfile.\tAs\twe\tdiscussed\tearlier\tin Chapter\t6,\twe\texpect\tboth\tthe\tconsumer\tand\tproducer\tto\tbe\tin\tdifferent\tbuilds.\tThe\tuse\tof a\tlanguage-agnostic\tJSON\tspecification\tis\tan\tespecially\tnice\ttouch.\tIt\tmeans\tthat\tyou\tcan generate\tthe\tconsumer’s\tspecification\tusing\ta\tRuby\tclient,\tbut\tuse\tit\tto\tverify\ta\tJava producer\tby\tusing\tthe\tJVM\tport\tof\tPact.\n\nAs\tthe\tJSON\tPact\tspecification\tis\tcreated\tby\tthe\tconsumer,\tthis\tneeds\tto\tbecome\tan artifact\tthat\tthe\tproducer\tbuild\thas\taccess\tto.\tYou\tcould\tstore\tthis\tin\tyour\tCI/CD\ttool’s artifact\trepository,\tor\telse\tuse\tthe\tPact\tBroker,\twhich\tallows\tyou\tto\tstore\tmultiple\tversions of\tyour\tPact\tspecifications.\tThis\tcould\tlet\tyou\trun\tyour\tconsumer-driven\tcontract\ttests against\tmultiple\tdifferent\tversions\tof\tthe\tconsumers,\tif\tyou\twanted\tto\ttest\tagainst,\tsay,\tthe version\tof\tthe\tconsumer\tin\tproduction\tand\tthe\tversion\tof\tthe\tconsumer\tthat\twas\tmost recently\tbuilt.\n\nConfusingly,\tthere\tis\ta\tThoughtWorks\topen\tsource\tproject\tcalled\tPacto,\twhich\tis\talso\ta Ruby\ttool\tused\tfor\tconsumer-driven\ttesting.\tIt\thas\tthe\tability\tto\trecord\tinteractions",
      "content_length": 2108,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 256,
      "content": "between\tclient\tand\tserver\tto\tgenerate\tthe\texpectations.\tThis\tmakes\twriting\tconsumer- driven\tcontracts\tfor\texisting\tservices\tfairly\teasy.\tWith\tPacto,\tonce\tgenerated\tthese expectations\tare\tmore\tor\tless\tstatic,\twhereas\twith\tPact\tyou\tregenerate\tthe\texpectations\tin the\tconsumer\twith\tevery\tbuild.\tThe\tfact\tthat\tyou\tcan\tdefine\texpectations\tfor\tcapabilities the\tproducer\tmay\tnot\teven\thave\tyet\talso\tbetter\tfits\tinto\ta\tworkflow\twhere\tthe\tproducing service\tis\tstill\tbeing\t(or\thas\tyet\tto\tbe)\tdeveloped.",
      "content_length": 491,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 257,
      "content": "It’s\tAbout\tConversations\n\nIn\tagile,\tstories\tare\toften\treferred\tto\tas\ta\tplaceholder\tfor\ta\tconversation.\tCDCs\tare\tjust like\tthat.\tThey\tbecome\tthe\tcodification\tof\ta\tset\tof\tdiscussions\tabout\twhat\ta\tservice\tAPI should\tlook\tlike,\tand\twhen\tthey\tbreak,\tthey\tbecome\ta\ttrigger\tpoint\tto\thave\tconversations about\thow\tthat\tAPI\tshould\tevolve.\n\nIt\tis\timportant\tto\tunderstand\tthat\tCDCs\trequire\tgood\tcommunication\tand\ttrust\tbetween\tthe consumer\tand\tproducing\tservice.\tIf\tboth\tparties\tare\tin\tthe\tsame\tteam\t(or\tthe\tsame person!),\tthen\tthis\tshouldn’t\tbe\thard.\tHowever,\tif\tyou\tare\tconsuming\ta\tservice\tprovided with\ta\tthird\tparty,\tyou\tmay\tnot\thave\tthe\tfrequency\tof\tcommunication,\tor\ttrust,\tto\tmake CDCs\twork.\tIn\tthese\tsituations,\tyou\tmay\thave\tto\tmake\tdo\twith\tlimited\tlarger-scoped integration\ttests\tjust\taround\tthe\tuntrusted\tcomponent.\tAlternatively,\tif\tyou\tare\tcreating\tan API\tfor\tthousands\tof\tpotential\tconsumers,\tsuch\tas\twith\ta\tpublicly\tavailable\tweb\tservice API,\tyou\tmay\thave\tto\tplay\tthe\trole\tof\tthe\tconsumer\tyourself\t(or\tperhaps\twork\twith\ta subset\tof\tyour\tconsumers)\tin\tdefining\tthese\ttests.\tBreaking\thuge\tnumbers\tof\texternal consumers\tis\ta\tpretty\tbad\tidea,\tso\tif\tanything\tthe\timportance\tof\tCDCs\tis\tincreased!",
      "content_length": 1192,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 258,
      "content": "So\tShould\tYou\tUse\tEnd-to-End\tTests?\n\nAs\toutlined\tin\tdetail\tearlier\tin\tthe\tchapter,\tend-to-end\ttests\thave\ta\tlarge\tnumber\tof disadvantages\tthat\tgrow\tsignificantly\tas\tyou\tadd\tmore\tmoving\tparts\tunder\ttest.\tFrom speaking\tto\tpeople\twho\thave\tbeen\timplementing\tmicroservices\tat\tscale\tfor\ta\twhile\tnow,\tI have\tlearned\tthat\tmost\tof\tthem\tover\ttime\tremove\tthe\tneed\tentirely\tfor\tend-to-end\ttests\tin favor\tof\ttools\tlike\tCDCs\tand\timproved\tmonitoring.\tBut\tthey\tdo\tnot\tnecessarily\tthrow those\ttests\taway.\tThey\tend\tup\tusing\tmany\tof\tthose\tend-to-end\tjourney\ttests\tto\tmonitor\tthe production\tsystem\tusing\ta\ttechnique\tcalled\tsemantic\tmonitoring,\twhich\twe\twill\tdiscuss more\tin\tChapter\t8.\n\nYou\tcan\tview\trunning\tend-to-end\ttests\tprior\tto\tproduction\tdeployment\tas\ttraining\twheels. While\tyou\tare\tlearning\thow\tCDCs\twork,\tand\timproving\tyour\tproduction\tmonitoring\tand deployment\ttechniques,\tthese\tend-to-end\ttests\tmay\tform\ta\tuseful\tsafety\tnet,\twhere\tyou\tare trading\toff\tcycle\ttime\tfor\tdecreased\trisk.\tBut\tas\tyou\timprove\tthose\tother\tareas,\tyou\tcan start\tto\treduce\tyour\treliance\ton\tend-to-end\ttests\tto\tthe\tpoint\twhere\tthey\tare\tno\tlonger needed.\n\nSimilarly,\tyou\tmay\twork\tin\tan\tenvironment\twhere\tthe\tappetite\tto\tlearn\tin\tproduction\tis low,\tand\tpeople\twould\trather\twork\tas\thard\tas\tthey\tcan\tto\teliminate\tany\tdefects\tbefore production,\teven\tif\tthat\tmeans\tsoftware\ttakes\tlonger\tto\tship.\tAs\tlong\tas\tyou\tunderstand that\tyou\tcannot\tbe\tcertain\tthat\tyou\thave\teliminated\tall\tsources\tof\tdefects,\tand\tthat\tyou\twill still\tneed\tto\thave\teffective\tmonitoring\tand\tremediation\tin\tplace\tin\tproduction,\tthis\tmay\tbe a\tsensible\tdecision.\n\nObviously\tyou’ll\thave\ta\tbetter\tunderstanding\tof\tyour\town\torganization’s\trisk\tprofile\tthan me,\tbut\tI\twould\tchallenge\tyou\tto\tthink\tlong\tand\thard\tabout\thow\tmuch\tend-to-end\ttesting you\treally\tneed\tto\tdo.",
      "content_length": 1781,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 259,
      "content": "Testing\tAfter\tProduction\n\nMost\ttesting\tis\tdone\tbefore\tthe\tsystem\tis\tin\tproduction.\tWith\tour\ttests,\twe\tare\tdefining\ta series\tof\tmodels\twith\twhich\twe\thope\tto\tprove\twhether\tour\tsystem\tworks\tand\tbehaves\tas we\twould\tlike,\tboth\tfunctionally\tand\tnonfunctionally.\tBut\tif\tour\tmodels\tare\tnot\tperfect, then\twe\twill\tencounter\tproblems\twhen\tour\tsystems\tare\tused\tin\tanger.\tBugs\tslip\tinto production,\tnew\tfailure\tmodes\tare\tdiscovered,\tand\tour\tusers\tuse\tthe\tsystem\tin\tways\twe could\tnever\texpect.\n\nOne\treaction\tto\tthis\tis\toften\tto\tdefine\tmore\tand\tmore\ttests,\tand\trefine\tour\tmodels,\tto\tcatch more\tissues\tearly\tand\treduce\tthe\tnumber\tof\tproblems\twe\tencounter\twith\tour\trunning production\tsystem.\tHowever,\tat\ta\tcertain\tpoint\twe\thave\tto\taccept\tthat\twe\thit\tdiminishing returns\twith\tthis\tapproach.\tWith\ttesting\tprior\tto\tdeployment,\twe\tcannot\treduce\tthe\tchance of\tfailure\tto\tzero.",
      "content_length": 854,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 260,
      "content": "Separating\tDeployment\tfrom\tRelease\n\nOne\tway\tin\twhich\twe\tcan\tcatch\tmore\tproblems\tbefore\tthey\toccur\tis\tto\textend\twhere\twe run\tour\ttests\tbeyond\tthe\ttraditional\tpredeployment\tsteps.\tInstead,\tif\twe\tcan\tdeploy\tour software,\tand\ttest\tit\tin\tsitu\tprior\tto\tdirecting\tproduction\tloads\tagainst\tit,\twe\tcan\tdetect issues\tspecific\tto\ta\tgiven\tenvironment.\tA\tcommon\texample\tof\tthis\tis\tthe\tsmoke\ttest\tsuite, a\tcollection\tof\ttests\tdesigned\tto\tbe\trun\tagainst\tnewly\tdeployed\tsoftware\tto\tconfirm\tthat the\tdeployment\tworked.\tThese\ttests\thelp\tyou\tpick\tup\tany\tlocal\tenvironmental\tissues.\tIf you’re\tusing\ta\tsingle\tcommand-line\tcommand\tto\tdeploy\tany\tgiven\tmicroservice\t(and\tyou should),\tthis\tcommand\tshould\trun\tthe\tsmoke\ttests\tautomatically.\n\nAnother\texample\tof\tthis\tis\twhat\tis\tcalled\tblue/green\tdeployment.\tWith\tblue/green,\twe have\ttwo\tcopies\tof\tour\tsoftware\tdeployed\tat\ta\ttime,\tbut\tonly\tone\tversion\tof\tit\tis\treceiving real\trequests.\n\nLet’s\tconsider\ta\tsimple\texample,\tseen\tin\tFigure\t7-12.\tIn\tproduction,\twe\thave\tv123\tof\tthe customer\tservice\tlive.\tWe\twant\tto\tdeploy\ta\tnew\tversion,\tv456.\tWe\tdeploy\tthis\talongside v123,\tbut\tdo\tnot\tdirect\tany\ttraffic\tto\tit.\tInstead,\twe\tperform\tsome\ttesting\tin\tsitu\tagainst\tthe newly\tdeployed\tversion.\tOnce\tthe\ttests\thave\tworked,\twe\tdirect\tthe\tproduction\tload\tto\tthe new\tv456\tversion\tof\tthe\tcustomer\tservice.\tIt\tis\tcommon\tto\tkeep\tthe\told\tversion\taround\tfor a\tshort\tperiod\tof\ttime,\tallowing\tfor\ta\tfast\tfallback\tif\tyou\tdetect\tany\terrors.\n\nFigure\t7-12.\tUsing\tblue/green\tdeployments\tto\tseparate\tdeployment\tfrom\trelease\n\nImplementing\tblue/green\tdeployment\trequires\ta\tfew\tthings.\tFirst,\tyou\tneed\tto\tbe\table\tto direct\tproduction\ttraffic\tto\tdifferent\thosts\t(or\tcollections\tof\thosts).\tYou\tcould\tdo\tthis\tby changing\tDNS\tentries,\tor\tupdating\tload-balancing\tconfiguration.\tYou\talso\tneed\tto\tbe\table to\tprovision\tenough\thosts\tto\thave\tboth\tversions\tof\tthe\tmicroservice\trunning\tat\tonce.\tIf you’re\tusing\tan\telastic\tcloud\tprovider,\tthis\tcould\tbe\tstraightforward.\tUsing\tblue/green deployments\tallows\tyou\tto\treduce\tthe\trisk\tof\tdeployment,\tas\twell\tas\tgives\tyou\tthe\tchance to\trevert\tshould\tyou\tencounter\ta\tproblem.\tIf\tyou\tget\tgood\tat\tthis,\tthe\tentire\tprocess\tcan\tbe completely\tautomated,\twith\teither\tthe\tfull\troll-out\tor\trevert\thappening\twithout\tany\thuman intervention.\n\nQuite\taside\tfrom\tthe\tbenefit\tof\tallowing\tus\tto\ttest\tour\tservices\tin\tsitu\tprior\tto\tsending them\tproduction\ttraffic,\tby\tkeeping\tthe\told\tversion\trunning\twhile\twe\tperform\tour\trelease",
      "content_length": 2430,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 261,
      "content": "we\tgreatly\treduce\tthe\tdowntime\tassociated\twith\treleasing\tour\tsoftware.\tDepending\ton what\tmechanism\tis\tused\tto\timplement\tthe\ttraffic\tredirection,\tthe\tswitchover\tbetween versions\tcan\tbe\tcompletely\tinvisible\tto\tthe\tcustomer,\tgiving\tus\tzero-downtime deployments.\n\nThere\tis\tanother\ttechnique\tworth\tdiscussing\tbriefly\there\ttoo,\twhich\tis\tsometimes\tconfused with\tblue/green\tdeployments,\tas\tit\tcan\tuse\tsome\tof\tthe\tsame\ttechnical\timplementations.\tIt is\tknown\tas\tcanary\treleasing.",
      "content_length": 469,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 262,
      "content": "Canary\tReleasing\n\nWith\tcanary\treleasing,\twe\tare\tverifying\tour\tnewly\tdeployed\tsoftware\tby\tdirecting amounts\tof\tproduction\ttraffic\tagainst\tthe\tsystem\tto\tsee\tif\tit\tperforms\tas\texpected. “Performing\tas\texpected”\tcan\tcover\ta\tnumber\tof\tthings,\tboth\tfunctional\tand nonfunctional.\tFor\texample,\twe\tcould\tcheck\tthat\ta\tnewly\tdeployed\tservice\tis\tresponding to\trequests\twithin\t500ms,\tor\tthat\twe\tsee\tthe\tsame\tproportional\terror\trates\tfrom\tthe\tnew and\tthe\told\tservice.\tBut\tyou\tcould\tgo\tdeeper\tthan\tthat.\tImagine\twe’ve\treleased\ta\tnew version\tof\tthe\trecommendation\tservice.\tWe\tmight\trun\tboth\tof\tthem\tside\tby\tside\tbut\tsee\tif the\trecommendations\tgenerated\tby\tthe\tnew\tversion\tof\tthe\tservice\tresult\tin\tas\tmany expected\tsales,\tmaking\tsure\tthat\twe\thaven’t\treleased\ta\tsuboptimal\talgorithm.\n\nIf\tthe\tnew\trelease\tis\tbad,\tyou\tget\tto\trevert\tquickly.\tIf\tit\tis\tgood,\tyou\tcan\tpush\tincreasing amounts\tof\ttraffic\tthrough\tthe\tnew\tversion.\tCanary\treleasing\tdiffers\tfrom\tblue/green\tin that\tyou\tcan\texpect\tversions\tto\tcoexist\tfor\tlonger,\tand\tyou’ll\toften\tvary\tthe\tamounts\tof traffic.\n\nNetflix\tuses\tthis\tapproach\textensively.\tPrior\tto\trelease,\tnew\tservice\tversions\tare\tdeployed alongside\ta\tbaseline\tcluster\tthat\trepresents\tthe\tsame\tversion\tas\tproduction.\tNetflix\tthen runs\ta\tsubset\tof\tthe\tproduction\tload\tover\ta\tnumber\tof\thours\tagainst\tboth\tthe\tnew\tversion and\tthe\tbaseline,\tscoring\tboth.\tIf\tthe\tcanary\tpasses,\tthe\tcompany\tthen\tproceeds\tto\ta\tfull roll-out\tinto\tproduction.\n\nWhen\tconsidering\tcanary\treleasing,\tyou\tneed\tto\tdecide\tif\tyou\tare\tgoing\tto\tdivert\ta\tportion of\tproduction\trequests\tto\tthe\tcanary\tor\tjust\tcopy\tproduction\tload.\tSome\tteams\tare\table\tto shadow\tproduction\ttraffic\tand\tdirect\tit\tto\ttheir\tcanary.\tIn\tthis\tway,\tthe\texisting\tproduction and\tcanary\tversions\tcan\tsee\texactly\tthe\tsame\trequests,\tbut\tonly\tthe\tresults\tof\tthe production\trequests\tare\tseen\texternally.\tThis\tallows\tyou\tto\tdo\ta\tside-by-side\tcomparison while\teliminating\tthe\tchance\tthat\ta\tfailure\tin\tthe\tcanary\tcan\tbe\tseen\tby\ta\tcustomer\trequest. The\twork\tto\tshadow\tproduction\ttraffic\tcan\tbe\tcomplex,\tthough,\tespecially\tif\tthe events/requests\tbeing\treplayed\taren’t\tidempotent.\n\nCanary\treleasing\tis\ta\tpowerful\ttechnique,\tand\tcan\thelp\tyou\tverify\tnew\tversions\tof\tyour software\twith\treal\ttraffic,\twhile\tgiving\tyou\ttools\tto\tmanage\tthe\trisk\tof\tpushing\tout\ta\tbad release.\tIt\tdoes\trequire\ta\tmore\tcomplex\tsetup,\thowever,\tthan\tblue/green\tdeployment,\tand\ta bit\tmore\tthought.\tYou\tcould\texpect\tto\tcoexist\tdifferent\tversions\tof\tyour\tservices\tfor\tlonger than\twith\tblue/green,\tso\tyou\tmay\tbe\ttying\tup\tmore\thardware\tfor\tlonger\tthan\tbefore.\tYou’ll also\tneed\tmore\tsophisticated\ttraffic\trouting,\tas\tyou\tmay\twant\tto\tramp\tup\tor\tdown\tthe percentages\tof\tthe\ttraffic\tto\tget\tmore\tconfidence\tthat\tyour\trelease\tworks.\tIf\tyou\talready handle\tblue/green\tdeployments,\tyou\tmay\thave\tsome\tof\tthe\tbuilding\tblocks\talready.",
      "content_length": 2812,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 263,
      "content": "Mean\tTime\tto\tRepair\tOver\tMean\tTime\tBetween\tFailures?\n\nSo\tby\tlooking\tat\ttechniques\tlike\tblue/green\tdeployment\tor\tcanary\treleasing,\twe\tfind\ta\tway to\ttest\tcloser\tto\t(or\teven\tin)\tproduction,\tand\twe\talso\tbuild\ttools\tto\thelp\tus\tmanage\ta\tfailure if\tit\toccurs.\tUsing\tthese\tapproaches\tis\ta\ttacit\tacknowledgment\tthat\twe\tcannot\tspot\tand catch\tall\tproblems\tbefore\twe\tactually\trelease\tour\tsoftware.\n\nSometimes\texpending\tthe\tsame\teffort\tinto\tgetting\tbetter\tat\tremediation\tof\ta\trelease\tcan\tbe significantly\tmore\tbeneficial\tthan\tadding\tmore\tautomated\tfunctional\ttests.\tIn\tthe\tweb operations\tworld,\tthis\tis\toften\treferred\tto\tas\tthe\ttrade-off\tbetween\toptimizing\tfor\tmean time\tbetween\tfailures\t(MTBF)\tand\tmean\ttime\tto\trepair\t(MTTR).\n\nTechniques\tto\treduce\tthe\ttime\tto\trecovery\tcan\tbe\tas\tsimple\tas\tvery\tfast\trollbacks\tcoupled with\tgood\tmonitoring\t(which\twe’ll\tdiscuss\tin\tChapter\t8),\tlike\tblue/green\tdeployments.\tIf we\tcan\tspot\ta\tproblem\tin\tproduction\tearly,\tand\troll\tback\tearly,\twe\treduce\tthe\timpact\tto\tour customers.\tWe\tcan\talso\tuse\ttechniques\tlike\tblue/green\tdeployment,\twhere\twe\tdeploy\ta new\tversion\tof\tour\tsoftware\tand\ttest\tit\tin\tsitu\tprior\tto\tdirecting\tour\tusers\tto\tthe\tnew version.\n\nFor\tdifferent\torganizations,\tthis\ttrade-off\tbetween\tMTBF\tand\tMTTR\twill\tvary,\tand\tmuch of\tthis\tlies\twith\tunderstanding\tthe\ttrue\timpact\tof\tfailure\tin\ta\tproduction\tenvironment. However,\tmost\torganizations\tthat\tI\tsee\tspending\ttime\tcreating\tfunctional\ttest\tsuites\toften expend\tlittle\tto\tno\teffort\tat\tall\ton\tbetter\tmonitoring\tor\trecovering\tfrom\tfailure.\tSo\twhile they\tmay\treduce\tthe\tnumber\tof\tdefects\tthat\toccur\tin\tthe\tfirst\tplace,\tthey\tcan’t\teliminate\tall of\tthem,\tand\tare\tunprepared\tfor\tdealing\twith\tthem\tif\tthey\tpop\tup\tin\tproduction.\n\nTrade-offs\tother\tthan\tMTBF\tand\tMTTR\texist.\tFor\texample,\tif\tyou\tare\ttrying\tto\twork\tout if\tanyone\twill\tactually\tuse\tyour\tsoftware,\tit\tmay\tmake\tmuch\tmore\tsense\tto\tget\tsomething out\tnow,\tto\tprove\tthe\tidea\tor\tthe\tbusiness\tmodel\tbefore\tbuilding\trobust\tsoftware.\tIn\tan environment\twhere\tthis\tis\tthe\tcase,\ttesting\tmay\tbe\toverkill,\tas\tthe\timpact\tof\tnot\tknowing if\tyour\tidea\tworks\tis\tmuch\thigher\tthan\thaving\ta\tdefect\tin\tproduction.\tIn\tthese\tsituations,\tit can\tbe\tquite\tsensible\tto\tavoid\ttesting\tprior\tto\tproduction\taltogether.",
      "content_length": 2216,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 264,
      "content": "Cross-Functional\tTesting\n\nThe\tbulk\tof\tthis\tchapter\thas\tbeen\tfocused\ton\ttesting\tspecific\tpieces\tof\tfunctionality,\tand how\tthis\tdiffers\twhen\tyou\tare\ttesting\ta\tmicroservice-based\tsystem.\tHowever,\tthere\tis another\tcategory\tof\ttesting\tthat\tis\timportant\tto\tdiscuss.\tNonfunctional\trequirements\tis\tan umbrella\tterm\tused\tto\tdescribe\tthose\tcharacteristics\tyour\tsystem\texhibits\tthat\tcannot simply\tbe\timplemented\tlike\ta\tnormal\tfeature.\tThey\tinclude\taspects\tlike\tthe\tacceptable latency\tof\ta\tweb\tpage,\tthe\tnumber\tof\tusers\ta\tsystem\tshould\tsupport,\thow\taccessible\tyour user\tinterface\tshould\tbe\tto\tpeople\twith\tdisabilities,\tor\thow\tsecure\tyour\tcustomer\tdata should\tbe.\n\nThe\tterm\tnonfunctional\tnever\tsat\twell\twith\tme.\tSome\tof\tthe\tthings\tthat\tget\tcovered\tby\tthis term\tseem\tvery\tfunctional\tin\tnature!\tOne\tof\tmy\tcolleagues,\tSarah\tTaraporewalla,\tcoined the\tphrase\tcross-functional\trequirements\t(CFR)\tinstead,\twhich\tI\tgreatly\tprefer.\tIt\tspeaks more\tto\tthe\tfact\tthat\tthese\tsystem\tbehaviors\treally\tonly\temerge\tas\tthe\tresult\tof\tlots\tof cross-cutting\twork.\n\nMany,\tif\tnot\tmost,\tCFRs\tcan\treally\tonly\tbe\tmet\tin\tproduction.\tThat\tsaid,\twe\tcan\tdefine test\tstrategies\tto\thelp\tus\tsee\tif\twe\tare\tat\tleast\tmoving\ttoward\tmeeting\tthese\tgoals.\tThese sorts\tof\ttests\tfall\tinto\tthe\tProperty\tTesting\tquadrant.\tA\tgreat\texample\tof\tthis\tis\tthe performance\ttest,\twhich\twe’ll\tdiscuss\tin\tmore\tdepth\tshortly.\n\nFor\tsome\tCFRs,\tyou\tmay\twant\tto\ttrack\tthem\tat\tan\tindividual\tservice\tlevel.\tFor\texample, you\tmay\tdecide\tthat\tthe\tdurability\tof\tservice\tyou\trequire\tfrom\tyour\tpayment\tservice\tis significantly\thigher,\tbut\tyou\tare\thappy\twith\tmore\tdowntime\tfor\tyour\tmusic recommendation\tservice,\tknowing\tthat\tyour\tcore\tbusiness\tcan\tsurvive\tif\tyou\tare\tunable\tto recommend\tartists\tsimilar\tto\tMetallica\tfor\t10\tminutes\tor\tso.\tThese\ttrade-offs\twill\tend\tup having\ta\tlarge\timpact\ton\thow\tyou\tdesign\tand\tevolve\tyour\tsystem,\tand\tonce\tagain\tthe\tfine- grained\tnature\tof\ta\tmicroservice-based\tsystem\tgives\tyou\tmany\tmore\tchances\tto\tmake these\ttrade-offs.\n\nTests\taround\tCFRs\tshould\tfollow\tthe\tpyramid\ttoo.\tSome\ttests\twill\thave\tto\tbe\tend-to-end, like\tload\ttests,\tbut\tothers\twon’t.\tFor\texample,\tonce\tyou’ve\tfound\ta\tperformance bottleneck\tin\tan\tend-to-end\tload\ttest,\twrite\ta\tsmaller-scoped\ttest\tto\thelp\tyou\tcatch\tthe problem\tin\tthe\tfuture.\tOther\tCFRs\tfit\tfaster\ttests\tquite\teasily.\tI\tremember\tworking\ton\ta project\twhere\twe\thad\tinsisted\ton\tensuring\tour\tHTML\tmarkup\twas\tusing\tproper accessibility\tfeatures\tto\thelp\tpeople\twith\tdisabilities\tuse\tour\twebsite.\tChecking\tthe generated\tmarkup\tto\tmake\tsure\tthat\tthe\tappropriate\tcontrols\twere\tthere\tcould\tbe\tdone very\tquickly\twithout\tthe\tneed\tfor\tany\tnetworking\troundtrips.\n\nAll\ttoo\toften,\tconsiderations\tabout\tCFRs\tcome\tfar\ttoo\tlate.\tI\tstrongly\tsuggest\tlooking\tat your\tCFRs\tas\tearly\tas\tpossible,\tand\treviewing\tthem\tregularly.",
      "content_length": 2779,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 265,
      "content": "Performance\tTests\n\nPerformance\ttests\tare\tworth\tcalling\tout\texplicitly\tas\ta\tway\tof\tensuring\tthat\tsome\tof\tour cross-functional\trequirements\tcan\tbe\tmet.\tWhen\tdecomposing\tsystems\tinto\tsmaller microservices,\twe\tincrease\tthe\tnumber\tof\tcalls\tthat\twill\tbe\tmade\tacross\tnetwork boundaries.\tWhere\tpreviously\tan\toperation\tmight\thave\tinvolved\tone\tdatabase\tcall,\tit\tmay now\tinvolve\tthree\tor\tfour\tcalls\tacross\tnetwork\tboundaries\tto\tother\tservices,\twith\ta matching\tnumber\tof\tdatabase\tcalls.\tAll\tof\tthis\tcan\tdecrease\tthe\tspeed\tat\twhich\tour systems\toperate.\tTracking\tdown\tsources\tof\tlatency\tis\tespecially\timportant.\tWhen\tyou have\ta\tcall\tchain\tof\tmultiple\tsynchronous\tcalls,\tif\tany\tpart\tof\tthe\tchain\tstarts\tacting slowly,\teverything\tis\taffected,\tpotentially\tleading\tto\ta\tsignificant\timpact.\tThis\tmakes having\tsome\tway\tto\tperformance\ttest\tyour\tapplications\teven\tmore\timportant\tthan\tit\tmight be\twith\ta\tmore\tmonolithic\tsystem.\tOften\tthe\treason\tthis\tsort\tof\ttesting\tgets\tdelayed\tis because\tinitially\tthere\tisn’t\tenough\tof\tthe\tsystem\tthere\tto\ttest.\tI\tunderstand\tthis\tproblem, but\tall\ttoo\toften\tit\tleads\tto\tkicking\tthe\tcan\tdown\tthe\troad,\twith\tperformance\ttesting\toften only\tbeing\tdone\tjust\tbefore\tyou\tgo\tlive\tfor\tthe\tfirst\ttime,\tif\tat\tall!\tDon’t\tfall\tinto\tthis\ttrap.\n\nAs\twith\tfunctional\ttests,\tyou\tmay\twant\ta\tmix.\tYou\tmay\tdecide\tthat\tyou\twant\tperformance tests\tthat\tisolate\tindividual\tservices,\tbut\tstart\twith\ttests\tthat\tcheck\tcore\tjourneys\tin\tyour system.\tYou\tmay\tbe\table\tto\ttake\tend-to-end\tjourney\ttests\tand\tsimply\trun\tthese\tat\tvolume.\n\nTo\tgenerate\tworthwhile\tresults,\tyou’ll\toften\tneed\tto\trun\tgiven\tscenarios\twith\tgradually increasing\tnumbers\tof\tsimulated\tcustomers.\tThis\tallows\tyou\tto\tsee\thow\tlatency\tof\tcalls varies\twith\tincreasing\tload.\tThis\tmeans\tthat\tperformance\ttests\tcan\ttake\ta\twhile\tto\trun.\tIn addition,\tyou’ll\twant\tthe\tsystem\tto\tmatch\tproduction\tas\tclosely\tas\tpossible,\tto\tensure\tthat the\tresults\tyou\tsee\twill\tbe\tindicative\tof\tthe\tperformance\tyou\tcan\texpect\ton\tthe\tproduction systems.\tThis\tcan\tmean\tthat\tyou’ll\tneed\tto\tacquire\ta\tmore\tproduction-like\tvolume\tof\tdata, and\tmay\tneed\tmore\tmachines\tto\tmatch\tthe\tinfrastructure\t—\ttasks\tthat\tcan\tbe\tchallenging. Even\tif\tyou\tstruggle\tto\tmake\tthe\tperformance\tenvironment\ttruly\tproduction-like,\tthe\ttests may\tstill\thave\tvalue\tin\ttracking\tdown\tbottlenecks.\tJust\tbe\taware\tthat\tyou\tmay\tget\tfalse negatives,\tor\teven\tworse,\tfalse\tpositives.\n\nDue\tto\tthe\ttime\tit\ttakes\tto\trun\tperformance\ttests,\tit\tisn’t\talways\tfeasible\tto\trun\tthem\ton every\tcheck-in.\tIt\tis\ta\tcommon\tpractice\tto\trun\ta\tsubset\tevery\tday,\tand\ta\tlarger\tset\tevery week.\tWhatever\tapproach\tyou\tpick,\tmake\tsure\tyou\trun\tthem\tas\tregularly\tas\tyou\tcan.\tThe longer\tyou\tgo\twithout\trunning\tperformance\ttests,\tthe\tharder\tit\tcan\tbe\tto\ttrack\tdown\tthe culprit.\tPerformance\tproblems\tare\tespecially\tdifficult\tto\tresolve,\tso\tif\tyou\tcan\treduce\tthe number\tof\tcommits\tyou\tneed\tto\tlook\tat\tin\torder\tto\tsee\ta\tnewly\tintroduced\tproblem,\tyour life\twill\tbe\tmuch\teasier.\n\nAnd\tmake\tsure\tyou\talso\tlook\tat\tthe\tresults!\tI’ve\tbeen\tvery\tsurprised\tby\tthe\tnumber\tof teams\tI\thave\tencountered\twho\thave\tspent\ta\tlot\tof\twork\timplementing\ttests\tand\trunning them,\tand\tnever\tcheck\tthe\tnumbers.\tOften\tthis\tis\tbecause\tpeople\tdon’t\tknow\twhat\ta\tgood result\tlooks\tlike.\tYou\treally\tneed\tto\thave\ttargets.\tThis\tway,\tyou\tcan\tmake\tthe\tbuild\tgo\tred",
      "content_length": 3273,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 266,
      "content": "or\tgreen\tbased\ton\tthe\tresults,\twith\ta\tred\t(failing)\tbuild\tbeing\ta\tclear\tcall\tto\taction.\n\nPerformance\ttesing\tneeds\tto\tbe\tdone\tin\tconcert\twith\tmonitoring\tthe\treal\tsystem performance\t(which\twe’ll\tdiscuss\tmore\tin\tChapter\t8),\tand\tideally\tshould\tuse\tthe\tsame tools\tin\tyour\tperformance\ttest\tenvironment\tfor\tvisualizing\tsystem\tbehavior\tas\tthose\tyou use\tin\tproduction.\tThis\tcan\tmake\tit\tmuch\teasier\tto\tcompare\tlike\twith\tlike.",
      "content_length": 415,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 267,
      "content": "Summary\n\nBringing\tthis\tall\ttogether,\twhat\tI\thave\toutlined\there\tis\ta\tholistic\tapproach\tto\ttesting\tthat hopefully\tgives\tyou\tsome\tgeneral\tguidance\ton\thow\tto\tproceed\twhen\ttesting\tyour\town systems.\tTo\treiterate\tthe\tbasics:\n\nOptimize\tfor\tfast\tfeedback,\tand\tseparate\ttypes\tof\ttests\taccordingly.\n\nAvoid\tthe\tneed\tfor\tend-to-end\ttests\twherever\tpossible\tby\tusing\tconsumer-driven contracts.\n\nUse\tconsumer-driven\tcontracts\tto\tprovide\tfocus\tpoints\tfor\tconversations\tbetween teams.\n\nTry\tto\tunderstand\tthe\ttrade-off\tbetween\tputting\tmore\tefforts\tinto\ttesting\tand detecting\tissues\tfaster\tin\tproduction\t(optimizing\tfor\tMTBF\tversus\tMTTR).\n\nIf\tyou\tare\tinterested\tin\treading\tmore\tabout\ttesting,\tI\trecommend\tAgile\tTesting\tby\tLisa Crispin\tand\tJanet\tGregory\t(Addison-Wesley),\twhich\tamong\tother\tthings\tcovers\tthe\tuse\tof the\ttesting\tquadrant\tin\tmore\tdetail.\n\nThis\tchapter\tfocused\tmostly\ton\tmaking\tsure\tour\tcode\tworks\tbefore\tit\thits\tproduction,\tbut we\talso\tneed\tto\tknow\thow\tto\tmake\tsure\tour\tcode\tworks\tonce\tit’s\tdeployed.\tIn\tthe\tnext chapter,\twe’ll\ttake\ta\tlook\tat\thow\tto\tmonitor\tour\tmicroservice-based\tsystems.\n\n2\tDiane\tVaughan,\tThe\tChallenger\tLaunch\tDecision:\tRisky\tTechnology,\tCulture,\tand Deviance\tat\tNASA\t(Chicago:\tUniversity\tof\tChicago\tPress,\t1996).",
      "content_length": 1226,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 268,
      "content": "Chapter\t8.\tMonitoring\n\nAs\tI’ve\thopefully\tshown\tso\tfar,\tbreaking\tour\tsystem\tup\tinto\tsmaller,\tfine-grained microservices\tresults\tin\tmultiple\tbenefits.\tIt\talso,\thowever,\tadds\tcomplexity\twhen\tit comes\tto\tmonitoring\tthe\tsystem\tin\tproduction.\tIn\tthis\tchapter,\twe’ll\tlook\tat\tthe\tchallenges associated\twith\tmonitoring\tand\tidentifying\tproblems\tin\tour\tfine-grained\tsystems,\tand\tI’ll outline\tsome\tof\tthe\tthings\tyou\tcan\tdo\tto\thave\tyour\tcake\tand\teat\tit\ttoo!\n\nPicture\tthe\tscene.\tIt’s\ta\tquiet\tFriday\tafternoon,\tand\tthe\tteam\tis\tlooking\tforward\tto\tsloping off\tearly\tto\tthe\tpub\tas\ta\tway\tto\tstart\ta\tweekend\taway\tfrom\twork.\tThen\tsuddenly\tthe emails\tarrive.\tThe\twebsite\tis\tmisbehaving!\tTwitter\tis\tablaze\twith\tyour\tcompany’s\tfailings, your\tboss\tis\tchewing\tyour\tear\toff,\tand\tthe\tprospects\tof\ta\tquiet\tweekend\tvanish.\n\nWhat’s\tthe\tfirst\tthing\tyou\tneed\tto\tknow?\tWhat\tthe\thell\thas\tgone\twrong?\n\nIn\tthe\tworld\tof\tthe\tmonolithic\tapplication,\twe\tat\tleast\thave\ta\tvery\tobvious\tplace\tto\tstart our\tinvestigations.\tWebsite\tslow?\tIt’s\tthe\tmonolith.\tWebsite\tgiving\todd\terrors?\tIt’s\tthe monolith.\tCPU\tat\t100%?\tMonolith.\tSmell\tof\tburning?\tWell,\tyou\tget\tthe\tidea.\tHaving\ta single\tpoint\tof\tfailure\talso\tmakes\tfailure\tinvestigation\tsomewhat\tsimpler!\n\nNow\tlet’s\tthink\tabout\tour\town,\tmicroservice-based\tsystem.\tThe\tcapabilities\twe\toffer\tour users\tare\tserved\tfrom\tmultiple\tsmall\tservices,\tsome\tof\twhich\tcommunicate\twith\tyet\tmore services\tto\taccomplish\ttheir\ttasks.\tThere\tare\tlots\tof\tadvantages\tto\tsuch\tan\tapproach (which\tis\tgood,\tas\totherwise\tthis\tbook\twould\tbe\ta\twaste\tof\ttime),\tbut\tin\tthe\tworld\tof monitoring,\twe\thave\ta\tmore\tcomplex\tproblem\ton\tour\thands.\n\nWe\tnow\thave\tmultiple\tservers\tto\tmonitor,\tmultiple\tlogfiles\tto\tsift\tthrough,\tand\tmultiple places\twhere\tnetwork\tlatency\tcould\tcause\tproblems.\tSo\thow\tdo\twe\tapproach\tthis?\tWe need\tto\tmake\tsense\tof\twhat\totherwise\tmight\tbe\ta\tchaotic,\ttangled\tmess\t—\tthe\tlast\tthing any\tof\tus\twants\tto\tdeal\twith\ton\ta\tFriday\tafternoon\t(or\tat\tany\ttime,\tcome\tto\tthat!).\n\nThe\tanswer\there\tis\tpretty\tstraightforward:\tmonitor\tthe\tsmall\tthings,\tand\tuse\taggregation\tto see\tthe\tbigger\tpicture.\tTo\tsee\thow,\twe’ll\tstart\twith\tthe\tsimplest\tsystem\twe\tcan:\ta\tsingle node.",
      "content_length": 2140,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 269,
      "content": "Single\tService,\tSingle\tServer\n\nFigure\t8-1\tpresents\ta\tvery\tsimple\tsetup:\tone\thost,\trunning\tone\tservice.\tNow\twe\tneed\tto monitor\tit\tin\torder\tto\tknow\twhen\tsomething\tgoes\twrong,\tso\twe\tcan\tfix\tit.\tSo\twhat\tshould we\tlook\tfor?\n\nFigure\t8-1.\tA\tsingle\tservice\ton\ta\tsingle\thost\n\nFirst,\twe’ll\twant\tto\tmonitor\tthe\thost\titself.\tCPU,\tmemory\t—\tall\tof\tthese\tthings\tare\tuseful. We’ll\twant\tto\tknow\twhat\tthey\tshould\tbe\twhen\tthings\tare\thealthy,\tso\twe\tcan\talert\twhen they\tgo\tout\tof\tbounds.\tIf\twe\twant\tto\trun\tour\town\tmonitoring\tsoftware,\twe\tcould\tuse something\tlike\tNagios\tto\tdo\tso,\tor\telse\tuse\ta\thosted\tservice\tlike\tNew\tRelic.\n\nNext,\twe’ll\twant\tto\thave\taccess\tto\tthe\tlogs\tfrom\tthe\tserver\titself.\tIf\ta\tuser\treports\tan\terror, these\tlogs\tshould\tpick\tit\tup\tand\thopefully\ttell\tus\twhen\tand\twhere\tthe\terror\tis.\tAt\tthis point,\twith\tour\tsingle\thost\twe\tcan\tprobably\tget\tby\twith\tjust\tlogging\ton\tto\tthe\thost\tand using\tcommand-line\ttools\tto\tscan\tthe\tlog.\tWe\tmay\teven\tget\tadvanced\tand\tuse\tlogrotate to\tmove\told\tlogs\tout\tof\tthe\tway\tand\tavoid\tthem\ttaking\tup\tall\tour\tdisk\tspace.\n\nFinally,\twe\tmight\twant\tto\tmonitor\tthe\tapplication\titself.\tAt\ta\tbare\tminimum,\tmonitoring the\tresponse\ttime\tof\tthe\tservice\tis\ta\tgood\tidea.\tYou’ll\tprobably\tbe\table\tto\tdo\tthis\tby looking\tat\tthe\tlogs\tcoming\teither\tfrom\ta\tweb\tserver\tfronting\tyour\tservice,\tor\tperhaps\tfrom the\tservice\titself.\tIf\twe\tget\tvery\tadvanced,\twe\tmight\twant\tto\ttrack\tthe\tnumber\tof\terrors\twe are\treporting.\n\nTime\tpasses,\tloads\tincrease,\tand\twe\tfind\tourselves\tneeding\tto\tscale…",
      "content_length": 1482,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 270,
      "content": "Single\tService,\tMultiple\tServers\n\nNow\twe\thave\tmultiple\tcopies\tof\tthe\tservice\trunning\ton\tseparate\thosts,\tas\tshown\tin Figure\t8-2,\twith\trequests\tto\tthe\tdifferent\tservice\tinstances\tdistributed\tvia\ta\tload\tbalancer. Things\tstart\tto\tget\ta\tbit\ttrickier\tnow.\tWe\tstill\twant\tto\tmonitor\tall\tthe\tsame\tthings\tas\tbefore, but\tneed\tto\tdo\tso\tin\tsuch\ta\tway\tthat\twe\tcan\tisolate\tthe\tproblem.\tWhen\tthe\tCPU\tis\thigh,\tis it\ta\tproblem\twe\tare\tseeing\ton\tall\thosts,\twhich\twould\tpoint\tto\tan\tissue\twith\tthe\tservice itself,\tor\tis\tit\tisolated\tto\ta\tsingle\thost,\timplying\tthat\tthe\thost\titself\thas\tthe\tproblem\t— perhaps\ta\trogue\tOS\tprocess?\n\nFigure\t8-2.\tA\tsingle\tservice\tdistributed\tacross\tmultiple\thosts\n\nSo\tat\tthis\tpoint,\twe\tstill\twant\tto\ttrack\tthe\thost-level\tmetrics,\tand\talert\ton\tthem.\tBut\tnow we\twant\tto\tsee\twhat\tthey\tare\tacross\tall\thosts,\tas\twell\tas\tindividual\thosts.\tIn\tother\twords, we\twant\tto\taggregate\tthem\tup,\tand\tstill\tbe\table\tto\tdrill\tdown.\tNagios\tlets\tus\tgroup\tour hosts\tlike\tthis\t—\tso\tfar,\tso\tgood.\tA\tsimilar\tapproach\twill\tprobably\tsuffice\tfor\tour application.\n\nThen\twe\thave\tour\tlogs.\tWith\tour\tservice\trunning\ton\tmore\tthan\tone\tserver,\twe’ll\tprobably get\ttired\tof\tlogging\tinto\teach\tbox\tto\tlook\tat\tit.\tWith\tjust\ta\tfew\thosts,\tthough,\twe\tcan\tuse tools\tlike\tssh-multiplexers,\twhich\tallow\tus\tto\trun\tthe\tsame\tcommands\ton\tmultiple\thosts. A\tbig\tmonitor\tand\ta\tgrep\t\"Error\"\tapp.log\tlater,\tand\twe\tcan\tfind\tour\tculprit.\n\nFor\ttasks\tlike\tresponse\ttime\ttracking,\twe\tcan\tget\tsome\tof\tthe\taggregation\tfor\tfree\tby tracking\tat\tthe\tload\tbalancer\titself.\tBut\twe\tneed\tto\ttrack\tthe\tload\tbalancer\tas\twell,\tof course;\tif\tthat\tmisbehaves,\twe\thave\ta\tproblem.\tAt\tthis\tpoint,\twe\talso\tprobably\tcare\ta\tlot more\tabout\twhat\ta\thealthy\tservice\tlooks\tlike,\tas\twe’ll\tconfigure\tour\tload\tbalancer\tto remove\tunhealthy\tnodes\tfrom\tour\tapplication.\tHopefully\tby\tthe\ttime\twe\tget\there\twe\thave at\tleast\tsome\tidea\tof\tthat…",
      "content_length": 1850,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 271,
      "content": "Multiple\tServices,\tMultiple\tServers\n\nIn\tFigure\t8-3,\tthings\tget\tmuch\tmore\tinteresting.\tMultiple\tservices\tare\tcollaborating\tto provide\tcapabilities\tto\tour\tusers,\tand\tthose\tservices\tare\trunning\ton\tmultiple\thosts\t—\tbe they\tphysical\tor\tvirtual.\tHow\tdo\tyou\tfind\tthe\terror\tyou’re\tlooking\tfor\tin\tthousands\tof\tlines of\tlogs\ton\tmultiple\thosts?\tHow\tdo\tyou\tdetermine\tif\tone\tserver\tis\tmisbehaving,\tor\tif\tit\tis\ta systematic\tissue?\tAnd\thow\tdo\tyou\ttrack\tback\tan\terror\tfound\tdeep\tdown\tin\ta\tcall\tchain between\tmultiple\thosts\tand\twork\tout\twhat\tcaused\tit?\n\nFigure\t8-3.\tMultiple\tcollaborating\tservices\tdistributed\tacross\tmultiple\thosts\n\nThe\tanswer\tis\tcollection\tand\tcentral\taggregation\tof\tas\tmuch\tas\twe\tcan\tget\tour\thands\ton, from\tlogs\tto\tapplication\tmetrics.",
      "content_length": 737,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 272,
      "content": "Logs,\tLogs,\tand\tYet\tMore\tLogs…\n\nNow\tthe\tnumber\tof\thosts\twe\tare\trunning\ton\tis\tbecoming\ta\tchallenge.\tSSH-multiplexing\tto retrieve\tlogs\tprobably\tisn’t\tgoing\tto\tcut\tit\tnow,\tand\tthere\tisn’t\ta\tscreen\tbig\tenough\tfor\tyou to\thave\tterminals\topen\ton\tevery\thost.\tInstead,\twe’re\tlooking\tto\tuse\tspecialized\tsubsystems to\tgrab\tour\tlogs\tand\tmake\tthem\tavailable\tcentrally.\tOne\texample\tof\tthis\tis\tlogstash,\twhich can\tparse\tmultiple\tlogfile\tformats\tand\tcan\tsend\tthem\tto\tdownstream\tsystems\tfor\tfurther investigation.\n\nKibana\tis\tan\tElasticSearch-backed\tsystem\tfor\tviewing\tlogs,\tillustrated\tin\tFigure\t8-4.\tYou can\tuse\ta\tquery\tsyntax\tto\tsearch\tthrough\tlogs,\tallowing\tyou\tto\tdo\tthings\tlike\trestrict\ttime and\tdate\tranges\tor\tuse\tregular\texpressions\tto\tfind\tmatching\tstrings.\tKibana\tcan\teven generate\tgraphs\tfrom\tthe\tlogs\tyou\tsend\tit,\tallowing\tyou\tto\tsee\tat\ta\tglance\thow\tmany errors\thave\tbeen\tgenerated\tover\ttime,\tfor\texample.\n\nFigure\t8-4.\tUsing\tKibana\tto\tview\taggregated\tlogs",
      "content_length": 949,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 273,
      "content": "Metric\tTracking\tAcross\tMultiple\tServices\n\nAs\twith\tthe\tchallenge\tof\tlooking\tat\tlogs\tfor\tdifferent\thosts,\twe\tneed\tto\tlook\tat\tbetter\tways to\tgather\tand\tview\tour\tmetrics.\tIt\tcan\tbe\thard\tto\tknow\twhat\tgood\tlooks\tlike\twhen\twe’re looking\tat\tmetrics\tfor\ta\tmore\tcomplex\tsystem.\tOur\twebsite\tis\tseeing\tnearly\t50\t4XX\tHTTP error\tcodes\tper\tsecond.\tIs\tthat\tbad?\tThe\tCPU\tload\ton\tthe\tcatalog\tservice\thas\tincreased\tby 20%\tsince\tlunch;\thas\tsomething\tgone\twrong?\tThe\tsecret\tto\tknowing\twhen\tto\tpanic\tand when\tto\trelax\tis\tto\tgather\tmetrics\tabout\thow\tyour\tsystem\tbehaves\tover\ta\tlong-enough period\tof\ttime\tthat\tclear\tpatterns\temerge.\n\nIn\ta\tmore\tcomplex\tenvironment,\twe’ll\tbe\tprovisioning\tnew\tinstances\tof\tour\tservices pretty\tfrequently,\tso\twe\twant\tthe\tsystem\twe\tpick\tto\tmake\tit\tvery\teasy\tto\tcollect\tmetrics from\tnew\thosts.\tWe’ll\twant\tto\tbe\table\tto\tlook\tat\ta\tmetric\taggregated\tfor\tthe\twhole\tsystem —\tfor\texample,\tthe\tavergage\tCPU\tload\t—\tbut\twe’ll\talso\twant\tto\taggregate\tthat\tmetric\tfor all\tthe\tinstances\tof\ta\tgiven\tservice,\tor\teven\tfor\ta\tsingle\tinstance\tof\tthat\tservice.\tThat means\twe’ll\tneed\tto\tbe\table\tto\tassociate\tmetadata\twith\tthe\tmetric\tto\tallow\tus\tto\tinfer\tthis structure.\n\nGraphite\tis\tone\tsuch\tsystem\tthat\tmakes\tthis\tvery\teasy.\tIt\texposes\ta\tvery\tsimple\tAPI\tand allows\tyou\tto\tsend\tmetrics\tin\treal\ttime.\tIt\tthen\tallows\tyou\tto\tquery\tthose\tmetrics\tto produce\tcharts\tand\tother\tdisplays\tto\tsee\twhat\tis\thappening.\tThe\tway\tit\thandles\tvolume\tis also\tinteresting.\tEffectively,\tyou\tconfigure\tit\tso\tthat\tyou\treduce\tthe\tresolution\tof\tolder metrics\tto\tensure\tthe\tvolumes\tdon’t\tget\ttoo\tlarge.\tSo,\tfor\texample,\tI\tmight\trecord\tthe\tCPU for\tmy\thosts\tonce\tevery\t10\tseconds\tfor\tthe\tlast\t10\tminutes,\tthen\tan\taggregated\tsample every\tminute\tfor\tthe\tlast\tday,\tdown\tto\tperhaps\tone\tsample\tevery\t30\tminutes\tfor\tthe\tlast several\tyears.\tIn\tthis\tway,\tyou\tcan\tstore\tinformation\tabout\thow\tyour\tsystem\thas\tbehaved over\ta\tlong\tperiod\tof\ttime\twithout\tneeding\thuge\tamounts\tof\tstorage.\n\nGraphite\talso\tenables\tyou\tto\taggregate\tacross\tsamples,\tor\tdrill\tdown\tto\ta\tsingle\tseries,\tso you\tcan\tsee\tthe\tresponse\ttime\tfor\tyour\twhole\tsystem,\ta\tgroup\tof\tservices,\tor\ta\tsingle instance.\tIf\tGraphite\tdoesn’t\twork\tfor\tyou\tfor\twhatever\treason,\tmake\tsure\tyou\tget\tsimilar capabilities\tin\tany\tother\ttool\tyou\tselect.\tAnd\tcertainly\tmake\tsure\tyou\tcan\tget\taccess\tto\tthe raw\tdata\tto\tprovide\tyour\town\treporting\tor\tdashboards\tif\tyou\tneed\tto.\n\nAnother\tkey\tbenefit\tof\tunderstanding\tyour\ttrends\tis\twhen\tit\tcomes\tto\tcapacity\tplanning. Are\twe\treaching\tour\tlimit?\tHow\tlong\tuntil\twe\tneed\tmore\thosts?\tIn\tthe\tpast\twhen\twe brought\tphysical\thosts,\tthis\twas\toften\tan\tannual\tjob.\tIn\tthe\tnew\tage\tof\ton-demand computing\tprovided\tby\tinfrastructure\tas\ta\tservice\t(IaaS)\tvendors,\twe\tcan\tnow\tscale\tup\tor down\tin\tminutes,\tif\tnot\tseconds.\tThis\tmeans\tthat\tif\twe\tunderstand\tour\tusage\tpatterns,\twe can\tmake\tsure\twe\thave\tjust\tenough\tinfrastructure\tto\tserve\tour\tneeds.\tThe\tsmarter\twe\tare in\ttracking\tour\ttrends\tand\tknowing\twhat\tto\tdo\twith\tthem,\tthe\tmore\tcost\teffective\tand responsive\tour\tsystems\tcan\tbe.",
      "content_length": 2994,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 274,
      "content": "Service\tMetrics\n\nThe\toperating\tsystems\twe\trun\ton\tgenerate\ta\tlarge\tnumber\tof\tmetrics\tfor\tus,\tas\tyou’ll\tfind the\tmoment\tyou\tinstall\tcollectd\ton\ta\tLinux\tbox\tand\tpoint\tit\tat\tGraphite.\tLikewise, supporting\tsubsystems\tlike\tNginx\tor\tVarnish\texposes\tuseful\tinformation\tlike\tresponse times\tor\tcache\thit\trates.\tBut\twhat\tabout\tyour\town\tservice?\n\nI\twould\tstrongly\tsuggest\thaving\tyour\tservices\texpose\tbasic\tmetrics\tthemselves.\tAt\ta\tbare minimum,\tfor\ta\tweb\tservice\tyou\tshould\tprobably\texpose\tmetrics\tlike\tresponse\ttimes\tand error\trates\t—\tvital\tif\tyour\tserver\tisn’t\tfronted\tby\ta\tweb\tserver\tthat\tis\tdoing\tthis\tfor\tyou. But\tyou\tshould\treally\tgo\tfurther.\tFor\texample,\tour\taccounts\tservice\tmay\twant\tto\texpose the\tnumber\tof\ttimes\tcustomers\tview\ttheir\tpast\torders,\tor\tyour\tweb\tshop\tmight\twant\tto capture\thow\tmuch\tmoney\thas\tbeen\tmade\tduring\tthe\tlast\tday.\n\nWhy\tdo\twe\tcare\tabout\tthis?\tWell,\tfor\ta\tnumber\tof\treasons.\tFirst,\tthere\tis\tan\told\tadage\tthat 80%\tof\tsoftware\tfeatures\tare\tnever\tused.\tNow\tI\tcan’t\tcomment\ton\thow\taccurate\tthat figure\tis,\tbut\tas\tsomeone\twho\thas\tbeen\tdeveloping\tsoftware\tfor\tnearly\t20\tyears,\tI\tknow that\tI\thave\tspent\ta\tlot\tof\ttime\ton\tfeatures\tthat\tnever\tactually\tget\tused.\tWouldn’t\tit\tbe\tnice to\tknow\twhat\tthey\tare?\n\nSecond,\twe\tare\tgetting\tbetter\tthan\tever\tat\treacting\tto\thow\tour\tusers\tare\tusing\tour\tsystem to\twork\tout\thow\tto\timprove\tit.\tMetrics\tthat\tinform\tus\tof\thow\tour\tsystems\tbehave\tcan\tonly help\tus\there.\tWe\tpush\tout\ta\tnew\tversion\tof\tthe\twebsite,\tand\tfind\tthat\tthe\tnumber\tof searches\tby\tgenre\thas\tgone\tup\tsignificantly\ton\tthe\tcatalog\tservice.\tIs\tthat\ta\tproblem,\tor expected?\n\nFinally,\twe\tcan\tnever\tknow\twhat\tdata\twill\tbe\tuseful!\tMore\ttimes\tthan\tI\tcan\tcount\tI’ve wanted\tto\tcapture\tdata\tto\thelp\tme\tunderstand\tsomething\tonly\tafter\tthe\tchance\tto\tdo\tso\thas long\tpassed.\tI\ttend\tto\terr\ttoward\texposing\teverything\tand\trelying\ton\tmy\tmetrics\tsystem\tto handle\tthis\tlater.\n\nLibraries\texist\tfor\ta\tnumber\tof\tdifferent\tplatforms\tthat\tallow\tour\tservices\tto\tsend\tmetrics to\tstandard\tsystems.\tCodahale’s\tMetrics\tlibrary\tis\tone\tsuch\texample\tlibrary\tfor\tthe\tJVM. It\tallows\tyou\tto\tstore\tmetrics\tas\tcounters,\ttimers,\tor\tgauges;\tsupports\ttime-boxing\tmetrics (so\tyou\tcan\tspecify\tmetrics\tlike\t“number\tof\torders\tin\tthe\tlast\tfive\tminutes”);\tand\talso comes\tout\tof\tthe\tbox\twith\tsupport\tfor\tsending\tdata\tto\tGraphite\tand\tother\taggregating\tand reporting\tsystems.",
      "content_length": 2331,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 275,
      "content": "Synthetic\tMonitoring\n\nWe\tcan\ttry\tto\twork\tout\tif\ta\tservice\tis\thealthy\tby,\tfor\texample,\tdeciding\twhat\ta\tgood\tCPU level\tis,\tor\twhat\tmakes\tfor\tan\tacceptable\tresponse\ttime.\tIf\tour\tmonitoring\tsystem\tdetects that\tthe\tactual\tvalues\tfall\toutside\tthis\tsafe\tlevel,\twe\tcan\ttrigger\tan\talert\t—\tsomething\tthat a\ttool\tlike\tNagios\tis\tmore\tthan\tcapable\tof.\n\nHowever,\tin\tmany\tways,\tthese\tvalues\tare\tone\tstep\tremoved\tfrom\twhat\twe\tactually\twant\tto track\t—\tnamely,\tis\tthe\tsystem\tworking?\tThe\tmore\tcomplex\tthe\tinteractions\tbetween\tthe services,\tthe\tfurther\tremoved\twe\tare\tfrom\tactually\tanswering\tthat\tquestion.\tSo\twhat\tif\tour monitoring\tsystems\twere\tprogrammed\tto\tact\ta\tbit\tlike\tour\tusers,\tand\tcould\treport\tback\tif something\tgoes\twrong?\n\nI\tfirst\tdid\tthis\tback\tin\t2005.\tI\twas\tpart\tof\ta\tsmall\tThoughtWorks\tteam\tthat\twas\tbuilding\ta system\tfor\tan\tinvestment\tbank.\tThroughout\tthe\ttrading\tday,\tlots\tof\tevents\tcame\tin representing\tchanges\tin\tthe\tmarket.\tOur\tjob\twas\tto\treact\tto\tthese\tchanges,\tand\tlook\tat\tthe impact\ton\tthe\tbank’s\tportfolio.\tWe\twere\tworking\tunder\tsome\tfairly\ttight\tdeadlines,\tas\tthe goal\twas\tto\thave\tdone\tall\tour\tcalculations\tin\tless\tthan\t10\tseconds\tafter\tthe\tevent\tarrived. The\tsystem\titself\tconsisted\tof\taround\tfive\tdiscrete\tservices,\tat\tleast\tone\tof\twhich\twas running\ton\ta\tcomputing\tgrid\tthat,\tamong\tother\tthings,\twas\tscavenging\tunused\tCPU\tcycles on\taround\t250\tdesktop\thosts\tin\tthe\tbank’s\tdisaster\trecovery\tcenter.\n\nThe\tnumber\tof\tmoving\tparts\tin\tthe\tsystem\tmeant\ta\tlot\tof\tnoise\twas\tbeing\tgenerated\tfrom many\tof\tthe\tlower-level\tmetrics\twe\twere\tgathering.\tWe\tdidn’t\thave\tthe\tbenefit\tof\tscaling gradually\tor\thaving\tthe\tsystem\trun\tfor\ta\tfew\tmonths\tto\tunderstand\twhat\tgood\tlooked\tlike for\tmetrics\tlike\tour\tCPU\trate\tor\teven\tthe\tlatencies\tof\tsome\tof\tthe\tindividual\tcomponents. Our\tapproach\twas\tto\tgenerate\tfake\tevents\tto\tprice\tpart\tof\tthe\tportfolio\tthat\twas\tnot booked\tinto\tthe\tdownstream\tsystems.\tEvery\tminute\tor\tso,\twe\thad\tNagios\trun\ta\tcommand- line\tjob\tthat\tinserted\ta\tfake\tevent\tinto\tone\tof\tour\tqueues.\tOur\tsystem\tpicked\tit\tup\tand\tran all\tthe\tvarious\tcalculations\tjust\tlike\tany\tother\tjob,\texcept\tthe\tresults\tappeared\tin\tthe\tjunk book,\twhich\twas\tused\tonly\tfor\ttesting.\tIf\ta\tre-pricing\twasn’t\tseen\twithin\ta\tgiven\ttime, Nagios\treported\tthis\tas\tan\tissue.\n\nThis\tfake\tevent\twe\tcreated\tis\tan\texample\tof\tsynthetic\ttransaction.\tWe\tused\tthis\tsynthetic transaction\tto\tensure\tthe\tsystem\twas\tbehaving\tsemantically,\twhich\tis\twhy\tthis\ttechnique\tis often\tcalled\tsemantic\tmonitoring.\n\nIn\tpractice,\tI’ve\tfound\tthe\tuse\tof\tsynthetic\ttransactions\tto\tperform\tsemantic\tmonitoring like\tthis\tto\tbe\ta\tfar\tbetter\tindicator\tof\tissues\tin\tsystems\tthan\talerting\ton\tthe\tlower-level metrics.\tThey\tdon’t\treplace\tthe\tneed\tfor\tthe\tlower-level\tmetrics,\tthough\t—\twe’ll\tstill\twant that\tdetail\twhen\twe\tneed\tto\tfind\tout\twhy\tour\tsemantic\tmonitoring\tis\treporting\ta\tproblem.",
      "content_length": 2816,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 276,
      "content": "Implementing\tSemantic\tMonitoring\n\nNow\tin\tthe\tpast,\timplementing\tsemantic\tmonitoring\twas\ta\tfairly\tdaunting\ttask.\tBut\tthe world\thas\tmoved\ton,\tand\tthe\tmeans\tto\tdo\tthis\tis\tat\tour\tfingertips!\tYou\tare\trunning\ttests for\tyour\tsystems,\tright?\tIf\tnot,\tgo\tread\tChapter\t7\tand\tcome\tback.\tAll\tdone?\tGood!\n\nIf\twe\tlook\tat\tthe\ttests\twe\thave\tthat\ttest\ta\tgiven\tservice\tend\tto\tend,\tor\teven\tour\twhole system\tend\tto\tend,\twe\thave\tmuch\tof\twhat\twe\tneed\tto\timplement\tsemantic\tmonitoring. Our\tsystem\talready\texposes\tthe\thooks\tneeded\tto\tlaunch\tthe\ttest\tand\tcheck\tthe\tresult.\tSo why\tnot\tjust\trun\ta\tsubset\tof\tthese\ttests,\ton\tan\tongoing\tbasis,\tas\ta\tway\tof\tmonitoring\tour system?\n\nThere\tare\tsome\tthings\twe\tneed\tto\tdo,\tof\tcourse.\tFirst,\twe\tneed\tto\tbe\tcareful\tabout\tthe\tdata requirements\tof\tour\ttests.\tWe\tmay\tneed\tto\tfind\ta\tway\tfor\tour\ttests\tto\tadapt\tto\tdifferent\tlive data\tif\tthis\tchanges\tover\ttime,\tor\telse\tset\ta\tdifferent\tsource\tof\tdata.\tFor\texample,\twe\tcould have\ta\tset\tof\tfake\tusers\twe\tuse\tin\tproduction\twith\ta\tknown\tset\tof\tdata.\n\nLikewise,\twe\thave\tto\tmake\tsure\twe\tdon’t\taccidentally\ttrigger\tunforeseen\tside\teffects.\tA friend\ttold\tme\ta\tstory\tabout\tan\tecommerce\tcompany\tthat\taccidentally\tran\tits\ttests\tagainst its\tproduction\tordering\tsystems.\tIt\tdidn’t\trealize\tits\tmistake\tuntil\ta\tlarge\tnumber\tof washing\tmachines\tarrived\tat\tthe\thead\toffice.",
      "content_length": 1311,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 277,
      "content": "Correlation\tIDs\n\nWith\ta\tlarge\tnumber\tof\tservices\tinteracting\tto\tprovide\tany\tgiven\tend-user\tcapability,\ta single\tinitiating\tcall\tcan\tend\tup\tgenerating\tmultiple\tmore\tdownstream\tservice\tcalls.\tFor example,\tconsider\tthe\texample\tof\ta\tcustomer\tbeing\tregistered.\tThe\tcustomer\tfills\tin\tall\ther details\tin\ta\tform\tand\tclicks\tsubmit.\tBehind\tthe\tscenes,\twe\tcheck\tvalidity\tof\tthe\tcredit\tcard details\twith\tour\tpayment\tservice,\ttalk\tto\tour\tpostal\tservice\tto\tsend\tout\ta\twelcome\tpack\tin the\tpost,\tand\tsend\ta\twelcome\temail\tusing\tour\temail\tservice.\tNow\twhat\thappens\tif\tthe\tcall to\tthe\tpayment\tservice\tends\tup\tgenerating\tan\todd\terror?\tWe’ll\ttalk\tat\tlength\tabout handling\tthe\tfailure\tin\tChapter\t11,\tbut\tconsider\tthe\tdifficulty\tof\tdiagnosing\twhat happened.\n\nIf\twe\tlook\tat\tthe\tlogs,\tthe\tonly\tservice\tregistering\tan\terror\tis\tour\tpayment\tservice.\tIf\twe are\tlucky,\twe\tcan\twork\tout\twhat\trequest\tcaused\tthe\tproblem,\tand\twe\tmay\teven\tbe\table\tto look\tat\tthe\tparameters\tof\tthe\tcall.\tNow\tconsider\tthat\tthis\tis\ta\tsimple\texample,\tand\tthat\tone initiating\trequest\tcould\tgenerate\ta\tchain\tof\tdownstream\tcalls\tand\tmaybe\tevents\tbeing\tfired off\tthat\tare\thandled\tin\tan\tasynchronous\tmanner.\tHow\tcan\twe\treconstruct\tthe\tflow\tof\tcalls in\torder\tto\treproduce\tand\tfix\tthe\tproblem?\tOften\twhat\twe\tneed\tis\tto\tsee\tthat\terror\tin\tthe wider\tcontext\tof\tthe\tinitiating\tcall;\tin\tother\twords,\twe’d\tlike\tto\ttrace\tthe\tcall\tchain upstream,\tjust\tlike\twe\tdo\twith\ta\tstack\ttrace.\n\nOne\tapproach\tthat\tcan\tbe\tuseful\there\tis\tto\tuse\tcorrelation\tIDs.\tWhen\tthe\tfirst\tcall\tis\tmade, you\tgenerate\ta\tGUID\tfor\tthe\tcall.\tThis\tis\tthen\tpassed\talong\tto\tall\tsubsequent\tcalls,\tas\tseen in\tFigure\t8-5,\tand\tcan\tbe\tput\tinto\tyour\tlogs\tin\ta\tstructured\tway,\tmuch\tas\tyou’ll\talready\tdo with\tcomponents\tlike\tthe\tlog\tlevel\tor\tdate.\tWith\tthe\tright\tlog\taggregation\ttooling,\tyou’ll then\tbe\table\tto\ttrace\tthat\tevent\tall\tthe\tway\tthrough\tyour\tsystem:\n\n15-02-2014\t16:01:01\tWeb-Frontend\tINFO\t[abc-123]\tRegister 15-02-2014\t16:01:02\tRegisterService\tINFO\t[abc-123]\tRegisterCustomer… 15-02-2014\t16:01:03\tPostalSystem\tINFO\t[abc-123]\tSendWelcomePack… 15-02-2014\t16:01:03\tEmailSystem\tINFO\t[abc-123]\tSendWelcomeEmail… 15-02-2014\t16:01:03\tPaymentGateway\tERROR\t[abc-123]\tValidatePayment…",
      "content_length": 2172,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 278,
      "content": "Figure\t8-5.\tUsing\tcorrelation\tIDs\tto\ttrack\tcall\tchains\tacross\tmultiple\tservices\n\nYou\twill,\tof\tcourse,\tneed\tto\tensure\tthat\teach\tservice\tknows\tto\tpass\ton\tthe\tcorrelation\tID. This\tis\twhere\tyou\tneed\tto\tstandardize\tand\tbe\tstronger\tin\tenforcing\tthis\tacross\tyour system.\tBut\tonce\tyou\thave\tdone\tthis,\tyou\tcan\tactually\tcreate\ttooling\tto\ttrack\tall\tsorts\tof interactions.\tSuch\ttooling\tcan\tbe\tuseful\tin\ttracking\tdown\tevent\tstorms,\todd\tcorner\tcases, or\teven\tidentifying\tespecially\tcostly\ttransactions,\tas\tyou\tcan\tpicture\tthe\twhole\tcascade\tof calls.\n\nSoftware\tsuch\tas\tZipkin\tcan\talso\ttrace\tcalls\tacross\tmultiple\tsystem\tboundaries.\tBased\ton the\tideas\tfrom\tGoogle’s\town\ttracing\tsystem,\tDapper,\tZipkin\tcan\tprovide\tvery\tdetailed tracing\tof\tinterservice\tcalls,\talong\twith\ta\tUI\tto\thelp\tpresent\tthe\tdata.\tPersonally,\tI’ve found\tthe\trequirements\tof\tZipkin\tto\tbe\tsomewhat\theavyweight,\trequiring\tcustom\tclients and\tsupporting\tcollection\tsystems.\tGiven\tthat\tyou’ll\talready\twant\tlog\taggregation\tfor other\tpurposes,\tit\tfeels\tmuch\tsimpler\tto\tinstead\tmake\tuse\tof\tdata\tyou’re\talready\tcollecting than\thave\tto\tplumb\tin\tadditional\tsources\tof\tdata.\tThat\tsaid,\tif\tyou\tfind\tthat\tyou\tneed\ta more\tadvanced\ttool\tto\ttrack\tinterservice\tcalls\tlike\tthis,\tyou\tmight\twant\tto\tgive\tthem\ta look.\n\nOne\tof\tthe\treal\tproblems\twith\tcorrelation\tIDs\tis\tthat\tyou\toften\tdon’t\tknow\tyou\tneed\tone until\tafter\tyou\talready\thave\ta\tproblem\tthat\tcould\tbe\tdiagnosed\tonly\tif\tyou\thad\tthe\tID\tat the\tbeginning!\tThis\tis\tespecially\tproblematic,\tas\tretrofitting\tcorrelation\tIDs\tin\tis\tvery difficult;\tyou\tneed\tto\thandle\tthem\tin\ta\tstandardized\tway\tto\tbe\table\tto\teasily\treconsititute call\tchains.\tAlthough\tit\tmight\tseem\tlike\tadditional\twork\tup\tfront,\tI\twould\tstrongly\tsuggest you\tconsider\tputting\tthem\tin\tas\tsoon\tas\tyou\tcan,\tespecially\tif\tyour\tsystem\twill\tmake\tuse of\tevent-drive\tarchitecture\tpatterns,\twhich\tcan\tlead\tto\tsome\todd\temergent\tbehavior.",
      "content_length": 1872,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 279,
      "content": "Needing\tto\thandle\ttasks\tlike\tconsistently\tpassing\tthrough\tcorrelation\tIDs\tcan\tbe\ta\tstrong argument\tfor\tthe\tuse\tof\tthin\tshared\tclient\twrapper\tlibraries.\tAt\ta\tcertain\tscale,\tit\tbecomes difficult\tto\tensure\tthat\teveryone\tis\tcalling\tdownstream\tservices\tin\tthe\tright\tway\tand collecting\tthe\tright\tsort\tof\tdata.\tIt\tonly\ttakes\tone\tservice\tpartway\tthrough\tthe\tchain\tto forget\tto\tdo\tthis\tfor\tyou\tto\tlose\tcritical\tinformation.\tIf\tyou\tdo\tdecide\tto\tcreate\tan\tin-house client\tlibrary\tto\tmake\tthings\tlike\tthis\twork\tout\tof\tthe\tbox,\tdo\tmake\tsure\tyou\tkeep\tit\tvery thin\tand\tnot\ttied\tto\tany\tparticular\tproducing\tservice.\tFor\texample,\tif\tyou\tare\tusing\tHTTP as\tthe\tunderlying\tprotocol\tfor\tcommunication,\tjust\twrap\ta\tstandard\tHTTP\tclient\tlibrary, adding\tin\tcode\tto\tmake\tsure\tyou\tpropogate\tthe\tcorrelation\tIDs\tin\tthe\theaders.",
      "content_length": 800,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 280,
      "content": "The\tCascade\n\nCascading\tfailures\tcan\tbe\tespecially\tperilous.\tImagine\ta\tsituation\twhere\tthe\tnetwork connection\tbetween\tour\tmusic\tshop\twebsite\tand\tthe\tcatalog\tservice\tgoes\tdown.\tThe services\tthemselves\tappear\thealthy,\tbut\tthey\tcan’t\ttalk\tto\teach\tother.\tIf\twe\tjust\tlooked\tat the\thealth\tof\tthe\tindividual\tservice,\twe\twouldn’t\tknow\tthere\tis\ta\tproblem.\tUsing\tsynthetic monitoring\t—\tfor\texample,\tto\tmimic\ta\tcustomer\tsearching\tfor\ta\tsong\t—\twould\tpick\tup the\tproblem.\tBut\twe’d\talso\tneed\tto\treport\ton\tthe\tfact\tthat\tone\tservice\tcannot\tsee\tanother in\torder\tto\tdetermine\tthe\tcause\tof\tthe\tproblem.\n\nTherefore,\tmonitoring\tthe\tintegration\tpoints\tbetween\tsystems\tis\tkey.\tEach\tservice\tinstance should\ttrack\tand\texpose\tthe\thealth\tof\tits\tdownstream\tdependencies,\tfrom\tthe\tdatabase\tto other\tcollaborating\tservices.\tYou\tshould\talso\tallow\tthis\tinformation\tto\tbe\taggregated\tto give\tyou\ta\trolled-up\tpicture.\tYou’ll\twant\tto\tsee\tthe\tresponse\ttime\tof\tthe\tdownstream\tcalls, and\talso\tdetect\tif\tit\tis\terroring.\n\nAs\twe’ll\tdiscuss\tmore\tin\tChapter\t11,\tyou\tcan\tuse\tlibraries\tto\timplement\ta\tcircuit\tbreaker around\tnetwork\tcalls\tto\thelp\tyou\thandle\tcascading\tfailures\tin\ta\tmore\telegant\tfashion, allowing\tyou\tto\tmore\tgracefully\tdegrade\tyour\tsystem.\tSome\tof\tthese\tlibraries,\tsuch\tas Hystrix\tfor\tthe\tJVM,\talso\tdo\ta\tgood\tjob\tof\tproviding\tthese\tmonitoring\tcapabilities\tfor you.",
      "content_length": 1333,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 281,
      "content": "Standardization\n\nAs\twe’ve\tcovered\tpreviously,\tone\tof\tthe\tongoing\tbalancing\tacts\tyou’ll\tneed\tto\tpull\toff\tis where\tto\tallow\tfor\tdecisions\tto\tbe\tmade\tnarrowly\tfor\ta\tsingle\tservice\tversus\twhere\tyou need\tto\tstandardize\tacross\tyour\tsystem.\tIn\tmy\topinion,\tmonitoring\tis\tone\tarea\twhere standardization\tis\tincredibly\timportant.\tWith\tservices\tcollaborating\tin\tlots\tof\tdifferent ways\tto\tprovide\tcapabilities\tto\tusers\tusing\tmultiple\tinterfaces,\tyou\tneed\tto\tview\tthe system\tin\ta\tholistic\tway.\n\nYou\tshould\ttry\tto\twrite\tyour\tlogs\tout\tin\ta\tstandard\tformat.\tYou\tdefinitely\twant\tto\thave\tall your\tmetrics\tin\tone\tplace,\tand\tyou\tmay\twant\tto\thave\ta\tlist\tof\tstandard\tnames\tfor\tyour metrics\ttoo;\tit\twould\tbe\tvery\tannoying\tfor\tone\tservice\tto\thave\ta\tmetric\tcalled ResponseTime,\tand\tanother\tto\thave\tone\tcalled\tRspTimeSecs,\twhen\tthey\tmean\tthe\tsame thing.\n\nAs\talways\twith\tstandardization,\ttools\tcan\thelp.\tAs\tI’ve\tsaid\tbefore,\tthe\tkey\tis\tmaking\tit easy\tto\tdo\tthe\tright\tthing\t—\tso\twhy\tnot\tprovide\tpreconfigured\tvirtual\tmachine\timages with\tlogstash\tand\tcollectd\tready\tto\tgo,\talong\twith\tapplication\tlibraries\tthat\tlet\tyou\ttalk\tto Graphite\treally\teasily?",
      "content_length": 1120,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 282,
      "content": "Consider\tthe\tAudience\n\nAll\tthis\tdata\twe\tare\tgathering\tis\tfor\ta\tpurpose.\tMore\tspecifically,\twe\tare\tgathering\tall\tthis data\tfor\tdifferent\tpeople\tto\thelp\tthem\tdo\ttheir\tjobs;\tthis\tdata\tbecomes\ta\tcall\tto\taction. Some\tof\tthis\tdata\tneeds\tto\ttrigger\tan\timmediate\tcall\tto\taction\tfor\tour\tsupport\tteam\t—\tfor example,\tin\tthe\tcase\tof\tone\tof\tour\tsynthetic\tmonitoring\ttests\tfailing.\tOther\tdata,\tlike\tthe fact\tthat\tour\tCPU\tload\thas\tincreased\tby\t2%\tover\tthe\tlast\tweek,\tis\tpotentially\tonly\tof interest\twhen\twe’re\tdoing\tcapacity\tplanning.\tLikewise,\tyour\tboss\tis\tprobably\tgoing\tto want\tto\tknow\tright\taway\tthat\trevenue\tdipped\t25%\tafter\tthe\tlast\trelease,\tbut\tprobably doesn’t\tneed\tto\tbe\twoken\tup\tbecause\tsearches\tfor\t“Justin\tBieber”\thave\tgone\tup\t5%\tin\tthe last\thour.\n\nWhat\tour\tpeople\twant\tto\tsee\tand\treact\tto\tright\tnow\tis\tdifferent\tthan\twhat\tthey\tneed\twhen drilling\tdown.\tSo,\tfor\tthe\ttype\tof\tperson\twho\twill\tbe\tlooking\tat\tthis\tdata,\tconsider\tthe following:\n\nWhat\tthey\tneed\tto\tknow\tright\tnow\n\nWhat\tthey\tmight\twant\tlater\n\nHow\tthey\tlike\tto\tconsume\tdata\n\nAlert\ton\tthe\tthings\tthey\tneed\tto\tknow\tright\tnow.\tCreate\tbig\tvisible\tdisplays\twith\tthis information\tthat\tsit\tin\tthe\tcorner\tof\tthe\troom.\tGive\tthem\teasy\taccess\tto\tthe\tdata\tthey\tneed to\tknow\tlater.\tAnd\tspend\ttime\twith\tthem\tto\tknow\thow\tthey\twant\tto\tconsume\tdata.\tA discussion\tabout\tall\tthe\tnuances\tinvolved\tin\tthe\tgraphical\tdisplay\tof\tquantitative information\tis\tcertainly\toutside\tthe\tscope\tof\tthis\tbook,\tbut\ta\tgreat\tplace\tto\tstart\tis\tStephen Few’s\texcellent\tbook\tInformation\tDashboard\tDesign:\tDisplaying\tData\tfor\tAt-a-Glance Monitoring\t(Analytics\tPress).",
      "content_length": 1579,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 283,
      "content": "The\tFuture\n\nI\thave\tseen\tmany\torganizations\twhere\tmetrics\tare\tsiloed\tinto\tdifferent\tsystems. Application-level\tmetrics,\tlike\tthe\tnumber\tof\torders\tplaced,\tend\tup\tin\ta\tproprietary analytics\tsystem\tlike\tOmniture,\twhich\tis\toften\tavailable\tonly\tto\tselect\tparts\tof\tthe business,\tor\telse\tends\tup\tin\tthe\tdreaded\tdata\twarehouse,\taka\twhere\tdata\tgoes\tto\tdie. Reporting\tfrom\tsuch\tsystems\tis\toften\tnot\tavailable\tin\treal\ttime,\talthough\tthat\tis\tstarting\tto change.\tMeanwhile,\tsystem\tmetrics\tlike\tresponse\ttimes,\terror\trates,\tand\tCPU\tload\tare stored\tin\tsystems\tthat\tthe\toperations\tteams\tcan\taccess.\tThese\tsystems\ttypically\tallow\tfor real-time\treporting,\tas\tnormally\tthe\tpoint\tof\tthem\tis\tto\tprovoke\tan\timmediate\tcall\tto action.\n\nHistorically,\tthe\tidea\tthat\twe\tcan\tfind\tout\tabout\tkey\tbusiness\tmetrics\ta\tday\tor\ttwo\tlater was\tfine,\tas\ttypically\twe\twere\tunable\tto\treact\tfast\tenough\tto\tthis\tdata\tto\tdo\tanything\tabout it\tanyway.\tNow,\tthough,\twe\toperate\tin\ta\tworld\tin\twhich\tmany\tof\tus\tcan\tand\tdo\tpush\tout multiple\treleases\tper\tday.\tTeams\tnow\tmeasure\tthemselves\tnot\tin\tterms\tof\thow\tmany points\tthey\tcomplete,\tbut\tinstead\toptimize\tfor\thow\tlong\tit\ttakes\tfor\tcode\tto\tget\tfrom laptop\tto\tlive.\tIn\tsuch\tan\tenvironment,\twe\tneed\tall\tour\tmetrics\tat\tour\tfingertips\tto\ttake\tthe right\taction.\tIronically,\tthe\tvery\tsystems\tthat\tstore\tbusiness\tmetrics\tare\toften\tnot\ttuned\tfor immediate\taccess\tto\tdata,\tbut\tour\toperational\tsystems\tare.\n\nSo\twhy\thandle\toperational\tand\tbusiness\tmetrics\tin\tthe\tsame\tway?\tUltimately,\tboth\ttypes of\tthings\tbreak\tdown\tto\tevents\tthat\tsay\tsomething\thappened\tat\tX.\tSo,\tif\twe\tcan\tunify\tthe systems\twe\tuse\tto\tgather,\taggregate,\tand\tstore\tthese\tevents,\tand\tmake\tthem\tavailable\tfor reporting,\twe\tend\tup\twith\ta\tmuch\tsimpler\tarchitecture.\n\nRiemann\tis\tan\tevent\tserver\tthat\tallows\tfor\tfairly\tadvanced\taggregation\tand\trouting\tof events\tand\tcan\tform\tpart\tof\tsuch\ta\tsolution.\tSuro\tis\tNetflix’s\tdata\tpipeline\tand\toperates\tin a\tsimilar\tspace.\tSuro\tis\texplicitly\tused\tto\thandle\tboth\tmetrics\tassociated\twith\tuser behavior,\tand\tmore\toperational\tdata\tlike\tapplication\tlogs.\tThis\tdata\tcan\tthen\tbe\tdispatched to\ta\tvariety\tof\tsystems,\tlike\tStorm\tfor\treal-time\tanalysis,\tHadoop\tfor\toffline\tbatch processing,\tor\tKibana\tfor\tlog\tanalysis.\n\nMany\torganizations\tare\tmoving\tin\ta\tfundamentally\tdifferent\tdirection:\taway\tfrom\thaving specialized\ttool\tchains\tfor\tdifferent\ttypes\tof\tmetrics\tand\ttoward\tmore\tgeneric\tevent routing\tsystems\tcapable\tof\tsignificant\tscale.\tThese\tsystems\tmanage\tto\tprovide\tmuch\tmore flexibility,\twhile\tat\tthe\tsame\ttime\tactually\tsimplifying\tour\tarchitecture.",
      "content_length": 2533,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 284,
      "content": "Summary\n\nSo,\twe’ve\tcovered\ta\tlot\there!\tI’ll\tattempt\tto\tsummarize\tthis\tchapter\tinto\tsome\teasy-to- follow\tadvice.\n\nFor\teach\tservice:\n\nTrack\tinbound\tresponse\ttime\tat\ta\tbare\tminimum.\tOnce\tyou’ve\tdone\tthat,\tfollow\twith error\trates\tand\tthen\tstart\tworking\ton\tapplication-level\tmetrics.\n\nTrack\tthe\thealth\tof\tall\tdownstream\tresponses,\tat\ta\tbare\tminimum\tincluding\tthe response\ttime\tof\tdownstream\tcalls,\tand\tat\tbest\ttracking\terror\trates.\tLibraries\tlike Hystrix\tcan\thelp\there.\n\nStandardize\ton\thow\tand\twhere\tmetrics\tare\tcollected.\n\nLog\tinto\ta\tstandard\tlocation,\tin\ta\tstandard\tformat\tif\tpossible.\tAggregation\tis\ta\tpain\tif every\tservice\tuses\ta\tdifferent\tlayout!\n\nMonitor\tthe\tunderlying\toperating\tsystem\tso\tyou\tcan\ttrack\tdown\trogue\tprocesses\tand do\tcapacity\tplanning.\n\nFor\tthe\tsystem:\n\nAggregate\thost-level\tmetrics\tlike\tCPU\ttogether\twith\tapplication-level\tmetrics.\n\nEnsure\tyour\tmetric\tstorage\ttool\tallows\tfor\taggregation\tat\ta\tsystem\tor\tservice\tlevel, and\tdrill\tdown\tto\tindividual\thosts.\n\nEnsure\tyour\tmetric\tstorage\ttool\tallows\tyou\tto\tmaintain\tdata\tlong\tenough\tto understand\ttrends\tin\tyour\tsystem.\n\nHave\ta\tsingle,\tqueryable\ttool\tfor\taggregating\tand\tstoring\tlogs.\n\nStrongly\tconsider\tstandardizing\ton\tthe\tuse\tof\tcorrelation\tIDs.\n\nUnderstand\twhat\trequires\ta\tcall\tto\taction,\tand\tstructure\talerting\tand\tdashboards accordingly.\n\nInvestigate\tthe\tpossibility\tof\tunifying\thow\tyou\taggregate\tall\tof\tyour\tvarious\tmetrics by\tseeing\tif\ta\ttool\tlike\tSuro\tor\tRiemann\tmakes\tsense\tfor\tyou.\n\nI’ve\talso\tattempted\tto\toutline\tthe\tdirection\tin\twhich\tmonitoring\tis\tmoving:\taway\tfrom systems\tspecialized\tto\tdo\tjust\tone\tthing,\tand\ttoward\tgeneric\tevent\tprocessing\tsystems\tthat allow\tyou\tto\tlook\tat\tyour\tsystem\tin\ta\tmore\tholistic\tway.\tThis\tis\tan\texciting\tand\temerging space,\tand\twhile\ta\tfull\tinvestigation\tis\toutside\tthe\tscope\tof\tthis\tbook,\thopefully\tI’ve\tgiven you\tenough\tto\tget\tstarted\twith.\tIf\tyou\twant\tto\tknow\tmore,\tI\tgo\tinto\tsome\tof\tthese\tideas",
      "content_length": 1903,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 285,
      "content": "and\tmore\tin\tmy\tearlier\tpublication\tLightweight\tSystems\tfor\tRealtime\tMonitoring (O’Reilly).\n\nIn\tthe\tnext\tchapter,\twe’ll\ttake\ta\tdifferent\tholistic\tview\tof\tour\tsystems\tto\tconsider\tsome\tof the\tunique\tadvantages\t—\tand\tchallenges\t—\tthat\tfine-grained\tarchitectures\tcan\tprovide\tin the\tarea\tof\tsecurity.",
      "content_length": 294,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 286,
      "content": "Chapter\t9.\tSecurity\n\nWe’ve\tbecome\tfamiliar\twith\tstories\tabout\tsecurity\tbreaches\tof\tlarge-scale\tsystems resulting\tin\tour\tdata\tbeing\texposed\tto\tall\tsorts\tof\tdodgy\tcharacters.\tBut\tmore\trecently, events\tlike\tthe\tEdward\tSnowden\trevelations\thave\tmade\tus\teven\tmore\taware\tof\tthe\tvalue of\tdata\tthat\tcompanies\thold\tabout\tus,\tand\tthe\tvalue\tof\tdata\tthat\twe\thold\tfor\tour\tcustomers in\tthe\tsystems\twe\tbuild.\tThis\tchapter\twill\tgive\ta\tbrief\toverview\tof\tsome\taspects\tof security\tyou\tshould\tconsider\twhen\tdesigning\tyour\tsystems.\tWhile\tnot\tmeant\tto\tbe exhaustive,\tit\twill\tlay\tout\tsome\tof\tthe\tmain\toptions\tavailable\tto\tyou\tand\tgive\tyou\ta starting\tpoint\tfor\tyour\town\tfurther\tresearch.\n\nWe\tneed\tto\tthink\tabout\twhat\tprotection\tour\tdata\tneeds\twhile\tin\ttransit\tfrom\tone\tpoint\tto another,\tand\twhat\tprotection\tit\tneeds\tat\trest.\tWe\tneed\tto\tthink\tabout\tthe\tsecurity\tof\tour underlying\toperating\tsystems,\tand\tour\tnetworks\ttoo.\tThere\tis\tso\tmuch\tto\tthink\tabout,\tand so\tmuch\twe\tcould\tdo!\tSo\thow\tmuch\tsecurity\tdo\twe\tneed?\tHow\tcan\twe\twork\tout\twhat\tis enough\tsecurity?\n\nBut\twe\talso\tneed\tto\tthink\tof\tthe\thuman\telement.\tHow\tdo\twe\tknow\twho\ta\tperson\tis,\tand what\the\tcan\tdo?\tAnd\thow\tdoes\tthis\trelate\tto\thow\tour\tservers\ttalk\tto\teach\tother?\tLet’s\tstart there.",
      "content_length": 1214,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 287,
      "content": "Authentication\tand\tAuthorization\n\nAuthentication\tand\tauthorization\tare\tcore\tconcepts\twhen\tit\tcomes\tto\tpeople\tand\tthings that\tinteract\twith\tour\tsystem.\tIn\tthe\tcontext\tof\tsecurity,\tauthentication\tis\tthe\tprocess\tby which\twe\tconfirm\tthat\ta\tparty\tis\twho\tshe\tsays\tshe\tis.\tFor\ta\thuman,\tyou\ttypically authenticate\ta\tuser\tby\thaving\ther\ttype\tin\ther\tusername\tand\tpassword.\tWe\tassume\tthat\tonly she\thas\taccess\tto\tthis\tinformation,\tand\ttherefore\tthat\tthe\tperson\tentering\tthis\tinformation must\tbe\ther.\tOther,\tmore\tcomplex\tsystems\texist\tas\twell,\tof\tcourse.\tMy\tphone\tnow\tlets\tme use\tmy\tfingerprint\tto\tconfirm\tthat\tI\tam\twho\tI\tsay\tI\tam.\tGenerally,\twhen\twe’re\ttalking abstractly\tabout\twho\tor\twhat\tis\tbeing\tauthenticated,\twe\trefer\tto\tthat\tparty\tas\tthe\tprincipal.\n\nAuthorization\tis\tthe\tmechanism\tby\twhich\twe\tmap\tfrom\ta\tprincipal\tto\tthe\taction\twe\tare allowing\ther\tto\tdo.\tOften,\twhen\ta\tprincipal\tis\tauthenticated,\twe\twill\tbe\tgiven\tinformation about\ther\tthat\twill\thelp\tus\tdecide\twhat\twe\tshould\tlet\ther\tdo.\tWe\tmight,\tfor\texample,\tbe told\twhat\tdepartment\tor\toffice\tshe\tworks\tin\t—\tpieces\tof\tinformation\tthat\tour\tsystems\tcan use\tto\tdecide\twhat\tshe\tcan\tand\tcannot\tdo.\n\nFor\tsingle,\tmonolithic\tapplications,\tit\tis\tcommon\tfor\tthe\tapplication\titself\tto\thandle authentication\tand\tauthorization\tfor\tyou.\tDjango,\tthe\tPython\tweb\tframework,\tcomes\tout of\tthe\tbox\twith\tuser\tmanagement,\tfor\texample.\tWhen\tit\tcomes\tto\tdistributed\tsystems, though,\twe\tneed\tto\tthink\tof\tmore\tadvanced\tschemes.\tWe\tdon’t\twant\teveryone\tto\thave\tto log\tin\tseparately\tfor\tdifferent\tsystems,\tusing\ta\tdifferent\tusername\tand\tpassword\tfor\teach. The\taim\tis\tto\thave\ta\tsingle\tidentity\tthat\twe\tcan\tauthenticate\tonce.",
      "content_length": 1639,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 288,
      "content": "Common\tSingle\tSign-On\tImplementations\n\nA\tcommon\tapproach\tto\tauthentication\tand\tauthorization\tis\tto\tuse\tsome\tsort\tof\tsingle\tsign- on\t(SSO)\tsolution.\tSAML,\twhich\tis\tthe\treigning\timplementation\tin\tthe\tenterprise\tspace, and\tOpenID\tConnect\tboth\tprovide\tcapabilities\tin\tthis\tarea.\tMore\tor\tless\tthey\tuse\tthe\tsame core\tconcepts,\talthough\tthe\tterminology\tdiffers\tslightly.\tThe\tterms\tused\there\tare\tfrom SAML.\n\nWhen\ta\tprincipal\ttries\tto\taccess\ta\tresource\t(like\ta\tweb-based\tinterface),\tshe\tis\tdirected\tto authenticate\twith\tan\tidentity\tprovider.\tThis\tmay\task\ther\tto\tprovide\ta\tusername\tand password,\tor\tmight\tuse\tsomething\tmore\tadvanced\tlike\ttwo-factor\tauthentication.\tOnce\tthe identity\tprovider\tis\tsatisfied\tthat\tthe\tprincipal\thas\tbeen\tauthenticated,\tit\tgives\tinformation to\tthe\tservice\tprovider,\tallowing\tit\tto\tdecide\twhether\tto\tgrant\ther\taccess\tto\tthe\tresource.\n\nThis\tidentity\tprovider\tcould\tbe\tan\texternally\thosted\tsystem,\tor\tsomething\tinside\tyour\town organization.\tGoogle,\tfor\texample,\tprovides\tan\tOpenID\tConnect\tidentity\tprovider.\tFor enterprises,\tthough,\tit\tis\tcommon\tto\thave\tyour\town\tidentity\tprovider,\twhich\tmay\tbe\tlinked to\tyour\tcompany’s\tdirectory\tservice.\tA\tdirectory\tservice\tcould\tbe\tsomething\tlike\tthe Lightweight\tDirectory\tAccess\tProtocol\t(LDAP)\tor\tActive\tDirectory.\tThese\tsystems\tallow you\tto\tstore\tinformation\tabout\tprincipals,\tsuch\tas\twhat\troles\tthey\tplay\tin\tthe\torganization. Often,\tthe\tdirectory\tservice\tand\tthe\tidentity\tprovider\tare\tone\tand\tthe\tsame,\twhile sometimes\tthey\tare\tseparate\tbut\tlinked.\tOkta,\tfor\texample,\tis\ta\thosted\tSAML\tidentity provider\tthat\thandles\ttasks\tlike\ttwo-factor\tauthentication,\tbut\tcan\tlink\tto\tyour\tcompany’s directory\tservices\tas\tthe\tsource\tof\ttruth.\n\nSAML\tis\ta\tSOAP-based\tstandard,\tand\tis\tknown\tfor\tbeing\tfairly\tcomplex\tto\twork\twith despite\tthe\tlibraries\tand\ttooling\tavailable\tto\tsupport\tit.\tOpenID\tConnect\tis\ta\tstandard\tthat has\temerged\tas\ta\tspecific\timplementation\tof\tOAuth\t2.0,\tbased\ton\tthe\tway\tGoogle\tand others\thandle\tSSO.\tIt\tuses\tsimpler\tREST\tcalls,\tand\tin\tmy\topinion\tis\tlikely\tto\tmake inroads\tinto\tenterprises\tdue\tto\tits\timproved\tease\tof\tuse.\tIts\tbiggest\tstumbling\tblock\tright now\tis\tthe\tlack\tof\tidentity\tproviders\tthat\tsupport\tit.\tFor\ta\tpublic-facing\twebsite,\tyou\tmight be\tOK\tusing\tGoogle\tas\tyour\tprovider,\tbut\tfor\tinternal\tsystems\tor\tsystems\twhere\tyou\twant more\tcontrol\tover\tand\tvisibility\tinto\thow\tand\twhere\tyour\tdata\tis\tinstalled,\tyou’ll\twant your\town\tin-house\tidentity\tprovider.\tAt\tthe\ttime\tof\twriting,\tOpenAM\tand\tGluu\tare\ttwo\tof the\tvery\tfew\toptions\tavailable\tin\tthis\tspace,\tcompared\tto\ta\twealth\tof\toptions\tfor\tSAML (including\tActive\tDirectory,\twhich\tseems\tto\tbe\teverywhere).\tUntil\tand\tunless\texisting identity\tproviders\tstart\tsupporting\tOpenID\tConnect,\tits\tgrowth\tmay\tbe\tlimited\tto\tthose situations\twhere\tpeople\tare\thappy\tusing\ta\tpublic\tidentity\tprovider.\n\nSo\twhile\tI\tthink\tOpenID\tConnect\tis\tthe\tfuture,\tit’s\tquite\tpossible\tit’ll\ttake\ta\twhile\tto\treach widespread\tadoption.",
      "content_length": 2919,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 289,
      "content": "Single\tSign-On\tGateway\n\nWithin\ta\tmicroservice\tsetup,\teach\tservice\tcould\tdecide\tto\thandle\tthe\tredirection\tto,\tand handshaking\twith,\tthe\tidentity\tprovider.\tObviously,\tthis\tcould\tmean\ta\tlot\tof\tduplicated work.\tA\tshared\tlibrary\tcould\thelp,\tbut\twe’d\thave\tto\tbe\tcareful\tto\tavoid\tthe\tcoupling\tthat can\tcome\tfrom\tshared\tcode.\tThis\talso\twouldn’t\thelp\tif\tyou\thad\tmultiple\tdifferent technology\tstacks.\n\nRather\tthan\thaving\teach\tservice\tmanage\thandshaking\twith\tyour\tidentity\tprovider,\tyou\tcan use\ta\tgateway\tto\tact\tas\ta\tproxy,\tsitting\tbetween\tyour\tservices\tand\tthe\toutside\tworld\t(as shown\tin\tFigure\t9-1).\tThe\tidea\tis\tthat\twe\tcan\tcentralize\tthe\tbehavior\tfor\tredirecting\tthe user\tand\tperform\tthe\thandshake\tin\tonly\tone\tplace.\n\nFigure\t9-1.\tUsing\ta\tgateway\tto\thandle\tSSO\n\nHowever,\twe\tstill\tneed\tto\tsolve\tthe\tproblem\tof\thow\tthe\tdownstream\tservice\treceives information\tabout\tprincipals,\tsuch\tas\ttheir\tusername\tor\twhat\troles\tthey\tplay.\tIf\tyou’re using\tHTTP,\tit\tcould\tpopulate\theaders\twith\tthis\tinformation.\tShibboleth\tis\tone\ttool\tthat can\tdo\tthis\tfor\tyou,\tand\tI’ve\tseen\tit\tused\twith\tApache\tto\tgreat\teffect\tto\thandle\tintegration with\tSAML-based\tidentity\tproviders.\n\nAnother\tproblem\tis\tthat\tif\twe\thave\tdecided\tto\toffload\tresponsibility\tfor\tauthentication\tto\ta gateway,\tit\tcan\tbe\tharder\tto\treason\tabout\thow\ta\tmicroservice\tbehaves\twhen\tlooking\tat\tit in\tisolation.\tRemember\tin\tChapter\t7\twhere\twe\texplored\tsome\tof\tthe\tchallenges\tin reproducing\tproduction-like\tenvironments?\tIf\tyou\tgo\tthe\tgateway\troute,\tmake\tsure\tyour developers\tcan\tlaunch\ttheir\tservices\tbehind\tone\twithout\ttoo\tmuch\twork.\n\nOne\tfinal\tproblem\twith\tthis\tapproach\tis\tthat\tit\tcan\tlull\tyou\tinto\ta\tfalse\tsense\tof\tsecurity.\tI like\tthe\tidea\tof\tdefense\tin\tdepth\t—\tfrom\tnetwork\tperimeter,\tto\tsubnet,\tto\tfirewall,\tto",
      "content_length": 1743,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 290,
      "content": "machine,\tto\toperating\tsystem,\tto\tthe\tunderlying\thardware.\tYou\thave\tthe\tability\tto implement\tsecurity\tmeasures\tat\tall\tof\tthese\tpoints,\tsome\tof\twhich\twe’ll\tget\tinto\tshortly.\tI have\tseen\tsome\tpeople\tput\tall\ttheir\teggs\tin\tone\tbasket,\trelying\ton\tthe\tgateway\tto\thandle every\tstep\tfor\tthem.\tAnd\twe\tall\tknow\twhat\thappens\twhen\twe\thave\ta\tsingle\tpoint\tof failure…\n\nObviously\tyou\tcould\tuse\tthis\tgateway\tto\tdo\tother\tthings.\tIf\tusing\ta\tlayer\tof\tApache instances\trunning\tShibboleth,\tfor\texample,\tyou\tcould\talso\tdecide\tto\tterminate\tHTTPS\tat this\tlevel,\trun\tintrusion\tdetection,\tand\tso\ton.\tDo\tbe\tcareful,\tthough.\tGateway\tlayers\ttend to\ttake\ton\tmore\tand\tmore\tfunctionality,\twhich\titself\tcan\tend\tup\tbeing\ta\tgiant\tcoupling point.\tAnd\tthe\tmore\tfunctionality\tsomething\thas,\tthe\tgreater\tthe\tattack\tsurface.",
      "content_length": 783,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 291,
      "content": "Fine-Grained\tAuthorization\n\nA\tgateway\tmay\tbe\table\tto\tprovide\tfairly\teffective\tcoarse-grained\tauthentication.\tFor example,\tit\tcould\tprevent\taccess\tto\tany\tnon-logged-in\tuser\tto\tthe\thelpdesk\tapplication. Assuming\tour\tgateway\tcan\textract\tattributes\tabout\tthe\tprincipal\tas\ta\tresult\tof\tthe authentication,\tit\tmay\tbe\table\tto\tmake\tmore\tnuanced\tdecisions.\tFor\texample,\tit\tis\tcommon to\tplace\tpeople\tin\tgroups,\tor\tassign\tthem\tto\troles.\tWe\tcan\tuse\tthis\tinformation\tto understand\twhat\tthey\tcan\tdo.\tSo\tfor\tthe\thelpdesk\tapplication,\twe\tmight\tallow\taccess\tonly to\tprincipals\twith\ta\tspecific\trole\t(e.g.,\tSTAFF).\tBeyond\tallowing\t(or\tdisallowing)\taccess to\tspecific\tresources\tor\tendpoints,\tthough,\twe\tneed\tto\tleave\tthe\trest\tto\tthe\tmicroservice itself;\tit\twill\tneed\tto\tmake\tfurther\tdecisions\tabout\twhat\toperations\tto\tallow.\n\nBack\tto\tour\thelpdesk\tapplication:\tdo\twe\tallow\tany\tstaff\tmembers\tto\tsee\tany\tand\tall details?\tMore\tlikely,\twe’ll\thave\tdifferent\troles\tat\twork.\tFor\texample,\ta\tprincipal\tin\tthe CALL_CENTER\tgroup\tmight\tbe\tallowed\tto\tview\tany\tpiece\tof\tinformation\tabout\ta customer\texcept\this\tpayment\tdetails.\tThe\tprincipal\tmight\talso\tbe\table\tto\tissue\trefunds,\tbut that\tamount\tmight\tbe\tcapped.\tSomeone\twho\thas\tthe\tCALL_CENTER_TEAM_LEADER role,\thowever,\tmight\tbe\table\tto\tissue\tlarger\trefunds.\n\nThese\tdecisions\tneed\tto\tbe\tlocal\tto\tthe\tmicroservice\tin\tquestion.\tI\thave\tseen\tpeople\tuse the\tvarious\tattributes\tsupplied\tby\tidentity\tproviders\tin\thorrible\tways,\tusing\treally\tfine- grained\troles\tlike\tCALL_CENTER_50_DOLLAR_REFUND,\twhere\tthey\tend\tup\tputting information\tspecific\tto\tone\tpart\tof\tone\tof\tour\tsystem’s\tbehavior\tinto\ttheir\tdirectory services.\tThis\tis\ta\tnightmare\tto\tmaintain\tand\tgives\tvery\tlittle\tscope\tfor\tour\tservices\tto have\ttheir\town\tindependent\tlifecycle,\tas\tsuddenly\ta\tchunk\tof\tinformation\tabout\thow\ta service\tbehaves\tlives\telsewhere,\tperhaps\tin\ta\tsystem\tmanaged\tby\ta\tdifferent\tpart\tof\tthe organization.\n\nInstead,\tfavor\tcoarse-grained\troles,\tmodeled\taround\thow\tyour\torganization\tworks.\tGoing all\tthe\tway\tback\tto\tthe\tearly\tchapters,\tremember\tthat\twe\tare\tbuilding\tsoftware\tto\tmatch how\tour\torganization\tworks.\tSo\tuse\tyour\troles\tin\tthis\tway\ttoo.",
      "content_length": 2130,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 292,
      "content": "Service-to-Service\tAuthentication\tand\tAuthorization\n\nUp\tto\tthis\tpoint\twe’ve\tbeen\tusing\tthe\tterm\tprincipal\tto\tdescribe\tanything\tthat\tcan authenticate\tand\tbe\tauthorized\tto\tdo\tthings,\tbut\tour\texamples\thave\tactually\tbeen\tabout humans\tusing\tcomputers.\tBut\twhat\tabout\tprograms,\tor\tother\tservices,\tauthenticating\twith each\tother?",
      "content_length": 322,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 293,
      "content": "Allow\tEverything\tInside\tthe\tPerimeter\n\nOur\tfirst\toption\tcould\tbe\tto\tjust\tassume\tthat\tany\tcalls\tto\ta\tservice\tmade\tfrom\tinside\tour perimeter\tare\timplicitly\ttrusted.\n\nDepending\ton\tthe\tsensitivity\tof\tthe\tdata,\tthis\tmight\tbe\tfine.\tSome\torganizations\tattempt\tto ensure\tsecurity\tat\tthe\tperimeter\tof\ttheir\tnetworks,\tand\ttherefore\tassume\tthey\tdon’t\tneed\tto do\tanything\telse\twhen\ttwo\tservices\tare\ttalking\ttogether.\tHowever,\tshould\tan\tattacker penetrate\tyour\tnetwork,\tyou\twill\thave\tlittle\tprotection\tagainst\ta\ttypical\tman-in-the-middle attack.\tIf\tthe\tattacker\tdecides\tto\tintercept\tand\tread\tthe\tdata\tbeing\tsent,\tchange\tthe\tdata without\tyou\tknowing,\tor\teven\tin\tsome\tcircumstances\tpretend\tto\tbe\tthe\tthing\tyou\tare talking\tto,\tyou\tmay\tnot\tknow\tmuch\tabout\tit.\n\nThis\tis\tby\tfar\tthe\tmost\tcommon\tform\tof\tinside-perimeter\ttrust\tI\tsee\tin\torganizations.\tThey may\tdecide\tto\trun\tthis\ttraffic\tover\tHTTPS,\tbut\tthey\tdon’t\tdo\tmuch\telse.\tI’m\tnot\tsaying that\tis\ta\tgood\tthing!\tFor\tmost\tof\tthe\torganizations\tI\tsee\tusing\tthis\tmodel,\tI\tworry\tthat\tthe implicit\ttrust\tmodel\tis\tnot\ta\tconscious\tdecision,\tbut\tmore\tthat\tpeople\tare\tunaware\tof\tthe risks\tin\tthe\tfirst\tplace.",
      "content_length": 1130,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 294,
      "content": "HTTP(S)\tBasic\tAuthentication\n\nHTTP\tBasic\tAuthentication\tallows\tfor\ta\tclient\tto\tsend\ta\tusername\tand\tpassword\tin\ta standard\tHTTP\theader.\tThe\tserver\tcan\tthen\tcheck\tthese\tdetails\tand\tconfirm\tthat\tthe\tclient is\tallowed\tto\taccess\tthe\tservice.\tThe\tadvantage\there\tis\tthat\tthis\tis\tan\textremely\twell- understood\tand\twell-supported\tprotocol.\tThe\tproblem\tis\tthat\tdoing\tthis\tover\tHTTP\tis highly\tproblematic,\tas\tthe\tusername\tand\tpassword\tare\tnot\tsent\tin\ta\tsecure\tmanner.\tAny intermediate\tparty\tcan\tlook\tat\tthe\tinformation\tin\tthe\theader\tand\tsee\tthe\tdata.\tThus,\tHTTP Basic\tAuthentication\tshould\tnormally\tbe\tused\tover\tHTTPS.\n\nWhen\tusing\tHTTPS,\tthe\tclient\tgains\tstrong\tguarantees\tthat\tthe\tserver\tit\tis\ttalking\tto\tis who\tthe\tclient\tthinks\tit\tis.\tIt\talso\tgives\tus\tadditional\tprotection\tagainst\tpeople eavesdropping\ton\tthe\ttraffic\tbetween\tthe\tclient\tand\tserver\tor\tmessing\twith\tthe\tpayload.\n\nThe\tserver\tneeds\tto\tmanage\tits\town\tSSL\tcertificates,\twhich\tcan\tbecome\tproblematic\twhen it\tis\tmanaging\tmultiple\tmachines.\tSome\torganizations\ttake\ton\ttheir\town\tcertificate\tissuing process,\twhich\tis\tan\tadditional\tadministrative\tand\toperational\tburden.\tTools\taround managing\tthis\tin\tan\tautomated\tfashion\tare\tnowhere\tnear\tas\tmature\tas\tthey\tcould\tbe,\tand\tit isn’t\tjust\tthe\tissuing\tprocess\tyou\thave\tto\thandle.\tSelf-signed\tcertificates\tare\tnot\teasily revokable,\tand\tthus\trequire\ta\tlot\tmore\tthought\taround\tdisaster\tscenarios.\tSee\tif\tyou\tcan dodge\tall\tthis\twork\tby\tavoiding\tself-signing\taltogether.\n\nAnother\tdownside\tis\tthat\ttraffic\tsent\tvia\tSSL\tcannot\tbe\tcached\tby\treverse\tproxies\tlike Varnish\tor\tSquid.\tThis\tmeans\tthat\tif\tyou\tneed\tto\tcache\ttraffic,\tit\twill\thave\tto\tbe\tdone either\tinside\tthe\tserver\tor\tinside\tthe\tclient.\tYou\tcan\tfix\tthis\tby\thaving\ta\tload\tbalancer terminate\tthe\tSSL\ttraffic,\tand\thaving\tthe\tcache\tsit\tbehind\tthe\tload\tbalancer.\n\nWe\talso\thave\tto\tthink\tabout\twhat\thappens\tif\twe\tare\tusing\tan\texisting\tSSO\tsolution,\tlike SAML,\tthat\talready\thas\taccess\tto\tusernames\tand\tpasswords.\tDo\twe\twant\tour\tbasic\tservice auth\tto\tuse\tthe\tsame\tset\tof\tcredentials,\tallowing\tus\tone\tprocess\tfor\tissuing\tand\trevoking them?\tWe\tcould\tdo\tthis\tby\thaving\tthe\tservice\ttalk\tto\tthe\tsame\tdirectory\tservice\tthat\tbacks our\tSSO\tsolution.\tAlternatively,\twe\tcould\tstore\tthe\tusernames\tand\tpasswords\tourselves inside\tthe\tservice,\tbut\tthen\twe\trun\tthe\trisk\tof\tduplicating\tbehavior.\n\nOne\tnote:\tin\tthis\tapproach,\tall\tthe\tserver\tknows\tis\tthat\tthe\tclient\thas\tthe\tusername\tand password.\tWe\thave\tno\tidea\tif\tthis\tinformation\tis\tcoming\tfrom\ta\tmachine\twe\texpect;\tit could\tbe\tcoming\tfrom\tanyone\ton\tour\tnetwork.",
      "content_length": 2534,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 295,
      "content": "Use\tSAML\tor\tOpenID\tConnect\n\nIf\tyou\tare\talready\tusing\tSAML\tor\tOpenID\tConnect\tas\tyour\tauthentication\tand authorization\tscheme,\tyou\tcould\tjust\tuse\tthat\tfor\tservice-to-service\tinteractions\ttoo.\tIf you’re\tusing\ta\tgateway,\tyou’ll\tneed\tto\troute\tall\tin-network\ttraffic\tvia\tthe\tgateway\ttoo,\tbut if\teach\tservice\tis\thandling\tthe\tintegration\titself,\tthis\tapproach\tshould\tjust\twork\tout\tof\tthe box.\tThe\tadvantage\there\tis\tthat\tyou’re\tmaking\tuse\tof\texisting\tinfrastructure,\tand\tget\tto centralize\tall\tyour\tservice\taccess\tcontrols\tin\ta\tcentral\tdirectory\tserver.\tWe’d\tstill\tneed\tto route\tthis\tover\tHTTPS\tif\twe\twanted\tto\tavoid\tman-in-the-middle\tattacks.\n\nClients\thave\ta\tset\tof\tcredentials\tthey\tuse\tto\tauthenticate\tthemselves\twith\tthe\tidentity provider,\tand\tthe\tservice\tgets\tthe\tinformation\tit\tneeds\tto\tdecide\ton\tany\tfine-grained authentication.\n\nThis\tdoes\tmean\tyou’ll\tneed\tan\taccount\tfor\tyour\tclients,\tsometimes\treferred\tto\tas\ta\tservice account.\tMany\torganizations\tuse\tthis\tapproach\tquite\tcommonly.\tA\tword\tof\twarning, though:\tif\tyou\tare\tgoing\tto\tcreate\tservice\taccounts,\ttry\tto\tkeep\ttheir\tuse\tnarrow.\tSo consider\teach\tmicroservice\thaving\tits\town\tset\tof\tcredentials.\tThis\tmakes revoking/changing\taccess\teasier\tif\tthe\tcredentials\tbecome\tcompromised,\tas\tyou\tonly\tneed to\trevoke\tthe\tset\tof\tcredentials\tthat\thave\tbeen\taffected.\n\nThere\tare\ta\tcouple\tof\tother\tdownsides,\tthough.\tFirst,\tjust\tas\twith\tBasic\tAuth,\twe\tneed\tto securely\tstore\tour\tcredentials:\twhere\tdo\tthe\tusername\tand\tpassword\tlive?\tThe\tclient\twill need\tto\tfind\tsome\tsecure\tway\tto\tstore\tthis\tdata.\tThe\tother\tproblem\tis\tthat\tsome\tof\tthe technology\tin\tthis\tspace\tto\tdo\tthe\tauthentication\tis\tfairly\ttedious\tto\tcode\tfor.\tSAML,\tin particular,\tmakes\timplementing\ta\tclient\ta\tpainful\taffair.\tOpenID\tConnect\thas\ta\tsimpler workflow,\tbut\tas\twe\tdiscussed\tearlier\tit\tisn’t\tthat\twell\tsupported\tyet.",
      "content_length": 1818,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 296,
      "content": "Client\tCertificates\n\nAnother\tapproach\tto\tconfirm\tthe\tidentity\tof\ta\tclient\tis\tto\tmake\tuse\tof\tcapabilities\tin Transport\tLayer\tSecurity\t(TLS),\tthe\tsuccessor\tto\tSSL,\tin\tthe\tform\tof\tclient\tcertificates. Here,\teach\tclient\thas\tan\tX.509\tcertificate\tinstalled\tthat\tis\tused\tto\testablish\ta\tlink\tbetween client\tand\tserver.\tThe\tserver\tcan\tverify\tthe\tauthenticity\tof\tthe\tclient\tcertificate,\tproviding strong\tguarantees\tthat\tthe\tclient\tis\tvalid.\n\nThe\toperational\tchallenges\there\tin\tcertificate\tmanagement\tare\teven\tmore\tonerous\tthan with\tjust\tusing\tserver-side\tcertificates.\tIt\tisn’t\tjust\tsome\tof\tthe\tbasic\tissues\tof\tcreating\tand managing\ta\tgreater\tnumber\tof\tcertificates;\trather,\tit’s\tthat\twith\tall\tthe\tcomplexities\taround the\tcertificates\tthemselves,\tyou\tcan\texpect\tto\tspend\ta\tlot\tof\ttime\ttrying\tto\tdiagnose\twhy\ta service\twon’t\taccept\twhat\tyou\tbelieve\tto\tbe\ta\tcompletely\tvalid\tclient\tcertificate.\tAnd\tthen we\thave\tto\tconsider\tthe\tdifficulty\tof\trevoking\tand\treissuing\tcertificates\tshould\tthe\tworst happen.\tUsing\twildcard\tcertificates\tcan\thelp,\tbut\twon’t\tsolve\tall\tproblems.\tThis\tadditional burden\tmeans\tyou’ll\tbe\tlooking\tto\tuse\tthis\ttechnique\twhen\tyou\tare\tespecially\tconcerned about\tthe\tsensitivity\tof\tthe\tdata\tbeing\tsent,\tor\tif\tyou\tare\tsending\tdata\tvia\tnetworks\tyou don’t\tfully\tcontrol.\tSo\tyou\tmight\tdecide\tto\tsecure\tcommunication\tof\tvery\timportant\tdata between\tparties\tthat\tis\tsent\tover\tthe\tInternet,\tfor\texample.",
      "content_length": 1400,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 297,
      "content": "HMAC\tOver\tHTTP\n\nAs\twe\tdiscussed\tearlier,\tthe\tuse\tof\tBasic\tAuthentication\tover\tplain\tHTTP\tis\tnot\tterribly sensible\tif\twe\tare\tworried\tabout\tthe\tusername\tand\tpassword\tbeing\tcompromised.\tThe traditional\talternative\tis\troute\ttraffic\tHTTPS,\tbut\tthere\tare\tsome\tdownsides.\tAside\tfrom managing\tthe\tcertificates,\tthe\toverhead\tof\tHTTPS\ttraffic\tcan\tplace\tadditional\tstrain\ton servers\t(although,\tto\tbe\thonest,\tthis\thas\ta\tlower\timpact\tthan\tit\tdid\tseveral\tyears\tago),\tand the\ttraffic\tcannot\teasily\tbe\tcached.\n\nAn\talternative\tapproach,\tas\tused\textensively\tby\tAmazon’s\tS3\tAPIs\tfor\tAWS\tand\tin\tparts of\tthe\tOAuth\tspecification,\tis\tto\tuse\ta\thash-based\tmessaging\tcode\t(HMAC)\tto\tsign\tthe request.\n\nWith\tHMAC\tthe\tbody\trequest\talong\twith\ta\tprivate\tkey\tis\thashed,\tand\tthe\tresulting\thash\tis sent\talong\twith\tthe\trequest.\tThe\tserver\tthen\tuses\tits\town\tcopy\tof\tthe\tprivate\tkey\tand\tthe request\tbody\tto\tre-create\tthe\thash.\tIf\tit\tmatches,\tit\tallows\tthe\trequest.\tThe\tnice\tthing\there is\tthat\tif\ta\tman\tin\tthe\tmiddle\tmesses\twith\tthe\trequest,\tthen\tthe\thash\twon’t\tmatch\tand\tthe server\tknows\tthe\trequest\thas\tbeen\ttampered\twith.\tAnd\tthe\tprivate\tkey\tis\tnever\tsent\tin\tthe request,\tso\tit\tcannot\tbe\tcompromised\tin\ttransit!\tThe\tadded\tbenefit\tis\tthat\tthis\ttraffic\tcan then\tmore\teasily\tbe\tcached,\tand\tthe\toverhead\tof\tgenerating\tthe\thashes\tmay\twell\tbe\tlower than\thandling\tHTTPS\ttraffic\t(although\tyour\tmileage\tmay\tvary).\n\nThere\tare\tthree\tdownsides\tto\tthis\tapproach.\tFirst,\tboth\tthe\tclient\tand\tserver\tneed\ta\tshared secret\tthat\tneeds\tto\tbe\tcommunicated\tsomehow.\tHow\tdo\tthey\tshare\tit?\tIt\tcould\tbe hardcoded\tat\tboth\tends,\tbut\tthen\tyou\thave\tthe\tproblem\tof\trevoking\taccess\tif\tthe\tsecret becomes\tcompromised.\tIf\tyou\tcommunicate\tthis\tkey\tover\tsome\talternative\tprotocol,\tthen you\tneed\tto\tmake\tsure\tthat\tthat\tprotocol\tis\talso\tvery\tsecure!\n\nSecond,\tthis\tis\ta\tpattern,\tnot\ta\tstandard,\tand\tthus\tthere\tare\tdivergent\tways\tof implementing\tit.\tAs\ta\tresult,\tthere\tis\ta\tdearth\tof\tgood,\topen,\tand\tusable\timplementations of\tthis\tapproach.\tIn\tgeneral,\tif\tthis\tapproach\tinterests\tyou,\tthen\tdo\tsome\tmore\treading\tto understand\tthe\tdifferent\tways\tit\tis\tdone.\tI’d\tgo\tas\tfar\tas\tto\tsay\tjust\tlook\tat\thow\tAmazon does\tthis\tfor\tS3\tand\tcopy\tits\tapproach,\tespecially\tusing\ta\tsensible\thashing\tfunction\twith\ta suitably\tlong\tkey\tlike\tSHA-256.\tJSON\tweb\ttokens\t(JWT)\tare\talso\tworth\tlooking\tat,\tas they\timplement\ta\tvery\tsimilar\tapproach\tand\tseem\tto\tbe\tgaining\ttraction.\tBut\tbe\taware\tof the\tdifficulty\tof\tgetting\tthis\tstuff\tright.\tMy\tcolleague\twas\tworking\twith\ta\tteam\tthat\twas implementing\tits\town\tJWT\timplementation,\tomitted\ta\tsingle\tBoolean\tcheck,\tand invalidated\tits\tentire\tauthentication\tcode!\tHopefully\tover\ttime\twe’ll\tsee\tmore\treusable library\timplementations.\n\nFinally,\tunderstand\tthat\tthis\tapproach\tensures\tonly\tthat\tno\tthird\tparty\thas\tmanipulated\tthe request\tand\tthat\tthe\tprivate\tkey\titself\tremains\tprivate.\tThe\trest\tof\tthe\tdata\tin\tthe\trequest will\tstill\tbe\tvisible\tto\tparties\tsnooping\ton\tthe\tnetwork.",
      "content_length": 2918,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 298,
      "content": "API\tKeys\n\nAll\tpublic\tAPIs\tfrom\tservices\tlike\tTwitter,\tGoogle,\tFlickr,\tand\tAWS\tmake\tuse\tof\tAPI keys.\tAPI\tkeys\tallow\ta\tservice\tto\tidentify\twho\tis\tmaking\ta\tcall,\tand\tplace\tlimits\ton\twhat they\tcan\tdo.\tOften\tthe\tlimits\tgo\tbeyond\tsimply\tgiving\taccess\tto\ta\tresource,\tand\tcan\textend to\tactions\tlike\trate-limiting\tspecific\tcallers\tto\tprotect\tquality\tof\tservice\tfor\tother\tpeople.\n\nWhen\tit\tcomes\tto\tusing\tAPI\tkeys\tto\thandle\tyour\town\tmicroservice-to-microservice approach,\tthe\texact\tmechanics\tof\thow\tit\tworks\twill\tdepend\ton\tthe\ttechnology\tyou\tuse. Some\tsystems\tuse\ta\tsingle\tAPI\tkey\tthat\tis\tshared,\tand\tuse\tan\tapproach\tsimilar\tto\tHMAC as\tjust\tdescribed.\tA\tmore\tcommon\tapproach\tis\tto\tuse\ta\tpublic\tand\tprivate\tkey\tpair. Typically,\tyou’ll\tmanage\tkeys\tcentrally,\tjust\tas\twe\twould\tmanage\tidentities\tof\tpeople centrally.\tThe\tgateway\tmodel\tis\tvery\tpopular\tin\tthis\tspace.\n\nPart\tof\ttheir\tpopularity\tstems\tfrom\tthe\tfact\tthat\tAPI\tkeys\tare\tfocused\ton\tease\tof\tuse\tfor programs.\tCompared\tto\thandling\ta\tSAML\thandshake,\tAPI\tkey–based\tauthentication\tis much\tsimpler\tand\tmore\tstraightforward.\n\nThe\texact\tcapabilities\tof\tthe\tsystems\tvary,\tand\tyou\thave\tmultiple\toptions\tin\tboth\tthe commercial\tand\topen\tsource\tspace.\tSome\tof\tthe\tproducts\tjust\thandle\tthe\tAPI\tkey exchange\tand\tsome\tbasic\tkey\tmanagement.\tOther\ttools\toffer\teverything\tup\tto\tand including\trate\tlimiting,\tmonetization,\tAPI\tcatalogs,\tand\tdiscovery\tsystems.\n\nSome\tAPI\tsystems\tallow\tyou\tto\tbridge\tAPI\tkeys\tto\texisting\tdirectory\tservices.\tThis\twould allow\tyou\tto\tissue\tAPI\tkeys\tto\tprincipals\t(representing\tpeople\tor\tsystems)\tin\tyour organization,\tand\tcontrol\tthe\tlifecycle\tof\tthose\tkeys\tin\tthe\tsame\tway\tyou’d\tmanage\ttheir normal\tcredentials.\tThis\topens\tup\tthe\tpossibility\tof\tallowing\taccess\tto\tyour\tservices\tin different\tways\tbut\tkeeping\tthe\tsame\tsource\tof\ttruth\t—\tfor\texample,\tusing\tSAML\tto authenticate\thumans\tfor\tSSO,\tand\tusing\tAPI\tkeys\tfor\tservice-to-service\tcommunication, as\tshown\tin\tFigure\t9-2.",
      "content_length": 1924,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 299,
      "content": "Figure\t9-2.\tUsing\tdirectory\tservices\tto\tsynchronize\tprincipal\tinformation\tbetween\tan\tSSO\tand\tan\tAPI\tgateway",
      "content_length": 107,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 300,
      "content": "The\tDeputy\tProblem\n\nHaving\ta\tprincipal\tauthenticate\twith\ta\tgiven\tmicroserservice\tis\tsimple\tenough.\tBut\twhat happens\tif\tthat\tservice\tthen\tneeds\tto\tmake\tadditional\tcalls\tto\tcomplete\tan\toperation?\tTake a\tlook\tat\tFigure\t9-3,\twhich\tillustrates\tMusicCorp’s\tonline\tshopping\tsite.\tOur\tonline\tshop is\ta\tbrowser-based\tJavaScript\tUI.\tIt\tmakes\tcalls\tto\ta\tserver-side\tshop\tapplication,\tusing the\tbackends-for-frontends\tpattern\twe\tdescribed\tin\tChapter\t4.\tCalls\tmade\tbetween\tthe browser\tand\tserver\tcalls\tcan\tbe\tauthenticated\tusing\tSAML\tor\tOpenID\tConnect\tor\tsimilar. So\tfar,\tso\tgood.\n\nWhen\tI\tam\tlogged\tin,\tI\tcan\tclick\ton\ta\tlink\tto\tview\tdetails\tof\tan\torder.\tTo\tdisplay\tthe information,\twe\tneed\tto\tpull\tback\tthe\toriginal\torder\tfrom\tthe\torder\tservice,\tbut\twe\talso want\tto\tlook\tup\tshipping\tinformation\tfor\tthe\torder.\tSo\tclicking\tthe\tlink\tto /orderStatus/12345\tcauses\tthe\tonline\tshop\tto\tinitiate\ta\tcall\tfrom\tthe\tonline\tshop\tservice\tto both\tthe\torder\tservice\tand\tshipping\tservice\tasking\tfor\tthose\tdetails.\tBut\tshould\tthese downstream\tservices\taccept\tthe\tcalls\tfrom\tthe\tonline\tshop?\tWe\tcould\tadopt\ta\tstance\tof implicit\ttrust\t—\tthat\tbecause\tthe\tcall\tcame\tfrom\twithin\tour\tperimeter,\tit\tis\tOK.\tWe\tcould even\tuse\tcertificates\tor\tAPI\tkeys\tto\tconfirm\tthat\tyes,\tit\treally\tis\tthe\tonline\tshop\tasking\tfor this\tinformation.\tBut\tis\tthis\tenough?\n\nFigure\t9-3.\tAn\texample\twhere\ta\tconfused\tdeputy\tcould\tcome\tinto\tplay\n\nThere\tis\ta\ttype\tof\tvulnerability\tcalled\tthe\tconfused\tdeputy\tproblem,\twhich\tin\tthe\tcontext of\tservice-to-service\tcommunication\trefers\tto\ta\tsituation\twhere\ta\tmalicious\tparty\tcan\ttrick a\tdeputy\tservice\tinto\tmaking\tcalls\tto\ta\tdownstream\tservice\ton\this\tbehalf\tthat\the\tshouldn’t be\table\tto.\tFor\texample,\tas\ta\tcustomer,\twhen\tI\tlog\tin\tto\tthe\tonline\tshopping\tsystem,\tI\tcan see\tmy\taccount\tdetails.\tWhat\tif\tI\tcould\ttrick\tthe\tonline\tshopping\tUI\tinto\tmaking\ta\trequest for\tsomeone\telse’s\tdetails,\tmaybe\tby\tmaking\ta\tcall\twith\tmy\tlogged-in\tcredentials?\n\nIn\tthis\texample,\twhat\tis\tto\tstop\tme\tfrom\tasking\tfor\torders\tthat\tare\tnot\tmine?\tOnce\tlogged in,\tI\tcould\tstart\tsending\trequests\tfor\tother\torders\tthat\taren’t\tmine\tto\tsee\tif\tI\tcould\tget",
      "content_length": 2098,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 301,
      "content": "useful\tinformation.\tWe\tcould\ttry\tto\tprotect\tagainst\tthis\tinside\tthe\tonline\tshop\titself,\tby checking\twho\tthe\torder\tis\tfor\tand\trejecting\tit\tif\tsomeone’s\tasking\tfor\tthings\the\tshouldn’t. If\twe\thave\tlots\tof\tdifferent\tapplications\tthat\tsurface\tthis\tinformation,\tthough,\twe\tcould potentially\tbe\tduplicating\tthis\tlogic\tin\tlots\tof\tplaces.\n\nWe\tcould\troute\trequests\tdirectly\tfrom\tthe\tUI\tto\tthe\torder\tservice\tand\tallow\tit\tto\tvalidate the\trequest,\tbut\tthen\twe\thit\tthe\tvarious\tdownsides\twe\tdiscussed\tin\tChapter\t4. Alternatively,\twhen\tthe\tonline\tshop\tsends\tthe\trequest\tto\tthe\torder\tservice,\tit\tcould\tstate not\tjust\twhat\torder\tit\twants,\tbut\talso\ton\twhose\tbehalf\tit\tis\tasking.\tSome\tauthentication schemes\tallow\tus\tto\tpass\tin\tthe\toriginal\tprincipal’s\tcredentials\tdownstream,\talthough\twith SAML\tthis\tis\ta\tbit\tof\ta\tnightmare,\tinvolving\tnested\tSAML\tassertions\tthat\tare\ttechnically achievable\t—\tbut\tso\tdifficult\tthat\tno\tone\tever\tdoes\tthis.\tThis\tcan\tbecome\teven\tmore complex,\tof\tcourse.\tImagine\tif\tthe\tservices\tthe\tonline\tshop\ttalks\tto\tin\tturn\tmake\tmore downstream\tcalls.\tHow\tfar\tdo\twe\thave\tto\tgo\tin\tvalidating\ttrust\tfor\tall\tthose\tdeputies?\n\nThis\tproblem,\tunfortunately,\thas\tno\tsimple\tanswer,\tbecause\tit\tisn’t\ta\tsimple\tproblem.\tBe aware\tthat\tit\texists,\tthough.\tDepending\ton\tthe\tsensitivity\tof\tthe\toperation\tin\tquestion,\tyou might\thave\tto\tchoose\tbetween\timplicit\ttrust,\tverifying\tthe\tidentity\tof\tthe\tcaller,\tor\tasking the\tcaller\tto\tprovide\tthe\tcredentials\tof\tthe\toriginal\tprincipal.",
      "content_length": 1458,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 302,
      "content": "Securing\tData\tat\tRest\n\nData\tlying\tabout\tis\ta\tliability,\tespecially\tif\tit\tis\tsensitive.\tHopefully\twe’ve\tdone everything\twe\tcan\tto\tensure\tattackers\tcannot\tbreach\tour\tnetwork,\tand\talso\tthat\tthey cannot\tbreach\tour\tapplications\tor\toperating\tsystems\tto\tget\taccess\tto\tthe\tunderlying\tclose up.\tHowever,\twe\tneed\tto\tbe\tprepared\tin\tcase\tthey\tdo\t—\tdefense\tin\tdepth\tis\tkey.\n\nMany\tof\tthe\thigh-profile\tsecurity\tbreaches\tinvolve\tdata\tat\trest\tbeing\tacquired\tby\tan attacker,\tand\tthat\tdata\tbeing\treadable\tby\tthe\tattacker.\tThis\tis\teither\tbecause\tthe\tdata\twas stored\tin\tan\tunencrypted\tform,\tor\tbecause\tthe\tmechanism\tused\tto\tprotect\tthe\tdata\thad\ta fundamental\tflaw.\n\nThe\tmechanisms\tby\twhich\tsecure\tinformation\tcan\tbe\tprotected\tare\tmany\tand\tvaried,\tbut whichever\tapproach\tyou\tpick\tthere\tare\tsome\tgeneral\tthings\tto\tbear\tin\tmind.",
      "content_length": 804,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 303,
      "content": "Go\twith\tthe\tWell\tKnown\n\nThe\teasiest\tway\tyou\tcan\tmess\tup\tdata\tencryption\tis\tto\ttry\tto\timplement\tyour\town encryption\talgorithms,\tor\teven\ttry\tto\timplement\tsomeone\telse’s.\tWhatever\tprogramming language\tyou\tuse,\tyou’ll\thave\taccess\tto\treviewed,\tregularly\tpatched\timplementations\tof well-regarded\tencryption\talgorithms.\tUse\tthose!\tAnd\tsubscribe\tto\tthe\tmailing lists/advisory\tlists\tfor\tthe\ttechnology\tyou\tchoose\tto\tmake\tsure\tyou\tare\taware\tof vulnerabilities\tas\tthey\tare\tfound\tso\tyou\tcan\tkeep\tthem\tpatched\tand\tup\tto\tdate.\n\nFor\tencryption\tat\trest,\tunless\tyou\thave\ta\tvery\tgood\treason\tfor\tpicking\tsomething\telse, pick\ta\twell-known\timplementation\tof\tAES-128\tor\tAES-256\tfor\tyour\tplatform.3\tBoth\tthe Java\tand\t.NET\truntimes\tinclude\timplementations\tof\tAES\tthat\tare\thighly\tlikely\tto\tbe\twell tested\t(and\twell\tpatched),\tbut\tseparate\tlibraries\texist\tfor\tmost\tplatforms\ttoo\t—\tfor example,\tthe\tBouncy\tCastle\tlibraries\tfor\tJava\tand\tC#.\n\nFor\tpasswords,\tyou\tshould\tconsider\tusing\ta\ttechnique\tcalled\tsalted\tpassword\thashing.\n\nBadly\timplemented\tencryption\tcould\tbe\tworse\tthan\thaving\tnone,\tas\tthe\tfalse\tsense\tof security\t(pardon\tthe\tpun)\tcan\tlead\tyou\tto\ttake\tyour\teye\toff\tthe\tball.",
      "content_length": 1152,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 304,
      "content": "It’s\tAll\tAbout\tthe\tKeys\n\nAs\thas\tbeen\tcovered\tso\tfar,\tencryption\trelies\ton\tan\talgorithm\ttaking\tthe\tdata\tto\tbe encrypted\tand\ta\tkey\tand\tthen\tproducing\tthe\tencrypted\tdata.\tSo,\twhere\tis\tyour\tkey\tstored? Now\tif\tI\tam\tencrypting\tmy\tdata\tbecause\tI\tam\tworried\tabout\tsomeone\tstealing\tmy\twhole database,\tand\tI\tstore\tthe\tkey\tI\tuse\tin\tthe\tsame\tdatabase,\tthen\tI\thaven’t\treally\tachieved much!\tTherefore,\twe\tneed\tto\tstore\tthe\tkeys\tsomewhere\telse.\tBut\twhere?\n\nOne\tsolution\tis\tto\tuse\ta\tseparate\tsecurity\tappliance\tto\tencrypt\tand\tdecrypt\tdata.\tAnother\tis to\tuse\ta\tseparate\tkey\tvault\tthat\tyour\tservice\tcan\taccess\twhen\tit\tneeds\ta\tkey.\tThe\tlifecycle management\tof\tthe\tkeys\t(and\taccess\tto\tchange\tthem)\tcan\tbe\ta\tvital\toperation,\tand\tthese systems\tcan\thandle\tthis\tfor\tyou.\n\nSome\tdatabases\teven\tinclude\tbuilt-in\tsupport\tfor\tencryption,\tsuch\tas\tSQL\tServer’s Transparent\tData\tEncryption,\tthat\taim\tto\thandle\tthis\tin\ta\ttransparent\tfashion.\tEven\tif\tyour database\tof\tchoice\tdoes,\tresearch\thow\tthe\tkeys\tare\thandled\tand\tunderstand\tif\tthe\tthreat you\tare\tprotecting\tagainst\tis\tactually\tbeing\tmitigated.\n\nAgain,\tthis\tstuff\tis\tcomplex.\tAvoid\timplementing\tyour\town,\tand\tdo\tsome\tgood\tresearch!",
      "content_length": 1152,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 305,
      "content": "Pick\tYour\tTargets\n\nAssuming\teverything\tshould\tbe\tencrypted\tcan\tsimplify\tthings\tsomewhat.\tThere\tis\tno guesswork\tabout\twhat\tshould\tor\tshould\tnot\tbe\tprotected.\tHowever,\tyou’ll\tstill\tneed\tto think\tabout\twhat\tdata\tcan\tbe\tput\tinto\tlogfiles\tto\thelp\tproblem\tidentification,\tand\tthe computational\toverhead\tof\tencrypting\teverything\tcan\tbecome\tpretty\tonerous,\tneeding more\tpowerful\thardware\tas\ta\tresult.\tThis\tis\teven\tmore\tchallenging\twhen\tyou’re\tapplying database\tmigrations\tas\tpart\tof\trefactoring\tschemas.\tDepending\ton\tthe\tchanges\tbeing made,\tthe\tdata\tmay\tneed\tto\tbe\tdecrypted,\tmigrated,\tand\tre-encrypted.\n\nBy\tsubdividing\tyour\tsystem\tinto\tmore\tfine-grained\tservices,\tyou\tmight\tidentify\tan\tentire data\tstore\tthat\tcan\tbe\tencrypted\twholesale,\tbut\teven\tthen\tit\tis\tunlikely.\tLimiting\tthis encryption\tto\ta\tknown\tset\tof\ttables\tis\ta\tsensible\tapproach.",
      "content_length": 833,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 306,
      "content": "Decrypt\ton\tDemand\n\nEncrypt\tdata\twhen\tyou\tfirst\tsee\tit.\tOnly\tdecrypt\ton\tdemand,\tand\tensure\tthat\tdata\tis\tnever stored\tanywhere.",
      "content_length": 125,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 307,
      "content": "Encrypt\tBackups\n\nBackups\tare\tgood.\tWe\twant\tto\tback\tup\tour\timportant\tdata,\tand\talmost\tby\tdefinition\tdata we\tare\tworried\tenough\tabout\tthat\twe\twant\tto\tencrypt\tit\tis\timportant\tenough\tto\tback\tup! So\tit\tmay\tseem\tlike\tan\tobvious\tpoint,\tbut\twe\tneed\tto\tmake\tsure\tthat\tour\tbackups\tare\talso encrypted.\tThis\talso\tmeans\tthat\twe\tneed\tto\tknow\twhich\tkeys\tare\tneeded\tto\thandle\twhich version\tof\tdata,\tespecially\tif\tthe\tkeys\tchange.\tHaving\tclear\tkey\tmanagement\tbecomes fairly\timportant.",
      "content_length": 467,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 308,
      "content": "Defense\tin\tDepth\n\nAs\tI’ve\tmentioned\tearlier,\tI\tdislike\tputting\tall\tour\teggs\tin\tone\tbasket.\tIt’s\tall\tabout\tdefence in\tdepth.\tWe’ve\ttalked\talready\tabout\tsecuring\tdata\tin\ttransit,\tand\tsecuring\tdata\tat\trest.\tBut are\tthere\tother\tprotections\twe\tcould\tput\tin\tplace\tto\thelp?",
      "content_length": 266,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 309,
      "content": "Firewalls\n\nHaving\tone\tor\tmore\tfirewalls\tis\ta\tvery\tsensible\tprecaution\tto\ttake.\tSome\tare\tvery\tsimple, able\tonly\tto\trestrict\taccess\tto\tcertain\ttypes\tof\ttraffic\ton\tcertain\tports.\tOthers\tare\tmore sophisticated.\tModSecurity,\tfor\texample,\tis\ta\ttype\tof\tapplication\tfirewall\tthat\tcan\thelp throttle\tconnections\tfrom\tcertain\tIP\tranges\tand\tdetect\tother\tsorts\tof\tmalicious\tattacks.\n\nThere\tis\tvalue\tin\thaving\tmore\tthan\tone\tfirewall.\tFor\texample,\tyou\tmay\tdecide\tto\tuse IPTables\tlocally\ton\ta\thost\tto\tsecure\tthat\thost,\tsetting\tup\tthe\tallowable\tingress\tand\tegress. These\trules\tcould\tbe\ttailored\tto\tthe\tlocally\trunning\tservices,\twith\ta\tfirewall\tat\tthe perimeter\tfor\tcontrolling\tgeneral\taccess.",
      "content_length": 675,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 310,
      "content": "Logging\n\nGood\tlogging,\tand\tspecifically\tthe\tability\tto\taggregate\tlogs\tfrom\tmultiple\tsystems,\tis\tnot about\tprevention,\tbut\tcan\thelp\twith\tdetecting\tand\trecovering\tfrom\tbad\tthings\thappening. For\texample,\tafter\tapplying\tsecurity\tpatches\tyou\tcan\toften\tsee\tin\tlogs\tif\tpeople\thave\tbeen exploiting\tcertain\tvulnerabilities.\tPatching\tmakes\tsure\tit\twon’t\thappen\tagain,\tbut\tif\tit already\thas\thappened,\tyou\tmay\tneed\tto\tgo\tinto\trecovery\tmode.\tHaving\tlogs\tavailable allows\tyou\tto\tsee\tif\tsomething\tbad\thappened\tafter\tthe\tfact.\n\nNote,\thowever,\tthat\twe\tneed\tto\tbe\tcareful\tabout\twhat\tinformation\twe\tstore\tin\tour\tlogs! Sensitive\tinformation\tneeds\tto\tbe\tculled\tto\tensure\twe\taren’t\tleaking\timportant\tdata\tinto our\tlogs,\twhich\tcould\tend\tup\tbeing\ta\tgreat\ttarget\tfor\tattackers.",
      "content_length": 752,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 311,
      "content": "Intrusion\tDetection\t(and\tPrevention)\tSystem\n\nIntrusion\tdetection\tsystems\t(IDS)\tcan\tmonitor\tnetworks\tor\thosts\tfor\tsuspicious\tbehavior, reporting\tproblems\twhen\tit\tsees\tthem.\tIntrusion\tprevention\tsystems\t(IPS),\tas\twell\tas monitoring\tfor\tsuspicious\tactivity,\tcan\tstep\tin\tto\tstop\tit\tfrom\thappening.\tUnlike\ta\tfirewall, which\tis\tprimarily\tlooking\toutward\tto\tstop\tbad\tthings\tfrom\tgetting\tin,\tIDS\tand\tIPS\tare actively\tlooking\tinside\tthe\tperimeter\tfor\tsuspect\tbehavior.\tWhen\tyou’re\tstarting\tfrom scratch,\tIDS\tmay\tmake\tmost\tsense.\tThese\tsystems\tare\theuristic-based\t(as\tare\tmany application\tfirewalls),\tand\tit\tis\tpossible\tthat\tthe\tgeneric\tstarting\tset\tof\trules\twill\teither\tbe too\tlenient\tor\tnot\tlenient\tenough\tfor\thow\tyour\tservice\tbehaves.\tUsing\ta\tmore\tpassive\tIDS to\talert\tyou\tto\tproblems\tis\ta\tgood\tway\tto\ttune\tyour\trules\tbefore\tusing\tit\tin\ta\tmore\tactive capacity.",
      "content_length": 853,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 312,
      "content": "Network\tSegregation\n\nWith\ta\tmonolithic\tsystem,\twe\thave\tlimits\tto\thow\twe\tcan\tstructure\tour\tnetworks\tto\tprovide additional\tprotections.\tWith\tmicroservices,\tthough,\tyou\tcan\tput\tthem\tinto\tdifferent network\tsegments\tto\tfurther\tcontrol\thow\tservices\ttalk\tto\teach\tother.\tAWS,\tfor\texample, provides\tthe\tability\tto\tautomatically\tprovision\ta\tvirtual\tprivate\tcloud\t(VPC),\twhich\tallow hosts\tto\tlive\tin\tseparate\tsubnets.\tYou\tcan\tthen\tspecify\twhich\tVPCs\tcan\tsee\teach\tother\tby defining\tpeering\trules,\tand\teven\troute\ttraffic\tthrough\tgateways\tto\tproxy\taccess,\tgiving you\tin\teffect\tmultiple\tperimeters\tat\twhich\tadditional\tsecurity\tmeasures\tcan\tbe\tput\tinto place.\n\nThis\tcould\tallow\tyou\tto\tsegment\tnetworks\tbased\ton\tteam\townership,\tor\tperhaps\tby\trisk level.",
      "content_length": 736,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 313,
      "content": "Operating\tSystem\n\nOur\tsystems\trely\ton\ta\tlarge\tamount\tof\tsoftware\tthat\twe\tdidn’t\twrite,\tand\tmay\thave security\tvulnerabilities\tthat\tcould\texpose\tour\tapplication,\tnamely\tour\toperating\tsystems and\tthe\tother\tsupporting\ttools\twe\trun\ton\tthem.\tHere,\tbasic\tadvice\tcan\tget\tyou\ta\tlong\tway. Start\twith\tonly\trunning\tservices\tas\tOS\tusers\tthat\thave\tas\tfew\tpermissions\tas\tpossible,\tto ensure\tthat\tif\tsuch\tan\taccount\tis\tcompromised\tit\twill\tdo\tminimal\tdamage.\n\nNext,\tpatch\tyour\tsoftware.\tRegularly.\tThis\tneeds\tto\tbe\tautomated,\tand\tyou\tneed\tto\tknow if\tyour\tmachines\tare\tout\tof\tsync\twith\tthe\tlatest\tpatch\tlevels.\tTools\tlike\tMicrosoft’s\tSCCM or\tRedHat’s\tSpacewalk\tcan\tbe\tbeneficial\there,\tas\tthey\tcan\thelp\tyou\tsee\tif\tmachines\tare\tup to\tdate\twith\tthe\tlatest\tpatches\tand\tinitiate\tupdates\tif\trequired.\tIf\tyou\tare\tusing\ttools\tlike Ansible,\tPuppet,\tor\tChef,\tchances\tare\tyou\tare\talready\tfairly\thappy\twith\tpushing\tout changes\tautomatically\t—\tthese\ttools\tcan\tget\tyou\ta\tlong\tway\ttoo,\tbut\twon’t\tdo\teverything for\tyou.\n\nThis\treally\tis\tbasic\tstuff,\tbut\tit\tis\tsurprising\thow\toften\tI\tsee\tcritical\tsoftware\trunning\ton unpatched,\told\toperating\tsystems.\tYou\tcan\thave\tthe\tmost\twell-defined\tand\tprotected application-level\tsecurity\tin\tthe\tworld,\tbut\tif\tyou\thave\tan\told\tversion\tof\ta\tweb\tserver running\ton\tyour\tmachine\tas\troot\tthat\thas\tan\tunpatched\tbuffer\toverflow\tvulnerability,\tthen your\tsystem\tcould\tstill\tbe\textremely\tvulnerable.\n\nAnother\tthing\tto\tlook\tat\tif\tyou\tare\tusing\tLinux\tis\tthe\temergence\tof\tsecurity\tmodules\tfor the\toperating\tsystem\titself.\tAppArmour,\tfor\texample,\tallows\tyou\tto\tdefine\thow\tyour application\tis\texpected\tto\tbehave,\twith\tthe\tkernel\tkeeping\tan\teye\ton\tit.\tIf\tit\tstarts\tdoing something\tit\tshouldn’t,\tthe\tkernel\tsteps\tin.\tAppArmour\thas\tbeen\taround\tfor\ta\twhile,\tas has\tSeLinux.\tAlthough\ttechnically\teither\tof\tthem\tshould\twork\ton\tany\tmodern\tLinux system,\tin\tpractice\tsome\tdistributions\tsupport\tone\tbetter\tthan\tthe\tother.\tAppArmour\tis used\tby\tdefault\tin\tUbuntu\tand\tSuSE,\tfor\texample,\twhereas\tSELinux\thas\ttraditionally\tbeen well\tsupported\tby\tRedHat.\tA\tnewer\toption\tis\tGrSSecurity,\twhich\taims\tto\tbe\tsimpler\tto use\tthan\teither\tAppArmour\tor\tGrSecurity\twhile\talso\ttrying\tto\texpand\ton\ttheir\tcapabilities, but\tit\trequires\ta\tcustom\tkernel\tto\twork.\tI’d\tsuggest\ttaking\ta\tlook\tat\tall\tthree\tto\tsee\twhich fits\tyour\tuse\tcases\tbest,\tbut\tI\tlike\tthe\tidea\tof\thaving\tanother\tlayer\tof\tprotection\tand prevention\tat\twork.",
      "content_length": 2375,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 314,
      "content": "A\tWorked\tExample\n\nHaving\ta\tfiner-grained\tsystem\tarchitecture\tgives\tus\tmuch\tmore\tfreedom\tin\thow\twe implement\tour\tsecurity.\tFor\tthose\tparts\tthat\tdeal\twith\tthe\tmost\tsensitive\tinformation\tor expose\tthe\tmost\tvaluable\tcapabilities,\twe\tcan\tadopt\tthe\tstrictest\tsecurity\tprovisions.\tBut for\tother\tparts\tof\tthe\tsystem,\twe\tcan\tafford\tto\tbe\tmuch\tmore\tlax\tin\twhat\twe\tworry\tabout.\n\nLet’s\tconsider\tMusicCorp\tonce\tagain,\tand\tpull\tsome\tof\tthe\tpreceding\tconcepts\ttogether\tto see\twhere\tand\thow\twe\tmight\tuse\tsome\tof\tthese\tsecurity\ttechniques.\tWe’re\tlooking primarily\tat\tthe\tsecurity\tconcerns\tof\tdata\tin\ttransit\tand\tat\trest.\tFigure\t9-4\tshows\ta\tsubset of\tthe\toverall\tsystem\tthat\twe’ll\tbe\tanalyzing,\twhich\tcurrently\tshows\ta\tcrushing\tlack\tof regard\tfor\tsecurity\tconcerns.\tEverything\tis\tsent\tover\tplain\told\tHTTP.\n\nFigure\t9-4.\tA\tsubset\tof\tMusicCorp’s\tunfortunately\tinsecure\tarchitecture\n\nHere\twe\thave\tstandard\tweb\tbrowsers\tthat\tare\tused\tby\tour\tcustomers\tto\tshop\ton\tthe\tsite. We\talso\tintroduce\tthe\tconcept\tof\ta\tthird-party\troyalty\tgateway:\twe’ve\tstarted\tworking with\ta\tthird-party\tcompany\tthat\twill\thandle\troyalty\tpayments\tfor\tour\tnew\tstreaming service.\tIt\tcontacts\tus\toccasionally\tto\tpull\tdown\trecords\tof\twhat\tmusic\thas\tbeen\tstreamed when\t—\tinformation\twe\tjealously\tprotect\tas\twe\tare\tworried\tabout\tcompetition\tfrom\trival companies.\tFinally,\twe\texpose\tour\tcatalog\tdata\tto\tother\tthird\tparties\t—\tfor\texample, allowing\tthe\tmetadata\tabout\tartist\tor\tsong\tto\tbe\tembedded\tin\tmusic\treview\tsites.\tInside our\tnetwork\tperimeter,\twe\thave\tsome\tcollaborating\tservices,\twhich\tare\tonly\tever\tused internally.\n\nFor\tthe\tbrowser,\twe’ll\tuse\ta\tmix\tof\tstandard\tHTTP\ttraffic\tfor\tnonsecure\tcontent,\tto\tallow for\tit\tto\tbe\tcached.\tFor\tsecure,\tlogged-in\tpages,\tall\tsecure\tcontent\twill\tbe\tsent\tover HTTPS,\tgiving\tour\tcustomers\textra\tprotection\tif\tthey\tare\tdoing\tthings\tlike\trunning\ton public\tWiFi\tnetworks.\n\nWhen\tit\tcomes\tto\tthe\tthird-party\troyalty\tpayment\tsystem,\twe\tare\tconcerned\tnot\tonly\tabout the\tnature\tof\tthe\tdata\twe\tare\texposing,\tbut\talso\tabout\tmaking\tsure\tthe\trequests\twe’re",
      "content_length": 2026,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 315,
      "content": "getting\tare\tlegitimate.\tHere,\twe\tinsist\tthat\tour\tthird\tparty\tuses\tclient\tcertificates.\tAll\tthe data\tis\tsent\tover\ta\tsecure,\tcryptographic\tchannel,\tincreasing\tour\tability\tto\tensure\twe’re being\tasked\tfor\tthis\tdata\tby\tthe\tright\tperson.\tWe\tdo,\tof\tcourse,\thave\tto\tthink\tabout\twhat happens\twhen\tthe\tdata\tleaves\tour\tcontrol.\tWill\tour\tpartner\tcare\tabout\tthe\tdata\tas\tmuch\tas we\twill?\n\nFor\tthe\tfeeds\tof\tcatalog\tdata,\twe\twant\tthis\tinformation\tshared\tas\twidely\tas\tpossible\tto allow\tpeople\tto\teasily\tbuy\tmusic\tfrom\tus!\tHowever,\twe\tdon’t\twant\tthis\tabused,\tand\twe’d like\tsome\tidea\tof\twho\tis\tusing\tour\tdata.\tHere,\tAPI\tkeys\tmake\tperfect\tsense.\n\nInside\tthe\tnetwork\tperimeter,\tthings\tare\ta\tbit\tmore\tnuanced.\tHow\tworried\tare\twe\tabout people\tcompromising\tour\tinternal\tnetworks?\tIdeally,\twe’d\tlike\tto\tuse\tHTTPS\tat\ta minimum,\tbut\tmanaging\tit\tis\tsomewhat\tpainful.\tWe\tdecide\tinstead\tto\tput\tthe\twork (initially,\tat\tleast)\tinto\thardening\tour\tnetwork\tperimeter,\tincluding\thaving\ta\tproperly configured\tfirewall\tand\tselecting\tan\tappropriate\thardware\tor\tsoftware\tsecurity\tappliance to\tcheck\tfor\tmalicious\ttraffic\t(e.g.,\tport\tscanning\tor\tdenial-of-service\tattacks).\n\nThat\tsaid,\twe\tare\tconcerned\tabout\tsome\tof\tour\tdata\tand\twhere\tit\tlives.\tWe\taren’t\tworried about\tthe\tcatalog\tservice;\tafter\tall,\twe\twant\tthat\tdata\tshared\tand\thave\tprovided\tan\tAPI\tfor it!\tBut\twe\tare\tvery\tconcerned\tabout\tour\tcustomers’\tdata.\tHere,\twe\tdecide\tto\tencrypt\tthe data\theld\tby\tthe\tcustomer\tservice,\tand\tdecrypt\tdata\ton\tread.\tIf\tattackers\tdo\tpenetrate\tour network,\tthey\tcould\tstill\trun\trequests\tagainst\tthe\tcustomer\tservice’s\tAPI,\tbut\tthe\tcurrent implementation\tdoes\tnot\tallow\tfor\tthe\tbulk\tretrieval\tof\tcustomer\tdata.\tIf\tit\tdid,\twe\twould likely\tconsider\tthe\tuse\tof\tclient\tcertificates\tto\tprotect\tthis\tinformation.\tEven\tif\tattackers compromise\tthe\tmachine\tthe\tdatabase\tis\trunning\ton\tand\tmanage\tto\tdownload\tthe\tentire contents,\tthey\twould\tneed\taccess\tto\tthe\tkey\tused\tto\tencrypt\tand\tdecrypt\tthe\tdata\tto\tmake use\tif\tit.\n\nFigure\t9-5\tshows\tthe\tfinal\tpicture.\tAs\tyou\tcan\tsee,\tthe\tchoices\twe\tmade\tabout\twhat technology\tto\tuse\twere\tbased\ton\tan\tunderstanding\tof\tthe\tnature\tof\tthe\tinformation\tbeing secured.\tYour\town\tarchitecture’s\tsecurity\tconcerns\tare\tlikely\tto\tbe\tvery\tdifferent,\tand\tso you\tmay\tend\tup\twith\ta\tdifferent-looking\tsolution.",
      "content_length": 2266,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 316,
      "content": "Figure\t9-5.\tMusicCorp’s\tmore\tsecure\tsystem",
      "content_length": 42,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 317,
      "content": "Be\tFrugal\n\nAs\tdisk\tspace\tbecomes\tcheaper\tand\tthe\tcapabilities\tof\tthe\tdatabases\timprove,\tthe\tease with\twhich\tbulk\tamounts\tof\tinformation\tcan\tbe\tcaptured\tand\tstored\tis\timproving\trapidly. This\tdata\tis\tvaluable\t—\tnot\tonly\tto\tbusinesses\tthemselves,\twhich\tincreasingly\tsee\tdata\tas a\tvaluable\tasset,\tbut\tequally\tto\tthe\tusers\twho\tvalue\ttheir\town\tprivacy.\tThe\tdata\tthat pertains\tto\tan\tindividual,\tor\tcould\tbe\tused\tto\tderive\tinformation\tabout\tan\tindividual,\tmust be\tthe\tdata\twe\tare\tmost\tcareful\tabout.\n\nHowever,\twhat\tif\twe\tmade\tour\tlives\ta\tbit\teasier?\tWhy\tnot\tscrub\tas\tmuch\tinformation\tas possible\tthat\tcan\tbe\tpersonally\tidentifiable,\tand\tdo\tit\tas\tsoon\tas\tpossible?\tWhen\tlogging\ta request\tfrom\ta\tuser,\tdo\twe\tneed\tto\tstore\tthe\tentire\tIP\taddress\tforever,\tor\tcould\twe\treplace the\tlast\tfew\tdigits\twith\tx?\tDo\twe\tneed\tto\tstore\tsomeone’s\tname,\tage,\tgender,\tand\tdate\tof birth\tin\torder\tto\tprovide\ther\twith\tproduct\toffers,\tor\tis\ther\tage\trange\tand\tpostcode\tenough information?\n\nThe\tadvantages\there\tare\tmanifold.\tFirst,\tif\tyou\tdon’t\tstore\tit,\tno\tone\tcan\tsteal\tit.\tSecond,\tif you\tdon’t\tstore\tit,\tno\tone\t(e.g.,\ta\tgovernmental\tagency)\tcan\task\tfor\tit\teither!\n\nThe\tGerman\tphrase\tDatensparsamkeit\trepresents\tthis\tconcept.\tOriginating\tfrom\tGerman privacy\tlegislation,\tit\tencapsulates\tthe\tconcept\tof\tonly\tstoring\tas\tmuch\tinformation\tas\tis absolutely\trequired\tto\tfulfill\tbusiness\toperations\tor\tsatisfy\tlocal\tlaws.\n\nThis\tis\tobviously\tin\tdirect\ttension\twith\tthe\tmove\ttoward\tstoring\tmore\tand\tmore information,\tbut\tit\tis\ta\tstart\tto\trealize\tthat\tthis\ttension\teven\texists!",
      "content_length": 1535,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 318,
      "content": "The\tHuman\tElement\n\nMuch\tof\twhat\twe\thave\tcovered\there\tis\tthe\tbasics\tof\thow\tto\timplement\ttechnological safeguards\tto\tprotect\tyour\tsystems\tand\tdata\tfrom\tmalicious,\texternal\tattackers.\tHowever, you\tmay\talso\tneed\tprocesses\tand\tpolicies\tin\tplace\tto\tdeal\twith\tthe\thuman\telement\tin\tyour organization.\tHow\tdo\tyou\trevoke\taccess\tto\tcredentials\twhen\tsomeone\tleaves\tthe organization?\tHow\tcan\tyou\tprotect\tyourself\tagainst\tsocial\tengineering?\tAs\ta\tgood\tmental exercise,\tconsider\twhat\tdamage\ta\tdisgruntled\tex-employee\tcould\tdo\tto\tyour\tsystems\tif\tshe wanted\tto.\tPutting\tyourself\tin\tthe\tmindset\tof\ta\tmalicious\tparty\tis\toften\ta\tgood\tway\tto reason\tabout\tthe\tprotections\tyou\tmay\tneed,\tand\tfew\tmalicious\tparties\thave\tas\tmuch\tinside information\tas\ta\trecent\temployee!",
      "content_length": 743,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 319,
      "content": "The\tGolden\tRule\n\nIf\tthere\tis\tnothing\telse\tyou\ttake\taway\tfrom\tthis\tchapter,\tlet\tit\tbe\tthis:\tdon’t\twrite\tyour\town crypto.\tDon’t\tinvent\tyour\town\tsecurity\tprotocols.\tUnless\tyou\tare\ta\tcryptographic\texpert with\tyears\tof\texperience,\tif\tyou\ttry\tinventing\tyour\town\tencoding\tor\telaborate cryptographic\tprotections,\tyou\twill\tget\tit\twrong.\tAnd\teven\tif\tyou\tare\ta\tcryptographic expert,\tyou\tmay\tstill\tget\tit\twrong.\n\nMany\tof\tthe\ttools\tpreviously\toutlined,\tlike\tAES,\tare\tindustry-hardened\ttechnologies whose\tunderlying\talgorithms\thave\tbeen\tpeer\treviewed,\tand\twhose\tsoftware implementation\thas\tbeen\trigorously\ttested\tand\tpatched\tover\tmany\tyears.\tThey\tare\tgood enough!\tReinventing\tthe\twheel\tin\tmany\tcases\tis\toften\tjust\ta\twaste\tof\ttime,\tbut\twhen\tit comes\tto\tsecurity\tit\tcan\tbe\toutright\tdangerous.",
      "content_length": 776,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 320,
      "content": "Baking\tSecurity\tIn\n\nJust\tas\twith\tautomated\tfunctional\ttesting,\twe\tdon’t\twant\tsecurity\tto\tbe\tleft\tto\ta\tdifferent set\tof\tpeople,\tnor\tdo\twe\twant\tto\tleave\teverything\tto\tthe\tlast\tminute.\tHelping\teducate developers\tabout\tsecurity\tconcerns\tis\tkey,\tas\traising\teveryone’s\tgeneral\tawareness\tof security\tissues\tcan\thelp\treduce\tthem\tin\tthe\tfirst\tplace.\tGetting\tpeople\tfamilar\twith\tthe OWASP\tTop\tTen\tlist\tand\tOWASP’s\tSecurity\tTesting\tFramework\tcan\tbe\ta\tgreat\tplace\tto start.\tSpecialists\tabsolutely\thave\ttheir\tplace,\tthough,\tand\tif\tyou\thave\taccess\tto\tthem,\tuse them\tto\thelp\tyou.\n\nThere\tare\tautomated\ttools\tthat\tcan\tprobe\tour\tsystems\tfor\tvulnerabilities,\tsuch\tas\tby looking\tfor\tcross-site\tscripting\tattacks.\tThe\tZed\tAttack\tProxy\t(aka\tZAP)\tis\ta\tgood example.\tInformed\tby\tthe\twork\tof\tOWASP,\tZAP\tattempts\tto\tre-create\tmalicious\tattacks on\tyour\twebsite.\tOther\ttools\texist\tthat\tuse\tstatic\tanalysis\tto\tlook\tfor\tcommon\tcoding mistakes\tthat\tcan\topen\tup\tsecurity\tholes,\tsuch\tas\tBrakeman\tfor\tRuby.\tWhere\tthese\ttools can\tbe\teasily\tintegrated\tinto\tnormal\tCI\tbuilds,\tintegrate\tthem\tinto\tyour\tstandard\tcheck-ins. Other\tsorts\tof\tautomated\ttests\tare\tmore\tinvolved.\tFor\texample,\tusing\tsomething\tlike Nessus\tto\tscan\tfor\tvulnerabilities\tis\ta\tbit\tmore\tinvolved\tand\tit\tmay\trequire\ta\thuman\tto interpret\tthe\tresults.\tThat\tsaid,\tthese\ttests\tare\tstill\tautomatable,\tand\tit\tmay\tmake\tsense\tto run\tthem\twith\tthe\tsame\tsort\tof\tcadence\tas\tload\ttesting.\n\nMicrosoft’s\tSecurity\tDevelopment\tLifecycle\talso\thas\tsome\tgood\tmodels\tfor\thow\tdelivery teams\tcan\tbake\tsecurity\tin.\tSome\taspects\tof\tit\tfeel\toverly\twaterfall,\tbut\ttake\ta\tlook\tand\tsee what\taspects\tcan\tfit\tinto\tyour\tcurrent\tworkflow.",
      "content_length": 1635,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 321,
      "content": "External\tVerification\n\nWith\tsecurity,\tI\tthink\tthere\tis\tgreat\tvalue\tin\thaving\tan\texternal\tassessment\tdone.\tExercises like\tpenetration\ttesting,\twhen\tdone\tby\tan\toutside\tparty,\treally\tdo\tmimic\treal-world attempts.\tThey\talso\tsidestep\tthe\tissue\tthat\tteams\taren’t\talways\table\tto\tsee\tthe\tmistakes they\thave\tmade\tthemselves,\tas\tthey\tare\ttoo\tclose\tto\tthe\tproblem.\tIf\tyou’re\ta\tbig\tenough company,\tyou\tmay\thave\ta\tdedicated\tinfosec\tteam\tthat\tcan\thelp\tyou.\tIf\tnot,\tfind\tan external\tparty\twho\tcan.\tReach\tout\tto\tthem\tearly,\tunderstand\thow\tthey\tlike\tto\twork,\tand find\tout\thow\tmuch\tnotice\tthey\tneed\tto\tdo\ta\ttest.\n\nYou’ll\talso\tneed\tto\tconsider\thow\tmuch\tverification\tyou\trequire\tbefore\teach\trelease. Generally,\tdoing\ta\tfull\tpenetration\ttest,\tfor\texample,\tisn’t\tneeded\tfor\tsmall\tincremental releases,\tbut\tmay\tbe\tfor\tlarger\tchanges.\tWhat\tyou\tneed\tdepends\ton\tyour\town\trisk\tprofile.",
      "content_length": 858,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 322,
      "content": "Summary\n\nSo\tagain\twe\treturn\tto\ta\tcore\ttheme\tof\tthe\tbook\t—\tthat\thaving\ta\tsystem\tdecomposed\tinto finer-grained\tservices\tgives\tus\tmany\tmore\toptions\tas\tto\thow\tto\tsolve\ta\tproblem.\tNot\tonly can\thaving\tmicroservices\tpotentially\treduce\tthe\timpact\tof\tany\tgiven\tbreach,\tbut\tit\talso gives\tus\tmore\tability\tto\ttrade\toff\tthe\toverhead\tof\tmore\tcomplex\tand\tsecure\tapproaches where\tdata\tis\tsensitive,\tand\ta\tlighter-weight\tapproach\twhen\tthe\trisks\tare\tlower.\n\nOnce\tyou\tunderstand\tthe\tthreat\tlevels\tof\tdifferent\tparts\tof\tyour\tsystem,\tyou\tshould\tstart\tto get\ta\tsense\tof\twhen\tto\tconsider\tsecurity\tduring\ttransit,\tat\trest,\tor\tnot\tat\tall.\n\nFinally,\tunderstand\tthe\timportance\tof\tdefense\tin\tdepth,\tmake\tsure\tyou\tpatch\tyour operating\tsystems,\tand\teven\tif\tyou\tconsider\tyourself\ta\trock\tstar,\tdon’t\ttry\tto\timplement your\town\tcryptography!\n\nIf\tyou\twant\ta\tgeneral\toverview\tof\tsecurity\tfor\tbrowser-based\tapplications,\ta\tgreat\tplace\tto start\tis\tthe\texcellent\tOpen\tWeb\tApplication\tSecurity\tProject\t(OWASP)\tnonprofit,\twhose regularly\tupdated\tTop\t10\tSecurity\tRisk\tdocument\tshould\tbe\tconsidered\tessential\treading for\tany\tdeveloper.\tFinally,\tif\tyou\twant\ta\tmore\tgeneral\tdiscussion\tof\tcryptography,\tcheck out\tthe\tbook\tCryptography\tEngineering\tby\tNiels\tFerguson,\tBruce\tSchneier,\tand Tadayoshi\tKohno\t(Wiley).\n\nGetting\tto\tgrips\twith\tsecurity\tis\toften\tabout\tunderstanding\tpeople\tand\thow\tthey\twork\twith our\tsystems.\tOne\thuman-related\taspect\twe\thaven’t\tyet\tdiscussed\tin\tterms\tof\tmicroservices is\tthe\tinterplay\tbetween\torganizational\tstructures\tand\tthe\tarchitectures\tthemselves.\tBut\tas with\tsecurity,\twe’ll\tsee\tthat\tignoring\tthe\thuman\telement\tcan\tbe\ta\tgrave\tmistake.\n\n3\tIn\tgeneral,\tkey\tlength\tincreases\tthe\tamount\tof\twork\trequired\tto\tbrute-force-break\ta\tkey. Therefore\tyou\tcan\tassume\tthe\tlonger\tthe\tkey,\tthe\tmore\tsecure\tyour\tdata.\tHowever,\tsome minor\tconcerns\thave\tbeen\traised\tabout\tthe\timplementation\tof\tAES-256\tfor\tcertain\ttypes of\tkeys\tby\trespected\tsecurity\texpert\tBruce\tSchneier.\tThis\tis\tone\tof\tthose\tareas\twhere\tyou need\tto\tdo\tmore\tresearch\ton\twhat\tthe\tcurrent\tadvice\tis\tat\tthe\ttime\tof\treading!",
      "content_length": 2050,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 323,
      "content": "Chapter\t10.\tConway’s\tLaw\tand\tSystem Design\n\nMuch\tof\tthe\tbook\tso\tfar\thas\tfocused\ton\tthe\ttechnical\tchallenges\tin\tmoving\ttoward\ta\tfine- grained\tarchitecture.\tBut\tthere\tare\tother,\torganizational\tissues\tto\tconsider\tas\twell.\tAs we’ll\tlearn\tin\tthis\tchapter,\tyou\tignore\tyour\tcompany’s\torganization\tchart\tat\tyour\tperil!\n\nOur\tindustry\tis\tyoung,\tand\tseems\tto\tbe\tconstantly\treinventing\titself.\tAnd\tyet\ta\tfew\tkey laws\thave\tstood\tthe\ttest\tof\ttime.\tMoore’s\tlaw,\tfor\texample,\twhich\tstates\tthat\tthe\tdensity\tof transistors\ton\tintegrated\tcircuits\tdoubles\tevery\ttwo\tyears,\thas\tproved\tto\tbe\tuncannily accurate\t(although\tsome\tpeople\tpredict\tthat\tthis\ttrend\tis\talready\tslowing).\tOne\tlaw\tthat\tI have\tfound\tto\tbe\talmost\tuniversally\ttrue,\tand\tfar\tmore\tuseful\tin\tmy\tday-to-day\twork,\tis Conway’s\tlaw.\n\nMelvin\tConway’s\tpaper\tHow\tDo\tCommittees\tInvent,\tpublished\tin\tDatamation\tmagazine in\tApril\t1968,\tobserved\tthat:\n\nAny\torganization\tthat\tdesigns\ta\tsystem\t(defined\tmore\tbroadly\there\tthan\tjust information\tsystems)\twill\tinevitably\tproduce\ta\tdesign\twhose\tstructure\tis\ta\tcopy\tof\tthe organization’s\tcommunication\tstructure.\n\nThis\tstatement\tis\toften\tquoted,\tin\tvarious\tforms,\tas\tConway’s\tlaw.\tEric\tS.\tRaymond summarized\tthis\tphenomenon\tin\tThe\tNew\tHacker’s\tDictionary\t(MIT\tPress)\tby\tstating\t“If you\thave\tfour\tgroups\tworking\ton\ta\tcompiler,\tyou’ll\tget\ta\t4-pass\tcompiler.”",
      "content_length": 1332,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 324,
      "content": "Evidence\n\nThe\tstory\tgoes\tthat\twhen\tMelvin\tConway\tsubmitted\this\tpaper\ton\tthis\ttopic\tto\tthe\tHarvard Business\tReview,\tthey\trejected\tit,\tclaiming\the\thadn’t\tproved\this\tthesis.\tI’ve\tseen\tthis theory\tborne\tout\tin\tso\tmany\tdifferent\tsituations\tthat\tI’ve\taccepted\tit\tas\ttrue.\tBut\tyou\tdon’t have\tto\ttake\tmy\tword\tfor\tit:\tsince\tConway’s\toriginal\tsubmission,\ta\tlot\tof\twork\thas\tbeen done\tin\tthis\tarea.\tA\tnumber\tof\tstudies\thave\tbeen\tcarried\tout\tto\texplore\tthe\tinterrelation\tof organizational\tstructure\tand\tthe\tsystems\tthey\tcreate.",
      "content_length": 514,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 325,
      "content": "Loose\tand\tTightly\tCoupled\tOrganizations\n\nIn\tExploring\tthe\tDuality\tBetween\tProduct\tand\tOrganizational\tArchitectures\t(Harvard Business\tSchool),\tthe\tauthors\tAlan\tMacCormack,\tJohn\tRusnak,\tand\tCarliss\tBaldwin\tlook at\ta\tnumber\tof\tdifferent\tsoftware\tsystems,\tloosely\tcategorized\tas\tbeing\tcreated\teither\tby loosely\tcoupled\torganizations\tor\ttightly\tcoupled\torganizations.\tFor\ttightly\tcoupled organizations,\tthink\tcommercial\tproduct\tfirms\tthat\tare\ttypically\tcolocated\twith\tstrongly aligned\tvisions\tand\tgoals,\twhile\tloosely\tcoupled\torganizations\tare\twell\trepresented\tby distributed\topen\tsource\tcommunities.\n\nIn\ttheir\tstudy,\tin\twhich\tthey\tmatched\tsimilar\tproduct\tpairs\tfrom\teach\ttype\tof\torganization, the\tauthors\tfound\tthat\tthe\tmore\tloosely\tcoupled\torganizations\tactually\tcreated\tmore modular,\tless\tcoupled\tsystems,\twhereas\tthe\tmore\ttightly\tfocused\torganization’s\tsoftware was\tless\tmodularized.",
      "content_length": 882,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 326,
      "content": "Windows\tVista\n\nMicrosoft\tcarried\tout\tan\tempirical\tstudy\twhere\tit\tlooked\tat\thow\tits\town\torganizational structure\timpacted\tthe\tsoftware\tquality\tof\ta\tspecific\tproduct,\tWindows\tVista.\tSpecifically, the\tresearchers\tlooked\tat\tmultiple\tfactors\tto\tdetermine\thow\terror-prone\ta\tcomponent\tin the\tsystem\twould\tbe.4\tAfter\tlooking\tat\tmultiple\tmetrics,\tincluding\tcommonly\tused software\tquality\tmetrics\tlike\tcode\tcomplexity,\tthey\tfound\tthat\tthe\tmetrics\tassociated\twith organizational\tstructures\tproved\tto\tbe\tthe\tmost\tstatistically\trelevant\tmeasures.\n\nSo\there\twe\thave\tanother\texample\tof\tthe\torganizational\tstructure\timpacting\tthe\tnature\tof the\tsystem\tthat\torganization\tcreates.",
      "content_length": 660,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 327,
      "content": "Netflix\tand\tAmazon\n\nProbably\tthe\ttwo\tposter\tchildren\tfor\tthe\tidea\tthat\torganizations\tand\tarchitecture\tshould\tbe aligned\tare\tAmazon\tand\tNetflix.\tEarly\ton,\tAmazon\tstarted\tto\tunderstand\tthe\tbenefits\tof teams\towning\tthe\twhole\tlifecycle\tof\tthe\tsystems\tthey\tmanaged.\tIt\twanted\tteams\tto\town and\toperate\tthe\tsystems\tthey\tlooked\tafter,\tmanaging\tthe\tentire\tlifecycle.\tBut\tAmazon\talso knew\tthat\tsmall\tteams\tcan\twork\tfaster\tthan\tlarge\tteams.\tThis\tled\tfamously\tto\tits\ttwo-pizza teams,\twhere\tno\tteam\tshould\tbe\tso\tbig\tthat\tit\tcould\tnot\tbe\tfed\twith\ttwo\tpizzas.\tThis\tdriver for\tsmall\tteams\towning\tthe\twhole\tlifecycle\tof\ttheir\tservices\tis\ta\tmajor\treason\twhy Amazon\tdeveloped\tAmazon\tWeb\tServices.\tIt\tneeded\tto\tcreate\tthe\ttooling\tto\tallow\tits teams\tto\tbe\tself-sufficient.\n\nNetflix\tlearned\tfrom\tthis\texample,\tand\tensured\tthat\tfrom\tthe\tbeginning\tit\tstructured\titself around\tsmall,\tindependent\tteams,\tso\tthat\tthe\tservices\tthey\tcreated\twould\talso\tbe independent\tfrom\teach\tother.\tThis\tensured\tthat\tthe\tarchitecture\tof\tthe\tsystem\twas optimized\tfor\tspeed\tof\tchange.\tEffectively,\tNetflix\tdesigned\tthe\torganizational\tstructure for\tthe\tsystem\tarchitecture\tit\twanted.",
      "content_length": 1136,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 328,
      "content": "What\tCan\tWe\tDo\twith\tThis?\n\nSo\tevidence,\tanecdotal\tand\tempirical,\tpoints\tto\tour\torganizational\tstructure\tbeing\ta\tstrong influence\ton\tthe\tnature\t(and\tquality)\tof\tthe\tsystems\twe\tprovide.\tSo\thow\tdoes\tthis understanding\thelp\tus?\tLet’s\tlook\tat\ta\tfew\tdifferent\torganizational\tsituations\tand understand\twhat\timpact\teach\tmight\thave\ton\tour\tsystem\tdesign.",
      "content_length": 344,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 329,
      "content": "Adapting\tto\tCommunication\tPathways\n\nLet’s\tfirst\tconsider\ta\tsimple,\tsingle\tteam.\tIt’s\tin\tcharge\tof\tall\taspects\tof\tthe\tsystem\tdesign and\timplementation.\tIt\tcan\thave\tfrequent,\tfine-grained\tcommunication.\tImagine\tthat\tthis team\tis\tin\tcharge\tof\ta\tsingle\tservice\t—\tsay,\tour\tmusic\tshop’s\tcatalog\tservice.\tNow consider\tthe\tinside\tof\ta\tservice:\tlots\tof\tfine-grained\tmethod\tor\tfunction\tcalls.\tAs\twe’ve discussed\tbefore,\twe\taim\tto\tensure\tour\tservices\tare\tdecomposed\tsuch\tthat\tthe\tpace\tof change\tinside\ta\tservice\tis\tmuch\thigher\tthan\tthe\tpace\tof\tchange\tbetween\tservices.\tThis single\tteam,\twith\tits\tability\tfor\tfine-grained\tcommunication,\tmatches\tnicely\twith\tthe communication\tpathways\tof\tthe\tcode\twithin\tthe\tservice.\n\nThis\tsingle\tteam\tfinds\tit\teasy\tto\tcommunicate\tabout\tproposed\tchanges\tand\trefactorings, and\ttypically\thas\ta\tgood\tsense\tof\townership.\n\nNow\tlet’s\timagine\ta\tdifferent\tscenario.\tInstead\tof\ta\tsingle,\tgeolocated\tteam\towning\tour catalog\tservice,\tsuppose\tthat\tteams\tin\tthe\tUK\tand\tIndia\tboth\tare\tactively\tinvolved\tin changing\ta\tservice\t—\teffectively\thaving\tjoint\townership\tof\tthe\tservice.\tGeographical\tand time\tzone\tboundaries\there\tmake\tfine-grained\tcommunication\tbetween\tthose\tteams difficult.\tInstead,\tthey\trely\ton\tmore\tcoarse-grained\tcommunication\tvia\tvideo\tconferencing and\temail.\tHow\teasy\tis\tit\tfor\ta\tteam\tmember\tin\tthe\tUK\tto\tmake\ta\tsimple\trefactoring\twith confidence?\tThe\tcost\tof\tcommunications\tin\ta\tgeographically\tdistributed\tteam\tis\thigher, and\ttherefore\tthe\tcost\tof\tcoordinating\tchanges\tis\thigher.\n\nWhen\tthe\tcost\tof\tcoordinating\tchange\tincreases,\tone\tof\ttwo\tthings\thappen.\tEither\tpeople find\tways\tto\treduce\tthe\tcoordination/communication\tcosts,\tor\tthey\tstop\tmaking\tchanges. The\tlatter\tis\texactly\thow\twe\tend\tup\twith\tlarge,\thard-to-maintain\tcodebases.\n\nI\trecall\tone\tclient\tproject\tI\tworked\ton\twhere\townership\tof\ta\tsingle\tservice\twas\tshared between\ttwo\tgeographical\tlocations.\tEventually,\teach\tsite\tstarted\tspecializing\twhat\twork\tit handled.\tThis\tallowed\tit\tto\ttake\townership\tof\tpart\tof\tthe\tcodebase,\twithin\twhich\tit\tcould have\tan\teasier\tcost\tof\tchange.\tThe\tteams\tthen\thad\tmore\tcoarse-grained\tcommunication about\thow\tthe\ttwo\tparts\tinterrelated;\teffectively,\tthe\tcommunication\tpathways\tmade possible\twithin\tthe\torganizational\tstructure\tmatched\tthe\tcoarse-grained\tAPI\tthat\tformed the\tboundary\tbetween\tthe\ttwo\thalves\tof\tthe\tcodebase.\n\nSo\twhere\tdoes\tthis\tleave\tus\twhen\tconsidering\tevolving\tour\town\tservice\tdesign?\tWell,\tI would\tsuggest\tthat\tgeographical\tboundaries\tbetween\tpeople\tinvolved\twith\tthe development\tof\ta\tsystem\tcan\tbe\ta\tgreat\tway\tto\tdrive\twhen\tservices\tshould\tbe decomposed,\tand\tthat\tin\tgeneral,\tyou\tshould\tlook\tto\tassign\townership\tof\ta\tservice\tto\ta single,\tcolocated\tteam\twho\tcan\tkeep\tthe\tcost\tof\tchange\tlow.\n\nPerhaps\tyour\torganization\tdecides\tthat\tit\twants\tto\tincrease\tthe\tnumber\tof\tpeople\tworking on\tyour\tproject\tby\topening\tup\tan\toffice\tin\tanother\tcountry.\tAt\tthis\tpoint,\tthink\tactively about\twhat\tparts\tof\tyour\tsystem\tcan\tbe\tmoved\tover.\tPerhaps\tthis\tis\twhat\tdrives\tyour decisions\tabout\twhat\tseams\tto\tsplit\tout\tnext.",
      "content_length": 3027,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 330,
      "content": "It\tis\talso\tworth\tnoting\tat\tthis\tpoint\tthat,\tat\tleast\tbased\ton\tthe\tobservations\tof\tthe\tauthors\tof the\tExploring\tthe\tDuality\tBetween\tProduct\tand\tOrganizational\tArchitectures\treport previously\treferenced,\tif\tthe\torganization\tbuilding\tthe\tsystem\tis\tmore\tloosely\tcoupled (e.g.,\tconsisting\tof\tgeographically\tdistributed\tteams),\tthe\tsystems\tbeing\tbuilt\ttend\ttoward the\tmore\tmodular,\tand\ttherefore\thopefully\tless\tcoupled.\tThe\ttendency\tof\ta\tsingle\tteam that\towns\tmany\tservices\tto\tlean\ttoward\ttighter\tintegration\tis\tvery\thard\tto\tmaintain\tin\ta more\tdistributed\torganization.",
      "content_length": 563,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 331,
      "content": "Service\tOwnership\n\nWhat\tdo\tI\tmean\tby\tservice\townership?\tIn\tgeneral,\tit\tmeans\tthat\tthe\tteam\towning\ta\tservice is\tresponsible\tfor\tmaking\tchanges\tto\tthat\tservice.\tThe\tteam\tshould\tfeel\tfree\tto\trestructure the\tcode\thowever\tit\twants,\tas\tlong\tas\tthat\tchange\tdoesn’t\tbreak\tconsuming\tservices.\tFor many\tteams,\townership\textends\tto\tall\taspects\tof\tthe\tservice,\tfrom\tsourcing\trequirements to\tbuilding,\tdeploying,\tand\tmaintaining\tthe\tapplication.\tThis\tmodel\tis\tespecially\tprevalent with\tmicroservices,\twhere\tit\tis\teasier\tfor\ta\tsmall\tteam\tto\town\ta\tsmall\tservice.\tThis increased\tlevel\tof\townership\tleads\tto\tincreased\tautonomy\tand\tspeed\tof\tdelivery.\tHaving one\tteam\tresponsible\tfor\tdeploying\tand\tmaintaining\tthe\tapplication\tmeans\tit\thas\tan incentive\tto\tcreate\tservices\tthat\tare\teasy\tto\tdeploy;\tthat\tis,\tconcerns\tabout\t“throwing something\tover\tthe\twall”\tdissipate\twhen\tthere\tis\tno\tone\tto\tthrow\tit\tto!\n\nThis\tmodel\tis\tcertainly\tone\tI\tfavor.\tIt\tpushes\tthe\tdecisions\tto\tthe\tpeople\tbest\table\tto\tmake them,\tgiving\tthe\tteam\tboth\tincreased\tpower\tand\tautonomy,\tbut\talso\tmaking\tit\taccountable for\tits\twork.\tI’ve\tseen\tfar\ttoo\tmany\tdevelopers\thand\ttheir\tsystem\tover\tfor\ttesting\tor deployment\tphases\tand\tthink\tthat\ttheir\twork\tis\tdone\tat\tthat\tpoint.",
      "content_length": 1217,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 332,
      "content": "Drivers\tfor\tShared\tServices\n\nI\thave\tseen\tmany\tteams\tadopt\ta\tmodel\tof\tshared\tservice\townership.\tI\tfind\tthis\tapproach suboptimal,\tfor\treasons\talready\tdiscussed.\tHowever,\tthe\tdrivers\tthat\tcause\tpeople\tto\tpick shared\tservices\tare\timportant\tto\tunderstand,\tespecially\tas\twe\tmay\tbe\table\tto\tfind\tsome compelling\talternative\tmodels\tthat\tcan\taddress\tpeople’s\tunderlying\tconcerns.",
      "content_length": 369,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 333,
      "content": "Too\tHard\tto\tSplit\n\nObviously,\tone\tof\tthe\treasons\tyou\tmay\tfind\tyourself\twith\ta\tsingle\tservice\towned\tby\tmore than\tone\tteam\tis\tthat\tthe\tcost\tof\tsplitting\tthe\tservice\tis\ttoo\thigh,\tor\tperhaps\tyour organization\tmight\tnot\tsee\tthe\tpoint\tof\tit.\tThis\tis\ta\tcommon\toccurrence\twith\tlarge monolithic\tsystems.\tIf\tthis\tis\tthe\tmain\tchallenge\tyou\tface,\tthen\tI\thope\tsome\tof\tthe\tadvice given\tin\tChapter\t5\twill\tbe\tof\tuse.\tYou\tcould\talso\tconsider\tmerging\tteams\ttogether,\tto\talign more\tclosely\twith\tthe\tarchitecture\titself.",
      "content_length": 500,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 334,
      "content": "Feature\tTeams\n\nThe\tidea\tof\tfeature\tteams\t(aka\tfeature-based\tteams)\tis\tthat\ta\tsmall\tteam\tdrives\tthe development\tof\ta\tset\tof\tfeatures,\timplementing\tall\tfunctionality\trequired\teven\tif\tit\tcuts across\tcomponent\t(or\teven\tservice)\tboundaries.\tThe\tgoals\tof\tfeature\tteams\tare\tsensible enough.\tThis\tstructure\tallows\tthe\tteam\tto\tretain\ta\tfocus\ton\tthe\tend\tresult\tand\tensures\tthat the\twork\tis\tjoined\tup,\tavoiding\tsome\tof\tthe\tchallenges\tof\ttrying\tto\tcoordinate\tchanges across\tmultiple\tdifferent\tteams.\n\nIn\tmany\tsituations,\tthe\tfeature\tteam\tis\ta\treaction\tto\ttraditional\tIT\torganizations\twhere team\tstructure\tis\taligned\taround\ttechnical\tboundaries.\tFor\texample,\tyou\tmight\thave\ta team\tthat\tis\tresponsible\tfor\tthe\tUI,\tanother\tthat\tis\tresponsible\tfor\tthe\tapplication\tlogic,\tand a\tthird\thandling\tthe\tdatabase.\tIn\tthis\tenvironment,\ta\tfeature\tteam\tis\ta\tsignificant\tstep\tup, as\tit\tworks\tacross\tall\tthese\tlayers\tto\tdeliver\tthe\tfunctionality.\n\nWith\twholesale\tadoption\tof\tfeature\tteams,\tall\tservices\tcan\tbe\tconsidered\tshared.\tEveryone can\tchange\tevery\tservice,\tevery\tpiece\tof\tcode.\tThe\trole\tof\tthe\tservice\tcustodians\there becomes\tmuch\tmore\tcomplex,\tif\tthe\trole\texists\tat\tall.\tUnfortunately,\tI\trarely\tsee functioning\tcustodians\tat\tall\twhere\tthis\tpattern\tis\tadopted,\tleading\tto\tthe\tsorts\tof\tissues\twe discussed\tearlier.\n\nBut\tlet’s\tagain\tconsider\twhat\tmicroservices\tare:\tservices\tmodeled\tafter\ta\tbusiness\tdomain, not\ta\ttechnical\tone.\tAnd\tif\tour\tteam\tthat\towns\tany\tgiven\tservice\tis\tsimilarly\taligned\talong the\tbusiness\tdomain,\tit\tis\tmuch\tmore\tlikely\tthat\tthe\tteam\twill\tbe\table\tto\tretain\ta\tcustomer focus,\tand\tsee\tmore\tof\tthe\tfeature\tdevelopment\tthrough,\tbecause\tit\thas\ta\tholistic understanding\tand\townership\tof\tall\tthe\ttechnology\tassociated\twith\ta\tservice.\n\nCross-cutting\tchanges\tcan\toccur,\tof\tcourse,\tbut\ttheir\tlikelihood\tis\tsignificantly\treduced\tby our\tavoiding\ttechnology-oriented\tteams.",
      "content_length": 1860,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 335,
      "content": "Delivery\tBottlenecks\n\nOne\tkey\treason\tpeople\tmove\ttoward\tshared\tservices\tis\tto\tavoid\tdelivery\tbottlenecks. What\tif\tthere\tis\ta\tlarge\tbacklog\tof\tchanges\tthat\tneed\tto\tbe\tmade\tin\ta\tsingle\tservice?\tLet’s imagine\tthat\twe\tare\trolling\tout\tthe\tability\tfor\ta\tcustomer\tto\tsee\tthe\tgenre\tof\ta\ttrack\tacross our\tproducts,\tas\twell\tas\tadding\ta\ta\tbrand\tnew\ttype\tof\tstock:\tvirtual\tmusical\tringtones\tfor the\tmobile\tphone.\tThe\twebsite\tteam\tneeds\tto\tmake\ta\tchange\tto\tsurface\tthe\tgenre information,\twith\tthe\tmobile\tapp\tteam\tworking\tto\tallow\tusers\tto\tbrowse,\tpreview,\tand\tbuy the\tringtones.\tBoth\tchanges\tneed\tto\tbe\tmade\tto\tthe\tcatalog\tservice,\tbut\tunfortunately\thalf the\tteam\tis\tout\twith\tthe\tflu,\tand\tthe\tother\thalf\tis\tstuck\tdiagnosing\ta\tproduction\tfailure.\n\nWe\thave\ta\tcouple\tof\toptions\tthat\tdon’t\tinvolve\tshared\tservices\tto\tavoid\tthis\tsituation.\tThe first\tis\tto\tjust\twait.\tThe\twebsite\tand\tmobile\tapplication\tteams\tmove\ton\tto\tsomething\telse. Depending\ton\thow\timportant\tthe\tfeature\tis,\tor\thow\tlong\tthe\tdelay\tis\tlikely\tto\tbe,\tthis\tmay be\tfine\tor\tit\tmay\tbe\ta\tmajor\tproblem.\n\nYou\tcould\tinstead\tadd\tpeople\tto\tthe\tcatalog\tteam\tto\thelp\tthem\tmove\tthrough\ttheir\twork faster.\tThe\tmore\tstandardized\tthe\ttechnology\tstack\tand\tprogramming\tidioms\tin\tuse\tacross your\tsystem,\tthe\teasier\tit\tis\tfor\tother\tpeople\tto\tmake\tchanges\tin\tyour\tservices.\tThe flipside,\tof\tcourse,\tas\twe\tdiscussed\tearlier,\tis\tthat\tstandardization\ttends\tto\treduce\ta\tteam’s ability\tto\tadopt\tthe\tright\tsolution\tfor\tthe\tjob,\tand\tcan\tlead\tto\tdifferent\tsorts\tof inefficiencies.\tIf\tthe\tteam\tis\ton\tthe\tother\tside\tof\tthe\tplanet,\tthis\tmight\tbe\timpossible, however.\n\nAnother\toption\tcould\tbe\tto\tsplit\tthe\tcatalog\tinto\ta\tseparate\tgeneral\tmusic\tcatalog\tand\ta ringtone\tcatalog.\tIf\tthe\tchange\tbeing\tmade\tto\tsupport\tringtones\tis\tfairly\tsmall,\tand\tthe likelihood\tof\tthis\tbeing\tan\tarea\tin\twhich\twe\twill\tdevelop\theavily\tin\tthe\tfuture\tis\talso\tquite low,\tthis\tmay\twell\tbe\tpremature.\tOn\tthe\tother\thand,\tif\tthere\tare\t10\tweeks\tof\tringtone- related\tfeatures\tstacked\tup,\tsplitting\tout\tthe\tservice\tcould\tmake\tsense,\twith\tthe\tmobile team\ttaking\townership.\n\nThere\tis\tanother\tmodel\tthat\tcould\twork\twell\tfor\tus,\tthough.",
      "content_length": 2116,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 336,
      "content": "Internal\tOpen\tSource\n\nSo\twhat\tif\twe’ve\ttried\tour\thardest,\tbut\twe\tjust\tcan’t\tfind\ta\tway\tpast\thaving\ta\tfew\tshared services?\tAt\tthis\tpoint,\tproperly\tembracing\tthe\tinternal\topen\tsource\tmodel\tcan\tmake\ta\tlot of\tsense.\n\nWith\tnormal\topen\tsource,\ta\tsmall\tgroup\tof\tpeople\tare\tconsidered\tcore\tcommitters.\tThey are\tthe\tcustodians\tof\tthe\tcode.\tIf\tyou\twant\ta\tchange\tto\tan\topen\tsource\tproject,\tyou\teither ask\tone\tof\tthe\tcommitters\tto\tmake\tthe\tchange\tfor\tyou,\tor\telse\tyou\tmake\tthe\tchange yourself\tand\tsend\tthem\ta\tpull\trequest.\tThe\tcore\tcommitters\tare\tstill\tin\tcharge\tof\tthe codebase;\tthey\tare\tthe\towners.\n\nInside\tthe\torganization,\tthis\tpattern\tcan\twork\twell\ttoo.\tPerhaps\tthe\tpeople\twho\tworked\ton the\tservice\toriginally\tare\tno\tlonger\ton\ta\tteam\ttogether;\tperhaps\tthey\tare\tnow\tscattered across\tthe\torganization.\tWell,\tif\tthey\tstill\thave\tcommit\trights,\tyou\tcan\tfind\tthem\tand\task for\ttheir\thelp,\tperhaps\tpairing\tup\twith\tthem,\tor\tif\tyou\thave\tthe\tright\ttooling\tyou\tcan\tsend them\ta\tpull\trequest.",
      "content_length": 971,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 337,
      "content": "Role\tof\tthe\tCustodians\n\nWe\tstill\twant\tour\tservices\tto\tbe\tsensible.\tWe\twant\tthe\tcode\tto\tbe\tof\tdecent\tquality,\tand\tthe service\titself\tto\texhibit\tsome\tsort\tof\tconsistency\tin\thow\tit\tis\tput\ttogether.\tWe\talso\twant\tto make\tsure\tthat\tchanges\tbeing\tmade\tnow\tdon’t\tmake\tfuture\tplanned\tchanges\tmuch\tharder than\tthey\tneed\tto\tbe.\tThis\tmeans\tthat\twe\tneed\tto\tadopt\tthe\tsame\tpatterns\tused\tin\tnormal open\tsource\tinternally\ttoo,\twhich\tmeans\tseparating\tout\ta\tgroup\tof\ttrusted\tcommitters\t(the core\tteam),\tand\tuntrusted\tcommitters\t(people\tfrom\toutside\tthe\tteam\tsubmitting\tchanges).\n\nThe\tcore\tteam\tneeds\tto\thave\tsome\tway\tof\tvetting\tand\tapproving\tthe\tchanges.\tIt\tneeds\tto make\tsure\tthe\tchanges\tare\tidiomatically\tconsistent\t—\tthat\tis,\tthat\tthey\tfollow\tthe\tgeneral coding\tguidelines\tof\tthe\trest\tof\tthe\tcodebase.\tThe\tpeople\tdoing\tthe\tvetting\tare\ttherefore going\tto\thave\tto\tspend\ttime\tworking\twith\tthe\tsubmitters\tto\tmake\tsure\tthe\tchange\tis\tof sufficient\tquality.\n\nGood\tgatekeepers\tput\ta\tlot\tof\twork\tinto\tthis,\tcommunicating\tclearly\twith\tthe\tsubmitters and\tencouraging\tgood\tbehavior.\tBad\tgatekeepers\tcan\tuse\tthis\tas\tan\texcuse\tto\texert\tpower over\tothers\tor\thave\treligious\twars\tabout\tarbitrary\ttechnical\tdecisions.\tHaving\tseen\tboth sets\tof\tbehavior,\tI\tcan\ttell\tyou\tone\tthing\tis\tclear:\teither\tway\tit\ttakes\ttime.\tWhen considering\tallowing\tuntrusted\tcommitters\tto\tsubmit\tchanges\tto\tyour\tcodebase,\tyou\thave to\tdecide\tif\tthe\toverhead\tof\tbeing\ta\tgatekeeper\tis\tworth\tthe\ttrouble:\tcould\tthe\tcore\tteam\tbe doing\tbetter\tthings\twith\tthe\ttime\tit\tspends\tvetting\tpatches?",
      "content_length": 1526,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 338,
      "content": "Maturity\n\nThe\tless\tstable\tor\tmature\ta\tservice\tis,\tthe\tharder\tit\twill\tbe\tto\tallow\tpeople\toutside\tthe\tcore team\tto\tsubmit\tpatches.\tBefore\tthe\tkey\tspine\tof\ta\tservice\tis\tin\tplace,\tthe\tteam\tmay\tnot know\twhat\tgood\tlooks\tlike,\tand\ttherefore\tmay\tstruggle\tto\tknow\twhat\ta\tgood\tsubmission looks\tlike.\tDuring\tthis\tstage,\tthe\tservice\titself\tis\tundergoing\ta\thigh\tdegree\tof\tchange.\n\nMost\topen\tsource\tprojects\ttend\tto\tnot\ttake\tsubmissions\tfrom\ta\twider\tgroup\tof\tuntrusted committers\tuntil\tthe\tcore\tof\tthe\tfirst\tversion\tis\tdone.\tFollowing\ta\tsimilar\tmodel\tfor\tyour own\torganizations\tmakes\tsense.\tIf\ta\tservice\tis\tpretty\tmature,\tand\tis\trarely\tchanged\t—\tfor example,\tour\tcart\tservice\t—\tthen\tperhaps\tthat\tis\tthe\ttime\tto\topen\tit\tup\tfor\tother contributions.",
      "content_length": 732,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 339,
      "content": "Tooling\n\nTo\tbest\tsupport\tan\tinternal\topen\tsource\tmodel,\tyou’ll\tneed\tsome\ttooling\tin\tplace.\tThe\tuse of\ta\tdistributed\tversion\tcontrol\ttool\twith\tthe\tability\tfor\tpeople\tto\tsubmit\tpull\trequests\t(or something\tsimilar)\tis\timportant.\tDepending\ton\tthe\tsize\tof\tthe\torganization,\tyou\tmay\talso need\ttooling\tto\tallow\tfor\ta\tdiscussion\tand\tevolution\tof\tpatch\trequests;\tthis\tmay\tor\tmay\tnot mean\ta\tfull-blown\tcode\treview\tsystem,\tbut\tthe\tability\tto\tcomment\tinline\ton\tpatches\tis very\tuseful.\tFinally,\tyou’ll\tneed\tto\tmake\tit\tvery\teasy\tfor\ta\tcommitter\tto\tbuild\tand\tdeploy your\tsoftware,\tand\tmake\tit\tavailable\tfor\tothers.\tTypically\tthis\tinvolves\thaving\twell- defined\tbuild\tand\tdeployment\tpipelines\tand\tcentralized\tartifact\trepositories.",
      "content_length": 714,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 340,
      "content": "Bounded\tContexts\tand\tTeam\tStructures\n\nAs\tmentioned\tbefore,\twe\tlook\tto\tdraw\tour\tservice\tboundaries\taround\tbounded\tcontexts.\tIt therefore\tfollows\tthat\twe\twould\tlike\tour\tteams\taligned\talong\tbounded\tcontexts\ttoo.\tThis has\tmultiple\tbenefits.\tFirst,\ta\tteam\twill\tfind\tit\teasier\tto\tgrasp\tdomain\tconcepts\twithin\ta bounded\tcontext,\tas\tthey\tare\tinterrelated.\tSecond,\tservices\twithin\ta\tbounded\tcontext\tare more\tlikely\tto\tbe\tservices\tthat\ttalk\tto\teach\tother,\tmaking\tsystem\tdesign\tand\trelease coordination\teasier.\tFinally,\tin\tterms\tof\thow\tthe\tdelivery\tteam\tinteracts\twith\tthe\tbusiness stakeholders,\tit\tbecomes\teasier\tfor\tthe\tteam\tto\tcreate\tgood\trelationships\twith\tthe\tone\tor two\texperts\tin\tthat\tarea.",
      "content_length": 686,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 341,
      "content": "The\tOrphaned\tService?\n\nSo\twhat\tabout\tservices\tthat\tare\tno\tlonger\tbeing\tactively\tmaintained?\tAs\twe\tmove\ttoward finer-grained\tarchitectures,\tthe\tservices\tthemselves\tbecome\tsmaller.\tOne\tof\tthe\tgoals\tof smaller\tservices,\tas\twe\thave\tdiscussed,\tis\tthe\tfact\tthat\tthey\tare\tsimpler.\tSimpler\tservices with\tless\tfunctionality\tmay\tnot\tneed\tto\tchange\tfor\ta\twhile.\tConsider\tthe\thumble\tcart service,\twhich\tprovides\tsome\tfairly\tmodest\tcapabilities:\tAdd\tto\tCart,\tRemove\tfrom\tCart, and\tso\ton.\tIt\tis\tquite\tconceivable\tthat\tthis\tservice\tmay\tnot\thave\tto\tchange\tfor\tmonths\tafter first\tbeing\twritten,\teven\tif\tactive\tdevelopment\tis\tstill\tgoing\ton.\tWhat\thappens\there?\tWho owns\tthis\tservice?\n\nIf\tyour\tteam\tstructures\tare\taligned\talong\tthe\tbounded\tcontexts\tof\tyour\torganization,\tthen even\tservices\tthat\tare\tnot\tchanged\tfrequently\tstill\thave\ta\tde\tfacto\towner.\tImagine\ta\tteam that\tis\taligned\twith\tthe\tconsumer\tweb\tsales\tcontext.\tIt\tmight\thandle\tthe\twebsite,\tcart,\tand recommendation\tservices.\tEven\tif\tthe\tcart\tservice\thasn’t\tbeen\tchanged\tin\tmonths,\tit\twould naturally\tfall\tto\tthis\tteam\tto\tmake\tthe\tchange.\tOne\tof\tthe\tbenefits\tof\tmicroservices,\tof course,\tis\tthat\tif\tthe\tteam\tneeds\tto\tchange\tthe\tservice\tto\tadd\ta\tnew\tfeature\tand\tnot\tfind\tit to\tits\tliking,\trewriting\tit\tshouldn’t\ttake\ttoo\tlong\tat\tall.\n\nThat\tsaid,\tif\tyou’ve\tadopted\ta\ttruly\tpolyglot\tapproach,\tmaking\tuse\tof\tmultiple\ttechnology stacks,\tthen\tthe\tchallenges\tof\tmaking\tchanges\tto\tan\torphaned\tservice\tcould\tbe compounded\tif\tyour\tteam\tdoesn’t\tknow\tthe\ttech\tstack\tany\tlonger.",
      "content_length": 1503,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 342,
      "content": "Case\tStudy:\tRealEstate.com.au\n\nREA’s\tcore\tbusiness\tis\treal\testate.\tBut\tthis\tencompasses\tmultiple\tdifferent\tfacets,\teach\tof which\toperates\tas\ta\tsingle\tline\tof\tbusiness\t(LOB).\tFor\texample,\tone\tline\tof\tbusiness\tdeals with\tresidential\tproperty\tin\tAustralia,\tanother\tcommercial,\twhile\tanother\tmight\trelate\tto one\tof\tREA’s\toverseas\tbusinesses.\tThese\tlines\tof\tbusiness\thave\tIT\tdelivery\tteams\t(or squads)\tassociated\twith\tthem;\tsome\tmay\thave\tonly\ta\tsingle\tsquad,\twhile\tthe\tbiggest\thas four.\tSo\tfor\tresidential\tproperty,\tthere\tare\tmultiple\tteams\tinvolved\twith\tcreating\tthe website\tand\tlisting\tservices\tto\tallow\tpeople\tto\tbrowse\tproperty.\tPeople\trotate\tbetween these\tteams\tevery\tnow\tand\tthen,\tbut\ttend\tto\tstay\twithin\tthat\tline\tof\tbusiness\tfor\textended periods,\tensuring\tthat\tthe\tteam\tmembers\tcan\tbuild\tup\ta\tstrong\tawareness\tof\tthat\tpart\tof the\tdomain.\tThis\tin\tturn\thelps\tthe\tcommunication\tbetween\tthe\tvarious\tbusiness stakeholders\tand\tthe\tteam\tdelivering\tfeatures\tfor\tthem.\n\nEach\tsquad\tinside\ta\tline\tof\tbusiness\tis\texpected\tto\town\tthe\tentire\tlifecycle\tof\tthe\tservices it\tcreates,\tincluding\tbuilding,\ttesting\tand\treleasing,\tsupporting,\tand\teven decommissioning.\tA\tcore\tdelivery\tservices\tteam\tprovides\tadvice\tand\tguidance\tto\tthese teams,\tas\twell\tas\ttooling\tto\thelp\tit\tget\tthe\tjob\tdone.\tA\tstrong\tculture\tof\tautomation\tis\tkey, and\tREA\tmakes\theavy\tuse\tof\tAWS\tas\ta\tkey\tpart\tof\tenabling\tthe\tteams\tto\tbe\tmore autonomous.\tFigure\t10-1\tillustrates\thow\tthis\tall\tworks.\n\nFigure\t10-1.\tAn\toverview\tof\tRealestate.com.au’s\torganizational\tand\tteam\tstructure,\tand\talignment\twith\tarchitecture\n\nIt\tisn’t\tjust\tthe\tdelivery\torganization\tthat\tis\taligned\tto\thow\tthe\tbusiness\toperates.\tIt extends\tto\tthe\tarchitecture\ttoo.\tOne\texample\tof\tthis\tis\tintegration\tmethods.\tWithin\tan LOB,\tall\tservices\tare\tfree\tto\ttalk\tto\teach\tother\tin\tany\tway\tthey\tsee\tfit,\tas\tdecided\tby\tthe squads\twho\tact\tas\ttheir\tcustodians.\tBut\tbetween\tLOBs,\tall\tcommunication\tis\tmandated\tto",
      "content_length": 1917,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 343,
      "content": "be\tasynchronous\tbatch,\tone\tof\tthe\tfew\tcast-iron\trules\tof\tthe\tvery\tsmall\tarchitecture\tteam. This\tcoarse-grained\tcommunication\tmatches\tthe\tcoarse-grained\tcommunication\tthat\texists between\tthe\tdifferent\tparts\tof\tthe\tbusiness\ttoo.\tBy\tinsisting\ton\tit\tbeing\tbatch,\teach\tLOB has\ta\tlot\tof\tfreedom\tin\thow\tit\tacts\tand\tmanages\titself.\tIt\tcould\tafford\tto\ttake\tits\tservices down\twhenever\tit\twanted,\tknowing\tthat\tas\tlong\tas\tit\tcan\tsatisfy\tthe\tbatch\tintegration\twith other\tparts\tof\tthe\tbusiness\tand\tits\town\tbusiness\tstakeholders,\tno\tone\twould\tcare.\n\nThis\tstructure\thas\tallowed\tfor\tsignificant\tautonomy\tof\tnot\tonly\tthe\tteams\tbut\talso\tthe different\tparts\tof\tthe\tbusiness.\tFrom\ta\thandful\tof\tservices\ta\tfew\tyears\tago,\tREA\tnow\thas hundreds,\twith\tmore\tservices\tthan\tpeople,\tand\tis\tgrowing\tat\ta\trapid\tpace.\tThe\tability\tto deliver\tchange\thas\thelped\tthe\tcompany\tachieve\tsignificant\tsuccess\tin\tthe\tlocal\tmarket\tto the\tpoint\twhere\tit\tis\texpanding\toverseas.\tAnd,\tmost\theartening\tof\tall,\tfrom\ttalking\tto\tthe people\tthere\tI\tget\tthe\timpression\tthat\tboth\tthe\tarchitecture\tand\torganizational\tstructure\tas they\tstand\tnow\tare\tjust\tthe\tlatest\titeration\trather\tthan\tthe\tdestination.\tI\tdaresay\tin\tanother five\tyears\tREA\twill\tlook\tvery\tdifferent\tagain.\n\nThose\torganizations\tthat\tare\tadaptive\tenough\tto\tchange\tnot\tonly\ttheir\tsystem\tarchitecture but\talso\ttheir\torganizational\tstructure\tcan\tyield\thuge\tbenefits\tin\tterms\tof\timproved autonomy\tof\tteams\tand\tfaster\ttime\tto\tmarket\tfor\tnew\tfeatures\tand\tfunctionality.\tREA\tis just\tone\tof\ta\tnumber\tof\torganizations\tthat\tare\trealizing\tthat\tsystem\tarchitecture\tdoesn’t exist\tin\ta\tvacuum.",
      "content_length": 1586,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 344,
      "content": "Conway’s\tLaw\tin\tReverse\n\nSo\tfar,\twe’ve\tspoken\tabout\thow\tthe\torganization\timpacts\tthe\tsystem\tdesign.\tBut\twhat about\tthe\treverse?\tNamely,\tcan\ta\tsystem\tdesign\tchange\tthe\torganization?\tWhile\tI\thaven’t been\table\tto\tfind\tthe\tsame\tquality\tof\tevidence\tto\tsupport\tthe\tidea\tthat\tConway’s\tlaw works\tin\treverse,\tI’ve\tseen\tit\tanecdotally.\n\nProbably\tthe\tbest\texample\twas\ta\tclient\tI\tworked\twith\tmany\tyears\tago.\tBack\tin\tthe\tdays when\tthe\tWeb\twas\tfairly\tnascent,\tand\tthe\tInternet\twas\tseen\tas\tsomething\tthat\tarrived\ton an\tAOL\tfloppy\tdisk\tthrough\tthe\tdoor,\tthis\tcompany\twas\ta\tlarge\tprint\tfirm\tthat\thad\ta small,\tmodest\twebsite.\tIt\thad\ta\twebsite\tbecause\tit\twas\tthe\tthing\tto\tdo,\tbut\tin\tthe\tgrand scheme\tof\tthings\tit\twas\tfairly\tunimportant\tto\thow\tthe\tbusiness\toperated.\tWhen\tthe original\tsystem\twas\tcreated,\ta\tfairly\tarbitrary\ttechnical\tdecision\twas\tmade\tas\tto\thow\tthe system\twould\twork.\n\nThe\tcontent\tfor\tthis\tsystem\twas\tsourced\tin\tmultiple\tways,\tbut\tmost\tof\tit\tcame\tfrom\tthird parties\twho\twere\tplacing\tads\tfor\tviewing\tby\tthe\tgeneral\tpublic.\tThere\twas\tan\tinput\tsystem that\tallowed\tcontent\tto\tbe\tcreated\tby\tthe\tpaying\tthird\tparties,\ta\tcentral\tsystem\tthat\ttook that\tdata\tand\tenriched\tit\tin\tvarious\tways,\tand\tan\toutput\tsystem\tthat\tcreated\tthe\tfinal website\tthat\tthe\tgeneral\tpublic\tcould\tbrowse.\n\nWhether\tthe\toriginal\tdesign\tdecisions\twere\tright\tat\tthe\ttime\tis\ta\tconversation\tfor historians,\tbut\tmany\tyears\ton\tthe\tcompany\thad\tchanged\tquite\ta\tbit\tand\tI\tand\tmany\tof\tmy colleagues\twere\tstarting\tto\twonder\tif\tthe\tsystem\tdesign\twas\tfit\tfor\tthe\tcompany’s\tpresent state.\tIts\tphysical\tprint\tbusiness\thad\tdiminished\tsignificantly,\tand\tthe\trevenues\tand therefore\tbusiness\toperations\tof\tthe\torganization\twere\tnow\tdominated\tby\tits\tonline presence.\n\nWhat\twe\tsaw\tat\tthat\ttime\twas\tan\torganization\ttightly\taligned\tto\tthis\tthree-part\tsystem. Three\tchannels\tor\tdivisions\tin\tthe\tIT\tside\tof\tthe\tbusiness\taligned\twith\teach\tof\tthe\tinput, core,\tand\toutput\tparts\tof\tthe\tbusiness.\tWithin\tthose\tchannels,\tthere\twere\tseparate\tdelivery teams.\tWhat\tI\tdidn’t\trealize\tat\tthe\ttime\twas\tthat\tthese\torganizational\tstructures\tdidn’t predate\tthe\tsystem\tdesign,\tbut\tactually\tgrew\tup\taround\tit.\tAs\tthe\tprint\tside\tof\tthe\tbusiness diminished,\tand\tthe\tdigital\tside\tof\tthe\tbusiness\tgrew,\tthe\tsystem\tdesign\tinadvertently\tlay the\tpath\tfor\thow\tthe\torganization\tgrew.\n\nIn\tthe\tend\twe\trealized\tthat\twhatever\tthe\tshortcomings\tof\tthe\tsystem\tdesign\twere,\twe would\thave\tto\tmake\tchanges\tto\tthe\torganizational\tstructure\tto\tmake\ta\tshift.\tMany\tyears later,\tthat\tprocess\tremains\ta\twork\tin\tprogress!",
      "content_length": 2513,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 345,
      "content": "People\n\nNo\tmatter\thow\tit\tlooks\tat\tfirst,\tit’s\talways\ta\tpeople\tproblem.\n\nGerry\tWeinberg,\tThe\tSecond\tLaw\tof\tConsulting\n\nWe\thave\tto\taccept\tthat\tin\ta\tmicroservice\tenvironment,\tit\tis\tharder\tfor\ta\tdeveloper\tto\tjust think\tabout\twriting\tcode\tin\this\town\tlittle\tworld.\tHe\thas\tto\tbe\tmore\taware\tof\tthe implications\tof\tthings\tlike\tcalls\tacross\tnetwork\tboundaries,\tor\tthe\timplications\tof\tfailure. We’ve\talso\ttalked\tabout\tthe\tability\tof\tmicroservices\tto\tmake\tit\teasier\tto\ttry\tout\tnew technologies,\tfrom\tdata\tstores\tto\tlanguages.\tBut\tif\tyou’re\tmoving\tfrom\ta\tworld\twhere\tyou have\ta\tmonolithic\tsystem,\twhere\tthe\tmajority\tof\tyour\tdevelopers\thave\tjust\thad\tto\tuse\tone language\tand\tremain\tcompletely\toblivious\tto\tthe\toperational\tconcerns,\tthen\tthrowing them\tinto\tthe\tworld\tof\tmicroservices\tmay\tbe\ta\trude\tawakening\tfor\tthem.\n\nLikewise,\tpushing\tpower\tinto\tdevelopment\tteams\tto\tincrease\tautonomy\tcan\tbe\tfraught. People\twho\thave\tin\tthe\tpast\tthrown\twork\tover\tthe\twall\tto\tsomeone\telse\tare\taccustomed\tto having\tsomeone\telse\tto\tblame,\tand\tmay\tnot\tfeel\tcomfortable\tbeing\tfully\taccountable\tfor their\twork.\tYou\tmay\teven\tfind\tcontractual\tbarriers\tto\thaving\tyour\tdevelopers\tcarry support\tpagers\tfor\tthe\tsystems\tthey\tsupport!\n\nAlthough\tthis\tbook\thas\tmostly\tbeen\tabout\ttechnology,\tpeople\tare\tnot\tjust\ta\tside\tissue\tto be\tconsidered;\tthey\tare\tthe\tpeople\twho\tbuilt\twhat\tyou\thave\tnow,\tand\twill\tbuild\twhat happens\tnext.\tComing\tup\twith\ta\tvision\tfor\thow\tthings\tshould\tbe\tdone\twithout\tconsidering how\tyour\tcurrent\tstaff\twill\tfeel\tabout\tthis\tor\twithout\tconsidering\twhat\tcapabilities\tthey have\tis\tlikely\tto\tlead\tto\ta\tbad\tplace.\n\nEach\torganization\thas\tits\town\tset\tof\tdynamics\taround\tthis\ttopic.\tUnderstand\tyour\tstaff’s appetite\tto\tchange.\tDon’t\tpush\tthem\ttoo\tfast!\tMaybe\tyou\tstill\thave\ta\tseparate\tteam\thandle frontline\tsupport\tor\tdeployment\tfor\ta\tshort\tperiod\tof\ttime,\tgiving\tyour\tdevelopers\ttime\tto adjust\tto\tother\tnew\tpractices.\tYou\tmay,\thowever,\thave\tto\taccept\tthat\tyou\tneed\tdifferent sorts\tof\tpeople\tin\tyour\torganization\tto\tmake\tall\tthis\twork.\tWhatever\tyour\tapproach, understand\tthat\tyou\tneed\tto\tbe\tclear\tin\tarticulating\tthe\tresponsibilities\tof\tyour\tpeople\tin\ta microservices\tworld,\tand\talso\tbe\tclear\twhy\tthose\tresponsibilities\tare\timportant\tto\tyou. This\tcan\thelp\tyou\tsee\twhat\tyour\tskill\tgaps\tmight\tbe,\tand\tthink\tabout\thow\tto\tclose\tthem. For\tmany\tpeople,\tthis\twill\tbe\ta\tpretty\tscary\tjourney.\tJust\tremember\tthat\twithout\tpeople\ton board,\tany\tchange\tyou\tmight\twant\tto\tmake\tcould\tbe\tdoomed\tfrom\tthe\tstart.",
      "content_length": 2457,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 346,
      "content": "Summary\n\nConway’s\tlaw\thighlights\tthe\tperils\tof\ttrying\tto\tenforce\ta\tsystem\tdesign\tthat\tdoesn’t\tmatch the\torganization.\tThis\tleads\tus\tto\ttrying\tto\talign\tservice\townership\tto\tcolocated\tteams, which\tthemselves\tare\taligned\taround\tthe\tsame\tbounded\tcontexts\tof\tthe\torganization. When\tthe\ttwo\tare\tnot\tin\talignment,\twe\tget\ttension\tpoints\tas\toutlined\tthroughout\tthis chapter.\tBy\trecognizing\tthe\tlink\tbetween\tthe\ttwo,\twe’ll\tmake\tsure\tthe\tsystem\twe\tare trying\tto\tbuild\tmakes\tsense\tfor\tthe\torganization\twe’re\tbuilding\tit\tfor.\n\nSome\tof\twhat\twe\tcovered\there\ttouched\ton\tthe\tchallenges\tof\tworking\twith\torganizations\tat scale.\tHowever,\tthere\tare\tother\ttechnical\tconsiderations\tthat\twe\tneed\tto\tworry\tabout\twhen our\tsystems\tstart\tto\tgrow\tbeyond\ta\tfew\tdiscrete\tservices.\tWe’ll\taddress\tthose\tnext.\n\n4\tAnd\twe\tall\tknow\tWindows\tVista\twas\tquite\terror-prone!",
      "content_length": 831,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 347,
      "content": "Chapter\t11.\tMicroservices\tat\tScale\n\nWhen\tyou’re\tdealing\twith\tnice,\tsmall,\tbook-sized\texamples,\teverything\tseems\tsimple.\tBut the\treal\tworld\tis\ta\tmore\tcomplex\tspace.\tWhat\thappens\twhen\tour\tmicroservice architectures\tgrow\tfrom\tsimpler,\tmore\thumble\tbeginnings\tto\tsomething\tmore\tcomplex? What\thappens\twhen\twe\thave\tto\thandle\tfailure\tof\tmultiple\tseparate\tservices\tor\tmanage hundreds\tof\tservices?\tWhat\tare\tsome\tof\tthe\tcoping\tpatterns\twhen\tyou\thave\tmore microservices\tthan\tpeople?\tLet’s\tfind\tout.",
      "content_length": 486,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 348,
      "content": "Failure\tIs\tEverywhere\n\nWe\tunderstand\tthat\tthings\tcan\tgo\twrong.\tHard\tdisks\tcan\tfail.\tOur\tsoftware\tcan\tcrash.\tAnd as\tanyone\twho\thas\tread\tthe\tfallacies\tof\tdistributed\tcomputing\tcan\ttell\tyou,\twe\tknow\tthat the\tnetwork\tis\tunreliable.\tWe\tcan\tdo\tour\tbest\tto\ttry\tto\tlimit\tthe\tcauses\tof\tfailure,\tbut\tat\ta certain\tscale,\tfailure\tbecomes\tinevitable.\tHard\tdrives,\tfor\texample,\tare\tmore\treliable\tnow than\tever\tbefore,\tbut\tthey’ll\tbreak\teventually.\tThe\tmore\thard\tdrives\tyou\thave,\tthe\thigher the\tlikelihood\tof\tfailure\tfor\tan\tindividual\tunit;\tfailure\tbecomes\ta\tstatistical\tcertainty\tat scale.\n\nEven\tfor\tthose\tof\tus\tnot\tthinking\tat\textreme\tscale,\tif\twe\tcan\tembrace\tthe\tpossibility\tof failure\twe\twill\tbe\tbetter\toff.\tFor\texample,\tif\twe\tcan\thandle\tthe\tfailure\tof\ta\tservice gracefully,\tthen\tit\tfollows\tthat\twe\tcan\talso\tdo\tin-place\tupgrades\tof\ta\tservice,\tas\ta\tplanned outage\tis\tmuch\teasier\tto\tdeal\twith\tthan\tan\tunplanned\tone.\n\nWe\tcan\talso\tspend\ta\tbit\tless\tof\tour\ttime\ttrying\tto\tstop\tthe\tinevitable,\tand\ta\tbit\tmore\tof\tour time\tdealing\twith\tit\tgracefully.\tI’m\tamazed\tat\thow\tmany\torganizations\tput\tprocesses\tand controls\tin\tplace\tto\ttry\tto\tstop\tfailure\tfrom\toccurring,\tbut\tput\tlittle\tto\tno\tthought\tinto actually\tmaking\tit\teasier\tto\trecover\tfrom\tfailure\tin\tthe\tfirst\tplace.\n\nBaking\tin\tthe\tassumption\tthat\teverything\tcan\tand\twill\tfail\tleads\tyou\tto\tthink\tdifferently about\thow\tyou\tsolve\tproblems.\n\nI\tsaw\tone\texample\tof\tthis\tthinking\twhile\tspending\tsome\ttime\ton\tthe\tGoogle\tcampus\tmany years\tago.\tIn\tthe\treception\tarea\tof\tone\tof\tthe\tbuildings\tin\tMountain\tView\twas\tan\told\track of\tmachines,\tthere\tas\ta\tsort\tof\texhibit.\tI\tnoticed\ta\tcouple\tof\tthings.\tFirst,\tthese\tservers weren’t\tin\tserver\tenclosures,\tthey\twere\tjust\tbare\tmotherboards\tslotted\tinto\tthe\track.\tThe main\tthing\tI\tnoticed,\tthough,\twas\tthat\tthe\thard\tdrives\twere\tattached\tby\tvelcro.\tI\tasked\tone of\tthe\tGooglers\twhy\tthat\twas.\t“Oh,”\the\tsaid,\t“the\thard\tdrives\tfail\tso\tmuch\twe\tdon’t\twant them\tscrewed\tin.\tWe\tjust\trip\tthem\tout,\tthrow\tthem\tin\tthe\tbin,\tand\tvelcro\tin\ta\tnew\tone.”\n\nSo\tlet\tme\trepeat:\tat\tscale,\teven\tif\tyou\tbuy\tthe\tbest\tkit,\tthe\tmost\texpensive\thardware,\tyou cannot\tavoid\tthe\tfact\tthat\tthings\tcan\tand\twill\tfail.\tTherefore,\tyou\tneed\tto\tassume\tfailure can\thappen.\tIf\tyou\tbuild\tthis\tthinking\tinto\teverything\tyou\tdo,\tand\tplan\tfor\tfailure,\tyou\tcan make\tdifferent\ttrade-offs.\tIf\tyou\tknow\tyour\tsystem\tcan\thandle\tthe\tfact\tthat\ta\tserver\tcan and\twill\tfail,\twhy\tbother\tspending\tmuch\ton\tit\tat\tall?\tWhy\tnot\tuse\ta\tbare\tmotherboard\twith cheaper\tcomponents\t(and\tsome\tvelcro)\tlike\tGoogle\tdid,\trather\tthan\tworrying\ttoo\tmuch about\tthe\tresiliency\tof\ta\tsingle\tnode?",
      "content_length": 2573,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 349,
      "content": "How\tMuch\tIs\tToo\tMuch?\n\nWe\ttouched\ton\tthe\ttopic\tof\tcross-functional\trequirements\tin\tChapter\t7.\tUnderstanding cross-functional\trequirements\tis\tall\tabout\tconsidering\taspects\tlike\tdurability\tof\tdata, availability\tof\tservices,\tthroughput,\tand\tacceptable\tlatency\tof\tservices.\tMany\tof\tthe techniques\tcovered\tin\tthis\tchapter\tand\telsewhere\ttalk\tabout\tapproaches\tto\timplement these\trequirements,\tbut\tonly\tyou\tknow\texactly\twhat\tthe\trequirements\tthemselves\tmight be.\n\nHaving\tan\tautoscaling\tsystem\tcapable\tof\treacting\tto\tincreased\tload\tor\tfailure\tof\tindividual nodes\tmight\tbe\tfantastic,\tbut\tcould\tbe\toverkill\tfor\ta\treporting\tsystem\tthat\tonly\tneeds\tto run\ttwice\ta\tmonth,\twhere\tbeing\tdown\tfor\ta\tday\tor\ttwo\tisn’t\tthat\tbig\tof\ta\tdeal.\tLikewise, figuring\tout\thow\tto\tdo\tblue/green\tdeployments\tto\teliminate\tdowntime\tof\ta\tservice\tmight make\tsense\tfor\tyour\tonline\tecommerce\tsystem,\tbut\tfor\tyour\tcorporate\tintranet\tknowledge base\tit’s\tprobably\ta\tstep\ttoo\tfar.\n\nKnowing\thow\tmuch\tfailure\tyou\tcan\ttolerate,\tor\thow\tfast\tyour\tsystem\tneeds\tto\tbe,\tis driven\tby\tthe\tusers\tof\tyour\tsystem.\tThat\tin\tturn\twill\thelp\tyou\tunderstand\twhich techniques\twill\tmake\tthe\tmost\tsense\tfor\tyou.\tThat\tsaid,\tyour\tusers\twon’t\talways\tbe\table\tto articulate\twhat\tthe\texact\trequirements\tare.\tSo\tyou\tneed\tto\task\tquestions\tto\thelp\textract\tthe right\tinformation,\tand\thelp\tthem\tunderstand\tthe\trelative\tcosts\tof\tproviding\tdifferent\tlevels of\tservice.\n\nAs\tI\tmentioned\tpreviously,\tthese\tcross-functional\trequirements\tcan\tvary\tfrom\tservice\tto service,\tbut\tI\twould\tsuggest\tdefining\tsome\tgeneral\tcross-functionals\tand\tthen\toverriding them\tfor\tparticular\tuse\tcases.\tWhen\tit\tcomes\tto\tconsidering\tif\tand\thow\tto\tscale\tout\tyour system\tto\tbetter\thandle\tload\tor\tfailure,\tstart\tby\ttrying\tto\tunderstand\tthe\tfollowing requirements:\n\nResponse\ttime/latency\n\nHow\tlong\tshould\tvarious\toperations\ttake?\tIt\tcan\tbe\tuseful\there\tto\tmeasure\tthis\twith different\tnumbers\tof\tusers\tto\tunderstand\thow\tincreasing\tload\twill\timpact\tthe response\ttime.\tGiven\tthe\tnature\tof\tnetworks,\tyou’ll\talways\thave\toutliers,\tso\tsetting targets\tfor\ta\tgiven\tpercentile\tof\tthe\tresponses\tmonitored\tcan\tbe\tuseful.\tThe\ttarget should\talso\tinclude\tthe\tnumber\tof\tconcurrent\tconnections/users\tyou\twill\texpect\tyour software\tto\thandle.\tSo\tyou\tmight\tsay,\t“We\texpect\tthe\twebsite\tto\thave\ta\t90th- percentile\tresponse\ttime\tof\t2\tseconds\twhen\thandling\t200\tconcurrent\tconnections\tper second.”\n\nAvailability",
      "content_length": 2375,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 350,
      "content": "Can\tyou\texpect\ta\tservice\tto\tbe\tdown?\tIs\tthis\tconsidered\ta\t24/7\tservice?\tSome\tpeople like\tto\tlook\tat\tperiods\tof\tacceptable\tdowntime\twhen\tmeasuring\tavailability,\tbut\thow useful\tis\tthis\tto\tsomeone\tcalling\tyour\tservice?\tI\tshould\teither\tbe\table\tto\trely\ton\tyour service\tresponding\tor\tnot.\tMeasuring\tperiods\tof\tdowntime\tis\treally\tmore\tuseful\tfrom a\thistorical\treporting\tangle.\n\nDurability\tof\tdata\n\nHow\tmuch\tdata\tloss\tis\tacceptable?\tHow\tlong\tshould\tdata\tbe\tkept\tfor?\tThis\tis\thighly likely\tto\tchange\ton\ta\tcase-by-case\tbasis.\tFor\texample,\tyou\tmight\tchoose\tto\tkeep\tuser session\tlogs\tfor\ta\tyear\tor\tless\tto\tsave\tspace,\tbut\tyour\tfinancial\ttransaction\trecords might\tneed\tto\tbe\tkept\tfor\tmany\tyears.\n\nOnce\tyou\thave\tthese\trequirements\tin\tplace,\tyou’ll\twant\ta\tway\tto\tsystematically\tmeasure them\ton\tan\tongoing\tbasis.\tYou\tmay\tdecide\tto\tmake\tuse\tof\tperformance\ttests,\tfor\texample, to\tensure\tyour\tsystem\tmeets\tacceptable\tperformance\ttargets,\tbut\tyou’ll\twant\tto\tmake\tsure you\tare\tmonitoring\tthese\tstats\tin\tproduction\tas\twell!",
      "content_length": 1001,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 351,
      "content": "Degrading\tFunctionality\n\nAn\tessential\tpart\tof\tbuilding\ta\tresilient\tsystem,\tespecially\twhen\tyour\tfunctionality\tis spread\tover\ta\tnumber\tof\tdifferent\tmicroservices\tthat\tmay\tbe\tup\tor\tdown,\tis\tthe\tability\tto safely\tdegrade\tfunctionality.\tLet’s\timagine\ta\tstandard\tweb\tpage\ton\tour\tecommerce\tsite.\tTo pull\ttogether\tthe\tvarious\tparts\tof\tthat\twebsite,\twe\tmight\tneed\tseveral\tmicroservices\tto\tplay a\tpart.\tOne\tmicroservice\tmight\tdisplay\tthe\tdetails\tabout\tthe\talbum\tbeing\toffered\tfor\tsale. Another\tmight\tshow\tthe\tprice\tand\tstock\tlevel.\tAnd\twe’ll\tprobably\tbe\tshowing\tshopping cart\tcontents\ttoo,\twhich\tmay\tbe\tyet\tanother\tmicroservice.\tNow\tif\tone\tof\tthose\tservices\tis down,\tand\tthat\tresults\tin\tthe\twhole\tweb\tpage\tbeing\tunavailable,\tthen\twe\thave\targuably made\ta\tsystem\tthat\tis\tless\tresilient\tthan\tone\tthat\trequires\tonly\tone\tservice\tto\tbe\tavailable.\n\nWhat\twe\tneed\tto\tdo\tis\tunderstand\tthe\timpact\tof\teach\toutage,\tand\twork\tout\thow\tto properly\tdegrade\tfunctionality.\tIf\tthe\tshopping\tcart\tservice\tis\tunavailable,\twe’re\tprobably in\ta\tlot\tof\ttrouble,\tbut\twe\tcould\tstill\tshow\tthe\tweb\tpage\twith\tthe\tlisting.\tPerhaps\twe\tjust hide\tthe\tshopping\tcart\tor\treplace\tit\twith\tan\ticon\tsaying\t“Be\tBack\tSoon!”\n\nWith\ta\tsingle,\tmonolithic\tapplication,\twe\tdon’t\thave\tmany\tdecisions\tto\tmake.\tSystem health\tis\tbinary.\tBut\twith\ta\tmicroservice\tarchitecture,\twe\tneed\tto\tconsider\ta\tmuch\tmore nuanced\tsituation.\tThe\tright\tthing\tto\tdo\tin\tany\tsituation\tis\toften\tnot\ta\ttechnical\tdecision. We\tmight\tknow\twhat\tis\ttechnically\tpossible\twhen\tthe\tshopping\tcart\tis\tdown,\tbut\tunless we\tunderstand\tthe\tbusiness\tcontext\twe\twon’t\tunderstand\twhat\taction\twe\tshould\tbe\ttaking. For\texample,\tperhaps\twe\tclose\tthe\tentire\tsite,\tstill\tallow\tpeople\tto\tbrowse\tthe\tcatalog\tof items,\tor\treplace\tthe\tpart\tof\tthe\tUI\tcontaining\tthe\tcart\tcontrol\twith\ta\tphone\tnumber\tfor placing\tan\torder.\tBut\tfor\tevery\tcustomer-facing\tinterface\tthat\tuses\tmultiple\tmicroservices, or\tevery\tmicroservice\tthat\tdepends\ton\tmultiple\tdownstream\tcollaborators,\tyou\tneed\tto\task yourself,\t“What\thappens\tif\tthis\tis\tdown?”\tand\tknow\twhat\tto\tdo.\n\nBy\tthinking\tabout\tthe\tcriticality\tof\teach\tof\tour\tcapabilities\tin\tterms\tof\tour\tcross-functional requirements,\twe’ll\tbe\tmuch\tbetter\tpositioned\tto\tknow\twhat\twe\tcan\tdo.\tNow\tlet’s consider\tsome\tthings\twe\tcan\tdo\tfrom\ta\ttechnical\tpoint\tof\tview\tto\tmake\tsure\tthat\twhen failure\toccurs\twe\tcan\thandle\tit\tgracefully.",
      "content_length": 2338,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 352,
      "content": "Architectural\tSafety\tMeasures\n\nThere\tare\ta\tfew\tpatterns,\twhich\tcollectively\tI\trefer\tto\tas\tarchitectural\tsafety\tmeasures,\tthat we\tcan\tmake\tuse\tof\tto\tensure\tthat\tif\tsomething\tdoes\tgo\twrong,\tit\tdoesn’t\tcause\tnasty ripple-out\teffects.\tThese\tare\tpoints\tit\tis\tessential\tyou\tunderstand,\tand\tshould\tstrongly consider\tstandardizing\tin\tyour\tsystem\tto\tensure\tthat\tone\tbad\tcitizen\tdoesn’t\tbring\tthe whole\tworld\tcrashing\tdown\taround\tyour\tears.\tIn\ta\tmoment,\twe’ll\ttake\ta\tlook\tat\ta\tfew\tkey safety\tmeasures\tyou\tshould\tconsider,\tbut\tbefore\twe\tdo,\tI’d\tlike\tto\tshare\ta\tbrief\tstory\tto outline\tthe\tsort\tof\tthing\tthat\tcan\tgo\twrong.\n\nI\twas\ta\ttechnical\tlead\ton\ta\tproject\twhere\twe\twere\tbuilding\tan\tonline\tclassified\tads website.\tThe\twebsite\titself\thandled\tfairly\thigh\tvolumes,\tand\tgenerated\ta\tgood\tdeal\tof income\tfor\tthe\tbusiness.\tOur\tcore\tapplication\thandled\tsome\tdisplay\tof\tclassified\tads\titself, and\talso\tproxied\tcalls\tto\tother\tservices\tthat\tprovided\tdifferent\ttypes\tof\tproducts,\tas\tshown in\tFigure\t11-1.\tThis\tis\tactually\tan\texample\tof\ta\tstrangler\tapplication,\twhere\ta\tnew\tsystem intercepts\tcalls\tmade\tto\tlegacy\tapplications\tand\tgradually\treplaces\tthem\taltogether.\tAs part\tof\tthis\tproject,\twe\twere\tpartway\tthrough\tretiring\tthe\tolder\tapplications.\tWe\thad\tjust moved\tover\tthe\thighest\tvolume\tand\tbiggest\tearning\tproduct,\tbut\tmuch\tof\tthe\trest\tof\tthe ads\twere\tstill\tbeing\tserved\tby\ta\tnumber\tof\tolder\tapplications.\tIn\tterms\tof\tboth\tthe\tnumber of\tsearches\tand\tthe\tmoney\tmade\tby\tthese\tapplications,\tthere\twas\ta\tvery\tlong\ttail.\n\nFigure\t11-1.\tA\tclassified\tads\twebsite\tstrangling\tolder\tlegacy\tapplications\n\nOur\tsystem\thad\tbeen\tlive\tfor\ta\twhile\tand\twas\tbehaving\tvery\twell,\thandling\ta\tnot insignificant\tload.\tAt\tthat\ttime\twe\tmust\thave\tbeen\thandling\taround\t6,000–7,000\trequests per\tsecond\tduring\tpeak,\tand\talthough\tmost\tof\tthat\twas\tvery\theavily\tcached\tby\treverse proxies\tsitting\tin\tfront\tof\tour\tapplication\tservers,\tthe\tsearches\tfor\tproducts\t(the\tmost important\taspect\tof\tthe\tsite)\twere\tmostly\tuncached\tand\trequired\ta\tfull\tserver\tround-trip.",
      "content_length": 2005,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 353,
      "content": "One\tmorning,\tjust\tbefore\twe\thit\tour\tdaily\tlunchtime\tpeak,\tthe\tsystem\tstarted\tbehaving slowly,\tthen\tgradually\tstarted\tfailing.\tWe\thad\tsome\tlevel\tof\tmonitoring\ton\tour\tnew\tcore application,\tenough\tto\ttell\tus\tthat\teach\tof\tour\tapplication\tnodes\twas\thitting\ta\t100%\tCPU spike,\twell\tabove\tthe\tnormal\tlevels\teven\tat\tpeak.\tIn\ta\tshort\tperiod\tof\ttime,\tthe\tentire\tsite went\tdown.\n\nWe\tmanaged\tto\ttrack\tdown\tthe\tculprit\tand\tbring\tthe\tsite\tback\tup.\tIt\tturned\tout\tone\tof\tthe downstream\tad\tsystems,\tone\tof\tthe\toldest\tand\tleast\tactively\tmaintained,\thad\tstarted responding\tvery\tslowly.\tResponding\tvery\tslowly\tis\tone\tof\tthe\tworst\tfailure\tmodes\tyou\tcan experience.\tIf\ta\tsystem\tis\tjust\tnot\tthere,\tyou\tfind\tout\tpretty\tquickly.\tWhen\tit’s\tjust\tslow, you\tend\tup\twaiting\taround\tfor\ta\twhile\tbefore\tgiving\tup.\tBut\twhatever\tthe\tcause\tof\tthe failure,\twe\thad\tcreated\ta\tsystem\tthat\twas\tvulnerable\tto\ta\tcascading\tfailure.\tA\tdownstream service,\tover\twhich\twe\thad\tlittle\tcontrol,\twas\table\tto\ttake\tdown\tour\twhole\tsystem.\n\nWhile\tone\tteam\tlooked\tat\tthe\tproblems\twith\tthe\tdownstream\tsystem,\tthe\trest\tof\tus\tstarted looking\tat\twhat\thad\tgone\twrong\tin\tour\tapplication.\tWe\tfound\ta\tfew\tproblems.\tWe\twere using\tan\tHTTP\tconnection\tpool\tto\thandle\tour\tdownstream\tconnections.\tThe\tthreads\tin\tthe pool\titself\thad\ttimeouts\tconfigured\tfor\thow\tlong\tthey\twould\twait\twhen\tmaking\tthe downstream\tHTTP\tcall,\twhich\tis\tgood.\tThe\tproblem\twas\tthat\tthe\tworkers\twere\tall\ttaking a\twhile\tto\ttime\tout\tdue\tto\tthe\tslow\tdownstream\tsystem.\tWhile\tthey\twere\twaiting,\tmore requests\twent\tto\tthe\tpool\tasking\tfor\tworker\tthreads.\tWith\tno\tworkers\tavailable,\tthese requests\tthemselves\thung.\tIt\tturned\tout\tthe\tconnection\tpool\tlibrary\twe\twere\tusing\tdid have\ta\ttimeout\tfor\twaiting\tfor\tworkers,\tbut\tthis\twas\tdisabled\tby\tdefault!\tThis\tled\tto\ta\thuge build-up\tof\tblocked\tthreads.\tOur\tapplication\tnormally\thad\t40\tconcurrent\tconnections\tat any\tgiven\ttime.\tIn\tthe\tspace\tof\tfive\tminutes,\tthis\tsituation\tcaused\tus\tto\tpeak\tat\taround\t800 connections,\tbringing\tthe\tsystem\tdown.\n\nWhat\twas\tworse\twas\tthat\tthe\tdownstream\tservice\twe\twere\ttalking\tto\trepresented functionality\tthat\tless\tthan\t5%\tof\tour\tcustomer\tbase\tused,\tand\tgenerated\teven\tless\trevenue than\tthat.\tWhen\tyou\tget\tdown\tto\tit,\twe\tdiscovered\tthe\thard\tway\tthat\tsystems\tthat\tjust\tact slow\tare\tmuch\tharder\tto\tdeal\twith\tthan\tsystems\tthat\tjust\tfail\tfast.\tIn\ta\tdistributed\tsystem, latency\tkills.\n\nEven\tif\twe’d\thad\tthe\ttimeouts\ton\tthe\tpool\tset\tcorrectly,\twe\twere\talso\tsharing\ta\tsingle HTTP\tconnection\tpool\tfor\tall\toutbound\trequests.\tThis\tmeant\tthat\tone\tslow\tservice\tcould exhaust\tthe\tnumber\tof\tavailable\tworkers\tall\tby\titself,\teven\tif\teverything\telse\twas\thealthy. Lastly,\tit\twas\tclear\tthat\tthe\tdownstream\tservice\tin\tquestion\twasn’t\thealthy,\tbut\twe\tkept sending\ttraffic\tits\tway.\tIn\tour\tsituation,\tthis\tmeant\twe\twere\tactually\tmaking\ta\tbad situation\tworse,\tas\tthe\tdownstream\tservice\thad\tno\tchance\tto\trecover.\tWe\tended\tup implementing\tthree\tfixes\tto\tavoid\tthis\thappening\tagain:\tgetting\tour\ttimeouts\tright, implementing\tbulkheads\tto\tseparate\tout\tdifferent\tconnection\tpools,\tand\timplementing\ta circuit\tbreaker\tto\tavoid\tsending\tcalls\tto\tan\tunhealthy\tsystem\tin\tthe\tfirst\tplace.",
      "content_length": 3120,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 354,
      "content": "The\tAntifragile\tOrganization\n\nIn\this\tbook\tAntifragile\t(Random\tHouse),\tNassim\tTaleb\ttalks\tabout\tthings\tthat\tactually benefit\tfrom\tfailure\tand\tdisorder.\tAriel\tTseitlin\tused\tthis\tconcept\tto\tcoin\tthe\tconcept\tof\tthe antifragile\torganization\tin\tregards\tto\thow\tNetflix\toperates.\n\nThe\tscale\tat\twhich\tNetflix\toperates\tis\twell\tknown,\tas\tis\tthe\tfact\tthat\tNetflix\tis\tbased entirely\ton\tthe\tAWS\tinfrastructure.\tThese\ttwo\tfactors\tmean\tthat\tit\thas\tto\tembrace\tfailure well.\tNetflix\tgoes\tbeyond\tthat\tby\tactually\tinciting\tfailure\tto\tensure\tthat\tits\tsystems\tare tolerant\tof\tit.\n\nSome\torganizations\twould\tbe\thappy\twith\tgame\tdays,\twhere\tfailure\tis\tsimulated\tby systems\tbeing\tswitched\toff\tand\thaving\tthe\tvarious\tteams\treact.\tDuring\tmy\ttime\tat\tGoogle, this\twas\ta\tfairly\tcommon\toccurrence\tfor\tvarious\tsystems,\tand\tI\tcertainly\tthink\tthat\tmany organizations\tcould\tbenefit\tfrom\thaving\tthese\tsorts\tof\texercises\tregularly.\tGoogle\tgoes beyond\tsimple\ttests\tto\tmimic\tserver\tfailure,\tand\tas\tpart\tof\tits\tannual\tDiRT\t(Disaster Recovery\tTest)\texercises\tit\thas\tsimulated\tlarge-scale\tdisasters\tsuch\tas\tearthquakes.\tNetflix also\ttakes\ta\tmore\taggressive\tapproach,\tby\twriting\tprograms\tthat\tcause\tfailure\tand\trunning them\tin\tproduction\ton\ta\tdaily\tbasis.\n\nThe\tmost\tfamous\tof\tthese\tprograms\tis\tthe\tChaos\tMonkey,\twhich\tduring\tcertain\thours\tof the\tday\twill\tturn\toff\trandom\tmachines.\tKnowing\tthat\tthis\tcan\tand\twill\thappen\tin production\tmeans\tthat\tthe\tdevelopers\twho\tcreate\tthe\tsystems\treally\thave\tto\tbe\tprepared for\tit.\tThe\tChaos\tMonkey\tis\tjust\tone\tpart\tof\tNetflix’s\tSimian\tArmy\tof\tfailure\tbots.\tThe Chaos\tGorilla\tis\tused\tto\ttake\tout\tan\tentire\tavailability\tcenter\t(the\tAWS\tequivalent\tof\ta data\tcenter),\twhereas\tthe\tLatency\tMonkey\tsimulates\tslow\tnetwork\tconnectivity\tbetween machines.\tNetflix\thas\tmade\tthese\ttools\tavailable\tunder\tan\topen\tsource\tlicense.\tFor\tmany, the\tultimate\ttest\tof\twhether\tyour\tsystem\treally\tis\trobust\tmight\tbe\tunleashing\tyour\tvery own\tSimian\tArmy\ton\tyour\tproduction\tinfrastructure.\n\nEmbracing\tand\tinciting\tfailure\tthrough\tsoftware,\tand\tbuilding\tsystems\tthat\tcan\thandle\tit, is\tonly\tpart\tof\twhat\tNetflix\tdoes.\tIt\talso\tunderstands\tthe\timportance\tof\tlearning\tfrom\tthe failure\twhen\tit\toccurs,\tand\tadopting\ta\tblameless\tculture\twhen\tmistakes\tdo\thappen. Developers\tare\tfurther\tempowered\tto\tbe\tpart\tof\tthis\tlearning\tand\tevolving\tprocess,\tas\teach developer\tis\talso\tresponsible\tfor\tmanaging\this\tor\ther\tproduction\tservices.\n\nBy\tcausing\tfailure\tto\thappen,\tand\tbuilding\tfor\tit,\tNetflix\thas\tensured\tthat\tthe\tsystems\tit has\tscale\tbetter,\tand\tbetter\tsupport\tthe\tneeds\tof\tits\tcustomers.\n\nNot\teveryone\tneeds\tto\tgo\tto\tthe\tsorts\tof\textremes\tthat\tGoogle\tor\tNetflix\tdo,\tbut\tit\tis important\tto\tunderstand\tthe\tmindset\tshift\tthat\tis\trequired\twith\tdistributed\tsystems.\tThings will\tfail.\tThe\tfact\tthat\tyour\tsystem\tis\tnow\tspread\tacross\tmultiple\tmachines\t(which\tcan\tand will\tfail)\tacross\ta\tnetwork\t(which\twill\tbe\tunreliable)\tcan\tactually\tmake\tyour\tsystem\tmore vulnerable,\tnot\tless.\tSo\tregardless\tof\twhether\tyou’re\ttrying\tto\tprovide\ta\tservice\tat\tthe scale\tof\tGoogle\tor\tNetflix,\tpreparing\tyourself\tfor\tthe\tsorts\tof\tfailure\tthat\thappen\twith",
      "content_length": 3079,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 355,
      "content": "more\tdistributed\tarchitectures\tis\tpretty\timportant.\tSo\twhat\tdo\twe\tneed\tto\tdo\tto\thandle failure\tin\tour\tsystems?",
      "content_length": 110,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 356,
      "content": "Timeouts\n\nTimeouts\tare\tsomething\tit\tis\teasy\tto\toverlook,\tbut\tin\ta\tdownstream\tsystem\tthey\tare important\tto\tget\tright.\tHow\tlong\tcan\tI\twait\tbefore\tI\tcan\tconsider\ta\tdownstream\tsystem\tto actually\tbe\tdown?\n\nWait\ttoo\tlong\tto\tdecide\tthat\ta\tcall\thas\tfailed,\tand\tyou\tcan\tslow\tthe\twhole\tsystem\tdown. Time\tout\ttoo\tquickly,\tand\tyou’ll\tconsider\ta\tcall\tthat\tmight\thave\tworked\tas\tfailed.\tHave\tno timeouts\tat\tall,\tand\ta\tdownstream\tsystem\tbeing\tdown\tcould\thang\tyour\twhole\tsystem.\n\nPut\ttimeouts\ton\tall\tout-of-process\tcalls,\tand\tpick\ta\tdefault\ttimeout\tfor\teverything.\tLog when\ttimeouts\toccur,\tlook\tat\twhat\thappens,\tand\tchange\tthem\taccordingly.",
      "content_length": 623,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 357,
      "content": "Circuit\tBreakers\n\nIn\tyour\town\thome,\tcircuit\tbreakers\texist\tto\tprotect\tyour\telectrical\tdevices\tfrom\tspikes\tin the\tpower.\tIf\ta\tspike\toccurs,\tthe\tcircuit\tbreaker\tgets\tblown,\tprotecting\tyour\texpensive home\tappliances.\tYou\tcan\talso\tmanually\tdisable\ta\tcircuit\tbreaker\tto\tcut\tthe\tpower\tto\tpart of\tyour\thome,\tallowing\tyou\tto\twork\tsafely\ton\tthe\telectrics.\tMichael\tNygard’s\tbook Release\tIt!\t(Pragmatic\tProgrammers)\tshows\thow\tthe\tsame\tidea\tcan\twork\twonders\tas\ta protection\tmechanism\tfor\tour\tsoftware.\n\nConsider\tthe\tstory\tI\tshared\tjust\ta\tmoment\tago.\tThe\tdownstream\tlegacy\tad\tapplication\twas responding\tvery\tslowly,\tbefore\teventually\treturning\tan\terror.\tEven\tif\twe’d\tgot\tthe timeouts\tright,\twe’d\tbe\twaiting\ta\tlong\ttime\tbefore\twe\tgot\tthe\terror.\tAnd\tthen\twe’d\ttry\tit again\tthe\tnext\ttime\ta\trequest\tcame\tin,\tand\twait.\tIt’s\tbad\tenough\tthat\tthe\tdownstream service\tis\tmalfunctioning,\tbut\tit’s\tmaking\tus\tgo\tslow\ttoo.\n\nWith\ta\tcircuit\tbreaker,\tafter\ta\tcertain\tnumber\tof\trequests\tto\tthe\tdownstream\tresource\thave failed,\tthe\tcircuit\tbreaker\tis\tblown.\tAll\tfurther\trequests\tfail\tfast\twhile\tthe\tcircuit\tbreaker\tis in\tits\tblown\tstate.\tAfter\ta\tcertain\tperiod\tof\ttime,\tthe\tclient\tsends\ta\tfew\trequests\tthrough\tto see\tif\tthe\tdownstream\tservice\thas\trecovered,\tand\tif\tit\tgets\tenough\thealthy\tresponses\tit resets\tthe\tcircuit\tbreaker.\tYou\tcan\tsee\tan\toverview\tof\tthis\tprocess\tin\tFigure\t11-2.\n\nHow\tyou\timplement\ta\tcircuit\tbreaker\tdepends\ton\twhat\ta\tfailed\trequest\tmeans,\tbut\twhen I’ve\timplemented\tthem\tfor\tHTTP\tconnections\tI’ve\ttaken\tfailure\tto\tmean\teither\ta\ttimeout or\ta\t5XX\tHTTP\treturn\tcode.\tIn\tthis\tway,\twhen\ta\tdownstream\tresource\tis\tdown,\tor\ttiming out,\tor\treturning\terrors,\tafter\ta\tcertain\tthreshold\tis\treached\twe\tautomatically\tstop\tsending traffic\tand\tstart\tfailing\tfast.\tAnd\twe\tcan\tautomatically\tstart\tagain\twhen\tthings\tare\thealthy.\n\nGetting\tthe\tsettings\tright\tcan\tbe\ta\tlittle\ttricky.\tYou\tdon’t\twant\tto\tblow\tthe\tcircuit\tbreaker too\treadily,\tnor\tdo\tyou\twant\tto\ttake\ttoo\tlong\tto\tblow\tit.\tLikewise,\tyou\treally\twant\tto\tmake sure\tthat\tthe\tdownstream\tservice\tis\thealthy\tagain\tbefore\tsending\ttraffic.\tAs\twith\ttimeouts, I’d\tpick\tsome\tsensible\tdefaults\tand\tstick\twith\tthem\teverywhere,\tthen\tchange\tthem\tfor specific\tcases.\n\nWhile\tthe\tcircuit\tbreaker\tis\tblown,\tyou\thave\tsome\toptions.\tOne\tis\tto\tqueue\tup\tthe\trequests and\tretry\tthem\tlater\ton.\tFor\tsome\tuse\tcases,\tthis\tmight\tbe\tappropriate,\tespecially\tif\tyou’re carrying\tout\tsome\twork\tas\tpart\tof\ta\tasynchronous\tjob.\tIf\tthis\tcall\tis\tbeing\tmade\tas\tpart\tof a\tsynchronous\tcall\tchain,\thowever,\tit\tis\tprobably\tbetter\tto\tfail\tfast.\tThis\tcould\tmean propagating\tan\terror\tup\tthe\tcall\tchain,\tor\ta\tmore\tsubtle\tdegrading\tof\tfunctionality.\n\nIf\twe\thave\tthis\tmechanism\tin\tplace\t(as\twith\tthe\tcircuit\tbreakers\tin\tour\thome),\twe\tcould use\tthem\tmanually\tto\tmake\tit\tsafer\tto\tdo\tour\twork.\tFor\texample,\tif\twe\twanted\tto\ttake\ta microservice\tdown\tas\tpart\tof\troutine\tmaintenance,\twe\tcould\tmanually\tblow\tall\tthe\tcircuit breakers\tof\tthe\tdependent\tsystems\tso\tthey\tfail\tfast\twhile\tthe\tmicroservice\tis\toffline.\tOnce it’s\tback,\twe\tcan\treset\tthe\tcircuit\tbreakers\tand\teverything\tshould\tgo\tback\tto\tnormal.",
      "content_length": 3070,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 358,
      "content": "Figure\t11-2.\tAn\toverview\tof\tcircuit\tbreakers",
      "content_length": 44,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 359,
      "content": "Bulkheads\n\nIn\tanother\tpattern\tfrom\tRelease\tIt!,\tNygard\tintroduces\tthe\tconcept\tof\ta\tbulkhead\tas\ta\tway to\tisolate\tyourself\tfrom\tfailure.\tIn\tshipping,\ta\tbulkhead\tis\ta\tpart\tof\tthe\tship\tthat\tcan\tbe sealed\toff\tto\tprotect\tthe\trest\tof\tthe\tship.\tSo\tif\tthe\tship\tsprings\ta\tleak,\tyou\tcan\tclose\tthe bulkhead\tdoors.\tYou\tlose\tpart\tof\tthe\tship,\tbut\tthe\trest\tof\tit\tremains\tintact.\n\nIn\tsoftware\tarchitecture\tterms,\tthere\tare\tlots\tof\tdifferent\tbulkheads\twe\tcan\tconsider. Returning\tto\tmy\town\texperience,\twe\tactually\tmissed\tthe\tchance\tto\timplement\ta\tbulkhead. We\tshould\thave\tused\tdifferent\tconnection\tpools\tfor\teach\tdownstream\tconnection.\tThat way,\tif\tone\tconnection\tpool\tgets\texhausted,\tthe\tother\tconnections\taren’t\timpacted,\tas\twe see\tin\tFigure\t11-3.\tThis\twould\tensure\tthat\tif\ta\tdownstream\tservice\tstarted\tbehaving slowly\tin\tthe\tfuture,\tonly\tthat\tone\tconnection\tpool\twould\tbe\timpacted,\tallowing\tother calls\tto\tproceed\tas\tnormal.\n\nFigure\t11-3.\tUsing\ta\tconnection\tpool\tper\tdownstream\tservice\tto\tprovide\tbulkheads\n\nSeparation\tof\tconcerns\tcan\talso\tbe\ta\tway\tto\timplement\tbulkheads.\tBy\tteasing\tapart functionality\tinto\tseparate\tmicroservices,\twe\treduce\tthe\tchance\tof\tan\toutage\tin\tone\tarea affecting\tanother.\n\nLook\tat\tall\tthe\taspects\tof\tyour\tsystem\tthat\tcan\tgo\twrong,\tboth\tinside\tyour\tmicroservices and\tbetween\tthem.\tDo\tyou\thave\tbulkheads\tin\tplace?\tI’d\tsuggest\tstarting\twith\tseparate connection\tpools\tfor\teach\tdownstream\tconnection\tat\tthe\tvery\tleast.\tYou\tmay\twant\tto\tgo further,\thowever,\tand\tconsider\tusing\tcircuit\tbreakers\ttoo.\n\nWe\tcan\tthink\tof\tour\tcircuit\tbreakers\tas\tan\tautomatic\tmechanism\tto\tseal\ta\tbulkhead,\tto\tnot only\tprotect\tthe\tconsumer\tfrom\tthe\tdownstream\tproblem,\tbut\talso\tto\tpotentially\tprotect the\tdownstream\tservice\tfrom\tmore\tcalls\tthat\tmay\tbe\thaving\tan\tadverse\timpact.\tGiven\tthe perils\tof\tcascading\tfailure,\tI’d\trecommend\tmandating\tcircuit\tbreakers\tfor\tall\tyour synchronous\tdownstream\tcalls.\tYou\tdon’t\thave\tto\twrite\tyour\town,\teither.\tNetflix’s\tHystrix",
      "content_length": 1940,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 360,
      "content": "library\tis\ta\tJVM\tcircuit\tbreaker\tabstraction\tthat\tcomes\twith\tsome\tpowerful\tmonitoring, but\tother\timplementations\texist\tfor\tdifferent\ttechnology\tstacks,\tsuch\tas\tPolly\tfor\t.NET,\tor the\tcircuit_breaker\tmixin\tfor\tRuby.\n\nIn\tmany\tways,\tbulkheads\tare\tthe\tmost\timportant\tof\tthese\tthree\tpatterns.\tTimeouts\tand circuit\tbreakers\thelp\tyou\tfree\tup\tresources\twhen\tthey\tare\tbecoming\tconstrained,\tbut bulkheads\tcan\tensure\tthey\tdon’t\tbecome\tconstrained\tin\tthe\tfirst\tplace.\tHystrix\tallows\tyou, for\texample,\tto\timplement\tbulkheads\tthat\tactually\treject\trequests\tin\tcertain\tconditions\tto ensure\tthat\tresources\tdon’t\tbecome\teven\tmore\tsaturated;\tthis\tis\tknown\tas\tload\tshedding. Sometimes\trejecting\ta\trequest\tis\tthe\tbest\tway\tto\tstop\tan\timportant\tsystem\tfrom\tbecoming overwhelmed\tand\tbeing\ta\tbottleneck\tfor\tmultiple\tupstream\tservices.",
      "content_length": 809,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 361,
      "content": "Isolation\n\nThe\tmore\tone\tservice\tdepends\ton\tanother\tbeing\tup,\tthe\tmore\tthe\thealth\tof\tone\timpacts\tthe ability\tof\tthe\tother\tto\tdo\tits\tjob.\tIf\twe\tcan\tuse\tintegration\ttechniques\tthat\tallow\ta downstream\tserver\tto\tbe\toffline,\tupstream\tservices\tare\tless\tlikely\tto\tbe\taffected\tby outages,\tplanned\tor\tunplanned.\n\nThere\tis\tanother\tbenefit\tto\tincreasing\tisolation\tbetween\tservices.\tWhen\tservices\tare isolated\tfrom\teach\tother,\tmuch\tless\tcoordination\tis\tneeded\tbetween\tservice\towners.\tThe less\tcoordination\tneeded\tbetween\tteams,\tthe\tmore\tautonomy\tthose\tteams\thave,\tas\tthey\tare able\tto\toperate\tand\tevolve\ttheir\tservices\tmore\tfreely.",
      "content_length": 617,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 362,
      "content": "Idempotency\n\nIn\tidempotent\toperations,\tthe\toutcome\tdoesn’t\tchange\tafter\tthe\tfirst\tapplication,\teven\tif the\toperation\tis\tsubsequently\tapplied\tmultiple\ttimes.\tIf\toperations\tare\tidempotent,\twe\tcan repeat\tthe\tcall\tmultiple\ttimes\twithout\tadverse\timpact.\tThis\tis\tvery\tuseful\twhen\twe\twant\tto replay\tmessages\tthat\twe\taren’t\tsure\thave\tbeen\tprocessed,\ta\tcommon\tway\tof\trecovering from\terror.\n\nLet’s\tconsider\ta\tsimple\tcall\tto\tadd\tsome\tpoints\tas\ta\tresult\tof\tone\tof\tour\tcustomers\tplacing an\torder.\tWe\tmight\tmake\ta\tcall\twith\tthe\tsort\tof\tpayload\tshown\tin\tExample\t11-1.\n\nExample\t11-1.\tCrediting\tpoints\tto\tan\taccount <credit> \t\t<amount>100</amount> \t\t<forAccount>1234</account> </credit>\n\nIf\tthis\tcall\tis\treceived\tmultiple\ttimes,\twe\twould\tadd\t100\tpoints\tmultiple\ttimes.\tAs\tit stands,\ttherefore,\tthis\tcall\tis\tnot\tidempotent.\tWith\ta\tbit\tmore\tinformation,\tthough,\twe allow\tthe\tpoints\tbank\tto\tmake\tthis\tcall\tidempotent,\tas\tshown\tin\tExample\t11-2.\n\nExample\t11-2.\tAdding\tmore\tinformation\tto\tthe\tpoints\tcredit\tto\tmake\tit\tidempotent <credit> \t\t<amount>100</amount> \t\t<forAccount>1234</account> \t\t<reason> \t\t\t\t<forPurchase>4567</forPurchase> \t\t</reason> </credit>\n\nNow\twe\tknow\tthat\tthis\tcredit\trelates\tto\ta\tspecific\torder,\t4567.\tAssuming\tthat\twe\tcould receive\tonly\tone\tcredit\tfor\ta\tgiven\torder,\twe\tcould\tapply\tthis\tcredit\tagain\twithout increasing\tthe\toverall\tnumber\tof\tpoints.\n\nThis\tmechanism\tworks\tjust\tas\twell\twith\tevent-based\tcollaboration,\tand\tcan\tbe\tespecially useful\tif\tyou\thave\tmultiple\tinstances\tof\tthe\tsame\ttype\tof\tservice\tsubscribing\tto\tevents. Even\tif\twe\tstore\twhich\tevents\thave\tbeen\tprocessed,\twith\tsome\tforms\tof\tasynchronous message\tdelivery\tthere\tmay\tbe\tsmall\twindows\twhere\ttwo\tworkers\tcan\tsee\tthe\tsame message.\tBy\tprocessing\tthe\tevents\tin\tan\tidempotent\tmanner,\twe\tensure\tthis\twon’t\tcause us\tany\tissues.\n\nSome\tpeople\tget\tquite\tcaught\tup\twith\tthis\tconcept,\tand\tassume\tit\tmeans\tthat\tsubsequent calls\twith\tthe\tsame\tparameters\tcan’t\thave\tany\timpact,\twhich\tthen\tleaves\tus\tin\tan interesting\tposition.\tWe\treally\twould\tstill\tlike\tto\trecord\tthe\tfact\tthat\ta\tcall\twas\treceived\tin our\tlogs,\tfor\texample.\tWe\twant\tto\trecord\tthe\tresponse\ttime\tof\tthe\tcall\tand\tcollect\tthis\tdata for\tmonitoring.\tThe\tkey\tpoint\there\tis\tthat\tit\tis\tthe\tunderlying\tbusiness\toperation\tthat\twe are\tconsidering\tidempotent,\tnot\tthe\tentire\tstate\tof\tthe\tsystem.\n\nSome\tof\tthe\tHTTP\tverbs,\tsuch\tas\tGET\tand\tPUT,\tare\tdefined\tin\tthe\tHTTP\tspecification\tto be\tidempotent,\tbut\tfor\tthat\tto\tbe\tthe\tcase,\tthey\trely\ton\tyour\tservice\thandling\tthese\tcalls\tin",
      "content_length": 2483,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 363,
      "content": "an\tidempotent\tmanner.\tIf\tyou\tstart\tmaking\tthese\tverbs\tnonidempotent,\tbut\tcallers\tthink they\tcan\tsafely\texecute\tthem\trepeatedly,\tyou\tmay\tget\tyourself\tinto\ta\tmess.\tRemember, just\tbecause\tyou’re\tusing\tHTTP\tas\tan\tunderlying\tprotocol\tdoesn’t\tmean\tyou\tget everything\tfor\tfree!",
      "content_length": 270,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 364,
      "content": "Scaling\n\nWe\tscale\tour\tsystems\tin\tgeneral\tfor\tone\tof\ttwo\treasons.\tFirst,\tto\thelp\tdeal\twith\tfailure:\tif we’re\tworried\tthat\tsomething\twill\tfail,\tthen\thaving\tmore\tof\tit\twill\thelp,\tright?\tSecond,\twe scale\tfor\tperformance,\teither\tin\tterms\tof\thandling\tmore\tload,\treducing\tlatency,\tor\tboth. Let’s\tlook\tat\tsome\tcommon\tscaling\ttechniques\twe\tcan\tuse\tand\tthink\tabout\thow\tthey\tapply to\tmicroservice\tarchitectures.",
      "content_length": 400,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 365,
      "content": "Go\tBigger\n\nSome\toperations\tcan\tjust\tbenefit\tfrom\tmore\tgrunt.\tGetting\ta\tbigger\tbox\twith\tfaster\tCPU and\tbetter\tI/O\tcan\toften\timprove\tlatency\tand\tthroughput,\tallowing\tyou\tto\tprocess\tmore work\tin\tless\ttime.\tHowever,\tthis\tform\tof\tscaling,\toften\tcalled\tvertical\tscaling,\tcan\tbe expensive\t—\tsometimes\tone\tbig\tserver\tcan\tcost\tmore\tthan\ttwo\tsmaller\tservers\twith\tthe same\tcombined\traw\tpower,\tespecially\twhen\tyou\tstart\tgetting\tto\treally\tbig\tmachines. Sometimes\tour\tsoftware\titself\tcannot\tdo\tmuch\twith\tthe\textra\tresources\tavailable\tto\tit. Larger\tmachines\toften\tjust\tgive\tus\tmore\tCPU\tcores,\tbut\tnot\tenough\tof\tour\tsoftware\tis written\tto\ttake\tadvantage\tof\tthem.\tThe\tother\tproblem\tis\tthat\tthis\tform\tof\tscaling\tmay\tnot do\tmuch\tto\timprove\tour\tserver’s\tresiliency\tif\twe\tonly\thave\tone\tof\tthem!\tNonetheless,\tthis can\tbe\ta\tgood\tquick\twin,\tespecially\tif\tyou’re\tusing\ta\tvirtualization\tprovider\tthat\tlets\tyou resize\tmachines\teasily.",
      "content_length": 907,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 366,
      "content": "Splitting\tWorkloads\n\nAs\toutlined\tin\tChapter\t6,\thaving\ta\tsingle\tmicroservice\tper\thost\tis\tcertainly\tpreferable\tto\ta multiservice-per-host\tmodel.\tInitially,\thowever,\tmany\tpeople\tdecide\tto\tcoexist\tmultiple microservices\ton\tone\tbox\tto\tkeep\tcosts\tdown\tor\tto\tsimplify\thost\tmanagement\t(although that\tis\tan\targuable\treason).\tAs\tthe\tmicroservices\tare\tindependent\tprocesses\tthat communicate\tover\tthe\tnetwork,\tit\tshould\tbe\tan\teasy\ttask\tto\tthen\tmove\tthem\tonto\ttheir own\thosts\tto\timprove\tthroughput\tand\tscaling.\tThis\tcan\talso\tincrease\tthe\tresiliency\tof\tthe system,\tas\ta\tsingle\thost\toutage\twill\timpact\ta\treduced\tnumber\tof\tmicroservices.\n\nOf\tcourse,\twe\tcould\talso\tuse\tthe\tneed\tfor\tincreased\tscale\tto\tsplit\tan\texisting\tmicroservice into\tparts\tto\tbetter\thandle\tthe\tload.\tAs\ta\tsimplistic\texample,\tlet’s\timagine\tthat\tour accounts\tservice\tprovides\tthe\tability\tto\tcreate\tand\tmanage\tindividual\tcustomers’\tfinancial accounts,\tbut\talso\texposes\tan\tAPI\tfor\trunning\tqueries\tto\tgenerate\treports.\tThis\tquery capability\tplaces\ta\tsignificant\tload\ton\tthe\tsystem.\tThe\tquery\tcapacity\tis\tconsidered noncritical,\tas\tit\tisn’t\tneeded\tto\tkeep\torders\tflowing\tin\tduring\tthe\tday.\tThe\tability\tto manage\tthe\tfinancial\trecords\tfor\tour\tcustomers\tis\tcritical,\tthough,\tand\twe\tcan’t\tafford\tfor it\tto\tbe\tdown.\tBy\tsplitting\tthese\ttwo\tcapabilities\tinto\tseparate\tservices,\twe\treduce\tthe\tload on\tthe\tcritical\taccounts\tservice,\tand\tintroduce\ta\tnew\taccounts\treporting\tservice\tthat\tis designed\tnot\tonly\twith\tquerying\tin\tmind\t(perhaps\tusing\tsome\tof\tthe\ttechniques\twe outlined\tin\tChapter\t4,\tbut\talso\tas\ta\tnoncritical\tsystem\tdoesn’t\tneed\tto\tbe\tdeployed\tin\tas resilient\ta\tway\tas\tthe\tcore\taccounts\tservice.",
      "content_length": 1643,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 367,
      "content": "Spreading\tYour\tRisk\n\nOne\tway\tto\tscale\tfor\tresilience\tis\tto\tensure\tthat\tyou\tdon’t\tput\tall\tyour\teggs\tin\tone\tbasket. A\tsimplistic\texample\tof\tthis\tis\tmaking\tsure\tthat\tyou\tdon’t\thave\tmultiple\tservices\ton\tone host,\twhere\tan\toutage\twould\timpact\tmultiple\tservices.\tBut\tlet’s\tconsider\twhat\thost\tmeans. In\tmost\tsituations\tnowadays,\ta\thost\tis\tactually\ta\tvirtual\tconcept.\tSo\twhat\tif\tI\thave\tall\tof my\tservices\ton\tdifferent\thosts,\tbut\tall\tthose\thosts\tare\tactually\tvirtual\thosts,\trunning\ton\tthe same\tphysical\tbox?\tIf\tthat\tbox\tgoes\tdown,\tI\tcould\tlose\tmultiple\tservices.\tSome virtualization\tplatforms\tenable\tyou\tto\tensure\tthat\tyour\thosts\tare\tdistributed\tacross multiple\tdifferent\tphysical\tboxes\tto\treduce\tthis\tchance.\n\nFor\tinternal\tvirtualization\tplatforms,\tit\tis\ta\tcommon\tpractice\tto\thave\tthe\tvirtual\tmachine’s root\tpartition\tmapped\tto\ta\tsingle\tSAN\t(storage\tarea\tnetwork).\tIf\tthat\tSAN\tgoes\tdown,\tit can\ttake\tdown\tall\tconnected\tVMs.\tSANs\tare\tbig,\texpensive,\tand\tdesigned\tnot\tto\tfail.\tThat said,\tI\thave\thad\tbig\texpensive\tSANs\tfail\ton\tme\tat\tleast\ttwice\tin\tthe\tlast\t10\tyears,\tand\teach time\tthe\tresults\twere\tfairly\tserious.\n\nAnother\tcommon\tform\tof\tseparation\tto\treduce\tfailure\tis\tto\tensure\tthat\tnot\tall\tyour\tservices are\trunning\tin\ta\tsingle\track\tin\tthe\tdata\tcenter,\tor\tthat\tyour\tservices\tare\tdistributed\tacross more\tthan\tone\tdata\tcenter.\tIf\tyou’re\tusing\tan\tunderlying\tservice\tprovider,\tit\tis\timportant\tto know\tif\ta\tservice-level\tagreement\t(SLA)\tis\toffered\tand\tplan\taccordingly.\tIf\tyou\tneed\tto ensure\tyour\tservices\tare\tdown\tfor\tno\tmore\tthan\tfour\thours\tevery\tquarter,\tbut\tyour\thosting provider\tcan\tonly\tguarantee\ta\tdowntime\tof\teight\thours\tper\tquarter,\tyou\thave\tto\teither change\tthe\tSLA,\tor\tcome\tup\twith\tan\talternative\tsolution.\n\nAWS,\tfor\texample,\tis\tsplit\tinto\tregions,\twhich\tyou\tcan\tthink\tof\tas\tdistinct\tclouds.\tEach region\tis\tin\tturn\tsplit\tinto\ttwo\tor\tmore\tavailability\tzones\t(AZs).\tAZs\tare\tAWS’s\tequivalent of\ta\tdata\tcenter.\tIt\tis\tessential\tto\thave\tservices\tdistributed\tacross\tmultiple\tavailability zones,\tas\tAWS\tdoes\tnot\toffer\tany\tguarantees\tabout\tthe\tavailability\tof\ta\tsingle\tnode,\tor even\tan\tentire\tavailability\tzone.\tFor\tits\tcompute\tservice,\tit\toffers\tonly\ta\t99.95%\tuptime over\ta\tgiven\tmonthly\tperiod\tof\tthe\tregion\tas\ta\twhole,\tso\tyou’ll\twant\tto\tdistribute\tyour workloads\tacross\tmultiple\tavailability\tzones\tinside\ta\tsingle\tregion.\tFor\tsome\tpeople,\tthis isn’t\tgood\tenough,\tand\tinstead\tthey\trun\ttheir\tservices\tacross\tmultiple\tregions\ttoo.\n\nIt\tshould\tbe\tnoted,\tof\tcourse,\tthat\tbecause\tproviders\tgive\tyou\tan\tSLA\tguarantee,\tthey\twill tend\tto\tlimit\ttheir\tliability!\tIf\tthem\tmissing\ttheir\ttargets\tcosts\tyou\tcustomers\tand\ta\tlarge amount\tof\tmoney,\tyou\tmight\tfind\tyourself\tsearching\tthrough\tcontracts\tto\tsee\tif\tyou\tcan claw\tanything\tback\tfrom\tthem.\tTherefore,\tI\twould\tstrongly\tsuggest\tyou\tunderstand\tthe impact\tof\ta\tsupplier\tfailing\tin\tits\tobligations\tto\tyou,\tand\twork\tout\tif\tyou\tneed\tto\thave\ta plan\tB\t(or\tC)\tin\tyour\tpocket.\tMore\tthan\tone\tclient\tI’ve\tworked\twith\thas\thad\ta\tdisaster recovery\thosting\tplatform\twith\ta\tdifferent\tsupplier,\tfor\texample,\tto\tensure\tthey\tweren’t too\tvulnerable\tto\tthe\tmistakes\tof\tone\tcompany.",
      "content_length": 3090,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 368,
      "content": "Load\tBalancing\n\nWhen\tyou\tneed\tyour\tservice\tto\tbe\tresilient,\tyou\twant\tto\tavoid\tsingle\tpoints\tof\tfailure.\tFor a\ttypical\tmicroservice\tthat\texposes\ta\tsynchronous\tHTTP\tendpoint,\tthe\teasiest\tway\tto achieve\tthis\tis\tto\thave\tmultiple\thosts\trunning\tyour\tmicroservice\tinstance,\tsitting\tbehind\ta load\tbalancer,\tas\tshown\tin\tFigure\t11-4.\tTo\tconsumers\tof\tthe\tmicroservice,\tyou\tdon’t\tknow if\tyou\tare\ttalking\tto\tone\tmicroservice\tinstance\tor\ta\thundred.\n\nFigure\t11-4.\tAn\texample\tof\ta\tload\tbalancing\tapproach\tto\tscale\tthe\tnumber\tof\tcustomer\tservice\tinstances\n\nLoad\tbalancers\tcome\tin\tall\tshapes\tand\tsizes,\tfrom\tbig\tand\texpensive\thardware\tappliances to\tsoftware-based\tload\tbalancers\tlike\tmod_proxy.\tThey\tall\tshare\tsome\tkey\tcapabilities. They\tdistribute\tcalls\tsent\tto\tthem\tto\tone\tor\tmore\tinstances\tbased\ton\tsome\talgorithm, remove\tinstances\twhen\tthey\tare\tno\tlonger\thealthy,\tand\thopefully\tadd\tthem\tback\tin\twhen they\tare.\n\nSome\tload\tbalancers\tprovide\tuseful\tfeatures.\tA\tcommon\tone\tis\tSSL\ttermination,\twhere inbound\tHTTPS\tconnections\tto\tthe\tload\tbalancer\tare\ttransformed\tto\tHTTP\tconnections once\tthey\thit\tthe\tinstance\titself.\tHistorically,\tthe\toverhead\tof\tmanaging\tSSL\twas significant\tenough\tthat\thaving\ta\tload\tbalancer\thandle\tthis\tprocess\tfor\tyou\twas\tfairly useful.\tNowadays,\tthis\tis\tas\tmuch\tabout\tsimplifying\tthe\tset-up\tof\tthe\tindividual\thosts running\tthe\tinstance.\tThe\tpoint\tof\tusing\tHTTPS,\tthough,\tis\tto\tensure\tthat\tthe\trequests aren’t\tvulnerable\tto\ta\tman-in-the-middle\tattack,\tas\twe\tdiscussed\tin\tChapter\t9,\tso\tif\twe\tuse SSL\ttermination,\twe\tare\tpotentially\texposing\tourselves\tsomewhat.\tOne\tmitigation\tis\tto have\tall\tthe\tinstances\tof\tthe\tmicroservice\tinside\ta\tsingle\tVLAN,\tas\twe\tsee\tin\tFigure\t11-5. A\tVLAN\tis\ta\tvirtual\tlocal\tarea\tnetwork,\tthat\tis\tisolated\tin\tsuch\ta\tway\tthat\trequests\tfrom outside\tit\tcan\tcome\tonly\tvia\ta\trouter,\tand\tin\tthis\tcase\tour\trouter\tis\talso\tour\tSSL- terminating\tload\tbalancer.\tThe\tonly\tcommunication\tto\tthe\tmicroservice\tfrom\toutside\tthe VLAN\tcomes\tover\tHTTPS,\tbut\tinternally\teverything\tis\tHTTP.",
      "content_length": 1993,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 369,
      "content": "Figure\t11-5.\tUsing\tHTTPS\ttermination\tat\tthe\tload\tbalancer\twith\ta\tVLAN\tfor\timproved\tsecurity\n\nAWS\tprovides\tHTTPS-terminating\tload\tbalancers\tin\tthe\tform\tof\tELBs\t(elastic\tload balancers)\tand\tyou\tcan\tuse\tits\tsecurity\tgroups\tor\tvirtual\tprivate\tclouds\t(VPCs)\tto implement\tthe\tVLAN.\tOtherwise,\tsoftware\tlike\tmod_proxy\tcan\tplay\ta\tsimilar\trole\tas\ta software\tload\tbalancer.\tMany\torganizations\thave\thardware\tload\tbalancers,\twhich\tcan\tbe difficult\tto\tautomate.\tIn\tsuch\tcircumstances\tI\thave\tfound\tmyself\tadvocating\tfor\tsoftware load\tbalancers\tsitting\tbehind\tthe\thardware\tload\tbalancers\tto\tallow\tteams\tthe\tfreedom\tto reconfigure\tthese\tas\trequired.\tYou\tdo\twant\tto\twatch\tfor\tthe\tfact\tthat\tall\ttoo\toften\tthe hardware\tload\tbalancers\tthemselves\tare\tsingle\tpoints\tof\tfailure!\tWhatever\tapproach\tyou take,\twhen\tconsidering\tthe\tconfiguration\tof\ta\tload\tbalancer,\ttreat\tit\tas\tyou\ttreat\tthe configuration\tof\tyour\tservice:\tmake\tsure\tit\tis\tstored\tin\tversion\tcontrol\tand\tcan\tbe\tapplied automatically.\n\nLoad\tbalancers\tallow\tus\tto\tadd\tmore\tinstances\tof\tour\tmicroservice\tin\ta\tway\tthat\tis transparent\tto\tany\tservice\tconsumers.\tThis\tgives\tus\tan\tincreased\tability\tto\thandle\tload, and\talso\treduce\tthe\timpact\tof\ta\tsingle\thost\tfailing.\tHowever,\tmany,\tif\tnot\tmost,\tof\tyour microservices\twill\thave\tsome\tsort\tof\tpersistent\tdata\tstore,\tprobably\ta\tdatabase\tsitting\ton\ta different\tmachine.\tIf\twe\thave\tmultiple\tmicroservice\tinstances\ton\tdifferent\tmachines,\tbut only\ta\tsingle\thost\trunning\tthe\tdatabase\tinstance,\tour\tdatabase\tis\tstill\ta\tsingle\tsource\tof failure.\tWe’ll\ttalk\tabout\tpatterns\tto\thandle\tthis\tshortly.",
      "content_length": 1565,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 370,
      "content": "Worker-Based\tSystems\n\nLoad\tbalancing\tisn’t\tthe\tonly\tway\tto\thave\tmultiple\tinstances\tof\tyour\tservice\tshare\tload and\treduce\tfragility.\tDepending\ton\tthe\tnature\tof\tthe\toperations,\ta\tworker-based\tsystem could\tbe\tjust\tas\teffective.\tHere,\ta\tcollection\tof\tinstances\tall\twork\ton\tsome\tshared\tbacklog of\twork.\tThis\tcould\tbe\ta\tnumber\tof\tHadoop\tprocesses,\tor\tperhaps\ta\tnumber\tof\tlisteners\tto a\tshared\tqueue\tof\twork.\tThese\ttypes\tof\toperations\tare\twell\tsuited\tto\tbatch\twork\tor asynchronous\tjobs.\tThink\tof\ttasks\tlike\timage\tthumbnail\tprocessing,\tsending\temail,\tor generating\treports.\n\nThe\tmodel\talso\tworks\twell\tfor\tpeaky\tload,\twhere\tyou\tcan\tspin\tup\tadditional\tinstances\ton demand\tto\tmatch\tthe\tload\tcoming\tin.\tAs\tlong\tas\tthe\twork\tqueue\titself\tis\tresilient,\tthis model\tcan\tbe\tused\tto\tscale\tboth\tfor\timproved\tthroughput\tof\twork,\tbut\talso\tfor\timproved resiliency\t—\tthe\timpact\tof\ta\tworker\tfailing\t(or\tnot\tbeing\tthere)\tis\teasy\tto\tdeal\twith.\tWork will\ttake\tlonger,\tbut\tnothing\tgets\tlost.\n\nI’ve\tseen\tthis\twork\twell\tin\torganizations\twhere\tthere\tis\tlots\tof\tunused\tcompute\tcapacity\tat certain\ttimes\tof\tday.\tFor\texample,\tovernight\tyou\tmight\tnot\tneed\tas\tmany\tmachines\tto\trun your\tecommerce\tsystem,\tso\tyou\tcan\ttemporarily\tuse\tthem\tto\trun\tworkers\tfor\ta\treporting job\tinstead.\n\nWith\tworker-based\tsystems,\talthough\tthe\tworkers\tthemselves\tdon’t\tneed\tto\tbe\tthat reliable,\tthe\tsystem\tthat\tcontains\tthe\twork\tto\tbe\tdone\tdoes.\tYou\tcould\thandle\tthis\tby running\ta\tpersistent\tmessage\tbroker,\tfor\texample,\tor\tperhaps\ta\tsystem\tlike\tZookeeper.\tThe benefit\there\tis\tthat\tif\twe\tuse\texisting\tsoftware\tfor\tthis\tpurpose,\tsomeone\thas\tdone\tmuch\tof the\thard\twork\tfor\tus.\tHowever,\twe\tstill\tneed\tto\tknow\thow\tto\tset\tup\tand\tmaintain\tthese systems\tin\ta\tresilient\tfashion.",
      "content_length": 1710,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 371,
      "content": "Starting\tAgain\n\nThe\tarchitecture\tthat\tgets\tyou\tstarted\tmay\tnot\tbe\tthe\tarchitecture\tthat\tkeeps\tyou\tgoing when\tyour\tsystem\thas\tto\thandle\tvery\tdifferent\tvolumes\tof\tload.\tAs\tJeff\tDean\tsaid\tin\this presentation\t“Challenges\tin\tBuilding\tLarge-Scale\tInformation\tRetrieval\tSystems” (WSDM\t2009\tconference),\tyou\tshould\t“design\tfor\t~10×\tgrowth,\tbut\tplan\tto\trewrite before\t~100×.”\tAt\tcertain\tpoints,\tyou\tneed\tto\tdo\tsomething\tpretty\tradical\tto\tsupport\tthe next\tlevel\tof\tgrowth.\n\nRecall\tthe\tstory\tof\tGilt,\twhich\twe\ttouched\ton\tin\tChapter\t6.\tA\tsimple\tmonolithic\tRails application\tdid\twell\tfor\tGilt\tfor\ttwo\tyears.\tIts\tbusiness\tbecame\tincreasingly\tsuccessful, which\tmeant\tmore\tcustomers\tand\tmore\tload.\tAt\ta\tcertain\ttipping\tpoint,\tthe\tcompany\thad to\tredesign\tthe\tapplication\tto\thandle\tthe\tload\tit\twas\tseeing.\n\nA\tredesign\tmay\tmean\tsplitting\tapart\tan\texisting\tmonolith,\tas\tit\tdid\tfor\tGilt.\tOr\tit\tmight mean\tpicking\tnew\tdata\tstores\tthat\tcan\thandle\tthe\tload\tbetter,\twhich\twe’ll\tlook\tat\tin\ta moment.\tIt\tcould\talso\tmean\tadopting\tnew\ttechniques,\tsuch\tas\tmoving\tfrom\tsynchronous request/response\tto\tevent-based\tsystems,\tadopting\tnew\tdeployment\tplatforms,\tchanging whole\ttechnology\tstacks,\tor\teverything\tin\tbetween.\n\nThere\tis\ta\tdanger\tthat\tpeople\twill\tsee\tthe\tneed\tto\trearchitect\twhen\tcertain\tscaling thresholds\tare\treached\tas\ta\treason\tto\tbuild\tfor\tmassive\tscale\tfrom\tthe\tbeginning.\tThis\tcan be\tdisastrous.\tAt\tthe\tstart\tof\ta\tnew\tproject,\twe\toften\tdon’t\tknow\texactly\twhat\twe\twant\tto build,\tnor\tdo\twe\tknow\tif\tit\twill\tbe\tsuccessful.\tWe\tneed\tto\tbe\table\tto\trapidly\texperiment, and\tunderstand\twhat\tcapabilities\twe\tneed\tto\tbuild.\tIf\twe\ttried\tbuilding\tfor\tmassive\tscale up\tfront,\twe’d\tend\tup\tfront-loading\ta\thuge\tamount\tof\twork\tto\tprepare\tfor\tload\tthat\tmay never\tcome,\twhile\tdiverting\teffort\taway\tfrom\tmore\timportant\tactivities,\tlike understanding\tif\tanyone\twill\twant\tto\tactually\tuse\tour\tproduct.\tEric\tRies\ttells\tthe\tstory\tof spending\tsix\tmonths\tbuilding\ta\tproduct\tthat\tno\tone\tever\tdownloaded.\tHe\treflected\tthat\the could\thave\tput\tup\ta\tlink\ton\ta\tweb\tpage\tthat\t404’d\twhen\tpeople\tclicked\ton\tit\tto\tsee\tif\tthere was\tany\tdemand,\tspent\tsix\tmonths\ton\tthe\tbeach\tinstead,\tand\tlearned\tjust\tas\tmuch!\n\nThe\tneed\tto\tchange\tour\tsystems\tto\tdeal\twith\tscale\tisn’t\ta\tsign\tof\tfailure.\tIt\tis\ta\tsign\tof success.",
      "content_length": 2250,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 372,
      "content": "Scaling\tDatabases\n\nScaling\tstateless\tmicroservices\tis\tfairly\tstraightforward.\tBut\twhat\tif\twe\tare\tstoring\tdata\tin a\tdatabase?\tWe’ll\tneed\tto\tknow\thow\tto\tscale\tthat\ttoo.\tDifferent\ttypes\tof\tdatabases\tprovide different\tforms\tof\tscaling,\tand\tunderstanding\twhat\tform\tsuits\tyour\tuse\tcase\tbest\twill ensure\tyou\tselect\tthe\tright\tdatabase\ttechnology\tfrom\tthe\tbeginning.",
      "content_length": 357,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 373,
      "content": "Availability\tof\tService\tVersus\tDurability\tof\tData\n\nStraight\toff,\tit\tis\timportant\tto\tseparate\tthe\tconcept\tof\tavailability\tof\tthe\tservice\tfrom\tthe durability\tof\tthe\tdata\titself.\tYou\tneed\tto\tunderstand\tthat\tthese\tare\ttwo\tdifferent\tthings,\tand as\tsuch\tthey\twill\thave\tdifferent\tsolutions.\n\nFor\texample,\tI\tcould\tstore\ta\tcopy\tof\tall\tdata\twritten\tto\tmy\tdatabase\tin\ta\tresilient filesystem.\tIf\tthe\tdatabase\tgoes\tdown,\tmy\tdata\tisn’t\tlost,\tas\tI\thave\ta\tcopy,\tbut\tthe\tdatabase itself\tisn’t\tavailable,\twhich\tmay\tmake\tmy\tmicroservice\tunavailable\ttoo.\tA\tmore\tcommon model\twould\tbe\tusing\ta\tstandby.\tAll\tdata\twritten\tto\tthe\tprimary\tdatabase\tgets\tcopied\tto the\tstandby\treplica\tdatabase.\tIf\tthe\tprimary\tgoes\tdown,\tmy\tdata\tis\tsafe,\tbut\twithout\ta mechanism\tto\teither\tbring\tit\tback\tup\tor\tpromote\tthe\treplica\tto\tthe\tprimary,\twe\tdon’t\thave an\tavailable\tdatabase,\teven\tthough\tour\tdata\tis\tsafe.",
      "content_length": 866,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 374,
      "content": "Scaling\tfor\tReads\n\nMany\tservices\tare\tread-mostly.\tThink\tof\ta\tcatalog\tservice\tthat\tstores\tinformation\tfor\tthe items\twe\thave\tfor\tsale.\tWe\tadd\trecords\tfor\tnew\titems\ton\ta\tfairly\tirregular\tbasis,\tand\tit wouldn’t\tat\tall\tbe\tsurprising\tif\twe\tget\tmore\tthan\t100\treads\tof\tour\tcatalog’s\tdata\tfor\tevery write.\tHappily,\tscaling\tfor\treads\tis\tmuch\teasier\tthan\tscaling\tfor\twrites.\tCaching\tof\tdata can\tplay\ta\tlarge\tpart\there,\tand\twe’ll\tdiscuss\tthat\tin\tmore\tdepth\tshortly.\tAnother\tmodel\tis to\tmake\tuse\tof\tread\treplicas.\n\nIn\ta\trelational\tdatabase\tmanagement\tsystem\t(RDBMS)\tlike\tMySQL\tor\tPostgres,\tdata\tcan be\tcopied\tfrom\ta\tprimary\tnode\tto\tone\tor\tmore\treplicas.\tThis\tis\toften\tdone\tto\tensure\tthat\ta copy\tof\tour\tdata\tis\tkept\tsafe,\tbut\twe\tcan\talso\tuse\tit\tto\tdistribute\tour\treads.\tA\tservice\tcould direct\tall\twrites\tto\tthe\tsingle\tprimary\tnode,\tbut\tdistribute\treads\tto\tone\tor\tmore\tread replicas,\tas\twe\tsee\tin\tFigure\t11-6.\tThe\treplication\tfrom\tthe\tprimary\tdatabase\tto\tthe replicas\thappens\tat\tsome\tpoint\tafter\tthe\twrite.\tThis\tmeans\tthat\twith\tthis\ttechnique\treads may\tsometimes\tsee\tstale\tdata\tuntil\tthe\treplication\thas\tcompleted.\tEventually\tthe\treads will\tsee\tthe\tconsistent\tdata.\tSuch\ta\tsetup\tis\tcalled\teventually\tconsistent,\tand\tif\tyou\tcan handle\tthe\ttemporary\tinconsistency\tit\tis\ta\tfairly\teasy\tand\tcommon\tway\tto\thelp\tscale systems.\tWe’ll\tlook\tinto\tthis\tin\tmore\tdepth\tshortly\twhen\twe\tlook\tat\tthe\tCAP\ttheorem.\n\nFigure\t11-6.\tUsing\tread\treplicas\tto\tscale\treads\n\nYears\tago,\tusing\tread\treplicas\tto\tscale\twas\tall\tthe\trage,\talthough\tnowadays\tI\twould suggest\tyou\tlook\tto\tcaching\tfirst,\tas\tit\tcan\tdeliver\tmuch\tmore\tsignificant\timprovements\tin performance,\toften\twith\tless\twork.",
      "content_length": 1640,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 375,
      "content": "Scaling\tfor\tWrites\n\nReads\tare\tcomparatively\teasy\tto\tscale.\tWhat\tabout\twrites?\tOne\tapproach\tis\tto\tuse sharding.\tWith\tsharding,\tyou\thave\tmultiple\tdatabase\tnodes.\tYou\ttake\ta\tpiece\tof\tdata\tto\tbe written,\tapply\tsome\thashing\tfunction\tto\tthe\tkey\tof\tthe\tdata,\tand\tbased\ton\tthe\tresult\tof\tthe function\tlearn\twhere\tto\tsend\tthe\tdata.\tTo\tpick\ta\tvery\tsimplistic\t(and\tactually\tbad) example,\timagine\tthat\tcustomer\trecords\tA–M\tgo\tto\tone\tdatabase\tinstance,\tand\tN–Z another.\tYou\tcan\tmanage\tthis\tyourself\tin\tyour\tapplication,\tbut\tsome\tdatabases,\tlike Mongo,\thandle\tmuch\tof\tit\tfor\tyou.\n\nThe\tcomplexity\twith\tsharding\tfor\twrites\tcomes\tfrom\thandling\tqueries.\tLooking\tup\tan individual\trecord\tis\teasy,\tas\tI\tcan\tjust\tapply\tthe\thashing\tfunction\tto\tfind\twhich\tinstance the\tdata\tshould\tbe\ton,\tand\tthen\tretrieve\tit\tfrom\tthe\tcorrect\tshard.\tBut\twhat\tabout\tqueries that\tspan\tthe\tdata\tin\tmultiple\tnodes\t—\tfor\texample,\tfinding\tall\tthe\tcustomers\twho\tare\tover 18?\tIf\tyou\twant\tto\tquery\tall\tshards,\tyou\teither\tneed\tto\tquery\teach\tindividual\tshard\tand join\tin\tmemory,\tor\thave\tan\talternative\tread\tstore\twhere\tboth\tdata\tsets\tare\tavailable.\tOften querying\tacross\tshards\tis\thandled\tby\tan\tasynchronous\tmechanism,\tusing\tcached\tresults. Mongo\tuses\tmap/reduce\tjobs,\tfor\texample,\tto\tperform\tthese\tqueries.\n\nOne\tof\tthe\tquestions\tthat\temerges\twith\tsharded\tsystems\tis,\twhat\thappens\tif\tI\twant\tto\tadd an\textra\tdatabase\tnode?\tIn\tthe\tpast,\tthis\twould\toften\trequire\tsignificant\tdowntime\t— especially\tfor\tlarge\tclusters\t—\tas\tyou\tmight\thave\tto\ttake\tthe\tentire\tdatabase\tdown\tand rebalance\tthe\tdata.\tMore\trecently,\tmore\tsystems\tsupport\tadding\textra\tshards\tto\ta\tlive system,\twhere\tthe\trebalancing\tof\tdata\thappens\tin\tthe\tbackground;\tCassandra,\tfor\texample, handles\tthis\tvery\twell.\tAdding\tshards\tto\tan\texisting\tcluster\tisn’t\tfor\tthe\tfaint\tof\theart, though,\tso\tmake\tsure\tyou\ttest\tthis\tthoroughly.\n\nSharding\tfor\twrites\tmay\tscale\tfor\twrite\tvolume,\tbut\tmay\tnot\timprove\tresiliency.\tIf customer\trecords\tA–M\talways\tgo\tto\tInstance\tX,\tand\tInstance\tX\tis\tunavailable,\taccess\tto records\tA–M\tcan\tbe\tlost.\tCassandra\toffers\tadditional\tcapabilities\there,\twhere\twe\tcan ensure\tthat\tdata\tis\treplicated\tto\tmultiple\tnodes\tin\ta\tring\t(Cassandra’s\tterm\tfor\ta\tcollection of\tCassandra\tnodes).\n\nAs\tyou\tmay\thave\tinferred\tfrom\tthis\tbrief\toverview,\tscaling\tdatabases\tfor\twrites\tare\twhere things\tget\tvery\ttricky,\tand\twhere\tthe\tcapabilities\tof\tthe\tvarious\tdatabases\treally\tstart\tto become\tdifferentiated.\tI\toften\tsee\tpeople\tchanging\tdatabase\ttechnology\twhen\tthey\tstart hitting\tlimits\ton\thow\teasily\tthey\tcan\tscale\ttheir\texisting\twrite\tvolume.\tIf\tthis\thappens\tto you,\tbuying\ta\tbigger\tbox\tis\toften\tthe\tquickest\tway\tto\tsolve\tthe\tproblem,\tbut\tin\tthe background\tyou\tmight\twant\tto\tlook\tat\tsystems\tlike\tCassandra,\tMongo,\tor\tRiak\tto\tsee\tif their\talternative\tscaling\tmodels\tmight\toffer\tyou\ta\tbetter\tlong-term\tsolution.",
      "content_length": 2810,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 376,
      "content": "Shared\tDatabase\tInfrastructure\n\nSome\ttypes\tof\tdatabases,\tsuch\tas\tthe\ttraditional\tRDBMS,\tseparate\tthe\tconcept\tof\tthe database\titself\tand\tthe\tschema.\tThis\tmeans\tone\trunning\tdatabase\tcould\thost\tmultiple, independent\tschemas,\tone\tfor\teach\tmicroservice.\tThis\tcan\tbe\tvery\tuseful\tin\tterms\tof reducing\tthe\tnumber\tof\tmachines\twe\tneed\tto\trun\tour\tsystem,\tbut\twe\tare\tintroducing\ta significant\tsingle\tpoint\tof\tfailure.\tIf\tthis\tdatabase\tinfrastructure\tgoes\tdown,\tit\tcan\timpact multiple\tmicroservices\tat\tonce,\tpotentially\tresulting\tin\ta\tcatastrophic\toutage.\tIf\tyou\tare running\tthis\tsort\tof\tsetup,\tmake\tsure\tyou\tconsider\tthe\trisks.\tAnd\tbe\tvery\tsure\tthat\tthe database\titself\tis\tas\tresilient\tas\tit\tcan\tbe.",
      "content_length": 687,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 377,
      "content": "CQRS\n\nThe\tCommand-Query\tResponsibility\tSegregation\t(CQRS)\tpattern\trefers\tto\tan\talternate model\tfor\tstoring\tand\tquerying\tinformation.\tWith\tnormal\tdatabases,\twe\tuse\tone\tsystem for\tperforming\tmodifications\tto\tdata\tand\tquerying\tthe\tdata.\tWith\tCQRS,\tpart\tof\tthe system\tdeals\twith\tcommands,\twhich\tcapture\trequests\tto\tmodify\tstate,\twhile\tanother\tpart of\tthe\tsystem\tdeals\twith\tqueries.\n\nCommands\tcome\tin\trequesting\tchanges\tin\tstate.\tThese\tcommands\tare\tvalidated,\tand\tif they\twork,\tthey\twill\tbe\tapplied\tto\tthe\tmodel.\tCommands\tshould\tcontain\tinformation\tabout their\tintent.\tThey\tcan\tbe\tprocessed\tsynchronously\tor\tasynchronously,\tallowing\tfor different\tmodels\tto\thandle\tscaling;\twe\tcould,\tfor\texample,\tjust\tqueue\tup\tinbound\trequests and\tprocess\tthem\tlater.\n\nThe\tkey\ttakeaway\there\tis\tthat\tthe\tinternal\tmodels\tused\tto\thandle\tcommands\tand\tqueries are\tthemselves\tcompletely\tseparate.\tFor\texample,\tI\tmight\tchoose\tto\thandle\tand\tprocess commands\tas\tevents,\tperhaps\tjust\tstoring\tthe\tlist\tof\tcommands\tin\ta\tdata\tstore\t(a\tprocess known\tas\tevent\tsourcing).\tMy\tquery\tmodel\tcould\tquery\tan\tevent\tstore\tand\tcreate projections\tfrom\tstored\tevents\tto\tassemble\tthe\tstate\tof\tdomain\tobjects,\tor\tcould\tjust\tpick up\ta\tfeed\tfrom\tthe\tcommand\tpart\tof\tthe\tsystem\tto\tupdate\ta\tdifferent\ttype\tof\tstore.\tIn\tmany ways,\twe\tget\tthe\tsame\tbenefits\tof\tread\treplicas\tthat\twe\tdiscussed\tearlier,\twithout\tthe requirement\tthat\tthe\tbacking\tstore\tfor\tthe\treplicas\tbe\tthe\tsame\tas\tthe\tdata\tstore\tused\tto handle\tdata\tmodifications.\n\nThis\tform\tof\tseparation\tallows\tfor\tdifferent\ttypes\tof\tscaling.\tThe\tcommand\tand\tquery parts\tof\tour\tsystem\tcould\tlive\tin\tdifferent\tservices,\tor\ton\tdifferent\thardware,\tand\tcould make\tuse\tof\tradically\tdifferent\ttypes\tof\tdata\tstore.\tThis\tcan\tunlock\ta\tlarge\tnumber\tof\tways to\thandle\tscale.\tYou\tcould\teven\tsupport\tdifferent\ttypes\tof\tread\tformat\tby\thaving\tmultiple implementations\tof\tthe\tquery\tpiece,\tperhaps\tsupporting\ta\tgraph-based\trepresentation\tof your\tdata,\tor\ta\tkey/value-based\tform\tof\tyour\tdata.\n\nBe\twarned,\thowever:\tthis\tsort\tof\tpattern\tis\tquite\ta\tshift\taway\tfrom\ta\tmodel\twhere\ta\tsingle data\tstore\thandles\tall\tour\tCRUD\toperations.\tI’ve\tseen\tmore\tthan\tone\texperienced development\tteam\tstruggle\tto\tget\tthis\tpattern\tright!",
      "content_length": 2193,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 378,
      "content": "Caching\n\nCaching\tis\ta\tcommonly\tused\tperformance\toptimization\twhereby\tthe\tprevious\tresult\tof some\toperation\tis\tstored,\tso\tthat\tsubsequent\trequests\tcan\tuse\tthis\tstored\tvalue\trather\tthan spending\ttime\tand\tresources\trecalculating\tthe\tvalue.\tMore\toften\tthan\tnot,\tcaching\tis\tabout eliminating\tneedless\tround-trips\tto\tdatabases\tor\tother\tservices\tto\tserve\tresults\tfaster.\tUsed well,\tit\tcan\tyield\thuge\tperformance\tbenefits.\tThe\treason\tthat\tHTTP\tscales\tso\twell\tin handling\tlarge\tnumbers\tof\trequests\tis\tthat\tthe\tconcept\tof\tcaching\tis\tbuilt\tin.\n\nEven\twith\ta\tsimple\tmonolithic\tweb\tapplication,\tthere\tare\tquite\ta\tfew\tchoices\tas\tto\twhere and\thow\tto\tcache.\tWith\ta\tmicroservice\tarchitecture,\twhere\teach\tservice\tis\tits\town\tsource of\tdata\tand\tbehavior,\twe\thave\tmany\tmore\tchoices\tto\tmake\tabout\twhere\tand\thow\tto\tcache. With\ta\tdistributed\tsystem,\twe\ttypically\tthink\tof\tcaching\teither\ton\tthe\tclient\tside\tor\ton\tthe server\tside.\tBut\twhich\tis\tbest?",
      "content_length": 922,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 379,
      "content": "Client-Side,\tProxy,\tand\tServer-Side\tCaching\n\nIn\tclient-side\tcaching,\tthe\tclient\tstores\tthe\tcached\tresult.\tThe\tclient\tgets\tto\tdecide\twhen (and\tif)\tit\tgoes\tand\tretrieves\ta\tfresh\tcopy.\tIdeally,\tthe\tdownstream\tservice\twill\tprovide hints\tto\thelp\tthe\tclient\tunderstand\twhat\tto\tdo\twith\tthe\tresponse,\tso\tit\tknows\twhen\tand\tif\tto make\ta\tnew\trequest.\tWith\tproxy\tcaching,\ta\tproxy\tis\tplaced\tbetween\tthe\tclient\tand\tthe server.\tA\tgreat\texample\tof\tthis\tis\tusing\ta\treverse\tproxy\tor\tcontent\tdelivery\tnetwork (CDN).\tWith\tserver-side\tcaching,\tthe\tserver\thandles\tcaching\tresponsibility,\tperhaps making\tuse\tof\ta\tsystem\tlike\tRedis\tor\tMemcache,\tor\teven\ta\tsimple\tin-memory\tcache.\n\nWhich\tone\tmakes\tthe\tmost\tsense\tdepends\ton\twhat\tyou\tare\ttrying\tto\toptimize.\tClient-side caching\tcan\thelp\treduce\tnetwork\tcalls\tdrastically,\tand\tcan\tbe\tone\tof\tthe\tfastest\tways\tof reducing\tload\ton\ta\tdownstream\tservice.\tIn\tthis\tcase,\tthe\tclient\tis\tin\tcharge\tof\tthe\tcaching behavior,\tand\tif\tyou\twant\tto\tmake\tchanges\tto\thow\tcaching\tis\tdone,\trolling\tout\tchanges\tto a\tnumber\tof\tconsumers\tcould\tbe\tdifficult.\tInvalidation\tof\tstale\tdata\tcan\talso\tbe\ttrickier, although\twe’ll\tdiscuss\tsome\tcoping\tmechanisms\tfor\tthis\tin\ta\tmoment.\n\nWith\tproxy\tcaching,\teverything\tis\topaque\tto\tboth\tthe\tclient\tand\tserver.\tThis\tis\toften\ta\tvery simple\tway\tto\tadd\tcaching\tto\tan\texisting\tsystem.\tIf\tthe\tproxy\tis\tdesigned\tto\tcache\tgeneric traffic,\tit\tcan\talso\tcache\tmore\tthan\tone\tservice;\ta\tcommon\texample\tis\ta\treverse\tproxy\tlike Squid\tor\tVarnish,\twhich\tcan\tcache\tany\tHTTP\ttraffic.\tHaving\ta\tproxy\tbetween\tthe\tclient and\tserver\tdoes\tintroduce\tadditional\tnetwork\thops,\talthough\tin\tmy\texperience\tit\tis\tvery rare\tthat\tthis\tcauses\tproblems,\tas\tthe\tperformance\toptimizations\tresulting\tfrom\tthe caching\titself\toutweigh\tany\tadditional\tnetwork\tcosts.\n\nWith\tserver-side\tcaching,\teverything\tis\topaque\tto\tthe\tclients;\tthey\tdon’t\tneed\tto\tworry about\tanything.\tWith\ta\tcache\tnear\tor\tinside\ta\tservice\tboundary,\tit\tcan\tbe\teasier\tto\treason about\tthings\tlike\tinvalidation\tof\tdata,\tor\ttrack\tand\toptimize\tcache\thits.\tIn\ta\tsituation\twhere you\thave\tmultiple\ttypes\tof\tclients,\ta\tserver-side\tcache\tcould\tbe\tthe\tfastest\tway\tto\timprove performance.\n\nFor\tevery\tpublic-facing\twebsite\tI’ve\tworked\ton,\twe’ve\tended\tup\tdoing\ta\tmix\tof\tall\tthree approaches.\tBut\tfor\tmore\tthan\tone\tdistributed\tsystem,\tI’ve\tgotten\taway\twith\tno\tcaching\tat all.\tBut\tit\tall\tcomes\tdown\tto\tknowing\twhat\tload\tyou\tneed\tto\thandle,\thow\tfresh\tyour\tdata needs\tto\tbe,\tand\twhat\tyour\tsystem\tcan\tdo\tright\tnow.\tKnowing\tthat\tyou\thave\ta\tnumber\tof different\ttools\tat\tyour\tdisposal\tis\tjust\tthe\tbeginning.",
      "content_length": 2548,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 380,
      "content": "Caching\tin\tHTTP\n\nHTTP\tprovides\tsome\treally\tuseful\tcontrols\tto\thelp\tus\tcache\teither\ton\tthe\tclient\tside\tor server\tside,\twhich\tare\tworth\tunderstanding\teven\tif\tyou\taren’t\tusing\tHTTP\titself.\n\nFirst,\twith\tHTTP,\twe\tcan\tuse\tcache-control\tdirectives\tin\tour\tresponses\tto\tclients.\tThese tell\tclients\tif\tthey\tshould\tcache\tthe\tresource\tat\tall,\tand\tif\tso\thow\tlong\tthey\tshould\tcache\tit for\tin\tseconds.\tWe\talso\thave\tthe\toption\tof\tsetting\tan\tExpires\theader,\twhere\tinstead\tof saying\thow\tlong\ta\tpiece\tof\tcontent\tcan\tbe\tcached\tfor,\twe\tspecify\ta\ttime\tand\tdate\tat\twhich a\tresource\tshould\tbe\tconsidered\tstale\tand\tfetched\tagain.\tThe\tnature\tof\tthe\tresources\tyou are\tsharing\tdetermines\twhich\tone\tis\tmost\tlikely\tto\tfit.\tStandard\tstatic\twebsite\tcontent\tlike CSS\tor\timages\toften\tfit\twell\twith\ta\tsimple\tcache-control\ttime\tto\tlive\t(TTL).\tOn\tthe other\thand,\tif\tyou\tknow\tin\tadvance\twhen\ta\tnew\tversion\tof\ta\tresource\twill\tbe\tupdated, setting\tan\tExpires\theader\twill\tmake\tmore\tsense.\tAll\tof\tthis\tis\tvery\tuseful\tin\tstopping\ta client\tfrom\teven\tneeding\tto\tmake\ta\trequest\tto\tthe\tserver\tin\tthe\tfirst\tplace.\n\nAside\tfrom\tcache-control\tand\tExpires,\twe\thave\tanother\toption\tin\tour\tarsenal\tof\tHTTP goodies:\tEntity\tTags,\tor\tETags.\tAn\tETag\tis\tused\tto\tdetermine\tif\tthe\tvalue\tof\ta\tresource\thas changed.\tIf\tI\tupdate\ta\tcustomer\trecord,\tthe\tURI\tto\tthe\tresource\tis\tthe\tsame,\tbut\tthe\tvalue is\tdifferent,\tso\tI\twould\texpect\tthe\tETag\tto\tchange.\tThis\tbecomes\tpowerful\twhen\twe’re using\twhat\tis\tcalled\ta\tconditional\tGET.\tWhen\tmaking\ta\tGET\trequest,\twe\tcan\tspecify additional\theaders,\ttelling\tthe\tservice\tto\tsend\tus\tthe\tresource\tonly\tif\tsome\tcriteria\tare\tmet.\n\nFor\texample,\tlet’s\timagine\twe\tfetch\ta\tcustomer\trecord,\tand\tits\tETag\tcomes\tback\tas o5t6fkd2sa.\tLater\ton,\tperhaps\tbecause\ta\tcache-control\tdirective\thas\ttold\tus\tthe\tresource should\tbe\tconsidered\tstale,\twe\twant\tto\tmake\tsure\twe\tget\tthe\tlatest\tversion.\tWhen\tissuing the\tsubsequent\tGET\trequest,\twe\tcan\tpass\tin\ta\tIf-None-Match:\to5t6fkd2sa.\tThis\ttells\tthe server\tthat\twe\twant\tthe\tresource\tat\tthe\tspecified\tURI,\tunless\tit\talready\tmatches\tthis\tETag value.\tIf\twe\talready\thave\tthe\tup-to-date\tversion,\tthe\tservice\tsends\tus\ta\t304\tNot\tModified response,\ttelling\tus\twe\thave\tthe\tlatest\tversion.\tIf\tthere\tis\ta\tnewer\tversion\tavailable,\twe\tget a\t200\tOK\twith\tthe\tchanged\tresource,\tand\ta\tnew\tETag\tfor\tthe\tresource.\n\nThe\tfact\tthat\tthese\tcontrols\tare\tbuilt\tinto\tsuch\ta\twidely\tused\tspecification\tmeans\twe\tget\tto take\tadvantage\tof\ta\tlot\tof\tpreexisting\tsoftware\tthat\thandles\tthe\tcaching\tfor\tus.\tReverse proxies\tlike\tSquid\tor\tVarnish\tcan\tsit\ttransparently\ton\tthe\tnetwork\tbetween\tclient\tand server,\tstoring\tand\texpiring\tcached\tcontent\tas\trequired.\tThese\tsystems\tare\tgeared\ttoward serving\thuge\tnumbers\tof\tconcurrent\trequests\tvery\tfast,\tand\tare\ta\tstandard\tway\tof\tscaling public-facing\twebsites.\tCDNs\tlike\tAWS’s\tCloudFront\tor\tAkamai\tcan\tensure\tthat\trequests are\trouted\tto\tcaches\tnear\tthe\tcalling\tclient,\tmaking\tsure\tthat\ttraffic\tdoesn’t\tgo\thalfway round\tthe\tworld\twhen\tit\tneeds\tto.\tAnd\tmore\tprosaically,\tHTTP\tclient\tlibraries\tand\tclient caches\tcan\thandle\ta\tlot\tof\tthis\twork\tfor\tus.\n\nETags,\tExpires,\tand\tcache-control\tcan\toverlap\ta\tbit,\tand\tif\tyou\taren’t\tcareful\tyou\tcan end\tup\tgiving\tconflicting\tinformation\tif\tyou\tdecide\tto\tuse\tall\tof\tthem!\tFor\ta\tmore\tin-depth",
      "content_length": 3224,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 381,
      "content": "discussion\tof\tthe\tvarious\tmerits,\ttake\ta\tlook\tat\tthe\tbook\tREST\tIn\tPractice\t(O’Reilly)\tor read\tsection\t13\tof\tthe\tHTTP\t1.1\tspecification,\twhich\tdescribes\thow\tboth\tclients\tand servers\tare\tsupposed\tto\timplement\tthese\tvarious\tcontrols.\n\nWhether\tyou\tdecide\tto\tuse\tHTTP\tas\tan\tinterservice\tprotocol,\tcaching\tat\tthe\tclient\tand reducing\tthe\tneed\tfor\tround-trips\tto\tthe\tclient\tis\twell\tworth\tit.\tIf\tyou\tdecide\tto\tpick\ta different\tprotocol,\tunderstand\twhen\tand\thow\tyou\tcan\tprovide\thints\tto\tthe\tclient\tto\thelp\tit understand\thow\tlong\tit\tcan\tcache\tfor.",
      "content_length": 536,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 382,
      "content": "Caching\tfor\tWrites\n\nAlthough\tyou’ll\tfind\tyourself\tusing\tcaching\tfor\treads\tmore\toften,\tthere\tare\tsome\tuse\tcases where\tcaching\tfor\twrites\tmake\tsense.\tFor\texample,\tif\tyou\tmake\tuse\tof\ta\twrite-behind cache,\tyou\tcan\twrite\tto\ta\tlocal\tcache,\tand\tat\tsome\tlater\tpoint\tthe\tdata\twill\tbe\tflushed\tto\ta downstream\tsource,\tprobably\tthe\tcanonical\tsource\tof\tdata.\tThis\tcan\tbe\tuseful\twhen\tyou have\tbursts\tof\twrites,\tor\twhen\tthere\tis\ta\tgood\tchance\tthat\tthe\tsame\tdata\twill\tbe\twritten multiple\ttimes.\tWhen\tused\tto\tbuffer\tand\tpotentially\tbatch\twrites,\twrite-behind\tcaches\tcan be\ta\tuseful\tfurther\tperformance\toptimization.\n\nWith\ta\twrite-behind\tcache,\tif\tthe\tbuffered\twrites\tare\tsuitably\tpersistent,\teven\tif\tthe downstream\tservice\tis\tunavailable\twe\tcould\tqueue\tup\tthe\twrites\tand\tsend\tthem\tthrough when\tit\tis\tavailable\tagain.",
      "content_length": 799,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 383,
      "content": "Caching\tfor\tResilience\n\nCaching\tcan\tbe\tused\tto\timplement\tresiliency\tin\tcase\tof\tfailure.\tWith\tclient-side\tcaching,\tif the\tdownstream\tservice\tis\tunavailable,\tthe\tclient\tcould\tdecide\tto\tsimply\tuse\tcached\tbut potentially\tstale\tdata.\tWe\tcould\talso\tuse\tsomething\tlike\ta\treverse\tproxy\tto\tserve\tup\tstale data.\tFor\tsome\tsystems,\tbeing\tavailable\teven\twith\tstale\tdata\tis\tbetter\tthan\tnot\treturning\ta result\tat\tall,\tbut\tthat\tis\ta\tjudgment\tcall\tyou’ll\thave\tto\tmake.\tObviously,\tif\twe\tdon’t\thave the\trequested\tdata\tin\tthe\tcache,\tthen\twe\tcan’t\tdo\tmuch\tto\thelp,\tbut\tthere\tare\tways\tto mitigate\tthis.\n\nA\ttechnique\tI\tsaw\tused\tat\tthe\tGuardian,\tand\tsubsequently\telsewhere,\twas\tto\tcrawl\tthe existing\tlive\tsite\tperiodically\tto\tgenerate\ta\tstatic\tversion\tof\tthe\twebsite\tthat\tcould\tbe served\tin\tthe\tevent\tof\tan\toutage.\tAlthough\tthis\tcrawled\tversion\twasn’t\tas\tfresh\tas\tthe cached\tcontent\tserved\tfrom\tthe\tlive\tsystem,\tin\ta\tpinch\tit\tcould\tensure\tthat\ta\tversion\tof\tthe site\twould\tget\tdisplayed.",
      "content_length": 962,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 384,
      "content": "Hiding\tthe\tOrigin\n\nWith\ta\tnormal\tcache,\tif\ta\trequest\tresults\tin\ta\tcache\tmiss,\tthe\trequest\tgoes\ton\tto\tthe\torigin to\tfetch\tthe\tfresh\tdata\twith\tthe\tcaller\tblocking,\twaiting\ton\tthe\tresult.\tIn\tthe\tnormal\tcourse of\tthings,\tthis\tis\tto\tbe\texpected.\tBut\tif\twe\tsuffer\ta\tmassive\tcache\tmiss,\tperhaps\tbecause\tan entire\tmachine\t(or\tgroup\tof\tmachines)\tthat\tprovide\tour\tcache\tfail,\ta\tlarge\tnumber\tof requests\twill\thit\tthe\torigin.\n\nFor\tthose\tservices\tthat\tserve\tup\thighly\tcachable\tdata,\tit\tis\tcommon\tfor\tthe\torigin\titself\tto be\tscaled\tto\thandle\tonly\ta\tfraction\tof\tthe\ttotal\ttraffic,\tas\tmost\trequests\tget\tserved\tout\tof memory\tby\tthe\tcaches\tthat\tsit\tin\tfront\tof\tthe\torigin.\tIf\twe\tsuddenly\tget\ta\tthundering\therd due\tto\tan\tentire\tcache\tregion\tvanishing,\tour\torigin\tcould\tbe\tpummelled\tout\tof\texistence.\n\nOne\tway\tto\tprotect\tthe\torigin\tin\tsuch\ta\tsituation\tis\tnever\tto\tallow\trequests\tto\tgo\tto\tthe origin\tin\tthe\tfirst\tplace.\tInstead,\tthe\torigin\titself\tpopulates\tthe\tcache\tasynchronously\twhen needed,\tas\tshown\tin\tFigure\t11-7.\tIf\ta\tcache\tmiss\tis\tcaused,\tthis\ttriggers\tan\tevent\tthat\tthe origin\tcan\tpick\tup\ton,\talerting\tit\tthat\tit\tneeds\tto\trepopulate\tthe\tcache.\tSo\tif\tan\tentire\tshard has\tvanished,\twe\tcan\trebuild\tthe\tcache\tin\tthe\tbackground.\tWe\tcould\tdecide\tto\tblock\tthe original\trequest\twaiting\tfor\tthe\tregion\tto\tbe\trepopulated,\tbut\tthis\tcould\tcause\tcontention on\tthe\tcache\titself,\tleading\tto\tfurther\tproblems.\tIt’s\tmore\tlikely\tif\twe\tare\tprioritizing keeping\tthe\tsystem\tstable\tthat\twe\twould\tfail\tthe\toriginal\trequest,\tbut\tit\twould\tfail\tfast.\n\nFigure\t11-7.\tHiding\tthe\torigin\tfrom\tthe\tclient\tand\tpopulating\tthe\tcache\tasynchronously\n\nThis\tsort\tof\tapproach\tmay\tnot\tmake\tsense\tfor\tsome\tsituations,\tbut\tit\tcan\tbe\ta\tway\tto ensure\tthe\tsystem\tremains\tup\twhen\tparts\tof\tit\tfail.\tBy\tfailing\trequests\tfast,\tand\tensuring we\tdon’t\ttake\tup\tresources\tor\tincrease\tlatency,\twe\tavoid\ta\tfailure\tin\tour\tcache\tfrom cascading\tdownstream\tand\tgive\tourselves\ta\tchance\tto\trecover.",
      "content_length": 1923,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 385,
      "content": "Keep\tIt\tSimple\n\nBe\tcareful\tabout\tcaching\tin\ttoo\tmany\tplaces!\tThe\tmore\tcaches\tbetween\tyou\tand\tthe source\tof\tfresh\tdata,\tthe\tmore\tstale\tthe\tdata\tcan\tbe,\tand\tthe\tharder\tit\tcan\tbe\tto\tdetermine the\tfreshness\tof\tthe\tdata\tthat\ta\tclient\teventually\tsees.\tThis\tcan\tbe\tespecially\tproblematic with\ta\tmicroservice\tarchitecture\twhere\tyou\thave\tmultiple\tservices\tinvolved\tin\ta\tcall\tchain. Again,\tthe\tmore\tcaching\tyou\thave,\tthe\tharder\tit\twill\tbe\tto\tassess\tthe\tfreshness\tof\tany\tpiece of\tdata.\tSo\tif\tyou\tthink\ta\tcache\tis\ta\tgood\tidea,\tkeep\tit\tsimple,\tstick\tto\tone,\tand\tthink carefully\tbefore\tadding\tmore!",
      "content_length": 584,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 386,
      "content": "Cache\tPoisoning:\tA\tCautionary\tTale\n\nWith\tcaching\twe\toften\tthink\tthat\tif\twe\tget\tit\twrong\tthe\tworst\tthing\tthat\tcan\thappen\tis\twe serve\tstale\tdata\tfor\ta\tbit.\tBut\twhat\thappens\tif\tyou\tend\tup\tserving\tstale\tdata\tforever? Earlier\tI\tmentioned\tthe\tproject\tI\tworked\ton\twhere\twe\twere\tusing\ta\tstrangler\tapplication\tto help\tintercept\tcalls\tto\tmultiple\tlegacy\tsystems\twith\ta\tview\tof\tincrementally\tretiring\tthem. Our\tapplication\toperated\teffectively\tas\ta\tproxy.\tTraffic\tto\tour\tapplication\twas\trouted through\tto\tthe\tlegacy\tapplication.\tOn\tthe\tway\tback,\twe\tdid\ta\tfew\thousekeeping\tthings;\tfor example,\twe\tmade\tsure\tthat\tthe\tresults\tfrom\tthe\tlegacy\tapplication\thad\tproper\tHTTP cache\theaders\tapplied.\n\nOne\tday,\tshortly\tafter\ta\tnormal\troutine\trelease,\tsomething\todd\tstarted\thappening.\tA\tbug had\tbeen\tintroduced\twhereby\ta\tsmall\tsubset\tof\tpages\twere\tfalling\tthrough\ta\tlogic condition\tin\tour\tcache\theader\tinsertion\tcode,\tresulting\tin\tus\tnot\tchanging\tthe\theader\tat\tall. Unfortunately,\tthis\tdownstream\tapplication\thad\talso\tbeen\tchanged\tsometime\tpreviously\tto include\tan\tExpires:\tNever\tHTTP\theader.\tThis\thadn’t\thad\tany\teffect\tearlier,\tas\twe\twere overriding\tthis\theader.\tNow\twe\tweren’t.\n\nOur\tapplication\tmade\theavy\tuse\tof\tSquid\tto\tcache\tHTTP\ttraffic,\tand\twe\tnoticed\tthe problem\tquite\tquickly\tas\twe\twere\tseeing\tmore\trequests\tbypassing\tSquid\titself\tto\thit\tour application\tservers.\tWe\tfixed\tthe\tcache\theader\tcode\tand\tpushed\tout\ta\trelease,\tand\talso manually\tcleared\tthe\trelevant\tregion\tof\tthe\tSquid\tcache.\tHowever,\tthat\twasn’t\tenough.\n\nAs\tI\tmentioned\tearlier,\tyou\tcan\tcache\tin\tmultiple\tplaces.\tWhen\tit\tcomes\tto\tserving\tup content\tto\tusers\tof\ta\tpublic-facing\tweb\tapplication,\tyou\tcould\thave\tmultiple\tcaches between\tyou\tand\tyour\tcustomer.\tNot\tonly\tmight\tyou\tbe\tfronting\tyour\twebsite\twith something\tlike\ta\tCDN,\tbut\tsome\tISPs\tmake\tuse\tof\tcaching.\tCan\tyou\tcontrol\tthose\tcaches? And\teven\tif\tyou\tcould,\tthere\tis\tone\tcache\tthat\tyou\thave\tlittle\tcontrol\tover:\tthe\tcache\tin\ta user’s\tbrowser.\n\nThose\tpages\twith\tExpires:\tNever\tstuck\tin\tthe\tcaches\tof\tmany\tof\tour\tusers,\tand\twould never\tbe\tinvalidated\tuntil\tthe\tcache\tbecame\tfull\tor\tthe\tuser\tcleaned\tthem\tout\tmanually. Clearly\twe\tcouldn’t\tmake\teither\tthing\thappen;\tour\tonly\toption\twas\tto\tchange\tthe\tURLs\tof these\tpages\tso\tthey\twere\trefetched.\n\nCaching\tcan\tbe\tvery\tpowerful\tindeed,\tbut\tyou\tneed\tto\tunderstand\tthe\tfull\tpath\tof\tdata\tthat is\tcached\tfrom\tsource\tto\tdestination\tto\treally\tappreciate\tits\tcomplexities\tand\twhat\tcan\tgo wrong.",
      "content_length": 2433,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 387,
      "content": "Autoscaling\n\nIf\tyou\tare\tlucky\tenough\tto\thave\tfully\tautomatable\tprovisioning\tof\tvirtual\thosts,\tand\tcan fully\tautomate\tthe\tdeployment\tof\tyour\tmicroservice\tinstances,\tthen\tyou\thave\tthe\tbuilding blocks\tto\tallow\tyou\tto\tautomatically\tscale\tyour\tmicroservices.\n\nFor\texample,\tyou\tcould\talso\thave\tthe\tscaling\ttriggered\tby\twell-known\ttrends.\tYou\tmight know\tthat\tyour\tsystem’s\tpeak\tload\tis\tbetween\t9\ta.m.\tand\t5\tp.m.,\tso\tyou\tbring\tup additional\tinstances\tat\t8:45\ta.m.,\tand\tturn\tthem\toff\tat\t5:15\tp.m..\tIf\tyou’re\tusing\tsomething like\tAWS\t(which\thas\tvery\tgood\tsupport\tfor\tautoscaling\tbuilt\tin),\tturning\toff\tinstances\tyou don’t\tneed\tany\tlonger\twill\thelp\tsave\tmoney.\tYou’ll\tneed\tdata\tto\tunderstand\thow\tyour\tload changes\tover\ttime,\tfrom\tday\tto\tday,\tweek\tto\tweek.\tSome\tbusinesses\thave\tobvious seasonal\tcycles\ttoo,\tso\tyou\tmay\tneed\tdata\tgoing\tback\ta\tfair\tway\tto\tmake\tproper\tjudgment calls.\n\nOn\tthe\tother\thand,\tyou\tcould\tbe\treactive,\tbringing\tup\tadditional\tinstances\twhen\tyou\tsee an\tincrease\tin\tload\tor\tan\tinstance\tfailure,\tand\tremove\tinstances\twhen\tyou\tno\tlonger needed\tthem.\tKnowing\thow\tfast\tyou\tcan\tscale\tup\tonce\tyou\tspot\tan\tupward\ttrend\tis\tkey.\tIf you\tknow\tyou’ll\tonly\tget\ta\tcouple\tof\tminutes’\tnotice\tabout\tan\tincrease\tin\tload,\tbut\tscaling up\twill\ttake\tyou\tat\tleast\t10\tminutes,\tyou\tknow\tyou’ll\tneed\tto\tkeep\textra\tcapacity\taround to\tbridge\tthis\tgap.\tHaving\ta\tgood\tsuite\tof\tload\ttests\tis\talmost\tessential\there.\tYou\tcan\tuse them\tto\ttest\tyour\tautoscaling\trules.\tIf\tyou\tdon’t\thave\ttests\tthat\tcan\treproduce\tdifferent loads\tthat\twill\ttrigger\tscaling,\tthen\tyou’re\tonly\tgoing\tto\tfind\tout\tin\tproduction\tif\tyou\tgot the\trules\twrong.\tAnd\tthe\tconsequences\tof\tfailure\taren’t\tgreat!\n\nA\tnews\tsite\tis\ta\tgreat\texample\tof\ta\ttype\tof\tbusiness\twhere\tyou\tmay\twant\ta\tmix\tof predictive\tand\treactive\tscaling.\tOn\tthe\tlast\tnews\tsite\tI\tworked\ton,\twe\tsaw\tvery\tclear\tdaily trends,\twith\tviews\tclimbing\tfrom\tthe\tmorning\tto\tlunchtime\tand\tthen\tstarting\tto\tdecline. This\tpattern\twas\trepeated\tday\tin,\tday\tout,\twith\ttraffic\tless\tpronounced\tat\tthe\tweekend. That\tgave\tyou\ta\tfairly\tclear\ttrend\tthat\tcould\tdrive\tproactive\tscaling\tup\t(and\tdown)\tof resources.\tOn\tthe\tother\thand,\ta\tbig\tnews\tstory\twould\tcause\tan\tunexpected\tspike,\trequiring more\tcapacity\tat\toften\tshort\tnotice.\n\nI\tactually\tsee\tautoscaling\tused\tmuch\tmore\tfor\thandling\tfailure\tof\tinstances\tthan\tfor reacting\tto\tload\tconditions.\tAWS\tlets\tyou\tspecify\trules\tlike\t“There\tshould\tbe\tat\tleast\t5 instances\tin\tthis\tgroup,”\tso\tif\tone\tgoes\tdown\ta\tnew\tone\tis\tautomatically\tlaunched.\tI’ve seen\tthis\tapproach\tlead\tto\ta\tfun\tgame\tof\twhack-a-mole\twhen\tsomeone\tforgets\tto\tturn\toff the\trule\tand\tthen\ttries\tto\ttake\tdown\tthe\tinstances\tfor\tmaintenance,\tonly\tto\tsee\tthem\tkeep spinning\tup!\n\nBoth\treactive\tand\tpredictive\tscaling\tare\tvery\tuseful,\tand\tcan\thelp\tyou\tbe\tmuch\tmore\tcost effective\tif\tyou’re\tusing\ta\tplatform\tthat\tallows\tyou\tto\tpay\tonly\tfor\tthe\tcomputing resources\tyou\tuse.\tBut\tthey\talso\trequire\tcareful\tobservation\tof\tthe\tdata\tavailable\tto\tyou. I’d\tsuggest\tusing\tautoscaling\tfor\tfailure\tconditions\tfirst\twhile\tyou\tcollect\tthe\tdata.\tOnce",
      "content_length": 3021,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 388,
      "content": "you\twant\tto\tstart\tscaling\tfor\tload,\tmake\tsure\tyou\tare\tvery\tcautious\tabout\tscaling\tdown\ttoo quickly.\tIn\tmost\tsituations,\thaving\tmore\tcomputing\tpower\tat\tyour\thands\tthan\tyou\tneed\tis much\tbetter\tthan\tnot\thaving\tenough!",
      "content_length": 214,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 389,
      "content": "CAP\tTheorem\n\nWe’d\tlike\tto\thave\tit\tall,\tbut\tunfortunately\twe\tknow\twe\tcan’t.\tAnd\twhen\tit\tcomes\tto distributed\tsystems\tlike\tthose\twe\tbuild\tusing\tmicroservice\tarchitectures,\twe\teven\thave\ta mathematical\tproof\tthat\ttells\tus\twe\tcan’t.\tYou\tmay\twell\thave\theard\tabout\tthe\tCAP theorem,\tespecially\tin\tdiscussions\tabout\tthe\tmerits\tof\tvarious\tdifferent\ttypes\tof\tdata stores.\tAt\tits\theart\tit\ttells\tus\tthat\tin\ta\tdistributed\tsystem,\twe\thave\tthree\tthings\twe\tcan\ttrade off\tagainst\teach\tother:\tconsistency,\tavailability,\tand\tpartition\ttolerance.\tSpecifically,\tthe theorem\ttells\tus\tthat\twe\tget\tto\tkeep\ttwo\tin\ta\tfailure\tmode.\n\nConsistency\tis\tthe\tsystem\tcharacteristic\tby\twhich\tI\twill\tget\tthe\tsame\tanswer\tif\tI\tgo\tto multiple\tnodes.\tAvailability\tmeans\tthat\tevery\trequest\treceives\ta\tresponse.\tPartition tolerance\tis\tthe\tsystem’s\tability\tto\thandle\tthe\tfact\tthat\tcommunication\tbetween\tits\tparts\tis sometimes\timpossible.\n\nSince\tEric\tBrewer\tpublished\this\toriginal\tconjecture,\tthe\tidea\thas\tgained\ta\tmathematical proof.\tI’m\tnot\tgoing\tto\tdive\tinto\tthe\tmath\tof\tthe\tproof\titself,\tas\tnot\tonly\tis\tthis\tnot\tthat sort\tof\tbook,\tbut\tI\tcan\talso\tguarantee\tthat\tI\twould\tget\tit\twrong.\tInstead,\tlet’s\tuse\tsome worked\texamples\tthat\twill\thelp\tus\tunderstand\tthat\tunder\tit\tall,\tthe\tCAP\ttheorem\tis\ta distillation\tof\ta\tvery\tlogical\tset\tof\treasoning.\n\nWe’ve\talready\ttalked\tabout\tsome\tsimple\tdatabase\tscaling\ttechniques.\tLet’s\tuse\tone\tof these\tto\tprobe\tthe\tideas\tbehind\tthe\tCAP\ttheorem.\tLet’s\timagine\tthat\tour\tinventory\tservice is\tdeployed\tacross\ttwo\tseparate\tdata\tcenters,\tas\tshown\tin\tFigure\t11-8.\tBacking\tour\tservice instance\tin\teach\tdata\tcenter\tis\ta\tdatabase,\tand\tthese\ttwo\tdatabases\ttalk\tto\teach\tother\tto\ttry to\tsynchronize\tdata\tbetween\tthem.\tReads\tand\twrites\tare\tdone\tvia\tthe\tlocal\tdatabase\tnode, and\treplication\tis\tused\tto\tsynchronize\tthe\tdata\tbetween\tthe\tnodes.\n\nNow\tlet’s\tthink\tabout\twhat\thappens\twhen\tsomething\tfails.\tImagine\tthat\tsomething\tas simple\tas\tthe\tnetwork\tlink\tbetween\tthe\ttwo\tdata\tcenters\tstops\tworking.\tThe synchronization\tat\tthis\tpoint\tfails.\tWrites\tmade\tto\tthe\tprimary\tdatabase\tin\tDC1\twill\tnot propagate\tto\tDC2,\tand\tvice\tversa.\tMost\tdatabases\tthat\tsupport\tthese\tsetups\talso\tsupport some\tsort\tof\tqueuing\ttechnique\tto\tensure\tthat\twe\tcan\trecover\tfrom\tthis\tafterward,\tbut what\thappens\tin\tthe\tmeantime?",
      "content_length": 2267,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 390,
      "content": "Figure\t11-8.\tUsing\tmultiprimary\treplication\tto\tshare\tdata\tbetween\ttwo\tdatabase\tnodes",
      "content_length": 84,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 391,
      "content": "Sacrificing\tConsistency\n\nLet’s\tassume\tthat\twe\tdon’t\tshut\tthe\tinventory\tservice\tdown\tentirely.\tIf\tI\tmake\ta\tchange now\tto\tthe\tdata\tin\tDC1,\tthe\tdatabase\tin\tDC2\tdoesn’t\tsee\tit.\tThis\tmeans\tany\trequests\tmade to\tour\tinventory\tnode\tin\tDC2\tsee\tpotentially\tstale\tdata.\tIn\tother\twords,\tour\tsystem\tis\tstill available\tin\tthat\tboth\tnodes\tare\table\tto\tserve\trequests,\tand\twe\thave\tkept\tthe\tsystem running\tdespite\tthe\tpartition,\tbut\twe\thave\tlost\tconsistency.\tThis\tis\toften\tcalled\ta\tAP system.\tWe\tdon’t\tget\tto\tkeep\tall\tthree.\n\nDuring\tthis\tpartition,\tif\twe\tkeep\taccepting\twrites\tthen\twe\taccept\tthe\tfact\tthat\tat\tsome point\tin\tthe\tfuture\tthey\thave\tto\tbe\tresynchronized.\tThe\tlonger\tthe\tpartition\tlasts,\tthe\tmore difficult\tthis\tresynchronization\tcan\tbecome.\n\nThe\treality\tis\tthat\teven\tif\twe\tdon’t\thave\ta\tnetwork\tfailure\tbetween\tour\tdatabase\tnodes, replication\tof\tdata\tis\tnot\tinstantaneous.\tAs\ttouched\ton\tearlier,\tsystems\tthat\tare\thappy\tto cede\tconsistency\tto\tkeep\tpartition\ttolerance\tand\tavailability\tare\tsaid\tto\tbe\teventually consistent;\tthat\tis,\twe\texpect\tat\tsome\tpoint\tin\tthe\tfuture\tthat\tall\tnodes\twill\tsee\tthe\tupdated data,\tbut\tit\twon’t\thappen\tat\tonce\tso\twe\thave\tto\tlive\twith\tthe\tpossibility\tthat\tusers\tsee\told data.",
      "content_length": 1195,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 392,
      "content": "Sacrificing\tAvailability\n\nWhat\thappens\tif\twe\tneed\tto\tkeep\tconsistency\tand\twant\tto\tdrop\tsomething\telse\tinstead? Well,\tto\tkeep\tconsistency,\teach\tdatabase\tnode\tneeds\tto\tknow\tthe\tcopy\tof\tthe\tdata\tit\thas\tis the\tsame\tas\tthe\tother\tdatabase\tnode.\tNow\tin\tthe\tpartition,\tif\tthe\tdatabase\tnodes\tcan’t\ttalk to\teach\tother,\tthey\tcannot\tcoordinate\tto\tensure\tconsistency.\tWe\tare\tunable\tto\tguarantee consistency,\tso\tour\tonly\toption\tis\tto\trefuse\tto\trespond\tto\tthe\trequest.\tIn\tother\twords,\twe have\tsacrificed\tavailability.\tOur\tsystem\tis\tconsistent\tand\tpartition\ttolerant,\tor\tCP.\tIn\tthis mode\tour\tservice\twould\thave\tto\twork\tout\thow\tto\tdegrade\tfunctionality\tuntil\tthe\tpartition is\thealed\tand\tthe\tdatabase\tnodes\tcan\tbe\tresynchronized.\n\nConsistency\tacross\tmultiple\tnodes\tis\treally\thard.\tThere\tare\tfew\tthings\t(perhaps\tnothing) harder\tin\tdistributed\tsystems.\tThink\tabout\tit\tfor\ta\tmoment.\tImagine\tI\twant\tto\tread\ta record\tfrom\tthe\tlocal\tdatabase\tnode.\tHow\tdo\tI\tknow\tit\tis\tup\tto\tdate?\tI\thave\tto\tgo\tand\task the\tother\tnode.\tBut\tI\talso\thave\tto\task\tthat\tdatabase\tnode\tto\tnot\tallow\tit\tto\tbe\tupdated while\tthe\tread\tcompletes;\tin\tother\twords,\tI\tneed\tto\tinitiate\ta\ttransactional\tread\tacross multiple\tdatabase\tnodes\tto\tensure\tconsistency.\tBut\tin\tgeneral\tpeople\tdon’t\tdo transactional\treads,\tdo\tthey?\tBecause\ttransactional\treads\tare\tslow.\tThey\trequire\tlocks.\tA read\tcan\tblock\tan\tentire\tsystem\tup.\tAll\tconsistent\tsystems\trequire\tsome\tlevel\tof\tlocking\tto do\ttheir\tjob.\n\nAs\twe’ve\talready\tdiscussed,\tdistributed\tsystems\thave\tto\texpect\tfailure.\tConsider\tour transactional\tread\tacross\ta\tset\tof\tconsistent\tnodes.\tI\task\ta\tremote\tnode\tto\tlock\ta\tgiven record\twhile\tthe\tread\tis\tinitiated.\tI\tcomplete\tthe\tread,\tand\task\tthe\tremote\tnode\tto\trelease its\tlock,\tbut\tnow\tI\tcan’t\ttalk\tto\tit.\tWhat\thappens\tnow?\tLocks\tare\treally\thard\tto\tget\tright even\tin\ta\tsingle\tprocess\tsystem,\tand\tare\tsignificantly\tmore\tdifficult\tto\timplement\twell\tin\ta distributed\tsystem.\n\nRemember\twhen\twe\ttalked\tabout\tdistributed\ttransactions\tin\tChapter\t5?\tThe\tcore\treason they\tare\tchallenging\tis\tbecause\tof\tthis\tproblem\twith\tensuring\tconsistency\tacross\tmultiple nodes.\n\nGetting\tmultinode\tconsistency\tright\tis\tso\thard\tthat\tI\twould\tstrongly,\tstrongly\tsuggest\tthat if\tyou\tneed\tit,\tdon’t\ttry\tto\tinvent\tit\tyourself.\tInstead,\tpick\ta\tdata\tstore\tor\tlock\tservice\tthat offers\tthese\tcharacteristics.\tConsul,\tfor\texample,\twhich\twe’ll\tdiscuss\tshortly,\timplements a\tstrongly\tconsistent\tkey/value\tstore\tdesigned\tto\tshare\tconfiguration\tbetween\tmultiple nodes.\tAlong\twith\t“Friends\tdon’t\tlet\tfriends\twrite\ttheir\town\tcrypto”\tshould\tgo\t“Friends don’t\tlet\tfriends\twrite\ttheir\town\tdistributed\tconsistent\tdata\tstore.”\tIf\tyou\tthink\tyou\tneed\tto write\tyour\town\tCP\tdata\tstore,\tread\tall\tthe\tpapers\ton\tthe\tsubject\tfirst,\tthen\tget\ta\tPhD,\tand then\tlook\tforward\tto\tspending\ta\tfew\tyears\tgetting\tit\twrong.\tMeanwhile,\tI’ll\tbe\tusing something\toff\tthe\tshelf\tthat\tdoes\tit\tfor\tme,\tor\tmore\tlikely\ttrying\treally\thard\tto\tbuild eventually\tconsistent\tAP\tsystems\tinstead.",
      "content_length": 2939,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 393,
      "content": "Sacrificing\tPartition\tTolerance?\n\nWe\tget\tto\tpick\ttwo,\tright?\tSo\twe’ve\tgot\tour\teventually\tconsistent\tAP\tsystem.\tWe\thave\tour consistent,\tbut\thard\tto\tbuild\tand\tscale,\tCP\tsystem.\tWhy\tnot\ta\tCA\tsystem?\tWell,\thow\tcan we\tsacrifice\tpartition\ttolerance?\tIf\tour\tsystem\thas\tno\tpartition\ttolerance,\tit\tcan’t\trun\tover\ta network.\tIn\tother\twords,\tit\tneeds\tto\tbe\ta\tsingle\tprocess\toperating\tlocally.\tCA\tsystems don’t\texist\tin\tdistributed\tsystems.",
      "content_length": 428,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 394,
      "content": "AP\tor\tCP?\n\nWhich\tis\tright,\tAP\tor\tCP?\tWell,\tthe\treality\tis\tit\tdepends.\tAs\tthe\tpeople\tbuilding\tthe system,\twe\tknow\tthe\ttrade-off\texists.\tWe\tknow\tthat\tAP\tsystems\tscale\tmore\teasily\tand\tare simpler\tto\tbuild,\tand\twe\tknow\tthat\ta\tCP\tsystem\twill\trequire\tmore\twork\tdue\tto\tthe challenges\tin\tsupporting\tdistributed\tconsistency.\tBut\twe\tmay\tnot\tunderstand\tthe\tbusiness impact\tof\tthis\ttrade-off.\tFor\tour\tinventory\tsystem,\tif\ta\trecord\tis\tout\tof\tdate\tby\tfive minutes,\tis\tthat\tOK?\tIf\tthe\tanswer\tis\tyes,\tan\tAP\tsystem\tmight\tbe\tthe\tanswer.\tBut\twhat about\tthe\tbalance\theld\tfor\ta\tcustomer\tin\ta\tbank?\tCan\tthat\tbe\tout\tof\tdate?\tWithout knowing\tthe\tcontext\tin\twhich\tthe\toperation\tis\tbeing\tused,\twe\tcan’t\tknow\tthe\tright\tthing\tto do.\tKnowing\tabout\tthe\tCAP\ttheorem\tjust\thelps\tyou\tunderstand\tthat\tthis\ttrade-off\texists and\twhat\tquestions\tto\task.",
      "content_length": 814,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 395,
      "content": "It’s\tNot\tAll\tor\tNothing\n\nOur\tsystem\tas\ta\twhole\tdoesn’t\tneed\tto\tbe\teither\tAP\tor\tCP.\tOur\tcatalog\tcould\tbe\tAP,\tas\twe don’t\tmind\ttoo\tmuch\tabout\ta\tstale\trecord.\tBut\twe\tmight\tdecide\tthat\tour\tinventory\tservice needs\tto\tbe\tCP,\tas\twe\tdon’t\twant\tto\tsell\ta\tcustomer\tsomething\twe\tdon’t\thave\tand\tthen have\tto\tapologize\tlater.\n\nBut\tindividual\tservices\tdon’t\teven\tneed\tto\tbe\tCP\tor\tAP.\n\nLet’s\tthink\tabout\tour\tpoints\tbalance\tservice,\twhere\twe\tstore\trecords\tof\thow\tmany\tloyalty points\tour\tcustomers\thave\tbuilt\tup.\tWe\tcould\tdecide\tthat\twe\tdon’t\tcare\tif\tthe\tbalance\twe show\tfor\ta\tcustomer\tis\tstale,\tbut\tthat\twhen\tit\tcomes\tto\tupdating\ta\tbalance\twe\tneed\tit\tto\tbe consistent\tto\tensure\tthat\tcustomers\tdon’t\tuse\tmore\tpoints\tthan\tthey\thave\tavailable.\tIs\tthis microservice\tCP,\tor\tAP,\tor\tis\tit\tboth?\tReally,\twhat\twe\thave\tdone\tis\tpush\tthe\ttrade-offs around\tthe\tCAP\ttheorem\tdown\tto\tindividual\tservice\tcapabilities.\n\nAnother\tcomplexity\tis\tthat\tneither\tconsistency\tnor\tavailability\tis\tall\tor\tnothing.\tMany systems\tallow\tus\ta\tfar\tmore\tnuanced\ttrade-off.\tFor\texample,\twith\tCassandra\tI\tcan\tmake different\ttrade-offs\tfor\tindividual\tcalls.\tSo\tif\tI\tneed\tstrict\tconsistency,\tI\tcan\tperform\ta\tread that\tblocks\tuntil\tall\treplicas\thave\tresponded\tconfirming\tthe\tvalue\tis\tconsistent,\tor\tuntil\ta specific\tquorum\tof\treplicas\thave\tresponded,\tor\teven\tjust\ta\tsingle\tnode.\tObviously,\tif\tI block\twaiting\tfor\tall\treplicas\tto\treport\tback\tand\tone\tof\tthem\tis\tunavailable,\tI’ll\tbe blocking\tfor\ta\tlong\ttime.\tBut\tif\tI\tam\tsatisfied\twith\tjust\ta\tsimple\tquorum\tof\tnodes reporting\tback,\tI\tcan\taccept\tsome\tlack\tof\tconsistency\tto\tbe\tless\tvulnerable\tto\ta\tsingle replica\tbeing\tunavailable.\n\nYou’ll\toften\tsee\tposts\tabout\tpeople\tbeating\tthe\tCAP\ttheorem.\tThey\thaven’t.\tWhat\tthey have\tdone\tis\tcreate\ta\tsystem\twhere\tsome\tcapabilities\tare\tCP,\tand\tsome\tare\tAP.\tThe mathematical\tproof\tbehind\tthe\tCAP\ttheorem\tholds.\tDespite\tmany\tattempts\tat\tschool,\tI’ve learned\tthat\tyou\tdon’t\tbeat\tmath.",
      "content_length": 1910,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 396,
      "content": "And\tthe\tReal\tWorld\n\nMuch\tof\twhat\twe’ve\ttalked\tabout\tis\tthe\telectronic\tworld\t—\tbits\tand\tbytes\tstored\tin memory.\tWe\ttalk\tabout\tconsistency\tin\tan\talmost\tchild-like\tfashion;\twe\timagine\tthat\twithin the\tscope\tof\tthe\tsystem\twe\thave\tcreated,\twe\tcan\tstop\tthe\tworld\tand\thave\tit\tall\tmake\tsense. And\tyet\tso\tmuch\tof\twhat\twe\tbuild\tis\tjust\ta\treflection\tof\tthe\treal\tworld,\tand\twe\tdon’t\tget\tto control\tthat,\tdo\twe?\n\nLet’s\trevisit\tour\tinventory\tsystem.\tThis\tmaps\tto\treal-world,\tphysical\titems.\tWe\tkeep\ta count\tin\tour\tsystem\tof\thow\tmany\talbums\twe\thave.\tAt\tthe\tstart\tof\tthe\tday\twe\thad\t100 copies\tof\tGive\tBlood\tby\tThe\tBrakes.\tWe\tsold\tone.\tNow\twe\thave\t99\tcopies.\tEasy,\tright? By\twhat\thappens\tif\twhen\tthe\torder\twas\tbeing\tsent\tout,\tsomeone\tknocks\ta\tcopy\tof\tthe album\tonto\tthe\tfloor\tand\tit\tgets\tstepped\ton\tand\tbroken?\tWhat\thappens\tnow?\tOur\tsystems say\t99,\tbut\tthere\tare\t98\tcopies\ton\tthe\tshelf.\n\nWhat\tif\twe\tmade\tour\tinventory\tsystem\tAP\tinstead,\tand\toccasionally\thad\tto\tcontact\ta\tuser later\ton\tand\ttell\thim\tthat\tone\tof\this\titems\tis\tactually\tout\tof\tstock?\tWould\tthat\tbe\tthe\tworst thing\tin\tthe\tworld?\tIt\twould\tcertainly\tbe\tmuch\teasier\tto\tbuild,\tscale,\tand\tensure\tit\tis correct.\n\nWe\thave\tto\trecognize\tthat\tno\tmatter\thow\tconsistent\tour\tsystems\tmight\tbe\tin\tand\tof themselves,\tthey\tcannot\tknow\teverything\tthat\thappens,\tespecially\twhen\twe’re\tkeeping records\tof\tthe\treal\tworld.\tThis\tis\tone\tof\tthe\tmain\treasons\twhy\tAP\tsystems\tend\tup\tbeing the\tright\tcall\tin\tmany\tsituations.\tAside\tfrom\tthe\tcomplexity\tof\tbuilding\tCP\tsystems,\tthey can’t\tfix\tall\tour\tproblems\tanyway.",
      "content_length": 1527,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 397,
      "content": "Service\tDiscovery\n\nOnce\tyou\thave\tmore\tthan\ta\tfew\tmicroservices\tlying\taround,\tyour\tattention\tinevitably turns\tto\tknowing\twhere\ton\tearth\teverything\tis.\tPerhaps\tyou\twant\tto\tknow\twhat\tis\trunning in\ta\tgiven\tenvironment\tso\tyou\tknow\twhat\tyou\tshould\tbe\tmonitoring.\tMaybe\tit’s\tas\tsimple as\tknowing\twhere\tyour\taccounts\tservice\tis\tso\tthat\tthose\tmicroservices\tthat\tuse\tit\tknow where\tto\tfind\tit.\tOr\tperhaps\tyou\tjust\twant\tto\tmake\tit\teasy\tfor\tdevelopers\tin\tyour organization\tto\tknow\twhat\tAPIs\tare\tavailable\tso\tthey\tdon’t\treinvent\tthe\twheel.\tBroadly speaking,\tall\tof\tthese\tuse\tcases\tfall\tunder\tthe\tbanner\tof\tservice\tdiscovery.\tAnd\tas\talways with\tmicroservices,\twe\thave\tquite\ta\tfew\tdifferent\toptions\tat\tour\tdisposal\tfor\tdealing\twith it.\n\nAll\tof\tthe\tsolutions\twe’ll\tlook\tat\thandle\tthings\tin\ttwo\tparts.\tFirst,\tthey\tprovide\tsome mechanism\tfor\tan\tinstance\tto\tregister\titself\tand\tsay,\t“I’m\there!”\tSecond,\tthey\tprovide\ta way\tto\tfind\tthe\tservice\tonce\tit’s\tregistered.\tService\tdiscovery\tgets\tmore\tcomplicated, though,\twhen\twe\tare\tconsidering\tan\tenvironment\twhere\twe\tare\tconstantly\tdestroying\tand deploying\tnew\tinstances\tof\tservices.\tIdeally,\twe’d\twant\twhatever\tsolution\twe\tpick\tto\tcope with\tthis.\n\nLet’s\tlook\tat\tsome\tof\tthe\tmost\tcommon\tsolutions\tto\tservice\tdelivery\tand\tconsider\tour options.",
      "content_length": 1266,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 398,
      "content": "DNS\n\nIt’s\tnice\tto\tstart\tsimple.\tDNS\tlets\tus\tassociate\ta\tname\twith\tthe\tIP\taddress\tof\tone\tor\tmore machines.\tWe\tcould\tdecide,\tfor\texample,\tthat\tour\taccounts\tservice\tis\talways\tfound\tat accounts.musiccorp.com.\tWe\twould\tthen\thave\tthat\tentry\tpoint\tto\tthe\tIP\taddress\tof\tthe\thost running\tthat\tservice,\tor\tperhaps\thave\tit\tresolve\tto\ta\tload\tbalancer\tthat\tis\tdistributing\tload across\ta\tnumber\tof\tinstances.\tThis\tmeans\twe’d\thave\tto\thandle\tupdating\tthese\tentries\tas part\tof\tdeploying\tour\tservice.\n\nWhen\tdealing\twith\tinstances\tof\ta\tservice\tin\tdifferent\tenvironments,\tI\thave\tseen\ta convention-based\tdomain\ttemplate\twork\twell.\tFor\texample,\twe\tmight\thave\ta\ttemplate defined\tas\t<servicename>-<environment>.musiccorp.com,\tgiving\tus\tentries\tlike accounts-uat.musiccorp.com\tor\taccounts-dev.musiccorp.com.\n\nA\tmore\tadvanced\tway\tof\thandling\tdifferent\tenvironments\tis\tto\thave\tdifferent\tdomain name\tservers\tfor\tdifferent\tenvironments.\tSo\tI\tcould\tassume\tthat\taccounts.musiccorp.com is\twhere\tI\talways\tfind\tthe\taccounts\tservice,\tbut\tit\tcould\tresolve\tto\tdifferent\thosts depending\ton\twhere\tI\tdo\tthe\tlookup.\tIf\tyou\talready\thave\tyour\tenvironments\tsitting\tin different\tnetwork\tsegments\tand\tare\tcomfortable\twith\tmanaging\tyour\town\tDNS\tservers and\tentries,\tthis\tcould\tbe\tquite\ta\tneat\tsolution,\tbut\tit\tis\ta\tlot\tof\twork\tif\tyou\taren’t\tgetting other\tbenefits\tfrom\tthis\tsetup.\n\nDNS\thas\ta\thost\tof\tadvantages,\tthe\tmain\tone\tbeing\tit\tis\tsuch\ta\twell-understood\tand\twell- used\tstandard\tthat\talmost\tany\ttechnology\tstack\twill\tsupport\tit.\tUnfortunately,\twhile\ta number\tof\tservices\texist\tfor\tmanaging\tDNS\tinside\tan\torganization,\tfew\tof\tthem\tseem designed\tfor\tan\tenvironment\twhere\twe\tare\tdealing\twith\thighly\tdisposable\thosts,\tmaking updating\tDNS\tentries\tsomewhat\tpainful.\tAmazon’s\tRoute53\tservice\tdoes\ta\tpretty\tgood job\tof\tthis,\tbut\tI\thaven’t\tseen\ta\tself-hosted\toption\tthat\tis\tas\tgood\tyet,\talthough\t(as\twe’ll discuss\tshortly)\tConsul\tmay\thelp\tus\there.\tAside\tfrom\tthe\tproblems\tin\tupdating\tDNS entries,\tthe\tDNS\tspecification\titself\tcan\tcause\tus\tsome\tissues.\n\nDNS\tentries\tfor\tdomain\tnames\thave\ta\ttime\tto\tlive\t(TTL).\tThis\tis\thow\tlong\ta\tclient\tcan consider\tthe\tentry\tfresh.\tWhen\twe\twant\tto\tchange\tthe\thost\tto\twhich\tthe\tdomain\tname refers,\twe\tupdate\tthat\tentry,\tbut\twe\thave\tto\tassume\tthat\tclients\twill\tbe\tholding\ton\tto\tthe old\tIP\tfor\tat\tleast\tas\tlong\tas\tthe\tTTL\tstates.\tDNS\tentries\tcan\tget\tcached\tin\tmultiple\tplaces (even\tthe\tJVM\twill\tcache\tDNS\tentries\tunless\tyou\ttell\tit\tnot\tto),\tand\tthe\tmore\tplaces\tthey are\tcached\tin,\tthe\tmore\tstale\tthe\tentry\tcan\tbe.\n\nOne\tway\tto\twork\taround\tthis\tproblem\tis\tto\thave\tthe\tdomain\tname\tentry\tfor\tyour\tservice point\tto\ta\tload\tbalancer,\twhich\tin\tturn\tpoints\tto\tthe\tinstances\tof\tyour\tservice,\tas\tshown\tin Figure\t11-9.\tWhen\tyou\tdeploy\ta\tnew\tinstance,\tyou\tcan\ttake\tthe\told\tone\tout\tof\tthe\tload- balancer\tentry\tand\tadd\tthe\tnew\tone.\tSome\tpeople\tuse\tDNS\tround-robining,\twhere\tthe DNS\tentries\tthemselves\trefer\tto\ta\tgroup\tof\tmachines.\tThis\ttechnique\tis\textremely problematic,\tas\tthe\tclient\tis\thidden\tfrom\tthe\tunderlying\thost,\tand\ttherefore\tcannot\teasily",
      "content_length": 3013,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 399,
      "content": "stop\trouting\ttraffic\tto\tone\tof\tthe\thosts\tshould\tit\tbecome\tsick.\n\nFigure\t11-9.\tUsing\tDNS\tto\tresolve\tto\ta\tload\tbalancer\tto\tavoid\tstale\tDNS\tentries\n\nAs\tmentioned,\tDNS\tis\twell\tunderstood\tand\twidely\tsupported.\tBut\tit\tdoes\thave\tone\tor\ttwo downsides.\tI\twould\tsuggest\tinvestigating\twhether\tit\tis\ta\tgood\tfit\tfor\tyou\tbefore\tpicking something\tmore\tcomplex.\tFor\ta\tsituation\twhere\tyou\thave\tonly\tsingle\tnodes,\thaving\tDNS refer\tdirectly\tto\thosts\tis\tprobably\tfine.\tBut\tfor\tthose\tsituations\twhere\tyou\tneed\tmore\tthan one\tinstance\tof\ta\thost,\thave\tDNS\tentries\tresolve\tto\tload\tbalancers\tthat\tcan\thandle\tputting individual\thosts\tinto\tand\tout\tof\tservice\tas\tappropriate.",
      "content_length": 646,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 400,
      "content": "Dynamic\tService\tRegistries\n\nThe\tdownsides\tof\tDNS\tas\ta\tway\tof\tfinding\tnodes\tin\ta\thighly\tdynamic\tenvironment\thave led\tto\ta\tnumber\tof\talternative\tsystems,\tmost\tof\twhich\tinvolve\tthe\tservice\tregistering\titself with\tsome\tcentral\tregistry,\twhich\tin\tturn\toffers\tthe\tability\tto\tlook\tup\tthese\tservices\tlater on.\tOften,\tthese\tsystems\tdo\tmore\tthan\tjust\tproviding\tservice\tregistration\tand\tdiscovery, which\tmay\tor\tmay\tnot\tbe\ta\tgood\tthing.\tThis\tis\ta\tcrowded\tfield,\tso\twe’ll\tjust\tlook\tat\ta\tfew options\tto\tgive\tyou\ta\tsense\tof\twhat\tis\tavailable.",
      "content_length": 527,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 401,
      "content": "Zookeeper\n\nZookeeper\twas\toriginally\tdeveloped\tas\tpart\tof\tthe\tHadoop\tproject.\tIt\tis\tused\tfor\tan\talmost bewildering\tarray\tof\tuse\tcases,\tincluding\tconfiguration\tmanagement,\tsynchronizing\tdata between\tservices,\tleader\telection,\tmessage\tqueues,\tand\t(usefully\tfor\tus)\tas\ta\tnaming service.\n\nLike\tmany\tsimilar\ttypes\tof\tsystems,\tZookeeper\trelies\ton\trunning\ta\tnumber\tof\tnodes\tin\ta cluster\tto\tprovide\tvarious\tguarantees.\tThis\tmeans\tyou\tshould\texpect\tto\tbe\trunning\tat\tleast three\tZookeeper\tnodes.\tMost\tof\tthe\tsmarts\tin\tZookeeper\tare\taround\tensuring\tthat\tdata\tis replicated\tsafely\tbetween\tthese\tnodes,\tand\tthat\tthings\tremain\tconsistent\twhen\tnodes\tfail.\n\nAt\tits\theart,\tZookeeper\tprovides\ta\thierarchical\tnamespace\tfor\tstoring\tinformation.\tClients can\tinsert\tnew\tnodes\tin\tthis\thierarchy,\tchange\tthem,\tor\tquery\tthem.\tFurthermore,\tthey\tcan add\twatches\tto\tnodes\tto\tbe\ttold\twhen\tthey\tchange.\tThis\tmeans\twe\tcould\tstore\tthe information\tabout\twhere\tour\tservices\tare\tlocated\tin\tthis\tstructure,\tand\tas\ta\tclient\tbe\ttold when\tthey\tchange.\tZookeeper\tis\toften\tused\tas\ta\tgeneral\tconfiguration\tstore,\tso\tyou\tcould also\tstore\tservice-specific\tconfiguration\tin\tit,\tallowing\tyou\tto\tdo\ttasks\tlike\tdynamically changing\tlog\tlevels\tor\tturning\toff\tfeatures\tof\ta\trunning\tsystem.\tPersonally,\tI\ttend\tto\tshy away\tfrom\tthe\tuse\tof\tsystems\tlike\tZookeeper\tas\ta\tconfiguration\tsource,\tas\tI\tthink\tit\tcan make\tit\tharder\tto\treason\tabout\tthe\tbehavior\tof\ta\tgiven\tservice.\n\nZookeeper\titself\tis\tfairly\tgeneric\tin\twhat\tit\toffers,\twhich\tis\twhy\tit\tis\tused\tfor\tso\tmany\tuse cases.\tYou\tcan\tthink\tof\tit\tjust\tas\ta\treplicated\ttree\tof\tinformation\tthat\tyou\tcan\tbe\talerted about\twhen\tit\tchanges.\tThis\tmeans\tthat\tyou’ll\ttypically\tbuild\tthings\ton\ttop\tof\tit\tto\tsuit your\tparticular\tuse\tcase.\tLuckily,\tclient\tlibraries\texist\tfor\tmost\tlanguages\tout\tthere.\n\nIn\tthe\tgrand\tscheme\tof\tthings,\tZookeeper\tcould\tbe\tconsidered\told\tby\tnow,\tand\tdoesn’t provide\tus\tthat\tmuch\tfunctionality\tout\tof\tthe\tbox\tto\thelp\twith\tservice\tdiscovery\tcompared to\tsome\tof\tthe\tnewer\talternatives.\tThat\tsaid,\tit\tis\tcertainly\ttried\tand\ttested,\tand\twidely used.\tThe\tunderlying\talgorithms\tZookeeper\timplements\tare\tquite\thard\tto\tget\tright.\tI\tknow one\tdatabase\tvendor,\tfor\texample,\tthat\twas\tusing\tZookeeper\tjust\tfor\tleader\telection\tin order\tto\tensure\tthat\ta\tprimary\tnode\tgot\tproperly\tpromoted\tduring\tfailure\tconditions.\tThe client\tfelt\tthat\tZookeeper\twas\ttoo\theavyweight\tand\tspent\ta\tlong\ttime\tironing\tout\tbugs\tin its\town\timplementation\tof\tthe\tPAXOS\talgorithm\tto\treplace\twhat\tZookeeper\tdid.\tPeople often\tsay\tyou\tshouldn’t\twrite\tyour\town\tcryptography\tlibraries.\tI’d\textend\tthat\tby\tsaying you\tshouldn’t\twrite\tyour\town\tdistributed\tcoordination\tsystems\teither.\tThere\tis\ta\tlot\tto\tbe said\tfor\tusing\texisting\tstuff\tthat\tjust\tworks.",
      "content_length": 2714,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 402,
      "content": "Consul\n\nLike\tZookeeper,\tConsul\tsupports\tboth\tconfiguration\tmanagement\tand\tservice\tdiscovery. But\tit\tgoes\tfurther\tthan\tZookeeper\tin\tproviding\tmore\tsupport\tfor\tthese\tkey\tuse\tcases.\tFor example,\tit\texposes\tan\tHTTP\tinterface\tfor\tservice\tdiscovery,\tand\tone\tof\tConsul’s\tkiller features\tis\tthat\tit\tactually\tprovides\ta\tDNS\tserver\tout\tof\tthe\tbox;\tspecifically,\tit\tcan\tserve SRV\trecords,\twhich\tgive\tyou\tboth\tan\tIP\tand\tport\tfor\ta\tgiven\tname.\tThis\tmeans\tif\tpart\tof your\tsystem\tuses\tDNS\talready\tand\tcan\tsupport\tSRV\trecords,\tyou\tcan\tjust\tdrop\tin\tConsul and\tstart\tusing\tit\twithout\tany\tchanges\tto\tyour\texisting\tsystem.\n\nConsul\talso\tbuilds\tin\tother\tcapabilities\tthat\tyou\tmight\tfind\tuseful,\tsuch\tas\tthe\tability\tto perform\thealth\tchecks\ton\tnodes.\tThis\tmeans\tthat\tConsul\tcould\twell\toverlap\tthe capabilities\tprovided\tby\tother\tdedicated\tmonitoring\ttools,\talthough\tyou\twould\tmore\tlikely use\tConsul\tas\ta\tsource\tof\tthis\tinformation\tand\tthen\tpull\tit\tinto\ta\tmore\tcomprehensive dashboard\tor\talerting\tsystem.\tConsul’s\thighly\tfault-tolerant\tdesign\tand\tfocus\ton\thandling systems\tthat\tmake\theavy\tuse\tof\tephemeral\tnodes\tdoes\tmake\tme\twonder,\tthough,\tif\tit\tmay end\tup\treplacing\tsystems\tlike\tNagios\tand\tSensu\tfor\tsome\tuse\tcases.\n\nConsul\tuses\ta\tRESTful\tHTTP\tinterface\tfor\teverything\tfrom\tregistering\ta\tservice,\tquerying the\tkey/value\tstore,\tor\tinserting\thealth\tchecks.\tThis\tmakes\tintegration\twith\tdifferent technology\tstacks\tvery\tstraightforward.\tOne\tof\tthe\tother\tthings\tI\treally\tlike\tabout\tConsul is\tthat\tthe\tteam\tbehind\tit\thas\tsplit\tout\tthe\tunderlying\tcluster\tmanagement\tpiece.\tSerf, which\tConsul\tsits\ton\ttop\tof,\thandles\tdetection\tof\tnodes\tin\ta\tcluster,\tfailure\tmanagement, and\talerting.\tConsul\tthen\tadds\tservice\tdiscovery\tand\tconfiguration\tmanagement.\tThis separation\tof\tconcerns\tappeals\tto\tme,\twhich\tshould\tbe\tno\tsurprise\tto\tyou\tgiven\tthe\tthemes that\trun\tthrough\tthis\tbook!\n\nConsul\tis\tvery\tnew,\tand\tgiven\tthe\tcomplexity\tof\tthe\talgorithms\tit\tuses,\tthis\twould normally\tmake\tme\thesitant\tin\trecommending\tit\tfor\tsuch\tan\timportant\tjob.\tThat\tsaid, Hashicorp,\tthe\tteam\tbehind\tit,\tcertainly\thas\ta\tgreat\ttrack\trecord\tin\tcreating\tvery\tuseful open\tsource\ttechnology\t(in\tthe\tform\tof\tboth\tPacker\tand\tVagrant),\tthe\tproject\tis\tbeing actively\tdeveloped,\tand\tI’ve\tspoken\tto\ta\tfew\tpeople\twho\tare\thappily\tusing\tit\tin production.\tGiven\tthat,\tI\tthink\tit\tis\twell\tworth\ta\tlook.",
      "content_length": 2320,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 403,
      "content": "Eureka\n\nNetflix’s\topen\tsource\tEureka\tsystem\tbucks\tthe\ttrend\tof\tsystems\tlike\tConsul\tand Zookeeper\tin\tthat\tit\tdoesn’t\talso\ttry\tto\tbe\ta\tgeneral-purpose\tconfiguration\tstore.\tIt\tis actually\tvery\ttargeted\tin\tits\tuse\tcase.\n\nEureka\talso\tprovides\tbasic\tload-balancing\tcapabilities\tin\tthat\tit\tcan\tsupport\tbasic\tround- robin\tlookup\tof\tservice\tinstances.\tIt\tprovides\ta\tREST-based\tendpoint\tso\tyou\tcan\twrite your\town\tclients,\tor\tyou\tcan\tuse\tits\town\tJava\tclient.\tThe\tJava\tclient\tprovides\tadditional capabilities,\tsuch\tas\thealth\tchecking\tof\tinstances.\tObviously\tif\tyou\tbypass\tEureka’s\town client\tand\tgo\tdirectly\tto\tthe\tREST\tendpoint,\tyou’re\ton\tyour\town\tthere.\n\nBy\thaving\tthe\tclients\tdeal\twith\tservice\tdiscovery\tdirectly,\twe\tavoid\tthe\tneed\tfor\ta\tseparate process.\tHowever,\tyou\tdo\trequire\tthat\tevery\tclient\timplement\tservice\tdiscovery.\tNetflix, which\tstandardizes\ton\tthe\tJVM,\tachieves\tthis\tby\thaving\tall\tclients\tuse\tEureka.\tIf\tyou’re\tin a\tmore\tpolyglot\tenvironment,\tthis\tmay\tbe\tmore\tof\ta\tchallenge.",
      "content_length": 980,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 404,
      "content": "Rolling\tYour\tOwn\n\nOne\tapproach\tI\thave\tused\tmyself\tand\tseen\tdone\telsewhere\tis\tto\troll\tyour\town\tsystem.\tOn one\tproject\twe\twere\tmaking\theavy\tuse\tof\tAWS,\twhich\toffers\tthe\tability\tto\tadd\ttags\tto instances.\tWhen\tlaunching\tservice\tinstances,\tI\twould\tapply\ttags\tto\thelp\tdefine\twhat\tthe instance\twas\tand\twhat\tit\twas\tused\tfor.\tThese\tallowed\tfor\tsome\trich\tmetadata\tto\tbe associated\twith\ta\tgiven\thost,\tfor\texample:\n\nservice\t=\taccounts\n\nenvironment\t=\tproduction\n\nversion\t=\t154\n\nI\tcould\tthen\tuse\tthe\tAWS\tAPIs\tto\tquery\tall\tthe\tinstances\tassociated\twith\ta\tgiven\tAWS account\tto\tfind\tmachines\tI\tcared\tabout.\tHere,\tAWS\titself\tis\thandling\tthe\tstoring\tof\tthe metadata\tassociated\twith\teach\tinstance,\tand\tproviding\tus\twith\tthe\tability\tto\tquery\tit.\tI\tthen built\tcommand-line\ttools\tfor\tinteracting\twith\tthese\tinstances,\tand\tmaking\tdashboards\tfor status\tmonitoring\tbecomes\tfairly\teasy,\tespecially\tif\tyou\tadopt\tthe\tidea\tof\thaving\teach service\tinstance\texposing\thealth\tcheck\tdetails.\n\nThe\tlast\ttime\tI\tdid\tthis\twe\tdidn’t\tgo\tas\tfar\tas\thaving\tservices\tuse\tthe\tAWS\tAPIs\tto\tfind their\tservice\tdependencies,\tbut\tthere\tis\tno\treason\twhy\tyou\tcouldn’t.\tObviously,\tif\tyou want\tupstream\tservices\tto\tbe\talerted\twhen\tthe\tlocation\tof\ta\tdownstream\tservice\tchanges, you’re\ton\tyour\town.",
      "content_length": 1240,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 405,
      "content": "Don’t\tForget\tthe\tHumans!\n\nThe\tsystems\twe’ve\tlooked\tat\tso\tfar\tmake\tit\teasy\tfor\ta\tservice\tinstance\tto\tregister\titself\tand look\tup\tother\tservices\tit\tneeds\tto\ttalk\tto.\tBut\tas\thumans\twe\tsometimes\twant\tthis information\ttoo.\tWhatever\tsystem\tyou\tpick,\tmake\tsure\tyou\thave\ttools\tavailable\tthat\tlet you\tbuild\treports\tand\tdashboards\ton\ttop\tof\tthese\tregistries\tto\tcreate\tdisplays\tfor\thumans, not\tjust\tfor\tcomputers.",
      "content_length": 402,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 406,
      "content": "Documenting\tServices\n\nBy\tdecomposing\tour\tsystems\tinto\tfiner-grained\tmicroservices,\twe’re\thoping\tto\texpose\tlots of\tseams\tin\tthe\tform\tof\tAPIs\tthat\tpeople\tcan\tuse\tto\tdo\tmany,\thopefully\twonderful,\tthings. If\tyou\tget\tyour\tdiscovery\tright,\twe\tknow\twhere\tthings\tare.\tBut\thow\tdo\twe\tknow\twhat those\tthings\tdo,\tor\thow\tto\tuse\tthem?\tOne\toption\tis\tobviously\tto\thave\tdocumentation\tabout the\tAPIs.\tOf\tcourse,\tdocumentation\tcan\toften\tbe\tout\tof\tdate.\tIdeally,\twe’d\tensure\tthat\tour documentation\tis\talways\tup\tto\tdate\twith\tthe\tmicroservice\tAPI,\tand\tmake\tit\teasy\tto\tsee\tthis documentation\twhen\twe\tknow\twhere\ta\tservice\tendpoint\tis.\tTwo\tdifferent\tpieces\tof technology,\tSwagger\tand\tHAL,\ttry\tto\tmake\tthis\ta\treality,\tand\tboth\tare\tworth\tlooking\tat.",
      "content_length": 722,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 407,
      "content": "Swagger\n\nSwagger\tlets\tyou\tdescribe\tyour\tAPI\tin\torder\tto\tgenerate\ta\tvery\tnice\tweb\tUI\tthat\tallows you\tto\tview\tthe\tdocumentation\tand\tinteract\twith\tthe\tAPI\tvia\ta\tweb\tbrowser.\tThe\tability\tto execute\trequests\tis\tvery\tnice:\tyou\tcan\tdefine\tPOST\ttemplates,\tfor\texample,\tmaking\tit clear\twhat\tsort\tof\tcontent\tthe\tserver\texpects.\n\nTo\tdo\tall\tof\tthis,\tSwagger\tneeds\tthe\tservice\tto\texpose\ta\tsidecar\tfile\tmatching\tthe\tSwagger format.\tSwagger\thas\ta\tnumber\tof\tlibraries\tfor\tdifferent\tlanguages\tthat\tdoes\tthis\tfor\tyou. For\texample,\tfor\tJava\tyou\tcan\tannotate\tmethods\tthat\tmatch\tyour\tAPI\tcalls,\tand\tthe\tfile gets\tgenerated\tfor\tyou.\n\nI\tlike\tthe\tend-user\texperience\tthat\tSwagger\tgives\tyou,\tbut\tit\tdoes\tlittle\tfor\tthe\tincremental exploration\tconcept\tat\tthe\theart\tof\thypermedia.\tStill,\tit’s\ta\tpretty\tnice\tway\tto\texpose documentation\tabout\tyour\tservices.",
      "content_length": 828,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 408,
      "content": "HAL\tand\tthe\tHAL\tBrowser\n\nBy\titself,\tthe\tHypertext\tApplication\tLanguage\t(HAL)\tis\ta\tstandard\tthat\tdescribes standards\tfor\thypermedia\tcontrols\tthat\twe\texpose.\tAs\twe\tcovered\tin\tChapter\t4, hypermedia\tcontrols\tare\tthe\tmeans\tby\twhich\twe\tallow\tclients\tto\tprogressively\texplore\tour APIs\tto\tuse\tour\tservice’s\tcapabilities\tin\ta\tless\tcoupled\tfashion\tthan\tother\tintegration techniques.\tIf\tyou\tdecide\tto\tadopt\tHAL’s\thypermedia\tstandard,\tthen\tnot\tonly\tcan\tyou make\tuse\tof\ta\twide\tnumber\tof\tclient\tlibraries\tfor\tconsuming\tthe\tAPI\t(at\tthe\ttime\tof writing,\tthe\tHAL\twiki\tlisted\t50\tsupporting\tlibraries\tfor\ta\tnumber\tof\tdifferent\tlanguages), but\tyou\tcan\talso\tmake\tuse\tof\tthe\tHAL\tbrowser,\twhich\tgives\tyou\ta\tway\tto\texplore\tthe\tAPI via\ta\tweb\tbrowser.\n\nLike\tSwagger,\tthis\tUI\tcan\tbe\tused\tnot\tonly\tto\tact\tas\tliving\tdocumentation,\tbut\talso\tto execute\tcalls\tagainst\tthe\tservice\titself.\tExecuting\tcalls\tisn’t\tquite\tas\tslick,\tthough. Whereas\twith\tSwagger\tyou\tcan\tdefine\ttemplates\tto\tdo\tthings\tlike\tissue\ta\tPOST\trequest, with\tHAL\tyou’re\tmore\ton\tyour\town.\tThe\tflipside\tto\tthis\tis\tthat\tthe\tinherent\tpower\tof hypermedia\tcontrols\tlets\tyou\tmuch\tmore\teffectively\texplore\tthe\tAPI\texposed\tby\tthe service,\tas\tyou\tcan\tfollow\tlinks\taround\tvery\teasily.\tIt\tturns\tout\tthat\tweb\tbrowsers\tare pretty\tgood\tat\tthat\tsort\tof\tthing!\n\nUnlike\twith\tSwagger,\tall\tthe\tinformation\tneeded\tto\tdrive\tthis\tdocumentation\tand\tsandbox is\tembedded\tin\tthe\thypermedia\tcontrols.\tThis\tis\ta\tdouble-edged\tsword.\tIf\tyou\tare\talready using\thypermedia\tcontrols,\tit\ttakes\tlittle\teffort\tto\texpose\ta\tHAL\tbrowser\tand\thave\tclients explore\tyour\tAPI.\tHowever,\tif\tyou\taren’t\tusing\thypermedia,\tyou\teither\tcan’t\tuse\tHAL\tor have\tto\tretrofit\tyour\tAPI\tto\tuse\thypermedia,\twhich\tis\tlikely\tto\tbe\tan\texercise\tthat\tbreaks existing\tconsumers.\n\nThe\tfact\tthat\tHAL\talso\tdescribes\ta\thypermedia\tstandard\twith\tsome\tsupporting\tclient libraries\tis\tan\tadded\tbonus,\tand\tI\tsuspect\tis\ta\tbig\treason\twhy\tI’ve\tseen\tmore\tuptake\tof HAL\tas\ta\tway\tof\tdocumenting\tAPIs\tthan\tSwagger\tfor\tthose\tpeople\talready\tusing hypermedia\tcontrols.\tIf\tyou’re\tusing\thypermedia,\tmy\trecommendation\tis\tto\tgo\twith\tHAL over\tSwagger.\tBut\tif\tyou’re\tusing\thypermedia\tand\tcan’t\tjustify\tthe\tswitch,\tI’d\tdefinitely suggest\tgiving\tSwagger\ta\tgo.",
      "content_length": 2197,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 409,
      "content": "The\tSelf-Describing\tSystem\n\nDuring\tthe\tearly\tevolution\tof\tSOA,\tstandards\tlike\tUniversal\tDescription,\tDiscovery,\tand Integration\t(UDDI)\temerged\tto\thelp\tpeople\tmake\tsense\tof\twhat\tservices\twere\trunning. These\tapproaches\twere\tfairly\theavyweight,\twhich\tled\tto\talternative\ttechniques\tto\ttry\tto make\tsense\tof\tour\tsystems.\tMartin\tFowler\tdiscussed\tthe\tconcept\tof\tthe\thumane\tregistry, where\ta\tmuch\tmore\tlightweight\tapproach\tis\tsimply\tto\thave\ta\tplace\twhere\thumans\tcan record\tinformation\tabout\tthe\tservices\tin\tthe\torganization\tin\tsomething\tas\tbasic\tas\ta\twiki.\n\nGetting\ta\tpicture\tof\tour\tsystem\tand\thow\tit\tis\tbehaving\tis\timportant,\tespecially\twhen\twe’re at\tscale.\tWe’ve\tcovered\ta\tnumber\tof\tdifferent\ttechniques\tthat\twill\thelp\tus\tgain understanding\tdirectly\tfrom\tour\tsystem.\tBy\ttracking\tthe\thealth\tof\tour\tdownstream services\ttogether\twith\tcorrelation\tIDs\tto\thelp\tus\tsee\tcall\tchains,\twe\tcan\tget\treal\tdata\tin terms\tof\thow\tour\tservices\tinterrelate.\tUsing\tservice\tdiscovery\tsystems\tlike\tConsul,\twe\tcan see\twhere\tour\tmicroservices\tare\trunning.\tHAL\tlets\tus\tsee\twhat\tcapabilities\tare\tbeing hosted\ton\tany\tgiven\tendpoint,\twhile\tour\thealth-check\tpages\tand\tmonitoring\tsystems\tlet\tus know\tthe\thealth\tof\tboth\tthe\toverall\tsystem\tand\tindividual\tservices.\n\nAll\tof\tthis\tinformation\tis\tavailable\tprogramatically.\tAll\tof\tthis\tdata\tallows\tus\tto\tmake\tour humane\tregistry\tmore\tpowerful\tthan\ta\tsimple\twiki\tpage\tthat\twill\tno\tdoubt\tget\tout\tof\tdate. Instead,\twe\tshould\tuse\tit\tto\tharness\tand\tdisplay\tall\tthe\tinformation\tour\tsystem\twill\tbe emitting.\tBy\tcreating\tcustom\tdashboards,\twe\tcan\tpull\ttogether\tthe\tvast\tarray\tof information\tthat\tis\tavailable\tto\thelp\tus\tmake\tsense\tof\tour\tecosystem.\n\nBy\tall\tmeans,\tstart\twith\tsomething\tas\tsimple\tas\ta\tstatic\tweb\tpage\tor\twiki\tthat\tperhaps scrapes\tin\ta\tbit\tof\tdata\tfrom\tthe\tlive\tsystem.\tBut\tlook\tto\tpull\tin\tmore\tand\tmore information\tover\ttime.\tMaking\tthis\tinformation\treadily\tavailable\tis\ta\tkey\ttool\tto\tmanaging the\temerging\tcomplexity\tthat\twill\tcome\tfrom\trunning\tthese\tsystems\tat\tscale.",
      "content_length": 1982,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 410,
      "content": "Summary\n\nAs\ta\tdesign\tapproach,\tmicroservices\tare\tstill\tfairly\tyoung,\tso\talthough\twe\thave\tsome notable\texperiences\tto\tdraw\tupon,\tI’m\tsure\tthe\tnext\tfew\tyears\twill\tyield\tmore\tuseful patterns\tin\thandling\tthem\tat\tscale.\tNonetheless,\tI\thope\tthis\tchapter\thas\toutlined\tsome steps\tyou\tcan\ttake\ton\tyour\tjourney\tto\tmicroservices\tat\tscale\tthat\twill\thold\tyou\tin\tgood stead.\n\nIn\taddition\tto\twhat\tI\thave\tcovered\there,\tI\trecommend\tMichael\tNygard’s\texcellent\tbook Release\tIt!.\tIn\tit\the\tshares\ta\tcollection\tof\tstories\tabout\tsystem\tfailure\tand\tsome\tpatterns\tto help\tdeal\twith\tit\twell.\tThe\tbook\tis\twell\tworth\ta\tread\t(in\tfact,\tI\twould\tgo\tso\tfar\tas\tto\tsay\tit should\tbe\tconsidered\tessential\treading\tfor\tanyone\tbuilding\tsystems\tat\tscale).\n\nWe’ve\tcovered\tquite\ta\tlot\tof\tground,\tand\twe’re\tnearing\tthe\tend.\tIn\tour\tnext\tand\tfinal chapter,\twe\twill\tlook\tto\tpull\teverything\tback\ttogether\tand\tsummarize\twhat\twe\thave learned\tin\tthe\tbook\toverall.",
      "content_length": 912,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 411,
      "content": "Chapter\t12.\tBringing\tIt\tAll\tTogether\n\nWe’ve\tcovered\ta\tfair\tamount\tin\tthe\tprevious\tchapters,\tfrom\twhat\tmicroservices\tare\tto\thow to\tdefine\ttheir\tboundaries,\tand\tfrom\tintegration\ttechnology\tto\tconcerns\tabout\tsecurity\tand monitoring.\tAnd\twe\teven\tfound\ttime\tto\twork\tout\thow\tthe\trole\tof\tthe\tarchitect\tfits\tin. There\tis\ta\tlot\tto\ttake\tin,\tas\talthough\tmicroservices\tthemselves\tmay\tbe\tsmall,\tthe\tbreadth and\timpact\tof\ttheir\tarchitecture\tare\tnot.\tSo\there\tI’ll\ttry\tto\tsummarize\tsome\tof\tthe\tkey points\tcovered\tthroughout\tthe\tbook.",
      "content_length": 517,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 412,
      "content": "Principles\tof\tMicroservices\n\nWe\tdiscussed\tthe\trole\tthat\tprinciples\tcan\tplay\tin\tChapter\t2.\tThey\tare\tstatements\tabout\thow things\tshould\tbe\tdone,\tand\twhy\twe\tthink\tthey\tshould\tbe\tdone\tthat\tway.\tThey\thelp\tus frame\tthe\tvarious\tdecisions\twe\thave\tto\tmake\twhen\tbuilding\tour\tsystems.\tYou\tshould absolutely\tdefine\tyour\town\tprinciples,\tbut\tI\tthought\tit\tworth\tspelling\tout\twhat\tI\tsee\tas being\tthe\tkey\tprinciples\tfor\tmicroservice\tarchitectures,\twhich\tyou\tcan\tsee\tsummarized\tin Figure\t12-1.\tThese\tare\tthe\tprinciples\tthat\twill\thelp\tus\tcreate\tsmall\tautonomous\tservices that\twork\twell\ttogether.\tWe’ve\talready\tcovered\teverything\there\tat\tleast\tonce\tso\tfar,\tso nothing\tshould\tbe\tnew,\tbut\tthere\tis\tvalue\tin\tdistilling\tit\tdown\tto\tits\tcore\tessence.\n\nYou\tcan\tchoose\tto\tadopt\tthese\tprinciples\twholesale,\tor\tperhaps\ttweak\tthem\tto\tmake\tsense in\tyour\town\torganization.\tBut\tnote\tthe\tvalue\tthat\tcomes\tfrom\tusing\tthem\tin\tcombination: the\twhole\tshould\tbe\tgreater\tthan\tthe\tsum\tof\tthe\tparts.\tSo\tif\tyou\tdecide\tto\tdrop\tone\tof them,\tmake\tsure\tyou\tunderstand\twhat\tyou’ll\tbe\tmissing.\n\nFor\teach\tof\tthese\tprinciples,\tI’ve\ttried\tto\tpull\tout\tsome\tof\tthe\tsupporting\tpractices\tthat\twe have\tcovered\tin\tthe\tbook.\tAs\tthe\tsaying\tgoes,\tthere\tis\tmore\tthan\tone\tway\tto\tskin\ta\tcat: you\tmight\tfind\tyour\town\tpractices\tto\thelp\tdeliver\ton\tthese\tprinciples,\tbut\tthis\tshould\tget you\tstarted.\n\nFigure\t12-1.\tPrinciples\tof\tmicroservices",
      "content_length": 1372,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 413,
      "content": "Model\tAround\tBusiness\tConcepts\n\nExperience\thas\tshown\tus\tthat\tinterfaces\tstructured\taround\tbusiness-bounded\tcontexts\tare more\tstable\tthan\tthose\tstructured\taround\ttechnical\tconcepts.\tBy\tmodeling\tthe\tdomain\tin which\tour\tsystem\toperates,\tnot\tonly\tdo\twe\tattempt\tto\tform\tmore\tstable\tinterfaces,\tbut\twe also\tensure\tthat\twe\tare\tbetter\table\tto\treflect\tchanges\tin\tbusiness\tprocesses\teasily.\tUse bounded\tcontexts\tto\tdefine\tpotential\tdomain\tboundaries.",
      "content_length": 440,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 414,
      "content": "Adopt\ta\tCulture\tof\tAutomation\n\nMicroservices\tadd\ta\tlot\tof\tcomplexity,\ta\tkey\tpart\tof\twhich\tcomes\tfrom\tthe\tsheer\tnumber of\tmoving\tparts\twe\thave\tto\tdeal\twith.\tEmbracing\ta\tculture\tof\tautomation\tis\tone\tkey\tway to\taddress\tthis,\tand\tfront-loading\teffort\tto\tcreate\tthe\ttooling\tto\tsupport\tmicroservices\tcan make\ta\tlot\tof\tsense.\tAutomated\ttesting\tis\tessential,\tas\tensuring\tour\tservices\tstill\twork\tis\ta more\tcomplex\tprocess\tthan\twith\tmonolithic\tsystems.\tHaving\ta\tuniform\tcommand-line\tcall to\tdeploy\tthe\tsame\tway\teverywhere\tcan\thelp,\tand\tthis\tcan\tbe\ta\tkey\tpart\tof\tadopting continuous\tdelivery\tto\tgive\tus\tfast\tfeedback\ton\tthe\tproduction\tquality\tof\teach\tcheck-in.\n\nConsider\tusing\tenvironment\tdefinitions\tto\thelp\tyou\tspecify\tthe\tdifferences\tfrom\tone environment\tto\tanother,\twithout\tsacrificing\tthe\tability\tto\tuse\ta\tuniform\tdeployment method.\tThink\tabout\tcreating\tcustom\timages\tto\tspeed\tup\tdeployment,\tand\tembracing\tthe creation\tof\tfully\tautomated\timmutable\tservers\tto\tmake\tit\teasier\tto\treason\tabout\tyour systems.",
      "content_length": 997,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 415,
      "content": "Hide\tInternal\tImplementation\tDetails\n\nTo\tmaximize\tthe\tability\tof\tone\tservice\tto\tevolve\tindependently\tof\tany\tothers,\tit\tis\tvital that\twe\thide\timplementation\tdetails.\tModeling\tbounded\tcontexts\tcan\thelp,\tas\tthis\thelps\tus focus\ton\tthose\tmodels\tthat\tshould\tbe\tshared,\tand\tthose\tthat\tshould\tbe\thidden.\tServices should\talso\thide\ttheir\tdatabases\tto\tavoid\tfalling\tinto\tone\tof\tthe\tmost\tcommon\tsorts\tof coupling\tthat\tcan\tappear\tin\ttraditional\tservice-oriented\tarchitectures,\tand\tuse\tdata\tpumps or\tevent\tdata\tpumps\tto\tconsolidate\tdata\tacross\tmultiple\tservices\tfor\treporting\tpurposes.\n\nWhere\tpossible,\tpick\ttechnology-agnostic\tAPIs\tto\tgive\tyou\tfreedom\tto\tuse\tdifferent technology\tstacks.\tConsider\tusing\tREST,\twhich\tformalizes\tthe\tseparation\tof\tinternal\tand external\timplementation\tdetails,\talthough\teven\tif\tusing\tremote\tprocedure\tcalls\t(RPCs), you\tcan\tstill\tembrace\tthese\tideas.",
      "content_length": 865,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 416,
      "content": "Decentralize\tAll\tthe\tThings\n\nTo\tmaximize\tthe\tautonomy\tthat\tmicroservices\tmake\tpossible,\twe\tneed\tto\tconstantly\tbe looking\tfor\tthe\tchance\tto\tdelegate\tdecision\tmaking\tand\tcontrol\tto\tthe\tteams\tthat\town\tthe services\tthemselves.\tThis\tprocess\tstarts\twith\tembracing\tself-service\twherever\tpossible, allowing\tpeople\tto\tdeploy\tsoftware\ton\tdemand,\tmaking\tdevelopment\tand\ttesting\tas\teasy as\tpossible,\tand\tavoiding\tthe\tneed\tfor\tseparate\tteams\tto\tperform\tthese\tactivities.\n\nEnsuring\tthat\tteams\town\ttheir\tservices\tis\tan\timportant\tstep\ton\tthis\tjourney,\tmaking\tteams responsible\tfor\tthe\tchanges\tthat\tare\tmade,\tideally\teven\thaving\tthem\tdecide\twhen\tto release\tthose\tchanges.\tMaking\tuse\tof\tinternal\topen\tsource\tensures\tthat\tpeople\tcan\tmake changes\ton\tservices\towned\tby\tother\tteams,\talthough\tremember\tthat\tthis\trequires\twork\tto implement.\tAlign\tteams\tto\tthe\torganization\tto\tensure\tthat\tConway’s\tlaw\tworks\tfor\tyou, and\thelp\tyour\tteam\tbecome\tdomain\texperts\tin\tthe\tbusiness-focused\tservices\tthey\tare creating.\tWhere\tsome\toverarching\tguidance\tis\tneeded,\ttry\tto\tembrace\ta\tshared governance\tmodel\twhere\tpeople\tfrom\teach\tteam\tcollectively\tshare\tresponsibility\tfor evolving\tthe\ttechnical\tvision\tof\tthe\tsystem.\n\nThis\tprinciple\tcan\tapply\tto\tarchitecture\ttoo.\tAvoid\tapproaches\tlike\tenterprise\tservice\tbus or\torchestration\tsystems,\twhich\tcan\tlead\tto\tcentralization\tof\tbusiness\tlogic\tand\tdumb services.\tInstead,\tprefer\tchoreography\tover\torchestration\tand\tdumb\tmiddleware,\twith smart\tendpoints\tto\tensure\tthat\tyou\tkeep\tassociated\tlogic\tand\tdata\twithin\tservice boundaries,\thelping\tkeep\tthings\tcohesive.",
      "content_length": 1564,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 417,
      "content": "Independently\tDeployable\n\nWe\tshould\talways\tstrive\tto\tensure\tthat\tour\tmicroservices\tcan\tand\tare\tdeployed\tby themselves.\tEven\twhen\tbreaking\tchanges\tare\trequired,\twe\tshould\tseek\tto\tcoexist versioned\tendpoints\tto\tallow\tour\tconsumers\tto\tchange\tover\ttime.\tThis\tallows\tus\tto optimize\tfor\tspeed\tof\trelease\tof\tnew\tfeatures,\tas\twell\tas\tincreasing\tthe\tautonomy\tof\tthe teams\towning\tthese\tmicroservices\tby\tensuring\tthat\tthey\tdon’t\thave\tto\tconstantly orchestrate\ttheir\tdeployments.\tWhen\tusing\tRPC-based\tintegration,\tavoid\ttightly\tbound client/server\tstub\tgeneration\tsuch\tas\tthat\tpromoted\tby\tJava\tRMI.\n\nBy\tadopting\ta\tone-service-per-host\tmodel,\tyou\treduce\tside\teffects\tthat\tcould\tcause deploying\tone\tservice\tto\timpact\tanother\tunrelated\tservice.\tConsider\tusing\tblue/green\tor canary\trelease\ttechniques\tto\tseparate\tdeployment\tfrom\trelease,\treducing\tthe\trisk\tof\ta release\tgoing\twrong.\tUse\tconsumer-driven\tcontracts\tto\tcatch\tbreaking\tchanges\tbefore they\thappen.\n\nRemember\tthat\tit\tshould\tbe\tthe\tnorm,\tnot\tthe\texception,\tthat\tyou\tcan\tmake\ta\tchange\tto\ta single\tservice\tand\trelease\tit\tinto\tproduction,\twithout\thaving\tto\tdeploy\tany\tother\tservices in\tlock-step.\tYour\tconsumers\tshould\tdecide\twhen\tthey\tupdate\tthemselves,\tand\tyou\tneed\tto accommodate\tthis.",
      "content_length": 1227,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 418,
      "content": "Isolate\tFailure\n\nA\tmicroservice\tarchitecture\tcan\tbe\tmore\tresilient\tthan\ta\tmonolithic\tsystem,\tbut\tonly\tif\twe understand\tand\tplan\tfor\tfailures\tin\tpart\tof\tour\tsystem.\tIf\twe\tdon’t\taccount\tfor\tthe\tfact\tthat a\tdownstream\tcall\tcan\tand\twill\tfail,\tour\tsystems\tmight\tsuffer\tcatastrophic\tcascading failure,\tand\twe\tcould\tfind\tourselves\twith\ta\tsystem\tthat\tis\tmuch\tmore\tfragile\tthan\tbefore.\n\nWhen\tusing\tnetwork\tcalls,\tdon’t\ttreat\tremote\tcalls\tlike\tlocal\tcalls,\tas\tthis\twill\thide different\tsorts\tof\tfailure\tmode.\tSo\tmake\tsure\tif\tyou’re\tusing\tclient\tlibraries\tthat\tthe abstraction\tof\tthe\tremote\tcall\tdoesn’t\tgo\ttoo\tfar.\n\nIf\twe\thold\tthe\ttenets\tof\tantifragility\tin\tmind,\tand\texpect\tfailure\twill\toccur\tanywhere\tand everywhere,\twe\tare\ton\tthe\tright\ttrack.\tMake\tsure\tyour\ttimeouts\tare\tset\tappropriately. Understand\twhen\tand\thow\tto\tuse\tbulkheads\tand\tcircuit\tbreakers\tto\tlimit\tthe\tfallout\tof\ta failing\tcomponent.\tUnderstand\twhat\tthe\tcustomer-facing\timpact\twill\tbe\tif\tonly\tone\tpart\tof the\tsystem\tis\tmisbehaving.\tKnow\twhat\tthe\timplications\tof\ta\tnetwork\tpartition\tmight\tbe, and\twhether\tsacrificing\tavailability\tor\tconsistency\tin\ta\tgiven\tsituation\tis\tthe\tright\tcall.",
      "content_length": 1138,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 419,
      "content": "Highly\tObservable\n\nWe\tcannot\trely\ton\tobserving\tthe\tbehavior\tof\ta\tsingle\tservice\tinstance\tor\tthe\tstatus\tof\ta single\tmachine\tto\tsee\tif\tthe\tsystem\tis\tfunctioning\tcorrectly.\tInstead,\twe\tneed\ta\tjoined-up view\tof\twhat\tis\thappening.\tUse\tsemantic\tmonitoring\tto\tsee\tif\tyour\tsystem\tis\tbehaving correctly,\tby\tinjecting\tsynthetic\ttransactions\tinto\tyour\tsystem\tto\tsimulate\treal-user behavior.\tAggregate\tyour\tlogs,\tand\taggregate\tyour\tstats,\tso\tthat\twhen\tyou\tsee\ta\tproblem you\tcan\tdrill\tdown\tto\tthe\tsource.\tAnd\twhen\tit\tcomes\tto\treproducing\tnasty\tissues\tor\tjust seeing\thow\tyour\tsystem\tis\tinteracting\tin\tproduction,\tuse\tcorrelation\tIDs\tto\tallow\tyou\tto trace\tcalls\tthrough\tthe\tsystem.",
      "content_length": 666,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 420,
      "content": "When\tShouldn’t\tYou\tUse\tMicroservices?\n\nI\tget\tasked\tthis\tquestion\ta\tlot.\tMy\tfirst\tpiece\tof\tadvice\twould\tbe\tthat\tthe\tless\twell\tyou understand\ta\tdomain,\tthe\tharder\tit\twill\tbe\tfor\tyou\tto\tfind\tproper\tbounded\tcontexts\tfor\tyour services.\tAs\twe\tdiscussed\tpreviously,\tgetting\tservice\tboundaries\twrong\tcan\tresult\tin having\tto\tmake\tlots\tof\tchanges\tin\tservice-to-service\tcollaboration\t—\tan\texpensive operation.\tSo\tif\tyou’re\tcoming\tto\ta\tmonolithic\tsystem\tfor\twhich\tyou\tdon’t\tunderstand\tthe domain,\tspend\tsome\ttime\tlearning\twhat\tthe\tsystem\tdoes\tfirst,\tand\tthen\tlook\tto\tidentify clean\tmodule\tboundaries\tprior\tto\tsplitting\tout\tservices.\n\nGreenfield\tdevelopment\tis\talso\tquite\tchallenging.\tIt\tisn’t\tjust\tthat\tthe\tdomain\tis\talso\tlikely to\tbe\tnew;\tit’s\tthat\tit\tis\tmuch\teasier\tto\tchunk\tup\tsomething\tyou\thave\tthan\tsomething\tyou don’t!\tSo\tagain,\tconsider\tstarting\tmonolithic\tfirst\tand\tbreak\tthings\tout\twhen\tyou’re\tstable.\n\nMany\tof\tthe\tchallenges\tyou’re\tgoing\tto\tface\twith\tmicroservices\tget\tworse\twith\tscale.\tIf you\tmostly\tdo\tthings\tmanually,\tyou\tmight\tbe\tOK\twith\t1\tor\t2\tservices,\tbut\t5\tor\t10? Sticking\twith\told\tmonitoring\tpractices\twhere\tyou\tjust\tlook\tat\tstats\tlike\tCPU\tand\tmemory likewise\tmight\twork\tOK\tfor\ta\tfew\tservices,\tbut\tthe\tmore\tservice-to-service\tcollaboration you\tdo,\tthe\tmore\tpainful\tthis\twill\tbecome.\tYou’ll\tfind\tyourself\thitting\tthese\tpain\tpoints\tas you\tadd\tmore\tservices,\tand\tI\thope\tthe\tadvice\tin\tthis\tbook\twill\thelp\tyou\tsee\tsome\tof\tthese problems\tcoming,\tand\tgive\tyou\tsome\tconcrete\ttips\tfor\thow\tto\tdeal\twith\tthem.\tI\tspoke before\tabout\tREA\tand\tGilt\ttaking\ta\twhile\tto\tbuild\tthe\ttooling\tand\tpractices\tto\tmanage microservices\twell,\tprior\tto\tbeing\table\tto\tuse\tthem\tin\tany\tlarge\tquantity.\tThese\tstories\tjust reinforce\tto\tme\tthe\timportance\tof\tstarting\tgradually\tso\tyou\tunderstand\tyour\torganization’s appetite\tand\tability\tto\tchange,\twhich\twill\thelp\tyou\tproperly\tadopt\tmicroservices.",
      "content_length": 1866,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 421,
      "content": "Parting\tWords\n\nMicroservice\tarchitectures\tgive\tyou\tmore\toptions,\tand\tmore\tdecisions\tto\tmake.\tMaking decisions\tin\tthis\tworld\tis\ta\tfar\tmore\tcommon\tactivity\tthan\tin\tsimpler,\tmonolithic\tsystems. You\twon’t\tget\tall\tof\tthese\tdecisions\tright,\tI\tcan\tguarantee\tthat.\tSo,\tknowing\twe\tare\tgoing to\tget\tsome\tthings\twrong,\twhat\tare\tour\toptions?\tWell,\tI\twould\tsuggest\tfinding\tways\tto make\teach\tdecision\tsmall\tin\tscope;\tthat\tway,\tif\tyou\tget\tit\twrong,\tyou\tonly\timpact\ta\tsmall part\tof\tyour\tsystem.\tLearn\tto\tembrace\tthe\tconcept\tof\tevolutionary\tarchitecture,\twhere your\tsystem\tbends\tand\tflexes\tand\tchanges\tover\ttime\tas\tyou\tlearn\tnew\tthings.\tThink\tnot\tof big-bang\trewrites,\tbut\tinstead\tof\ta\tseries\tof\tchanges\tmade\tto\tyour\tsystem\tover\ttime\tto keep\tit\tsupple.\n\nHopefully\tby\tnow\tI’ve\tshared\twith\tyou\tenough\tinformation\tand\texperiences\tto\thelp\tyou decide\tif\tmicroservices\tare\tfor\tyou.\tIf\tthey\tare,\tI\thope\tyou\tthink\tof\tthis\tas\ta\tjourney,\tnot\ta destination.\tGo\tincrementally.\tBreak\tyour\tsystem\tapart\tpiece\tby\tpiece,\tlearning\tas\tyou\tgo. And\tget\tused\tto\tit:\tin\tmany\tways,\tthe\tdiscipline\tto\tcontinually\tchange\tand\tevolve\tour systems\tis\ta\tfar\tmore\timportant\tlesson\tto\tlearn\tthan\tany\tother\tI\thave\tshared\twith\tyou through\tthis\tbook.\tChange\tis\tinevitable.\tEmbrace\tit.",
      "content_length": 1232,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 422,
      "content": "Index\n\nA\n\nacceptance\ttesting,\tTypes\tof\tTests\n\naccess\tby\treference,\tAccess\tby\tReference\n\naccountability,\tPeople\n\nadaptability,\tSummary\n\nAegisthus\tproject,\tBackup\tData\tPump\n\naggregated\tlogs,\tLogs,\tLogs,\tand\tYet\tMore\tLogs…\n\nantifragile\tsystems,\tMicroservices,\tThe\tAntifragile\tOrganization-Isolation\n\nbulkheads,\tBulkheads\n\ncircuit\tbreakers,\tCircuit\tBreakers\n\nexamples\tof,\tThe\tAntifragile\tOrganization\n\nincreased\tuse\tof,\tMicroservices\n\nisolation,\tIsolation\n\nload\tshedding,\tBulkheads\n\ntimeouts,\tTimeouts\n\nAP\tsystem\n\ndefinition\tof\tterm,\tSacrificing\tConsistency\n\nvs.\tCP\tsystem,\tAP\tor\tCP?\n\nAPI\tkey-based\tauthentication,\tAPI\tKeys,\tIt’s\tAll\tAbout\tthe\tKeys\n\napplication\tcontainers,\tApplication\tContainers\n\narchitects\t(see\tsystems\tarchitects)",
      "content_length": 729,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 423,
      "content": "architectural\tprinciples\n\ndevelopment\tof,\tPrinciples\n\nHeroku’s\t12\tfactors,\tPrinciples\n\nkey\tmicroservices\tprinciples,\tBringing\tIt\tAll\tTogether\n\nreal-world\texample,\tA\tReal-World\tExample\n\narchitectural\tsafety,\tArchitectural\tSafety,\tArchitectural\tSafety\tMeasures\n\nartifacts\n\nimages,\tImages\tas\tArtifacts\n\noperating\tsystem,\tOperating\tSystem\tArtifacts\n\nplatform-specific,\tPlatform-Specific\tArtifacts\n\nasynchronous\tcollaboration\n\ncomplexities\tof,\tComplexities\tof\tAsynchronous\tArchitectures\n\nimplementing,\tImplementing\tAsynchronous\tEvent-Based\tCollaboration\n\nvs.\tsynchronous,\tSynchronous\tVersus\tAsynchronous\n\nATOM\tspecification,\tTechnology\tChoices\n\nauthentication/authorization,\tAuthentication\tand\tAuthorization-The\tDeputy Problem\n\ndefinition\tof\tterms,\tAuthentication\tand\tAuthorization\n\nfine-grained,\tFine-Grained\tAuthorization\n\nservice-to-service,\tService-to-Service\tAuthentication\tand\tAuthorization\n\nsingle\tsign-on\t(SSO),\tCommon\tSingle\tSign-On\tImplementations\n\nsingle\tsign-on\tgateway,\tSingle\tSign-On\tGateway\n\nterminology,\tCommon\tSingle\tSign-On\tImplementations\n\nautomation",
      "content_length": 1064,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 424,
      "content": "B\n\nbenefits\tfor\tdeployment,\tAutomation\n\ncase\tstudies\ton,\tTwo\tCase\tStudies\ton\tthe\tPower\tof\tAutomation\n\nautonomy\n\nmicroservices\tand,\tAutonomous\n\nrole\tof\tsystems\tarchitect\tin,\tSummary\n\nautoscaling,\tAutoscaling\n\navailability\n\nin\tCAP\ttheorem,\tCAP\tTheorem\n\nkey\tmicroservices\tprinciple\tof,\tHow\tMuch\tIs\tToo\tMuch?\n\nsacrificing,\tSacrificing\tAvailability\n\nbackends\tfor\tfrontends\t(BFFs),\tBackends\tfor\tFrontends\n\nbackup\tdata\tpumps,\tBackup\tData\tPump\n\nbackups,\tencryption\tof,\tEncrypt\tBackups\n\nblue/green\tdeployment,\tSeparating\tDeployment\tfrom\tRelease\n\nbottlenecks,\tDelivery\tBottlenecks\n\nbounded\tcontexts\n\nconcept\tof,\tThe\tBounded\tContext\n\nmodules\tand\tservices,\tModules\tand\tServices\n\nnested,\tTurtles\tAll\tthe\tWay\tDown\n\npremature\tdecomposition,\tPremature\tDecomposition\n\nshared\tvs.\thidden\tmodels,\tShared\tand\tHidden\tModels\n\nsystem\tdesign\tand,\tBounded\tContexts\tand\tTeam\tStructures",
      "content_length": 858,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 425,
      "content": "C\n\nBrakeman,\tBaking\tSecurity\tIn\n\nbreaking\tchanges\n\navoiding,\tAvoid\tBreaking\tChanges\n\ndeferring,\tDefer\tIt\tfor\tas\tLong\tas\tPossible\n\nearly\tdetection\tof,\tCatch\tBreaking\tChanges\tEarly\n\nbrittle\ttests,\tFlaky\tand\tBrittle\tTests\n\nbrittleness,\tBrittleness\n\nbuild\tpipelines,\tBuild\tPipelines\tand\tContinuous\tDelivery\n\nbulkheads,\tBulkheads\n\nbundled\tservice\trelease,\tAnd\tthe\tInevitable\tExceptions\n\nbusiness\tcapabilities,\tBusiness\tCapabilities\n\nbusiness\tconcepts,\tCommunication\tin\tTerms\tof\tBusiness\tConcepts\n\nbusiness-facing\ttests,\tTypes\tof\tTests\n\ncaching\n\nbenefits\tof,\tCaching\n\ncache\tfailures,\tHiding\tthe\tOrigin\n\ncache\tpoisoning,\tCache\tPoisoning:\tA\tCautionary\tTale\n\nclient-side,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\nfor\twrites,\tCaching\tfor\tWrites\n\nin\tHTTP,\tCaching\tin\tHTTP\n\nproxy,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\nserver-side,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching",
      "content_length": 874,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 426,
      "content": "canary\treleasing,\tCanary\tReleasing\n\nCAP\ttheorem,\tCAP\tTheorem-And\tthe\tReal\tWorld\n\nAP/CP\tsystems,\tIt’s\tNot\tAll\tor\tNothing\n\napplication\tof,\tAnd\tthe\tReal\tWorld\n\nbasics\tof,\tCAP\tTheorem\n\nsacrificing\tavailability,\tSacrificing\tAvailability\n\nsacrificing\tconsistency,\tSacrificing\tConsistency\n\nsacrificing\tpartition\ttolerance,\tSacrificing\tPartition\tTolerance?\n\ncascading\tfailures,\tThe\tCascade\n\ncertificate\tmanagement,\tClient\tCertificates\n\nChaos\tGorilla,\tThe\tAntifragile\tOrganization\n\nChaos\tMonkey,\tThe\tAntifragile\tOrganization\n\nchoreographed\tarchitecture,\tOrchestration\tVersus\tChoreography\n\ncircuit\tbreakers,\tTailored\tService\tTemplate,\tCircuit\tBreakers\n\ncircuit_breaker\tmixin\tfor\tRuby,\tBulkheads\n\nclass-responsibility-collaboration\t(CRC),\tCost\tof\tChange\n\nclient\tcertificates,\tClient\tCertificates\n\nclient\tlibraries,\tClient\tLibraries\n\nclient-side\tcaching,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\ncode\treuse,\tDRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta\tMicroservice\tWorld\n\ncoding\tarchitect,\tZoning\n\ncohesion,\tSmall,\tand\tFocused\ton\tDoing\tOne\tThing\tWell,\tHigh\tCohesion",
      "content_length": 1051,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 427,
      "content": "Cohn’s\tTest\tPyramid,\tTest\tScope\n\ncollaboration,\tSummary\n\nevent-based,\tSynchronous\tVersus\tAsynchronous\n\nrequest/response,\tSynchronous\tVersus\tAsynchronous\n\nCommand-Query\tResponsibility\tSegregation\t(CQRS),\tCQRS\n\ncommits,\ttwo-phase,\tDistributed\tTransactions\n\ncommunication\n\nadapting\tto\tpathways,\tAdapting\tto\tCommunication\tPathways\n\nprotocols\tfor\t(SOAP),\tWhat\tAbout\tService-Oriented\tArchitecture?\n\nsynchronous\tvs.\tasynchronous,\tSynchronous\tVersus\tAsynchronous\n\ncompensating\ttransactions,\tAbort\tthe\tEntire\tOperation\n\ncomposability,\tComposability\n\nconfiguration\tdrift,\tImmutable\tServers\n\nconfiguration,\tservice,\tService\tConfiguration\n\nconfused\tdeputy\tproblem,\tThe\tDeputy\tProblem\n\nconsistency\n\nin\tCAP\ttheorem,\tCAP\tTheorem\n\nsacrificing,\tSacrificing\tConsistency\n\nconstraints,\tConstraints\n\nConsul,\tConsul\n\nconsumer-driven\tcontracts\t(CDCs),\tConsumer-Driven\tTests\tto\tthe\tRescue-It’s About\tConversations\n\ncontent\tdelivery\tnetwork\t(CDN),\tClient-Side,\tProxy,\tand\tServer-Side\tCaching",
      "content_length": 966,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 428,
      "content": "content\tmanagement\tsystems\t(CMS),\tExample:\tCMS\tas\ta\tservice\n\ncontinuous\tdelivery\t(CD),\tMicroservices,\tBuild\tPipelines\tand\tContinuous Delivery\n\ncontinuous\tintegration\t(CI)\n\nbasics,\tA\tBrief\tIntroduction\tto\tContinuous\tIntegration\n\nchecklist\tfor,\tAre\tYou\tReally\tDoing\tIt?\n\nmapping\tto\tmicroservices,\tMapping\tContinuous\tIntegration\tto Microservices\n\nConway’s\tlaw\n\nevidence\tof,\tEvidence\n\nin\treverse,\tConway’s\tLaw\tin\tReverse\n\nstatement\tof,\tConway’s\tLaw\tand\tSystem\tDesign\n\nsummary\tof,\tSummary\n\ncoordination\tprocess,\tDistributed\tTransactions\n\ncore\tteam,\tRole\tof\tthe\tCustodians\n\nCoreOS,\tDocker\n\ncorrelation\tIDs,\tCorrelation\tIDs\n\nCP\tsystem,\tAP\tor\tCP?\n\ncross-functional\trequirements\t(CFR),\tCross-Functional\tTesting,\tHow\tMuch\tIs Too\tMuch?\n\ncustodians,\tRole\tof\tthe\tCustodians\n\ncustom\timages,\tCustom\tImages\n\nCustomer\tRelationship\tManagement\t(CRM),\tExample:\tThe\tmultirole\tCRM system",
      "content_length": 865,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 429,
      "content": "D\n\ncustomers,\tinterfacing\twith\n\nenrolling\tnew\tcustomers,\tInterfacing\twith\tCustomers,\tOrchestration Versus\tChoreography\n\nshared\tdatabases,\tThe\tShared\tDatabase\n\ndata\n\nbatch\tinsertion\tof,\tData\tRetrieval\tvia\tService\tCalls\n\ndurability\tof,\tHow\tMuch\tIs\tToo\tMuch?\n\nencryption\tof\tbackup,\tEncrypt\tBackups\n\nretrieval\tvia\tservice\tcalls,\tData\tRetrieval\tvia\tService\tCalls\n\nsecuring\tat\trest,\tSecuring\tData\tat\tRest\n\n(see\talso\tsecurity)\n\nshared,\tExample:\tShared\tData\n\nshared\tstatic,\tExample:\tShared\tStatic\tData\n\ndata\tencryption,\tGo\twith\tthe\tWell\tKnown\n\ndata\tpumps\n\nbackup,\tBackup\tData\tPump\n\ndata\tretrieval\tvia,\tData\tPumps\n\nevent,\tEvent\tData\tPump\n\nserial\tuse\tof,\tAlternative\tDestinations\n\ndatabase\tdecomposition,\tThe\tDatabase-Understanding\tRoot\tCauses\n\nbreaking\tforeign\tkey\trelationships,\tExample:\tBreaking\tForeign\tKey Relationships\n\nincremental\tapproach\tto,\tCost\tof\tChange\n\noverview\tof,\tSummary",
      "content_length": 877,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 430,
      "content": "refactoring\tdatabases,\tStaging\tthe\tBreak\n\nselecting\tseparation\tpoints,\tGetting\tto\tGrips\twith\tthe\tProblem\n\nselecting\tseparation\ttiming,\tUnderstanding\tRoot\tCauses\n\nshared\tdata,\tExample:\tShared\tData\n\nshared\tstatic\tdata,\tExample:\tShared\tStatic\tData\n\nshared\ttables,\tExample:\tShared\tTables\n\ntransactional\tboundaries,\tTransactional\tBoundaries\n\ndatabase\tintegration,\tThe\tShared\tDatabase\n\ndatabase\tscaling\n\nCommand-Query\tResponsibility\tSegregation\t(CQRS),\tCQRS\n\nfor\treads,\tScaling\tfor\tReads\n\nfor\twrites,\tScaling\tfor\tWrites\n\nservice\tavailability\tvs.\tdata\tdurability,\tAvailability\tof\tService\tVersus Durability\tof\tData\n\nshared\tinfrastructure,\tShared\tDatabase\tInfrastructure\n\ndecision-making\tguidelines,\tA\tPrincipled\tApproach-A\tReal-World\tExample\n\ncustomized\tapproach\tto,\tCombining\tPrinciples\tand\tPractices\n\npractices\tfor,\tPractices\n\nprinciples\tfor,\tPrinciples\n\nreal-world\texample,\tA\tReal-World\tExample\n\nstrategic\tgoals,\tStrategic\tGoals\n\ndecompositional\ttechniques\n\ndatabases\t(see\tdatabase\tdecomposition)",
      "content_length": 991,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 431,
      "content": "identifying/packaging\tcontexts,\tBreaking\tApart\tMusicCorp\n\nmodules,\tModules\n\nseam\tconcept,\tIt’s\tAll\tAbout\tSeams\n\nselecting\tseparation\tpoints,\tThe\tReasons\tto\tSplit\tthe\tMonolith\n\nselecting\tseparation\ttiming,\tUnderstanding\tRoot\tCauses\n\nshared\tlibraries,\tShared\tLibraries\n\ndecoupling,\tAutonomous,\tOrchestration\tVersus\tChoreography\n\ndegrading\tfunctionality,\tDegrading\tFunctionality\n\ndelivery\tbottlenecks,\tDelivery\tBottlenecks\n\ndeployment\n\nartifacts,\timages\tas,\tImages\tas\tArtifacts\n\nartifacts,\toperating\tsystem,\tOperating\tSystem\tArtifacts\n\nartifacts,\tplatform-specific,\tPlatform-Specific\tArtifacts\n\nautomation,\tAutomation\n\nblue/green\tdeployment,\tSeparating\tDeployment\tfrom\tRelease\n\nbuild\tpipeline,\tBuild\tPipelines\tand\tContinuous\tDelivery\n\nbundled\tservice\trelease,\tAnd\tthe\tInevitable\tExceptions\n\ncontinuous\tintegration\tbasics,\tA\tBrief\tIntroduction\tto\tContinuous Integration\n\ncontinuous\tintegration\tchecklist,\tAre\tYou\tReally\tDoing\tIt?\n\ncontinuous\tintegration\tin\tmicroservices,\tMapping\tContinuous Integration\tto\tMicroservices\n\ncustom\timages,\tCustom\tImages",
      "content_length": 1045,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 432,
      "content": "environment\tdefinition,\tEnvironment\tDefinition\n\nenvironments\tto\tconsider,\tEnvironments\n\nimmutable\tservers,\tImmutable\tServers\n\ninterfaces,\tA\tDeployment\tInterface\n\nmicroservices\tvs.\tmonolithic\tsystems,\tEase\tof\tDeployment,\tDeployment\n\noverview\tof,\tSummary\n\nseparating\tfrom\trelease,\tSeparating\tDeployment\tfrom\tRelease\n\nservice\tconfiguration,\tService\tConfiguration\n\nvirtualization\tapproach,\tFrom\tPhysical\tto\tVirtual\n\nvirtualization,\thypervisors,\tTraditional\tVirtualization\n\nvirtualization,\ttraditional,\tTraditional\tVirtualization\n\nvirtualization,\ttype\t2,\tTraditional\tVirtualization\n\ndeputy\tproblem,\tThe\tDeputy\tProblem\n\ndesign\tprinciples,\tPrinciples,\tBringing\tIt\tAll\tTogether-Highly\tObservable\n\n(see\talso\tarchitectural\tprinciples)\n\ndesign/delivery\tpractices\n\ndevelopment\tof,\tPractices\n\nreal-world\texample,\tA\tReal-World\tExample\n\ndirectory\tservice,\tCommon\tSingle\tSign-On\tImplementations\n\nDiRT\t(Disaster\tRecovery\tTest),\tThe\tAntifragile\tOrganization\n\ndistributed\tsystems\n\nfallacies\tof,\tLocal\tCalls\tAre\tNot\tLike\tRemote\tCalls,\tFailure\tIs Everywhere",
      "content_length": 1036,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 433,
      "content": "E\n\nkey\tpromises\tof,\tComposability\n\ndistributed\ttransactions,\tDistributed\tTransactions\n\nDNS\tservice,\tDNS\n\nDocker,\tDocker\n\ndocumentation\n\nHAL\t(Hypertext\tApplication\tLanguage),\tHAL\tand\tthe\tHAL\tBrowser\n\nimportance\tof,\tDocumenting\tServices\n\nself-describing\tsystems,\tHAL\tand\tthe\tHAL\tBrowser\n\nSwagger,\tSwagger\n\ndomain-driven\tdesign,\tMicroservices\n\nDropwizard,\tTailored\tService\tTemplate\n\nDRY\t(Don’t\tRepeat\tYourself),\tDRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta Microservice\tWorld\n\ndummies,\tMocking\tor\tStubbing\n\ndurability,\tHow\tMuch\tIs\tToo\tMuch?\n\ndynamic\tservice\tregistries\n\nbenefits\tof,\tDynamic\tService\tRegistries\n\nConsul,\tConsul\n\nEureka,\tEureka\n\nlaunching,\tRolling\tYour\tOwn\n\nZookeeper,\tZookeeper\n\nempathy,\tSummary\n\nencryption,\tGo\twith\tthe\tWell\tKnown",
      "content_length": 736,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 434,
      "content": "end-to-end\ttests\n\nappropriate\tuses\tfor,\tTest\tJourneys,\tNot\tStories,\tSo\tShould\tYou\tUse\tEnd- to-End\tTests?\n\nCohn’s\tTest\tPyramid,\tTest\tScope\n\ncreation\tof,\tWho\tWrites\tThese\tTests?\n\ndrawbacks\tof,\tFlaky\tand\tBrittle\tTests\n\nfeedback\tcycle,\tThe\tGreat\tPile-up\n\nimplementation\tof,\tThose\tTricky\tEnd-to-End\tTests\n\nmetaversion,\tThe\tMetaversion\n\nscope\tof,\tEnd-to-End\tTests\n\ntiming\tof,\tHow\tLong?\n\nendpoints\n\ncoexisting\tdifferent,\tCoexist\tDifferent\tEndpoints\n\nserver-side\taggregation,\tBackends\tfor\tFrontends\n\nenvironments\n\ndefinition\tduring\tdeployment,\tEnvironment\tDefinition\n\ndeployment\tconsiderations,\tEnvironments\n\nmanaging,\tEnvironments\n\nErlang\tmodules,\tModules\n\nEureka,\tEureka\n\nevent\tdata\tpumps,\tEvent\tData\tPump\n\nevent\tsourcing,\tCQRS\n\nevent-based\tcollaboration,\tSynchronous\tVersus\tAsynchronous",
      "content_length": 781,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 435,
      "content": "F\n\nG\n\neventual\tconsistency,\tTry\tAgain\tLater,\tSacrificing\tConsistency\n\nevolutionary\tarchitects\t(see\tsystems\tarchitects)\n\nexception\thandling,\tException\tHandling\n\nexemplars,\tExemplars\n\nexploratory\ttesting,\tTypes\tof\tTests\n\nfailure\tbots,\tThe\tAntifragile\tOrganization\n\nfailures\n\ncascading,\tThe\tCascade\n\n(see\talso\tmonitoring)\n\ndealing\twith,\tFailure\tIs\tEverywhere\n\nfakes,\tMocking\tor\tStubbing\n\nfeature-based\tteams,\tFeature\tTeams\n\nfirewalls,\tFirewalls\n\nflaky\ttests,\tFlaky\tand\tBrittle\tTests\n\nforeign\tkey\trelationships,\tbreaking,\tExample:\tBreaking\tForeign\tKey Relationships\n\nFPM\tpackage\tmanager\ttool,\tOperating\tSystem\tArtifacts\n\nfunctionality,\tdegrading,\tDegrading\tFunctionality\n\ngame\tdays,\tThe\tAntifragile\tOrganization\n\ngatekeepers,\tRole\tof\tthe\tCustodians\n\ngovernance\n\nconcept\tof,\tGovernance\tand\tLeading\tfrom\tthe\tCenter",
      "content_length": 808,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 436,
      "content": "H\n\nrole\tof\tsystems\tarchitect\tin,\tSummary\n\ngranularity,\tWhat\tAbout\tService-Oriented\tArchitecture?\n\nGraphite,\tMetric\tTracking\tAcross\tMultiple\tServices\n\nhabitable\tsystems,\tAn\tEvolutionary\tVision\tfor\tthe\tArchitect\n\nHAL\t(Hypertext\tApplication\tLanguage),\tHAL\tand\tthe\tHAL\tBrowser\n\nhash-based\tmessaging\tcode\t(HMAC),\tHMAC\tOver\tHTTP\n\nHATEOS\tprinciple,\tHypermedia\tAs\tthe\tEngine\tof\tApplication\tState\n\nheterogeneity\n\nbenefits\tof,\tTechnology\tHeterogeneity\n\nshared\tlibraries\tand,\tShared\tLibraries\n\nhexagonal\tarchitecture,\tMicroservices\n\nhidden\tmodels,\tShared\tand\tHidden\tModels\n\nhigh\tcohesion,\tHigh\tCohesion\n\nHMAC\t(hash-based\tmessaging\tcode),\tHMAC\tOver\tHTTP\n\nHTTP\t(Hypertext\tTransfer\tProtocol)\n\ncaching\tin,\tCaching\tin\tHTTP\n\nHATEOS\tprinciple,\tHypermedia\tAs\tthe\tEngine\tof\tApplication\tState\n\nHTTP\tover\tREST\tbenefits,\tREST\tand\tHTTP\n\nHTTP\tover\tREST\tdrawbacks,\tDownsides\tto\tREST\tOver\tHTTP\n\nHTTP\ttermination,\tLoad\tBalancing\n\nHTTP(S)\tBasic\tAuthentication,\tHTTP(S)\tBasic\tAuthentication\n\nhumane\tregistry,\tHAL\tand\tthe\tHAL\tBrowser",
      "content_length": 1002,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 437,
      "content": "I\n\nhypermedia,\tHypermedia\tAs\tthe\tEngine\tof\tApplication\tState\n\nhypervisors,\tTraditional\tVirtualization\n\nHystrix\tlibrary,\tTailored\tService\tTemplate,\tBulkheads\n\nidempotent\toperations,\tIdempotency\n\nidentity\tprovider,\tCommon\tSingle\tSign-On\tImplementations\n\nimages\n\nas\tartifacts,\tImages\tas\tArtifacts\n\ncustom,\tCustom\tImages\n\nimmutable\tservers,\tImmutable\tServers\n\ninfrastructure\tautomation,\tMicroservices\n\nintegration\n\naccess\tby\treference,\tAccess\tby\tReference\n\nasynchronous\tevent-based\tcollaboration,\tImplementing\tAsynchronous Event-Based\tCollaboration\n\ncustomer\tinterface,\tInterfacing\twith\tCustomers\n\nDRY\t(Don’t\tRepeat\tYourself),\tDRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta Microservice\tWorld\n\ngoals\tfor,\tLooking\tfor\tthe\tIdeal\tIntegration\tTechnology\n\nguidelines\tfor,\tSummary\n\nimportance\tof,\tIntegration\n\norchestration\tvs.\tchoreography,\tOrchestration\tVersus\tChoreography\n\nreactive\textensions,\tReactive\tExtensions\n\nremote\tprocedure\tcalls,\tRemote\tProcedure\tCalls",
      "content_length": 946,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 438,
      "content": "J\n\nK\n\nREST\t(Representational\tState\tTransfer),\tREST\n\nservices\tas\tstate\tmachines,\tServices\tas\tState\tMachines\n\nshared\tdatabases,\tThe\tShared\tDatabase\n\nsynchronous\tvs.\tasynchronous\tcommunication,\tSynchronous\tVersus Asynchronous\n\nthird-party\tsoftware,\tIntegrating\twith\tThird-Party\tSoftware\n\nuser\tinterfaces,\tUser\tInterfaces\n\nversioning,\tVersioning\n\ninterfaces\n\ncoexisting\tnew\tand\told,\tCoexist\tDifferent\tEndpoints\n\ndeployment,\tA\tDeployment\tInterface\n\nstandards\testablishment\tfor,\tInterfaces\n\n(see\talso\tuser\tinterfaces)\n\ninternal\timplementation\tdetail,\tHide\tInternal\tImplementation\tDetail\n\ninternal\topen\tsource\tmodel,\tInternal\tOpen\tSource\n\nintrusion\tdetection\tsystems\t(IDS),\tIntrusion\tDetection\t(and\tPrevention)\tSystem\n\nintrusion\tprevention\tsystems\t(IPS),\tIntrusion\tDetection\t(and\tPrevention)\tSystem\n\nisolation,\tIsolation\n\nIT\tarchitects\t(see\tsystems\tarchitects)\n\nJSON,\tJSON,\tXML,\tor\tSomething\tElse?\n\nJSON\tweb\ttokens\t(JWT),\tHMAC\tOver\tHTTP\n\nKaryon,\tTailored\tService\tTemplate",
      "content_length": 964,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 439,
      "content": "L\n\nM\n\nkey-based\tauthentication,\tAPI\tKeys\n\nKibana,\tLogs,\tLogs,\tand\tYet\tMore\tLogs…\n\nlatency,\tHow\tMuch\tIs\tToo\tMuch?\n\nLatency\tMonkey,\tThe\tAntifragile\tOrganization\n\nlayered\tarchitectures,\tMicroservices\n\nlibraries\n\nclient,\tClient\tLibraries\n\nservice\tmetrics,\tService\tMetrics\n\nshared,\tShared\tLibraries\n\nLinux\tcontainers,\tLinux\tContainers\n\nload\tbalancing,\tLoad\tBalancing\n\nload\tshedding,\tBulkheads\n\nlocal\tcalls,\tLocal\tCalls\tAre\tNot\tLike\tRemote\tCalls\n\nlogs\n\naggregated,\tLogs,\tLogs,\tand\tYet\tMore\tLogs…\n\n(see\talso\tmonitoring)\n\nsecurity\tissues,\tLogging\n\nstandardization\tof,\tStandardization\n\nlogstash,\tLogs,\tLogs,\tand\tYet\tMore\tLogs…\n\nloose\tcoupling,\tLoose\tCoupling,\tOrchestration\tVersus\tChoreography,\tLoose\tand Tightly\tCoupled\tOrganizations\n\nman-in-the-middle\tattacks,\tAllow\tEverything\tInside\tthe\tPerimeter",
      "content_length": 791,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 440,
      "content": "Marick’s\tquadrant,\tTypes\tof\tTests\n\nmaturity,\tMaturity\n\nmean\ttime\tbetween\tfailures\t(MTBF),\tMean\tTime\tto\tRepair\tOver\tMean\tTime Between\tFailures?\n\nmean\ttime\tto\trepair\t(MTTR),\tMean\tTime\tto\tRepair\tOver\tMean\tTime\tBetween Failures?\n\nmessage\tbrokers,\tTechnology\tChoices\n\nmetrics\n\nlibraries\tfor,\tService\tMetrics\n\nservice\tmetrics,\tService\tMetrics\n\ntracking\tacross\tmultiple\tservices,\tMetric\tTracking\tAcross\tMultiple Services\n\nMetrics\tlibrary,\tTailored\tService\tTemplate\n\nmicroservices\n\nappropriate\tapplication\tof,\tWhen\tShouldn’t\tYou\tUse\tMicroservices?\n\nautonomy\tand,\tAutonomous,\tBuilding\ta\tTeam\n\nbenefits\tof,\tMicroservices\n\ncomposability\tof,\tComposability\n\ndefinition\tof\tterm,\tWhat\tAre\tMicroservices?\n\ndeployment\tease\tof,\tEase\tof\tDeployment\n\ndrawbacks\tof,\tNo\tSilver\tBullet,\tWhen\tShouldn’t\tYou\tUse\tMicroservices?\n\nkey\tprinciples\tof,\tBringing\tIt\tAll\tTogether\n\norganizational\talignment\tand,\tOrganizational\tAlignment\n\norigins\tof,\tMicroservices",
      "content_length": 927,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 441,
      "content": "replaceability\tand,\tOptimizing\tfor\tReplaceability\n\nresilience\tof,\tResilience\n\nscaling\tand,\tScaling\n\nsize\tand,\tSmall,\tand\tFocused\ton\tDoing\tOne\tThing\tWell\n\ntechnology\theterogeneity\tof,\tTechnology\tHeterogeneity\n\nvs.\tmodules,\tModules\n\nvs.\tservice-oriented\tarchitecture,\tWhat\tAbout\tService-Oriented Architecture?\n\nvs.\tshared\tlibraries,\tShared\tLibraries\n\nmicroservices\tat\tscale\n\nantifragile\tsystems,\tThe\tAntifragile\tOrganization\n\narchitectural\tsafety\tmeasures,\tArchitectural\tSafety\tMeasures\n\nautoscaling,\tAutoscaling\n\ncaching,\tCaching\n\ncaching\tfor\twrites,\tCaching\tfor\tWrites\n\nCAP\ttheorem,\tCAP\tTheorem\n\ncross-functional\trequirements\t(CFR),\tHow\tMuch\tIs\tToo\tMuch?\n\ndealing\twith\tfailures,\tFailure\tIs\tEverywhere\n\ndegrading\tfunctionality,\tDegrading\tFunctionality\n\ndocumenting\tservices,\tDocumenting\tServices\n\ndynamic\tservice\tregistries,\tDynamic\tService\tRegistries\n\nidempotent\toperations,\tIdempotency\n\nscaling,\tScaling",
      "content_length": 904,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 442,
      "content": "scaling\tdatabases,\tScaling\tDatabases\n\nself-describing\tsystems,\tHAL\tand\tthe\tHAL\tBrowser\n\nservice\tdiscovery,\tService\tDiscovery\n\nmiddleware,\tTechnology\tChoices\n\nmocking\tvs.\tstubbing,\tMocking\tor\tStubbing\n\nmodeling\tservices\n\nbounded\tcontexts,\tThe\tBounded\tContext\n\nbusiness\tcapabilities,\tBusiness\tCapabilities\n\nbusiness\tconcepts,\tCommunication\tin\tTerms\tof\tBusiness\tConcepts\n\nkey\tconcepts,\tWhat\tMakes\ta\tGood\tService?\n\nmodules\tand\tservices,\tModules\tand\tServices\n\nnested\tbounded\tcontexts,\tTurtles\tAll\tthe\tWay\tDown\n\npremature\tdecomposition,\tPremature\tDecomposition\n\nshared\tvs.\thidden\tmodels,\tShared\tand\tHidden\tModels\n\ntechnical\tboundaries,\tThe\tTechnical\tBoundary\n\nmodular\tdecomposition,\tModules\n\nmodules,\tModules\tand\tServices\n\nmonitoring\n\ncascading\tfailures,\tThe\tCascade\n\ncentral\tlogging,\tLogs,\tLogs,\tand\tYet\tMore\tLogs…\n\ncomplexities\tof,\tMonitoring\n\ncorrelation\tIDs,\tCorrelation\tIDs\n\ndisplaying/sharing\tresults,\tConsider\tthe\tAudience",
      "content_length": 923,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 443,
      "content": "metric\ttracking\tacross\tmultiple\tservices,\tMetric\tTracking\tAcross Multiple\tServices\n\nmultiple\tservices/multiple\tservers,\tMultiple\tServices,\tMultiple\tServers\n\noverview\tof,\tSummary\n\nreal-time\treporting,\tThe\tFuture\n\nsemantic,\tImplementing\tSemantic\tMonitoring\n\nservice\tmetrics,\tService\tMetrics\n\nsingle\tservice/multiple\tservers,\tSingle\tService,\tMultiple\tServers\n\nsingle\tservice/single\tserver,\tSingle\tService,\tSingle\tServer\n\nstandardization\tof,\tStandardization\n\nstandards\testablishment\tand,\tMonitoring\n\nsynthetic,\tSynthetic\tMonitoring\n\nmonolithic\tsystems\n\ncodebases\tin,\tSmall,\tand\tFocused\ton\tDoing\tOne\tThing\tWell\n\nlack\tof\tcohesion/loose\tcoupling\tin,\tIt’s\tAll\tAbout\tSeams\n\nreporting\tdatabases\tin,\tThe\tReporting\tDatabase\n\nvs.\tservice-oriented\tarchitecture,\tWhat\tAbout\tService-Oriented Architecture?\n\nMoore’s\tlaw,\tConway’s\tLaw\tand\tSystem\tDesign\n\nMountebank,\tA\tSmarter\tStub\tService\n\nMTBF\t(mean\ttime\tbetween\tfailures),\tMean\tTime\tto\tRepair\tOver\tMean\tTime Between\tFailures?\n\nMTTR\t(mean\ttime\tto\trepair),\tMean\tTime\tto\tRepair\tOver\tMean\tTime\tBetween Failures?",
      "content_length": 1041,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 444,
      "content": "N\n\nO\n\nnested\tbounded\tcontexts,\tTurtles\tAll\tthe\tWay\tDown\n\nnetwork\tsegregation,\tNetwork\tSegregation\n\nnonfunctional\trequirements,\tCross-Functional\tTesting\n\nnormalization\tof\tdeviance,\tFlaky\tand\tBrittle\tTests\n\non-demand\tprovisioning\tsystems,\tScaling\n\non-demand\tvirtualization,\tMicroservices\n\nonion\tarchitecture,\tThe\tTechnical\tBoundary\n\nOpen\tWeb\tApplication\tSecurity\tProject\t(OWASP),\tBaking\tSecurity\tIn\n\nOpenID\tConnect,\tCommon\tSingle\tSign-On\tImplementations,\tUse\tSAML\tor OpenID\tConnect\n\noperating\tsystem\tartifacts,\tOperating\tSystem\tArtifacts\n\noperating\tsystems\tsecurity,\tOperating\tSystem\n\norchestration\tarchitecture,\tOrchestration\tVersus\tChoreography\n\norganizational\talignment,\tOrganizational\tAlignment\n\norganizational\tstructure\n\nConway’s\tlaw\tand,\tConway’s\tLaw\tand\tSystem\tDesign\n\neffect\ton\tsystems\tdesign,\tEvidence\n\nloose\tvs.\ttightly\tcoupled,\tLoose\tand\tTightly\tCoupled\tOrganizations\n\norphaned\tservices,\tThe\tOrphaned\tService?\n\nOSGI\t(Open\tSource\tGateway\tInitiative),\tModules\n\nownership\n\nshared,\tDrivers\tfor\tShared\tServices",
      "content_length": 1014,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 445,
      "content": "P\n\nR\n\nsystem\tdesign\tand,\tService\tOwnership\n\nPacker,\tCustom\tImages\n\nPact,\tPact\n\nPacto,\tPact\n\npartition\ttolerance\n\nin\tCAP\ttheorem,\tCAP\tTheorem\n\nsacrificing,\tSacrificing\tPartition\tTolerance?\n\npasswords,\tGo\twith\tthe\tWell\tKnown\n\nperformance\ttests,\tPerformance\tTests\n\nplatform\tas\ta\tservice\t(PaaS),\tPlatform\tas\ta\tService\n\nplatform-specific\tartifacts,\tPlatform-Specific\tArtifacts\n\nPolly\tfor\t.NET,\tBulkheads\n\nPostel’s\tLaw,\tDefer\tIt\tfor\tas\tLong\tas\tPossible\n\npredictive\tscaling,\tAutoscaling\n\nprincipal\tparty,\tAuthentication\tand\tAuthorization\n\nprivacy\tissues,\tBe\tFrugal\n\nproperty\ttesting,\tTypes\tof\tTests\n\nproxy\tcaching,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\nRabbitMQ,\tTechnology\tChoices\n\nRDBMS\t(relational\tdatabase\tmanagement\tsystems),\tScaling\tfor\tReads\n\nreactive\textensions\t(Rx),\tReactive\tExtensions",
      "content_length": 795,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 446,
      "content": "reactive\tscaling,\tAutoscaling\n\nread\treplicas,\tScaling\tfor\tReads\n\nredesign,\tStarting\tAgain\n\nrefactoring\tdatabases,\tStaging\tthe\tBreak\n\nremote\tprocedure\tcalls,\tRemote\tProcedure\tCalls-Is\tRPC\tTerrible?\n\nbenefits\tand\tdrawbacks\tof,\tIs\tRPC\tTerrible?\n\nbrittleness,\tBrittleness\n\ndefinition\tof\tterm,\tRemote\tProcedure\tCalls\n\ntechnologies\tavailable,\tRemote\tProcedure\tCalls\n\ntechnology\tcoupling,\tTechnology\tCoupling\n\nvs.\tlocal\tcalls,\tLocal\tCalls\tAre\tNot\tLike\tRemote\tCalls\n\nreplaceability,\tOptimizing\tfor\tReplaceability\n\nreporting\tdatabases\n\nbackup\tdata\tpumps,\tBackup\tData\tPump\n\ndata\tpump\tguidelines,\tData\tPumps\n\ndata\tretrieval\tvia\tservice\tcalls,\tData\tRetrieval\tvia\tService\tCalls\n\nevent\tdata\tpumps,\tEvent\tData\tPump\n\ngeneric\teventing\tsystems,\tToward\tReal\tTime\n\nmonolithic\tapproach\tto,\tThe\tReporting\tDatabase\n\nthird-party\tsoftware,\tData\tRetrieval\tvia\tService\tCalls\n\nrequest/response\tcollaboration,\tSynchronous\tVersus\tAsynchronous\n\nresilience\tengineering,\tResilience,\tCaching\tfor\tResilience\n\nresources,\tREST",
      "content_length": 989,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 447,
      "content": "S\n\nresponse\ttime,\tHow\tMuch\tIs\tToo\tMuch?\n\nREST\t(Representational\tState\tTransfer),\tREST-Downsides\tto\tREST\tOver HTTP\n\nATOM\tspecification,\tTechnology\tChoices\n\nconcept\tof,\tREST\n\nframeworks\tfor,\tBeware\tToo\tMuch\tConvenience\n\nHTTP\tover\tREST\tbenefits,\tREST\tand\tHTTP\n\nHTTP\tover\tREST\tdrawbacks,\tDownsides\tto\tREST\tOver\tHTTP\n\ntextual\tformats,\tJSON,\tXML,\tor\tSomething\tElse?\n\nreverse\tproxy,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\nRiemann,\tThe\tFuture\n\nrisk,\tspreading,\tSpreading\tYour\tRisk\n\nRobustness\tprinciple,\tDefer\tIt\tfor\tas\tLong\tas\tPossible\n\nRx\t(reactive\textensions),\tReactive\tExtensions\n\nSAML,\tCommon\tSingle\tSign-On\tImplementations,\tUse\tSAML\tor\tOpenID Connect\n\nSAN\t(storage\tarea\tnetworks),\tSpreading\tYour\tRisk\n\nscaling,\tScaling-Starting\tAgain\n\nautoscaling,\tAutoscaling\n\nbenefits\tof,\tScaling\n\ndatabases,\tScaling\tDatabases\n\nload\tbalancing,\tLoad\tBalancing\n\nreasons\tfor,\tScaling",
      "content_length": 869,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 448,
      "content": "splitting\tworkloads,\tSplitting\tWorkloads\n\nspreading\trisk,\tSpreading\tYour\tRisk\n\nvertical,\tGo\tBigger\n\nvs.\tredesign,\tStarting\tAgain\n\nworker-based\tsystems,\tWorker-Based\tSystems\n\nseams,\tconcept\tof,\tIt’s\tAll\tAbout\tSeams\n\nsecurity,\tSecurity-Summary\n\nattacks,\tdefending\tfrom,\tDefense\tin\tDepth\n\nauthentication/authorization,\tAuthentication\tand\tAuthorization\n\nbackups,\tBackup\tData\tPump,\tEncrypt\tBackups\n\neducation/awareness\tof,\tBaking\tSecurity\tIn\n\nencryption,\tGo\twith\tthe\tWell\tKnown\n\nexample\tsetup,\tA\tWorked\tExample\n\nexternal\tverification\tof,\tExternal\tVerification\n\nfirewalls,\tFirewalls\n\nhuman\telement\tof,\tThe\tHuman\tElement\n\nimportance\tof,\tSecurity\n\nintrusion\tdetection/prevention,\tIntrusion\tDetection\t(and\tPrevention) System\n\nkey\tstorage,\tIt’s\tAll\tAbout\tthe\tKeys\n\nlogs,\tLogging\n\nman-in-the-middle\tattacks,\tAllow\tEverything\tInside\tthe\tPerimeter\n\noperating\tsystems,\tOperating\tSystem",
      "content_length": 871,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 449,
      "content": "overview\tof,\tSummary\n\npasswords,\tGo\twith\tthe\tWell\tKnown\n\nprivacy\tissues,\tBe\tFrugal\n\nsecuring\tdata\tat\trest,\tSecuring\tData\tat\tRest\n\nservice-to-service\tauthentication/authorization,\tService-to-Service Authentication\tand\tAuthorization\n\ntool\tselection,\tThe\tGolden\tRule\n\nvirtual\tprivate\tclouds,\tNetwork\tSegregation\n\nSecurity\tDevelopment\tLifecycle,\tBaking\tSecurity\tIn\n\nself-describing\tsystems,\tHAL\tand\tthe\tHAL\tBrowser\n\nsemantic\tmonitoring,\tSo\tShould\tYou\tUse\tEnd-to-End\tTests?,\tSynthetic Monitoring\n\nsemantic\tversioning,\tUse\tSemantic\tVersioning\n\nserver-side\tcaching,\tClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\nservice\taccounts,\tUse\tSAML\tor\tOpenID\tConnect\n\nservice\tboundaries,\tZoning\n\n(see\talso\tmodeling\tservices)\n\nservice\tcalls,\tdata\tretrieval\tvia,\tData\tRetrieval\tvia\tService\tCalls\n\nservice\tconfiguration,\tService\tConfiguration\n\nservice\tdiscovery,\tService\tDiscovery\n\nservice\townership\n\ncomprehensive\tapproach,\tService\tOwnership\n\nshared,\tDrivers\tfor\tShared\tServices\n\nservice\tprovider,\tCommon\tSingle\tSign-On\tImplementations",
      "content_length": 1015,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 450,
      "content": "service\tseparation,\tstaging,\tStaging\tthe\tBreak\n\n(see\talso\tdatabase\tdecomposition)\n\nservice\ttemplates,\tTailored\tService\tTemplate\n\nservice\ttests\n\nCohn’s\tTest\tPyramid,\tTest\tScope\n\nimplementation\tof,\tImplementing\tService\tTests\n\nmocking\tvs.\tstubbing,\tMocking\tor\tStubbing\n\nMountebank\tserver\tfor,\tA\tSmarter\tStub\tService\n\nscope\tof,\tService\tTests\n\nservice-oriented\tarchitectures\t(SOA)\n\nconcept\tof,\tWhat\tAbout\tService-Oriented\tArchitecture?\n\ndrawbacks\tof,\tWhat\tAbout\tService-Oriented\tArchitecture?\n\nreuse\tof\tfunctionality\tin,\tComposability\n\nvs.\tmicroservices,\tWhat\tAbout\tService-Oriented\tArchitecture?\n\nservice-to-host\tmapping,\tService-to-Host\tMapping-Platform\tas\ta\tService\n\napplication\tcontainers,\tApplication\tContainers\n\nmultiple\tservices\tper\thost,\tMultiple\tServices\tPer\tHost\n\nplatform\tas\ta\tservice\t(PaaS),\tPlatform\tas\ta\tService\n\nsingle\tservice\tper\thost,\tSingle\tService\tPer\tHost\n\nterminology,\tService-to-Host\tMapping\n\nservice-to-service\tauthentication/authorization,\tService-to-Service Authentication\tand\tAuthorization-The\tDeputy\tProblem\n\nAPI\tkeys,\tAPI\tKeys\n\nclient\tcertificates,\tClient\tCertificates",
      "content_length": 1091,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 451,
      "content": "confused\tdeputy\tproblem,\tThe\tDeputy\tProblem\n\nHMAC\tover\tHTTP,\tHMAC\tOver\tHTTP\n\nHTTP(S)\tbasic,\tHTTP(S)\tBasic\tAuthentication\n\nman-in-the-middle\tattacks,\tAllow\tEverything\tInside\tthe\tPerimeter\n\nSAML/OpenID\tConnect,\tUse\tSAML\tor\tOpenID\tConnect\n\nsharding,\tScaling\tfor\tWrites\n\nshared\tcode,\tDRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta\tMicroservice\tWorld\n\nshared\tdata,\tExample:\tShared\tData\n\nshared\tlibraries,\tShared\tLibraries\n\nshared\tmodels,\tShared\tand\tHidden\tModels\n\nshared\tstatic\tdata,\tExample:\tShared\tStatic\tData\n\nshared\ttables,\tExample:\tShared\tTables\n\nsharing\tbehavior,\tThe\tShared\tDatabase\n\nsingle\tsign-on\t(SSO),\tCommon\tSingle\tSign-On\tImplementations-Single\tSign-On Gateway\n\nsmoke\ttest\tsuites,\tSeparating\tDeployment\tfrom\tRelease\n\nspies,\tMocking\tor\tStubbing\n\nSSH-multiplexing,\tSingle\tService,\tMultiple\tServers\n\nSSL\tcertificates,\tHTTP(S)\tBasic\tAuthentication\n\nSSL\ttermination,\tLoad\tBalancing\n\nstandards\tenforcement\n\nexemplars,\tExemplars\n\ntailored\tservice\ttemplates,\tTailored\tService\tTemplate",
      "content_length": 975,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 452,
      "content": "standards\testablishment,\tThe\tRequired\tStandard-Architectural\tSafety\n\narchitectural\tsafety,\tArchitectural\tSafety\n\nimportance\tof,\tThe\tRequired\tStandard\n\ninterfaces,\tInterfaces\n\nmonitoring,\tMonitoring\n\nstatic\tdata,\tExample:\tShared\tStatic\tData\n\nStrangler\tApplication\tPattern,\tThe\tStrangler\tPattern,\tArchitectural\tSafety Measures\n\nstrategic\tgoals\n\nreal-world\texample,\tA\tReal-World\tExample\n\nunderstanding,\tStrategic\tGoals\n\nstubbing\tvs.\tmocking,\tMocking\tor\tStubbing\n\nSuro,\tThe\tFuture\n\nSwagger,\tSwagger\n\nsynchronous\tcommunication,\tSynchronous\tVersus\tAsynchronous\n\nsynthetic\tmonitoring,\tSynthetic\tMonitoring\n\nsystem\tdesign\n\naccountability\tand,\tPeople\n\nadapting\tto\tcommunication\tpathways,\tAdapting\tto\tCommunication Pathways\n\nbounded\tcontexts,\tBounded\tContexts\tand\tTeam\tStructures\n\ncase\tstudy,\tCase\tStudy:\tRealEstate.com.au\n\nConway’s\tlaw\tof,\tConway’s\tLaw\tand\tSystem\tDesign\n\ndelivery\tbottlenecks,\tDelivery\tBottlenecks",
      "content_length": 905,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 453,
      "content": "effect\ton\torganizational\tstructure,\tConway’s\tLaw\tin\tReverse\n\nfeature\tteams,\tFeature\tTeams\n\ninternal\topen\tsource\tmodel,\tInternal\tOpen\tSource\n\norganizational\tstructure\tand,\tEvidence\n\norphaned\tservices,\tThe\tOrphaned\tService?\n\noverview\tof,\tSummary\n\nrole\tof\tcustodians,\tRole\tof\tthe\tCustodians\n\nservice\tmaturity,\tMaturity\n\nservice\townership,\tService\tOwnership\n\nshared\tservice\townership,\tDrivers\tfor\tShared\tServices\n\ntooling,\tTooling\n\nsystems\tarchitects\n\nchallenges\tfaced\tby,\tSummary\n\ndecision-making\tguidelines\tfor,\tA\tPrincipled\tApproach\n\nexception\thandling,\tException\tHandling\n\ngovernance,\tGovernance\tand\tLeading\tfrom\tthe\tCenter\n\nresponsibilities\tof,\tInaccurate\tComparisons,\tTechnical\tDebt,\tSummary\n\nrole\tof,\tAn\tEvolutionary\tVision\tfor\tthe\tArchitect\n\nservice\tboundaries\tand,\tZoning\n\nstandards\tenforcement\tby,\tGovernance\tThrough\tCode-Tailored\tService Template\n\nstandards\testablishment\tby,\tThe\tRequired\tStandard\n\nteam\tbuilding\tby,\tBuilding\ta\tTeam",
      "content_length": 939,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 454,
      "content": "T\n\nteam\tparticipation\tby,\tZoning\n\ntechnical\tdebt\tand,\tTechnical\tDebt\n\ntables,\tshared,\tExample:\tShared\tTables\n\ntailored\tservice\ttemplates,\tTailored\tService\tTemplate\n\nteam\tbuilding,\tBuilding\ta\tTeam\n\nteam\tstructures,\tBounded\tContexts\tand\tTeam\tStructures\n\ntechnical\tboundaries,\tThe\tTechnical\tBoundary\n\ntechnical\tdebt,\tTechnical\tDebt\n\ntechnology\theterogeneity,\tTechnology\tHeterogeneity\n\ntechnology-agnostic\tAPIs,\tKeep\tYour\tAPIs\tTechnology-Agnostic\n\ntechnology-facing\ttests,\tTypes\tof\tTests\n\ntemplates,\tTailored\tService\tTemplate\n\ntest\tdoubles,\tMocking\tor\tStubbing\n\nTest\tPyramid,\tTest\tScope,\tConsumer-Driven\tTests\tto\tthe\tRescue\n\ntest\tsnow\tcone,\tHow\tMany?\n\ntest-driven\tdesign\t(TDD),\tUnit\tTests\n\ntesting\n\ncanary\treleasing,\tCanary\tReleasing\n\nconsiderations\tfor,\tTrade-Offs\n\nconsumer-driven\ttests,\tConsumer-Driven\tTests\tto\tthe\tRescue\n\ncross-functional,\tCross-Functional\tTesting\n\nend-to-end\ttests,\tThose\tTricky\tEnd-to-End\tTests",
      "content_length": 914,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 455,
      "content": "MTTR\tover\tMTBF,\tMean\tTime\tto\tRepair\tOver\tMean\tTime\tBetween Failures?\n\noverview\tof,\tSummary\n\nperformance\ttests,\tPerformance\tTests\n\npost-production,\tTesting\tAfter\tProduction\n\nscope\tof,\tTest\tScope\n\nselecting\tnumber\tof,\tHow\tMany?\n\nsemantic\tmonitoring,\tSo\tShould\tYou\tUse\tEnd-to-End\tTests?\n\nseparating\tdeployment\tfrom\trelease,\tSeparating\tDeployment\tfrom Release\n\nservice\ttest\timplementation,\tImplementing\tService\tTests\n\ntypes\tof\ttests,\tTypes\tof\tTests\n\nthird-party\tsoftware,\tIntegrating\twith\tThird-Party\tSoftware-The\tStrangler Pattern,\tData\tRetrieval\tvia\tService\tCalls\n\nbuilding\tvs.\tbuying,\tIntegrating\twith\tThird-Party\tSoftware\n\ncontent\tmanagement\tsystems\t(CMS),\tExample:\tCMS\tas\ta\tservice\n\nCustomer\tRelationship\tManagement\t(CRM),\tExample:\tThe\tmultirole CRM\tsystem\n\ncustomization\tof,\tCustomization\n\nintegration\tissues,\tIntegration\tSpaghetti\n\nlack\tof\tcontrol\tover,\tLack\tof\tControl\n\nreporting\tdatabases,\tData\tRetrieval\tvia\tService\tCalls\n\nStrangler\tApplication\tPattern,\tThe\tStrangler\tPattern\n\ntight\tcoupling,\tLoose\tCoupling,\tLoose\tand\tTightly\tCoupled\tOrganizations",
      "content_length": 1054,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 456,
      "content": "U\n\ntime\tto\tlive\t(TTL),\tDNS\n\ntimeouts,\tTimeouts\n\ntransaction\tmanagers,\tDistributed\tTransactions\n\ntransactional\tboundaries,\tTransactional\tBoundaries-So\tWhat\tto\tDo?\n\ntransactions\n\ncompensating,\tAbort\tthe\tEntire\tOperation\n\ndistributed,\tDistributed\tTransactions\n\nTransport\tLayer\tSecurity\t(TLS),\tClient\tCertificates\n\ntwo-phase\tcommits,\tDistributed\tTransactions\n\ntype\t2\tvirtualization,\tTraditional\tVirtualization\n\nUDDI\t(Universal\tDescription,\tDiscovery,\tand\tIntegration),\tHAL\tand\tthe\tHAL Browser\n\nunit\ttests\n\nCohn’s\tTest\tPyramid,\tTest\tScope\n\ngoals\tof,\tUnit\tTests\n\nMarick’s\tquadrant,\tTypes\tof\tTests\n\nscope\tof,\tUnit\tTests\n\nuser\tinterfaces,\tUser\tInterfaces-A\tHybrid\tApproach\n\nAPI\tcomposition,\tAPI\tComposition\n\nAPI\tgateways,\tBackends\tfor\tFrontends\n\nAPI\tgranularity,\tToward\tDigital\n\nCohn’s\tTest\tPyramid,\tTest\tScope\n\n(see\talso\tend-to-end\ttests)",
      "content_length": 831,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 457,
      "content": "V\n\nconstraints,\tConstraints\n\nevolution\tof,\tUser\tInterfaces\n\nfragment\tcomposition,\tUI\tFragment\tComposition\n\nhybrid\tapproaches,\tA\tHybrid\tApproach\n\nVagrant,\tVagrant\n\nversioning,\tVersioning-Use\tMultiple\tConcurrent\tService\tVersions\n\ncatching\tbreaking\tchanges\tearly,\tCatch\tBreaking\tChanges\tEarly\n\ncoexisting\tdifferent\tendpoints,\tCoexist\tDifferent\tEndpoints\n\ndeferring\tbreaking\tchanges,\tDefer\tIt\tfor\tas\tLong\tas\tPossible\n\nmultiple\tconcurrent\tversions,\tUse\tMultiple\tConcurrent\tService\tVersions\n\nsemantic,\tUse\tSemantic\tVersioning\n\nvertical\tscaling,\tGo\tBigger\n\nvirtual\tprivate\tclouds\t(VPC),\tNetwork\tSegregation\n\nvirtualization\n\nhypervisors,\tTraditional\tVirtualization\n\ntraditional,\tTraditional\tVirtualization\n\ntype\t2,\tTraditional\tVirtualization\n\nvirtualization\tplatforms\n\nDocker,\tDocker\n\nLinux\tcontainers,\tLinux\tContainers\n\non-demand,\tMicroservices\n\nstorage\tarea\tnetworks\tin,\tSpreading\tYour\tRisk",
      "content_length": 884,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 458,
      "content": "W\n\nX\n\nZ\n\nVagrant,\tVagrant\n\nvision,\tSummary\n\nworker-based\tsystems,\tWorker-Based\tSystems\n\nwrite-behind\tcaches,\tCaching\tfor\tResilience\n\nXML,\tJSON,\tXML,\tor\tSomething\tElse?\n\nZed\tAttack\tProxy\t(ZAP),\tBaking\tSecurity\tIn\n\nZipkin,\tCorrelation\tIDs\n\nZookeeper,\tZookeeper",
      "content_length": 258,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 459,
      "content": "About\tthe\tAuthor\n\nSam\tNewman\tis\ta\ttechnologist\tat\tThoughtWorks,\twhere\the\tcurrently\tsplits\this\ttime between\thelping\tclients\tand\tworking\tas\tan\tarchitect\tfor\tThoughtWorks’\town\tinternal systems.\tHe\thas\tworked\twith\ta\tvariety\tof\tcompanies\tin\tmultiple\tdomains\taround\tthe world,\toften\twith\tone\tfoot\tin\tthe\tdeveloper\tworld,\tand\tanother\tin\tthe\tIT\toperations\tspace. If\tyou\tasked\thim\twhat\the\tdoes,\the’d\tsay,\t“I\twork\twith\tpeople\tto\tbuild\tbetter\tsoftware systems.”\tHe\thas\twritten\tarticles,\tpresented\tat\tconferences,\tand\tsporadically\tcommits\tto open\tsource\tprojects.",
      "content_length": 551,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 460,
      "content": "Colophon\n\nThe\tanimals\ton\tthe\tcover\tof\tBuilding\tMicroservices\tare\thoney\tbees\t(of\tthe\tgenus\tApis).\tOf 20,000\tknown\tspecies\tof\tbees,\tonly\tseven\tare\tconsidered\thoney\tbees.\tThey\tare\tdistinct because\tthey\tproduce\tand\tstore\thoney,\tas\twell\tas\tbuilding\thives\tfrom\twax.\tBeekeeping\tto collect\thoney\thas\tbeen\ta\thuman\tpursuit\tfor\tthousands\tof\tyears.\n\nHoney\tbees\tlive\tin\thives\twith\tthousands\tof\tindividuals\tand\thave\ta\tvery\torganized\tsocial structure.\tThere\tare\tthree\tcastes:\tqueen,\tdrone,\tand\tworker.\tEach\thive\thas\tone\tqueen,\twho remains\tfertile\tfor\t3–5\tyears\tafter\ther\tmating\tflight,\tand\tlays\tup\tto\t2,000\teggs\tper\tday. Drones\tare\tmale\tbees\twho\tmate\twith\tthe\tqueen\t(and\tdie\tin\tthe\tact\tbecause\tof\ttheir\tbarbed sex\torgans).\tWorker\tbees\tare\tsterile\tfemales\twho\tfill\tmany\troles\tduring\ttheir\tlifetime,\tsuch as\tnursemaid,\tconstruction\tworker,\tgrocer,\tguard,\tundertaker,\tand\tforager.\tForaging worker\tbees\tcommunicate\twith\tone\tanother\tby\t“dancing”\tin\tparticular\tpatterns\tto\tshare information\tabout\tnearby\tresources.\n\nAll\tthree\tcastes\tof\thoney\tbee\tare\tsimilar\tin\tappearance,\twith\twings,\tsix\tlegs,\tand\ta\tbody segmented\tinto\ta\thead,\tthorax,\tand\tabdomen.\tThey\thave\tshort\tfuzzy\thairs\tin\ta\tstriped yellow\tand\tblack\tpattern.\tTheir\tdiet\tis\tmade\tup\texclusively\tof\thoney,\twhich\tis\tcreated\tby\ta process\tof\tpartially\tdigesting\tand\tregurgitating\tsugar-rich\tflower\tnectar.\n\nBees\tare\tcrucial\tto\tagriculture,\tas\tthey\tpollinate\tcrops\tand\tother\tflowering\tplants\twhile they\tcollect\tpollen\tand\tnectar.\tOn\taverage,\teach\thive\tof\tbees\tgathers\t66\tpounds\tof\tpollen\ta year.\tIn\trecent\tyears,\tthe\tdecline\tof\tmany\tbee\tspecies\thas\tbeen\tcause\tfor\tconcern\tand\tis known\tas\t“colony\tcollapse\tdisorder.”\tIt\tis\tstill\tunclear\twhat\tis\tcausing\tthis\tdie-off:\tsome theories\tinclude\tparasites,\tinsecticide\tuse,\tor\tdisease,\tbut\tno\teffective\tpreventative measures\thave\tbeen\tfound\tto\tdate.\n\nMany\tof\tthe\tanimals\ton\tO’Reilly\tcovers\tare\tendangered;\tall\tof\tthem\tare\timportant\tto\tthe world.\tTo\tlearn\tmore\tabout\thow\tyou\tcan\thelp,\tgo\tto\tanimals.oreilly.com.\n\nThe\tcover\timage\tis\tfrom\tJohnson’s\tNatural\tHistory.\tThe\tcover\tfonts\tare\tURW\tTypewriter and\tGuardian\tSans.\tThe\ttext\tfont\tis\tAdobe\tMinion\tPro;\tthe\theading\tfont\tis\tAdobe\tMyriad Condensed;\tand\tthe\tcode\tfont\tis\tDalton\tMaag’s\tUbuntu\tMono.",
      "content_length": 2215,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 461,
      "content": "Preface\n\nWho\tShould\tRead\tThis\tBook\n\nWhy\tI\tWrote\tThis\tBook\n\nA\tWord\ton\tMicroservices\tToday\n\nNavigating\tThis\tBook\n\nConventions\tUsed\tin\tThis\tBook\n\nSafari®\tBooks\tOnline\n\nHow\tto\tContact\tUs\n\nAcknowledgments\n\n1.\tMicroservices\n\nWhat\tAre\tMicroservices?\n\nSmall,\tand\tFocused\ton\tDoing\tOne\tThing\tWell\n\nAutonomous\n\nKey\tBenefits\n\nTechnology\tHeterogeneity\n\nResilience\n\nScaling\n\nEase\tof\tDeployment\n\nOrganizational\tAlignment\n\nComposability\n\nOptimizing\tfor\tReplaceability\n\nWhat\tAbout\tService-Oriented\tArchitecture?\n\nOther\tDecompositional\tTechniques\n\nShared\tLibraries\n\nModules\n\nNo\tSilver\tBullet",
      "content_length": 573,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 462,
      "content": "Summary\n\n2.\tThe\tEvolutionary\tArchitect\n\nInaccurate\tComparisons\n\nAn\tEvolutionary\tVision\tfor\tthe\tArchitect\n\nZoning\n\nA\tPrincipled\tApproach\n\nStrategic\tGoals\n\nPrinciples\n\nPractices\n\nCombining\tPrinciples\tand\tPractices\n\nA\tReal-World\tExample\n\nThe\tRequired\tStandard\n\nMonitoring\n\nInterfaces\n\nArchitectural\tSafety\n\nGovernance\tThrough\tCode\n\nExemplars\n\nTailored\tService\tTemplate\n\nTechnical\tDebt\n\nException\tHandling\n\nGovernance\tand\tLeading\tfrom\tthe\tCenter\n\nBuilding\ta\tTeam\n\nSummary\n\n3.\tHow\tto\tModel\tServices\n\nIntroducing\tMusicCorp\n\nWhat\tMakes\ta\tGood\tService?\n\nLoose\tCoupling",
      "content_length": 560,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 463,
      "content": "High\tCohesion\n\nThe\tBounded\tContext\n\nShared\tand\tHidden\tModels\n\nModules\tand\tServices\n\nPremature\tDecomposition\n\nBusiness\tCapabilities\n\nTurtles\tAll\tthe\tWay\tDown\n\nCommunication\tin\tTerms\tof\tBusiness\tConcepts\n\nThe\tTechnical\tBoundary\n\nSummary\n\n4.\tIntegration\n\nLooking\tfor\tthe\tIdeal\tIntegration\tTechnology\n\nAvoid\tBreaking\tChanges\n\nKeep\tYour\tAPIs\tTechnology-Agnostic\n\nMake\tYour\tService\tSimple\tfor\tConsumers\n\nHide\tInternal\tImplementation\tDetail\n\nInterfacing\twith\tCustomers\n\nThe\tShared\tDatabase\n\nSynchronous\tVersus\tAsynchronous\n\nOrchestration\tVersus\tChoreography\n\nRemote\tProcedure\tCalls\n\nTechnology\tCoupling\n\nLocal\tCalls\tAre\tNot\tLike\tRemote\tCalls\n\nBrittleness\n\nIs\tRPC\tTerrible?\n\nREST",
      "content_length": 671,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 464,
      "content": "REST\tand\tHTTP\n\nHypermedia\tAs\tthe\tEngine\tof\tApplication\tState\n\nJSON,\tXML,\tor\tSomething\tElse?\n\nBeware\tToo\tMuch\tConvenience\n\nDownsides\tto\tREST\tOver\tHTTP\n\nImplementing\tAsynchronous\tEvent-Based\tCollaboration\n\nTechnology\tChoices\n\nComplexities\tof\tAsynchronous\tArchitectures\n\nServices\tas\tState\tMachines\n\nReactive\tExtensions\n\nDRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta\tMicroservice\tWorld\n\nClient\tLibraries\n\nAccess\tby\tReference\n\nVersioning\n\nDefer\tIt\tfor\tas\tLong\tas\tPossible\n\nCatch\tBreaking\tChanges\tEarly\n\nUse\tSemantic\tVersioning\n\nCoexist\tDifferent\tEndpoints\n\nUse\tMultiple\tConcurrent\tService\tVersions\n\nUser\tInterfaces\n\nToward\tDigital\n\nConstraints\n\nAPI\tComposition\n\nUI\tFragment\tComposition\n\nBackends\tfor\tFrontends\n\nA\tHybrid\tApproach",
      "content_length": 715,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 465,
      "content": "Integrating\twith\tThird-Party\tSoftware\n\nLack\tof\tControl\n\nCustomization\n\nIntegration\tSpaghetti\n\nOn\tYour\tOwn\tTerms\n\nThe\tStrangler\tPattern\n\nSummary\n\n5.\tSplitting\tthe\tMonolith\n\nIt’s\tAll\tAbout\tSeams\n\nBreaking\tApart\tMusicCorp\n\nThe\tReasons\tto\tSplit\tthe\tMonolith\n\nPace\tof\tChange\n\nTeam\tStructure\n\nSecurity\n\nTechnology\n\nTangled\tDependencies\n\nThe\tDatabase\n\nGetting\tto\tGrips\twith\tthe\tProblem\n\nExample:\tBreaking\tForeign\tKey\tRelationships\n\nExample:\tShared\tStatic\tData\n\nExample:\tShared\tData\n\nExample:\tShared\tTables\n\nRefactoring\tDatabases\n\nStaging\tthe\tBreak\n\nTransactional\tBoundaries\n\nTry\tAgain\tLater",
      "content_length": 583,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 466,
      "content": "Abort\tthe\tEntire\tOperation\n\nDistributed\tTransactions\n\nSo\tWhat\tto\tDo?\n\nReporting\n\nThe\tReporting\tDatabase\n\nData\tRetrieval\tvia\tService\tCalls\n\nData\tPumps\n\nAlternative\tDestinations\n\nEvent\tData\tPump\n\nBackup\tData\tPump\n\nToward\tReal\tTime\n\nCost\tof\tChange\n\nUnderstanding\tRoot\tCauses\n\nSummary\n\n6.\tDeployment\n\nA\tBrief\tIntroduction\tto\tContinuous\tIntegration\n\nAre\tYou\tReally\tDoing\tIt?\n\nMapping\tContinuous\tIntegration\tto\tMicroservices\n\nBuild\tPipelines\tand\tContinuous\tDelivery\n\nAnd\tthe\tInevitable\tExceptions\n\nPlatform-Specific\tArtifacts\n\nOperating\tSystem\tArtifacts\n\nCustom\tImages\n\nImages\tas\tArtifacts\n\nImmutable\tServers\n\nEnvironments",
      "content_length": 616,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 467,
      "content": "Service\tConfiguration\n\nService-to-Host\tMapping\n\nMultiple\tServices\tPer\tHost\n\nApplication\tContainers\n\nSingle\tService\tPer\tHost\n\nPlatform\tas\ta\tService\n\nAutomation\n\nTwo\tCase\tStudies\ton\tthe\tPower\tof\tAutomation\n\nFrom\tPhysical\tto\tVirtual\n\nTraditional\tVirtualization\n\nVagrant\n\nLinux\tContainers\n\nDocker\n\nA\tDeployment\tInterface\n\nEnvironment\tDefinition\n\nSummary\n\n7.\tTesting\n\nTypes\tof\tTests\n\nTest\tScope\n\nUnit\tTests\n\nService\tTests\n\nEnd-to-End\tTests\n\nTrade-Offs\n\nHow\tMany?\n\nImplementing\tService\tTests\n\nMocking\tor\tStubbing\n\nA\tSmarter\tStub\tService",
      "content_length": 530,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 468,
      "content": "Those\tTricky\tEnd-to-End\tTests\n\nDownsides\tto\tEnd-to-End\tTesting\n\nFlaky\tand\tBrittle\tTests\n\nWho\tWrites\tThese\tTests?\n\nHow\tLong?\n\nThe\tGreat\tPile-up\n\nThe\tMetaversion\n\nTest\tJourneys,\tNot\tStories\n\nConsumer-Driven\tTests\tto\tthe\tRescue\n\nPact\n\nIt’s\tAbout\tConversations\n\nSo\tShould\tYou\tUse\tEnd-to-End\tTests?\n\nTesting\tAfter\tProduction\n\nSeparating\tDeployment\tfrom\tRelease\n\nCanary\tReleasing\n\nMean\tTime\tto\tRepair\tOver\tMean\tTime\tBetween\tFailures?\n\nCross-Functional\tTesting\n\nPerformance\tTests\n\nSummary\n\n8.\tMonitoring\n\nSingle\tService,\tSingle\tServer\n\nSingle\tService,\tMultiple\tServers\n\nMultiple\tServices,\tMultiple\tServers\n\nLogs,\tLogs,\tand\tYet\tMore\tLogs…\n\nMetric\tTracking\tAcross\tMultiple\tServices\n\nService\tMetrics",
      "content_length": 689,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 469,
      "content": "Synthetic\tMonitoring\n\nImplementing\tSemantic\tMonitoring\n\nCorrelation\tIDs\n\nThe\tCascade\n\nStandardization\n\nConsider\tthe\tAudience\n\nThe\tFuture\n\nSummary\n\n9.\tSecurity\n\nAuthentication\tand\tAuthorization\n\nCommon\tSingle\tSign-On\tImplementations\n\nSingle\tSign-On\tGateway\n\nFine-Grained\tAuthorization\n\nService-to-Service\tAuthentication\tand\tAuthorization\n\nAllow\tEverything\tInside\tthe\tPerimeter\n\nHTTP(S)\tBasic\tAuthentication\n\nUse\tSAML\tor\tOpenID\tConnect\n\nClient\tCertificates\n\nHMAC\tOver\tHTTP\n\nAPI\tKeys\n\nThe\tDeputy\tProblem\n\nSecuring\tData\tat\tRest\n\nGo\twith\tthe\tWell\tKnown\n\nIt’s\tAll\tAbout\tthe\tKeys\n\nPick\tYour\tTargets\n\nDecrypt\ton\tDemand",
      "content_length": 610,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 470,
      "content": "Encrypt\tBackups\n\nDefense\tin\tDepth\n\nFirewalls\n\nLogging\n\nIntrusion\tDetection\t(and\tPrevention)\tSystem\n\nNetwork\tSegregation\n\nOperating\tSystem\n\nA\tWorked\tExample\n\nBe\tFrugal\n\nThe\tHuman\tElement\n\nThe\tGolden\tRule\n\nBaking\tSecurity\tIn\n\nExternal\tVerification\n\nSummary\n\n10.\tConway’s\tLaw\tand\tSystem\tDesign\n\nEvidence\n\nLoose\tand\tTightly\tCoupled\tOrganizations\n\nWindows\tVista\n\nNetflix\tand\tAmazon\n\nWhat\tCan\tWe\tDo\twith\tThis?\n\nAdapting\tto\tCommunication\tPathways\n\nService\tOwnership\n\nDrivers\tfor\tShared\tServices\n\nToo\tHard\tto\tSplit\n\nFeature\tTeams\n\nDelivery\tBottlenecks",
      "content_length": 543,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 471,
      "content": "Internal\tOpen\tSource\n\nRole\tof\tthe\tCustodians\n\nMaturity\n\nTooling\n\nBounded\tContexts\tand\tTeam\tStructures\n\nThe\tOrphaned\tService?\n\nCase\tStudy:\tRealEstate.com.au\n\nConway’s\tLaw\tin\tReverse\n\nPeople\n\nSummary\n\n11.\tMicroservices\tat\tScale\n\nFailure\tIs\tEverywhere\n\nHow\tMuch\tIs\tToo\tMuch?\n\nDegrading\tFunctionality\n\nArchitectural\tSafety\tMeasures\n\nThe\tAntifragile\tOrganization\n\nTimeouts\n\nCircuit\tBreakers\n\nBulkheads\n\nIsolation\n\nIdempotency\n\nScaling\n\nGo\tBigger\n\nSplitting\tWorkloads\n\nSpreading\tYour\tRisk\n\nLoad\tBalancing",
      "content_length": 498,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 472,
      "content": "Worker-Based\tSystems\n\nStarting\tAgain\n\nScaling\tDatabases\n\nAvailability\tof\tService\tVersus\tDurability\tof\tData\n\nScaling\tfor\tReads\n\nScaling\tfor\tWrites\n\nShared\tDatabase\tInfrastructure\n\nCQRS\n\nCaching\n\nClient-Side,\tProxy,\tand\tServer-Side\tCaching\n\nCaching\tin\tHTTP\n\nCaching\tfor\tWrites\n\nCaching\tfor\tResilience\n\nHiding\tthe\tOrigin\n\nKeep\tIt\tSimple\n\nCache\tPoisoning:\tA\tCautionary\tTale\n\nAutoscaling\n\nCAP\tTheorem\n\nSacrificing\tConsistency\n\nSacrificing\tAvailability\n\nSacrificing\tPartition\tTolerance?\n\nAP\tor\tCP?\n\nIt’s\tNot\tAll\tor\tNothing\n\nAnd\tthe\tReal\tWorld\n\nService\tDiscovery\n\nDNS",
      "content_length": 560,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 473,
      "content": "Dynamic\tService\tRegistries\n\nZookeeper\n\nConsul\n\nEureka\n\nRolling\tYour\tOwn\n\nDon’t\tForget\tthe\tHumans!\n\nDocumenting\tServices\n\nSwagger\n\nHAL\tand\tthe\tHAL\tBrowser\n\nThe\tSelf-Describing\tSystem\n\nSummary\n\n12.\tBringing\tIt\tAll\tTogether\n\nPrinciples\tof\tMicroservices\n\nModel\tAround\tBusiness\tConcepts\n\nAdopt\ta\tCulture\tof\tAutomation\n\nHide\tInternal\tImplementation\tDetails\n\nDecentralize\tAll\tthe\tThings\n\nIndependently\tDeployable\n\nIsolate\tFailure\n\nHighly\tObservable\n\nWhen\tShouldn’t\tYou\tUse\tMicroservices?\n\nParting\tWords\n\nIndex",
      "content_length": 502,
      "extraction_method": "Unstructured"
    }
  ]
}
{
  "metadata": {
    "title": "AWS Networking Cookbook - Satyajit Das",
    "author": "Satyajit Das & Jhalak Modi",
    "publisher": "Unknown Publisher",
    "edition": "1st Edition",
    "isbn": "",
    "total_pages": 544,
    "conversion_date": "2025-12-19T17:17:21.402950",
    "conversion_method": "PyMuPDF + OCR fallback",
    "source_pdf": "AWS Networking Cookbook - Satyajit Das.pdf",
    "extraction_method": "Unstructured"
  },
  "chapters": [
    {
      "number": 1,
      "title": "Segment 1 (pages 2-9)",
      "start_page": 2,
      "end_page": 9,
      "detection_method": "topic_boundary",
      "content": "Jhalak Modi\n\nBIRMINGHAM - MUMBAI\n\nOceanofPDF.com\n\nOceanofPDF.com\n\nAWS Networking Cookbook\n\nCopyright © 2017 Packt Publishing\n\nAll rights reserved. No part of this book may be reproduced, stored in a retrieval system, or transmitted in any form or by any means, without the prior written permission of the publisher, except in the case of brief quotations embedded in critical articles or reviews.\n\nEvery effort has been made in the preparation of this book to ensure the accuracy of the information presented. However, the information contained in this book is sold without warranty, either express or implied. Neither the authors, nor Packt Publishing, and its dealers and distributors will be held liable for any damages caused or alleged to be caused directly or indirectly by this book.\n\nPackt Publishing has endeavored to provide trademark information about all of the companies and products mentioned in this book by the appropriate use of capitals. However, Packt Publishing cannot guarantee the accuracy of this information.\n\nFirst published: August 2017\n\nProduction reference: 1210817\n\nPublished by Packt Publishing Ltd. Livery Place\n\n35 Livery Street Birmingham B3 2PB, UK.\n\nISBN 978-1-78712-324-3\n\nwww.packtpub.com\n\nOceanofPDF.com\n\nCredits\n\nAuthors\n\nSatyajit Das\n\nJhalak Modi\n\nReviewers\n\nAppasaheb Bagali\n\nAdrin Mukherjee\n\nLegorie Rajan\n\nCommissioning Editor\n\nVijin Boricha\n\nCopy Editor\n\nJuliana Nair\n\nProject Coordinator\n\nJudie Jose\n\nProofreader\n\nSafis Editing\n\nAcquisition Editor\n\nHeramb Bhavsar\n\nContent Development Editor\n\nDevika Battike\n\nTechnical Editor\n\nAditya Khadye\n\nIndexer\n\nAishwarya Gangawane\n\nGraphics\n\nKirk D'Penha\n\nProduction Coordinator\n\nAparna Bhagat\n\nOceanofPDF.com\n\nAbout the Authors\n\nSatyajit Das has more than sixteen years of IT experience. He is currently working as an AWS CoE lead cloud architect in a large enterprise. He has also worked as an enterprise architect, solution architect, and technical architect in recent engagements. He has guided, designed, integrated, implemented, and governed enterprise-grade applications. He works on building solutions using microservices on the hybrid cloud using DevOps principles. He has extensively worked on IoT, AWS, and cloud migration.\n\nSatyajit has worked in leading organizations, such as Wipro, Infosys, PwC, and Accenture, in various challenging roles.\n\nI would like to thank the extremely helpful and supportive editorial team at Packt, who enabled me to write my first book. I would like to thank the Wipro management team and colleagues for providing support while I was writing this book. I'll take this opportunity to thank Vipul for mentoring and motivating me to take up new challenges and learning opportunity. I would like to thank my entire family, especially my wife, Papiya, for supporting me through all the ups and downs. I would like to dedicate this book to my father, Sasadhar, who guided me and made me who I am today, and my lovely son, Shreyas, to whom I cannot give much time due to the challenges of my professional career.\n\nJhalak Modi is a DevOps, cloud architect, and an AWS trainer with a deep interest and expertise in implementing multi-tier architectures, cluster platforms, and automation solutions. She is an AWS certified solutions architect professional and a certified DevOps professional with 10+ certifications in trending technologies.\n\nJhalak is also a public speaker at various AWS events, colleges/universities, and meet-ups, and has provided AWS and Linux training at several renowned institutes and corporates. Currently, she is working with KOGENTiX and has worked with Wipro Technologies and Electromech Corporation in the past.\n\nI would like to dedicate this book to my parents for always believing in me and loving me unconditionally. Special thanks to my husband, Darshan, for his constant guidance, support, and patience. Without him, this book would be impossible. Many thanks to Karishma Modi, Hardik Modi, and my in-laws; you all mean a lot to me. Many heartfelt thanks and gratitude go out to Vipul Tankariya, Bhavin Parmar, Divya Tiwari, and my co-author, Satyajit Das, and all the mentors (Ashutosh Pancholi, Shivram Meena, Rukhsana Saifee, Anu Badola, Sadhandan PT, Jai Malhotra, and Shiksha Kanwar). Thanks to Packt's Heramb Bhavsar, Devika Battike, and team for putting up with my random schedule and making this a better book with their diligent reviewing efforts. Finally, there would be no book about AWS networking without AWS. I wish to thank the AWS team for their extraordinary documents.\n\nOceanofPDF.com",
      "page_number": 2
    },
    {
      "number": 2,
      "title": "Segment 2 (pages 10-24)",
      "start_page": 10,
      "end_page": 24,
      "detection_method": "topic_boundary",
      "content": "About the Reviewers\n\nAppasaheb Bagali is an AWS solution architect working with enterprise customers. His love for computers drove him to pursue a master's degree in computer application (MCA) and has not looked back ever since. He started his career as a web developer, and is currently working as an AWS solutions architect and helps customers understand how to transform their IT infrastructure, operations, and applications to make the most of the scalability, innovation, and cost efficiency of the AWS platform. He loves to hack around DevOps and automation using Puppet and AWS CloudFormation.\n\nHe lives in Banglore with his wife, Sandhya, and son, Pritam.\n\nAdrin Mukherjee is a passionate software engineer and a technical architect with expertise in building distributed applications and high- performance systems. He has 13 years of experience in the IT industry and is presently working as a solution architect at Wipro.\n\nHis current focus is on cloud computing, NoSQL, and machine learning.\n\nLegorie Rajan is a cloud consultant working with enterprise customers in the banking and insurance domains. He started his career as a mainframe developer and is currently working as a solution architect on the cloud and helps with migration of applications to the cloud. He loves to hack around with new languages; his current side projects use NodeJs, Mongo, and Kubernetes. He has a B.Tech (CS) from Pondicherry University and MS (Mgmt) from Grenoble Graduate School of Business.\n\nHe lives in Chennai with his wife, Anitha Sophie, and son, Reuel Bepin.\n\nOceanofPDF.com\n\nwww.PacktPub.com\n\nFor support files and downloads related to your book, please visit www.PacktP ub.com.\n\nDid you know that Packt offers eBook versions of every book published, with PDF and ePub files available? You can upgrade to the eBook version at www.PacktPub.com and as a print book customer, you are entitled to a discount on the eBook copy. Get in touch with us at service@packtpub.com for more details.\n\nAt www.PacktPub.com, you can also read a collection of free technical articles, sign up for a range of free newsletters and receive exclusive discounts and offers on Packt books and eBooks.\n\nhttps://www.packtpub.com/mapt\n\nGet the most in-demand software skills with Mapt. Mapt gives you full access to all Packt books and video courses, as well as industry-leading tools to help you plan your personal development and advance your career.\n\nOceanofPDF.com\n\nWhy subscribe?\n\nFully searchable across every book published by Packt Copy and paste, print, and bookmark content On demand and accessible via a web browser\n\nOceanofPDF.com\n\nCustomer Feedback\n\nThanks for purchasing this Packt book. At Packt, quality is at the heart of our editorial process. To help us improve, please leave us an honest review on this book's Amazon page at https://www.amazon.com/dp/1787123243.\n\nIf you'd like to join our team of regular reviewers, you can e-mail us at customerreviews@packtpub.com. We award our regular reviewers with free eBooks and videos in exchange for their valuable feedback. Help us be relentless in improving our products!\n\nOceanofPDF.com\n\nTable of Contents\n\nPreface\n\nWhat this book covers\n\nWhat you need for this book\n\nWho this book is for\n\nSections\n\nGetting ready\n\nHow to do it…\n\nHow it works…\n\nThere's more…\n\nSee also\n\nConventions\n\nReader feedback\n\nCustomer support\n\nDownloading the example code\n\nDownloading the color images of this book\n\nErrata\n\nPiracy\n\nQuestions\n\n1. Getting Started with AWS Networking Components\n\nIntroduction\n\nVarious AWS network services\n\nCreating an account in AWS\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nCreating an admin user in AWS\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nCreating a VPC and a subnet with IPv6\n\nGetting ready\n\nHow to do it...\n\nCreating an EC2 with an IPv6 address\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nCreating NAT on EC2 instance\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nWorking with network interfaces\n\nGetting ready\n\nHow to do it...\n\nConfiguring AWS CLI\n\nGetting ready\n\nHow to do it...\n\n2. Building Your Own Custom VPC\n\nIntroduction\n\nManaging a VPC\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nManaging public and private subnets\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nManaging a Network ACL\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nManaging a Security Group\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nManaging an Internet Gateway\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nManaging a NAT Gateway\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nManaging a Route Table\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nManaging EC2 instances\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more... 3. VPC Advanced Components Introduction\n\nAssigning multiple IPs to an instance and ENI\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nAccessing an instance within the network\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nAccessing an instance from outside AWS\n\nGetting ready\n\nHow to do it...\n\nCreating an application ELB\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nCreating a launch configuration\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nCreating an Auto Scaling group\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nCreating VPC peering\n\nGetting ready\n\nHow to do it...\n\nAccepting VPC peering\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nConfiguring routes between multiple VPCs peered together\n\nLimitations of VPC peering connection\n\nControlling access to VPC peering connections\n\nConfiguring VPN connections to your Amazon VPC\n\nGetting ready\n\nHow to do it...\n\n4. Configuring Global Scale Infrastructure\n\nIntroduction\n\nCreating a VPC and subnet from the CLI\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nCreating a VPC to DC connectivity--VPN Tunneling\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nCreating a VPC with a private subnet and connecting DC\n\nGetting ready\n\nHow to do it...\n\nCreating a multi-region VPC communication\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nSetting up a private DNS with a VPC\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nMigrating to IPv6\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\n5. Working with Infrastructure Automation\n\nIntroduction\n\nInfrastructure as a Service\n\nWhy do we need to automate?\n\nInfrastructure automation tools\n\nCreating, storing, and testing the template--CloudFormation\n\nGetting ready\n\nHow to do it...\n\nCreating the template\n\nVPC\n\nSubnet\n\nInternet Gateway\n\nElastic IP\n\nNat Gateway\n\nStoring the template\n\nTesting the JSON template\n\nThere's more...\n\nCreating a new stack--CloudFormation\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nModify the stack--CloudFormation\n\nGetting ready\n\nHow to do it...\n\nUsing change sets\n\nUsing direct update\n\nDeleting the stack--CloudFormation\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nSetting up Ansible\n\nGetting ready\n\nHow to do it...\n\nInstalling Ansible\n\nCreating Ansible playbooks for creating VPC\n\nHow to do it...\n\nThere's more...\n\n6. Working with Route 53\n\nIntroduction\n\nHow does Route 53 DNS works?\n\nSupported DNS resource record types\n\nAlias resource record\n\nRouting policies\n\nRegistering a new domain\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nTransferring a domain into Amazon Route 53\n\nGetting ready\n\nHow to do it...\n\nCreating hosted zones and record sets\n\nGetting ready\n\nHow to do it...\n\nDeleting a public hosted zone\n\nGetting ready\n\nHow to do it...\n\nCreating an Alias record set\n\nHow to do it...\n\nThere's more...\n\nCreating a private hosted zone\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nWorking with the weighted routing policy\n\nHow to do it...\n\nHow it works...\n\nWorking with the failover routing policy and health checks\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\n7. Cloud Security and Network Compliance\n\nIntroduction\n\nTypes of attack\n\nSetting up CloudFront--EC2 origin\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nSetting up CloudFront--S3 origin\n\nHow to do it...\n\nThere's more...\n\nGeographic restrictions with Amazon CloudFront\n\nHow to do it...\n\nHow it works...\n\nCustomizing error responses in CloudFront\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nSetting up CloudWatch monitoring\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nSetting up ELB and Auto Scaling\n\nHow to do it...\n\nHow it works...\n\nTrusted Advisor\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nProtecting log information--sending logs to CloudWatch\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nStarting CloudTrail\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nSubmitting a penetration testing request\n\nGetting ready\n\nHow to do it...\n\n8. Troubleshooting and VPC Limits\n\nIntroduction\n\nTroubleshooting IP address overlapping\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nErrors while connecting an EC2 instance in a VPC\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nInternet not accessible in the instance\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nInternet not accessible in the private subnet instance (NAT Gateway)\n\nHow to do it...\n\nNot able to delete a VPC\n\nGetting ready\n\nHow to do it...\n\nEnabling VPC flow logs\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nIncreasing VPC Limits\n\nGetting ready\n\nHow to do it... 9. Pricing of VPC and Related Components\n\nIntroduction\n\nVPC, VPN and Nat Gateway pricing\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nEC2, ELB and Elastic IP pricing\n\nGetting ready\n\nHow to do it...\n\nRoute 53 pricing\n\nGetting ready\n\nHow to do it...\n\nDirect Connect pricing\n\nGetting ready\n\nHow to do it...\n\nCloudFront pricing\n\nGetting ready\n\nHow to do it...\n\nWAF and Cloud Shield pricing\n\nGetting ready\n\nHow to do it...\n\nOceanofPDF.com\n\nPreface\n\nThere is no debate on the fact that Cloud is going to be the default infrastructure provider as it provides numerous benefits. The most important aspects of cloud computing are as follows:\n\nMassive scale: This can virtually serve resources for all programming needs to anyone without the need to build a massive scale computing infrastructure On demand access: The resources can be provisioned by self-service instantly when required and released when not needed any more\n\nCloud computing is being used by organizations to do the following:\n\nIncrease agility of the organization through purchase provision deploy and manage applications, services dynamically and secure support in real time based on demand without managing compute, network and other resources Cut overall cost of ownership and upfront investment for resources and pay only for the resources being used Utilize software tools and services as per the requirement offered by cloud providers instead of purchasing and owning them Reduced time to market products and services due to reduced time cycle for accruing infrastructure resources to build and deploy them Increase in reliability and availability as cloud providers offer multiple data centers that can be used for disaster recovery options if some data center goes down\n\nThat's why organizations are thinking about cloud first approach for hosting their services in cloud. AWS is the most popular public cloud service. It's a challenge for architects and DevOps professionals for building infrastructure in AWS right the first time itself. This book will provide a practical and simple-to-follow approach for creating, managing, and automating AWS networking components. It will also provide insight's best",
      "page_number": 10
    },
    {
      "number": 3,
      "title": "Segment 3 (pages 25-33)",
      "start_page": 25,
      "end_page": 33,
      "detection_method": "topic_boundary",
      "content": "use of different AWS networking services. We'll start simple so that it's easy for first timers. However, we'll dive deep into various AWS networking- related services that are expected out of a seasoned AWS professional.\n\nOceanofPDF.com\n\nWhat this book covers\n\nChapter 1, Getting Started with AWS Networking Components, helps first timers to create AWS account and users. It guides readers for creating simple AWS networking components from Console and creating first EC2 instance in AWS. It also guides to configure AWS CLI.\n\nChapter 2, Building Your Own Custom VPC, walks through all the necessary steps to different network components in AWS. It guides how to build subnetworks, firewalls, and routing in AWS. It also provides a recipe for creating and connecting to your instance hosted in AWS.\n\nChapter 3, VPC Advanced Components, provides advanced recipes for adding multiple network interfaces to EC2, connecting to Windows and Linux instance. Then it guides to create high available solutions through horizontal scaling using load balancer and launch configuration. It also provides a recipe for connecting multiple VPCs in a region.\n\nChapter 4, Configuring Global Scale Infrastructure, focuses on creating global scale network infrastructure by connecting VPCs across AWS regions or creating a communication channel between VPC and the corporate data center. It also provides a recipe for creating network components from CLI and how to make AWS resources IPv6 compliant.\n\nChapter 5, Working with Infrastructure Automation, provides flexibility to automate network resources such as VPC, subnet, and NAT gateway using Cloudformation and Ansible. Don’t worry, this chapter also explains how to set up Cloudformation and Ansible and related playbooks. There are various sample playbooks for you to play with.\n\nChapter 6, Working with Route 53, gives an overall understanding of how DNS works and the different routing policies. This recipe will guide you from buying a domain to creating a highly available DNS routing. This\n\nchapter also covers setting up private DNS and monitoring the DNS resources.\n\nChapter 7, Cloud Security and Network Compliance, turns your attention to security. This chapter will help you understand how to prevent and mitigate various attacks such as DDOS and Port scanning using different AWS services (CloudFront, Elastic Load Balancer, Auto Scaling Group, CloudWatch, Trusted Advisor, and CloudTrail)\n\nChapter 8, Troubleshooting and VPC Limits, concentrates various troubleshooting and support issues. It covers most common error messages and configuration problems. The chapter also includes information on how and where you can get support to increase the VPC resource limits\n\nChapter 9, Pricing of VPC and Related Components, guides you to calculate pricing of the infrastructure that you are going to build in AWS.\n\nOceanofPDF.com\n\nWhat you need for this book\n\nThis book assumes basic-level knowledge on Linux operating system and cloud computing. The book will go through building different networking components in AWS, which may require a basic understanding of networking and virtualization concepts. If you have an experience of networking concepts, this is a big plus.\n\nMost of the recipes provided in the book for networking components are provided by AWS and require AWS console access. For this you need moderate network connectivity to the internet. Some of the recipes that are executed on the local system are also very lightweight and can be executed on any laptop or desktop with decent configuration. Sample hardware or virtual requirements are listed as follows:\n\nCPU: 4 cores Memory: 8 GB RAM Disk space: 80 GB\n\nIn this book, you will need the following software list:\n\nAWS Tools—AWS CLI Putty and puttygen Internet Browser Ansible Python 2.7+ Pip EPEL Repo Curl / wget\n\nOceanofPDF.com\n\nWho this book is for\n\nTo make use of the content of this book, basic prior knowledge of Cloud and networking is expected. If you do not possess that knowledge, it is always possible to catch up the basic requirements by going through the major components from the AWS documentation at https://aws.amazon.com/docum entation/. This covers all the AWS services used in this book and much more. This book is essentially intended to AWS developers, architects, network professionals and DevOps engineers who want a quick start for creating basic infrastructure in the AWS cloud. It will also provide you the steps for creating a global scale production-ready infrastructure using AWS console and Automation tools (CloudFormation and Ansible).\n\nOceanofPDF.com\n\nSections\n\nIn this book, you will find several headings that appear frequently (Getting ready, How to do it…, How it works…, There's more…, and See also). To give clear instructions on how to complete a recipe, we use these sections as follows:\n\nOceanofPDF.com\n\nGetting ready\n\nThis section tells you what to expect in the recipe, and describes how to set up any software or any preliminary settings required for the recipe.\n\nOceanofPDF.com\n\nHow to do it…\n\nThis section contains the steps required to follow the recipe.\n\nOceanofPDF.com\n\nHow it works…\n\nThis section usually consists of a detailed explanation of what happened in the previous section.\n\nOceanofPDF.com",
      "page_number": 25
    },
    {
      "number": 4,
      "title": "Segment 4 (pages 34-41)",
      "start_page": 34,
      "end_page": 41,
      "detection_method": "topic_boundary",
      "content": "There's more…\n\nThis section consists of additional information about the recipe in order to make the reader more knowledgeable about the recipe.\n\nOceanofPDF.com\n\nSee also\n\nThis section provides helpful links to other useful information for the recipe.\n\nOceanofPDF.com\n\nConventions\n\nIn this book, you will find a number of text styles that distinguish between different kinds of information. Here are some examples of these styles and an explanation of their meaning.\n\nCode words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles are shown as follows: \"Add 0.0.0.0/0 in the destination.\"\n\nA block of code is set as follows:\n\n#!/bin/bash yum update -y yum install -y httpd24 php56 mysql55-server php56-mysqlnd service httpd start chkconfig httpd on groupadd\n\nWhen we wish to draw your attention to a particular part of a code block, the relevant lines or items are set in bold:\n\n[root@ansible playbook]# vim awsvpc.yml --- - name: Create VPC hosts: localhost gather_facts: no roles: - vpc\n\nAny command-line input or output is written as follows:\n\nmysql -u root -p\n\nNew terms and important words are shown in bold. Words that you see on the screen, for example, in menus or dialog boxes, appear in the text like this: \"Click on the button Create an AWS Account. \"\n\nWarnings or important notes appear like this.\n\nTips and tricks appear like this.\n\nOceanofPDF.com\n\nReader feedback\n\nFeedback from our readers is always welcome. Let us know what you think about this book-what you liked or disliked. Reader feedback is important for us as it helps us develop titles that you will really get the most out of. To send us general feedback, simply e-mail feedback@packtpub.com, and mention the book's title in the subject of your message. If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, see our author guide at www.packtpub.com/authors.\n\nOceanofPDF.com\n\nCustomer support\n\nNow that you are the proud owner of a Packt book, we have a number of things to help you to get the most from your purchase.\n\nOceanofPDF.com\n\nDownloading the example code\n\nYou can download the example code files for this book from your account at http://www.packtpub.com. If you purchased this book elsewhere, you can visit h ttp://www.packtpub.com/support, and register to have the files e-mailed directly to you. You can download the code files by following these steps:\n\n1. Log in or register to our website using your e-mail address and password.\n\n2. Hover the mouse pointer on the SUPPORT tab at the top. 3. Click on Code Downloads & Errata. 4. Enter the name of the book in the Search box. 5. Select the book for which you're looking to download the code files. 6. Choose from the drop-down menu where you purchased this book from.\n\n7. Click on Code Download.\n\nYou can also download the code files by clicking on the Code Files button on the book's webpage at the Packt Publishing website. This page can be accessed by entering the book's name in the Search box. Please note that you need to be logged in to your Packt account. Once the file is downloaded, please make sure that you unzip or extract the folder using the latest version of:\n\nWinRAR / 7-Zip for Windows Zipeg / iZip / UnRarX for Mac 7-Zip / PeaZip for Linux\n\nThe code bundle for the book is also hosted on GitHub at https://github.com/Packt Publishing/AWS-Networking-Cookbook. We also have other code bundles from our rich catalog of books and videos available at https://github.com/PacktPublishing/. Check them out!\n\nOceanofPDF.com\n\nDownloading the color images of this book\n\nWe also provide you with a PDF file that has color images of the screenshots/diagrams used in this book. The color images will help you better understand the changes in the output. You can download this file from https://www.packtpub.com/sites/default/files/downloads/AWSNetworkingCookbook_ColorIm ages.pdf.\n\nOceanofPDF.com",
      "page_number": 34
    },
    {
      "number": 5,
      "title": "Segment 5 (pages 42-49)",
      "start_page": 42,
      "end_page": 49,
      "detection_method": "topic_boundary",
      "content": "Errata\n\nAlthough we have taken every care to ensure the accuracy of our content, mistakes do happen. If you find a mistake in one of our books-maybe a mistake in the text or the code-we would be grateful if you could report this to us. By doing so, you can save other readers from frustration and help us improve subsequent versions of this book. If you find any errata, please report them by visiting http://www.packtpub.com/submit-errata, selecting your book, clicking on the Errata Submission Form link, and entering the details of your errata. Once your errata are verified, your submission will be accepted and the errata will be uploaded to our website or added to any list of existing errata under the Errata section of that title. To view the previously submitted errata, go to https://www.packtpub.com/books/content/support, and enter the name of the book in the search field. The required information will appear under the Errata section.\n\nOceanofPDF.com\n\nPiracy\n\nPiracy of copyrighted material on the Internet is an ongoing problem across all media. At Packt, we take the protection of our copyright and licenses very seriously. If you come across any illegal copies of our works in any form on the Internet, please provide us with the location address or website name immediately so that we can pursue a remedy. Please contact us at copyright@packtpub.com with a link to the suspected pirated material. We appreciate your help in protecting our authors and our ability to bring you valuable content.\n\nOceanofPDF.com\n\nQuestions\n\nIf you have a problem with any aspect of this book, you can contact us at questions@packtpub.com, and we will do our best to address the problem.\n\nOceanofPDF.com\n\nGetting Started with AWS Networking Components\n\nIn this chapter, we'll cover the following recipes:\n\nCreating an account in AWS Creating an admin user in AWS Creating a VPC and a subnet with IPv6 Creating an EC2 with an IPv6 address Creating NAT on EC2 instance Working with network interfaces Configuring AWS CLI\n\nOceanofPDF.com\n\nIntroduction\n\nPublic cloud computing is a service that can be accessed over the internet. It provides resources, on a shared basis, for hosting applications and data on distributed computing resources. Cloud providers host a pool of services for computer servers, storages, networks, application platforms and software services that are assigned to customers based on their needs. Cloud providers take responsibility of managing computing resources so that customers can concentrate on building applications or services quickly. AWS is the biggest public cloud service provider.\n\nAWS provides most of the networking services that we are going to explore for free. It also lets customers experiment with some of the other services for free at a lower scale. We need to have an account and the required permissions in AWS to execute the recipes provided throughout this book. Creating some of the services may cost some money, so please look into the AWS pricing page (https://aws.amazon.com/pricing/services/) for different services and understand the cost impact that execution of some recipes will have.\n\nOceanofPDF.com\n\nVarious AWS network services\n\nIn this section, we shall come to understand the building blocks of AWS Cloud. We are going to use or create the following components through this book.\n\nRegion: AWS Cloud currently has data centers in 16 cities and is also coming up in new locations throughout the world. Each region is completely isolated from the others. You need to choose one region to create network components. Availability Zone (AZ): Each region of AWS Cloud has multiple physically isolated and separate data centers called availability zone. Some network components span across multiple AZs in a region like VPC. Components like subnet are confined within an AZ. AWS provides various networking services as Platform as a Service (PaaS). Examples are:\n\nRoute 53: Distributed, scalable and highly available Domain Name System (DNS) Direct connect: This provides a dedicated low latency and high bandwidth network connectivity between a data center and an AWS VPC. ELB: This is a high availablility and scalable load balancing service provided by AWS. AWS VPC: VPC is a virtual network built in the AWS Cloud similar to a network in a data center. It is isolated from other VPCs that are created in your account or other accounts. You can choose the Classless Inter-Domain Routing (CIDR) range of the VPC and can create instances with the IP address within that range. Virtual Routing and Forwarding (VRF) in conventional networking is equivalent to a VPC in AWS, whereas VLAN is synonymous to a subnet. You can isolate instances in separate VLANs or subnets.\n\nThe following figure gives the default VPC components which include Internet gateway, Virtual private gateway, Router, Route table, Subnet, Network ACL and Security group.\n\nAWS VPC high level components\n\nSource: http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/images/security-diagram.png\n\nOceanofPDF.com\n\nCreating an account in AWS\n\nWe are going to create an AWS account in this section. Please skip this section if you already have an AWS account. Otherwise, please follow the step by step process to create an account with AWS.\n\nOceanofPDF.com",
      "page_number": 42
    },
    {
      "number": 6,
      "title": "Segment 6 (pages 50-58)",
      "start_page": 50,
      "end_page": 58,
      "detection_method": "topic_boundary",
      "content": "Getting ready\n\nBe ready with your credit card information.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Please open the URL https://aws.amazon.com/account/ in your favorite browser. 2. Click on the button Create an AWS Account. 3. You will see a page which looks like the following figure. Provide your email or mobile number, select the option I am a new user and click on Sign in using our secure server. The email ID provided here will be treated as the owner or root user for this account and has exclusive rights to do anything in the account.\n\nCreate account--Provide mail or mobile\n\n4. You will get a page like this. Provide the required details and click on Create account.\n\nCreate account--Provide personal details\n\n5. Provide additional details for your account.\n\nCreate account--Provide contact information\n\n6. Provide payment information for billing purposes.\n\nCreate account--Provide payment information\n\n7. Provide identity verification. There will be an automated call initiated by AWS to your phone number and you will need to key in the verification code shown on the screen.\n\nCreate account--provide identity verification\n\n8. Choose Support Plan and click on Continue.\n\nCreate account--Choose support plan\n\n9. You will see a welcome screen and can log in to the AWS console by clicking on Sign In to the Console. You'll also receive an email confirmation for the account creation.\n\nCreate account--Registration confirmation\n\n10. After login, you will see a screen like the following:\n\nAWS dashboard\n\nOceanofPDF.com\n\nThere's more...\n\nOnce you decide to delete your account, you can do so by logging in to your account; see the following figure:\n\nDelete account\n\nOceanofPDF.com",
      "page_number": 50
    },
    {
      "number": 7,
      "title": "Segment 7 (pages 59-67)",
      "start_page": 59,
      "end_page": 67,
      "detection_method": "topic_boundary",
      "content": "Creating an admin user in AWS\n\nOnce the account is created, we should not use it for anything apart from creating an admin user and handling billing related information. A strong password policy and multi-factor authentication (MFA) should be configured for all powerful users. We shall go through the steps to create an admin user. We shall use this user credential for executing recipes for different network elements in AWS. More stringent processes and methods should be followed for creating and managing users in AWS for production purposes.\n\nOceanofPDF.com\n\nGetting ready\n\nLog in to the AWS account with user credentials.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Select Identity and Access Management (IAM) service from the console by typing https://console.aws.amazon.com/iam/ in the browser. You will see the URL that the user other than the root user will need to use for console access.\n\nURL for AWS console login URL\n\n2. Click on Users in the left menu and then click on Add user.\n\nUser dashboard\n\n3. Provide a username of your choice. Opt for both programmatic and console access. Select other relevant options and click on Next: Permission.\n\nAdd user in IAM\n\n4. Choose the option Attach existing policies directly. Choose AdministratorAccess and then click Next: Review.\n\nChoose permission\n\n5. Review the details and click on Create User.\n\nReview create user\n\n6. Download and store the .csv file in a safe place. The file contains user access key details and console login link. User access information is required for AWS service access through program or CLI. It will be used in the later part of the book.\n\nUser access key details\n\nOceanofPDF.com\n\nThere's more...\n\nThe user access details can be used for accessing AWS from Command Line Interface (CLI). Scripts can be written using CLI and can be used as code for managing AWS infrastructure.\n\nOceanofPDF.com\n\nCreating a VPC and a subnet with IPv6\n\nIn this section, we shall be creating a VPC and a subnet using wizard to get started quickly.\n\nOceanofPDF.com\n\nGetting ready\n\nWe need an AWS account and a user with the proper permissions for creating a VPC and a subnet.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to your AWS account. Select VPC in AWS services as shown in the following figure:\n\nSelect VPC from AWS console\n\n2. Click on Start VPC Wizard.\n\nVPC dashboard\n\n3. VPC wizard will appear with four options. Now, we shall choose the first one to create our first VPC and subnet. Click on the Select button.\n\nVPC Wizard",
      "page_number": 59
    },
    {
      "number": 8,
      "title": "Segment 8 (pages 68-75)",
      "start_page": 68,
      "end_page": 75,
      "detection_method": "topic_boundary",
      "content": "4. We need to choose Amazon provided IPv6 CIDR block to enable IPv6 for VPC. For a subnet in a drop-down menu Public subnet's IPv6 CIDR: we need to select Specify a custom IPv6 CIDR. Key in the VPC and subnet names. Keep other options unchanged. Click on th Create VPC button.\n\nCreate VPC and subnet with IPv6\n\n5. A success message will be displayed as following:\n\nVPC and subnet creation success message\n\n6. Click on Your VPCs in the left menu. The VPC will be displayed. If you choose to see details, you can see that a Network ACL and Route table has been automatically created.\n\nSummary of VPC created\n\n7. Click on Subnets on the left menu bar. You will be able to see the subnet that was just created. If you choose to see details, you can see that a Network ACL and Route table that is automatically created.\n\nSummary of subnet created\n\n8. Click on the Route Table tab. You can see that the Route Table includes four entries. Two for internal IPv4 and IPv6 communication and two internet gateways (starting with igw) for communication with the outside world for IPv4 and IPv6.\n\nRoute Table of subnet created\n\n9. Click on the Network ACL tab. You can see that all traffic for both IPv4 and IPv6 has been allowed. We shall learn how to configure the rules in the later section of the book.\n\nNetwork ACL of subnet created\n\nOceanofPDF.com\n\nCreating an EC2 with an IPv6 address\n\nIn this section, we shall be creating an EC2 instance with an IPv6 address in the VPC and subnet that we created using the wizard. EC2 is a virtual machine in AWS that comes as an IaaS offering. You can choose different virtual machine images called Amazon Machine Image (AMI) or create your own custom AMI for creating an EC2 instance. We shall also install a web server to test if our steps are correct.\n\nOceanofPDF.com\n\nGetting ready\n\nWe need an AWS account and user with proper permissions for creating an EC2 instance.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to your AWS account. Select EC2 services as shown in the following figure:\n\nSelect EC2 service\n\n2. The EC2 dashboard will appear. Click on Launch Instance in the EC2 dashboard.\n\nEC2 dashboard\n\n3. Select Amazon Linux AMI, which is available on the top of the list\n\nChoose AMI\n\n4. There are many instance types available with different vCPU and memory options. We shall choose t2.micro and then click on Next: Configure Instance Details.\n\nChoose instance type\n\n5. In Network, choose the VPC we just created. In Subnet, select the subnet we created. In Auto-assign Public IP, choose Enable. In Auto- assign IPv6 IP, choose Enable. Click on Next: Add Storage.\n\nChoose network\n\n6. Click on the Advanced Details and put the following lines in the text box. This is user data. This may vary with the OS of EC2. The script is executed when the instance is first created. Here is a script that can execute on Linux. It will install Apache, PHP, and MySQL in the server. It will also start the Apache server once the EC2 is running.\n\n#!/bin/bash yum update -y yum install -y httpd24 php56 mysql55-server php56-mysqlnd service httpd start chkconfig httpd on groupadd www usermod -a -G www ec2-user chown -R root:www /var/www chmod 2775 /var/www find /var/www -type d -exec chmod 2775 {} + find /var/www -type f -exec chmod 0664 {} + echo \"<?php phpinfo(); ?>\" > /var/www/html/phpinfo.php\n\n7. Accept the default option and click Next: Add Tags.",
      "page_number": 68
    },
    {
      "number": 9,
      "title": "Segment 9 (pages 76-86)",
      "start_page": 76,
      "end_page": 86,
      "detection_method": "topic_boundary",
      "content": "Add Storage\n\n8. Click on Add Tags. In Key, put Name and in Value, put MyFirstEC2. Click on Next: Configure Security Group.\n\nAdd Tags\n\n9. Provide a Security group name and Description. By default, SSH is open to all IP addresses. In Source, we have two CIDR ranges, 0.0.0.0/0 to allow all IPv4 addresses and ::/0 to allow all IPv6 addresses. Click on Add Rule and allow HTTP traffic to all source. We should not be opening our servers to all like this, however for simplicity, let's do this for now. Click on Review and Launch.\n\nConfigure Security Group\n\n10. Review the details and click Launch.\n\nReview instance launch\n\n11. We can optionally create a key pair. Key information is required if we want to log into EC2. Download Key Pair and store it in a safe place. Click on Launch Instances.\n\nCreate Key Pair\n\n12. You can see a success message with the EC2 instance ID. Click on the ID. It will take us to the EC2 console. The instance will be in running condition in some time.\n\nEC2 launch status\n\n13. We can see both Public DNS (IPv4) and IPv6 IPs. We can create URL to access page running on EC2: http:// DNS(IPv4)/phpinfo.php. Replace the DNS (IPv4) in the URL with the one you see in the console. Open a browser and paste the URL.\n\nEC2 instance detail\n\n14. We can see the page of the server we created on the EC2 instance.\n\nSample web page on EC2\n\nOceanofPDF.com\n\nHow it works...\n\nWe have seen that the Network ACL with VPC and subnet allows all traffic. In the security group of the instance, we have opened HTTP protocol on port 80 for all incoming traffic. Internet Gateway is attached to the subnet in which we created the instance. During instance creation we have installed Apache, PHP and MySQL to host a website with page phpinfo.php. As we have enabled IPv4 and IPv6 in VPC, subnet and EC2, the EC2 instance has assigned those. So, after EC2 creation, we can access the website using the URL. The DNS name is resolved by AWS Route 53.\n\nOceanofPDF.com\n\nCreating NAT on EC2 instance\n\nIn this recipe, you'll learn how to create a NAT instance on EC2 instances created in a public subnet. The private subnet does not have any Internet Gateway attached to it, so EC2 on private subnet cannot directly communicate with the outside world.\n\nOceanofPDF.com\n\nGetting ready\n\nWe need an AWS account and user with proper permissions for creating a NAT instance on EC2. Create an EC2 in the same way as the previous recipe. The only difference is, you don't put any Advanced Details in the Choose Network page. In the security group page, create NATSG security group and attach the same with instance with the following rules. We are allowing all traffic for simplicity. However, you should only put the required CIDR ranges.\n\nNATSG: Rules\n\nInbound\n\nType\n\nProtocol Port range Source\n\nHTTP\n\nTCP\n\n80\n\n0.0.0.0/0 and ::/0\n\nHTTPS\n\nTCP\n\n443\n\n0.0.0.0/0 and ::/0\n\nSSL\n\nTCP\n\n22\n\n0.0.0.0/0 and ::/0\n\nOutbound\n\nDestination Protocol Port range Comments\n\nAll traffic\n\nTCP\n\nALL\n\n0.0.0.0/0 and ::/0\n\nYou can use the same key pair created before for this instance as well. In the Add tag page, put Nat Instance in value for Name and Key. We also need to create an Elastic IP for attaching it to a NAT instance. This we shall show in the recipe.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. I have created one more EC2 instance as visible in the Instances section of the EC2 console.\n\nEC2 created for NAT\n\n2. Click on Elastic IPs in the left menu bar.\n\nElastic IP dashboard\n\n3. Click on Allocate new address.\n\nElastic IP creation page\n\n4. Click on Allocate.\n\nElastic IP creation success message\n\n5. Click on Close. The Elastic IP page will be visible. Choose Elastic IP and click on Actions | Associate address.\n\nElastic IP Action menu\n\n6. Choose Instance in the Resource type. Select Nat Instance from the Instance drop-down menu. Click on Associate. A success message is shown.\n\nElastic IP association with EC2 instance\n\n7. Go to the Instances menu. You can see that the public DNS and IPv4 public IP has changed. You can see Change Source/Dest. Check is true for the instance.\n\nEC2 instance with Elastic IP\n\n8. Select Actions | Networking | Change Source/Dest. Check.\n\nChanging Source/Dest Check for NAT instance\n\n9. You can see that Change Source/Dest. Check is now false.",
      "page_number": 76
    },
    {
      "number": 10,
      "title": "Segment 10 (pages 87-96)",
      "start_page": 87,
      "end_page": 96,
      "detection_method": "topic_boundary",
      "content": "NAT instance details\n\n10. We need to update the main Route Table attached to the VPC. Let's go back to the VPC dashboard and select our VPC.\n\nVPC dashboard\n\n11. Click on the Route Tables starting with rtb.\n\nMain Route Table\n\n12. Select the Route Table and navigate to the Routes tab. Click on the Edit button. Add 0.0.0.0/0 in the destination and the NAT instance ID in Target. Click Save.\n\nAttach NAT in main Route Table\n\nOceanofPDF.com\n\nHow it works...\n\nBy default, EC2 instance can either be a source or destination for network traffic request or response. However, NAT instances need to forward requests to the internet that were originated from a private subnet and return the response back to them. That's why we need to disable the source destination check for NAT instance.\n\nOceanofPDF.com\n\nThere's more...\n\nNAT instance does not support IPv6. To support NAT for IPv6 we need to create an Egress-Only Internet Gateway from the VPC console and attach it to main Route Table.\n\nOceanofPDF.com\n\nWorking with network interfaces\n\nElastic Network Interface (ENI) in AWS is a network interface that can be attached to an EC2 instance. Based on its capacity, one EC2 instance can have number of ENIs attached to it. Each ENI comes with its own MAC and IP addresses. You can't move the ENI to another subnet after it is created. You can attach an ENI to an EC2 in the same AZ.\n\nOceanofPDF.com\n\nGetting ready\n\nWe need an AWS account and user with proper permissions for creating an ENI.\n\nOceanofPDF.com\n\nHow to do it...\n\nHere are the steps to follow:\n\n1. Log in to the AWS account and browse to https://console.aws.amazon.com/ec2/. In the left navigation menu, choose Network Interfaces.\n\nNetwork Interface Dashboard\n\n2. Click on Create Network Interface.\n\nNetwork Interface Creation Details\n\n3. In Description, provide the name. In Subnet, choose subnet where the NIC needs to be created. Leave IPv4 Private IP and IPv6 IP; they will be created as per CIDR range of subnet. Select Security Group. Otherwise, you can mention the IP address from the CIDR range. Click on Yes, Create.\n\nNetwork Interface Detail\n\n4. You can see that only one network interface is created. However, its status is available as it is not attached to any instance. Click on the Attach button.\n\nNetwork Interface Creation\n\n5. Choose the EC2 Instance ID with which you want to attach it. Click Attach.\n\nNetwork Interface attached\n\n6. You can see that the interface is in use. You can Detach it and attach it to some other instance. From the Action menu you can manage the ENI. Click on Instance ID.\n\nEC2 with two Network Interface\n\n7. You can see two private IPs and two network interfaces eth0 and eth1.\n\nOceanofPDF.com\n\nConfiguring AWS CLI\n\nThe AWS CLI is a collection of tools for managing AWS services from the command-line. We can create the script using CLI to automate AWS resource management. AWS CLI can be installed with an installer (Windows) or by using a pip or a package manager for Python.\n\nOceanofPDF.com",
      "page_number": 87
    },
    {
      "number": 11,
      "title": "Segment 11 (pages 97-104)",
      "start_page": 97,
      "end_page": 104,
      "detection_method": "topic_boundary",
      "content": "Getting ready\n\nKeep the user access key details handy that we created in the earlier section.\n\nOceanofPDF.com\n\nHow to do it...\n\nHere are the steps to follow:\n\nInstallation for Windows:\n\nDownload the installer compatible with your system:\n\nWindows 64-bit: https://s3.amazonaws.com/aws-cli/AWSCLI64.msi Windows 32-bit: https://s3.amazonaws.com/aws-cli/AWSCLI32.msi\n\nRun the installer and follow the instructions that appear\n\nInstallation for Linux, macOS, or Unix:\n\nYou should have a working version of Python 2.6.5+ or 3.5+ in your system. Otherwise, install python in your system first. Check your Python installation:\n\n$ python --version\n\nFollow the given steps to install AWS CLI using bundled installer:\n\nDownload the AWS CLI bundled installer. For Linux flavor the command is as follows:\n\n$ cURL \"https://s3.amazonaws.com/aws-cli/aws-cli-bundle.zip\" - \"awscli- bundle.zip\"\n\nThe package need to be unzipped. For Linux flavor the command is as following:\n\n$sudo ./awscli-bundle/install –i /usr/local/aws -b /usr/local/bin/aws\n\nConfiguration:\n\nType aws configure in command prompt or shell depending on your machine operating system. It will ask for the required details. Provide AWS Access Key ID and AWS Secret Access Key that were generated while creating an admin user. You can mention us-east-1 as the default region or choose any other region from the list given in the\n\nscreenshot following and JSON as Default output format. Don't worry if you don't understand region for now. We shall take a detailed look at in the following section.\n\nConfigure AWS CLI\n\nYou are all set for creating, modifying and managing networking components through API/CLI call in AWS depending on AWS privilege that your user have.\n\nOceanofPDF.com\n\nBuilding Your Own Custom VPC\n\nIn this chapter, we'll cover the following recipes:\n\nManaging a VPC Managing public and private subnets Managing a Network ACL Managing a Security Group Managing an Internet Gateway Managing a NAT Gateway Managing a Route Table Managing EC2 instances\n\nOceanofPDF.com\n\nIntroduction\n\nAWS provides a very user friendly interface for managing all of its services. This enables users to create services at the click of a button as and when required and delete them when they are not necessary. We shall go through recipes for creating the most used network components that we have to use, in case we host our application in AWS. Also, we shall learn how to create instances in the network that we built.\n\nOceanofPDF.com\n\nManaging a VPC\n\nAWS VPC is a virtual network in AWS cloud that is similar to the conventional network in a corporate data center. A VPC created in an account isolates all resources in it from any other VPC created by the same or other accounts.\n\nOceanofPDF.com\n\nGetting ready\n\nWe need an AWS account and a user with proper permissions for creating a VPC.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to your AWS account. AWS provides a default VPC in each region where the account has been created, with all the components listed above in each Availability Zone (AZ) in that region. After logging in to the account, select VPC in AWS services:\n\nSelect VPC from AWS console\n\n2. The VPC dashboard will appear. It is the place in the AWS console where you can manage all of the VPC and its related components. You need to select a different region from the top left menu option to see the VPCs and their related components for that region:\n\nVPC dashboard\n\n3. Click on Your VPCs in the VPC dashboard, the left menu option. We can see that the column Default VPC is Yes. This VPC has all",
      "page_number": 97
    },
    {
      "number": 12,
      "title": "Segment 12 (pages 105-114)",
      "start_page": 105,
      "end_page": 114,
      "detection_method": "topic_boundary",
      "content": "components to host services in the cloud. This has been created to help new users create required resources in the VPC without understanding the complexity and relationship between different networking components in the VPC and without creating any of them:\n\nDefault VPC\n\n4. Click on Create VPC. Put the VPC name tag and CIDR range. If you need IPv6 support for components, select Amazon provided IPv6 CIDR block. Don't change the other options and click on Yes, Create:\n\nCreating VPC from console\n\n5. A VPC is created with the given details. Please take note of the VPC ID. As we can see, a Route Table and Network ACL have also been created and associated with the VPC:\n\nVPC dashboard with user created VPC from console\n\n6. We can select a VPC and from the action menu, we can edit details or delete a VPC, as shown in the screenshot following:\n\nModifying VPC details\n\nOceanofPDF.com\n\nHow it works...\n\nThe CIDR range decides the internal IPs of the EC2 instances created in the VPC. By default, the instances inside the same VPCs communicate with the internal IP. The number of instances that you can create is based on the CIDR range that you choose. If you want to communicate with an other network/VPC through a private network, the CIDR range of that network must be different.\n\nOceanofPDF.com\n\nThere's more...\n\nBy default, the same hardware hosts EC2 instances for multiple customers. If you need dedicated hardware for your instances, you should choose Tenancy as Dedicated during VPC creation. However, dedicated instances cost more.\n\nOceanofPDF.com\n\nManaging public and private subnets\n\nSubnets of AWS are similar to VLAN in DC with a specific range of IPs isolated from an other VLAN/subnet. Each AZ in a region can host multiple subnets, as per the requirement. A subnet is bound by one AZ limit and can't span across multiple AZs. There are two types of subnets; instances created in a public subnet are assigned a public IP and can be accessed from outside the VPC. There is another type of subnet that is called the private subnet. Public IP is not assigned to instance created inside this type of subnet. A default VPC has default subnets associated with it; all default subnets are public subnets.\n\nOceanofPDF.com\n\nGetting ready\n\nWe need an AWS account and a user with proper permissions for creating a subnet.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Click on Subnets in VPC Dashboard. You can see that one default subnet is created in each AZ available in that region associated with the default VPC:\n\nDefault subnet\n\n2. Click on Create Subnet link. Put the Name tag, select the VPC, CIDR range and Availability Zone. Click on Yes, Create:\n\nCreate subnet from console\n\n3. A subnet is created with the Route Table and the Network ACL. We can select a subnet and, from the Subnet Actions menu, delete a subnet or modify other settings:\n\nDashboard with newly created subnet\n\n4. Click on the Route Table tab. You can see two entries, one for local VPC communication and the other for external communication through the Internet Gateway (starting with igw). The Internet Gateway enables resources hosted in AWS to communicate with the outside world. As the subnet is capable of communication with the external world through an Internet Gateway, it is a public subnet:\n\nRoute Table of subnet\n\n5. Click on Edit, so we can change the Route Table. If we associate a subnet with the Route Table that does not have an IGW attached to it, the subnet will act as a private subnet because the external world cannot\n\nconnect through it. In the later section, we'll see how to create a route table.\n\n6. You can delete a subnet by choosing the Delete option from the Subnet Actions menu.\n\nOceanofPDF.com\n\nThere's more...\n\nThe CIDR range of a subnet determines the number of instances that can be created in a subnet and the internal IP range of the instances. The CIDR range of subnet should be a subset of the VPC CIDR range. Two subnets in a VPC can't have overlapping CIDR ranges.\n\nOceanofPDF.com",
      "page_number": 105
    },
    {
      "number": 13,
      "title": "Segment 13 (pages 115-122)",
      "start_page": 115,
      "end_page": 122,
      "detection_method": "topic_boundary",
      "content": "Managing a Network ACL\n\nAn AWS Network Access Control List (NACL) works as a firewall at the VPC level for controlling incoming and outgoing requests from one or more subnets associated with that VPC. It is used in conjunction with the Security Group (SG) in controlling traffic to the AWS. When we create a VPC, a default NACL is created that is open to every IP and port. The subnet is associated with the default NACL created during its creation. We can create a custom NACL and associate it with a subnet, thus replacing the default NACL.\n\nOceanofPDF.com\n\nGetting ready\n\nWe need an AWS account and a user with proper permissions to create a security group. We also need to configure the AWS CLI in our local machine. We also need a VPC creation in the region where we are going to create the components. We have already created those in Chapter 1, Getting Started with AWS Networking Components.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to your AWS account and open the VPC Dashboard.\n\nVPC Dashboard\n\n2. Click on Network ACLs from the left menu bar under\n\nthe Security menu. Default NACLs created with a default VPC and other VPCs that we created in Chapter 1, Getting Started with AWS Networking Components, appear on the screen. If you click on Inbound Rules and Outbound Rules, you will see that there is a rule number 100 which allows all traffic with all protocols from all ports. So effectively, the firewall is all open and traffic from any source, protocol, and port can connect to resources in this NACL. In the Subnet Associations tab, you can see that both subnets in the VPC are associated with NACL:\n\nDefault NACL\n\n3. Click on Create Network ACL for creating a new NACL. Provide the Name tag and select the VPC for which you want to create an NACL. Click on Yes, Create:\n\nNetwork ACL creation from console\n\n4. You can see that the Default column is No for the NACL that we just created. Click on Inbound Rules or Outbound Rules:\n\nUser created NACL\n\n5. Click on the Edit button in the Inbound Rules tab. Click on Add another rule. You can add multiple rules. Here I am allowing all traffic for simplicity. Click on the Save button:\n\nAdd inbound rules to NACL\n\n6. Click on the Edit button in the Outbound Rules tab. Click on Add another rule. You can add multiple rules. Here I am allowing all traffic for simplicity. Click on the Save button:\n\nAdd outbound rules to NACL\n\n7. Click on Subnet Associations. Select the subnet that we created earlier. Click on the Save button:\n\nNACL and subnet association\n\n8. We can go and select the subnet menu and see that the NACL associated with the subnet has changed:\n\nNACL and subnet association success\n\n9. If a custom NACL is not associated with any subnet, it can be deleted by selecting the Delete button in the console. However, we can't delete the NACL that we created now as it is attached to a subnet. First we need to replace the subnet association, as given in step 7, and then can delete it if required. OceanofPDF.com\n\nHow it works...\n\nWe can define multiple inbound and outbound rules in an NACL. An NACL can be associated with one or multiple subnets in the VPC. An inbound rule allows or blocks incoming network requests from outside of the subnet to the resources hosted in the subnet. An outbound rule allows or blocks network requests from resources hosted within the subnet to outside of the subnet. Each rule has a number. The rules are evaluated from the rule with the lowest number first and then the rule with the next highest number. However, if a rule allows particular network traffic, other rules are not evaluated. So if a rule with the lowest number allows all traffic, more restrictive rule that would have blocked the traffic will not take effect. An NACL is stateless. This means that, if a network request is allowed by an inbound rule, the response can't go out if the outbound rule does not allow it, and vice versa. It may be preferable to add a DENY rule first where you want to allow a wide range of ports, but there are a few ports in that range which you would need to block.\n\nOceanofPDF.com\n\nThere's more...\n\nWhen a request comes to a resource say, an HTTP request, a short-lived transport protocol port for Internet Protocol (IP) communications is allocated automatically from a predefined range by the IP stack software, and is called the ephemeral port. The response goes back via the ephemeral port. You need to know the ephemeral ports which differ depending on the OS; a few samples are shown in the table following. You need to allow ephemeral ports in an NACL for effective communication:\n\nOperating System\n\nEphemeral port\n\nAmazon Linux\n\n32768-61000\n\nWindows Server 2003/Windows XP 1025-5000\n\nWindows Server 2008\n\n49152-65535\n\nAWS ELB/AWS NAT\n\n1024-65535\n\nOceanofPDF.com",
      "page_number": 115
    },
    {
      "number": 14,
      "title": "Segment 14 (pages 123-130)",
      "start_page": 123,
      "end_page": 130,
      "detection_method": "topic_boundary",
      "content": "Managing a Security Group\n\nSecurity Group (SG) works as a virtual firewall that controls incoming traffic to protect resources hosted in AWS, such as EC2 and RDS, from unwanted access. The same SGs should be associated with services/resources having the same functionality and security requirements such as a cluster of web servers. SGs can span across different subnets in a VPC. SGs are stateful firewalls where you can define rules for a valid source, protocol, and port for incoming and outgoing traffic. Stateful meaning--if the connection from source to destination is allowed, the return path is also allowed. At least one SG needs to be attached to the resource at the time of resource creation. More than one SG can also be attached to a resource. The rules of an SG can be modified at any time and they will take effect immediately. An SG can be detached from the resource at any time.\n\nOceanofPDF.com\n\nGetting ready\n\nThe prerequisites for this section are the same as recipe, Managing a Network ACL.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to your AWS account and open the VPC Dashboard as shown in the earlier recipe.\n\n2. Click on Security Group in the left menu bar under the Security menu. The default SG created with the default VPC and other VPCs that we created in Chapter 1, Getting Started with AWS Networking Components, appears on the screen. If you click on Inbound Rules and Outbound Rules, you will see that all traffic, with all protocols from all ports, is allowed. So effectively, the firewall is all open and traffic from any source, protocol, and port can connect to the resources in this SG:\n\nDefault Security group\n\n3. Click on Create Security Group. The following window will open. Put in the required details and the VPC with which you want to associate the SG. Click on Yes, Create:\n\nSecurity Group creation from console\n\n4. You can now see the new SG. However, there is one important difference from the default SGs: there are no Inbound Rules defined. This means no traffic is allowed inside this SG:\n\nDashboard with created Security Group\n\n5. Click on the Edit button under Inbound Rules. You can select the traffic type from the options. For now, put SSH. In the Source, you can mention any valid CIDR range, such as your corporate DC CIDR range. For now, put 0.0.0.0/0. You can also mention the security groups in the same VPC. You can add any additional inbound rules by clicking Add another rule and add HTTP, as shown. Click on the Save button:\n\nConfigure Security Group inbound rule\n\n6. You can see that the SG Inbound Rules has been saved successfully. Click on Outbound Rules. You can see that all outgoing traffic types to all ports and all destinations are allowed. For now, we are not modifying this. However, you can modify it if required:\n\nSecurity Group outbound rules\n\n7. You can delete a particular SG by selecting Delete Security Group from the security group actions:\n\nDelete Security Group\n\nOceanofPDF.com\n\nHow it works...\n\nSecurity groups control the incoming and outgoing requests to and from resources hosted in the AWS. Inbound rules allow incoming network traffic from source CIDR ranges with the protocol and ports mentioned in a rule. If you want to allow requests only from resources hosted inside your VPC, put an SG associated with those resources in the source. Outbound rules allow outbound requests initiated from resources hosted in the AWS.\n\nOceanofPDF.com\n\nThere's more...\n\nApart from load balancers, the source for inbound rules should not be open to all IPs or ports for production scenarios. For other ports such as RDP/SSH, access should be allowed from the Jump Server/Bastion Host. All rules in an SG are evaluated before allowing any traffic.\n\nOceanofPDF.com",
      "page_number": 123
    },
    {
      "number": 15,
      "title": "Segment 15 (pages 131-138)",
      "start_page": 131,
      "end_page": 138,
      "detection_method": "topic_boundary",
      "content": "Managing an Internet Gateway\n\nAn Internet Gateway is an AWS component that enables communication between resources hosted in the VPC and the internet. It is a horizontally scalable and highly available component. It doesn't enforce any network bandwidth constraints. It is the channel through which services hosted inside the VPC are accessed by the outside world. It also enables resources hosted in the AWS to connect to the internet.\n\nOceanofPDF.com\n\nGetting ready\n\nThe prerequisites for this section are the same as recipe, Managing a Network ACL.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to your AWS account and open the VPC Dashboard as shown in the earlier recipe.\n\n2. Click on Internet Gateways in the left menu bar under the Virtual Private Cloud menu. You can see that the IG which was created with the default VPC in the region is visible:\n\nInternet Gateway dashboard\n\n3. Click on Create Internet Gateway. The following window will open. Provide a Name tag and click on Yes, Create:\n\nInternet Gateway creation from console\n\n4. You can see the IG is created. However, it is in the detached state. This means that it is not attached to any VPC:\n\nDashboard with created Internet Gateway\n\n5. Click on the Attach to VPC button. The following window will open. Select the VPC that we created and click on Yes, Attach:\n\nAttach Internet Gateway with VPC\n\n6. Now you can see that the state of the IG has changed to attached:\n\nInternet Gateway status\n\n7. If you want, you can click on Detach from VPC and then Delete the IG that you created.\n\nOceanofPDF.com\n\nHow it works...\n\nResources inside the subnet only understand the private IP (internal) assigned to them from the CIDR range of that subnet. The default VPC has an IG attached to it and the subnet's route is associated with the IG. The IG works as a Network Address Translation (NAT) for instances that have public IP/Elastic IP attached to them. When outside instances send requests to the AWS resources with a public IP/Elastic IP, the IG translates the address and sends the request to the internal IP of the resource. Similarly, when resources inside a subnet send requests to services outside the VPC, the reply address is set by the IG as public/Elastic IP of that resource. Thus, if a subnet route has an IG attached to it, the resources hosted inside it are accessible from the internet. This type of subnet is called a public subnet. All default subnets are public subnets. If no IG is attached to the subnet route, the resources hosted inside it can't be accessed from the internet and is hence called a private subnet.\n\nOceanofPDF.com\n\nThere's more...\n\nBy default, all user created subnets are private subnets. If we want resources to be accessed from the internet directly, we need to create an IG and attach it to the VPC. The IG needs to be attached to the route table of the subnet that hosts the resources. If we attach an IG to the route of the subnet, it becomes a public subnet.\n\nOceanofPDF.com\n\nManaging a NAT Gateway\n\nBy default, there is no way that resources hosted in a private subnet can access the internet. NAT is a way to achieve that. However, any resource outside the VPC can't access the resources in a private subnet. We can use a NAT instance or a NAT Gateway to achieve this. However NAT Gateway is a scalable, managed service that does not require any administration. In this section, we will see how to manage a NAT Gateway.\n\nOceanofPDF.com",
      "page_number": 131
    },
    {
      "number": 16,
      "title": "Segment 16 (pages 139-153)",
      "start_page": 139,
      "end_page": 153,
      "detection_method": "topic_boundary",
      "content": "Getting ready\n\nWe need to have an AWS account created with a user that has permissions to manage the NAT which we already have. We need to create an Elastic IP to be attached to with NAT, which is provided here. We shall learn details about Elastic IPs in the later sections.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to your AWS account and open the VPC Dashboard as shown in the earlier recipe.\n\n2. Click on Elastic IP under the Virtual Private Cloud menu. There are no Elastic IPs as we have not created any till now:\n\nElastic IP console\n\n3. Click on Allocate New Address. The following window will open. Click on Allocate:\n\nElastic IP creation from console\n\n4. An Elastic IP will be provided:\n\nConsole with Elastic IP created\n\n5. Click on NAT Gateways under the Virtual Private Cloud menu:\n\nNAT Gateway console\n\n6. Click on Create NAT Gateway. The following window will open. Select the subnet where you want it to be hosted from the Subnet search menu and the Elastic IP that we created in step 4. Click on Create a NAT Gateway:\n\nConsole for NAT Gateway creation\n\n7. You will get a confirmation message; you can see it on the dashboard. Initially, the Status will be Pending. The Status will change to Available after some time:\n\nConsole with created NAT Gateway\n\n8. You can click on Delete NAT Gateway if it is not needed any more from the console. In that case, also remember to release the Elastic IP.\n\nOceanofPDF.com\n\nHow it works...\n\nWhen resources in the private subnet need to connect to services out on the internet, they send the requests through NAT. NAT forwards the requests to the internet and replaces the return address of the Elastic IP address assigned to it instead with the internal IP of the resource. Similarly, when a response comes back, NAT translates the address to the internal IP of the resource and forwards the response.\n\nOceanofPDF.com\n\nThere's more...\n\nA NAT instance is created in one subnet, meaning one AZ where the subnet is created. If you have resources in multiple AZs and in case the AZ that hosts the NAT Gateway is down, resources hosted in the other AZs lose the internet connection. So to have a highly available NAT infrastructure, you need to create a NAT Gateway which is a managed NAT service with a NAT instance created in multiple AZs to have fault tolerance.\n\nOceanofPDF.com\n\nManaging a Route Table\n\nA Route Table contains a set of rules that control how the network traffic flows within a VPC and outside of it. Each subnet must be associated with one Route Table. However, Route Tables may contain more than one subnet that needs the same route configuration.\n\nOceanofPDF.com\n\nGetting ready\n\nWe need to have an AWS account created with a user that has permissions to manage Route Tables, which we already have. We have already created two subnets, one IG, and one NAT Gateway. By configuring these with the Route Table, we shall make one subnet a public subnet and the other one a private subnet.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to your AWS account and open the VPC Dashboard as shown in the earlier recipe.\n\n2. Click on Route Tables under the Virtual Private Cloud menu. We can see the Main Route Table created and associated with the VPC that we created from the console. You can see that no subnet is associated with any route explicitly:\n\nRoute Table console\n\n3. Click on Routes. You can see there is only one route with the Target as local. Click on Edit, and then click on Add another route. Add all destinations with 0.0.0.0/0 and target the Internet Gateway that we created earlier. Also, add the NAT Gateway in as another route. Click on the Save button:\n\nConfigure main route table\n\n4. Go to the Subnet Associations tab. You can see that no subnet is explicitly associated with this route:\n\nSubnet association console for Route Table\n\n5. Click on Edit. The following console will open. Select the subnet that we created from the console. Click on the Save button:\n\nEdit subnet association for main route table\n\n6. You can see that Explicitly Association has been modified from 0 to 1:\n\nRoute Table subnet association\n\n7. Let's add another route for creating a private subnet. Click on Create Route Table. The following window will open. Put the Name tag and select the VPC that we created from the console earlier. Click on Yes, Create:\n\nConsole for Route Table creation\n\n8. We can see the newly created Route Table in the console. However, the Main column is No for this case:\n\nConsole with custom route table\n\n9. Go to Subnet Associations. Click on the Edit button. Choose the other subnet that we created. Click on the Save button:\n\nSubnet association for custom route table\n\n10. After removing the subnet association with a particular route table, you can delete it by clicking the Delete Route Table button.\n\nOceanofPDF.com\n\nHow it works...\n\nNow we have turned one subnet into a public subnet that is associated with the route table having Internet Gateway and NAT Gateway. The other subnets that are associated with the route table with a local route become private subnets.\n\nOceanofPDF.com\n\nThere's more...\n\nA VPC comes with a main router when created. If any subnet in the VPC is not associated with any route table, it is automatically associated with the main table. You can make any Route Table the main table by clicking the Set As Main Table button from the console.\n\nOceanofPDF.com\n\nManaging EC2 instances\n\nEC2 is an infrastructure in the AWS Cloud with certain compute, memory, and network resources. Though EC2 is not a networking component, we shall try to create a couple of them to check whether the network components that we have created work with EC2. We shall also understand how networking components integrate with resources in AWS.\n\nOceanofPDF.com",
      "page_number": 139
    },
    {
      "number": 17,
      "title": "Segment 17 (pages 154-161)",
      "start_page": 154,
      "end_page": 161,
      "detection_method": "topic_boundary",
      "content": "Getting ready\n\nWe need to have an AWS account created with a user that has permission to manage EC2 instances, which we already have.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to your AWS account and open the EC2 Dashboard:\n\nEC2 Dashboard\n\n2. Click on the Launch Instance. The following window will open. You can choose any prebuilt virtual image called Amazon Machine Images (AMIs) that you like. However, for now Select the first one:\n\nChoose AMI for EC2\n\n3. The following window will open. Select the instance type that you would like to choose. For now, select the one that is already selected. It is free tier eligible:\n\nEC2 - Choose instance type\n\n4. Click Next: Configure Instance Details. The following window will open. In the Number of instances, put 1. You can create more by putting a higher number. In Network, choose the VPC that we created earlier. In Subnet, choose the public subnet that we created earlier. In Auto-assign Public IP, choose Enable. Leave other options as they are. Click on Next: Add Storage:\n\nConfigure EC2 Network detail\n\n5. Leave the details as they are and click on Next: Add Tags:\n\nChoose EC2 Storage\n\n6. Add a tag for identifying the EC2 instance in the EC2 dashboard. Click on Next: Configure Security Group:\n\nAdd EC2 tag\n\n7. Select the Select an existing security group option. It will show the SG that we created earlier. Choose it. Click on Review and Launch:\n\nChoose EC2 SG\n\n8. Review the details and click Launch:\n\nLaunch EC2\n\n9. The following window will open. Select Create the new key pair and Key pair name. Download the key and store it. We shall use it in a while. Click on the Launch Instances button. You will get a success message:\n\nEC2 Key Pair creation\n\n10. Go to the EC2 dashboard. Select Instances from the Instances menu. Choose the instance that we just created. You will see the details about the instance. You can also see that the public IP has been assigned to it:\n\nEC2 instance details\n\n11. Click on the Connect button. You can see the instructions to connect to the instance using an SSH client. If you would have chosen Windows AMI, it would show the connection steps using RDP. You should be able to connect to the instance using the public IP of the instance. For\n\ndetails, please refer to the AWS Documentation (http://docs.aws.amazon.com/A WSEC2/latest/UserGuide/putty.html):\n\nConnecting to EC2 instance\n\n12. You can terminate or stop an instance from the Instance State of the Action menu when needed.\n\nOceanofPDF.com\n\nHow it works...\n\nThis EC2 instance is created in a public subnet that has an IGW attached to it. The NACL is open for all connections. Security groups is open to all inbound connections over port 22, so we could add SSH to the instance.\n\nOceanofPDF.com",
      "page_number": 154
    },
    {
      "number": 18,
      "title": "Segment 18 (pages 162-176)",
      "start_page": 162,
      "end_page": 176,
      "detection_method": "topic_boundary",
      "content": "There's more...\n\nThe public IP associated with the instance is transient. If we stop and start the instance, the IP will change. We can attach the Elastic IP to the instance in the same way we attached the Elastic IP to the NAT instance in Chapter 1, Getting Started with AWS Networking Components. In that case, the IP will not be changed if the instance is stopped and started.\n\nIf we had created an instance in a private subnet, it could not have been connected as there is no inbound route available from the internet. However, we can connect to it from the instance in the public instance. For that, we need to add an SG of the public subnet instance to the inbound rules of an SG of the private instance. Once we log into the private subnet instance, we can connect to the internet as we have configured the NAT Gateway.\n\nOceanofPDF.com\n\nVPC Advanced Components\n\nIn this chapter, we'll cover the following recipes:\n\nAssigning multiple IPs to an instance and ENI Accessing an instance within the network Accessing an instance from outside AWS Creating an application ELB Creating a launch configuration Creating an Auto Scaling group Creating VPC peering Accepting VPC peering Configuring VPN connections to your Amazon VPC\n\nOceanofPDF.com\n\nIntroduction\n\nIn this chapter, we shall dive further to learn to create components for load balancing of an application. Load balancing is required to route the request to different servers hosting the applications. This helps to host applications with the exact capacity that the application needs at a certain point of time.\n\nSecurity is a major concern that cuts across every application type. We shall learn how to build components for establishing communication between multiple VPCs and between a data center and VPC. This will enable applications and services to securely connect to each other.\n\nOceanofPDF.com\n\nAssigning multiple IPs to an instance and ENI\n\nThe Elastic Network Interface (ENI) is a virtual interface. Any instance when created comes with its default NI attached to it (eth0). Additional ENIs can be created and attached to an instance or can be detached from it. The number of ENIs that can be attached to an EC2 instance depends on its type. An ENI may have the following properties:\n\nOne primary and multiple secondary IPv4 addresses and optionally, one public or Elastic (fixed) IPv4 IP One or more IPv6 addresses if supported by the instance type and network One MAC address Additional properties such as SG, source destination check, and so on.\n\nThis recipe is similar to creating a NAT instance that we learnt in Chapter 1, Getting Started with AWS Networking Components. In that case, we attached an Elastic IP to one instance. Here, we shall learn how to create an ENI and attach it to an EC2 instance. For an ENI to be attached to an EC2, it must be done in same subnet and VPC.\n\nOceanofPDF.com\n\nGetting ready\n\nLog in to the console with the appropriate permission.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe stepsfor assigning multiple IPs to an instance are as follows:\n\n1. Go to the AWS EC2 console by typing the URL in your favorite browser: https://console.aws.amazon.com/ec2/. Choose Network Interfaces in the left navigation menu under Network & Security. In the dashboard, you can see the ENI that has already been created while creating the EC2 instance or the Elastic IP. Click on Create Network Interface:\n\nCrete network interface\n\n2. Provide the Description and select the Subnet to which it should be associated with. Choose the IPv4 Private IP and IPv6 IP that is allowed under the CIDR of the subnet. You can leave it and AWS will choose the IPs for you. Select the Security groups that it should be associated with. SGs created in the VPC will be populated in the Security groups section. Click Yes, Create. We can change the Security Group associated with the ENI later.\n\n3. You can now see the Network Interface that was just created in the dashboard. You can see the status is available:\n\nCreate network interface\n\n4. Click on the Attach button:\n\nAttach network interface\n\n5. Select the EC2 instance that you want to attach the ENI with. Click on the Attach button:\n\nNetwork interface attached\n\n6. You can see that the status has changed to in-use. The Instance ID of the EC2 instance is visible in the Details section. If you want, you can detach the network interface and attach it with another instance in the same subnet.\n\nOceanofPDF.com\n\nThere's more...\n\nNow the EC2 instance has two ENIs attached to it. So, the instance can be connected using any IP associated with either of the ENIs based on the SG rules attached to the ENI.\n\nA network interface can be attached to an instance in the running state, stopped state, or while the instance is being created. An Elastic IP is a special network interface and it can be attached to any instance in the public subnet in any VPC of your account. In Chapter 1, Getting Started with AWS Networking Components, we created one EIP while creating a NAT instance.\n\nOceanofPDF.com\n\nAccessing an instance within the network\n\nIn the earlier chapters, we created an instance in the public subnet and connected to it from our system. In this section, we shall create an instance in the private subnet of the same VPC and connect it from the instance that we created earlier. We shall create a private subnet in the VPC that we created in Chapter 1, Getting Started with AWS Networking Components, and create an instance to it.\n\nOceanofPDF.com\n\nGetting ready\n\nLog in to the account with the proper permissions and a VPC, subnet, and EC2 instance in the public subnet already created.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe steps for accessing an instance within the network are as follows:\n\n1. Log in to the AWS console EC2 dashboard by browsing to the URL http s://console.aws.amazon.com/vpc/. Choose Subnet from the left side menu. Click on Create Subnet. Provide the required details. Click on Yes, Create:\n\nCreate private subnet\n\n2. You can create an EC2 instance by following the similar steps provided in Chapter 2, Building Your Own Custom VPC. We need to create it in the subnet that we just created and assign an SG to allow only instances in the public subnet to connect to it. Let's create an instance from the existing one. Browse to Instances in the EC2 Dashboard. Select one EC2 instance that you want to create a new EC2 instance from. Go to Actions | Launch More Like This:\n\nCreate similar EC2 instances\n\n3. The EC2 creation review page will appear as follows:\n\nEC2 creation review page\n\n4. Click on Edit instance type. Change the Subnet to the newly created one. Click on Review and Launch:\n\nModify configure instance details\n\n5. You will come back to the preview page. Click on Edit security groups. Choose Create a new security group. Put the Security group name and\n\nDescription for all the rules for the Security Group. Here we'll open port 22 for instances created in the Security Group associated to the instance created in the public subnet. Copy the SG associated with that instance and paste it in Source:\n\nModify Security Group\n\n6. Click Review and Launch and then click on Edit Tag. Put the tag as per your needs:\n\nAdd EC2 tag\n\n7. Click Review and Launch. Click on Launch. You can create a new key or use an existing key. I'll be using the existing one. Click on Launch Instances:\n\nLaunch EC2 instance\n\n8. You will see a success page as shown:\n\nEC2 Create success message\n\n9. Click on the instance ID. Wait for some time till it comes to the running state with status checks in green. First, log in to the public subnet EC2 instance MyFirstEC2 in the same way we did in Chapter 1, Getting Started with AWS Networking Components:\n\nConnect to EC2 instance in public subnet",
      "page_number": 162
    },
    {
      "number": 19,
      "title": "Segment 19 (pages 177-185)",
      "start_page": 177,
      "end_page": 185,
      "detection_method": "topic_boundary",
      "content": "10. Create a file using your favorite editor. Paste the contents of the EC2 key you downloaded earlier and save it. Verify that the file has been created, and modify its permission to 400 (chmod 400 FirstEC2KeyPair.pem), and connect to it (ssh -i <KeyName> ec2-user@<Private IP of instance>). Type yes for continuing the connection:\n\nConnect to EC2 instance in private subnet\n\n11. You will be logged in to the instance in the private subnet. You can see that the IP of EC2 console has changed to one of private subnet (10.0.0.240) from one in public subnet (10.0.0.13).\n\nConnection to private subnet EC2 instance successful\n\nOceanofPDF.com\n\nHow it works...\n\nEC2 instances in a VPC can connect to each other via the local route in the Route Table provided the Security Group allows inbound connections. For SG (say SGPrivate) of the instance in private subnet, we added SG of instance in public subnet(say SGPublic). This ensures that no other instance can connect to the new instance in the private subnet apart from EC2 instances associated with SGPublic. Now we have created a bastion server or jump server, which is our EC2 instance in the public subnet. To connect to the instance in the private subnet instances, someone has to go through it. Generally, the Security Group of a bastion server is configured to accept connections from a list of known IP addresses where administrators operate from.\n\nOceanofPDF.com\n\nAccessing an instance from outside AWS\n\nIn the last recipe, we connected to an instance in the private subnet through a bastion server through the internet. In this recipe, we'll see how to connect to the Windows Server and connect it through the Microsoft Remote Desktop Protocol (RDP). You need to have a Windows OS in your machine to complete this recipe.\n\nOceanofPDF.com\n\nGetting ready\n\nLog in to the console with the appropriate permissions.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe steps for accessing an instance from outside AWS are as follows:\n\n1. Browse to the EC2 console. Click on Launch Instance. Select Microsoft Windows Server 2016 Base AMI:\n\nChoose Windows AMI\n\n2. Select t2.micro on the Choose Instance Type page. Click on Next: Configure Instance Details. Select a VPC in Network and a public subnet in Subnet with Auto-assign Public IP enabled. Click Next: Add Storage. Let the default option be there and click Next: Add Tags. Let the default option be there and click Next: Configure Security Group:\n\nChoose configuration details\n\n3. You can see that the port RDP is open for all IP addresses. You may modify the IP range to suit your needs:\n\nSecurity group for Windows instance\n\n4. Click Review and Launch and then click on Launch. Select Choose an existing key pair and click on Launch Instance. You can see the instance in the EC2 Dashboard with the public IP assigned to it:\n\nWindows instance on EC2 console\n\n5. Choose EC2 and click on Connect. Click on Download Remote Desktop File and save it.\n\nWindows instance connection guideline\n\n6. Click on Get Password, the following window will open. Select the Key Pair Path. Click on Decrypt Password. The password will be shown. Copy the password and save it.\n\nWindows instance password generation\n\n7. Click on the RDP shortcut downloaded earlier. Put in the user ID and password. You will now be able to connect to the instance.\n\nWindows Instance Connection\n\nOceanofPDF.com\n\nCreating an application ELB\n\nAWS provides an Elastic Load Balancer (ELB) as a service. AWS has two kinds of ELB:\n\nClassic ELB Application Load Balancer\n\nA Classic ELB can forward requests to one set of EC2 instances and an Application Load Balancer can forward requests to applications based on the application content/path/host. Classic load balancer can handle load for both layer 4 and layer 7. Application load balancer can handle load for only layer 7 protocol.\n\nOceanofPDF.com",
      "page_number": 177
    },
    {
      "number": 20,
      "title": "Segment 20 (pages 186-193)",
      "start_page": 186,
      "end_page": 193,
      "detection_method": "topic_boundary",
      "content": "Getting ready\n\nLogin to the console with appropriate permissions.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe steps are as follows:\n\n1. Browse to AWS EC2 console by typing the URL: https://console.aws.amazon.c om/ec2. Click on Load Balancers under the LOAD BALANCING option on the left menu. Click on Create Load Balancer:\n\nSelect Load Balancer Type\n\n2. Let's choose the Application Load Balancer and click Continue. Provide the load balancer Name, Scheme, whether it is internet facing or internal facing and the IP address type for only IPv4 support of dual stack support. If you choose dual stack, your VPC and subnets should have support for IPv4 and IPv6 ports. Provide Listeners on which protocol (HTTP/S) and port you want the requests to come to. Scroll down to select the VPC where you want to create the load balancer and select at least two Availability Zones where the load balancer instances will be created. To have an internet facing load balancer, subnets need to have an IGW attached to them. You can add tags as well. Click Next: Configure Security Settings:\n\nSelect security setting\n\n3. If you choose the HTTPS listener, you need to provide a security certificate. As I have chosen HTTP, no configuration is required in this step. Click on Next: Configure Security Group. Choose Create a new security group. Provide the Security group name and Description. Provide rules and as we chose HTTP protocol and port 80 in the previous step, keep the same here. In the source, you can put the source IP range that you want the request coming from. I am allowing all URLs by providing the CIDR range to be open to all:\n\nConfigure Security Group\n\n4. Click on Next: Configure routing. Provide the name of the target group. It is a logical group of all the servers that the load balancer sends traffic to. Provide the Protocol and Port that the services on the server are running on. Provide the Health Checks details using which load balancer sends requests at regular intervals to verify whether the server is healthy or not:\n\nConfigure load balancer routing\n\n5. It will provide a list of EC2 instances already running. As we don't have any instance in the VPC, the list is empty. You can choose instances if there are any. However, you need to remember that merely adding those instances will not work. The service should be up and should provide a healthy response to the health check settings which you did earlier and Security Group of server should be modified to allow incoming requests from the ELB. Click on Next: Review.\n\n6. Review the details and click Create. Success message will be displayed. Click on Close. You'll be able to see the application load balancer created with all details. You can see the DNS name of the load balancer\n\nwhich can be used to access the service hosted by the target group servers:\n\nLoad balancer details\n\nOceanofPDF.com\n\nHow it works...\n\nThe load balancer sends requests using the Protocol and Path that you provide in the Health checks. It initiates a request at a given interval to all server associated with it. If some server does not respond back in predefined interval for few consecutive requests, the server is marked as OutOfService. Load balancer does not send user requests to it. However load balancer keeps on sending the health check request. If server responds back to few consecutive health check requests, it is marked as InService. Load balancer send user requests to it again. Advanced health check settings provide better control on frequency of these requests and threshold to decide whether the server is healthy or not. Click on Next: Register Targets.\n\nOceanofPDF.com\n\nThere's more...\n\nYou can check the health of the ELB by looking at the monitoring tab. Different useful statistics including the number of requests and number of errors are provided. In Listener, you get an option to add another application group to forward the request to.\n\nOceanofPDF.com\n\nCreating a launch configuration\n\nA launch configuration is a way to create a template for creating EC2 instances that have the same predefined configuration. EC2 instances can be created when more instances are required for load balancing from this configuration.\n\nOceanofPDF.com",
      "page_number": 186
    },
    {
      "number": 21,
      "title": "Segment 21 (pages 194-201)",
      "start_page": 194,
      "end_page": 201,
      "detection_method": "topic_boundary",
      "content": "Getting ready\n\nLog in to the console with the appropriate permissions.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe steps for creating a launch configuration are as follows:\n\n1. Browse to AWS EC2 console by typing the URL: https://console.aws.amazon.c om/ec2. Browse to Launch Configurations under AUTO SCALING in the left menu bar. You'll see the following dashboard if there are no Auto Scaling Groups or launch configurations already created:\n\nCreate launch configuration\n\n2. Click on Create Auto Scaling group:\n\nCreate Auto Scaling group page\n\n3. This page has an introduction and tells you that you need to create a launch configuration before creating an Auto Scaling group. Click on Create launch configuration. You will be taken through the same steps that you did while creating an EC2 instance. Select your favourite AMI by clicking on Select as shown following:\n\nChoose AMI for launch configuration\n\n4. Choose the instance type that you need to create:\n\nChoose instance type for launch configuration\n\n5. Click Next: Configure details. Provide the Name. Click on the Advanced Details and put the following lines in the textbox. It will\n\ninstall Apache, PHP, and MySQL in the server. It will also start the Apache server once the EC2 is running:\n\n#!/bin/bash yum update -y yum install -y httpd24 php56 mysql55-server php56-mysqlnd service httpd start chkconfig httpd on groupadd www usermod -a -G www ec2-user chown -R root:www /var/www chmod 2775 /var/www find /var/www -type d -exec chmod 2775 {} + find /var/www -type f -exec chmod 0664 {} + echo \"<?php phpinfo(); ?>\" > /var/www/html/phpinfo.php\n\nIn the IP Address Type, choose the option Do not assign a public IP address to any instances, as we want to access the instances only through the load balancer:\n\nChoose configure details for launch configuration\n\n6. Click on Next: Add Storage. You can modify it if you want large volumes to be attached to the EC2 instance. Leave the default options for now. Click on Next: Configure Security Group. Provide the Security group name and Description. Change the request protocol Type to HTTP and the Port Range to 80, as we did that in the load balancer configuration. In Source, choose Custom IP and provide the load balancer security group that we created earlier:\n\nChoose add storage for launch configuration\n\n7. Click on Review. You can review and modify configurations of the previous steps. Click on Create launch configuration:\n\nReview for launch configuration\n\n8. Choose a key if you want to connect to the EC2 instance. But remember, you also need to add a security group of your bastion server in the same VPC in the Configure Security Group step; because, through the bastion server, you can connect to instances in the Auto Scaling group as these EC2 instances don't have a public IP. Check the acknowledgement and click on Create launch configuration:\n\nSelect EC2 key for launch configuration\n\n9. Click on the Launch Configuration menu again. You will see the dashboard with the launch configuration which we just created:\n\nFigure 3 – 36 Launch configuration created\n\nOceanofPDF.com\n\nThere's more...\n\nGenerally, we create an EC2 instance and configure it with the required software and create a virtual image (AMI) from that EC2 from the EC2 Actions | Image | Create Image menu. Other compatible virtual machine images can also be imported to AWS for reuse. If we have created any, this will be visible under the My AMIs menu.\n\nSo instead of using boot strap scripts in step 5, we can use custom AMI to create ec2 instances. As the software already installed in EC2, it takes lesser time to start server. It is more useful when we have to install larger software that takes significant time.\n\nOceanofPDF.com\n\nCreating an Auto Scaling group\n\nAn Auto Scaling group is a group of instances that host the same application. These instances are treated as a logical group for managing and scaling instances. You can define a criteria based on which of the number of instances serving the application can be changed to support the load on the application.\n\nOceanofPDF.com",
      "page_number": 194
    },
    {
      "number": 22,
      "title": "Segment 22 (pages 202-209)",
      "start_page": 202,
      "end_page": 209,
      "detection_method": "topic_boundary",
      "content": "Getting ready\n\nLog in to the console with the appropriate permissions.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe steps for creating an auto scaling group are as follows:\n\n1. Browse to the AWS EC2 console by typing the URL: https://console.aws.ama zon.com/ec2. Browse to Auto Scaling Groups under AUTO SCALING in left menu bar. You'll see the following dashboard if there are no Auto Scaling groups or launch configurations already created:\n\nCreate Auto Scaling Group\n\n2. Click on Create Auto Scaling group. The following screen will appear. You can create a new launch configuration or select the existing one and click on Next Step:\n\nCreate Auto Scaling group with launch configuration\n\n3. Provide a name in Group name and Group size to create the minimum number of instances in the group. Select VPC in the Network option and one or more subnets to provide the AWS information about where these instances will be created. Leave the Advanced Details as they are. Click Next: Configure scaling policies. You should choose the same VPC with which the Security Group of the launch configuration is associated:\n\nCreate Auto Scaling Group Details\n\n4. You can keep the group at its initial size. Otherwise define policies when you need to increase number of instances in group and reduce number of instances in the group. You provide the minimum and maximum instances in the group:\n\nCreate Auto Scaling group capacity\n\n5. You need to click on the Add new alarm link to increase and decrease the group size sections. You can see we are defining policies to add new instances in the group; you can select from different parameters and conditions. You can optionally define the notification group to send an email when this event occurs. Here I have defined a policy to add an instance if the average CPU utilization of the instances in the group is more than or equal to 70% for at least 5 minutes. Click on Create Alarm:\n\nAlarm for increase group size\n\n6. Similarly, we can define the policy to decrease the number of instances in the group if the average CPU utilization of the instances in the group is less than or equal to 30% for at least 5 minutes:\n\nAlarm for decrease group size\n\n7. Put the number of instances to be added and removed when the respective policies occur. Click on Review:\n\nConfigure scaling policy for Auto Scaling group\n\n8. Review the details and click on Create Auto Scaling group:\n\nReview creation of Auto Scaling group\n\n9. An Auto Scaling group will be created and the next time you go to the menu, you will see the newly created Auto Scaling group:\n\nAuto Scaling group details\n\n10. Note that one instance will be created and the instances column will show 1 after some time. Even if you delete the instance, one more instance will be created to have the minimum number of instances defined in this group. If you want to associate the Auto Scaling group with a load balancer, click on the Edit button on the Details tab. Add the load balancer and the target group. Click on the Save button:\n\nEdit Auto Scaling group details\n\n11. You can select the Auto Scaling group from the Actions menu to Edit or Delete the scaling group. If you delete a scaling group, instances associated with this group will also be terminated.\n\nOceanofPDF.com",
      "page_number": 202
    },
    {
      "number": 23,
      "title": "Segment 23 (pages 210-217)",
      "start_page": 210,
      "end_page": 217,
      "detection_method": "topic_boundary",
      "content": "There's more...\n\nScaling policies can be defined using any available cloud watch statistics. We can define the custom cloud watch metrics which can also be used to define policies. If you define the desired and minimum instance as 0, instances will not be created even if you don't delete the scaling group.\n\nYou can define the scheduled actions if you want the number of instances to vary according to a fixed schedule.\n\nOceanofPDF.com\n\nCreating VPC peering\n\nInstances in a VPC are isolated from other VPCs. We need to create VPC peering to communicate between instances using the private IPv4 or IPv6 IPs. You can create peering between two VPCs in the same region. Both the VPCs can either belong to the same AWS account or different accounts. Here we'll learn how to create VPC peering between two VPCs in one account.\n\nOceanofPDF.com\n\nGetting ready\n\nLog in to the console with the appropriate permissions.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe steps to create VPC peering are as follows:\n\n1. Browse to the AWS VPC console. In the left menu option, choose Peering Connections under Virtual Private Cloud:\n\nCreate Peering Connection\n\n2. Click on Create Peering Connection. Provide the Peering connection name tag, VPC (Requester) and VPC (Accepter). Click on Create Peering Connection:\n\nCreating Peering Connection\n\n3. In the dashboard, you can see the created peering connection. However the status is Pending Acceptance:\n\nDashboard with Peering Connection Created\n\nOceanofPDF.com\n\nAccepting VPC peering\n\nPeering is not complete till the owner of the accepter VPC accepts the peering request. Also, you need to enable the Route Table of the VPC to enable network traffic flow.\n\nOceanofPDF.com\n\nGetting ready\n\nLog in to the console with the appropriate permissions. The recipe for Creating VPC peering has to be executed first.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe steps for accepting VPC peering:\n\n1. Browse to the AWS VPC console. In the left menu option, choose Peering Connections under Virtual Private Cloud. Select the peering connection and browse to Actions | Accept Request:\n\nPeering Connection Actions\n\n2. The following window will open. Click on Yes, Accept. The confirmation window will come with an option to Modify my route tables now; you can click that to go to the Route Tables page. We'll choose Close and do this later:\n\nAccept Peering Connection Request\n\n3. You can see the status has now changed to Active:",
      "page_number": 210
    },
    {
      "number": 24,
      "title": "Segment 24 (pages 218-225)",
      "start_page": 218,
      "end_page": 225,
      "detection_method": "topic_boundary",
      "content": "4. Browse to Actions | Edit DNS Settings. Allow the DNS resolution. Click on the Save button:\n\nDNS setting of Peering Connection\n\n5. You can see that the DNS settings are now enabled. To delete the peering connection, choose Actions | Delete VPC Peering Connection:\n\nPeering Connection Details\n\n6. Go to the VPC associated with the peering connection. Click on the Route Table of one VPC. Click on the Edit button and add the route for\n\nVPC peering mentioning the CIDR range of other VPCs as shown. Click on the Save button. Do the same for the other VPC routing table:\n\nRouting for VPC with Peering Connection\n\n7. Now you are ready and the instances of one VPC can communicate with the other VPC peering connection.\n\nOceanofPDF.com\n\nThere's more...\n\nYou may get an error in the last step when mentioning VPC does not have a public hostname enabled. Select the respective VPC from the VPC console. From Actions | Edit DNS Hostname, select yes and save. Try again and configure VPC Peering.\n\nOceanofPDF.com\n\nConfiguring routes between multiple VPCs peered together\n\nFor allowing communication between multiple VPCs, you need to create a peering connection between each participating VPC individually. If there are three VPCs, A, B, and C and you want to create a peering connection then you need to create the connection, A-B, B-C and A-C.\n\nOceanofPDF.com\n\nLimitations of VPC peering connection\n\nLimitations of VPC peering connection are:\n\nYou cannot create a peering connection between VPCs with an overlapping CIDR range. You cannot create VPC peering between VPCs in different regions. Peering does not support unicast reverse path forwarding. Peering is not transitive. This means, if you have peering between VPC A and B, and you also have another peering between A and C, A and C cannot talk to each other.\n\nOceanofPDF.com\n\nControlling access to VPC peering connections\n\nVPC peering connections can't be created or modified by IAM users by default. An IAM policy allowing VPC peering connections needs to be created and added to an IAM group. Users who need to manage peering connections need to be added to the group.\n\nOceanofPDF.com\n\nConfiguring VPN connections to your Amazon VPC\n\nBy default, instances in your data center cannot communicate securely to instances in the VPC. Establishing an IPSec VPN enables you to do so. There are three components of a VPN connection which are as follows:\n\nVirtual Private Gateway (VGW) is a part of the VPN connection on the AWS side. AWS provides two redundant IPSec tunnels in the VPC to provide high availability. Customer Gateway (CGW) is a part of the VPN connection on the data center. To have redundant connections for high availability, we need multiple CGWs configured in the data center. It will ensure continuous connectivity, even if one fails. VPN connection that connects between VGW and CGW.\n\nTo have connectivity to multiple data centers, you need to configure different CGWs and configure the VPN channel with the same VGW:\n\nMultiple VPN Connection with VPC\n\nSource: http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/images/Branch_Offices_diagram.png\n\nOceanofPDF.com",
      "page_number": 218
    },
    {
      "number": 25,
      "title": "Segment 25 (pages 226-233)",
      "start_page": 226,
      "end_page": 233,
      "detection_method": "topic_boundary",
      "content": "Getting ready\n\nLog in to the console with the appropriate permissions.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe steps are as follows:\n\n1. Browse to the VPC console. Select the Virtual Private Gateways option under the VPN Connections on the left menu. Click on Create Virtual Private Gateway:\n\nCreate Virtual Private Gateway\n\n2. Provide the Name tag and you can click on Yes, Create. You can see the State as detached:\n\nVirtual private gateway created and detached\n\n3. Click on Attach to VPC. Select the VPC with which you want to attach the VGW. Click on Yes, Attach:\n\nAttaching Virtual Private Gateway to VPC\n\n4. You can see that the state has changed to attached after some time. Also, the VPC with which it is attached is shown in detail. If you want to delete a VPG, you need to first detach it and then delete it from the top menu options:\n\nVirtual Private Gateway Created and Attached\n\n5. Select the Virtual Private Gateways option under VPN Connections on the left menu. Click on Create Customer Gateway. Provide the Name tag and IP address, leave Routing as Static. Click on Yes, Create:\n\nCreate customer gateway\n\n6. You can see the CGW that we created with Status available. You can delete the CGW by clicking the Delete Customer Gateway button when you no longer need it:\n\nCustomer Gateway Details\n\n7. Click on VPN Connections from the left menu option and click on Create VPN Connection. Provide the Name tag, choose the Virtual Private Gateway, Customer Gateway, and click on Yes, Create:\n\nCreate VPN connection\n\n8. You can see the VPN connection created in the dashboard. You can remove the VPN by clicking the Delete button when you don't need it:\n\nVPN connection details\n\n9. Click on Download Configuration. You can choose the Vendor, Platform, and Software in the window. For now, let's choose Microsoft as the Vendor, Windows Server as the Platform, and 2012 R2 as the Software. Click on Yes, Download to download the configuration file for configuring the router in DC. The content of the file will be like the following:\n\n! Amazon Web Services ! Virtual Private Cloud ! To configure this VPN connection using the New Connection Security Rule Wizard ! in the Windows Server 2012 R2 console, use the information below and refer to ! the AWS VPC Network Administrator Guide for more information: ! http://docs.aws.amazon.com/AmazonVPC/latest/NetworkAdminGuide/customer- gateway-windows-2012.html ! Your VPN Connection ID : vpn-70abbb11 ! Your Virtual Private Gateway ID : vgw-68a74c01 ! Your Customer Gateway ID : cgw-7ab15a13 ! Information needed for the configuration of your VPN connection: ! vgw-68a74c01 Tunnel1 ! ------------------------------------------------------------------------ -------- ! Local Tunnel Endpoint: 192.34.56.73 ! Remote Tunnel Endpoint: 34.225.227.231 ! Endpoint 1: [Your_Static_Route_IP_Prefix] ! Endpoint 2: [Your_VPC_CIDR_Block] ! Preshared key: yM2c0CIQsERVaVPHLPP97zt7NMw0U7tu ! vgw-68a74c01 Tunnel2 ! ------------------------------------------------------------------------ -------- ! Local Tunnel Endpoint: 192.34.56.73 ! Remote Tunnel Endpoint: 34.227.145.250 ! Endpoint 1: [Your_Static_Route_IP_Prefix] ! Endpoint 2: [Your_VPC_CIDR_Block] ! Preshared key: jmTUcawwqCh1hs0aPMTdu1kAIhLYOSF2 ! Local Tunnel Endpoint: ! The IP address you entered for your customer gateway when you created ! the VPN connection for your Amazon VPC. ! ! * You should use the private IP address of the Windows Server 2012 R2 ! server rather than this IP address when you enter the Local Tunnel Endpoint ! in the New Connection Security Rule Wizard or in the netsh script below. ! Remote Tunnel Endpoint ! One of two IP addresses for the Amazon virtual private gateway that ! terminates the VPN connection on the AWS side of the connection. ! Endpoint 1 ! The IP prefix that you entered as a static route when you created your ! VPN connection. This indicates the IP addresses in your network that are ! allowed to use the VPN connection to access your Amazon VPC. ! Endpoint 2 ! The IP address range (CIDR block) of your Amazon VPC; for example, 10.0.0.0/16 ! Preshared key ! This is the pre-shared key that is used to establish IPsec VPN connection ! between the Local Tunnel Endpoint and the Remote Tunnel Endpoint. ! Note ! From time to time, AWS will perform routine maintenance on the virtual private ! gateway. This maintenance may disable one of the two tunnels of your VPN ! connection for a brief period of time. Your VPN connection will automatically ! fail over to the second tunnel while this maintenance is performed. To ensure ! uninterrupted service, it's important that you configure both tunnels.\n\n! Configuration Details for IKE and IPsec ! ======================================= ! Additional information regarding the Internet Key Exchange (IKE) and IPsec ! Security Associations (SA) are presented below. Because the AWS VPC VPN ! suggested settings are the same as the Windows Server 2012 R2 default IPsec ! configuration settings, minimal work is needed on your part (see QuickModePFS ! below.) ! MainModeSecMethods: DHGroup2-AES128-SHA1 ! MainModeKeyLifetime: 480min,0sess ! QuickModeSecMethods: ESP:SHA1-AES128+60min+100000kb ! QuickModePFS: DHGroup2 ! MainModeSecMethods ! This specifies the encryption and authentication algorithms for the IKE SA. ! These are the suggested settings for the AWS VPC VPN connection and are the ! default settings for Windows Server 2012 R2 IPsec VPN connections. ! MainModeKeyLifetime ! This specifies the IKE SA key lifetime. This is the suggested setting for ! the AWS VPC VPN connection and is the default setting for Windows Server ! 2012 R2 IPsec VPN connections. ! QuickModeSecMethods ! This specifies the encryption and authentication algorithms for the IPsec SA. ! These are the suggested settings for the AWS VPC VPN connection and are the ! default settings for Windows Server 2012 R2 IPsec VPN connections. ! QuickModePFS ! The use of master key perfect forward secrecy (PFS) is suggested for your ! IPsec sessions. Enabling PFS isn't possible via the Windows Server 2012 R2 ! user interface. The only way to enable this setting is to execute the netsh ! script (below) with QMPFS=dhgroup2 ! Dead Gateway Detection ! ------------------------------------------------------------------------ -------- ! To configure TCP to detect when a gateway becomes unavailable, run the following ! command to enable Dead Gateway Detection: reg add HKLM\\System\\CurrentControlSet\\services\\Tcpip\\Parameters ^ /v EnableDeadGWDetect /t REG_DWORD /d 1 ! After you change the registry key, you must reboot the server. ! Netsh script to configure your IPsec VPN connection ! ------------------------------------------------------------------------ -------- ! You can automatically configure your IPsec VPN connection by copying and pasting ! the netsh scripts below. Replace the items in brackets [] with the appropriate ! values as indicated above. ! Script for Tunnel 1: netsh advfirewall consec add rule Name=\"vgw-68a74c01 Tunnel 1\" ^ Enable=Yes Profile=any Type=Static Mode=Tunnel ^ LocalTunnelEndpoint=[Windows_Server_Private_IP_address] ^\n\nRemoteTunnelEndpoint=34.225.227.231 Endpoint1= [Your_Static_Route_IP_Prefix] ^ Endpoint2=[Your_VPC_CIDR_Block] Protocol=Any Action=RequireInClearOut ^ Auth1=ComputerPSK Auth1PSK=yM2c0CIQsERVaVPHLPP97zt7NMw0U7tu ^ QMSecMethods=ESP:SHA1-AES128+60min+100000kb ^ ExemptIPsecProtectedConnections=No ApplyAuthz=No QMPFS=dhgroup2 ! Script for Tunnel 2: netsh advfirewall consec add rule Name=\"vgw-68a74c01 Tunnel 2\" ^ Enable=Yes Profile=any Type=Static Mode=Tunnel ^ LocalTunnelEndpoint=[Windows_Server_Private_IP_address] ^ RemoteTunnelEndpoint=34.227.145.250 Endpoint1= [Your_Static_Route_IP_Prefix] ^ Endpoint2=[Your_VPC_CIDR_Block] Protocol=Any Action=RequireInClearOut ^ Auth1=ComputerPSK Auth1PSK=jmTUcawwqCh1hs0aPMTdu1kAIhLYOSF2 ^ QMSecMethods=ESP:SHA1-AES128+60min+100000kb ^ ExemptIPsecProtectedConnections=No ApplyAuthz=No QMPFS=dhgroup2 ! Additional Notes and Questions ! - Amazon Virtual Private Cloud Getting Started Guide: ! http://docs.aws.amazon.com/AmazonVPC/latest/GettingStartedGuide ! - Amazon Virtual Private Cloud Network Administrator Guide: ! http://docs.aws.amazon.com/AmazonVPC/latest/NetworkAdminGuide ! - XSL Version: 2009-07-15-1119716\n\nYou configure the router in your data center with this configuration. You are all set for primitively connecting AWS from your data center.\n\nOceanofPDF.com",
      "page_number": 226
    },
    {
      "number": 26,
      "title": "Segment 26 (pages 234-241)",
      "start_page": 234,
      "end_page": 241,
      "detection_method": "topic_boundary",
      "content": "Configuring Global Scale Infrastructure\n\nIn this chapter, we will learn the following recipes:\n\nCreating a VPC and Subnet from the CLI Creating a VPC to DC Connectivity--VPN Tunneling Creating a VPC with a private subnet and connecting DC Creating a multi-region VPC communication Setting up a private DNS with a VPC Migrating to IPv6\n\nOceanofPDF.com\n\nIntroduction\n\nIn this chapter, we will learn how to quickly create different AWS VPC networking topologies. We will also learn how to connect two VPCs in the same region or across different AWS regions. Criteria for choosing one of the different available topologies of VPC will depend on the following different considerations:\n\nAvailability of the application deployed to AWS: Single AZ deployment can provide moderate availability. Multi AZ deployments will provide high availability and fault tolerance of a single AZ failure. Multi region deployment will provide very high availability of the application. It will be available even if the complete region of AWS fails. Creating a public and private subnet: Public and private subnets need to be created based on the security requirements of different layers of the application. Connectivity requirement between data center (DC) and AWS Cloud: For securely connecting DC and AWS Cloud, VPN needs to be created. However it works over internet. For high bandwidth and dedicated connectivity, direct connect can be configured. VPN hub can be created for connecting multiple DCs to AWS VPCs. Connectivity amongst different VPCs: Different VPCs in the same or different regions may need to be connected for security and high availability.\n\nAWS provides a VPC wizard for the quick creation of some of these topologies to fit their exact use case.\n\nOceanofPDF.com\n\nCreating a VPC and subnet from the CLI\n\nAWS CLI is a command-line interface that facilitates managing AWS resources from the command line. Until now we have learnt recipes for creating AWS networking components from the console. In this recipe we'll learn how to create them through the CLI. This will help you understand how scripts can be written to automate the management of network components.\n\nOceanofPDF.com\n\nGetting ready\n\nYou will need to configure the CLI in your system from which you are going to execute the commands.\n\nOceanofPDF.com\n\nHow to do it...\n\nFollow the steps provided to create AWS VPC and subnet from CLI.\n\n1. Open your command prompt and give the command:\n\naws ec2 create-vpc --profile user2 --region us-east-1 --cidr-block 10.0.0.0/16 --amazon-provided-ipv6-cidr-block\n\nThe different components of our command are explained as follows:\n\naws ec2 create-vpc: It is the command for creating a VPC profile. user2: It is the user profile with which a VPC is being created. You may omit this if you want to create the VPC with a default profile. region us-east-1: It is the AWS region where the VPC is going to be created. You can omit this if you want to create it in the default region. cidr-block 10.0.0.0/16: It is the IPv4 CIDR block associated with the VPC. amazon-provided-ipv6-cidr-block: It is an option, if you want AWS to associate IPv6 to be with VPC.\n\nCreate VPC from CLI\n\n2. You can see the response where a VPC is created with the ID vpc- 23e0795a with a given CIDR range for both IPv4 and IPv6.\n\n3. You can browse to the AWS console for the VPC and check that the VPC has been created with the properties shown in the command prompt.\n\nView VPC created from CLI\n\n4. Now let's create a subnet in the VPC by giving the following command:\n\naws ec2 create-subnet --profile user2 --region us-east-1 --vpc-id vpc- 23e0795a --cidr-block 10.0.1.0/24 --ipv6-cidr-block 2600:1f18:4659:5c00::/64\n\nHere we are providing the profile and region that we explained earlier. We are also providing the following options:\n\nvpc-id vpc-23e0795a: The VPC in which subnet will be created cidr-block 10.0.1.0/24: The IPv4 CIDR range of the subnet ipv6-cidr-block 2600:1f18:4659:5c00::/64: The IPv6 IP range associated with the subnet\n\nCreate subnet from CLI\n\n5. We can browse to the AWS VPC console and go to subnets. We can see the subnet created as shown in the following screenshot:\n\nView subnet created from CLI\n\nOceanofPDF.com\n\nThere's more...\n\nHence, you can create multiple VPCs and subnets in multiple regions from a single script. There are multiple other third party tools like Terraform, Chef, Ansible through which you can also create and manage AWS components. You can also use AWS CloudFormation for the same. We will look at some of these in next chapters.\n\nOceanofPDF.com",
      "page_number": 234
    },
    {
      "number": 27,
      "title": "Segment 27 (pages 242-249)",
      "start_page": 242,
      "end_page": 249,
      "detection_method": "topic_boundary",
      "content": "Creating a VPC to DC connectivity--VPN Tunneling\n\nEarlier we learnt how to create a VPC, subnet and a VPN in separate recipes. In this recipe, we will learn how to create those in a single recipe.\n\nOceanofPDF.com\n\nGetting ready\n\nLog in to your AWS account with the proper permissions for creating the required components.\n\nOceanofPDF.com\n\nHow to do it...\n\nAWS provides simple steps for creating basic AWS networking components for first time users.\n\n1. Open the VPC dashboard by browsing https://console.aws.amazon.com/vpc as shown in the following screenshot:\n\nVPC console\n\n2. Click on Start VPC Wizard. We have already provided a recipe for the first option in Chapter 1, Getting Started with AWS Networking Components. The following window will open:\n\nVPC wizard with single public subnet\n\n3. Let's select the option VPC with Public and Private Subnets and Hardware VPN Access. The preceding screenshot explains the components that we are going to create. One VPC\n\nOne public subnet that can be accessed from the internet One private subnet that can be accessed through a corporate data center One VPN connection that connects the corporate data center to the AWS subnet Service endpoint for connecting services like S3 over a private network\n\nVPC wizard with single public, private subnet, and VPN\n\n4. Click on the Select button. Provide the IPv4 CIDR block, IPv6 CIDR block, VPC name, Public subnet's IPv4 CIDR, Availability Zone for the public subnet, Public subnet name, Private subnet's IPv4 CIDR, Availability Zone for the private subnet, and the Private subnet name as shown in the following screenshot:\n\nCreate VPC, two subnets, and VPN\n\n5. Click on Add Endpoint. You can choose the subnet to which the endpoint needs to be connected, and access the policy for either full access or customized access. You can add more endpoints by clicking Add Endpoint for attaching multiple endpoints with multiple policies for the target subnet group.\n\nFigure 4- 9 Create a VPC endpoint\n\n6. Choose Enable DNS hostnames and Hardware tenancy. Click on Next. 7. Provide the details for the VPN, and click on Create VPC.\n\nVPN configuration\n\n8. You can browse to the VPC Dashboard and find the VPC that we created.\n\nDetails of the VPC created\n\n9. You can also see the subnets created and associated with the VPC.\n\nSubnets of VPC created\n\n10. You can also see the VPN connection created and associated with the VPC.\n\nSubnet with the VPC created\n\n11. You can click on Download Configuration, and download the configuration file after choosing the right options.\n\nVPN configuration download\n\nOceanofPDF.com",
      "page_number": 242
    },
    {
      "number": 28,
      "title": "Segment 28 (pages 250-257)",
      "start_page": 250,
      "end_page": 257,
      "detection_method": "topic_boundary",
      "content": "There's more...\n\nIn the preceding configuration, NAT is not attached to the routes created with the public subnet. So if instances want to have internet connectivity, they can either do that through the DC network or an additional NAT needs to be attached. Instances in a public subnet can access DC either through the internet or through the VPN.\n\nOceanofPDF.com\n\nCreating a VPC with a private subnet and connecting DC\n\nSometimes for security purposes, you will want to host instances in AWS and treat it as an extension of the corporate DC. In this case, VPC will only have a private subnet and a VPN connection to the DC for connectivity. In this recipe, we will learn how to create connectivity with the DC, without creating a public subnet.\n\nOceanofPDF.com\n\nGetting ready\n\nLog in to your AWS account with proper permissions for creating the required components.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Open the VPC dashboard by browsing to https://console.aws.amazon.com/vpc as shown in the following screenshot:\n\nVPC wizard\n\n2. Click on Start VPC Wizard. Let's select the option VPC with a Private Subnet Only and Hardware VPN Access. The screenshot explains the components that we are going to create. One VPC One private subnet that can be accessed through a corporate data center One VPN connection that connects the corporate data center to the AWS subnet Service endpoint for connecting services like S3 over a private network\n\nVPC wizard with Private Subnet and Hardware VPN\n\n3. Click on the Select button. Provide the required details. You can optionally click on Add Endpoint. Click on Next.\n\nDetails of private subnet and hardware VPN\n\n4. Provide the required details for a VPN connection. Click on Create VPC as shown in the following screenshot:\n\nConfigure VPN\n\n5. Provide the required details for a VPN connection. Click on Create VPC. The VPC will be created. You can then browse to the VPC Dashboard to see the details of the VPC as shown in the following screenshot:\n\nDetails of VPC created\n\nOceanofPDF.com\n\nCreating a multi-region VPC communication\n\nSometimes we need to host applications across multiple VPCs that spread across several regions for hosting a solution in very high demand. In this case, we need to have connectivity between VPCs in different regions. There are multiple options for how this can be achieved. We'll do this using the strongSwan open source software which is an implementation of the IPSEC-based VPN solution.\n\nOceanofPDF.com\n\nGetting ready\n\nLog in to your AWS account with proper permissions for creating the required components.\n\nOceanofPDF.com",
      "page_number": 250
    },
    {
      "number": 29,
      "title": "Segment 29 (pages 258-265)",
      "start_page": 258,
      "end_page": 265,
      "detection_method": "topic_boundary",
      "content": "How to do it...\n\n1. Create a VPC from the VPC wizard in the US-West (Oregon) region using the VPC with a Single Public Subnet option with CIDR range 7.0.0.0/16 for VPC and 7.0.0.0/24 for the subnet as shown in the following screenshot:\n\nVPC creation in one region\n\n2. Create another VPC from the VPC wizard in the US-East (Ohio) region using the VPC with a Single Public Subnet option with CIDR range 8.0.0.0/16 for VPC and 8.0.0.0/24 for the subnet as shown in the following screenshot:\n\nVPC creation in second region\n\n3. Change the region to US-West (Oregon). Create an EC2 instance in the first region using an AMI for an Ubuntu Server, t2.micro instance type to VPC and the subnet that we created. Configure the security group for allowing traffic for the following: TCP 22 (SSH protocol) from 0.0.0.0/0 UDP 500 (IKE protocol) from 0.0.0.0/0 UDP 4500 (IPSec/UDP) from 0.0.0.0/0 All TCP from 8.0.0.0/16 (second VPC)\n\nNote that you should configure the SG based on your requirements. Also create and store the key.\n\nThe EC2 will look like the following from the console:\n\nDetails of EC2 created in one region\n\n4. Disable source destination and check for the instance.\n\nDisabling source destination Check for EC2\n\n5. Attach an elastic IP to the instance. It has a public IP attached to it as shown in the following screenshot:\n\nAttach Elastic IP to one instance\n\n6. Create a similar instance in the US-East (Ohio) region in the VPC and in the subnet that we created. Disable source-destination check. Attach the Elastic IP. The only difference from step 3 is to assign security groups for allowing traffic from the first VPC: TCP 22 (SSH protocol) from 0.0.0.0/0 UDP 500 (IKE protocol) from 0.0.0.0/0 UDP 4500 (IPSec/UDP) from 0.0.0.0/0\n\nAll TCP from 7.0.0.0/16 (first VPC)\n\nIt should look like the following:\n\nEC2 details in second region\n\n7. Log in to an instance in the Ohio region by following the earlier recipe. The default log in name is ubuntu.\n\nLog in to EC2 in one region\n\n8. To enable packet forwarding in the instance, execute the following command:\n\nsudo sysctl -w net.ipv4.ip_forward=1\n\nFigure 4- 27 Configure IPv4 forward\n\n9. Install strongswan in your instance using the following command:\n\nsudo apt-get install -y strongswan\n\nWe need to configure the /etc/strongswan/ipsec.conf file for setting up a connection. This needs to be put in the EC2 instances of both regions. Here is the common part for each:\n\nconfig setup strictcrlpolicy=no charondebug=all conn %default ikelifetime=60m keylife=20m rekeymargin=3m keyingtries=1 keyexchange=ikev2\n\nThis additional section needs to be put in the EC2 instance of Ohio region:\n\nconn Ohio authby=secret auto=start type=tunnel left=8.0.0.85 leftid=52.15.254.68 leftsubnet=8.0.0.0/16 leftauth=psk right=54.148.58.245 rightsubnet=7.0.0.0/16 rightauth=psk ike=aes128-sha1-modp1024 esp=aes128-sha1-modp1024\n\nThis additional section needs to be put in the EC2 instance of Oregon region:\n\nconn Oregon authby=secret auto=start type=tunnel left=7.0.0.178 leftid=54.148.58.245 leftsubnet=7.0.0.0/16 leftauth=psk right=52.15.254.68 rightsubnet=8.0.0.0/16 rightauth=psk ike=aes128-sha1-modp1024 esp=aes128-sha1-modp1024\n\nCreate and save the files with your favorite text editor. You can see that the left side represents the IP and CIDR of the EC2 and VPC of the same AWS region the EC2 is being configured. The right side has the details for the other EC2 and VPC of the other AWS region.\n\n10. Create a /etc/strongswan/ipsec.secrets file with your favourite editor with content like the following in both instances. Change the public IP and secret key as per your case.\n\n<local public ip> : PSK \"your key\" <foreign public ip> : PSK \"your key \"\n\n11. Add the following line to the /etc/sysctl.conf file in both the EC2 instances.\n\nnet.ipv4.ip_forward=1\n\n12. Run the following command in both instances:\n\nsysctl -p\n\n13. Go to the routing table attached to the subnet which we created, and add the destination route of the other VPC CIDR and target it as the instance ID which we created.\n\nConfigure Route Table for one region\n\n14. Do the same for the routing table for other regions as well.\n\nConfigure Route Table for second region\n\n15. Now execute the following command to start strongswan as a root user:\n\nservice. strongswan start\n\n16. To check the status of the connection, execute the following command:\n\nservice strongswan status\n\nOceanofPDF.com\n\nThere's more...\n\nYou can ping one server in one region from other server in other region for checking connectivity between EC2 of both regions.\n\nYou should opt for stronger security policies for production use case. For example, the security groups should be open to a specific IP address range or the passphrase should be stronger.\n\nOceanofPDF.com",
      "page_number": 258
    },
    {
      "number": 30,
      "title": "Segment 30 (pages 266-273)",
      "start_page": 266,
      "end_page": 273,
      "detection_method": "topic_boundary",
      "content": "Setting up a private DNS with a VPC\n\nRoute 53 is a very highly available DNS server in AWS. It can work for both external routing as well as internal routing. Internal routing works within the internal network of a VPC where both source and destination services can be connected via internal IPs. It can be used for users or applications to connect within the private network boundary. The private network can be extended to Corporate data center, other VPC in same region connected through VPC peering or VPC in other region connected privately over secure channel.\n\nOceanofPDF.com\n\nGetting ready\n\nLog in to your AWS account with proper permissions for creating the required components.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Browse to the VPC console and select the VPC in which you want to configure the private DNS. Check if the DNS resolution and DNS Hostnames are yes as shown in the following screesnhot:\n\nCheck VPC DNS resolution and DNS hostnames\n\n2. Browse to https://console.aws.amazon.com/route53/home, to go to the Route 53 home page. You will see in the following page that you don't have any DNS configured yet:\n\nAWS Route 53 dashboard\n\n3. Click on Get started now under DNS management. The following window will appear:\n\nCreate hosted zone\n\n4. Click on Create Hosted Zone. Provide a Domain Name and\n\nComment. In the Type drop down choose Private Hosted Zone for Amazon VPC. Select the VPC ID where this service will be configured. Click on the Create button as you can see in the following screenshot:\n\nHosted zone details\n\n5. You will see the default record set associated with this DNS. You can also select the record set and change properties.\n\nAWS record set details\n\n6. You can click on Create Record Set to click additional record sets if required. Provide the Name, choose the Type and the routing policy as required. Provide a TTL (Seconds) and Value. Click on Create. I have selected Type as A - IPv4 addresses. I have provided internal IP of EC2 instances which I created earlier as you can see in the following screenshot:\n\nCreate record set\n\n7. You can see the record set created in the following screenshot:\n\nCustom record set details for record A\n\n8. You can see the hosted zone created by selecting the Hosted Zones on the menu on the left.\n\nHosted zone created\n\n9. You can add the required VPC by clicking on the Associate New VPC button and selecting the VPC to be associated.\n\n10. If you want to configure the internal domain forwarding requests to elb, the same steps should be followed, only the record Type should be CNAME\n\nand the Value is elb DNS name as you can see in the following screenshot:\n\nRecord set for ELB CNAME record\n\nOceanofPDF.com\n\nThere's more...\n\nDNS hostname and DNS support needs to be enabled for the VPC where you are going to configure the private DNS. By default, these are enabled; otherwise you can do that from the Actions drop-down after selecting the VPC.\n\nOceanofPDF.com",
      "page_number": 266
    },
    {
      "number": 31,
      "title": "Segment 31 (pages 274-283)",
      "start_page": 274,
      "end_page": 283,
      "detection_method": "topic_boundary",
      "content": "Migrating to IPv6\n\nIPv6 support has been added to AWS since December 2016. So VPCs created prior to that didn't have IPv6 support. This recipe shows how to add IPv6 support with VPCs that have been created with the IPv4 option only.\n\nOceanofPDF.com\n\nGetting ready\n\nLog in to your AWS account with proper permissions for creating the required components.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Open the VPC dashboard by browsing to https://console.aws.amazon.com/vpc. Select the VPC without IPv6 support. You can see that IPv6 CIDR is blank as shown in the following screenshot:\n\nCheck VPC IPv6 CIDR\n\n2. Click Actions | Edit CIDRs. The following window will open. Click on Add IPv6 CIDR button. IPv6 CIDR will be associated. Click Close as shown in the following screenshot:\n\nEdit VPC IPv6 CIDR\n\n3. You can see it reflected in the Summary as well:\n\nVPC Summary after IPv6 Support\n\n4. Select the subnet associated with the VPC on which you want to enable IPv6 CIDR.\n\nSubnet summary before IPv6 support\n\n5. Click Subnet Actions and edit IPv6 CIDR. Click on Add IPv6 CIDR. Edit IPv6 CIDR range and click on the tick button. Click on the Close button as seen in the following screenshot:\n\nEdit Subnet IPv6 support\n\n6. You can see the IPv6 associated with the subnet from the Summary as seen in the following screenshot:\n\nSubnet summary after IPv6 support\n\n7. NAT instances don't work with IPv6 addresses. To enable the egress of traffic from instances hosted in a private subnet, we need an Egress Only Internet Gateways to be associated with the routing table. So you need to create an Egress-Only Internet Gateway. Click on Egress Only Internet Gateways.\n\nEgress Only Internet Gateway dashboard\n\n8. Click on Create Egress Only Internet Gateway. Associate the VPC from the dropdown menu. Click on Create.\n\nCreate Egress Only Internet Gateway\n\n9. Select the Routing Tables from the left menu bar. Select one associated with the private subnet of the VPC. Go to the Routes tab. Click on Edit. Click on Add another route. Put ::/0 in the destination and select the Internet Gateway in the Target. Click on Save.\n\nModify router for IPv6 support\n\n10. Select Security Group from the left menu bar. Select one associated with the subnet of the VPC. Go to the Inbound Rules tab. Click on Edit.\n\nClick on Add another rule. Put ::/0 or appropriate IPv6 CIDR range in the source. Click on Save.\n\nSecurity Group Support for IPv6\n\n11. If you have modified the default rules of NACL, you also need to add the configuration for IPv6; as we have not done that, we are skipping this step.\n\n12. Finally you need to assign the IPv6 address to the EC2. Browse to the EC2 Dashboard. In the menu, choose Instances. Select the instance and choose Actions | Networking | Manage IP Address:\n\nIPv6 support for EC2\n\n13. The following window will open. Click on Assign New IP under IPv6 Addresses. Click on Yes, Update. The IPv6 address will be assigned to instance.\n\nManage EC2 IPv6 IP\n\n14. The IPv6 address will be assigned to instance. You can see that in the dashboard.\n\nInstance with IPv6 support\n\nOceanofPDF.com\n\nThere's more...\n\nAll EC2 instance types are not IPv6 compliant. You can't migrate such instances to IPv6. You need to change the instance type to one that is IPv6 compliant before adding support to IPv6.\n\nOceanofPDF.com\n\nWorking with Infrastructure Automation\n\nIn this chapter, we will cover the following recipes:\n\nCreating, storing, and testing the template--CloudFormation Creating a new stack--CloudFormation Modifying the stack--CloudFormation Deleting the stack--CloudFormation Setting up Ansible Installing Ansible Creating Ansible playbooks for creating VPC\n\nOceanofPDF.com",
      "page_number": 274
    },
    {
      "number": 32,
      "title": "Segment 32 (pages 284-293)",
      "start_page": 284,
      "end_page": 293,
      "detection_method": "topic_boundary",
      "content": "Introduction\n\nNetworking infrastructure has become increasingly complex and advanced, and managing the configuration of networks has come under increased demands for higher velocity and consistency.\n\nThis chapter will focus on creating basic building blocks, that is, networks using automation scripts. We will be using CloudFormation and Ansible tools for automation. There are sample playbooks for your reference.\n\nCloudFormation provided by AWS gives us the ability to provision and manage AWS resources. CloudFormation templates support a wide range of AWS resources; you can create templates for the services and applications you want to build. You can create or update a stack to provision/manage the resources. You can create a template for managing a single EC2 instance or a highly available multi-tier application. The best part of CloudFormation is it automatically takes care of the sequence required for provisioning resources. There is no additional charge for CloudFormation; you just need to pay for the created resources. It supports YAML and JSON written templates.\n\nAnsible, powered by Red Hat, gives almost the same, and sometimes more, functionalities than other DevOps tools. With Ansible, migrations from anywhere, that is on-premises infrastructure, cloud to AWS, or anywhere become very easy. With Ansible, you can use the same simple playbook .yaml language to manage your infrastructure and deploy your application. Redeploy the application to a different environment by just changing the environment parameters.\n\nOceanofPDF.com\n\nInfrastructure as a Service\n\nInfrastructure as a Service (IaaS) is one of the service models of cloud computing that outsources computer infrastructure to support infrastructure operations. The basic functioning of IaaS is to allow all the hardware, the rack of servers, storage devices, and the network that is kept in the cloud and lets somebody else use it for their basic functioning.\n\nVPC Setup\n\nOceanofPDF.com\n\nWhy do we need to automate?\n\nThink of a scenario where you have really spent your blood to make things work and suddenly, one day, you get a message in the middle of the night that one of your regions has an API issue and it has started to affect your business. You have tried recovering that server but nothing seems to be fruitful and now you are forced to build the same infrastructure in another region. It is tough for you to even remember the sequence of the commands and the software that needs to be installed. Automation provides an effortless way of writing a piece of code for everything, from creating the network to making everything up and running.\n\nThere are ways in which creating an infrastructure can be automated as per your requirements. Your automation should sense the current region/infrastructure and should directly trigger a new infrastructure in another region in case of any failure.\n\nVPC Setup in another region while failure\n\nOceanofPDF.com\n\nInfrastructure automation tools\n\nIt always feels good to build an IT infrastructure from scratch, but when you need to do it regularly it's not so great. Sometimes, you are pushing the same commands, building the same type of servers; the easiest way to do it is by automation.\n\nThere are many tools available for automation, so there is no best tool that fits every environment; you should select a tool according to your infrastructure, such as Ansible, CloudFormation, Chef, Puppet, SaltStack, Jenkins, and so on.\n\nIn our example, we will be working on CloudFormation and Ansible.\n\nOceanofPDF.com\n\nCreating, storing, and testing the template--CloudFormation\n\nCloudFormation supports creating a VPC and its components for the mentioned CIDR block. We will go through the CloudFormation template and an example (JSON).\n\nOceanofPDF.com\n\nGetting ready\n\nBefore creating our first stack, we will need to create a template. CloudFormation templates can be written in JSON or YAML format.\n\nBelow are the basic snippets of various functions that we will be using in our example.\n\nOceanofPDF.com\n\nHow to do it...\n\nIn this section, we will focus on creating, storing, and testing the template. Let's start with some snippets of the template.\n\nOceanofPDF.com\n\nCreating the template\n\nYou can create a template in any text editor such as notepad and save the file with a .json extension.\n\nOceanofPDF.com\n\nVPC\n\nThe format for VPC declaration is: AWS::EC2::VPC\n\n{ \"Type\" : \"AWS::EC2::VPC\", \"Properties\" : { \"CidrBlock\" : String, \"EnableDnsSupport\" : Boolean, \"EnableDnsHostnames\" : Boolean, \"InstanceTenancy\" : String, \"Tags\" : [ Resource Tag, ... ] } }\n\nSr. No\n\nProperty\n\nRequired Type\n\nAvailable values\n\n1\n\nCIDRBlock\n\nYes\n\nString\n\nExample:\n\n192.168.0.0/16\n\n2\n\nEnableDnsSupport\n\nNo\n\nBoolean True/False\n\n3\n\nEnableDnsHostnames No\n\nBoolean True/False\n\n4\n\nInstanceTenancy\n\nNo\n\nString\n\n\"default\" / \"dedicated\"\n\n5\n\nTags\n\nNo\n\nString\n\nKey: String Value: String\n\nDefault value\n\nN/A\n\nTRUE\n\nTRUE\n\ndefault\n\nNA",
      "page_number": 284
    },
    {
      "number": 33,
      "title": "Segment 33 (pages 294-301)",
      "start_page": 294,
      "end_page": 301,
      "detection_method": "topic_boundary",
      "content": "Example:\n\n{ \"AWSTemplateFormatVersion\" : \"2010-09-09\", \"Resources\" : { \"VPCTesting\" : { \"Type\" : \"AWS::EC2::VPC\", \"Properties\" : { \"CidrBlock\" : \"10.1.0.0/16\", \"EnableDnsSupport\" : \"false\", \"EnableDnsHostnames\" : \"false\", \"InstanceTenancy\" : \"dedicated\", \"Tags\" : [ {\"Key\" : \"Name\", \"Value\" : “VPC-Dev\"} ] } } } }\n\nOceanofPDF.com\n\nSubnet\n\nThe format for subnet declaration is:\n\n{ \"Type\" : \"AWS::EC2::Subnet\", \"Properties\" : { \"AvailabilityZone\" : String, \"CidrBlock\" : String, \"MapPublicIpOnLaunch\" : Boolean, \"Tags\" : [ Resource Tag, ... ], \"VpcId\" : String } }\n\nSno Properties\n\nRequired Type\n\nAvailable values\n\n1\n\nAvailabilityZone\n\nNo\n\nString\n\nExample: “us-east-1a”\n\n2\n\nCIDRBlock\n\nYes\n\nString\n\nExample,\n\n10.0.0.0/16\n\n3\n\nMapPublicIpOnLaunch No\n\nBoolean True/False\n\n4\n\nTags\n\nNo\n\nString\n\nKey: String Value: String\n\n5\n\nVpcId\n\nYes\n\nRef ID Example: \"Ref\": vpc-\n\n12345678\n\nDefault value\n\nAWS automatically selects a zone\n\nNA\n\nFALSE\n\nNA\n\nNA\n\nOceanofPDF.com\n\nInternet Gateway\n\nThe format for Internet Gateway is:\n\n{ \"Type\" : \"AWS::EC2::InternetGateway\", \"Properties\" : { \"Tags\" : [ Resource Tag, ... ] } }\n\nExample:\n\n\"InternetGateway\" : { \"Type\" : \"AWS::EC2::InternetGateway\", \"Properties\" : { \"Tags\" : [ \"Key\" : \"Name\", \"Value\" : { \"Ref\" : \"AWS::StackName\"} ] } },\n\nOceanofPDF.com\n\nElastic IP\n\nThe format for Elastic IP is:\n\n{ \"Type\" : \"AWS::EC2::EIP\", \"Properties\" : { \"InstanceId\" : String, \"Domain\" : String } }\n\nSno Properties Required\n\nType\n\n1\n\nInstanceId\n\nNo\n\nString\n\n2\n\nDomain\n\nConditional String\n\nExample:\n\n\"EIP\" : { \"Type\" : \"AWS::EC2::EIP\", \"Properties\" : { \"Domain\" : \"vpc\" } }\n\nOceanofPDF.com\n\nNat Gateway\n\nThe format for NAT Gateway is:\n\n{ \"Type\" : \"AWS::EC2::NatGateway\", \"Properties\" : { \"AllocationId\" : String, \"SubnetId\" : String } }\n\nSno Properties Required Type\n\n1\n\nAllocationId Yes\n\nString\n\n2\n\nSubnetId\n\nYes\n\nString\n\nExample:\n\n\"NATGateway\" : { \"Type\" : \"AWS::EC2::NatGateway\", \"DependsOn\": \"VPCGatewayAttach\", \"Properties\" : { \"AllocationId\" : { \"Fn::GetAtt\" : [\"NATGatewayEIP\", \"AllocationId\"]}, \"SubnetId\" : { \"Ref\" : \"PublicSubnet\"} } }\n\nOceanofPDF.com\n\nStoring the template\n\nWhen you upload a template in CloudFormation to create your stack, CloudFormation will by default store the template into S3 Upload the source code into S3 and maintain versions of the template It's good to store the template into source control\n\nOceanofPDF.com\n\nTesting the JSON template\n\nThere are many tools available for JSON format testing, for example: https://j sonlint.com/.\n\nTesting JSON Template\n\nOceanofPDF.com",
      "page_number": 294
    },
    {
      "number": 34,
      "title": "Segment 34 (pages 302-310)",
      "start_page": 302,
      "end_page": 310,
      "detection_method": "topic_boundary",
      "content": "There's more...\n\nThere are a few best practices that you can follow while creating and storing your templates:\n\nNever embed credentials into the template; use input parameters to pass sensitive information to your environment. Be specific when providing access to any user to CloudFormation because modifying/deleting a CloudFormation stack can lead to unexpected disasters. Use the service role's policy to make calls instead of the user's policy. You can also store templates in a source repository such as GitHub or SVN and use the same template to replicate the environment in other regions. Make sure the resources you specify in the template don't hit the resource limit, otherwise your stack creation will fail. Always validate the template before using it. You can validate it by using CloudFormation or any other third-party tool. To modify the changes in the stack, always use change sets instead of direct updates. Using change sets will help in reviewing the changes. Both types of stack updates are mentioned in further recipes.\n\nOceanofPDF.com\n\nCreating a new stack-- CloudFormation\n\nA Cloudformation stack acts as a single unit to provision and manage your stack. All the resources in the stack are defined in Templates. A stack can include all the resources for creating your multi-tier architecture or a single server, and whenever you don't need the server/infrastructure, you can instantly delete the stack. Deleting the stack will terminate and release all the resources associated with it.\n\nOceanofPDF.com\n\nGetting ready\n\nYou will need to have the required permissions for VPC and CloudFormation. Also, keep your CIDR block ready for VPC and subnets. Be very careful when choosing your CIDR block, as you cannot update it later.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe steps for creating a new stack on CloudFormation are as follows:\n\n1. Log in to the AWS console.\n\nLogin into AWS console\n\n2. Go to CloudFormation service, as shown in the following screenshot:\n\nSearch CloudFormation\n\n3. Click on Create New Stack, as shown in the following screenshot:\n\nCloudFormation Console\n\n4. The code for Upload a template to Amazon S3 is available at https://github. com/PacktPublishing/AWS-Networking-Cookbook:\n\nSelect Template\n\n5. Provide a CIDR for your VPC, private, and public subnet, then click on Next, as shown in the following screenshot:\n\nProvide Subnet Details\n\n6. Provide the additional tag if required, then click Next.\n\nProvide Additional Tags\n\n7. Review the stack and click Create, as shown in the following screenshot:\n\nReview Stack Creation\n\n8. You will get the following screen:\n\nStack Creation\n\n9. Once all the resources have been created, the Status will be updated as CREATE_COMPLETE, as shown in the following screenshot:\n\nStack Overview\n\n10. You will get all the details of the created resources in the Outputs section.\n\nStack Output\n\n11. Now let's check the VPC (AWS Dashboard | VPC | Select Your VPC).\n\nStack: AWS VPC\n\n12. Subnets (AWS Dashboard | VPC | Subnets provides a filter of your VPCs if you have multiple VPCs):",
      "page_number": 302
    },
    {
      "number": 35,
      "title": "Segment 35 (pages 311-318)",
      "start_page": 311,
      "end_page": 318,
      "detection_method": "topic_boundary",
      "content": "Stack: AWS VPC Subnets\n\n13. Tags will look as shown in the following screenshot:\n\nStack: AWS VPC Subnet Tags\n\n14. NAT Gateway (AWS Dashboard | VPC | NAT Gateway or use VPC filter to get the details).\n\nStack: AWS VPC NAT Gateway\n\n15. Internet Gateway (AWS Dashboard | VPC | Internet Gateway):\n\nStack: AWS VPC Internet Gateway\n\n16. Route Table (AWS Dashboard | VPC | Route Table):\n\nStack: AWS VPC Route Table\n\n17. Elastic IP (AWS Dashboard | VPC | Elastic IP):\n\nStack: AWS VPC Elastic IP\n\n18. VPC and all its components have been created successfully.\n\nOceanofPDF.com\n\nHow it works...\n\nTemplates define all the resources that need to be created, so when you create a stack, CloudFormation makes the underlying service calls to AWS to provision and configure your resources. CloudFormation resource creation does not depend on how you mention them in your template until you specify to create the resources one after another. You can use the DependsOn attribute to specify the creation of your resources.\n\nOceanofPDF.com\n\nModify the stack--CloudFormation\n\nNow, we will modify/update the stack. For modifying, we will use the same template and add one more subnet into the VPC. CloudFormation provides two methods for modifying your stack:\n\n1. Direct update:\n\nWhen you submit the changes, CloudFormation deploys them immediately You want to have a quick update on the stack Works well when you are sure of the changes\n\n2. Change sets:\n\nWill allow you to preview the changes Will not make the changes until you execute the change set Provides a JSON formatted document to summarize the changes Creates multiple change sets of different changes by providing a modified template\n\nOceanofPDF.com\n\nGetting ready\n\nBefore going forward into this recipe, make sure you know how you want to update your changes. If you are sure with your changes, then select the direct update method, otherwise it is always preferred to use change sets (as we get time to review the changes).\n\nOceanofPDF.com\n\nHow to do it...\n\nThe following subsection will include how to make use of change sets and direct updates as a part of the CloudFormation update.\n\nOceanofPDF.com\n\nUsing change sets\n\nThe steps to create change sets are as follows:\n\n1. In the CloudFormation console, select your stack.\n\nCloudFormation Stack\n\n2. Select Actions | Create Change Set For Current Stack.\n\nModify Stack\n\n3. Select Upload a template to Amazon S3, upload the updated template from https://github.com/PacktPublishing/AWS-Networking-Cookbook and click Next.",
      "page_number": 311
    },
    {
      "number": 36,
      "title": "Segment 36 (pages 319-326)",
      "start_page": 319,
      "end_page": 326,
      "detection_method": "topic_boundary",
      "content": "Upload the modified template\n\n4. On the Specify Details page, current stack values will be available, as shown in the following screenshot:\n\nCurrent VPC details\n\n5. Provide Change Set name, brief Description, and PublicSubnetCIDR2. Then choose Next.\n\nProvide modified VPC details\n\n6. On the Options page, we can go for additional changes (such as stack's service role, stack tags, or Amazon SNS notification topic), and then click Next.\n\nProvide Additional tags\n\n7. Review the changes to the Change Set and click Create Change Sets.\n\nReview and Create Change Set\n\n8. Once the change set review has been completed, the Status will be CREATE_COMPLETE.\n\nChange Set Status\n\n9. The change set will be available at the CloudFormation console, select stack and Change Sets.\n\nChange Sets Details\n\n10. Let's check each section of the change set.\n\nChanges:\n\nChange Set: Changes\n\nChange Set input:\n\nChange Set: Change Set Input\n\nDetails:\n\nChange Set: Changes Details\n\nTemplate: Will show the entire updated template\n\n11. Once all looks good, you can make the changes by executing the change set. (Change set | Execute).\n\nUpdate Stack\n\n12. All the change sets have been deleted and the stack Status is UPDATE_IN_PROGRESS.\n\nCloudFormation Stack Status\n\n13. Now the Stack status is UPDATE_COMPLETE and the new subnet can be seen in the output section.\n\nCloudFormation Updated Output\n\nOceanofPDF.com\n\nUsing direct update\n\nIn this example, we will be adding a private subnet in the VPC.\n\n1. Log in to the CloudFormation console and select the stack that you want to update.\n\n2. Choose Action | Update stack.\n\nCloudFormation Stack Direct Update\n\n3. Provide the updated file and click Next. The file is available at https://githu b.com/PacktPublishing/AWS-Networking-Cookbook.\n\nUpload template to update Stack\n\n4. Provide the Private SubnetCIDR : 10.0.4.0/24.",
      "page_number": 319
    },
    {
      "number": 37,
      "title": "Segment 37 (pages 327-335)",
      "start_page": 327,
      "end_page": 335,
      "detection_method": "topic_boundary",
      "content": "Provide Updated Subnet Details\n\n5. In the Options tab, add or update tags if required, otherwise click Next. 6. Review the changes.\n\nReview Updation\n\nCloudFormation Update Stack\n\n7. The updated process can be seen in the Events section.\n\nCloudFormation Stack updation in process\n\n8. The Outputs section will give the details of created resources. For example, Subnet ID.\n\nCloudFormation Updated Output\n\nOceanofPDF.com\n\nDeleting the stack-- CloudFormation\n\nThink twice before performing this step, as deleting the stack will delete all the resources associated with it. You can delete a stack by using the AWS console or CLI.\n\nOceanofPDF.com\n\nGetting ready\n\nFollow the steps to delete the stack. The following are a few points to remember:\n\n1. After stack deletion has begun, you cannot stop it. The stack proceeds to the DELETE_IN_PROGRESS state.\n\n2. Stack deletion will delete all the resources associated with it. 3. By default, deleted stacks will not be visible in CloudFormation. To view the deleted stacks, change the filter to Deleted.\n\n4. Templates of deleted stacks will be available in S3 as well.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe steps to delete a CloudFormation stack:\n\n1. Log in to the CloudFormation console and select the stack.\n\nCloudFormation Stack\n\n2. Click Actions | Delete stack. 3. Click Yes, Delete when prompted.\n\nDelete CloudFormation Stack\n\n4. Stack status will change to DELETE_IN_PROGRESS.\n\nCloudFormation Stack Delete Status\n\n5. Stacks can be viewed by changing the filter to Deleted.\n\nGet Deleted CloudFormation Stack\n\nOceanofPDF.com\n\nThere's more...\n\nUse the following command to delete the stack using CLI:\n\n# aws cloudformation delete-stack --stack-name VPC-Dev\n\nOceanofPDF.com\n\nSetting up Ansible\n\nAnsible is an automation tool for the configuration, provisioning, and management of cloud and on-prem resources. It makes a difference in the way of deployment as it is an SSH-based tool and comes with a very easy and secure connection. It is very easy to get started with Ansible for people coming from a Linux background.\n\nAnsible is an agentless tool, you need to install it in on one controller machine and whenever you want to make a deployment, run it from your controller machine, provide the host list, and deploy it in all the nodes. All commands are run through Ansible via SSH, and if Ansible needs updating, you only need to update your single control machine.\n\nYou can also check the version and software status, for example, if you want to check whether Apache is installed on all the machines or not, Ansible will give you a machine list where Apache is not installed and will allow you to install it on those machines keeping the other machines untouched.\n\nOceanofPDF.com",
      "page_number": 327
    },
    {
      "number": 38,
      "title": "Segment 38 (pages 336-346)",
      "start_page": 336,
      "end_page": 346,
      "detection_method": "topic_boundary",
      "content": "Getting ready\n\nPlaybooks are written in .yaml and tend to follow a process with minimum syntax. Each playbook can have one or more plays on the list. An Ansible playbook is the simplest way to achieve configuration management, orchestration, and multimachine deployment.\n\nOceanofPDF.com\n\nHow to do it...\n\nLet's look at VPC and other resource creation snippets:\n\n1. VPC creation example:\n\nec2_vpc: state: present cidr_block: 10.0.0.0/16 resource_tags: { \"Environment\":\"Development\" } region: us-west-2\n\n2. Subnet creation example:\n\nsubnets: - cidr: 172.22.1.0/24 az: us-west-2c resource_tags: { \"Environment\":\"Dev\", \"Tier\" : \"Web\" }\n\n3. Internet Gateway:\n\ninternet_gateway: True route_tables: - subnets: - 172.22.2.0/24 - 172.22.3.0/24 routes: - dest: 0.0.0.0/0 gw: igw\n\n4. Creating a NAT Gateway:\n\nname: Create new nat gateway and allocate new EIP. ec2_vpc_nat_gateway: state: present subnet_id: subnet-12345678 wait: yes region: ap-southeast-2 register: new_nat_gateway\n\n5. Deleting a VPC:\n\nec2_vpc: state: absent vpc_id: vpc-aaaaaaa region: us-west-2\n\nOceanofPDF.com\n\nInstalling Ansible\n\nThere are several ways to install Ansible. We will be cloning the full repository from Git and then installing it. The following are the steps:\n\n1. Log in to the EC2 console (the steps have already been provided in Cha pter 2, Building Your Own Custom VPC, in recipe, Managing EC2 instances).\n\n2. Launch an EC2 server (the steps have already been provided in Chapter 2, Building Your Own Custom VPC, in recipe, Managing EC2 instances).\n\nEC2 Server\n\n3. Log in to the server.\n\nEC2 Linux Server Login\n\n4. Install Ansible (RHEL/Ubuntu). 5. Change the hostname.\n\n[root@ip-172-31-18-87 ~] # hostname ansible\n\n6. Check whether Python is installed with 2.x version (because a version below 2.x is not compatible with Ansible).\n\n[root@ansible ~]# python -V Python 2.7.12\n\n7. Enable the EPEL repository on Amazon Linux. Go to your yum.repos.d folder and enable epel.repo (modify enabled=0 to enabled=1).\n\n[root@ansible ansible]# vim /etc/yum.repos.d/epel.repo\n\nEnable EPEL Repo\n\n8. Type – esc :wq. 9. Follow the following steps to install Ansible:\n\n[root@ansible ~ ]# yum install ansible Loaded plugins: priorities, update-motd, upgrade-helper ... Installed: ansible.noarch 0:2.3.1.0-1.el6 Dependency Installed: python-crypto2.6.x86_64 0:2.6.1-2.el6 python-jinja2- 26.noarch 0:2.6-3.el6 python-keyczar.noarch 0:0.71c-1.el6 python26.x86_64 0:2.6.9-2.88.amzn1 python26-PyYAML.x86_64 0:3.10-3.10.amzn1 python26-babel.noarch 0:0.9.4-5.1.8.amzn1 python26-backports.x86_64 0:1.0-3.14.amzn1 python26-backports- ssl_match_hostname.noarch 0:3.4.0.2-1.12.amzn1 python26-crypto.x86_64 0:2.6.1-1.14.amzn1 python26-ecdsa.noarch 0:0.11-3.3.amzn1 python26-httplib2.noarch 0:0.7.7-1.5.amzn1 python26-libs.x86_64 0:2.6.9-2.88.amzn1 python26-markupsafe.x86_64 0:0.11-4.6.amzn1 python26- paramiko.noarch 0:1.15.1-1.5.amzn1 python26-pyasn1.noarch 0:0.1.7-2.9.amzn1 python26- setuptools.noarch 0:12.2-1.32.amzn1 python26-simplejson.x86_64 0:3.6.5-1.12.amzn1 python26-six.noarch 0:1.8.0-1.23.amzn1 sshpass.x86_64 0:1.06-1.el6 Complete!\n\n10. Follow these steps if you want to install the latest version of Ansible (Ansible 2.4.1.0):\n\n[root@ansible ~ ]# yum install git -y [root@ansible ~ ]# mkdir ansibletmp [root@ansible ~ ]# cd ./ansibletmp [root@ansible ansibletmp ]# git clone git://github.com/ansible/ansible.git –recursive Cloning into '–recursive'... remote: Counting objects: 267737, done. remote: Compressing objects: 100% (28/28), done. remote: Total 267737 (delta 11), reused 1 (delta 0), pack-reused 267709 Receiving objects: 100% (267737/267737), 76.53 MiB | 13.51 MiB/s, done. Resolving deltas: 100% (170624/170624), done. Checking connectivity... done. [root@ansible ansibletmp ]# cd ./ansible [root@ansible ansible]# source ./hacking/env-setup [root@ansible ansible]# ansible --version ansible 2.4.0 config file = None configured module search path = [u'/root/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules'] ansible python module location = /usr/local/lib/python2.7/site- packages/ansible-2.4.0-py2.7.egg/ansible executable location = /root/ansible/bin/ansible python version = 2.7.12 (default, Sep 1 2016, 22:14:00) [GCC 4.8.3 20140911 (Red Hat 4.8.3-9)]\n\n11. You can set up the host file for adding different hosts, but here we will be creating a VPC so we can skip the host entry.\n\n12. As we are using Amazon AMI, AWS CLI is already installed, otherwise it can be installed using the following commands:\n\n[root@ansible ansible]# yum install python-pipOr [root@ansible ansible]# curl -O https://bootstrap.pypa.io/get-pip.py [root@ansible ansible]# python get-pip.py [root@ansible ansible]# pip install awscli [root@ansible ansible]# aws --version [root@ansible ansible]# aws configure\n\n13. Ansible has been installed successfully.\n\nOceanofPDF.com\n\nCreating Ansible playbooks for creating VPC\n\nWe will be creating Ansible playbooks for managing VPC.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe following are the steps for creating Ansible playbooks:\n\n1. Create a new playbook. The folder structure will be as follows:\n\n[root@ansible ~ ]# cd /etc/ansible/ [root@ansible ansible]# mkdir playbook [root@ansible ansible]# mkdir playbook/roles [root@ansible ansible]# mkdir playbook/roles/vpc [root@ansible ansible]# mkdir playbook/roles/vpc/{defaults,tasks} [root@ansible ansible]# cd playbook\n\n2. Create the configuration file in the playbook folder awsvpc.yml.\n\n[root@ansible playbook]# vim awsvpc.yml --- - name: Create VPC hosts: localhost gather_facts: no roles: - vpc\n\n1. Create a file inventory in playbook folder and can be found at https://gith ub.com/PacktPublishing/AWS-Networking-Cookbook.\n\n[root@ansible playbook]# vim inventory [local] localhost ansible_connection=local\n\n2. Create a file main.yml in playbook/roles/vpc/tasks/ folder. This file will contain the configurations required for your VPC and can be found at https://github.com/PacktPublishing/AWS-Networking-Cookbook.\n\n[root@ansible playbook]# vim roles/vpc/tasks/main.yml --- - name: Create VPC inside mention region ec2_vpc: state: present cidr_block: \"{{ vpc_cidr_block }}\" region: \"{{ vpc_region }}\" resource_tags: { \"Name\":\"{{ vpc_name }}-vpc\" } subnets: - cidr: \"{{ public_cidr_1 }}\" # Private Subnet 1 az: \"{{ vpc_region }}a\" resource_tags: { \"Name\":\"{{ vpc_name }}-private-subnet\" } - cidr: \"{{ public_cidr_2 }}\" # Public Subnet 2\n\naz: \"{{ public_az_2 }}\" resource_tags: { \"Name\":\"{{ vpc_name }}-{{ public_az_2 }}-public- subnet\" } internet_gateway: yes route_tables: - subnets: - \"{{ public_cidr_2 }}\" routes: - dest: 0.0.0.0/0 gw: igw register: vpc\n\n3. Create a file main.yml in playbook/roles/vpc/defaults/ folder and can be found at https://github.com/PacktPublishing/AWS-Networking-Cookbook. This file will contain the VPC details required for your VPC. For example: VPC name, region, and so on. [root@ansible playbook]# vim roles/vpc/defaults/main.yml --- vpc_name: dev-vpc vpc_region: us-west-2 # Oregon vpc_cidr_block: 10.0.0.0/16 public_cidr_1: 10.0.10.0/24 public_az_1: \"{{ vpc_region }}a\" public_cidr_2: 10.0.20.0/24 public_az_2: \"{{ vpc_region }}b\"\n\n4. Run the playbook by providing following commands:\n\n[root@ansible playbook]# ansible-playbook -i inventory awsvpc.yml PLAY [Create VPC] ****************************************************************** ****************************************************************** ****************** TASK [vpc : Create VPC inside mention region] ****************************************************************** ******************************************************** changed: [localhost] PLAY RECAP ****************************************************************** ****************************************************************** ************************* localhost : ok=1 changed=1 unreachable=0 failed=0 # If you get any error try checking in verbose by adding -vvv in the end [root@ip-172-31-12-123 playbook]# ansible-playbook -i inventory awsvpc.yml -vvv Using /etc/ansible/ansible.cfg as config file PLAYBOOK: awsvpc.yml ****************************************************************** ****************************************************************** *************** 1 plays in awsvpc.yml PLAY [Create VPC] ******************************************************************\n\n****************************************************************** ****************** META: ran handlers TASK [vpc : Create VPC inside mention region] ****************************************************************** ******************************************************** task path: /etc/ansible/playbook/roles/vpc/tasks/main.yml:3 Using module file /usr/lib/python2.6/site- packages/ansible/modules/cloud/amazon/_ec2_vpc.py <localhost> ESTABLISH LOCAL CONNECTION FOR USER: root <localhost> EXEC /bin/sh -c 'echo ~ && sleep 0' <localhost> EXEC /bin/sh -c '( umask 77 && mkdir -p \"` echo /root/.ansible/tmp/ansible-tmp-1498048548.85-61490596099452 `\" && echo ansible-tmp-1498048548.85-61490596099452=\"` echo /root/.ansible/tmp/ansible-tmp-1498048548.85-61490596099452 `\" ) && sleep 0' <localhost> PUT /tmp/tmpeDeueO TO /root/.ansible/tmp/ansible-tmp- 1498048548.85-61490596099452/_ec2_vpc.py <localhost> EXEC /bin/sh -c 'chmod u+x /root/.ansible/tmp/ansible-tmp-1498048548.85-61490596099452/ /root/.ansible/tmp/ansible-tmp-1498048548.85- 61490596099452/_ec2_vpc.py && sleep 0' <localhost> EXEC /bin/sh -c '/usr/bin/python /root/.ansible/tmp/ansible-tmp-1498048548.85- 61490596099452/_ec2_vpc.py; rm -rf \"/root/.ansible/tmp/ansible- tmp-1498048548.85-61490596099452/\" > /dev/null 2>&1 && sleep 0' ok: [localhost] => { \"changed\": false, \"igw_id\": \"igw-993d9ffe\", \"invocation\": { \"module_args\": { \"aws_access_key\": null, \"aws_secret_key\": null, \"cidr_block\": \"10.0.0.0/16\", \"dns_hostnames\": true, \"dns_support\": true, \"ec2_url\": null, \"instance_tenancy\": \"default\", \"internet_gateway\": true, \"profile\": null, \"region\": \"us-west-2\", \"resource_tags\": { \"Name\": \"dev-vpc-vpc\" }, \"route_tables\": [ { \"routes\": [ { \"dest\": \"0.0.0.0/0\", \"gw\": \"igw\" } ], \"subnets\": [ \"10.0.20.0/24\" ] } ], \"security_token\": null, \"state\": \"present\", \"subnets\": [",
      "page_number": 336
    },
    {
      "number": 39,
      "title": "Segment 39 (pages 347-354)",
      "start_page": 347,
      "end_page": 354,
      "detection_method": "topic_boundary",
      "content": "{ \"az\": \"us-west-2a\", \"cidr\": \"10.0.10.0/24\", \"resource_tags\": { \"Name\": \"dev-vpc-private-subnet\" } }, { \"az\": \"us-west-2b\", \"cidr\": \"10.0.20.0/24\", \"resource_tags\": { \"Name\": \"dev-vpc-us-west-2b-public-subnet\" } } ], \"validate_certs\": true, \"vpc_id\": null, \"wait\": false, \"wait_timeout\": \"300\" } }, \"subnets\": [ { \"az\": \"us-west-2a\", \"cidr\": \"10.0.10.0/24\", \"id\": \"subnet-11edb558\", \"resource_tags\": { \"Name\": \"dev-vpc-private-subnet\" } }, { \"az\": \"us-west-2b\", \"cidr\": \"10.0.20.0/24\", \"id\": \"subnet-efb2b388\", \"resource_tags\": { \"Name\": \"dev-vpc-us-west-2b-public-subnet\" } } ], \"vpc\": { \"cidr_block\": \"10.0.0.0/16\", \"dhcp_options_id\": \"dopt-0d8ab268\", \"id\": \"vpc-b647b3d0\", \"region\": \"us-west-2\", \"state\": \"available\" }, \"vpc_id\": \"vpc-b647b3d0\" } META: ran handlers META: ran handlers PLAY RECAP ****************************************************************** ****************************************************************** ************************* localhost : ok=1 changed=0 unreachable=0 failed=0 [root@ip-172-31-12-123 playbook]#\n\n3. VPC and subnets are now available in the AWS console:\n\n4. Private subnet without IGW.\n\n5. Public subnet with IGW.\n\nAnsible: VPC\n\nAnsible: VPC Subnet\n\nAnsible: Public Subnet Route Table\n\nOceanofPDF.com\n\nThere's more...\n\nThe following are a few sample playbooks for various VPC configurations. You can use the following playbooks by replacing main.yml in (/etc/ansible/playbook/roles/tasks/main.yml).\n\nUse the following code to create a VPC with a single public subnet (https://git hub.com/PacktPublishing/AWS-Networking-Cookbook):\n\n--- - name: Create VPC inside mention region ec2_vpc: state: present cidr_block: \"{{ vpc_cidr_block }}\" region: \"{{ vpc_region }}\" resource_tags: { \"Name\":\"{{ vpc_name }}-vpc\" } subnets: - cidr: \"{{ public_cidr_1 }}\" # Public Subnet-1 az: \"{{ public_az_1 }}\" resource_tags: { \"Name\":\"{{ vpc_name }}-{{ public_az_1 }}-public-subnet\" } internet_gateway: yes route_tables: \"{{ public_subnet_rt }}\" - subnets: - \"{{ public_cidr_1 }}\" routes: - dest: 0.0.0.0/0 gw: igw register: vpc\n\nUse following code to create VPC with private subnet and NAT Gateway (ht tps://github.com/PacktPublishing/AWS-Networking-Cookbook):\n\n--- - name: Create VPC inside mention region ec2_vpc: state: present cidr_block: \"{{ vpc_cidr_block }}\" region: \"{{ vpc_region }}\" resource_tags: { \"Name\":\"{{ vpc_name }}-vpc\" } internet_gateway: yes register: new_vpc - name: Create private subnet ec2_vpc_subnet: state: present vpc_id: \"{{ new_vpc.vpc_id }}\" az: \"{{ public_az_1 }}\" cidr: \"{{ public_cidr_1 }}\" # Private Subnet-1 region: \"{{ vpc_region }}\" resource_tags: { \"Name\":\"{{ vpc_name }}-{{ public_az_1 }}-private-subnet\" }\n\nvpc_id: \"{{ new_vpc.vpc_id }}\" register: private_subnet - name: Create new nat gateway using an EIP address ec2_vpc_nat_gateway: state: present subnet_id: \"{{ private_subnet.subnet.id }}\" wait: yes region: \"{{ vpc_region }}\" if_exist_do_not_create: true register: vpc_nat_gateway - name: Modify private subnet ec2_vpc_route_table: vpc_id: '{{ new_vpc.vpc_id }}' region: '{{ vpc_region }}' subnets: \"{{ private_subnet.subnet.id }}\" routes: - dest: 0.0.0.0/0 gateway_id: \"{{ vpc_nat_gateway.nat_gateway_id }}\"\n\nOceanofPDF.com\n\nWorking with Route 53\n\nIn this chapter, we will cover the following recipes:\n\nRegistering a new domain Transferring a domain into Amazon Route 53 Creating hosted zones and record sets Deleting a public hosted zone Creating an Alias record set Creating a private hosted zone Working with the weighted routing policy Working with the failover routing policy and health checks\n\nOceanofPDF.com\n\nIntroduction\n\nRoute 53 is a highly available and scalable domain name service and primarily provides the following four functionalities:\n\nDomain management: Allows you to register a new domain and transfers the existing domain DNS management:\n\nRoute 53 translates friendly domain names such as abc.com into IP addresses such as 1.2.3.4. Route 53 uses its authoritative DNS server across a global network to respond to DNS queries, which helps in reducing latency. Route 53 can route internet traffic to CloudFront distribution, Elastic Beanstalk endpoint, ELB record, or S3 bucket. Also, there's no extra charge for DNS queries to these resources.\n\nTraffic management Health check of the domain:\n\nRoute 53 monitors the health of your resources, such as web and email servers Route 53 health checkers are placed globally Route 53 automatically sends a request over the internet to the application to verify that it's reachable, available, and functional You can also configure CloudWatch alarms to send a notification when a resource becomes unavailable Route 53's failover policy helps in reconfiguring internet traffic away from resources that are unavailable or have failed health checks\n\nOceanofPDF.com\n\nHow does Route 53 DNS works?\n\nThe domain name system provides a mapping between human-readable names such as www.abc.com and the IP of their associated servers.\n\nWhen you type an address in your browser www.abc.com:\n\nThe operating system will first check the DNS in its local cache. Then it will look for the DNS in your LAN. Then the query will be forwarded to your DNS cache server (generally your ISP).\n\nThese DNS cache servers are called not authoritative DNS servers.\n\nThe request is then forwarded to the authoritative root name server responsible for maintaining a list of name servers for each of the top- level domains (.com, .org, and so on). Based on TLD, the request goes to the authoritative top-level domain name server responsible for maintaining a list of name servers for all domains (www.gmail.com, www.wikipedia.org, and so on). Its job is to query name servers to find and return the authoritative name server for the requested domain.\n\nOceanofPDF.com",
      "page_number": 347
    },
    {
      "number": 40,
      "title": "Segment 40 (pages 355-369)",
      "start_page": 355,
      "end_page": 369,
      "detection_method": "topic_boundary",
      "content": "Supported DNS resource record types\n\nAddress (A) record IPv4 address <Value>192.0.2.1</Value>\n\nAAAA record\n\nIPv6 address <Value>2001:0db8:85a3:0:0:8a2e:0370:7334</Value>\n\nCNAME record\n\nCanonical/Alternative Domain Name <Value>hostname.example.com</Value>\n\nMail Xchange (MX) record\n\nDomain name of a mail host <Value>10 mail.example.com</Value>\n\nName Server (NS) record Name Servers Record <Value>ns-1.example.com</Value>\n\nPTR record\n\n<Value>hostname.example.com</Value>\n\nStart of Authority (SOA) record:\n\nInformation stored in the DNS zone about that zone and about other DNS records 7 fields: Primary authority, Contact detail, zone serial number, refresh time, retry time, expire time, and minimum time to live (TTL) <Value>ns-2048.awsdns-64.net hostmaster.awsdns.com 1 1 1 1 60</Value>\n\nSender Policy Framework (SPF) record\n\nUsed for verifying the identity of sender email messages We recommend creating a TXT record instead of SPF <Value>\"v=spf1 ip4:192.168.0.1/16 -all\"</Value>\n\nSRV record\n\nService record 4 values: priority, weight, port, and domain name <Value>10 5 80 hostname.example.com</Value>\n\nTXT record\n\nIt contains a space-separated list of double-quoted strings\n\nOceanofPDF.com\n\nAlias resource record\n\nRoute 53 supports alias records that give the flexibility to point our custom endpoints to the resource record set and TLD (abc.com) You can create alias record for CloudFront distribution, Elastic Beanstalk endpoint, ELB Endpoint, S3 bucket, or any other Route 53 resource record set You can use Alias record to point an apex zone (root domain without www, for example: google.com) to any custom DNS name As ELB and other resources change their IP frequently, Route 53 Alias makes this task easier by reflecting those changes automatically without making any changes to the hosted zone If an Alias resource record set points to a CloudFront distribution, a load balancer, or an S3 bucket, the time to live (TTL) can't be set; Route 53 uses the CloudFront, load balancer, or Amazon S3 TTLs\n\nOceanofPDF.com\n\nRouting policies\n\nRoute 53 supports the below routing policies:\n\nSimple routing policy:\n\nWhen you have a single resource for your domain to route your traffic Example: IP address in an A record\n\nWeighted routing policy:\n\nWhen you have multiple resources to perform the same role For example: Route traffic to different resources in specified balances (weights) for example, 30% to one server and the remaining 40% to the other resource These resources can be a part of the same hosting group and can be on-premise as well You can also set up an active-active routing policy by setting up 50% weight to both the resources\n\nLatency-based Routing (LBR) policy:\n\nRoute 53 routes traffic, based on which the data center gives the user the lowest network latency\n\nFailover routing policy:\n\nRoute 53 allows an active-passive failover setup, where the primary resource responds to all traffic while keeping the secondary resource idle If the primary resource becomes unavailable, the other resource takes all the traffic Geolocation routing policy:\n\nRoute 53 uses a geo-IP database and responds to DNS queries based on the user's geographic location\n\nOceanofPDF.com\n\nRegistering a new domain\n\nYou can find the available domains and registers using Route 53. It also supports registering an existing domain that you registered with other registrars. This recipe will explain how to register a new domain.\n\nOceanofPDF.com\n\nGetting ready\n\nYou will need access to the Route 53 service and will need the below details as a part of the domain registration:\n\nAccess to the email ID for domain confirmation Keep your domain name ready\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to the AWS console and select Route 53. 2. Navigate to domain registration and click on Get started now.\n\nDomain Registration: Get Started\n\n3. Click on Register Domain.\n\nRegister domain\n\n4. Type the domain name that you want to register and click Check to find out whether the domain name is available. This will give you multiple similar options in Related Domain Suggestions.\n\nChoose domain name\n\n5. Select the desired domain, click Add to Cart, and click Continue at the bottom of the page.\n\n6. Provide your contact details, as asked, and click Continue.\n\nProvide contact details\n\n7. Review the information you entered and read the terms of service. Select I have read and agree to the AWS Domain Name Registration Agreement, then click Complete Purchase.\n\nReview and complete domain registration\n\nOceanofPDF.com\n\nThere's more...\n\nOnce the domain registration is complete, the next step is to create a DNS, but when you register a domain from AWS Route 53, it registers a hosted zone automatically. A DNS can be created in Route 53 or you can use other providers. The usual renewal period of a domain is 1 year, some TLD (Top Level Domains) provide longer subscriptions as well. Wisely select the domain expiry. The period during which you can renew a domain varies from different TLDs.\n\nThe values that Route 53 returns after registration are as follows:\n\nRegistered on: The date on which the domain is registered Expires on: The date and time (in GMT) when the domain is going to expire Domain name status code: Current status of the domain (Example: Registering, transferring, or renewing a domain) Transfer Lock: Enabled or Disabled (Enable the lock to reduce the possibility of transferring your domain to other registrars) Auto renew: Route 53 to automatically renew your domain or not Authorization code: This code is required for transferring the domain to any other registrar Name servers: List of name servers that are going to respond to the DNS queries for the domain.\n\nOceanofPDF.com\n\nTransferring a domain into Amazon Route 53\n\nYou can transfer a domain from your current registrar to Amazon 53, or from one AWS account to another, or from Route 53 to another registrar. This recipe will explain how to transfer a domain and DNS to Route 53.\n\nOceanofPDF.com\n\nGetting ready\n\nThere are a few minimum requirements:\n\nThe domain registration or restoration with the previous registrar must be done at least 60 days before You cannot initiate a domain transfer if the current domain status is one of the following:\n\npendingDelete\n\npendingTransfer\n\nredemptionPeriod\n\nclientTransferProhibited\n\nCheck whether Route 53 supports the TLD\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Confirm that Route 53 supports the TLD; you can get a list of the supported TLD's here: http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/re gistrar-tld-list.html.\n\n2. Transfer the DNS:\n\n1. Create a Route 53 hosted zone to get the name server details. 2. Create all the resource record sets in a newly created hosted zone. 3. Change the settings with your current registrar (this process can differ with different registrars). 1. Unlock the domain. 2. Disable privacy protection from the domain. 3. Get an authorization code. 4. Disable DNSSEC for the domain. 5. Check your contact information with the current registrar.\n\n4. Request the transfer:\n\n1. Log in to the AWS console and select Route 53. 2. Navigate to domain registration and click on Get started now. 3. Choose Transfer Domain. 4. Enter the name of the domain for which you want to transfer the registration to Amazon Route 53 and choose Check.\n\n5. If the domain registration is available for transfer, click Add to Cart. If the domain is not available, you will get a list of possible reasons.\n\n6. When you've added all the domain registrations that you want to transfer, choose Continue. 7. Provide the following details: 1. Authorization code. 2. Name server options:\n\n1. Continue to use the name servers provided by the current registrar or DNS service.\n\n2. Import name servers from a Route 53 hosted zone that has the same name as the domain.\n\n3. Specify the new name servers to replace the current registrar's name servers (not recommended).\n\n3. Nameservers. 4. Glue records.\n\n8. Provide your contact details as asked and click Continue. 9. Review the information you entered, read the terms of service, and select the checkbox to confirm that you've read the terms of service.\n\n10. Choose Complete Purchase.\n\n5. You will get a confirmation email on your registered email ID to continue the transfer (if the registrant contact authorizes the transfer, AWS starts to work with your current registrar to transfer your domain).\n\n6. Update your domain configuration by changing the following details: (optional)\n\nTransfer lock Automatic renewal Extended registration period Domain Name System Security Extensions (DNSSEC)\n\nOceanofPDF.com\n\nCreating hosted zones and record sets\n\nHosted zones store the information about how you want to route the traffic in the form of resource record sets. Records determine how DNS responds to your domain or subdomain. This recipe will explain how to create a hosted zone and resource record sets.\n\nOceanofPDF.com",
      "page_number": 355
    },
    {
      "number": 41,
      "title": "Segment 41 (pages 370-379)",
      "start_page": 370,
      "end_page": 379,
      "detection_method": "topic_boundary",
      "content": "Getting ready\n\nBefore creating hosted zones, make sure you have access to the domain name and the resources you are going to point to.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Sign in to AWS console and click on Route 53. 2. In the DNS management section, click Get started now.\n\nDNS: Get Started\n\n3. Click Create Hosted Zone.\n\nHosted Zones\n\n4. In the Create Hosted Zone pane, enter a Domain Name and optionally, a Comment.\n\n5. Select Type as Public Hosted Zone and click Create.\n\nHosted zone creation\n\n6. Once the hosted zones are created, it will by default create NS (Name Server) and SOA (Start of Authority) records.\n\nHosted zone details\n\n7. Click on Create Record Set to create a new record. 8. Provide the following values:\n\n1. Name: We will keep it blank, as we want to resolve packttest.com to an IP.\n\n2. Type: Select A - IPv4 address.\n\nDNS: Select record type\n\n3. Alias: Select No. 4. TTL (Seconds): Default value of 300 seconds (five minutes). 5. Value: Elastic IP address for your Amazon EC2 instance or provide the IP address of your web server.\n\n6. Routing Policy: Select Simple. Accept the default value of Simple.\n\nCreate Resource Record Set\n\n7. Click Create.\n\n9. You can follow the same process to create www.packttest.com.\n\n10. Test the URL by entering it in the browser.\n\nOceanofPDF.com\n\nDeleting a public hosted zone\n\nThe following procedure explains how to delete a hosted zone using the Amazon Route 53 console.\n\nOceanofPDF.com\n\nGetting ready\n\nDeleting a hosted zone will destroy the current routing, hence take a backup before making any changes. Also, you can delete the hosted zone if there are no resource record sets associated with it, that is, before deleting the hosted zone we need to delete the records.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Sign into the AWS console, click on Route 53, and then click on Hosted zones.\n\nRoute 53 console\n\n2. Select the hosted zone that you want to delete.\n\nHosted zone console\n\n3. Delete the additional resource record set.\n\nDelete records\n\n4. Confirm to delete the resource record sets.\n\nDelete records\n\n5. Then, click on Back to Hosted Zones. To delete the hosted zone, click Delete Hosted Zone.\n\nDelete hosted zones\n\n6. Confirm to delete the hosted zone.\n\nDelete hosted zones\n\nOceanofPDF.com\n\nCreating an Alias record set\n\nELB, CloudFront, and S3 respond to each request with one or more IP addresses for the environment and change their IP addresses frequently so you cannot directly add the IP address. The only option is to add them as a CNAME record, but CloudFront allows you to add ELB, CloudFront, or S3 as an endpoint while using an Alias record.\n\nOceanofPDF.com",
      "page_number": 370
    },
    {
      "number": 42,
      "title": "Segment 42 (pages 380-387)",
      "start_page": 380,
      "end_page": 387,
      "detection_method": "topic_boundary",
      "content": "How to do it...\n\nSteps to create an Alias record:\n\n1. Select your hosted zone. 2. Click on Create Record Set to create a new record. 3. Provide the following values:\n\n1. Name: We will keep it blank, as we want to resolve test.packttest.com.\n\n2. Type: Select A - IPv4 address.\n\nDNS: Resource Record Type\n\n3. Alias: select Yes. 4. Choose the Alias target from the following: S3 Endpoint ELB Application Load Balancer ELB Classic Load Balancer CloudFront Distributions Elastic Beanstalk Record Sets in the hosted zone\n\n5. Provide the Alias Hosted Zone ID (this is specific to selected Alias Target).\n\n6. Routing Policy: Select Simple. 7. Evaluate Target Health: Select Yes if you want Route 53 to determine whether to respond to the DNS queries using this\n\nresource record set by checking the health of the resource specified by Alias Target.\n\n8. Click Create.\n\nOceanofPDF.com\n\nThere's more...\n\nYou cannot set the TTL for the following resource set when using it with Alias; Amazon Route 53 uses the CloudFront, Elastic Beanstalk, Elastic Load Balancing, or Amazon S3 Bucket endpoint. If your resource record sets points to another resource record set in the same hosted zone using an alias, then Route 53 uses the TTL of the origin resource record set. Alias resource record sets can save time because Amazon Route 53 automatically recognizes changes in the resource record sets. If the IP address of the load balancer or CloudFront changes, Amazon Route 53 will automatically reflect those changes in DNS queries. An alias resource record set is only followed inside Amazon Route 53. This means that both the alias resource record set and its target must be a part of the Amazon resources. Amazon Route 53 doesn't charge for alias queries to CloudFront distributions, Elastic Beanstalk environments, ELB load balancers, or Amazon S3 buckets.\n\nOceanofPDF.com\n\nCreating a private hosted zone\n\nA private hosted zone holds information about how you want to route traffic for a domain and its subdomain within a VPC. While creating a private hosted zone, you can only specify a single VPC, however, you can add VPC's into your hosted zone later.\n\nOceanofPDF.com\n\nGetting ready\n\nYou need to have a VPC in any region before creating a private hosted zone. To enable private zone functionality, you must set the following values to True:\n\nenableDnsHostnames\n\nenableDnsSupport\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Sign in to the AWS console and click on Route 53. 2. Select Get started now under DNS Management. 3. Choose Create Hosted Zone. 4. Provide the Domain Name. 5. Give some informative Comment. 6. Select Type as Private Hosted zone for Amazon VPC.\n\nDNS: Private Hosted Zone creation\n\n7. In the VPC ID list, select the VPC ID that you want to associate with the hosted zone.\n\nProvide VPC Details\n\n8. Click on Create after completion.\n\nComplete Private Hosted Zone Creation\n\n9. To create an additional VPC within the new hosted zone, click on Back to Hosted Zones in the left-hand corner.\n\nHosted Zone console\n\n10. Click on the radio button to select the hosted zone.\n\nSelect Hosted Zone\n\n11. Enter another VPC ID that you want to associate and click on Associate New VPC.\n\nAdd another VPC\n\nOceanofPDF.com",
      "page_number": 380
    },
    {
      "number": 43,
      "title": "Segment 43 (pages 388-397)",
      "start_page": 388,
      "end_page": 397,
      "detection_method": "topic_boundary",
      "content": "There's more...\n\nYou can have more than one hosted zone pointing to the same VPC with a condition that the TLD name should be different. The VPC CIDR IP network should not conflict You can leverage a simple AD directory:\n\nIf you want to integrate your on-premise network with your VPC If you want your on-premises network to resolve the domain names and resources in your private hosted zone\n\nOceanofPDF.com\n\nWorking with the weighted routing policy\n\nThe weighted routing policy can be applied when there are multiple resources that perform the same function, for example, web servers serving the same site from different web servers. Weighted resource record sets let you associate multiple resources with a single DNS name.\n\nCommon use cases of the weighted routing policy are as follows:\n\nLoad Balancing A/B Testing\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to the AWS console, go to Route 53, then click on Hosted zones and select your hosted zone.\n\nHosted Zone console\n\n2. Click on Create Record Set. 3. Create the first record set, provide the record details, and Name as test.internaltest.com.\n\nProvide Primary Record Details\n\n4. Select Routing Policy as Weighted, enter Weight as 1, enter a short unique description, and Set ID as t2 instance.\n\nThis will be your unique identifier between the same record sets.\n\nPrimary Record Routing Policy\n\n5. Create a second record set, provide record details and Name as test.internaltest.com.\n\nProvide Secondary Record Details\n\n6. Select Routing Policy as Weighted, enter Weight as 4, enter a short unique description, and Set ID as large instance.\n\nSecondary Record Routing Policy\n\n7. This will create two resource record sets having a weighted routing policy.\n\nRecord details with their weight\n\nOceanofPDF.com\n\nHow it works...\n\nWeighted resource record sets contain a group of resources having the same combination of DNS name and type, and each resource record set is assigned a unique identifier and a relative weight. Route 53 selects one endpoint from the group. The probability of selecting a resource depends on the weight as a proportion of the total weight of all resources. For example: Suppose you have a small on-premises infrastructure and large instances in AWS, to balance your load, you can create two resource record sets with weight 1 (20%) pointing to the on-premises server and weight 4 (80%) pointing to the AWS instances.\n\nOceanofPDF.com\n\nWorking with the failover routing policy and health checks\n\nThe failover routing policy is a method for routing traffic away from unhealthy resources and to healthy resources. When you have more than one resource performing the same function, for example, more than one web server or application server, you can configure Amazon Route 53 health checks to check the health of your resources and configure the resource record sets in your hosted zone to route traffic only to healthy resources.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to the AWS console and go to Route 53. 2. Set up the health check as follows:\n\n1. Select Health checks from the navigation pane and click on Create health check.\n\nDNS: Health Check console\n\n2. Provide the details as mentioned in the following image and click on Next.\n\nHealth Check Configurations\n\n3. Provide Advanced configuration if required.\n\nHealth Check Advanced Configurations\n\n4. Click Yes to set up an alarm.\n\nHealth Check Alarm setup\n\n5. Make sure the resource is in a Healthy state; sometimes it can take a few minutes to come into a Healthy state.\n\nResource Health Status\n\n6. In the same way, set up a health check for the secondary host.\n\n3. Set up a hosted zone as follows:\n\n1. Click on Hosted zones, select your hosted zone, and click on Create Record Set.\n\n2. Provide the Name and Value of your resource record set.",
      "page_number": 388
    },
    {
      "number": 44,
      "title": "Segment 44 (pages 398-405)",
      "start_page": 398,
      "end_page": 405,
      "detection_method": "topic_boundary",
      "content": "Hosted Zone: Create Record\n\n3. Select Routing Policy as Failover, Failover Record Type as Primary, Set ID as test1-Primary, and Associate with Health Check as Yes.\n\n4. For Health Check to Associate, select the health check we just created.\n\nPrimary Record Routing Policy\n\n5. In the same way, create a resource record set for the secondary host.\n\nOceanofPDF.com\n\nHow it works...\n\nA failover policy will send all traffic to the server you set as primary for as long as that server is healthy. If the health checks determine that it's failing, traffic will be diverted to the secondary backup resource. We have kept the TTL as 60 seconds so that Route 53 responds to the changed health checks in a faster way.\n\nFailover mechanism\n\nOceanofPDF.com\n\nThere's more...\n\nYou cannot create health checks for resources in private hosted zone, as health checks are available outside your VPC. You can create health checks for public IP/DNS resources. If you don't have a public IP attached to your instance, you can create a CloudWatch alarm and set up the health check based on the state of the alarm. For example, CloudWatch sends an alert if the CPU goes above 90% and turns into an alarm state. The health check will react according to the change.\n\nHealth Check Setup with Cloudwatch Alarm\n\nWhile configuring a failover routing policy, setting up health checks for secondary failover resource record sets is optional.\n\nOceanofPDF.com\n\nCloud Security and Network Compliance\n\nIn this chapter, we will cover the following recipes:\n\nSetting up CloudFront--EC2 origin Setting up CloudFront--S3 origin Geographic restrictions with Amazon CloudFront Customizing error responses in CloudFront Setting up CloudWatch monitoring Setting up ELB and Auto Scaling Trusted Advisor Protecting log information--sending logs to CloudWatch Starting CloudTrail Submitting a penetration testing request\n\nOceanofPDF.com\n\nIntroduction\n\nNetwork security is evaluated by each organization making sure it assesses the effectiveness of your defenses. Internet-facing systems receive several hundreds or even millions of attack attempts every day. Many of these are simple scans that our security system can defend against, but others catch you by surprise, unexpectedly shifting into incident investigation and cleanup mode.\n\nThis chapter provides assistance in securing a network by explaining important concepts and inter-relationships of security controls.\n\nFirst of all, we need to understand the shared responsibility model, as infrastructure security is shared between AWS and customer and it varies from different service models of Infrastructure as a Service (IAAS), Platform as a Service (PAAS), and Software as a Service (SAAS).\n\nAWS provides a global infrastructure responsible for the following:\n\nUnderlying hardware Physical security Network security and compliance Virtualization and underlying infrastructure Facilities\n\nAs a customer, you need to take care of the following:\n\nOS Ingress and outgress traffic from your instance AMI hardening and security Data in transit and rest AWS credentials and single sign on (SSO) IAM user policies and roles\n\nHere is a simplified diagram to explain the shared responsibility model:\n\nCustomers are responsible for their security and compliance IN the Cloud AWS is responsible for the security OF the Cloud\n\nAWS Shared Responsibiliy Model\n\nAs AWS takes care of the underlying setup, it allows you to scale and innovate while maintaining a secure environment.\n\nOceanofPDF.com\n\nTypes of attack\n\nHere we will be looking at various types of attacks and how to mitigate them with the help of different AWS services:\n\nDistributed Denial of Service (DDoS): This is a malicious attempt based on bandwidth or resource consumption. DDOS attacks can cause harm without even modifying or touching the intended victim:\n\nNetwork consumption: Attackers flood your environment with a large volume of spoofed packets to consume all your network bandwidth. Resource consumption: These attempts can sometimes be so strong that they target the vital resources of your system such as CPU cycles, hard disk space, and so on.\n\nPeer identity compromise/identity spoofing/man-in-the- middle: Hackers try to listen to traffic between two network nodes, looking for passwords, password hashes, and program instructions. IP/DNS spoofing: Attackers try to impersonate a user, device, or client to directly attack the host. Port scanning: The attacker tries to connect to a selected port or sometimes all ports to exploit the environment. The attacker works in the series of your system to understand the weakness.\n\nHere are some best practices:\n\nAlways use a Security Group Set up a Network ACL Use IPSec or Direct Connect for trusted connections Protect data in transit and rest Turn on VPC flow logs Always transfer data via SSL/TLS endpoints Ensure regular reviews of security controls and policies.",
      "page_number": 398
    },
    {
      "number": 45,
      "title": "Segment 45 (pages 406-416)",
      "start_page": 406,
      "end_page": 416,
      "detection_method": "topic_boundary",
      "content": "OceanofPDF.com\n\nSetting up CloudFront--EC2 origin\n\nCloudFront is a Content Delivery Network (CDN) service provided by AWS. CloudFront offers a globally distributed network which serves cache content such as images, videos, and static files from distributed data centers called edge locations. The edge locations are points of presence (POP), which are owned and operated by CloudFront.\n\nWhile a number of techniques can be used to mitigate DoS/DDoS attacks in the cloud, CloudFront is one of the best services that can manage large user requests while delivering good services to good customers. CloudFront absorbs DoS/DDoS flooding attacks.\n\nThere are two types of distribution that CloudFront provides:\n\nWeb distributions: Static and dynamic download content; for example, .html, .css, .php, and image files, using HTTP or HTTPS. RTMP distributions: Stream media files using Adobe Media Server and the Adobe Real-Time Messaging Protocol (RTMP). An RTMP distribution must use an Amazon S3 bucket as the origin.\n\nOceanofPDF.com\n\nGetting ready\n\nBefore creating a CloudFront web distribution:\n\nMake sure your origin is available. Configure origin servers (S3/web server/load balancer) from which CloudFront gets your files for distribution. Upload files to the origin servers. Files, also known as objects, typically include web pages, images, and media files but can be anything that can be served over HTTP. Configure the S3 bucket for logging. Create a CNAME or alias record. Optionally, you can configure your CloudFront distribution to use a custom domain name. Upload your SSL certificate if you want to use a custom certificate. Optionally, you can configure your origin server to add headers to the files; the headers indicate how long you want the files to stay in the cache in the CloudFront edge locations. By default, each object stays in an edge location for 24 hours before it expires. You will need access to create the CloudFront distribution.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to the AWS Console, navigate to Network & Content Delivery, and then select CloudFront.\n\nSelect CloudFront\n\n2. Navigate to Distributions and click on Create Distribution.\n\nCreate CloudFront Distribution\n\n3. After that, click on Select delivery method | Web | Get Started.\n\nCloudFront Delivery Method\n\n4. Provide an Origin Domain Name (here you can provide the EC2 public name/ELB name/domain name as per your requirement).\n\nCloudFront: Origin\n\n5. Change as per your specific requirements. I'll be using the default values for this testing.\n\n1. You can consider changing the Alternate Domain Names (CNAMEs) if any are available.\n\nCloudFront: CNAME\n\n2. Change the Object Caching behavior to customize if you want to specify caching expiry in CloudFront. By default, it will take the caching expiry from the headers.\n\nCloudFront: Object Caching\n\n3. Add the SSL Certificate if available; otherwise, CloudFront will automatically use the default *.cloudfront.net certificate.\n\nCloudFront: SSL Certificate\n\n6. Set Logging as On, provide a bucket name in Bucket for Logs, and give your folder name in the Log Prefix.\n\nCloudFront: Logs\n\n7. The entire web page will look like the following. Click on Create Distribution.\n\nCloudFront: Web Distribution Details\n\n8. Creating the distribution generally takes 15-20 mins. 9. Once the distribution is available, State will change to Enabled. Click on the ID to get the CloudFront domain name.\n\nCloudFront Web Distribution\n\n10. You can use the Domain Name to visit your web page.\n\nCloudFront Domain Name Details\n\n11. To modify the details or add another behavior, go to Behaviors and click on Create Behavior.\n\n1. Note that the behavior decides which data will be served by CloudFront and which data will be served by the origin server.\n\nCloudFront Behavior\n\nOceanofPDF.com\n\nHow it works...\n\n1. A user accesses your website or application and requests for one or more objects, such as an image file and an HTML file.\n\n2. DNS routes the request to the CloudFront edge location that can best serve the user's request, typically the nearest CloudFront edge location in terms of latency, and routes the request to that edge location. 3. In the edge location, CloudFront checks its cache for the requested\n\nfiles:\n\n1. If the files are in the cache, CloudFront returns them to the user. 2. If the files are not available, CloudFront sends the request to the origin server based on the file type. For example, to your Amazon S3 bucket for image files and to your HTTP server, for the HTML files. Then it stores the files to the edge location for the specified duration.\n\n4. Attackers trying to access content from an edge location don't get the details of the end server (S3 or IP of your HTTP server) as the data will be delivered with one of the CloudFront's IP addresses.\n\n5. In the case of attack, CloudFront absorbs the requests, leaving minimal or no impact to your website.\n\nOceanofPDF.com\n\nThere's more...\n\nCloudFront sends your distribution's configuration (but not your content) to all of its edge locations. The number of files that you can serve per distribution is unlimited. As you develop your website or application, you use the domain name that CloudFront provides for your URLs. CloudFront creates reports based on the access log's data. It gives the following reports:\n\nCloudFront cache statistics reports:\n\nTotal requests Percentage of viewer requests by result type Bytes transferred to viewers HTTP status codes Shows viewer GET\n\nCloudFront popular objects report CloudFront top referrers report CloudFront usage reports:\n\nNumber of requests Data transferred by protocol Data transferred by destination\n\nCloudFront viewers reports:\n\nDevices Browsers Operating systems Locations\n\nOceanofPDF.com",
      "page_number": 406
    },
    {
      "number": 46,
      "title": "Segment 46 (pages 417-424)",
      "start_page": 417,
      "end_page": 424,
      "detection_method": "topic_boundary",
      "content": "Setting up CloudFront--S3 origin\n\nIt is one of the best practices to store your static files (such as text, images, and videos) into S3 and using CloudFront you can distribute the content from S3. In this recipe, we will focus on how to create a CloudFront web distribution for S3 origin.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Create an S3 bucket:\n\n1. Log in to the AWS Console, select Amazon S3, and choose Create bucket.\n\nS3: Create Bucket\n\n2. In the Create Bucket dialog, enter the name of the bucket, then in Region, select a Region for your bucket, and click on Create.\n\nS3 Bucket Details\n\n1. Note that for your bucket to work with CloudFront, the name must conform to the DNS naming requirements. For more information, go to Bucket Restrictions and Limitations in the\n\nAmazon S3 Developer Guide or visit: http://docs.aws.amazon.com/A mazonS3/latest/dev/BucketRestrictions.html\n\n2. By default, Amazon S3 creates buckets in the US-Standard region. We recommend that you choose a region close to you to optimize latency, minimize costs, and address regulatory requirements.\n\n3. Select your bucket in the Buckets pane and choose Upload.\n\nS3 Upload Object\n\n4. On the Upload tab, select the files page, choose Add more files, and choose the files that you want to upload. Click on Upload after completion.\n\nS3 Upload Image\n\n2. Create a CloudFront web distribution as follows:\n\n1. Open the CloudFront console at https://console.aws.amazon.com/cloudfron t/ and choose Create Distribution.\n\n2. On Select a delivery method for your content page in the Web section, click on Get Started.\n\n3. On the Create Distribution page under Origin Settings, choose the Amazon S3 bucket that you created earlier.\n\nCloudFront: Origin Details\n\n4. Keep all other configurations as default or use the settings provided in recipe 1 (Setting up CloudFront--EC2 origin).\n\n5. After all the setups, click Create Distribution. 6. After CloudFront has created your distribution, the value of the Status column for your distribution will change from InProgress to Deployed. If you chose to enable the distribution, it will then be ready to process requests.\n\nThis should take less than 15 minutes. The domain name that CloudFront assigns to your distribution appears in the list of distributions. (It also appears on the General tab for a selected distribution.)\n\n3. Test your links-- if your object location in S3 is https://s3-us-west-2.amazonaw s.com/bucket-name/file-name then your CloudFront path will be http://abc1234abcdef8.cloudfront.net/file-name.\n\nIf your domain name was abc1234abcdef8.cloudfront.net and your object was image.jpg, the URL for the link would be: http://d111111abcdef8.cloudfront.net/image.jpg. If your object is in a folder within your bucket, include the folder in the URL. For example, if image.jpg is located in an images folder, then the URL would be: d111111abcdef8.cloudfront.net/images/image.jpg\n\nOceanofPDF.com\n\nThere's more...\n\nRestrictions on using alternate domain names include:\n\nYou should have the permission to create a CNAME or alias record with your DNS provider. The alternative name should be unique with all the CloudFront distributions. As a DNS protocol limitation, you cannot create a CNAME record for the top node of a DNS namespace (for example: abc.com) known as the zone apex, but you can create CNAME records for www.abc.com, new.abc.com, and so on. If you're using Amazon Route 53 as your DNS service, you can create an alias resource record set instead of a CNAME. With an alias resource record set, you don't pay for Amazon Route 53 queries. In addition, you can create an alias resource record set for a domain name at the zone apex (abc.com).\n\nOceanofPDF.com\n\nGeographic restrictions with Amazon CloudFront\n\nCloudFront has added a geo-restriction feature to make it easier to restrict access to your content based on the geographic location of your viewers.\n\nOceanofPDF.com",
      "page_number": 417
    },
    {
      "number": 47,
      "title": "Segment 47 (pages 425-432)",
      "start_page": 425,
      "end_page": 432,
      "detection_method": "topic_boundary",
      "content": "How to do it...\n\n1. Log in to the AWS Console, select CloudFront Distributions, then select your distribution, and go to the Restrictions tab.\n\nCloudFront Console\n\n2. Click on Edit.\n\nCloudFront Restrictions Setup\n\nOnce you enable the feature, you can select whether you want to configure a whitelist or blacklist of countries for your distribution.\n\n3. Select one or more countries from the list in the left-side box, and move those countries to the right-side box and then click on Yes, Edit button.\n\nEnable CloudFront Restrictions\n\n4. That's it! Once this configuration gets deployed to our worldwide edge locations (which takes a few minutes), the CloudFront edge locations will begin blocking users from certain countries based on your configuration. For users that are blocked, CloudFront will serve an HTTP response of 403 (Forbidden). You also have the ability to configure a custom error page with CloudFront for the 403 response so that you can serve a friendlier message to your users if you want (this is explained in the next recipe-- Customizing error responses in CloudFront).\n\nOceanofPDF.com\n\nHow it works...\n\nImagine you own an online store and have rights to distribute your products to users in a single country. Therefore you need a way to prevent users from across the globe from accessing your product. You can achieve this by using the Amazon CloudFront geo-restriction feature and whitelist the country where you are allowed to sell your product. Then CloudFront edge locations will first check the location of the viewer (based on their IP address) and only serve the content if the viewer's IP address maps to the whitelisted country. CloudFront uses an out-of-sight geo-IP database to map IP addresses to countries.\n\nThere is another scenario where you're a software company and want to restrict the download of your encrypted software products by users in certain territories because of licensing terms. In this scenario, you can configure a blacklist of a single country or countries using the CloudFront Management Console (or CLI/API) so that CloudFront edge locations don't serve your content to any requests from one of your blacklisted countries.\n\nOceanofPDF.com\n\nCustomizing error responses in CloudFront\n\nThe objects that you're serving through CloudFront can be unavailable for a variety of reasons. These reasons fall into two broad categories:\n\nClient errors (status code range 4xx): These errors are the result of HTTP requests sent by the client. For example, the object name isn't available, or the user doesn't have the permissions required to read the object. Server errors (status code range 5xx): These errors indicate a problem with the origin server as is not able to process the request. For example, the HTTP server is busy or unavailable.\n\nOceanofPDF.com\n\nGetting ready\n\nThe HTTP status codes for which CloudFront can return a custom error page includes the following:\n\n400, 403, 404, 405, 414 500, 501, 502, 503, 504\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to the AWS Console, select CloudFront, select your distribution, and go to the Error Pages tab.\n\n2. Click on Create Custom Error Response.\n\nCloudFront: Create Custom Error\n\n3. Set up the error pages and click on Create.\n\nCloudFront: Create Custom Error\n\nOceanofPDF.com\n\nHow it works...\n\nWhen you request for an object or HTTP web page:\n\n1. CloudFront checks for the object in its local cache. 2. If not available, CloudFront checks for the object with the origin server.\n\n3. If the object is unavailable with the origin server as well, your web server will return an HTTP status code to CloudFront.\n\n4. For example, if a user asks for an invalid URL/object, your web server returns a 404 status code to CloudFront, and CloudFront returns the same to the user.\n\n5. You can display a brief and sparsely formatted default message or a web page stating: Not Found: \"The requested URL /myfilename.html was not found on this server\".\n\n6. You can also specify an image/HTML page having the same formatting as the rest of your website. CloudFront will return an object or HTML file to the viewer that contains your custom error message.\n\nOceanofPDF.com\n\nSetting up CloudWatch monitoring\n\nThink of a scenario where you typically expect 5,000 concurrent sessions to your website at a specific time in a day. Immediately you get to know that the website becomes unresponsive and you find that the traffic has already exceeded twice the amount (10,000). Here you need a solution which monitors your system (Amazon CloudWatch) and triggers an alarm (Amazon SNS) if the current number of concurrent sessions exceeds twice that amount. Immediately, your infrastructure should be in a state to handle the heavy traffic to support good customers.\n\nCloudWatch has the following features:\n\nIt is a monitoring service It watches the resources and application you run on AWS It collects, processes raw data, and shows real-time metrics It collects and monitors log files It sets alarms It reacts to changes in your environment\n\nEC2 by default sends metric data to CloudWatch every 5 minutes but we can enable detailed monitoring to send metrics every minute.\n\nOceanofPDF.com",
      "page_number": 425
    },
    {
      "number": 48,
      "title": "Segment 48 (pages 433-440)",
      "start_page": 433,
      "end_page": 440,
      "detection_method": "topic_boundary",
      "content": "Getting ready\n\nIn this recipe, we will create a monitoring alert for CPU utilization and send an email to the appropriate recipient. Similarly, you can create an alert for various other resources and can also create custom metrics to monitor.\n\nTo create metrics and send a notification, you will need access to CloudWatch and SNS (to send emails).\n\nOceanofPDF.com\n\nHow to do it...\n\nCreate an alarm and send the notification:\n\n1. Log in to the AWS Console, then navigate to Management Tools, and select CloudWatch.\n\nSelect CloudWatch\n\n2. Go to Alarms and click on Create Alarm.\n\nCreate Alarm\n\n3. Search for the metrics (here we are selecting CPUUtilization). Select the instance and click on Next.\n\nCloudWatch: Metric Details\n\n4. In the Alarm Threshold section, provide the unique Name, short Description, and minimum threshold (that is when you want to trigger an action).\n\nCloudWatch: Alarm Threshold\n\n5. Provide the Actions as given to send an email.\n\nCloudWatch: Alarm Actions\n\n6. Go through the preview of the Alarm in the right corner side and click on Create Alarm.\n\nCloudWatch: Alarm Details\n\n7. You will get an email to confirm the subscription. Click on I will do it later.\n\nCloudWatch: Email setup\n\n8. Your alarm is now available in the pending state.\n\nCloudWatch: Alarm Status\n\n9. To confirm the email you have received, click Confirm subscription. Check your spam box if you haven't received any email.\n\nYou will not receive any confirmation email if the SNS topic is already created and the alarm status will automatically change.\n\nCloudWatch: Email Confirmation\n\n10. Check the state of the alarm again.\n\nOceanofPDF.com\n\nThere's more...\n\nYou can use CloudWatch to recover or restart the instance automatically whenever you receive Instance/System Status Check Failed.\n\nTo recover the instance whenever you receive System Status Check Failed:\n\n1. Follow the same steps until step 2 provided in the last section. 2. Search for StatusCheckFailed_System and click on Next.\n\nCloudWatch: Status Check Failed Alarm\n\n3. In the Actions pane, click on +EC2 Action, then select the Recover this instance, and click on Create Alarm.\n\nCloudWatch: Status Check Failed Alarm Action\n\n4. To restart the instance whenever you receive Instance Status Check Failed:\n\nFollow the same steps until step 2 provided in the last section Search for StatusCheckFailed_Instance and click on Next In the Actions pane, click on +EC2 Action, then select Reboot this instance and click on Create Alarm\n\nOceanofPDF.com",
      "page_number": 433
    },
    {
      "number": 49,
      "title": "Segment 49 (pages 441-450)",
      "start_page": 441,
      "end_page": 450,
      "detection_method": "topic_boundary",
      "content": "Setting up ELB and Auto Scaling\n\nAlong with conventional approaches for DoS/DDoS attack mitigation and protection, the AWS cloud provides capabilities based on its elasticity. DoS/DDoS attacks are attempts to deplete limited compute, memory, disk, or network resources, which often work against on-premises infrastructure. However, the AWS cloud is elastic, in the sense that new resources can be employed on demand, if and when required.\n\nOceanofPDF.com\n\nHow to do it...\n\nSteps to create ELB and Auto Scaling have already been shared in Chapter 3, VPC Advanced Components.\n\nOceanofPDF.com\n\nHow it works...\n\nAs AWS services are highly durable in nature, you can have ELB and ASG in the case of an attack:\n\nAll the requests will come to your Elastic Load Balancing and beneath that, it will go to your EC2 servers. You can configure CloudWatch to react on the sudden spikes (For example, trigger an alarm and send SNS notification or trigger EC2 instances using Auto Scaling). Auto Scaling will scale out your web server based on the load or number of requests. This will give you some time to fight against the attack by serving data to good users. Even under heavy attack, the web servers could scale to perform and provide optimal user experience by leveraging cloud elasticity. Auto Scaling will shrink back when the attack stops.\n\nOceanofPDF.com\n\nTrusted Advisor\n\nAWS Trusted Advisor helps you to optimize your infrastructure by giving real-time guidance by comparing your current infrastructure with AWS best practices, reducing cost, increasing performance, improving security, and fault tolerance.\n\nAWS compares the best practices in the following four categories:\n\nCost optimization Performance Security Fault tolerance\n\nOceanofPDF.com\n\nGetting ready\n\nIn this recipe, we will go through the AWS Trusted Advisor console and use Amazon CloudWatch events to detect and react to changes in the status of Trusted Advisor checks.\n\nYou will need access to Trusted Advisor, CloudWatch, and SNS to perform this recipe.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to the AWS Console, navigate to Management Tools, and click on Trusted Advisor.\n\nTrusted Advisor\n\n2. It will take some time to perform the checks and it then gives the following screen:\n\nTrusted Advisor Console\n\n3. In the Recommended Actions section, select the warning and on the basis of Alert Criteria, you can take the required action.\n\nTrusted Advisor Alerts\n\n4. Now go to the CloudWatch console, select Events from the navigation pane, and click on Create rule.\n\nCloudWatch Events\n\n5. Under Event Source, select Service Name as Trusted Advisor.\n\n1. Select Event Type as All Events.\n\nBe wise while choosing this option, as this can flood emails into your mailbox.\n\nCloudWatch Event Rule\n\n2. For specific events:\n\n1. Status values: Select Check Item Refresh Status in Event Type and choose Specific Status(es) as ERROR and WARN. 2. Trusted Advisor checks: Choose Specific check(s) and then\n\nchoose one or more check names from the list.\n\n3. AWS resources: Choose Specific resource ID(s) by ARN, and then type the ARNs of the resources (or select Any resource ID to apply rules to all resources).\n\nCloudWatch Events Details\n\n6. In the Targets area, click Add Target. 7. Select the Target Type (which action you want to perform), select SNS topic, select the Topic that you have created, and in Configure input select Matched event.\n\nCloudWatch Events Targets\n\n8. Click on Configure details.\n\nCloudWatch Event Configure Details\n\n9. In the section Step 2: Configure rule details, under Rule\n\ndefinition provide the Name and Description and click on Create rule.\n\nCloudWatch Events Configure Rule\n\n10. Once created, it should give a green status.\n\nCloudWatch Events Rule Status\n\nOceanofPDF.com",
      "page_number": 441
    },
    {
      "number": 50,
      "title": "Segment 50 (pages 451-463)",
      "start_page": 451,
      "end_page": 463,
      "detection_method": "topic_boundary",
      "content": "How it works...\n\nTrusted Advisor scans your environment and compares it with the AWS best practices. Once the scan is done, it provides recommended actions. You can take actions by selecting the specified links.\n\nFurther, we have created AWS CloudWatch events to send alerts for any changes in Trusted Advisor.\n\nOceanofPDF.com\n\nProtecting log information--sending logs to CloudWatch\n\nFor critical applications, all add, change/modify, and delete activities or transactions must generate a log entry. Each log entry should contain the following information:\n\nUser identification information Type of event Date and time stamp Success or failure indication Origination of event Identity or name of the affected data, system component, or resource\n\nProtecting logs:\n\nVerify that audit trails are enabled and active for system components Ensure that only individuals who have a job-related need can view audit trail files Confirm that the current audit trail files are protected from unauthorized modifications via access control mechanisms, physical segregation, and/or network segregation Ensure that the current audit trail files are promptly backed up to a centralized log server or media that is difficult to alter Verify that regular log reviews are performed for all system components\n\nOceanofPDF.com\n\nGetting ready\n\nThink of a scenario where you want to give access of your logs to your security team without them logging into the server and creating a separate log server can be little expensive.\n\nCloudWatch logs give you the ability to monitor and troubleshoot your systems and applications, and custom log files. You can ship your logs to CloudWatch and monitor them in near real time, for specific phrases, values, or patterns.\n\nFor example, you can set up an alarm on specific errors based on your system logs (such as, user log in failed) or view graphs based on your application logs (such as, the latency of web requests). These alarms or graphs will not manipulate the original files, so you can check logs any time to get more insights. Logs files are stored securely and can be accessed for up to 10 years, so you don't have to worry about filling up hard drives.\n\nThe CloudWatch Logs Agent is supported on Amazon Linux, Ubuntu, and Windows. This agent will support the ability to monitor individual log files on the host.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Configure your IAM role or user for CloudWatch logs as follows: 1. Open the IAM console at https://console.aws.amazon.com/iam/. 2. In the navigation pane, click Roles, and then on the Role Name column, click on IAM role.\n\n3. Under Inline Policies, click Create Role Policy. 4. On the Set Permissions page, click Custom Policy, and then click Select.\n\n5. On the Review Policy page, in the Policy Name field, type a name for the policy.\n\nIAM Policy\n\n6. In the Policy Document field, paste the following policy:\n\n{ \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"logs:CreateLogGroup\", \"logs:CreateLogStream\",\n\n\"logs:PutLogEvents\", \"logs:DescribeLogStreams\" ], \"Resource\": [ \"arn:aws:logs:*:*:*\" ] } ] }\n\n7. Click on Apply Policy.\n\n2. Install and configure CloudWatch logs on an existing Amazon EC2 instance:\n\n1. Connect to your EC2 instance. 2. The CloudWatch Logs agent installer requires certain information during set up. Before you start, you will need to know what log file you want to monitor and its timestamp format. You should also have the following information ready:\n\n1. AWS access key ID: Press Enter if you are using an IAM role. Otherwise, enter your AWS access key ID.\n\n2. AWS secret access key: Press Enter if you are using an IAM role. Otherwise, enter your AWS secret access key.\n\n3. Default region name: Press Enter. The default is us-east-1. You can set this to us-east-1, us-west-1, us-west-2, eu-west-1, eu- central-1, ap-southeast-1, ap-southeast-2, or ap-northeast-1. 4. Default output format: Leave blank and press Enter. 5. Path of log file to upload: This is the location of the file that contains the log data you want to send. The installer will suggest a path for you.\n\n6. Destination log group name: This is the name for your log group. The installer will suggest a log group name for you. 7. Destination log stream name: By default, this is the name of the host. The installer will suggest a hostname for you. 8. Timestamp format: Specify the format of the timestamp\n\nwithin the specified log file. Choose custom to specify your own format.\n\n9. Initial position: This is how the data will be uploaded. Set this to start_of_file to upload everything in the data file. Set it to end_of_file to upload only newly appended data.\n\n3. Run the CloudWatch Logs agent installer. On the instance, open a command prompt, type the following commands, and then follow the prompts:\n\n[root@ip-172-31-45-203 ~]# cd /home/centos/ [root@ip-172-31-45-203 jhalak]# wget https://s3.amazonaws.com/aws-CloudWatch/downloads/latest/awslogs- agent-setup.py [root@ip-172-31-45-203 jhalak]# python ./awslogs-agent-setup.py - -region us-west-2 Launching interactive setup of CloudWatch Logs agent ... Step 1 of 5: Installing pip ...DONE Step 2 of 5: Downloading the latest CloudWatch Logs agent bits ... DONE Step 3 of 5: Configuring AWS CLI ... AWS Access Key ID [****************A6GQ]: //Press Enter AWS Secret Access Key [****************0Y3Q]: //Press Enter Default region name [us-west-2]: //Press Enter Default output format [None]: text //Press Enter Step 4 of 5: Configuring the CloudWatch Logs Agent ... Path of log file to upload [/var/log/messages]: //Press Enter Destination Log Group name [/var/log/messages]: //Press Enter Choose Log Stream name: 1. Use EC2 instance id. 2. Use hostname. 3. Custom. Enter choice [1]: //Press Enter Choose Log Event timestamp format: 1. %b %d %H:%M:%S (Dec 31 23:59:59) 2. %d/%b/%Y:%H:%M:%S (10/Oct/2000:13:55:36) 3. %Y-%m-%d %H:%M:%S (2008-09-08 11:52:54) 4. Custom Enter choice [1]: //Press Enter Choose initial position of upload: 1. From start of file. 2. From end of file. Enter choice [1]: //Press Enter More log files to configure? [Y]: N //Press Y to configure more logs Step 5 of 5: Setting up agent as a daemon ...DONE ------------------------------------------------------ - Configuration file successfully saved at: /var/awslogs/etc/awslogs.conf - You can begin accessing new log events after a few moments at https://console.aws.amazon.com/CloudWatch/home?region=us-west- 2#logs: - You can use 'sudo service awslogs start|stop|status|restart' to control the daemon. - To see diagnostic information for the CloudWatch Logs Agent, see /var/log/awslogs.log - You can rerun interactive setup using 'sudo python ./awslogs-\n\nagent-setup.py --region us-west-2 --only-generate-config' ------------------------------------------------------\n\n4. After you have completed these steps, the installer asks if you want to configure another log file; you can run the process as many times as you like for each log file. If you have no more log files to monitor, choose N when prompted by the installer to set up another log.\n\n5. You should see the newly created log group and log stream in the CloudWatch console after the agent has been running for a few moments.\n\n6. To check the status, run the following command:\n\n[root@ip-172-31-45-203 jhalak]# systemctl status awslogs awslogs.service - LSB: Daemon for AWSLogs agent. Loaded: loaded (/etc/rc.d/init.d/awslogs) Active: active (running) since --- ---- Jul 22 20:10:56 ip-172-31-45-203.us-west-2.compute.internal systemd[1]: Started LSB: Daemon for AWSLogs agent..\n\n7. To configure more logs with the same setup, run the following command:\n\n[root@ip-172-31-45-203 jhalak]# python ./awslogs-agent-setup.py -- region us-west-2 --only-generate-config Launching interactive setup of CloudWatch Logs agent ... Skipping downloading and installation of agent bits.Step 3 of 5: Configuring AWS CLI ... AWS Access Key ID [****************A6GQ]: // press Enter AWS Secret Access Key [****************0Y3Q]: // press Enter Default region name [us-west-2]: // press Enter Default output format [text]: // press Enter Step 4 of 5: Configuring the CloudWatch Logs Agent ... Path of log file to upload [/var/log/messages]: /var/log/httpd/access_log //Enter the required path Destination Log Group name [/var/log/httpd/access_log]: // press Enter Choose Log Stream name: 1. Use EC2 instance id. 2. Use hostname. 3. Custom. Enter choice [1]: //Press Enter Choose Log Event timestamp format: 1. %b %d %H:%M:%S (Dec 31 23:59:59) 2. %d/%b/%Y:%H:%M:%S (10/Oct/2000:13:55:36) 3. %Y-%m-%d %H:%M:%S (2008-09-08 11:52:54)\n\n4. Custom Enter choice [1]: //Press Enter Choose initial position of upload: 1. From start of file. 2. From end of file. Enter choice [1]: //Press Enter More log files to configure? [Y]: N Step 5 of 5: Setting up agent as a daemon ...DONE ------------------------------------------------------ - Configuration file successfully saved at: /var/awslogs/etc/awslogs.conf - You can begin accessing new log events after a few moments at https://console.aws.amazon.com/CloudWatch/home?region=us-west- 2#logs: - You can use 'sudo service awslogs start|stop|status|restart' to control the daemon. - To see diagnostic information for the CloudWatch Logs Agent, see /var/log/awslogs.log - You can rerun interactive setup using 'sudo python ./awslogs- agent-setup.py --region us-west-2 --only-generate-config' ------------------------------------------------------\n\n8. To restart the CloudWatch agent, run the following command:\n\n[root@ip-172-31-45-203 jhalak]# systemctl daemon-reload [root@ip-172-31-45-203 jhalak]# systemctl restart awslogs\n\n9. To configure the error logs, run the following command:\n\n[root@ip-172-31-45-203 jhalak]# python ./awslogs-agent-setup.py -- region us-west-2 --only-generate-config Launching interactive setup of CloudWatch Logs agent ... Skipping downloading and installation of agent bits.Step 3 of 5: Configuring AWS CLI ... AWS Access Key ID [****************A6GQ]: AWS Secret Access Key [****************0Y3Q]: Default region name [us-west-2]: Default output format [text]: Step 4 of 5: Configuring the CloudWatch Logs Agent ... Path of log file to upload [/var/log/messages]: /var/log/httpd/error_log Destination Log Group name [/var/log/httpd/error_log]: Choose Log Stream name: 1. Use EC2 instance id. 2. Use hostname. 3. Custom. Enter choice [1]: Choose Log Event timestamp format: 1. %b %d %H:%M:%S (Dec 31 23:59:59) 2. %d/%b/%Y:%H:%M:%S (10/Oct/2000:13:55:36) 3. %Y-%m-%d %H:%M:%S (2008-09-08 11:52:54) 4. Custom Enter choice [1]: Choose initial position of upload: 1. From start of file. 2. From end of file.\n\nEnter choice [1]: More log files to configure? [Y]: N Step 5 of 5: Setting up agent as a daemon ...DONE ------------------------------------------------------ - Configuration file successfully saved at: /var/awslogs/etc/awslogs.conf - You can begin accessing new log events after a few moments at https://console.aws.amazon.com/CloudWatch/home?region=us-west- 2#logs: - You can use 'sudo service awslogs start|stop|status|restart' to control the daemon. - To see diagnostic information for the CloudWatch Logs Agent, see /var/log/awslogs.log - You can rerun interactive setup using 'sudo python ./awslogs- agent-setup.py --region us-west-2 --only-generate-config' ------------------------------------------------------\n\n10. Once done, you can configure more application logs in the same way.\n\n3. Check the logs in the AWS CloudWatch console:\n\n1. Log in to the AWS Console, go to CloudWatch, and click on the Logs tab in the left-side navigation pane.\n\nCloudWatch Logs\n\n2. Now you can see all the logs created. 3. Select the log you have configured /var/log/messages for.\n\nCloudWatch Log Groups\n\nOceanofPDF.com\n\nThere's more...\n\nExamples of what you can do with Amazon CloudWatch and your logs are as follows:\n\nReal-time application and system monitoring: You can use CloudWatch logs to monitor applications and systems using log data in near real-time. For example, CloudWatch Logs can track the number of errors that occur in your application logs and send you a notification whenever the rate of errors exceed a threshold that you specify. Amazon CloudWatch uses your log data for monitoring; so no code changes are required. Long-term log retention: You can use CloudWatch Logs to store your log data for as long as you need in a highly durable and cost-effective storage without worrying about hard drives running out of space. The CloudWatch Logs Agent makes it easy to quickly move both rotated and unrotated log files off of a host and into the log service. You can then access the raw log event data when you need it. Limitations of CloudWatch logs:\n\nUp to 5 GB of incoming data for free Up to 5 GB of data archiving for free The maximum number of log groups per AWS account is 500 The maximum number of metric filters is 100 per log group The maximum event size is 256 KB The maximum batch size is 1 MB The maximum rate of a PutLogEvents request is five requests per second per log stream The maximum batch size of a PutLogEvents request is 1 MB The maximum rate of a GetLogEvents request is 10 requests per second per AWS account\n\nOceanofPDF.com\n\nStarting CloudTrail\n\nAmazon CloudTrail is an API log monitoring and recording tool. CloudTrail captures and records all the API calls and related events for your account and stores it into S3. You can also deliver the logs to CloudWatch logs and events.\n\nCloudWatch primarily does three tasks:\n\nStores log files in S3 Looks up the API history Gives notification on specific API activity\n\nYou can create two types of trails:\n\nA trail that applies to all regions A trail that applies to one region\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Sign in to the AWS Management Console and click on CloudTrail.\n\nSelect CloudTrail\n\n2. Click on Get Started Now.\n\nCloudTrail: Get Started\n\n3. On the Turn on CloudTrail page, provide the Trail name and select Yes if you want to Apply trail to all regions.\n\n4. Under Management events, for Read/Write events, choose if you want your trail to log All, Read-only, Write-only, or None, and then choose Save. By default, trails log All management events.",
      "page_number": 451
    },
    {
      "number": 51,
      "title": "Segment 51 (pages 464-474)",
      "start_page": 464,
      "end_page": 474,
      "detection_method": "topic_boundary",
      "content": "Turn on CloudTrail\n\n5. Provide a storage location, select Yes, and provide a name to your bucket. Select No if you have an available bucket and provide the bucket name.\n\nS3 bucket for CloudTrail\n\n6. Click on Advanced and provide the details shown in the following screenshot:\n\nCloudTrail Advanced Details\n\n7. The new trail appears on the Trails page. The Trails page shows the trails in your account from all regions.\n\nCloudTrail Logs\n\nOceanofPDF.com\n\nHow it works...\n\nCloudTrail captures API calls and related events made by or on behalf of an AWS account and delivers log files to an Amazon S3 bucket. CloudTrail pushes log files generally every 5 minutes.\n\nOceanofPDF.com\n\nThere's more...\n\nYou can integrate CloudTrail with your third-party log monitoring tools such as Loggly using the API automate trail creation for your organization, check the status of your trails, and control how administrators turn CloudTrail logging on and off.\n\nBy default, log files are encrypted using Amazon S3 server-side encryption (SSE). You can store your log files in your bucket for as long as you want. You can also define the Amazon S3 life cycle rules to archive or delete log files automatically.\n\nYou can create up to five trails for each region. After you create a trail, CloudTrail automatically starts logging API calls and related events in your account. To stop logging, you can turn off logging for the trail or delete it.\n\nOceanofPDF.com\n\nSubmitting a penetration testing request\n\nPenetration testing is a cyber attack against your infrastructure to test exploitable vulnerabilities. The main objective of pen testing is to determine security weakness. AWS considers pen testing as abusive behavior so it, by default, blocks the source IP. Before performing pen testing, you need to inform AWS about the test.\n\nOceanofPDF.com\n\nGetting ready\n\nYou can request authorization for penetration testing by signing in with your root account credentials and filling out the AWS Vulnerability/Penetration Testing Request Form. AWS will follow up on your request within 2 business days.\n\nYou cannot perform pen testing on small/micro/nano EC2 or RDS instances.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to the AWS Console using the root account. 2. Click on the URL to open the form: https://aws.amazon.com/forms/penetration-testi ng-request\n\n3. Provide all the required details: 1. Contact Information:\n\nPenetration Testing Form\n\n2. Scan Information:\n\nPenetration Testing Form\n\n4. Click I agree in the Terms and Conditions Agreement section and click on Submit.\n\nPenetration Testing Form\n\n5. You will get a confirmation email within 2 days.\n\nOceanofPDF.com\n\nTroubleshooting and VPC Limits\n\nIn this chapter, we will cover the following recipes:\n\nTroubleshooting IP address overlapping Errors while connecting an EC2 instance in a VPC Internet not accessible in the instance Internet not accessible in the private subnet instance (NAT Gateway) Not able to delete a VPC Enabling VPC flow logs Increasing VPC limits\n\nOceanofPDF.com\n\nIntroduction\n\nIn this chapter, we will go through basic and advanced troubleshooting steps while creating and managing a VPC. You may have your own tools to check such issues, but there are a few standard series of tasks that you can look into. For example, incorrect CIDR block, overlapping routing table, and so on.\n\nOceanofPDF.com",
      "page_number": 464
    },
    {
      "number": 52,
      "title": "Segment 52 (pages 475-482)",
      "start_page": 475,
      "end_page": 482,
      "detection_method": "topic_boundary",
      "content": "Troubleshooting IP address overlapping\n\nThink of a scenario--you have already set up a VPC with instances inside it with, say, 172.0.x.x/16 CIDR and you've realized that the client who is going to connect also has the same CIDR block. So, wisely choose the IP address ranges for your VPC to avoid conflict with another network that you might connect to.\n\nOceanofPDF.com\n\nGetting ready\n\nYou will need access to modify the VPC.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe only option is to create a new VPC and migrate resources into the new one. Please follow the steps given in Chapter 2, Building Your Own Custom VPC, to create a new VPC.\n\nOceanofPDF.com\n\nThere's more...\n\nYou can create multiple VPCs with the same CIDR blocks. These VPCs will act as an individual network, but if you need to do peering between two VPCs, then it will create an issue. As you can't modify a VPC CIDR block, the only solution for this issue is to create another VPC that doesn't overlap with your peering VPC.\n\nOceanofPDF.com\n\nErrors while connecting an EC2 instance in a VPC\n\nThere can be multiple reasons for getting such an error; a few of them are mentioned following:\n\nEC2 created in the wrong subnet group or private subnet Instance doesn't have a public IP or you are trying to connect with a private IP SSH/RDP port is not opened in the security group or the security group is not attached to the instance\n\nOceanofPDF.com\n\nGetting ready\n\nYou should have access to EC2 and VPC to view and modify the resources.\n\nOceanofPDF.com\n\nHow to do it...\n\nThe following steps are to be followed:\n\n1. Start by checking the IP of the instance. Verify that you are using the correct IP address. Follow the following steps to check the IP: 1. Log in to the AWS Console | EC2 | Instances | Instance.\n\nAWS EC2 Console\n\n2. Check that your instance has either a public IP address or an Elastic IP address associated with it in the case of public instances. Follow the following steps to check the Associated Elastic IP: 3. Log in to the AWS Console | EC2 | Elastic IPs | Allocate new\n\naddress.\n\nAllocate Elastic IP\n\n4. When prompted, click on Allocate.\n\nAllocate Elastic IP\n\n5. Once the IP comes up, go to Actions | Associate address.\n\nAssociate Elastic IP\n\n6. Provide the instance details.\n\nAssociate Elastic IP",
      "page_number": 475
    },
    {
      "number": 53,
      "title": "Segment 53 (pages 483-490)",
      "start_page": 483,
      "end_page": 490,
      "detection_method": "topic_boundary",
      "content": "7. The Associated IP and details will look like this.\n\nAssociate Elastic IP\n\n8. Check the IP in the instance.\n\nAWS EC2 Elastic IP Details\n\n2. Check that both System Status Checks and Instance Status Checks are cleared. The following are the steps:\n\n1. Log in to the AWS Console | EC2 | Instances. 2. Then choose the Status Checks tab. 3. Verify that the instance passes both status checks.\n\n3. The SSH/RDP port may not be opened in the Security Group. Or there may be a scenario where you missed attaching the right Security Group to the instance:\n\n1. Log in to the AWS Console | EC2 | Instances. 2. Select Instance | Security Group.\n\nCheck Security Group\n\n3. Select the Inbound tab.\n\nSelect Security Group\n\n4. Your Security Group should allow SSH access over port 22 from your IP.\n\nCheck Inbound Rules\n\n1. If SSH access is not available, create a new rule by clicking on Edit | Add Rule.\n\nAdd Inbound Rule in Security Group\n\n2. Select Type | SSH | Source | My IP and click on Save.\n\nSecurity Group: Add SSH Rule\n\n5. Check whether the server has been created in the right subnet or whether the subnet allows traffic from the necessary ports and protocols.\n\n1. Log in to the AWS Console | Amazon Virtual Private Cloud (VPC) and navigate to Network ACLs.\n\n2. Choose either the Inbound Rules or Outbound Rules tab. 3. Choose to Allow for the traffic from the source IP address in both inbound and outbound rules.\n\nOceanofPDF.com\n\nThere's more...\n\nIf you still face this issue when connecting instances, there could be multiple reasons. The reasons can be as follows:\n\nLocal firewall rules Routing policy of your network Trying to connect with the wrong key pair\n\nOceanofPDF.com\n\nInternet not accessible in the instance\n\nYou are connected to your public subnet instance but, while updating the OS or trying to connect to the internet, you get an error. In this recipe, we will look at the possible reasons for internet related issues.\n\nWe will discuss private instances in a later section.\n\nOceanofPDF.com\n\nGetting ready\n\nFor troubleshooting, you will need access to the server and the VPC.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Verify whether the Route Table has the appropriate routes entered for the destination 0.0.0.0/0 via the Internet Gateway.\n\n1. Log in to the AWS Console | Amazon Virtual Private Cloud (VPC). 2. Select Route Tables from the navigation pane.\n\n3. Choose the Route Table associated with your subnet instance.\n\nSelect Route Table\n\n4. Select the Routes tab. Check whether the default routes (as mentioned in the image) are attached or any customized route is",
      "page_number": 483
    },
    {
      "number": 54,
      "title": "Segment 54 (pages 491-498)",
      "start_page": 491,
      "end_page": 498,
      "detection_method": "topic_boundary",
      "content": "available to the instance.\n\nCheck Routes\n\n2. Check whether the Internet Gateway is attached to the VPC:\n\n1. Log in to the AWS Console and select Amazon Virtual Private Cloud (VPC).\n\n2. Navigate to Internet Gateways and choose Create Internet Gateway.\n\nGoto Internet Gateway\n\n3. Select the Internet Gateway and check whether it is connected to the right VPC.\n\nSelect Internet Gateway\n\n4. If not attached, Choose Attach to VPC, and select your VPC from the list.\n\nOceanofPDF.com\n\nThere's more...\n\nThere can be various other reasons, which are as follows:\n\nOS firewall rules or SELinux Confirm DNS Resolution\n\nOceanofPDF.com\n\nInternet not accessible in the private subnet instance (NAT Gateway)\n\nWhile working with a private instance, we face various issues in terms of an EC2 instance connecting to the internet or any other instance in the subnet.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. The first troubleshooting step starts with pinging the destination (any other host or internet).\n\nMake sure that you test the destination from another server or your own computer because the destination host/website should have ICMP enabled.\n\n2. Verify that NAT Gateway and EC2 are attached to the desired subnet. 3. Ensure that NAT Gateway has been created in a public subnet.\n\nPublic subnet should have a public Route Table having a default route pointing to the Internet Gateway.\n\n4. Check that the NAT Gateway is in an available state. If the NAT Gateway goes into a failed state, you will need to resolve the issue or create a new one immediately.\n\nA failed NAT Gateway will be deleted automatically at some time, usually in an hour.\n\n5. Make sure you don't have any blocked rules in the Network ACLs associated with your VPC.\n\n6. Ensure that the security group rules for your private instance allows outbound internet traffic. For the ping command to work, the rules must also allow outbound ICMP traffic.\n\nOceanofPDF.com\n\nNot able to delete a VPC\n\nNow you have created a VPC, but you are unable to delete it.\n\nOceanofPDF.com\n\nGetting ready\n\nBefore deleting a VPC, all the resources attached to the VPC have to be terminated or released.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Check whether the NAT gateway is detached. 2. Disassociate the Elastic IP. 3. Remove dependencies between security groups 4. Terminate the EC2 instance. 5. Terminate the RDS instance and the DB subnet group. 6. Delete the Virtual Private Gateway. 7. All the VPN attachments will be terminated. 8. Delete the Internet Gateway. 9. Delete the Route Tables. OceanofPDF.com",
      "page_number": 491
    },
    {
      "number": 55,
      "title": "Segment 55 (pages 499-506)",
      "start_page": 499,
      "end_page": 506,
      "detection_method": "topic_boundary",
      "content": "Enabling VPC flow logs\n\nVPC flow logs is a feature which helps in capturing information about the IP network traffic going to and from the VPC. This information can be used for troubleshooting connectivity and security. All the logs are stored in CloudWatch logs. You can also trigger an alarm for certain use cases or threats.\n\nOceanofPDF.com\n\nGetting ready\n\nYou will need access to the VPC and CloudWatch.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Log in to the AWS Console and then select VPC.\n\n1. Select your VPC | Actions | Create Flow Log.\n\nCreate Flow Log\n\n2. Click Create Flow Log.\n\nCreate Flow Log\n\n3. Create a role if it's not already there by selecting Set Up Permissions.\n\nCreate Flow Log\n\n4. Navigate to Flow Logs in the lower pane.\n\nNavigate Flow Log\n\n5. Flow Logs will appear in the Cloudwatch Logs.\n\nCheck Flow Log in CloudWatch\n\nOceanofPDF.com\n\nThere's more...\n\nFlow logs will not include the following traffic:\n\nVPC flow logs support network interfaces created in VPC only, that is, EC2-classic links are not supported. Traffic to or from DNS servers. Windows license activation traffic. Traffic to and from instance metadata (that is, 169.254.169.254) requests. DHCP requests or responses.\n\nFlow logs cannot be tagged Flow logs configurations can't be changed once created, so you need to delete the existing ones and create new ones.\n\nOceanofPDF.com\n\nIncreasing VPC Limits\n\nVPC and, in fact, all AWS resources come with certain soft/hard limits so that people don't misuse or continue to spin up instances without any requirement. It also helps if your AWS server/account gets hacked and the hacker starts spinning up multiple high configuration servers to give you a billing heart attack.\n\nOceanofPDF.com\n\nGetting ready\n\nLimits of various services:\n\nSr.no Resources\n\n1\n\nVPC per region\n\n2\n\nSubnets per VPC\n\n3\n\nEIP per region\n\n4\n\nFlow logs per ENI per region\n\n5\n\nCustomer Gateway per region\n\nDefault limit\n\n5\n\n200\n\n5\n\n2\n\n50\n\nLimit type\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nHard Limit\n\nSoft Limit\n\nComments\n\nInternet Gateway per region will also increase by the same number\n\nThis limit is for VPC specific resources apart from EC2",
      "page_number": 499
    },
    {
      "number": 56,
      "title": "Segment 56 (pages 507-514)",
      "start_page": 507,
      "end_page": 514,
      "detection_method": "topic_boundary",
      "content": "6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\nInternet Gateway per region\n\nNAT Gateway per AZ\n\nVirtual private gateway per region\n\nNACL per VPC\n\nRules per NACL\n\nENI per region\n\nRoute Tables per VPC\n\n5\n\n5\n\n5\n\n200\n\n20\n\n350\n\n200\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nHard Limit\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nThis is directly related to VPCs and cannot be increased without increasing the VPC\n\nSingle NACL can be attached to multiple subnets\n\nThis can be increased to 40\n\nNo of ENI = No. of Instance * 5\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\nRoutes per Route Table (Propagated Routes)\n\nRoutes per Route Table (Non Propagated Routes)\n\nSecurity Groups per VPC\n\nInbound/outbound rules per vpc\n\nSecurity Groups per ENI\n\nVPC Peering connections per VPC\n\nOutstanding VPC peering connection requests\n\n100\n\n50\n\n500\n\n50\n\n5\n\n50\n\n25\n\nHard Limit\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nMax Limit = 100\n\n50 inbound + 50 outbound (Total Max = 250)\n\nMax Limit = 16\n\nMax Limit = 125\n\n20\n\n21\n\n22\n\nVPC endpoint per region\n\nVPN connections per VPC\n\nVPN connections per region\n\n20\n\nSoft Limit\n\n50\n\nSoft Limit\n\n10\n\nSoft Limit\n\nOceanofPDF.com\n\nMax Limit = 255 endpoints\n\nHow to do it...\n\nFollow the below steps to increase the limit of any resource:\n\n1. Log in to the AWS Console and click on Support (Upper right-hand side corner).\n\nNavigate Support Center\n\n2. Click Create Case.\n\nCreate Support case\n\n3. Select Regarding as Service Limit Increase and Limit Type as EC2 instances (or any other service you want to increase the limit for).\n\nProvide Support Case Details\n\n4. Provide the required details as asked for in the form. You can also add another request within the same ticket.\n\nProvide New limit details\n\n5. Provide Use Case Description, Support Language, and Contact method. 6. Click on Submit to complete the submission.\n\nOceanofPDF.com\n\nPricing of VPC and Related Components\n\nIn this chapter, we shall learn the following recipes:\n\nVPC, VPN and Nat Gateway pricing EC2, ELB and Elastic IP pricing Route 53 pricing Direct Connect pricing CloudFront pricing WAF and Cloud Shield pricing\n\nOceanofPDF.com\n\nIntroduction\n\nYou have learned different recipes related to different AWS networking components and infrastructure. Let's understand how pricing is done by AWS for these services. Pricing may be different for the same components over different regions. So you should consider costing in different regions before hosting your network and infrastructure in a particular AWS region. We shall use the AWS cost calculator, which is a simple user interface that lists most of the AWS services, and we can calculate the cost of all of the services that we are going to use in our AWS infrastructure for one or multiple regions. You need to remember that the cost of the networking components is calculated on their actual usage. AWS's pricing of services changes from time to time, so you should get the latest cost from the pricing page of each service. You can see the details of AWS free at: https://aws.amazon. com/free/. Here is the list of network related free services:\n\nThe list of free networking related components are:\n\nVPC Subnet Internet Gateway Security Group NACL Routing Table VPC Endpoint\n\nAlso supporting services like IAM, AWS CLI, and AWS CloudFormation are free. We are providing recipe to calculate pricing for some of the AWS components. You can apply same process for other AWS components as well.\n\nOceanofPDF.com",
      "page_number": 507
    },
    {
      "number": 57,
      "title": "Segment 57 (pages 515-522)",
      "start_page": 515,
      "end_page": 522,
      "detection_method": "topic_boundary",
      "content": "VPC, VPN and Nat Gateway pricing\n\nVPC and most of its components are free. However we need to pay for data that we transfer in and out of these components. To understand details of pricing, browse to the link: https://aws.amazon.com/vpc/pricing/.\n\nOceanofPDF.com\n\nGetting ready\n\nWe will start by short listing regions where an infrastructure can be created which may be dependent on network latency, compliance, and so on. Also you will need to determine which VPC components and how many of them you need to create.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Browse to the AWS cost calculator https://calculator.s3.amazonaws.com/index.html. US-East is the default region selected. Choose a different region if you wish to. Choose Amazon VPC from the left side menu option:\n\nAWS cost calculator\n\n2. Add the desired components, such as VPC, that you need to choose by clicking on +. If you want to delete a row, choose -. For the Usage field, you can choose the utilization % or hours or define it in terms of days or weeks or months. For each VPC, you can choose zero or more VPN connections. The cost will be updated in the Estimate of your Monthly Bill tab. I have added one VPC with 1 GB data in and 1 GB data out per month. You can see that the cost is zero for 100% utilization:\n\nVPC cost without VPN\n\n3. Now let's add a prod VPC with 1 VPN with 100% utilization. We can see the monthly cost has increased to $36.60:\n\nVPC cost with VPN\n\n4. Let's add 100 GB/month data in. You can see that the cost remains the same:\n\nVPC cost with VPN and data in\n\n5. Let's add 100 GB/month data transfer out. You can see that the price has increased to $44.25:\n\nVPC cost with VPN and data in and out\n\n6. Click on the Estimate of Your Monthly Bill tab. You can see the breakdown of the cost, along with the free tier discount amount:\n\nVPC cost breakdown with VPN and data in and out\n\n7. Let's go back to the Services tab. Add one NAT with 100% utilization. Add 100 GB data in and out. You can see that the cost has further increased to $90.69:\n\nVPC cost with VPN, NAT and data in and out\n\n8. Click on the Estimate of Your Monthly Bill tab. You can see the breakdown of the cost, with the NAT cost added:\n\nVPC cost breakup with VPN, NAT and data in and out\n\nOceanofPDF.com\n\nThere's more...\n\nThe data transfer cost is different with different usage levels. With higher usage, the cost reduces. You can see this at: https://aws.amazon.com/ec2/pricing/on-de mand/#Data_Transfer.\n\nOceanofPDF.com\n\nEC2, ELB and Elastic IP pricing\n\nEC2 is the infrastructure service that you need to host your application. You need services such as EBS to be attached to EC2. Elastic IP or ELB can be used to expose your service, hosted on EC2 to the end users. The cost of EC2 is dependent on the type of EC2 and the operating system. Discounts are available for reserved instances. We should consider shared instances with on demand usage for costing. Dedicated instances are also available for special purposes. To understand details of pricing, go to https://aws.amazon.c om/ec2/pricing/.\n\nOceanofPDF.com",
      "page_number": 515
    },
    {
      "number": 58,
      "title": "Segment 58 (pages 523-533)",
      "start_page": 523,
      "end_page": 533,
      "detection_method": "topic_boundary",
      "content": "Getting ready\n\nWe will start by short listing regions where an infrastructure can be created, which may be dependent on network latency, compliance, and so on. Perhaps you also need to determine how many of the EC2, EBS, ELB, and EIP components you will need to create.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Open a new cost calculator if you want to have the cost for only EC2 related components or use the same cost calculator used for the earlier recipe. Choose Amazon EC2 from the left menu bar:\n\nAWS cost calculator for EC2\n\n2. Click + under Compute: Amazon EC2 Instances: to add EC2 to the cost calculator. Enter the description, the number of instances, and the usage details. Click on the icon for type. The following window will open. Choose the instance type and operating system based on your need. Click on Close and Save:\n\nEC2 OS and instance type selection\n\n3. Click the icon next to the billing options. The following window will open. Choose the required billing option and click on Close and Save. For reserved options, you may pay upfront, partially upfront or no upfront fee at all. You need to make the upfront payment at the start of your reservation, as shown in the Upfront Price column. Effective Hourly Cost shows the per hour charge for using the instance:\n\nEC2 pricing options\n\n4. Now let's add the cost of storage attached to the EC2 instance. Click + under Storage: Amazon EBS Volumes:. Add the volume description, the number of volumes, the volume type, the storage amount and the snapshot size for backup:\n\nEBS pricing options\n\n5. Next, add the Elastic IP requirement details and data transfer details:\n\nElastic IP and data transfer options\n\n6. Finally, add ELB and the data processed by ELB:\n\nLoad balancing options\n\n7. Browse to the Estimate of Your Monthly Bill tab. You will be able to see the details for the cost components:\n\nMonthly bill for EC2\n\nOceanofPDF.com\n\nRoute 53 pricing\n\nRoute 53 is priced for pay per use DNS service. It has components such as hosted zones, traffic flow and queries. AWS has a staggering price for the number of hosted zones and queries, with a lesser unit price beyond a certain usage. For details, check https://aws.amazon.com/route53/pricing/.\n\nOceanofPDF.com\n\nGetting ready\n\nYou need to decide the amount of traffic flow, the hosted zones and the health check to be used for Route 53.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Open a new cost calculator if you want to have the cost for only Route 53 related components or use the same cost calculator used for earlier recipes. Choose Amazon Route 53 from the left menu bar:\n\nAWS cost calculator for Route 53\n\n2. Add the hosted zones, the traffic flow and type and the number of queries. You can see the estimated bill on the other tab:\n\nRoute 53 cost for Hosted zone components\n\n3. Add DNS failover details under DNS Failover Health Checks for endpoints:\n\nRoute 53 cost for Hosted zone components and Failover health check\n\n4. Browse to the Estimate of your Monthly Bill tab. You will be able to see the details for the cost components:\n\nRoute 53 monthly bill\n\nOceanofPDF.com\n\nDirect Connect pricing\n\nDirect Connect comes with a dedicated bandwidth connectivity ranging from 50 MB per second to 10 GB per second. It also has certain locations to which you need to establish connectivity for your data center.\n\nOceanofPDF.com\n\nGetting ready\n\nWe first need to finalize the number and bandwidth connectivity for Direct Connect.\n\nOceanofPDF.com",
      "page_number": 523
    },
    {
      "number": 59,
      "title": "Segment 59 (pages 534-541)",
      "start_page": 534,
      "end_page": 541,
      "detection_method": "topic_boundary",
      "content": "How to do it...\n\n1. Open a new cost calculator if you only want to have the cost for Direct Connect related components, or use the same cost calculator used for earlier recipes. Choose AWS Direct Connect from the left menu bar:\n\nAWS cost calculator for Direct Connect\n\n2. Add Direct Connect by clicking on +. If you want to delete a row, choose -. Provide the Port Description, number of ports and width, Port Usage, and Location. There are many locations available nearest to the AWS region, as shown in the following screenshot:\n\nDirect Connect locations\n\n3. Put in values for Data Transfer In and Data Transfer Out and get the final pricing:\n\nDirect Connect cost components\n\n4. Browse to the Estimate of your Monthly Bill tab. You will be able to see the details for the cost components:\n\nDirect Connect monthly bill\n\nOceanofPDF.com\n\nCloudFront pricing\n\nCloudFront is a caching service provided by AWS. There is a certain free use limit for CloudFront. The AWS CloudFront price is different for different geographic regions. You can get a discount for reserved pricing if you commit certain uses for at least 12 months. For details go to: https://aws.a mazon.com/cloudfront/pricing/.\n\nOceanofPDF.com\n\nGetting ready\n\nWe first need to finalize the data transfer amount, the request type, and the request.\n\nOceanofPDF.com\n\nHow to do it...\n\n1. Open a new cost calculator if you want to have the cost for only CloudFront related components, or use the same cost calculator used for earlier recipes. Choose AWS CloudFront from the left menu bar:\n\nAWS cost calculator for CloudFront\n\n2. Provide the data transfer volume, the average object size and the invalidation requests:\n\nCloudFront data transfer and request\n\n3. Provide the traffic distribution over the world, if you know. Provide the IP SSL certificates for HTTPS requests:\n\nCloudFront data distribution\n\n4. Browse to the Estimate of your Monthly Bill tab. You will be able to see the details for the cost components:\n\nCloudFront monthly bill\n\nOceanofPDF.com\n\nWAF and Cloud Shield pricing\n\nWAF and Cloud Shield pricing is still not integrated with the AWS cost calculator. Let's understand their pricing model. WAF can be integrated with ELB and CloudFront, so the WAF bill is included in the CloudFront or the ELB with which it is integrated.\n\nOceanofPDF.com\n\nGetting ready\n\nWe first need to understand the components of the services.\n\nOceanofPDF.com",
      "page_number": 534
    },
    {
      "number": 60,
      "title": "Segment 60 (pages 542-544)",
      "start_page": 542,
      "end_page": 544,
      "detection_method": "topic_boundary",
      "content": "How to do it...\n\n1. Go to https://aws.amazon.com/waf/pricing/. You can see that the WAF price is based on the number of web ACL and rules. For example, if you have 2 web ACLs and 20 rules, the cost per month will be as follows:\n\n(2 * $5 per web ACL per month) + (20 * $1 per rule per web ACL per month) = $30\n\n2. WAF has an additional price for the number of requests. For example, if your application receives 20 million requests, then the cost per month will be:\n\n20*$0.60 per million web requests = $12\n\n3. So the total cost of WAF is $42 per month. 4. AWS Cloud Shield is free and is integrated with Elastic Load Balancing (ELB), Application Load Balancer, Amazon CloudFront, and Amazon Route 53. You don't need to pay anything extra for the AWS Cloud Shield.\n\n5. However, there is another option, AWS Shield Advanced which needs one year's commitment and comes with a monthly fee of $3000. It has additional costs for data transfers, as well as for Application Load Balancer and Amazon CloudFront. The data transfer price is different for each of these services and is priced as pay per use. The cost is different at different usage levels. For details, check https://aws.amazon.com/ shield/pricing/.\n\n6. If you use the AWS Cloud Shield Advanced, and your application needs to transfer 500 GB of data out, cost per month will be as follows:\n\n3000 + 500* Data Transfer Out Price (0.05 $ per GB) = $3025\n\nOceanofPDF.com",
      "page_number": 542
    }
  ],
  "pages": [
    {
      "page_number": 2,
      "content": "AWS Networking Cookbook\n\nPowerful recipes to master the pain points of optimizing your VPC\n\nSatyajit Das",
      "content_length": 104,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 3,
      "content": "Jhalak Modi\n\nBIRMINGHAM - MUMBAI\n\nOceanofPDF.com",
      "content_length": 48,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 4,
      "content": "OceanofPDF.com",
      "content_length": 14,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 5,
      "content": "AWS Networking Cookbook\n\nCopyright © 2017 Packt Publishing\n\nAll rights reserved. No part of this book may be reproduced, stored in a retrieval system, or transmitted in any form or by any means, without the prior written permission of the publisher, except in the case of brief quotations embedded in critical articles or reviews.\n\nEvery effort has been made in the preparation of this book to ensure the accuracy of the information presented. However, the information contained in this book is sold without warranty, either express or implied. Neither the authors, nor Packt Publishing, and its dealers and distributors will be held liable for any damages caused or alleged to be caused directly or indirectly by this book.\n\nPackt Publishing has endeavored to provide trademark information about all of the companies and products mentioned in this book by the appropriate use of capitals. However, Packt Publishing cannot guarantee the accuracy of this information.\n\nFirst published: August 2017\n\nProduction reference: 1210817\n\nPublished by Packt Publishing Ltd. Livery Place",
      "content_length": 1076,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 6,
      "content": "35 Livery Street Birmingham B3 2PB, UK.\n\nISBN 978-1-78712-324-3\n\nwww.packtpub.com\n\nOceanofPDF.com",
      "content_length": 97,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 7,
      "content": "Credits\n\nAuthors\n\nSatyajit Das\n\nJhalak Modi\n\nReviewers\n\nAppasaheb Bagali\n\nAdrin Mukherjee\n\nLegorie Rajan\n\nCommissioning Editor\n\nVijin Boricha\n\nCopy Editor\n\nJuliana Nair\n\nProject Coordinator\n\nJudie Jose\n\nProofreader\n\nSafis Editing",
      "content_length": 229,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 8,
      "content": "Acquisition Editor\n\nHeramb Bhavsar\n\nContent Development Editor\n\nDevika Battike\n\nTechnical Editor\n\nAditya Khadye\n\nIndexer\n\nAishwarya Gangawane\n\nGraphics\n\nKirk D'Penha\n\nProduction Coordinator\n\nAparna Bhagat\n\nOceanofPDF.com",
      "content_length": 220,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 9,
      "content": "About the Authors\n\nSatyajit Das has more than sixteen years of IT experience. He is currently working as an AWS CoE lead cloud architect in a large enterprise. He has also worked as an enterprise architect, solution architect, and technical architect in recent engagements. He has guided, designed, integrated, implemented, and governed enterprise-grade applications. He works on building solutions using microservices on the hybrid cloud using DevOps principles. He has extensively worked on IoT, AWS, and cloud migration.\n\nSatyajit has worked in leading organizations, such as Wipro, Infosys, PwC, and Accenture, in various challenging roles.\n\nI would like to thank the extremely helpful and supportive editorial team at Packt, who enabled me to write my first book. I would like to thank the Wipro management team and colleagues for providing support while I was writing this book. I'll take this opportunity to thank Vipul for mentoring and motivating me to take up new challenges and learning opportunity. I would like to thank my entire family, especially my wife, Papiya, for supporting me through all the ups and downs. I would like to dedicate this book to my father, Sasadhar, who guided me and made me who I am today, and my lovely son, Shreyas, to whom I cannot give much time due to the challenges of my professional career.\n\nJhalak Modi is a DevOps, cloud architect, and an AWS trainer with a deep interest and expertise in implementing multi-tier architectures, cluster platforms, and automation solutions. She is an AWS certified solutions architect professional and a certified DevOps professional with 10+ certifications in trending technologies.",
      "content_length": 1664,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 10,
      "content": "Jhalak is also a public speaker at various AWS events, colleges/universities, and meet-ups, and has provided AWS and Linux training at several renowned institutes and corporates. Currently, she is working with KOGENTiX and has worked with Wipro Technologies and Electromech Corporation in the past.\n\nI would like to dedicate this book to my parents for always believing in me and loving me unconditionally. Special thanks to my husband, Darshan, for his constant guidance, support, and patience. Without him, this book would be impossible. Many thanks to Karishma Modi, Hardik Modi, and my in-laws; you all mean a lot to me. Many heartfelt thanks and gratitude go out to Vipul Tankariya, Bhavin Parmar, Divya Tiwari, and my co-author, Satyajit Das, and all the mentors (Ashutosh Pancholi, Shivram Meena, Rukhsana Saifee, Anu Badola, Sadhandan PT, Jai Malhotra, and Shiksha Kanwar). Thanks to Packt's Heramb Bhavsar, Devika Battike, and team for putting up with my random schedule and making this a better book with their diligent reviewing efforts. Finally, there would be no book about AWS networking without AWS. I wish to thank the AWS team for their extraordinary documents.\n\nOceanofPDF.com",
      "content_length": 1194,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 11,
      "content": "About the Reviewers\n\nAppasaheb Bagali is an AWS solution architect working with enterprise customers. His love for computers drove him to pursue a master's degree in computer application (MCA) and has not looked back ever since. He started his career as a web developer, and is currently working as an AWS solutions architect and helps customers understand how to transform their IT infrastructure, operations, and applications to make the most of the scalability, innovation, and cost efficiency of the AWS platform. He loves to hack around DevOps and automation using Puppet and AWS CloudFormation.\n\nHe lives in Banglore with his wife, Sandhya, and son, Pritam.\n\nAdrin Mukherjee is a passionate software engineer and a technical architect with expertise in building distributed applications and high- performance systems. He has 13 years of experience in the IT industry and is presently working as a solution architect at Wipro.\n\nHis current focus is on cloud computing, NoSQL, and machine learning.\n\nLegorie Rajan is a cloud consultant working with enterprise customers in the banking and insurance domains. He started his career as a mainframe developer and is currently working as a solution architect on the cloud and helps with migration of applications to the cloud. He loves to hack around with new languages; his current side projects use NodeJs, Mongo, and Kubernetes. He has a B.Tech (CS) from Pondicherry University and MS (Mgmt) from Grenoble Graduate School of Business.",
      "content_length": 1486,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 12,
      "content": "He lives in Chennai with his wife, Anitha Sophie, and son, Reuel Bepin.\n\nOceanofPDF.com",
      "content_length": 87,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 13,
      "content": "www.PacktPub.com\n\nFor support files and downloads related to your book, please visit www.PacktP ub.com.\n\nDid you know that Packt offers eBook versions of every book published, with PDF and ePub files available? You can upgrade to the eBook version at www.PacktPub.com and as a print book customer, you are entitled to a discount on the eBook copy. Get in touch with us at service@packtpub.com for more details.\n\nAt www.PacktPub.com, you can also read a collection of free technical articles, sign up for a range of free newsletters and receive exclusive discounts and offers on Packt books and eBooks.\n\nhttps://www.packtpub.com/mapt\n\nGet the most in-demand software skills with Mapt. Mapt gives you full access to all Packt books and video courses, as well as industry-leading tools to help you plan your personal development and advance your career.\n\nOceanofPDF.com",
      "content_length": 866,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 14,
      "content": "Why subscribe?\n\nFully searchable across every book published by Packt Copy and paste, print, and bookmark content On demand and accessible via a web browser\n\nOceanofPDF.com",
      "content_length": 172,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 15,
      "content": "Customer Feedback\n\nThanks for purchasing this Packt book. At Packt, quality is at the heart of our editorial process. To help us improve, please leave us an honest review on this book's Amazon page at https://www.amazon.com/dp/1787123243.\n\nIf you'd like to join our team of regular reviewers, you can e-mail us at customerreviews@packtpub.com. We award our regular reviewers with free eBooks and videos in exchange for their valuable feedback. Help us be relentless in improving our products!\n\nOceanofPDF.com",
      "content_length": 508,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 16,
      "content": "Table of Contents\n\nPreface\n\nWhat this book covers\n\nWhat you need for this book\n\nWho this book is for\n\nSections\n\nGetting ready\n\nHow to do it…\n\nHow it works…\n\nThere's more…\n\nSee also\n\nConventions\n\nReader feedback\n\nCustomer support\n\nDownloading the example code\n\nDownloading the color images of this book\n\nErrata\n\nPiracy\n\nQuestions\n\n1. Getting Started with AWS Networking Components\n\nIntroduction\n\nVarious AWS network services\n\nCreating an account in AWS\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nCreating an admin user in AWS\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nCreating a VPC and a subnet with IPv6\n\nGetting ready\n\nHow to do it...",
      "content_length": 651,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 17,
      "content": "Creating an EC2 with an IPv6 address\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nCreating NAT on EC2 instance\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nWorking with network interfaces\n\nGetting ready\n\nHow to do it...\n\nConfiguring AWS CLI\n\nGetting ready\n\nHow to do it...\n\n2. Building Your Own Custom VPC\n\nIntroduction\n\nManaging a VPC\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nManaging public and private subnets\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nManaging a Network ACL\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nManaging a Security Group\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...",
      "content_length": 697,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 18,
      "content": "Managing an Internet Gateway\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nManaging a NAT Gateway\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nManaging a Route Table\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nManaging EC2 instances\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more... 3. VPC Advanced Components Introduction\n\nAssigning multiple IPs to an instance and ENI\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nAccessing an instance within the network\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nAccessing an instance from outside AWS\n\nGetting ready\n\nHow to do it...\n\nCreating an application ELB\n\nGetting ready\n\nHow to do it...",
      "content_length": 724,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 19,
      "content": "How it works...\n\nThere's more...\n\nCreating a launch configuration\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nCreating an Auto Scaling group\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nCreating VPC peering\n\nGetting ready\n\nHow to do it...\n\nAccepting VPC peering\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nConfiguring routes between multiple VPCs peered together\n\nLimitations of VPC peering connection\n\nControlling access to VPC peering connections\n\nConfiguring VPN connections to your Amazon VPC\n\nGetting ready\n\nHow to do it...\n\n4. Configuring Global Scale Infrastructure\n\nIntroduction\n\nCreating a VPC and subnet from the CLI\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nCreating a VPC to DC connectivity--VPN Tunneling\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nCreating a VPC with a private subnet and connecting DC\n\nGetting ready\n\nHow to do it...",
      "content_length": 879,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 20,
      "content": "Creating a multi-region VPC communication\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nSetting up a private DNS with a VPC\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nMigrating to IPv6\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\n5. Working with Infrastructure Automation\n\nIntroduction\n\nInfrastructure as a Service\n\nWhy do we need to automate?\n\nInfrastructure automation tools\n\nCreating, storing, and testing the template--CloudFormation\n\nGetting ready\n\nHow to do it...\n\nCreating the template\n\nVPC\n\nSubnet\n\nInternet Gateway\n\nElastic IP\n\nNat Gateway\n\nStoring the template\n\nTesting the JSON template\n\nThere's more...\n\nCreating a new stack--CloudFormation\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nModify the stack--CloudFormation\n\nGetting ready\n\nHow to do it...",
      "content_length": 783,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 21,
      "content": "Using change sets\n\nUsing direct update\n\nDeleting the stack--CloudFormation\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nSetting up Ansible\n\nGetting ready\n\nHow to do it...\n\nInstalling Ansible\n\nCreating Ansible playbooks for creating VPC\n\nHow to do it...\n\nThere's more...\n\n6. Working with Route 53\n\nIntroduction\n\nHow does Route 53 DNS works?\n\nSupported DNS resource record types\n\nAlias resource record\n\nRouting policies\n\nRegistering a new domain\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nTransferring a domain into Amazon Route 53\n\nGetting ready\n\nHow to do it...\n\nCreating hosted zones and record sets\n\nGetting ready\n\nHow to do it...\n\nDeleting a public hosted zone\n\nGetting ready\n\nHow to do it...\n\nCreating an Alias record set\n\nHow to do it...\n\nThere's more...\n\nCreating a private hosted zone",
      "content_length": 803,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 22,
      "content": "Getting ready\n\nHow to do it...\n\nThere's more...\n\nWorking with the weighted routing policy\n\nHow to do it...\n\nHow it works...\n\nWorking with the failover routing policy and health checks\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\n7. Cloud Security and Network Compliance\n\nIntroduction\n\nTypes of attack\n\nSetting up CloudFront--EC2 origin\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nSetting up CloudFront--S3 origin\n\nHow to do it...\n\nThere's more...\n\nGeographic restrictions with Amazon CloudFront\n\nHow to do it...\n\nHow it works...\n\nCustomizing error responses in CloudFront\n\nGetting ready\n\nHow to do it...\n\nHow it works...\n\nSetting up CloudWatch monitoring\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nSetting up ELB and Auto Scaling\n\nHow to do it...\n\nHow it works...\n\nTrusted Advisor",
      "content_length": 817,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 23,
      "content": "Getting ready\n\nHow to do it...\n\nHow it works...\n\nProtecting log information--sending logs to CloudWatch\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nStarting CloudTrail\n\nHow to do it...\n\nHow it works...\n\nThere's more...\n\nSubmitting a penetration testing request\n\nGetting ready\n\nHow to do it...\n\n8. Troubleshooting and VPC Limits\n\nIntroduction\n\nTroubleshooting IP address overlapping\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nErrors while connecting an EC2 instance in a VPC\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nInternet not accessible in the instance\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nInternet not accessible in the private subnet instance (NAT Gateway)\n\nHow to do it...\n\nNot able to delete a VPC\n\nGetting ready\n\nHow to do it...\n\nEnabling VPC flow logs\n\nGetting ready\n\nHow to do it...",
      "content_length": 826,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 24,
      "content": "There's more...\n\nIncreasing VPC Limits\n\nGetting ready\n\nHow to do it... 9. Pricing of VPC and Related Components\n\nIntroduction\n\nVPC, VPN and Nat Gateway pricing\n\nGetting ready\n\nHow to do it...\n\nThere's more...\n\nEC2, ELB and Elastic IP pricing\n\nGetting ready\n\nHow to do it...\n\nRoute 53 pricing\n\nGetting ready\n\nHow to do it...\n\nDirect Connect pricing\n\nGetting ready\n\nHow to do it...\n\nCloudFront pricing\n\nGetting ready\n\nHow to do it...\n\nWAF and Cloud Shield pricing\n\nGetting ready\n\nHow to do it...\n\nOceanofPDF.com",
      "content_length": 509,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 25,
      "content": "Preface\n\nThere is no debate on the fact that Cloud is going to be the default infrastructure provider as it provides numerous benefits. The most important aspects of cloud computing are as follows:\n\nMassive scale: This can virtually serve resources for all programming needs to anyone without the need to build a massive scale computing infrastructure On demand access: The resources can be provisioned by self-service instantly when required and released when not needed any more\n\nCloud computing is being used by organizations to do the following:\n\nIncrease agility of the organization through purchase provision deploy and manage applications, services dynamically and secure support in real time based on demand without managing compute, network and other resources Cut overall cost of ownership and upfront investment for resources and pay only for the resources being used Utilize software tools and services as per the requirement offered by cloud providers instead of purchasing and owning them Reduced time to market products and services due to reduced time cycle for accruing infrastructure resources to build and deploy them Increase in reliability and availability as cloud providers offer multiple data centers that can be used for disaster recovery options if some data center goes down\n\nThat's why organizations are thinking about cloud first approach for hosting their services in cloud. AWS is the most popular public cloud service. It's a challenge for architects and DevOps professionals for building infrastructure in AWS right the first time itself. This book will provide a practical and simple-to-follow approach for creating, managing, and automating AWS networking components. It will also provide insight's best",
      "content_length": 1738,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 26,
      "content": "use of different AWS networking services. We'll start simple so that it's easy for first timers. However, we'll dive deep into various AWS networking- related services that are expected out of a seasoned AWS professional.\n\nOceanofPDF.com",
      "content_length": 237,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 27,
      "content": "What this book covers\n\nChapter 1, Getting Started with AWS Networking Components, helps first timers to create AWS account and users. It guides readers for creating simple AWS networking components from Console and creating first EC2 instance in AWS. It also guides to configure AWS CLI.\n\nChapter 2, Building Your Own Custom VPC, walks through all the necessary steps to different network components in AWS. It guides how to build subnetworks, firewalls, and routing in AWS. It also provides a recipe for creating and connecting to your instance hosted in AWS.\n\nChapter 3, VPC Advanced Components, provides advanced recipes for adding multiple network interfaces to EC2, connecting to Windows and Linux instance. Then it guides to create high available solutions through horizontal scaling using load balancer and launch configuration. It also provides a recipe for connecting multiple VPCs in a region.\n\nChapter 4, Configuring Global Scale Infrastructure, focuses on creating global scale network infrastructure by connecting VPCs across AWS regions or creating a communication channel between VPC and the corporate data center. It also provides a recipe for creating network components from CLI and how to make AWS resources IPv6 compliant.\n\nChapter 5, Working with Infrastructure Automation, provides flexibility to automate network resources such as VPC, subnet, and NAT gateway using Cloudformation and Ansible. Don’t worry, this chapter also explains how to set up Cloudformation and Ansible and related playbooks. There are various sample playbooks for you to play with.\n\nChapter 6, Working with Route 53, gives an overall understanding of how DNS works and the different routing policies. This recipe will guide you from buying a domain to creating a highly available DNS routing. This",
      "content_length": 1793,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 28,
      "content": "chapter also covers setting up private DNS and monitoring the DNS resources.\n\nChapter 7, Cloud Security and Network Compliance, turns your attention to security. This chapter will help you understand how to prevent and mitigate various attacks such as DDOS and Port scanning using different AWS services (CloudFront, Elastic Load Balancer, Auto Scaling Group, CloudWatch, Trusted Advisor, and CloudTrail)\n\nChapter 8, Troubleshooting and VPC Limits, concentrates various troubleshooting and support issues. It covers most common error messages and configuration problems. The chapter also includes information on how and where you can get support to increase the VPC resource limits\n\nChapter 9, Pricing of VPC and Related Components, guides you to calculate pricing of the infrastructure that you are going to build in AWS.\n\nOceanofPDF.com",
      "content_length": 838,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 29,
      "content": "What you need for this book\n\nThis book assumes basic-level knowledge on Linux operating system and cloud computing. The book will go through building different networking components in AWS, which may require a basic understanding of networking and virtualization concepts. If you have an experience of networking concepts, this is a big plus.\n\nMost of the recipes provided in the book for networking components are provided by AWS and require AWS console access. For this you need moderate network connectivity to the internet. Some of the recipes that are executed on the local system are also very lightweight and can be executed on any laptop or desktop with decent configuration. Sample hardware or virtual requirements are listed as follows:\n\nCPU: 4 cores Memory: 8 GB RAM Disk space: 80 GB\n\nIn this book, you will need the following software list:\n\nAWS Tools—AWS CLI Putty and puttygen Internet Browser Ansible Python 2.7+ Pip EPEL Repo Curl / wget\n\nOceanofPDF.com",
      "content_length": 970,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 30,
      "content": "Who this book is for\n\nTo make use of the content of this book, basic prior knowledge of Cloud and networking is expected. If you do not possess that knowledge, it is always possible to catch up the basic requirements by going through the major components from the AWS documentation at https://aws.amazon.com/docum entation/. This covers all the AWS services used in this book and much more. This book is essentially intended to AWS developers, architects, network professionals and DevOps engineers who want a quick start for creating basic infrastructure in the AWS cloud. It will also provide you the steps for creating a global scale production-ready infrastructure using AWS console and Automation tools (CloudFormation and Ansible).\n\nOceanofPDF.com",
      "content_length": 753,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 31,
      "content": "Sections\n\nIn this book, you will find several headings that appear frequently (Getting ready, How to do it…, How it works…, There's more…, and See also). To give clear instructions on how to complete a recipe, we use these sections as follows:\n\nOceanofPDF.com",
      "content_length": 259,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 32,
      "content": "Getting ready\n\nThis section tells you what to expect in the recipe, and describes how to set up any software or any preliminary settings required for the recipe.\n\nOceanofPDF.com",
      "content_length": 177,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 33,
      "content": "How to do it…\n\nThis section contains the steps required to follow the recipe.\n\nOceanofPDF.com",
      "content_length": 93,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 34,
      "content": "How it works…\n\nThis section usually consists of a detailed explanation of what happened in the previous section.\n\nOceanofPDF.com",
      "content_length": 128,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 35,
      "content": "There's more…\n\nThis section consists of additional information about the recipe in order to make the reader more knowledgeable about the recipe.\n\nOceanofPDF.com",
      "content_length": 160,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 36,
      "content": "See also\n\nThis section provides helpful links to other useful information for the recipe.\n\nOceanofPDF.com",
      "content_length": 105,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 37,
      "content": "Conventions\n\nIn this book, you will find a number of text styles that distinguish between different kinds of information. Here are some examples of these styles and an explanation of their meaning.\n\nCode words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles are shown as follows: \"Add 0.0.0.0/0 in the destination.\"\n\nA block of code is set as follows:\n\n#!/bin/bash yum update -y yum install -y httpd24 php56 mysql55-server php56-mysqlnd service httpd start chkconfig httpd on groupadd\n\nWhen we wish to draw your attention to a particular part of a code block, the relevant lines or items are set in bold:\n\n[root@ansible playbook]# vim awsvpc.yml --- - name: Create VPC hosts: localhost gather_facts: no roles: - vpc\n\nAny command-line input or output is written as follows:\n\nmysql -u root -p\n\nNew terms and important words are shown in bold. Words that you see on the screen, for example, in menus or dialog boxes, appear in the text like this: \"Click on the button Create an AWS Account. \"\n\nWarnings or important notes appear like this.",
      "content_length": 1116,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 38,
      "content": "Tips and tricks appear like this.\n\nOceanofPDF.com",
      "content_length": 49,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 39,
      "content": "Reader feedback\n\nFeedback from our readers is always welcome. Let us know what you think about this book-what you liked or disliked. Reader feedback is important for us as it helps us develop titles that you will really get the most out of. To send us general feedback, simply e-mail feedback@packtpub.com, and mention the book's title in the subject of your message. If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, see our author guide at www.packtpub.com/authors.\n\nOceanofPDF.com",
      "content_length": 548,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 40,
      "content": "Customer support\n\nNow that you are the proud owner of a Packt book, we have a number of things to help you to get the most from your purchase.\n\nOceanofPDF.com",
      "content_length": 158,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 41,
      "content": "Downloading the example code\n\nYou can download the example code files for this book from your account at http://www.packtpub.com. If you purchased this book elsewhere, you can visit h ttp://www.packtpub.com/support, and register to have the files e-mailed directly to you. You can download the code files by following these steps:\n\n1. Log in or register to our website using your e-mail address and password.\n\n2. Hover the mouse pointer on the SUPPORT tab at the top. 3. Click on Code Downloads & Errata. 4. Enter the name of the book in the Search box. 5. Select the book for which you're looking to download the code files. 6. Choose from the drop-down menu where you purchased this book from.\n\n7. Click on Code Download.\n\nYou can also download the code files by clicking on the Code Files button on the book's webpage at the Packt Publishing website. This page can be accessed by entering the book's name in the Search box. Please note that you need to be logged in to your Packt account. Once the file is downloaded, please make sure that you unzip or extract the folder using the latest version of:\n\nWinRAR / 7-Zip for Windows Zipeg / iZip / UnRarX for Mac 7-Zip / PeaZip for Linux\n\nThe code bundle for the book is also hosted on GitHub at https://github.com/Packt Publishing/AWS-Networking-Cookbook. We also have other code bundles from our rich catalog of books and videos available at https://github.com/PacktPublishing/. Check them out!\n\nOceanofPDF.com",
      "content_length": 1461,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 42,
      "content": "Downloading the color images of this book\n\nWe also provide you with a PDF file that has color images of the screenshots/diagrams used in this book. The color images will help you better understand the changes in the output. You can download this file from https://www.packtpub.com/sites/default/files/downloads/AWSNetworkingCookbook_ColorIm ages.pdf.\n\nOceanofPDF.com",
      "content_length": 366,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 43,
      "content": "Errata\n\nAlthough we have taken every care to ensure the accuracy of our content, mistakes do happen. If you find a mistake in one of our books-maybe a mistake in the text or the code-we would be grateful if you could report this to us. By doing so, you can save other readers from frustration and help us improve subsequent versions of this book. If you find any errata, please report them by visiting http://www.packtpub.com/submit-errata, selecting your book, clicking on the Errata Submission Form link, and entering the details of your errata. Once your errata are verified, your submission will be accepted and the errata will be uploaded to our website or added to any list of existing errata under the Errata section of that title. To view the previously submitted errata, go to https://www.packtpub.com/books/content/support, and enter the name of the book in the search field. The required information will appear under the Errata section.\n\nOceanofPDF.com",
      "content_length": 964,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 44,
      "content": "Piracy\n\nPiracy of copyrighted material on the Internet is an ongoing problem across all media. At Packt, we take the protection of our copyright and licenses very seriously. If you come across any illegal copies of our works in any form on the Internet, please provide us with the location address or website name immediately so that we can pursue a remedy. Please contact us at copyright@packtpub.com with a link to the suspected pirated material. We appreciate your help in protecting our authors and our ability to bring you valuable content.\n\nOceanofPDF.com",
      "content_length": 561,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 45,
      "content": "Questions\n\nIf you have a problem with any aspect of this book, you can contact us at questions@packtpub.com, and we will do our best to address the problem.\n\nOceanofPDF.com",
      "content_length": 172,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 46,
      "content": "Getting Started with AWS Networking Components\n\nIn this chapter, we'll cover the following recipes:\n\nCreating an account in AWS Creating an admin user in AWS Creating a VPC and a subnet with IPv6 Creating an EC2 with an IPv6 address Creating NAT on EC2 instance Working with network interfaces Configuring AWS CLI\n\nOceanofPDF.com",
      "content_length": 329,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 47,
      "content": "Introduction\n\nPublic cloud computing is a service that can be accessed over the internet. It provides resources, on a shared basis, for hosting applications and data on distributed computing resources. Cloud providers host a pool of services for computer servers, storages, networks, application platforms and software services that are assigned to customers based on their needs. Cloud providers take responsibility of managing computing resources so that customers can concentrate on building applications or services quickly. AWS is the biggest public cloud service provider.\n\nAWS provides most of the networking services that we are going to explore for free. It also lets customers experiment with some of the other services for free at a lower scale. We need to have an account and the required permissions in AWS to execute the recipes provided throughout this book. Creating some of the services may cost some money, so please look into the AWS pricing page (https://aws.amazon.com/pricing/services/) for different services and understand the cost impact that execution of some recipes will have.\n\nOceanofPDF.com",
      "content_length": 1120,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 48,
      "content": "Various AWS network services\n\nIn this section, we shall come to understand the building blocks of AWS Cloud. We are going to use or create the following components through this book.\n\nRegion: AWS Cloud currently has data centers in 16 cities and is also coming up in new locations throughout the world. Each region is completely isolated from the others. You need to choose one region to create network components. Availability Zone (AZ): Each region of AWS Cloud has multiple physically isolated and separate data centers called availability zone. Some network components span across multiple AZs in a region like VPC. Components like subnet are confined within an AZ. AWS provides various networking services as Platform as a Service (PaaS). Examples are:\n\nRoute 53: Distributed, scalable and highly available Domain Name System (DNS) Direct connect: This provides a dedicated low latency and high bandwidth network connectivity between a data center and an AWS VPC. ELB: This is a high availablility and scalable load balancing service provided by AWS. AWS VPC: VPC is a virtual network built in the AWS Cloud similar to a network in a data center. It is isolated from other VPCs that are created in your account or other accounts. You can choose the Classless Inter-Domain Routing (CIDR) range of the VPC and can create instances with the IP address within that range. Virtual Routing and Forwarding (VRF) in conventional networking is equivalent to a VPC in AWS, whereas VLAN is synonymous to a subnet. You can isolate instances in separate VLANs or subnets.",
      "content_length": 1563,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 49,
      "content": "The following figure gives the default VPC components which include Internet gateway, Virtual private gateway, Router, Route table, Subnet, Network ACL and Security group.\n\nAWS VPC high level components\n\nSource: http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/images/security-diagram.png\n\nOceanofPDF.com",
      "content_length": 309,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 50,
      "content": "Creating an account in AWS\n\nWe are going to create an AWS account in this section. Please skip this section if you already have an AWS account. Otherwise, please follow the step by step process to create an account with AWS.\n\nOceanofPDF.com",
      "content_length": 240,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 51,
      "content": "Getting ready\n\nBe ready with your credit card information.\n\nOceanofPDF.com",
      "content_length": 74,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 52,
      "content": "How to do it...\n\n1. Please open the URL https://aws.amazon.com/account/ in your favorite browser. 2. Click on the button Create an AWS Account. 3. You will see a page which looks like the following figure. Provide your email or mobile number, select the option I am a new user and click on Sign in using our secure server. The email ID provided here will be treated as the owner or root user for this account and has exclusive rights to do anything in the account.\n\nCreate account--Provide mail or mobile\n\n4. You will get a page like this. Provide the required details and click on Create account.",
      "content_length": 597,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 53,
      "content": "Create account--Provide personal details\n\n5. Provide additional details for your account.",
      "content_length": 89,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 54,
      "content": "Create account--Provide contact information\n\n6. Provide payment information for billing purposes.",
      "content_length": 97,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 55,
      "content": "Create account--Provide payment information\n\n7. Provide identity verification. There will be an automated call initiated by AWS to your phone number and you will need to key in the verification code shown on the screen.",
      "content_length": 219,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 56,
      "content": "Create account--provide identity verification\n\n8. Choose Support Plan and click on Continue.",
      "content_length": 92,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 57,
      "content": "Create account--Choose support plan\n\n9. You will see a welcome screen and can log in to the AWS console by clicking on Sign In to the Console. You'll also receive an email confirmation for the account creation.",
      "content_length": 210,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 58,
      "content": "Create account--Registration confirmation\n\n10. After login, you will see a screen like the following:\n\nAWS dashboard\n\nOceanofPDF.com",
      "content_length": 132,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 59,
      "content": "There's more...\n\nOnce you decide to delete your account, you can do so by logging in to your account; see the following figure:\n\nDelete account\n\nOceanofPDF.com",
      "content_length": 159,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 60,
      "content": "Creating an admin user in AWS\n\nOnce the account is created, we should not use it for anything apart from creating an admin user and handling billing related information. A strong password policy and multi-factor authentication (MFA) should be configured for all powerful users. We shall go through the steps to create an admin user. We shall use this user credential for executing recipes for different network elements in AWS. More stringent processes and methods should be followed for creating and managing users in AWS for production purposes.\n\nOceanofPDF.com",
      "content_length": 563,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 61,
      "content": "Getting ready\n\nLog in to the AWS account with user credentials.\n\nOceanofPDF.com",
      "content_length": 79,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 62,
      "content": "How to do it...\n\n1. Select Identity and Access Management (IAM) service from the console by typing https://console.aws.amazon.com/iam/ in the browser. You will see the URL that the user other than the root user will need to use for console access.\n\nURL for AWS console login URL\n\n2. Click on Users in the left menu and then click on Add user.\n\nUser dashboard\n\n3. Provide a username of your choice. Opt for both programmatic and console access. Select other relevant options and click on Next: Permission.",
      "content_length": 504,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 63,
      "content": "Add user in IAM\n\n4. Choose the option Attach existing policies directly. Choose AdministratorAccess and then click Next: Review.\n\nChoose permission\n\n5. Review the details and click on Create User.\n\nReview create user\n\n6. Download and store the .csv file in a safe place. The file contains user access key details and console login link. User access information is required for AWS service access through program or CLI. It will be used in the later part of the book.\n\nUser access key details",
      "content_length": 491,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 64,
      "content": "OceanofPDF.com",
      "content_length": 14,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 65,
      "content": "There's more...\n\nThe user access details can be used for accessing AWS from Command Line Interface (CLI). Scripts can be written using CLI and can be used as code for managing AWS infrastructure.\n\nOceanofPDF.com",
      "content_length": 211,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 66,
      "content": "Creating a VPC and a subnet with IPv6\n\nIn this section, we shall be creating a VPC and a subnet using wizard to get started quickly.\n\nOceanofPDF.com",
      "content_length": 148,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 67,
      "content": "Getting ready\n\nWe need an AWS account and a user with the proper permissions for creating a VPC and a subnet.\n\nOceanofPDF.com",
      "content_length": 125,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 68,
      "content": "How to do it...\n\n1. Log in to your AWS account. Select VPC in AWS services as shown in the following figure:\n\nSelect VPC from AWS console\n\n2. Click on Start VPC Wizard.\n\nVPC dashboard\n\n3. VPC wizard will appear with four options. Now, we shall choose the first one to create our first VPC and subnet. Click on the Select button.\n\nVPC Wizard",
      "content_length": 340,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 69,
      "content": "4. We need to choose Amazon provided IPv6 CIDR block to enable IPv6 for VPC. For a subnet in a drop-down menu Public subnet's IPv6 CIDR: we need to select Specify a custom IPv6 CIDR. Key in the VPC and subnet names. Keep other options unchanged. Click on th Create VPC button.\n\nCreate VPC and subnet with IPv6\n\n5. A success message will be displayed as following:\n\nVPC and subnet creation success message\n\n6. Click on Your VPCs in the left menu. The VPC will be displayed. If you choose to see details, you can see that a Network ACL and Route table has been automatically created.",
      "content_length": 581,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 70,
      "content": "Summary of VPC created\n\n7. Click on Subnets on the left menu bar. You will be able to see the subnet that was just created. If you choose to see details, you can see that a Network ACL and Route table that is automatically created.\n\nSummary of subnet created\n\n8. Click on the Route Table tab. You can see that the Route Table includes four entries. Two for internal IPv4 and IPv6 communication and two internet gateways (starting with igw) for communication with the outside world for IPv4 and IPv6.",
      "content_length": 499,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 71,
      "content": "Route Table of subnet created\n\n9. Click on the Network ACL tab. You can see that all traffic for both IPv4 and IPv6 has been allowed. We shall learn how to configure the rules in the later section of the book.\n\nNetwork ACL of subnet created\n\nOceanofPDF.com",
      "content_length": 256,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 72,
      "content": "Creating an EC2 with an IPv6 address\n\nIn this section, we shall be creating an EC2 instance with an IPv6 address in the VPC and subnet that we created using the wizard. EC2 is a virtual machine in AWS that comes as an IaaS offering. You can choose different virtual machine images called Amazon Machine Image (AMI) or create your own custom AMI for creating an EC2 instance. We shall also install a web server to test if our steps are correct.\n\nOceanofPDF.com",
      "content_length": 459,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 73,
      "content": "Getting ready\n\nWe need an AWS account and user with proper permissions for creating an EC2 instance.\n\nOceanofPDF.com",
      "content_length": 116,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 74,
      "content": "How to do it...\n\n1. Log in to your AWS account. Select EC2 services as shown in the following figure:\n\nSelect EC2 service\n\n2. The EC2 dashboard will appear. Click on Launch Instance in the EC2 dashboard.\n\nEC2 dashboard\n\n3. Select Amazon Linux AMI, which is available on the top of the list",
      "content_length": 289,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 75,
      "content": "Choose AMI\n\n4. There are many instance types available with different vCPU and memory options. We shall choose t2.micro and then click on Next: Configure Instance Details.\n\nChoose instance type\n\n5. In Network, choose the VPC we just created. In Subnet, select the subnet we created. In Auto-assign Public IP, choose Enable. In Auto- assign IPv6 IP, choose Enable. Click on Next: Add Storage.",
      "content_length": 391,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 76,
      "content": "Choose network\n\n6. Click on the Advanced Details and put the following lines in the text box. This is user data. This may vary with the OS of EC2. The script is executed when the instance is first created. Here is a script that can execute on Linux. It will install Apache, PHP, and MySQL in the server. It will also start the Apache server once the EC2 is running.\n\n#!/bin/bash yum update -y yum install -y httpd24 php56 mysql55-server php56-mysqlnd service httpd start chkconfig httpd on groupadd www usermod -a -G www ec2-user chown -R root:www /var/www chmod 2775 /var/www find /var/www -type d -exec chmod 2775 {} + find /var/www -type f -exec chmod 0664 {} + echo \"<?php phpinfo(); ?>\" > /var/www/html/phpinfo.php\n\n7. Accept the default option and click Next: Add Tags.",
      "content_length": 775,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 77,
      "content": "Add Storage\n\n8. Click on Add Tags. In Key, put Name and in Value, put MyFirstEC2. Click on Next: Configure Security Group.\n\nAdd Tags\n\n9. Provide a Security group name and Description. By default, SSH is open to all IP addresses. In Source, we have two CIDR ranges, 0.0.0.0/0 to allow all IPv4 addresses and ::/0 to allow all IPv6 addresses. Click on Add Rule and allow HTTP traffic to all source. We should not be opening our servers to all like this, however for simplicity, let's do this for now. Click on Review and Launch.",
      "content_length": 526,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 78,
      "content": "Configure Security Group\n\n10. Review the details and click Launch.\n\nReview instance launch\n\n11. We can optionally create a key pair. Key information is required if we want to log into EC2. Download Key Pair and store it in a safe place. Click on Launch Instances.",
      "content_length": 263,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 79,
      "content": "Create Key Pair\n\n12. You can see a success message with the EC2 instance ID. Click on the ID. It will take us to the EC2 console. The instance will be in running condition in some time.\n\nEC2 launch status\n\n13. We can see both Public DNS (IPv4) and IPv6 IPs. We can create URL to access page running on EC2: http:// DNS(IPv4)/phpinfo.php. Replace the DNS (IPv4) in the URL with the one you see in the console. Open a browser and paste the URL.",
      "content_length": 442,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 80,
      "content": "EC2 instance detail\n\n14. We can see the page of the server we created on the EC2 instance.\n\nSample web page on EC2\n\nOceanofPDF.com",
      "content_length": 130,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 81,
      "content": "How it works...\n\nWe have seen that the Network ACL with VPC and subnet allows all traffic. In the security group of the instance, we have opened HTTP protocol on port 80 for all incoming traffic. Internet Gateway is attached to the subnet in which we created the instance. During instance creation we have installed Apache, PHP and MySQL to host a website with page phpinfo.php. As we have enabled IPv4 and IPv6 in VPC, subnet and EC2, the EC2 instance has assigned those. So, after EC2 creation, we can access the website using the URL. The DNS name is resolved by AWS Route 53.\n\nOceanofPDF.com",
      "content_length": 595,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 82,
      "content": "Creating NAT on EC2 instance\n\nIn this recipe, you'll learn how to create a NAT instance on EC2 instances created in a public subnet. The private subnet does not have any Internet Gateway attached to it, so EC2 on private subnet cannot directly communicate with the outside world.\n\nOceanofPDF.com",
      "content_length": 295,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 83,
      "content": "Getting ready\n\nWe need an AWS account and user with proper permissions for creating a NAT instance on EC2. Create an EC2 in the same way as the previous recipe. The only difference is, you don't put any Advanced Details in the Choose Network page. In the security group page, create NATSG security group and attach the same with instance with the following rules. We are allowing all traffic for simplicity. However, you should only put the required CIDR ranges.\n\nNATSG: Rules\n\nInbound\n\nType\n\nProtocol Port range Source\n\nHTTP\n\nTCP\n\n80\n\n0.0.0.0/0 and ::/0\n\nHTTPS\n\nTCP\n\n443\n\n0.0.0.0/0 and ::/0\n\nSSL\n\nTCP\n\n22\n\n0.0.0.0/0 and ::/0\n\nOutbound\n\nDestination Protocol Port range Comments",
      "content_length": 677,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 84,
      "content": "All traffic\n\nTCP\n\nALL\n\n0.0.0.0/0 and ::/0\n\nYou can use the same key pair created before for this instance as well. In the Add tag page, put Nat Instance in value for Name and Key. We also need to create an Elastic IP for attaching it to a NAT instance. This we shall show in the recipe.\n\nOceanofPDF.com",
      "content_length": 302,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 85,
      "content": "How to do it...\n\n1. I have created one more EC2 instance as visible in the Instances section of the EC2 console.\n\nEC2 created for NAT\n\n2. Click on Elastic IPs in the left menu bar.\n\nElastic IP dashboard\n\n3. Click on Allocate new address.\n\nElastic IP creation page",
      "content_length": 263,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 86,
      "content": "4. Click on Allocate.\n\nElastic IP creation success message\n\n5. Click on Close. The Elastic IP page will be visible. Choose Elastic IP and click on Actions | Associate address.\n\nElastic IP Action menu\n\n6. Choose Instance in the Resource type. Select Nat Instance from the Instance drop-down menu. Click on Associate. A success message is shown.\n\nElastic IP association with EC2 instance",
      "content_length": 385,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 87,
      "content": "7. Go to the Instances menu. You can see that the public DNS and IPv4 public IP has changed. You can see Change Source/Dest. Check is true for the instance.\n\nEC2 instance with Elastic IP\n\n8. Select Actions | Networking | Change Source/Dest. Check.\n\nChanging Source/Dest Check for NAT instance\n\n9. You can see that Change Source/Dest. Check is now false.",
      "content_length": 353,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 88,
      "content": "NAT instance details\n\n10. We need to update the main Route Table attached to the VPC. Let's go back to the VPC dashboard and select our VPC.\n\nVPC dashboard\n\n11. Click on the Route Tables starting with rtb.",
      "content_length": 205,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 89,
      "content": "Main Route Table\n\n12. Select the Route Table and navigate to the Routes tab. Click on the Edit button. Add 0.0.0.0/0 in the destination and the NAT instance ID in Target. Click Save.\n\nAttach NAT in main Route Table\n\nOceanofPDF.com",
      "content_length": 230,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 90,
      "content": "How it works...\n\nBy default, EC2 instance can either be a source or destination for network traffic request or response. However, NAT instances need to forward requests to the internet that were originated from a private subnet and return the response back to them. That's why we need to disable the source destination check for NAT instance.\n\nOceanofPDF.com",
      "content_length": 358,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 91,
      "content": "There's more...\n\nNAT instance does not support IPv6. To support NAT for IPv6 we need to create an Egress-Only Internet Gateway from the VPC console and attach it to main Route Table.\n\nOceanofPDF.com",
      "content_length": 198,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 92,
      "content": "Working with network interfaces\n\nElastic Network Interface (ENI) in AWS is a network interface that can be attached to an EC2 instance. Based on its capacity, one EC2 instance can have number of ENIs attached to it. Each ENI comes with its own MAC and IP addresses. You can't move the ENI to another subnet after it is created. You can attach an ENI to an EC2 in the same AZ.\n\nOceanofPDF.com",
      "content_length": 391,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 93,
      "content": "Getting ready\n\nWe need an AWS account and user with proper permissions for creating an ENI.\n\nOceanofPDF.com",
      "content_length": 107,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 94,
      "content": "How to do it...\n\nHere are the steps to follow:\n\n1. Log in to the AWS account and browse to https://console.aws.amazon.com/ec2/. In the left navigation menu, choose Network Interfaces.\n\nNetwork Interface Dashboard\n\n2. Click on Create Network Interface.",
      "content_length": 251,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 95,
      "content": "Network Interface Creation Details\n\n3. In Description, provide the name. In Subnet, choose subnet where the NIC needs to be created. Leave IPv4 Private IP and IPv6 IP; they will be created as per CIDR range of subnet. Select Security Group. Otherwise, you can mention the IP address from the CIDR range. Click on Yes, Create.\n\nNetwork Interface Detail\n\n4. You can see that only one network interface is created. However, its status is available as it is not attached to any instance. Click on the Attach button.\n\nNetwork Interface Creation\n\n5. Choose the EC2 Instance ID with which you want to attach it. Click Attach.",
      "content_length": 618,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 96,
      "content": "Network Interface attached\n\n6. You can see that the interface is in use. You can Detach it and attach it to some other instance. From the Action menu you can manage the ENI. Click on Instance ID.\n\nEC2 with two Network Interface\n\n7. You can see two private IPs and two network interfaces eth0 and eth1.\n\nOceanofPDF.com",
      "content_length": 317,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 97,
      "content": "Configuring AWS CLI\n\nThe AWS CLI is a collection of tools for managing AWS services from the command-line. We can create the script using CLI to automate AWS resource management. AWS CLI can be installed with an installer (Windows) or by using a pip or a package manager for Python.\n\nOceanofPDF.com",
      "content_length": 298,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 98,
      "content": "Getting ready\n\nKeep the user access key details handy that we created in the earlier section.\n\nOceanofPDF.com",
      "content_length": 109,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 99,
      "content": "How to do it...\n\nHere are the steps to follow:\n\nInstallation for Windows:\n\nDownload the installer compatible with your system:\n\nWindows 64-bit: https://s3.amazonaws.com/aws-cli/AWSCLI64.msi Windows 32-bit: https://s3.amazonaws.com/aws-cli/AWSCLI32.msi\n\nRun the installer and follow the instructions that appear\n\nInstallation for Linux, macOS, or Unix:\n\nYou should have a working version of Python 2.6.5+ or 3.5+ in your system. Otherwise, install python in your system first. Check your Python installation:\n\n$ python --version\n\nFollow the given steps to install AWS CLI using bundled installer:\n\nDownload the AWS CLI bundled installer. For Linux flavor the command is as follows:\n\n$ cURL \"https://s3.amazonaws.com/aws-cli/aws-cli-bundle.zip\" - \"awscli- bundle.zip\"\n\nThe package need to be unzipped. For Linux flavor the command is as following:\n\n$sudo ./awscli-bundle/install –i /usr/local/aws -b /usr/local/bin/aws\n\nConfiguration:\n\nType aws configure in command prompt or shell depending on your machine operating system. It will ask for the required details. Provide AWS Access Key ID and AWS Secret Access Key that were generated while creating an admin user. You can mention us-east-1 as the default region or choose any other region from the list given in the",
      "content_length": 1265,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 100,
      "content": "screenshot following and JSON as Default output format. Don't worry if you don't understand region for now. We shall take a detailed look at in the following section.\n\nConfigure AWS CLI\n\nYou are all set for creating, modifying and managing networking components through API/CLI call in AWS depending on AWS privilege that your user have.\n\nOceanofPDF.com",
      "content_length": 353,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 101,
      "content": "Building Your Own Custom VPC\n\nIn this chapter, we'll cover the following recipes:\n\nManaging a VPC Managing public and private subnets Managing a Network ACL Managing a Security Group Managing an Internet Gateway Managing a NAT Gateway Managing a Route Table Managing EC2 instances\n\nOceanofPDF.com",
      "content_length": 296,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 102,
      "content": "Introduction\n\nAWS provides a very user friendly interface for managing all of its services. This enables users to create services at the click of a button as and when required and delete them when they are not necessary. We shall go through recipes for creating the most used network components that we have to use, in case we host our application in AWS. Also, we shall learn how to create instances in the network that we built.\n\nOceanofPDF.com",
      "content_length": 446,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 103,
      "content": "Managing a VPC\n\nAWS VPC is a virtual network in AWS cloud that is similar to the conventional network in a corporate data center. A VPC created in an account isolates all resources in it from any other VPC created by the same or other accounts.\n\nOceanofPDF.com",
      "content_length": 260,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 104,
      "content": "Getting ready\n\nWe need an AWS account and a user with proper permissions for creating a VPC.\n\nOceanofPDF.com",
      "content_length": 108,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 105,
      "content": "How to do it...\n\n1. Log in to your AWS account. AWS provides a default VPC in each region where the account has been created, with all the components listed above in each Availability Zone (AZ) in that region. After logging in to the account, select VPC in AWS services:\n\nSelect VPC from AWS console\n\n2. The VPC dashboard will appear. It is the place in the AWS console where you can manage all of the VPC and its related components. You need to select a different region from the top left menu option to see the VPCs and their related components for that region:\n\nVPC dashboard\n\n3. Click on Your VPCs in the VPC dashboard, the left menu option. We can see that the column Default VPC is Yes. This VPC has all",
      "content_length": 709,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 106,
      "content": "components to host services in the cloud. This has been created to help new users create required resources in the VPC without understanding the complexity and relationship between different networking components in the VPC and without creating any of them:\n\nDefault VPC\n\n4. Click on Create VPC. Put the VPC name tag and CIDR range. If you need IPv6 support for components, select Amazon provided IPv6 CIDR block. Don't change the other options and click on Yes, Create:\n\nCreating VPC from console\n\n5. A VPC is created with the given details. Please take note of the VPC ID. As we can see, a Route Table and Network ACL have also been created and associated with the VPC:",
      "content_length": 671,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 107,
      "content": "VPC dashboard with user created VPC from console\n\n6. We can select a VPC and from the action menu, we can edit details or delete a VPC, as shown in the screenshot following:\n\nModifying VPC details\n\nOceanofPDF.com",
      "content_length": 212,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 108,
      "content": "How it works...\n\nThe CIDR range decides the internal IPs of the EC2 instances created in the VPC. By default, the instances inside the same VPCs communicate with the internal IP. The number of instances that you can create is based on the CIDR range that you choose. If you want to communicate with an other network/VPC through a private network, the CIDR range of that network must be different.\n\nOceanofPDF.com",
      "content_length": 412,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 109,
      "content": "There's more...\n\nBy default, the same hardware hosts EC2 instances for multiple customers. If you need dedicated hardware for your instances, you should choose Tenancy as Dedicated during VPC creation. However, dedicated instances cost more.\n\nOceanofPDF.com",
      "content_length": 257,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 110,
      "content": "Managing public and private subnets\n\nSubnets of AWS are similar to VLAN in DC with a specific range of IPs isolated from an other VLAN/subnet. Each AZ in a region can host multiple subnets, as per the requirement. A subnet is bound by one AZ limit and can't span across multiple AZs. There are two types of subnets; instances created in a public subnet are assigned a public IP and can be accessed from outside the VPC. There is another type of subnet that is called the private subnet. Public IP is not assigned to instance created inside this type of subnet. A default VPC has default subnets associated with it; all default subnets are public subnets.\n\nOceanofPDF.com",
      "content_length": 670,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 111,
      "content": "Getting ready\n\nWe need an AWS account and a user with proper permissions for creating a subnet.\n\nOceanofPDF.com",
      "content_length": 111,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 112,
      "content": "How to do it...\n\n1. Click on Subnets in VPC Dashboard. You can see that one default subnet is created in each AZ available in that region associated with the default VPC:\n\nDefault subnet\n\n2. Click on Create Subnet link. Put the Name tag, select the VPC, CIDR range and Availability Zone. Click on Yes, Create:\n\nCreate subnet from console",
      "content_length": 337,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 113,
      "content": "3. A subnet is created with the Route Table and the Network ACL. We can select a subnet and, from the Subnet Actions menu, delete a subnet or modify other settings:\n\nDashboard with newly created subnet\n\n4. Click on the Route Table tab. You can see two entries, one for local VPC communication and the other for external communication through the Internet Gateway (starting with igw). The Internet Gateway enables resources hosted in AWS to communicate with the outside world. As the subnet is capable of communication with the external world through an Internet Gateway, it is a public subnet:\n\nRoute Table of subnet\n\n5. Click on Edit, so we can change the Route Table. If we associate a subnet with the Route Table that does not have an IGW attached to it, the subnet will act as a private subnet because the external world cannot",
      "content_length": 831,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 114,
      "content": "connect through it. In the later section, we'll see how to create a route table.\n\n6. You can delete a subnet by choosing the Delete option from the Subnet Actions menu.\n\nOceanofPDF.com",
      "content_length": 184,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 115,
      "content": "There's more...\n\nThe CIDR range of a subnet determines the number of instances that can be created in a subnet and the internal IP range of the instances. The CIDR range of subnet should be a subset of the VPC CIDR range. Two subnets in a VPC can't have overlapping CIDR ranges.\n\nOceanofPDF.com",
      "content_length": 294,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 116,
      "content": "Managing a Network ACL\n\nAn AWS Network Access Control List (NACL) works as a firewall at the VPC level for controlling incoming and outgoing requests from one or more subnets associated with that VPC. It is used in conjunction with the Security Group (SG) in controlling traffic to the AWS. When we create a VPC, a default NACL is created that is open to every IP and port. The subnet is associated with the default NACL created during its creation. We can create a custom NACL and associate it with a subnet, thus replacing the default NACL.\n\nOceanofPDF.com",
      "content_length": 558,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 117,
      "content": "Getting ready\n\nWe need an AWS account and a user with proper permissions to create a security group. We also need to configure the AWS CLI in our local machine. We also need a VPC creation in the region where we are going to create the components. We have already created those in Chapter 1, Getting Started with AWS Networking Components.\n\nOceanofPDF.com",
      "content_length": 355,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 118,
      "content": "How to do it...\n\n1. Log in to your AWS account and open the VPC Dashboard.\n\nVPC Dashboard\n\n2. Click on Network ACLs from the left menu bar under\n\nthe Security menu. Default NACLs created with a default VPC and other VPCs that we created in Chapter 1, Getting Started with AWS Networking Components, appear on the screen. If you click on Inbound Rules and Outbound Rules, you will see that there is a rule number 100 which allows all traffic with all protocols from all ports. So effectively, the firewall is all open and traffic from any source, protocol, and port can connect to resources in this NACL. In the Subnet Associations tab, you can see that both subnets in the VPC are associated with NACL:",
      "content_length": 702,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 119,
      "content": "Default NACL\n\n3. Click on Create Network ACL for creating a new NACL. Provide the Name tag and select the VPC for which you want to create an NACL. Click on Yes, Create:\n\nNetwork ACL creation from console\n\n4. You can see that the Default column is No for the NACL that we just created. Click on Inbound Rules or Outbound Rules:",
      "content_length": 327,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 120,
      "content": "User created NACL\n\n5. Click on the Edit button in the Inbound Rules tab. Click on Add another rule. You can add multiple rules. Here I am allowing all traffic for simplicity. Click on the Save button:\n\nAdd inbound rules to NACL\n\n6. Click on the Edit button in the Outbound Rules tab. Click on Add another rule. You can add multiple rules. Here I am allowing all traffic for simplicity. Click on the Save button:",
      "content_length": 411,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 121,
      "content": "Add outbound rules to NACL\n\n7. Click on Subnet Associations. Select the subnet that we created earlier. Click on the Save button:\n\nNACL and subnet association\n\n8. We can go and select the subnet menu and see that the NACL associated with the subnet has changed:\n\nNACL and subnet association success\n\n9. If a custom NACL is not associated with any subnet, it can be deleted by selecting the Delete button in the console. However, we can't delete the NACL that we created now as it is attached to a subnet. First we need to replace the subnet association, as given in step 7, and then can delete it if required. OceanofPDF.com",
      "content_length": 624,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 122,
      "content": "How it works...\n\nWe can define multiple inbound and outbound rules in an NACL. An NACL can be associated with one or multiple subnets in the VPC. An inbound rule allows or blocks incoming network requests from outside of the subnet to the resources hosted in the subnet. An outbound rule allows or blocks network requests from resources hosted within the subnet to outside of the subnet. Each rule has a number. The rules are evaluated from the rule with the lowest number first and then the rule with the next highest number. However, if a rule allows particular network traffic, other rules are not evaluated. So if a rule with the lowest number allows all traffic, more restrictive rule that would have blocked the traffic will not take effect. An NACL is stateless. This means that, if a network request is allowed by an inbound rule, the response can't go out if the outbound rule does not allow it, and vice versa. It may be preferable to add a DENY rule first where you want to allow a wide range of ports, but there are a few ports in that range which you would need to block.\n\nOceanofPDF.com",
      "content_length": 1100,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 123,
      "content": "There's more...\n\nWhen a request comes to a resource say, an HTTP request, a short-lived transport protocol port for Internet Protocol (IP) communications is allocated automatically from a predefined range by the IP stack software, and is called the ephemeral port. The response goes back via the ephemeral port. You need to know the ephemeral ports which differ depending on the OS; a few samples are shown in the table following. You need to allow ephemeral ports in an NACL for effective communication:\n\nOperating System\n\nEphemeral port\n\nAmazon Linux\n\n32768-61000\n\nWindows Server 2003/Windows XP 1025-5000\n\nWindows Server 2008\n\n49152-65535\n\nAWS ELB/AWS NAT\n\n1024-65535\n\nOceanofPDF.com",
      "content_length": 686,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 124,
      "content": "Managing a Security Group\n\nSecurity Group (SG) works as a virtual firewall that controls incoming traffic to protect resources hosted in AWS, such as EC2 and RDS, from unwanted access. The same SGs should be associated with services/resources having the same functionality and security requirements such as a cluster of web servers. SGs can span across different subnets in a VPC. SGs are stateful firewalls where you can define rules for a valid source, protocol, and port for incoming and outgoing traffic. Stateful meaning--if the connection from source to destination is allowed, the return path is also allowed. At least one SG needs to be attached to the resource at the time of resource creation. More than one SG can also be attached to a resource. The rules of an SG can be modified at any time and they will take effect immediately. An SG can be detached from the resource at any time.\n\nOceanofPDF.com",
      "content_length": 911,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 125,
      "content": "Getting ready\n\nThe prerequisites for this section are the same as recipe, Managing a Network ACL.\n\nOceanofPDF.com",
      "content_length": 113,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 126,
      "content": "How to do it...\n\n1. Log in to your AWS account and open the VPC Dashboard as shown in the earlier recipe.\n\n2. Click on Security Group in the left menu bar under the Security menu. The default SG created with the default VPC and other VPCs that we created in Chapter 1, Getting Started with AWS Networking Components, appears on the screen. If you click on Inbound Rules and Outbound Rules, you will see that all traffic, with all protocols from all ports, is allowed. So effectively, the firewall is all open and traffic from any source, protocol, and port can connect to the resources in this SG:\n\nDefault Security group\n\n3. Click on Create Security Group. The following window will open. Put in the required details and the VPC with which you want to associate the SG. Click on Yes, Create:",
      "content_length": 792,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 127,
      "content": "Security Group creation from console\n\n4. You can now see the new SG. However, there is one important difference from the default SGs: there are no Inbound Rules defined. This means no traffic is allowed inside this SG:\n\nDashboard with created Security Group\n\n5. Click on the Edit button under Inbound Rules. You can select the traffic type from the options. For now, put SSH. In the Source, you can mention any valid CIDR range, such as your corporate DC CIDR range. For now, put 0.0.0.0/0. You can also mention the security groups in the same VPC. You can add any additional inbound rules by clicking Add another rule and add HTTP, as shown. Click on the Save button:",
      "content_length": 668,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 128,
      "content": "Configure Security Group inbound rule\n\n6. You can see that the SG Inbound Rules has been saved successfully. Click on Outbound Rules. You can see that all outgoing traffic types to all ports and all destinations are allowed. For now, we are not modifying this. However, you can modify it if required:\n\nSecurity Group outbound rules\n\n7. You can delete a particular SG by selecting Delete Security Group from the security group actions:",
      "content_length": 434,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 129,
      "content": "Delete Security Group\n\nOceanofPDF.com",
      "content_length": 37,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 130,
      "content": "How it works...\n\nSecurity groups control the incoming and outgoing requests to and from resources hosted in the AWS. Inbound rules allow incoming network traffic from source CIDR ranges with the protocol and ports mentioned in a rule. If you want to allow requests only from resources hosted inside your VPC, put an SG associated with those resources in the source. Outbound rules allow outbound requests initiated from resources hosted in the AWS.\n\nOceanofPDF.com",
      "content_length": 464,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 131,
      "content": "There's more...\n\nApart from load balancers, the source for inbound rules should not be open to all IPs or ports for production scenarios. For other ports such as RDP/SSH, access should be allowed from the Jump Server/Bastion Host. All rules in an SG are evaluated before allowing any traffic.\n\nOceanofPDF.com",
      "content_length": 308,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 132,
      "content": "Managing an Internet Gateway\n\nAn Internet Gateway is an AWS component that enables communication between resources hosted in the VPC and the internet. It is a horizontally scalable and highly available component. It doesn't enforce any network bandwidth constraints. It is the channel through which services hosted inside the VPC are accessed by the outside world. It also enables resources hosted in the AWS to connect to the internet.\n\nOceanofPDF.com",
      "content_length": 452,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 133,
      "content": "Getting ready\n\nThe prerequisites for this section are the same as recipe, Managing a Network ACL.\n\nOceanofPDF.com",
      "content_length": 113,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 134,
      "content": "How to do it...\n\n1. Log in to your AWS account and open the VPC Dashboard as shown in the earlier recipe.\n\n2. Click on Internet Gateways in the left menu bar under the Virtual Private Cloud menu. You can see that the IG which was created with the default VPC in the region is visible:\n\nInternet Gateway dashboard\n\n3. Click on Create Internet Gateway. The following window will open. Provide a Name tag and click on Yes, Create:\n\nInternet Gateway creation from console\n\n4. You can see the IG is created. However, it is in the detached state. This means that it is not attached to any VPC:",
      "content_length": 587,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 135,
      "content": "Dashboard with created Internet Gateway\n\n5. Click on the Attach to VPC button. The following window will open. Select the VPC that we created and click on Yes, Attach:\n\nAttach Internet Gateway with VPC\n\n6. Now you can see that the state of the IG has changed to attached:\n\nInternet Gateway status",
      "content_length": 296,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 136,
      "content": "7. If you want, you can click on Detach from VPC and then Delete the IG that you created.\n\nOceanofPDF.com",
      "content_length": 105,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 137,
      "content": "How it works...\n\nResources inside the subnet only understand the private IP (internal) assigned to them from the CIDR range of that subnet. The default VPC has an IG attached to it and the subnet's route is associated with the IG. The IG works as a Network Address Translation (NAT) for instances that have public IP/Elastic IP attached to them. When outside instances send requests to the AWS resources with a public IP/Elastic IP, the IG translates the address and sends the request to the internal IP of the resource. Similarly, when resources inside a subnet send requests to services outside the VPC, the reply address is set by the IG as public/Elastic IP of that resource. Thus, if a subnet route has an IG attached to it, the resources hosted inside it are accessible from the internet. This type of subnet is called a public subnet. All default subnets are public subnets. If no IG is attached to the subnet route, the resources hosted inside it can't be accessed from the internet and is hence called a private subnet.\n\nOceanofPDF.com",
      "content_length": 1044,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 138,
      "content": "There's more...\n\nBy default, all user created subnets are private subnets. If we want resources to be accessed from the internet directly, we need to create an IG and attach it to the VPC. The IG needs to be attached to the route table of the subnet that hosts the resources. If we attach an IG to the route of the subnet, it becomes a public subnet.\n\nOceanofPDF.com",
      "content_length": 366,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 139,
      "content": "Managing a NAT Gateway\n\nBy default, there is no way that resources hosted in a private subnet can access the internet. NAT is a way to achieve that. However, any resource outside the VPC can't access the resources in a private subnet. We can use a NAT instance or a NAT Gateway to achieve this. However NAT Gateway is a scalable, managed service that does not require any administration. In this section, we will see how to manage a NAT Gateway.\n\nOceanofPDF.com",
      "content_length": 461,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 140,
      "content": "Getting ready\n\nWe need to have an AWS account created with a user that has permissions to manage the NAT which we already have. We need to create an Elastic IP to be attached to with NAT, which is provided here. We shall learn details about Elastic IPs in the later sections.\n\nOceanofPDF.com",
      "content_length": 291,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 141,
      "content": "How to do it...\n\n1. Log in to your AWS account and open the VPC Dashboard as shown in the earlier recipe.\n\n2. Click on Elastic IP under the Virtual Private Cloud menu. There are no Elastic IPs as we have not created any till now:\n\nElastic IP console\n\n3. Click on Allocate New Address. The following window will open. Click on Allocate:\n\nElastic IP creation from console\n\n4. An Elastic IP will be provided:",
      "content_length": 405,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 142,
      "content": "Console with Elastic IP created\n\n5. Click on NAT Gateways under the Virtual Private Cloud menu:\n\nNAT Gateway console\n\n6. Click on Create NAT Gateway. The following window will open. Select the subnet where you want it to be hosted from the Subnet search menu and the Elastic IP that we created in step 4. Click on Create a NAT Gateway:\n\nConsole for NAT Gateway creation",
      "content_length": 369,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 143,
      "content": "7. You will get a confirmation message; you can see it on the dashboard. Initially, the Status will be Pending. The Status will change to Available after some time:\n\nConsole with created NAT Gateway\n\n8. You can click on Delete NAT Gateway if it is not needed any more from the console. In that case, also remember to release the Elastic IP.\n\nOceanofPDF.com",
      "content_length": 356,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 144,
      "content": "How it works...\n\nWhen resources in the private subnet need to connect to services out on the internet, they send the requests through NAT. NAT forwards the requests to the internet and replaces the return address of the Elastic IP address assigned to it instead with the internal IP of the resource. Similarly, when a response comes back, NAT translates the address to the internal IP of the resource and forwards the response.\n\nOceanofPDF.com",
      "content_length": 443,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 145,
      "content": "There's more...\n\nA NAT instance is created in one subnet, meaning one AZ where the subnet is created. If you have resources in multiple AZs and in case the AZ that hosts the NAT Gateway is down, resources hosted in the other AZs lose the internet connection. So to have a highly available NAT infrastructure, you need to create a NAT Gateway which is a managed NAT service with a NAT instance created in multiple AZs to have fault tolerance.\n\nOceanofPDF.com",
      "content_length": 457,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 146,
      "content": "Managing a Route Table\n\nA Route Table contains a set of rules that control how the network traffic flows within a VPC and outside of it. Each subnet must be associated with one Route Table. However, Route Tables may contain more than one subnet that needs the same route configuration.\n\nOceanofPDF.com",
      "content_length": 301,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 147,
      "content": "Getting ready\n\nWe need to have an AWS account created with a user that has permissions to manage Route Tables, which we already have. We have already created two subnets, one IG, and one NAT Gateway. By configuring these with the Route Table, we shall make one subnet a public subnet and the other one a private subnet.\n\nOceanofPDF.com",
      "content_length": 335,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 148,
      "content": "How to do it...\n\n1. Log in to your AWS account and open the VPC Dashboard as shown in the earlier recipe.\n\n2. Click on Route Tables under the Virtual Private Cloud menu. We can see the Main Route Table created and associated with the VPC that we created from the console. You can see that no subnet is associated with any route explicitly:\n\nRoute Table console\n\n3. Click on Routes. You can see there is only one route with the Target as local. Click on Edit, and then click on Add another route. Add all destinations with 0.0.0.0/0 and target the Internet Gateway that we created earlier. Also, add the NAT Gateway in as another route. Click on the Save button:",
      "content_length": 661,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 149,
      "content": "Configure main route table\n\n4. Go to the Subnet Associations tab. You can see that no subnet is explicitly associated with this route:\n\nSubnet association console for Route Table\n\n5. Click on Edit. The following console will open. Select the subnet that we created from the console. Click on the Save button:\n\nEdit subnet association for main route table\n\n6. You can see that Explicitly Association has been modified from 0 to 1:",
      "content_length": 429,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 150,
      "content": "Route Table subnet association\n\n7. Let's add another route for creating a private subnet. Click on Create Route Table. The following window will open. Put the Name tag and select the VPC that we created from the console earlier. Click on Yes, Create:\n\nConsole for Route Table creation\n\n8. We can see the newly created Route Table in the console. However, the Main column is No for this case:\n\nConsole with custom route table\n\n9. Go to Subnet Associations. Click on the Edit button. Choose the other subnet that we created. Click on the Save button:",
      "content_length": 548,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 151,
      "content": "Subnet association for custom route table\n\n10. After removing the subnet association with a particular route table, you can delete it by clicking the Delete Route Table button.\n\nOceanofPDF.com",
      "content_length": 192,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 152,
      "content": "How it works...\n\nNow we have turned one subnet into a public subnet that is associated with the route table having Internet Gateway and NAT Gateway. The other subnets that are associated with the route table with a local route become private subnets.\n\nOceanofPDF.com",
      "content_length": 266,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 153,
      "content": "There's more...\n\nA VPC comes with a main router when created. If any subnet in the VPC is not associated with any route table, it is automatically associated with the main table. You can make any Route Table the main table by clicking the Set As Main Table button from the console.\n\nOceanofPDF.com",
      "content_length": 297,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 154,
      "content": "Managing EC2 instances\n\nEC2 is an infrastructure in the AWS Cloud with certain compute, memory, and network resources. Though EC2 is not a networking component, we shall try to create a couple of them to check whether the network components that we have created work with EC2. We shall also understand how networking components integrate with resources in AWS.\n\nOceanofPDF.com",
      "content_length": 376,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 155,
      "content": "Getting ready\n\nWe need to have an AWS account created with a user that has permission to manage EC2 instances, which we already have.\n\nOceanofPDF.com",
      "content_length": 149,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 156,
      "content": "How to do it...\n\n1. Log in to your AWS account and open the EC2 Dashboard:\n\nEC2 Dashboard\n\n2. Click on the Launch Instance. The following window will open. You can choose any prebuilt virtual image called Amazon Machine Images (AMIs) that you like. However, for now Select the first one:\n\nChoose AMI for EC2\n\n3. The following window will open. Select the instance type that you would like to choose. For now, select the one that is already selected. It is free tier eligible:",
      "content_length": 475,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 157,
      "content": "EC2 - Choose instance type\n\n4. Click Next: Configure Instance Details. The following window will open. In the Number of instances, put 1. You can create more by putting a higher number. In Network, choose the VPC that we created earlier. In Subnet, choose the public subnet that we created earlier. In Auto-assign Public IP, choose Enable. Leave other options as they are. Click on Next: Add Storage:\n\nConfigure EC2 Network detail\n\n5. Leave the details as they are and click on Next: Add Tags:",
      "content_length": 493,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 158,
      "content": "Choose EC2 Storage\n\n6. Add a tag for identifying the EC2 instance in the EC2 dashboard. Click on Next: Configure Security Group:\n\nAdd EC2 tag\n\n7. Select the Select an existing security group option. It will show the SG that we created earlier. Choose it. Click on Review and Launch:",
      "content_length": 282,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 159,
      "content": "Choose EC2 SG\n\n8. Review the details and click Launch:\n\nLaunch EC2\n\n9. The following window will open. Select Create the new key pair and Key pair name. Download the key and store it. We shall use it in a while. Click on the Launch Instances button. You will get a success message:",
      "content_length": 281,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 160,
      "content": "EC2 Key Pair creation\n\n10. Go to the EC2 dashboard. Select Instances from the Instances menu. Choose the instance that we just created. You will see the details about the instance. You can also see that the public IP has been assigned to it:\n\nEC2 instance details\n\n11. Click on the Connect button. You can see the instructions to connect to the instance using an SSH client. If you would have chosen Windows AMI, it would show the connection steps using RDP. You should be able to connect to the instance using the public IP of the instance. For",
      "content_length": 545,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 161,
      "content": "details, please refer to the AWS Documentation (http://docs.aws.amazon.com/A WSEC2/latest/UserGuide/putty.html):\n\nConnecting to EC2 instance\n\n12. You can terminate or stop an instance from the Instance State of the Action menu when needed.\n\nOceanofPDF.com",
      "content_length": 255,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 162,
      "content": "How it works...\n\nThis EC2 instance is created in a public subnet that has an IGW attached to it. The NACL is open for all connections. Security groups is open to all inbound connections over port 22, so we could add SSH to the instance.\n\nOceanofPDF.com",
      "content_length": 252,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 163,
      "content": "There's more...\n\nThe public IP associated with the instance is transient. If we stop and start the instance, the IP will change. We can attach the Elastic IP to the instance in the same way we attached the Elastic IP to the NAT instance in Chapter 1, Getting Started with AWS Networking Components. In that case, the IP will not be changed if the instance is stopped and started.\n\nIf we had created an instance in a private subnet, it could not have been connected as there is no inbound route available from the internet. However, we can connect to it from the instance in the public instance. For that, we need to add an SG of the public subnet instance to the inbound rules of an SG of the private instance. Once we log into the private subnet instance, we can connect to the internet as we have configured the NAT Gateway.\n\nOceanofPDF.com",
      "content_length": 842,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 164,
      "content": "VPC Advanced Components\n\nIn this chapter, we'll cover the following recipes:\n\nAssigning multiple IPs to an instance and ENI Accessing an instance within the network Accessing an instance from outside AWS Creating an application ELB Creating a launch configuration Creating an Auto Scaling group Creating VPC peering Accepting VPC peering Configuring VPN connections to your Amazon VPC\n\nOceanofPDF.com",
      "content_length": 400,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 165,
      "content": "Introduction\n\nIn this chapter, we shall dive further to learn to create components for load balancing of an application. Load balancing is required to route the request to different servers hosting the applications. This helps to host applications with the exact capacity that the application needs at a certain point of time.\n\nSecurity is a major concern that cuts across every application type. We shall learn how to build components for establishing communication between multiple VPCs and between a data center and VPC. This will enable applications and services to securely connect to each other.\n\nOceanofPDF.com",
      "content_length": 617,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 166,
      "content": "Assigning multiple IPs to an instance and ENI\n\nThe Elastic Network Interface (ENI) is a virtual interface. Any instance when created comes with its default NI attached to it (eth0). Additional ENIs can be created and attached to an instance or can be detached from it. The number of ENIs that can be attached to an EC2 instance depends on its type. An ENI may have the following properties:\n\nOne primary and multiple secondary IPv4 addresses and optionally, one public or Elastic (fixed) IPv4 IP One or more IPv6 addresses if supported by the instance type and network One MAC address Additional properties such as SG, source destination check, and so on.\n\nThis recipe is similar to creating a NAT instance that we learnt in Chapter 1, Getting Started with AWS Networking Components. In that case, we attached an Elastic IP to one instance. Here, we shall learn how to create an ENI and attach it to an EC2 instance. For an ENI to be attached to an EC2, it must be done in same subnet and VPC.\n\nOceanofPDF.com",
      "content_length": 1009,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 167,
      "content": "Getting ready\n\nLog in to the console with the appropriate permission.\n\nOceanofPDF.com",
      "content_length": 85,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 168,
      "content": "How to do it...\n\nThe stepsfor assigning multiple IPs to an instance are as follows:\n\n1. Go to the AWS EC2 console by typing the URL in your favorite browser: https://console.aws.amazon.com/ec2/. Choose Network Interfaces in the left navigation menu under Network & Security. In the dashboard, you can see the ENI that has already been created while creating the EC2 instance or the Elastic IP. Click on Create Network Interface:\n\nCrete network interface\n\n2. Provide the Description and select the Subnet to which it should be associated with. Choose the IPv4 Private IP and IPv6 IP that is allowed under the CIDR of the subnet. You can leave it and AWS will choose the IPs for you. Select the Security groups that it should be associated with. SGs created in the VPC will be populated in the Security groups section. Click Yes, Create. We can change the Security Group associated with the ENI later.\n\n3. You can now see the Network Interface that was just created in the dashboard. You can see the status is available:",
      "content_length": 1018,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 169,
      "content": "Create network interface\n\n4. Click on the Attach button:\n\nAttach network interface\n\n5. Select the EC2 instance that you want to attach the ENI with. Click on the Attach button:",
      "content_length": 176,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 170,
      "content": "Network interface attached\n\n6. You can see that the status has changed to in-use. The Instance ID of the EC2 instance is visible in the Details section. If you want, you can detach the network interface and attach it with another instance in the same subnet.\n\nOceanofPDF.com",
      "content_length": 274,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 171,
      "content": "There's more...\n\nNow the EC2 instance has two ENIs attached to it. So, the instance can be connected using any IP associated with either of the ENIs based on the SG rules attached to the ENI.\n\nA network interface can be attached to an instance in the running state, stopped state, or while the instance is being created. An Elastic IP is a special network interface and it can be attached to any instance in the public subnet in any VPC of your account. In Chapter 1, Getting Started with AWS Networking Components, we created one EIP while creating a NAT instance.\n\nOceanofPDF.com",
      "content_length": 581,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 172,
      "content": "Accessing an instance within the network\n\nIn the earlier chapters, we created an instance in the public subnet and connected to it from our system. In this section, we shall create an instance in the private subnet of the same VPC and connect it from the instance that we created earlier. We shall create a private subnet in the VPC that we created in Chapter 1, Getting Started with AWS Networking Components, and create an instance to it.\n\nOceanofPDF.com",
      "content_length": 456,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 173,
      "content": "Getting ready\n\nLog in to the account with the proper permissions and a VPC, subnet, and EC2 instance in the public subnet already created.\n\nOceanofPDF.com",
      "content_length": 154,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 174,
      "content": "How to do it...\n\nThe steps for accessing an instance within the network are as follows:\n\n1. Log in to the AWS console EC2 dashboard by browsing to the URL http s://console.aws.amazon.com/vpc/. Choose Subnet from the left side menu. Click on Create Subnet. Provide the required details. Click on Yes, Create:\n\nCreate private subnet\n\n2. You can create an EC2 instance by following the similar steps provided in Chapter 2, Building Your Own Custom VPC. We need to create it in the subnet that we just created and assign an SG to allow only instances in the public subnet to connect to it. Let's create an instance from the existing one. Browse to Instances in the EC2 Dashboard. Select one EC2 instance that you want to create a new EC2 instance from. Go to Actions | Launch More Like This:",
      "content_length": 787,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 175,
      "content": "Create similar EC2 instances\n\n3. The EC2 creation review page will appear as follows:\n\nEC2 creation review page\n\n4. Click on Edit instance type. Change the Subnet to the newly created one. Click on Review and Launch:\n\nModify configure instance details\n\n5. You will come back to the preview page. Click on Edit security groups. Choose Create a new security group. Put the Security group name and",
      "content_length": 394,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 176,
      "content": "Description for all the rules for the Security Group. Here we'll open port 22 for instances created in the Security Group associated to the instance created in the public subnet. Copy the SG associated with that instance and paste it in Source:\n\nModify Security Group\n\n6. Click Review and Launch and then click on Edit Tag. Put the tag as per your needs:\n\nAdd EC2 tag\n\n7. Click Review and Launch. Click on Launch. You can create a new key or use an existing key. I'll be using the existing one. Click on Launch Instances:",
      "content_length": 521,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 177,
      "content": "Launch EC2 instance\n\n8. You will see a success page as shown:\n\nEC2 Create success message\n\n9. Click on the instance ID. Wait for some time till it comes to the running state with status checks in green. First, log in to the public subnet EC2 instance MyFirstEC2 in the same way we did in Chapter 1, Getting Started with AWS Networking Components:\n\nConnect to EC2 instance in public subnet",
      "content_length": 388,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 178,
      "content": "10. Create a file using your favorite editor. Paste the contents of the EC2 key you downloaded earlier and save it. Verify that the file has been created, and modify its permission to 400 (chmod 400 FirstEC2KeyPair.pem), and connect to it (ssh -i <KeyName> ec2-user@<Private IP of instance>). Type yes for continuing the connection:\n\nConnect to EC2 instance in private subnet\n\n11. You will be logged in to the instance in the private subnet. You can see that the IP of EC2 console has changed to one of private subnet (10.0.0.240) from one in public subnet (10.0.0.13).\n\nConnection to private subnet EC2 instance successful\n\nOceanofPDF.com",
      "content_length": 639,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 179,
      "content": "How it works...\n\nEC2 instances in a VPC can connect to each other via the local route in the Route Table provided the Security Group allows inbound connections. For SG (say SGPrivate) of the instance in private subnet, we added SG of instance in public subnet(say SGPublic). This ensures that no other instance can connect to the new instance in the private subnet apart from EC2 instances associated with SGPublic. Now we have created a bastion server or jump server, which is our EC2 instance in the public subnet. To connect to the instance in the private subnet instances, someone has to go through it. Generally, the Security Group of a bastion server is configured to accept connections from a list of known IP addresses where administrators operate from.\n\nOceanofPDF.com",
      "content_length": 777,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 180,
      "content": "Accessing an instance from outside AWS\n\nIn the last recipe, we connected to an instance in the private subnet through a bastion server through the internet. In this recipe, we'll see how to connect to the Windows Server and connect it through the Microsoft Remote Desktop Protocol (RDP). You need to have a Windows OS in your machine to complete this recipe.\n\nOceanofPDF.com",
      "content_length": 374,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 181,
      "content": "Getting ready\n\nLog in to the console with the appropriate permissions.\n\nOceanofPDF.com",
      "content_length": 86,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 182,
      "content": "How to do it...\n\nThe steps for accessing an instance from outside AWS are as follows:\n\n1. Browse to the EC2 console. Click on Launch Instance. Select Microsoft Windows Server 2016 Base AMI:\n\nChoose Windows AMI\n\n2. Select t2.micro on the Choose Instance Type page. Click on Next: Configure Instance Details. Select a VPC in Network and a public subnet in Subnet with Auto-assign Public IP enabled. Click Next: Add Storage. Let the default option be there and click Next: Add Tags. Let the default option be there and click Next: Configure Security Group:",
      "content_length": 553,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 183,
      "content": "Choose configuration details\n\n3. You can see that the port RDP is open for all IP addresses. You may modify the IP range to suit your needs:\n\nSecurity group for Windows instance\n\n4. Click Review and Launch and then click on Launch. Select Choose an existing key pair and click on Launch Instance. You can see the instance in the EC2 Dashboard with the public IP assigned to it:\n\nWindows instance on EC2 console\n\n5. Choose EC2 and click on Connect. Click on Download Remote Desktop File and save it.",
      "content_length": 498,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 184,
      "content": "Windows instance connection guideline\n\n6. Click on Get Password, the following window will open. Select the Key Pair Path. Click on Decrypt Password. The password will be shown. Copy the password and save it.\n\nWindows instance password generation\n\n7. Click on the RDP shortcut downloaded earlier. Put in the user ID and password. You will now be able to connect to the instance.",
      "content_length": 378,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 185,
      "content": "Windows Instance Connection\n\nOceanofPDF.com",
      "content_length": 43,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 186,
      "content": "Creating an application ELB\n\nAWS provides an Elastic Load Balancer (ELB) as a service. AWS has two kinds of ELB:\n\nClassic ELB Application Load Balancer\n\nA Classic ELB can forward requests to one set of EC2 instances and an Application Load Balancer can forward requests to applications based on the application content/path/host. Classic load balancer can handle load for both layer 4 and layer 7. Application load balancer can handle load for only layer 7 protocol.\n\nOceanofPDF.com",
      "content_length": 482,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 187,
      "content": "Getting ready\n\nLogin to the console with appropriate permissions.\n\nOceanofPDF.com",
      "content_length": 81,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 188,
      "content": "How to do it...\n\nThe steps are as follows:\n\n1. Browse to AWS EC2 console by typing the URL: https://console.aws.amazon.c om/ec2. Click on Load Balancers under the LOAD BALANCING option on the left menu. Click on Create Load Balancer:\n\nSelect Load Balancer Type\n\n2. Let's choose the Application Load Balancer and click Continue. Provide the load balancer Name, Scheme, whether it is internet facing or internal facing and the IP address type for only IPv4 support of dual stack support. If you choose dual stack, your VPC and subnets should have support for IPv4 and IPv6 ports. Provide Listeners on which protocol (HTTP/S) and port you want the requests to come to. Scroll down to select the VPC where you want to create the load balancer and select at least two Availability Zones where the load balancer instances will be created. To have an internet facing load balancer, subnets need to have an IGW attached to them. You can add tags as well. Click Next: Configure Security Settings:",
      "content_length": 987,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 189,
      "content": "Select security setting\n\n3. If you choose the HTTPS listener, you need to provide a security certificate. As I have chosen HTTP, no configuration is required in this step. Click on Next: Configure Security Group. Choose Create a new security group. Provide the Security group name and Description. Provide rules and as we chose HTTP protocol and port 80 in the previous step, keep the same here. In the source, you can put the source IP range that you want the request coming from. I am allowing all URLs by providing the CIDR range to be open to all:",
      "content_length": 551,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 190,
      "content": "Configure Security Group\n\n4. Click on Next: Configure routing. Provide the name of the target group. It is a logical group of all the servers that the load balancer sends traffic to. Provide the Protocol and Port that the services on the server are running on. Provide the Health Checks details using which load balancer sends requests at regular intervals to verify whether the server is healthy or not:\n\nConfigure load balancer routing\n\n5. It will provide a list of EC2 instances already running. As we don't have any instance in the VPC, the list is empty. You can choose instances if there are any. However, you need to remember that merely adding those instances will not work. The service should be up and should provide a healthy response to the health check settings which you did earlier and Security Group of server should be modified to allow incoming requests from the ELB. Click on Next: Review.\n\n6. Review the details and click Create. Success message will be displayed. Click on Close. You'll be able to see the application load balancer created with all details. You can see the DNS name of the load balancer",
      "content_length": 1124,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 191,
      "content": "which can be used to access the service hosted by the target group servers:\n\nLoad balancer details\n\nOceanofPDF.com",
      "content_length": 114,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 192,
      "content": "How it works...\n\nThe load balancer sends requests using the Protocol and Path that you provide in the Health checks. It initiates a request at a given interval to all server associated with it. If some server does not respond back in predefined interval for few consecutive requests, the server is marked as OutOfService. Load balancer does not send user requests to it. However load balancer keeps on sending the health check request. If server responds back to few consecutive health check requests, it is marked as InService. Load balancer send user requests to it again. Advanced health check settings provide better control on frequency of these requests and threshold to decide whether the server is healthy or not. Click on Next: Register Targets.\n\nOceanofPDF.com",
      "content_length": 770,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 193,
      "content": "There's more...\n\nYou can check the health of the ELB by looking at the monitoring tab. Different useful statistics including the number of requests and number of errors are provided. In Listener, you get an option to add another application group to forward the request to.\n\nOceanofPDF.com",
      "content_length": 289,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 194,
      "content": "Creating a launch configuration\n\nA launch configuration is a way to create a template for creating EC2 instances that have the same predefined configuration. EC2 instances can be created when more instances are required for load balancing from this configuration.\n\nOceanofPDF.com",
      "content_length": 279,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 195,
      "content": "Getting ready\n\nLog in to the console with the appropriate permissions.\n\nOceanofPDF.com",
      "content_length": 86,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 196,
      "content": "How to do it...\n\nThe steps for creating a launch configuration are as follows:\n\n1. Browse to AWS EC2 console by typing the URL: https://console.aws.amazon.c om/ec2. Browse to Launch Configurations under AUTO SCALING in the left menu bar. You'll see the following dashboard if there are no Auto Scaling Groups or launch configurations already created:\n\nCreate launch configuration\n\n2. Click on Create Auto Scaling group:\n\nCreate Auto Scaling group page",
      "content_length": 451,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 197,
      "content": "3. This page has an introduction and tells you that you need to create a launch configuration before creating an Auto Scaling group. Click on Create launch configuration. You will be taken through the same steps that you did while creating an EC2 instance. Select your favourite AMI by clicking on Select as shown following:\n\nChoose AMI for launch configuration\n\n4. Choose the instance type that you need to create:\n\nChoose instance type for launch configuration\n\n5. Click Next: Configure details. Provide the Name. Click on the Advanced Details and put the following lines in the textbox. It will",
      "content_length": 597,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 198,
      "content": "install Apache, PHP, and MySQL in the server. It will also start the Apache server once the EC2 is running:\n\n#!/bin/bash yum update -y yum install -y httpd24 php56 mysql55-server php56-mysqlnd service httpd start chkconfig httpd on groupadd www usermod -a -G www ec2-user chown -R root:www /var/www chmod 2775 /var/www find /var/www -type d -exec chmod 2775 {} + find /var/www -type f -exec chmod 0664 {} + echo \"<?php phpinfo(); ?>\" > /var/www/html/phpinfo.php\n\nIn the IP Address Type, choose the option Do not assign a public IP address to any instances, as we want to access the instances only through the load balancer:\n\nChoose configure details for launch configuration\n\n6. Click on Next: Add Storage. You can modify it if you want large volumes to be attached to the EC2 instance. Leave the default options for now. Click on Next: Configure Security Group. Provide the Security group name and Description. Change the request protocol Type to HTTP and the Port Range to 80, as we did that in the load balancer configuration. In Source, choose Custom IP and provide the load balancer security group that we created earlier:",
      "content_length": 1127,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 199,
      "content": "Choose add storage for launch configuration\n\n7. Click on Review. You can review and modify configurations of the previous steps. Click on Create launch configuration:\n\nReview for launch configuration\n\n8. Choose a key if you want to connect to the EC2 instance. But remember, you also need to add a security group of your bastion server in the same VPC in the Configure Security Group step; because, through the bastion server, you can connect to instances in the Auto Scaling group as these EC2 instances don't have a public IP. Check the acknowledgement and click on Create launch configuration:",
      "content_length": 596,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 200,
      "content": "Select EC2 key for launch configuration\n\n9. Click on the Launch Configuration menu again. You will see the dashboard with the launch configuration which we just created:\n\nFigure 3 – 36 Launch configuration created\n\nOceanofPDF.com",
      "content_length": 229,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 201,
      "content": "There's more...\n\nGenerally, we create an EC2 instance and configure it with the required software and create a virtual image (AMI) from that EC2 from the EC2 Actions | Image | Create Image menu. Other compatible virtual machine images can also be imported to AWS for reuse. If we have created any, this will be visible under the My AMIs menu.\n\nSo instead of using boot strap scripts in step 5, we can use custom AMI to create ec2 instances. As the software already installed in EC2, it takes lesser time to start server. It is more useful when we have to install larger software that takes significant time.\n\nOceanofPDF.com",
      "content_length": 623,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 202,
      "content": "Creating an Auto Scaling group\n\nAn Auto Scaling group is a group of instances that host the same application. These instances are treated as a logical group for managing and scaling instances. You can define a criteria based on which of the number of instances serving the application can be changed to support the load on the application.\n\nOceanofPDF.com",
      "content_length": 355,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 203,
      "content": "Getting ready\n\nLog in to the console with the appropriate permissions.\n\nOceanofPDF.com",
      "content_length": 86,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 204,
      "content": "How to do it...\n\nThe steps for creating an auto scaling group are as follows:\n\n1. Browse to the AWS EC2 console by typing the URL: https://console.aws.ama zon.com/ec2. Browse to Auto Scaling Groups under AUTO SCALING in left menu bar. You'll see the following dashboard if there are no Auto Scaling groups or launch configurations already created:\n\nCreate Auto Scaling Group\n\n2. Click on Create Auto Scaling group. The following screen will appear. You can create a new launch configuration or select the existing one and click on Next Step:",
      "content_length": 541,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 205,
      "content": "Create Auto Scaling group with launch configuration\n\n3. Provide a name in Group name and Group size to create the minimum number of instances in the group. Select VPC in the Network option and one or more subnets to provide the AWS information about where these instances will be created. Leave the Advanced Details as they are. Click Next: Configure scaling policies. You should choose the same VPC with which the Security Group of the launch configuration is associated:\n\nCreate Auto Scaling Group Details",
      "content_length": 507,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 206,
      "content": "4. You can keep the group at its initial size. Otherwise define policies when you need to increase number of instances in group and reduce number of instances in the group. You provide the minimum and maximum instances in the group:\n\nCreate Auto Scaling group capacity\n\n5. You need to click on the Add new alarm link to increase and decrease the group size sections. You can see we are defining policies to add new instances in the group; you can select from different parameters and conditions. You can optionally define the notification group to send an email when this event occurs. Here I have defined a policy to add an instance if the average CPU utilization of the instances in the group is more than or equal to 70% for at least 5 minutes. Click on Create Alarm:",
      "content_length": 770,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 207,
      "content": "Alarm for increase group size\n\n6. Similarly, we can define the policy to decrease the number of instances in the group if the average CPU utilization of the instances in the group is less than or equal to 30% for at least 5 minutes:\n\nAlarm for decrease group size\n\n7. Put the number of instances to be added and removed when the respective policies occur. Click on Review:",
      "content_length": 372,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 208,
      "content": "Configure scaling policy for Auto Scaling group\n\n8. Review the details and click on Create Auto Scaling group:\n\nReview creation of Auto Scaling group\n\n9. An Auto Scaling group will be created and the next time you go to the menu, you will see the newly created Auto Scaling group:",
      "content_length": 280,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 209,
      "content": "Auto Scaling group details\n\n10. Note that one instance will be created and the instances column will show 1 after some time. Even if you delete the instance, one more instance will be created to have the minimum number of instances defined in this group. If you want to associate the Auto Scaling group with a load balancer, click on the Edit button on the Details tab. Add the load balancer and the target group. Click on the Save button:\n\nEdit Auto Scaling group details\n\n11. You can select the Auto Scaling group from the Actions menu to Edit or Delete the scaling group. If you delete a scaling group, instances associated with this group will also be terminated.",
      "content_length": 667,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 210,
      "content": "OceanofPDF.com",
      "content_length": 14,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 211,
      "content": "There's more...\n\nScaling policies can be defined using any available cloud watch statistics. We can define the custom cloud watch metrics which can also be used to define policies. If you define the desired and minimum instance as 0, instances will not be created even if you don't delete the scaling group.\n\nYou can define the scheduled actions if you want the number of instances to vary according to a fixed schedule.\n\nOceanofPDF.com",
      "content_length": 436,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 212,
      "content": "Creating VPC peering\n\nInstances in a VPC are isolated from other VPCs. We need to create VPC peering to communicate between instances using the private IPv4 or IPv6 IPs. You can create peering between two VPCs in the same region. Both the VPCs can either belong to the same AWS account or different accounts. Here we'll learn how to create VPC peering between two VPCs in one account.\n\nOceanofPDF.com",
      "content_length": 400,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 213,
      "content": "Getting ready\n\nLog in to the console with the appropriate permissions.\n\nOceanofPDF.com",
      "content_length": 86,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 214,
      "content": "How to do it...\n\nThe steps to create VPC peering are as follows:\n\n1. Browse to the AWS VPC console. In the left menu option, choose Peering Connections under Virtual Private Cloud:\n\nCreate Peering Connection\n\n2. Click on Create Peering Connection. Provide the Peering connection name tag, VPC (Requester) and VPC (Accepter). Click on Create Peering Connection:",
      "content_length": 360,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 215,
      "content": "Creating Peering Connection\n\n3. In the dashboard, you can see the created peering connection. However the status is Pending Acceptance:\n\nDashboard with Peering Connection Created\n\nOceanofPDF.com",
      "content_length": 194,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 216,
      "content": "Accepting VPC peering\n\nPeering is not complete till the owner of the accepter VPC accepts the peering request. Also, you need to enable the Route Table of the VPC to enable network traffic flow.\n\nOceanofPDF.com",
      "content_length": 210,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 217,
      "content": "Getting ready\n\nLog in to the console with the appropriate permissions. The recipe for Creating VPC peering has to be executed first.\n\nOceanofPDF.com",
      "content_length": 148,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 218,
      "content": "How to do it...\n\nThe steps for accepting VPC peering:\n\n1. Browse to the AWS VPC console. In the left menu option, choose Peering Connections under Virtual Private Cloud. Select the peering connection and browse to Actions | Accept Request:\n\nPeering Connection Actions\n\n2. The following window will open. Click on Yes, Accept. The confirmation window will come with an option to Modify my route tables now; you can click that to go to the Route Tables page. We'll choose Close and do this later:\n\nAccept Peering Connection Request\n\n3. You can see the status has now changed to Active:",
      "content_length": 583,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 219,
      "content": "4. Browse to Actions | Edit DNS Settings. Allow the DNS resolution. Click on the Save button:\n\nDNS setting of Peering Connection\n\n5. You can see that the DNS settings are now enabled. To delete the peering connection, choose Actions | Delete VPC Peering Connection:\n\nPeering Connection Details\n\n6. Go to the VPC associated with the peering connection. Click on the Route Table of one VPC. Click on the Edit button and add the route for",
      "content_length": 435,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 220,
      "content": "VPC peering mentioning the CIDR range of other VPCs as shown. Click on the Save button. Do the same for the other VPC routing table:\n\nRouting for VPC with Peering Connection\n\n7. Now you are ready and the instances of one VPC can communicate with the other VPC peering connection.\n\nOceanofPDF.com",
      "content_length": 295,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 221,
      "content": "There's more...\n\nYou may get an error in the last step when mentioning VPC does not have a public hostname enabled. Select the respective VPC from the VPC console. From Actions | Edit DNS Hostname, select yes and save. Try again and configure VPC Peering.\n\nOceanofPDF.com",
      "content_length": 271,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 222,
      "content": "Configuring routes between multiple VPCs peered together\n\nFor allowing communication between multiple VPCs, you need to create a peering connection between each participating VPC individually. If there are three VPCs, A, B, and C and you want to create a peering connection then you need to create the connection, A-B, B-C and A-C.\n\nOceanofPDF.com",
      "content_length": 347,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 223,
      "content": "Limitations of VPC peering connection\n\nLimitations of VPC peering connection are:\n\nYou cannot create a peering connection between VPCs with an overlapping CIDR range. You cannot create VPC peering between VPCs in different regions. Peering does not support unicast reverse path forwarding. Peering is not transitive. This means, if you have peering between VPC A and B, and you also have another peering between A and C, A and C cannot talk to each other.\n\nOceanofPDF.com",
      "content_length": 471,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 224,
      "content": "Controlling access to VPC peering connections\n\nVPC peering connections can't be created or modified by IAM users by default. An IAM policy allowing VPC peering connections needs to be created and added to an IAM group. Users who need to manage peering connections need to be added to the group.\n\nOceanofPDF.com",
      "content_length": 310,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 225,
      "content": "Configuring VPN connections to your Amazon VPC\n\nBy default, instances in your data center cannot communicate securely to instances in the VPC. Establishing an IPSec VPN enables you to do so. There are three components of a VPN connection which are as follows:\n\nVirtual Private Gateway (VGW) is a part of the VPN connection on the AWS side. AWS provides two redundant IPSec tunnels in the VPC to provide high availability. Customer Gateway (CGW) is a part of the VPN connection on the data center. To have redundant connections for high availability, we need multiple CGWs configured in the data center. It will ensure continuous connectivity, even if one fails. VPN connection that connects between VGW and CGW.\n\nTo have connectivity to multiple data centers, you need to configure different CGWs and configure the VPN channel with the same VGW:",
      "content_length": 845,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 226,
      "content": "Multiple VPN Connection with VPC\n\nSource: http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/images/Branch_Offices_diagram.png\n\nOceanofPDF.com",
      "content_length": 145,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 227,
      "content": "Getting ready\n\nLog in to the console with the appropriate permissions.\n\nOceanofPDF.com",
      "content_length": 86,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 228,
      "content": "How to do it...\n\nThe steps are as follows:\n\n1. Browse to the VPC console. Select the Virtual Private Gateways option under the VPN Connections on the left menu. Click on Create Virtual Private Gateway:\n\nCreate Virtual Private Gateway\n\n2. Provide the Name tag and you can click on Yes, Create. You can see the State as detached:\n\nVirtual private gateway created and detached\n\n3. Click on Attach to VPC. Select the VPC with which you want to attach the VGW. Click on Yes, Attach:",
      "content_length": 477,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 229,
      "content": "Attaching Virtual Private Gateway to VPC\n\n4. You can see that the state has changed to attached after some time. Also, the VPC with which it is attached is shown in detail. If you want to delete a VPG, you need to first detach it and then delete it from the top menu options:\n\nVirtual Private Gateway Created and Attached\n\n5. Select the Virtual Private Gateways option under VPN Connections on the left menu. Click on Create Customer Gateway. Provide the Name tag and IP address, leave Routing as Static. Click on Yes, Create:",
      "content_length": 526,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 230,
      "content": "Create customer gateway\n\n6. You can see the CGW that we created with Status available. You can delete the CGW by clicking the Delete Customer Gateway button when you no longer need it:\n\nCustomer Gateway Details\n\n7. Click on VPN Connections from the left menu option and click on Create VPN Connection. Provide the Name tag, choose the Virtual Private Gateway, Customer Gateway, and click on Yes, Create:",
      "content_length": 403,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 231,
      "content": "Create VPN connection\n\n8. You can see the VPN connection created in the dashboard. You can remove the VPN by clicking the Delete button when you don't need it:\n\nVPN connection details\n\n9. Click on Download Configuration. You can choose the Vendor, Platform, and Software in the window. For now, let's choose Microsoft as the Vendor, Windows Server as the Platform, and 2012 R2 as the Software. Click on Yes, Download to download the configuration file for configuring the router in DC. The content of the file will be like the following:",
      "content_length": 537,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 232,
      "content": "! Amazon Web Services ! Virtual Private Cloud ! To configure this VPN connection using the New Connection Security Rule Wizard ! in the Windows Server 2012 R2 console, use the information below and refer to ! the AWS VPC Network Administrator Guide for more information: ! http://docs.aws.amazon.com/AmazonVPC/latest/NetworkAdminGuide/customer- gateway-windows-2012.html ! Your VPN Connection ID : vpn-70abbb11 ! Your Virtual Private Gateway ID : vgw-68a74c01 ! Your Customer Gateway ID : cgw-7ab15a13 ! Information needed for the configuration of your VPN connection: ! vgw-68a74c01 Tunnel1 ! ------------------------------------------------------------------------ -------- ! Local Tunnel Endpoint: 192.34.56.73 ! Remote Tunnel Endpoint: 34.225.227.231 ! Endpoint 1: [Your_Static_Route_IP_Prefix] ! Endpoint 2: [Your_VPC_CIDR_Block] ! Preshared key: yM2c0CIQsERVaVPHLPP97zt7NMw0U7tu ! vgw-68a74c01 Tunnel2 ! ------------------------------------------------------------------------ -------- ! Local Tunnel Endpoint: 192.34.56.73 ! Remote Tunnel Endpoint: 34.227.145.250 ! Endpoint 1: [Your_Static_Route_IP_Prefix] ! Endpoint 2: [Your_VPC_CIDR_Block] ! Preshared key: jmTUcawwqCh1hs0aPMTdu1kAIhLYOSF2 ! Local Tunnel Endpoint: ! The IP address you entered for your customer gateway when you created ! the VPN connection for your Amazon VPC. ! ! * You should use the private IP address of the Windows Server 2012 R2 ! server rather than this IP address when you enter the Local Tunnel Endpoint ! in the New Connection Security Rule Wizard or in the netsh script below. ! Remote Tunnel Endpoint ! One of two IP addresses for the Amazon virtual private gateway that ! terminates the VPN connection on the AWS side of the connection. ! Endpoint 1 ! The IP prefix that you entered as a static route when you created your ! VPN connection. This indicates the IP addresses in your network that are ! allowed to use the VPN connection to access your Amazon VPC. ! Endpoint 2 ! The IP address range (CIDR block) of your Amazon VPC; for example, 10.0.0.0/16 ! Preshared key ! This is the pre-shared key that is used to establish IPsec VPN connection ! between the Local Tunnel Endpoint and the Remote Tunnel Endpoint. ! Note ! From time to time, AWS will perform routine maintenance on the virtual private ! gateway. This maintenance may disable one of the two tunnels of your VPN ! connection for a brief period of time. Your VPN connection will automatically ! fail over to the second tunnel while this maintenance is performed. To ensure ! uninterrupted service, it's important that you configure both tunnels.",
      "content_length": 2602,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 233,
      "content": "! Configuration Details for IKE and IPsec ! ======================================= ! Additional information regarding the Internet Key Exchange (IKE) and IPsec ! Security Associations (SA) are presented below. Because the AWS VPC VPN ! suggested settings are the same as the Windows Server 2012 R2 default IPsec ! configuration settings, minimal work is needed on your part (see QuickModePFS ! below.) ! MainModeSecMethods: DHGroup2-AES128-SHA1 ! MainModeKeyLifetime: 480min,0sess ! QuickModeSecMethods: ESP:SHA1-AES128+60min+100000kb ! QuickModePFS: DHGroup2 ! MainModeSecMethods ! This specifies the encryption and authentication algorithms for the IKE SA. ! These are the suggested settings for the AWS VPC VPN connection and are the ! default settings for Windows Server 2012 R2 IPsec VPN connections. ! MainModeKeyLifetime ! This specifies the IKE SA key lifetime. This is the suggested setting for ! the AWS VPC VPN connection and is the default setting for Windows Server ! 2012 R2 IPsec VPN connections. ! QuickModeSecMethods ! This specifies the encryption and authentication algorithms for the IPsec SA. ! These are the suggested settings for the AWS VPC VPN connection and are the ! default settings for Windows Server 2012 R2 IPsec VPN connections. ! QuickModePFS ! The use of master key perfect forward secrecy (PFS) is suggested for your ! IPsec sessions. Enabling PFS isn't possible via the Windows Server 2012 R2 ! user interface. The only way to enable this setting is to execute the netsh ! script (below) with QMPFS=dhgroup2 ! Dead Gateway Detection ! ------------------------------------------------------------------------ -------- ! To configure TCP to detect when a gateway becomes unavailable, run the following ! command to enable Dead Gateway Detection: reg add HKLM\\System\\CurrentControlSet\\services\\Tcpip\\Parameters ^ /v EnableDeadGWDetect /t REG_DWORD /d 1 ! After you change the registry key, you must reboot the server. ! Netsh script to configure your IPsec VPN connection ! ------------------------------------------------------------------------ -------- ! You can automatically configure your IPsec VPN connection by copying and pasting ! the netsh scripts below. Replace the items in brackets [] with the appropriate ! values as indicated above. ! Script for Tunnel 1: netsh advfirewall consec add rule Name=\"vgw-68a74c01 Tunnel 1\" ^ Enable=Yes Profile=any Type=Static Mode=Tunnel ^ LocalTunnelEndpoint=[Windows_Server_Private_IP_address] ^",
      "content_length": 2477,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 234,
      "content": "RemoteTunnelEndpoint=34.225.227.231 Endpoint1= [Your_Static_Route_IP_Prefix] ^ Endpoint2=[Your_VPC_CIDR_Block] Protocol=Any Action=RequireInClearOut ^ Auth1=ComputerPSK Auth1PSK=yM2c0CIQsERVaVPHLPP97zt7NMw0U7tu ^ QMSecMethods=ESP:SHA1-AES128+60min+100000kb ^ ExemptIPsecProtectedConnections=No ApplyAuthz=No QMPFS=dhgroup2 ! Script for Tunnel 2: netsh advfirewall consec add rule Name=\"vgw-68a74c01 Tunnel 2\" ^ Enable=Yes Profile=any Type=Static Mode=Tunnel ^ LocalTunnelEndpoint=[Windows_Server_Private_IP_address] ^ RemoteTunnelEndpoint=34.227.145.250 Endpoint1= [Your_Static_Route_IP_Prefix] ^ Endpoint2=[Your_VPC_CIDR_Block] Protocol=Any Action=RequireInClearOut ^ Auth1=ComputerPSK Auth1PSK=jmTUcawwqCh1hs0aPMTdu1kAIhLYOSF2 ^ QMSecMethods=ESP:SHA1-AES128+60min+100000kb ^ ExemptIPsecProtectedConnections=No ApplyAuthz=No QMPFS=dhgroup2 ! Additional Notes and Questions ! - Amazon Virtual Private Cloud Getting Started Guide: ! http://docs.aws.amazon.com/AmazonVPC/latest/GettingStartedGuide ! - Amazon Virtual Private Cloud Network Administrator Guide: ! http://docs.aws.amazon.com/AmazonVPC/latest/NetworkAdminGuide ! - XSL Version: 2009-07-15-1119716\n\nYou configure the router in your data center with this configuration. You are all set for primitively connecting AWS from your data center.\n\nOceanofPDF.com",
      "content_length": 1314,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 235,
      "content": "Configuring Global Scale Infrastructure\n\nIn this chapter, we will learn the following recipes:\n\nCreating a VPC and Subnet from the CLI Creating a VPC to DC Connectivity--VPN Tunneling Creating a VPC with a private subnet and connecting DC Creating a multi-region VPC communication Setting up a private DNS with a VPC Migrating to IPv6\n\nOceanofPDF.com",
      "content_length": 350,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 236,
      "content": "Introduction\n\nIn this chapter, we will learn how to quickly create different AWS VPC networking topologies. We will also learn how to connect two VPCs in the same region or across different AWS regions. Criteria for choosing one of the different available topologies of VPC will depend on the following different considerations:\n\nAvailability of the application deployed to AWS: Single AZ deployment can provide moderate availability. Multi AZ deployments will provide high availability and fault tolerance of a single AZ failure. Multi region deployment will provide very high availability of the application. It will be available even if the complete region of AWS fails. Creating a public and private subnet: Public and private subnets need to be created based on the security requirements of different layers of the application. Connectivity requirement between data center (DC) and AWS Cloud: For securely connecting DC and AWS Cloud, VPN needs to be created. However it works over internet. For high bandwidth and dedicated connectivity, direct connect can be configured. VPN hub can be created for connecting multiple DCs to AWS VPCs. Connectivity amongst different VPCs: Different VPCs in the same or different regions may need to be connected for security and high availability.\n\nAWS provides a VPC wizard for the quick creation of some of these topologies to fit their exact use case.\n\nOceanofPDF.com",
      "content_length": 1410,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 237,
      "content": "Creating a VPC and subnet from the CLI\n\nAWS CLI is a command-line interface that facilitates managing AWS resources from the command line. Until now we have learnt recipes for creating AWS networking components from the console. In this recipe we'll learn how to create them through the CLI. This will help you understand how scripts can be written to automate the management of network components.\n\nOceanofPDF.com",
      "content_length": 414,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 238,
      "content": "Getting ready\n\nYou will need to configure the CLI in your system from which you are going to execute the commands.\n\nOceanofPDF.com",
      "content_length": 130,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 239,
      "content": "How to do it...\n\nFollow the steps provided to create AWS VPC and subnet from CLI.\n\n1. Open your command prompt and give the command:\n\naws ec2 create-vpc --profile user2 --region us-east-1 --cidr-block 10.0.0.0/16 --amazon-provided-ipv6-cidr-block\n\nThe different components of our command are explained as follows:\n\naws ec2 create-vpc: It is the command for creating a VPC profile. user2: It is the user profile with which a VPC is being created. You may omit this if you want to create the VPC with a default profile. region us-east-1: It is the AWS region where the VPC is going to be created. You can omit this if you want to create it in the default region. cidr-block 10.0.0.0/16: It is the IPv4 CIDR block associated with the VPC. amazon-provided-ipv6-cidr-block: It is an option, if you want AWS to associate IPv6 to be with VPC.\n\nCreate VPC from CLI",
      "content_length": 856,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 240,
      "content": "2. You can see the response where a VPC is created with the ID vpc- 23e0795a with a given CIDR range for both IPv4 and IPv6.\n\n3. You can browse to the AWS console for the VPC and check that the VPC has been created with the properties shown in the command prompt.\n\nView VPC created from CLI\n\n4. Now let's create a subnet in the VPC by giving the following command:\n\naws ec2 create-subnet --profile user2 --region us-east-1 --vpc-id vpc- 23e0795a --cidr-block 10.0.1.0/24 --ipv6-cidr-block 2600:1f18:4659:5c00::/64\n\nHere we are providing the profile and region that we explained earlier. We are also providing the following options:\n\nvpc-id vpc-23e0795a: The VPC in which subnet will be created cidr-block 10.0.1.0/24: The IPv4 CIDR range of the subnet ipv6-cidr-block 2600:1f18:4659:5c00::/64: The IPv6 IP range associated with the subnet",
      "content_length": 838,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 241,
      "content": "Create subnet from CLI\n\n5. We can browse to the AWS VPC console and go to subnets. We can see the subnet created as shown in the following screenshot:\n\nView subnet created from CLI\n\nOceanofPDF.com",
      "content_length": 196,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 242,
      "content": "There's more...\n\nHence, you can create multiple VPCs and subnets in multiple regions from a single script. There are multiple other third party tools like Terraform, Chef, Ansible through which you can also create and manage AWS components. You can also use AWS CloudFormation for the same. We will look at some of these in next chapters.\n\nOceanofPDF.com",
      "content_length": 354,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 243,
      "content": "Creating a VPC to DC connectivity--VPN Tunneling\n\nEarlier we learnt how to create a VPC, subnet and a VPN in separate recipes. In this recipe, we will learn how to create those in a single recipe.\n\nOceanofPDF.com",
      "content_length": 212,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 244,
      "content": "Getting ready\n\nLog in to your AWS account with the proper permissions for creating the required components.\n\nOceanofPDF.com",
      "content_length": 123,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 245,
      "content": "How to do it...\n\nAWS provides simple steps for creating basic AWS networking components for first time users.\n\n1. Open the VPC dashboard by browsing https://console.aws.amazon.com/vpc as shown in the following screenshot:\n\nVPC console\n\n2. Click on Start VPC Wizard. We have already provided a recipe for the first option in Chapter 1, Getting Started with AWS Networking Components. The following window will open:\n\nVPC wizard with single public subnet\n\n3. Let's select the option VPC with Public and Private Subnets and Hardware VPN Access. The preceding screenshot explains the components that we are going to create. One VPC",
      "content_length": 627,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 246,
      "content": "One public subnet that can be accessed from the internet One private subnet that can be accessed through a corporate data center One VPN connection that connects the corporate data center to the AWS subnet Service endpoint for connecting services like S3 over a private network\n\nVPC wizard with single public, private subnet, and VPN\n\n4. Click on the Select button. Provide the IPv4 CIDR block, IPv6 CIDR block, VPC name, Public subnet's IPv4 CIDR, Availability Zone for the public subnet, Public subnet name, Private subnet's IPv4 CIDR, Availability Zone for the private subnet, and the Private subnet name as shown in the following screenshot:",
      "content_length": 645,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 247,
      "content": "Create VPC, two subnets, and VPN\n\n5. Click on Add Endpoint. You can choose the subnet to which the endpoint needs to be connected, and access the policy for either full access or customized access. You can add more endpoints by clicking Add Endpoint for attaching multiple endpoints with multiple policies for the target subnet group.",
      "content_length": 334,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 248,
      "content": "Figure 4- 9 Create a VPC endpoint\n\n6. Choose Enable DNS hostnames and Hardware tenancy. Click on Next. 7. Provide the details for the VPN, and click on Create VPC.\n\nVPN configuration\n\n8. You can browse to the VPC Dashboard and find the VPC that we created.",
      "content_length": 256,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 249,
      "content": "Details of the VPC created\n\n9. You can also see the subnets created and associated with the VPC.\n\nSubnets of VPC created\n\n10. You can also see the VPN connection created and associated with the VPC.",
      "content_length": 198,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 250,
      "content": "Subnet with the VPC created\n\n11. You can click on Download Configuration, and download the configuration file after choosing the right options.\n\nVPN configuration download\n\nOceanofPDF.com",
      "content_length": 187,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 251,
      "content": "There's more...\n\nIn the preceding configuration, NAT is not attached to the routes created with the public subnet. So if instances want to have internet connectivity, they can either do that through the DC network or an additional NAT needs to be attached. Instances in a public subnet can access DC either through the internet or through the VPN.\n\nOceanofPDF.com",
      "content_length": 363,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 252,
      "content": "Creating a VPC with a private subnet and connecting DC\n\nSometimes for security purposes, you will want to host instances in AWS and treat it as an extension of the corporate DC. In this case, VPC will only have a private subnet and a VPN connection to the DC for connectivity. In this recipe, we will learn how to create connectivity with the DC, without creating a public subnet.\n\nOceanofPDF.com",
      "content_length": 396,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 253,
      "content": "Getting ready\n\nLog in to your AWS account with proper permissions for creating the required components.\n\nOceanofPDF.com",
      "content_length": 119,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 254,
      "content": "How to do it...\n\n1. Open the VPC dashboard by browsing to https://console.aws.amazon.com/vpc as shown in the following screenshot:\n\nVPC wizard\n\n2. Click on Start VPC Wizard. Let's select the option VPC with a Private Subnet Only and Hardware VPN Access. The screenshot explains the components that we are going to create. One VPC One private subnet that can be accessed through a corporate data center One VPN connection that connects the corporate data center to the AWS subnet Service endpoint for connecting services like S3 over a private network\n\nVPC wizard with Private Subnet and Hardware VPN\n\n3. Click on the Select button. Provide the required details. You can optionally click on Add Endpoint. Click on Next.",
      "content_length": 718,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 255,
      "content": "Details of private subnet and hardware VPN\n\n4. Provide the required details for a VPN connection. Click on Create VPC as shown in the following screenshot:\n\nConfigure VPN\n\n5. Provide the required details for a VPN connection. Click on Create VPC. The VPC will be created. You can then browse to the VPC Dashboard to see the details of the VPC as shown in the following screenshot:",
      "content_length": 380,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 256,
      "content": "Details of VPC created\n\nOceanofPDF.com",
      "content_length": 38,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 257,
      "content": "Creating a multi-region VPC communication\n\nSometimes we need to host applications across multiple VPCs that spread across several regions for hosting a solution in very high demand. In this case, we need to have connectivity between VPCs in different regions. There are multiple options for how this can be achieved. We'll do this using the strongSwan open source software which is an implementation of the IPSEC-based VPN solution.\n\nOceanofPDF.com",
      "content_length": 448,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 258,
      "content": "Getting ready\n\nLog in to your AWS account with proper permissions for creating the required components.\n\nOceanofPDF.com",
      "content_length": 119,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 259,
      "content": "How to do it...\n\n1. Create a VPC from the VPC wizard in the US-West (Oregon) region using the VPC with a Single Public Subnet option with CIDR range 7.0.0.0/16 for VPC and 7.0.0.0/24 for the subnet as shown in the following screenshot:\n\nVPC creation in one region\n\n2. Create another VPC from the VPC wizard in the US-East (Ohio) region using the VPC with a Single Public Subnet option with CIDR range 8.0.0.0/16 for VPC and 8.0.0.0/24 for the subnet as shown in the following screenshot:",
      "content_length": 487,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 260,
      "content": "VPC creation in second region\n\n3. Change the region to US-West (Oregon). Create an EC2 instance in the first region using an AMI for an Ubuntu Server, t2.micro instance type to VPC and the subnet that we created. Configure the security group for allowing traffic for the following: TCP 22 (SSH protocol) from 0.0.0.0/0 UDP 500 (IKE protocol) from 0.0.0.0/0 UDP 4500 (IPSec/UDP) from 0.0.0.0/0 All TCP from 8.0.0.0/16 (second VPC)\n\nNote that you should configure the SG based on your requirements. Also create and store the key.\n\nThe EC2 will look like the following from the console:\n\nDetails of EC2 created in one region\n\n4. Disable source destination and check for the instance.",
      "content_length": 680,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 261,
      "content": "Disabling source destination Check for EC2\n\n5. Attach an elastic IP to the instance. It has a public IP attached to it as shown in the following screenshot:\n\nAttach Elastic IP to one instance\n\n6. Create a similar instance in the US-East (Ohio) region in the VPC and in the subnet that we created. Disable source-destination check. Attach the Elastic IP. The only difference from step 3 is to assign security groups for allowing traffic from the first VPC: TCP 22 (SSH protocol) from 0.0.0.0/0 UDP 500 (IKE protocol) from 0.0.0.0/0 UDP 4500 (IPSec/UDP) from 0.0.0.0/0",
      "content_length": 566,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 262,
      "content": "All TCP from 7.0.0.0/16 (first VPC)\n\nIt should look like the following:\n\nEC2 details in second region\n\n7. Log in to an instance in the Ohio region by following the earlier recipe. The default log in name is ubuntu.\n\nLog in to EC2 in one region",
      "content_length": 243,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 263,
      "content": "8. To enable packet forwarding in the instance, execute the following command:\n\nsudo sysctl -w net.ipv4.ip_forward=1\n\nFigure 4- 27 Configure IPv4 forward\n\n9. Install strongswan in your instance using the following command:\n\nsudo apt-get install -y strongswan\n\nWe need to configure the /etc/strongswan/ipsec.conf file for setting up a connection. This needs to be put in the EC2 instances of both regions. Here is the common part for each:\n\nconfig setup strictcrlpolicy=no charondebug=all conn %default ikelifetime=60m keylife=20m rekeymargin=3m keyingtries=1 keyexchange=ikev2\n\nThis additional section needs to be put in the EC2 instance of Ohio region:\n\nconn Ohio authby=secret auto=start type=tunnel left=8.0.0.85 leftid=52.15.254.68 leftsubnet=8.0.0.0/16 leftauth=psk right=54.148.58.245 rightsubnet=7.0.0.0/16 rightauth=psk ike=aes128-sha1-modp1024 esp=aes128-sha1-modp1024\n\nThis additional section needs to be put in the EC2 instance of Oregon region:",
      "content_length": 956,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 264,
      "content": "conn Oregon authby=secret auto=start type=tunnel left=7.0.0.178 leftid=54.148.58.245 leftsubnet=7.0.0.0/16 leftauth=psk right=52.15.254.68 rightsubnet=8.0.0.0/16 rightauth=psk ike=aes128-sha1-modp1024 esp=aes128-sha1-modp1024\n\nCreate and save the files with your favorite text editor. You can see that the left side represents the IP and CIDR of the EC2 and VPC of the same AWS region the EC2 is being configured. The right side has the details for the other EC2 and VPC of the other AWS region.\n\n10. Create a /etc/strongswan/ipsec.secrets file with your favourite editor with content like the following in both instances. Change the public IP and secret key as per your case.\n\n<local public ip> : PSK \"your key\" <foreign public ip> : PSK \"your key \"\n\n11. Add the following line to the /etc/sysctl.conf file in both the EC2 instances.\n\nnet.ipv4.ip_forward=1\n\n12. Run the following command in both instances:\n\nsysctl -p\n\n13. Go to the routing table attached to the subnet which we created, and add the destination route of the other VPC CIDR and target it as the instance ID which we created.",
      "content_length": 1091,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 265,
      "content": "Configure Route Table for one region\n\n14. Do the same for the routing table for other regions as well.\n\nConfigure Route Table for second region\n\n15. Now execute the following command to start strongswan as a root user:\n\nservice. strongswan start\n\n16. To check the status of the connection, execute the following command:\n\nservice strongswan status\n\nOceanofPDF.com",
      "content_length": 363,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 266,
      "content": "There's more...\n\nYou can ping one server in one region from other server in other region for checking connectivity between EC2 of both regions.\n\nYou should opt for stronger security policies for production use case. For example, the security groups should be open to a specific IP address range or the passphrase should be stronger.\n\nOceanofPDF.com",
      "content_length": 348,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 267,
      "content": "Setting up a private DNS with a VPC\n\nRoute 53 is a very highly available DNS server in AWS. It can work for both external routing as well as internal routing. Internal routing works within the internal network of a VPC where both source and destination services can be connected via internal IPs. It can be used for users or applications to connect within the private network boundary. The private network can be extended to Corporate data center, other VPC in same region connected through VPC peering or VPC in other region connected privately over secure channel.\n\nOceanofPDF.com",
      "content_length": 582,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 268,
      "content": "Getting ready\n\nLog in to your AWS account with proper permissions for creating the required components.\n\nOceanofPDF.com",
      "content_length": 119,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 269,
      "content": "How to do it...\n\n1. Browse to the VPC console and select the VPC in which you want to configure the private DNS. Check if the DNS resolution and DNS Hostnames are yes as shown in the following screesnhot:\n\nCheck VPC DNS resolution and DNS hostnames\n\n2. Browse to https://console.aws.amazon.com/route53/home, to go to the Route 53 home page. You will see in the following page that you don't have any DNS configured yet:\n\nAWS Route 53 dashboard",
      "content_length": 443,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 270,
      "content": "3. Click on Get started now under DNS management. The following window will appear:\n\nCreate hosted zone\n\n4. Click on Create Hosted Zone. Provide a Domain Name and\n\nComment. In the Type drop down choose Private Hosted Zone for Amazon VPC. Select the VPC ID where this service will be configured. Click on the Create button as you can see in the following screenshot:\n\nHosted zone details\n\n5. You will see the default record set associated with this DNS. You can also select the record set and change properties.",
      "content_length": 510,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 271,
      "content": "AWS record set details\n\n6. You can click on Create Record Set to click additional record sets if required. Provide the Name, choose the Type and the routing policy as required. Provide a TTL (Seconds) and Value. Click on Create. I have selected Type as A - IPv4 addresses. I have provided internal IP of EC2 instances which I created earlier as you can see in the following screenshot:\n\nCreate record set\n\n7. You can see the record set created in the following screenshot:",
      "content_length": 472,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 272,
      "content": "Custom record set details for record A\n\n8. You can see the hosted zone created by selecting the Hosted Zones on the menu on the left.\n\nHosted zone created\n\n9. You can add the required VPC by clicking on the Associate New VPC button and selecting the VPC to be associated.\n\n10. If you want to configure the internal domain forwarding requests to elb, the same steps should be followed, only the record Type should be CNAME",
      "content_length": 421,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 273,
      "content": "and the Value is elb DNS name as you can see in the following screenshot:\n\nRecord set for ELB CNAME record\n\nOceanofPDF.com",
      "content_length": 122,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 274,
      "content": "There's more...\n\nDNS hostname and DNS support needs to be enabled for the VPC where you are going to configure the private DNS. By default, these are enabled; otherwise you can do that from the Actions drop-down after selecting the VPC.\n\nOceanofPDF.com",
      "content_length": 252,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 275,
      "content": "Migrating to IPv6\n\nIPv6 support has been added to AWS since December 2016. So VPCs created prior to that didn't have IPv6 support. This recipe shows how to add IPv6 support with VPCs that have been created with the IPv4 option only.\n\nOceanofPDF.com",
      "content_length": 248,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 276,
      "content": "Getting ready\n\nLog in to your AWS account with proper permissions for creating the required components.\n\nOceanofPDF.com",
      "content_length": 119,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 277,
      "content": "How to do it...\n\n1. Open the VPC dashboard by browsing to https://console.aws.amazon.com/vpc. Select the VPC without IPv6 support. You can see that IPv6 CIDR is blank as shown in the following screenshot:\n\nCheck VPC IPv6 CIDR\n\n2. Click Actions | Edit CIDRs. The following window will open. Click on Add IPv6 CIDR button. IPv6 CIDR will be associated. Click Close as shown in the following screenshot:",
      "content_length": 400,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 278,
      "content": "Edit VPC IPv6 CIDR\n\n3. You can see it reflected in the Summary as well:\n\nVPC Summary after IPv6 Support\n\n4. Select the subnet associated with the VPC on which you want to enable IPv6 CIDR.\n\nSubnet summary before IPv6 support\n\n5. Click Subnet Actions and edit IPv6 CIDR. Click on Add IPv6 CIDR. Edit IPv6 CIDR range and click on the tick button. Click on the Close button as seen in the following screenshot:",
      "content_length": 407,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 279,
      "content": "Edit Subnet IPv6 support\n\n6. You can see the IPv6 associated with the subnet from the Summary as seen in the following screenshot:\n\nSubnet summary after IPv6 support\n\n7. NAT instances don't work with IPv6 addresses. To enable the egress of traffic from instances hosted in a private subnet, we need an Egress Only Internet Gateways to be associated with the routing table. So you need to create an Egress-Only Internet Gateway. Click on Egress Only Internet Gateways.",
      "content_length": 467,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 280,
      "content": "Egress Only Internet Gateway dashboard\n\n8. Click on Create Egress Only Internet Gateway. Associate the VPC from the dropdown menu. Click on Create.\n\nCreate Egress Only Internet Gateway\n\n9. Select the Routing Tables from the left menu bar. Select one associated with the private subnet of the VPC. Go to the Routes tab. Click on Edit. Click on Add another route. Put ::/0 in the destination and select the Internet Gateway in the Target. Click on Save.\n\nModify router for IPv6 support\n\n10. Select Security Group from the left menu bar. Select one associated with the subnet of the VPC. Go to the Inbound Rules tab. Click on Edit.",
      "content_length": 628,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 281,
      "content": "Click on Add another rule. Put ::/0 or appropriate IPv6 CIDR range in the source. Click on Save.\n\nSecurity Group Support for IPv6\n\n11. If you have modified the default rules of NACL, you also need to add the configuration for IPv6; as we have not done that, we are skipping this step.\n\n12. Finally you need to assign the IPv6 address to the EC2. Browse to the EC2 Dashboard. In the menu, choose Instances. Select the instance and choose Actions | Networking | Manage IP Address:\n\nIPv6 support for EC2\n\n13. The following window will open. Click on Assign New IP under IPv6 Addresses. Click on Yes, Update. The IPv6 address will be assigned to instance.",
      "content_length": 651,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 282,
      "content": "Manage EC2 IPv6 IP\n\n14. The IPv6 address will be assigned to instance. You can see that in the dashboard.\n\nInstance with IPv6 support\n\nOceanofPDF.com",
      "content_length": 149,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 283,
      "content": "There's more...\n\nAll EC2 instance types are not IPv6 compliant. You can't migrate such instances to IPv6. You need to change the instance type to one that is IPv6 compliant before adding support to IPv6.\n\nOceanofPDF.com",
      "content_length": 219,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 284,
      "content": "Working with Infrastructure Automation\n\nIn this chapter, we will cover the following recipes:\n\nCreating, storing, and testing the template--CloudFormation Creating a new stack--CloudFormation Modifying the stack--CloudFormation Deleting the stack--CloudFormation Setting up Ansible Installing Ansible Creating Ansible playbooks for creating VPC\n\nOceanofPDF.com",
      "content_length": 360,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 285,
      "content": "Introduction\n\nNetworking infrastructure has become increasingly complex and advanced, and managing the configuration of networks has come under increased demands for higher velocity and consistency.\n\nThis chapter will focus on creating basic building blocks, that is, networks using automation scripts. We will be using CloudFormation and Ansible tools for automation. There are sample playbooks for your reference.\n\nCloudFormation provided by AWS gives us the ability to provision and manage AWS resources. CloudFormation templates support a wide range of AWS resources; you can create templates for the services and applications you want to build. You can create or update a stack to provision/manage the resources. You can create a template for managing a single EC2 instance or a highly available multi-tier application. The best part of CloudFormation is it automatically takes care of the sequence required for provisioning resources. There is no additional charge for CloudFormation; you just need to pay for the created resources. It supports YAML and JSON written templates.\n\nAnsible, powered by Red Hat, gives almost the same, and sometimes more, functionalities than other DevOps tools. With Ansible, migrations from anywhere, that is on-premises infrastructure, cloud to AWS, or anywhere become very easy. With Ansible, you can use the same simple playbook .yaml language to manage your infrastructure and deploy your application. Redeploy the application to a different environment by just changing the environment parameters.\n\nOceanofPDF.com",
      "content_length": 1555,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 286,
      "content": "Infrastructure as a Service\n\nInfrastructure as a Service (IaaS) is one of the service models of cloud computing that outsources computer infrastructure to support infrastructure operations. The basic functioning of IaaS is to allow all the hardware, the rack of servers, storage devices, and the network that is kept in the cloud and lets somebody else use it for their basic functioning.\n\nVPC Setup\n\nOceanofPDF.com",
      "content_length": 415,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 287,
      "content": "Why do we need to automate?\n\nThink of a scenario where you have really spent your blood to make things work and suddenly, one day, you get a message in the middle of the night that one of your regions has an API issue and it has started to affect your business. You have tried recovering that server but nothing seems to be fruitful and now you are forced to build the same infrastructure in another region. It is tough for you to even remember the sequence of the commands and the software that needs to be installed. Automation provides an effortless way of writing a piece of code for everything, from creating the network to making everything up and running.\n\nThere are ways in which creating an infrastructure can be automated as per your requirements. Your automation should sense the current region/infrastructure and should directly trigger a new infrastructure in another region in case of any failure.",
      "content_length": 911,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 288,
      "content": "VPC Setup in another region while failure\n\nOceanofPDF.com",
      "content_length": 57,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 289,
      "content": "Infrastructure automation tools\n\nIt always feels good to build an IT infrastructure from scratch, but when you need to do it regularly it's not so great. Sometimes, you are pushing the same commands, building the same type of servers; the easiest way to do it is by automation.\n\nThere are many tools available for automation, so there is no best tool that fits every environment; you should select a tool according to your infrastructure, such as Ansible, CloudFormation, Chef, Puppet, SaltStack, Jenkins, and so on.\n\nIn our example, we will be working on CloudFormation and Ansible.\n\nOceanofPDF.com",
      "content_length": 599,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 290,
      "content": "Creating, storing, and testing the template--CloudFormation\n\nCloudFormation supports creating a VPC and its components for the mentioned CIDR block. We will go through the CloudFormation template and an example (JSON).\n\nOceanofPDF.com",
      "content_length": 234,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 291,
      "content": "Getting ready\n\nBefore creating our first stack, we will need to create a template. CloudFormation templates can be written in JSON or YAML format.\n\nBelow are the basic snippets of various functions that we will be using in our example.\n\nOceanofPDF.com",
      "content_length": 251,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 292,
      "content": "How to do it...\n\nIn this section, we will focus on creating, storing, and testing the template. Let's start with some snippets of the template.\n\nOceanofPDF.com",
      "content_length": 159,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 293,
      "content": "Creating the template\n\nYou can create a template in any text editor such as notepad and save the file with a .json extension.\n\nOceanofPDF.com",
      "content_length": 141,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 294,
      "content": "VPC\n\nThe format for VPC declaration is: AWS::EC2::VPC\n\n{ \"Type\" : \"AWS::EC2::VPC\", \"Properties\" : { \"CidrBlock\" : String, \"EnableDnsSupport\" : Boolean, \"EnableDnsHostnames\" : Boolean, \"InstanceTenancy\" : String, \"Tags\" : [ Resource Tag, ... ] } }\n\nSr. No\n\nProperty\n\nRequired Type\n\nAvailable values\n\n1\n\nCIDRBlock\n\nYes\n\nString\n\nExample:\n\n192.168.0.0/16\n\n2\n\nEnableDnsSupport\n\nNo\n\nBoolean True/False\n\n3\n\nEnableDnsHostnames No\n\nBoolean True/False\n\n4\n\nInstanceTenancy\n\nNo\n\nString\n\n\"default\" / \"dedicated\"\n\n5\n\nTags\n\nNo\n\nString\n\nKey: String Value: String\n\nDefault value\n\nN/A\n\nTRUE\n\nTRUE\n\ndefault\n\nNA",
      "content_length": 591,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 295,
      "content": "Example:\n\n{ \"AWSTemplateFormatVersion\" : \"2010-09-09\", \"Resources\" : { \"VPCTesting\" : { \"Type\" : \"AWS::EC2::VPC\", \"Properties\" : { \"CidrBlock\" : \"10.1.0.0/16\", \"EnableDnsSupport\" : \"false\", \"EnableDnsHostnames\" : \"false\", \"InstanceTenancy\" : \"dedicated\", \"Tags\" : [ {\"Key\" : \"Name\", \"Value\" : “VPC-Dev\"} ] } } } }\n\nOceanofPDF.com",
      "content_length": 329,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 296,
      "content": "Subnet\n\nThe format for subnet declaration is:\n\n{ \"Type\" : \"AWS::EC2::Subnet\", \"Properties\" : { \"AvailabilityZone\" : String, \"CidrBlock\" : String, \"MapPublicIpOnLaunch\" : Boolean, \"Tags\" : [ Resource Tag, ... ], \"VpcId\" : String } }\n\nSno Properties\n\nRequired Type\n\nAvailable values\n\n1\n\nAvailabilityZone\n\nNo\n\nString\n\nExample: “us-east-1a”\n\n2\n\nCIDRBlock\n\nYes\n\nString\n\nExample,\n\n10.0.0.0/16\n\n3\n\nMapPublicIpOnLaunch No\n\nBoolean True/False\n\n4\n\nTags\n\nNo\n\nString\n\nKey: String Value: String\n\n5\n\nVpcId\n\nYes\n\nRef ID Example: \"Ref\": vpc-\n\n12345678\n\nDefault value\n\nAWS automatically selects a zone\n\nNA\n\nFALSE\n\nNA\n\nNA",
      "content_length": 603,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 297,
      "content": "OceanofPDF.com",
      "content_length": 14,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 298,
      "content": "Internet Gateway\n\nThe format for Internet Gateway is:\n\n{ \"Type\" : \"AWS::EC2::InternetGateway\", \"Properties\" : { \"Tags\" : [ Resource Tag, ... ] } }\n\nExample:\n\n\"InternetGateway\" : { \"Type\" : \"AWS::EC2::InternetGateway\", \"Properties\" : { \"Tags\" : [ \"Key\" : \"Name\", \"Value\" : { \"Ref\" : \"AWS::StackName\"} ] } },\n\nOceanofPDF.com",
      "content_length": 322,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 299,
      "content": "Elastic IP\n\nThe format for Elastic IP is:\n\n{ \"Type\" : \"AWS::EC2::EIP\", \"Properties\" : { \"InstanceId\" : String, \"Domain\" : String } }\n\nSno Properties Required\n\nType\n\n1\n\nInstanceId\n\nNo\n\nString\n\n2\n\nDomain\n\nConditional String\n\nExample:\n\n\"EIP\" : { \"Type\" : \"AWS::EC2::EIP\", \"Properties\" : { \"Domain\" : \"vpc\" } }\n\nOceanofPDF.com",
      "content_length": 322,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 300,
      "content": "Nat Gateway\n\nThe format for NAT Gateway is:\n\n{ \"Type\" : \"AWS::EC2::NatGateway\", \"Properties\" : { \"AllocationId\" : String, \"SubnetId\" : String } }\n\nSno Properties Required Type\n\n1\n\nAllocationId Yes\n\nString\n\n2\n\nSubnetId\n\nYes\n\nString\n\nExample:\n\n\"NATGateway\" : { \"Type\" : \"AWS::EC2::NatGateway\", \"DependsOn\": \"VPCGatewayAttach\", \"Properties\" : { \"AllocationId\" : { \"Fn::GetAtt\" : [\"NATGatewayEIP\", \"AllocationId\"]}, \"SubnetId\" : { \"Ref\" : \"PublicSubnet\"} } }\n\nOceanofPDF.com",
      "content_length": 470,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 301,
      "content": "Storing the template\n\nWhen you upload a template in CloudFormation to create your stack, CloudFormation will by default store the template into S3 Upload the source code into S3 and maintain versions of the template It's good to store the template into source control\n\nOceanofPDF.com",
      "content_length": 283,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 302,
      "content": "Testing the JSON template\n\nThere are many tools available for JSON format testing, for example: https://j sonlint.com/.\n\nTesting JSON Template\n\nOceanofPDF.com",
      "content_length": 158,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 303,
      "content": "There's more...\n\nThere are a few best practices that you can follow while creating and storing your templates:\n\nNever embed credentials into the template; use input parameters to pass sensitive information to your environment. Be specific when providing access to any user to CloudFormation because modifying/deleting a CloudFormation stack can lead to unexpected disasters. Use the service role's policy to make calls instead of the user's policy. You can also store templates in a source repository such as GitHub or SVN and use the same template to replicate the environment in other regions. Make sure the resources you specify in the template don't hit the resource limit, otherwise your stack creation will fail. Always validate the template before using it. You can validate it by using CloudFormation or any other third-party tool. To modify the changes in the stack, always use change sets instead of direct updates. Using change sets will help in reviewing the changes. Both types of stack updates are mentioned in further recipes.\n\nOceanofPDF.com",
      "content_length": 1057,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 304,
      "content": "Creating a new stack-- CloudFormation\n\nA Cloudformation stack acts as a single unit to provision and manage your stack. All the resources in the stack are defined in Templates. A stack can include all the resources for creating your multi-tier architecture or a single server, and whenever you don't need the server/infrastructure, you can instantly delete the stack. Deleting the stack will terminate and release all the resources associated with it.\n\nOceanofPDF.com",
      "content_length": 467,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 305,
      "content": "Getting ready\n\nYou will need to have the required permissions for VPC and CloudFormation. Also, keep your CIDR block ready for VPC and subnets. Be very careful when choosing your CIDR block, as you cannot update it later.\n\nOceanofPDF.com",
      "content_length": 237,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 306,
      "content": "How to do it...\n\nThe steps for creating a new stack on CloudFormation are as follows:\n\n1. Log in to the AWS console.\n\nLogin into AWS console\n\n2. Go to CloudFormation service, as shown in the following screenshot:",
      "content_length": 212,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 307,
      "content": "Search CloudFormation\n\n3. Click on Create New Stack, as shown in the following screenshot:\n\nCloudFormation Console\n\n4. The code for Upload a template to Amazon S3 is available at https://github. com/PacktPublishing/AWS-Networking-Cookbook:",
      "content_length": 239,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 308,
      "content": "Select Template\n\n5. Provide a CIDR for your VPC, private, and public subnet, then click on Next, as shown in the following screenshot:\n\nProvide Subnet Details\n\n6. Provide the additional tag if required, then click Next.",
      "content_length": 219,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 309,
      "content": "Provide Additional Tags\n\n7. Review the stack and click Create, as shown in the following screenshot:\n\nReview Stack Creation",
      "content_length": 123,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 310,
      "content": "8. You will get the following screen:\n\nStack Creation\n\n9. Once all the resources have been created, the Status will be updated as CREATE_COMPLETE, as shown in the following screenshot:\n\nStack Overview\n\n10. You will get all the details of the created resources in the Outputs section.",
      "content_length": 283,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 311,
      "content": "Stack Output\n\n11. Now let's check the VPC (AWS Dashboard | VPC | Select Your VPC).\n\nStack: AWS VPC\n\n12. Subnets (AWS Dashboard | VPC | Subnets provides a filter of your VPCs if you have multiple VPCs):",
      "content_length": 201,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 312,
      "content": "Stack: AWS VPC Subnets\n\n13. Tags will look as shown in the following screenshot:\n\nStack: AWS VPC Subnet Tags\n\n14. NAT Gateway (AWS Dashboard | VPC | NAT Gateway or use VPC filter to get the details).",
      "content_length": 199,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 313,
      "content": "Stack: AWS VPC NAT Gateway\n\n15. Internet Gateway (AWS Dashboard | VPC | Internet Gateway):\n\nStack: AWS VPC Internet Gateway\n\n16. Route Table (AWS Dashboard | VPC | Route Table):",
      "content_length": 177,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 314,
      "content": "Stack: AWS VPC Route Table\n\n17. Elastic IP (AWS Dashboard | VPC | Elastic IP):\n\nStack: AWS VPC Elastic IP\n\n18. VPC and all its components have been created successfully.\n\nOceanofPDF.com",
      "content_length": 185,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 315,
      "content": "How it works...\n\nTemplates define all the resources that need to be created, so when you create a stack, CloudFormation makes the underlying service calls to AWS to provision and configure your resources. CloudFormation resource creation does not depend on how you mention them in your template until you specify to create the resources one after another. You can use the DependsOn attribute to specify the creation of your resources.\n\nOceanofPDF.com",
      "content_length": 450,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 316,
      "content": "Modify the stack--CloudFormation\n\nNow, we will modify/update the stack. For modifying, we will use the same template and add one more subnet into the VPC. CloudFormation provides two methods for modifying your stack:\n\n1. Direct update:\n\nWhen you submit the changes, CloudFormation deploys them immediately You want to have a quick update on the stack Works well when you are sure of the changes\n\n2. Change sets:\n\nWill allow you to preview the changes Will not make the changes until you execute the change set Provides a JSON formatted document to summarize the changes Creates multiple change sets of different changes by providing a modified template\n\nOceanofPDF.com",
      "content_length": 668,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 317,
      "content": "Getting ready\n\nBefore going forward into this recipe, make sure you know how you want to update your changes. If you are sure with your changes, then select the direct update method, otherwise it is always preferred to use change sets (as we get time to review the changes).\n\nOceanofPDF.com",
      "content_length": 290,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 318,
      "content": "How to do it...\n\nThe following subsection will include how to make use of change sets and direct updates as a part of the CloudFormation update.\n\nOceanofPDF.com",
      "content_length": 160,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 319,
      "content": "Using change sets\n\nThe steps to create change sets are as follows:\n\n1. In the CloudFormation console, select your stack.\n\nCloudFormation Stack\n\n2. Select Actions | Create Change Set For Current Stack.\n\nModify Stack\n\n3. Select Upload a template to Amazon S3, upload the updated template from https://github.com/PacktPublishing/AWS-Networking-Cookbook and click Next.",
      "content_length": 365,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 320,
      "content": "Upload the modified template\n\n4. On the Specify Details page, current stack values will be available, as shown in the following screenshot:\n\nCurrent VPC details",
      "content_length": 160,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 321,
      "content": "5. Provide Change Set name, brief Description, and PublicSubnetCIDR2. Then choose Next.\n\nProvide modified VPC details\n\n6. On the Options page, we can go for additional changes (such as stack's service role, stack tags, or Amazon SNS notification topic), and then click Next.\n\nProvide Additional tags\n\n7. Review the changes to the Change Set and click Create Change Sets.",
      "content_length": 370,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 322,
      "content": "Review and Create Change Set\n\n8. Once the change set review has been completed, the Status will be CREATE_COMPLETE.\n\nChange Set Status\n\n9. The change set will be available at the CloudFormation console, select stack and Change Sets.",
      "content_length": 232,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 323,
      "content": "Change Sets Details\n\n10. Let's check each section of the change set.\n\nChanges:\n\nChange Set: Changes\n\nChange Set input:",
      "content_length": 118,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 324,
      "content": "Change Set: Change Set Input\n\nDetails:\n\nChange Set: Changes Details\n\nTemplate: Will show the entire updated template\n\n11. Once all looks good, you can make the changes by executing the change set. (Change set | Execute).",
      "content_length": 220,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 325,
      "content": "Update Stack\n\n12. All the change sets have been deleted and the stack Status is UPDATE_IN_PROGRESS.\n\nCloudFormation Stack Status\n\n13. Now the Stack status is UPDATE_COMPLETE and the new subnet can be seen in the output section.",
      "content_length": 227,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 326,
      "content": "CloudFormation Updated Output\n\nOceanofPDF.com",
      "content_length": 45,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 327,
      "content": "Using direct update\n\nIn this example, we will be adding a private subnet in the VPC.\n\n1. Log in to the CloudFormation console and select the stack that you want to update.\n\n2. Choose Action | Update stack.\n\nCloudFormation Stack Direct Update\n\n3. Provide the updated file and click Next. The file is available at https://githu b.com/PacktPublishing/AWS-Networking-Cookbook.\n\nUpload template to update Stack\n\n4. Provide the Private SubnetCIDR : 10.0.4.0/24.",
      "content_length": 455,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 328,
      "content": "Provide Updated Subnet Details\n\n5. In the Options tab, add or update tags if required, otherwise click Next. 6. Review the changes.\n\nReview Updation",
      "content_length": 148,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 329,
      "content": "CloudFormation Update Stack\n\n7. The updated process can be seen in the Events section.\n\nCloudFormation Stack updation in process\n\n8. The Outputs section will give the details of created resources. For example, Subnet ID.",
      "content_length": 220,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 330,
      "content": "CloudFormation Updated Output\n\nOceanofPDF.com",
      "content_length": 45,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 331,
      "content": "Deleting the stack-- CloudFormation\n\nThink twice before performing this step, as deleting the stack will delete all the resources associated with it. You can delete a stack by using the AWS console or CLI.\n\nOceanofPDF.com",
      "content_length": 221,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 332,
      "content": "Getting ready\n\nFollow the steps to delete the stack. The following are a few points to remember:\n\n1. After stack deletion has begun, you cannot stop it. The stack proceeds to the DELETE_IN_PROGRESS state.\n\n2. Stack deletion will delete all the resources associated with it. 3. By default, deleted stacks will not be visible in CloudFormation. To view the deleted stacks, change the filter to Deleted.\n\n4. Templates of deleted stacks will be available in S3 as well.\n\nOceanofPDF.com",
      "content_length": 481,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 333,
      "content": "How to do it...\n\nThe steps to delete a CloudFormation stack:\n\n1. Log in to the CloudFormation console and select the stack.\n\nCloudFormation Stack\n\n2. Click Actions | Delete stack. 3. Click Yes, Delete when prompted.\n\nDelete CloudFormation Stack\n\n4. Stack status will change to DELETE_IN_PROGRESS.",
      "content_length": 296,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 334,
      "content": "CloudFormation Stack Delete Status\n\n5. Stacks can be viewed by changing the filter to Deleted.\n\nGet Deleted CloudFormation Stack\n\nOceanofPDF.com",
      "content_length": 144,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 335,
      "content": "There's more...\n\nUse the following command to delete the stack using CLI:\n\n# aws cloudformation delete-stack --stack-name VPC-Dev\n\nOceanofPDF.com",
      "content_length": 145,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 336,
      "content": "Setting up Ansible\n\nAnsible is an automation tool for the configuration, provisioning, and management of cloud and on-prem resources. It makes a difference in the way of deployment as it is an SSH-based tool and comes with a very easy and secure connection. It is very easy to get started with Ansible for people coming from a Linux background.\n\nAnsible is an agentless tool, you need to install it in on one controller machine and whenever you want to make a deployment, run it from your controller machine, provide the host list, and deploy it in all the nodes. All commands are run through Ansible via SSH, and if Ansible needs updating, you only need to update your single control machine.\n\nYou can also check the version and software status, for example, if you want to check whether Apache is installed on all the machines or not, Ansible will give you a machine list where Apache is not installed and will allow you to install it on those machines keeping the other machines untouched.\n\nOceanofPDF.com",
      "content_length": 1008,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 337,
      "content": "Getting ready\n\nPlaybooks are written in .yaml and tend to follow a process with minimum syntax. Each playbook can have one or more plays on the list. An Ansible playbook is the simplest way to achieve configuration management, orchestration, and multimachine deployment.\n\nOceanofPDF.com",
      "content_length": 286,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 338,
      "content": "How to do it...\n\nLet's look at VPC and other resource creation snippets:\n\n1. VPC creation example:\n\nec2_vpc: state: present cidr_block: 10.0.0.0/16 resource_tags: { \"Environment\":\"Development\" } region: us-west-2\n\n2. Subnet creation example:\n\nsubnets: - cidr: 172.22.1.0/24 az: us-west-2c resource_tags: { \"Environment\":\"Dev\", \"Tier\" : \"Web\" }\n\n3. Internet Gateway:\n\ninternet_gateway: True route_tables: - subnets: - 172.22.2.0/24 - 172.22.3.0/24 routes: - dest: 0.0.0.0/0 gw: igw\n\n4. Creating a NAT Gateway:\n\nname: Create new nat gateway and allocate new EIP. ec2_vpc_nat_gateway: state: present subnet_id: subnet-12345678 wait: yes region: ap-southeast-2 register: new_nat_gateway\n\n5. Deleting a VPC:\n\nec2_vpc: state: absent vpc_id: vpc-aaaaaaa region: us-west-2",
      "content_length": 764,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 339,
      "content": "OceanofPDF.com",
      "content_length": 14,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 340,
      "content": "Installing Ansible\n\nThere are several ways to install Ansible. We will be cloning the full repository from Git and then installing it. The following are the steps:\n\n1. Log in to the EC2 console (the steps have already been provided in Cha pter 2, Building Your Own Custom VPC, in recipe, Managing EC2 instances).\n\n2. Launch an EC2 server (the steps have already been provided in Chapter 2, Building Your Own Custom VPC, in recipe, Managing EC2 instances).\n\nEC2 Server\n\n3. Log in to the server.",
      "content_length": 493,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 341,
      "content": "EC2 Linux Server Login\n\n4. Install Ansible (RHEL/Ubuntu). 5. Change the hostname.\n\n[root@ip-172-31-18-87 ~] # hostname ansible\n\n6. Check whether Python is installed with 2.x version (because a version below 2.x is not compatible with Ansible).\n\n[root@ansible ~]# python -V Python 2.7.12\n\n7. Enable the EPEL repository on Amazon Linux. Go to your yum.repos.d folder and enable epel.repo (modify enabled=0 to enabled=1).\n\n[root@ansible ansible]# vim /etc/yum.repos.d/epel.repo",
      "content_length": 474,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 342,
      "content": "Enable EPEL Repo\n\n8. Type – esc :wq. 9. Follow the following steps to install Ansible:\n\n[root@ansible ~ ]# yum install ansible Loaded plugins: priorities, update-motd, upgrade-helper ... Installed: ansible.noarch 0:2.3.1.0-1.el6 Dependency Installed: python-crypto2.6.x86_64 0:2.6.1-2.el6 python-jinja2- 26.noarch 0:2.6-3.el6 python-keyczar.noarch 0:0.71c-1.el6 python26.x86_64 0:2.6.9-2.88.amzn1 python26-PyYAML.x86_64 0:3.10-3.10.amzn1 python26-babel.noarch 0:0.9.4-5.1.8.amzn1 python26-backports.x86_64 0:1.0-3.14.amzn1 python26-backports- ssl_match_hostname.noarch 0:3.4.0.2-1.12.amzn1 python26-crypto.x86_64 0:2.6.1-1.14.amzn1 python26-ecdsa.noarch 0:0.11-3.3.amzn1 python26-httplib2.noarch 0:0.7.7-1.5.amzn1 python26-libs.x86_64 0:2.6.9-2.88.amzn1 python26-markupsafe.x86_64 0:0.11-4.6.amzn1 python26- paramiko.noarch 0:1.15.1-1.5.amzn1 python26-pyasn1.noarch 0:0.1.7-2.9.amzn1 python26- setuptools.noarch 0:12.2-1.32.amzn1 python26-simplejson.x86_64 0:3.6.5-1.12.amzn1 python26-six.noarch 0:1.8.0-1.23.amzn1 sshpass.x86_64 0:1.06-1.el6 Complete!",
      "content_length": 1052,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 343,
      "content": "10. Follow these steps if you want to install the latest version of Ansible (Ansible 2.4.1.0):\n\n[root@ansible ~ ]# yum install git -y [root@ansible ~ ]# mkdir ansibletmp [root@ansible ~ ]# cd ./ansibletmp [root@ansible ansibletmp ]# git clone git://github.com/ansible/ansible.git –recursive Cloning into '–recursive'... remote: Counting objects: 267737, done. remote: Compressing objects: 100% (28/28), done. remote: Total 267737 (delta 11), reused 1 (delta 0), pack-reused 267709 Receiving objects: 100% (267737/267737), 76.53 MiB | 13.51 MiB/s, done. Resolving deltas: 100% (170624/170624), done. Checking connectivity... done. [root@ansible ansibletmp ]# cd ./ansible [root@ansible ansible]# source ./hacking/env-setup [root@ansible ansible]# ansible --version ansible 2.4.0 config file = None configured module search path = [u'/root/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules'] ansible python module location = /usr/local/lib/python2.7/site- packages/ansible-2.4.0-py2.7.egg/ansible executable location = /root/ansible/bin/ansible python version = 2.7.12 (default, Sep 1 2016, 22:14:00) [GCC 4.8.3 20140911 (Red Hat 4.8.3-9)]\n\n11. You can set up the host file for adding different hosts, but here we will be creating a VPC so we can skip the host entry.\n\n12. As we are using Amazon AMI, AWS CLI is already installed, otherwise it can be installed using the following commands:\n\n[root@ansible ansible]# yum install python-pipOr [root@ansible ansible]# curl -O https://bootstrap.pypa.io/get-pip.py [root@ansible ansible]# python get-pip.py [root@ansible ansible]# pip install awscli [root@ansible ansible]# aws --version [root@ansible ansible]# aws configure\n\n13. Ansible has been installed successfully.\n\nOceanofPDF.com",
      "content_length": 1744,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 344,
      "content": "Creating Ansible playbooks for creating VPC\n\nWe will be creating Ansible playbooks for managing VPC.\n\nOceanofPDF.com",
      "content_length": 116,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 345,
      "content": "How to do it...\n\nThe following are the steps for creating Ansible playbooks:\n\n1. Create a new playbook. The folder structure will be as follows:\n\n[root@ansible ~ ]# cd /etc/ansible/ [root@ansible ansible]# mkdir playbook [root@ansible ansible]# mkdir playbook/roles [root@ansible ansible]# mkdir playbook/roles/vpc [root@ansible ansible]# mkdir playbook/roles/vpc/{defaults,tasks} [root@ansible ansible]# cd playbook\n\n2. Create the configuration file in the playbook folder awsvpc.yml.\n\n[root@ansible playbook]# vim awsvpc.yml --- - name: Create VPC hosts: localhost gather_facts: no roles: - vpc\n\n1. Create a file inventory in playbook folder and can be found at https://gith ub.com/PacktPublishing/AWS-Networking-Cookbook.\n\n[root@ansible playbook]# vim inventory [local] localhost ansible_connection=local\n\n2. Create a file main.yml in playbook/roles/vpc/tasks/ folder. This file will contain the configurations required for your VPC and can be found at https://github.com/PacktPublishing/AWS-Networking-Cookbook.\n\n[root@ansible playbook]# vim roles/vpc/tasks/main.yml --- - name: Create VPC inside mention region ec2_vpc: state: present cidr_block: \"{{ vpc_cidr_block }}\" region: \"{{ vpc_region }}\" resource_tags: { \"Name\":\"{{ vpc_name }}-vpc\" } subnets: - cidr: \"{{ public_cidr_1 }}\" # Private Subnet 1 az: \"{{ vpc_region }}a\" resource_tags: { \"Name\":\"{{ vpc_name }}-private-subnet\" } - cidr: \"{{ public_cidr_2 }}\" # Public Subnet 2",
      "content_length": 1436,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 346,
      "content": "az: \"{{ public_az_2 }}\" resource_tags: { \"Name\":\"{{ vpc_name }}-{{ public_az_2 }}-public- subnet\" } internet_gateway: yes route_tables: - subnets: - \"{{ public_cidr_2 }}\" routes: - dest: 0.0.0.0/0 gw: igw register: vpc\n\n3. Create a file main.yml in playbook/roles/vpc/defaults/ folder and can be found at https://github.com/PacktPublishing/AWS-Networking-Cookbook. This file will contain the VPC details required for your VPC. For example: VPC name, region, and so on. [root@ansible playbook]# vim roles/vpc/defaults/main.yml --- vpc_name: dev-vpc vpc_region: us-west-2 # Oregon vpc_cidr_block: 10.0.0.0/16 public_cidr_1: 10.0.10.0/24 public_az_1: \"{{ vpc_region }}a\" public_cidr_2: 10.0.20.0/24 public_az_2: \"{{ vpc_region }}b\"\n\n4. Run the playbook by providing following commands:\n\n[root@ansible playbook]# ansible-playbook -i inventory awsvpc.yml PLAY [Create VPC] ****************************************************************** ****************************************************************** ****************** TASK [vpc : Create VPC inside mention region] ****************************************************************** ******************************************************** changed: [localhost] PLAY RECAP ****************************************************************** ****************************************************************** ************************* localhost : ok=1 changed=1 unreachable=0 failed=0 # If you get any error try checking in verbose by adding -vvv in the end [root@ip-172-31-12-123 playbook]# ansible-playbook -i inventory awsvpc.yml -vvv Using /etc/ansible/ansible.cfg as config file PLAYBOOK: awsvpc.yml ****************************************************************** ****************************************************************** *************** 1 plays in awsvpc.yml PLAY [Create VPC] ******************************************************************",
      "content_length": 1909,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 347,
      "content": "****************************************************************** ****************** META: ran handlers TASK [vpc : Create VPC inside mention region] ****************************************************************** ******************************************************** task path: /etc/ansible/playbook/roles/vpc/tasks/main.yml:3 Using module file /usr/lib/python2.6/site- packages/ansible/modules/cloud/amazon/_ec2_vpc.py <localhost> ESTABLISH LOCAL CONNECTION FOR USER: root <localhost> EXEC /bin/sh -c 'echo ~ && sleep 0' <localhost> EXEC /bin/sh -c '( umask 77 && mkdir -p \"` echo /root/.ansible/tmp/ansible-tmp-1498048548.85-61490596099452 `\" && echo ansible-tmp-1498048548.85-61490596099452=\"` echo /root/.ansible/tmp/ansible-tmp-1498048548.85-61490596099452 `\" ) && sleep 0' <localhost> PUT /tmp/tmpeDeueO TO /root/.ansible/tmp/ansible-tmp- 1498048548.85-61490596099452/_ec2_vpc.py <localhost> EXEC /bin/sh -c 'chmod u+x /root/.ansible/tmp/ansible-tmp-1498048548.85-61490596099452/ /root/.ansible/tmp/ansible-tmp-1498048548.85- 61490596099452/_ec2_vpc.py && sleep 0' <localhost> EXEC /bin/sh -c '/usr/bin/python /root/.ansible/tmp/ansible-tmp-1498048548.85- 61490596099452/_ec2_vpc.py; rm -rf \"/root/.ansible/tmp/ansible- tmp-1498048548.85-61490596099452/\" > /dev/null 2>&1 && sleep 0' ok: [localhost] => { \"changed\": false, \"igw_id\": \"igw-993d9ffe\", \"invocation\": { \"module_args\": { \"aws_access_key\": null, \"aws_secret_key\": null, \"cidr_block\": \"10.0.0.0/16\", \"dns_hostnames\": true, \"dns_support\": true, \"ec2_url\": null, \"instance_tenancy\": \"default\", \"internet_gateway\": true, \"profile\": null, \"region\": \"us-west-2\", \"resource_tags\": { \"Name\": \"dev-vpc-vpc\" }, \"route_tables\": [ { \"routes\": [ { \"dest\": \"0.0.0.0/0\", \"gw\": \"igw\" } ], \"subnets\": [ \"10.0.20.0/24\" ] } ], \"security_token\": null, \"state\": \"present\", \"subnets\": [",
      "content_length": 1838,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 348,
      "content": "{ \"az\": \"us-west-2a\", \"cidr\": \"10.0.10.0/24\", \"resource_tags\": { \"Name\": \"dev-vpc-private-subnet\" } }, { \"az\": \"us-west-2b\", \"cidr\": \"10.0.20.0/24\", \"resource_tags\": { \"Name\": \"dev-vpc-us-west-2b-public-subnet\" } } ], \"validate_certs\": true, \"vpc_id\": null, \"wait\": false, \"wait_timeout\": \"300\" } }, \"subnets\": [ { \"az\": \"us-west-2a\", \"cidr\": \"10.0.10.0/24\", \"id\": \"subnet-11edb558\", \"resource_tags\": { \"Name\": \"dev-vpc-private-subnet\" } }, { \"az\": \"us-west-2b\", \"cidr\": \"10.0.20.0/24\", \"id\": \"subnet-efb2b388\", \"resource_tags\": { \"Name\": \"dev-vpc-us-west-2b-public-subnet\" } } ], \"vpc\": { \"cidr_block\": \"10.0.0.0/16\", \"dhcp_options_id\": \"dopt-0d8ab268\", \"id\": \"vpc-b647b3d0\", \"region\": \"us-west-2\", \"state\": \"available\" }, \"vpc_id\": \"vpc-b647b3d0\" } META: ran handlers META: ran handlers PLAY RECAP ****************************************************************** ****************************************************************** ************************* localhost : ok=1 changed=0 unreachable=0 failed=0 [root@ip-172-31-12-123 playbook]#\n\n3. VPC and subnets are now available in the AWS console:",
      "content_length": 1101,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 349,
      "content": "4. Private subnet without IGW.\n\n5. Public subnet with IGW.\n\nAnsible: VPC\n\nAnsible: VPC Subnet",
      "content_length": 93,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 350,
      "content": "Ansible: Public Subnet Route Table\n\nOceanofPDF.com",
      "content_length": 50,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 351,
      "content": "There's more...\n\nThe following are a few sample playbooks for various VPC configurations. You can use the following playbooks by replacing main.yml in (/etc/ansible/playbook/roles/tasks/main.yml).\n\nUse the following code to create a VPC with a single public subnet (https://git hub.com/PacktPublishing/AWS-Networking-Cookbook):\n\n--- - name: Create VPC inside mention region ec2_vpc: state: present cidr_block: \"{{ vpc_cidr_block }}\" region: \"{{ vpc_region }}\" resource_tags: { \"Name\":\"{{ vpc_name }}-vpc\" } subnets: - cidr: \"{{ public_cidr_1 }}\" # Public Subnet-1 az: \"{{ public_az_1 }}\" resource_tags: { \"Name\":\"{{ vpc_name }}-{{ public_az_1 }}-public-subnet\" } internet_gateway: yes route_tables: \"{{ public_subnet_rt }}\" - subnets: - \"{{ public_cidr_1 }}\" routes: - dest: 0.0.0.0/0 gw: igw register: vpc\n\nUse following code to create VPC with private subnet and NAT Gateway (ht tps://github.com/PacktPublishing/AWS-Networking-Cookbook):\n\n--- - name: Create VPC inside mention region ec2_vpc: state: present cidr_block: \"{{ vpc_cidr_block }}\" region: \"{{ vpc_region }}\" resource_tags: { \"Name\":\"{{ vpc_name }}-vpc\" } internet_gateway: yes register: new_vpc - name: Create private subnet ec2_vpc_subnet: state: present vpc_id: \"{{ new_vpc.vpc_id }}\" az: \"{{ public_az_1 }}\" cidr: \"{{ public_cidr_1 }}\" # Private Subnet-1 region: \"{{ vpc_region }}\" resource_tags: { \"Name\":\"{{ vpc_name }}-{{ public_az_1 }}-private-subnet\" }",
      "content_length": 1424,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 352,
      "content": "vpc_id: \"{{ new_vpc.vpc_id }}\" register: private_subnet - name: Create new nat gateway using an EIP address ec2_vpc_nat_gateway: state: present subnet_id: \"{{ private_subnet.subnet.id }}\" wait: yes region: \"{{ vpc_region }}\" if_exist_do_not_create: true register: vpc_nat_gateway - name: Modify private subnet ec2_vpc_route_table: vpc_id: '{{ new_vpc.vpc_id }}' region: '{{ vpc_region }}' subnets: \"{{ private_subnet.subnet.id }}\" routes: - dest: 0.0.0.0/0 gateway_id: \"{{ vpc_nat_gateway.nat_gateway_id }}\"\n\nOceanofPDF.com",
      "content_length": 523,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 353,
      "content": "Working with Route 53\n\nIn this chapter, we will cover the following recipes:\n\nRegistering a new domain Transferring a domain into Amazon Route 53 Creating hosted zones and record sets Deleting a public hosted zone Creating an Alias record set Creating a private hosted zone Working with the weighted routing policy Working with the failover routing policy and health checks\n\nOceanofPDF.com",
      "content_length": 389,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 354,
      "content": "Introduction\n\nRoute 53 is a highly available and scalable domain name service and primarily provides the following four functionalities:\n\nDomain management: Allows you to register a new domain and transfers the existing domain DNS management:\n\nRoute 53 translates friendly domain names such as abc.com into IP addresses such as 1.2.3.4. Route 53 uses its authoritative DNS server across a global network to respond to DNS queries, which helps in reducing latency. Route 53 can route internet traffic to CloudFront distribution, Elastic Beanstalk endpoint, ELB record, or S3 bucket. Also, there's no extra charge for DNS queries to these resources.\n\nTraffic management Health check of the domain:\n\nRoute 53 monitors the health of your resources, such as web and email servers Route 53 health checkers are placed globally Route 53 automatically sends a request over the internet to the application to verify that it's reachable, available, and functional You can also configure CloudWatch alarms to send a notification when a resource becomes unavailable Route 53's failover policy helps in reconfiguring internet traffic away from resources that are unavailable or have failed health checks\n\nOceanofPDF.com",
      "content_length": 1205,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 355,
      "content": "How does Route 53 DNS works?\n\nThe domain name system provides a mapping between human-readable names such as www.abc.com and the IP of their associated servers.\n\nWhen you type an address in your browser www.abc.com:\n\nThe operating system will first check the DNS in its local cache. Then it will look for the DNS in your LAN. Then the query will be forwarded to your DNS cache server (generally your ISP).\n\nThese DNS cache servers are called not authoritative DNS servers.\n\nThe request is then forwarded to the authoritative root name server responsible for maintaining a list of name servers for each of the top- level domains (.com, .org, and so on). Based on TLD, the request goes to the authoritative top-level domain name server responsible for maintaining a list of name servers for all domains (www.gmail.com, www.wikipedia.org, and so on). Its job is to query name servers to find and return the authoritative name server for the requested domain.\n\nOceanofPDF.com",
      "content_length": 971,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 356,
      "content": "Supported DNS resource record types\n\nAddress (A) record IPv4 address <Value>192.0.2.1</Value>\n\nAAAA record\n\nIPv6 address <Value>2001:0db8:85a3:0:0:8a2e:0370:7334</Value>\n\nCNAME record\n\nCanonical/Alternative Domain Name <Value>hostname.example.com</Value>\n\nMail Xchange (MX) record\n\nDomain name of a mail host <Value>10 mail.example.com</Value>\n\nName Server (NS) record Name Servers Record <Value>ns-1.example.com</Value>\n\nPTR record\n\n<Value>hostname.example.com</Value>\n\nStart of Authority (SOA) record:\n\nInformation stored in the DNS zone about that zone and about other DNS records 7 fields: Primary authority, Contact detail, zone serial number, refresh time, retry time, expire time, and minimum time to live (TTL) <Value>ns-2048.awsdns-64.net hostmaster.awsdns.com 1 1 1 1 60</Value>\n\nSender Policy Framework (SPF) record\n\nUsed for verifying the identity of sender email messages We recommend creating a TXT record instead of SPF <Value>\"v=spf1 ip4:192.168.0.1/16 -all\"</Value>",
      "content_length": 982,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 357,
      "content": "SRV record\n\nService record 4 values: priority, weight, port, and domain name <Value>10 5 80 hostname.example.com</Value>\n\nTXT record\n\nIt contains a space-separated list of double-quoted strings\n\nOceanofPDF.com",
      "content_length": 209,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 358,
      "content": "Alias resource record\n\nRoute 53 supports alias records that give the flexibility to point our custom endpoints to the resource record set and TLD (abc.com) You can create alias record for CloudFront distribution, Elastic Beanstalk endpoint, ELB Endpoint, S3 bucket, or any other Route 53 resource record set You can use Alias record to point an apex zone (root domain without www, for example: google.com) to any custom DNS name As ELB and other resources change their IP frequently, Route 53 Alias makes this task easier by reflecting those changes automatically without making any changes to the hosted zone If an Alias resource record set points to a CloudFront distribution, a load balancer, or an S3 bucket, the time to live (TTL) can't be set; Route 53 uses the CloudFront, load balancer, or Amazon S3 TTLs\n\nOceanofPDF.com",
      "content_length": 828,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 359,
      "content": "Routing policies\n\nRoute 53 supports the below routing policies:\n\nSimple routing policy:\n\nWhen you have a single resource for your domain to route your traffic Example: IP address in an A record\n\nWeighted routing policy:\n\nWhen you have multiple resources to perform the same role For example: Route traffic to different resources in specified balances (weights) for example, 30% to one server and the remaining 40% to the other resource These resources can be a part of the same hosting group and can be on-premise as well You can also set up an active-active routing policy by setting up 50% weight to both the resources\n\nLatency-based Routing (LBR) policy:\n\nRoute 53 routes traffic, based on which the data center gives the user the lowest network latency\n\nFailover routing policy:\n\nRoute 53 allows an active-passive failover setup, where the primary resource responds to all traffic while keeping the secondary resource idle If the primary resource becomes unavailable, the other resource takes all the traffic Geolocation routing policy:\n\nRoute 53 uses a geo-IP database and responds to DNS queries based on the user's geographic location\n\nOceanofPDF.com",
      "content_length": 1157,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 360,
      "content": "Registering a new domain\n\nYou can find the available domains and registers using Route 53. It also supports registering an existing domain that you registered with other registrars. This recipe will explain how to register a new domain.\n\nOceanofPDF.com",
      "content_length": 252,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 361,
      "content": "Getting ready\n\nYou will need access to the Route 53 service and will need the below details as a part of the domain registration:\n\nAccess to the email ID for domain confirmation Keep your domain name ready\n\nOceanofPDF.com",
      "content_length": 221,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 362,
      "content": "How to do it...\n\n1. Log in to the AWS console and select Route 53. 2. Navigate to domain registration and click on Get started now.\n\nDomain Registration: Get Started\n\n3. Click on Register Domain.\n\nRegister domain\n\n4. Type the domain name that you want to register and click Check to find out whether the domain name is available. This will give you multiple similar options in Related Domain Suggestions.",
      "content_length": 404,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 363,
      "content": "Choose domain name\n\n5. Select the desired domain, click Add to Cart, and click Continue at the bottom of the page.\n\n6. Provide your contact details, as asked, and click Continue.\n\nProvide contact details\n\n7. Review the information you entered and read the terms of service. Select I have read and agree to the AWS Domain Name Registration Agreement, then click Complete Purchase.",
      "content_length": 379,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 364,
      "content": "Review and complete domain registration\n\nOceanofPDF.com",
      "content_length": 55,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 365,
      "content": "There's more...\n\nOnce the domain registration is complete, the next step is to create a DNS, but when you register a domain from AWS Route 53, it registers a hosted zone automatically. A DNS can be created in Route 53 or you can use other providers. The usual renewal period of a domain is 1 year, some TLD (Top Level Domains) provide longer subscriptions as well. Wisely select the domain expiry. The period during which you can renew a domain varies from different TLDs.\n\nThe values that Route 53 returns after registration are as follows:\n\nRegistered on: The date on which the domain is registered Expires on: The date and time (in GMT) when the domain is going to expire Domain name status code: Current status of the domain (Example: Registering, transferring, or renewing a domain) Transfer Lock: Enabled or Disabled (Enable the lock to reduce the possibility of transferring your domain to other registrars) Auto renew: Route 53 to automatically renew your domain or not Authorization code: This code is required for transferring the domain to any other registrar Name servers: List of name servers that are going to respond to the DNS queries for the domain.\n\nOceanofPDF.com",
      "content_length": 1182,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 366,
      "content": "Transferring a domain into Amazon Route 53\n\nYou can transfer a domain from your current registrar to Amazon 53, or from one AWS account to another, or from Route 53 to another registrar. This recipe will explain how to transfer a domain and DNS to Route 53.\n\nOceanofPDF.com",
      "content_length": 273,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 367,
      "content": "Getting ready\n\nThere are a few minimum requirements:\n\nThe domain registration or restoration with the previous registrar must be done at least 60 days before You cannot initiate a domain transfer if the current domain status is one of the following:\n\npendingDelete\n\npendingTransfer\n\nredemptionPeriod\n\nclientTransferProhibited\n\nCheck whether Route 53 supports the TLD\n\nOceanofPDF.com",
      "content_length": 382,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 368,
      "content": "How to do it...\n\n1. Confirm that Route 53 supports the TLD; you can get a list of the supported TLD's here: http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/re gistrar-tld-list.html.\n\n2. Transfer the DNS:\n\n1. Create a Route 53 hosted zone to get the name server details. 2. Create all the resource record sets in a newly created hosted zone. 3. Change the settings with your current registrar (this process can differ with different registrars). 1. Unlock the domain. 2. Disable privacy protection from the domain. 3. Get an authorization code. 4. Disable DNSSEC for the domain. 5. Check your contact information with the current registrar.\n\n4. Request the transfer:\n\n1. Log in to the AWS console and select Route 53. 2. Navigate to domain registration and click on Get started now. 3. Choose Transfer Domain. 4. Enter the name of the domain for which you want to transfer the registration to Amazon Route 53 and choose Check.\n\n5. If the domain registration is available for transfer, click Add to Cart. If the domain is not available, you will get a list of possible reasons.\n\n6. When you've added all the domain registrations that you want to transfer, choose Continue. 7. Provide the following details: 1. Authorization code. 2. Name server options:\n\n1. Continue to use the name servers provided by the current registrar or DNS service.",
      "content_length": 1347,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 369,
      "content": "2. Import name servers from a Route 53 hosted zone that has the same name as the domain.\n\n3. Specify the new name servers to replace the current registrar's name servers (not recommended).\n\n3. Nameservers. 4. Glue records.\n\n8. Provide your contact details as asked and click Continue. 9. Review the information you entered, read the terms of service, and select the checkbox to confirm that you've read the terms of service.\n\n10. Choose Complete Purchase.\n\n5. You will get a confirmation email on your registered email ID to continue the transfer (if the registrant contact authorizes the transfer, AWS starts to work with your current registrar to transfer your domain).\n\n6. Update your domain configuration by changing the following details: (optional)\n\nTransfer lock Automatic renewal Extended registration period Domain Name System Security Extensions (DNSSEC)\n\nOceanofPDF.com",
      "content_length": 880,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 370,
      "content": "Creating hosted zones and record sets\n\nHosted zones store the information about how you want to route the traffic in the form of resource record sets. Records determine how DNS responds to your domain or subdomain. This recipe will explain how to create a hosted zone and resource record sets.\n\nOceanofPDF.com",
      "content_length": 309,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 371,
      "content": "Getting ready\n\nBefore creating hosted zones, make sure you have access to the domain name and the resources you are going to point to.\n\nOceanofPDF.com",
      "content_length": 150,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 372,
      "content": "How to do it...\n\n1. Sign in to AWS console and click on Route 53. 2. In the DNS management section, click Get started now.\n\nDNS: Get Started\n\n3. Click Create Hosted Zone.\n\nHosted Zones\n\n4. In the Create Hosted Zone pane, enter a Domain Name and optionally, a Comment.\n\n5. Select Type as Public Hosted Zone and click Create.",
      "content_length": 323,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 373,
      "content": "Hosted zone creation\n\n6. Once the hosted zones are created, it will by default create NS (Name Server) and SOA (Start of Authority) records.\n\nHosted zone details\n\n7. Click on Create Record Set to create a new record. 8. Provide the following values:\n\n1. Name: We will keep it blank, as we want to resolve packttest.com to an IP.\n\n2. Type: Select A - IPv4 address.",
      "content_length": 363,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 374,
      "content": "DNS: Select record type\n\n3. Alias: Select No. 4. TTL (Seconds): Default value of 300 seconds (five minutes). 5. Value: Elastic IP address for your Amazon EC2 instance or provide the IP address of your web server.\n\n6. Routing Policy: Select Simple. Accept the default value of Simple.\n\nCreate Resource Record Set\n\n7. Click Create.\n\n9. You can follow the same process to create www.packttest.com.",
      "content_length": 394,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 375,
      "content": "10. Test the URL by entering it in the browser.\n\nOceanofPDF.com",
      "content_length": 63,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 376,
      "content": "Deleting a public hosted zone\n\nThe following procedure explains how to delete a hosted zone using the Amazon Route 53 console.\n\nOceanofPDF.com",
      "content_length": 142,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 377,
      "content": "Getting ready\n\nDeleting a hosted zone will destroy the current routing, hence take a backup before making any changes. Also, you can delete the hosted zone if there are no resource record sets associated with it, that is, before deleting the hosted zone we need to delete the records.\n\nOceanofPDF.com",
      "content_length": 300,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 378,
      "content": "How to do it...\n\n1. Sign into the AWS console, click on Route 53, and then click on Hosted zones.\n\nRoute 53 console\n\n2. Select the hosted zone that you want to delete.\n\nHosted zone console\n\n3. Delete the additional resource record set.\n\nDelete records",
      "content_length": 251,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 379,
      "content": "4. Confirm to delete the resource record sets.\n\nDelete records\n\n5. Then, click on Back to Hosted Zones. To delete the hosted zone, click Delete Hosted Zone.\n\nDelete hosted zones\n\n6. Confirm to delete the hosted zone.\n\nDelete hosted zones\n\nOceanofPDF.com",
      "content_length": 253,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 380,
      "content": "Creating an Alias record set\n\nELB, CloudFront, and S3 respond to each request with one or more IP addresses for the environment and change their IP addresses frequently so you cannot directly add the IP address. The only option is to add them as a CNAME record, but CloudFront allows you to add ELB, CloudFront, or S3 as an endpoint while using an Alias record.\n\nOceanofPDF.com",
      "content_length": 377,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 381,
      "content": "How to do it...\n\nSteps to create an Alias record:\n\n1. Select your hosted zone. 2. Click on Create Record Set to create a new record. 3. Provide the following values:\n\n1. Name: We will keep it blank, as we want to resolve test.packttest.com.\n\n2. Type: Select A - IPv4 address.\n\nDNS: Resource Record Type\n\n3. Alias: select Yes. 4. Choose the Alias target from the following: S3 Endpoint ELB Application Load Balancer ELB Classic Load Balancer CloudFront Distributions Elastic Beanstalk Record Sets in the hosted zone\n\n5. Provide the Alias Hosted Zone ID (this is specific to selected Alias Target).\n\n6. Routing Policy: Select Simple. 7. Evaluate Target Health: Select Yes if you want Route 53 to determine whether to respond to the DNS queries using this",
      "content_length": 752,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 382,
      "content": "resource record set by checking the health of the resource specified by Alias Target.\n\n8. Click Create.\n\nOceanofPDF.com",
      "content_length": 119,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 383,
      "content": "There's more...\n\nYou cannot set the TTL for the following resource set when using it with Alias; Amazon Route 53 uses the CloudFront, Elastic Beanstalk, Elastic Load Balancing, or Amazon S3 Bucket endpoint. If your resource record sets points to another resource record set in the same hosted zone using an alias, then Route 53 uses the TTL of the origin resource record set. Alias resource record sets can save time because Amazon Route 53 automatically recognizes changes in the resource record sets. If the IP address of the load balancer or CloudFront changes, Amazon Route 53 will automatically reflect those changes in DNS queries. An alias resource record set is only followed inside Amazon Route 53. This means that both the alias resource record set and its target must be a part of the Amazon resources. Amazon Route 53 doesn't charge for alias queries to CloudFront distributions, Elastic Beanstalk environments, ELB load balancers, or Amazon S3 buckets.\n\nOceanofPDF.com",
      "content_length": 981,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 384,
      "content": "Creating a private hosted zone\n\nA private hosted zone holds information about how you want to route traffic for a domain and its subdomain within a VPC. While creating a private hosted zone, you can only specify a single VPC, however, you can add VPC's into your hosted zone later.\n\nOceanofPDF.com",
      "content_length": 297,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 385,
      "content": "Getting ready\n\nYou need to have a VPC in any region before creating a private hosted zone. To enable private zone functionality, you must set the following values to True:\n\nenableDnsHostnames\n\nenableDnsSupport\n\nOceanofPDF.com",
      "content_length": 225,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 386,
      "content": "How to do it...\n\n1. Sign in to the AWS console and click on Route 53. 2. Select Get started now under DNS Management. 3. Choose Create Hosted Zone. 4. Provide the Domain Name. 5. Give some informative Comment. 6. Select Type as Private Hosted zone for Amazon VPC.\n\nDNS: Private Hosted Zone creation\n\n7. In the VPC ID list, select the VPC ID that you want to associate with the hosted zone.\n\nProvide VPC Details\n\n8. Click on Create after completion.",
      "content_length": 448,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 387,
      "content": "Complete Private Hosted Zone Creation\n\n9. To create an additional VPC within the new hosted zone, click on Back to Hosted Zones in the left-hand corner.\n\nHosted Zone console\n\n10. Click on the radio button to select the hosted zone.\n\nSelect Hosted Zone",
      "content_length": 251,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 388,
      "content": "11. Enter another VPC ID that you want to associate and click on Associate New VPC.\n\nAdd another VPC\n\nOceanofPDF.com",
      "content_length": 116,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 389,
      "content": "There's more...\n\nYou can have more than one hosted zone pointing to the same VPC with a condition that the TLD name should be different. The VPC CIDR IP network should not conflict You can leverage a simple AD directory:\n\nIf you want to integrate your on-premise network with your VPC If you want your on-premises network to resolve the domain names and resources in your private hosted zone\n\nOceanofPDF.com",
      "content_length": 407,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 390,
      "content": "Working with the weighted routing policy\n\nThe weighted routing policy can be applied when there are multiple resources that perform the same function, for example, web servers serving the same site from different web servers. Weighted resource record sets let you associate multiple resources with a single DNS name.\n\nCommon use cases of the weighted routing policy are as follows:\n\nLoad Balancing A/B Testing\n\nOceanofPDF.com",
      "content_length": 425,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 391,
      "content": "How to do it...\n\n1. Log in to the AWS console, go to Route 53, then click on Hosted zones and select your hosted zone.\n\nHosted Zone console\n\n2. Click on Create Record Set. 3. Create the first record set, provide the record details, and Name as test.internaltest.com.\n\nProvide Primary Record Details\n\n4. Select Routing Policy as Weighted, enter Weight as 1, enter a short unique description, and Set ID as t2 instance.",
      "content_length": 417,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 392,
      "content": "This will be your unique identifier between the same record sets.\n\nPrimary Record Routing Policy\n\n5. Create a second record set, provide record details and Name as test.internaltest.com.\n\nProvide Secondary Record Details",
      "content_length": 220,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 393,
      "content": "6. Select Routing Policy as Weighted, enter Weight as 4, enter a short unique description, and Set ID as large instance.\n\nSecondary Record Routing Policy\n\n7. This will create two resource record sets having a weighted routing policy.\n\nRecord details with their weight\n\nOceanofPDF.com",
      "content_length": 283,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 394,
      "content": "How it works...\n\nWeighted resource record sets contain a group of resources having the same combination of DNS name and type, and each resource record set is assigned a unique identifier and a relative weight. Route 53 selects one endpoint from the group. The probability of selecting a resource depends on the weight as a proportion of the total weight of all resources. For example: Suppose you have a small on-premises infrastructure and large instances in AWS, to balance your load, you can create two resource record sets with weight 1 (20%) pointing to the on-premises server and weight 4 (80%) pointing to the AWS instances.\n\nOceanofPDF.com",
      "content_length": 647,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 395,
      "content": "Working with the failover routing policy and health checks\n\nThe failover routing policy is a method for routing traffic away from unhealthy resources and to healthy resources. When you have more than one resource performing the same function, for example, more than one web server or application server, you can configure Amazon Route 53 health checks to check the health of your resources and configure the resource record sets in your hosted zone to route traffic only to healthy resources.\n\nOceanofPDF.com",
      "content_length": 508,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 396,
      "content": "How to do it...\n\n1. Log in to the AWS console and go to Route 53. 2. Set up the health check as follows:\n\n1. Select Health checks from the navigation pane and click on Create health check.\n\nDNS: Health Check console\n\n2. Provide the details as mentioned in the following image and click on Next.",
      "content_length": 294,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 397,
      "content": "Health Check Configurations\n\n3. Provide Advanced configuration if required.\n\nHealth Check Advanced Configurations",
      "content_length": 113,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 398,
      "content": "4. Click Yes to set up an alarm.\n\nHealth Check Alarm setup\n\n5. Make sure the resource is in a Healthy state; sometimes it can take a few minutes to come into a Healthy state.\n\nResource Health Status\n\n6. In the same way, set up a health check for the secondary host.\n\n3. Set up a hosted zone as follows:\n\n1. Click on Hosted zones, select your hosted zone, and click on Create Record Set.\n\n2. Provide the Name and Value of your resource record set.",
      "content_length": 446,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 399,
      "content": "Hosted Zone: Create Record\n\n3. Select Routing Policy as Failover, Failover Record Type as Primary, Set ID as test1-Primary, and Associate with Health Check as Yes.\n\n4. For Health Check to Associate, select the health check we just created.\n\nPrimary Record Routing Policy",
      "content_length": 270,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 400,
      "content": "5. In the same way, create a resource record set for the secondary host.\n\nOceanofPDF.com",
      "content_length": 88,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 401,
      "content": "How it works...\n\nA failover policy will send all traffic to the server you set as primary for as long as that server is healthy. If the health checks determine that it's failing, traffic will be diverted to the secondary backup resource. We have kept the TTL as 60 seconds so that Route 53 responds to the changed health checks in a faster way.\n\nFailover mechanism\n\nOceanofPDF.com",
      "content_length": 380,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 402,
      "content": "There's more...\n\nYou cannot create health checks for resources in private hosted zone, as health checks are available outside your VPC. You can create health checks for public IP/DNS resources. If you don't have a public IP attached to your instance, you can create a CloudWatch alarm and set up the health check based on the state of the alarm. For example, CloudWatch sends an alert if the CPU goes above 90% and turns into an alarm state. The health check will react according to the change.\n\nHealth Check Setup with Cloudwatch Alarm\n\nWhile configuring a failover routing policy, setting up health checks for secondary failover resource record sets is optional.\n\nOceanofPDF.com",
      "content_length": 680,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 403,
      "content": "Cloud Security and Network Compliance\n\nIn this chapter, we will cover the following recipes:\n\nSetting up CloudFront--EC2 origin Setting up CloudFront--S3 origin Geographic restrictions with Amazon CloudFront Customizing error responses in CloudFront Setting up CloudWatch monitoring Setting up ELB and Auto Scaling Trusted Advisor Protecting log information--sending logs to CloudWatch Starting CloudTrail Submitting a penetration testing request\n\nOceanofPDF.com",
      "content_length": 462,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 404,
      "content": "Introduction\n\nNetwork security is evaluated by each organization making sure it assesses the effectiveness of your defenses. Internet-facing systems receive several hundreds or even millions of attack attempts every day. Many of these are simple scans that our security system can defend against, but others catch you by surprise, unexpectedly shifting into incident investigation and cleanup mode.\n\nThis chapter provides assistance in securing a network by explaining important concepts and inter-relationships of security controls.\n\nFirst of all, we need to understand the shared responsibility model, as infrastructure security is shared between AWS and customer and it varies from different service models of Infrastructure as a Service (IAAS), Platform as a Service (PAAS), and Software as a Service (SAAS).\n\nAWS provides a global infrastructure responsible for the following:\n\nUnderlying hardware Physical security Network security and compliance Virtualization and underlying infrastructure Facilities\n\nAs a customer, you need to take care of the following:\n\nOS Ingress and outgress traffic from your instance AMI hardening and security Data in transit and rest AWS credentials and single sign on (SSO) IAM user policies and roles",
      "content_length": 1237,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 405,
      "content": "Here is a simplified diagram to explain the shared responsibility model:\n\nCustomers are responsible for their security and compliance IN the Cloud AWS is responsible for the security OF the Cloud\n\nAWS Shared Responsibiliy Model\n\nAs AWS takes care of the underlying setup, it allows you to scale and innovate while maintaining a secure environment.\n\nOceanofPDF.com",
      "content_length": 363,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 406,
      "content": "Types of attack\n\nHere we will be looking at various types of attacks and how to mitigate them with the help of different AWS services:\n\nDistributed Denial of Service (DDoS): This is a malicious attempt based on bandwidth or resource consumption. DDOS attacks can cause harm without even modifying or touching the intended victim:\n\nNetwork consumption: Attackers flood your environment with a large volume of spoofed packets to consume all your network bandwidth. Resource consumption: These attempts can sometimes be so strong that they target the vital resources of your system such as CPU cycles, hard disk space, and so on.\n\nPeer identity compromise/identity spoofing/man-in-the- middle: Hackers try to listen to traffic between two network nodes, looking for passwords, password hashes, and program instructions. IP/DNS spoofing: Attackers try to impersonate a user, device, or client to directly attack the host. Port scanning: The attacker tries to connect to a selected port or sometimes all ports to exploit the environment. The attacker works in the series of your system to understand the weakness.\n\nHere are some best practices:\n\nAlways use a Security Group Set up a Network ACL Use IPSec or Direct Connect for trusted connections Protect data in transit and rest Turn on VPC flow logs Always transfer data via SSL/TLS endpoints Ensure regular reviews of security controls and policies.",
      "content_length": 1397,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 407,
      "content": "OceanofPDF.com",
      "content_length": 14,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 408,
      "content": "Setting up CloudFront--EC2 origin\n\nCloudFront is a Content Delivery Network (CDN) service provided by AWS. CloudFront offers a globally distributed network which serves cache content such as images, videos, and static files from distributed data centers called edge locations. The edge locations are points of presence (POP), which are owned and operated by CloudFront.\n\nWhile a number of techniques can be used to mitigate DoS/DDoS attacks in the cloud, CloudFront is one of the best services that can manage large user requests while delivering good services to good customers. CloudFront absorbs DoS/DDoS flooding attacks.\n\nThere are two types of distribution that CloudFront provides:\n\nWeb distributions: Static and dynamic download content; for example, .html, .css, .php, and image files, using HTTP or HTTPS. RTMP distributions: Stream media files using Adobe Media Server and the Adobe Real-Time Messaging Protocol (RTMP). An RTMP distribution must use an Amazon S3 bucket as the origin.\n\nOceanofPDF.com",
      "content_length": 1011,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 409,
      "content": "Getting ready\n\nBefore creating a CloudFront web distribution:\n\nMake sure your origin is available. Configure origin servers (S3/web server/load balancer) from which CloudFront gets your files for distribution. Upload files to the origin servers. Files, also known as objects, typically include web pages, images, and media files but can be anything that can be served over HTTP. Configure the S3 bucket for logging. Create a CNAME or alias record. Optionally, you can configure your CloudFront distribution to use a custom domain name. Upload your SSL certificate if you want to use a custom certificate. Optionally, you can configure your origin server to add headers to the files; the headers indicate how long you want the files to stay in the cache in the CloudFront edge locations. By default, each object stays in an edge location for 24 hours before it expires. You will need access to create the CloudFront distribution.\n\nOceanofPDF.com",
      "content_length": 944,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 410,
      "content": "How to do it...\n\n1. Log in to the AWS Console, navigate to Network & Content Delivery, and then select CloudFront.\n\nSelect CloudFront\n\n2. Navigate to Distributions and click on Create Distribution.\n\nCreate CloudFront Distribution\n\n3. After that, click on Select delivery method | Web | Get Started.",
      "content_length": 298,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 411,
      "content": "CloudFront Delivery Method\n\n4. Provide an Origin Domain Name (here you can provide the EC2 public name/ELB name/domain name as per your requirement).\n\nCloudFront: Origin\n\n5. Change as per your specific requirements. I'll be using the default values for this testing.\n\n1. You can consider changing the Alternate Domain Names (CNAMEs) if any are available.\n\nCloudFront: CNAME\n\n2. Change the Object Caching behavior to customize if you want to specify caching expiry in CloudFront. By default, it will take the caching expiry from the headers.\n\nCloudFront: Object Caching",
      "content_length": 568,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 412,
      "content": "3. Add the SSL Certificate if available; otherwise, CloudFront will automatically use the default *.cloudfront.net certificate.\n\nCloudFront: SSL Certificate\n\n6. Set Logging as On, provide a bucket name in Bucket for Logs, and give your folder name in the Log Prefix.\n\nCloudFront: Logs\n\n7. The entire web page will look like the following. Click on Create Distribution.",
      "content_length": 368,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 414,
      "content": "CloudFront: Web Distribution Details\n\n8. Creating the distribution generally takes 15-20 mins. 9. Once the distribution is available, State will change to Enabled. Click on the ID to get the CloudFront domain name.",
      "content_length": 214,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 415,
      "content": "CloudFront Web Distribution\n\n10. You can use the Domain Name to visit your web page.\n\nCloudFront Domain Name Details\n\n11. To modify the details or add another behavior, go to Behaviors and click on Create Behavior.\n\n1. Note that the behavior decides which data will be served by CloudFront and which data will be served by the origin server.",
      "content_length": 341,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 416,
      "content": "CloudFront Behavior\n\nOceanofPDF.com",
      "content_length": 35,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 417,
      "content": "How it works...\n\n1. A user accesses your website or application and requests for one or more objects, such as an image file and an HTML file.\n\n2. DNS routes the request to the CloudFront edge location that can best serve the user's request, typically the nearest CloudFront edge location in terms of latency, and routes the request to that edge location. 3. In the edge location, CloudFront checks its cache for the requested\n\nfiles:\n\n1. If the files are in the cache, CloudFront returns them to the user. 2. If the files are not available, CloudFront sends the request to the origin server based on the file type. For example, to your Amazon S3 bucket for image files and to your HTTP server, for the HTML files. Then it stores the files to the edge location for the specified duration.\n\n4. Attackers trying to access content from an edge location don't get the details of the end server (S3 or IP of your HTTP server) as the data will be delivered with one of the CloudFront's IP addresses.\n\n5. In the case of attack, CloudFront absorbs the requests, leaving minimal or no impact to your website.\n\nOceanofPDF.com",
      "content_length": 1114,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 418,
      "content": "There's more...\n\nCloudFront sends your distribution's configuration (but not your content) to all of its edge locations. The number of files that you can serve per distribution is unlimited. As you develop your website or application, you use the domain name that CloudFront provides for your URLs. CloudFront creates reports based on the access log's data. It gives the following reports:\n\nCloudFront cache statistics reports:\n\nTotal requests Percentage of viewer requests by result type Bytes transferred to viewers HTTP status codes Shows viewer GET\n\nCloudFront popular objects report CloudFront top referrers report CloudFront usage reports:\n\nNumber of requests Data transferred by protocol Data transferred by destination\n\nCloudFront viewers reports:\n\nDevices Browsers Operating systems Locations\n\nOceanofPDF.com",
      "content_length": 817,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 419,
      "content": "Setting up CloudFront--S3 origin\n\nIt is one of the best practices to store your static files (such as text, images, and videos) into S3 and using CloudFront you can distribute the content from S3. In this recipe, we will focus on how to create a CloudFront web distribution for S3 origin.\n\nOceanofPDF.com",
      "content_length": 304,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 420,
      "content": "How to do it...\n\n1. Create an S3 bucket:\n\n1. Log in to the AWS Console, select Amazon S3, and choose Create bucket.\n\nS3: Create Bucket\n\n2. In the Create Bucket dialog, enter the name of the bucket, then in Region, select a Region for your bucket, and click on Create.\n\nS3 Bucket Details\n\n1. Note that for your bucket to work with CloudFront, the name must conform to the DNS naming requirements. For more information, go to Bucket Restrictions and Limitations in the",
      "content_length": 466,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 421,
      "content": "Amazon S3 Developer Guide or visit: http://docs.aws.amazon.com/A mazonS3/latest/dev/BucketRestrictions.html\n\n2. By default, Amazon S3 creates buckets in the US-Standard region. We recommend that you choose a region close to you to optimize latency, minimize costs, and address regulatory requirements.\n\n3. Select your bucket in the Buckets pane and choose Upload.\n\nS3 Upload Object\n\n4. On the Upload tab, select the files page, choose Add more files, and choose the files that you want to upload. Click on Upload after completion.",
      "content_length": 530,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 422,
      "content": "S3 Upload Image\n\n2. Create a CloudFront web distribution as follows:\n\n1. Open the CloudFront console at https://console.aws.amazon.com/cloudfron t/ and choose Create Distribution.\n\n2. On Select a delivery method for your content page in the Web section, click on Get Started.\n\n3. On the Create Distribution page under Origin Settings, choose the Amazon S3 bucket that you created earlier.",
      "content_length": 388,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 423,
      "content": "CloudFront: Origin Details\n\n4. Keep all other configurations as default or use the settings provided in recipe 1 (Setting up CloudFront--EC2 origin).\n\n5. After all the setups, click Create Distribution. 6. After CloudFront has created your distribution, the value of the Status column for your distribution will change from InProgress to Deployed. If you chose to enable the distribution, it will then be ready to process requests.\n\nThis should take less than 15 minutes. The domain name that CloudFront assigns to your distribution appears in the list of distributions. (It also appears on the General tab for a selected distribution.)\n\n3. Test your links-- if your object location in S3 is https://s3-us-west-2.amazonaw s.com/bucket-name/file-name then your CloudFront path will be http://abc1234abcdef8.cloudfront.net/file-name.\n\nIf your domain name was abc1234abcdef8.cloudfront.net and your object was image.jpg, the URL for the link would be: http://d111111abcdef8.cloudfront.net/image.jpg. If your object is in a folder within your bucket, include the folder in the URL. For example, if image.jpg is located in an images folder, then the URL would be: d111111abcdef8.cloudfront.net/images/image.jpg",
      "content_length": 1205,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 424,
      "content": "OceanofPDF.com",
      "content_length": 14,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 425,
      "content": "There's more...\n\nRestrictions on using alternate domain names include:\n\nYou should have the permission to create a CNAME or alias record with your DNS provider. The alternative name should be unique with all the CloudFront distributions. As a DNS protocol limitation, you cannot create a CNAME record for the top node of a DNS namespace (for example: abc.com) known as the zone apex, but you can create CNAME records for www.abc.com, new.abc.com, and so on. If you're using Amazon Route 53 as your DNS service, you can create an alias resource record set instead of a CNAME. With an alias resource record set, you don't pay for Amazon Route 53 queries. In addition, you can create an alias resource record set for a domain name at the zone apex (abc.com).\n\nOceanofPDF.com",
      "content_length": 771,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 426,
      "content": "Geographic restrictions with Amazon CloudFront\n\nCloudFront has added a geo-restriction feature to make it easier to restrict access to your content based on the geographic location of your viewers.\n\nOceanofPDF.com",
      "content_length": 213,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 427,
      "content": "How to do it...\n\n1. Log in to the AWS Console, select CloudFront Distributions, then select your distribution, and go to the Restrictions tab.\n\nCloudFront Console\n\n2. Click on Edit.\n\nCloudFront Restrictions Setup",
      "content_length": 212,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 428,
      "content": "Once you enable the feature, you can select whether you want to configure a whitelist or blacklist of countries for your distribution.\n\n3. Select one or more countries from the list in the left-side box, and move those countries to the right-side box and then click on Yes, Edit button.\n\nEnable CloudFront Restrictions\n\n4. That's it! Once this configuration gets deployed to our worldwide edge locations (which takes a few minutes), the CloudFront edge locations will begin blocking users from certain countries based on your configuration. For users that are blocked, CloudFront will serve an HTTP response of 403 (Forbidden). You also have the ability to configure a custom error page with CloudFront for the 403 response so that you can serve a friendlier message to your users if you want (this is explained in the next recipe-- Customizing error responses in CloudFront).\n\nOceanofPDF.com",
      "content_length": 892,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 429,
      "content": "How it works...\n\nImagine you own an online store and have rights to distribute your products to users in a single country. Therefore you need a way to prevent users from across the globe from accessing your product. You can achieve this by using the Amazon CloudFront geo-restriction feature and whitelist the country where you are allowed to sell your product. Then CloudFront edge locations will first check the location of the viewer (based on their IP address) and only serve the content if the viewer's IP address maps to the whitelisted country. CloudFront uses an out-of-sight geo-IP database to map IP addresses to countries.\n\nThere is another scenario where you're a software company and want to restrict the download of your encrypted software products by users in certain territories because of licensing terms. In this scenario, you can configure a blacklist of a single country or countries using the CloudFront Management Console (or CLI/API) so that CloudFront edge locations don't serve your content to any requests from one of your blacklisted countries.\n\nOceanofPDF.com",
      "content_length": 1087,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 430,
      "content": "Customizing error responses in CloudFront\n\nThe objects that you're serving through CloudFront can be unavailable for a variety of reasons. These reasons fall into two broad categories:\n\nClient errors (status code range 4xx): These errors are the result of HTTP requests sent by the client. For example, the object name isn't available, or the user doesn't have the permissions required to read the object. Server errors (status code range 5xx): These errors indicate a problem with the origin server as is not able to process the request. For example, the HTTP server is busy or unavailable.\n\nOceanofPDF.com",
      "content_length": 607,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 431,
      "content": "Getting ready\n\nThe HTTP status codes for which CloudFront can return a custom error page includes the following:\n\n400, 403, 404, 405, 414 500, 501, 502, 503, 504\n\nOceanofPDF.com",
      "content_length": 177,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 432,
      "content": "How to do it...\n\n1. Log in to the AWS Console, select CloudFront, select your distribution, and go to the Error Pages tab.\n\n2. Click on Create Custom Error Response.\n\nCloudFront: Create Custom Error\n\n3. Set up the error pages and click on Create.\n\nCloudFront: Create Custom Error\n\nOceanofPDF.com",
      "content_length": 295,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 433,
      "content": "How it works...\n\nWhen you request for an object or HTTP web page:\n\n1. CloudFront checks for the object in its local cache. 2. If not available, CloudFront checks for the object with the origin server.\n\n3. If the object is unavailable with the origin server as well, your web server will return an HTTP status code to CloudFront.\n\n4. For example, if a user asks for an invalid URL/object, your web server returns a 404 status code to CloudFront, and CloudFront returns the same to the user.\n\n5. You can display a brief and sparsely formatted default message or a web page stating: Not Found: \"The requested URL /myfilename.html was not found on this server\".\n\n6. You can also specify an image/HTML page having the same formatting as the rest of your website. CloudFront will return an object or HTML file to the viewer that contains your custom error message.\n\nOceanofPDF.com",
      "content_length": 874,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 434,
      "content": "Setting up CloudWatch monitoring\n\nThink of a scenario where you typically expect 5,000 concurrent sessions to your website at a specific time in a day. Immediately you get to know that the website becomes unresponsive and you find that the traffic has already exceeded twice the amount (10,000). Here you need a solution which monitors your system (Amazon CloudWatch) and triggers an alarm (Amazon SNS) if the current number of concurrent sessions exceeds twice that amount. Immediately, your infrastructure should be in a state to handle the heavy traffic to support good customers.\n\nCloudWatch has the following features:\n\nIt is a monitoring service It watches the resources and application you run on AWS It collects, processes raw data, and shows real-time metrics It collects and monitors log files It sets alarms It reacts to changes in your environment\n\nEC2 by default sends metric data to CloudWatch every 5 minutes but we can enable detailed monitoring to send metrics every minute.\n\nOceanofPDF.com",
      "content_length": 1007,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 435,
      "content": "Getting ready\n\nIn this recipe, we will create a monitoring alert for CPU utilization and send an email to the appropriate recipient. Similarly, you can create an alert for various other resources and can also create custom metrics to monitor.\n\nTo create metrics and send a notification, you will need access to CloudWatch and SNS (to send emails).\n\nOceanofPDF.com",
      "content_length": 363,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 436,
      "content": "How to do it...\n\nCreate an alarm and send the notification:\n\n1. Log in to the AWS Console, then navigate to Management Tools, and select CloudWatch.\n\nSelect CloudWatch\n\n2. Go to Alarms and click on Create Alarm.\n\nCreate Alarm\n\n3. Search for the metrics (here we are selecting CPUUtilization). Select the instance and click on Next.",
      "content_length": 331,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 437,
      "content": "CloudWatch: Metric Details\n\n4. In the Alarm Threshold section, provide the unique Name, short Description, and minimum threshold (that is when you want to trigger an action).\n\nCloudWatch: Alarm Threshold\n\n5. Provide the Actions as given to send an email.",
      "content_length": 254,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 438,
      "content": "CloudWatch: Alarm Actions\n\n6. Go through the preview of the Alarm in the right corner side and click on Create Alarm.\n\nCloudWatch: Alarm Details\n\n7. You will get an email to confirm the subscription. Click on I will do it later.",
      "content_length": 228,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 439,
      "content": "CloudWatch: Email setup\n\n8. Your alarm is now available in the pending state.\n\nCloudWatch: Alarm Status\n\n9. To confirm the email you have received, click Confirm subscription. Check your spam box if you haven't received any email.\n\nYou will not receive any confirmation email if the SNS topic is already created and the alarm status will automatically change.",
      "content_length": 359,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 440,
      "content": "CloudWatch: Email Confirmation\n\n10. Check the state of the alarm again.\n\nOceanofPDF.com",
      "content_length": 87,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 441,
      "content": "There's more...\n\nYou can use CloudWatch to recover or restart the instance automatically whenever you receive Instance/System Status Check Failed.\n\nTo recover the instance whenever you receive System Status Check Failed:\n\n1. Follow the same steps until step 2 provided in the last section. 2. Search for StatusCheckFailed_System and click on Next.\n\nCloudWatch: Status Check Failed Alarm\n\n3. In the Actions pane, click on +EC2 Action, then select the Recover this instance, and click on Create Alarm.",
      "content_length": 499,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 442,
      "content": "CloudWatch: Status Check Failed Alarm Action\n\n4. To restart the instance whenever you receive Instance Status Check Failed:\n\nFollow the same steps until step 2 provided in the last section Search for StatusCheckFailed_Instance and click on Next In the Actions pane, click on +EC2 Action, then select Reboot this instance and click on Create Alarm\n\nOceanofPDF.com",
      "content_length": 362,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 443,
      "content": "Setting up ELB and Auto Scaling\n\nAlong with conventional approaches for DoS/DDoS attack mitigation and protection, the AWS cloud provides capabilities based on its elasticity. DoS/DDoS attacks are attempts to deplete limited compute, memory, disk, or network resources, which often work against on-premises infrastructure. However, the AWS cloud is elastic, in the sense that new resources can be employed on demand, if and when required.\n\nOceanofPDF.com",
      "content_length": 454,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 444,
      "content": "How to do it...\n\nSteps to create ELB and Auto Scaling have already been shared in Chapter 3, VPC Advanced Components.\n\nOceanofPDF.com",
      "content_length": 133,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 445,
      "content": "How it works...\n\nAs AWS services are highly durable in nature, you can have ELB and ASG in the case of an attack:\n\nAll the requests will come to your Elastic Load Balancing and beneath that, it will go to your EC2 servers. You can configure CloudWatch to react on the sudden spikes (For example, trigger an alarm and send SNS notification or trigger EC2 instances using Auto Scaling). Auto Scaling will scale out your web server based on the load or number of requests. This will give you some time to fight against the attack by serving data to good users. Even under heavy attack, the web servers could scale to perform and provide optimal user experience by leveraging cloud elasticity. Auto Scaling will shrink back when the attack stops.\n\nOceanofPDF.com",
      "content_length": 758,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 446,
      "content": "Trusted Advisor\n\nAWS Trusted Advisor helps you to optimize your infrastructure by giving real-time guidance by comparing your current infrastructure with AWS best practices, reducing cost, increasing performance, improving security, and fault tolerance.\n\nAWS compares the best practices in the following four categories:\n\nCost optimization Performance Security Fault tolerance\n\nOceanofPDF.com",
      "content_length": 392,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 447,
      "content": "Getting ready\n\nIn this recipe, we will go through the AWS Trusted Advisor console and use Amazon CloudWatch events to detect and react to changes in the status of Trusted Advisor checks.\n\nYou will need access to Trusted Advisor, CloudWatch, and SNS to perform this recipe.\n\nOceanofPDF.com",
      "content_length": 288,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 448,
      "content": "How to do it...\n\n1. Log in to the AWS Console, navigate to Management Tools, and click on Trusted Advisor.\n\nTrusted Advisor\n\n2. It will take some time to perform the checks and it then gives the following screen:\n\nTrusted Advisor Console\n\n3. In the Recommended Actions section, select the warning and on the basis of Alert Criteria, you can take the required action.",
      "content_length": 366,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 449,
      "content": "Trusted Advisor Alerts\n\n4. Now go to the CloudWatch console, select Events from the navigation pane, and click on Create rule.\n\nCloudWatch Events\n\n5. Under Event Source, select Service Name as Trusted Advisor.\n\n1. Select Event Type as All Events.",
      "content_length": 246,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 450,
      "content": "Be wise while choosing this option, as this can flood emails into your mailbox.\n\nCloudWatch Event Rule\n\n2. For specific events:\n\n1. Status values: Select Check Item Refresh Status in Event Type and choose Specific Status(es) as ERROR and WARN. 2. Trusted Advisor checks: Choose Specific check(s) and then\n\nchoose one or more check names from the list.\n\n3. AWS resources: Choose Specific resource ID(s) by ARN, and then type the ARNs of the resources (or select Any resource ID to apply rules to all resources).",
      "content_length": 510,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 451,
      "content": "CloudWatch Events Details\n\n6. In the Targets area, click Add Target. 7. Select the Target Type (which action you want to perform), select SNS topic, select the Topic that you have created, and in Configure input select Matched event.\n\nCloudWatch Events Targets",
      "content_length": 260,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 452,
      "content": "8. Click on Configure details.\n\nCloudWatch Event Configure Details\n\n9. In the section Step 2: Configure rule details, under Rule\n\ndefinition provide the Name and Description and click on Create rule.\n\nCloudWatch Events Configure Rule\n\n10. Once created, it should give a green status.\n\nCloudWatch Events Rule Status\n\nOceanofPDF.com",
      "content_length": 330,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 453,
      "content": "How it works...\n\nTrusted Advisor scans your environment and compares it with the AWS best practices. Once the scan is done, it provides recommended actions. You can take actions by selecting the specified links.\n\nFurther, we have created AWS CloudWatch events to send alerts for any changes in Trusted Advisor.\n\nOceanofPDF.com",
      "content_length": 326,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 454,
      "content": "Protecting log information--sending logs to CloudWatch\n\nFor critical applications, all add, change/modify, and delete activities or transactions must generate a log entry. Each log entry should contain the following information:\n\nUser identification information Type of event Date and time stamp Success or failure indication Origination of event Identity or name of the affected data, system component, or resource\n\nProtecting logs:\n\nVerify that audit trails are enabled and active for system components Ensure that only individuals who have a job-related need can view audit trail files Confirm that the current audit trail files are protected from unauthorized modifications via access control mechanisms, physical segregation, and/or network segregation Ensure that the current audit trail files are promptly backed up to a centralized log server or media that is difficult to alter Verify that regular log reviews are performed for all system components\n\nOceanofPDF.com",
      "content_length": 974,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 455,
      "content": "Getting ready\n\nThink of a scenario where you want to give access of your logs to your security team without them logging into the server and creating a separate log server can be little expensive.\n\nCloudWatch logs give you the ability to monitor and troubleshoot your systems and applications, and custom log files. You can ship your logs to CloudWatch and monitor them in near real time, for specific phrases, values, or patterns.\n\nFor example, you can set up an alarm on specific errors based on your system logs (such as, user log in failed) or view graphs based on your application logs (such as, the latency of web requests). These alarms or graphs will not manipulate the original files, so you can check logs any time to get more insights. Logs files are stored securely and can be accessed for up to 10 years, so you don't have to worry about filling up hard drives.\n\nThe CloudWatch Logs Agent is supported on Amazon Linux, Ubuntu, and Windows. This agent will support the ability to monitor individual log files on the host.\n\nOceanofPDF.com",
      "content_length": 1049,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 456,
      "content": "How to do it...\n\n1. Configure your IAM role or user for CloudWatch logs as follows: 1. Open the IAM console at https://console.aws.amazon.com/iam/. 2. In the navigation pane, click Roles, and then on the Role Name column, click on IAM role.\n\n3. Under Inline Policies, click Create Role Policy. 4. On the Set Permissions page, click Custom Policy, and then click Select.\n\n5. On the Review Policy page, in the Policy Name field, type a name for the policy.\n\nIAM Policy\n\n6. In the Policy Document field, paste the following policy:\n\n{ \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"logs:CreateLogGroup\", \"logs:CreateLogStream\",",
      "content_length": 651,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 457,
      "content": "\"logs:PutLogEvents\", \"logs:DescribeLogStreams\" ], \"Resource\": [ \"arn:aws:logs:*:*:*\" ] } ] }\n\n7. Click on Apply Policy.\n\n2. Install and configure CloudWatch logs on an existing Amazon EC2 instance:\n\n1. Connect to your EC2 instance. 2. The CloudWatch Logs agent installer requires certain information during set up. Before you start, you will need to know what log file you want to monitor and its timestamp format. You should also have the following information ready:\n\n1. AWS access key ID: Press Enter if you are using an IAM role. Otherwise, enter your AWS access key ID.\n\n2. AWS secret access key: Press Enter if you are using an IAM role. Otherwise, enter your AWS secret access key.\n\n3. Default region name: Press Enter. The default is us-east-1. You can set this to us-east-1, us-west-1, us-west-2, eu-west-1, eu- central-1, ap-southeast-1, ap-southeast-2, or ap-northeast-1. 4. Default output format: Leave blank and press Enter. 5. Path of log file to upload: This is the location of the file that contains the log data you want to send. The installer will suggest a path for you.\n\n6. Destination log group name: This is the name for your log group. The installer will suggest a log group name for you. 7. Destination log stream name: By default, this is the name of the host. The installer will suggest a hostname for you. 8. Timestamp format: Specify the format of the timestamp\n\nwithin the specified log file. Choose custom to specify your own format.\n\n9. Initial position: This is how the data will be uploaded. Set this to start_of_file to upload everything in the data file. Set it to end_of_file to upload only newly appended data.",
      "content_length": 1647,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 458,
      "content": "3. Run the CloudWatch Logs agent installer. On the instance, open a command prompt, type the following commands, and then follow the prompts:\n\n[root@ip-172-31-45-203 ~]# cd /home/centos/ [root@ip-172-31-45-203 jhalak]# wget https://s3.amazonaws.com/aws-CloudWatch/downloads/latest/awslogs- agent-setup.py [root@ip-172-31-45-203 jhalak]# python ./awslogs-agent-setup.py - -region us-west-2 Launching interactive setup of CloudWatch Logs agent ... Step 1 of 5: Installing pip ...DONE Step 2 of 5: Downloading the latest CloudWatch Logs agent bits ... DONE Step 3 of 5: Configuring AWS CLI ... AWS Access Key ID [****************A6GQ]: //Press Enter AWS Secret Access Key [****************0Y3Q]: //Press Enter Default region name [us-west-2]: //Press Enter Default output format [None]: text //Press Enter Step 4 of 5: Configuring the CloudWatch Logs Agent ... Path of log file to upload [/var/log/messages]: //Press Enter Destination Log Group name [/var/log/messages]: //Press Enter Choose Log Stream name: 1. Use EC2 instance id. 2. Use hostname. 3. Custom. Enter choice [1]: //Press Enter Choose Log Event timestamp format: 1. %b %d %H:%M:%S (Dec 31 23:59:59) 2. %d/%b/%Y:%H:%M:%S (10/Oct/2000:13:55:36) 3. %Y-%m-%d %H:%M:%S (2008-09-08 11:52:54) 4. Custom Enter choice [1]: //Press Enter Choose initial position of upload: 1. From start of file. 2. From end of file. Enter choice [1]: //Press Enter More log files to configure? [Y]: N //Press Y to configure more logs Step 5 of 5: Setting up agent as a daemon ...DONE ------------------------------------------------------ - Configuration file successfully saved at: /var/awslogs/etc/awslogs.conf - You can begin accessing new log events after a few moments at https://console.aws.amazon.com/CloudWatch/home?region=us-west- 2#logs: - You can use 'sudo service awslogs start|stop|status|restart' to control the daemon. - To see diagnostic information for the CloudWatch Logs Agent, see /var/log/awslogs.log - You can rerun interactive setup using 'sudo python ./awslogs-",
      "content_length": 2021,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 459,
      "content": "agent-setup.py --region us-west-2 --only-generate-config' ------------------------------------------------------\n\n4. After you have completed these steps, the installer asks if you want to configure another log file; you can run the process as many times as you like for each log file. If you have no more log files to monitor, choose N when prompted by the installer to set up another log.\n\n5. You should see the newly created log group and log stream in the CloudWatch console after the agent has been running for a few moments.\n\n6. To check the status, run the following command:\n\n[root@ip-172-31-45-203 jhalak]# systemctl status awslogs awslogs.service - LSB: Daemon for AWSLogs agent. Loaded: loaded (/etc/rc.d/init.d/awslogs) Active: active (running) since --- ---- Jul 22 20:10:56 ip-172-31-45-203.us-west-2.compute.internal systemd[1]: Started LSB: Daemon for AWSLogs agent..\n\n7. To configure more logs with the same setup, run the following command:\n\n[root@ip-172-31-45-203 jhalak]# python ./awslogs-agent-setup.py -- region us-west-2 --only-generate-config Launching interactive setup of CloudWatch Logs agent ... Skipping downloading and installation of agent bits.Step 3 of 5: Configuring AWS CLI ... AWS Access Key ID [****************A6GQ]: // press Enter AWS Secret Access Key [****************0Y3Q]: // press Enter Default region name [us-west-2]: // press Enter Default output format [text]: // press Enter Step 4 of 5: Configuring the CloudWatch Logs Agent ... Path of log file to upload [/var/log/messages]: /var/log/httpd/access_log //Enter the required path Destination Log Group name [/var/log/httpd/access_log]: // press Enter Choose Log Stream name: 1. Use EC2 instance id. 2. Use hostname. 3. Custom. Enter choice [1]: //Press Enter Choose Log Event timestamp format: 1. %b %d %H:%M:%S (Dec 31 23:59:59) 2. %d/%b/%Y:%H:%M:%S (10/Oct/2000:13:55:36) 3. %Y-%m-%d %H:%M:%S (2008-09-08 11:52:54)",
      "content_length": 1915,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 460,
      "content": "4. Custom Enter choice [1]: //Press Enter Choose initial position of upload: 1. From start of file. 2. From end of file. Enter choice [1]: //Press Enter More log files to configure? [Y]: N Step 5 of 5: Setting up agent as a daemon ...DONE ------------------------------------------------------ - Configuration file successfully saved at: /var/awslogs/etc/awslogs.conf - You can begin accessing new log events after a few moments at https://console.aws.amazon.com/CloudWatch/home?region=us-west- 2#logs: - You can use 'sudo service awslogs start|stop|status|restart' to control the daemon. - To see diagnostic information for the CloudWatch Logs Agent, see /var/log/awslogs.log - You can rerun interactive setup using 'sudo python ./awslogs- agent-setup.py --region us-west-2 --only-generate-config' ------------------------------------------------------\n\n8. To restart the CloudWatch agent, run the following command:\n\n[root@ip-172-31-45-203 jhalak]# systemctl daemon-reload [root@ip-172-31-45-203 jhalak]# systemctl restart awslogs\n\n9. To configure the error logs, run the following command:\n\n[root@ip-172-31-45-203 jhalak]# python ./awslogs-agent-setup.py -- region us-west-2 --only-generate-config Launching interactive setup of CloudWatch Logs agent ... Skipping downloading and installation of agent bits.Step 3 of 5: Configuring AWS CLI ... AWS Access Key ID [****************A6GQ]: AWS Secret Access Key [****************0Y3Q]: Default region name [us-west-2]: Default output format [text]: Step 4 of 5: Configuring the CloudWatch Logs Agent ... Path of log file to upload [/var/log/messages]: /var/log/httpd/error_log Destination Log Group name [/var/log/httpd/error_log]: Choose Log Stream name: 1. Use EC2 instance id. 2. Use hostname. 3. Custom. Enter choice [1]: Choose Log Event timestamp format: 1. %b %d %H:%M:%S (Dec 31 23:59:59) 2. %d/%b/%Y:%H:%M:%S (10/Oct/2000:13:55:36) 3. %Y-%m-%d %H:%M:%S (2008-09-08 11:52:54) 4. Custom Enter choice [1]: Choose initial position of upload: 1. From start of file. 2. From end of file.",
      "content_length": 2039,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 461,
      "content": "Enter choice [1]: More log files to configure? [Y]: N Step 5 of 5: Setting up agent as a daemon ...DONE ------------------------------------------------------ - Configuration file successfully saved at: /var/awslogs/etc/awslogs.conf - You can begin accessing new log events after a few moments at https://console.aws.amazon.com/CloudWatch/home?region=us-west- 2#logs: - You can use 'sudo service awslogs start|stop|status|restart' to control the daemon. - To see diagnostic information for the CloudWatch Logs Agent, see /var/log/awslogs.log - You can rerun interactive setup using 'sudo python ./awslogs- agent-setup.py --region us-west-2 --only-generate-config' ------------------------------------------------------\n\n10. Once done, you can configure more application logs in the same way.\n\n3. Check the logs in the AWS CloudWatch console:\n\n1. Log in to the AWS Console, go to CloudWatch, and click on the Logs tab in the left-side navigation pane.\n\nCloudWatch Logs\n\n2. Now you can see all the logs created. 3. Select the log you have configured /var/log/messages for.",
      "content_length": 1070,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 462,
      "content": "CloudWatch Log Groups\n\nOceanofPDF.com",
      "content_length": 37,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 463,
      "content": "There's more...\n\nExamples of what you can do with Amazon CloudWatch and your logs are as follows:\n\nReal-time application and system monitoring: You can use CloudWatch logs to monitor applications and systems using log data in near real-time. For example, CloudWatch Logs can track the number of errors that occur in your application logs and send you a notification whenever the rate of errors exceed a threshold that you specify. Amazon CloudWatch uses your log data for monitoring; so no code changes are required. Long-term log retention: You can use CloudWatch Logs to store your log data for as long as you need in a highly durable and cost-effective storage without worrying about hard drives running out of space. The CloudWatch Logs Agent makes it easy to quickly move both rotated and unrotated log files off of a host and into the log service. You can then access the raw log event data when you need it. Limitations of CloudWatch logs:\n\nUp to 5 GB of incoming data for free Up to 5 GB of data archiving for free The maximum number of log groups per AWS account is 500 The maximum number of metric filters is 100 per log group The maximum event size is 256 KB The maximum batch size is 1 MB The maximum rate of a PutLogEvents request is five requests per second per log stream The maximum batch size of a PutLogEvents request is 1 MB The maximum rate of a GetLogEvents request is 10 requests per second per AWS account\n\nOceanofPDF.com",
      "content_length": 1444,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 464,
      "content": "Starting CloudTrail\n\nAmazon CloudTrail is an API log monitoring and recording tool. CloudTrail captures and records all the API calls and related events for your account and stores it into S3. You can also deliver the logs to CloudWatch logs and events.\n\nCloudWatch primarily does three tasks:\n\nStores log files in S3 Looks up the API history Gives notification on specific API activity\n\nYou can create two types of trails:\n\nA trail that applies to all regions A trail that applies to one region\n\nOceanofPDF.com",
      "content_length": 511,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 465,
      "content": "How to do it...\n\n1. Sign in to the AWS Management Console and click on CloudTrail.\n\nSelect CloudTrail\n\n2. Click on Get Started Now.\n\nCloudTrail: Get Started\n\n3. On the Turn on CloudTrail page, provide the Trail name and select Yes if you want to Apply trail to all regions.\n\n4. Under Management events, for Read/Write events, choose if you want your trail to log All, Read-only, Write-only, or None, and then choose Save. By default, trails log All management events.",
      "content_length": 467,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 466,
      "content": "Turn on CloudTrail\n\n5. Provide a storage location, select Yes, and provide a name to your bucket. Select No if you have an available bucket and provide the bucket name.\n\nS3 bucket for CloudTrail\n\n6. Click on Advanced and provide the details shown in the following screenshot:",
      "content_length": 275,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 467,
      "content": "CloudTrail Advanced Details\n\n7. The new trail appears on the Trails page. The Trails page shows the trails in your account from all regions.\n\nCloudTrail Logs\n\nOceanofPDF.com",
      "content_length": 173,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 468,
      "content": "How it works...\n\nCloudTrail captures API calls and related events made by or on behalf of an AWS account and delivers log files to an Amazon S3 bucket. CloudTrail pushes log files generally every 5 minutes.\n\nOceanofPDF.com",
      "content_length": 222,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 469,
      "content": "There's more...\n\nYou can integrate CloudTrail with your third-party log monitoring tools such as Loggly using the API automate trail creation for your organization, check the status of your trails, and control how administrators turn CloudTrail logging on and off.\n\nBy default, log files are encrypted using Amazon S3 server-side encryption (SSE). You can store your log files in your bucket for as long as you want. You can also define the Amazon S3 life cycle rules to archive or delete log files automatically.\n\nYou can create up to five trails for each region. After you create a trail, CloudTrail automatically starts logging API calls and related events in your account. To stop logging, you can turn off logging for the trail or delete it.\n\nOceanofPDF.com",
      "content_length": 762,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 470,
      "content": "Submitting a penetration testing request\n\nPenetration testing is a cyber attack against your infrastructure to test exploitable vulnerabilities. The main objective of pen testing is to determine security weakness. AWS considers pen testing as abusive behavior so it, by default, blocks the source IP. Before performing pen testing, you need to inform AWS about the test.\n\nOceanofPDF.com",
      "content_length": 386,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 471,
      "content": "Getting ready\n\nYou can request authorization for penetration testing by signing in with your root account credentials and filling out the AWS Vulnerability/Penetration Testing Request Form. AWS will follow up on your request within 2 business days.\n\nYou cannot perform pen testing on small/micro/nano EC2 or RDS instances.\n\nOceanofPDF.com",
      "content_length": 338,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 472,
      "content": "How to do it...\n\n1. Log in to the AWS Console using the root account. 2. Click on the URL to open the form: https://aws.amazon.com/forms/penetration-testi ng-request\n\n3. Provide all the required details: 1. Contact Information:\n\nPenetration Testing Form\n\n2. Scan Information:",
      "content_length": 275,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 473,
      "content": "Penetration Testing Form\n\n4. Click I agree in the Terms and Conditions Agreement section and click on Submit.",
      "content_length": 109,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 474,
      "content": "Penetration Testing Form\n\n5. You will get a confirmation email within 2 days.\n\nOceanofPDF.com",
      "content_length": 93,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 475,
      "content": "Troubleshooting and VPC Limits\n\nIn this chapter, we will cover the following recipes:\n\nTroubleshooting IP address overlapping Errors while connecting an EC2 instance in a VPC Internet not accessible in the instance Internet not accessible in the private subnet instance (NAT Gateway) Not able to delete a VPC Enabling VPC flow logs Increasing VPC limits\n\nOceanofPDF.com",
      "content_length": 369,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 476,
      "content": "Introduction\n\nIn this chapter, we will go through basic and advanced troubleshooting steps while creating and managing a VPC. You may have your own tools to check such issues, but there are a few standard series of tasks that you can look into. For example, incorrect CIDR block, overlapping routing table, and so on.\n\nOceanofPDF.com",
      "content_length": 333,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 477,
      "content": "Troubleshooting IP address overlapping\n\nThink of a scenario--you have already set up a VPC with instances inside it with, say, 172.0.x.x/16 CIDR and you've realized that the client who is going to connect also has the same CIDR block. So, wisely choose the IP address ranges for your VPC to avoid conflict with another network that you might connect to.\n\nOceanofPDF.com",
      "content_length": 369,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 478,
      "content": "Getting ready\n\nYou will need access to modify the VPC.\n\nOceanofPDF.com",
      "content_length": 70,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 479,
      "content": "How to do it...\n\nThe only option is to create a new VPC and migrate resources into the new one. Please follow the steps given in Chapter 2, Building Your Own Custom VPC, to create a new VPC.\n\nOceanofPDF.com",
      "content_length": 206,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 480,
      "content": "There's more...\n\nYou can create multiple VPCs with the same CIDR blocks. These VPCs will act as an individual network, but if you need to do peering between two VPCs, then it will create an issue. As you can't modify a VPC CIDR block, the only solution for this issue is to create another VPC that doesn't overlap with your peering VPC.\n\nOceanofPDF.com",
      "content_length": 352,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 481,
      "content": "Errors while connecting an EC2 instance in a VPC\n\nThere can be multiple reasons for getting such an error; a few of them are mentioned following:\n\nEC2 created in the wrong subnet group or private subnet Instance doesn't have a public IP or you are trying to connect with a private IP SSH/RDP port is not opened in the security group or the security group is not attached to the instance\n\nOceanofPDF.com",
      "content_length": 402,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 482,
      "content": "Getting ready\n\nYou should have access to EC2 and VPC to view and modify the resources.\n\nOceanofPDF.com",
      "content_length": 102,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 483,
      "content": "How to do it...\n\nThe following steps are to be followed:\n\n1. Start by checking the IP of the instance. Verify that you are using the correct IP address. Follow the following steps to check the IP: 1. Log in to the AWS Console | EC2 | Instances | Instance.\n\nAWS EC2 Console\n\n2. Check that your instance has either a public IP address or an Elastic IP address associated with it in the case of public instances. Follow the following steps to check the Associated Elastic IP: 3. Log in to the AWS Console | EC2 | Elastic IPs | Allocate new\n\naddress.",
      "content_length": 546,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 484,
      "content": "Allocate Elastic IP\n\n4. When prompted, click on Allocate.\n\nAllocate Elastic IP\n\n5. Once the IP comes up, go to Actions | Associate address.\n\nAssociate Elastic IP\n\n6. Provide the instance details.\n\nAssociate Elastic IP",
      "content_length": 217,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 485,
      "content": "7. The Associated IP and details will look like this.\n\nAssociate Elastic IP\n\n8. Check the IP in the instance.\n\nAWS EC2 Elastic IP Details\n\n2. Check that both System Status Checks and Instance Status Checks are cleared. The following are the steps:\n\n1. Log in to the AWS Console | EC2 | Instances. 2. Then choose the Status Checks tab. 3. Verify that the instance passes both status checks.\n\n3. The SSH/RDP port may not be opened in the Security Group. Or there may be a scenario where you missed attaching the right Security Group to the instance:\n\n1. Log in to the AWS Console | EC2 | Instances. 2. Select Instance | Security Group.",
      "content_length": 633,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 486,
      "content": "Check Security Group\n\n3. Select the Inbound tab.\n\nSelect Security Group\n\n4. Your Security Group should allow SSH access over port 22 from your IP.",
      "content_length": 146,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 487,
      "content": "Check Inbound Rules\n\n1. If SSH access is not available, create a new rule by clicking on Edit | Add Rule.\n\nAdd Inbound Rule in Security Group\n\n2. Select Type | SSH | Source | My IP and click on Save.",
      "content_length": 199,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 488,
      "content": "Security Group: Add SSH Rule\n\n5. Check whether the server has been created in the right subnet or whether the subnet allows traffic from the necessary ports and protocols.\n\n1. Log in to the AWS Console | Amazon Virtual Private Cloud (VPC) and navigate to Network ACLs.\n\n2. Choose either the Inbound Rules or Outbound Rules tab. 3. Choose to Allow for the traffic from the source IP address in both inbound and outbound rules.\n\nOceanofPDF.com",
      "content_length": 441,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 489,
      "content": "There's more...\n\nIf you still face this issue when connecting instances, there could be multiple reasons. The reasons can be as follows:\n\nLocal firewall rules Routing policy of your network Trying to connect with the wrong key pair\n\nOceanofPDF.com",
      "content_length": 247,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 490,
      "content": "Internet not accessible in the instance\n\nYou are connected to your public subnet instance but, while updating the OS or trying to connect to the internet, you get an error. In this recipe, we will look at the possible reasons for internet related issues.\n\nWe will discuss private instances in a later section.\n\nOceanofPDF.com",
      "content_length": 325,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 491,
      "content": "Getting ready\n\nFor troubleshooting, you will need access to the server and the VPC.\n\nOceanofPDF.com",
      "content_length": 99,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 492,
      "content": "How to do it...\n\n1. Verify whether the Route Table has the appropriate routes entered for the destination 0.0.0.0/0 via the Internet Gateway.\n\n1. Log in to the AWS Console | Amazon Virtual Private Cloud (VPC). 2. Select Route Tables from the navigation pane.\n\n3. Choose the Route Table associated with your subnet instance.\n\nSelect Route Table\n\n4. Select the Routes tab. Check whether the default routes (as mentioned in the image) are attached or any customized route is",
      "content_length": 471,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 493,
      "content": "available to the instance.\n\nCheck Routes\n\n2. Check whether the Internet Gateway is attached to the VPC:\n\n1. Log in to the AWS Console and select Amazon Virtual Private Cloud (VPC).\n\n2. Navigate to Internet Gateways and choose Create Internet Gateway.",
      "content_length": 250,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 494,
      "content": "Goto Internet Gateway\n\n3. Select the Internet Gateway and check whether it is connected to the right VPC.\n\nSelect Internet Gateway\n\n4. If not attached, Choose Attach to VPC, and select your VPC from the list.\n\nOceanofPDF.com",
      "content_length": 224,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 495,
      "content": "There's more...\n\nThere can be various other reasons, which are as follows:\n\nOS firewall rules or SELinux Confirm DNS Resolution\n\nOceanofPDF.com",
      "content_length": 143,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 496,
      "content": "Internet not accessible in the private subnet instance (NAT Gateway)\n\nWhile working with a private instance, we face various issues in terms of an EC2 instance connecting to the internet or any other instance in the subnet.\n\nOceanofPDF.com",
      "content_length": 239,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 497,
      "content": "How to do it...\n\n1. The first troubleshooting step starts with pinging the destination (any other host or internet).\n\nMake sure that you test the destination from another server or your own computer because the destination host/website should have ICMP enabled.\n\n2. Verify that NAT Gateway and EC2 are attached to the desired subnet. 3. Ensure that NAT Gateway has been created in a public subnet.\n\nPublic subnet should have a public Route Table having a default route pointing to the Internet Gateway.\n\n4. Check that the NAT Gateway is in an available state. If the NAT Gateway goes into a failed state, you will need to resolve the issue or create a new one immediately.\n\nA failed NAT Gateway will be deleted automatically at some time, usually in an hour.\n\n5. Make sure you don't have any blocked rules in the Network ACLs associated with your VPC.\n\n6. Ensure that the security group rules for your private instance allows outbound internet traffic. For the ping command to work, the rules must also allow outbound ICMP traffic.\n\nOceanofPDF.com",
      "content_length": 1047,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 498,
      "content": "Not able to delete a VPC\n\nNow you have created a VPC, but you are unable to delete it.\n\nOceanofPDF.com",
      "content_length": 102,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 499,
      "content": "Getting ready\n\nBefore deleting a VPC, all the resources attached to the VPC have to be terminated or released.\n\nOceanofPDF.com",
      "content_length": 126,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 500,
      "content": "How to do it...\n\n1. Check whether the NAT gateway is detached. 2. Disassociate the Elastic IP. 3. Remove dependencies between security groups 4. Terminate the EC2 instance. 5. Terminate the RDS instance and the DB subnet group. 6. Delete the Virtual Private Gateway. 7. All the VPN attachments will be terminated. 8. Delete the Internet Gateway. 9. Delete the Route Tables. OceanofPDF.com",
      "content_length": 388,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 501,
      "content": "Enabling VPC flow logs\n\nVPC flow logs is a feature which helps in capturing information about the IP network traffic going to and from the VPC. This information can be used for troubleshooting connectivity and security. All the logs are stored in CloudWatch logs. You can also trigger an alarm for certain use cases or threats.\n\nOceanofPDF.com",
      "content_length": 343,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 502,
      "content": "Getting ready\n\nYou will need access to the VPC and CloudWatch.\n\nOceanofPDF.com",
      "content_length": 78,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 503,
      "content": "How to do it...\n\n1. Log in to the AWS Console and then select VPC.\n\n1. Select your VPC | Actions | Create Flow Log.\n\nCreate Flow Log\n\n2. Click Create Flow Log.",
      "content_length": 159,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 504,
      "content": "Create Flow Log\n\n3. Create a role if it's not already there by selecting Set Up Permissions.",
      "content_length": 92,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 505,
      "content": "Create Flow Log\n\n4. Navigate to Flow Logs in the lower pane.\n\nNavigate Flow Log\n\n5. Flow Logs will appear in the Cloudwatch Logs.\n\nCheck Flow Log in CloudWatch\n\nOceanofPDF.com",
      "content_length": 175,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 506,
      "content": "There's more...\n\nFlow logs will not include the following traffic:\n\nVPC flow logs support network interfaces created in VPC only, that is, EC2-classic links are not supported. Traffic to or from DNS servers. Windows license activation traffic. Traffic to and from instance metadata (that is, 169.254.169.254) requests. DHCP requests or responses.\n\nFlow logs cannot be tagged Flow logs configurations can't be changed once created, so you need to delete the existing ones and create new ones.\n\nOceanofPDF.com",
      "content_length": 507,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 507,
      "content": "Increasing VPC Limits\n\nVPC and, in fact, all AWS resources come with certain soft/hard limits so that people don't misuse or continue to spin up instances without any requirement. It also helps if your AWS server/account gets hacked and the hacker starts spinning up multiple high configuration servers to give you a billing heart attack.\n\nOceanofPDF.com",
      "content_length": 354,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 508,
      "content": "Getting ready\n\nLimits of various services:\n\nSr.no Resources\n\n1\n\nVPC per region\n\n2\n\nSubnets per VPC\n\n3\n\nEIP per region\n\n4\n\nFlow logs per ENI per region\n\n5\n\nCustomer Gateway per region\n\nDefault limit\n\n5\n\n200\n\n5\n\n2\n\n50\n\nLimit type\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nHard Limit\n\nSoft Limit\n\nComments\n\nInternet Gateway per region will also increase by the same number\n\nThis limit is for VPC specific resources apart from EC2",
      "content_length": 421,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 509,
      "content": "6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\nInternet Gateway per region\n\nNAT Gateway per AZ\n\nVirtual private gateway per region\n\nNACL per VPC\n\nRules per NACL\n\nENI per region\n\nRoute Tables per VPC\n\n5\n\n5\n\n5\n\n200\n\n20\n\n350\n\n200\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nHard Limit\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nThis is directly related to VPCs and cannot be increased without increasing the VPC\n\nSingle NACL can be attached to multiple subnets\n\nThis can be increased to 40\n\nNo of ENI = No. of Instance * 5",
      "content_length": 483,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 510,
      "content": "13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\nRoutes per Route Table (Propagated Routes)\n\nRoutes per Route Table (Non Propagated Routes)\n\nSecurity Groups per VPC\n\nInbound/outbound rules per vpc\n\nSecurity Groups per ENI\n\nVPC Peering connections per VPC\n\nOutstanding VPC peering connection requests\n\n100\n\n50\n\n500\n\n50\n\n5\n\n50\n\n25\n\nHard Limit\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nSoft Limit\n\nMax Limit = 100\n\n50 inbound + 50 outbound (Total Max = 250)\n\nMax Limit = 16\n\nMax Limit = 125",
      "content_length": 485,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 511,
      "content": "20\n\n21\n\n22\n\nVPC endpoint per region\n\nVPN connections per VPC\n\nVPN connections per region\n\n20\n\nSoft Limit\n\n50\n\nSoft Limit\n\n10\n\nSoft Limit\n\nOceanofPDF.com\n\nMax Limit = 255 endpoints",
      "content_length": 179,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 512,
      "content": "How to do it...\n\nFollow the below steps to increase the limit of any resource:\n\n1. Log in to the AWS Console and click on Support (Upper right-hand side corner).\n\nNavigate Support Center\n\n2. Click Create Case.\n\nCreate Support case\n\n3. Select Regarding as Service Limit Increase and Limit Type as EC2 instances (or any other service you want to increase the limit for).",
      "content_length": 368,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 513,
      "content": "Provide Support Case Details\n\n4. Provide the required details as asked for in the form. You can also add another request within the same ticket.\n\nProvide New limit details\n\n5. Provide Use Case Description, Support Language, and Contact method. 6. Click on Submit to complete the submission.",
      "content_length": 290,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 514,
      "content": "OceanofPDF.com",
      "content_length": 14,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 515,
      "content": "Pricing of VPC and Related Components\n\nIn this chapter, we shall learn the following recipes:\n\nVPC, VPN and Nat Gateway pricing EC2, ELB and Elastic IP pricing Route 53 pricing Direct Connect pricing CloudFront pricing WAF and Cloud Shield pricing\n\nOceanofPDF.com",
      "content_length": 263,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 516,
      "content": "Introduction\n\nYou have learned different recipes related to different AWS networking components and infrastructure. Let's understand how pricing is done by AWS for these services. Pricing may be different for the same components over different regions. So you should consider costing in different regions before hosting your network and infrastructure in a particular AWS region. We shall use the AWS cost calculator, which is a simple user interface that lists most of the AWS services, and we can calculate the cost of all of the services that we are going to use in our AWS infrastructure for one or multiple regions. You need to remember that the cost of the networking components is calculated on their actual usage. AWS's pricing of services changes from time to time, so you should get the latest cost from the pricing page of each service. You can see the details of AWS free at: https://aws.amazon. com/free/. Here is the list of network related free services:\n\nThe list of free networking related components are:\n\nVPC Subnet Internet Gateway Security Group NACL Routing Table VPC Endpoint\n\nAlso supporting services like IAM, AWS CLI, and AWS CloudFormation are free. We are providing recipe to calculate pricing for some of the AWS components. You can apply same process for other AWS components as well.\n\nOceanofPDF.com",
      "content_length": 1330,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 517,
      "content": "VPC, VPN and Nat Gateway pricing\n\nVPC and most of its components are free. However we need to pay for data that we transfer in and out of these components. To understand details of pricing, browse to the link: https://aws.amazon.com/vpc/pricing/.\n\nOceanofPDF.com",
      "content_length": 262,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 518,
      "content": "Getting ready\n\nWe will start by short listing regions where an infrastructure can be created which may be dependent on network latency, compliance, and so on. Also you will need to determine which VPC components and how many of them you need to create.\n\nOceanofPDF.com",
      "content_length": 268,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 519,
      "content": "How to do it...\n\n1. Browse to the AWS cost calculator https://calculator.s3.amazonaws.com/index.html. US-East is the default region selected. Choose a different region if you wish to. Choose Amazon VPC from the left side menu option:\n\nAWS cost calculator\n\n2. Add the desired components, such as VPC, that you need to choose by clicking on +. If you want to delete a row, choose -. For the Usage field, you can choose the utilization % or hours or define it in terms of days or weeks or months. For each VPC, you can choose zero or more VPN connections. The cost will be updated in the Estimate of your Monthly Bill tab. I have added one VPC with 1 GB data in and 1 GB data out per month. You can see that the cost is zero for 100% utilization:\n\nVPC cost without VPN\n\n3. Now let's add a prod VPC with 1 VPN with 100% utilization. We can see the monthly cost has increased to $36.60:",
      "content_length": 881,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 520,
      "content": "VPC cost with VPN\n\n4. Let's add 100 GB/month data in. You can see that the cost remains the same:\n\nVPC cost with VPN and data in\n\n5. Let's add 100 GB/month data transfer out. You can see that the price has increased to $44.25:\n\nVPC cost with VPN and data in and out\n\n6. Click on the Estimate of Your Monthly Bill tab. You can see the breakdown of the cost, along with the free tier discount amount:",
      "content_length": 398,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 521,
      "content": "VPC cost breakdown with VPN and data in and out\n\n7. Let's go back to the Services tab. Add one NAT with 100% utilization. Add 100 GB data in and out. You can see that the cost has further increased to $90.69:\n\nVPC cost with VPN, NAT and data in and out\n\n8. Click on the Estimate of Your Monthly Bill tab. You can see the breakdown of the cost, with the NAT cost added:\n\nVPC cost breakup with VPN, NAT and data in and out",
      "content_length": 420,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 522,
      "content": "OceanofPDF.com",
      "content_length": 14,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 523,
      "content": "There's more...\n\nThe data transfer cost is different with different usage levels. With higher usage, the cost reduces. You can see this at: https://aws.amazon.com/ec2/pricing/on-de mand/#Data_Transfer.\n\nOceanofPDF.com",
      "content_length": 217,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 524,
      "content": "EC2, ELB and Elastic IP pricing\n\nEC2 is the infrastructure service that you need to host your application. You need services such as EBS to be attached to EC2. Elastic IP or ELB can be used to expose your service, hosted on EC2 to the end users. The cost of EC2 is dependent on the type of EC2 and the operating system. Discounts are available for reserved instances. We should consider shared instances with on demand usage for costing. Dedicated instances are also available for special purposes. To understand details of pricing, go to https://aws.amazon.c om/ec2/pricing/.\n\nOceanofPDF.com",
      "content_length": 592,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 525,
      "content": "Getting ready\n\nWe will start by short listing regions where an infrastructure can be created, which may be dependent on network latency, compliance, and so on. Perhaps you also need to determine how many of the EC2, EBS, ELB, and EIP components you will need to create.\n\nOceanofPDF.com",
      "content_length": 285,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 526,
      "content": "How to do it...\n\n1. Open a new cost calculator if you want to have the cost for only EC2 related components or use the same cost calculator used for the earlier recipe. Choose Amazon EC2 from the left menu bar:\n\nAWS cost calculator for EC2\n\n2. Click + under Compute: Amazon EC2 Instances: to add EC2 to the cost calculator. Enter the description, the number of instances, and the usage details. Click on the icon for type. The following window will open. Choose the instance type and operating system based on your need. Click on Close and Save:",
      "content_length": 545,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 527,
      "content": "EC2 OS and instance type selection\n\n3. Click the icon next to the billing options. The following window will open. Choose the required billing option and click on Close and Save. For reserved options, you may pay upfront, partially upfront or no upfront fee at all. You need to make the upfront payment at the start of your reservation, as shown in the Upfront Price column. Effective Hourly Cost shows the per hour charge for using the instance:",
      "content_length": 446,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 528,
      "content": "EC2 pricing options\n\n4. Now let's add the cost of storage attached to the EC2 instance. Click + under Storage: Amazon EBS Volumes:. Add the volume description, the number of volumes, the volume type, the storage amount and the snapshot size for backup:\n\nEBS pricing options\n\n5. Next, add the Elastic IP requirement details and data transfer details:\n\nElastic IP and data transfer options",
      "content_length": 387,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 529,
      "content": "6. Finally, add ELB and the data processed by ELB:\n\nLoad balancing options\n\n7. Browse to the Estimate of Your Monthly Bill tab. You will be able to see the details for the cost components:\n\nMonthly bill for EC2\n\nOceanofPDF.com",
      "content_length": 226,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 530,
      "content": "Route 53 pricing\n\nRoute 53 is priced for pay per use DNS service. It has components such as hosted zones, traffic flow and queries. AWS has a staggering price for the number of hosted zones and queries, with a lesser unit price beyond a certain usage. For details, check https://aws.amazon.com/route53/pricing/.\n\nOceanofPDF.com",
      "content_length": 327,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 531,
      "content": "Getting ready\n\nYou need to decide the amount of traffic flow, the hosted zones and the health check to be used for Route 53.\n\nOceanofPDF.com",
      "content_length": 140,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 532,
      "content": "How to do it...\n\n1. Open a new cost calculator if you want to have the cost for only Route 53 related components or use the same cost calculator used for earlier recipes. Choose Amazon Route 53 from the left menu bar:\n\nAWS cost calculator for Route 53\n\n2. Add the hosted zones, the traffic flow and type and the number of queries. You can see the estimated bill on the other tab:\n\nRoute 53 cost for Hosted zone components\n\n3. Add DNS failover details under DNS Failover Health Checks for endpoints:",
      "content_length": 498,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 533,
      "content": "Route 53 cost for Hosted zone components and Failover health check\n\n4. Browse to the Estimate of your Monthly Bill tab. You will be able to see the details for the cost components:\n\nRoute 53 monthly bill\n\nOceanofPDF.com",
      "content_length": 219,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 534,
      "content": "Direct Connect pricing\n\nDirect Connect comes with a dedicated bandwidth connectivity ranging from 50 MB per second to 10 GB per second. It also has certain locations to which you need to establish connectivity for your data center.\n\nOceanofPDF.com",
      "content_length": 247,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 535,
      "content": "Getting ready\n\nWe first need to finalize the number and bandwidth connectivity for Direct Connect.\n\nOceanofPDF.com",
      "content_length": 114,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 536,
      "content": "How to do it...\n\n1. Open a new cost calculator if you only want to have the cost for Direct Connect related components, or use the same cost calculator used for earlier recipes. Choose AWS Direct Connect from the left menu bar:\n\nAWS cost calculator for Direct Connect\n\n2. Add Direct Connect by clicking on +. If you want to delete a row, choose -. Provide the Port Description, number of ports and width, Port Usage, and Location. There are many locations available nearest to the AWS region, as shown in the following screenshot:\n\nDirect Connect locations\n\n3. Put in values for Data Transfer In and Data Transfer Out and get the final pricing:",
      "content_length": 644,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 537,
      "content": "Direct Connect cost components\n\n4. Browse to the Estimate of your Monthly Bill tab. You will be able to see the details for the cost components:\n\nDirect Connect monthly bill\n\nOceanofPDF.com",
      "content_length": 189,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 538,
      "content": "CloudFront pricing\n\nCloudFront is a caching service provided by AWS. There is a certain free use limit for CloudFront. The AWS CloudFront price is different for different geographic regions. You can get a discount for reserved pricing if you commit certain uses for at least 12 months. For details go to: https://aws.a mazon.com/cloudfront/pricing/.\n\nOceanofPDF.com",
      "content_length": 365,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 539,
      "content": "Getting ready\n\nWe first need to finalize the data transfer amount, the request type, and the request.\n\nOceanofPDF.com",
      "content_length": 117,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 540,
      "content": "How to do it...\n\n1. Open a new cost calculator if you want to have the cost for only CloudFront related components, or use the same cost calculator used for earlier recipes. Choose AWS CloudFront from the left menu bar:\n\nAWS cost calculator for CloudFront\n\n2. Provide the data transfer volume, the average object size and the invalidation requests:\n\nCloudFront data transfer and request\n\n3. Provide the traffic distribution over the world, if you know. Provide the IP SSL certificates for HTTPS requests:",
      "content_length": 504,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 541,
      "content": "CloudFront data distribution\n\n4. Browse to the Estimate of your Monthly Bill tab. You will be able to see the details for the cost components:\n\nCloudFront monthly bill\n\nOceanofPDF.com",
      "content_length": 183,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 542,
      "content": "WAF and Cloud Shield pricing\n\nWAF and Cloud Shield pricing is still not integrated with the AWS cost calculator. Let's understand their pricing model. WAF can be integrated with ELB and CloudFront, so the WAF bill is included in the CloudFront or the ELB with which it is integrated.\n\nOceanofPDF.com",
      "content_length": 299,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 543,
      "content": "Getting ready\n\nWe first need to understand the components of the services.\n\nOceanofPDF.com",
      "content_length": 90,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 544,
      "content": "How to do it...\n\n1. Go to https://aws.amazon.com/waf/pricing/. You can see that the WAF price is based on the number of web ACL and rules. For example, if you have 2 web ACLs and 20 rules, the cost per month will be as follows:\n\n(2 * $5 per web ACL per month) + (20 * $1 per rule per web ACL per month) = $30\n\n2. WAF has an additional price for the number of requests. For example, if your application receives 20 million requests, then the cost per month will be:\n\n20*$0.60 per million web requests = $12\n\n3. So the total cost of WAF is $42 per month. 4. AWS Cloud Shield is free and is integrated with Elastic Load Balancing (ELB), Application Load Balancer, Amazon CloudFront, and Amazon Route 53. You don't need to pay anything extra for the AWS Cloud Shield.\n\n5. However, there is another option, AWS Shield Advanced which needs one year's commitment and comes with a monthly fee of $3000. It has additional costs for data transfers, as well as for Application Load Balancer and Amazon CloudFront. The data transfer price is different for each of these services and is priced as pay per use. The cost is different at different usage levels. For details, check https://aws.amazon.com/ shield/pricing/.\n\n6. If you use the AWS Cloud Shield Advanced, and your application needs to transfer 500 GB of data out, cost per month will be as follows:\n\n3000 + 500* Data Transfer Out Price (0.05 $ per GB) = $3025\n\nOceanofPDF.com",
      "content_length": 1422,
      "extraction_method": "Unstructured"
    }
  ]
}
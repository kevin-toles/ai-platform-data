{
  "metadata": {
    "title": "Python Essential Reference 4th",
    "author": "Unknown Author",
    "publisher": "Unknown Publisher",
    "edition": "1st Edition",
    "isbn": "",
    "total_pages": 742,
    "conversion_date": "2025-12-19T18:24:49.564523",
    "conversion_method": "PyMuPDF + OCR fallback",
    "source_pdf": "Python Essential Reference 4th.pdf",
    "extraction_method": "Unstructured"
  },
  "chapters": [
    {
      "number": 1,
      "title": "Segment 1 (pages 2-23)",
      "start_page": 2,
      "end_page": 23,
      "detection_method": "synthetic",
      "content": "Developer’s Library ESSENTIAL REFERENCES FOR PROGRAMMING PROFESSIONALS\n\nDeveloper’s Library books are designed to provide practicing programmers with unique, high-quality references and tutorials on the programming languages and technologies they use in their daily work.\n\nAll books in the Developer’s Library are written by expert technology practitioners who are especially skilled at organizing and presenting information in a way that’s useful for other programmers.\n\nKey titles include some of the best, most widely acclaimed books within their topic areas:\n\nPHP and MySQL Web Development Luke Welling & Laura Thomson ISBN 978-0-672-32916-6\n\nPython Essential Reference David Beazley ISBN-13: 978-0-672-32862-6\n\nMySQL Paul DuBois ISBN-13: 978-0-672-32938-8\n\nProgramming in Objective-C Stephen G. Kochan ISBN-13: 978-0-321-56615-7\n\nLinux Kernel Development Robert Love ISBN-13: 978-0-672-32946-3\n\nPostgreSQL Korry Douglas ISBN-13: 978-0-672-33015-5\n\nDeveloper’s Library books are available at most retail and online bookstores, as well as by subscription from Safari Books Online at safari.informit.com\n\nDeveloper’s Library informit.com/devlibrary\n\nF h Lib f L Bdff\n\nPython\n\nE S S E N T I A L R E F E R E N C E\n\nFourth Edition\n\nDavid M. Beazley\n\nUpper Saddle River, NJ • Boston • Indianapolis • San Francisco New York • Toronto • Montreal • London • Munich • Paris • Madrid Cape Town • Sydney • Tokyo • Singapore • Mexico City\n\nF h Lib f L Bdff\n\nPython Essential Reference Fourth Edition Copyright © 2009 by Pearson Education, Inc.\n\nAll rights reserved. No part of this book shall be reproduced, stored in a retrieval system, or transmitted by any means, electronic, mechani- cal, photocopying, recording, or otherwise, without written permission from the publisher. No patent liability is assumed with respect to the use of the information contained herein. Although every precaution has been taken in the preparation of this book, the publisher and author assume no responsibility for errors or omissions. Nor is any liability assumed for damages resulting from the use of the informa- tion contained herein.\n\nISBN-13: 978-0-672-32978-4 ISBN-10: 0-672-32978-6\n\nPrinted in the United States of America\n\nFirst Printing June 2009\n\nLibrary of Congress Cataloging-in-Publication data is on file.\n\nTrademarks All terms mentioned in this book that are known to be trademarks or service marks have been appropriately capitalized. Addison-Wesley cannot attest to the accuracy of this information. Use of a term in this book should not be regarded as affecting the validity of any trade- mark or service mark.\n\nWarning and Disclaimer Every effort has been made to make this book as complete and as accurate as possible, but no warranty or fitness is implied. The infor- mation provided is on an “as is” basis. The author and the publisher shall have neither liability nor responsibility to any person or entity with respect to any loss or damages arising from the information con- tained in this book.\n\nBulk Sales Addison-Wesley offers excellent discounts on this book when ordered in quantity for bulk purchases or special sales. For more information, please contact\n\nU.S. Corporate and Government Sales\n\n1-800-382-3419\n\ncorpsales@pearsontechgroup.com\n\nFor sales outside of the U.S., please contact\n\nInternational Sales\n\ninternational@pearson.com\n\nTo register this product and gain access to bonus content, go to www.informit.com/register to sign in and enter the ISBN. After you register the product, a link to the additional content will be listed on your Account page, under Registered Products.\n\nAcquisitions Editor Mark Taber\n\nDevelopment Editor Michael Thurston\n\nManaging Editor Patrick Kanouse\n\nProject Editor Seth Kerney\n\nCopy Editor Lisa Thibault\n\nIndexer David Beazley\n\nProofreader Megan Wade\n\nTechnical Editors Noah Gift Kurt Grandis\n\nPublishing Coordinator Vanessa Evans\n\nBook Designer Gary Adair\n\nCompositor Bronkella Publishing\n\nF h Lib f L Bdff\n\n❖\n\nFor Paula,Thomas., and his brother on the way.\n\n❖\n\nF h Lib f L Bdff\n\nContents at a Glance\n\nIntroduction\n\n1\n\nPart I: The Python Language\n\n1 A Tutorial Introduction\n\n5\n\n2 Lexical Conventions and Syntax\n\n25\n\n3 Types and Objects\n\n33\n\n4 Operators and Expressions\n\n65\n\n5 Program Structure and Control Flow 81\n\n6 Functions and Functional Programming\n\n93\n\n7 Classes and Object-Oriented Programming\n\n117\n\n8 Modules, Packages, and Distribution\n\n143\n\n9 Input and Output\n\n157\n\n10 Execution Environment\n\n173\n\n11 Testing, Debugging, Profiling, and Tuning\n\n181\n\nPart II: The Python Library\n\n12 Built-In Functions\n\n201\n\n13 Python Runtime Services\n\n219\n\n14 Mathematics\n\n243\n\n15 Data Structures, Algorithms, and Code Simplification\n\n16 String and Text Handling\n\n277\n\n17 Python Database Access\n\n297\n\n18 File and Directory Handling\n\n313\n\n19 Operating System Services\n\n331\n\n20 Threads and Concurrency\n\n413\n\n21 Network Programming and Sockets\n\n449\n\n22 Internet Application Programming\n\n497\n\n23 Web Programming\n\n531\n\n24 Internet Data Handling and Encoding\n\n545\n\n25 Miscellaneous Library Modules\n\n585\n\nPart III: Extending and Embedding\n\n26 Extending and Embedding Python\n\n591\n\nAppendix: Python 3 621\n\nIndex\n\n639\n\n257\n\nF h Lib f L Bdff\n\nTable of Contents\n\nIntroduction 1\n\nI: The Python Language\n\n1 A Tutorial Introduction 5\n\nRunning Python 5\n\nVariables and Arithmetic Expressions 7\n\nConditionals 9\n\nFile Input and Output 10\n\nStrings 11\n\nLists 12\n\nTuples 14\n\nSets 15\n\nDictionaries 16\n\nIteration and Looping 17\n\nFunctions 18\n\nGenerators 19\n\nCoroutines 20\n\nObjects and Classes 21\n\nExceptions 22\n\nModules 23\n\nGetting Help 24\n\n2 Lexical Conventions and Syntax 25\n\nLine Structure and Indentation 25\n\nIdentifiers and Reserved Words 26\n\nNumeric Literals 26\n\nString Literals 27\n\nContainers 29\n\nOperators, Delimiters, and Special Symbols 30\n\nDocumentation Strings 30\n\nDecorators 30\n\nSource Code Encoding 31\n\n3 Types and Objects 33\n\nTerminology 33\n\nObject Identity and Type 33\n\nReference Counting and Garbage Collection 34\n\nReferences and Copies 35\n\nF h Lib f L Bdff\n\nviii\n\nContents\n\nFirst-Class Objects 36\n\nBuilt-in Types for Representing Data 37\n\nThe None Type 38\n\nNumeric Types 38\n\nSequence Types 39\n\nMapping Types 44\n\nSet Types 46\n\nBuilt-in Types for Representing Program Structure 47\n\nCallable Types 47\n\nClasses, Types, and Instances 50\n\nModules 50\n\nBuilt-in Types for Interpreter Internals 51\n\nCode Objects 51\n\nFrame Objects 52\n\nTraceback Objects 52\n\nGenerator Objects 53\n\nSlice Objects 53\n\nEllipsis Object 54\n\nObject Behavior and Special Methods 54\n\nObject Creation and Destruction 54\n\nObject String Representation 55\n\nObject Comparison and Ordering 56\n\nType Checking 57\n\nAttribute Access 57\n\nAttribute Wrapping and Descriptors 58\n\nSequence and Mapping Methods 58\n\nIteration 59\n\nMathematical Operations 60\n\nCallable Interface 62\n\nContext Management Protocol 62\n\nObject Inspection and dir()\n\n63\n\n4 Operators and Expressions 65\n\nOperations on Numbers 65\n\nOperations on Sequences 67\n\nString Formatting 70\n\nAdvanced String Formatting 72\n\nOperations on Dictionaries 74\n\nOperations on Sets 75\n\nAugmented Assignment 75\n\nF h Lib f L Bdff\n\nContents\n\nix\n\nThe Attribute (.) Operator 76\n\nThe Function Call () Operator 76\n\nConversion Functions 76\n\nBoolean Expressions and Truth Values 77\n\nObject Equality and Identity 78\n\nOrder of Evaluation 78\n\nConditional Expressions 79\n\n5 Program Structure and Control Flow 81\n\nProgram Structure and Execution 81\n\nConditional Execution 81\n\nLoops and Iteration 82\n\nExceptions 84\n\nBuilt-in Exceptions 86\n\nDefining New Exceptions 88\n\nContext Managers and the with Statement 89 Assertions and __debug__ 91\n\n6 Functions and Functional Programming 93\n\nFunctions 93\n\nParameter Passing and Return Values 95\n\nScoping Rules 96\n\nFunctions as Objects and Closures 98\n\nDecorators 101\n\nGenerators and yield 102\n\nCoroutines and yield Expressions 104\n\nUsing Generators and Coroutines 106\n\nList Comprehensions 108\n\nGenerator Expressions 109\n\nDeclarative Programming 110\n\nThe lambda Operator 112\n\nRecursion 112\n\nDocumentation Strings 113\n\nFunction Attributes 114 eval(), exec(), and compile() 115\n\n7 Classes and Object-Oriented Programming 117\n\nThe class Statement 117\n\nClass Instances 118\n\nScoping Rules 118\n\nInheritance 119\n\nF h Lib f L Bdff\n\nx\n\nContents\n\nPolymorphism Dynamic Binding and Duck Typing 122\n\nStatic Methods and Class Methods 123\n\nProperties 124\n\nDescriptors 126\n\nData Encapsulation and Private Attributes 127\n\nObject Memory Management 128\n\nObject Representation and Attribute Binding 131 __slots__ 132\n\nOperator Overloading 133\n\nTypes and Class Membership Tests 134\n\nAbstract Base Classes 136\n\nMetaclasses 138\n\nClass Decorators 141\n\n8 Modules, Packages, and Distribution 143\n\nModules and the import Statement 143\n\nImporting Selected Symbols from a Module 145\n\nExecution as the Main Program 146\n\nThe Module Search Path 147\n\nModule Loading and Compilation 147\n\nModule Reloading and Unloading 149\n\nPackages 149\n\nDistributing Python Programs and Libraries 152\n\nInstalling Third-Party Libraries 154\n\n9 Input and Output 157\n\nReading Command-Line Options 157\n\nEnvironment Variables 158\n\nFiles and File Objects 158\n\nStandard Input, Output, and Error 161 The print Statement 162 The print() Function 163\n\nVariable Interpolation in Text Output 163\n\nGenerating Output 164\n\nUnicode String Handling 165\n\nUnicode I/O 167\n\nUnicode Data Encodings 168\n\nUnicode Character Properties 170\n\nObject Persistence and the pickle Module 171\n\nF h Lib f L Bdff\n\nContents\n\nxi\n\n10 Execution Environment 173\n\nInterpreter Options and Environment 173\n\nInteractive Sessions 175\n\nLaunching Python Applications 176\n\nSite Configuration Files 177\n\nPer-user Site Packages 177\n\nEnabling Future Features 178\n\nProgram Termination 179\n\n11 Testing, Debugging, Profiling, and Tuning 181\n\nDocumentation Strings and the doctest Module 181\n\nUnit Testing and the unittest Module 183\n\nThe Python Debugger and the pdb Module 186\n\nDebugger Commands 187\n\nDebugging from the Command Line 189\n\nConfiguring the Debugger 190\n\nProgram Profiling 190\n\nTuning and Optimization 191\n\nMaking Timing Measurements 191\n\nMaking Memory Measurements 192\n\nDisassembly 193\n\nTuning Strategies 194\n\nII: The Python Library 199\n\n12 Built-In Functions and Exceptions 201\n\nBuilt-in Functions and Types 201\n\nBuilt-In Exceptions 212\n\nException Base Classes 212\n\nException Instances 212\n\nPredefined Exception Classes 213\n\nBuilt-In Warnings 216\n\nfuture_builtins 217\n\n13 Python Runtime Services 219\n\natexit 219\n\ncopy 219\n\nNotes 220\n\nF h Lib f L Bdff\n\nxii\n\nContents\n\ngc 220\n\nNotes 222\n\ninspect 222\n\nmarshal 226\n\nNotes 226\n\npickle 226\n\nNotes 229\n\nsys 229\n\nVariables 229\n\nFunctions 233\n\ntraceback 235\n\ntypes 237\n\nNotes 237\n\nwarnings 238\n\nNotes 239\n\nweakref 240\n\nExample 242\n\nNotes 242\n\n14 Mathematics 243\n\ndecimal 243\n\nDecimal Objects 244\n\nContext Objects 244\n\nFunctions and Constants 247\n\nExamples 248\n\nNotes 249\n\nfractions 250\n\nmath 251\n\nNotes 252\n\nnumbers 252\n\nNotes 253\n\nrandom 254\n\nSeeding and Initialization 254\n\nRandom Integers 254\n\nRandom Sequences 254\n\nReal-Valued Random Distributions 255\n\nNotes 256\n\nF h Lib f L Bdff\n\nContents\n\nxiii\n\n15 Data Structures, Algorithms, and Code Simplification 257\n\nabc 257\n\narray 259\n\nNotes 261\n\nbisect 261\n\ncollections 262\n\ndeque and defaultdict 262\n\nNamed Tuples 263\n\nAbstract Base Classes 265\n\ncontextlib 267\n\nfunctools 268\n\nheapq 269\n\nitertools 270\n\nExamples 273\n\noperator 273\n\n16 String and Text Handling 277\n\ncodecs 277\n\nLow-Level codecs Interface 277\n\nI/O-Related Functions 279\n\nUseful Constants 279\n\nStandard Encodings 280\n\nNotes 280\n\nre 281\n\nPattern Syntax 281\n\nFunctions 283\n\nRegular Expression Objects 284\n\nMatch Objects 285\n\nExample 286\n\nNotes 287\n\nstring 287\n\nConstants 287\n\nFormatter Objects 288\n\nTemplate Strings 289\n\nUtility Functions 290\n\nstruct 290\n\nPacking and Unpacking Functions 290\n\nStruct Objects 291\n\nF h Lib f L Bdff\n\nxiv\n\nContents\n\nFormat Codes 291\n\nNotes 292\n\nunicodedata 293\n\n17 Python Database Access 297\n\nRelational Database API Specification 297\n\nConnections 297\n\nCursors 298\n\nForming Queries 300\n\nType Objects 301\n\nError Handling 302\n\nMultithreading 302\n\nMapping Results into Dictionaries 303\n\nDatabase API Extensions 303\n\nsqlite3 Module 303\n\nModule-Level Functions 304\n\nConnection Objects 305\n\nCursors and Basic Operations 308\n\nDBM-Style Database Modules 310\n\nshelve Module 311\n\n18 File and Directory Handling 313\n\nbz2 313\n\nfilecmp 314\n\nfnmatch 316\n\nExamples 316\n\nglob 317\n\nExample 317\n\ngzip 317\n\nNotes 317\n\nshutil 318\n\ntarfile 319\n\nExceptions 322\n\nExample 322\n\ntempfile 323\n\nzipfile 324\n\nzlib 328\n\nF h Lib f L Bdff\n\nContents\n\nxv\n\n19 Operating System Services 331\n\ncommands 331\n\nNotes 332\n\nconfigParser, Configparser 332\n\nThe ConfigParser Class 332\n\nExample 334\n\nNotes 336\n\ndatetime 336\n\ndate Objects 336\n\ntime Objects 338\n\ndatetime objects 339\n\ntimedelta objects 340\n\nMathematical Operations Involving Dates 341\n\ntzinfo Objects 342\n\nDate and Time Parsing 343\n\nerrno 343\n\nPOSIX Error Codes 344\n\nWindows Error Codes 346\n\nfcntl 347\n\nExample 348\n\nNotes 349\n\nio 349\n\nBase I/O Interface 349\n\nRaw I/O 350\n\nBuffered Binary I/O 351\n\nText I/O 353\n\nThe open() Function 354\n\nAbstract Base Classes 354\n\nlogging 355\n\nLogging Levels 355\n\nBasic Configuration 355\n\nLogger Objects 356\n\nHandler Objects 362\n\nMessage Formatting 364\n\nMiscellaneous Utility Functions 366\n\nLogging Configuration 366\n\nPerformance Considerations 369\n\nNotes 369\n\nF h Lib f L Bdff\n\nxvi\n\nContents\n\nmmap 369\n\nNotes 372\n\nmsvcrt 372\n\noptparse 374\n\nExample 377\n\nNotes 378\n\nos 378\n\nProcess Environment 379\n\nFile Creation and File Descriptors 381\n\nFiles and Directories 386\n\nProcess Management 390\n\nSystem Configuration 395\n\nExceptions 396\n\nos.path 396\n\nsignal 399\n\nExample 401\n\nNotes 401\n\nsubprocess 402\n\nExamples 404\n\nNotes 404\n\ntime 405\n\nNotes 407\n\nwinreg 408\n\nNotes 411\n\n20 Threads and Concurrency 413\n\nBasic Concepts 413\n\nConcurrent Programming and Python 414\n\nmultiprocessing 415\n\nProcesses 415\n\nInterprocess Communication 417\n\nProcess Pools 424\n\nShared Data and Synchronization 426\n\nManaged Objects 428\n\nConnections 433\n\nMiscellaneous Utility Functions 434\n\nGeneral Advice on Multiprocessing 435\n\nthreading 436\n\nThread Objects 436\n\nTimer Objects 437\n\nF h Lib f L Bdff\n\nContents\n\nxvii\n\nLock Objects 438\n\nRLock 438\n\nSemaphore and Bounded Semaphore 439\n\nEvents 440\n\nCondition Variables 441\n\nWorking with Locks 442\n\nThread Termination and Suspension 443\n\nUtility Functions 443\n\nThe Global Interpreter Lock 444\n\nProgramming with Threads 444\n\nqueue, Queue 444\n\nQueue Example with Threads 445\n\nCoroutines and Microthreading 446\n\n21 Network Programming and Sockets 449\n\nNetwork Programming Basics 449\n\nasynchat 452\n\nasyncore 455\n\nExample 457\n\nselect 459\n\nAdvanced Module Features 460\n\nAdvanced Asynchronous I/O Example 460\n\nWhen to Consider Asynchronous Networking 467\n\nsocket 469\n\nAddress Families 470\n\nSocket Types 470\n\nAddressing 471\n\nFunctions 473\n\nExceptions 485\n\nExample 485\n\nNotes 486\n\nssl 486\n\nExamples 489\n\nSocketServer 489\n\nHandlers 490\n\nServers 491\n\nDefining Customized Servers 492\n\nCustomization of Application Servers 494\n\nF h Lib f L Bdff\n\nxviii\n\nContents\n\n22 Internet Application Programming 497\n\nftplib 497\n\nExample 500\n\nhttp Package 500\n\nhttp.client (httplib) 502\n\nhttp.server (BaseHTTPServer, CGIHTTPServer, SimpleHTTPServer) 506\n\nhttp.cookies (Cookie) 511\n\nhttp.cookiejar (cookielib) 513\n\nsmtplib 513\n\nExample 514\n\nurllib Package 514\n\nurllib.request (urllib2) 515\n\nurllib.response 520\n\nurllib.parse 520\n\nurllib.error 523\n\nurllib.robotparser (robotparser) 523\n\nNotes 524\n\nxmlrpc Package 524\n\nxmlrpc.client (xmlrpclib) 524\n\nxmlrpc.server (SimpleXMLRPCServer, DocXMLRPCServer) 527\n\n23 Web Programming 531\n\ncgi 533\n\nCGI Programming Advice 537\n\nNotes 538\n\ncgitb 539\n\nwsgiref 540\n\nThe WSGI Specification 540\n\nwsgiref Package 542\n\nwebbrowser 544\n\n24 Internet Data Handling and Encoding 545\n\nbase64 545\n\nbinascii 547\n\ncsv 548\n\nDialects 551\n\nExample 551\n\nF h Lib f L Bdff\n\nContents\n\nxix\n\nemail Package 552\n\nParsing Email 552\n\nComposing Email 555\n\nNotes 558\n\nhashlib 559\n\nhmac 559\n\nExample 560\n\nHTMLParser 561\n\nExample 562\n\njson 563\n\nmimetypes 566\n\nquopri 567\n\nxml Package 568\n\nXML Example Document 569\n\nxml.dom.minidom 570\n\nxml.etree.ElementTree 573\n\nxml.sax 580\n\nxml.sax.saxutils 583\n\n25 Miscellaneous Library Modules 585\n\nPython Services 585\n\nString Processing 586\n\nOperating System Modules 586\n\nNetwork 587\n\nInternet Data Handling 587\n\nInternationalization 587\n\nMultimedia Services 588\n\nMiscellaneous 588\n\nIII: Extending and Embedding 589\n\n26 Extending and Embedding Python 591\n\nExtension Modules 591\n\nAn Extension Module Prototype 593\n\nNaming Extension Modules 595\n\nCompiling and Packaging Extensions 596\n\nType Conversion from Python to C 597\n\nType Conversion from C to Python 602\n\nF h Lib f L Bdff\n\nxx\n\nContents\n\nAdding Values to a Module 604\n\nError Handling 605\n\nReference Counting 607\n\nThreads 607\n\nEmbedding the Python Interpreter 608\n\nAn Embedding Template 608\n\nCompilation and Linking 608\n\nBasic Interpreter Operation and Setup 608\n\nAccessing Python from C 610\n\nConverting Python Objects to C 611\n\nctypes 612\n\nLoading Shared Libraries 612\n\nForeign Functions 612\n\nDatatypes 613\n\nCalling Foreign Functions 615\n\nAlternative Type Construction Methods 616\n\nUtility Functions 617\n\nExample 618\n\nAdvanced Extending and Embedding 619\n\nJython and IronPython 620\n\nAppendix Python 3 621\n\nWho Should Be Using Python 3? 621\n\nNew Language Features 622\n\nSource Code Encoding and Identifiers 622\n\nSet Literals 622\n\nSet and Dictionary Comprehensions 623\n\nExtended Iterable Unpacking 623\n\nNonlocal Variables 624\n\nFunction Annotations 624\n\nKeyword-Only Arguments 625\n\nEllipsis as an Expression 626\n\nChained Exceptions 626\n\nImproved super()\n\n627\n\nAdvanced Metaclasses 627\n\nCommon Pitfalls 629\n\nText Versus Bytes 629\n\nNew I/O System 631\n\nF h Lib f L Bdff\n\nContents\n\nxxi\n\nprint() and exec() Functions 631\n\nUse of Iterators and Views 632\n\nIntegers and Integer Division 633\n\nComparisons 633\n\nIterators and Generators 633\n\nFile Names, Arguments, and Environment Variables 633\n\nLibrary Reorganization 634\n\nAbsolute Imports 634\n\nCode Migration and 2to3 634\n\nPorting Code to Python 2.6 634\n\nProviding Test Coverage 635\n\nUsing the 2to3 Tool 635\n\nA Practical Porting Strategy 637\n\nSimultaneous Python 2 and Python 3 Support 638\n\nParticipate 638\n\nIndex 639\n\nF h Lib f L Bdff\n\nAbout the Author David M. Beazley is a long-time Python enthusiast, having been involved with the Python community since 1996. He is probably best known for his work on SWIG, a popular software package for integrating C/C++ programs with other programming languages, including Python, Perl, Ruby,Tcl, and Java. He has also written a number of other programming tools, including PLY, a Python implementation of lex and yacc. Dave spent seven years working in the Theoretical Physics Division at Los Alamos National Laboratory, where he helped pioneer the use of Python with massively parallel supercomputers.After that, Dave went off to work as an evil professor, where he enjoyed tormenting college students with a variety of insane programming projects. However, he has since seen the error of his ways and is now working as an independent software developer, consultant, Python trainer, and occasional jazz musician living in Chicago. He can be contacted at http://www.dabeaz.com.\n\nAbout the Technical Editor Noah Gift is the co-author of Python For UNIX and Linux System Administration (O’Reilly) and is also working on Google App Engine In Action (Manning). He is an author, speaker, consultant, and community leader, writing for publications such as IBM developerWorks, Red Hat Magazine, O’Reilly, and MacTech. His consulting company’s website is http://www.giftcs.com, and much of his writing can be found at http://noahgift.com.You can also follow Noah on Twitter.\n\nNoah has a master’s degree in CIS from Cal State, Los Angeles, a B.S. in nutritional\n\nscience from Cal Poly San Luis Obispo, is an Apple and LPI-certified SysAdmin, and has worked at companies such as Caltech, Disney Feature Animation, Sony Imageworks, and Turner Studios. He is currently working at Weta Digital in New Zealand. In his free time he enjoys spending time with his wife Leah and their son Liam, composing for the piano, running marathons, and exercising religiously.\n\nF h Lib f L Bdff\n\nAcknowledgments This book would not be possible without the support of many people. First and fore- most, I’d like to thank Noah Gift for jumping into the project and providing his amaz- ing feedback on the fourth edition. Kurt Grandis also provided useful comments for many chapters. I’d also like to acknowledge past technical reviewers Timothy Boronczyk, Paul DuBois, Mats Wichmann, David Ascher, and Tim Bell for their valuable comments and advice that made earlier editions a success. Guido van Rossum, Jeremy Hylton, Fred Drake, Roger Masse, and Barry Warsaw also provided tremendous assis- tance with the first edition while hosting me for a few weeks back in the hot summer of 1999. Last, but not least, this book would not be possible without all of the feedback I received from readers.There are far too many people to list individually, but I have done my best to incorporate your suggestions for making the book even better. I’d also like to thank all the folks at Addison-Wesley and Pearson Education for their continued commitment to the project and assistance. Mark Taber, Michael Thurston, Seth Kerney, and Lisa Thibault all helped out to get this edition out the door in good shape.A special thanks is in order for Robin Drake, whose tremendous effort in editing previous edi- tions made the third edition possible. Finally, I’d like to acknowledge my amazing wife and partner Paula Kamen for all of her encouragement, diabolical humor, and love.\n\nF h Lib f L Bdff",
      "page_number": 2
    },
    {
      "number": 2,
      "title": "Segment 2 (pages 24-43)",
      "start_page": 24,
      "end_page": 43,
      "detection_method": "synthetic",
      "content": "We Want to Hear from You! As the reader of this book, you are our most important critic and commentator.We value your opinion and want to know what we’re doing right, what we could do better, what areas you’d like to see us publish in, and any other words of wisdom you’re willing to pass our way.\n\nYou can email or write me directly to let me know what you did or didn’t like about this book—as well as what we can do to make our books stronger.\n\nPlease note that I cannot help you with technical problems related to the topic of this book, and that due to the high volume of mail I receive, I might not be able to reply to every message.\n\nWhen you write, please be sure to include this book’s title and author as well as your name and phone or email address. I will carefully review your comments and share them with the author and editors who worked on the book.\n\nEmail: Mail: Mark Taber\n\nfeedback@developers-library.info\n\nAssociate Publisher Pearson Education 800 East 96th Street Indianapolis, IN 46240 USA\n\nReader Services Visit our website and register this book at informit.com/register for convenient access to any updates, downloads, or errata that might be available for this book.\n\nF h Lib f L Bdff\n\nIntroduction\n\nThis book is intended to be a concise reference to the Python programming language.\n\nAlthough an experienced programmer will probably be able to learn Python from this book, it’s not intended to be an extended tutorial or a treatise on how to program. Rather, the goal is to present the core Python language, and the most essential parts of the Python library in a manner that’s accurate and concise.This book assumes that the reader has prior programming experience with Python or another language such as C or Java. In addition, a general familiarity with systems programming topics (for example, basic operating system concepts and network programming) may be useful in under- standing certain parts of the library reference.\n\nPython is freely available for download at http://www.python.org.Versions are avail-\n\nable for almost every operating system, including UNIX,Windows, and Macintosh. In addition, the Python website includes links to documentation, how-to guides, and a wide assortment of third-party software.\n\nThis edition of Python Essential Reference comes at a pivotal time in Python’s evolu- tion. Python 2.6 and Python 3.0 are being released almost simultaneously.Yet, Python 3 is a release that breaks backwards compatibility with prior Python versions.As an author and programmer, I’m faced with a dilemma: do I simply jump forward to Python 3.0 or do I build upon the Python 2.x releases that are more familiar to most programmers?\n\nYears ago, as a C programmer I used to treat certain books as the ultimate authority on what programming language features should be used. For example, if you were using something that wasn’t documented in the K&R book, it probably wasn’t going to be portable and should be approached with caution.This approach served me very well as a programmer and it’s the approach I have decided to take in this edition of the Essential Reference. Namely, I have chosen to omit features of Python 2 that have been removed from Python 3. Likewise, I don’t focus on features of Python 3 that have not been back-ported (although such features are still covered in an appendix).As a result, I hope this book can be a useful companion for Python programmers, regardless of what Python version is being used.\n\nThe fourth edition of Python Essential Reference also includes some of the most excit- ing changes since its initial publication nearly ten years ago. Much of Python’s develop- ment throughout the last few years has focused on new programming language fea- tures—especially related to functional and meta programming.As a result, the chapters on functions and object-oriented programming have been greatly expanded to cover topics such as generators, iterators, coroutines, decorators, and metaclasses.The library chapters have been updated to focus on more modern modules. Examples and code fragments have also been updated throughout the book. I think most programmers will be quite pleased with the expanded coverage.\n\nFinally, it should be noted that Python already includes thousands of pages of useful documentation.The contents of this book are largely based on that documentation, but with a number of key differences. First, this reference presents information in a much more compact form, with different examples and alternative descriptions of many top- ics. Second, a significant number of topics in the library reference have been expanded\n\nF h Lib f L Bdff\n\n2\n\nIntroduction\n\nto include outside reference material.This is especially true for low-level system and networking modules in which effective use of a module normally relies on a myriad of options listed in manuals and outside references. In addition, in order to produce a more concise reference, a number of deprecated and relatively obscure library modules have been omitted.\n\nIn writing this book, it has been my goal to produce a reference containing virtually\n\neverything I have needed to use Python and its large collection of modules.Although this is by no means a gentle introduction to the Python language, I hope that you find the contents of this book to be a useful addition to your programming reference library for many years to come. I welcome your comments.\n\nDavid Beazley Chicago, Illinois June, 2009\n\nF h Lib f L Bdff\n\nI\n\nThe Python Language\n\n1\n\nA Tutorial Introduction\n\n2\n\nLexical Conventions and Syntax\n\n3\n\nTypes and Objects\n\n4 Operators and Expressions\n\n5\n\nProgram Structure and Control Flow\n\n6\n\nFunctions and Functional Programming\n\n7 Classes and Object-Oriented Programming\n\n8 Modules, Packages, and Distribution\n\n9\n\nInput and Output\n\n10\n\nExecution Environment\n\n11\n\nTesting, Debugging, Profiling, and Tuning\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n1\n\nA Tutorial Introduction\n\nThis chapter provides a quick introduction to Python.The goal is to illustrate most of\n\nPython’s essential features without getting too bogged down in special rules or details. To do this, the chapter briefly covers basic concepts such as variables, expressions, con- trol flow, functions, generators, classes, and input/output.This chapter is not intended to provide comprehensive coverage. However, experienced programmers should be able to extrapolate from the material in this chapter to create more advanced programs. Beginners are encouraged to try a few examples to get a feel for the language. If you are new to Python and using Python 3, you might want to follow this chapter using Python 2.6 instead.Virtually all the major concepts apply to both versions, but there are a small number of critical syntax changes in Python 3—mostly related to printing and I/O—that might break many of the examples shown in this section. Please refer to Appendix A,“Python 3,” for further details.\n\nRunning Python Python programs are executed by an interpreter. Usually, the interpreter is started by simply typing python into a command shell. However, there are many different imple- mentations of the interpreter and Python development environments (for example, Jython, IronPython, IDLE,ActivePython,Wing IDE, pydev, etc.), so you should consult the documentation for startup details.When the interpreter starts, a prompt appears at which you can start typing programs into a simple read-evaluation loop. For example, in the following output, the interpreter displays its copyright message and presents the user with the >>> prompt, at which the user types the familiar “Hello World” command:\n\nPython 2.6rc2 (r26rc2:66504, Sep 19 2008, 08:50:24) [GCC 4.0.1 (Apple Inc. build 5465)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> print \"Hello World\" Hello World >>>\n\nF h Lib f L Bdff\n\n6\n\nChapter 1 A Tutorial Introduction\n\nNote\n\nIf you try the preceding example and it fails with a SyntaxError, you are probably using Python 3. If this is the case, you can continue to follow along with this chapter, but be aware that the print statement turned into a function in Python 3. Simply add parentheses around the items to be printed in the examples that follow. For instance:\n\n>>> print(\"Hello World\") Hello World >>>\n\nPutting parentheses around the item to be printed also works in Python 2 as long as you are printing just a single item. However, it’s not a syntax that you commonly see in existing Python code. In later chapters, this syntax is sometimes used in examples in which the primary focus is a feature not directly related to printing, but where the exam- ple is supposed to work with both Python 2 and 3.\n\nPython’s interactive mode is one of its most useful features. In the interactive shell, you can type any valid statement or sequence of statements and immediately view the results. Many people, including the author, even use interactive Python as their desktop calculator. For example:\n\n>>> 6000 + 4523.50 + 134.12 10657.620000000001 >>> _ + 8192.32 18849.940000000002 >>>\n\nWhen you use Python interactively, the special variable _ holds the result of the last operation.This can be useful if you want to save or use the result of the last operation in subsequent statements. However, it’s important to stress that this variable is only defined when working interactively.\n\nIf you want to create a program that you can run repeatedly, put statements in a file\n\nsuch as the following:\n\n# helloworld.py print \"Hello World\"\n\nPython source files are ordinary text files and normally have a .py suffix.The # charac- ter denotes a comment that extends to the end of the line.\n\nTo execute the helloworld.py file, you provide the filename to the interpreter as\n\nfollows:\n\n% python helloworld.py Hello World %\n\nOn Windows, Python programs can be started by double-clicking a .py file or typing the name of the program into the Run command on the Windows Start menu.This launches the interpreter and runs the program in a console window. However, be aware that the console window will disappear immediately after the program completes its execution (often before you can read its output). For debugging, it is better to run the program within a Python development tool such as IDLE.\n\nOn UNIX, you can use #! on the first line of the program, like this:\n\n#!/usr/bin/env python print \"Hello World\"\n\nF h Lib f L Bdff\n\nVariables and Arithmetic Expressions\n\n7\n\nThe interpreter runs statements until it reaches the end of the input file. If it’s running interactively, you can exit the interpreter by typing the EOF (end of file) character or by selecting Exit from pull-down menu of a Python IDE. On UNIX, EOF is Ctrl+D; on Windows, it’s Ctrl+Z.A program can request to exit by raising the SystemExit exception.\n\n>>> raise SystemExit\n\nVariables and Arithmetic Expressions The program in Listing 1.1 shows the use of variables and expressions by performing a simple compound-interest calculation.\n\nListing 1.1 principal = 1000 # Initial amount rate = 0.05 # Interest rate numyears = 5 # Number of years year = 1 while year <= numyears:\n\nSimple Compound-Interest Calculation\n\nprincipal = principal * (1 + rate) print year, principal # Reminder: print(year, principal) in Python 3 year += 1\n\nThe output of this program is the following table:\n\n1 1050.0 2 1102.5 3 1157.625 4 1215.50625 5 1276.2815625\n\nPython is a dynamically typed language where variable names are bound to different values, possibly of varying types, during program execution.The assignment operator simply creates an association between a name and a value.Although each value has an associated type such as an integer or string, variable names are untyped and can be made to refer to any type of data during execution.This is different from C, for exam- ple, in which a name represents a fixed type, size, and location in memory into which a value is stored.The dynamic behavior of Python can be seen in Listing 1.1 with the principal variable. Initially, it’s assigned to an integer value. However, later in the pro- gram it’s reassigned as follows:\n\nprincipal = principal * (1 + rate)\n\nThis statement evaluates the expression and reassociates the name principal with the result. Although the original value of principal was an integer 1000, the new value is now a floating-point number (rate is defined as a float, so the value of the above expression is also a float).Thus, the apparent “type” of principal dynamically changes from an integer to a float in the middle of the program. However, to be precise, it’s not the type of principal that has changed, but rather the value to which the principal name refers.\n\nA newline terminates each statement. However, you can use a semicolon to separate\n\nstatements on the same line, as shown here:\n\nprincipal = 1000; rate = 0.05; numyears = 5;\n\nF h Lib f L Bdff\n\n8\n\nChapter 1 A Tutorial Introduction\n\nThe while statement tests the conditional expression that immediately follows. If the tested statement is true, the body of the while statement executes.The condition is then retested and the body executed again until the condition becomes false. Because the body of the loop is denoted by indentation, the three statements following while in Listing 1.1 execute on each iteration. Python doesn’t specify the amount of required indentation, as long as it’s consistent within a block. However, it is most common (and generally recommended) to use four spaces per indentation level.\n\nOne problem with the program in Listing 1.1 is that the output isn’t very pretty.To make it better, you could right-align the columns and limit the precision of principal to two digits.There are several ways to achieve this formatting.The most widely used approach is to use the string formatting operator (%) like this:\n\nprint \"%3d %0.2f\" % (year, principal) print(\"%3d %0.2f\" % (year, principal)) # Python 3\n\nNow the output of the program looks like this:\n\n1 1050.00 2 1102.50 3 1157.63 4 1215.51 5 1276.28\n\nFormat strings contain ordinary text and special formatting-character sequences such as \"%d\", \"%s\", and \"%f\".These sequences specify the formatting of a particular type of data such as an integer, string, or floating-point number, respectively.The special- character sequences can also contain modifiers that specify a width and precision. For example, \"%3d\" formats an integer right-aligned in a column of width 3, and \"%0.2f\" formats a floating-point number so that only two digits appear after the decimal point. The behavior of format strings is almost identical to the C printf() function and is described in detail in Chapter 4,“Operators and Expressions.”\n\nA more modern approach to string formatting is to format each part individually\n\nusing the format() function. For example:\n\nprint format(year,\"3d\"),format(principal,\"0.2f\") print(format(year,\"3d\"),format(principal,\"0.2f\")) # Python 3\n\nformat() uses format specifiers that are similar to those used with the traditional string formatting operator (%). For example, \"3d\" formats an integer right-aligned in a col- umn of width 3, and \"0.2f\" formats a float-point number to have two digits of accura- cy. Strings also have a format() method that can be used to format many values at once. For example:\n\nprint \"{0:3d} {1:0.2f}\".format(year,principal) print(\"{0:3d} {1:0.2f}\".format(year,principal)) # Python 3\n\nIn this example, the number before the colon in \"{0:3d}\" and \"{1:0.2f}\" refers to the associated argument passed to the format() method and the part after the colon is the format specifier.\n\nF h Lib f L Bdff\n\nConditionals\n\n9\n\nConditionals The if and else statements can perform simple tests. Here’s an example:\n\nif a < b:\n\nprint \"Computer says Yes\"\n\nelse:\n\nprint \"Computer says No\"\n\nThe bodies of the if and else clauses are denoted by indentation.The else clause is optional.\n\nTo create an empty clause, use the pass statement, as follows:\n\nif a < b:\n\npass # Do nothing\n\nelse:\n\nprint \"Computer says No\"\n\nYou can form Boolean expressions by using the or, and, and not keywords:\n\nif product == \"game\" and type == \"pirate memory\" \\ and not (age < 4 or age > 8):\n\nprint \"I'll take it!\"\n\nNote\n\nWriting complex test cases commonly results in statements that involve an annoyingly long line of code. To improve readability, you can continue any statement to the next line by using a backslash (\\) at the end of a line as shown. If you do this, the normal inden- tation rules don’t apply to the next line, so you are free to format the continued lines as you wish.\n\nPython does not have a special switch or case statement for testing values.To handle multiple-test cases, use the elif statement, like this:\n\nif suffix == \".htm\":\n\ncontent = \"text/html\"\n\nelif suffix == \".jpg\":\n\ncontent = \"image/jpeg\"\n\nelif suffix == \".png\":\n\ncontent = \"image/png\"\n\nelse:\n\nraise RuntimeError(\"Unknown content type\")\n\nTo denote truth values, use the Boolean values True and False. Here’s an example:\n\nif 'spam' in s:\n\nhas_spam = True\n\nelse:\n\nhas_spam = False\n\nAll relational operators such as < and > return True or False as results.The in opera- tor used in this example is commonly used to check whether a value is contained inside of another object such as a string, list, or dictionary. It also returns True or False, so the preceding example could be shortened to this:\n\nhas_spam = 'spam' in s\n\nF h Lib f L Bdff\n\n10\n\nChapter 1 A Tutorial Introduction\n\nFile Input and Output The following program opens a file and reads its contents line by line:\n\nf = open(\"foo.txt\") # Returns a file object line = f.readline() # Invokes readline() method on file while line:\n\nprint line, # trailing ',' omits newline character # print(line,end='') # Use in Python 3 line = f.readline()\n\nf.close()\n\nThe open() function returns a new file object. By invoking methods on this object, you can perform various file operations.The readline() method reads a single line of input, including the terminating newline.The empty string is returned at the end of the file.\n\nIn the example, the program is simply looping over all the lines in the file foo.txt.\n\nWhenever a program loops over a collection of data like this (for instance input lines, numbers, strings, etc.), it is commonly known as iteration. Because iteration is such a com- mon operation, Python provides a dedicated statement, for, that is used to iterate over items. For instance, the same program can be written much more succinctly as follows:\n\nfor line in open(\"foo.txt\"):\n\nprint line,\n\nTo make the output of a program go to a file, you can supply a file to the print state- ment using >>, as shown in the following example:\n\nf = open(\"out\",\"w\") # Open file for writing while year <= numyears:\n\nprincipal = principal * (1 + rate) print >>f,\"%3d %0.2f\" % (year,principal) year += 1\n\nf.close()\n\nThe >> syntax only works in Python 2. If you are using Python 3, change the print statement to the following:\n\nprint(\"%3d %0.2f\" % (year,principal),file=f)\n\nIn addition, file objects support a write() method that can be used to write raw data. For example, the print statement in the previous example could have been written this way:\n\nf.write(\"%3d %0.2f\\n\" % (year,principal))\n\nAlthough these examples have worked with files, the same techniques apply to the stan- dard output and input streams of the interpreter. For example, if you wanted to read user input interactively, you can read from the file sys.stdin. If you want to write data to the screen, you can write to sys.stdout, which is the same file used to output data produced by the print statement. For example:\n\nimport sys sys.stdout.write(\"Enter your name :\") name = sys.stdin.readline()\n\nIn Python 2, this code can also be shortened to the following:\n\nname = raw_input(\"Enter your name :\")\n\nF h Lib f L Bdff\n\nStrings\n\n11\n\nIn Python 3, the raw_input() function is called input(), but it works in exactly the same manner.\n\nStrings To create string literals, enclose them in single, double, or triple quotes as follows:\n\na = \"Hello World\" b = 'Python is groovy' c = \"\"\"Computer says 'No'\"\"\"\n\nThe same type of quote used to start a string must be used to terminate it.Triple- quoted strings capture all the text that appears prior to the terminating triple quote, as opposed to single- and double-quoted strings, which must be specified on one logical line.Triple-quoted strings are useful when the contents of a string literal span multiple lines of text such as the following:\n\nprint '''Content-type: text/html\n\n<h1> Hello World </h1> Click <a href=\"http://www.python.org\">here</a>. '''\n\nStrings are stored as sequences of characters indexed by integers, starting at zero.To extract a single character, use the indexing operator s[i] like this:\n\na = \"Hello World\" b = a[4] # b = 'o'\n\nTo extract a substring, use the slicing operator s[i:j].This extracts all characters from swhose index kis in the range i<= k< j. If either index is omitted, the beginning or end of the string is assumed, respectively:\n\nc = a[:5] # c = \"Hello\" d = a[6:] # d = \"World\" e = a[3:8] # e = \"lo Wo\"\n\nStrings are concatenated with the plus (+) operator:\n\ng = a + \" This is a test\"\n\nPython never implicitly interprets the contents of a string as numerical data (i.e., as in other languages such as Perl or PHP). For example, + always concatenates strings:\n\nx = \"37\" y = \"42\" z = x + y # z = \"3742\" (String Concatenation)\n\nTo perform mathematical calculations, strings first have to be converted into a numeric value using a function such as int() or float(). For example:\n\nz = int(x) + int(y) # z = 79 (Integer +)\n\nNon-string values can be converted into a string representation by using the str(), repr(), or format() function. Here’s an example:\n\ns = \"The value of x is \" + str(x) s = \"The value of x is \" + repr(x) s = \"The value of x is \" + format(x,\"4d\")\n\nF h Lib f L Bdff\n\n12\n\nChapter 1 A Tutorial Introduction\n\nAlthough str() and repr() both create strings, their output is usually slightly differ- ent. str() produces the output that you get when you use the print statement, whereas repr() creates a string that you type into a program to exactly represent the value of an object. For example:\n\n>>> x = 3.4 >>> str(x) '3.4' >>> repr(x) '3.3999999999999999' >>>\n\nThe inexact representation of 3.4 in the previous example is not a bug in Python. It is an artifact of double-precision floating-point numbers, which by their design can not exactly represent base-10 decimals on the underlying computer hardware.\n\nThe format() function is used to convert a value to a string with a specific format-\n\nting applied. For example:\n\n>>> format(x,\"0.5f\") '3.40000' >>>\n\nLists Lists are sequences of arbitrary objects.You create a list by enclosing values in square brackets, as follows:\n\nnames = [ \"Dave\", \"Mark\", \"Ann\", \"Phil\" ]\n\nLists are indexed by integers, starting with zero. Use the indexing operator to access and modify individual items of the list:\n\na = names[2] # Returns the third item of the list, \"Ann\" names[0] = \"Jeff\" # Changes the first item to \"Jeff\"\n\nTo append new items to the end of a list, use the append() method:\n\nnames.append(\"Paula\")\n\nTo insert an item into the middle of a list, use the insert() method:\n\nnames.insert(2, \"Thomas\")\n\nYou can extract or reassign a portion of a list by using the slicing operator:\n\nb = names[0:2] # Returns [ \"Jeff\", \"Mark\" ] c = names[2:] # Returns [ \"Thomas\", \"Ann\", \"Phil\", \"Paula\" ] names[1] = 'Jeff' # Replace the 2nd item in names with 'Jeff' names[0:2] = ['Dave','Mark','Jeff'] # Replace the first two items of\n\n# the list with the list on the right.\n\nUse the plus (+) operator to concatenate lists:\n\na = [1,2,3] + [4,5] # Result is [1,2,3,4,5]\n\nAn empty list is created in one of two ways:\n\nnames = [] # An empty list names = list() # An empty list\n\nF h Lib f L Bdff\n\nLists\n\n13\n\nLists can contain any kind of Python object, including other lists, as in the following example:\n\na = [1,\"Dave\",3.14, [\"Mark\", 7, 9, [100,101]], 10]\n\nItems contained in nested lists are accessed by applying more than one indexing opera- tion, as follows:\n\na[1] # Returns \"Dave\" a[3][2] # Returns 9 a[3][3][1] # Returns 101\n\nThe program in Listing 1.2 illustrates a few more advanced features of lists by reading a list of numbers from a file specified on the command line and outputting the minimum and maximum values.\n\nListing 1.2 import sys # Load the sys module if len(sys.argv) != 2 # Check number of command line arguments :\n\nAdvanced List Features\n\nprint \"Please supply a filename\" raise SystemExit(1)\n\nf = open(sys.argv[1]) # Filename on the command line lines = f.readlines() # Read all lines into a list f.close()\n\n# Convert all of the input values from strings to floats fvalues = [float(line) for line in lines]\n\n# Print min and max values print \"The minimum value is \", min(fvalues) print \"The maximum value is \", max(fvalues)\n\nThe first line of this program uses the import statement to load the sys module from the Python library.This module is being loaded in order to obtain command-line argu- ments.\n\nThe open() function uses a filename that has been supplied as a command-line option and placed in the list sys.argv.The readlines() method reads all the input lines into a list of strings.\n\nThe expression [float(line) for line in lines] constructs a new list by looping over all the strings in the list lines and applying the function float() to each element.This particularly powerful method of constructing a list is known as a list com- prehension. Because the lines in a file can also be read using a for loop, the program can be shortened by converting values using a single statement like this:\n\nfvalues = [float(line) for line in open(sys.argv[1])]\n\nAfter the input lines have been converted into a list of floating-point numbers, the built-in min() and max() functions compute the minimum and maximum values.\n\nF h Lib f L Bdff\n\n14\n\nChapter 1 A Tutorial Introduction\n\nTuples To create simple data structures, you can pack a collection of values together into a sin- gle object using a tuple.You create a tuple by enclosing a group of values in parentheses like this:\n\nstock = ('GOOG', 100, 490.10) address = ('www.python.org', 80) person = (first_name, last_name, phone)\n\nPython often recognizes that a tuple is intended even if the parentheses are missing:\n\nstock = 'GOOG', 100, 490.10 address = 'www.python.org',80 person = first_name, last_name, phone\n\nFor completeness, 0- and 1-element tuples can be defined, but have special syntax:\n\na = () # 0-tuple (empty tuple) b = (item,) # 1-tuple (note the trailing comma) c = item, # 1-tuple (note the trailing comma)\n\nThe values in a tuple can be extracted by numerical index just like a list. However, it is more common to unpack tuples into a set of variables like this:\n\nname, shares, price = stock host, port = address first_name, last_name, phone = person\n\nAlthough tuples support most of the same operations as lists (such as indexing, slicing, and concatenation), the contents of a tuple cannot be modified after creation (that is, you cannot replace, delete, or append new elements to an existing tuple).This reflects the fact that a tuple is best viewed as a single object consisting of several parts, not as a collection of distinct objects to which you might insert or remove items.\n\nBecause there is so much overlap between tuples and lists, some programmers are inclined to ignore tuples altogether and simply use lists because they seem to be more flexible.Although this works, it wastes memory if your program is going to create a large number of small lists (that is, each containing fewer than a dozen items).This is because lists slightly overallocate memory to optimize the performance of operations that add new items. Because tuples are immutable, they use a more compact representa- tion where there is no extra space.\n\nTuples and lists are often used together to represent data. For example, this program\n\nshows how you might read a file consisting of different columns of data separated by commas:\n\n# File containing lines of the form \"name,shares,price\" filename = \"portfolio.csv\" portfolio = [] for line in open(filename):\n\nfields = line.split(\",\") # Split each line into a list name = fields[0] # Extract and convert individual fields shares = int(fields[1]) price = float(fields[2]) stock = (name,shares,price) # Create a tuple (name, shares, price) portfolio.append(stock) # Append to list of records\n\nThe split() method of strings splits a string into a list of fields separated by the given delimiter character.The resulting portfolio data structure created by this program\n\nF h Lib f L Bdff\n\nSets\n\n15\n\nlooks like a two-dimension array of rows and columns. Each row is represented by a tuple and can be accessed as follows:\n\n>>> portfolio[0] ('GOOG', 100, 490.10) >>> portfolio[1] ('MSFT', 50, 54.23) >>>\n\nIndividual items of data can be accessed like this:\n\n>>> portfolio[1][1] 50 >>> portfolio[1][2] 54.23 >>>\n\nHere’s an easy way to loop over all of the records and expand fields into a set of variables:\n\ntotal = 0.0 for name, shares, price in portfolio:\n\ntotal += shares * price\n\nSets A set is used to contain an unordered collection of objects.To create a set, use the set() function and supply a sequence of items such as follows:\n\ns = set([3,5,9,10]) # Create a set of numbers t = set(\"Hello\") # Create a set of unique characters\n\nUnlike lists and tuples, sets are unordered and cannot be indexed by numbers. Moreover, the elements of a set are never duplicated. For example, if you inspect the value of t from the preceding code, you get the following:\n\n>>> t set(['H', 'e', 'l', 'o'])\n\nNotice that only one 'l' appears.\n\nSets support a standard collection of operations, including union, intersection, differ-\n\nence, and symmetric difference. Here’s an example:\n\na = t | s # Union of t and s b = t & s # Intersection of t and s c = t – s # Set difference (items in t, but not in s) d = t ^ s # Symmetric difference (items in t or s, but not both)\n\nNew items can be added to a set using add() or update():\n\nt.add('x') # Add a single item s.update([10,37,42]) # Adds multiple items to s\n\nAn item can be removed using remove():\n\nt.remove('H')\n\nF h Lib f L Bdff\n\n16\n\nChapter 1 A Tutorial Introduction\n\nDictionaries A dictionary is an associative array or hash table that contains objects indexed by keys. You create a dictionary by enclosing the values in curly braces ({ }), like this:\n\nstock = {\n\n\"name\" : \"GOOG\", \"shares\" : 100, \"price\" : 490.10\n\n}\n\nTo access members of a dictionary, use the key-indexing operator as follows:\n\nname = stock[\"name\"] value = stock[\"shares\"] * shares[\"price\"]\n\nInserting or modifying objects works like this:\n\nstock[\"shares\"] = 75 stock[\"date\"] = \"June 7, 2007\"\n\nAlthough strings are the most common type of key, you can use many other Python objects, including numbers and tuples. Some objects, including lists and dictionaries, cannot be used as keys because their contents can change.\n\nA dictionary is a useful way to define an object that consists of named fields as shown previously. However, dictionaries are also used as a container for performing fast lookups on unordered data. For example, here’s a dictionary of stock prices:\n\nprices = {\n\n\"GOOG\" : 490.10, \"AAPL\" : 123.50, \"IBM\" : 91.50, \"MSFT\" : 52.13\n\n}\n\nAn empty dictionary is created in one of two ways:\n\nprices = {} # An empty dict prices = dict() # An empty dict\n\nDictionary membership is tested with the in operator, as in the following example:\n\nif \"SCOX\" in prices:\n\np = prices[\"SCOX\"]\n\nelse:\n\np = 0.0\n\nThis particular sequence of steps can also be performed more compactly as follows:\n\np = prices.get(\"SCOX\",0.0)\n\nTo obtain a list of dictionary keys, convert a dictionary to a list:\n\nsyms = list(prices) # syms = [\"AAPL\", \"MSFT\", \"IBM\", \"GOOG\"]\n\nUse the del statement to remove an element of a dictionary:\n\ndel prices[\"MSFT\"]\n\nDictionaries are probably the most finely tuned data type in the Python interpreter. So, if you are merely trying to store and work with data in your program, you are almost always better off using a dictionary than trying to come up with some kind of custom data structure on your own.\n\nF h Lib f L Bdff\n\nIteration and Looping\n\n17\n\nIteration and Looping The most widely used looping construct is the for statement, which is used to iterate over a collection of items. Iteration is one of Python’s richest features. However, the most common form of iteration is to simply loop over all the members of a sequence such as a string, list, or tuple. Here’s an example:\n\nfor n in [1,2,3,4,5,6,7,8,9]:\n\nprint \"2 to the %d power is %d\" % (n, 2**n)\n\nIn this example, the variable n will be assigned successive items from the list [1,2,3,4,…,9] on each iteration. Because looping over ranges of integers is quite common, the following shortcut is often used for that purpose:\n\nfor n in range(1,10):\n\nprint \"2 to the %d power is %d\" % (n, 2**n)\n\nThe range(i,j [,stride]) function creates an object that represents a range of inte- gers with values ito j-1. If the starting value is omitted, it’s taken to be zero.An optional stride can also be given as a third argument. Here’s an example:\n\na = range(5) # a = 0,1,2,3,4 b = range(1,8) # b = 1,2,3,4,5,6,7 c = range(0,14,3) # c = 0,3,6,9,12 d = range(8,1,-1) # d = 8,7,6,5,4,3,2\n\nOne caution with range() is that in Python 2, the value it creates is a fully populated list with all of the integer values. For extremely large ranges, this can inadvertently con- sume all available memory.Therefore, in older Python code, you will see programmers using an alternative function xrange(). For example:\n\nfor i in xrange(100000000): # i = 0,1,2,...,99999999\n\nstatements\n\nThe object created by xrange() computes the values it represents on demand when lookups are requested. For this reason, it is the preferred way to represent extremely large ranges of integer values. In Python 3, the xrange() function has been renamed to range() and the functionality of the old range() function has been removed.\n\nThe for statement is not limited to sequences of integers and can be used to iterate\n\nover many kinds of objects including strings, lists, dictionaries, and files. Here’s an example:\n\na = \"Hello World\" # Print out the individual characters in a for c in a: print c\n\nb = [\"Dave\",\"Mark\",\"Ann\",\"Phil\"] # Print out the members of a list for name in b: print name\n\nc = { 'GOOG' : 490.10, 'IBM' : 91.50, 'AAPL' : 123.15 } # Print out all of the members of a dictionary for key in c:\n\nprint key, c[key]\n\n# Print all of the lines in a file f = open(\"foo.txt\")\n\nF h Lib f L Bdff\n\n18\n\nChapter 1 A Tutorial Introduction\n\nfor line in f:\n\nprint line,\n\nThe for loop is one of Python’s most powerful language features because you can cre- ate custom iterator objects and generator functions that supply it with sequences of val- ues. More details about iterators and generators can be found later in this chapter and in Chapter 6,“Functions and Functional Programming.”\n\nFunctions You use the def statement to create a function, as shown in the following example:\n\ndef remainder(a,b):\n\nq = a // b # // is truncating division. r = a - q*b return r\n\nTo invoke a function, simply use the name of the function followed by its arguments enclosed in parentheses, such as result = remainder(37,15).You can use a tuple to return multiple values from a function, as shown here:\n\ndef divide(a,b):\n\nq = a // b # If a and b are integers, q is integer r = a - q*b return (q,r)\n\nWhen returning multiple values in a tuple, you can easily unpack the result into sepa- rate variables like this:\n\nquotient, remainder = divide(1456,33)\n\nTo assign a default value to a function parameter, use assignment:\n\ndef connect(hostname,port,timeout=300):\n\n# Function body\n\nWhen default values are given in a function definition, they can be omitted from subse- quent function calls.When omitted, the argument will simply take on the default value. Here’s an example:\n\nconnect('www.python.org', 80)\n\nYou also can invoke functions by using keyword arguments and supplying the argu- ments in arbitrary order. However, this requires you to know the names of the argu- ments in the function definition. Here’s an example:\n\nconnect(port=80,hostname=\"www.python.org\")\n\nWhen variables are created or assigned inside a function, their scope is local.That is, the variable is only defined inside the body of the function and is destroyed when the func- tion returns.To modify the value of a global variable from inside a function, use the global statement as follows:\n\ncount = 0 ... def foo():\n\nglobal count count += 1 # Changes the global variable count\n\nF h Lib f L Bdff\n\nGenerators\n\n19\n\nGenerators Instead of returning a single value, a function can generate an entire sequence of results if it uses the yield statement. For example:\n\ndef countdown(n):\n\nprint \"Counting down!\" while n > 0:\n\nyield n # Generate a value (n) n -= 1\n\nAny function that uses yield is known as a generator. Calling a generator function cre- ates an object that produces a sequence of results through successive calls to a next() method (or __next__() in Python 3). For example:\n\n>>> c = countdown(5) >>> c.next() Counting down! 5 >>> c.next() 4 >>> c.next() 3 >>>\n\nThe next() call makes a generator function run until it reaches the next yield state- ment.At this point, the value passed to yield is returned by next(), and the function suspends execution.The function resumes execution on the statement following yield when next() is called again.This process continues until the function returns.\n\nNormally you would not manually call next() as shown. Instead, you hook it up to\n\na for loop like this:\n\n>>> for i in countdown(5): ... Counting down! 5 4 3 2 1 >>>\n\nprint i,\n\nGenerators are an extremely powerful way of writing programs based on processing pipelines, streams, or data flow. For example, the following generator function mimics the behavior of the UNIX tail -f command that’s commonly used to monitor log files:\n\n# tail a file (like tail -f) import time def tail(f):\n\nf.seek(0,2) # Move to EOF while True:\n\nline = f.readline() # Try reading a new line of text if not line: # If nothing, sleep briefly and try again\n\ntime.sleep(0.1) continue\n\nyield line\n\nHere’s a generator that looks for a specific substring in a sequence of lines:\n\ndef grep(lines, searchtext):\n\nfor line in lines:\n\nif searchtext in line: yield line\n\nF h Lib f L Bdff",
      "page_number": 24
    },
    {
      "number": 3,
      "title": "Segment 3 (pages 44-63)",
      "start_page": 44,
      "end_page": 63,
      "detection_method": "synthetic",
      "content": "20\n\nChapter 1 A Tutorial Introduction\n\nHere’s an example of hooking both of these generators together to create a simple pro- cessing pipeline:\n\n# A python implementation of Unix \"tail -f | grep python\" wwwlog = tail(open(\"access-log\")) pylines = grep(wwwlog,\"python\") for line in pylines: print line,\n\nA subtle aspect of generators is that they are often mixed together with other iterable objects such as lists or files. Specifically, when you write a statement such as for item in s, scould represent a list of items, the lines of a file, the result of a generator func- tion, or any number of other objects that support iteration.The fact that you can just plug different objects in for scan be a powerful tool for creating extensible programs.\n\nCoroutines Normally, functions operate on a single set of input arguments. However, a function can also be written to operate as a task that processes a sequence of inputs sent to it.This type of function is known as a coroutine and is created by using the yield statement as an expression (yield) as shown in this example:\n\ndef print_matches(matchtext):\n\nprint \"Looking for\", matchtext while True:\n\nline = (yield) # Get a line of text if matchtext in line:\n\nprint line\n\nTo use this function, you first call it, advance it to the first (yield), and then start sending data to it using send(). For example:\n\n>>> matcher = print_matches(\"python\") >>> matcher.next() Looking for python >>> matcher.send(\"Hello World\") >>> matcher.send(\"python is cool\") python is cool >>> matcher.send(\"yow!\") >>> matcher.close() >>>\n\n# Advance to the first (yield)\n\n# Done with the matcher function call\n\nA coroutine is suspended until a value is sent to it using send().When this happens, that value is returned by the (yield) expression inside the coroutine and is processed by the statements that follow. Processing continues until the next (yield) expression is encountered—at which point the function suspends.This continues until the coroutine function returns or close() is called on it as shown in the previous example.\n\nCoroutines are useful when writing concurrent programs based on producer-\n\nconsumer problems where one part of a program is producing data to be consumed by another part of the program. In this model, a coroutine represents a consumer of data. Here is an example of using generators and coroutines together:\n\n# A set of matcher coroutines matchers = [\n\nprint_matches(\"python\"), print_matches(\"guido\"), print_matches(\"jython\")\n\n]\n\nF h Lib f L Bdff\n\nObjects and Classes\n\n21\n\n# Prep all of the matchers by calling next() for m in matchers: m.next()\n\n# Feed an active log file into all matchers. Note for this to work,\n\n# a web server must be actively writing data to the log.\n\nwwwlog = tail(open(\"access-log\")) for line in wwwlog:\n\nfor m in matchers:\n\nm.send(line) # Send data into each matcher coroutine\n\nFurther details about coroutines can be found in Chapter 6.\n\nObjects and Classes All values used in a program are objects.An object consists of internal data and methods that perform various kinds of operations involving that data.You have already used objects and methods when working with the built-in types such as strings and lists. For example:\n\nitems = [37, 42] # Create a list object items.append(73) # Call the append() method\n\nThe dir() function lists the methods available on an object and is a useful tool for interactive experimentation. For example:\n\n>>> items = [37, 42] >>> dir(items) ['__add__', '__class__', '__contains__', '__delattr__', '__delitem__', ...\n\n'append', 'count', 'extend', 'index', 'insert', 'pop', 'remove', 'reverse', 'sort']\n\n>>>\n\nWhen inspecting objects, you will see familiar methods such as append() and insert() listed. However, you will also see special methods that always begin and end with a double underscore.These methods implement various language operations. For example, the __add__() method implements the + operator:\n\n>>> items.__add__([73,101]) [37, 42, 73, 101] >>>\n\nThe class statement is used to define new types of objects and for object-oriented programming. For example, the following class defines a simple stack with push(), pop(), and length() operations:\n\nclass Stack(object):\n\ndef __init__(self): # Initialize the stack\n\nself.stack = [ ]\n\ndef push(self,object):\n\nself.stack.append(object)\n\ndef pop(self):\n\nreturn self.stack.pop()\n\ndef length(self):\n\nreturn len(self.stack)\n\nIn the first line of the class definition, the statement class Stack(object) declares Stack to be an object.The use of parentheses is how Python specifies inheritance—in this case, Stack inherits from object, which is the root of all Python types. Inside the class definition, methods are defined using the def statement.The first argument in each\n\nF h Lib f L Bdff\n\n22\n\nChapter 1 A Tutorial Introduction\n\nmethod always refers to the object itself. By convention, self is the name used for this argument.All operations involving the attributes of an object must explicitly refer to the self variable. Methods with leading and trailing double underscores are special meth- ods. For example, __init__ is used to initialize an object after it’s created.\n\nTo use a class, write code such as the following:\n\ns = Stack() # Create a stack s.push(\"Dave\") # Push some things onto it s.push(42) s.push([3,4,5]) x = s.pop() # x gets [3,4,5] y = s.pop() # y gets 42 del s # Destroy s\n\nIn this example, an entirely new object was created to implement the stack. However, a stack is almost identical to the built-in list object.Therefore, an alternative approach would be to inherit from list and add an extra method:\n\nclass Stack(list):\n\n# Add push() method for stack interface # Note: lists already provide a pop() method. def push(self,object):\n\nself.append(object)\n\nNormally, all of the methods defined within a class apply only to instances of that class (that is, the objects that are created). However, different kinds of methods can be defined such as static methods familiar to C++ and Java programmers. For example:\n\nclass EventHandler(object):\n\n@staticmethod def dispatcherThread():\n\nwhile (1):\n\n# Wait for requests ...\n\nEventHandler.dispatcherThread() # Call method like a function\n\nIn this case, @staticmethod declares the method that follows to be a static method. @staticmethod is an example of using an a decorator, a topic that is discussed further in Chapter 6.\n\nExceptions If an error occurs in your program, an exception is raised and a traceback message such as the following appears:\n\nTraceback (most recent call last):\n\nFile \"foo.py\", line 12, in <module>\n\nIOError: [Errno 2] No such file or directory: 'file.txt'\n\nThe traceback message indicates the type of error that occurred, along with its location. Normally, errors cause a program to terminate. However, you can catch and handle exceptions using try and except statements, like this:\n\ntry:\n\nf = open(\"file.txt\",\"r\")\n\nexcept IOError as e:\n\nprint e\n\nF h Lib f L Bdff\n\nModules\n\n23\n\nIf an IOError occurs, details concerning the cause of the error are placed in e and con- trol passes to the code in the except block. If some other kind of exception is raised, it’s passed to the enclosing code block (if any). If no errors occur, the code in the except block is ignored.When an exception is handled, program execution resumes with the statement that immediately follows the last except block.The program does not return to the location where the exception occurred.\n\nThe raise statement is used to signal an exception.When raising an exception, you\n\ncan use one of the built-in exceptions, like this:\n\nraise RuntimeError(\"Computer says no\")\n\nOr you can create your own exceptions, as described in the section “Defining New Exceptions” in Chapter 5,“ Program Structure and Control Flow.”\n\nProper management of system resources such as locks, files, and network connections\n\nis often a tricky problem when combined with exception handling.To simplify such programming, you can use the with statement with certain kinds of objects. Here is an example of writing code that uses a mutex lock:\n\nimport threading message_lock = threading.Lock() ... with message_lock:\n\nmessages.add(newmessage)\n\nIn this example, the message_lock object is automatically acquired when the with statement executes.When execution leaves the context of the with block, the lock is automatically released.This management takes place regardless of what happens inside the with block. For example, if an exception occurs, the lock is released when control leaves the context of the block.\n\nThe with statement is normally only compatible with objects related to system resources or the execution environment such as files, connections, and locks. However, user-defined objects can define their own custom processing.This is covered in more detail in the “Context Management Protocol” section of Chapter 3,“Types and Objects.”\n\nModules As your programs grow in size, you will want to break them into multiple files for easi- er maintenance.To do this, Python allows you to put definitions in a file and use them as a module that can be imported into other programs and scripts.To create a module, put the relevant statements and definitions into a file that has the same name as the module. (Note that the file must have a .py suffix.) Here’s an example:\n\n# file : div.py def divide(a,b):\n\nq = a/b # If a and b are integers, q is an integer r = a - q*b return (q,r)\n\nTo use your module in other programs, you can use the import statement:\n\nimport div a, b = div.divide(2305, 29)\n\nF h Lib f L Bdff\n\n24\n\nChapter 1 A Tutorial Introduction\n\nThe import statement creates a new namespace and executes all the statements in the associated .py file within that namespace.To access the contents of the namespace after import, simply use the name of the module as a prefix, as in div.divide() in the pre- ceding example.\n\nIf you want to import a module using a different name, supply the import statement\n\nwith an optional as qualifier, as follows:\n\nimport div as foo a,b = foo.divide(2305,29)\n\nTo import specific definitions into the current namespace, use the from statement:\n\nfrom div import divide a,b = divide(2305,29) # No longer need the div prefix\n\nTo load all of a module’s contents into the current namespace, you can also use the following:\n\nfrom div import *\n\nAs with objects, the dir() function lists the contents of a module and is a useful tool for interactive experimentation:\n\n>>> import string >>> dir(string) ['__builtins__', '__doc__', '__file__', '__name__', '_idmap',\n\n'_idmapL', '_lower', '_swapcase', '_upper', 'atof', 'atof_error', 'atoi', 'atoi_error', 'atol', 'atol_error', 'capitalize', 'capwords', 'center', 'count', 'digits', 'expandtabs', 'find',\n\n... >>>\n\nGetting Help When working with Python, you have several sources of quickly available information. First, when Python is running in interactive mode, you can use the help() command to get information about built-in modules and other aspects of Python. Simply type help() by itself for general information or help('modulename') for information about a specific module.The help() command can also be used to return information about specific functions if you supply a function name.\n\nMost Python functions have documentation strings that describe their usage.To\n\nprint the doc string, simply print the __doc__ attribute. Here’s an example:\n\n>>> print issubclass.__doc__ issubclass(C, B) -> bool\n\nReturn whether class C is a subclass (i.e., a derived class) of class B. When using a tuple as the second argument issubclass(X, (A, B, ...)), is a shortcut for issubclass(X, A) or issubclass(X, B) or ... (etc.). >>>\n\nLast, but not least, most Python installations also include the command pydoc, which can be used to return documentation about Python modules. Simply type pydoc topicat a system command prompt.\n\nF h Lib f L Bdff\n\n2\n\nLexical Conventions and Syntax\n\nThis chapter describes the syntactic and lexical conventions of a Python program.\n\nTopics include line structure, grouping of statements, reserved words, literals, operators, tokens, and source code encoding.\n\nLine Structure and Indentation Each statement in a program is terminated with a newline. Long statements can span multiple lines by using the line-continuation character (\\), as shown in the following example:\n\na = math.cos(3 * (x - n)) + \\ math.sin(3 * (y - n))\n\nYou don’t need the line-continuation character when the definition of a triple-quoted string, list, tuple, or dictionary spans multiple lines. More generally, any part of a pro- gram enclosed in parentheses (...), brackets [...], braces {...}, or triple quotes can span multiple lines without use of the line-continuation character because they clearly denote the start and end of a definition.\n\nIndentation is used to denote different blocks of code, such as the bodies of func- tions, conditionals, loops, and classes.The amount of indentation used for the first state- ment of a block is arbitrary, but the indentation of the entire block must be consistent. Here’s an example:\n\nif a:\n\nstatement1 statement2\n\n# Consistent indentation\n\nelse:\n\nstatement3\n\nstatement4\n\n# Inconsistent indentation (error)\n\nIf the body of a function, conditional, loop, or class is short and contains only a single statement, it can be placed on the same line, like this:\n\nif a: statement1 else: statement2\n\nTo denote an empty body or block, use the pass statement. Here’s an example:\n\nif a:\n\npass\n\nelse:\n\nstatements\n\nF h Lib f L Bdff\n\n26\n\nChapter 2 Lexical Conventions and Syntax\n\nAlthough tabs can be used for indentation, this practice is discouraged.The use of spaces is universally preferred (and encouraged) by the Python programming community. When tab characters are encountered, they’re converted into the number of spaces required to move to the next column that’s a multiple of 8 (for example, a tab appear- ing in column 11 inserts enough spaces to move to column 16). Running Python with the -t option prints warning messages when tabs and spaces are mixed inconsistently within the same program block.The -tt option turns these warning messages into TabError exceptions.\n\nTo place more than one statement on a line, separate the statements with a semi- colon (;).A line containing a single statement can also be terminated by a semicolon, although this is unnecessary.\n\nThe # character denotes a comment that extends to the end of the line.A # appear-\n\ning inside a quoted string doesn’t start a comment, however.\n\nFinally, the interpreter ignores all blank lines except when running in interactive mode. In this case, a blank line signals the end of input when typing a statement that spans multiple lines.\n\nIdentifiers and Reserved Words An identifier is a name used to identify variables, functions, classes, modules, and other objects. Identifiers can include letters, numbers, and the underscore character (_) but must always start with a nonnumeric character. Letters are currently confined to the characters A–Z and a–z in the ISO–Latin character set. Because identifiers are case- sensitive, FOO is different from foo. Special symbols such as $, %, and @ are not allowed in identifiers. In addition, words such as if, else, and for are reserved and cannot be used as identifier names.The following list shows all the reserved words:\n\nand\n\ndel\n\nfrom\n\nnonlocal\n\ntry\n\nas\n\nelif\n\nglobal\n\nnot\n\nwhile\n\nassert\n\nelse\n\nif\n\nor\n\nwith\n\nbreak\n\nexcept\n\nimport\n\npass\n\nyield\n\nclass\n\nexec\n\nin\n\nprint\n\ncontinue\n\nfinally\n\nis\n\nraise\n\ndef\n\nfor\n\nlambda\n\nreturn\n\nIdentifiers starting or ending with underscores often have special meanings. For exam- ple, identifiers starting with a single underscore such as _foo are not imported by the from module import * statement. Identifiers with leading and trailing double under- scores such as __init__ are reserved for special methods, and identifiers with leading double underscores such as __bar are used to implement private class members, as described in Chapter 7,“Classes and Object-Oriented Programming.” General-purpose use of similar identifiers should be avoided.\n\nNumeric Literals There are four types of built-in numeric literals:\n\nn Booleans n Integers\n\nF h Lib f L Bdff\n\nString Literals\n\n27\n\nn Floating-point numbers n Complex numbers\n\nThe identifiers True and False are interpreted as Boolean values with the integer val- ues of 1 and 0, respectively.A number such as 1234 is interpreted as a decimal integer. To specify an integer using octal, hexadecimal, or binary notation, precede the value with 0, 0x, or 0b, respectively (for example, 0644, 0x100fea8, or 0b11101010).\n\nIntegers in Python can have an arbitrary number of digits, so if you want to specify a\n\nreally large integer, just write out all of the digits, as in 12345678901234567890. However, when inspecting values and looking at old Python code, you might see large numbers written with a trailing l (lowercase L) or L character, as in 12345678901234567890L.This trailing L is related to the fact that Python internally represents integers as either a fixed-precision machine integer or an arbitrary precision long integer type depending on the magnitude of the value. In older versions of Python, you could explicitly choose to use either type and would add the trailing L to explicitly indicate the long type.Today, this distinction is unnecessary and is actively dis- couraged. So, if you want a large integer value, just write it without the L.\n\nNumbers such as 123.34 and 1.2334e+02 are interpreted as floating-point num- bers.An integer or floating-point number with a trailing j or J, such as 12.34J, is an imaginary number.You can create complex numbers with real and imaginary parts by adding a real number and an imaginary number, as in 1.2 + 12.34J.\n\nString Literals String literals are used to specify a sequence of characters and are defined by enclosing text in single ('), double (\"), or triple (''' or \"\"\") quotes.There is no semantic differ- ence between quoting styles other than the requirement that you use the same type of quote to start and terminate a string. Single- and double-quoted strings must be defined on a single line, whereas triple-quoted strings can span multiple lines and include all of the enclosed formatting (that is, newlines, tabs, spaces, and so on).Adjacent strings (sepa- rated by white space, newline, or a line-continuation character) such as \"hello\" 'world' are concatenated to form a single string \"helloworld\".\n\nWithin string literals, the backslash (\\) character is used to escape special characters such as newlines, the backslash itself, quotes, and nonprinting characters.Table 2.1 shows the accepted escape codes. Unrecognized escape sequences are left in the string unmod- ified and include the leading backslash.\n\nTable 2.1\n\nStandard Character Escape Codes\n\nCharacter\n\nDescription\n\n\\\n\n\\\\\n\n\\'\n\n\\\"\n\n\\a\n\n\\b\n\n\\e\n\nNewline continuation Backslash Single quote Double quote Bell Backspace Escape Null\n\n\\0\n\nF h Lib f L Bdff\n\n28\n\nChapter 2 Lexical Conventions and Syntax\n\nTable 2.1\n\nContinued\n\nCharacter\n\nDescription\n\n\\n\n\n\\v\n\n\\t\n\n\\r\n\n\\f\n\n\\OOO\n\n\\uxxxx\n\n\\Uxxxxxxxx\n\n\\N{charname}\n\nLine feed Vertical tab Horizontal tab Carriage return Form feed Octal value (\\000 to \\377) Unicode character (\\u0000 to \\uffff) Unicode character (\\U00000000 to \\Uffffffff) Unicode character name Hexadecimal value (\\x00 to \\xff)\n\n\\xhh\n\nThe escape codes \\OOO and \\x are used to embed characters into a string literal that can’t be easily typed (that is, control codes, nonprinting characters, symbols, internation- al characters, and so on). For these escape codes, you have to specify an integer value corresponding to a character value. For example, if you wanted to write a string literal for the word “Jalapeño”, you might write it as \"Jalape\\xf1o\" where \\xf1 is the char- acter code for ñ.\n\nIn Python 2 string literals correspond to 8-bit character or byte-oriented data.A serious limitation of these strings is that they do not fully support international charac- ter sets and Unicode.To address this limitation, Python 2 uses a separate string type for Unicode data.To write a Unicode string literal, you prefix the first quote with the letter “u”. For example:\n\ns = u\"Jalape\\u00f1o\"\n\nIn Python 3, this prefix character is unnecessary (and is actually a syntax error) as all strings are already Unicode. Python 2 will emulate this behavior if you run the inter- preter with the -U option (in which case all string literals will be treated as Unicode and the u prefix can be omitted).\n\nRegardless of which Python version you are using, the escape codes of \\u, \\U, and\n\n\\N in Table 2.1 are used to insert arbitrary characters into a Unicode literal. Every Unicode character has an assigned code point, which is typically denoted in Unicode charts as U+XXXXwhere XXXXis a sequence of four or more hexadecimal digits. (Note that this notation is not Python syntax but is often used by authors when describing Unicode characters.) For example, the character ñ has a code point of U+00F1.The \\u escape code is used to insert Unicode characters with code points in the range U+0000 to U+FFFF (for example, \\u00f1).The \\U escape code is used to insert characters in the range U+10000 and above (for example, \\U00012345). One subtle caution concerning the \\U escape code is that Unicode characters with code points above U+10000 usually get decomposed into a pair of characters known as a surrogate pair.This has to do with the internal representation of Unicode strings and is covered in more detail in Chapter 3,“Types and Objects.”\n\nUnicode characters also have a descriptive name. If you know the name, you can use\n\nthe \\N{character name} escape sequence. For example:\n\ns = u\"Jalape\\N{LATIN SMALL LETTER N WITH TILDE}o\"\n\nF h Lib f L Bdff\n\nContainers\n\n29\n\nFor an authoritative reference on code points and character names, consult http://www.unicode.org/charts.\n\nOptionally,you can precede a string literal with an r or R,such as in r'\\d'.These strings are known as raw strings because all their backslash characters are left intact—that is, the string literally contains the enclosed text,including the backslashes.The main use of raw strings is to specify literals where the backslash character has some significance.Examples might include the specification of regular expression patterns with the re module or speci- fying a filename on a Windows machine (for example, r'c:\\newdata\\tests').\n\nRaw strings cannot end in a single backslash, such as r\"\\\".Within raw strings, \\uXXXXescape sequences are still interpreted as Unicode characters, provided that the number of preceding \\ characters is odd. For instance, ur\"\\u1234\" defines a raw Unicode string with the single character U+1234, whereas ur\"\\\\u1234\" defines a seven-character string in which the first two characters are slashes and the remaining five characters are the literal \"u1234\".Also, in Python 2.2, the r must appear after the u in raw Unicode strings as shown. In Python 3.0, the u prefix is unnecessary.\n\nString literals should not be defined using a sequence of raw bytes that correspond to a data encoding such as UTF-8 or UTF-16. For example, directly writing a raw UTF-8 encoded string such as 'Jalape\\xc3\\xb1o' simply produces a nine-character string U+004A, U+0061, U+006C, U+0061, U+0070, U+0065, U+00C3, U+00B1, U+006F, which is probably not what you intended.This is because in UTF-8, the multi- byte sequence \\xc3\\xb1 is supposed to represent the single character U+00F1, not the two characters U+00C3 and U+00B1.To specify an encoded byte string as a literal, pre- fix the first quote with a \"b\" as in b\"Jalape\\xc3\\xb1o\".When defined, this literally creates a string of single bytes. From this representation, it is possible to create a normal string by decoding the value of the byte literal with its decode() method. More details about this are covered in Chapter 3 and Chapter 4,“Operators and Expressions.”\n\nThe use of byte literals is quite rare in most programs because this syntax did not appear until Python 2.6, and in that version there is no difference between a byte literal and a normal string. In Python 3, however, byte literals are mapped to a new bytes datatype that behaves differently than a normal string (see Appendix A,“Python 3”).\n\nContainers Values enclosed in square brackets [...], parentheses (...), and braces {...} denote a collection of objects contained in a list, tuple, and dictionary, respectively, as in the fol- lowing example:\n\na = [ 1, 3.4, 'hello' ] # A list b = ( 10, 20, 30 ) # A tuple c = { 'a': 3, 'b': 42 } # A dictionary\n\nList, tuple, and dictionary literals can span multiple lines without using the line- continuation character (\\). In addition, a trailing comma is allowed on the last item. For example:\n\na = [ 1,\n\n3.4, 'hello',\n\n]\n\nF h Lib f L Bdff\n\n30\n\nChapter 2 Lexical Conventions and Syntax\n\nOperators, Delimiters, and Special Symbols The following operators are recognized:\n\n+ - * ** / // % << >> & | ^ -= *= /= //= %= **= &= |= ^= >>= <<=\n\n~\n\n< > <= >= == != <> +=\n\nThe following tokens serve as delimiters for expressions, lists, dictionaries, and various parts of a statement:\n\n( ) [ ] { } , : . ` = ;\n\nFor example, the equal (=) character serves as a delimiter between the name and value of an assignment, whereas the comma (,) character is used to delimit arguments to a function, elements in lists and tuples, and so on.The period (.) is also used in floating- point numbers and in the ellipsis (...) used in extended slicing operations.\n\nFinally, the following special symbols are also used:\n\n' \" # \\ @\n\nThe characters $ and ? have no meaning in Python and cannot appear in a program except inside a quoted string literal.\n\nDocumentation Strings If the first statement of a module, class, or function definition is a string, that string becomes a documentation string for the associated object, as in the following example:\n\ndef fact(n):\n\n\"This function computes a factorial\" if (n <= 1): return 1 else: return n * fact(n - 1)\n\nCode-browsing and documentation-generation tools sometimes use documentation strings.The strings are accessible in the __doc__ attribute of an object, as shown here:\n\n>>> print fact.__doc__ This function computes a factorial >>>\n\nThe indentation of the documentation string must be consistent with all the other statements in a definition. In addition, a documentation string cannot be computed or assigned from a variable as an expression.The documentation string always has to be a string literal enclosed in quotes.\n\nDecorators Function, method, or class definitions may be preceded by a special symbol known as a decorator, the purpose of which is to modify the behavior of the definition that follows. Decorators are denoted with the @ symbol and must be placed on a separate line imme- diately before the corresponding function, method, or class. Here’s an example:\n\nclass Foo(object):\n\n@staticmethod def bar():\n\npass\n\nF h Lib f L Bdff\n\nSource Code Encoding\n\n31\n\nMore than one decorator can be used, but each one must be on a separate line. Here’s an example:\n\n@foo @bar def spam(): pass\n\nMore information about decorators can be found in Chapter 6,“Functions and Functional Programming,” and Chapter 7,“Classes and Object-Oriented Programming.”\n\nSource Code Encoding Python source programs are normally written in standard 7-bit ASCII. However, users working in Unicode environments may find this awkward—especially if they must write a lot of string literals with international characters.\n\nIt is possible to write Python source code in a different encoding by including a spe-\n\ncial encoding comment in the first or second line of a Python program:\n\n#!/usr/bin/env python # -*- coding: UTF-8 -*-\n\ns = \"Jalapeño\" # String in quotes is directly encoded in UTF-8.\n\nWhen the special coding: comment is supplied, string literals may be typed in directly using a Unicode-aware editor. However, other elements of Python, including identifier names and reserved words, should still be restricted to ASCII characters.\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n3\n\nTypes and Objects\n\nAll the data stored in a Python program is built around the concept of an object.\n\nObjects include fundamental data types such as numbers, strings, lists, and dictionaries. However, it’s also possible to create user-defined objects in the form of classes. In addi- tion, most objects related to program structure and the internal operation of the inter- preter are also exposed.This chapter describes the inner workings of the Python object model and provides an overview of the built-in data types. Chapter 4,“Operators and Expressions,” further describes operators and expressions. Chapter 7,“Classes and Object-Oriented Programming,” describes how to create user-defined objects.\n\nTerminology Every piece of data stored in a program is an object. Each object has an identity, a type (which is also known as its class), and a value. For example, when you write a = 42, an integer object is created with the value of 42.You can view the identity of an object as a pointer to its location in memory. a is a name that refers to this specific location.\n\nThe type of an object, also known as the object’s class, describes the internal repre- sentation of the object as well as the methods and operations that it supports.When an object of a particular type is created, that object is sometimes called an instance of that type.After an instance is created, its identity and type cannot be changed. If an object’s value can be modified, the object is said to be mutable. If the value cannot be modified, the object is said to be immutable.An object that contains references to other objects is said to be a container or collection.\n\nMost objects are characterized by a number of data attributes and methods.An attrib-\n\nute is a value associated with an object.A method is a function that performs some sort of operation on an object when the method is invoked as a function.Attributes and methods are accessed using the dot (.) operator, as shown in the following example:\n\na = 3 + 4j # Create a complex number r = a.real # Get the real part (an attribute)\n\nb = [1, 2, 3] # Create a list b.append(7) # Add a new element using the append method\n\nObject Identity and Type The built-in function id() returns the identity of an object as an integer.This integer usually corresponds to the object’s location in memory, although this is specific to the Python implementation and no such interpretation of the identity should be made.The\n\nF h Lib f L Bdff\n\n34\n\nChapter 3 Types and Objects\n\nis operator compares the identity of two objects.The built-in function type() returns the type of an object. Here’s an example of different ways you might compare two objects:\n\n# Compare two objects def compare(a,b): if a is b:\n\n# a and b are the same object statements\n\nif a == b:\n\n# a and b have the same value statements\n\nif type(a) is type(b):\n\n# a and b have the same type statements\n\nThe type of an object is itself an object known as the object’s class.This object is uniquely defined and is always the same for all instances of a given type.Therefore, the type can be compared using the is operator.All type objects are assigned names that can be used to perform type checking. Most of these names are built-ins, such as list, dict, and file. Here’s an example:\n\nif type(s) is list:\n\ns.append(item)\n\nif type(d) is dict: d.update(t)\n\nBecause types can be specialized by defining classes, a better way to check types is to use the built-in isinstance(object, type) function. Here’s an example:\n\nif isinstance(s,list): s.append(item)\n\nif isinstance(d,dict):\n\nd.update(t)\n\nBecause the isinstance() function is aware of inheritance, it is the preferred way to check the type of any Python object.\n\nAlthough type checks can be added to a program, type checking is often not as use-\n\nful as you might imagine. For one, excessive checking severely affects performance. Second, programs don’t always define objects that neatly fit into an inheritance hierar- chy. For instance, if the purpose of the preceding isinstance(s,list) statement is to test whether s is “list-like,” it wouldn’t work with objects that had the same program- ming interface as a list but didn’t directly inherit from the built-in list type.Another option for adding type-checking to a program is to define abstract base classes.This is described in Chapter 7.\n\nReference Counting and Garbage Collection All objects are reference-counted.An object’s reference count is increased whenever it’s assigned to a new name or placed in a container such as a list, tuple, or dictionary, as shown here:\n\na = 37 # Creates an object with value 37 b = a # Increases reference count on 37 c = [] c.append(b) # Increases reference count on 37\n\nF h Lib f L Bdff\n\nReferences and Copies\n\n35\n\nThis example creates a single object containing the value 37. a is merely a name that refers to the newly created object.When b is assigned a, b becomes a new name for the same object and the object’s reference count increases. Likewise, when you place b into a list, the object’s reference count increases again.Throughout the example, only one object contains 37.All other operations are simply creating new references to the object.\n\nAn object’s reference count is decreased by the del statement or whenever a refer-\n\nence goes out of scope (or is reassigned). Here’s an example:\n\ndel a # Decrease reference count of 37 b = 42 # Decrease reference count of 37 c[0] = 2.0 # Decrease reference count of 37\n\nThe current reference count of an object can be obtained using the sys.getrefcount() function. For example:\n\n>>> a = 37 >>> import sys >>> sys.getrefcount(a) 7 >>>\n\nIn many cases, the reference count is much higher than you might guess. For immutable data such as numbers and strings, the interpreter aggressively shares objects between dif- ferent parts of the program in order to conserve memory.\n\nWhen an object’s reference count reaches zero, it is garbage-collected. However, in some cases a circular dependency may exist among a collection of objects that are no longer in use. Here’s an example:\n\na = { } b = { } a['b'] = b # a contains reference to b b['a'] = a # b contains reference to a del a del b\n\nIn this example, the del statements decrease the reference count of a and b and destroy the names used to refer to the underlying objects. However, because each object con- tains a reference to the other, the reference count doesn’t drop to zero and the objects remain allocated (resulting in a memory leak).To address this problem, the interpreter periodically executes a cycle detector that searches for cycles of inaccessible objects and deletes them.The cycle-detection algorithm runs periodically as the interpreter allocates more and more memory during execution.The exact behavior can be fine-tuned and controlled using functions in the gc module (see Chapter 13,“Python Runtime Services”).\n\nReferences and Copies When a program makes an assignment such as a = b, a new reference to b is created. For immutable objects such as numbers and strings, this assignment effectively creates a copy of b. However, the behavior is quite different for mutable objects such as lists and dictionaries. Here’s an example:\n\n>>> a = [1,2,3,4] >>> b = a >>> b is a True\n\n# b is a reference to a\n\nF h Lib f L Bdff\n\n36\n\nChapter 3 Types and Objects\n\n>>> b[2] = -100 >>> a [1, 2, -100, 4] >>>\n\n# Change an element in b # Notice how a also changed\n\nBecause a and b refer to the same object in this example, a change made to one of the variables is reflected in the other.To avoid this, you have to create a copy of an object rather than a new reference.\n\nTwo types of copy operations are applied to container objects such as lists and dic- tionaries: a shallow copy and a deep copy.A shallow copy creates a new object but popu- lates it with references to the items contained in the original object. Here’s an example:\n\n>>> a = [ 1, 2, [3,4] ] >>> b = list(a) >>> b is a False >>> b.append(100) >>> b [1, 2, [3, 4], 100] >>> a [1, 2, [3, 4]] >>> b[2][0] = -100 >>> b [1, 2, [-100, 4], 100] >>> a [1, 2, [-100, 4]] >>> In this case, a and b are separate list objects, but the elements they contain are shared. Therefore, a modification to one of the elements of a also modifies an element of b, as shown.\n\n# Create a shallow copy of a.\n\n# Append element to b.\n\n# Notice that a is unchanged\n\n# Modify an element inside b\n\n# Notice the change inside a\n\nA deep copy creates a new object and recursively copies all the objects it contains.\n\nThere is no built-in operation to create deep copies of objects. However, the copy.deepcopy() function in the standard library can be used, as shown in the follow- ing example:\n\n>>> import copy >>> a = [1, 2, [3, 4]] >>> b = copy.deepcopy(a) >>> b[2][0] = -100 >>> b [1, 2, [-100, 4]] >>> a [1, 2, [3, 4]] >>>\n\n# Notice that a is unchanged\n\nFirst-Class Objects All objects in Python are said to be “first class.”This means that all objects that can be named by an identifier have equal status. It also means that all objects that can be named can be treated as data. For example, here is a simple dictionary containing two values:\n\nitems = {\n\n'number' : 42 'text' : \"Hello World\"\n\n}\n\nF h Lib f L Bdff\n\nBuilt-in Types for Representing Data\n\n37\n\nThe first-class nature of objects can be seen by adding some more unusual items to this dictionary. Here are some examples:\n\nitems[\"func\"] = abs # Add the abs() function import math items[\"mod\"] = math # Add a module items[\"error\"] = ValueError # Add an exception type nums = [1,2,3,4] items[\"append\"] = nums.append # Add a method of another object\n\nIn this example, the items dictionary contains a function, a module, an exception, and a method of another object. If you want, you can use dictionary lookups on items in place of the original names and the code will still work. For example:\n\n>>> items[\"func\"](-45) 45 >>> items[\"mod\"].sqrt(4) 2.0 >>> try: x = int(\"a lot\") ... ... except items[\"error\"] as e: ... ... Couldn't convert >>> items[\"append\"](100) >>> nums [1, 2, 3, 4, 100] >>>\n\nprint(\"Couldn't convert\")\n\n# Executes abs(-45)\n\n# Executes math.sqrt(4)\n\n# Same as except ValueError as e\n\n# Executes nums.append(100)\n\nThe fact that everything in Python is first-class is often not fully appreciated by new programmers. However, it can be used to write very compact and flexible code. For example, suppose you had a line of text such as \"GOOG,100,490.10\" and you wanted to convert it into a list of fields with appropriate type-conversion. Here’s a clever way that you might do it by creating a list of types (which are first-class objects) and execut- ing a few simple list processing operations:\n\n>>> line = \"GOOG,100,490.10\" >>> field_types = [str, int, float] >>> raw_fields = line.split(',') >>> fields = [ty(val) for ty,val in zip(field_types,raw_fields)] >>> fields ['GOOG', 100, 490.10000000000002] >>>\n\nBuilt-in Types for Representing Data There are approximately a dozen built-in data types that are used to represent most of the data used in programs.These are grouped into a few major categories as shown in Table 3.1.The Type Name column in the table lists the name or expression that you can use to check for that type using isinstance() and other type-related functions. Certain types are only available in Python 2 and have been indicated as such (in Python 3, they have been deprecated or merged into one of the other types).\n\nF h Lib f L Bdff\n\n38\n\nChapter 3 Types and Objects\n\nTable 3.1\n\nBuilt-In Types for Data Representation\n\nType Category\n\nType Name\n\nDescription\n\nNone Numbers\n\nSequences\n\nMapping Sets\n\ntype(None) The null object None Integer int Arbitrary-precision integer (Python 2 only) Floating point Complex number Boolean (True or False) Character string Unicode character string (Python 2 only) List Tuple A range of integers created by xrange() (In Python 3, it is called range.) Dictionary Mutable set Immutable set\n\nlong\n\nfloat\n\ncomplex\n\nbool\n\nstr\n\nunicode\n\nlist\n\ntuple\n\nxrange\n\ndict\n\nset\n\nfrozenset\n\nThe None Type The None type denotes a null object (an object with no value). Python provides exactly one null object, which is written as None in a program.This object is returned by func- tions that don’t explicitly return a value. None is frequently used as the default value of optional arguments, so that the function can detect whether the caller has actually passed a value for that argument. None has no attributes and evaluates to False in Boolean expressions.\n\nNumeric Types Python uses five numeric types: Booleans, integers, long integers, floating-point num- bers, and complex numbers. Except for Booleans, all numeric objects are signed.All numeric types are immutable.\n\nBooleans are represented by two values: True and False.The names True and\n\nFalse are respectively mapped to the numerical values of 1 and 0.\n\nIntegers represent whole numbers in the range of –2147483648 to 2147483647 (the\n\nrange may be larger on some machines). Long integers represent whole numbers of unlimited range (limited only by available memory).Although there are two integer types, Python tries to make the distinction seamless (in fact, in Python 3, the two types have been unified into a single integer type).Thus, although you will sometimes see ref- erences to long integers in existing Python code, this is mostly an implementation detail that can be ignored—just use the integer type for all integer operations.The one excep- tion is in code that performs explicit type checking for integer values. In Python 2, the expression isinstance(x, int) will return False if xis an integer that has been promoted to a long.\n\nFloating-point numbers are represented using the native double-precision (64-bit) representation of floating-point numbers on the machine. Normally this is IEEE 754, which provides approximately 17 digits of precision and an exponent in the range of\n\nF h Lib f L Bdff\n\nBuilt-in Types for Representing Data\n\n39\n\n–308 to 308.This is the same as the double type in C. Python doesn’t support 32-bit single-precision floating-point numbers. If precise control over the space and precision of numbers is an issue in your program, consider using the numpy extension (which can be found at http://numpy.sourceforge.net).\n\nComplex numbers are represented as a pair of floating-point numbers.The real and\n\nimaginary parts of a complex number zare available in z.real and z.imag.The method z.conjugate() calculates the complex conjugate of z(the conjugate of a+bj is a-bj).\n\nNumeric types have a number of properties and methods that are meant to simplify operations involving mixed arithmetic. For simplified compatibility with rational num- bers (found in the fractions module), integers have the properties x.numerator and x.denominator.An integer or floating-point number yhas the properties y.real and y.imag as well as the method y.conjugate() for compatibility with complex num- bers.A floating-point number ycan be converted into a pair of integers representing a fraction using y.as_integer_ratio().The method y.is_integer() tests if a floating-point number yrepresents an integer value. Methods y.hex() and y.fromhex() can be used to work with floating-point numbers using their low-level binary representation.\n\nSeveral additional numeric types are defined in library modules.The decimal mod- ule provides support for generalized base-10 decimal arithmetic.The fractions mod- ule adds a rational number type.These modules are covered in Chapter 14, “Mathematics.”\n\nSequence Types Sequences represent ordered sets of objects indexed by non-negative integers and include strings, lists, and tuples. Strings are sequences of characters, and lists and tuples are sequences of arbitrary Python objects. Strings and tuples are immutable; lists allow inser- tion, deletion, and substitution of elements.All sequences support iteration.\n\nOperations Common to All Sequences Table 3.2 shows the operators and methods that you can apply to all sequence types. Element iof sequence sis selected using the indexing operator s[i], and subse- quences are selected using the slicing operator s[i:j] or extended slicing operator s[i:j:stride] (these operations are described in Chapter 4).The length of any sequence is returned using the built-in len(s) function.You can find the minimum and maximum values of a sequence by using the built-in min(s) and max(s) functions. However, these functions only work for sequences in which the elements can be ordered (typically numbers and strings). sum(s) sums items in sbut only works for numeric data.\n\nTable 3.3 shows the additional operators that can be applied to mutable sequences\n\nsuch as lists.\n\nTable 3.2 Operations and Methods Applicable to All Sequences\n\nItem\n\nDescription\n\ns[i] s[i:j] s[i:j:stride]\n\nReturns element iof a sequence Returns a slice Returns an extended slice\n\nF h Lib f L Bdff",
      "page_number": 44
    },
    {
      "number": 4,
      "title": "Segment 4 (pages 64-85)",
      "start_page": 64,
      "end_page": 85,
      "detection_method": "synthetic",
      "content": "40\n\nChapter 3 Types and Objects\n\nTable 3.2\n\nContinued\n\nItem\n\nDescription\n\nlen(s)\n\nmin(s)\n\nmax(s)\n\nsum(s [,initial])\n\nall(s)\n\nany(s)\n\nNumber of elements in s Minimum value in s Maximum value in s Sum of items in s Checks whether all items in sare True. Checks whether any item in sis True.\n\nTable 3.3 Operations Applicable to Mutable Sequences\n\nItem\n\nDescription\n\ns[i] = v\n\ns[i:j] = t\n\ns[i:j:stride] = t\n\ndel s[i]\n\ndel s[i:j]\n\ndel s[i:j:stride]\n\nItem assignment Slice assignment Extended slice assignment Item deletion Slice deletion Extended slice deletion\n\nLists Lists support the methods shown in Table 3.4.The built-in function list(s) converts any iterable type to a list. If sis already a list, this function constructs a new list that’s a shallow copy of s.The s.append(x) method appends a new element, x, to the end of the list.The s.index(x) method searches the list for the first occurrence of x. If no such element is found, a ValueError exception is raised. Similarly, the s.remove(x) method removes the first occurrence of xfrom the list or raises ValueError if no such item exists.The s.extend(t) method extends the list sby appending the elements in sequence t.\n\nThe s.sort() method sorts the elements of a list and optionally accepts a key func-\n\ntion and reverse flag, both of which must be specified as keyword arguments.The key function is a function that is applied to each element prior to comparison during sort- ing. If given, this function should take a single item as input and return the value that will be used to perform the comparison while sorting. Specifying a key function is use- ful if you want to perform special kinds of sorting operations such as sorting a list of strings, but with case insensitivity.The s.reverse() method reverses the order of the items in the list. Both the sort() and reverse() methods operate on the list elements in place and return None.\n\nTable 3.4\n\nList Methods\n\nMethod\n\nDescription\n\nlist(s)\n\ns.append(x)\n\ns.extend(t)\n\ns.count(x)\n\nConverts sto a list. Appends a new element, x, to the end of s. Appends a new list, t, to the end of s. Counts occurrences of xin s.\n\nF h Lib f L Bdff\n\nBuilt-in Types for Representing Data\n\n41\n\nTable 3.4\n\nContinued\n\nMethod\n\nDescription\n\ns.index(x [,start [,stop]]) Returns the smallest iwhere s[i]==x. start\n\ns.insert(i,x)\n\ns.pop([i])\n\ns.remove(x)\n\ns.reverse()\n\ns.sort([key [, reverse]])\n\nand stopoptionally specify the starting and ending index for the search. Inserts xat index i. Returns the element iand removes it from the list. If iis omitted, the last element is returned. Searches for xand removes it from s. Reverses items of sin place. Sorts items of sin place. keyis a key function. reverseis a flag that sorts the list in reverse order. keyand reverseshould always be speci- fied as keyword arguments.\n\nStrings Python 2 provides two string object types. Byte strings are sequences of bytes contain- ing 8-bit data.They may contain binary data and embedded NULL bytes. Unicode strings are sequences of unencoded Unicode characters, which are internally represented by 16-bit integers.This allows for 65,536 unique character values.Although the Unicode standard supports up to 1 million unique character values, these extra charac- ters are not supported by Python by default. Instead, they are encoded as a special two- character (4-byte) sequence known as a surrogate pair—the interpretation of which is up to the application.As an optional feature, Python may be built to store Unicode charac- ters using 32-bit integers.When enabled, this allows Python to represent the entire range of Unicode values from U+000000 to U+110000.All Unicode-related functions are adjusted accordingly.\n\nStrings support the methods shown in Table 3.5.Although these methods operate on\n\nstring instances, none of these methods actually modifies the underlying string data. Thus, methods such as s.capitalize(), s.center(), and s.expandtabs() always return a new string as opposed to modifying the string s. Character tests such as s.isalnum() and s.isupper() return True or False if all the characters in the string ssatisfy the test. Furthermore, these tests always return False if the length of the string is zero.\n\nThe s.find(), s.index(), s.rfind(), and s.rindex() methods are used to search sfor a substring.All these functions return an integer index to the substring in s. In addition, the find() method returns -1 if the substring isn’t found, whereas the index() method raises a ValueError exception.The s.replace() method is used to replace a substring with replacement text. It is important to emphasize that all of these methods only work with simple substrings. Regular expression pattern matching and searching is handled by functions in the re library module.\n\nThe s.split() and s.rsplit() methods split a string into a list of fields separated by a delimiter.The s.partition() and s.rpartition() methods search for a separa- tor substring and partition sinto three parts corresponding to text before the separator, the separator itself, and text after the separator.\n\nMany of the string methods accept optional startand endparameters, which are integer values specifying the starting and ending indices in s. In most cases, these values\n\nF h Lib f L Bdff\n\n42\n\nChapter 3 Types and Objects\n\nmay be given negative values, in which case the index is taken from the end of the string.\n\nThe s.translate() method is used to perform advanced character substitutions such as quickly stripping all control characters out of a string.As an argument, it accepts a translation table containing a one-to-one mapping of characters in the original string to characters in the result. For 8-bit strings, the translation table is a 256-character string. For Unicode, the translation table can be any sequence object swhere s[n] returns an integer character code or Unicode character corresponding to the Unicode character with integer value n.\n\nThe s.encode() and s.decode() methods are used to transform string data to and\n\nfrom a specified character encoding.As input, these accept an encoding name such as 'ascii', 'utf-8', or 'utf-16'.These methods are most commonly used to convert Unicode strings into a data encoding suitable for I/O operations and are described fur- ther in Chapter 9,“Input and Output.” Be aware that in Python 3, the encode() method is only available on strings, and the decode() method is only available on the bytes datatype.\n\nThe s.format() method is used to perform string formatting.As arguments, it accepts any combination of positional and keyword arguments. Placeholders in sdenot- ed by {item} are replaced by the appropriate argument. Positional arguments can be referenced using placeholders such as {0} and {1}. Keyword arguments are referenced using a placeholder with a name such as {name}. Here is an example:\n\n>>> a = \"Your name is {0} and your age is {age}\" >>> a.format(\"Mike\", age=40) 'Your name is Mike and your age is 40' >>>\n\nWithin the special format strings, the {item} placeholders can also include simple index and attribute lookup.A placeholder of {item[n]} where nis a number performs a sequence lookup on item.A placeholder of {item[key]} where keyis a non- numeric string performs a dictionary lookup of item[\"key\"].A placeholder of {item.attr} refers to attribute attrof item. Further details on the format() method can be found in the “String Formatting” section of Chapter 4.\n\nTable 3.5\n\nString Methods\n\nMethod\n\nDescription\n\ns.capitalize()\n\ns.center(width [, pad])\n\ns.count(sub [,start [,end]])\n\ns.decode([encoding [,errors]])\n\ns.encode([encoding [,errors]])\n\ns.endswith(suffix [,start [,end]])\n\ns.expandtabs([tabsize])\n\ns.find(sub [, start [,end]])\n\nCapitalizes the first character. Centers the string in a field of length width. padis a padding character. Counts occurrences of the specified substring sub. Decodes a string and returns a Unicode string (byte strings only). Returns an encoded version of the string (unicode strings only). Checks the end of the string for a suffix. Replaces tabs with spaces. Finds the first occurrence of the speci- fied substring subor returns -1.\n\nF h Lib f L Bdff\n\nTable 3.5\n\nContinued\n\nMethod\n\ns.format(*args, **kwargs)\n\ns.index(sub [, start [,end]])\n\ns.isalnum()\n\ns.isalpha()\n\ns.isdigit()\n\ns.islower()\n\ns.isspace()\n\ns.istitle()\n\ns.isupper()\n\ns.join(t)\n\ns.ljust(width [, fill])\n\ns.lower()\n\ns.lstrip([chrs])\n\ns.partition(sep)\n\ns.replace(old, new [,maxreplace])\n\ns.rfind(sub [,start [,end]])\n\ns.rindex(sub [,start [,end]])\n\ns.rjust(width [, fill])\n\ns.rpartition(sep)\n\ns.rsplit([sep [,maxsplit]])\n\ns.rstrip([chrs])\n\ns.split([sep [,maxsplit]])\n\nBuilt-in Types for Representing Data\n\n43\n\nDescription\n\nFormats s. Finds the first occurrence of the speci- fied substring subor raises an error. Checks whether all characters are alphanumeric. Checks whether all characters are alphabetic. Checks whether all characters are digits. Checks whether all characters are low- ercase. Checks whether all characters are whitespace. Checks whether the string is a title- cased string (first letter of each word capitalized). Checks whether all characters are uppercase. Joins the strings in sequence twith s as a separator. Left-aligns sin a string of size width. Converts to lowercase. Removes leading whitespace or charac- ters supplied in chrs. Partitions a string based on a separa- tor string sep. Returns a tuple (head,sep,tail) or (s, \"\",\"\") if sepisn’t found. Replaces a substring. Finds the last occurrence of a substring. Finds the last occurrence or raises an error. Right-aligns sin a string of length width. Partitions sbased on a separator sep, but searches from the end of the string. Splits a string from the end of the string using sepas a delimiter. maxsplitis the maximum number of splits to per- form. If maxsplitis omitted, the result is identical to the split() method. Removes trailing whitespace or charac- ters supplied in chrs. Splits a string using sepas a delimiter. maxsplitis the maximum number of splits to perform.\n\nF h Lib f L Bdff\n\n44\n\nChapter 3 Types and Objects\n\nTable 3.5\n\nContinued\n\ns.splitlines([keepends])\n\nSplits a string into a list of lines. If keependsis 1, trailing newlines are preserved.\n\ns.startswith(prefix [,start [,end]]) Checks whether a string starts with\n\ns.strip([chrs])\n\ns.swapcase()\n\ns.title()\n\ns.translate(table [,deletechars])\n\ns.upper()\n\ns.zfill(width)\n\nprefix. Removes leading and trailing white- space or characters supplied in chrs. Converts uppercase to lowercase, and vice versa. Returns a title-cased version of the string. Translates a string using a character translation table table, removing char- acters in deletechars. Converts a string to uppercase. Pads a string with zeros on the left up to the specified width.\n\nxrange() Objects The built-in function xrange([i,]j [,stride]) creates an object that represents a range of integers ksuch that i <= k < j.The first index, i, and the strideare optional and have default values of 0 and 1, respectively.An xrange object calculates its values whenever it’s accessed and although an xrange object looks like a sequence, it is actually somewhat limited. For example, none of the standard slicing operations are sup- ported.This limits the utility of xrange to only a few applications such as iterating in simple loops.\n\nIt should be noted that in Python 3, xrange() has been renamed to range().\n\nHowever, it operates in exactly the same manner as described here.\n\nMapping Types A mapping object represents an arbitrary collection of objects that are indexed by another collection of nearly arbitrary key values. Unlike a sequence, a mapping object is unordered and can be indexed by numbers, strings, and other objects. Mappings are mutable.\n\nDictionaries are the only built-in mapping type and are Python’s version of a hash table or associative array.You can use any immutable object as a dictionary key value (strings, numbers, tuples, and so on). Lists, dictionaries, and tuples containing mutable objects cannot be used as keys (the dictionary type requires key values to remain con- stant).\n\nTo select an item in a mapping object, use the key index operator m[k], where kis a key value. If the key is not found, a KeyError exception is raised.The len(m) function returns the number of items contained in a mapping object.Table 3.6 lists the methods and operations.\n\nF h Lib f L Bdff\n\nBuilt-in Types for Representing Data\n\n45\n\nTable 3.6 Methods and Operations for Dictionaries\n\nItem\n\nDescription\n\nlen(m)\n\nReturns the number of items in m. Returns the item of mwith key k. Sets m[k] to x. Removes m[k] from m. Returns True if kis a key in m. Removes all items from m. Makes a copy of m.\n\nm[k]\n\nm[k]=x\n\ndel m[k]\n\nk in m\n\nm.clear()\n\nm.copy() m.fromkeys(s [,value]) Create a new dictionary with keys from sequence sand values all set to value. Returns m[k] if found; otherwise, returns v. Returns True if mhas key k; otherwise, returns False. (Deprecated, use the in operator instead. Python 2 only) Returns a sequence of (key,value) pairs. Returns a sequence of key values. Returns m[k] if found and removes it from m; otherwise, returns defaultif supplied or raises KeyError if not. Removes a random (key,value) pair from mand returns it as a tuple.\n\nm.get(k [,v])\n\nm.has_key(k)\n\nm.items()\n\nm.keys()\n\nm.pop(k [,default])\n\nm.popitem()\n\nm.setdefault(k [, v]) Returns m[k] if found; otherwise, returns vand sets\n\nm.update(b)\n\nm.values()\n\nm[k] = v. Adds all objects from bto m. Returns a sequence of all values in m.\n\nMost of the methods in Table 3.6 are used to manipulate or retrieve the contents of a dictionary.The m.clear() method removes all items.The m.update(b) method updates the current mapping object by inserting all the (key,value) pairs found in the mapping object b.The m.get(k [,v]) method retrieves an object but allows for an optional default value, v, that’s returned if no such key exists.The m.setdefault(k [,v]) method is similar to m.get(), except that in addition to returning vif no object exists, it sets m[k] = v. If vis omitted, it defaults to None.The m.pop() method returns an item from a dictionary and removes it at the same time.The m.popitem() method is used to iteratively destroy the contents of a dictionary.\n\nThe m.copy() method makes a shallow copy of the items contained in a mapping\n\nobject and places them in a new mapping object.The m.fromkeys(s [,value]) method creates a new mapping with keys all taken from a sequence s. The type of the resulting mapping will be the same as m.The value associated with all of these keys is set to None unless an alternative value is given with the optional valueparameter.The fromkeys() method is defined as a class method, so an alternative way to invoke it would be to use the class name such as dict.fromkeys().\n\nThe m.items() method returns a sequence containing (key,value) pairs.The m.keys() method returns a sequence with all the key values, and the m.values() method returns a sequence with all the values. For these methods, you should assume that the only safe operation that can be performed on the result is iteration. In Python 2 the result is a list, but in Python 3 the result is an iterator that iterates over the current contents of the mapping. If you write code that simply assumes it is an iterator, it will\n\nF h Lib f L Bdff\n\n46\n\nChapter 3 Types and Objects\n\nbe generally compatible with both versions of Python. If you need to store the result of these methods as data, make a copy by storing it in a list. For example, items = list(m.items()). If you simply want a list of all keys, use keys = list(m).\n\nSet Types A set is an unordered collection of unique items. Unlike sequences, sets provide no indexing or slicing operations.They are also unlike dictionaries in that there are no key values associated with the objects.The items placed into a set must be immutable.Two different set types are available: set is a mutable set, and frozenset is an immutable set. Both kinds of sets are created using a pair of built-in functions:\n\ns = set([1,5,10,15]) f = frozenset(['a',37,'hello'])\n\nBoth set() and frozenset() populate the set by iterating over the supplied argu- ment. Both kinds of sets provide the methods outlined in Table 3.7.\n\nTable 3.7 Methods and Operations for Set Types\n\nItem\n\nDescription\n\nlen(s)\n\ns.copy()\n\ns.difference(t)\n\ns.intersection(t)\n\ns.isdisjoint(t)\n\ns.issubset(t)\n\nReturns the number of items in s. Makes a copy of s. Set difference. Returns all the items in s, but not in t. Intersection. Returns all the items that are both in s and in t. Returns True if sand thave no items in common. Returns True if sis a subset of t. Returns True if sis a superset of t.\n\ns.issuperset(t) s.symmetric_difference(t) Symmetric difference. Returns all the items that are\n\ns.union(t)\n\nin sor t, but not in both sets. Union. Returns all items in sor t.\n\nThe s.difference(t), s.intersection(t), s.symmetric_difference(t), and s.union(t) methods provide the standard mathematical operations on sets.The returned value has the same type as s(set or frozenset).The parameter tcan be any Python object that supports iteration.This includes sets, lists, tuples, and strings.These set operations are also available as mathematical operators, as described further in Chapter 4.\n\nMutable sets (set) additionally provide the methods outlined in Table 3.8.\n\nTable 3.8 Methods for Mutable Set Types\n\nItem\n\nDescription\n\ns.add(item)\n\ns.clear()\n\ns.difference_update(t)\n\nAdds itemto s. Has no effect if itemis already in s. Removes all items from s. Removes all the items from sthat are also in t.\n\nF h Lib f L Bdff\n\nBuilt-in Types for Representing Program Structure\n\n47\n\nTable 3.8\n\nContinued\n\nItem\n\nDescription\n\ns.discard(item)\n\ns.intersection_update(t)\n\ns.pop()\n\ns.remove(item)\n\nRemoves itemfrom s. If itemis not a member of s, nothing happens. Computes the intersection of sand tand leaves the result in s. Returns an arbitrary set element and removes it from s. Removes itemfrom s. If itemis not a member, KeyError is raised.\n\ns.symmetric_difference_update(t) Computes the symmetric difference of sand t\n\ns.update(t)\n\nand leaves the result in s. Adds all the items in tto s. tmay be anoth- er set, a sequence, or any object that sup- ports iteration.\n\nAll these operations modify the set sin place.The parameter tcan be any object that supports iteration.\n\nBuilt-in Types for Representing Program Structure In Python, functions, classes, and modules are all objects that can be manipulated as data.Table 3.9 shows types that are used to represent various elements of a program itself.\n\nTable 3.9\n\nBuilt-in Python Types for Program Structure\n\nType Category\n\nType Name\n\nDescription\n\nCallable\n\nModules Classes Types\n\ntypes.BuiltinFunctionType Built-in function or method type\n\nType of built-in types and classes Ancestor of all types and classes User-defined function Class method Module Ancestor of all types and classes Type of built-in types and classes\n\nobject\n\ntypes.FunctionType\n\ntypes.MethodType\n\ntypes.ModuleType\n\nobject\n\ntype\n\nNote that object and type appear twice in Table 3.9 because classes and types are both callable as a function.\n\nCallable Types Callable types represent objects that support the function call operation.There are sev- eral flavors of objects with this property, including user-defined functions, built-in func- tions, instance methods, and classes.\n\nF h Lib f L Bdff\n\n48\n\nChapter 3 Types and Objects\n\nUser-Defined Functions User-defined functions are callable objects created at the module level by using the def statement or with the lambda operator. Here’s an example:\n\ndef foo(x,y):\n\nreturn x + y\n\nbar = lambda x,y: x + y\n\nA user-defined function fhas the following attributes:\n\nAttribute(s) f.__doc__\n\nf.__name__\n\nf.__dict__\n\nf.__code__\n\nf.__defaults__\n\nf.__globals__\n\nDescription Documentation string Function name Dictionary containing function attributes Byte-compiled code Tuple containing the default arguments Dictionary defining the global namespace Tuple containing data related to nested scopes\n\nf.__closure__\n\nIn older versions of Python 2, many of the preceding attributes had names such as func_code, func_defaults, and so on.The attribute names listed are compatible with Python 2.6 and Python 3.\n\nMethods Methods are functions that are defined inside a class definition.There are three common types of methods—instance methods, class methods, and static methods:\n\nclass Foo(object):\n\ndef instance_method(self,arg):\n\nstatements\n\n@classmethod def class_method(cls,arg):\n\nstatements\n\n@staticmethod def static_method(arg):\n\nstatements\n\nAn instance method is a method that operates on an instance belonging to a given class. The instance is passed to the method as the first argument, which is called self by convention.A class method operates on the class itself as an object.The class object is passed to a class method in the first argument, cls.A static method is a just a function that happens to be packaged inside a class. It does not receive an instance or a class object as a first argument.\n\nBoth instance and class methods are represented by a special object of type\n\ntypes.MethodType. However, understanding this special type requires a careful under- standing of how object attribute lookup (.) works.The process of looking something up on an object (.) is always a separate operation from that of making a function call. When you invoke a method, both operations occur, but as distinct steps.This example illustrates the process of invoking f.instance_method(arg) on an instance of Foo in the preceding listing:\n\nf = Foo() # Create an instance meth = f.instance_method # Lookup the method and notice the lack of () meth(37) # Now call the method\n\nF h Lib f L Bdff\n\nBuilt-in Types for Representing Program Structure\n\n49\n\nIn this example, meth is known as a bound method.A bound method is a callable object that wraps both a function (the method) and an associated instance.When you call a bound method, the instance is passed to the method as the first parameter (self).Thus, meth in the example can be viewed as a method call that is primed and ready to go but which has not been invoked using the function call operator ().\n\nMethod lookup can also occur on the class itself. For example:\n\numeth = Foo.instance_method # Lookup instance_method on Foo umeth(f,37) # Call it, but explicitly supply self\n\nIn this example, umeth is known as an unbound method.An unbound method is a callable object that wraps the method function, but which expects an instance of the proper type to be passed as the first argument. In the example, we have passed f, a an instance of Foo, as the first argument. If you pass the wrong kind of object, you get a TypeError. For example:\n\n>>> umeth(\"hello\",5) Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: descriptor 'instance_method' requires a 'Foo' object but received a 'str' >>>\n\nFor user-defined classes, bound and unbound methods are both represented as an object of type types.MethodType, which is nothing more than a thin wrapper around an ordinary function object.The following attributes are defined for method objects:\n\nAttribute m.__doc__\n\nm.__name__\n\nm.__class__\n\nm.__func__\n\nm.__self__\n\nDescription Documentation string Method name Class in which this method was defined Function object implementing the method Instance associated with the method (None if unbound)\n\nOne subtle feature of Python 3 is that unbound methods are no longer wrapped by a types.MethodType object. If you access Foo.instance_method as shown in earlier examples, you simply obtain the raw function object that implements the method. Moreover, you’ll find that there is no longer any type checking on the self parameter.\n\nBuilt-in Functions and Methods The object types.BuiltinFunctionType is used to represent functions and methods implemented in C and C++.The following attributes are available for built-in methods:\n\nAttribute b.__doc__\n\nb.__name__\n\nb.__self__\n\nDescription Documentation string Function/method name Instance associated with the method (if bound)\n\nFor built-in functions such as len(), __self__ is set to None, indicating that the func- tion isn’t bound to any specific object. For built-in methods such as x.append, where x is a list object, __self__ is set to x.\n\nF h Lib f L Bdff\n\n50\n\nChapter 3 Types and Objects\n\nClasses and Instances as Callables Class objects and instances also operate as callable objects.A class object is created by the class statement and is called as a function in order to create new instances. In this case, the arguments to the function are passed to the __init__() method of the class in order to initialize the newly created instance.An instance can emulate a function if it defines a special method, __call__(). If this method is defined for an instance, x, then x(args) invokes the method x.__call__(args).\n\nClasses, Types, and Instances When you define a class, the class definition normally produces an object of type type. Here’s an example:\n\n>>> class Foo(object): ... ... >>> type(Foo) <type 'type'>\n\npass\n\nThe following table shows commonly used attributes of a type object t:\n\nAttribute t.__doc__\n\nt.__name__\n\nt.__bases__\n\nt.__dict__\n\nt.__module__\n\nt.__abstractmethods__\n\nDescription Documentation string Class name Tuple of base classes Dictionary holding class methods and variables Module name in which the class is defined Set of abstract method names (may be undefined if there aren’t any)\n\nWhen an object instance is created, the type of the instance is the class that defined it. Here’s an example:\n\n>>> f = Foo() >>> type(f) <class '__main__.Foo'>\n\nThe following table shows special attributes of an instance i:\n\nAttribute i.__class__\n\ni.__dict__\n\nDescription Class to which the instance belongs Dictionary holding instance data\n\nThe __dict__ attribute is normally where all of the data associated with an instance is stored.When you make assignments such as i.attr = value, the value is stored here. However, if a user-defined class uses __slots__, a more efficient internal representation is used and instances will not have a __dict__ attribute. More details on objects and the organization of the Python object system can be found in Chapter 7.\n\nModules The module type is a container that holds objects loaded with the import statement. When the statement import foo appears in a program, for example, the name foo is\n\nF h Lib f L Bdff\n\nBuilt-in Types for Interpreter Internals\n\n51\n\nassigned to the corresponding module object. Modules define a namespace that’s imple- mented using a dictionary accessible in the attribute __dict__.Whenever an attribute of a module is referenced (using the dot operator), it’s translated into a dictionary lookup. For example, m.xis equivalent to m.__dict__[\"x\"]. Likewise, assignment to an attribute such as m.x = yis equivalent to m.__dict__[\"x\"] = y.The following attributes are available:\n\nAttribute m.__dict__\n\nm.__doc__\n\nm.__name__\n\nm.__file__\n\nm.__path__\n\nDescription Dictionary associated with the module Module documentation string Name of the module File from which the module was loaded Fully qualified package name, only defined when the module object refers to a package\n\nBuilt-in Types for Interpreter Internals A number of objects used by the internals of the interpreter are exposed to the user. These include traceback objects, code objects, frame objects, generator objects, slice objects, and the Ellipsis as shown in Table 3.10. It is relatively rare for programs to manipulate these objects directly, but they may be of practical use to tool-builders and framework designers.\n\nTable 3.10 Built-in Python Types for Interpreter Internals\n\nType Name\n\nDescription\n\ntypes.CodeType\n\ntypes.FrameType\n\ntypes.GeneratorType\n\ntypes.TracebackType\n\nslice\n\nEllipsis\n\nByte-compiled code Execution frame Generator object Stack traceback of an exception Generated by extended slices Used in extended slices\n\nCode Objects Code objects represent raw byte-compiled executable code, or bytecode, and are typically returned by the built-in compile() function. Code objects are similar to functions except that they don’t contain any context related to the namespace in which the code was defined, nor do code objects store information about default argument values.A code object, c, has the following read-only attributes:\n\nAttribute\n\nDescription\n\nc.co_name\n\nc.co_argcount\n\nc.co_nlocals c.co_varnames\n\nFunction name. Number of positional arguments (including default values). Number of local variables used by the function. Tuple containing names of local variables.\n\nF h Lib f L Bdff\n\n52\n\nChapter 3 Types and Objects\n\nAttribute\n\nDescription\n\nc.co_cellvars\n\nc.co_freevars\n\nc.co_code\n\nc.co_consts\n\nc.co_names\n\nTuple containing names of variables referenced by nested func- tions. Tuple containing names of free variables used by nested func- tions. String representing raw bytecode. Tuple containing the literals used by the bytecode. Tuple containing names used by the bytecode. Name of the file in which the code was compiled.\n\nc.co_filename c.co_firstlineno First line number of the function. c.co_lnotab\n\nString encoding bytecode offsets to line numbers. Required stack size (including local variables). Integer containing interpreter flags. Bit 2 is set if the function uses a variable number of positional arguments using \"*args\". Bit 3 is set if the function allows arbitrary keyword arguments using \"**kwargs\". All other bits are reserved.\n\nc.co_stacksize\n\nc.co_flags\n\nFrame Objects Frame objects are used to represent execution frames and most frequently occur in traceback objects (described next).A frame object, f, has the following read-only attributes:\n\nAttribute f.f_back\n\nf.f_code\n\nf.f_locals\n\nf.f_globals\n\nf.f_builtins\n\nf.f_lineno\n\nf.f_lasti\n\nDescription Previous stack frame (toward the caller). Code object being executed. Dictionary used for local variables. Dictionary used for global variables. Dictionary used for built-in names. Line number. Current instruction. This is an index into the bytecode string of f_code.\n\nThe following attributes can be modified (and are used by debuggers and other tools):\n\nAttribute f.f_trace\n\nf.f_exc_type\n\nf.f_exc_value\n\nf.f_exc_traceback\n\nDescription Function called at the start of each source code line Most recent exception type (Python 2 only) Most recent exception value (Python 2 only) Most recent exception traceback (Python 2 only)\n\nTraceback Objects Traceback objects are created when an exception occurs and contain stack trace infor- mation.When an exception handler is entered, the stack trace can be retrieved using the\n\nF h Lib f L Bdff\n\nBuilt-in Types for Interpreter Internals\n\n53\n\nsys.exc_info() function.The following read-only attributes are available in traceback objects:\n\nAttribute t.tb_next\n\nt.tb_frame\n\nt.tb_lineno\n\nt.tb_lasti\n\nDescription Next level in the stack trace (toward the execution frame where the exception occurred) Execution frame object of the current level Line number where the exception occurred Instruction being executed in the current level\n\nGenerator Objects Generator objects are created when a generator function is invoked (see Chapter 6, “Functions and Functional Programming”).A generator function is defined whenever a function makes use of the special yield keyword.The generator object serves as both an iterator and a container for information about the generator function itself.The fol- lowing attributes and methods are available:\n\nAttribute g.gi_code\n\nDescription Code object for the generator function. Execution frame of the generator function. Integer indicating whether or not the generator function is currently running. Execute the function until the next yield statement and return the value (this method is called __next__ in Python 3). Sends a value to a generator. The passed value is returned by the yield expression in the generator that executes until the next yield expression is encoun- tered. send() returns the value passed to yield in this expression. Closes a generator by raising a GeneratorExit excep- tion in the generator function. This method executes auto- matically when a generator object is garbage-collected. g.throw(exc [,exc_value Raises an exception in a generator at the point of the [,exc_tb ]])\n\ng.gi_frame\n\ng.gi_running\n\ng.next()\n\ng.send(value)\n\ng.close()\n\ncurrent yield statement. excis the exception type, exc_valueis the exception value, and exc_tbis an optional traceback. If the resulting exception is caught and handled, returns the value passed to the next yield statement.\n\nSlice Objects Slice objects are used to represent slices given in extended slice syntax, such as a[i:j:stride], a[i:j, n:m], or a[..., i:j]. Slice objects are also created using the built-in slice([i,] j [,stride]) function.The following read-only attributes are available:\n\nF h Lib f L Bdff\n\n54\n\nChapter 3 Types and Objects\n\nAttribute s.start\n\ns.stop\n\ns.step\n\nDescription Lower bound of the slice; None if omitted Upper bound of the slice; None if omitted Stride of the slice; None if omitted\n\nSlice objects also provide a single method, s.indices(length).This function takes a length and returns a tuple (start,stop,stride) that indicates how the slice would be applied to a sequence of that length. Here’s an example:\n\ns = slice(10,20) # Slice object represents [10:20] s.indices(100) # Returns (10,20,1) —> [10:20] s.indices(15) # Returns (10,15,1) —> [10:15]\n\nEllipsis Object The Ellipsis object is used to indicate the presence of an ellipsis (...) in an index lookup [].There is a single object of this type, accessed through the built-in name Ellipsis. It has no attributes and evaluates as True. None of Python’s built-in types make use of Ellipsis, but it may be useful if you are trying to build advanced func- tionality into the indexing operator [] on your own objects.The following code shows how an Ellipsis gets created and passed into the indexing operator:\n\nclass Example(object):\n\ndef __getitem__(self,index):\n\nprint(index)\n\ne = Example() e[3, ..., 4] # Calls e.__getitem__((3, Ellipsis, 4))\n\nObject Behavior and Special Methods Objects in Python are generally classified according to their behaviors and the features that they implement. For example, all of the sequence types such as strings, lists, and tuples are grouped together merely because they all happen to support a common set of sequence operations such as s[n], len(s), etc.All basic interpreter operations are implemented through special object methods.The names of special methods are always preceded and followed by double underscores (__).These methods are automatically triggered by the interpreter as a program executes. For example, the operation x + yis mapped to an internal method, x.__add__(y), and an indexing operation, x[k], is mapped to x.__getitem__(k).The behavior of each data type depends entirely on the set of special methods that it implements.\n\nUser-defined classes can define new objects that behave like the built-in types simply\n\nby supplying an appropriate subset of the special methods described in this section. In addition, built-in types such as lists and dictionaries can be specialized (via inheritance) by redefining some of the special methods.\n\nThe next few sections describe the special methods associated with different cate-\n\ngories of interpreter features.\n\nObject Creation and Destruction The methods in Table 3.11 create, initialize, and destroy instances. __new__() is a class method that is called to create an instance.The __init__() method initializes the\n\nF h Lib f L Bdff\n\nObject Behavior and Special Methods\n\n55\n\nattributes of an object and is called immediately after an object has been newly created. The __del__() method is invoked when an object is about to be destroyed.This method is invoked only when an object is no longer in use. It’s important to note that the statement del xonly decrements an object’s reference count and doesn’t necessari- ly result in a call to this function. Further details about these methods can be found in Chapter 7.\n\nTable 3.11\n\nSpecial Methods for Object Creation and Destruction\n\nMethod\n\nDescription\n\n__new__(cls [,*args [,**kwargs]])\n\nA class method called to create a new instance\n\n__init__(self [,*args [,**kwargs]]) Called to initialize a new instance __del__(self) Called when an instance is being destroyed\n\nThe __new__() and __init__() methods are used together to create and initialize new instances.When an object is created by calling A(args), it is translated into the following steps:\n\nx = A.__new__(A,args) is isinstance(x,A): x.__init__(args)\n\nIn user-defined objects, it is rare to define __new__() or __del__(). __new__() is usually only defined in metaclasses or in user-defined objects that happen to inherit from one of the immutable types (integers, strings, tuples, and so on). __del__() is only defined in situations in which there is some kind of critical resource management issue, such as releasing a lock or shutting down a connection.\n\nObject String Representation The methods in Table 3.12 are used to create various string representations of an object.\n\nTable 3.12\n\nSpecial Methods for Object Representation\n\nMethod\n\nDescription\n\n__format__(self, format_spec) Creates a formatted representation __repr__(self) __str__(self)\n\nCreates a string representation of an object Creates a simple string representation\n\nThe __repr__() and __str__() methods create simple string representations of an object.The __repr__() method normally returns an expression string that can be eval- uated to re-create the object.This is also the method responsible for creating the output of values you see when inspecting variables in the interactive interpreter.This method is invoked by the built-in repr() function. Here’s an example of using repr() and eval() together:\n\na = [2,3,4,5] # Create a list s = repr(a) # s = '[2, 3, 4, 5]' b = eval(s) # Turns s back into a list\n\nF h Lib f L Bdff\n\n56\n\nChapter 3 Types and Objects\n\nIf a string expression cannot be created, the convention is for __repr__() to return a string of the form <...message...>, as shown here:\n\nf = open(\"foo\") a = repr(f) # a = \"<open file 'foo', mode 'r' at dc030>\"\n\nThe __str__() method is called by the built-in str() function and by functions relat- ed to printing. It differs from __repr__() in that the string it returns can be more concise and informative to the user. If this method is undefined, the __repr__() method is invoked.\n\nThe __format__() method is called by the format() function or the format() method of strings.The format_specargument is a string containing the format specifi- cation.This string is the same as the format_specargument to format(). For example:\n\nformat(x,\"spec\") # Calls x.__format__(\"spec\") \"x is {0:spec}\".format(x) # Calls x.__format__(\"spec\")\n\nThe syntax of the format specification is arbitrary and can be customized on an object- by-object basis. However, a standard syntax is described in Chapter 4.\n\nObject Comparison and Ordering Table 3.13 shows methods that can be used to perform simple tests on an object.The __bool__() method is used for truth-value testing and should return True or False. If undefined, the __len__() method is a fallback that is invoked to determine truth.The __hash__() method is defined on objects that want to work as keys in a dictionary. The value returned is an integer that should be identical for two objects that compare as equal. Furthermore, mutable objects should not define this method; any changes to an object will alter the hash value and make it impossible to locate an object on subse- quent dictionary lookups.\n\nTable 3.13\n\nSpecial Methods for Object Testing and Hashing\n\nMethod\n\nDescription\n\n__bool__(self)\n\n__hash__(self)\n\nReturns False or True for truth-value testing Computes an integer hash index\n\nObjects can implement one or more of the relational operators (<, >, <=, >=, ==, !=). Each of these methods takes two arguments and is allowed to return any kind of object, including a Boolean value, a list, or any other Python type. For instance, a numerical package might use this to perform an element-wise comparison of two matrices, returning a matrix with the results. If a comparison can’t be made, these functions may also raise an exception.Table 3.14 shows the special methods for comparison operators.\n\nTable 3.14 Methods for Comparisons\n\nMethod\n\nResult\n\n__lt__(self,other)\n\nself < other\n\n__le__(self,other)\n\nself <= other\n\n__gt__(self,other)\n\nself > other\n\n__ge__(self,other)\n\nself >= other\n\nF h Lib f L Bdff\n\nObject Behavior and Special Methods\n\n57\n\nTable 3.14\n\nContinued\n\nMethod\n\nResult\n\n__eq__(self,other)\n\nself == other\n\n__ne__(self,other)\n\nself != other\n\nIt is not necessary for an object to implement all of the operations in Table 3.14. However, if you want to be able to compare objects using == or use an object as a dic- tionary key, the __eq__() method should be defined. If you want to be able to sort objects or use functions such as min() or max(), then __lt__() must be minimally defined.\n\nType Checking The methods in Table 3.15 can be used to redefine the behavior of the type checking functions isinstance() and issubclass().The most common application of these methods is in defining abstract base classes and interfaces, as described in Chapter 7.\n\nTable 3.15 Methods for Type Checking\n\nMethod\n\nResult\n\n__instancecheck__(cls,object)\n\nisinstance(object, cls)\n\n__subclasscheck__(cls, sub)\n\nissubclass(sub, cls)\n\nAttribute Access The methods in Table 3.16 read, write, and delete the attributes of an object using the dot (.) operator and the del operator, respectively.\n\nTable 3.16\n\nSpecial Methods for Attribute Access\n\nMethod\n\nDescription\n\n__getattribute__(self,name)\n\n__getattr__(self, name)\n\nReturns the attribute self.name. Returns the attribute self.name if not found through normal attribute lookup or raise AttributeError.\n\n__setattr__(self, name, value) Sets the attribute self.name = value.\n\n__delattr__(self, name)\n\nOverrides the default mechanism. Deletes the attribute self.name.\n\nWhenever an attribute is accessed, the __getattribute__() method is always invoked. If the attribute is located, it is returned. Otherwise, the __getattr__() method is invoked.The default behavior of __getattr__() is to raise an AttributeError exception.The __setattr__() method is always invoked when setting an attribute, and the __delattr__() method is always invoked when deleting an attribute.\n\nF h Lib f L Bdff\n\n58\n\nChapter 3 Types and Objects\n\nAttribute Wrapping and Descriptors A subtle aspect of attribute manipulation is that sometimes the attributes of an object are wrapped with an extra layer of logic that interact with the get, set, and delete opera- tions described in the previous section.This kind of wrapping is accomplished by creat- ing a descriptor object that implements one or more of the methods in Table 3.17. Keep in mind that descriptions are optional and rarely need to be defined.\n\nTable 3.17\n\nSpecial Methods for Descriptor Object\n\nMethod\n\nDescription\n\n__get__(self,instance,cls)\n\nReturns an attribute value or raises AttributeError\n\n__set__(self,instance,value) Sets the attribute to value __delete__(self,instance)\n\nDeletes the attribute\n\nThe __get__(), __set__(), and __delete__() methods of a descriptor are meant to interact with the default implementation of __getattribute__(), __setattr__(), and __delattr__() methods on classes and types.This interaction occurs if you place an instance of a descriptor object in the body of a user-defined class. In this case, all access to the descriptor attribute will implicitly invoke the appropriate method on the descriptor object itself.Typically, descriptors are used to implement the low-level func- tionality of the object system including bound and unbound methods, class methods, static methods, and properties. Further examples appear in Chapter 7.\n\nSequence and Mapping Methods The methods in Table 3.18 are used by objects that want to emulate sequence and map- ping objects.\n\nTable 3.18 Methods for Sequences and Mappings\n\nMethod\n\nDescription\n\n__len__(self)\n\nReturns the length of self Returns self[key]\n\n__getitem__(self, key) __setitem__(self, key, value) Sets self[key] = value __delitem__(self, key)\n\nDeletes self[key] Returns True if objis in self; otherwise, returns False\n\n__contains__(self,obj)\n\nHere’s an example:\n\na = [1,2,3,4,5,6] len(a) # a.__len__() x = a[2] # x = a.__getitem__(2) a[1] = 7 # a.__setitem__(1,7) del a[2] # a.__delitem__(2) 5 in a # a.__contains__(5)\n\nThe __len__ method is called by the built-in len() function to return a nonnegative length.This function also determines truth values unless the __bool__() method has also been defined.\n\nF h Lib f L Bdff\n\nObject Behavior and Special Methods\n\n59\n\nFor manipulating individual items, the __getitem__() method can return an item\n\nby key value.The key can be any Python object but is typically an integer for sequences.The __setitem__() method assigns a value to an element.The __delitem__() method is invoked whenever the del operation is applied to a single element.The __contains__() method is used to implement the in operator. The slicing operations such as x = s[i:j] are also implemented using\n\n__getitem__(), __setitem__(), and __delitem__(). However, for slices, a special slice object is passed as the key.This object has attributes that describe the range of the slice being requested. For example:\n\na = [1,2,3,4,5,6] x = a[1:5] # x = a.__getitem__(slice(1,5,None)) a[1:3] = [10,11,12] # a.__setitem__(slice(1,3,None), [10,11,12]) del a[1:4] # a.__delitem__(slice(1,4,None))\n\nThe slicing features of Python are actually more powerful than many programmers realize. For example, the following variations of extended slicing are all supported and might be useful for working with multidimensional data structures such as matrices and arrays:\n\na = m[0:100:10] # Strided slice (stride=10) b = m[1:10, 3:20] # Multidimensional slice c = m[0:100:10, 50:75:5] # Multiple dimensions with strides m[0:5, 5:10] = n # extended slice assignment del m[:10, 15:] # extended slice deletion\n\nThe general format for each dimension of an extended slice is i:j[:stride], where strideis optional.As with ordinary slices, you can omit the starting or ending values for each part of a slice. In addition, the ellipsis (written as ...) is available to denote any number of trailing or leading dimensions in an extended slice:\n\na = m[..., 10:20] # extended slice access with Ellipsis m[10:20, ...] = n\n\nWhen using extended slices, the __getitem__(), __setitem__(), and __delitem__() methods implement access, modification, and deletion, respectively. However, instead of an integer, the value passed to these methods is a tuple containing a combination of slice or Ellipsis objects. For example,\n\na = m[0:10, 0:100:5, ...]\n\ninvokes __getitem__() as follows:\n\na = m.__getitem__((slice(0,10,None), slice(0,100,5), Ellipsis))\n\nPython strings, tuples, and lists currently provide some support for extended slices, which is described in Chapter 4. Special-purpose extensions to Python, especially those with a scientific flavor, may provide new types and objects with advanced support for extended slicing operations.\n\nIteration If an object, obj, supports iteration, it must provide a method, obj.__iter__(), that returns an iterator object.The iterator object iter, in turn, must implement a single method, iter.next() (or iter.__next__() in Python 3), that returns the next object or raises StopIteration to signal the end of iteration. Both of these methods are used by the implementation of the for statement as well as other operations that\n\nF h Lib f L Bdff\n\n60\n\nChapter 3 Types and Objects\n\nimplicitly perform iteration. For example, the statement for x in s is carried out by performing steps equivalent to the following:\n\n_iter = s.__iter__() while 1: try:\n\nx = _iter.next()(#_iter.__next__() in Python 3)\n\nexcept StopIteration:\n\nbreak\n\n# Do statements in body of for loop ...\n\nMathematical Operations Table 3.19 lists special methods that objects must implement to emulate numbers. Mathematical operations are always evaluated from left to right according the prece- dence rules described in Chapter 4; when an expression such as x + yappears, the interpreter tries to invoke the method x.__add__(y).The special methods beginning with rsupport operations with reversed operands.These are invoked only if the left operand doesn’t implement the specified operation. For example, if xin x + ydoesn’t support the __add__() method, the interpreter tries to invoke the method y.__radd__(x).\n\nTable 3.19 Methods for Mathematical Operations\n\nMethod\n\nResult\n\n__add__(self,other)\n\nself + other\n\n__sub__(self,other)\n\nself - other\n\n__mul__(self,other)\n\n__div__(self,other)\n\n__truediv__(self,other)\n\n__floordiv__(self,other)\n\nself * other self / other (Python 2 only) self / other (Python 3) self // other\n\n__mod__(self,other)\n\nself % other\n\n__divmod__(self,other)\n\ndivmod(self,other)\n\n__pow__(self,other [,modulo]) self ** other, pow(self, other,\n\nmodulo)\n\n__lshift__(self,other)\n\nself << other\n\n__rshift__(self,other)\n\nself >> other\n\n__and__(self,other)\n\nself & other\n\n__or__(self,other)\n\nself | other\n\n__xor__(self,other)\n\nself ^ other\n\n__radd__(self,other)\n\nother + self\n\n__rsub__(self,other)\n\nother - self\n\n__rmul__(self,other)\n\n__rdiv__(self,other)\n\n__rtruediv__(self,other)\n\n__rfloordiv__(self,other)\n\nother * self other / self(Python 2 only) other / self(Python 3) other // self\n\n__rmod__(self,other) __rdivmod__(self,other)\n\nother % self divmod(other,self)\n\nF h Lib f L Bdff\n\nObject Behavior and Special Methods\n\n61\n\nTable 3.19\n\nContinued\n\nMethod\n\nResult\n\n__rpow__(self,other)\n\nother ** self\n\n__rlshift__(self,other)\n\nother << self\n\n__rrshift__(self,other)\n\nother >> self\n\n__rand__(self,other)\n\nother & self\n\n__ror__(self,other)\n\nother | self\n\n__rxor__(self,other)\n\nother ^ self\n\n__iadd__(self,other)\n\nself += other\n\n__isub__(self,other)\n\nself -= other\n\n__imul__(self,other)\n\n__idiv__(self,other)\n\n__itruediv__(self,other)\n\n__ifloordiv__(self,other)\n\nself *= other self /= other (Python 2 only) self /= other (Python 3) self //= other\n\n__imod__(self,other)\n\nself %= other\n\n__ipow__(self,other)\n\nself **= other\n\n__iand__(self,other)\n\nself &= other\n\n__ior__(self,other)\n\nself |= other\n\n__ixor__(self,other)\n\nself ^= other\n\n__ilshift__(self,other)\n\nself <<= other\n\n__irshift__(self,other)\n\nself >>= other\n\n__neg__(self)\n\n–self\n\n__pos__(self)\n\n+self\n\n__abs__(self)\n\nabs(self)\n\n__invert__(self)\n\n~self\n\n__int__(self)\n\nint(self)\n\n__long__(self) __float__(self)\n\nlong(self)\n\nfloat(self)\n\n(Python 2 only)\n\n__complex__(self)\n\ncomplex(self)\n\nThe methods __iadd__(), __isub__(), and so forth are used to support in-place arithmetic operators such as a+=b and a-=b (also known as augmented assignment).A dis- tinction is made between these operators and the standard arithmetic methods because the implementation of the in-place operators might be able to provide certain cus- tomizations such as performance optimizations. For instance, if the selfparameter is not shared, the value of an object could be modified in place without having to allocate a newly created object for the result.\n\nThe three flavors of division operators—__div__(), __truediv__(), and\n\n__floordiv__()—are used to implement true division (/) and truncating division (//) operations.The reasons why there are three operations deal with a change in the semantics of integer division that started in Python 2.2 but became the default behavior in Python 3. In Python 2, the default behavior of Python is to map the / operator to __div__(). For integers, this operation truncates the result to an integer. In Python 3, division is mapped to __truediv__() and for integers, a float is returned.This latter\n\nF h Lib f L Bdff",
      "page_number": 64
    },
    {
      "number": 5,
      "title": "Segment 5 (pages 86-106)",
      "start_page": 86,
      "end_page": 106,
      "detection_method": "synthetic",
      "content": "62\n\nChapter 3 Types and Objects\n\nbehavior can be enabled in Python 2 as an optional feature by including the statement from __future__ import division in a program.\n\nThe conversion methods __int__(), __long__(), __float__(), and\n\n__complex__() convert an object into one of the four built-in numerical types.These methods are invoked by explicit type conversions such as int() and float(). However, these methods are not used to implicitly coerce types in mathematical opera- tions. For example, the expression 3 + xproduces a TypeError even if xis a user- defined object that defines __int__() for integer conversion.\n\nCallable Interface An object can emulate a function by providing the __call__(self [,*args [, **kwargs]]) method. If an object, x, provides this method, it can be invoked like a function.That is, x(arg1, arg2, ...) invokes x.__call__(self, arg1, arg2, ...). Objects that emulate functions can be useful for creating functors or proxies. Here is a simple example:\n\nclass DistanceFrom(object):\n\ndef __init__(self,origin): self.origin = origin def __call__(self, x):\n\nreturn abs(x - self.origin)\n\nnums = [1, 37, 42, 101, 13, 9, -20] nums.sort(key=DistanceFrom(10)) # Sort by distance from 10\n\nIn this example, the DistanceFrom class creates instances that emulate a single- argument function.These can be used in place of a normal function—for instance, in the call to sort() in the example.\n\nContext Management Protocol The with statement allows a sequence of statements to execute under the control of another object known as a context manager.The general syntax is as follows:\n\nwith context [ as var]:\n\nstatements\n\nThe contextobject shown here is expected to implement the methods shown in Table 3.20.The __enter__() method is invoked when the with statement executes.The value returned by this method is placed into the variable specified with the optional as varspecifier.The __exit__() method is called as soon as control-flow leaves from the block of statements associated with the with statement.As arguments, __exit__() receives the current exception type, value, and traceback if an exception has been raised. If no errors are being handled, all three values are set to None.\n\nTable 3.20\n\nSpecial Methods for Context Managers\n\nMethod\n\nDescription\n\n__enter__(self)\n\nCalled when entering a new context. The return value is placed in the variable listed with the as specifier to the with state- ment.\n\nF h Lib f L Bdff\n\nObject Behavior and Special Methods\n\n63\n\nTable 3.20\n\nContinued\n\nMethod\n\nDescription\n\n__exit__(self, type, value, tb)\n\nCalled when leaving a context. If an excep- tion occurred, type, value, and tbhave the exception type, value, and traceback information. The primary use of the context management interface is to allow for simpli- fied resource control on objects involving system state such as open files, network connections, and locks. By implementing this interface, an object can safely clean up resources when execution leaves a context in which an object is being used. Further details are found in Chapter 5, “Program Structure and Control Flow.”\n\nObject Inspection and dir() The dir() function is commonly used to inspect objects.An object can supply the list of names returned by dir() by implementing __dir__(self). Defining this makes it easier to hide the internal details of objects that you don’t want a user to directly access. However, keep in mind that a user can still inspect the underlying __dict__ attribute of instances and classes to see everything that is defined.\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n4\n\nOperators and Expressions\n\nThis chapter describes Python’s built-in operators, expressions, and evaluation rules.\n\nAlthough much of this chapter describes Python’s built-in types, user-defined objects can easily redefine any of the operators to provide their own behavior.\n\nOperations on Numbers The following operations can be applied to all numeric types:\n\nOperation x + y\n\nx - y\n\nx * y\n\nx / y\n\nx // y\n\nx ** y\n\nx % y\n\n–x\n\nDescription Addition Subtraction Multiplication Division Truncating division Power (xy) Modulo (x mod y) Unary minus Unary plus\n\n+x\n\nThe truncating division operator (//, also known as floor division) truncates the result to an integer and works with both integers and floating-point numbers. In Python 2, the true division operator (/) also truncates the result to an integer if the operands are inte- gers.Therefore, 7/4 is 1, not 1.75. However, this behavior changes in Python 3, where division produces a floating-point result.The modulo operator returns the remainder of the division x // y. For example, 7 % 4 is 3. For floating-point numbers, the modulo operator returns the floating-point remainder of x // y, which is x – (x // y) * y. For complex numbers, the modulo (%) and truncating division operators (//) are invalid.\n\nThe following shifting and bitwise logical operators can be applied only to integers:\n\nOperation x << y\n\nx >> y\n\nx & y\n\nx | y\n\nx ^ y\n\nDescription Left shift Right shift Bitwise and Bitwise or Bitwise xor (exclusive or) Bitwise negation\n\n~x\n\nF h Lib f L Bdff\n\n66\n\nChapter 4 Operators and Expressions\n\nThe bitwise operators assume that integers are represented in a 2’s complement binary representation and that the sign bit is infinitely extended to the left. Some care is required if you are working with raw bit-patterns that are intended to map to native integers on the hardware.This is because Python does not truncate the bits or allow val- ues to overflow—instead, the result will grow arbitrarily large in magnitude.\n\nIn addition, you can apply the following built-in functions to all the numerical\n\ntypes:\n\nFunction abs(x)\n\nDescription Absolute value Returns (x // y, x % y)\n\ndivmod(x,y) pow(x,y [,modulo]) Returns (x ** y) % modulo round(x,[n])\n\nRounds to the nearest multiple of 10-n (floating-point numbers only)\n\nThe abs() function returns the absolute value of a number.The divmod() function returns the quotient and remainder of a division operation and is only valid on non- complex numbers.The pow() function can be used in place of the ** operator but also supports the ternary power-modulo function (often used in cryptographic algorithms). The round() function rounds a floating-point number, x, to the nearest multiple of 10 to the power minus n. If nis omitted, it’s set to 0. If xis equally close to two multiples, Python 2 rounds to the nearest multiple away from zero (for example, 0.5 is rounded to 1.0 and -0.5 is rounded to -1.0). One caution here is that Python 3 rounds equally close values to the nearest even multiple (for example, 0.5 is rounded to 0.0, and 1.5 is rounded to 2.0).This is a subtle portability issue for mathematical programs being port- ed to Python 3.\n\nThe following comparison operators have the standard mathematical interpretation\n\nand return a Boolean value of True for true, False for false:\n\nOperation x < y\n\nx > y\n\nx == y\n\nx != y\n\nx >= y\n\nx <= y\n\nDescription Less than Greater than Equal to Not equal to Greater than or equal to Less than or equal to\n\nComparisons can be chained together, such as in w < x < y < z. Such expressions are evaluated as w < x and x < y and y < z. Expressions such as x < y > zare legal but are likely to confuse anyone reading the code (it’s important to note that no com- parison is made between xand zin such an expression). Comparisons involving com- plex numbers are undefined and result in a TypeError.\n\nOperations involving numbers are valid only if the operands are of the same type. For built-in numbers, a coercion operation is performed to convert one of the types to the other, as follows:\n\n1. If either operand is a complex number, the other operand is converted to a com- plex number.\n\nF h Lib f L Bdff\n\nOperations on Sequences\n\n67\n\n2. If either operand is a floating-point number, the other is converted to a float. 3. Otherwise, both numbers must be integers and no conversion is performed.\n\nFor user-defined objects, the behavior of expressions involving mixed operands depends on the implementation of the object.As a general rule, the interpreter does not try to perform any kind of implicit type conversion.\n\nOperations on Sequences The following operators can be applied to sequence types, including strings, lists, and tuples:\n\nOperation s + r s * n, n * s v1,v2…, vn= s s[i]\n\ns[i:j]\n\ns[i:j:stride] x in s, x not in s for x in s:\n\nall(s)\n\nany(s)\n\nlen(s)\n\nmin(s)\n\nmax(s)\n\nDescription Concatenation Makes ncopies of s, where nis an integer Variable unpacking Indexing Slicing Extended slicing Membership Iteration Returns True if all items in sare true. Returns True if any item in sis true. Length Minimum item in s Maximum item in s Sum of items with an optional initial value\n\nsum(s [, initial])\n\nThe + operator concatenates two sequences of the same type.The s * noperator makes ncopies of a sequence. However, these are shallow copies that replicate elements by reference only. For example, consider the following code:\n\n>>> a = [3,4,5] >>> b = [a] >>> c = 4*b >>> c [[3, 4, 5], [3, 4, 5], [3, 4, 5], [3, 4, 5]] >>> a[0] = -7 >>> c [[-7, 4, 5], [-7, 4, 5], [-7, 4, 5], [-7, 4, 5]] >>>\n\nNotice how the change to a modified every element of the list c. In this case, a reference to the list a was placed in the list b.When b was replicated, four additional references to a were created. Finally, when a was modified, this change was propagated to all the other “copies” of a.This behavior of sequence multiplication is often unexpected and not the intent of the programmer. One way to work around the problem is to manually construct the replicated sequence by duplicating the contents of a. Here’s an example:\n\na = [ 3, 4, 5 ] c = [list(a) for j in range(4)] # list() makes a copy of a list\n\nThe copy module in the standard library can also be used to make copies of objects.\n\nF h Lib f L Bdff\n\n68\n\nChapter 4 Operators and Expressions\n\nAll sequences can be unpacked into a sequence of variable names. For example:\n\nitems = [ 3, 4, 5 ] x,y,z = items # x = 3, y = 4, z = 5\n\nletters = \"abc\" x,y,z = letters # x = 'a', y = 'b', z = 'c'\n\ndatetime = ((5, 19, 2008), (10, 30, \"am\")) (month,day,year),(hour,minute,am_pm) = datetime\n\nWhen unpacking values into variables, the number of variables must exactly match the number of items in the sequence. In addition, the structure of the variables must match that of the sequence. For example, the last line of the example unpacks values into six variables, organized into two 3-tuples, which is the structure of the sequence on the right. Unpacking sequences into variables works with any kind of sequence, including those created by iterators and generators.\n\nThe indexing operator s[n] returns the nth object from a sequence in which s[0]\n\nis the first object. Negative indices can be used to fetch characters from the end of a sequence. For example, s[-1] returns the last item. Otherwise, attempts to access ele- ments that are out of range result in an IndexError exception.\n\nThe slicing operator s[i:j] extracts a subsequence from sconsisting of the ele- ments with index k, where i <= k < j. Both iand jmust be integers or long inte- gers. If the starting or ending index is omitted, the beginning or end of the sequence is assumed, respectively. Negative indices are allowed and assumed to be relative to the end of the sequence. If ior jis out of range, they’re assumed to refer to the beginning or end of a sequence, depending on whether their value refers to an element before the first item or after the last item, respectively.\n\nThe slicing operator may be given an optional stride, s[i:j:stride], that causes the slice to skip elements. However, the behavior is somewhat more subtle. If a stride is supplied, iis the starting index; jis the ending index; and the produced subsequence is the elements s[i], s[i+stride], s[i+2*stride], and so forth until index jis reached (which is not included).The stride may also be negative. If the starting index i is omitted, it is set to the beginning of the sequence if strideis positive or the end of the sequence if strideis negative. If the ending index jis omitted, it is set to the end of the sequence if strideis positive or the beginning of the sequence if strideis negative. Here are some examples:\n\na = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n\nb = a[::2] # b = [0, 2, 4, 6, 8 ] c = a[::-2] # c = [9, 7, 5, 3, 1 ] d = a[0:5:2] # d = [0,2] e = a[5:0:-2] # e = [5,3,1] f = a[:5:1] # f = [0,1,2,3,4] g = a[:5:-1] # g = [9,8,7,6] h = a[5::1] # h = [5,6,7,8,9] i = a[5::-1] # i = [5,4,3,2,1,0] j = a[5:0:-1] # j = [5,4,3,2,1]\n\nThe x in soperator tests to see whether the object xis in the sequence sand returns True or False. Similarly, the x not in soperator tests whether xis not in the sequence s. For strings, the in and not in operators accept subtrings. For example,\n\nF h Lib f L Bdff\n\nOperations on Sequences\n\n69\n\n'hello' in 'hello world' produces True. It is important to note that the in oper- ator does not support wildcards or any kind of pattern matching. For this, you need to use a library module such as the re module for regular expression patterns.\n\nThe for x in soperator iterates over all the elements of a sequence and is\n\ndescribed further in Chapter 5, “Program Structure and Control Flow.” len(s) returns the number of elements in a sequence. min(s) and max(s) return the minimum and maximum values of a sequence, respectively, although the result may only make sense if the elements can be ordered with respect to the < operator (for example, it would make little sense to find the maximum value of a list of file objects). sum(s) sums all of the items in sbut usually works only if the items represent numbers.An optional initial value can be given to sum().The type of this value usually determines the result. For example, if you used sum(items, decimal.Decimal(0)), the result would be a Decimal object (see more about the decimal module in Chapter 14,“Mathematics”). Strings and tuples are immutable and cannot be modified after creation. Lists can be\n\nmodified with the following operators:\n\nOperation s[i] = x\n\ns[i:j] = r\n\ns[i:j:stride] = r\n\ndel s[i]\n\ndel s[i:j]\n\nDescription Index assignment Slice assignment Extended slice assignment Deletes an element Deletes a slice Deletes an extended slice\n\ndel s[i:j:stride]\n\nThe s[i] = xoperator changes element iof a list to refer to object x, increasing the reference count of x. Negative indices are relative to the end of the list, and attempts to assign a value to an out-of-range index result in an IndexError exception.The slicing assignment operator s[i:j] = rreplaces element k, where i <= k < j, with ele- ments from sequence r. Indices may have the same values as for slicing and are adjusted to the beginning or end of the list if they’re out of range. If necessary, the sequence sis expanded or reduced to accommodate all the elements in r. Here’s an example:\n\na = [1,2,3,4,5] a[1] = 6 # a = [1,6,3,4,5] a[2:4] = [10,11] # a = [1,6,10,11,5] a[3:4] = [-1,-2,-3] # a = [1,6,10,-1,-2,-3,5] a[2:] = [0] # a = [1,6,0]\n\nSlicing assignment may be supplied with an optional stride argument. However, the behavior is somewhat more restricted in that the argument on the right side must have exactly the same number of elements as the slice that’s being replaced. Here’s an example:\n\na = [1,2,3,4,5] a[1::2] = [10,11] # a = [1,10,3,11,5] a[1::2] = [30,40,50] # ValueError. Only two elements in slice on left\n\nThe del s[i] operator removes element ifrom a list and decrements its reference count. del s[i:j] removes all the elements in a slice.A stride may also be supplied, as in del s[i:j:stride].\n\nF h Lib f L Bdff\n\n70\n\nChapter 4 Operators and Expressions\n\nSequences are compared using the operators <, >, <=, >=, ==, and !=.When compar- ing two sequences, the first elements of each sequence are compared. If they differ, this determines the result. If they’re the same, the comparison moves to the second element of each sequence.This process continues until two different elements are found or no more elements exist in either of the sequences. If the end of both sequences is reached, the sequences are considered equal. If ais a subsequence of b, then a < b.\n\nStrings are compared using lexicographical ordering. Each character is assigned a unique numerical index determined by the character set (such as ASCII or Unicode).A character is less than another character if its index is less. One caution concerning char- acter ordering is that the preceding simple comparison operators are not related to the character ordering rules associated with locale or language settings.Thus, you would not use these operations to order strings according to the standard conventions of a foreign language (see the unicodedata and locale modules for more information).\n\nAnother caution, this time involving strings. Python has two types of string data: byte strings and Unicode strings. Byte strings differ from their Unicode counterpart in that they are usually assumed to be encoded, whereas Unicode strings represent raw unencoded character values. Because of this, you should never mix byte strings and Unicode together in expressions or comparisons (such as using + to concatenate a byte string and Unicode string or using == to compare mixed strings). In Python 3, mixing string types results in a TypeError exception, but Python 2 attempts to perform an implicit promotion of byte strings to Unicode.This aspect of Python 2 is widely con- sidered to be a design mistake and is often a source of unanticipated exceptions and inexplicable program behavior. So, to keep your head from exploding, don’t mix string types in sequence operations.\n\nString Formatting The modulo operator (s % d) produces a formatted string, given a format string, s, and a collection of objects in a tuple or mapping object (dictionary) d.The behavior of this operator is similar to the C sprintf() function.The format string contains two types of objects: ordinary characters (which are left unmodified) and conversion specifiers, each of which is replaced with a formatted string representing an element of the associ- ated tuple or mapping. If dis a tuple, the number of conversion specifiers must exactly match the number of objects in d. If dis a mapping, each conversion specifier must be associated with a valid key name in the mapping (using parentheses, as described short- ly). Each conversion specifier starts with the % character and ends with one of the con- version characters shown in Table 4.1.\n\nTable 4.1\n\nString Formatting Conversions\n\nCharacter Output Format\n\nd,i\n\nu\n\no\n\nx\n\nX\n\nf e\n\nDecimal integer or long integer. Unsigned integer or long integer. Octal integer or long integer. Hexadecimal integer or long integer. Hexadecimal integer (uppercase letters). Floating point as [-]m.dddddd. Floating point as [-]m.dddddde±xx.\n\nF h Lib f L Bdff\n\nString Formatting\n\n71\n\nTable 4.1\n\nContinued\n\nCharacter Output Format\n\nE\n\ng,G\n\ns\n\nr\n\nc\n\n%\n\nFloating point as [-]m.ddddddE±xx. Use %e or %E for exponents less than –4 or greater than the precision; oth- erwise, use %f. String or any object. The formatting code uses str() to generate strings. Produces the same string as produced by repr(). Single character. Literal %.\n\nBetween the % character and the conversion character, the following modifiers may appear, in this order:\n\n1. A key name in parentheses, which selects a specific item out of the mapping object. If no such element exists, a KeyError exception is raised.\n\n2. One or more of the following:\n\nn - sign, indicating left alignment. By default, values are right-aligned. n + sign, indicating that the numeric sign should be included (even if posi-\n\ntive).\n\nn 0, indicating a zero fill.\n\n3. A number specifying the minimum field width.The converted value will be printed in a field at least this wide and padded on the left (or right if the – flag is given) to make up the field width.\n\n4. A period separating the field width from a precision. 5. A number specifying the maximum number of characters to be printed from a string, the number of digits following the decimal point in a floating-point num- ber, or the minimum number of digits for an integer.\n\nIn addition, the asterisk (*) character may be used in place of a number in any width field. If present, the width will be read from the next item in the tuple.\n\nThe following code illustrates a few examples:\n\na = 42 b = 13.142783 c = \"hello\" d = {'x':13, 'y':1.54321, 'z':'world'} e = 5628398123741234\n\nr = \"a is %d\" % a # r = \"a is 42\" r = \"%10d %f\" % (a,b) # r = \" 42 13.142783\" r = \"%+010d %E\" % (a,b) # r = \"+000000042 1.314278E+01\" r = \"%(x)-10d %(y)0.3g\" % d # r = \"13 1.54\" r = \"%0.4s %s\" % (c, d['z']) # r = \"hell world\" r = \"%*.*f\" % (5,3,b) # r = \"13.143\" r = \"e = %d\" % e # r = \"e = 5628398123741234\"\n\nWhen used with a dictionary, the string formatting operator % is often used to mimic the string interpolation feature often found in scripting languages (e.g., expansion of\n\nF h Lib f L Bdff\n\n72\n\nChapter 4 Operators and Expressions\n\n$var symbols in strings). For example, if you have a dictionary of values, you can expand those values into fields within a formatted string as follows:\n\nstock = {\n\n'name' : 'GOOG', 'shares' : 100, 'price' : 490.10 }\n\nr = \"%(shares)d of %(name)s at %(price)0.2f\" % stock # r = \"100 shares of GOOG at 490.10\"\n\nThe following code shows how to expand the values of currently defined variables within a string.The vars() function returns a dictionary containing all of the variables defined at the point at which vars() is called.\n\nname = \"Elwood\" age = 41 r = \"%(name)s is %(age)s years old\" % vars()\n\nAdvanced String Formatting A more advanced form of string formatting is available using the s.format(*args, *kwargs) method on strings.This method collects an arbitrary collection of positional and keyword arguments and substitutes their values into placeholders embedded in s.A placeholder of the form '{n}', where nis a number, gets replaced by positional argu- ment nsupplied to format().A placeholder of the form '{name}' gets replaced by keyword argument namesupplied to format. Use '{{' to output a single '{' and '}}' to output a single '}'. For example:\n\nr = \"{0} {1} {2}\".format('GOOG',100,490.10) r = \"{name} {shares} {price}\".format(name='GOOG',shares=100,price=490.10) r = \"Hello {0}, your age is {age}\".format(\"Elwood\",age=47) r = \"Use {{ and }} to output single curly braces\".format()\n\nWith each placeholder, you can additionally perform both indexing and attribute lookups. For example, in '{name[n]}' where nis an integer, a sequence lookup is per- formed and in '{name[key]}' where keyis a non-numeric string, a dictionary lookup of the form name['key'] is performed. In '{name.attr}', an attribute lookup is per- formed. Here are some examples:\n\nstock = { 'name' : 'GOOG', 'shares' : 100, 'price' : 490.10 }\n\nr = \"{0[name]} {0[shares]} {0[price]}\".format(stock)\n\nx = 3 + 4j r = \"{0.real} {0.imag}\".format(x)\n\nIn these expansions, you are only allowed to use names.Arbitrary expressions, method calls, and other operations are not supported.\n\nYou can optionally specify a format specifier that gives more precise control over the output.This is supplied by adding an optional format specifier to each placeholder using a colon (:), as in '{place:format_spec}'. By using this specifier, you can specify col- umn widths, decimal places, and alignment. Here is an example:\n\nr = \"{name:8} {shares:8d} {price:8.2f}\".format (name=\"GOOG\",shares=100,price=490.10)\n\nF h Lib f L Bdff\n\nAdvanced String Formatting\n\n73\n\nThe general format of a specifier is [[fill[align]][sign][0][width] [.precision][type] where each part enclosed in [] is optional.The widthspecifier specifies the minimum field width to use, and the alignspecifier is one of '<', '>’, or '^' for left, right, and centered alignment within the field.An optional fill character fillis used to pad the space. For example:\n\nname = \"Elwood\" r = \"{0:<10}\".format(name) # r = 'Elwood ' r = \"{0:>10}\".format(name) # r = ' Elwood' r = \"{0:^10}\".format(name) # r = ' Elwood ' r = \"{0:=^10}\".format(name) # r = '==Elwood=='\n\nThe typespecifier indicates the type of data.Table 4.2 lists the supported format codes. If not supplied, the default format code is 's' for strings, 'd' for integers, and 'f' for floats.\n\nTable 4.2\n\nAdvanced String Formatting Type Specifier Codes\n\nCharacter Output Format\n\nd\n\nb\n\no\n\nx\n\nX\n\nf,F\n\ne\n\nE\n\ng,G\n\nn\n\n%\n\ns\n\nDecimal integer or long integer. Binary integer or long integer. Octal integer or long integer. Hexadecimal integer or long integer. Hexadecimal integer (uppercase letters). Floating point as [-]m.dddddd. Floating point as [-]m.dddddde±xx. Floating point as [-]m.ddddddE±xx. Use e or E for exponents less than –4 or greater than the precision; other- wise, use f. Same as g except that the current locale setting determines the decimal point character. Multiplies a number by 100 and displays it using f format followed by a % sign. String or any object. The formatting code uses str() to generate strings. Single character.\n\nc\n\nThe signpart of a format specifier is one of '+', '-', or ' '.A '+' indicates that a leading sign should be used on all numbers. '-' is the default and only adds a sign character for negative numbers.A ' ' adds a leading space to positive numbers.The precisionpart of the specifier supplies the number of digits of accuracy to use for decimals. If a leading '0' is added to the field width for numbers, numeric values are padded with leading 0s to fill the space. Here are some examples of formatting different kinds of numbers:\n\nx = 42 r = '{0:10d}'.format(x) # r = ' 42' r = '{0:10x}'.format(x) # r = ' 2a' r = '{0:10b}'.format(x) # r = ' 101010' r = '{0:010b}'.format(x) # r = '0000101010'\n\ny = 3.1415926 r = '{0:10.2f}'.format(y) # r = ' 3.14'\n\nF h Lib f L Bdff\n\n74\n\nChapter 4 Operators and Expressions\n\nr = '{0:10.2e}'.format(y) # r = ' 3.14e+00' r = '{0:+10.2f}'.format(y) # r = ' +3.14' r = '{0:+010.2f}'.format(y) # r = '+000003.14' r = '{0:+10.2%}'.format(y) # r = ' +314.16%'\n\nParts of a format specifier can optionally be supplied by other fields supplied to the for- mat function.They are accessed using the same syntax as normal fields in a format string. For example:\n\ny = 3.1415926 r = '{0:{width}.{precision}f}'.format(y,width=10,precision=3) r = '{0:{1}.{2}f}'.format(y,10,3)\n\nThis nesting of fields can only be one level deep and can only occur in the format specifier portion. In addition, the nested values cannot have any additional format speci- fiers of their own.\n\nOne caution on format specifiers is that objects can define their own custom set of\n\nspecifiers. Underneath the covers, advanced string formatting invokes the special method __format__(self, format_spec) on each field value.Thus, the capabilities of the format() operation are open-ended and depend on the objects to which it is applied. For example, dates, times, and other kinds of objects may define their own for- mat codes.\n\nIn certain cases, you may want to simply format the str() or repr() representation\n\nof an object, bypassing the functionality implemented by its __format__() method. To do this, you can add the '!s' or '!r' modifier before the format specifier. For example:\n\nname = \"Guido\" r = '{0!r:^20}'.format(name) # r = \" 'Guido' \"\n\nOperations on Dictionaries Dictionaries provide a mapping between names and objects.You can apply the following operations to dictionaries:\n\nOperation x = d[k]\n\nd[k] = x\n\ndel d[k]\n\nk in d\n\nlen(d)\n\nDescription Indexing by key Assignment by key Deletes an item by key Tests for the existence of a key Number of items in the dictionary\n\nKey values can be any immutable object, such as strings, numbers, and tuples. In addi- tion, dictionary keys can be specified as a comma-separated list of values, like this:\n\nd = { } d[1,2,3] = \"foo\" d[1,0,3] = \"bar\"\n\nIn this case, the key values represent a tuple, making the preceding assignments identical to the following:\n\nd[(1,2,3)] = \"foo\" d[(1,0,3)] = \"bar\"\n\nF h Lib f L Bdff\n\nAugmented Assignment\n\n75\n\nOperations on Sets The set and frozenset type support a number of common set operations:\n\nOperation s | t\n\ns & t\n\ns – t\n\ns ^ t\n\nlen(s) max(s) min(s)\n\nDescription Union of sand t Intersection of sand t Set difference Symmetric difference Number of items in the set Maximum value Minimum value\n\nThe result of union, intersection, and difference operations will have the same type as the left-most operand. For example, if sis a frozenset, the result will be a frozenset even if t is a set.\n\nAugmented Assignment Python provides the following set of augmented assignment operators:\n\nOperation x += y\n\nDescription x = x + y\n\nx -= y\n\nx = x - y\n\nx *= y\n\nx = x * y\n\nx /= y\n\nx = x / y\n\nx //= y\n\nx = x // y\n\nx **= y\n\nx = x ** y\n\nx %= y\n\nx = x % y\n\nx &= y\n\nx = x & y\n\nx |= y\n\nx = x | y\n\nx ^= y\n\nx = x ^ y\n\nx >>= y\n\nx = x >> y\n\nx <<= y\n\nx = x << y\n\nThese operators can be used anywhere that ordinary assignment is used. Here’s an example:\n\na = 3 b = [1,2] c = \"Hello %s %s\" a += 1 # a = 4 b[1] += 10 # b = [1, 12] c %= (\"Monty\", \"Python\") # c = \"Hello Monty Python\"\n\nAugmented assignment doesn’t violate mutability or perform in-place modification of objects.Therefore, writing x += ycreates an entirely new object xwith the value x + y. User-defined classes can redefine the augmented assignment operators using the spe- cial methods described in Chapter 3,“Types and Objects.”\n\nF h Lib f L Bdff\n\n76\n\nChapter 4 Operators and Expressions\n\nThe Attribute (.) Operator The dot (.) operator is used to access the attributes of an object. Here’s an example:\n\nfoo.x = 3 print foo.y a = foo.bar(3,4,5)\n\nMore than one dot operator can appear in a single expression, such as in foo.y.a.b. The dot operator can also be applied to the intermediate results of functions, as in a = foo.bar(3,4,5).spam.\n\nUser-defined classes can redefine or customize the behavior of (.). More details are\n\nfound in Chapter 3 and Chapter 7,“Classes and Object-Oriented Programming.”\n\nThe Function Call () Operator The f(args) operator is used to make a function call on f. Each argument to a func- tion is an expression. Prior to calling the function, all of the argument expressions are fully evaluated from left to right.This is sometimes known as applicative order evaluation. It is possible to partially evaluate function arguments using the partial() function\n\nin the functools module. For example:\n\ndef foo(x,y,z):\n\nreturn x + y + z\n\nfrom functools import partial f = partial(foo,1,2) # Supply values to x and y arguments of foo f(3) # Calls foo(1,2,3), result is 6\n\nThe partial() function evaluates some of the arguments to a function and returns an object that you can call to supply the remaining arguments at a later point. In the previ- ous example, the variable f represents a partially evaluated function where the first two arguments have already been calculated.You merely need to supply the last remaining argument value for the function to execute. Partial evaluation of function arguments is closely related to a process known as currying, a mechanism by which a function taking multiple arguments such as f(x,y) is decomposed into a series of functions each taking only one argument (for example, you partially evaluate f by fixing x to get a new func- tion to which you give values of y to produce a result).\n\nConversion Functions Sometimes it’s necessary to perform conversions between the built-in types.To convert between types, you simply use the type name as a function. In addition, several built-in functions are supplied to perform special kinds of conversions.All of these functions return a new object representing the converted value.\n\nFunction\n\nDescription\n\nint(x [,base])\n\nfloat(x)\n\ncomplex(real [,imag])\n\nstr(x)\n\nConverts xto an integer. basespecifies the base if x is a string. Converts xto a floating-point number. Creates a complex number. Converts object xto a string representation.\n\nF h Lib f L Bdff\n\nBoolean Expressions and Truth Values\n\n77\n\nFunction\n\nDescription\n\nrepr(x) format(x [,format_spec]) Converts object xto a formatted string. Evaluates a string and returns an object. eval(str) Converts sto a tuple. Converts sto a list. Converts sto a set. Creates a dictionary. dmust be a sequence of (key,value) tuples. Converts sto a frozen set. Converts an integer to a character. Converts an integer to a Unicode character (Python 2 only). Converts a single character to its integer value. Converts an integer to a hexadecimal string. Converts an integer to a binary string. Converts an integer to an octal string.\n\nConverts object xto an expression string.\n\ntuple(s)\n\nlist(s)\n\nset(s)\n\ndict(d)\n\nfrozenset(s)\n\nchr(x)\n\nunichr(x)\n\nord(x)\n\nhex(x)\n\nbin(x)\n\noct(x)\n\nNote that the str() and repr() functions may return different results. repr() typically creates an expression string that can be evaluated with eval() to re-create the object. On the other hand, str() produces a concise or nicely formatted representation of the object (and is used by the print statement).The format(x, [format_spec]) function produces the same output as that produced by the advanced string formatting operations but applied to a single object x.As input, it accepts an optional format_spec, which is a string containing the formatting code.The ord() function returns the integer ordinal value of a character. For Unicode, this value will be the integer code point.The chr() and unichr() functions convert integers back into characters.\n\nTo convert strings back into numbers, use the int(), float(), and complex() functions.The eval() function can also convert a string containing a valid expression to an object. Here’s an example:\n\na = int(\"34\") # a = 34 b = long(\"0xfe76214\", 16) # b = 266822164L (0xfe76214L) b = float(\"3.1415926\") # b = 3.1415926 c = eval(\"3, 5, 6\") # c = (3,5,6)\n\nIn functions that create containers (list(), tuple(), set(), and so on), the argument may be any object that supports iteration used to generate all the items used to populate the object that’s being created.\n\nBoolean Expressions and Truth Values The and, or, and not keywords can form Boolean expressions.The behavior of these operators is as follows:\n\nOperator x or y x and y\n\nnot x\n\nDescription If xis false, return y; otherwise, return x. If xis false, return x; otherwise, return y. If xis false, return 1; otherwise, return 0.\n\nF h Lib f L Bdff\n\n78\n\nChapter 4 Operators and Expressions\n\nWhen you use an expression to determine a true or false value, True, any nonzero number, nonempty string, list, tuple, or dictionary is taken to be true. False; zero; None; and empty lists, tuples, and dictionaries evaluate as false. Boolean expressions are evaluat- ed from left to right and consume the right operand only if it’s needed to determine the final value. For example, a and b evaluates b only if a is true.This is sometimes known as “short-circuit” evaluation.\n\nObject Equality and Identity The equality operator (x == y) tests the values of xand yfor equality. In the case of lists and tuples, all the elements are compared and evaluated as true if they’re of equal value. For dictionaries, a true value is returned only if xand yhave the same set of keys and all the objects with the same key have equal values.Two sets are equal if they have the same elements, which are compared using equality (==).\n\nThe identity operators (x is yand x is not y) test two objects to see whether they refer to the same object in memory. In general, it may be the case that x == y, but x is not y.\n\nComparison between objects of noncompatible types, such as a file and a floating-\n\npoint number, may be allowed, but the outcome is arbitrary and may not make any sense. It may also result in an exception depending on the type.\n\nOrder of Evaluation Table 4.3 lists the order of operation (precedence rules) for Python operators.All opera- tors except the power (**) operator are evaluated from left to right and are listed in the table from highest to lowest precedence.That is, operators listed first in the table are evaluated before operators listed later. (Note that operators included together within subsections, such as x * y, x / y, x / y, and x % y, have equal precedence.)\n\nTable 4.3 Order of Evaluation (Highest to Lowest)\n\nOperator\n\nName\n\nTuple, list, and dictionary creation Indexing and slicing Attributes Function calls Unary operators Power (right associative)\n\n(...), [...], {...}\n\ns[i], s[i:j]\n\ns.attr\n\nf(...)\n\n+x, -x, ~x\n\nx ** y x * y, x / y, x // y, x % y Multiplication, division, floor division, modulo x + y, x - y\n\nAddition, subtraction Bit-shifting Bitwise and Bitwise exclusive or Bitwise or Comparison, identity, and sequence member- ship tests\n\nx << y, x >> y\n\nx & y\n\nx ^ y\n\nx | y\n\nx < y, x <= y,\n\nx > y, x >= y,\n\nx == y, x != y\n\nF h Lib f L Bdff\n\nOrder of Evaluation\n\n79\n\nTable 4.3\n\nContinued\n\nOperator\n\nName\n\nx is y, x is not y\n\nx in s, x not in s\n\nnot x\n\nx and y\n\nx or y\n\nlambda args: expr\n\nLogical negation Logical and Logical or Anonymous function\n\nThe order of evaluation is not determined by the types of xand yin Table 4.3. So, even though user-defined objects can redefine individual operators, it is not possible to cus- tomize the underlying evaluation order, precedence, and associativity rules.\n\nConditional Expressions A common programming pattern is that of conditionally assigning a value based on the result of an expression. For example:\n\nif a <= b:\n\nminvalue = a\n\nelse:\n\nminvalue = b\n\nThis code can be shortened using a conditional expression. For example:\n\nminvalue = a if a <=b else b\n\nIn such expressions, the condition in the middle is evaluated first.The expression to the left of the if is then evaluated if the result is True. Otherwise, the expression after the else is evaluated.\n\nConditional expressions should probably be used sparingly because they can lead to confusion (especially if they are nested or mixed with other complicated expressions). However, one particularly useful application is in list comprehensions and generator expressions. For example:\n\nvalues = [1, 100, 45, 23, 73, 37, 69 ] clamped = [x if x < 50 else 50 for x in values] print(clamped) # [1, 50, 45, 23, 50, 37, 50]\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n5\n\nProgram Structure and Control Flow\n\nThis chapter covers the details of program structure and control flow.Topics include\n\nconditionals, iteration, exceptions, and context managers.\n\nProgram Structure and Execution Python programs are structured as a sequence of statements.All language features, including variable assignment, function definitions, classes, and module imports, are statements that have equal status with all other statements. In fact, there are no “special” statements, and every statement can be placed anywhere in a program. For example, this code defines two different versions of a function:\n\nif debug:\n\ndef square(x):\n\nif not isinstance(x,float):\n\nraise TypeError(\"Expected a float\")\n\nreturn x * x\n\nelse:\n\ndef square(x):\n\nreturn x * x\n\nWhen loading source files, the interpreter always executes every statement in order until there are no more statements to execute.This execution model applies both to files you simply run as the main program and to library files that are loaded via import.\n\nConditional Execution The if, else, and elif statements control conditional code execution.The general format of a conditional statement is as follows:\n\nif expression: statements\n\nelif expression:\n\nstatements\n\nelif expression:\n\nstatements\n\n... else:\n\nstatements\n\nF h Lib f L Bdff\n\n82\n\nChapter 5 Program Structure and Control Flow\n\nIf no action is to be taken, you can omit both the else and elif clauses of a condi- tional. Use the pass statement if no statements exist for a particular clause:\n\nif expression:\n\npass # Do nothing\n\nelse:\n\nstatements\n\nLoops and Iteration You implement loops using the for and while statements. Here’s an example:\n\nwhile expression: statements\n\nfor i in s:\n\nstatements\n\nThe while statement executes statements until the associated expression evaluates to false.The for statement iterates over all the elements of s until no more elements are available.The for statement works with any object that supports iteration.This obvi- ously includes the built-in sequence types such as lists, tuples, and strings, but also any object that implements the iterator protocol.\n\nAn object, s, supports iteration if it can be used with the following code, which mir-\n\nrors the implementation of the for statement:\n\nit = s.__iter__() # Get an iterator for s while 1:\n\ntry:\n\ni = it.next() # Get next item (Use _ _next_ _ in Python 3)\n\nexcept StopIteration: # No more items\n\nbreak # Perform operations on i\n\n...\n\nIn the statement for i in s, the variable iis known as the iteration variable. On each iteration of the loop, it receives a new value from s.The scope of the iteration variable is not private to the for statement. If a previously defined variable has the same name, that value will be overwritten. Moreover, the iteration variable retains the last value after the loop has completed.\n\nIf the elements used in iteration are sequences of identical size, you can unpack their\n\nvalues into individual iteration variables using a statement such as the following:\n\nfor x,y,z in s: statements\n\nIn this example, smust contain or produce sequences, each with three elements. On each iteration, the contents of the variables x, y, and zare assigned the items of the cor- responding sequence.Although it is most common to see this used when sis a sequence of tuples, unpacking works if the items in sare any kind of sequence includ- ing lists, generators, and strings.\n\nWhen looping, it is sometimes useful to keep track of a numerical index in addition\n\nto the data values. Here’s an example:\n\ni = 0 for x in s:\n\nF h Lib f L Bdff",
      "page_number": 86
    },
    {
      "number": 6,
      "title": "Segment 6 (pages 107-126)",
      "start_page": 107,
      "end_page": 126,
      "detection_method": "synthetic",
      "content": "Loops and Iteration\n\n83\n\nstatements i += 1\n\nPython provides a built-in function, enumerate(), that can be used to simplify this code:\n\nfor i,x in enumerate(s): statements\n\nenumerate(s) creates an iterator that simply returns a sequence of tuples (0, s[0]), (1, s[1]), (2, s[2]), and so on.\n\nAnother common looping problem concerns iterating in parallel over two or more\n\nsequences—for example, writing a loop where you want to take items from different sequences on each iteration as follows:\n\n# s and t are two sequences i = 0 while i < len(s) and i < len(t):\n\nx = s[i] # Take an item from s y = t[i] # Take an item from t statements i += 1\n\nThis code can be simplified using the zip() function. For example:\n\n# s and t are two sequences for x,y in zip(s,t): statements\n\nzip(s,t) combines sequences sand tinto a sequence of tuples (s[0],t[0]), (s[1],t[1]), (s[2], t[2]), and so forth, stopping with the shortest of the sequences sand tshould they be of unequal length. One caution with zip() is that in Python 2, it fully consumes both sand t, creating a list of tuples. For generators and sequences containing a large amount of data, this may not be what you want.The function itertools.izip() achieves the same effect as zip() but generates the zipped values one at a time rather than creating a large list of tuples. In Python 3, the zip() function also generates values in this manner.\n\nTo break out of a loop, use the break statement. For example, this code reads lines\n\nof text from a file until an empty line of text is encountered:\n\nfor line in open(\"foo.txt\"):\n\nstripped = line.strip() if not stripped:\n\nbreak # A blank line, stop reading\n\n# process the stripped line ...\n\nTo jump to the next iteration of a loop (skipping the remainder of the loop body), use the continue statement.This statement tends to be used less often but is sometimes useful when the process of reversing a test and indenting another level would make the program too deeply nested or unnecessarily complicated.As an example, the following loop skips all of the blank lines in a file:\n\nfor line in open(\"foo.txt\"):\n\nstripped = line.strip() if not stripped:\n\ncontinue # Skip the blank line\n\n# process the stripped line ...\n\nF h Lib f L Bdff\n\n84\n\nChapter 5 Program Structure and Control Flow\n\nThe break and continue statements apply only to the innermost loop being executed. If it’s necessary to break out of a deeply nested loop structure, you can use an excep- tion. Python doesn’t provide a “goto” statement.\n\nYou can also attach the else statement to loop constructs, as in the following\n\nexample:\n\n# for-else for line in open(\"foo.txt\"): stripped = line.strip() if not stripped:\n\nbreak\n\n# process the stripped line ...\n\nelse:\n\nraise RuntimeError(\"Missing section separator\")\n\nThe else clause of a loop executes only if the loop runs to completion.This either occurs immediately (if the loop wouldn’t execute at all) or after the last iteration. On the other hand, if the loop is terminated early using the break statement, the else clause is skipped.\n\nThe primary use case for the looping else clause is in code that iterates over data but which needs to set or check some kind of flag or condition if the loop breaks pre- maturely. For example, if you didn’t use else, the previous code might have to be rewritten with a flag variable as follows:\n\nfound_separator = False for line in open(\"foo.txt\"): stripped = line.strip() if not stripped:\n\nfound_separator = True break\n\n# process the stripped line ...\n\nif not found_separator:\n\nraise RuntimeError(\"Missing section separator\")\n\nExceptions Exceptions indicate errors and break out of the normal control flow of a program.An exception is raised using the raise statement.The general format of the raise state- ment is raise Exception([value]), where Exceptionis the exception type and valueis an optional value giving specific details about the exception. Here’s an example:\n\nraise RuntimeError(\"Unrecoverable Error\")\n\nIf the raise statement is used by itself, the last exception generated is raised again (although this works only while handling a previously raised exception).\n\nTo catch an exception, use the try and except statements, as shown here:\n\ntry:\n\nf = open('foo')\n\nexcept IOError as e: statements\n\nF h Lib f L Bdff\n\nExceptions\n\n85\n\nWhen an exception occurs, the interpreter stops executing statements in the try block and looks for an except clause that matches the exception that has occurred. If one is found, control is passed to the first statement in the except clause.After the except clause is executed, control continues with the first statement that appears after the try-except block. Otherwise, the exception is propagated up to the block of code in which the try statement appeared.This code may itself be enclosed in a try-except that can handle the exception. If an exception works its way up to the top level of a program without being caught, the interpreter aborts with an error message. If desired, uncaught exceptions can also be passed to a user-defined function, sys.excepthook(), as described in Chapter 13,“Python Runtime Services.”\n\nThe optional as varmodifier to the except statement supplies the name of a vari-\n\nable in which an instance of the exception type supplied to the raise statement is placed if an exception occurs. Exception handlers can examine this value to find out more about the cause of the exception. For example, you can use isinstance() to check the exception type. One caution on the syntax: In previous versions of Python, the except statement was written as except ExcType, varwhere the exception type and variable were separated by a comma (,). In Python 2.6, this syntax still works, but it is deprecated. In new code, use the as varsyntax because it is required in Python 3.\n\nMultiple exception-handling blocks are specified using multiple except clauses, as in\n\nthe following example:\n\ntry:\n\ndo something\n\nexcept IOError as e:\n\n# Handle I/O error ...\n\nexcept TypeError as e: # Handle Type error ...\n\nexcept NameError as e: # Handle Name error ...\n\nA single handler can catch multiple exception types like this:\n\ntry:\n\ndo something\n\nexcept (IOError, TypeError, NameError) as e:\n\n# Handle I/O, Type, or Name errors ...\n\nTo ignore an exception, use the pass statement as follows:\n\ntry:\n\ndo something except IOError:\n\npass # Do nothing (oh well).\n\nTo catch all exceptions except those related to program exit, use Exception like this:\n\ntry:\n\ndo something\n\nexcept Exception as e:\n\nerror_log.write('An error occurred : %s\\n' % e)\n\nF h Lib f L Bdff\n\n86\n\nChapter 5 Program Structure and Control Flow\n\nWhen catching all exceptions, you should take care to report accurate error information to the user. For example, in the previous code, an error message and the associated exception value is being logged. If you don’t include any information about the excep- tion value, it can make it very difficult to debug code that is failing for reasons that you don’t expect.\n\nAll exceptions can be caught using except with no exception type as follows:\n\ntry:\n\ndo something\n\nexcept:\n\nerror_log.write('An error occurred\\n')\n\nCorrect use of this form of except is a lot trickier than it looks and should probably be avoided. For instance, this code would also catch keyboard interrupts and requests for program exit—things that you may not want to catch.\n\nThe try statement also supports an else clause, which must follow the last except\n\nclause.This code is executed if the code in the try block doesn’t raise an exception. Here’s an example:\n\ntry:\n\nf = open('foo', 'r')\n\nexcept IOError as e:\n\nerror_log.write('Unable to open foo : %s\\n' % e)\n\nelse:\n\ndata = f.read() f.close()\n\nThe finally statement defines a cleanup action for code contained in a try block. Here’s an example:\n\nf = open('foo','r') try:\n\n# Do some stuff ... finally:\n\nf.close() # File closed regardless of what happened\n\nThe finally clause isn’t used to catch errors. Rather, it’s used to provide code that must always be executed, regardless of whether an error occurs. If no exception is raised, the code in the finally clause is executed immediately after the code in the try block. If an exception occurs, control is first passed to the first statement of the finally clause.After this code has executed, the exception is re-raised to be caught by another exception handler.\n\nBuilt-in Exceptions Python defines the built-in exceptions listed in Table 5.1.\n\nF h Lib f L Bdff\n\nExceptions\n\n87\n\nTable 5.1\n\nBuilt-in Exceptions\n\nException\n\nDescription\n\nBaseException\n\nGeneratorExit\n\nKeyboardInterrupt\n\nSystemExit\n\nException\n\nStopIteration\n\nStandardError\n\nArithmeticError\n\nFloatingPointError\n\nZeroDivisionError\n\nAssertionError\n\nAttributeError\n\nEnvironmentError\n\nIOError\n\nOSError\n\nEOFError\n\nImportError\n\nLookupError\n\nIndexError\n\nKeyError\n\nMemoryError\n\nNameError\n\nUnboundLocalError\n\nReferenceError\n\nRuntimeError\n\nNotImplementedError\n\nSyntaxError\n\nIndentationError\n\nTabError\n\nSystemError\n\nTypeError\n\nThe root of all exceptions. Raised by .close() method on a generator. Generated by the interrupt key (usually Ctrl+C). Program exit/termination. Base class for all non-exiting exceptions. Raised to stop iteration. Base for all built-in exceptions (Python 2 only). In Python 3, all exceptions below are grouped under Exception. Base for arithmetic exceptions. Failure of a floating-point operation. Division or modulus operation with 0. Raised by the assert statement. Raised when an attribute name is invalid. Errors that occur externally to Python. I/O or file-related error. Operating system error. Raised when the end of the file is reached. Failure of the import statement. Indexing and key errors. Out-of-range sequence index. Nonexistent dictionary key. Out of memory. Failure to find a local or global name. Unbound local variable. Weak reference used after referent destroyed. A generic catchall error. Unimplemented feature. Parsing error. Indentation error. Inconsistent tab usage (generated with -tt option). Nonfatal system error in the interpreter. Passing an inappropriate type to an operation. Invalid type. Unicode error. Unicode decoding error. Unicode encoding error.\n\nValueError\n\nUnicodeError\n\nUnicodeDecodeError\n\nUnicodeEncodeError UnicodeTranslateError Unicode translation error.\n\nF h Lib f L Bdff\n\n88\n\nChapter 5 Program Structure and Control Flow\n\nExceptions are organized into a hierarchy as shown in the table.All the exceptions in a particular group can be caught by specifying the group name in an except clause. Here’s an example:\n\ntry:\n\nstatements\n\nexcept LookupError: # Catch IndexError or KeyError\n\nstatements\n\nor\n\ntry:\n\nstatements\n\nexcept Exception: # Catch any program-related exception\n\nstatements\n\nAt the top of the exception hierarchy, the exceptions are grouped according to whether or not the exceptions are related to program exit. For example, the SystemExit and KeyboardInterrupt exceptions are not grouped under Exception because programs that want to catch all program-related errors usually don’t want to also capture program termination by accident.\n\nDefining New Exceptions All the built-in exceptions are defined in terms of classes.To create a new exception, create a new class definition that inherits from Exception, such as the following:\n\nclass NetworkError(Exception): pass\n\nTo use your new exception, use it with the raise statement as follows:\n\nraise NetworkError(\"Cannot find host.\")\n\nWhen raising an exception, the optional values supplied with the raise statement are used as the arguments to the exception’s class constructor. Most of the time, this is sim- ply a string indicating some kind of error message. However, user-defined exceptions can be written to take one or more exception values as shown in this example:\n\nclass DeviceError(Exception):\n\ndef __init__(self,errno,msg): self.args = (errno, msg) self.errno = errno self.errmsg = msg\n\n# Raises an exception (multiple arguments) raise DeviceError(1, 'Not Responding')\n\nWhen you create a custom exception class that redefines __init__(), it is important to assign a tuple containing the arguments to __init__() to the attribute self.args as shown.This attribute is used when printing exception traceback messages. If you leave it undefined, users won’t be able to see any useful information about the exception when an error occurs.\n\nExceptions can be organized into a hierarchy using inheritance. For instance, the NetworkError exception defined earlier could serve as a base class for a variety of more specific errors. Here’s an example:\n\nclass HostnameError(NetworkError): pass class TimeoutError(NetworkError): pass\n\nF h Lib f L Bdff\n\nContext Managers and the with Statement\n\n89\n\ndef error1():\n\nraise HostnameError(\"Unknown host\")\n\ndef error2():\n\nraise TimeoutError(\"Timed out\")\n\ntry:\n\nerror1()\n\nexcept NetworkError as e:\n\nif type(e) is HostnameError:\n\n# Perform special actions for this kind of error ...\n\nIn this case, the except NetworkError statement catches any exception derived from NetworkError.To find the specific type of error that was raised, examine the type of the execution value with type().Alternatively, the sys.exc_info() function can be used to retrieve information about the last raised exception.\n\nContext Managers and the with Statement Proper management of system resources such as files, locks, and connections is often a tricky problem when combined with exceptions. For example, a raised exception can cause control flow to bypass statements responsible for releasing critical resources such as a lock.\n\nThe with statement allows a series of statements to execute inside a runtime context\n\nthat is controlled by an object that serves as a context manager. Here is an example:\n\nwith open(\"debuglog\",\"a\") as f: f.write(\"Debugging\\n\") statements f.write(\"Done\\n\")\n\nimport threading lock = threading.Lock() with lock:\n\n# Critical section statements # End critical section\n\nIn the first example, the with statement automatically causes the opened file to be closed when control-flow leaves the block of statements that follows. In the second example, the with statement automatically acquires and releases a lock when control enters and leaves the block of statements that follows.\n\nThe with objstatement allows the object objto manage what happens when control-flow enters and exits the associated block of statements that follows.When the with objstatement executes, it executes the method obj.__enter__() to signal that a new context is being entered.When control flow leaves the context, the method obj.__exit__(type,value,traceback) executes. If no exception has been raised, the three arguments to __exit__() are all set to None. Otherwise, they contain the type, value, and traceback associated with the exception that has caused control-flow to leave the context.The __exit__() method returns True or False to indicate whether the raised exception was handled or not (if False is returned, any exceptions raised are propagated out of the context).\n\nF h Lib f L Bdff\n\n90\n\nChapter 5 Program Structure and Control Flow\n\nThe with objstatement accepts an optional as varspecifier. If given, the value returned by obj.__enter__() is placed into var. It is important to emphasize that objis not necessarily the value assigned to var.\n\nThe with statement only works with objects that support the context management protocol (the __enter__() and __exit__() methods). User-defined classes can imple- ment these methods to define their own customized context-management. Here is a simple example:\n\nclass ListTransaction(object):\n\ndef __init__(self,thelist): self.thelist = thelist\n\ndef __enter__(self):\n\nself.workingcopy = list(self.thelist) return self.workingcopy\n\ndef __exit__(self,type,value,tb):\n\nif type is None:\n\nself.thelist[:] = self.workingcopy\n\nreturn False\n\nThis class allows one to make a sequence of modifications to an existing list. However, the modifications only take effect if no exceptions occur. Otherwise, the original list is left unmodified. For example:\n\nitems = [1,2,3] with ListTransaction(items) as working:\n\nworking.append(4) working.append(5)\n\nprint(items) # Produces [1,2,3,4,5]\n\ntry:\n\nwith ListTransaction(items) as working:\n\nworking.append(6) working.append(7) raise RuntimeError(\"We're hosed!\")\n\nexcept RuntimeError:\n\npass\n\nprint(items) # Produces [1,2,3,4,5]\n\nThe contextlib module allows custom context managers to be more easily imple- mented by placing a wrapper around a generator function. Here is an example:\n\nfrom contextlib import contextmanager @contextmanager def ListTransaction(thelist):\n\nworkingcopy = list(thelist) yield workingcopy # Modify the original list only if no errors thelist[:] = workingcopy\n\nIn this example, the value passed to yield is used as the return value from __enter__().When the __exit__() method gets invoked, execution resumes after the yield. If an exception gets raised in the context, it shows up as an exception in the generator function. If desired, an exception could be caught, but in this case, exceptions will simply propagate out of the generator to be handled elsewhere.\n\nF h Lib f L Bdff\n\nAssertions and __debug__\n\n91\n\nAssertions and __debug__ The assert statement can introduce debugging code into a program.The general form of assert is\n\nassert test [, msg]\n\nwhere testis an expression that should evaluate to True or False. If testevaluates to False, assert raises an AssertionError exception with the optional message msg supplied to the assert statement. Here’s an example:\n\ndef write_data(file,data):\n\nassert file, \"write_data: file not defined!\" ...\n\nThe assert statement should not be used for code that must be executed to make the program correct because it won’t be executed if Python is run in optimized mode (specified with the -O option to the interpreter). In particular, it’s an error to use assert to check user input. Instead, assert statements are used to check things that should always be true; if one is violated, it represents a bug in the program, not an error by the user.\n\nFor example, if the function write_data(), shown previously, were intended for use\n\nby an end user, the assert statement should be replaced by a conventional if state- ment and the desired error-handling.\n\nIn addition to assert, Python provides the built-in read-only variable __debug__,\n\nwhich is set to True unless the interpreter is running in optimized mode (specified with the -O option). Programs can examine this variable as needed—possibly running extra error-checking procedures if set.The underlying implementation of the __debug__ variable is optimized in the interpreter so that the extra control-flow logic of the if statement itself is not actually included. If Python is running in its normal mode, the statements under the if __debug__ statement are just inlined into the pro- gram without the if statement itself. In optimized mode, the if __debug__ statement and all associated statements are completely removed from the program.\n\nThe use of assert and __debug__ allow for efficient dual-mode development of a\n\nprogram. For example, in debug mode, you can liberally instrument your code with assertions and debug checks to verify correct operation. In optimized mode, all of these extra checks get stripped, resulting in no extra performance penalty.\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n6\n\nFunctions and Functional Programming\n\nSubstantial programs are broken up into functions for better modularity and ease of\n\nmaintenance. Python makes it easy to define functions but also incorporates a surprising number of features from functional programming languages.This chapter describes functions, scoping rules, closures, decorators, generators, coroutines, and other functional programming features. In addition, list comprehensions and generator expressions are described—both of which are powerful tools for declarative-style programming and data processing.\n\nFunctions Functions are defined with the def statement:\n\ndef add(x,y):\n\nreturn x + y\n\nThe body of a function is simply a sequence of statements that execute when the func- tion is called.You invoke a function by writing the function name followed by a tuple of function arguments, such as a = add(3,4).The order and number of arguments must match those given in the function definition. If a mismatch exists, a TypeError exception is raised.\n\nYou can attach default arguments to function parameters by assigning values in the\n\nfunction definition. For example:\n\ndef split(line,delimiter=','):\n\nstatements\n\nWhen a function defines a parameter with a default value, that parameter and all the parameters that follow are optional. If values are not assigned to all the optional parame- ters in the function definition, a SyntaxError exception is raised.\n\nDefault parameter values are always set to the objects that were supplied as values\n\nwhen the function was defined. Here’s an example:\n\na = 10 def foo(x=a):\n\nreturn x\n\na = 5 # Reassign 'a'. foo() # returns 10 (default value not changed)\n\nF h Lib f L Bdff\n\n94\n\nChapter 6 Functions and Functional Programming\n\nIn addition, the use of mutable objects as default values may lead to unintended behavior:\n\ndef foo(x, items=[]):\n\nitems.append(x) return items\n\nfoo(1) # returns [1] foo(2) # returns [1, 2] foo(3) # returns [1, 2, 3]\n\nNotice how the default argument retains modifications made from previous invocations. To prevent this, it is better to use None and add a check as follows:\n\ndef foo(x, items=None):\n\nif items is None: items = []\n\nitems.append(x) return items\n\nA function can accept a variable number of parameters if an asterisk (*) is added to the last parameter name:\n\ndef fprintf(file, fmt, *args): file.write(fmt % args)\n\n# Use fprintf. args gets (42,\"hello world\", 3.45) fprintf(out,\"%d %s %f\", 42, \"hello world\", 3.45)\n\nIn this case, all the remaining arguments are placed into the argsvariable as a tuple.To pass a tuple argsto a function as if they were parameters, the *args syntax can be used in a function call as follows:\n\ndef printf(fmt, *args):\n\n# Call another function and pass along args fprintf(sys.stdout, fmt, *args)\n\nFunction arguments can also be supplied by explicitly naming each parameter and spec- ifying a value.These are known as keyword arguments. Here is an example:\n\ndef foo(w,x,y,z): statements\n\n# Keyword argument invocation foo(x=3, y=22, w='hello', z=[1,2])\n\nWith keyword arguments, the order of the parameters doesn’t matter. However, unless there are default values, you must explicitly name all of the required function parame- ters. If you omit any of the required parameters or if the name of a keyword doesn’t match any of the parameter names in the function definition, a TypeError exception is raised.Also, since any Python function can be called using the keyword calling style, it is generally a good idea to define functions with descriptive argument names.\n\nPositional arguments and keyword arguments can appear in the same function call, provided that all the positional arguments appear first, values are provided for all non- optional arguments, and no argument value is defined more than once. Here’s an example:\n\nfoo('hello', 3, z=[1,2], y=22) foo(3, 22, w='hello', z=[1,2]) # TypeError. Multiple values for w\n\nF h Lib f L Bdff\n\nParameter Passing and Return Values\n\n95\n\nIf the last argument of a function definition begins with **, all the additional keyword arguments (those that don’t match any of the other parameter names) are placed in a dictionary and passed to the function.This can be a useful way to write functions that accept a large number of potentially open-ended configuration options that would be too unwieldy to list as parameters. Here’s an example:\n\ndef make_table(data, **parms):\n\n# Get configuration parameters from parms (a dict) fgcolor = parms.pop(\"fgcolor\",\"black\") bgcolor = parms.pop(\"bgcolor\",\"white\") width = parms.pop(\"width\",None) ... # No more options if parms:\n\nraise TypeError(\"Unsupported configuration options %s\" % list(parms))\n\nmake_table(items, fgcolor=\"black\", bgcolor=\"white\", border=1,\n\nborderstyle=\"grooved\", cellpadding=10, width=400)\n\nYou can combine extra keyword arguments with variable-length argument lists, as long as the ** parameter appears last:\n\n# Accept variable number of positional or keyword arguments def spam(*args, **kwargs):\n\n# args is a tuple of positional args # kwargs is dictionary of keyword args ...\n\nKeyword arguments can also be passed to another function using the **kwargs syntax:\n\ndef callfunc(*args, **kwargs):\n\nfunc(*args,**kwargs)\n\nThis use of *args and **kwargs is commonly used to write wrappers and proxies for other functions. For example, the callfunc() accepts any combination of arguments and simply passes them through to func().\n\nParameter Passing and Return Values When a function is invoked, the function parameters are simply names that refer to the passed input objects.The underlying semantics of parameter passing doesn’t neatly fit into any single style, such as “pass by value” or “pass by reference,” that you might know about from other programming languages. For example, if you pass an immutable value, the argument effectively looks like it was passed by value. However, if a mutable object (such as a list or dictionary) is passed to a function where it’s then modified, those changes will be reflected in the original object. Here’s an example:\n\na = [1, 2, 3, 4, 5] def square(items):\n\nfor i,x in enumerate(items):\n\nitems[i] = x * x # Modify items in-place\n\nsquare(a) # Changes a to [1, 4, 9, 16, 25]\n\nFunctions that mutate their input values or change the state of other parts of the pro- gram behind the scenes like this are said to have side effects.As a general rule, this is a\n\nF h Lib f L Bdff\n\n96\n\nChapter 6 Functions and Functional Programming\n\nprogramming style that is best avoided because such functions can become a source of subtle programming errors as programs grow in size and complexity (for example, it’s not obvious from reading a function call if a function has side effects). Such functions interact poorly with programs involving threads and concurrency because side effects typically need to be protected by locks.\n\nThe return statement returns a value from a function. If no value is specified or you omit the return statement, the None object is returned.To return multiple values, place them in a tuple:\n\ndef factor(a): d = 2 while (d <= (a / 2)):\n\nif ((a / d) * d == a):\n\nreturn ((a / d), d)\n\nd = d + 1 return (a, 1)\n\nMultiple return values returned in a tuple can be assigned to individual variables:\n\nx, y = factor(1243) # Return values placed in x and y.\n\nor\n\n(x, y) = factor(1243) # Alternate version. Same behavior.\n\nScoping Rules Each time a function executes, a new local namespace is created.This namespace repre- sents a local environment that contains the names of the function parameters, as well as the names of variables that are assigned inside the function body.When resolving names, the interpreter first searches the local namespace. If no match exists, it searches the glob- al namespace.The global namespace for a function is always the module in which the function was defined. If the interpreter finds no match in the global namespace, it makes a final check in the built-in namespace. If this fails, a NameError exception is raised.\n\nOne peculiarity of namespaces is the manipulation of global variables within a func-\n\ntion. For example, consider the following code:\n\na = 42 def foo(): a = 13\n\nfoo() # a is still 42\n\nWhen this code executes, a returns its value of 42, despite the appearance that we might be modifying the variable a inside the function foo.When variables are assigned inside a function, they’re always bound to the function’s local namespace; as a result, the variable a in the function body refers to an entirely new object containing the value 13, not the outer variable.To alter this behavior, use the global statement. global sim- ply declares names as belonging to the global namespace, and it’s necessary only when global variables will be modified. It can be placed anywhere in a function body and used repeatedly. Here’s an example:\n\nF h Lib f L Bdff\n\nScoping Rules\n\n97\n\na = 42 b = 37 def foo():\n\nglobal a # 'a' is in global namespace a = 13 b = 0\n\nfoo() # a is now 13. b is still 37.\n\nPython supports nested function definitions. Here’s an example:\n\ndef countdown(start):\n\nn = start def display(): # Nested function definition\n\nprint('T-minus %d' % n)\n\nwhile n > 0:\n\ndisplay() n -= 1\n\nVariables in nested functions are bound using lexical scoping.That is, names are resolved by first checking the local scope and then all enclosing scopes of outer function defini- tions from the innermost scope to the outermost scope. If no match is found, the global and built-in namespaces are checked as before.Although names in enclosing scopes are accessible, Python 2 only allows variables to be reassigned in the innermost scope (local variables) and the global namespace (using global).Therefore, an inner function can’t reassign the value of a local variable defined in an outer function. For example, this code does not work:\n\ndef countdown(start):\n\nn = start def display():\n\nprint('T-minus %d' % n)\n\ndef decrement():\n\nn -= 1 # Fails in Python 2\n\nwhile n > 0:\n\ndisplay() decrement()\n\nIn Python 2, you can work around this by placing values you want to change in a list or dictionary. In Python 3, you can declare n as nonlocal as follows:\n\ndef countdown(start):\n\nn = start def display():\n\nprint('T-minus %d' % n)\n\ndef decrement():\n\nnonlocal n # Bind to outer n (Python 3 only) n -= 1\n\nwhile n > 0:\n\ndisplay() decrement()\n\nThe nonlocal declaration does not bind a name to local variables defined inside arbi- trary functions further down on the current call-stack (that is, dynamic scope). So, if you’re coming to Python from Perl, nonlocal is not the same as declaring a Perl local variable.\n\nF h Lib f L Bdff\n\n98\n\nChapter 6 Functions and Functional Programming\n\nIf a local variable is used before it’s assigned a value, an UnboundLocalError excep-\n\ntion is raised. Here’s an example that illustrates one scenario of how this might occur:\n\ni = 0 def foo():\n\ni = i + 1 # Results in UnboundLocalError exception print(i)\n\nIn this function, the variable i is defined as a local variable (because it is being assigned inside the function and there is no global statement). However, the assignment i = i + 1 tries to read the value of i before its local value has been first assigned. Even though there is a global variable i in this example, it is not used to supply a value here. Variables are determined to be either local or global at the time of function definition and cannot suddenly change scope in the middle of a function. For example, in the pre- ceding code, it is not the case that the i in the expression i + 1 refers to the global variable i, whereas the i in print(i) refers to the local variable i created in the previ- ous statement.\n\nFunctions as Objects and Closures Functions are first-class objects in Python.This means that they can be passed as argu- ments to other functions, placed in data structures, and returned by a function as a result. Here is an example of a function that accepts another function as input and calls it:\n\n# foo.py def callf(func): return func()\n\nHere is an example of using the above function:\n\n>>> import foo >>> def helloworld(): ... ... >>> foo.callf(helloworld) 'Hello World' >>>\n\nreturn 'Hello World'\n\n# Pass a function as an argument\n\nWhen a function is handled as data, it implicitly carries information related to the sur- rounding environment where the function was defined.This affects how free variables in the function are bound.As an example, consider this modified version foo.py that now contains a variable definition:\n\n# foo.py x = 42 def callf(func): return func()\n\nNow, observe the behavior of this example:\n\n>>> import foo >>> x = 37 >>> def helloworld(): ... ... >>> foo.callf(helloworld) 'Hello World. x is 37' >>>\n\nreturn \"Hello World. x is %d\" % x\n\n# Pass a function as an argument\n\nF h Lib f L Bdff\n\nFunctions as Objects and Closures\n\n99\n\nIn this example, notice how the function helloworld() uses the value of x that’s defined in the same environment as where helloworld() was defined.Thus, even though there is also an x defined in foo.py and that’s where helloworld() is actually being called, that value of x is not the one that’s used when helloworld() executes.\n\nWhen the statements that make up a function are packaged together with the envi- ronment in which they execute, the resulting object is known as a closure.The behavior of the previous example is explained by the fact that all functions have a __globals__ attribute that points to the global namespace in which the function was defined.This always corresponds to the enclosing module in which a function was defined. For the previous example, you get the following:\n\n>>> helloworld.__globals__ {'__builtins__': <module '__builtin__' (built-in)>,\n\n'helloworld': <function helloworld at 0x7bb30>, 'x': 37, '__name__': '__main__', '__doc__': None 'foo': <module 'foo' from 'foo.py'>}\n\n>>>\n\nWhen nested functions are used, closures capture the entire environment needed for the inner function to execute. Here is an example:\n\nimport foo def bar(): x = 13 def helloworld():\n\nreturn \"Hello World. x is %d\" % x\n\nfoo.callf(helloworld) # returns 'Hello World, x is 13'\n\nClosures and nested functions are especially useful if you want to write code based on the concept of lazy or delayed evaluation. Here is another example:\n\nfrom urllib import urlopen # from urllib.request import urlopen (Python 3) def page(url): def get():\n\nreturn urlopen(url).read()\n\nreturn get\n\nIn this example, the page() function doesn’t actually carry out any interesting compu- tation. Instead, it merely creates and returns a function get() that will fetch the con- tents of a web page when it is called.Thus, the computation carried out in get() is actually delayed until some later point in a program when get() is evaluated. For example:\n\n>>> python = page(\"http://www.python.org\") >>> jython = page(\"http://www.jython.org\") >>> python <function get at 0x95d5f0> >>> jython <function get at 0x9735f0> >>> pydata = python() >>> jydata = jython() >>>\n\n# Fetches http://www.python.org # Fetches http://www.jython.org\n\nIn this example, the two variables python and jython are actually two different ver- sions of the get() function. Even though the page() function that created these values is no longer executing, both get() functions implicitly carry the values of the outer variables that were defined when the get() function was created.Thus, when get()\n\nF h Lib f L Bdff\n\n100\n\nChapter 6 Functions and Functional Programming\n\nexecutes, it calls urlopen(url) with the value of url that was originally supplied to page().With a little inspection, you can view the contents of variables that are carried along in a closure. For example:\n\n>>> python.__closure__ (<cell at 0x67f50: str object at 0x69230>,) >>> python.__closure__[0].cell_contents 'http://www.python.org' >>> jython.__closure__[0].cell_contents 'http://www.jython.org' >>>\n\nA closure can be a highly efficient way to preserve state across a series of function calls. For example, consider this code that runs a simple counter:\n\ndef countdown(n):\n\ndef next():\n\nnonlocal n r = n n -= 1 return r\n\nreturn next\n\n# Example use next = countdown(10) while True:\n\nv = next() # Get the next value if not v: break\n\nIn this code, a closure is being used to store the internal counter value n.The inner function next() updates and returns the previous value of this counter variable each time it is called. Programmers not familiar with closures might be inclined to imple- ment similar functionality using a class such as this:\n\nclass Countdown(object):\n\ndef __init__(self,n):\n\nself.n = n\n\ndef next(self):\n\nr = self.n self.n -= 1 return r\n\n# Example use c = Countdown(10) while True:\n\nv = c.next() # Get the next value if not v: break\n\nHowever, if you increase the starting value of the countdown and perform a simple timing benchmark, you will find that that the version using closures runs much faster (almost a 50% speedup when tested on the author’s machine).\n\nThe fact that closures capture the environment of inner functions also make them useful for applications where you want to wrap existing functions in order to add extra capabilities.This is described next.\n\nF h Lib f L Bdff\n\nDecorators\n\n101\n\nDecorators A decorator is a function whose primary purpose is to wrap another function or class. The primary purpose of this wrapping is to transparently alter or enhance the behavior of the object being wrapped. Syntactically, decorators are denoted using the special @ symbol as follows:\n\n@trace def square(x):\n\nreturn x*x\n\nThe preceding code is shorthand for the following:\n\ndef square(x): return x*x\n\nsquare = trace(square)\n\nIn the example, a function square() is defined. However, immediately after its defini- tion, the function object itself is passed to the function trace(), which returns an object that replaces the original square. Now, let’s consider an implementation of trace that will clarify how this might be useful:\n\nenable_tracing = True if enable_tracing:\n\ndebug_log = open(\"debug.log\",\"w\")\n\ndef trace(func):\n\nif enable_tracing:\n\ndef callf(*args,**kwargs):\n\ndebug_log.write(\"Calling %s: %s, %s\\n\" %\n\n(func.__name__, args, kwargs))\n\nr = func(*args,**kwargs) debug_log.write(\"%s returned %s\\n\" % (func.__name, r)) return r return callf\n\nelse:\n\nreturn func\n\nIn this code, trace() creates a wrapper function that writes some debugging output and then calls the original function object.Thus, if you call square(), you will see the output of the write() methods in the wrapper.The function callf that is returned from trace() is a closure that serves as a replacement for the original function.A final interesting aspect of the implementation is that the tracing feature itself is only enabled through the use of a global variable enable_tracing as shown. If set to False, the trace() decorator simply returns the original function unmodified.Thus, when tracing is disabled, there is no added performance penalty associated with using the decorator.\n\nWhen decorators are used, they must appear on their own line immediately prior to\n\na function or class definition. More than one decorator can also be applied. Here’s an example:\n\n@foo @bar @spam def grok(x):\n\npass\n\nF h Lib f L Bdff\n\n102\n\nChapter 6 Functions and Functional Programming\n\nIn this case, the decorators are applied in the order listed.The result is the same as this:\n\ndef grok(x): pass\n\ngrok = foo(bar(spam(grok)))\n\nA decorator can also accept arguments. Here’s an example:\n\n@eventhandler('BUTTON') def handle_button(msg):\n\n...\n\n@eventhandler('RESET') def handle_reset(msg):\n\n...\n\nIf arguments are supplied, the semantics of the decorator are as follows:\n\ndef handle_button(msg):\n\n...\n\ntemp = eventhandler('BUTTON') # Call decorator with supplied arguments handle_button = temp(handle_button) # Call the function returned by the decorator\n\nIn this case, the decorator function only accepts the arguments supplied with the @ specifier. It then returns a function that is called with the function as an argument. Here’s an example:\n\n# Event handler decorator event_handlers = { } def eventhandler(event):\n\ndef register_function(f):\n\nevent_handlers[event] = f return f\n\nreturn register_function\n\nDecorators can also be applied to class definitions. For example:\n\n@foo class Bar(object):\n\ndef __init__(self,x):\n\nself.x = x\n\ndef spam(self):\n\nstatements\n\nFor class decorators, you should always have the decorator function return a class object as a result. Code that expects to work with the original class definition may want to ref- erence members of the class directly such as Bar.spam.This won’t work correctly if the decorator function foo() returns a function.\n\nDecorators can interact strangely with other aspects of functions such as recursion, documentation strings, and function attributes.These issues are described later in this chapter.\n\nGenerators and yield If a function uses the yield keyword, it defines an object known as a generator.A gener- ator is a function that produces a sequence of values for use in iteration. Here’s an example:\n\nF h Lib f L Bdff",
      "page_number": 107
    },
    {
      "number": 7,
      "title": "Segment 7 (pages 127-148)",
      "start_page": 127,
      "end_page": 148,
      "detection_method": "synthetic",
      "content": "Generators and yield\n\n103\n\ndef countdown(n):\n\nprint(\"Counting down from %d\" % n) while n > 0: yield n n -= 1\n\nreturn\n\nIf you call this function, you will find that none of its code starts executing. For example:\n\n>>> c = countdown(10) >>>\n\nInstead, a generator object is returned.The generator object, in turn, executes the func- tion whenever next() is called (or __next__() in Python 3). Here’s an example:\n\n>>> c.next() Counting down from 10 10 >>> c.next() 9\n\n# Use c.__next__() in Python 3\n\nWhen next() is invoked, the generator function executes statements until it reaches a yield statement.The yield statement produces a result at which point execution of the function stops until next() is invoked again. Execution then resumes with the statement following yield.\n\nYou normally don’t call next() directly on a generator but use it with the for statement, sum(), or some other operation that consumes a sequence. For example:\n\nfor n in countdown(10):\n\nstatements a = sum(countdown(10))\n\nA generator function signals completion by returning or raising StopIteration, at which point iteration stops. It is never legal for a generator to return a value other than None upon completion.\n\nA subtle problem with generators concerns the case where a generator function is\n\nonly partially consumed. For example, consider this code:\n\nfor n in countdown(10):\n\nif n == 2: break statements\n\nIn this example, the for loop aborts by calling break, and the associated generator never runs to full completion.To handle this case, generator objects have a method close() that is used to signal a shutdown.When a generator is no longer used or deleted, close() is called. Normally it is not necessary to call close(), but you can also call it manually as shown here:\n\n>>> c = countdown(10) >>> c.next() Counting down from 10 10 >>> c.next() 9 >>> c.close() >>> c.next() Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nStopIteration >>>\n\nF h Lib f L Bdff\n\n104\n\nChapter 6 Functions and Functional Programming\n\nInside the generator function, close() is signaled by a GeneratorExit exception occurring on the yield statement.You can optionally catch this exception to perform cleanup actions.\n\ndef countdown(n):\n\nprint(\"Counting down from %d\" % n) try:\n\nwhile n > 0: yield n n = n - 1\n\nexcept GeneratorExit:\n\nprint(\"Only made it to %d\" % n)\n\nAlthough it is possible to catch GeneratorExit, it is illegal for a generator function to handle the exception and produce another output value using yield. Moreover, if a program is currently iterating on generator, you should not call close() asynchronous- ly on that generator from a separate thread of execution or from a signal handler.\n\nCoroutines and yield Expressions Inside a function, the yield statement can also be used as an expression that appears on the right side of an assignment operator. For example:\n\ndef receiver():\n\nprint(\"Ready to receive\") while True:\n\nn = (yield) print(\"Got %s\" % n)\n\nA function that uses yield in this manner is known as a coroutine, and it executes in response to values being sent to it. Its behavior is also very similar to a generator. For example:\n\n>>> r = receiver() >>> r.next() # Advance to first yield (r.__next__() in Python 3) Ready to receive >>> r.send(1) Got 1 >>> r.send(2) Got 2 >>> r.send(\"Hello\") Got Hello >>>\n\nIn this example, the initial call to next() is necessary so that the coroutine executes statements leading to the first yield expression.At this point, the coroutine suspends, waiting for a value to be sent to it using the send() method of the associated generator object r.The value passed to send() is returned by the (yield) expression in the coroutine. Upon receiving a value, a coroutine executes statements until the next yield statement is encountered.\n\nThe requirement of first calling next() on a coroutine is easily overlooked and a common source of errors.Therefore, it is recommended that coroutines be wrapped with a decorator that automatically takes care of this step.\n\nF h Lib f L Bdff\n\nCoroutines and yield Expressions\n\n105\n\ndef coroutine(func):\n\ndef start(*args,**kwargs):\n\ng = func(*args,**kwargs) g.next() return g return start\n\nUsing this decorator, you would write and use coroutines using:\n\n@coroutine def receiver():\n\nprint(\"Ready to receive\") while True:\n\nn = (yield) print(\"Got %s\" % n)\n\n# Example use r = receiver() r.send(\"Hello World\") # Note : No initial .next() needed\n\nA coroutine will typically run indefinitely unless it is explicitly shut down or it exits on its own.To close the stream of input values, use the close() method like this:\n\n>>> r.close() >>> r.send(4) Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nStopIteration\n\nOnce closed, a StopIteration exception will be raised if further values are sent to a coroutine.The close() operation raises GeneratorExit inside the coroutine as described in the previous section on generators. For example:\n\ndef receiver():\n\nprint(\"Ready to receive\") try:\n\nwhile True:\n\nn = (yield) print(\"Got %s\" % n)\n\nexcept GeneratorExit:\n\nprint(\"Receiver done\")\n\nExceptions can be raised inside a coroutine using the throw(exctype [, value [, tb]]) method where exctypeis an exception type, valueis the exception value, and tbis a traceback object. For example:\n\n>>> r.throw(RuntimeError,\"You're hosed!\") Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module> File \"<stdin>\", line 4, in receiver\n\nRuntimeError: You're hosed!\n\nExceptions raised in this manner will originate at the currently executing yield state- ment in the coroutine.A coroutine can elect to catch exceptions and handle them as appropriate. It is not safe to use throw() as an asynchronous signal to a coroutine—it should never be invoked from a separate execution thread or in a signal handler.\n\nA coroutine may simultaneously receive and emit return values using yield if values\n\nare supplied in the yield expression. Here is an example that illustrates this:\n\ndef line_splitter(delimiter=None):\n\nprint(\"Ready to split\") result = None while True:\n\nline = (yield result) result = line.split(delimiter)\n\nF h Lib f L Bdff\n\n106\n\nChapter 6 Functions and Functional Programming\n\nIn this case, we use the coroutine in the same way as before. However, now calls to send() also produce a result. For example:\n\n>>> s = line_splitter(\",\") >>> s.next() Ready to split >>> s.send(\"A,B,C\") ['A', 'B', 'C' ] >>> s.send(\"100,200,300\") ['100', '200', '300'] >>>\n\nUnderstanding the sequencing of this example is critical.The first next() call advances the coroutine to (yield result), which returns None, the initial value of result. On subsequent send() calls, the received value is placed in line and split into result.The value returned by send() is the value passed to the next yield statement encountered. In other words, the value returned by send() comes from the next yield expression, not the one responsible for receiving the value passed by send().\n\nIf a coroutine returns values, some care is required if exceptions raised with throw()\n\nare being handled. If you raise an exception in a coroutine using throw(), the value passed to the next yield in the coroutine will be returned as the result of throw(). If you need this value and forget to save it, it will be lost.\n\nUsing Generators and Coroutines At first glance, it might not be obvious how to use generators and coroutines for practi- cal problems. However, generators and coroutines can be particularly effective when applied to certain kinds of programming problems in systems, networking, and distrib- uted computation. For example, generator functions are useful if you want to set up a processing pipeline, similar in nature to using a pipe in the UNIX shell. One example of this appeared in the Introduction. Here is another example involving a set of generator functions related to finding, opening, reading, and processing files:\n\nimport os import fnmatch\n\ndef find_files(topdir, pattern):\n\nfor path, dirname, filelist in os.walk(topdir):\n\nfor name in filelist:\n\nif fnmatch.fnmatch(name, pattern):\n\nyield os.path.join(path,name)\n\nimport gzip, bz2 def opener(filenames):\n\nfor name in filenames:\n\nif name.endswith(\".gz\"): f = gzip.open(name) elif name.endswith(\".bz2\"): f = bz2.BZ2File(name) else: f = open(name) yield f\n\ndef cat(filelist):\n\nfor f in filelist: for line in f: yield line\n\ndef grep(pattern, lines): for line in lines:\n\nif pattern in line: yield line\n\nF h Lib f L Bdff\n\nUsing Generators and Coroutines\n\n107\n\nHere is an example of using these functions to set up a processing pipeline:\n\nwwwlogs = find(\"www\",\"access-log*\") files = opener(wwwlogs) lines = cat(files) pylines = grep(\"python\", lines) for line in pylines:\n\nsys.stdout.write(line)\n\nIn this example, the program is processing all lines in all \"access-log*\" files found within all subdirectories of a top-level directory \"www\". Each \"access-log\" is tested for file compression and opened using an appropriate file opener. Lines are concatenat- ed together and processed through a filter that is looking for a substring \"python\".The entire program is being driven by the for statement at the end. Each iteration of this loop pulls a new value through the pipeline and consumes it. Moreover, the implemen- tation is highly memory-efficient because no temporary lists or other large data struc- tures are ever created.\n\nCoroutines can be used to write programs based on data-flow processing. Programs\n\norganized in this way look like inverted pipelines. Instead of pulling values through a sequence of generator functions using a for loop, you send values into a collection of linked coroutines. Here is an example of coroutine functions written to mimic the gen- erator functions shown previously:\n\nimport os import fnmatch\n\n@coroutine def find_files(target):\n\nwhile True:\n\ntopdir, pattern = (yield) for path, dirname, filelist in os.walk(topdir):\n\nfor name in filelist:\n\nif fnmatch.fnmatch(name,pattern):\n\ntarget.send(os.path.join(path,name))\n\nimport gzip, bz2 @coroutine def opener(target): while True:\n\nname = (yield) if name.endswith(\".gz\"): f = gzip.open(name) elif name.endswith(\".bz2\"): f = bz2.BZ2File(name) else: f = open(name) target.send(f)\n\n@coroutine def cat(target):\n\nwhile True:\n\nf = (yield) for line in f:\n\ntarget.send(line)\n\nF h Lib f L Bdff\n\n108\n\nChapter 6 Functions and Functional Programming\n\n@coroutine def grep(pattern, target):\n\nwhile True:\n\nline = (yield) if pattern in line:\n\ntarget.send(line)\n\n@coroutine def printer():\n\nwhile True:\n\nline = (yield) sys.stdout.write(line)\n\nHere is how you would link these coroutines to create a dataflow processing pipeline:\n\nfinder = find_files(opener(cat(grep(\"python\",printer()))))\n\n# Now, send a value finder.send((\"www\",\"access-log*\")) finder.send((\"otherwww\",\"access-log*\"))\n\nIn this example, each coroutine sends data to another coroutine specified in the target argument to each coroutine. Unlike the generator example, execution is entirely driven by pushing data into the first coroutine find_files().This coroutine, in turn, pushes data to the next stage.A critical aspect of this example is that the coroutine pipeline remains active indefinitely or until close() is explicitly called on it. Because of this, a program can continue to feed data into a coroutine for as long as necessary—for exam- ple, the two repeated calls to send() shown in the example.\n\nCoroutines can be used to implement a form of concurrency. For example, a central-\n\nized task manager or event loop can schedule and send data into a large collection of hundreds or even thousands of coroutines that carry out various processing tasks.The fact that input data is “sent” to a coroutine also means that coroutines can often be easi- ly mixed with programs that use message queues and message passing to communicate between program components. Further information on this can be found in Chapter 20,“Threads.”\n\nList Comprehensions A common operation involving functions is that of applying a function to all of the items of a list, creating a new list with the results. For example:\n\nnums = [1, 2, 3, 4, 5] squares = [] for n in nums:\n\nsquares.append(n * n)\n\nBecause this type of operation is so common, it is has been turned into an operator known as a list comprehension. Here is a simple example:\n\nnums = [1, 2, 3, 4, 5] squares = [n * n for n in nums]\n\nThe general syntax for a list comprehension is as follows:\n\n[expression for item1 in iterable1 if condition1 for item2 in iterable2 if condition2 ... for itemN in iterableN if conditionN ]\n\nF h Lib f L Bdff\n\nGenerator Expressions\n\n109\n\nThis syntax is roughly equivalent to the following code:\n\ns = [] for item1 in iterable1: if condition1:\n\nfor item2 in iterable2:\n\nif condition2:\n\n... for itemN in iterableN:\n\nif conditionN: s.append(expression)\n\nTo illustrate, here are some more examples:\n\na = [-3,5,2,-10,7,8] b = 'abc'\n\nc = [2*s for s in a] # c = [-6,10,4,-20,14,16] d = [s for s in a if s >= 0] # d = [5,2,7,8] e = [(x,y) for x in a # e = [(5,'a'),(5,'b'),(5,'c'), for y in b # (2,'a'),(2,'b'),(2,'c'), if x > 0 ] # (7,'a'),(7,'b'),(7,'c'), # (8,'a'),(8,'b'),(8,'c')]\n\nf = [(1,2), (3,4), (5,6)] g = [math.sqrt(x*x+y*y) # f = [2.23606, 5.0, 7.81024]\n\nfor x,y in f]\n\nThe sequences supplied to a list comprehension don’t have to be the same length because they’re iterated over their contents using a nested set of for loops, as previously shown.The resulting list contains successive values of expressions.The if clause is optional; however, if it’s used, expressionis evaluated and added to the result only if conditionis true.\n\nIf a list comprehension is used to construct a list of tuples, the tuple values must be enclosed in parentheses. For example, [(x,y) for x in a for y in b] is legal syn- tax, whereas [x,y for x in a for y in b] is not.\n\nFinally, it is important to note that in Python 2, the iteration variables defined within\n\na list comprehension are evaluated within the current scope and remain defined after the list comprehension has executed. For example, in [x for x in a], the iteration variable x overwrites any previously defined value of x and is set to the value of the last item in a after the resulting list is created. Fortunately, this is not the case in Python 3 where the iteration variable remains private.\n\nGenerator Expressions A generator expression is an object that carries out the same computation as a list compre- hension, but which iteratively produces the result.The syntax is the same as for list comprehensions except that you use parentheses instead of square brackets. Here’s an example:\n\n(expression for item1 in iterable1 if condition1 for item2 in iterable2 if condition2 ... for itemN in iterableN if conditionN)\n\nF h Lib f L Bdff\n\n110\n\nChapter 6 Functions and Functional Programming\n\nUnlike a list comprehension, a generator expression does not actually create a list or immediately evaluate the expression inside the parentheses. Instead, it creates a generator object that produces the values on demand via iteration. Here’s an example:\n\n>>> a = [1, 2, 3, 4] >>> b = (10*i for i in a) >>> b <generator object at 0x590a8> >>> b.next() 10 >>> b.next() 20 ...\n\nThe difference between list and generator expressions is important, but subtle.With a list comprehension, Python actually creates a list that contains the resulting data.With a generator expression, Python creates a generator that merely knows how to produce data on demand. In certain applications, this can greatly improve performance and memory use. Here’s an example:\n\n# Read a file f = open(\"data.txt\") # Open a file lines = (t.strip() for t in f) # Read lines, strip\n\n# trailing/leading whitespace\n\ncomments = (t for t in lines if t[0] == '#') # All comments for c in comments: print(c)\n\nIn this example, the generator expression that extracts lines and strips whitespace does not actually read the entire file into memory.The same is true of the expression that extracts comments. Instead, the lines of the file are actually read when the program starts iterating in the for loop that follows. During this iteration, the lines of the file are produced upon demand and filtered accordingly. In fact, at no time will the entire file be loaded into memory during this process.Therefore, this would be a highly efficient way to extract comments from a gigabyte-sized Python source file.\n\nUnlike a list comprehension, a generator expression does not create an object that\n\nworks like a sequence. It can’t be indexed, and none of the usual list operations will work (for example, append()). However, a generator expression can be converted into a list using the built-in list() function:\n\nclist = list(comments)\n\nDeclarative Programming List comprehensions and generator expressions are strongly tied to operations found in declarative languages. In fact, the origin of these features is loosely derived from ideas in mathematical set theory. For example, when you write a statement such as [x*x for x in a if x > 0], it’s somewhat similar to specifying a set such as { x2 | x Œa, x > 0 }. Instead of writing programs that manually iterate over data, you can use these declar-\n\native features to structure programs as a series of computations that simply operate on all of the data all at once. For example, suppose you had a file “portfolio.txt” containing stock portfolio data like this:\n\nF h Lib f L Bdff\n\nDeclarative Programming\n\n111\n\nAA 100 32.20 IBM 50 91.10 CAT 150 83.44 MSFT 200 51.23 GE 95 40.37 MSFT 50 65.10 IBM 100 70.44\n\nHere is a declarative-style program that calculates the total cost by summing up the sec- ond column multiplied by the third column:\n\nlines = open(\"portfolio.txt\") fields = (line.split() for line in lines) print(sum(float(f[1]) * float(f[2]) for f in fields))\n\nIn this program, we really aren’t concerned with the mechanics of looping line-by-line over the file. Instead, we just declare a sequence of calculations to perform on all of the data. Not only does this approach result in highly compact code, but it also tends to run faster than this more traditional version:\n\ntotal = 0 for line in open(\"portfolio.txt\"):\n\nfields = line.split() total += float(fields[1]) * float(fields[2])\n\nprint(total)\n\nThe declarative programming style is somewhat tied to the kinds of operations a pro- grammer might perform in a UNIX shell. For instance, the preceding example using generator expressions is similar to the following one-line awk command:\n\n% awk '{ total += $2 * $3} END { print total }' portfolio.txt 44671.2 %\n\nThe declarative style of list comprehensions and generator expressions can also be used to mimic the behavior of SQL select statements, commonly used when processing databases. For example, consider these examples that work on data that has been read in a list of dictionaries:\n\nfields = (line.split() for line in open(\"portfolio.txt\")) portfolio = [ {'name' : f[0],\n\n'shares' : int(f[1]), 'price' : float(f[2]) }\n\nfor f in fields]\n\n# Some queries msft = [s for s in portfolio if s['name'] == 'MSFT'] large_holdings = [s for s in portfolio\n\nif s['shares']*s['price'] >= 10000]\n\nIn fact, if you are using a module related to database access (see Chapter 17), you can often use list comprehensions and database queries together all at once. For example:\n\nsum(shares*cost for shares,cost in\n\ncursor.execute(\"select shares, cost from portfolio\")\n\nif shares*cost >= 10000)\n\nF h Lib f L Bdff\n\n112\n\nChapter 6 Functions and Functional Programming\n\nThe lambda Operator Anonymous functions in the form of an expression can be created using the lambda statement:\n\nlambda args : expression\n\nargsis a comma-separated list of arguments, and expressionis an expression involv- ing those arguments. Here’s an example:\n\na = lambda x,y : x+y r = a(2,3) # r gets 5\n\nThe code defined with lambda must be a valid expression. Multiple statements and other non-expression statements, such as for and while, cannot appear in a lambda statement. lambda expressions follow the same scoping rules as functions.\n\nThe primary use of lambda is in specifying short callback functions. For example, if\n\nyou wanted to sort a list of names with case-insensitivity, you might write this:\n\nnames.sort(key=lambda n: n.lower())\n\nRecursion Recursive functions are easily defined. For example:\n\ndef factorial(n):\n\nif n <= 1: return 1 else: return n * factorial(n - 1)\n\nHowever, be aware that there is a limit on the depth of recursive function calls.The function sys.getrecursionlimit() returns the current maximum recursion depth, and the function sys.setrecursionlimit() can be used to change the value.The default value is 1000.Although it is possible to increase the value, programs are still lim- ited by the stack size limits enforced by the host operating system.When the recursion depth is exceeded, a RuntimeError exception is raised. Python does not perform tail- recursion optimization that you often find in functional languages such as Scheme.\n\nRecursion does not work as you might expect in generator functions and corou-\n\ntines. For example, this code prints all items in a nested collection of lists:\n\ndef flatten(lists): for s in lists:\n\nif isinstance(s,list):\n\nflatten(s)\n\nelse:\n\nprint(s)\n\nitems = [[1,2,3],[4,5,[5,6]],[7,8,9]] flatten(items) # Prints 1 2 3 4 5 6 7 8 9\n\nHowever, if you change the print operation to a yield, it no longer works.This is because the recursive call to flatten() merely creates a new generator object without actually iterating over it. Here’s a recursive generator version that works:\n\nF h Lib f L Bdff\n\nDocumentation Strings\n\n113\n\ndef genflatten(lists): for s in lists:\n\nif isinstance(s,list):\n\nfor item in genflatten(s):\n\nyield item\n\nelse:\n\nyield item\n\nCare should also be taken when mixing recursive functions and decorators. If a decora- tor is applied to a recursive function, all inner recursive calls now get routed through the decorated version. For example:\n\n@locked def factorial(n):\n\nif n <= 1: return 1 else: return n * factorial(n - 1) # Calls the wrapped version of factorial\n\nIf the purpose of the decorator was related to some kind of system management such as synchronization or locking, recursion is something probably best avoided.\n\nDocumentation Strings It is common practice for the first statement of function to be a documentation string describing its usage. For example:\n\ndef factorial(n):\n\n\"\"\"Computes n factorial. For example:\n\n>>> factorial(6) 120 >>>\n\n\"\"\" if n <= 1: return 1 else: return n*factorial(n-1)\n\nThe documentation string is stored in the __doc__ attribute of the function that is commonly used by IDEs to provide interactive help.\n\nIf you are using decorators, be aware that wrapping a function with a decorator can\n\nbreak the help features associated with documentation strings. For example, consider this code:\n\ndef wrap(func):\n\ncall(*args,**kwargs):\n\nreturn func(*args,**kwargs)\n\nreturn call\n\n@wrap def factorial(n):\n\n\"\"\"Computes n factorial.\"\"\" ...\n\nIf a user requests help on this version of factorial(), he will get a rather cryptic explanation:\n\n>>> help(factorial) Help on function call in module __main__:\n\ncall(*args, **kwargs) (END) >>>\n\nF h Lib f L Bdff\n\n114\n\nChapter 6 Functions and Functional Programming\n\nTo fix this, write decorator functions so that they propagate the function name and documentation string. For example:\n\ndef wrap(func):\n\ncall(*args,**kwargs):\n\nreturn func(*args,**kwargs)\n\ncall.__doc__ = func.__doc__ call.__name__ = func.__name__ return call\n\nBecause this is a common problem, the functools module provides a function wraps that can automatically copy these attributes. Not surprisingly, it is also a decorator:\n\nfrom functools import wraps def wrap(func):\n\n@wraps(func) call(*args,**kwargs):\n\nreturn func(*args,**kwargs)\n\nreturn call\n\nThe @wraps(func) decorator, defined in functools, propagates attributes from func to the wrapper function that is being defined.\n\nFunction Attributes Functions can have arbitrary attributes attached to them. Here’s an example:\n\ndef foo():\n\nstatements\n\nfoo.secure = 1 foo.private = 1\n\nFunction attributes are stored in a dictionary that is available as the __dict__ attribute of a function.\n\nThe primary use of function attributes is in highly specialized applications such as parser generators and application frameworks that would like to attach additional infor- mation to function objects.\n\nAs with documentation strings, care should be given if mixing function attributes with decorators. If a function is wrapped by a decorator, access to the attributes will actually take place on the decorator function, not the original implementation.This may or may not be what you want depending on the application.To propagate already defined function attributes to a decorator function, use the following template or the functools.wraps() decorator as shown in the previous section:\n\ndef wrap(func):\n\ncall(*args,**kwargs):\n\nreturn func(*args,**kwargs)\n\ncall.__doc__ = func.__doc__ call.__name__ = func.__name__ call.__dict__.update(func.__dict__) return call\n\nF h Lib f L Bdff\n\neval(), exec(), and compile()\n\n115\n\neval(), exec(), and compile() The eval(str [,globals [,locals]]) function executes an expression string and returns the result. Here’s an example:\n\na = eval('3*math.sin(3.5+x) + 7.2')\n\nSimilarly, the exec(str [, globals [, locals]]) function executes a string con- taining arbitrary Python code.The code supplied to exec() is executed as if the code actually appeared in place of the exec operation. Here’s an example:\n\na = [3, 5, 10, 13] exec(\"for i in a: print(i)\")\n\nOne caution with exec is that in Python 2, exec is actually defined as a statement. Thus, in legacy code, you might see statements invoking exec without the surrounding parentheses, such as exec \"for i in a: print i\".Although this still works in Python 2.6, it breaks in Python 3. Modern programs should use exec() as a function.\n\nBoth of these functions execute within the namespace of the caller (which is used to resolve any symbols that appear within a string or file). Optionally, eval() and exec() can accept one or two mapping objects that serve as the global and local namespaces for the code to be executed, respectively. Here’s an example:\n\nglobals = {'x': 7,\n\n'y': 10, 'birds': ['Parrot', 'Swallow', 'Albatross']\n\n}\n\nlocals = { }\n\n# Execute using the above dictionaries as the global and local namespace a = eval(\"3 * x + 4 * y\", globals, locals) exec(\"for b in birds: print(b)\", globals, locals)\n\nIf you omit one or both namespaces, the current values of the global and local name- spaces are used.Also, due to issues related to nested scopes, the use of exec() inside of a function body may result in a SyntaxError exception if that function also contains nested function definitions or uses the lambda operator.\n\nWhen a string is passed to exec() or eval() the parser first compiles it into byte-\n\ncode. Because this process is expensive, it may be better to precompile the code and reuse the bytecode on subsequent calls if the code will be executed multiple times.\n\nThe compile(str,filename,kind) function compiles a string into bytecode in which stris a string containing the code to be compiled and filenameis the file in which the string is defined (for use in traceback generation).The kindargument speci- fies the type of code being compiled—'single' for a single statement, 'exec' for a set of statements, or 'eval' for an expression.The code object returned by the compile() function can also be passed to the eval() function and exec() statement. Here’s an example:\n\ns = \"for i in range(0,10): print(i)\" c = compile(s,'','exec') # Compile into a code object exec(c) # Execute it\n\ns2 = \"3 * x + 4 * y\" c2 = compile(s2, '', 'eval') # Compile into an expression result = eval(c2) # Execute it\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n7\n\nClasses and Object-Oriented Programming\n\nClasses are the mechanism used to create new kinds of objects.This chapter covers\n\nthe details of classes, but is not intended to be an in-depth reference on object-oriented programming and design. It’s assumed that the reader has some prior experience with data structures and object-oriented programming in other languages such as C or Java. (Chapter 3,“Types and Objects,” contains additional information about the terminology and internal implementation of objects.)\n\nThe class Statement A class defines a set of attributes that are associated with, and shared by, a collection of objects known as instances.A class is most commonly a collection of functions (known as methods), variables (which are known as class variables), and computed attributes (which are known as properties).\n\nA class is defined using the class statement.The body of a class contains a series of\n\nstatements that execute during class definition. Here’s an example:\n\nclass Account(object):\n\nnum_accounts = 0 def __init__(self,name,balance):\n\nself.name = name self.balance = balance Account.num_accounts += 1\n\ndef __del__(self):\n\nAccount.num_accounts -= 1\n\ndef deposit(self,amt):\n\nself.balance = self.balance + amt\n\ndef withdraw(self,amt):\n\nself.balance = self.balance - amt\n\ndef inquiry(self):\n\nreturn self.balance\n\nThe values created during the execution of the class body are placed into a class object that serves as a namespace much like a module. For example, the members of the Account class are accessed as follows:\n\nAccount.num_accounts Account.__init__ Account.__del__ Account.deposit Account.withdraw Account.inquiry\n\nF h Lib f L Bdff\n\n118\n\nChapter 7 Classes and Object-Oriented Programming\n\nIt’s important to note that a class statement by itself doesn’t create any instances of the class (for example, no accounts are actually created in the preceding example). Rather, a class merely sets up the attributes that will be common to all the instances that will be created later. In this sense, you might think of it as a blueprint.\n\nThe functions defined inside a class are known as instance methods.An instance\n\nmethod is a function that operates on an instance of the class, which is passed as the first argument. By convention, this argument is called self, although any legal identifier name can be used. In the preceding example, deposit(), withdraw(), and inquiry() are examples of instance methods.\n\nClass variables such as num_accounts are values that are shared among all instances\n\nof a class (that is, they’re not individually assigned to each instance). In this case, it’s a variable that’s keeping track of how many Account instances are in existence.\n\nClass Instances Instances of a class are created by calling a class object as a function.This creates a new instance that is then passed to the __init__() method of the class.The arguments to __init__() consist of the newly created instance self along with the arguments sup- plied when calling the class object. For example:\n\n# Create a few accounts a = Account(\"Guido\", 1000.00) # Invokes Account.__init__(a,\"Guido\",1000.00) b = Account(\"Bill\", 10.00)\n\nInside __init__(), attributes are saved in the instance by assigning to self. For\n\nexample, self.name = name is saving a name attribute in the instance. Once the newly created instance has been returned to the user, these attributes as well as attrib- utes of the class are accessed using the dot (.) operator as follows:\n\na.deposit(100.00) # Calls Account.deposit(a,100.00) b.withdraw(50.00) # Calls Account.withdraw(b,50.00) name = a.name # Get account name\n\nThe dot (.) operator is responsible for attribute binding.When you access an attribute, the resulting value may come from several different places. For example, a.name in the previous example returns the name attribute of the instance a. However, a.deposit returns the deposit attribute (a method) of the Account class.When you access an attribute, the instance is checked first and if nothing is known, the search moves to the instance’s class instead.This is the underlying mechanism by which a class shares its attributes with all of its instances.\n\nScoping Rules Although classes define a namespace, classes do not create a scope for names used inside the bodies of methods.Therefore, when you’re implementing a class, references to attributes and methods must be fully qualified. For example, in methods you always ref- erence attributes of the instance through self. Thus, in the example you use self.balance, not balance. This also applies if you want to call a method from another method, as shown in the following example:\n\nF h Lib f L Bdff\n\nInheritance\n\n119\n\nclass Foo(object): def bar(self):\n\nprint(\"bar!\")\n\ndef spam(self):\n\nbar(self) # Incorrect! 'bar' generates a NameError self.bar() # This works Foo.bar(self) # This also works\n\nThe lack of scoping in classes is one area where Python differs from C++ or Java. If you have used those languages, the self parameter in Python is the same as the this pointer.The explicit use of self is required because Python does not provide a means to explicitly declare variables (that is, a declaration such as int x or float y in C). Without this, there is no way to know whether an assignment to a variable in a method is supposed to be a local variable or if it’s supposed to be saved as an instance attribute. The explicit use of self fixes this—all values stored on self are part of the instance and all other assignments are just local variables.\n\nInheritance Inheritance is a mechanism for creating a new class that specializes or modifies the behavior of an existing class.The original class is called a base class or a superclass.The new class is called a derived class or a subclass.When a class is created via inheritance, it “inherits” the attributes defined by its base classes. However, a derived class may redefine any of these attributes and add new attributes of its own.\n\nInheritance is specified with a comma-separated list of base-class names in the class\n\nstatement. If there is no logical base class, a class inherits from object, as has been shown in prior examples. object is a class which is the root of all Python objects and which provides the default implementation of some common methods such as __str__(), which creates a string for use in printing.\n\nInheritance is often used to redefine the behavior of existing methods.As an exam-\n\nple, here’s a specialized version of Account that redefines the inquiry() method to periodically overstate the current balance with the hope that someone not paying close attention will overdraw his account and incur a big penalty when making a payment on their subprime mortgage:\n\nimport random class EvilAccount(Account): def inquiry(self):\n\nif random.randint(0,4) == 1:\n\nreturn self.balance * 1.10 # Note: Patent pending idea\n\nelse:\n\nreturn self.balance\n\nc = EvilAccount(\"George\", 1000.00) c.deposit(10.0) # Calls Account.deposit(c,10.0) available = c.inquiry() # Calls EvilAccount.inquiry(c)\n\nIn this example, instances of EvilAccount are identical to instances of Account except for the redefined inquiry() method.\n\nInheritance is implemented with only a slight enhancement of the dot (.) operator.\n\nSpecifically, if the search for an attribute doesn’t find a match in the instance or the instance’s class, the search moves on to the base class.This process continues until there are no more base classes to search. In the previous example, this explains why c.deposit() calls the implementation of deposit() defined in the Account class.\n\nF h Lib f L Bdff\n\n120\n\nChapter 7 Classes and Object-Oriented Programming\n\nA subclass can add new attributes to the instances by defining its own version of\n\n__init__(). For example, this version of EvilAccount adds a new attribute evilfactor:\n\nclass EvilAccount(Account):\n\ndef __init__(self,name,balance,evilfactor):\n\nAccount.__init__(self,name,balance) # Initialize Account self.evilfactor = evilfactor\n\ndef inquiry(self):\n\nif random.randint(0,4) == 1:\n\nreturn self.balance * self.evilfactor\n\nelse:\n\nreturn self.balance\n\nWhen a derived class defines __init__(), the __init__() methods of base classes are not automatically invoked.Therefore, it’s up to a derived class to perform the proper initialization of the base classes by calling their __init__() methods. In the previous example, this is shown in the statement that calls Account.__init__(). If a base class does not define __init__(), this step can be omitted. If you don’t know whether the base class defines __init__(), it is always safe to call it without any arguments because there is always a default implementation that simply does nothing.\n\nOccasionally, a derived class will reimplement a method but also want to call the original implementation.To do this, a method can explicitly call the original method in the base class, passing the instance self as the first parameter as shown here:\n\nclass MoreEvilAccount(EvilAccount):\n\ndef deposit(self,amount):\n\nself.withdraw(5.00) # Subtract the \"convenience\" fee EvilAccount.deposit(self,amount) # Now, make deposit\n\nA subtlety in this example is that the class EvilAccount doesn’t actually implement the deposit() method. Instead, it is implemented in the Account class.Although this code works, it might be confusing to someone reading the code (e.g., was EvilAccount sup- posed to implement deposit()?).Therefore, an alternative solution is to use the super() function as follows:\n\nclass MoreEvilAccount(EvilAccount):\n\ndef deposit(self,amount):\n\nself.withdraw(5.00) # Subtract convenience fee super(MoreEvilAccount,self).deposit(amount) # Now, make deposit\n\nsuper(cls, instance) returns a special object that lets you perform attribute lookups on the base classes. If you use this, Python will search for an attribute using the normal search rules that would have been used on the base classes.This frees you from hard-coding the exact location of a method and more clearly states your intentions (that is, you want to call the previous implementation without regard for which base class defines it). Unfortunately, the syntax of super() leaves much to be desired. If you are using Python 3, you can use the simplified statement super().deposit(amount) to carry out the calculation shown in the example. In Python 2, however, you have to use the more verbose version.\n\nPython supports multiple inheritance.This is specified by having a class list multiple\n\nbase classes. For example, here are a collection of classes:\n\nF h Lib f L Bdff\n\nInheritance\n\n121\n\nclass DepositCharge(object):\n\nfee = 5.00 def deposit_fee(self):\n\nself.withdraw(self.fee)\n\nclass WithdrawCharge(object):\n\nfee = 2.50 def withdraw_fee(self):\n\nself.withdraw(self.fee)\n\n# Class using multiple inheritance class MostEvilAccount(EvilAccount, DepositCharge, WithdrawCharge):\n\ndef deposit(self,amt): self.deposit_fee() super(MostEvilAccount,self).deposit(amt)\n\ndef withdraw(self,amt): self.withdraw_fee() super(MostEvilAcount,self).withdraw(amt)\n\nWhen multiple inheritance is used, attribute resolution becomes considerably more complicated because there are many possible search paths that could be used to bind attributes.To illustrate the possible complexity, consider the following statements:\n\nd = MostEvilAccount(\"Dave\",500.00,1.10) d.deposit_fee() # Calls DepositCharge.deposit_fee(). Fee is 5.00 d.withdraw_fee() # Calls WithdrawCharge.withdraw_fee(). Fee is 5.00 ??\n\nIn this example, methods such as deposit_fee() and withdraw_fee() are uniquely named and found in their respective base classes. However, the withdraw_fee() func- tion doesn’t seem to work right because it doesn’t actually use the value of fee that was initialized in its own class.What has happened is that the attribute fee is a class variable defined in two different base classes. One of those values is used, but which one? (Hint: it’s DepositCharge.fee.)\n\nTo find attributes with multiple inheritance, all base classes are ordered in a list from the “most specialized” class to the “least specialized” class.Then, when searching for an attribute, this list is searched in order until the first definition of the attribute is found. In the example, the class EvilAccount is more specialized than Account because it inherits from Account. Similarly, within MostEvilAccount, DepositCharge is con- sidered to be more specialized than WithdrawCharge because it is listed first in the list of base classes. For any given class, the ordering of base classes can be viewed by print- ing its __mro__ attribute. Here’s an example:\n\n>>> MostEvilAccount.__mro__ (<class '__main__.MostEvilAccount'>,\n\n<class '__main__.EvilAccount'>, <class '__main__.Account'>, <class '__main__.DepositCharge'>, <class '__main__.WithdrawCharge'>, <type 'object'>)\n\n>>>\n\nIn most cases, this list is based on rules that “make sense.”That is, a derived class is always checked before its base classes and if a class has more than one parent, the parents are always checked in the same order as listed in the class definition. However, the pre- cise ordering of base classes is actually quite complex and not based on any sort of “simple” algorithm such as depth-first or breadth-first search. Instead, the ordering is determined according to the C3 linearization algorithm, which is described in the paper “A Monotonic Superclass Linearization for Dylan” (K. Barrett, et al, presented at\n\nF h Lib f L Bdff\n\n122\n\nChapter 7 Classes and Object-Oriented Programming\n\nOOPSLA’96).A subtle aspect of this algorithm is that certain class hierarchies will be rejected by Python with a TypeError. Here’s an example:\n\nclass X(object): pass class Y(X): pass class Z(X,Y): pass # TypeError.\n\n# Can't create consistent method resolution order__\n\nIn this case, the method resolution algorithm rejects class Z because it can’t determine an ordering of the base classes that makes sense. For example, the class X appears before class Y in the inheritance list, so it must be checked first. However, class Y is more spe- cialized because it inherits from X.Therefore, if X is checked first, it would not be possi- ble to resolve specialized methods in Y. In practice, these issues should rarely arise—and if they do, it usually indicates a more serious design problem with a program.\n\nAs a general rule, multiple inheritance is something best avoided in most programs. However, it is sometimes used to define what are known as mixin classes.A mixin class typically defines a set of methods that are meant to be “mixed in” to other classes in order to add extra functionality (almost like a macro).Typically, the methods in a mixin will assume that other methods are present and will build upon them.The DepositCharge and WithdrawCharge classes in the earlier example illustrate this. These classes add new methods such as deposit_fee() to classes that include them as one of the base classes. However, you would never instantiate DepositCharge by itself. In fact, if you did, it wouldn’t create an instance that could be used for anything useful (that is, the one defined method wouldn’t even execute correctly).\n\nJust as a final note, if you wanted to fix the problematic references to fee in this example, the implementation of deposit_fee() and withdraw_fee() should be changed to refer to the attribute directly using the class name instead of self (for example, DepositChange.fee).\n\nPolymorphism Dynamic Binding and Duck Typing Dynamic binding (also sometimes referred to as polymorphism when used in the context of inheritance) is the capability to use an instance without regard for its type. It is handled entirely through the attribute lookup process described for inheritance in the preceding section.Whenever an attribute is accessed as obj.attr, attris located by searching within the instance itself, the instance’s class definition, and then base classes, in that order.The first match found is returned.\n\nA critical aspect of this binding process is that it is independent of what kind of object objis.Thus, if you make a lookup such as obj.name, it will work on any obj that happens to have a name attribute.This behavior is sometimes referred to as duck typing in reference to the adage “if it looks like, quacks like, and walks like a duck, then it’s a duck.”\n\nPython programmers often write programs that rely on this behavior. For example, if\n\nyou want to make a customized version of an existing object, you can either inherit from it or you can simply create a completely new object that looks and acts like it but is otherwise unrelated.This latter approach is often used to maintain a loose coupling of program components. For example, code may be written to work with any kind of object whatsoever as long as it has a certain set of methods. One of the most common examples is with various “file-like” objects defined in the standard library.Although these objects work like files, they don’t inherit from the built-in file object.\n\nF h Lib f L Bdff\n\nStatic Methods and Class Methods\n\n123\n\nStatic Methods and Class Methods In a class definition, all functions are assumed to operate on an instance, which is always passed as the first parameter self. However, there are two other common kinds of methods that can be defined.\n\nA static method is an ordinary function that just happens to live in the namespace\n\ndefined by a class. It does not operate on any kind of instance.To define a static method, use the @staticmethod decorator as shown here:\n\nclass Foo(object): @staticmethod def add(x,y):\n\nreturn x + y\n\nTo call a static method, you just prefix it by the class name.You do not pass it any addi- tional information. For example:\n\nx = Foo.add(3,4) # x = 7\n\nA common use of static methods is in writing classes where you might have many dif- ferent ways to create new instances. Because there can only be one __init__() func- tion, alternative creation functions are often defined as shown here:\n\nclass Date(object):\n\ndef __init__(self,year,month,day):\n\nself.year = year self.month = month self.day = day\n\n@staticmethod def now():\n\nt = time.localtime() return Date(t.tm_year, t.tm_mon, t.tm_day)\n\n@staticmethod def tomorrow():\n\nt = time.localtime(time.time()+86400) return Date(t.tm_year, t.tm_mon, t.tm_day)\n\n# Example of creating some dates a = Date(1967, 4, 9) b = Date.now() # Calls static method now() c = Date.tomorrow() # Calls static method tomorrow()\n\nClass methods are methods that operate on the class itself as an object. Defined using the @classmethod decorator, a class method is different than an instance method in that the class is passed as the first argument which is named cls by convention. For example:\n\nclass Times(object):\n\nfactor = 1 @classmethod def mul(cls,x):\n\nreturn cls.factor*x\n\nclass TwoTimes(Times):\n\nfactor = 2\n\nx = TwoTimes.mul(4) # Calls Times.mul(TwoTimes, 4) -> 8\n\nF h Lib f L Bdff\n\n124\n\nChapter 7 Classes and Object-Oriented Programming\n\nIn this example, notice how the class TwoTimes is passed to mul() as an object. Although this example is esoteric, there are practical, but subtle, uses of class methods. As an example, suppose that you defined a class that inherited from the Date class shown previously and customized it slightly:\n\nclass EuroDate(Date):\n\n# Modify string conversion to use European dates def __str__(self):\n\nreturn \"%02d/%02d/%4d\" % (self.day, self.month, self.year)\n\nBecause the class inherits from Date, it has all of the same features. However, the now() and tomorrow() methods are slightly broken. For example, if someone calls EuroDate.now(), a Date object is returned instead of a EuroDate object.A class method can fix this:\n\nclass Date(object):\n\n... @classmethod def now(cls):\n\nt = time.localtime() # Create an object of the appropriate type return cls(t.tm_year, t.tm_month, t.tm_day)\n\nclass EuroDate(Date):\n\n...\n\na = Date.now() # Calls Date.now(Date) and returns a Date b = EuroDate.now() # Calls Date.now(EuroDate) and returns a EuroDate\n\nOne caution about static and class methods is that Python does not manage these meth- ods in a separate namespace than the instance methods.As a result, they can be invoked on an instance. For example:\n\na = Date(1967,4,9) b = d.now() # Calls Date.now(Date)\n\nThis is potentially quite confusing because a call to d.now() doesn’t really have any- thing to do with the instance d.This behavior is one area where the Python object sys- tem differs from that found in other OO languages such as Smalltalk and Ruby. In those languages, class methods are strictly separate from instance methods.\n\nProperties Normally, when you access an attribute of an instance or a class, the associated value that is stored is returned.A property is a special kind of attribute that computes its value when accessed. Here is a simple example:\n\nclass Circle(object):\n\ndef __init__(self,radius): self.radius = radius\n\n# Some additional properties of Circles @property def area(self):\n\nreturn math.pi*self.radius**2\n\n@property def perimeter(self):\n\nreturn 2*math.pi*self.radius\n\nF h Lib f L Bdff",
      "page_number": 127
    },
    {
      "number": 8,
      "title": "Segment 8 (pages 149-167)",
      "start_page": 149,
      "end_page": 167,
      "detection_method": "synthetic",
      "content": "Properties\n\n125\n\nThe resulting Circle object behaves as follows:\n\n>>> c = Circle(4.0) >>> c.radius 4.0 >>> c.area 50.26548245743669 >>> c.perimeter 25.132741228718345 >>> c.area = 2 Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nAttributeError: can't set attribute >>>\n\nIn this example, Circle instances have an instance variable c.radius that is stored. c.area and c.perimeter are simply computed from that value.The @property deco- rator makes it possible for the method that follows to be accessed as a simple attribute, without the extra () that you would normally have to add to call the method.To the user of the object, there is no obvious indication that an attribute is being computed other than the fact that an error message is generated if an attempt is made to redefine the attribute (as shown in the AttributeError exception above).\n\nUsing properties in this way is related to something known as the Uniform Access Principle. Essentially, if you’re defining a class, it is always a good idea to make the pro- gramming interface to it as uniform as possible.Without properties, certain attributes of an object would be accessed as a simple attribute such as c.radius whereas other attributes would be accessed as methods such as c.area(). Keeping track of when to add the extra () adds unnecessary confusion.A property can fix this.\n\nPython programmers don’t often realize that methods themselves are implicitly han-\n\ndled as a kind of property. Consider this class:\n\nclass Foo(object):\n\ndef __init__(self,name): self.name = name\n\ndef spam(self,x):\n\nprint(\"%s, %s\" % (self.name, x)\n\nWhen a user creates an instance such as f = Foo(\"Guido\") and then accesses f.spam, the original function object spam is not returned. Instead, you get something known as a bound method, which is an object that represents the method call that will execute when the () operator is invoked on it.A bound method is like a partially evaluated function where the self parameter has already been filled in, but the additional argu- ments still need to be supplied by you when you call it using ().The creation of this bound method object is silently handled through a property function that executes behind the scenes.When you define static and class methods using @staticmethod and @classmethod, you are actually specifying the use of a different property function that will handle the access to those methods in a different way. For example, @staticmethod simply returns the method function back “as is” without any special wrapping or processing.\n\nProperties can also intercept operations to set and delete an attribute.This is done by\n\nattaching additional setter and deleter methods to a property. Here is an example:\n\nF h Lib f L Bdff\n\n126\n\nChapter 7 Classes and Object-Oriented Programming\n\nclass Foo(object):\n\ndef __init__(self,name):\n\nself.__name = name\n\n@property def name(self):\n\nreturn self.__name\n\n@name.setter def name(self,value):\n\nif not isinstance(value,str):\n\nraise TypeError(\"Must be a string!\")\n\nself.__name = value\n\n@name.deleter def name(self):\n\nraise TypeError(\"Can't delete name\")\n\nf = Foo(\"Guido\") n = f.name # calls f.name() - get function f.name = \"Monty\" # calls setter name(f,\"Monty\") f.name = 45 # calls setter name(f,45) -> TypeError del f.name # Calls deleter name(f) -> TypeError\n\nIn this example, the attribute name is first defined as a read-only property using the @property decorator and associated method.The @name.setter and @name.deleter decorators that follow are associating additional methods with the set and deletion operations on the name attribute.The names of these methods must exactly match the name of the original property. In these methods, notice that the actual value of the name is stored in an attribute __name.The name of the stored attribute does not have to follow any convention, but it has to be different than the property in order to distin- guish it from the name of the property itself.\n\nIn older code, you will often see properties defined using the property(getf=None, setf=None, delf=None, doc=None) function with a set of uniquely named methods for carrying out each operation. For example:\n\nclass Foo(object):\n\ndef getname(self):\n\nreturn self.__name\n\ndef setname(self,value):\n\nif not isinstance(value,str):\n\nraise TypeError(\"Must be a string!\")\n\nself.__name = value\n\ndef delname(self):\n\nraise TypeError(\"Can't delete name\") name = property(getname,setname,delname)\n\nThis older approach is still supported, but the decorator version tends to lead to classes that are a little more polished. For example, if you use decorators, the get, set, and delete functions aren’t also visible as methods.\n\nDescriptors With properties, access to an attribute is controlled by a series of user-defined get, set, and delete functions.This sort of attribute control can be further generalized through the use of a descriptor object.A descriptor is simply an object that represents the value of an attribute. By implementing one or more of the special methods __get__(), __set__(), and __delete__(), it can hook into the attribute access mechanism and can customize those operations. Here is an example:\n\nF h Lib f L Bdff\n\nData Encapsulation and Private Attributes\n\n127\n\nclass TypedProperty(object):\n\ndef __init__(self,name,type,default=None):\n\nself.name = \"_\" + name self.type = type\n\nself.default = default if default else type()\n\ndef __get__(self,instance,cls):\n\nreturn getattr(instance,self.name,self.default)\n\ndef __set__(self,instance,value):\n\nif not isinstance(value,self.type):\n\nraise TypeError(\"Must be a %s\" % self.type)\n\nsetattr(instance,self.name,value)\n\ndef __delete__(self,instance):\n\nraise AttributeError(\"Can't delete attribute\")\n\nclass Foo(object):\n\nname = TypedProperty(\"name\",str) num = TypedProperty(\"num\",int,42)\n\nIn this example, the class TypedProperty defines a descriptor where type checking is performed when the attribute is assigned and an error is produced if an attempt is made to delete the attribute. For example:\n\nf = Foo() a = f.name # Implicitly calls Foo.name.__get__(f,Foo) f.name = \"Guido\" # Calls Foo.name.__set__(f,\"Guido\") del f.name # Calls Foo.name.__delete__(f)\n\nDescriptors can only be instantiated at the class level. It is not legal to create descriptors on a per-instance basis by creating descriptor objects inside __init__() and other methods.Also, the attribute name used by the class to hold a descriptor takes prece- dence over attributes stored on instances. In the previous example, this is why the descriptor object takes a name parameter and why the name is changed slightly by inserting a leading underscore. In order for the descriptor to store a value on the instance, it has to pick a name that is different than that being used by the descriptor itself.\n\nData Encapsulation and Private Attributes By default, all attributes and methods of a class are “public.”This means that they are all accessible without any restrictions. It also implies that everything defined in a base class is inherited and accessible within a derived class.This behavior is often undesirable in object-oriented applications because it exposes the internal implementation of an object and can lead to namespace conflicts between objects defined in a derived class and those defined in a base class.\n\nTo fix this problem, all names in a class that start with a double underscore, such as __Foo, are automatically mangled to form a new name of the form _Classname__Foo. This effectively provides a way for a class to have private attributes and methods because private names used in a derived class won’t collide with the same private names used in a base class. Here’s an example:\n\nclass A(object):\n\ndef __init__(self):\n\nself.__X = 3 # Mangled to self._A__X def __spam(self): # Mangled to _A__spam()\n\npass\n\ndef bar(self):\n\nself.__spam() # Only calls A.__spam()\n\nF h Lib f L Bdff\n\n128\n\nChapter 7 Classes and Object-Oriented Programming\n\nclass B(A):\n\ndef __init__(self):\n\nA.__init__(self) self.__X = 37 # Mangled to self._B__X def __spam(self): # Mangled to _B__spam()\n\npass\n\nAlthough this scheme provides the illusion of data hiding, there’s no strict mechanism in place to actually prevent access to the “private” attributes of a class. In particular, if the name of the class and corresponding private attribute are known, they can be accessed using the mangled name.A class can make these attributes less visible by redefining the __dir__() method, which supplies the list of names returned by the dir() function that’s used to inspect objects.\n\nAlthough this name mangling might look like an extra processing step, the mangling process actually only occurs once at the time a class is defined. It does not occur during execution of the methods, nor does it add extra overhead to program execution.Also, be aware that name mangling does not occur in functions such as getattr(), hasattr(), setattr(), or delattr() where the attribute name is specified as a string. For these functions, you need to explicitly use the mangled name such as _Classname__nameto access the attribute.\n\nIt is recommended that private attributes be used when defining mutable attributes via properties. By doing so, you will encourage users to use the property name rather than accessing the underlying instance data directly (which is probably not what you intended if you wrapped it with a property to begin with).An example of this appeared in the previous section.\n\nGiving a method a private name is a technique that a superclass can use to prevent a derived class from redefining and changing the implementation of a method. For exam- ple, the A.bar() method in the example only calls A.__spam(), regardless of the type of self or the presence of a different __spam() method in a derived class.\n\nFinally, don’t confuse the naming of private class attributes with the naming of “pri-\n\nvate” definitions in a module.A common mistake is to define a class where a single leading underscore is used on attribute names in an effort to hide their values (e.g., _name). In modules, this naming convention prevents names from being exported by the from module import * statement. However, in classes, this naming convention does not hide the attribute nor does it prevent name clashes that arise if someone inherits from the class and defines a new attribute or method with the same name.\n\nObject Memory Management When a class is defined, the resulting class is a factory for creating new instances. For example:\n\nclass Circle(object):\n\ndef __init__(self,radius):\n\nself.radius = radius\n\n# Create some Circle instances c = Circle(4.0) d = Circle(5.0)\n\nF h Lib f L Bdff\n\nObject Memory Management\n\n129\n\nThe creation of an instance is carried out in two steps using the special method __new__(), which creates a new instance, and __init__(), which initializes it. For example, the operation c = Circle(4.0) performs these steps:\n\nc = Circle.__new__(Circle, 4.0) if isinstance(c,Circle):\n\nCircle.__init__(c,4.0)\n\nThe __new__() method of a class is something that is rarely defined by user code. If it is defined, it is typically written with the prototype __new__(cls, *args, **kwargs) where args and kwargs are the same arguments that will be passed to __init__(). __new__() is always a class method that receives the class object as the first parameter.Although __new__() creates an instance, it does not automatically call __init__().\n\nIf you see __new__() defined in a class, it usually means the class is doing one of\n\ntwo things. First, the class might be inheriting from a base class whose instances are immutable.This is common if defining objects that inherit from an immutable built-in type such as an integer, string, or tuple because __new__() is the only method that executes prior to the instance being created and is the only place where the value could be modified (in __init__(), it would be too late). For example:\n\nclass Upperstr(str):\n\ndef __new__(cls,value=\"\"):\n\nreturn str.__new__(cls, value.upper())\n\nu = Upperstr(\"hello\") # value is \"HELLO\"\n\nThe other major use of __new__() is when defining metaclasses.This is described at the end of this chapter.\n\nOnce created, instances are managed by reference counting. If the reference count reaches zero, the instance is immediately destroyed.When the instance is about to be destroyed, the interpreter first looks for a __del__() method associated with the object and calls it. In practice, it’s rarely necessary for a class to define a __del__() method.The only exception is when the destruction of an object requires a cleanup action such as closing a file, shutting down a network connection, or releasing other system resources. Even in these cases, it’s dangerous to rely on __del__() for a clean shutdown because there’s no guarantee that this method will be called when the inter- preter exits.A better approach may be to define a method such as close() that a pro- gram can use to explicitly perform a shutdown.\n\nOccasionally, a program will use the del statement to delete a reference to an object. If this causes the reference count of the object to reach zero, the __del__() method is called. However, in general, the del statement doesn’t directly call __del__().\n\nA subtle danger involving object destruction is that instances for which __del__()\n\nis defined cannot be collected by Python’s cyclic garbage collector (which is a strong reason not to define __del__ unless you need to). Programmers coming from lan- guages without automatic garbage collection (e.g., C++) should take care not to adopt a programming style where __del__() is unnecessarily defined.Although it is rare to break the garbage collector by defining __del__(), there are certain types of program- ming patterns, especially those involving parent-child relationships or graphs, where this\n\nF h Lib f L Bdff\n\n130\n\nChapter 7 Classes and Object-Oriented Programming\n\ncan be a problem. For example, suppose you had an object that was implementing a variant of the “Observer Pattern.”\n\nclass Account(object):\n\ndef __init__(self,name,balance):\n\nself.name = name self.balance = balance self.observers = set()\n\ndef __del__(self):\n\nfor ob in self.observers:\n\nob.close() del self.observers def register(self,observer):\n\nself.observers.add(observer)\n\ndef unregister(self,observer):\n\nself.observers.remove(observer)\n\ndef notify(self):\n\nfor ob in self.observers:\n\nob.update()\n\ndef withdraw(self,amt): self.balance -= amt self.notify()\n\nclass AccountObserver(object):\n\ndef __init__(self, theaccount): self.theaccount = theaccount theaccount.register(self)\n\ndef __del__(self):\n\nself.theaccount.unregister(self) del self.theaccount\n\ndef update(self):\n\nprint(\"Balance is %0.2f\" % self.theaccount.balance)\n\ndef close(self):\n\nprint(\"Account no longer in use\")\n\n# Example setup a = Account('Dave',1000.00) a_ob = AccountObserver(a)\n\nIn this code, the Account class allows a set of AccountObserver objects to monitor an Account instance by receiving an update whenever the balance changes.To do this, each Account keeps a set of the observers and each AccountObserver keeps a refer- ence back to the account. Each class has defined __del__() in an attempt to provide some sort of cleanup (such as unregistering and so on). However, it just doesn’t work. Instead, the classes have created a reference cycle in which the reference count never drops to 0 and there is no cleanup. Not only that, the garbage collector (the gc module) won’t even clean it up, resulting in a permanent memory leak.\n\nOne way to fix the problem shown in this example is for one of the classes to create\n\na weak reference to the other using the weakref module.A weak reference is a way of creating a reference to an object without increasing its reference count.To work with a weak reference, you have to add an extra bit of functionality to check whether the object being referred to still exists. Here is an example of a modified observer class:\n\nimport weakref class AccountObserver(object):\n\ndef __init__(self, theaccount):\n\nself.accountref = weakref.ref(theaccount) # Create a weakref theaccount.register(self)\n\nF h Lib f L Bdff\n\nObject Representation and Attribute Binding\n\n131\n\ndef __del__(self):\n\nacc = self.accountref() # Get account if acc: # Unregister if still exists\n\nacc.unregister(self)\n\ndef update(self):\n\nprint(\"Balance is %0.2f\" % self.accountref().balance)\n\ndef close(self):\n\nprint(\"Account no longer in use\")\n\n# Example setup a = Account('Dave',1000.00) a_ob = AccountObserver(a)\n\nIn this example, a weak reference accountref is created.To access the underlying Account, you call it like a function.This either returns the Account or None if it’s no longer around.With this modification, there is no longer a reference cycle. If the Account object is destroyed, its __del__ method runs and observers receive notifica- tion.The gc module also works properly. More information about the weakref module can be found in Chapter 13,“Python Runtime Services.”\n\nObject Representation and Attribute Binding Internally, instances are implemented using a dictionary that’s accessible as the instance’s __dict__ attribute.This dictionary contains the data that’s unique to each instance. Here’s an example:\n\n>>> a = Account('Guido', 1100.0) >>> a.__dict__ {'balance': 1100.0, 'name': 'Guido'}\n\nNew attributes can be added to an instance at any time, like this:\n\na.number = 123456 # Add attribute 'number' to a.__dict__\n\nModifications to an instance are always reflected in the local __dict__ attribute. Likewise, if you make modifications to __dict__ directly, those modifications are reflected in the attributes.\n\nInstances are linked back to their class by a special attribute __class__.The class itself is also just a thin layer over a dictionary which can be found in its own __dict__ attribute.The class dictionary is where you find the methods. For example:\n\n>>> a.__class__ <class '__main__.Account'> >>> Account.__dict__.keys() ['__dict__', '__module__', 'inquiry', 'deposit', 'withdraw', '__del__', 'num_accounts', '__weakref__', '__doc__', '__init__'] >>>\n\nFinally, classes are linked to their base classes in a special attribute __bases__, which is a tuple of the base classes.This underlying structure is the basis for all of the operations that get, set, and delete the attributes of objects.\n\nWhenever an attribute is set using obj.name = value, the special method\n\nobj.__setattr__(\"name\", value) is invoked. If an attribute is deleted using del obj.name, the special method obj.__delattr__(\"name\") is invoked.The default behavior of these methods is to modify or remove values from the local __dict__ of obj unless the requested attribute happens to correspond to a property or descriptor. In\n\nF h Lib f L Bdff\n\n132\n\nChapter 7 Classes and Object-Oriented Programming\n\nthat case, the set and delete operation will be carried out by the set and delete functions associated with the property.\n\nFor attribute lookup such as obj.name, the special method\n\nobj.__getattrribute__(\"name\") is invoked.This method carries out the search process for finding the attribute, which normally includes checking for properties, look- ing in the local __dict__ attribute, checking the class dictionary, and searching the base classes. If this search process fails, a final attempt to find the attribute is made by trying to invoke the __getattr__() method of the class (if defined). If this fails, an AttributeError exception is raised.\n\nUser-defined classes can implement their own versions of the attribute access func-\n\ntions, if desired. For example:\n\nclass Circle(object):\n\ndef __init__(self,radius): self.radius = radius def __getattr__(self,name): if name == 'area':\n\nreturn math.pi*self.radius**2\n\nelif name == 'perimeter':\n\nreturn 2*math.pi*self.radius\n\nelse:\n\nreturn object.__getattr__(self,name)\n\ndef __setattr__(self,name,value):\n\nif name in ['area','perimeter']:\n\nraise TypeError(\"%s is readonly\" % name)\n\nobject.__setattr__(self,name,value)\n\nA class that reimplements these methods should probably rely upon the default imple- mentation in object to carry out the actual work.This is because the default imple- mentation takes care of the more advanced features of classes such as descriptors and properties.\n\nAs a general rule, it is relatively uncommon for classes to redefine the attribute access\n\noperators. However, one application where they are often used is in writing general- purpose wrappers and proxies to existing objects. By redefining __getattr__(), __setattr__(), and __delattr__(), a proxy can capture attribute access and trans- parently forward those operations on to another object.\n\n__slots__ A class can restrict the set of legal instance attribute names by defining a special variable called __slots__. Here’s an example:\n\nclass Account(object):\n\n__slots__ = ('name','balance')\n\n...\n\nWhen __slots__ is defined, the attribute names that can be assigned on instances are restricted to the names specified. Otherwise, an AttributeError exception is raised. This restriction prevents someone from adding new attributes to existing instances and solves the problem that arises if someone assigns a value to an attribute that they can’t spell correctly.\n\nIn reality, __slots__ was never implemented to be a safety feature. Instead, it is actually a performance optimization for both memory and execution speed. Instances of a class that uses __slots__ no longer use a dictionary for storing instance data. Instead, a much more compact data structure based on an array is used. In programs that\n\nF h Lib f L Bdff\n\nOperator Overloading\n\n133\n\ncreate a large number of objects, using __slots__ can result in a substantial reduction in memory use and execution time.\n\nBe aware that the use of __slots__ has a tricky interaction with inheritance. If a class inherits from a base class that uses __slots__, it also needs to define __slots__ for storing its own attributes (even if it doesn’t add any) to take advantage of the bene- fits __slots__ provides. If you forget this, the derived class will run slower and use even more memory than what would have been used if __slots__ had not been used on any of the classes!\n\nThe use of __slots__ can also break code that expects instances to have an under-\n\nlying __dict__ attribute.Although this often does not apply to user code, utility libraries and other tools for supporting objects may be programmed to look at __dict__ for debugging, serializing objects, and other operations.\n\nFinally, the presence of __slots__ has no effect on the invocation of methods such as __getattribute__(), __getattr__(), and __setattr__() should they be rede- fined in a class. However, the default behavior of these methods will take __slots__ into account. In addition, it should be stressed that it is not necessary to add method or property names to __slots__, as they are stored in the class, not on a per-instance basis.\n\nOperator Overloading User-defined objects can be made to work with all of Python’s built-in operators by adding implementations of the special methods described in Chapter 3 to a class. For example, if you wanted to add a new kind of number to Python, you could define a class in which special methods such as __add__() were defined to make instances work with the standard mathematical operators.\n\nThe following example shows how this works by defining a class that implements\n\nthe complex numbers with some of the standard mathematical operators.\n\nNote\n\nBecause Python already provides a complex number type, this class is only provided for the purpose of illustration.\n\nclass Complex(object):\n\ndef __init__(self,real,imag=0): self.real = float(real) self.imag = float(imag)\n\ndef __repr__(self):\n\nreturn \"Complex(%s,%s)\" % (self.real, self.imag)\n\ndef __str__(self):\n\nreturn \"(%g+%gj)\" % (self.real, self.imag)\n\n# self + other def __add__(self,other):\n\nreturn Complex(self.real + other.real, self.imag + other.imag)\n\n# self - other def __sub__(self,other):\n\nreturn Complex(self.real - other.real, self.imag - other.imag)\n\nIn the example, the __repr__() method creates a string that can be evaluated to re- create the object (that is, \"Complex(real,imag)\").This convention should be followed for all user-defined objects as applicable. On the other hand, the __str__() method\n\nF h Lib f L Bdff\n\n134\n\nChapter 7 Classes and Object-Oriented Programming\n\ncreates a string that’s intended for nice output formatting (this is the string that would be produced by the print statement).\n\nThe other operators, such as __add__() and __sub__(), implement mathematical\n\noperations.A delicate matter with these operators concerns the order of operands and type coercion.As implemented in the previous example, the __add__() and __sub__() operators are applied only if a complex number appears on the left side of the operator.They do not work if they appear on the right side of the operator and the left-most operand is not a Complex. For example:\n\n>>> c = Complex(2,3) >>> c + 4.0 Complex(6.0,3.0) >>> 4.0 + c Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: unsupported operand type(s) for +: 'int' and 'Complex'\n\n>>>\n\nThe operation c + 4.0 works partly by accident.All of Python’s built-in numbers already have .real and .imag attributes, so they were used in the calculation. If the other object did not have these attributes, the implementation would break. If you want your implementation of Complex to work with objects missing these attributes, you have to add extra conversion code to extract the needed information (which might depend on the type of the other object).\n\nThe operation 4.0 + c does not work at all because the built-in floating point type\n\ndoesn’t know anything about the Complex class.To fix this, you can add reversed- operand methods to Complex:\n\nclass Complex(object):\n\n... def __radd__(self,other):\n\nreturn Complex(other.real + self.real, other.imag + self.imag)\n\ndef __rsub__(self,other):\n\nreturn Complex(other.real - self.real, other.imag - self.img)\n\n...\n\nThese methods serve as a fallback. If the operation 4.0 + c fails, Python tries to exe- cute c.__radd__(4.0) first before issuing a TypeError.\n\nOlder versions of Python have tried various approaches to coerce types in mixed- type operations. For example, you might encounter legacy Python classes that imple- ment a __coerce__() method.This is no longer used by Python 2.6 or Python 3. Also, don’t be fooled by special methods such as __int__(), __float__(), or __complex__().Although these methods are called by explicit conversions such as int(x) or float(x), they are never called implicitly to perform type conversion in mixed-type arithmetic. So, if you are writing classes where operators must work with mixed types, you have to explicitly handle the type conversion in the implementation of each operator.\n\nTypes and Class Membership Tests When you create an instance of a class, the type of that instance is the class itself.To test for membership in a class, use the built-in function isinstance(obj,cname).This\n\nF h Lib f L Bdff\n\nTypes and Class Membership Tests\n\n135\n\nfunction returns True if an object, obj, belongs to the class cnameor any class derived from cname. Here’s an example:\n\nclass A(object): pass class B(A): pass class C(object): pass\n\na = A() # Instance of 'A' b = B() # Instance of 'B' c = C() # Instance of 'C'\n\ntype(a) # Returns the class object A isinstance(a,A) # Returns True isinstance(b,A) # Returns True, B derives from A isinstance(b,C) # Returns False, C not derived from A\n\nSimilarly, the built-in function issubclass(A,B) returns True if the class Ais a sub- class of class B. Here’s an example:\n\nissubclass(B,A) # Returns True issubclass(C,A) # Returns False\n\nA subtle problem with type-checking of objects is that programmers often bypass inher- itance and simply create objects that mimic the behavior of another object.As an exam- ple, consider these two classes:\n\nclass Foo(object):\n\ndef spam(self,a,b):\n\npass\n\nclass FooProxy(object):\n\ndef __init__(self,f):\n\nself.f = f def spam(self,a,b):\n\nreturn self.f.spam(a,b)\n\nIn this example, FooProxy is functionally identical to Foo. It implements the same methods, and it even uses Foo underneath the covers.Yet, in the type system, FooProxy is different than Foo. For example:\n\nf = Foo() # Create a Foo g = FooProxy(f) # Create a FooProxy isinstance(g, Foo) # Returns False\n\nIf a program has been written to explicitly check for a Foo using isinstance(), then it certainly won’t work with a FooProxy object. However, this degree of strictness is often not exactly what you want. Instead, it might make more sense to assert that an object can simply be used as Foo because it has the same interface.To do this, it is possible to define an object that redefines the behavior of isinstance() and issubclass() for the purpose of grouping objects together and type-checking. Here is an example:\n\nclass IClass(object):\n\ndef __init__(self):\n\nself.implementors = set()\n\ndef register(self,C):\n\nself.implementors.add(C)\n\ndef __instancecheck__(self,x):\n\nreturn self.__subclasscheck__(type(x))\n\nF h Lib f L Bdff\n\n136\n\nChapter 7 Classes and Object-Oriented Programming\n\ndef __subclasscheck__(self,sub):\n\nreturn any(c in self.implementors for c in sub.mro())\n\n# Now, use the above object IFoo = IClass() IFoo.register(Foo) IFoo.register(FooProxy)\n\nIn this example, the class IClass creates an object that merely groups a collection of other classes together in a set.The register() method adds a new class to the set.The special method __instancecheck__() is called if anyone performs the operation isinstance(x, IClass).The special method __subclasscheck__() is called if the operation issubclass(C,IClass) is called.\n\nBy using the IFoo object and registered implementers, one can now perform type\n\nchecks such as the following:\n\nf = Foo() # Create a Foo g = FooProxy(f) # Create a FooProxy isinstance(f, IFoo) # Returns True isinstance(g, IFoo) # Returns True issubclass(FooProxy, IFoo) # Returns True\n\nIn this example, it’s important to emphasize that no strong type-checking is occurring. The IFoo object has overloaded the instance checking operations in a way that allows a you to assert that a class belongs to a group. It doesn’t assert any information on the actual programming interface, and no other verification actually occurs. In fact, you can simply register any collection of objects you want to group together without regard to how those classes are related to each other.Typically, the grouping of classes is based on some criteria such as all classes implementing the same programming interface. However, no such meaning should be inferred when overloading __instancecheck__() or __subclasscheck__().The actual interpretation is left up to the application.\n\nPython provides a more formal mechanism for grouping objects, defining interfaces,\n\nand type-checking.This is done by defining an abstract base class, which is defined in the next section.\n\nAbstract Base Classes In the last section, it was shown that the isinstance() and issubclass() operations can be overloaded.This can be used to create objects that group similar classes together and to perform various forms of type-checking. Abstract base classes build upon this con- cept and provide a means for organizing objects into a hierarchy, making assertions about required methods, and so forth.\n\nTo define an abstract base class, you use the abc module.This module defines\n\na metaclass (ABCMeta) and a set of decorators (@abstractmethod and @abstractproperty) that are used as follows:\n\nfrom abc import ABCMeta, abstractmethod, abstractproperty class Foo: # In Python 3, you use the syntax __metaclass__ = ABCMeta # class Foo(metaclass=ABCMeta) @abstractmethod def spam(self,a,b):\n\npass\n\n@abstractproperty\n\nF h Lib f L Bdff\n\nAbstract Base Classes\n\n137\n\ndef name(self):\n\npass\n\nThe definition of an abstract class needs to set its metaclass to ABCMeta as shown (also, be aware that the syntax differs between Python 2 and 3).This is required because the implementation of abstract classes relies on a metaclass (described in the next section). Within the abstract class, the @abstractmethod and @abstractproperty decorators specify that a method or property must be implemented by subclasses of Foo.\n\nAn abstract class is not meant to be instantiated directly. If you try to create a Foo for\n\nthe previous class, you will get the following error:\n\n>>> f = Foo() Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: Can't instantiate abstract class Foo with abstract methods spam >>>\n\nThis restriction carries over to derived classes as well. For instance, if you have a class Bar that inherits from Foo but it doesn’t implement one or more of the abstract meth- ods, attempts to create a Bar will fail with a similar error. Because of this added check- ing, abstract classes are useful to programmers who want to make assertions on the methods and properties that must be implemented on subclasses.\n\nAlthough an abstract class enforces rules about methods and properties that must be implemented, it does not perform conformance checking on arguments or return val- ues.Thus, an abstract class will not check a subclass to see whether a method has used the same arguments as an abstract method. Likewise, an abstract class that requires the definition of a property does not check to see whether the property in a subclass sup- ports the same set of operations (get, set, and delete) of the property specified in a base.\n\nAlthough an abstract class can not be instantiated, it can define methods and proper-\n\nties for use in subclasses. Moreover, an abstract method in the base can still be called from a subclass. For example, calling Foo.spam(a,b) from the subclass is allowed.\n\nAbstract base classes allow preexisting classes to be registered as belonging to that\n\nbase.This is done using the register() method as follows:\n\nclass Grok(object):\n\ndef spam(self,a,b):\n\nprint(\"Grok.spam\")\n\nFoo.register(Grok) # Register with Foo abstract base class\n\nWhen a class is registered with an abstract base, type-checking operations involving the abstract base (such as isinstance() and issubclass()) will return True for instances of the registered class.When a class is registered with an abstract class, no checks are made to see whether the class actually implements any of the abstract methods or prop- erties.This registration process only affects type-checking. It does not add extra error checking to the class that is registered.\n\nUnlike many other object-oriented languages, Python’s built-in types are organized into a relatively flat hierarchy. For example, if you look at the built-in types such as int or float, they directly inherit from object, the root of all objects, instead of an inter- mediate base class representing numbers.This makes it clumsy to write programs that want to inspect and manipulate objects based on a generic category such as simply being an instance of a number.\n\nF h Lib f L Bdff\n\n138\n\nChapter 7 Classes and Object-Oriented Programming\n\nThe abstract class mechanism addresses this issue by allowing preexisting objects to be organized into user-definable type hierarchies. Moreover, some library modules aim to organize the built-in types according to different capabilities that they possess.The collections module contains abstract base classes for various kinds of operations involving sequences, sets, and dictionaries.The numbers module contains abstract base classes related to organizing a hierarchy of numbers. Further details can be found in Chapter 14,“Mathematics,” and Chapter 15,“Data Structures,Algorithms, and Utilities.”\n\nMetaclasses When you define a class in Python, the class definition itself becomes an object. Here’s an example:\n\nclass Foo(object): pass isinstance(Foo,object) # Returns True\n\nIf you think about this long enough, you will realize that something had to create the Foo object.This creation of the class object is controlled by a special kind of object called a metaclass. Simply stated, a metaclass is an object that knows how to create and manage classes.\n\nIn the preceding example, the metaclass that is controlling the creation of Foo is a\n\nclass called type. In fact, if you display the type of Foo, you will find out that it is a type:\n\n>>> type(Foo) <type 'type'>\n\nWhen a new class is defined with the class statement, a number of things happen. First, the body of the class is executed as a series of statements within its own private dictionary.The execution of statements is exactly the same as in normal code with the addition of the name mangling that occurs on private members (names that start with __). Finally, the name of the class, the list of base classes, and the dictionary are passed to the constructor of a metaclass to create the corresponding class object. Here is an example of how it works:\n\nclass_name = \"Foo\" # Name of class class_parents = (object,) # Base classes class_body = \"\"\" # Class body def __init__(self,x):\n\nself.x = x\n\ndef blah(self):\n\nprint(\"Hello World\")\n\n\"\"\" class_dict = { } # Execute the body in the local dictionary class_dict exec(class_body,globals(),class_dict)\n\n# Create the class object Foo Foo = type(class_name,class_parents,class_dict)\n\nThe final step of class creation where the metaclass type() is invoked can be cus- tomized.The choice of what happens in the final step of class definition is controlled in\n\nF h Lib f L Bdff\n\nMetaclasses\n\n139\n\na number of ways. First, the class can explicitly specify its metaclass by either setting a __metaclass__ class variable (Python 2), or supplying the metaclass keyword argu- ment in the tuple of base classes (Python 3).\n\nclass Foo: # In Python 3, use the syntax\n\n__metaclass__ = type # class Foo(metaclass=type) ...\n\nIf no metaclass is explicitly specified, the class statement examines the first entry in the tuple of base classes (if any). In this case, the metaclass is the same as the type of the first base class.Therefore, when you write\n\nclass Foo(object): pass\n\nFoo will be the same type of class as object.\n\nIf no base classes are specified, the class statement checks for the existence of a global variable called __metaclass__. If this variable is found, it will be used to create classes. If you set this variable, it will control how classes are created when a simple class statement is used. Here’s an example:\n\n__metaclass__ = type class Foo: pass\n\nFinally, if no __metaclass__ value can be found anywhere, Python uses the default metaclass. In Python 2, this defaults to types.ClassType, which is known as an old- style class.This kind of class, deprecated since Python 2.2, corresponds to the original implementation of classes in Python.Although these classes are still supported, they should be avoided in new code and are not covered further here. In Python 3, the default metaclass is simply type().\n\nThe primary use of metaclasses is in frameworks that want to assert more control over the definition of user-defined objects.When a custom metaclass is defined, it typi- cally inherits from type() and reimplements methods such as __init__() or __new__(). Here is an example of a metaclass that forces all methods to have a documentation string:\n\nclass DocMeta(type):\n\ndef __init__(self,name,bases,dict): for key, value in dict.items():\n\n# Skip special and private methods if key.startswith(\"__\"): continue # Skip anything not callable if not hasattr(value,\"__call__\"): continue # Check for a doc-string if not getattr(value,\"__doc__\"):\n\nraise TypeError(\"%s must have a docstring\" % key)\n\ntype.__init__(self,name,bases,dict)\n\nIn this metaclass, the __init__() method has been written to inspect the contents of the class dictionary. It scans the dictionary looking for methods and checking to see whether they all have documentation strings. If not, a TypeError exception is generat- ed. Otherwise, the default implementation of type.__init__() is called to initialize the class.\n\nTo use this metaclass, a class needs to explicitly select it.The most common tech-\n\nnique for doing this is to first define a base class such as the following:\n\nclass Documented: # In Python 3, use the syntax\n\n__metaclass_ _ = DocMeta # class Documented(metaclass=DocMeta)\n\nF h Lib f L Bdff\n\n140\n\nChapter 7 Classes and Object-Oriented Programming\n\nThis base class is then used as the parent for all objects that are to be documented. For example:\n\nclass Foo(Documented): spam(self,a,b):\n\n\"spam does something\" pass\n\nThis example illustrates one of the major uses of metaclasses, which is that of inspecting and gathering information about class definitions.The metaclass isn’t changing anything about the class that actually gets created but is merely adding some additional checks. In more advanced metaclass applications, a metaclass can both inspect and alter the contents of a class definition prior to the creation of the class. If alterations are going to be made, you should redefine the __new__() method that runs prior to the creation of the class itself.This technique is commonly combined with techniques that wrap attrib- utes with descriptors or properties because it is one way to capture the names being used in the class.As an example, here is a modified version of the TypedProperty descriptor that was used in the “Descriptors” section:\n\nclass TypedProperty(object):\n\ndef __init__(self,type,default=None):\n\nself.name = None self.type = type if default: self.default = default else: self.default = type()\n\ndef __get__(self,instance,cls):\n\nreturn getattr(instance,self.name,self.default)\n\ndef __set__(self,instance,value):\n\nif not isinstance(value,self.type):\n\nraise TypeError(\"Must be a %s\" % self.type)\n\nsetattr(instance,self.name,value)\n\ndef __delete__(self,instance):\n\nraise AttributeError(\"Can't delete attribute\")\n\nIn this example, the name attribute of the descriptor is simply set to None.To fill this in, we’ll rely on a meta class. For example:\n\nclass TypedMeta(type):\n\ndef __new__(cls,name,bases,dict):\n\nslots = [] for key,value in dict.items():\n\nif isinstance(value,TypedProperty):\n\nvalue.name = \"_\" + key slots.append(value.name)\n\ndict['__slots__'] = slots return type.__new__(cls,name,bases,dict)\n\n# Base class for user-defined objects to use class Typed: # In Python 3, use the syntax\n\n__metaclass__ = TypedMeta # class Typed(metaclass=TypedMeta)\n\nIn this example, the metaclass scans the class dictionary and looks for instances of TypedProperty. If found, it sets the name attribute and builds a list of names in slots. After this is done, a __slots__ attribute is added to the class dictionary, and the class is constructed by calling the __new__() method of the type() metaclass. Here is an example of using this new metaclass:\n\nclass Foo(Typed):\n\nname = TypedProperty(str) num = TypedProperty(int,42)\n\nF h Lib f L Bdff\n\nClass Decorators\n\n141\n\nAlthough metaclasses make it possible to drastically alter the behavior and semantics of user-defined classes, you should probably resist the urge to use metaclasses in a way that makes classes work wildly different from what is described in the standard Python doc- umentation. Users will be confused if the classes they must write don’t adhere to any of the normal coding rules expected for classes.\n\nClass Decorators In the previous section, it was shown how the process of creating a class can be cus- tomized by defining a metaclass. However, sometimes all you want to do is perform some kind of extra processing after a class is defined, such as adding a class to a registry or database.An alternative approach for such problems is to use a class decorator.A class decorator is a function that takes a class as input and returns a class as output. For example:\n\nregistry = { } def register(cls):\n\nregistry[cls.__clsid__] = cls return cls\n\nIn this example, the register function looks inside a class for a __clsid__ attribute. If found, it’s used to add the class to a dictionary mapping class identifiers to class objects. To use this function, you can use it as a decorator right before the class definition. For example:\n\n@register class Foo(object):\n\n__clsid__ = \"123-456\" def bar(self):\n\npass\n\nHere, the use of the decorator syntax is mainly one of convenience.An alternative way to accomplish the same thing would have been this:\n\nclass Foo(object):\n\n__clsid__ = \"123-456\" def bar(self):\n\npass\n\nregister(Foo) # Register the class\n\nAlthough it’s possible to think of endless diabolical things one might do to a class in a class decorator function, it’s probably best to avoid excessive magic such as putting a wrapper around the class or rewriting the class contents.\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n8\n\nModules, Packages, and Distribution\n\nLarge Python programs are organized into modules and packages. In addition, a large\n\nnumber of modules are included in the Python standard library.This chapter describes the module and package system in more detail. In addition, it provides information on how to install third-party modules and distribute source code.\n\nModules and the import Statement Any Python source file can be used as a module. For example, consider the following code:\n\n# spam.py a = 37 def foo():\n\nprint(\"I'm foo and a is %s\" % a)\n\ndef bar():\n\nprint(\"I'm bar and I'm calling foo\") foo()\n\nclass Spam(object): def grok(self):\n\nprint(\"I'm Spam.grok\")\n\nTo load this code as a module, use the statement import spam.The first time import is used to load a module, it does three things:\n\n1. It creates a new namespace that serves as a container for all the objects defined in the corresponding source file.This is the namespace accessed when functions and methods defined within the module use the global statement.\n\n2. It executes the code contained in the module within the newly created name- space.\n\n3. It creates a name within the caller that refers to the module namespace.This name matches the name of the module and is used as follows:\n\nimport spam # Loads and executes the module 'spam' x = spam.a # Accesses a member of module 'spam' spam.foo() # Call a function in module 'spam' s = spam.Spam() # Create an instance of spam.Spam() s.grok() ...\n\nF h Lib f L Bdff",
      "page_number": 149
    },
    {
      "number": 9,
      "title": "Segment 9 (pages 168-190)",
      "start_page": 168,
      "end_page": 190,
      "detection_method": "synthetic",
      "content": "144\n\nChapter 8 Modules, Packages, and Distribution\n\nIt is important to emphasize that import executes all of the statements in the loaded source file. If a module carries out a computation or produces output in addition to defining variables, functions, and classes, you will see the result.Also, a common confu- sion with modules concerns the access to classes. Keep in mind that if a file spam.py defines a class Spam, you must use the name spam.Spam to refer to the class.\n\nTo import multiple modules, you can supply import with a comma-separated list of\n\nmodule names, like this:\n\nimport socket, os, re\n\nThe name used to refer to a module can be changed using the as qualifier. Here’s an example:\n\nimport spam as sp import socket as net sp.foo() sp.bar() net.gethostname()\n\nWhen a module is loaded using a different name like this, the new name only applies to the source file or context where the import statement appeared. Other program mod- ules can still load the module using its original name.\n\nChanging the name of the imported module can be a useful tool for writing extensible code. For example, suppose you have two modules, xmlreader.py and csvreader.py, that both define a function read_data(filename) for reading some data from a file, but in different input formats.You can write code that selectively picks the reader module like this:\n\nif format == 'xml':\n\nimport xmlreader as reader\n\nelif format == 'csv':\n\nimport csvreader as reader data = reader.read_data(filename)\n\nModules are first class objects in Python.This means that they can be assigned to variables, placed in data structures such as a list, and passed around in a program as a data. For instance, the reader variable in the previous example simply refers to the cor- responding module object. Underneath the covers, a module object is a layer over a dic- tionary that is used to hold the contents of the module namespace.This dictionary is available as the __dict__ of a module, and whenever you look up or change a value in a module, you’re working with this dictionary.\n\nThe import statement can appear at any point in a program. However, the code in\n\neach module is loaded and executed only once, regardless of how often you use the import statement. Subsequent import statements simply bind the module name to the module object already created by the previous import.You can find a dictionary con- taining all currently loaded modules in the variable sys.modules.This dictionary maps module names to module objects.The contents of this dictionary are used to determine whether import loads a fresh copy of a module.\n\nF h Lib f L Bdff\n\nImporting Selected Symbols from a Module\n\n145\n\nImporting Selected Symbols from a Module The from statement is used to load specific definitions within a module into the cur- rent namespace.The from statement is identical to import except that instead of creat- ing a name referring to the newly created module namespace, it places references to one or more of the objects defined in the module into the current namespace:\n\nfrom spam import foo # Imports spam and puts 'foo' in current namespace foo() # Calls spam.foo() spam.foo() # NameError: spam\n\nThe from statement also accepts a comma-separated list of object names. For example:\n\nfrom spam import foo, bar\n\nIf you have a very long list of names to import, the names can be enclosed in parenthe- ses.This makes it easier to break the import statement across multiple lines. Here’s an example:\n\nfrom spam import (foo, bar, Spam)\n\nIn addition, the as qualifier can be used to rename specific objects imported with from. Here’s an example:\n\nfrom spam import Spam as Sp s = Sp()\n\nThe asterisk (*) wildcard character can also be used to load all the definitions in a mod- ule, except those that start with an underscore. Here’s an example:\n\nfrom spam import * # Load all definitions into current namespace\n\nThe from module import * statement may only be used at the top level of a mod- ule. In particular, it is illegal to use this form of import inside function bodies due to the way in which it interacts with function scoping rules (e.g., when functions are com- piled into internal bytecode, all of the symbols used within the function need to be fully specified).\n\nModules can more precisely control the set of names imported by from module\n\nimport * by defining the list __all__. Here’s an example:\n\n# module: spam.py __all__ = [ 'bar', 'Spam' ] # Names I will export with from spam import *\n\nImporting definitions with the from form of import does not change their scoping rules. For example, consider this code:\n\nfrom spam import foo a = 42 foo() # Prints \"I'm foo and a is 37\"\n\nIn this example, the definition of foo() in spam.py refers to a global variable a.When a reference to foo is placed into a different namespace, it doesn’t change the binding rules for variables within that function.Thus, the global namespace for a function is always the module in which the function was defined, not the namespace into which a function is imported and called.This also applies to function calls. For example, in the\n\nF h Lib f L Bdff\n\n146\n\nChapter 8 Modules, Packages, and Distribution\n\nfollowing code, the call to bar() results in a call to spam.foo(), not the redefined foo() that appears in the previous code example:\n\nfrom spam import bar def foo():\n\nprint(\"I'm a different foo\")\n\nbar() # When bar calls foo(), it calls spam.foo(), not\n\n# the definition of foo() above\n\nAnother common confusion with the from form of import concerns the behavior of global variables. For example, consider this code:\n\nfrom spam import a, foo # Import a global variable a = 42 # Modify the variable foo() # Prints \"I'm foo and a is 37\" print(a) # Prints \"42\"\n\nHere, it is important to understand that variable assignment in Python is not a storage operation.That is, the assignment to a in the earlier example is not storing a new value in a, overwriting the previous value. Instead, a new object containing the value 42 is created and the name a is made to refer to it.At this point, a is no longer bound to the value in the imported module but to some other object. Because of this behavior, it is not possible to use the from statement in a way that makes variables behave similarly as global variables or common blocks in languages such as C or Fortran. If you want to have mutable global program parameters in your program, put them in a module and use the module name explicitly using the import statement (that is, use spam.a explic- itly).\n\nExecution as the Main Program There are two ways in which a Python source file can execute.The import statement executes code in its own namespace as a library module. However, code might also exe- cute as the main program or script.This occurs when you supply the program as the script name to the interpreter:\n\n% python spam.py\n\nEach module defines a variable, __name__, that contains the module name. Programs can examine this variable to determine the module in which they’re executing.The top-level module of the interpreter is named __main__. Programs specified on the command line or entered interactively run inside the __main__ module. Sometimes a program may alter its behavior, depending on whether it has been imported as a mod- ule or is running in __main__. For example, a module may include some testing code that is executed if the module is used as the main program but which is not executed if the module is simply imported by another module.This can be done as follows:\n\n# Check if running as a program if __name__ == '__main__':\n\n# Yes statements\n\nelse:\n\n# No, I must have been imported as a module statements\n\nIt is common practice for source files intended for use as libraries to use this technique for including optional testing or example code. For example, if you’re developing a\n\nF h Lib f L Bdff\n\nModule Loading and Compilation\n\n147\n\nmodule, you can put code for testing the features of your library inside an if statement as shown and simply run Python on your module as the main program to run it.That code won’t run for users who import your library.\n\nThe Module Search Path When loading modules, the interpreter searches the list of directories in sys.path.The first entry in sys.path is typically an empty string '', which refers to the current working directory. Other entries in sys.path may consist of directory names, .zip archive files, and .egg files.The order in which entries are listed in sys.path deter- mines the search order used when modules are loaded.To add new entries to the search path, simply add them to this list.\n\nAlthough the path usually contains directory names, zip archive files containing Python modules can also be added to the search path.This can be a convenient way to package a collection of modules as a single file. For example, suppose you created two modules, foo.py and bar.py, and placed them in a zip file called mymodules.zip.The file could be added to the Python search path as follows:\n\nimport sys sys.path.append(\"mymodules.zip\") import foo, bar\n\nSpecific locations within the directory structure of a zip file can also be used. In addi- tion, zip files can be mixed with regular pathname components. Here’s an example:\n\nsys.path.append(\"/tmp/modules.zip/lib/python\")\n\nIn addition to .zip files, you can also add .egg files to the search path. .egg files are packages created by the setuptools library.This is a common format encountered when installing third-party Python libraries and extensions.An .egg file is actually just a .zip file with some extra metadata (e.g., version number, dependencies, etc.) added to it.Thus, you can examine and extract data from an .egg file using standard tools for working with .zip files.\n\nDespite support for zip file imports, there are some restrictions to be aware of. First,\n\nit is only possible import .py, .pyw, .pyc, and .pyo files from an archive. Shared libraries and extension modules written in C cannot be loaded directly from archives, although packaging systems such as setuptools are sometimes able to provide a workaround (typically by extracting C extensions to a temporary directory and loading modules from it). Moreover, Python will not create .pyc and .pyo files when .py files are loaded from an archive (described next).Thus, it is important to make sure these files are created in advance and placed in the archive in order to avoid poor perform- ance when loading modules.\n\nModule Loading and Compilation So far, this chapter has presented modules as files containing pure Python code. However, modules loaded with import really fall into four general categories:\n\nn Code written in Python (.py files) n C or C++ extensions that have been compiled into shared libraries or DLLs\n\nF h Lib f L Bdff\n\n148\n\nChapter 8 Modules, Packages, and Distribution\n\nn Packages containing a collection of modules n Built-in modules written in C and linked into the Python interpreter\n\nWhen looking for a module (for example, foo), the interpreter searches each of the directories in sys.path for the following files (listed in search order):\n\n1. A directory, foo, defining a package\n\n2. foo.pyd, foo.so, foomodule.so, or foomodule.dll (compiled extensions)\n\n3. foo.pyo (only if the -O or -OO option has been used)\n\n4. foo.pyc\n\n5. foo.py (on Windows, Python also checks for .pyw files.)\n\nPackages are described shortly; compiled extensions are described in Chapter 26, “Extending and Embedding Python.” For .py files, when a module is first imported, it’s compiled into bytecode and written back to disk as a .pyc file. On subsequent imports, the interpreter loads this precompiled bytecode unless the modification date of the .py file is more recent (in which case, the .pyc file is regenerated). .pyo files are used in conjunction with the interpreter’s -O option.These files contain bytecode stripped of line numbers, assertions, and other debugging information.As a result, they’re somewhat smaller and allow the interpreter to run slightly faster. If the -OO option is specified instead of -O, documentation strings are also stripped from the file.This removal of doc- umentation strings occurs only when .pyo files are created—not when they’re loaded. If none of these files exists in any of the directories in sys.path, the interpreter checks whether the name corresponds to a built-in module name. If no match exists, an ImportError exception is raised.\n\nThe automatic compilation of files into .pyc and .pyo files occurs only in conjunc-\n\ntion with the import statement. Programs specified on the command line or standard input don’t produce such files. In addition, these files aren’t created if the directory con- taining a module’s .py file doesn’t allow writing (e.g., either due to insufficient permis- sion or if it’s part of a zip archive).The -B option to the interpreter also disables the generation of these files.\n\nIf .pyc and .pyo files are available, it is not necessary for a corresponding .py file to exist.Thus, if you are packaging code and don’t wish to include source, you can merely bundle a set of .pyc files together. However, be aware that Python has extensive sup- port for introspection and disassembly. Knowledgeable users will still be able to inspect and find out a lot of details about your program even if the source hasn’t been provid- ed.Also, be aware that .pyc files tend to be version-specific.Thus, a .pyc file generated for one version of Python might not work in a future release.\n\nWhen import searches for files, it matches filenames in a case-sensitive manner—\n\neven on machines where the underlying file system is case-insensitive, such as on Windows and OS X (such systems are case-preserving, however).Therefore, import foo will only import the file foo.py and not the file FOO.PY. However, as a general rule, you should avoid the use of module names that differ in case only.\n\nF h Lib f L Bdff\n\nPackages\n\n149\n\nModule Reloading and Unloading Python provides no real support for reloading or unloading of previously imported modules.Although you can remove a module from sys.modules, this does not gener- ally unload a module from memory.This is because references to the module object may still exist in other program components that used import to load that module. Moreover, if there are instances of classes defined in the module, those instances contain references back to their class object, which in turn holds references to the module in which it was defined.\n\nThe fact that module references exist in many places makes it generally impractical\n\nto reload a module after making changes to its implementation. For example, if you remove a module from sys.modules and use import to reload it, this will not retroac- tively change all of the previous references to the module used in a program. Instead, you’ll have one reference to the new module created by the most recent import state- ment and a set of references to the old module created by imports in other parts of the code.This is rarely what you want and never safe to use in any kind of sane production code unless you are able to carefully control the entire execution environment.\n\nOlder versions of Python provided a reload() function for reloading a module. However, use of this function was never really safe (for all of the aforementioned rea- sons), and its use was actively discouraged except as a possible debugging aid. Python 3 removes this feature entirely. So, it’s best not to rely upon it.\n\nFinally, it should be noted that C/C++ extensions to Python cannot be safely unloaded or reloaded in any way. No support is provided for this, and the underlying operating system may prohibit it anyways.Thus, your only recourse is to restart the Python interpreter process.\n\nPackages Packages allow a collection of modules to be grouped under a common package name. This technique helps resolve namespace conflicts between module names used in differ- ent applications.A package is defined by creating a directory with the same name as the package and creating the file __init__.py in that directory.You can then place addi- tional source files, compiled extensions, and subpackages in this directory, as needed. For example, a package might be organized as follows:\n\nGraphics/\n\n__init__.py Primitive/\n\n__init__.py lines.py fill.py text.py ... Graph2d/\n\n__init__.py plot2d.py ... Graph3d/\n\n__init__.py plot3d.py ... Formats/\n\n__init__.py gif.py\n\nF h Lib f L Bdff\n\n150\n\nChapter 8 Modules, Packages, and Distribution\n\npng.py tiff.py jpeg.py\n\nThe import statement is used to load modules from a package in a number of ways:\n\nn import Graphics.Primitive.fill\n\nThis loads the submodule Graphics.Primitive.fill.The contents of this module have to be explicitly named, such as Graphics.Primitive.fill.floodfill(img,x,y,color).\n\nn from Graphics.Primitive import fill\n\nThis loads the submodule fill but makes it available without the package prefix; for example, fill.floodfill(img,x,y,color).\n\nn from Graphics.Primitive.fill import floodfill\n\nThis loads the submodule fill but makes the floodfill function directly accessible; for example, floodfill(img,x,y,color).\n\nWhenever any part of a package is first imported, the code in the file __init__.py is executed. Minimally, this file may be empty, but it can also contain code to perform package-specific initializations.All the __init__.py files encountered during an import are executed.Therefore, the statement import Graphics.Primitive.fill, shown earlier, would first execute the __init__.py file in the Graphics directory and then the __init__.py file in the Primitive directory.\n\nOne peculiar problem with packages is the handling of this statement:\n\nfrom Graphics.Primitive import *\n\nA programmer who uses this statement usually wants to import all the submodules asso- ciated with a package into the current namespace. However, because filename conven- tions vary from system to system (especially with regard to case sensitivity), Python cannot accurately determine what modules those might be.As a result, this statement just imports all the names that are defined in the __init__.py file in the Primitive directory.This behavior can be modified by defining a list, __all__, that contains all the module names associated with the package.This list should be defined in the pack- age __init__.py file, like this:\n\n# Graphics/Primitive/__init__.py __all__ = [\"lines\",\"text\",\"fill\"]\n\nNow when the user issues a from Graphics.Primitive import * statement, all the listed submodules are loaded as expected.\n\nAnother subtle problem with packages concerns submodules that want to import other submodules within the same package. For example, suppose the Graphics.Primitive.fill module wants to import the Graphics.Primitive.lines module.To do this, you can simply use the fully specified named (e.g., from Graphics.Primitives import lines) or use a package relative import like this:\n\n# fill.py from . import lines\n\nIn this example, the . used in the statement from . import lines refers to the same directory of the calling module.Thus, this statement looks for a module lines in the\n\nF h Lib f L Bdff\n\nPackages\n\n151\n\nsame directory as the file fill.py. Great care should be taken to avoid using a state- ment such as import moduleto import a package submodule. In older versions of Python, it was unclear whether the import modulestatement was referring to a stan- dard library module or a submodule of a package. Older versions of Python would first try to load the module from the same package directory as the submodule where the import statement appeared and then move on to standard library modules if no match was found. However, in Python 3, import assumes an absolute path and will simply try to load modulefrom the standard library.A relative import more clearly states your intentions.\n\nRelative imports can also be used to load submodules contained in different directo-\n\nries of the same package. For example, if the module Graphics.Graph2D.plot2d wanted to import Graphics.Primitives.lines, it could use a statement like this:\n\n# plot2d.py from ..Primitives import lines\n\nHere, the .. moves out one directory level and Primitives drops down into a differ- ent package directory.\n\nRelative imports can only be specified using the from module import symbol form of the import statement.Thus, statements such as import ..Primitives.lines or import .lines are a syntax error.Also, symbolhas to be a valid identifier. So, a statement such as from .. import Primitives.lines is also illegal. Finally, relative imports can only be used within a package; it is illegal to use a relative import to refer to modules that are simply located in a different directory on the filesystem.\n\nImporting a package name alone doesn’t import all the submodules contained in the\n\npackage. For example, the following code doesn’t work:\n\nimport Graphics Graphics.Primitive.fill.floodfill(img,x,y,color) # Fails!\n\nHowever, because the import Graphics statement executes the __init__.py file in the Graphics directory, relative imports can be used to load all the submodules auto- matically, as follows:\n\n# Graphics/__init__.py from . import Primitive, Graph2d, Graph3d\n\n# Graphics/Primitive/__init__.py from . import lines, fill, text, ...\n\nNow the import Graphics statement imports all the submodules and makes them available using their fully qualified names.Again, it is important to stress that a package relative import should be used as shown. If you use a simple statement such as import module, standard library modules may be loaded instead.\n\nFinally, when Python imports a package, it defines a special variable, __path__, which contains a list of directories that are searched when looking for package submod- ules (__path__ is a package-specific version of the sys.path variable). __path__ is accessible to the code contained in __init__.py files and initially contains a single item with the directory name of the package. If necessary, a package can supply additional directories to the __path__ list to alter the search path used for finding submodules. This might be useful if the organization of a package on the file system is complicated and doesn’t neatly match up with the package hierarchy.\n\nF h Lib f L Bdff\n\n152\n\nChapter 8 Modules, Packages, and Distribution\n\nDistributing Python Programs and Libraries To distribute Python programs to others, you should use the distutils module.As preparation, you should first cleanly organize your work into a directory that has a README file, supporting documentation, and your source code.Typically, this directory will contain a mix of library modules, packages, and scripts. Modules and packages refer to source files that will be loaded with import statements. Scripts are programs that will run as the main program to the interpreter (e.g., running as python scriptname). Here is an example of a directory containing Python code:\n\nspam/\n\nREADME.txt Documentation.txt libspam.py # A single library module spampkg/ # A package of support modules\n\n__init__.py foo.py bar.py\n\nrunspam.py # A script to run as: python runspam.py\n\nYou should organize your code so that it works normally when running the Python interpreter in the top-level directory. For example, if you start Python in the spam directory, you should be able to import modules, import package components, and run scripts without having to alter any of Python’s settings such as the module search path. After you have organized your code, create a file setup.py in the top most directo-\n\nry (spam in the previous examples). In this file, put the following code:\n\n# setup.py from distutils.core import setup\n\nsetup(name = \"spam\",\n\nversion = \"1.0\", py_modules = ['libspam'], packages = ['spampkg'], scripts = ['runspam.py'], )\n\nIn the setup() call, the py_modules argument is a list of all of the single-file Python modules, packages is a list of all package directories, and scripts is a list of script files.Any of these arguments may be omitted if your software does not have any match- ing components (i.e., there are no scripts). name is the name of your package, and version is the version number as a string.\n\nThe call to setup() supports a variety of other parameters that supply various\n\nmetadata about your package.Table 8.1 shows the most common parameters that can be specified.All values are strings except for the classifiers parameter, which is a list of strings such as ['Development Status :: 4 - Beta', 'Programming Language :: Python'] (a full list can be found at http://pypi.python.org).\n\nTable 8.1 Parameters to setup()\n\nParameter\n\nDescription\n\nname\n\nversion\n\nauthor\n\nauthor_email\n\nName of the package (required) Version number (required) Author’s name Author’s email address\n\nF h Lib f L Bdff\n\nDistributing Python Programs and Libraries\n\n153\n\nTable 8.1\n\nContinued\n\nParameter\n\nDescription\n\nmaintainer\n\nmaintainer_email\n\nurl\n\ndescription\n\nlong_description\n\ndownload_url\n\nclassifiers\n\nMaintainer’s name Maintainer’s email Home page for the package Short description of the package Long description of the package Location where package can be downloaded List of string classifiers\n\nCreating a setup.py file is enough to create a source distribution of your software. Type the following shell command to make a source distribution:\n\n% python setup.py sdist ... %\n\nThis creates an archive file such as spam-1.0.tar.gz or spam-1.0.zip in the directo- ry spam/dist.This is the file you would give to others to install your software.To install, a user simply unpacks the archive and performs these steps:\n\n% unzip spam-1.0.zip ... % cd spam-1.0 % python setup.py install ... %\n\nThis installs the software into the local Python distribution and makes it available for general use. Modules and packages are normally installed into a directory called \"site-packages\" in the Python library.To find the exact location of this directory, inspect the value of sys.path. Scripts are normally installed into the same directory as the Python interpreter on UNIX-based systems or into a \"Scripts\" directory on Windows (found in \"C:\\Python26\\Scripts\" in a typical installation).\n\nOn UNIX, if the first line of a script starts with #! and contains the text \"python\", the installer will rewrite the line to point to the local installation of Python.Thus, if you have written scripts that have been hard-coded to a specific Python location such as /usr/local/bin/python, they should still work when installed on other systems where Python is in a different location.\n\nThe setup.py file has a number of other commands concerning the distribution of\n\nsoftware. If you type 'python setup.py bdist', a binary distribution is created in which all of the .py files have already been precompiled into .pyc files and placed into a directory structure that mimics that of the local platform.This kind of distribution is needed only if parts of your application have platform dependencies (for example, if you also have C extensions that need to be compiled). If you run 'python setup.py bdist_wininst' on a Windows machine, an .exe file will be created.When opened, a Windows installer dialog will start, prompting the user for information about where the software should be installed.This kind of distribution also adds entries to the registry, making it easy to uninstall your package at a later date.\n\nThe distutils module assumes that users already have a Python installation on their machine (downloaded separately).Although it is possible to create software pack- ages where the Python runtime and your software are bundled together into a single\n\nF h Lib f L Bdff\n\n154\n\nChapter 8 Modules, Packages, and Distribution\n\nbinary executable, that is beyond the scope of what can be covered here (look at a third-party module such as py2exe or py2app for further details). If all you are doing is distributing libraries or simple scripts to people, it is usually unnecessary to package your code with the Python interpreter and runtime as well.\n\nFinally, it should be noted that there are many more options to distutils than those covered here. Chapter 26 describes how distutils can be used to compile C and C++ extensions.\n\nAlthough not part of the standard Python distribution, Python software is often dis- tributed in the form of an .egg file.This format is created by the popular setuptools extension (http://pypi.python.org/pypi/setuptools).To support setuptools, you can simply change the first part of your setup.py file as follows:\n\n# setup.py try:\n\nfrom setuptools import setup\n\nexcept ImportError:\n\nfrom distutils.core import setup\n\nsetup(name = \"spam\",\n\n...\n\n)\n\nInstalling Third-Party Libraries The definitive resource for locating third-party libraries and extensions to Python is the Python Package Index (PyPI), which is located at http://pypi.python.org. Installing third- party modules is usually straightforward but can become quite involved for very large packages that also depend on other third-party modules. For the more major exten- sions, you will often find a platform-native installer that simply steps you through the process using a series of dialog screens. For other modules, you typically unpack the download, look for the setup.py file, and type python setup.py install to install the software.\n\nBy default, third-party modules are installed in the site-packages directory of the Python standard library.Access to this directory typically requires root or administrator access. If this is not the case, you can type python setup.py install --user to have the module installed in a per-user library directory.This installs the package in a per-user directory such as \"/Users/beazley/.local/lib/python2.6/site-pack- ages\" on UNIX.\n\nIf you want to install the software somewhere else entirely, use the --prefix option\n\nto setup.py. For example, typing python setup.py install --prefix=/home/ beazley/pypackages installs a module under the directory /home/beazley/ pypackages.When installing in a nonstandard location, you will probably have to adjust the setting of sys.path in order for Python to locate your newly installed modules.\n\nBe aware that many extensions to Python involve C or C++ code. If you have downloaded a source distribution, your system will have to have a C++ compiler installed in order to run the installer. On UNIX, Linux, and OS X, this is usually not an issue. On Windows, it has traditionally been necessary to have a version of Microsoft Visual Studio installed. If you’re working on that platform, you’re probably better off looking for a precompiled version of your extension.\n\nF h Lib f L Bdff\n\nInstalling Third-Party Libraries\n\n155\n\nIf you have installed setuptools, a script easy_install is available to install pack-\n\nages. Simply type easy_install pkgnameto install a specific package. If configured correctly, this will download the appropriate software from PyPI along with any dependencies and install it for you. Of course, your mileage might vary.\n\nIf you would like to add your own software to PyPI, simply type python setup.py\n\nregister.This will upload metadata about the latest version of your software to the index (note that you will have to register a username and password first).\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n9\n\nInput and Output\n\nThis chapter describes the basics of Python input and output (I/O), including\n\ncommand-line options, environment variables, file I/O, Unicode, and how to serialize objects using the pickle module.\n\nReading Command-Line Options When Python starts, command-line options are placed in the list sys.argv.The first element is the name of the program. Subsequent items are the options presented on the command line after the program name.The following program shows a minimal proto- type of manually processing simple command-line arguments:\n\nimport sys if len(sys.argv) != 3:\n\nsys.stderr.write(\"Usage : python %s inputfile outputfile\\n\" % sys.argv[0]) raise SystemExit(1)\n\ninputfile = sys.argv[1] outputfile = sys.argv[2]\n\nIn this program, sys.argv[0] contains the name of the script being executed.Writing an error message to sys.stderr and raising SystemExit with a non-zero exit code as shown is standard practice for reporting usage errors in command-line tools.\n\nAlthough you can manually process command options for simple scripts, use the optparse module for more complicated command-line handling. Here is a simple example:\n\nimport optparse p = optparse.OptionParser()\n\n# An option taking an argument p.add_option(\"-o\",action=\"store\",dest=\"outfile\") p.add_option(\"--output\",action=\"store\",dest=\"outfile\")\n\n# An option that sets a boolean flag p.add_option(\"-d\",action=\"store_true\",dest=\"debug\") p.add_option(\"--debug\",action=\"store_true\",dest=\"debug\")\n\n# Set default values for selected options p.set_defaults(debug=False)\n\n# Parse the command line opts, args = p.parse_args()\n\n# Retrieve the option settings outfile = opts.outfile debugmode = opts.debug\n\nF h Lib f L Bdff\n\n158\n\nChapter 9 Input and Output\n\nIn this example, two types of options are added.The first option, -o or --output, has a required argument.This behavior is selected by specifying action='store' in the call to p.add_option().The second option, -d or --debug, is merely setting a Boolean flag.This is enabled by specifying action='store_true' in p.add_option().The dest argument to p.add_option() selects an attribute name where the argument value will be stored after parsing.The p.set_defaults() method sets default values for one or more of the options.The argument names used with this method should match the destination names selected for each option. If no default value is selected, the default value is set to None.\n\nThe previous program recognizes all of the following command-line styles:\n\n% python prog.py -o outfile -d infile1 ... infileN % python prog.py --output=outfile --debug infile1 ... infileN % python prog.py -h % python prog.py --help\n\nParsing is performed using the p.parse_args() method.This method returns a 2-tuple (opts, args) where opts is an object containing the parsed option values and args is a list of items on the command line not parsed as options. Option values are retrieved using opts.destwhere destis the destination name used when adding an option. For example, the argument to the -o or --output argument is placed in opts.outfile, whereas args is a list of the remaining arguments such as ['infile1', ..., 'infileN'].The optparse module automatically provides a -h or --help option that lists the available options if requested by the user. Bad options also result in an error message.\n\nThis example only shows the simplest use of the optparse module. Further details on some of the more advanced options can be found in Chapter 19,“Operating System Services.”\n\nEnvironment Variables Environment variables are accessed in the dictionary os.environ. Here’s an example:\n\nimport os path = os.environ[\"PATH\"] user = os.environ[\"USER\"] editor = os.environ[\"EDITOR\"] ... etc ...\n\nTo modify the environment variables, set the os.environ variable. For example:\n\nos.environ[\"FOO\"] = \"BAR\"\n\nModifications to os.environ affect both the running program and subprocesses created by Python.\n\nFiles and File Objects The built-in function open(name [,mode [,bufsize]]) opens and creates a file object, as shown here:\n\nf = open(\"foo\") # Opens \"foo\" for reading f = open(\"foo\",'r') # Opens \"foo\" for reading (same as above) f = open(\"foo\",'w') # Open for writing\n\nF h Lib f L Bdff\n\nFiles and File Objects\n\n159\n\nThe file mode is 'r' for read, 'w' for write, or 'a' for append.These file modes assume text-mode and may implicitly perform translation of the newline character '\\n'. For example, on Windows, writing the character '\\n' actually outputs the two- character sequence '\\r\\n' (and when reading the file back, '\\r\\n' is translated back into a single '\\n' character). If you are working with binary data, append a 'b' to the file mode such as 'rb' or 'wb'.This disables newline translation and should be includ- ed if you are concerned about portability of code that processes binary data (on UNIX, it is a common mistake to omit the 'b' because there is no distinction between text and binary files).Also, because of the distinction in modes, you might see text-mode specified as 'rt', 'wt', or 'at', which more clearly expresses your intent.\n\nA file can be opened for in-place updates by supplying a plus (+) character, such as 'r+' or 'w+'.When a file is opened for update, you can perform both input and out- put, as long as all output operations flush their data before any subsequent input opera- tions. If a file is opened using 'w+' mode, its length is first truncated to zero.\n\nIf a file is opened with mode 'U' or 'rU', it provides universal newline support for\n\nreading.This feature simplifies cross-platform work by translating different newline encodings (such as '\\n', '\\r', and '\\r\\n') to a standard '\\n' character in the strings returned by various file I/O functions.This can be useful if, for example, you are writ- ing scripts on UNIX systems that must process text files generated by programs on Windows.\n\nThe optional bufsizeparameter controls the buffering behavior of the file, where 0 is unbuffered, 1 is line buffered, and a negative number requests the system default.Any other positive number indicates the approximate buffer size in bytes that will be used.\n\nPython 3 adds four additional parameters to the open() function, which is called as\n\nopen(name [,mode [,bufsize [, encoding [, errors [, newline [, closefd]]]]]]). encodingis an encoding name such as 'utf-8' or 'ascii'. errorsis the error-handling policy to use for encoding errors (see the later sections in this chapter on Unicode for more information). newlinecontrols the behavior of uni- versal newline mode and is set to None, '', '\\n', '\\r', or '\\r\\n'. If set to None, any line ending of the form '\\n', '\\r', or '\\r\\n' is translated into '\\n'. If set to '' (the empty string), any of these line endings are recognized as newlines, but left untranslated in the input text. If newlinehas any other legal value, that value is what is used to ter- minate lines. closefdcontrols whether the underlying file descriptor is actually closed when the close() method is invoked. By default, this is set to True.\n\nTable 9.1 shows the methods supported by file objects.\n\nTable 9.1\n\nFile Methods\n\nMethod\n\nDescription\n\nf.read([n])\n\nf.readline([n])\n\nf.readlines([size])\n\nf.write(s)\n\nf.writelines(lines)\n\nReads at most nbytes. Reads a single line of input up to ncharacters. If nis omitted, this method reads the entire line. Reads all the lines and returns a list. sizeoptionally specifies the approximate number of characters to read on the file before stopping. Writes string s. Writes all strings in sequence lines. Closes the file.\n\nf.close()\n\nF h Lib f L Bdff\n\n160\n\nChapter 9 Input and Output\n\nTable 9.1\n\nContinued\n\nMethod\n\nDescription\n\nf.tell() f.seek(offset [, whence]) Seeks to a new file position. f.isatty()\n\nReturns the current file pointer.\n\nReturns 1 if fis an interactive terminal. Flushes the output buffers. Truncates the file to at most sizebytes. Returns an integer file descriptor. Returns the next line or raises StopIteration. In Python 3, it is called f.__next__().\n\nf.flush()\n\nf.truncate([size])\n\nf.fileno()\n\nf.next()\n\nThe read() method returns the entire file as a string unless an optional lengthparam- eter is given specifying the maximum number of characters.The readline() method returns the next line of input, including the terminating newline; the readlines() method returns all the input lines as a list of strings.The readline() method optional- ly accepts a maximum line length, n. If a line longer than ncharacters is read, the first n characters are returned.The remaining line data is not discarded and will be returned on subsequent read operations.The readlines() method accepts a size parameter that specifies the approximate number of characters to read before stopping.The actual number of characters read may be larger than this depending on how much data has been buffered.\n\nBoth the readline() and readlines() methods are platform-aware and handle different representations of newlines properly (for example, '\\n' versus '\\r\\n'). If the file is opened in universal newline mode ('U' or 'rU'), newlines are converted to '\\n'.\n\nread() and readline() indicate end-of-file (EOF) by returning an empty string.\n\nThus, the following code shows how you can detect an EOF condition:\n\nwhile True:\n\nline = f.readline() if not line: # EOF\n\nbreak\n\nA convenient way to read all lines in a file is to use iteration with a for loop. For example:\n\nfor line in f: # Iterate over all lines in the file\n\n# Do something with line ...\n\nBe aware that in Python 2, the various read operations always return 8-bit strings, regardless of the file mode that was specified (text or binary). In Python 3, these opera- tions return Unicode strings if a file has been opened in text mode and byte strings if the file is opened in binary mode.\n\nThe write() method writes a string to the file, and the writelines() method\n\nwrites a list of strings to the file. write() and writelines() do not add newline characters to the output, so all output that you produce should already include all nec- essary formatting.These methods can write raw-byte strings to a file, but only if the file has been opened in binary mode.\n\nF h Lib f L Bdff\n\nStandard Input, Output, and Error\n\n161\n\nInternally, each file object keeps a file pointer that stores the byte offset at which the next read or write operation will occur.The tell() method returns the current value of the file pointer as a long integer.The seek() method is used to randomly access parts of a file given an offsetand a placement rule in whence. If whenceis 0 (the default), seek() assumes that offsetis relative to the start of the file; if whenceis 1, the position is moved relative to the current position; and if whenceis 2, the offset is taken from the end of the file. seek() returns the new value of the file pointer as an integer. It should be noted that the file pointer is associated with the file object returned by open() and not the file itself.The same file can be opened more than once in the same program (or in different programs). Each instance of the open file has its own file pointer that can be manipulated independently.\n\nThe fileno() method returns the integer file descriptor for a file and is sometimes\n\nused in low-level I/O operations in certain library modules. For example, the fcntl module uses the file descriptor to provide low-level file control operations on UNIX systems.\n\nFile objects also have the read-only data attributes shown in Table 9.2.\n\nTable 9.2\n\nFile Object Attributes\n\nAttribute\n\nDescription\n\nf.closed\n\nf.mode\n\nf.name\n\nf.softspace\n\nf.newlines\n\nf.encoding\n\nBoolean value indicates the file state: False if the file is open, True if closed. The I/O mode for the file. Name of the file if created using open(). Otherwise, it will be a string indicating the source of the file. Boolean value indicating whether a space character needs to be print- ed before another value when using the print statement. Classes that emulate files must provide a writable attribute of this name that’s initially initialized to zero (Python 2 only). When a file is opened in universal newline mode, this attribute con- tains the newline representation actually found in the file. The value is None if no newlines have been encountered, a string containing '\\n', '\\r', or '\\r\\n', or a tuple containing all the different newline encod- ings seen. A string that indicates file encoding, if any (for example, 'latin-1' or 'utf-8'). The value is None if no encoding is being used.\n\nStandard Input, Output, and Error The interpreter provides three standard file objects, known as standard input, standard out- put, and standard error, which are available in the sys module as sys.stdin, sys.stdout, and sys.stderr, respectively. stdin is a file object corresponding to the stream of input characters supplied to the interpreter. stdout is the file object that receives output produced by print. stderr is a file that receives error messages. More often than not, stdin is mapped to the user’s keyboard, whereas stdout and stderr produce text onscreen.\n\nF h Lib f L Bdff\n\n162\n\nChapter 9 Input and Output\n\nThe methods described in the preceding section can be used to perform raw I/O with the user. For example, the following code writes to standard output and reads a line of input from standard input:\n\nimport sys sys.stdout.write(\"Enter your name : \") name = sys.stdin.readline()\n\nAlternatively, the built-in function raw_input(prompt) can read a line of text from stdin and optionally print a prompt:\n\nname = raw_input(\"Enter your name : \")\n\nLines read by raw_input() do not include the trailing newline.This is different than reading directly from sys.stdin where newlines are included in the input text. In Python 3, raw_input() has been renamed to input().\n\nKeyboard interrupts (typically generated by Ctrl+C) result in a\n\nKeyboardInterrupt exception that can be caught using an exception handler. If necessary, the values of sys.stdout, sys.stdin, and sys.stderr can be\n\nreplaced with other file objects, in which case the print statement and input functions use the new values. Should it ever be necessary to restore the original value of sys.stdout, it should be saved first.The original values of sys.stdout, sys.stdin, and sys.stderr at interpreter startup are also available in sys.__stdout__, sys.__stdin__, and sys.__stderr__, respectively.\n\nNote that in some cases sys.stdin, sys.stdout, and sys.stderr may be altered\n\nby the use of an integrated development environment (IDE). For example, when Python is run under IDLE, sys.stdin is replaced with an object that behaves like a file but is really an object in the development environment. In this case, certain low- level methods, such as read() and seek(), may be unavailable.\n\nThe print Statement Python 2 uses a special print statement to produce output on the file contained in sys.stdout. print accepts a comma-separated list of objects such as the following:\n\nprint \"The values are\", x, y, z\n\nFor each object, the str() function is invoked to produce an output string.These out- put strings are then joined and separated by a single space to produce the final output string.The output is terminated by a newline unless a trailing comma is supplied to the print statement. In this case, the next print statement will insert a space before print- ing more items.The output of this space is controlled by the softspace attribute of the file being used for output.\n\nprint \"The values are \", x, y, z, w # Print the same text, using two print statements print \"The values are \", x, y, # Omits trailing newline print z, w # A space is printed before z\n\nTo produce formatted output, use the string-formatting operator (%) or the .format() method as described in Chapter 4,“Operators and Expressions.” Here’s an example:\n\nprint \"The values are %d %7.5f %s\" % (x,y,z) # Formatted I/O print \"The values are {0:d} {1:7.5f} {2}\".format(x,y,z)\n\nF h Lib f L Bdff\n\nVariable Interpolation in Text Output\n\n163\n\nYou can change the destination of the print statement by adding the special >>file modifier followed by a comma, where fileis a file object that allows writes. Here’s an example:\n\nf = open(\"output\",\"w\") print >>f, \"hello world\" ... f.close()\n\nThe print() Function One of the most significant changes in Python 3 is that print is turned into a func- tion. In Python 2.6, it is also possible to use print as a function if you include the statement from __future__ import print_function in each module where used. The print() function works almost exactly the same as the print statement described in the previous section.\n\nTo print a series of values separated by spaces, just supply them all to print() like\n\nthis:\n\nprint(\"The values are\", x, y, z)\n\nTo suppress or change the line ending, use the end=endingkeyword argument. For example:\n\nprint(\"The values are\", x, y, z, end='') # Suppress the newline\n\nTo redirect the output to a file, use the file=outfilekeyword argument. For example:\n\nprint(\"The values are\", x, y, z, file=f) # Redirect to file object f\n\nTo change the separator character between items, use the sep=sepchrkeyword argu- ment. For example:\n\nprint(\"The values are\", x, y, z, sep=',') # Put commas between the values\n\nVariable Interpolation in Text Output A common problem when generating output is that of producing large text fragments containing embedded variable substitutions. Many scripting languages such as Perl and PHP allow variables to be inserted into strings using dollar-variable substitutions (that is, $name, $address, and so on). Python provides no direct equivalent of this feature, but it can be emulated using formatted I/O combined with triple-quoted strings. For example, you could write a short form letter, filling in a name, an item name, and an amount, as shown in the following example:\n\n# Note: trailing slash right after \"\"\" prevents # a blank line from appearing as the first line form = \"\"\"\\ Dear %(name)s,\n\nF h Lib f L Bdff\n\n164\n\nChapter 9 Input and Output\n\nPlease send back my %(item)s or pay me $%(amount)0.2f.\n\nSincerely yours,\n\nJoe Python User\n\n\"\"\" print form % { 'name': 'Mr. Bush',\n\n'item': 'blender', 'amount': 50.00,\n\n}\n\nThis produces the following output:\n\nDear Mr. Bush,\n\nPlease send back my blender or pay me $50.00.\n\nSincerely yours,\n\nJoe Python User\n\nThe format() method is a more modern alternative that cleans up some of the previ- ous code. For example:\n\nform = \"\"\"\\ Dear {name}, Please send back my {item} or pay me {amount:0.2f}.\n\nSincerely yours,\n\nJoe Python User\n\n\"\"\" print form.format(name='Mr. Bush', item='blender', amount=50.0)\n\nFor certain kinds of forms, you can also use Template strings, as follows:\n\nimport string form = string.Template(\"\"\"\\ Dear $name, Please send back my $item or pay me $amount.\n\nSincerely yours,\n\nJoe Python User\n\n\"\"\") print form.substitute({'name': 'Mr. Bush',\n\n'item': 'blender', 'amount': \"%0.2f\" % 50.0})\n\nIn this case, special $ variables in the string indicate substitutions.The form.substitute() method takes a dictionary of replacements and returns a new string.Although the previous approaches are simple, they aren’t always the most power- ful solutions to text generation.Web frameworks and other large application frameworks tend to provide their own template string engines that support embedded control-flow, variable substitutions, file inclusion, and other advanced features.\n\nGenerating Output Working directly with files is the I/O model most familiar to programmers. However, generator functions can also be used to emit an I/O stream as a sequence of data frag- ments.To do this, simply use the yield statement like you would use a write() or print statement. Here is an example:\n\nF h Lib f L Bdff\n\nUnicode String Handling\n\n165\n\ndef countdown(n):\n\nwhile n > 0:\n\nyield \"T-minus %d\\n\" % n n -= 1 yield \"Kaboom!\\n\"\n\nProducing an output stream in this manner provides great flexibility because the pro- duction of the output stream is decoupled from the code that actually directs the stream to its intended destination. For example, if you wanted to route the above output to a file f, you could do this:\n\ncount = countdown(5) f.writelines(count)\n\nIf, instead, you wanted to redirect the output across a socket s, you could do this:\n\nfor chunk in count:\n\ns.sendall(chunk)\n\nOr, if you simply wanted to capture all of the output in a string, you could do this:\n\nout = \"\".join(count)\n\nMore advanced applications can use this approach to implement their own I/O buffer- ing. For example, a generator could be emitting small text fragments, but another func- tion could be collecting the fragments into large buffers to create a larger, more efficient I/O operation:\n\nchunks = [] buffered_size = 0 for chunk in count:\n\nchunks.append(chunk) buffered_size += len(chunk) if buffered_size >= MAXBUFFERSIZE:\n\noutf.write(\"\".join(chunks)) chunks.clear() buffered_size = 0 outf.write(\"\".join(chunks)\n\nFor programs that are routing output to files or network connections, a generator approach can also result in a significant reduction in memory use because the entire output stream can often be generated and processed in small fragments as opposed to being first collected into one large output string or list of strings.This approach to out- put is sometimes seen when writing programs that interact with the Python Web Services Gateway Interface (WSGI) that’s used to communicate between components in certain web frameworks.\n\nUnicode String Handling A common problem associated with I/O handling is that of dealing with international characters represented as Unicode. If you have a string sof raw bytes containing an encoded representation of a Unicode string, use the s.decode([encoding [,errors]]) method to convert it into a proper Unicode string.To convert a Unicode string, u, to an encoded byte string, use the string method u.encode([encoding [, errors]]). Both of these conversion operators require the use of a special encoding name that specifies how Unicode character values are mapped to a sequence of 8-bit characters in byte strings, and vice versa.The encoding parameter is specified as a string\n\nF h Lib f L Bdff\n\n166\n\nChapter 9 Input and Output\n\nand is one of more than a hundred different character encodings.The following values, however, are most common:\n\nValue 'ascii' 'latin-1' or 'iso-8859-1' 'cp1252'\n\n'utf-8'\n\n'utf-16'\n\n'utf-16-le'\n\n'utf-16-be' 'unicode-escape'\n\nDescription 7-bit ASCII ISO 8859-1 Latin-1 Windows 1252 encoding 8-bit variable-length encoding 16-bit variable-length encoding (may be little or big endian) UTF-16, little endian encoding UTF-16, big endian encoding Same format as Unicode literals u\"string\" Same format as raw Unicode literals ur\"string\"\n\n'raw-unicode-escape'\n\nThe default encoding is set in the site module and can be queried using sys.getdefaultencoding(). In many cases, the default encoding is 'ascii', which means that ASCII characters with values in the range [0x00,0x7f] are directly mapped to Unicode characters in the range [U+0000, U+007F]. However, 'utf-8' is also a very common setting.Technical details concerning common encodings appears in a later section.\n\nWhen using the s.decode() method, it is always assumed that sis a string of bytes. In Python 2, this means that sis a standard string, but in Python 3, smust be a special bytes type. Similarly, the result of t.encode() is always a byte sequence. One caution if you care about portability is that these methods are a little muddled in Python 2. For instance, Python 2 strings have both decode() and encode() methods, whereas in Python 3, strings only have an encode() method and the bytes type only has a decode() method.To simplify code in Python 2, make sure you only use encode() on Unicode strings and decode() on byte strings.\n\nWhen string values are being converted, a UnicodeError exception might be raised\n\nif a character that can’t be converted is encountered. For instance, if you are trying to encode a string into 'ascii' and it contains a Unicode character such as U+1F28, you will get an encoding error because this character value is too large to be represented in the ASCII character set.The errors parameter of the encode() and decode() meth- ods determines how encoding errors are handled. It’s a string with one of the following values:\n\nValue 'strict'\n\n'ignore'\n\n'replace'\n\n'backslashreplace'\n\nDescription Raises a UnicodeError exception for encoding and decod- ing errors. Ignores invalid characters. Replaces invalid characters with a replacement character (U+FFFD in Unicode, '?' in standard strings). Replaces invalid characters with a Python character escape sequence. For example, the character U+1234 is replaced by '\\u1234'.\n\n'xmlcharrefreplace' Replaces invalid characters with an XML character reference.\n\nFor example, the character U+1234 is replaced by '&#4660;'.\n\nF h Lib f L Bdff",
      "page_number": 168
    },
    {
      "number": 10,
      "title": "Segment 10 (pages 191-211)",
      "start_page": 191,
      "end_page": 211,
      "detection_method": "synthetic",
      "content": "Unicode I/O\n\n167\n\nThe default error handling is 'strict'.\n\nThe 'xmlcharrefreplace’ error handling policy is often a useful way to embed international characters into ASCII-encoded text on web pages. For example, if you output the Unicode string 'Jalape\\u00f1o' by encoding it to ASCII with 'xmlcharrefreplace' handling, browsers will almost always correctly render the out- put text as “Jalapeño” and not some garbled alternative.\n\nTo keep your brain from exploding, encoded byte strings and unencoded strings should never be mixed together in expressions (for example, using + to concatenate). Python 3 prohibits this altogether, but Python 2 will silently go ahead with such opera- tions by automatically promoting byte strings to Unicode according to the default encoding setting.This behavior is often a source of surprising results or inexplicable error messages.Thus, you should carefully try to maintain a strict separation between encoded and unencoded character data in your program.\n\nUnicode I/O When working with Unicode strings, it is never possible to directly write raw Unicode data to a file.This is due to the fact that Unicode characters are internally represented as multibyte integers and that writing such integers directly to an output stream causes problems related to byte ordering. For example, you would have to arbitrarily decide if the Unicode character U+HHLL is to be written in “little endian” format as the byte sequence LL HH or in “big endian” format as the byte sequence HH LL. Moreover, other tools that process Unicode would have to know which encoding you used.\n\nBecause of this problem, the external representation of Unicode strings is always done according to a specific encoding rule that precisely defines how Unicode charac- ters are to be represented as a byte sequence.Thus, to support Unicode I/O, the encod- ing and decoding concepts described in the previous section are extended to files.The built-in codecs module contains a collection of functions for converting byte-oriented data to and from Unicode strings according to a variety of different data-encoding schemes.\n\nPerhaps the most straightforward way to handle Unicode files is to use the codecs.open(filename [, mode [, encoding [, errors]]]) function, as follows:\n\nf = codecs.open('foo.txt','r','utf-8','strict') # Reading g = codecs.open('bar.txt','w','utf-8') # Writing\n\nThis creates a file object that reads or writes Unicode strings.The encoding parameter specifies the underlying character encoding that will be used to translate data as it is read or written to the file.The errorsparameter determines how errors are handled and is one of 'strict', 'ignore', 'replace', 'backslashreplace', or 'xmlcharrefreplace' as described in the previous section.\n\nIf you already have a file object, the codecs.EncodedFile(file, inputenc [, outputenc [, errors]]) function can be used to place an encoding wrapper around it. Here’s an example:\n\nf = open(\"foo.txt\",\"rb\") ... fenc = codecs.EncodedFile(f,'utf-8')\n\nF h Lib f L Bdff\n\n168\n\nChapter 9 Input and Output\n\nIn this case, data read from the file will be interpreted according to the encoding sup- plied in inputenc. Data written to the file will be interpreted according to the encod- ing in inputencand written according to the encoding in outputenc. If outputenc is omitted, it defaults to the same as inputenc. errorshas the same meaning as described earlier.When putting an EncodedFile wrapper around an existing file, make sure that file is in binary mode. Otherwise, newline translation might break the encod- ing.\n\nWhen you’re working with Unicode files, the data encoding is often embedded in\n\nthe file itself. For example, XML parsers may look at the first few bytes of the string '<?xml ...>' to determine the document encoding. If the first four values are 3C 3F 78 6D ('<?xm'), the encoding is assumed to be UTF-8. If the first four values are 00 3C 00 3F or 3C 00 3F 00, the encoding is assumed to be UTF-16 big endian or UTF-16 little endian, respectively.Alternatively, a document encoding may appear in MIME headers or as an attribute of other document elements. Here’s an example:\n\n<?xml ... encoding=\"ISO-8859-1\" ... ?>\n\nSimilarly, Unicode files may also include special byte-order markers (BOM) that indi- cate properties of the character encoding.The Unicode character U+FEFF is reserved for this purpose.Typically, the marker is written as the first character in the file. Programs then read this character and look at the arrangement of the bytes to determine encod- ing (for example, '\\xff\\xfe' for UTF-16-LE or '\\xfe\\xff' UTF-16-BE). Once the encoding is determined, the BOM character is discarded and the remainder of the file is processed. Unfortunately, all of this extra handling of the BOM is not something that happens behind the scenes.You often have to take care of this yourself if your applica- tion warrants it.\n\nWhen the encoding is read from a document, code similar to the following can be\n\nused to turn the input file into an encoded stream:\n\nf = open(\"somefile\",\"rb\") # Determine encoding of the file ... # Put an appropriate encoding wrapper on the file. # Assumes that the BOM (if any) has already been discarded # by earlier statements. fenc = codecs.EncodedFile(f,encoding) data = fenc.read()\n\nUnicode Data Encodings Table 9.3 lists some of the most commonly used encoders in the codecs module.\n\nTable 9.3\n\nEncoders in the codecs Module\n\nEncoder\n\nDescription\n\n'ascii' 'latin-1', 'iso-8859-1' 'cp437'\n\n'cp1252'\n\n'utf-8'\n\n'utf-16'\n\nASCII encoding Latin-1 or ISO-8859-1 encoding CP437 encoding CP1252 encoding 8-bit variable-length encoding 16-bit variable-length encoding\n\nF h Lib f L Bdff\n\nUnicode I/O\n\n169\n\nTable 9.3\n\nContinued\n\nEncoder\n\nDescription\n\n'utf-16-le'\n\n'utf-16-be'\n\n'unicode-escape'\n\n'raw-unicode-escape'\n\nUTF-16, but with explicit little endian encoding UTF-16, but with explicit big endian encoding Same format as u\"string\" Same format as ur\"string\"\n\nThe following sections describe each of the encoders in more detail.\n\n'ascii' Encoding In 'ascii' encoding, character values are confined to the ranges [0x00,0x7f] and [U+0000, U+007F].Any character outside this range is invalid.\n\n'iso-8859-1', 'latin-1' Encoding Characters can be any 8-bit value in the ranges [0x00,0xff] and [U+0000, U+00FF]. Values in the range [0x00,0x7f] correspond to characters from the ASCII character set.Values in the range [0x80,0xff] correspond to characters from the ISO-8859-1 or extended ASCII character set.Any characters with values outside the range [0x00,0xff] result in an error.\n\n'cp437' Encoding This encoding is similar to 'iso-8859-1' but is the default encoding used by Python when it runs as a console application on Windows. Certain characters in the range [x80,0xff] correspond to special symbols used for rendering menus, windows, and frames in legacy DOS applications.\n\n'cp1252' Encoding This is an encoding that is very similar to 'iso-8859-1' used on Windows. However, this encoding defines characters in the range [0x80-0x9f] that are undefined in 'iso-8859-1' and which have different code points in Unicode.\n\n'utf-8' Encoding UTF-8 is a variable-length encoding that allows all Unicode characters to be represent- ed.A single byte is used to represent ASCII characters in the range 0–127.All other characters are represented by multibyte sequences of 2 or 3 bytes.The encoding of these bytes is shown here:\n\nUnicode Characters U+0000 - U+007F\n\nByte 0 0nnnnnnn\n\nByte 1\n\nByte 2\n\nU+007F - U+07FF\n\n110nnnnn\n\n10nnnnnn\n\nU+0800 - U+FFFF\n\n1110nnnn\n\n10nnnnnn\n\n10nnnnnn\n\nFor 2-byte sequences, the first byte always starts with the bit sequence 110. For 3-byte sequences, the first byte starts with the bit sequence 1110.All subsequent data bytes in multibyte sequences start with the bit sequence 10.\n\nIn full generality, the UTF-8 format allows for multibyte sequences of up to 6 bytes.\n\nIn Python, 4-byte UTF-8 sequences are used to encode a pair of Unicode characters\n\nF h Lib f L Bdff\n\n170\n\nChapter 9 Input and Output\n\nknown as a surrogate pair. Both characters have values in the range [U+D800, U+DFFF] and are combined to encode a 20-bit character value.The surrogate encoding is as follows:The 4-byte sequence 11110nnn 10nnnnnn 10nmmmm 10mmmmmis encoded as the pair U+D800 + N, U+DC00 + M, where N is the upper 10 bits and M is the lower 10 bits of the 20-bit character encoded in the 4-byte UTF-8 sequence. Five- and 6-byte UTF-8 sequences (denoted by starting bit sequences of 111110 and 1111110, respec- tively) are used to encode character values up to 32 bits in length.These values are not supported by Python and currently result in a UnicodeError exception if they appear in an encoded data stream.\n\nUTF-8 encoding has a number of useful properties that allow it to be used by older software. First, the standard ASCII characters are represented in their standard encoding. This means that a UTF-8–encoded ASCII string is indistinguishable from a traditional ASCII string. Second, UTF-8 doesn’t introduce embedded NULL bytes for multibyte character sequences.Therefore, existing software based on the C library and programs that expect NULL-terminated 8-bit strings will work with UTF-8 strings. Finally, UTF-8 encoding preserves the lexicographic ordering of strings.That is, if a and b are Unicode strings and a < b, then a < b also holds when a and b are converted to UTF-8.Therefore, sorting algorithms and other ordering algorithms written for 8-bit strings will also work for UTF-8.\n\n'utf-16', 'utf-16-be', and 'utf-16-le' Encoding UTF-16 is a variable-length 16-bit encoding in which Unicode characters are written as 16-bit values. Unless a byte ordering is specified, big endian encoding is assumed. In addition, a byte-order marker of U+FEFF can be used to explicitly specify the byte ordering in a UTF-16 data stream. In big endian encoding, U+FEFF is the Unicode character for a zero-width nonbreaking space, whereas the reversed value U+FFFE is an illegal Unicode character.Thus, the encoder can use the byte sequence FE FF or FF FE to determine the byte ordering of a data stream.When reading Unicode data, Python removes the byte-order markers from the final Unicode string.\n\n'utf-16-be' encoding explicitly selects UTF-16 big endian encoding.\n\n'utf-16-le' encoding explicitly selects UTF-16 little ending encoding.\n\nAlthough there are extensions to UTF-16 to support character values greater than\n\n16 bits, none of these extensions are currently supported.\n\n'unicode-escape' and 'raw-unicode-escape' Encoding These encoding methods are used to convert Unicode strings to the same format as used in Python Unicode string literals and Unicode raw string literals. Here’s an example:\n\ns = u'\\u14a8\\u0345\\u2a34' t = s.encode('unicode-escape') #t = '\\u14a8\\u0345\\u2a34'\n\nUnicode Character Properties In addition to performing I/O, programs that use Unicode may need to test Unicode characters for various properties such as capitalization, numbers, and whitespace.The unicodedata module provides access to a database of character properties. General character properties can be obtained with the unicodedata.category(c) function. For example, unicodedata.category(u\"A\") returns 'Lu', signifying that the charac- ter is an uppercase letter.\n\nF h Lib f L Bdff\n\nObject Persistence and the pickle Module\n\n171\n\nAnother tricky problem with Unicode strings is that there might be multiple repre- sentations of the same Unicode string. For example, the character U+00F1 (ñ), might be fully composed as a single character U+00F1 or decomposed into a multicharacter sequence U+006e U+0303 (n, ˜). If consistent processing of Unicode strings is an issue, use the unicodedata.normalize() function to ensure a consistent character represen- tation. For example, unicodedata.normalize('NFC', s) will make sure that all characters in sare fully composed and not represented as a sequence of combining characters.\n\nFurther details about the Unicode character database and the unicodedata module\n\ncan be found in Chapter 16,“Strings and Text Handling.”\n\nObject Persistence and the pickle Module Finally, it’s often necessary to save and restore the contents of an object to a file. One approach to this problem is to write a pair of functions that simply read and write data from a file in a special format.An alternative approach is to use the pickle and shelve modules.\n\nThe pickle module serializes an object into a stream of bytes that can be written to\n\na file and later restored.The interface to pickle is simple, consisting of a dump() and load() operation. For example, the following code writes an object to a file:\n\nimport pickle obj = SomeObject() f = open(filename,'wb') pickle.dump(obj, f) # Save object on f f.close()\n\nTo restore the object, you can use the following code:\n\nimport pickle f = open(filename,'rb') obj = pickle.load(f) # Restore the object f.close()\n\nA sequence of objects can be saved by issuing a series of dump() operations one after the other.To restore these objects, simply use a similar sequence of load() operations. The shelve module is similar to pickle but saves objects in a dictionary-like\n\ndatabase:\n\nimport shelve obj = SomeObject() db = shelve.open(\"filename\") # Open a shelve db['key'] = obj # Save object in the shelve ... obj = db['key'] # Retrieve it db.close() # Close the shelve\n\nAlthough the object created by shelve looks like a dictionary, it also has restrictions. First, the keys must be strings. Second, the values stored in a shelf must be compatible with pickle. Most Python objects will work, but special-purpose objects such as files and network connections maintain an internal state that cannot be saved and restored in this manner.\n\nThe data format used by pickle is specific to Python. However, the format has evolved several times over Python versions.The choice of protocol can be selected using an optional protocol parameter to the pickle dump(obj, file, protocol) operation.\n\nF h Lib f L Bdff\n\n172\n\nChapter 9 Input and Output\n\nBy default, protocol 0 is used.This is the oldest pickle data format that stores objects in a format understood by virtually all Python versions. However, this format is also incompatible with many of Python’s more modern features of user-defined classes such as slots. Protocol 1 and 2 use a more efficient binary data representation.To use these alternative protocols, you would perform operations such as the following:\n\nimport pickle obj = SomeObject() f = open(filename,'wb') pickle.dump(obj,f,2) # Save using protocol 2 pickle.dump(obj,f,pickle.HIGHEST_PROTOCOL) # Use the most modern protocol f.close()\n\nIt is not necessary to specify the protocol when restoring an object using load().The underlying protocol is encoded into the file itself.\n\nSimilarly, a shelve can be opened to save Python objects using an alternative pickle\n\nprotocol like this:\n\nimport shelve db = shelve.open(filename,protocol=2) ... It is not normally necessary for user-defined objects to do anything extra to work with pickle or shelve. However, the special methods __getstate__() and __setstate__() can be used to assist the pickling process.The __getstate__() method, if defined, will be called to create a value representing the state of an object. The value returned by __getstate__() should typically be a string, tuple, list, or dic- tionary.The __setstate__() method receives this value during unpickling and should restore the state of an object from it. Here is an example that shows how these methods could be used with an object involving an underlying network connection.Although the actual connection can’t be pickled, the object saves enough information to reestab- lish it when it’s unpickled later:\n\nimport socket class Client(object):\n\ndef __init__(self,addr):\n\nself.server_addr = addr self.sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM) self.sock.connect(addr)\n\ndef __getstate__(self):\n\nreturn self.server_addr def __setstate__(self,value):\n\nself.server_addr = value self.sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM) self.sock.connect(self.server_addr)\n\nBecause the data format used by pickle is Python-specific, you would not use this feature as a means for exchanging data between applications written in different pro- gramming languages. Moreover, due to security concerns, programs should not process pickled data from untrusted sources (a knowledgeable attacker can manipulate the pick- le data format to execute arbitrary system commands during unpickling).\n\nThe pickle and shelve modules have many more customization features and\n\nadvanced usage options. For more details, consult Chapter 13,“Python Runtime Services.”\n\nF h Lib f L Bdff\n\n10\n\nExecution Environment\n\nThis chapter describes the environment in which Python programs are executed.The\n\ngoal is to describe the runtime behavior of the interpreter, including program startup, configuration, and program termination.\n\nInterpreter Options and Environment The interpreter has a number of options that control its runtime behavior and environ- ment. Options are given to the interpreter on the command line as follows:\n\npython [options] [-c cmd | filename | - ] [args]\n\nHere’s a list of the most common command-line options:\n\nTable 10.1\n\nInterpreter Command-Line Arguments\n\nOption\n\nDescription\n\nEnables warnings about features that are being removed or changed in Python 3. Prevents the creation of .pyc or .pyo files on import. Ignores environment variables. Prints a list of all available command-line options. Enters interactive mode after program execution.\n\n3\n\nB\n\nE\n\nh\n\ni -m module Runs library module moduleas a script. -O\n\nOptimized mode. Optimized mode plus removal of documentation strings when creating .pyo files. Specifies the behavior of the division operator in Python 2. One of -Qold (the default), -Qnew, -Qwarn, or -Qwarnall. Prevents the addition of the user site directory to sys.path. Prevents inclusion of the site initialization module. Reports warnings about inconsistent tab usage. Inconsistent tab usage results in a TabError exception. Unbuffered binary stdout and stdin. Unicode literals. All string literals are handled as Unicode (Python 2 only). Verbose mode. Traces import statements. Prints the version number and exits. Skips the first line of the source program. Executes cmdas a string.\n\nOO\n\nQ arg\n\ns\n\nS\n\nt\n\ntt\n\nu\n\nU\n\nv\n\nV\n\nx\n\n-c cmd\n\nF h Lib f L Bdff\n\n174\n\nChapter 10 Execution Environment\n\nThe -i option starts an interactive session immediately after a program has finished exe- cution and is useful for debugging.The -m option runs a library module as a script which executes inside the __main__ module prior to the execution of the main script. The -O and -OO options apply some optimization to byte-compiled files and are described in Chapter 8,“Modules, Packages, and Distribution.”The -S option omits the site initialization module described in the later section “Site Configuration Files.” The -t, -tt, and -v options report additional warnings and debugging information. -x ignores the first line of a program in the event that it’s not a valid Python statement (for example, when the first line starts the Python interpreter in a script).\n\nThe program name appears after all the interpreter options. If no name is given, or the hyphen (-) character is used as a filename, the interpreter reads the program from standard input. If standard input is an interactive terminal, a banner and prompt are pre- sented. Otherwise, the interpreter opens the specified file and executes its statements until an end-of-file marker is reached.The -c cmdoption can be used to execute short programs in the form of a command-line option—for example, python -c \"print('hello world')\".\n\nCommand-line options appearing after the program name or hyphen (-) are passed\n\nto the program in sys.argv, as described in the section “Reading Options and Environment Variables” in Chapter 9,“Input and Output.”\n\nAdditionally, the interpreter reads the following environment variables:\n\nTable 10.2\n\nInterpreter Environment Variables\n\nEnvironment Variable\n\nDescription\n\nPYTHONPATH\n\nPYTHONSTARTUP\n\nPYTHONHOME\n\nPYTHONINSPECT\n\nPYTHONUNBUFFERED\n\nPYTHONIOENCODING\n\nPYTHONDONTWRITEBYTECODE\n\nPYTHONOPTIMIZE\n\nPYTHONNOUSERSITE\n\nPYTHONVERBOSE\n\nPYTHONUSERBASE\n\nColon-separated module search path. File executed on interactive startup. Location of the Python installation. Implies the -i option. Implies the -u option. Encoding and error handling for stdin, stdout, and stderr. This is a string of the form \"encoding[:errors]\" such as \"utf-8\" or \"utf- 8:ignore\". Implies the -B option Implies the -O option. Implies the -s option. Implies the -v option. Root directory for per-user site packages. Indicates to use case-insensitive matching for module names used by import.\n\nPYTHONCASEOK\n\nPYTHONPATH specifies a module search path that is inserted into the beginning of sys.path, which is described in Chapter 9. PYTHONSTARTUP specifies a file to execute when the interpreter runs in interactive mode.The PYTHONHOME variable is used to set the location of the Python installation but is rarely needed because Python knows how\n\nF h Lib f L Bdff\n\nInteractive Sessions\n\n175\n\nto find its own libraries and the site-packages directory where extensions are nor- mally installed. If a single directory such as /usr/local is given, the interpreter expects to find all files in that location. If two directories are given, such as /usr/local:/usr/ local/sparc-solaris-2.6, the interpreter searches for platform-independent files in the first directory and platform-dependent files in the second. PYTHONHOME has no effect if no valid Python installation exists at the specified location.\n\nThe PYTHONIOENCODING environment setting might be of interest to users of Python 3 because it sets both the encoding and error handling of the standard I/O streams.This might be important because Python 3 directly outputs Unicode while running the interactive interpreter prompt.This, in turn, can cause unexpected excep- tions merely while inspecting data. For example:\n\n>>> a = 'Jalape\\xf1o' >>> a Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module> File \"/tmp/lib/python3.0/io.py\", line 1486, in write\n\nb = encoder.encode(s)\n\nFile \"/tmp/lib/python3.0/encodings/ascii.py\", line 22, in encode\n\nreturn codecs.ascii_encode(input, self.errors)[0]\n\nUnicodeEncodeError: 'ascii' codec can't encode character '\\xf1' in position 7: ordinal not in range(128) >>>\n\nTo fix this, you can set the environment variable PYTHONIOENCODING to something such as 'ascii:backslashreplace' or 'utf-8'. Now, you will get this:\n\n>>> a = 'Jalape\\xf1o' >>> a 'Jalape\\xf1o' >>>\n\nOn Windows, some of the environment variables such as PYTHONPATH are addition-\n\nally read from registry entries found in HKEY_LOCAL_MACHINE/Software/Python.\n\nInteractive Sessions If no program name is given and the standard input to the interpreter is an interactive terminal, Python starts in interactive mode. In this mode, a banner message is printed and the user is presented with a prompt. In addition, the interpreter evaluates the script contained in the PYTHONSTARTUP environment variable (if set).This script is evaluated as if it’s part of the input program (that is, it isn’t loaded using an import statement). One application of this script might be to read a user configuration file such as .pythonrc.\n\nWhen interactive input is being accepted, two user prompts appear.The >>> prompt appears at the beginning of a new statement; the ... prompt indicates a statement con- tinuation. Here’s an example:\n\n>>> for i in range(0,4): print i, ... ... 0 1 2 3 >>>\n\nF h Lib f L Bdff\n\n176\n\nChapter 10 Execution Environment\n\nIn customized applications, you can change the prompts by modifying the values of sys.ps1 and sys.ps2.\n\nOn some systems, Python may be compiled to use the GNU readline library. If enabled, this library provides command histories, completion, and other additions to Python’s interactive mode.\n\nBy default, the output of commands issued in interactive mode is generated by printing the output of the built-in repr() function on the result.This can be changed by setting the variable sys.displayhook to a function responsible for displaying results. Here’s an example that truncates long results:\n\n>>> def my_display(x): ... ... ... >>> sys.displayhook = my_display >>> 3+4 7 >>> range(100000) [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 1...] >>>\n\nr = repr(x) if len(r) > 40: print(r[:40]+\"...\"+r[-1]) else: print(r)\n\nFinally, in interactive mode, it is useful to know that the result of the last operation is stored in a special variable (_).This variable can be used to retrieve the result should you need to use it in subsequent operations. Here’s an example:\n\n>>> 7 + 3 10 >>> _ + 2 12 >>>\n\nThe setting of the _ variable occurs in the displayhook() function shown previously. If you redefine displayhook(), your replacement function should also set _ if you want to retain that functionality.\n\nLaunching Python Applications In most cases, you’ll want programs to start the interpreter automatically, rather than first having to start the interpreter manually. On UNIX, this is done by giving the pro- gram execute permission and setting the first line of a program to something like this:\n\n#!/usr/bin/env python # Python code from this point on... print \"Hello world\" ...\n\nOn Windows, double-clicking a .py, .pyw, .wpy, .pyc, or .pyo file automatically launches the interpreter. Normally, programs run in a console window unless they’re renamed with a .pyw suffix (in which case the program runs silently). If it’s necessary to supply options to the interpreter, Python can also be started from a .bat file. For exam- ple, this .bat file simply runs Python on a script and passes any options supplied on the command prompt along to the interpreter:\n\n:: foo.bat :: Runs foo.py script and passes supplied command line options along (if any) c:\\python26\\python.exe c:\\pythonscripts\\foo.py %*\n\nF h Lib f L Bdff\n\nPer-user Site Packages\n\n177\n\nSite Configuration Files A typical Python installation may include a number of third-party modules and pack- ages.To configure these packages, the interpreter first imports the module site.The role of site is to search for package files and to add additional directories to the mod- ule search path sys.path. In addition, the site module sets the default encoding for Unicode string conversions.\n\nThe site module works by first creating a list of directory names constructed from\n\nthe values of sys.prefix and sys.exec_prefix as follows:\n\n[ sys.prefix, # Windows only sys.exec_prefix, # Windows only sys.prefix + 'lib/pythonvers/site-packages', sys.prefix + 'lib/site-python', sys.exec_prefix + 'lib/pythonvers/site-packages', sys.exec_prefix + 'lib/site-python' ]\n\nIn addition, if enabled, a user-specific site packages directory may be added to this list (described in the next section).\n\nFor each directory in the list, a check is made to see whether the directory exists. If so, it’s added to the sys.path variable. Next, a check is made to see whether it contains any path configuration files (files with a .pth suffix).A path configuration file contains a list of directories, zip files, or .egg files relative to the location of the path file that should be added to sys.path. For example:\n\n# foo package configuration file 'foo.pth' foo bar\n\nEach directory in the path configuration file must be listed on a separate line. Comments and blank lines are ignored.When the site module loads the file, it checks to see whether each directory exists. If so, the directory is added to sys.path. Duplicated items are added to the path only once.\n\nAfter all paths have been added to sys.path, an attempt is made to import a mod-\n\nule named sitecustomize.The purpose of this module is to perform any additional (and arbitrary) site customization. If the import of sitecustomize fails with an ImportError, the error is silently ignored.The import of sitecustomize occurs prior to adding any user directories to sys.path.Thus, placing this file in your own directo- ry has no effect.\n\nThe site module is also responsible for setting the default Unicode encoding. By\n\ndefault, the encoding is set to 'ascii'. However, the encoding can be changed by placing code in sitecustomize.py that calls sys.setdefaultencoding() with a new encoding such as 'utf-8'. If you’re willing to experiment, the source code of site can also be modified to automatically set the encoding based on the machine’s locale settings.\n\nPer-user Site Packages Normally, third-party modules are installed in a way that makes them accessible to all users. However, individual users can install modules and packages in a per-user site directory. On UNIX and Macintosh systems, this directory is found under ~/.local and is named something such as ~/.local/lib/python2.6/site-packages. On Windows systems, this directory is determined by the %APPDATA% environment variable,\n\nF h Lib f L Bdff\n\n178\n\nChapter 10 Execution Environment\n\nwhich is usually something similar to C:\\Documents and Settings\\David Beazley\\Application Data.Within that folder, you will find a \"Python\\Python26\\ site-packages\" directory.\n\nIf you are writing your own Python modules and packages that you want to use in a library, they can be placed in the per-user site directory. If you are installing third-party modules, you can manually install them in this directory by supplying the --user option to setup.py. For example: python setup.py install --user.\n\nEnabling Future Features New language features that affect compatibility with older versions of Python are often disabled when they first appear in a release.To enable these features, the statement from __future__ import featurecan be used. Here’s an example:\n\n# Enable new division semantics from __future__ import division\n\nWhen used, this statement should appear as the first statement of a module or program. Moreover, the scope of a __future__ import is restricted only to the module in which it is used.Thus, importing a future feature does not affect the behavior of Python’s library modules or older code that requires the previous behavior of the interpreter to operate correctly.\n\nCurrently, the following features have been defined:\n\nTable 10.3\n\nFeature Names in the __future__ Module\n\nFeature Name\n\nDescription\n\nnested_scopes\n\ngenerators\n\ndivision\n\nSupport for nested scopes in functions. First introduced in Python 2.1 and made the default behavior in Python 2.2. Support for generators. First introduced in Python 2.2 and made the default behavior in Python 2.3. Modified division semantics where integer division returns a frac- tional result. For example, 1/4 yields 0.25 instead of 0. First introduced in Python 2.2 and is still an optional feature as of Python 2.6. This is the default behavior in Python 3.0.\n\nabsolute_import Modified behavior of package-relative imports. Currently, when a\n\nwith_statement\n\nprint_function\n\nsubmodule of a package makes an import statement such as import string, it first looks in the current directory of the package and then directories in sys.path. However, this makes it impos- sible to load modules in the standard library if a package hap- pens to use conflicting names. When this feature is enabled, the statement import module is an absolute import. Thus, a state- ment such as import string will always load the string mod- ule from the standard library. First introduced in Python 2.5 and still disabled in Python 2.6. It is enabled in Python 3.0. Support for context managers and the with statement. First introduced in Python 2.5 and enabled by default in Python 2.6. Use Python 3.0 print() function instead of the print state- ment. First introduced in Python 2.6 and enabled by default in Python 3.0.\n\nF h Lib f L Bdff\n\nProgram Termination\n\n179\n\nIt should be noted that no feature name is ever deleted from __future__. Thus, even if a feature is turned on by default in a later Python version, no existing code that uses that feature name will break.\n\nProgram Termination A program terminates when no more statements exist to execute in the input program, when an uncaught SystemExit exception is raised (as generated by sys.exit()), or when the interpreter receives a SIGTERM or SIGHUP signal (on UNIX). On exit, the interpreter decrements the reference count of all objects in all the currently known namespaces (and destroys each namespace as well). If the reference count of an object reaches zero, the object is destroyed and its __del__() method is invoked.\n\nIt’s important to note that in some cases the __del__() method might not be invoked at program termination.This can occur if circular references exist between objects (in which case objects may be allocated but accessible from no known name- space).Although Python’s garbage collector can reclaim unused circular references dur- ing execution, it isn’t normally invoked on program termination.\n\nBecause there’s no guarantee that __del__() will be invoked at termination, it may\n\nbe a good idea to explicitly clean up certain objects, such as open files and network connections.To accomplish this, add specialized cleanup methods (for example, close()) to user-defined objects.Another possibility is to write a termination function and register it with the atexit module, as follows:\n\nimport atexit connection = open_connection(\"deaddot.com\")\n\ndef cleanup():\n\nprint \"Going away...\" close_connection(connection)\n\natexit.register(cleanup)\n\nThe garbage collector can also be invoked in this manner:\n\nimport atexit, gc atexit.register(gc.collect)\n\nOne final peculiarity about program termination is that the __del__ method for some objects may try to access global data or methods defined in other modules. Because these objects may already have been destroyed, a NameError exception occurs in __del__, and you may get an error such as the following:\n\nException exceptions.NameError: 'c' in <method Bar.__del__ of Bar instance at c0310> ignored\n\nIf this occurs, it means that __del__ has aborted prematurely. It also implies that it may have failed in an attempt to perform an important operation (such as cleanly shutting down a server connection). If this is a concern, it’s probably a good idea to perform an explicit shutdown step in your code, rather than rely on the interpreter to destroy objects cleanly at program termination.The peculiar NameError exception can also be\n\nF h Lib f L Bdff\n\n180\n\nChapter 10 Execution Environment\n\neliminated by declaring default arguments in the declaration of the __del__() method:\n\nimport foo class Bar(object):\n\ndef __del__(self, foo=foo):\n\nfoo.bar() # Use something in module foo\n\nIn some cases, it may be useful to terminate program execution without performing any cleanup actions.This can be accomplished by calling os._exit(status).This function provides an interface to the low-level exit() system call responsible for killing the Python interpreter process.When it’s invoked, the program immediately terminates without any further processing or cleanup.\n\nF h Lib f L Bdff\n\n11\n\nTesting, Debugging, Profiling, and Tuning\n\nUnlike programs in languages such as C or Java, Python programs are not processed\n\nby a compiler that produces an executable program. In those languages, the compiler is the first line of defense against programming errors—catching mistakes such as calling functions with the wrong number of arguments or assigning improper values to vari- ables (that is, type checking). In Python, however, these kinds of checks do not occur until a program runs. Because of this, you will never really know if your program is cor- rect until you run and test it. Not only that, unless you are able to run your program in a way that executes every possible branch of its internal control-flow, there is always some chance of a hidden error just waiting to strike (fortunately, this usually only hap- pens a few days after shipping, however).\n\nTo address these kinds of problems, this chapter covers techniques and library mod- ules used to test, debug, and profile Python code.At the end, some strategies for opti- mizing Python code are discussed.\n\nDocumentation Strings and the doctest Module If the first line of a function, class, or module is a string, that string is known as a docu- mentation string.The inclusion of documentation strings is considered good style because these strings are used to supply information to Python software development tools. For example, the help() command inspects documentation strings, and Python IDEs look at the strings as well. Because programmers tend to view documentation strings while experimenting in the interactive shell, it is common for the strings to include short interactive examples. For example:\n\n# splitter.py def split(line, types=None, delimiter=None):\n\n\"\"\"Splits a line of text and optionally performs type conversion.\n\nFor example:\n\n>>> split('GOOG 100 490.50') ['GOOG', '100', '490.50'] >>> split('GOOG 100 490.50',[str, int, float]) ['GOOG', 100, 490.5] >>>\n\nF h Lib f L Bdff\n\n182\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nBy default, splitting is performed on whitespace, but a different delimiter can be selected with the delimiter keyword argument:\n\n>>> split('GOOG,100,490.50',delimiter=',') ['GOOG', '100', '490.50'] >>>\n\n\"\"\" fields = line.split(delimiter) if types:\n\nfields = [ ty(val) for ty,val in zip(types,fields) ]\n\nreturn fields\n\nA common problem with writing documentation is keeping the documentation syn- chronized with the actual implementation of a function. For example, a programmer might modify a function but forget to update the documentation.\n\nTo address this problem, use the doctest module. doctest collects documentation strings, scans them for interactive sessions, and executes them as a series of tests.To use doctest, you typically create a separate module for testing. For example, if the previous function is in a file splitter.py, you would create a file testsplitter.py for test- ing, as follows:\n\n# testsplitter.py import splitter import doctest\n\nnfail, ntests = doctest.testmod(splitter)\n\nIn this code, the call to doctest.testmod(module) runs tests on the specified module and returns the number of failures and total number of tests executed. No output is produced if all of the tests pass. Otherwise, you will get a failure report that shows the difference between the expected and received output. If you want to see verbose output of the tests, you can use testmod(module, verbose=True).\n\nAs an alternative to creating a separate testing file, library modules can test them-\n\nselves by including code such as this at the end of the file:\n\n... if _ _name_ _ == '_ _main_ _':\n\n# test myself import doctest doctest.testmod()\n\nWith this code, documentation tests will run if the file is run as the main program to the interpreter. Otherwise, the tests are ignored if the file is loaded with import.\n\ndoctest expects the output of functions to literally match the exact output you get in the interactive interpreter.As a result, it is quite sensitive to issues of white space and numerical precision. For example, consider this function:\n\ndef half(x):\n\n\"\"\"Halves x. For example:\n\n>>> half(6.8) 3.4 >>> \"\"\" return x/2\n\nF h Lib f L Bdff\n\nUnit Testing and the unittest Module\n\n183\n\nIf you run doctest on this function, you will get a failure report such as this:\n\n********************************************************************** File \"half.py\", line 4, in _ _main_ _.half Failed example:\n\nhalf(6.8)\n\nExpected:\n\n3.4\n\nGot:\n\n3.3999999999999999\n\n**********************************************************************\n\nTo fix this, you either need to make the documentation exactly match the output or need to pick a better example in the documentation.\n\nBecause using doctest is almost trivial, there is almost no excuse for not using it with your own programs. However, keep in mind that doctest is not a module you would typically use for exhaustive program testing. Doing so tends to result in exces- sively long and complicated documentation strings—which defeats the point of produc- ing useful documentation (e.g., a user will probably be annoyed if he asks for help and the documentation lists 50 examples covering all sorts of tricky corner cases). For this kind of testing, you want to use the unittest module.\n\nLast, the doctest module has a large number of configuration options that concerns various aspects of how testing is performed and how results are reported. Because these options are not required for the most common use of the module, they are not covered here. Consult http://docs.python.org/library/doctest.html for more details.\n\nUnit Testing and the unittest Module For more exhaustive program testing, use the unittest module.With unit testing, a developer writes a collection of isolated test cases for each element that makes up a pro- gram (for example, individual functions, methods, classes, and modules).These tests are then run to verify correct behavior of the basic building blocks that make up larger programs.As programs grow in size, unit tests for various components can be combined to create large testing frameworks and testing tools.This can greatly simplify the task of verifying correct behavior as well as isolating and fixing problems when they do occur. Use of this module can be illustrated by the code listing in the previous section:\n\n# splitter.py def split(line, types=None, delimiter=None):\n\n\"\"\"Splits a line of text and optionally performs type conversion.\n\n...\n\n\"\"\" fields = line.split(delimiter) if types:\n\nfields = [ ty(val) for ty,val in zip(types,fields) ]\n\nreturn fields\n\nF h Lib f L Bdff\n\n184\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nIf you wanted to write unit tests for testing various aspects of the split() function, you would create a separate module testsplitter.py, like this:\n\n# testsplitter.py import splitter import unittest\n\n# Unit tests class TestSplitFunction(unittest.TestCase):\n\ndef setUp(self):\n\n# Perform set up actions (if any) pass\n\ndef tearDown(self):\n\n# Perform clean-up actions (if any) pass\n\ndef testsimplestring(self):\n\nr = splitter.split('GOOG 100 490.50') self.assertEqual(r,['GOOG','100','490.50'])\n\ndef testtypeconvert(self):\n\nr = splitter.split('GOOG 100 490.50',[str, int, float]) self.assertEqual(r,['GOOG', 100, 490.5])\n\ndef testdelimiter(self):\n\nr = splitter.split('GOOG,100,490.50',delimiter=',') self.assertEqual(r,['GOOG','100','490.50'])\n\n# Run the unittests if _ _name_ _ == '_ _main_ _':\n\nunittest.main()\n\nTo run tests, simply run Python on the file testsplitter.py. Here’s an example:\n\n% python testsplitter.py ... ---------------------------------------------------------------------- Ran 3 tests in 0.014s\n\nOK\n\nBasic use of unittest involves defining a class that inherits from unittest.TestCase. Within this class, individual tests are defined by methods starting with the name 'test'—for example, 'testsimplestring', 'testtypeconvert', and so on. (It is important to emphasize that the names are entirely up to you as long as they start with 'test'.) Within each test, various assertions are used to check for different conditions. An instance, t, of unittest.TestCase has the following methods that are used\n\nwhen writing tests and for controlling the testing process:\n\nt.setUp()\n\nCalled to perform set-up steps prior to running any of the testing methods.\n\nt.tearDown()\n\nCalled to perform clean-up actions after running the tests.\n\nF h Lib f L Bdff\n\nUnit Testing and the unittest Module\n\n185\n\nt.assert_(expr [, msg]) t.failUnless(expr [, msg]) Signals a test failure if exprevaluates as False. msgis a message string giving an expla- nation for the failure (if any).\n\nt.assertEqual(x, y [,msg]) t.failUnlessEqual(x, y [, msg])\n\nSignals a test failure if xand yare not equal to each other. msgis a message explaining the failure (if any).\n\nt.assertNotEqual(x, y [, msg]) t.failIfEqual(x, y, [, msg])\n\nSignals a test failure if xand yare equal to each other. msgis a message explaining the failure (if any).\n\nt.assertAlmostEqual(x, y [, places [, msg]]) t.failUnlessAlmostEqual(x, y, [, places [, msg]])\n\nSignals a test failure if numbers xand yare not within placesdecimal places of each other.This is checked by computing the difference of xand y and rounding the result to the given number of places. If the result is zero, xand yare almost equal. msgis a message explaining the failure (if any).\n\nt.assertNotAlmostEqual(x, y, [, places [, msg]]) t.failIfAlmostEqual(x, y [, places [, msg]])\n\nSignals a test failure if xand yare not at least placesdecimal places apart. msgis a message explaining the failure (if any).\n\nt.assertRaises(exc, callable, ...) t.failUnlessRaises(exc, callable, ...)\n\nSignals a test failure if the callable object callabledoes not raise the exception exc. Remaining arguments are passed as arguments to callable. Multiple exceptions can be checked by using a tuple of exceptions as exc.\n\nt.failIf(expr [, msg])\n\nSignals a test failure if exprevaluates as True. msgis a message explaining the failure (if any).\n\nt.fail([msg])\n\nSignals a test failure. msgis a message explaining the failure (if any).\n\nt.failureException\n\nThis attribute is set to the last exception value caught in a test.This may be useful if you not only want to check that an exception was raised, but that the exception raises an appropriate value—for example, if you wanted to check the error message generated as part of raising an exception.\n\nF h Lib f L Bdff\n\n186\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nIt should be noted that the unittest module contains a large number of advanced customization options for grouping tests, creating test suites, and controlling the envi- ronment in which tests run.These features are not directly related to the process of writing tests for your code (you tend to write testing classes as shown independently of how tests actually get executed). Consult the documentation at http://docs.python.org/ library/unittest.html for more information on how to organize tests for larger programs.\n\nThe Python Debugger and the pdb Module Python includes a simple command-based debugger which is found in the pdb module. The pdb module supports post-mortem debugging, inspection of stack frames, break- points, single-stepping of source lines, and code evaluation.\n\nThere are several functions for invoking the debugger from a program or from the\n\ninteractive Python shell.\n\nrun(statement [, globals [, locals]])\n\nExecutes the string statementunder debugger control.The debugger prompt will appear immediately before any code executes.Typing 'continue' will force it to run. globalsand localsdefine the global and local namespaces, respectively, in which the code runs.\n\nruneval(expression [, globals [, locals]])\n\nEvaluates the expressionstring under debugger control.The debugger prompt will appear before any code executes, so you will need to type 'continue' to force it to execute as with run(). On success, the value of the expression is returned.\n\nruncall(function [, argument, ...])\n\nCalls a function within the debugger. functionis a callable object.Additional argu- ments are supplied as the arguments to function.The debugger prompt will appear before any code executes.The return value of the function is returned upon comple- tion.\n\nset_trace()\n\nStarts the debugger at the point at which this function is called.This can be used to hard-code a debugger breakpoint into a specific code location.\n\npost_mortem(traceback)\n\nStarts post-mortem debugging of a traceback object. tracebackis typically obtained using a function such as sys.exc_info().\n\npm()\n\nEnters post-mortem debugging using the traceback of the last exception.\n\nOf all of the functions for launching the debugger, the set_trace() function may\n\nbe the easiest to use in practice. If you are working on a complicated application but you have detected a problem in one part of it, you can insert a set_trace() call into the code and simply run the application.When encountered, this will suspend the pro- gram and go directly to the debugger where you can inspect the execution environ- ment. Execution resumes after you leave the debugger.\n\nF h Lib f L Bdff\n\nThe Python Debugger and the pdb Module\n\n187\n\nDebugger Commands When the debugger starts, it presents a (Pdb) prompt such as the following:\n\n>>> import pdb >>> import buggymodule >>> pdb.run('buggymodule.start()') > <string>(0)?() (Pdb)\n\n(Pdb) is the debugger prompt at which the following commands are recognized. Note that some commands have a short and a long form. In this case, parentheses are used to indicate both forms. For example, h(elp) means that either h or help is acceptable.\n\n[!]statement\n\nExecutes the (one-line) statementin the context of the current stack frame.The exclamation point may be omitted, but it must be used to avoid ambiguity if the first word of the statement resembles a debugger command.To set a global variable, you can prefix the assignment command with a “global” command on the same line:\n\n(Pdb) global list_options; list_options = ['-l'] (Pdb)\n\na(rgs)\n\nPrints the argument list of the current function.\n\nalias [name [command]]\n\nCreates an alias called namethat executes command.Within the commandstring, the sub- strings '%1','%2', and so forth are replaced by parameters when the alias is typed. '%*' is replaced by all parameters. If no command is given, the current alias list is shown. Aliases can be nested and can contain anything that can be legally typed at the Pdb prompt. Here’s an example:\n\n# Print instance variables (usage \"pi classInst\") alias pi for k in %1._ _dict_ _.keys(): print \"%1.\",k,\"=\",%1._ _dict_ _[k] # Print instance variables in self alias ps pi self\n\nb(reak) [loc [, condition]]\n\nSets a breakpoint at location loc. loceither specifies a specific filename and line num- ber or is the name of a function within a module.The following syntax is used:\n\nSetting n\n\nfilename:n\n\nfunction module.function\n\nDescription A line number in the current file A line number in another file A function name in the current module A function name in a module\n\nIf locis omitted, all the current breakpoints are printed. conditionis an expression that must evaluate to true before the breakpoint is honored.All breakpoints are assigned\n\nF h Lib f L Bdff",
      "page_number": 191
    },
    {
      "number": 11,
      "title": "Segment 11 (pages 212-233)",
      "start_page": 212,
      "end_page": 233,
      "detection_method": "synthetic",
      "content": "188\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nnumbers that are printed as output upon the completion of this command.These num- bers are used in several other debugger commands that follow.\n\ncl(ear) [bpnumber [bpnumber ...]]\n\nClears a list of breakpoint numbers. If breakpoints are specified, all breaks are cleared.\n\ncommands [bpnumber]\n\nSets a series of debugger commands to execute automatically when the breakpoint bpnumberis encountered.When listing the commands to execute, simply type them on the subsequent lines and use end to mark the end of the command sequence. If you include the continue command, the execution of the program will resume automati- cally when the breakpoint is encountered. If bpnumberis omitted, the last breakpoint set is used.\n\ncondition bpnumber [condition]\n\nPlaces a condition on a breakpoint. conditionis an expression that must evaluate to true before the breakpoint is recognized. Omitting the condition clears any previous condition.\n\nc(ont(inue))\n\nContinues execution until the next breakpoint is encountered.\n\ndisable [bpnumber [bpnumber ...]]\n\nDisables the set of specified breakpoints. Unlike with clear, they can be reenabled later.\n\nd(own)\n\nMoves the current frame one level down in the stack trace.\n\nenable [bpnumber [bpnumber ...]]\n\nEnables a specified set of breakpoints.\n\nh(elp) [command]\n\nShows the list of available commands. Specifying a command returns help for that com- mand.\n\nignore bpnumber [count]\n\nIgnores a breakpoint for countexecutions.\n\nj(ump) lineno\n\nSets the next line to execute.This can only be used to move between statements in the same execution frame. Moreover, you can’t jump into certain statements, such as state- ments in the middle of a loop.\n\nl(ist) [first [, last]]\n\nLists source code.Without arguments, this command lists 11 lines around the current line (5 lines before and 5 lines after).With one argument, it lists 11 lines around that line.With two arguments, it lists lines in a given range. If lastis less than first, it’s interpreted as a count.\n\nF h Lib f L Bdff\n\nThe Python Debugger and the pdb Module\n\n189\n\nn(ext)\n\nExecutes until the next line of the current function. Skips the code contained in func- tion calls.\n\np expression\n\nEvaluates the expression in the current context and prints its value.\n\npp expression\n\nThe same as the p command, but the result is formatted using the pretty-printing mod- ule (pprint).\n\nq(uit)\n\nQuits from the debugger.\n\nr(eturn)\n\nRuns until the current function returns.\n\nrun [args]\n\nRestarts the program and uses the command-line arguments in argsas the new setting of sys.argv.All breakpoints and other debugger settings are preserved.\n\ns(tep)\n\nExecutes a single source line and stops inside called functions.\n\ntbreak [loc [, condition]]\n\nSets a temporary breakpoint that’s removed after its first hit.\n\nu(p)\n\nMoves the current frame one level up in the stack trace.\n\nunalias name\n\nDeletes the specified alias.\n\nuntil\n\nResumes execution until control leaves the current execution frame or until a line number greater than the current line number is reached. For example, if the debugger was stopped at the last line in a loop body, typing until will execute all of the state- ments in the loop until the loop is finished.\n\nw(here)\n\nPrints a stack trace.\n\nDebugging from the Command Line An alternative method for running the debugger is to invoke it on the command line. Here’s an example:\n\n% python -m pdb someprogram.py\n\nF h Lib f L Bdff\n\n190\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nIn this case, the debugger is launched automatically at the beginning of program startup where you are free to set breakpoints and make other configuration changes.To make the program run, simply use the continue command. For example, if you wanted to debug the split() function from within a program that used it, you might do this:\n\n% python –m pdb someprogram.py > /Users/beazley/Code/someprogram.py(1)<module>() -> import splitter (Pdb) b splitter.split Breakpoint 1 at /Users/beazley/Code/splitter.py:1 (Pdb) c > /Users/beazley/Code/splitter.py(18)split() -> fields = line.split(delimiter) (Pdb)\n\nConfiguring the Debugger If a .pdbrc file exists in the user’s home directory or in the current directory, it’s read in and executed as if it had been typed at the debugger prompt.This can be useful for specifying debugging commands that you want to execute each time the debugger is started (as opposed to having to interactively type the commands each time).\n\nProgram Profiling The profile and cProfile modules are used to collect profiling information. Both modules work in the same way, but cProfile is implemented as a C extension, is sig- nificantly faster, and is more modern. Either module is used to collect both coverage information (that is, what functions get executed) as well as performance statistics.The easiest way to profile a program is to execute it from the command line as follows:\n\n% python -m cProfile someprogram.py\n\nAlternatively, the following function in the profile module can be used:\n\nrun(command [, filename])\n\nExecutes the contents of commandusing the exec statement under the profiler. filenameis the name of a file in which raw profiling data is saved. If it’s omitted, a report is printed to standard output.\n\nThe result of running the profiler is a report such as the following:\n\n126 function calls (6 primitive calls) in 5.130 CPU seconds Ordered by: standard name ncalls tottime percall cumtime percall filename:lineno(function)\n\n1 0.030 0.030 5.070 5.070 <string>:1(?)\n\n121/1 5.020 0.041 5.020 5.020 book.py:11(process)\n\n1 0.020 0.020 5.040 5.040 book.py:5(?) 2 0.000 0.000 0.000 0.000 exceptions.py:101(_ _init_ _) 1 0.060 0.060 5.130 5.130 profile:0(execfile('book.py')) 0 0.000 0.000 profile:0(profiler)\n\nDifferent parts of the report generated by run() are interpreted as follows:\n\nF h Lib f L Bdff\n\nTuning and Optimization\n\n191\n\nSection primitive calls\n\nncalls\n\ntottime\n\npercall\n\ncumtime\n\nDescription Number of nonrecursive function calls Total number of calls (including self-recursion) Time spent in this function (not counting subfunctions) tottime/ncalls Total time spent in the function cumtime/(primitive calls)\n\npercall filename:lineno(function) Location and name of each function\n\nWhen there are two numbers in the first column (for example, \"121/1\"), the latter is the number of primitive calls and the former is the actual number of calls.\n\nSimply inspecting the generated report of the profiler is often enough for most appli-\n\ncations of this module—for example, if you simply want to see how your program is spending its time. However, if you want to save the data and analyze it further, the pstats module can be used. Consult http://docs.python.org/library/profile.html for more details about saving and analyzing the profile data.\n\nTuning and Optimization This section covers some general rules of thumb that can be used to make Python pro- grams run faster and use less memory.The techniques described here are by no means exhaustive but should give programmers some ideas when looking at their own code.\n\nMaking Timing Measurements If you simply want to time a long-running Python program, the easiest way to do it is often just to run it until the control of something like the UNIX time command. Alternatively, if you have a block of long-running statements you want to time, you can insert calls to time.clock() to get a current reading of the elapsed CPU time or calls to time.time() to read the current wall-clock time. For example:\n\nstart_cpu = time.clock() start_real= time.time() statements statements end_cpu = time.clock() end_real = time.time() print(\"%f Real Seconds\" % (end_real – start_real)) print(\"%f CPU seconds\" % (end_cpu - start_cpu))\n\nKeep in the mind that this technique really works only if the code to be timed runs for a reasonable period of time. If you have a fine-grained statement you want to bench- mark, you can use the timeit(code [, setup]) function in the timeit module. For example:\n\n>>> from timeit import timeit >>> timeit('math.sqrt(2.0)','import math') 0.20388007164001465 >>> timeit('sqrt(2.0)','from math import sqrt') 0.14494490623474121\n\nF h Lib f L Bdff\n\n192\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nIn this example, the first argument to timeit() is the code you want to benchmark. The second argument is a statement that gets executed once in order to set up the exe- cution environment.The timeit() function runs the supplied statement one million times and reports the execution time.The number of repetitions can be changed by supplying a number=countkeyword argument to timeit().\n\nThe timeit module also has a function repeat() that can be used to make meas- urements.This function works the same way as timeit() except that it repeats the tim- ing measurement three times and returns a list of the results. For example:\n\n>>> from timeit import repeat >>> repeat('math.sqrt(2.0)','import math') [0.20306601524353027, 0.19715800285339355, 0.20907392501831055] >>>\n\nWhen making performance measurement, it is common to refer to the associated speedup, which usually refers to the original execution time divided by the new execu- tion time. For example, in the previous timing measurements, using sqrt(2.0) instead of math.sqrt(2.0) represents a speedup of 0.20388/0.14494 or about 1.41. Sometimes this gets reported as a percentage by saying the speedup is about 41 percent.\n\nMaking Memory Measurements The sys module has a function getsizeof() that can be used to investigate the mem- ory footprint (in bytes) of individual Python objects. For example:\n\n>>> import sys >>> sys.getsizeof(1) 14 >>> sys.getsizeof(\"Hello World\") 52 >>> sys.getsizeof([1,2,3,4]) 52 >>> sum(sys.getsizeof(x) for x in [1,2,3,4]) 56\n\nFor containers such as lists, tuples, and dictionaries, the size that gets reported is just for the container object itself, not the cumulative size of all objects contained inside of it. For instance, in the previous example, the reported size of the list [1,2,3,4] is actually smaller than the space required for four integers (which are 14 bytes each).This is because the contents of the list are not included in the total.You can use sum() as shown here to calculate the total size of the list contents.\n\nBe aware that the getsizeof() function is only going to give you a rough idea of\n\noverall memory use for various objects. Internally, the interpreter aggressively shares objects via reference counting so the actual memory consumed by an object might be far less than you first imagine.Also, given that C extensions to Python can allocate memory outside of the interpreter, it may be difficult to precisely get a measurement of overall memory use.Thus, a secondary technique for measuring the actual memory footprint is to inspect your running program from an operating system process viewer or task manager.\n\nFrankly, a better way to get a handle on memory use may be to sit down and be analytical about it. If you know your program is going to allocate various kinds of data structures and you know what kinds of data will be stored in those structures (that is, ints, floats, strings, and so on), you can use the results of the getsizeof() function to\n\nF h Lib f L Bdff\n\nTuning and Optimization\n\n193\n\nobtain figures for calculating an upper bound on your program’s memory footprint—or at the very least, you can get enough information to carry out a “back of the envelope” estimate.\n\nDisassembly The dis module can be used to disassemble Python functions, methods, and classes into low-level interpreter instructions.The module defines a function dis() that can be used like this:\n\n>>> from dis import dis >>> dis(split)\n\n2 0 LOAD_FAST 0 (line)\n\n3 LOAD_ATTR 0 (split) 6 LOAD_FAST 1 (delimiter) 9 CALL_FUNCTION 1\n\n12 STORE_FAST 2 (fields)\n\n3 15 LOAD_GLOBAL 1 (types) 18 JUMP_IF_FALSE 58 (to 79) 21 POP_TOP\n\n4 22 BUILD_LIST 0\n\n25 DUP_TOP 26 STORE_FAST 3 (_[1]) 29 LOAD_GLOBAL 2 (zip) 32 LOAD_GLOBAL 1 (types) 35 LOAD_FAST 2 (fields) 38 CALL_FUNCTION 2 41 GET_ITER\n\n>> 42 FOR_ITER 25 (to 70)\n\n45 UNPACK_SEQUENCE 2 48 STORE_FAST 4 (ty) 51 STORE_FAST 5 (val) 54 LOAD_FAST 3 (_[1]) 57 LOAD_FAST 4 (ty) 60 LOAD_FAST 5 (val) 63 CALL_FUNCTION 1 66 LIST_APPEND 67 JUMP_ABSOLUTE 42\n\n>> 70 DELETE_FAST 3 (_[1])\n\n73 STORE_FAST 2 (fields) 76 JUMP_FORWARD 1 (to 80)\n\n>> 79 POP_TOP\n\n5 >> 80 LOAD_FAST 2 (fields)\n\n83 RETURN_VALUE\n\n>>>\n\nExpert programmers can use this information in two ways. First, a disassembly will show you exactly what operations are involved in executing a function.With careful study, you might spot opportunities for making speedups. Second, if you are program- ming with threads, each line printed in the disassembly represents a single interpreter operation—each of which has atomic execution.Thus, if you are trying to track down a tricky race condition, this information might be useful.\n\nF h Lib f L Bdff\n\n194\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nTuning Strategies The following sections outline a few optimization strategies that, in the opinion of the author, have proven to be useful with Python code.\n\nUnderstand Your Program Before you optimize anything, know that speedup obtained by optimizing part of a program is directly related to that part’s total contribution to the execution time. For example, if you optimize a function by making it run 10 times as fast but that function only contributes to 10 percent of the program’s total execution time, you’re only going to get an overall speedup of about 9%–10%. Depending on the effort involved in mak- ing the optimization, this may or may not be worth it.\n\nIt is always a good idea to first use the profiling module on code you intend to opti-\n\nmize.You really only want to focus on functions and methods where your program spends most of its time, not obscure operations that are called only occasionally.\n\nUnderstand Algorithms A poorly implemented O(n log n) algorithm will outperform the most finely tuned O(n3) algorithm. Don’t optimize inefficient algorithms—look for a better algorithm first.\n\nUse the Built-In Types Python’s built-in tuple, list, set, and dictionary types are implemented entirely in C and are the most finely tuned data structures in the interpreter.You should actively use these types to store and manipulate data in your program and resist the urge to build your own custom data structures that mimic their functionality (that is, binary search trees, linked lists, and so on).\n\nHaving said that, you should still look more closely at types in the standard library. Some library modules provide new types that outperform the built-ins at certain tasks. For instance, the collection.deque type provides similar functionality to a list but has been highly optimized for the insertion of new items at both ends.A list, in contrast, is only efficient when appending items at the end. If you insert items at the front, all of the other elements need to be shifted in order to make room.The time required to do this grows as the list gets larger and larger. Just to give you an idea of the difference, here is a timing measurement of inserting one million items at the front of a list and a deque:\n\n>>> from timeit import timeit >>> timeit('s.appendleft(37)', ... 'import collections; s = collections.deque()', ... number=1000000) 0.24434304237365723 >>> timeit('s.insert(0,37)', 's = []', number=1000000) 612.95199513435364\n\nDon’t Add Layers Any time you add an extra layer of abstraction or convenience to an object or a func- tion, you will slow down your program. However, there is also a trade-off between usability and performance. For instance, the whole point of adding an extra layer is often to simplify coding, which is also a good thing.\n\nF h Lib f L Bdff\n\nTuning and Optimization\n\n195\n\nTo illustrate with a simple example, consider a program that makes use of the\n\ndict() function to create dictionaries with string keys like this:\n\ns = dict(name='GOOG',shares=100,price=490.10) # s = {'name':'GOOG', 'shares':100, 'price':490.10 }\n\nA programmer might create dictionaries in this way to save typing (you don’t have to put quotes around the key names). However, this alternative way of creating a dictionary also runs much more slowly because it adds an extra function call.\n\n>>> timeit(\"s = {'name':'GOOG','shares':100,'price':490.10}\") 0.38917303085327148 >>> timeit(\"s = dict(name='GOOG',shares=100,price=490.10)\") 0.94420003890991211\n\nIf your program creates millions of dictionaries as it runs, then you should know that the first approach is faster.With few exceptions, any feature that adds an enhancement or changes the way in which an existing Python object works will run more slowly.\n\nKnow How Classes and Instances Build Upon Dictionaries User-defined classes and instances are built using dictionaries. Because of this, operations that look up, set, or delete instance data are almost always going to run more slowly than directly performing these operations on a dictionary. If all you are doing is build- ing a simple data structure for storing data, a dictionary may be a more efficient choice than defining a class.\n\nJust to illustrate the difference, here is a simple class that represents a holding of\n\nstock:\n\nclass Stock(object):\n\ndef _ _init_ _(self,name,shares,price):\n\nself.name = name self.shares = shares self.price = price\n\nIf you compare the performance of using this class against a dictionary, the results are interesting. First, let’s compare the performance of simply creating instances:\n\n>>> from timeit import timeit >>> timeit(\"s = Stock('GOOG',100,490.10)\",\"from stock import Stock\") 1.3166780471801758 >>> timeit(\"s = {'name' : 'GOOG', 'shares' : 100, 'price' : 490.10 }\") 0.37812089920043945 >>>\n\nHere, the speedup of creating new objects is about 3.5. Next, let’s look at the perform- ance of performing a simple calculation:\n\n>>> timeit(\"s.shares*s.price\", ... 0.29100513458251953 >>> timeit(\"s['shares']*s['price']\", ... 0.23622798919677734 >>>\n\n\"from stock import Stock; s = Stock('GOOG',100,490.10)\")\n\n\"s = {'name' : 'GOOG', 'shares' : 100, 'price' : 490.10 }\")\n\nHere, the speedup is about 1.2.The lesson here is that just because you can define a new object using a class, it’s not the only way to work with data.Tuples and diction- aries are often good enough. Using them will make your program run more quickly and use less memory.\n\nF h Lib f L Bdff\n\n196\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nUse __slots__ If your program creates a large number of instances of user-defined classes, you might consider using the _ _slots_ _ attribute in a class definition. For example:\n\nclass Stock(object):\n\n__slots__ = ['name','shares','price'] def __init__(self,name,shares,price):\n\nself.name = name self.shares = shares self.price = price\n\n_ _slots_ _ is sometimes viewed as a safety feature because it restricts the set of attrib- ute names. However, it is really more of a performance optimization. Classes that use _ _slots_ _ don’t use a dictionary for storing instance data (instead, a more efficient internal data structure is used). So, not only will instances use far less memory, but access to instance data is also more efficient. In some cases, simply adding _ _slots_ _ will make a program run noticeably faster without making any other changes.\n\nThere is one caution with using _ _slots_ _, however.Adding this feature to a class\n\nmay cause other code to break mysteriously. For example, it is generally well-known that instances store their data in a dictionary that can be accessed as the _ _dict_ _ attribute.When slots are defined, this attribute doesn’t exist so any code that relies on _ _dict_ _ will fail.\n\nAvoid the (.) Operator Whenever you use the (.) to look up an attribute on an object, it always involves a name lookup. For example, when you say x.name, there is a lookup for the variable name \"x\" in the environment and then a lookup for the attribute \"name\" on x. For user-defined objects, attribute lookup may involve looking in the instance dictionary, the class dictionary, and the dictionaries of base-classes.\n\nFor calculations involving heavy use of methods or module lookups, it is almost always better to eliminate the attribute lookup by putting the operation you want to perform into a local variable first. For example, if you were performing a lot of square root operations, it is faster to use 'from math import sqrt' and 'sqrt(x)' rather than typing 'math.sqrt(x)'. In the first part of this section, we saw that this approach resulted in speedup of about 1.4.\n\nObviously you should not try to eliminate attribute lookups everywhere in your program because it will make your code very difficult to read. However, for performance-critical sections, this is a useful technique.\n\nUse Exceptions to Handle Uncommon Cases To avoid errors, you might be inclined to add extra checks to a program. For example:\n\ndef parse_header(line):\n\nfields = line.split(\":\") if len(fields) != 2:\n\nraise RuntimeError(\"Malformed header\")\n\nheader, value = fields return header.lower(), value.strip()\n\nF h Lib f L Bdff\n\nTuning and Optimization\n\n197\n\nHowever, an alternative way to handle errors is to simply let the program generate an exception and to catch it. For example:\n\ndef parse_header(line):\n\nfields = line.split(\":\") try:\n\nheader, value = fields return header.lower(), value.strip()\n\nexcept ValueError:\n\nraise RuntimeError(\"Malformed header\")\n\nIf you benchmark both versions on a properly formatted line, the second version of code runs about 10 percent faster. Setting up a try block for code that normally doesn’t raise an exceptions runs more quickly than executing an if statement.\n\nAvoid Exceptions for Common Cases Don’t write code that uses exception handling for the common case. For example, sup- pose you had a program that performed a lot of dictionary lookups, but most of these lookups were for keys that didn’t exist. Now, consider two approaches to performing a lookup:\n\n# Approach 1 : Perform a lookup and catch an exception\n\ntry:\n\nvalue = items[key]\n\nexcept KeyError: value = None\n\n# Approach 2: Check if the key exists and perform a lookup if key in items:\n\nvalue = items[key]\n\nelse:\n\nvalue = None\n\nIn a simple performance measurement where the key is not found, the second approach runs more than 17 times faster! In case you were wondering, this latter approach also runs almost twice as fast as using items.get(key) because the in operator is faster to execute than a method call.\n\nEmbrace Functional Programming and Iteration List comprehensions, generator expressions, generators, coroutines, and closures are much more efficient than most Python programmers realize. For data processing espe- cially, list comprehensions and generator expressions run significantly more quickly than code that manually iterates over data and carries out similar operations.These operations also run much more quickly than legacy Python code that uses functions such as map() and filter(). Generators can be used to write code that not only runs fast, but which makes efficient use of memory.\n\nUse Decorators and Metaclasses Decorators and metaclasses are features that are used to modify functions and classes. However, because they operate at the time of function or class definition, they can be used in ways that lead to improved performance—especially if a program has many optional features that might be turned on or off. Chapter 6,“Functions and Functional Programming,” has an example of using a decorator to enable logging of functions, but in a way that does not impact performance when logging is disabled.\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\nII\n\nThe Python Library\n\n12 Built-In Functions\n\n13\n\nPython Runtime Services\n\n14 Mathematics\n\n15 Data Structures, Algorithms, and Utilities\n\n16 String and Text Handling\n\n17\n\nPython Database Access\n\n18\n\nFile and Directory Handling\n\n19 Operating System Services\n\n20\n\nThreads and Concurrency\n\n21 Network Programming and Sockets\n\n22\n\nInternet Application Programming\n\n23 Web Programming\n\n24\n\nInternet Data Handling and Encoding\n\n25 Miscellaneous Library Modules\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n12\n\nBuilt-In Functions and Exceptions\n\nThis chapter describes Python’s built-in functions and exceptions. Much of this mate-\n\nrial is covered less formally in earlier chapters of this book.This chapter merely consoli- dates all this information into one section and expands upon some of the more subtle features of certain functions.Also, Python 2 includes a number of built-in functions that are considered to be obsolete and which have been removed from Python 3.Those functions are not documented here—instead the focus is on modern functionality.\n\nBuilt-in Functions and Types Certain types, functions, and variables are always available to the interpreter and can be used in any source module.Although you don’t need to perform any extra imports to access these functions, they are contained in a module _ _builtin_ _ in Python 2 and in a module builtins in Python 3.Within other modules that you import, the variable _ _builtins_ _ is also bound to this module.\n\nabs(x)\n\nReturns the absolute value of x.\n\nall(s)\n\nReturns True if all of the values in the iterable sevaluate as True.\n\nany(s)\n\nReturns True if any of the values in the iterable sevaluate as True.\n\nascii(x)\n\nCreates a printable representation of the object xjust like the repr(), but only uses ASCII characters in the result. Non-ASCII characters are turned into appropriate escape sequences.This can be used to view Unicode strings in a terminal or shell that doesn’t support Unicode. Python 3 only.\n\nF h Lib f L Bdff\n\n202\n\nChapter 12 Built-In Functions and Exceptions\n\nbasestring\n\nThis is an abstract data type that is the superclass of all strings in Python 2 (str and unicode). It is only used for type testing of strings. For example, isinstance(s,basestring) returns True if sis either kind of string. Python 2 only.\n\nbin(x)\n\nReturns a string containing the binary representation of the integer x.\n\nbool([x])\n\nType representing Boolean values True and False. If used to convert x, it returns True if xevaluates to true using the usual truth-testing semantics (that is, nonzero number, non-empty list, and so on). Otherwise, False is returned. False is also the default value returned if bool() is called without any arguments.The bool class inherits from int so the Boolean values True and False can be used as integers with values 1 and 0 in mathematical calculations.\n\nbytearray([x])\n\nA type representing a mutable array of bytes.When creating an instance, xmay be an iterable sequence of integers in the range 0 to 255, an 8-bit string or bytes literal, or an integer that specifies the size of the byte array (in which case every entry will be initial- ized to 0).A bytearray object alooks like an array of integers. If you perform a lookup such as a[i], you will get an integer value representing the byte value at index i.Assignments such as a[i] = valso require vto be an integer byte value. However, a bytearray also provides all of the operations normally associated with strings (that is, slicing, find(), split(), replace(), and so on).When using these string operations, you should be careful to preface all string literals with b in order to indicate that you’re working with bytes. For example, if you wanted to split a byte array ainto fields using a comma character separator, you would use a.split(b',') not a.split(',').The result of these operations is always new bytearray objects, not strings.To turn a bytearray ainto a string, use the a.decode(encoding) method.An encoding of 'latin-1' will directly turn a bytearray of 8-bit characters into a string without any modification of the underlying character values.\n\nbytearray(s ,encoding)\n\nAn alternative calling convention for creating a bytearray instance from characters in a string swhere encodingspecifies the character encoding to use in the conversion.\n\nbytes([x])\n\nA type representing an immutable array of bytes. In Python 2, this is an alias for str() which creates a standard 8-bit string of characters. In Python 3, bytes is a completely separate type that is an immutable version of the bytearray type described earlier. In that case, the argument xhas the same interpretation and can be used in the same man- ner. One portability caution is that even though bytes is defined in Python 2, the resulting object does not behave consistently with Python 3. For example, if ais an instance created by bytes(), then a[i] returns a character string in Python 2, but returns an integer in Python 3.\n\nF h Lib f L Bdff\n\nBuilt-in Functions and Types\n\n203\n\nbytes(s, encoding)\n\nAn alternative calling convention for creating a bytes instance from characters in a string swhere encodingspecifies the character encoding to use. Python 3 only.\n\nchr(x)\n\nConverts an integer value, x, into a one-character string. In Python 2, xmust be in the range 0 <= x <= 255, and in Python 3, xmust represent a valid Unicode code point. If xis out of range, a ValueError exception is raised.\n\nclassmethod(func)\n\nThis function creates a class method for the function func. It is typically only used inside class definitions where it is implicitly invoked by the @classmethod decorator. Unlike a normal method, a class method receives the class as the first argument, not an instance. For example, if you had an object, f, that is an instance of class Foo, invoking a class method on f will pass the class Foo as the first argument to the method, not the instance f.\n\ncmp(x, y)\n\nCompares xand yand returns a negative number if x < y, a positive number if x > y, or 0 if x == y.Any two objects can be compared, although the result may be meaning- less if the two objects have no meaningful comparison method defined (for example, comparing a number with a file object). In certain circumstances, such comparisons may also raise an exception.\n\ncompile(string, filename, kind [, flags [, dont_inherit]])\n\nCompiles stringinto a code object for use with exec() or eval(). stringis a string containing valid Python code. If this code spans multiple lines, the lines must be terminated by a single newline ('\\n') and not platform-specific variants (for example, '\\r\\n' on Windows). filenameis a string containing the name of the file in which the string was defined. kindis 'exec' for a sequence of statements, 'eval' for a single expression, or 'single' for a single executable statement.The flagsparameter deter- mines which optional features (associated with the _ _future_ _ module) are enabled. Features are specified using the bitwise OR of flags defined in the _ _future_ _ mod- ule. For example, if you wanted to enable new division semantics, you would set flags to _ _future_ _.division.compiler_flag. If flagsis omitted or set to 0, the code is compiled with whatever features are currently in effect. If flagsis supplied, the fea- tures specified are added to those features already in effect. If dont_inherit is set, only those features specified in flagsare enabled—features currently enabled are ignored.\n\ncomplex([real [, imag]])\n\nType representing a complex number with real and imaginary components, realand imag, which can be supplied as any numeric type. If imagis omitted, the imaginary component is set to zero. If realis passed as a string, the string is parsed and converted to a complex number. In this case, imagshould be omitted. If no arguments are given, 0j is returned.\n\ndelattr(object, attr)\n\nDeletes an attribute of an object. attris a string. Same as del object.attr.\n\nF h Lib f L Bdff\n\n204\n\nChapter 12 Built-In Functions and Exceptions\n\ndict([m]) or dict(key1 = value1, key2 = value2, ...)\n\nType representing a dictionary. If no argument is given, an empty dictionary is returned. If mis a mapping object (such as a dictionary), a new dictionary having the same keys and same values as mis returned. For example, if mis a dictionary, dict(m) simply makes a shallow copy of it. If mis not a mapping, it must support iteration in which a sequence of (key,value) pairs is produced.These pairs are used to populate the dic- tionary. dict() can also be called with keyword arguments. For example, dict(foo=3, bar=7) creates the dictionary { 'foo' : 3, 'bar' : 7 }.\n\ndir([object])\n\nReturns a sorted list of attribute names. If objectis a module, it contains the list of symbols defined in that module. If objectis a type or class object, it returns a list of attribute names.The names are typically obtained from the object’s _ _dict_ _ attribute if defined, but other sources may be used. If no argument is given, the names in the current local symbol table are returned. It should be noted that this function is primari- ly used for informational purposes (for example, used interactively at the command line). It should not be used for formal program analysis because the information obtained may be incomplete.Also, user-defined classes can define a special method _ _dir_ _() that alters the result of this function.\n\ndivmod(a, b)\n\nReturns the quotient and remainder of long division as a tuple. For integers, the value (a // b, a % b) is returned. For floats, (math.floor(a / b), a % b) is returned.This function may not be called with complex numbers.\n\nenumerate(iter[, initial value)\n\nGiven an iterable object, iter, returns a new iterator (of type enumerate) that pro- duces tuples containing a count and the value produced from iter. For example, if iterproduces a, b, c, then enumerate(iter) produces (0,a), (1,b), (2,c).\n\neval(expr [, globals [, locals]])\n\nEvaluates an expression. expris a string or a code object created by compile(). globalsand localsare mapping objects that define the global and local namespaces, respectively, for the operation. If omitted, the expression is evaluated in the namespace of the caller. It is most common for globalsand localsto be specified as dictionaries, but advanced applications can supply custom mapping objects.\n\nexec(code [, global [, locals]])\n\nExecutes Python statements. codeis a string, a file, or a code object created by compile(). globalsand localsdefine the global and local namespaces, respectively, for the operation. If omitted, the code is executed in the namespace of the caller. If no global or local dictionaries are given, the behavior of this function is a little muddled between Python versions. In Python 2, exec is actually implemented as a special lan- guage statement, whereas Python 3 implements it as a standard library function.A subtle side effect of this implementation difference is that in Python 2, code evaluated by exec can freely mutate local variables in the caller’s namespace. In Python 3, you can execute code that makes such changes, but they don’t seem to have any lasting effect beyond the exec() call itself.This is because Python 3 uses locals() to obtain the local name- space if one isn’t supplied.As you will note in the documentation for locals(), the returned dictionary is only safe to inspect, not modify.\n\nF h Lib f L Bdff\n\nBuilt-in Functions and Types\n\n205\n\nfilter(function, iterable)\n\nIn Python 2, this creates a list consisting of the objects from iterablefor which func- tionevaluates to true. In Python 3, the result is an iterator that produces this result. If functionis None, the identity function is used and all the elements of iterablethat are false are removed. iterablecan be any object that supports iteration.As a general rule, it is significantly faster to use a generator expression or list comprehension to filter data (refer to Chapter 6).\n\nfloat([x])\n\nType representing a floating-point number. If xis a number, it is converted to a float. If xis a string, it is parsed into a float. If no argument is supplied, 0.0 is returned.\n\nformat(value [, format_spec])\n\nConverts valueto a formatted string according to the format specification string in format_spec.This operation invokes value._ _format_ _(), which is free to inter- pret the format specification as it sees fit. For simple types of data, the format specifier typically includes an alignment character of '<', '>’, or '^'; a number (which indicates the field width); and a character code of 'd', 'f', or 's' for integer, floating point, or string values, respectively. For example, a format specification of 'd' formats an integer, a specification of '8d' right aligns an integer in an 8-character field and '<8d' left aligns an integer in an 8-character field. More details on format() and format speci- fiers can be found in Chapter 3,“Types and Objects,” and Chapter 4,“Operators and Expressions.”\n\nfrozenset([items])\n\nType representing an immutable set object populated with values taken from itemsthat must be an iterable.The values must also be immutable. If no argument is given, an empty set is returned.\n\ngetattr(object, name [,default])\n\nReturns the value of a named attribute of an object. nameis a string containing the attribute name. defaultis an optional value to return if no such attribute exists. Otherwise, AttributeError is raised. Same as object.name.\n\nglobals()\n\nReturns the dictionary of the current module that represents the global namespace. When called inside another function or method, it returns the global namespace of the module in which the function or method was defined.\n\nhasattr(object, name)\n\nReturns True if nameis the name of an attribute of object. False is returned other- wise. nameis a string.\n\nhash(object)\n\nReturns an integer hash value for an object (if possible).The hash value is primarily used in the implementation of dictionaries, sets, and other mapping objects.The hash value is the same for any two objects that compare as equals. Mutable objects don’t define a hash value, although user-defined classes can define a method _ _hash_ _() to support this operation.\n\nF h Lib f L Bdff\n\n206\n\nChapter 12 Built-In Functions and Exceptions\n\nhelp([object])\n\nCalls the built-in help system during interactive sessions. objectmay be a string repre- senting the name of a module, class, function, method, keyword, or documentation topic. If it is any other kind of object, a help screen related to that object will be pro- duced. If no argument is supplied, an interactive help tool will start and provide more information.\n\nhex(x)\n\nCreates a hexadecimal string from an integer x.\n\nid(object)\n\nReturns the unique integer identity of object.You should not interpret the return value in any way (that is, as a memory location).\n\ninput([prompt])\n\nIn Python 2, this prints a prompt, reads a line of input, and processes it through eval() (that is, it’s the same as eval(raw_input(prompt)). In Python 3, a prompt is printed to standard output and a single line of input is read without any kind of evaluation or modification.\n\nint(x [,base])\n\nType representing an integer. If xis a number, it is converted to an integer by truncat- ing toward 0. If it is a string, it is parsed into an integer value. baseoptionally specifies a base when converting from a string. In Python 2, a long integer is created if the value exceeds the 32-bit range of the int type.\n\nisinstance(object, classobj)\n\nReturns True if objectis an instance of classobj, is a subclass of classobj, or belongs to an abstract base class classobj.The classobjparameter can also be a tuple of possible types or classes. For example, isinstance(s, (list,tuple)) returns True if sis a tuple or a list.\n\nissubclass(class1, class2)\n\nReturns True if class1is a subclass of (derived from) class2or if class1is regis- tered with an abstract base class class2. class2can also be a tuple of possible classes, in which case each class will be checked. Note that issubclass(A, A) is true.\n\niter(object [,sentinel])\n\nReturns an iterator for producing items in object. If the sentinelparameter is omit- ted, the object must either provide the method _ _iter_ _(), which creates an iterator, or implement _ _getitem_ _(), which accepts integer arguments starting at 0. If sen- tinelis specified, objectis interpreted differently. Instead, objectshould be a callable object that takes no parameters.The returned iterator object will call this function repeatedly until the returned value is equal to sentinel, at which point iteration will stop.A TypeError will be generated if objectdoes not support iteration.\n\nlen(s)\n\nReturns the number of items contained in s. sshould be a list, tuple, string, set, or dic- tionary.A TypeError is generated if sis an iterable such as a generator.\n\nF h Lib f L Bdff\n\nBuilt-in Functions and Types\n\n207\n\nlist([items])\n\nType representing a list. itemsmay be any iterable object, the values of which are used to populate the list. If itemsis already a list, a copy is made. If no argument is given, an empty list is returned.\n\nlocals()\n\nReturns a dictionary corresponding to the local namespace of the caller.This dictionary should only be used to inspect the execution environment—it is not safe to modify the contents of this dictionary.\n\nlong([x [, base]])\n\nType representing long integers in Python 2. If xis a number, it is converted to an inte- ger by truncating toward 0. If xis a string, it is parsed into a long value. If no argument is given, this function returns 0L. For portability, you should avoid direct use of long. Using int(x) will create a long as necessary. For type checking, use isinstance(x, numbers.Integral) to check if xis any integer type.\n\nmap(function, items, ...)\n\nIn Python 2, this applies functionto every item of itemsand returns a list of results. In Python 3, an iterator producing the same results is created. If multiple input sequences are supplied, functionis assumed to take that many arguments, with each argument taken from a different sequence.The behavior when processing multiple input sequences differs between Python 2 and Python 3. In Python 2, the result is the same length as the longest input sequence with None used as a padding value when the shorter input sequences are exhausted. In Python 3, the result is only as long as the shortest sequence.The functionality provided by map() is almost always better expressed using a generator expression or list comprehension (both of which provide better per- formance). For example, map(function, s) can usually be replaced by [function(x) for x in s].\n\nmax(s [, args, ...])\n\nFor a single argument, s, this function returns the maximum value of the items in s, which may be any iterable object. For multiple arguments, it returns the largest of the arguments.\n\nmin(s [, args, ...])\n\nFor a single argument, s, this function returns the minimum value of the items in s, which may be any iterable object. For multiple arguments, it returns the smallest of the arguments.\n\nnext(s [, default])\n\nReturns the next item from the iterator s. If the iterator has no more items, a StopIteration exception is raised unless a value is supplied to the defaultargument. In that case, defaultis returned instead. For portability, you should always use this function instead of calling s.next() directly on an iterator s. In Python 3, the name of the underlying iterator method changed to s._ _next_ _(). If you write your code to use the next() function, you won’t have to worry about this difference.\n\nF h Lib f L Bdff\n\n208\n\nChapter 12 Built-In Functions and Exceptions\n\nobject()\n\nThe base class for all objects in Python.You can call it to create an instance, but the result isn’t especially interesting.\n\noct(x)\n\nConverts an integer, x, to an octal string.\n\nopen(filename [, mode [, bufsize]])\n\nIn Python 2, opens the file filenameand returns a new file object (refer to Chapter 9, “Input and Output”). modeis a string that indicates how the file should be opened: 'r' for reading, 'w' for writing, and 'a' for appending.A second character 't' or 'b' is used to indicate text-mode (the default) or binary mode. For example, 'r' or 'rt' opens a file in text mode, whereas 'rb' opens a file in binary mode.An optional '+' can be added to the mode to open the file for updating (which allows both reading and writing).A mode of 'w+' truncates the file to zero length if it already exists.A mode of 'r+' or 'a+' opens the file for both reading and writing but leaves the original con- tents intact when the file is opened. If a mode of 'U' or 'rU' is specified, the file is opened in universal newline mode. In this mode, all variants of a newline ('\\n', '\\r', '\\r\\n') are converted to the standard '\\n' character. If the mode is omitted, a mode of 'rt' is assumed.The bufsize argument specifies the buffering behavior, where 0 is unbuffered, 1 is line buffered, and any other positive number indicates an approximate buffer size in bytes.A negative number indicates that the system default buffering should be used (this is the default behavior).\n\nopen(filename [, mode [, bufsize [, encoding [, errors [, newline [, closefd]]]]]])\n\nIn Python 3, this opens the file filenameand returns a file object.The first three argu- ments have the same meaning as for the Python 2 version of open() described earlier. encodingis an encoding name such as 'utf-8'. errorsis the error handling policy and is one of 'strict', 'ignore', 'replace', 'backslashreplace', or 'xmlcharrefreplace'. newlinecontrols the behavior of universal newline mode and is set to None, '', '\\n', '\\r', or '\\r\\n'. closefdis a Boolean flag that specifies whether the underlying file descriptor is closed when the close() method executes. Unlike Python 2, different kinds of objects are returned depending on the selected I/O mode. For example, if you open a file in binary mode, you get an object where I/O operations such as read() and write() operate on byte arrays instead of strings. File I/O is one area where there are significant differences between Python 2 and 3. Consult Appendix A,“Python 3,” for more details.\n\nord(c)\n\nReturns the integer ordinal value of a single character, c. For ordinary characters, a value in the range [0,255] is returned. For single Unicode characters, a value in the range [0,65535] is usually returned. In Python 3, cmay also be a Unicode surrogate pair, in which case it is converted into the appropriate Unicode code point.\n\npow(x, y [, z])\n\nReturns x ** y. If zis supplied, this function returns (x ** y) % z. If all three argu- ments are given, they must be integers and ymust be nonnegative.\n\nF h Lib f L Bdff\n\nBuilt-in Functions and Types\n\n209\n\nprint(value, ... [, sep=separator, end=ending, file=outfile])\n\nPython 3 function for printing a series of values.As input, you can supply any number of values, all of which are printed on the same line.The sep keyword argument is used to specify a different separator character (a space by default).The end keyword argu- ment specifies a different line ending ('\\n' by default).The file keyword argument redirects the output to a file object.This function can be used in Python 2 if you add the statement from _ _future_ _ import print_function to your code.\n\nproperty([fget [,fset [,fdel [,doc]]]])\n\nCreates a property attribute for classes. fgetis a function that returns the attribute value, fsetsets the attribute value, and fdeldeletes an attribute. docprovides a docu- mentation string.These parameters may be supplied using keyword arguments—for example, property(fget=getX, doc=\"some text\").\n\nrange([start,] stop [, step])\n\nIn Python 2, this creates a fully populated list of integers from startto stop. step indicates a stride and is set to 1 if omitted. If startis omitted (when range() is called with one argument), it defaults to 0.A negative stepcreates a list of numbers in descending order. In Python 3, range() creates a special range object that computes its values on demand (like xrange() in previous Python versions).\n\nraw_input([prompt])\n\nPython 2 function that reads a line of input from standard input (sys.stdin) and returns it as a string. If promptis supplied, it’s first printed to standard output (sys.stdout).Trailing newlines are stripped, and an EOFError exception is raised if an EOF is read. If the readline module is loaded, this function will use it to provide advanced line-editing and command-completion features. Use input() to read input in Python 3.\n\nrepr(object)\n\nReturns a string representation of object. In most cases, the returned string is an expression that can be passed to eval() to re-create the object. Be aware that in Python 3, the result of this function may be a Unicode string that can’t be displayed in the terminal or shell window (resulting in an exception). Use the ascii() function to create an ASCII representation of object.\n\nreversed(s)\n\nCreates a reverse iterator for sequence s.This function only works if simplements the sequence methods _ _len_ _() and _ _getitem_ _(). In addition, smust index items starting at 0. It does not work with generators or iterators.\n\nround(x [, n])\n\nRounds the result of rounding the floating-point number xto the closest multiple of 10 to the power minus n. If nis omitted, it defaults to 0. If two multiples are equally close, Python 2 rounds away from 0 (for example, 0.5 is rounded to 1.0 and -0.5 is rounded to -1.0). Python 3 rounds toward 0 if the previous digit is even and away from 0 oth- erwise (for example, 0.5 is rounded to 0.0 and 1.5 is rounded to 2).\n\nF h Lib f L Bdff",
      "page_number": 212
    },
    {
      "number": 12,
      "title": "Segment 12 (pages 234-256)",
      "start_page": 234,
      "end_page": 256,
      "detection_method": "synthetic",
      "content": "210\n\nChapter 12 Built-In Functions and Exceptions\n\nset([items])\n\nCreates a set populated with items taken from the iterable object items.The items must be immutable. If itemscontains other sets, those sets must be of type frozenset. If itemsis omitted, an empty set is returned.\n\nsetattr(object, name, value)\n\nSets an attribute of an object. nameis a string. Same as object.name = value.\n\nslice([start,] stop [, step])\n\nReturns a slice object representing integers in the specified range. Slice objects are also generated by the extended slice syntax a[i:i:k]. Refer to the section “Sequence and Mapping Methods” in Chapter 3 for details.\n\nsorted(iterable [, key=keyfunc [, reverse=reverseflag]])\n\nCreates a sorted list from items in iterable.The keyword argument key is a single- argument function that transforms values before they are passed to the compare func- tion.The keyword argument reverse is a Boolean flag that specifies whether or not the resulting list is sorted in reverse order.The key and reverse arguments must be specified using keywords—for example, sorted(a,key=get_name).\n\nstaticmethod(func)\n\nCreates a static method for use in classes.This function is implicitly invoked by the @staticmethod decorator.\n\nstr([object])\n\nType representing a string. In Python 2, a string contains 8-bit characters, whereas in Python 3 strings are Unicode. If objectis supplied, a string representation of its value is created by calling its _ _str_ _() method.This is the same string that you see when you print the object. If no argument is given, an empty string is created.\n\nsum(items [,initial])\n\nComputes the sum of a sequence of items taken from the iterable object items. initialprovides the starting value and defaults to 0.This function only works with numbers.\n\nsuper(type [, object])\n\nReturns an object that represents the superclasses of type.The primary purpose of this object is to invoke methods in base classes. Here’s an example: class B(A):\n\ndef foo(self):\n\nsuper(B,self).foo()\n\nIf objectis an object, then isinstance(object, type) must be true. If objectis a type, then it must be a subclass of type. Refer to Chapter 7,“Classes and Object- Oriented Programming,” for more details. In Python 3, you can use super() in a method with no arguments. In this case, typeis set to the class in which the method is defined and objectis set to the first argument of the method.Although this cleans up the syntax, it’s not backwards-compatible with Python 2 so it should be avoided if you’re concerned about portability.\n\nF h Lib f L Bdff\n\nBuilt-in Functions and Types\n\n211\n\ntuple([items])\n\nType representing a tuple. If supplied, itemsis an iterable object that is used to popu- late the tuple. However, if itemsis already a tuple, it’s simply returned unmodified. If no argument is given, an empty tuple is returned.\n\ntype(object)\n\nThe base class of all types in Python.When called as a function, returns the type of object.This type is the same as the object’s class. For common types such as integers, floats, and lists, the type will refer to one of the other built-in classes such as int, float, list, and so forth. For user-defined objects, the type is the associated class. For objects related to Python’s internals, you will typically get a reference to one of the classes defined in the types module.\n\ntype(name,bases,dict)\n\nCreates a new typeobject (which is the same as defining a new class). nameis the name of the type, basesis a tuple of base classes, and dictis a dictionary containing definitions corresponding to a class body.This function is most commonly used when working with metaclasses.This is described further in Chapter 7.\n\nunichr(x)\n\nConverts the integer or long integer x, where 0 <= x <= 65535, to a single Unicode character. Python 2 only. In Python 3, just use chr(x).\n\nunicode(string [,encoding [,errors]])\n\nIn Python 2, this converts stringto a Unicode string. encodingspecifies the data encoding of string. If omitted, the default encoding as returned by sys.getdefaultencoding() is used. errorsspecifies how encoding errors are han- dled and is one of 'strict', 'ignore', 'replace', 'backslashreplace', or 'xmlcharrefreplace'. Refer to Chapter 9 and Chapter 3 for details. Not available in Python 3.\n\nvars([object])\n\nReturns the symbol table of object(usually found in its _ _dict_ _ attribute). If no argument is given, a dictionary corresponding to the local namespace is returned.The dictionary returned by this function should be assumed to be read-only. It’s not safe to modify its contents.\n\nxrange([start,] stop [, step])\n\nA type representing a range of integer values from startto stopthat is not included. stepprovides an optional stride.The values are not actually stored but are computed on demand when accessed. In Python 2, xrange() is the preferred function to use when you want to write loops over ranges of integer values. In Python 3, xrange() has been renamed to range() and xrange() is unavailable. start, stop, and stepare limited to the set of values supported by machine integers (typically 32 bits).\n\nzip([s1 [, s2 [,..]]])\n\nIn Python 2, returns a list of tuples where the nth tuple is (s1[n], s2[n], ...).The resulting list is truncated to the length of the shortest argument sequence. If no argu- ments are given, an empty list is returned. In Python 3, the behavior is similar, but the\n\nF h Lib f L Bdff\n\n212\n\nChapter 12 Built-In Functions and Exceptions\n\nresult is an iterator that produces a sequence of tuples. In Python 2, be aware that using zip() with long input sequences is something that can unintentionally consume large amounts of memory. Consider using itertools.izip() instead.\n\nBuilt-In Exceptions Built-in exceptions are contained in the exceptions module, which is always loaded prior to the execution of any program. Exceptions are defined as classes.\n\nException Base Classes The following exceptions serve as base classes for all the other exceptions:\n\nBaseException\n\nThe root class for all exceptions.All built-in exceptions are derived from this class.\n\nException\n\nThe base class for all program-related exceptions that includes all built-in exceptions except for SystemExit, GeneratorExit, and KeyboardInterrupt. User-defined exceptions should be defined by inheriting from Exception.\n\nArithmeticError\n\nThe base class for arithmetic exceptions, including OverflowError, ZeroDivisionError, and FloatingPointError.\n\nLookupError\n\nThe base class for indexing and key errors, including IndexError and KeyError.\n\nEnvironmentError\n\nThe base class for errors that occur outside Python, including IOError and OSError. The preceding exceptions are never raised explicitly. However, they can be used to catch certain classes of errors. For instance, the following code would catch any sort of numerical error:\n\ntry:\n\n# Some operation ...\n\nexcept ArithmeticError as e:\n\n# Math error\n\nException Instances When an exception is raised, an instance of an exception class is created.This instance is placed in the optional variable supplied to the except statement. Here’s an example:\n\nexcept IOError as e:\n\n# Handle error # 'e' has an instance of IOError\n\nInstances of an exception ehave a few standard attributes that can be useful to inspect and/or manipulate in certain applications.\n\nF h Lib f L Bdff\n\nBuilt-In Exceptions\n\n213\n\ne.args\n\nThe tuple of arguments supplied when raising the exception. In most cases, this is a one-item tuple with a string describing the error. For EnvironmentError exceptions, the value is a 2-tuple or 3-tuple containing an integer error number, a string error mes- sage, and an optional filename.The contents of this tuple might be useful if you need to re-create the exception in a different context; for example, to raise an exception in a different Python interpreter process.\n\ne.message\n\nA string representing the error message that gets printed when the exception is dis- played (Python 2 only).\n\ne._ _cause_ _\n\nPrevious exception when using explicit chained exceptions (Python 3 only). See Appendix A.\n\ne.__context__\n\nPrevious exception for implicitly chained exceptions (Python 3 only). See Appendix A.\n\ne.__traceback__\n\nTraceback object associated with the exception (Python 3 only). See Appendix A.\n\nPredefined Exception Classes The following exceptions are raised by programs:\n\nAssertionError\n\nFailed assert statement.\n\nAttributeError\n\nFailed attribute reference or assignment.\n\nEOFError\n\nEnd of file. Generated by the built-in functions input() and raw_input(). It should be noted that most other I/O operations such as the read() and readline() methods of files return an empty string to signal EOF instead of raising an exception.\n\nFloatingPointError\n\nFailed floating-point operation. It should be noted that floating-point exception- handling is a tricky problem and only that this exception only gets raised if Python has been configured and built in a way that enables it. It is more common for floating-point errors to silently produce results such as float('nan') or float('inf').A subclass of ArithmeticError.\n\nGeneratorExit\n\nRaised inside a generator function to signal termination.This happens when a generator is destroyed prematurely (before all generator values are consumed) or the close() method of a generator is called. If a generator ignores this exception, the generator is terminated and the exception is silently ignored.\n\nF h Lib f L Bdff\n\n214\n\nChapter 12 Built-In Functions and Exceptions\n\nIOError\n\nFailed I/O operation.The value is an IOError instance with the attributes errno, strerror, and filename. errno is an integer error number, strerror is a string error message, and filename is an optional filename.A subclass of EnvironmentError.\n\nImportError\n\nRaised when an import statement can’t find a module or when from can’t find a name in a module.\n\nIndentationError\n\nIndentation error.A subclass of SyntaxError.\n\nIndexError\n\nSequence subscript out of range.A subclass of LookupError.\n\nKeyError\n\nKey not found in a mapping.A subclass of LookupError.\n\nKeyboardInterrupt\n\nRaised when the user hits the interrupt key (usually Ctrl+C).\n\nMemoryError\n\nRecoverable out-of-memory error.\n\nNameError\n\nName not found in local or global namespaces.\n\nNotImplementedError\n\nUnimplemented feature. Can be raised by base classes that require derived classes to implement certain methods.A subclass of RuntimeError.\n\nOSError\n\nOperating system error. Primarily raised by functions in the os module.The value is the same as for IOError.A subclass of EnvironmentError.\n\nOverflowError\n\nResult of an integer value being too large to be represented.This exception usually only arises if large integer values are passed to objects that internally rely upon fixed- precision machine integers in their implementation. For example, this error can arise with range or xrange objects if you specify starting or ending values that exceed 32 bits in size.A subclass of ArithmeticError.\n\nReferenceError\n\nResult of accessing a weak reference after the underlying object has been destroyed. See the weakref module.\n\nRuntimeError\n\nA generic error not covered by any of the other categories.\n\nF h Lib f L Bdff\n\nBuilt-In Exceptions\n\n215\n\nStopIteration\n\nRaised to signal the end of iteration.This normally happens in the next() method of an object or in a generator function.\n\nSyntaxError\n\nParser syntax error. Instances have the attributes filename, lineno, offset, and text, which can be used to gather more information.\n\nSystemError\n\nInternal error in the interpreter.The value is a string indicating the problem.\n\nSystemExit\n\nRaised by the sys.exit() function.The value is an integer indicating the return code. If it’s necessary to exit immediately, os._exit() can be used.\n\nTabError\n\nInconsistent tab usage. Generated when Python is run with the -tt option.A subclass of SyntaxError.\n\nTypeError\n\nOccurs when an operation or a function is applied to an object of an inappropriate type.\n\nUnboundLocalError\n\nUnbound local variable referenced.This error occurs if a variable is referenced before it’s defined in a function.A subclass of NameError.\n\nUnicodeError\n\nUnicode encoding or decoding error.A subclass of ValueError.\n\nUnicodeEncodeError\n\nUnicode encoding error.A subclass of UnicodeError.\n\nUnicodeDecodeError\n\nUnicode decoding error.A subclass of UnicodeError.\n\nUnicodeTranslateError\n\nUnicode error occurred during translation.A subclass of UnicodeError.\n\nValueError\n\nGenerated when the argument to a function or an operation is the right type but an inappropriate value.\n\nWindowsError\n\nGenerated by failed system calls on Windows.A subclass of OSError.\n\nZeroDivisionError\n\nDividing by zero.A subclass of ArithmeticError.\n\nF h Lib f L Bdff\n\n216\n\nChapter 12 Built-In Functions and Exceptions\n\nBuilt-In Warnings Python has a warnings module that is typically used to notify programmers about dep- recated features.Warnings are issued by including code such as the following:\n\nimport warnings warnings.warn(\"The MONDO flag is no longer supported\", DeprecationWarning)\n\nAlthough warnings are issued by a library module, the names of the various warnings are built-in.Warnings are somewhat similar to exceptions.There is a hierarchy of built- in warnings that all inherit from Exception.\n\nWarning\n\nThe base class of all warnings.A subclass of Exception.\n\nUserWarning\n\nA generic user-defined warning.A subclass of Warning.\n\nDeprecationWarning\n\nA warning for deprecated features.A subclass of Warning.\n\nSyntaxWarning\n\nA warning for deprecated Python syntax.A subclass of Warning.\n\nRuntimeWarning\n\nA warning for potential runtime problems.A subclass of Warning.\n\nFutureWarning\n\nA warning that the behavior of a feature will change in the future.A subclass of Warning.\n\nWarnings are different than exceptions in that the issuing of a warning with the warn() function may or may not cause a program to stop. For example, a warning may just print something to the output or it may raise an exception.The actual behavior can be configured with the warnings module or with the -W option to the interpreter. If you are using someone else’s code that generates a warning, but you would like to pro- ceed anyways, you can catch warnings that have been turned into exceptions using try and except. For example:\n\ntry:\n\nimport md5\n\nexcept DeprecationWarning:\n\npass\n\nIt should be emphasized that code such as this is rare.Although it will catch a warning that has been turned into an exception, it doesn’t suppress warning messages (you have to use the warnings module to control that). Plus, ignoring warnings is a good way to write code that doesn’t work correctly when new versions of Python are released.\n\nF h Lib f L Bdff\n\nfuture_builtins\n\n217\n\nfuture_builtins The future_builtins module, only available in Python 2, provides implementations of the built-in functions whose behavior is changed in Python 3.The following func- tions are defined:\n\nascii(object)\n\nProduces the same output as repr(). Refer to the description in the “Built-In Functions” section of this chapter.\n\nfilter(function, iterable)\n\nCreates an iterator instead of a list.The same as itertools.ifilter().\n\nhex(object)\n\nCreates a hexadecimal string, but uses the _ _index_ _() special method to get an inte- ger value instead of calling _ _hex_ _().\n\nmap(function, iterable, ...)\n\nCreates an iterator instead of a list.The same as itertools.imap().\n\noct(object)\n\nCreates an octal string, but uses the _ _index_ _() special method to get an integer value instead of calling _ _oct_ _().\n\nzip(iterable, iterable, ... )\n\nCreates an iterator instead of a list.The same as itertools.izip().\n\nBe aware that the functions listed in this module are not a complete list of changes to the built-in module. For instance, Python 3 also renames raw_input() to input() and xrange() to range().\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n13\n\nPython Runtime Services\n\nThis chapter describes modules that are related to the Python interpreter runtime.\n\nTopics include garbage collection, basic management of objects (copying, marshalling, and so on), weak references, and interpreter environment.\n\natexit The atexit module is used to register functions to execute when the Python inter- preter exits.A single function is provided:\n\nregister(func [,args [,kwargs]])\n\nAdds function functo a list of functions that will execute when the interpreter exits. argsis a tuple of arguments to pass to the function. kwargsis a dictionary of keyword arguments.The function is invoked as func(*args,**kwargs). Upon exit, functions are invoked in reverse order of registration (the most recently added exit function is invoked first). If an error occurs, an exception message will be printed to standard error but will otherwise be ignored.\n\ncopy The copy module provides functions for making shallow and deep copies of compound objects, including lists, tuples, dictionaries, and instances of user-defined objects.\n\ncopy(x)\n\nMakes a shallow copy of xby creating a new compound object and duplicating the members of xby reference. For built-in types, it is somewhat uncommon to use this function. Instead, you use calls such as list(x), dict(x), set(x), and so forth to cre- ate a shallow copy of x(it should be noted that using the type name directly like this is also significantly faster than using copy()).\n\ndeepcopy(x [, visit])\n\nMakes a deep copy of xby creating a new compound object and recursively duplicating all the members of x. visitis an optional dictionary that’s used to keep track of visited objects in order to detect and avoid cycles in recursively defined data structures.This argument is typically only supplied if deepcopy() is being called recursively as described later in this chapter.\n\nF h Lib f L Bdff\n\n220\n\nChapter 13 Python Runtime Services\n\nAlthough it is not usually necessary, a class can implement customized copy methods by implementing the methods _ _copy_ _(self) and _ _deepcopy_ _(self, visit), which implement the shallow and deep copy operations respectively.The _ _deepcopy_ _() method must accept a dictionary, visit, which is used to keep track of previously encountered objects during the copy process. It’s not necessary for _ _deepcopy_ _() to do anything with visitother than pass it to other deepcopy() operations carried out in the implementation (if any).\n\nIf a class implements the methods _ _getstate_ _() and _ _setstate_ _() that are used by the pickle module, they will be used by the copy module to create copies.\n\nNotes\n\nn This module can be used with simple types such as integers and strings, but\n\nthere’s little need to do so.\n\nn The copy functions don’t work with modules, class objects, functions, methods, tracebacks, stack frames, files, sockets, and other similar types.When an object can’t be copied, the copy.error exception is raised.\n\ngc The gc module provides an interface for controlling the garbage collector used to col- lect cycles in objects such as lists, tuples, dictionaries, and instances.As various types of container objects are created, they’re placed on a list that’s internal to the interpreter. Whenever container objects are deallocated, they’re removed from this list. If the num- ber of allocations exceeds the number of deallocations by a user-definable threshold value, the garbage collector is invoked.The garbage collector works by scanning this list and identifying collections of objects that are no longer being used but haven’t been deallocated due to circular dependencies. In addition, the garbage collector uses a three- level generational scheme in which objects that survive the initial garbage-collection step are placed onto lists of objects that are checked less frequently.This provides better performance for programs that have a large number of long-lived objects.\n\ncollect([generation])\n\nRuns a full garbage collection.This function checks all generations and returns the number of unreachable objects found. generationis an optional integer in the range 0 - 2 that specifies the generation to collect.\n\ndisable()\n\nDisables garbage collection.\n\nenable()\n\nEnables garbage collection.\n\ngarbage\n\nA variable containing a read-only list of user-defined instances that are no longer in use, but which cannot be garbage collected because they are involved in a reference cycle and they define a _ _del_ _() method. Such objects cannot be garbage-collected because in order to break the reference cycle, the interpreter must arbitrarily destroy\n\nF h Lib f L Bdff\n\ngc\n\n221\n\none of the objects first. However, there is no way to know if the _ _del_ _() method of the remaining objects in the cycle needs to perform critical operations on the object that was just destroyed.\n\nget_count()\n\nReturns a tuple (count0, count1, count2) containing the number of objects cur- rently in each generation.\n\nget_debug()\n\nReturns the debugging flags currently set.\n\nget_objects()\n\nReturns a list of all objects being tracked by the garbage collector. Does not include the returned list.\n\nget_referrers(obj1, obj2, ...)\n\nReturns a list of all objects that directly refer to the objects obj1, obj2, and so on.The returned list may include objects that have not yet been garbage-collected as well as partially constructed objects.\n\nget_referents(obj1, obj2, ...)\n\nReturns a list of objects that the objects obj1, obj2, and so on refer to. For example, if obj1is a container, this would return a list of the objects in the container.\n\nget_threshold()\n\nReturns the current collection threshold as a tuple.\n\nisenabled()\n\nReturns True if garbage collection is enabled.\n\nset_debug(flags)\n\nSets the garbage-collection debugging flags, which can be used to debug the behavior of the garbage collector. flagsis the bitwise OR of the constants DEBUG_STATS, DEBUG_COLLECTABLE, DEBUG_UNCOLLECTABLE, DEBUG_INSTANCES, DEBUG_OBJECTS, DEBUG_SAVEALL, and DEBUG_LEAK.The DEBUG_LEAK flag is probably the most useful because it will have the collector print information useful for debugging programs with memory leaks.\n\nset_threshold(threshold0 [, threshold1[, threshold2]])\n\nSets the collection frequency of garbage collection. Objects are classified into three gen- erations, where generation 0 contains the youngest objects and generation 2 contains the oldest objects. Objects that survive a garbage-collection step are moved to the next- oldest generation. Once an object reaches generation 2, it stays in that generation. threshold0is the difference between the number of allocations and deallocations that must be reached before garbage collection occurs in generation 0. threshold1is the number of collections of generation 0 that must occur before generation 1 is scanned. threshold2is the number of collections that must occur in generation 1 before gener- ation 2 is collected.The default threshold is currently set to (700,10,10). Setting threshold0to 0 disables garbage collection.\n\nF h Lib f L Bdff\n\n222\n\nChapter 13 Python Runtime Services\n\nNotes\n\nn Circular references involving objects with a _ _del_ _() method are not\n\ngarbage-collected and are placed on the list gc.garbage (uncollectable objects). These objects are not collected due to difficulties related to object finalization. n The functions get_referrers() and get_referents() only apply to objects\n\nthat support garbage collection. In addition, these functions are only intended for debugging.They should not be used for other purposes.\n\ninspect The inspect module is used to gather information about live Python objects such as attributes, documentation strings, source code, stack frames, and so on.\n\ncleandoc(doc)\n\nCleans up a documentation string docby changing all tabs into whitespace and remov- ing indentation that might have been inserted to make the docstring line up with other statements inside a function or method.\n\ncurrentframe()\n\nReturns the frame object corresponding to the caller’s stack frame.\n\nformatargspec(args [, varags [, varkw [, defaults]]])\n\nProduces a nicely formatted string representing the values returned by getargspec().\n\nformatargvalues(args [, varargs [, varkw [, locals]]])\n\nProduces a nicely formatted string representing the values returned by getargvalues().\n\ngetargspec(func)\n\nGiven a function, func, returns a named tuple ArgSpec(args, varargs, varkw, defaults). argsis a list of argument names, and varargsis the name of the * argu- ment (if any). varkwis the name of the ** argument (if any), and defaultsis a tuple of default argument values or None if there are no default argument values. If there are default argument values, the defaultstuple represents the values of the last nargu- ments in args, where nis the len(defaults).\n\ngetargvalues(frame)\n\nReturns the values of arguments supplied to a function with execution frame frame. Returns a tuple ArgInfo(args, varargs, varkw, locals). argsis a list of argu- ment names, varargsis the name of the * argument (if any), and varkwis the name of the ** argument (if any). localsis the local dictionary of the frame.\n\ngetclasstree(classes [, unique])\n\nGiven a list of related classes, classes, this function organizes the classes into a hierar- chy based on inheritance.The hierarchy is represented as a collection of nested lists, where each entry in the list is a list of classes that inherit from the class that immediate- ly precedes the list. Each entry in the list is a 2-tuple (cls, bases), where clsis the\n\nF h Lib f L Bdff\n\ninspect\n\n223\n\nclass object and basesis a tuple of base classes. If uniqueis True, each class only appears once in the returned list. Otherwise, a class may appear multiple times if multi- ple inheritance is being used.\n\ngetcomments(object)\n\nReturns a string consisting of comments that immediately precede the definition of objectin Python source code. If objectis a module, comments defined at the top of the module are returned. Returns None if no comments are found.\n\ngetdoc(object)\n\nReturns the documentation string for object.The documentation string is first processed using the cleandoc() function before being returned.\n\ngetfile(object)\n\nReturns the name of the file in which objectwas defined. May return TypeError if this information is not applicable or available (for example, for built-in functions).\n\ngetframeinfo(frame [, context])\n\nReturns a named tuple Traceback(filename, lineno, function, code_context, index) containing information about the frame object frame. filenameand linespecify a source code location.The contextparameter specifies the number of lines of context from the source code to retrieve.The contextlist field in the returned tuple contains a list of source lines corresponding to this context. The indexfield is a numerical index within this list for the line corresponding to frame.\n\ngetinnerframes(traceback [, context])\n\nReturns a list of frame records for the frame of a traceback and all inner frames. Each frame-record is a 6-tuple consisting of (frame, filename, line, funcname, contextlist, index). filename, line, context, contextlist, and indexhave the same meaning as with getframeinfo().\n\ngetmembers(object [, predicate])\n\nReturns all of the members of object.Typically, the members are obtained by looking in the _ _dict_ _ attribute of an object, but this function may return attributes of objectstored elsewhere (for example, docstrings in _ _doc_ _, objects’ names in _ _name_ _, and so on).The members are returned a list of (name, value) pairs. predicateis an optional function that accepts a member object as an argument and returns True or False. Only members for which predicatereturns True are returned. Functions such as isfunction() and isclass() can be used as predicate functions.\n\ngetmodule(object)\n\nReturns the module in which objectwas defined (if possible).\n\ngetmoduleinfo(path)\n\nReturns information about how Python would interpret the file path. If pathis not a Python module, None is returned. Otherwise, a named tuple ModuleInfo(name, suffix, mode, module_type) is returned where nameis the name of the module,\n\nF h Lib f L Bdff\n\n224\n\nChapter 13 Python Runtime Services\n\nsuffixis the filename suffix, modeis the file mode that would be used to open the module, and module_typeis an integer code specifying the module type. Module type codes are defined in the imp module as follows:\n\nModule Type imp.PY_SOURCE\n\nimp.PY_COMPILED\n\nimp.C_EXTENSION\n\nimp.PKG_DIRECTORY\n\nimp.C_BUILTIN\n\nDescription Python source file Python compiled object file (.pyc) Dynamically loadable C extension Package directory Built-in module Frozen module\n\nimp.PY_FROZEN\n\ngetmodulename(path)\n\nReturns the name of the module that would be used for the file path. If pathdoes not look like a Python module, None is returned.\n\ngetmro(cls)\n\nReturns a tuple of classes that represent the method-resolution ordering used to resolve methods in class cls. Refer to Chapter 7,“Classes and Object-Oriented Programming,” for further details.\n\ngetouterframes(frame [, context])\n\nReturns a list of frame records for frameand all outer frames.This list represents the calling sequence where the first entry contains information for frame. Each frame record is a 6-tuple (frame, filename, line, funcname, contextlist, index) where the fields have the same meaning as for getinnerframes()The contextargu- ment has the same meaning as for getframeinfo().\n\ngetsourcefile(object)\n\nReturns the name of the Python source file in which objectwas defined.\n\ngetsourcelines(object)\n\nReturns a tuple (sourcelines, firstline) corresponding to the definition of object. sourcelinesis a list of source code lines, and firstlineis the line number of the first source code line. Raises IOError if source code can’t be found.\n\ngetsource(object)\n\nReturns source code of objectas a single string. Raises IOError if the source code can’t be found.\n\nisabstract(object)\n\nReturns True if objectis an abstract base class.\n\nisbuiltin(object)\n\nReturns True if objectis a built-in function.\n\nisclass(object)\n\nReturns True if objectis a class.\n\nF h Lib f L Bdff\n\ninspect\n\n225\n\niscode(object)\n\nReturns True if objectis a code object.\n\nisdatadescriptor(object)\n\nReturns True if objectis a data descriptor object.This is the case if objectdefines both a _ _get_ _() and _ _set_ _() method.\n\nisframe(object)\n\nReturns True if objectis a frame object.\n\nisfunction(object)\n\nReturns True if objectis a function object.\n\nisgenerator(object)\n\nReturns True if objectis a generator object.\n\nisgeneratorfunction(object)\n\nReturns True if objectis a generator function.This is different than isgenerator() in that it tests if objectis a function that creates a generator when called. It is not used to check if objectis an actively running generator.\n\nismethod(object)\n\nReturns True if objectis a method.\n\nismethoddescriptor(object)\n\nReturns True if objectis a method descriptor object.This is the case if objectis not a method, class, or function and it defines a _ _get_ _() method but does not define _ _set_ _().\n\nismodule(object)\n\nReturns True if objectis a module object.\n\nisroutine(object)\n\nReturns True if objectis a user-defined or built-in function or method.\n\nistraceback(object)\n\nReturns True if objectis a traceback object.\n\nstack([context])\n\nReturns a list of frame records corresponding to the stack of the caller. Each frame record is a 6-tuple (frame, filename, line, funcname, contextlist, index), which contains the same information as returned by getinnerframes(). context specifies the number of lines of source context to return in each frame record.\n\ntrace([context])\n\nReturns a list of frame records for the stack between the current frame and the frame in which the current exception was raised.The first frame record is the caller, and the last frame record is the frame where the exception occurred. contextspecifies the number of lines of source context to return in each frame record.\n\nF h Lib f L Bdff\n\n226\n\nChapter 13 Python Runtime Services\n\nmarshal The marshal module is used to serialize Python objects in an “undocumented” Python-specific data format. marshal is similar to the pickle and shelve modules, but it is less powerful and intended for use only with simple objects. It shouldn’t be used to implement persistent objects in general (use pickle instead). However, for sim- ple built-in types, the marshal module is a very fast approach for saving and loading data.\n\ndump(value, file [, version])\n\nWrites the object value to the open file object file. If valueis an unsupported type, a ValueError exception is raised. versionis an integer that specifies the data format to use.The default output format is found in marshal.version and is currently set to 2. Version 0 is an older format used by earlier versions of Python.\n\ndumps(value [,version])\n\nReturns the string written by the dump() function. If valueis an unsupported type, a ValueError exception is raised. versionis the same as described previously.\n\nload(file)\n\nReads and returns the next value from the open file object file. If no valid value is read, an EOFError, ValueError, or TypeError exception will be raised.The format of the input data is automatically detected.\n\nloads(string)\n\nReads and returns the next value from the string string.\n\nNotes\n\nn Data is stored in a binary architecture-independent format. n Only None, integers, long integers, floats, complex numbers, strings, Unicode\n\nstrings, tuples, lists, dictionaries, and code objects are supported. Lists, tuples, and dictionaries can only contain supported objects. Class instances and recursive ref- erences in lists, tuples, and dictionaries are not supported.\n\nn Integers may be promoted to long integers if the built-in integer type doesn’t have enough precision—for example, if the marshalled data contains a 64-bit integer, but the data is being read on a 32-bit machine.\n\nn marshal is not intended to be secure against erroneous or maliciously construct-\n\ned data and should not be used to unmarshal data from untrusted sources.\n\nn marshal is significantly faster than pickle, but it isn’t as flexible.\n\npickle The pickle module is used to serialize Python objects into a stream of bytes suitable for storing in a file, transferring across a network, or placing in a database.This process is variously called pickling, serializing, marshalling, or flattening.The resulting byte stream can also be converted back into a series of Python objects using an unpickling process.\n\nF h Lib f L Bdff\n\npickle\n\n227\n\nThe following functions are used to turn an object into a byte-stream.\n\ndump(object, file [, protocol ])\n\nDumps a pickled representation of objectto the file object file. protocolspecifies the output format of the data. Protocol 0 (the default) is a text-based format that is backwards-compatible with earlier versions of Python. Protocol 1 is a binary protocol that is also compatible with most earlier Python versions. Protocol 2 is a newer protocol that provides more efficient pickling of classes and instances. Protocol 3 is used by Python 3 and is not backwards-compatible. If protocolis negative, the most modern protocol will be selected.The variable pickle.HIGHEST_PROTOCOL contains the high- est protocol available. If objectdoesn’t support pickling, a pickle.PicklingError exception is raised.\n\ndumps(object [, protocol])\n\nSame as dump(), but returns a string containing the pickled data.\n\nThe following example shows how you use these functions to save objects to a file:\n\nf = open('myfile', 'wb') pickle.dump(x, f) pickle.dump(y, f) ... dump more objects ... f.close()\n\nThe following functions are used to restore a pickled object.\n\nload(file)\n\nLoads and returns a pickled representation of an object from the file object file. It is not necessary to specify the input protocol as it is automatically detected.A pickle.UnpicklingError exception is raised if the file contains corrupted data that can’t be decoded. If an end-of-file is detected, an EOFError exception is raised.\n\nloads(string)\n\nSame as load(), but reads the pickled representation of an object from a string. The following example shows how you use these functions to load data:\n\nf = open('myfile', 'rb') x = pickle.load(f) y = pickle.load(f) ... load more objects ... f.close()\n\nWhen loading, it is not necessary to specify the protocol or any information about the type of object being loaded.That information is saved as part of the pickle data format itself.\n\nIf you are pickling more than one Python object, you can simply make repeated calls to dump() and load() as shown in the previous examples.When making multiple calls, you simply have to make sure the sequence of load() calls matches the sequence of dump() calls that were used to write the file.\n\nWhen working with complicated data structures involving cycles or shared refer- ences, using dump() and load() can be problematic because they don’t maintain any internal state about objects that have already been pickled or restored.This can result in output files that are excessively large and that don’t properly restore the relationship\n\nF h Lib f L Bdff\n\n228\n\nChapter 13 Python Runtime Services\n\nbetween objects when loaded.An alternative approach is to use Pickler and Unpickler objects.\n\nPickler(file [, protocol ])\n\nCreates a pickling object that writes data to the file object filewith the specified pickle protocol.An instance p of Pickler has a method p.dump(x) that dumps an object xto file. Once xhas been dumped, its identity is remembered. If a subsequent p.dump() operation is used to write the same object, a reference to the previously dumped object is saved instead of writing a new copy.The method p.clear_memo() clears the internal dictionary used to track previously dumped objects.You would use this if you wanted to write a fresh copy of a previously dumped object (that is, if its value changed since the last dump() operation).\n\nUnpickler(file)\n\nCreates an unpickling object that reads data from the file object file.An instance u of Unpickler has a method u.load() that loads and returns a new object from file.An Unpickler keeps track of objects it has returned because the input source might con- tain an object reference created by the Pickler object. In this case, u.load() returns a reference to the previously loaded object.\n\nThe pickle module works with most kinds of normal Python objects.This\n\nincludes:\n\nn None\n\nn Numbers and strings n Tuples, lists, and dictionaries containing only pickleable objects n Instances of user-defined classes defined at the top level of a module\n\nWhen instances of a user-defined class are pickled, the instance data is the only part that gets pickled.The corresponding class definition is not saved—instead, the pickled data merely contains the name of the associated class and module.When instances are unpickled, the module in which the class is defined is automatically imported in order to access the class definition when re-creating instances. It should also be noted that when restoring an instance, the _ _init_ _() method of a class is not invoked. Instead, the instance is re-created through other means and the instance data restored.\n\nOne restriction on instances is that the corresponding class definition must appear at\n\nthe top level of a module (that is, no nested classes). In addition, if the instance’s class definition was originally defined in _ _main_ _, that class definition must be manually reloaded prior to unpickling a saved object (because there’s no way for the interpreter to know how to automatically load the necessary class definitions back into _ _main_ _ when unpickling).\n\nIt is not normally necessary to do anything to make a user-defined class work with pickle. However, a class can define customized methods for saving and restoring its state by implementing the special methods _ _getstate_ _() and _ _setstate_ _().The _ _getstate_ _() method must return a pickleable object (such as a string or tuple) representing the state of the object.The _ _setstate_ _() method accepts the pickled object and restores its state. If these methods are undefined, the default behavior is to pickle an instance’s underlying _ _dict_ _ attribute. It should be noted that if these methods are defined, they will also be used by the copy module to implement the shal- low and deep copy operations.\n\nF h Lib f L Bdff\n\nsys\n\n229\n\nNotes\n\nn In Python 2, a module called cPickle contains a C implementation of functions in the pickle module. It is significantly faster than pickle, but is restricted in that it doesn’t allow subclassing of the Pickler and Unpickler objects. Python 3 has a support module that also contains C implementation, but it is used more transparently (pickle takes advantage of it automatically as appropriate).\n\nn The data format used by pickle is Python-specific and shouldn’t be assumed to\n\nbe compatible with any external standards such as XML.\n\nn Whenever possible, the pickle module should be used instead of the marshal module because pickle is more flexible, the data encoding is documented, and additional error-checking is performed.\n\nn Due to security concerns, programs should not unpickle data received from\n\nuntrusted sources.\n\nn Use of the pickle module with types defined in extension modules is much more involved than what is described here. Implementers of extension types should consult the online documentation for details concerning the low-level protocol required to make these objects work with pickle—in particular, details on how to implement the _ _reduce_ _() and _ _reduce_ex_ _() special methods that pickle uses to create the serialized byte sequences.\n\nsys The sys module contains variables and functions that pertain to the operation of the interpreter and its environment.\n\nVariables The following variables are defined.\n\napi_version\n\nAn integer representing the C API version of the Python interpreter. Used when work- ing with extension modules.\n\nargv\n\nList of command-line options passed to a program. argv[0] is the name of the pro- gram.\n\nbuiltin_module_names\n\nTuple containing names of modules built into the Python executable.\n\nbyteorder\n\nNative byte-ordering of the machine—'little' for little-endian or 'big' for big- endian.\n\nF h Lib f L Bdff\n\n230\n\nChapter 13 Python Runtime Services\n\ncopyright\n\nString containing copyright message.\n\n_ _displayhook__\n\nOriginal value of the displayhook() function.\n\ndont_write_bytecode\n\nBoolean flag that determines whether or not Python writes bytecode (.pyc or .pyo files) when importing modules.The initial value is True unless the -B option to the interpreter is given.The setting can be changed as needed in your own program.\n\ndllhandle\n\nInteger handle for the Python DLL (Windows).\n\n__excepthook__\n\nOriginal value of the excepthook() function.\n\nexec_prefix\n\nDirectory where platform-dependent Python files are installed.\n\nexecutable\n\nString containing the name of the interpreter executable.\n\nflags\n\nAn object representing the settings of different command-line options supplied to the Python interpreter itself.The following table lists the attributes of flags along with the corresponding command-line option that turns the flag on.These attributes are read- only.\n\nAttribute flags.debug flags.py3k_warning\n\nCommand-Line Option -d -3\n\nflags.division_warning\n\nQ\n\nflags.division_new\n\nQnew\n\nflags.inspect\n\ni\n\nflags.interactive\n\nflags.optimize\n\nflags.dont_write_bytecode\n\ni -O or -OO -B\n\nflags.no_site\n\nS\n\nflags.ignore_environment\n\nflags.tabcheck\n\nflags.verbose\n\nE -t or -tt -v\n\nflags.unicode\n\nU\n\nF h Lib f L Bdff\n\nsys\n\n231\n\nfloat_info\n\nAn object that holds information about internal representation of floating-point num- bers.The values of these attributes are taken from the float.h C header file.\n\nAttribute float_info.epsilon\n\nfloat_info.dig\n\nfloat_info.mant_dig\n\nfloat_info.max\n\nfloat_info.max_exp\n\nDescription Difference between 1.0 and the next largest float. Number of decimal digits that can be represented without any changes after rounding. Number of digits that can be represented using the numer- ic base specified in float_info.radix. Maximum floating-point number. Maximum exponent in the numeric base specified in float_info.radix.\n\nfloat_info.max_10_exp Maximum exponent in base 10. float_info.min\n\nMinimum positive floating-point value. Minimum exponent in the numeric base specified in float_info.radix.\n\nfloat_info.min_exp\n\nfloat_info.min_10_exp Minimum exponent in base 10. float_info.radix\n\nNumeric base used for exponents. Rounding behavior (-1 undetermined, 0 towards zero, 1 nearest, 2 towards positive infinity, 3 towards negative infinity).\n\nfloat_info.rounds\n\nhexversion\n\nInteger whose hexadecimal representation encodes the version information contained in sys.version_info.The value of this integer is always guaranteed to increase with newer versions of the interpreter.\n\nlast_type, last_value, last_traceback\n\nThese variables are set when an unhandled exception is encountered and the interpreter prints an error message. last_type is the last exception type, last_value is the last exception value, and last_traceback is a stack trace. Note that the use of these vari- ables is not thread-safe. sys.exc_info() should be used instead.\n\nmaxint\n\nLargest integer supported by the integer type (Python 2 only).\n\nmaxsize\n\nLargest integer value supported by the C size_t datatype on the system.This value determines the largest possible length for strings, lists, dicts, and other built-in types.\n\nmaxunicode\n\nInteger that indicates the largest Unicode code point that can be represented.The default value is 65535 for the 16-bit UCS-2 encoding.A larger value will be found if Python has been configured to use UCS-4.\n\nmodules\n\nDictionary that maps module names to module objects.\n\nF h Lib f L Bdff\n\n232\n\nChapter 13 Python Runtime Services\n\npath\n\nList of strings specifying the search path for modules.The first entry is always set to the directory in which the script used to start Python is located (if available). Refer to Chapter 8,“Iterators and Generators.”\n\nplatform\n\nPlatform identifier string, such as 'linux-i386'.\n\nprefix\n\nDirectory where platform-independent Python files are installed.\n\nps1, ps2\n\nStrings containing the text for the primary and secondary prompts of the interpreter. Initially, ps1 is set to '>>> ' and ps2 is set to '... '.The str() method of whatever object is assigned to these values is evaluated to generate the prompt text.\n\npy3kwarning\n\nFlag set to True in Python 2 when the interpreter is run with the -3 option.\n\nstdin, stdout, stderr\n\nFile objects corresponding to standard input, standard output, and standard error. stdin is used for the raw_input() and input() functions. stdout is used for print and the prompts of raw_input() and input(). stderr is used for the interpreter’s prompts and error messages.These variables can be assigned to any object that supports a write() method operating on a single string argument.\n\n_ _stdin_ _, _ _stdout_ _, _ _stderr_ _\n\nFile objects containing the values of stdin, stdout, and stderr at the start of the interpreter.\n\ntracebacklimit\n\nMaximum number of levels of traceback information printed when an unhandled exception occurs.The default value is 1000.A value of 0 suppresses all traceback infor- mation and causes only the exception type and value to be printed.\n\nversion\n\nVersion string.\n\nversion_info\n\nVersion information represented as a tuple (major, minor, micro, releaselevel, serial).All values are integers except releaselevel, which is the string 'alpha', 'beta', 'candidate', or 'final'.\n\nwarnoptions\n\nList of warning options supplied to the interpreter with the –W command-line option.\n\nwinver\n\nThe version number used to form registry keys on Windows.\n\nF h Lib f L Bdff",
      "page_number": 234
    },
    {
      "number": 13,
      "title": "Segment 13 (pages 257-279)",
      "start_page": 257,
      "end_page": 279,
      "detection_method": "synthetic",
      "content": "sys\n\n233\n\nFunctions The following functions are available:\n\n_clear_type_cache()\n\nClears the internal type cache.To optimize method lookups, a small 1024-entry cache of recently used methods is maintained inside the interpreter.This cache speeds up repeated method lookups—especially in code that has deep inheritance hierarchies. Normally, you don’t need to clear this cache, but you might do so if you are trying to track down a really tricky memory reference counting issue. For example, if a method in the cache was holding a reference to an object that you were expecting to be destroyed.\n\n_current_frames()\n\nReturns a dictionary mapping thread identifiers to the topmost stack frame of the exe- cuting thread at the time of call.This information can be useful in writing tools related to thread debugging (that is, tracking down deadlock). Keep in mind that the values returned by this function only represent a snapshot of the interpreter at the time of call. Threads may be executing elsewhere by the time you look at the returned data.\n\ndisplayhook([value])\n\nThis function is called to print the result of an expression when the interpreter is run- ning in interactive mode. By default, the value of repr(value) is printed to standard output and valueis saved in the variable _ _builtin_ _._. displayhook can be rede- fined to provide different behavior if desired.\n\nexcepthook(type,value,traceback)\n\nThis function is called when an uncaught exception occurs. typeis the exception class, valueis the value supplied by the raise statement, and tracebackis a traceback object.The default behavior is to print the exception and traceback to standard error. However, this function can be redefined to provide alternative handling of uncaught exceptions (which may be useful in specialized applications such as debuggers or CGI scripts).\n\nexc_clear()\n\nClears all information related to the last exception that occurred. It only clears informa- tion specific to the calling thread.\n\nexc_info()\n\nReturns a tuple (type, value, traceback) containing information about the exception that’s currently being handled. typeis the exception type, valueis the exception parameter passed to raise, and tracebackis a traceback object containing the call stack at the point where the exception occurred. Returns None if no exception is currently being handled.\n\nexit([n])\n\nExits Python by raising the SystemExit exception. nis an integer exit code indicating a status code.A value of 0 is considered normal (the default); nonzero values are consid- ered abnormal. If a noninteger value is given to n, it’s printed to sys.stderr and an exit code of 1 is used.\n\nF h Lib f L Bdff\n\n234\n\nChapter 13 Python Runtime Services\n\ngetcheckinterval()\n\nReturns the value of the check interval, which specifies how often the interpreter checks for signals, thread switches, and other periodic events.\n\ngetdefaultencoding()\n\nGets the default string encoding in Unicode conversions. Returns a value such as 'ascii' or 'utf-8'.The default encoding is set by the site module.\n\ngetdlopenflags()\n\nReturns the flags parameter that is supplied to the C function dlopen() when loading extension modules on UNIX. See dl module.\n\ngetfilesystemencoding()\n\nReturns the character encoding used to map Unicode filenames to filenames used by the underlying operating system. Returns 'mbcs' on Windows or 'utf-8' on Macintosh OS X. On UNIX systems, the encoding depends on locale settings and will return the value of the locale CODESET parameter. May return None, in which case the system default encoding is used.\n\n_getframe([depth])\n\nReturns a frame object from the call stack. If depthis omitted or zero, the topmost frame is returned. Otherwise, the frame for that many calls below the current frame is returned. For example, _getframe(1) returns the caller’s frame. Raises ValueError if depthis invalid.\n\ngetprofile()\n\nReturns the profile function set by the setprofile() function.\n\ngetrecursionlimit()\n\nReturns the recursion limit for functions.\n\ngetrefcount(object)\n\nReturns the reference count of object.\n\ngetsizeof(object [, default])\n\nReturns the size of objectin bytes.This calculation is made by calling the _ _sizeof_ _() special method of object. If undefined, a TypeError will be generat- ed unless a default value has been specified with the defaultargument. Because objects are free to define _ _sizeof_ _() however they wish, there is no guarantee that the result of this function is a true measure of memory use. However, for built-in types such as lists or string, it is correct.\n\ngettrace()\n\nReturns the trace function set by the settrace() function.\n\ngetwindowsversion()\n\nReturns a tuple (major,minor,build,platform,text) that describes the version of Windows being used. majoris the major version number. For example, a value of 4 indicates Windows NT 4.0, and a value of 5 indicates Windows 2000 and Windows XP\n\nF h Lib f L Bdff\n\ntraceback\n\n235\n\nvariants. minoris the minor version number. For example, 0 indicates Windows 2000, whereas 1 indicates Windows XP. buildis the Windows build number. platformiden- tifies the platform and is an integer with one of the following common values: 0 (Win32s on Windows 3.1), 1 (Windows 95,98, or Me), 2 (Windows NT, 2000, XP), or 3 (Windows CE). textis a string containing additional information such as \"Service Pack 3\".\n\nsetcheckinterval(n)\n\nSets the number of Python virtual machine instructions that must be executed by the interpreter before it checks for periodic events such as signals and thread context switches.The default value is 10.\n\nsetdefaultencoding(enc)\n\nSets the default encoding. encis a string such as 'ascii' or 'utf-8'.This function is only defined inside the site module. It can be called from user-definable sitecustomize modules.\n\nsetdlopenflags(flags)\n\nSets the flags passed to the C dlopen() function, which is used to load extension mod- ules on UNIX.This will affect the way in which symbols are resolved between libraries and other extension modules. flagsis the bitwise OR of values that can be found in the dl module (see Chapter 19,“Network Programming”)—for example, sys.setdlopenflags(dl.RTLD_NOW | dl.RTLD_GLOBAL).\n\nsetprofile(pfunc)\n\nSets the system profile function that can be used to implement a source code profiler.\n\nsetrecursionlimit(n)\n\nChanges the recursion limit for functions.The default value is 1000. Note that the operating system may impose a hard limit on the stack size, so setting this too high may cause the Python interpreter process to crash with a Segmentation Fault or Access Violation.\n\nsettrace(tfunc)\n\nSets the system trace function, which can be used to implement a debugger. Refer to Chapter 11 for information about the Python debugger.\n\ntraceback The traceback module is used to gather and print stack traces of a program after an exception has occurred.The functions in this module operate on traceback objects such as the third item returned by the sys.exc_info() function.The main use of this module is in code that needs to report errors in a non-standard way—for example, if you were running Python programs deeply embedded within a network server and you wanted to redirect tracebacks to a log file.\n\nprint_tb(traceback [, limit [, file]])\n\nPrints up to limitstack trace entries from tracebackto the file file. If limitis omitted, all the entries are printed. If fileis omitted, the output is sent to sys.stderr.\n\nF h Lib f L Bdff\n\n236\n\nChapter 13 Python Runtime Services\n\nprint_exception(type, value, traceback [, limit [, file]])\n\nPrints exception information and a stack trace to file. typeis the exception type, and valueis the exception value. limitand fileare the same as in print_tb().\n\nprint_exc([limit [, file]])\n\nSame as print_exception() applied to the information returned by the sys.exc_info() function.\n\nformat_exc([limit [, file]])\n\nReturns a string containing the same information printed by print_exc().\n\nprint_last([limit [, file]])\n\nSame as print_exception (sys.last_type, sys.last_value, sys.last_traceback, limit, file).\n\nprint_stack([frame [, limit [, file]]])\n\nPrints a stack trace from the point at which it’s invoked. framespecifies an optional stack frame from which to start. limitand filehave the same meaning as for print_tb().\n\nextract_tb(traceback [, limit])\n\nExtracts the stack trace information used by print_tb().The return value is a list of tuples of the form (filename, line, funcname, text) containing the same infor- mation that normally appears in a stack trace. limitis the number of entries to return.\n\nextract_stack([frame [, limit]])\n\nExtracts the same stack trace information used by print_stack(), but obtained from the stack frame frame. If frameis omitted, the current stack frame of the caller is used and limitis the number of entries to return.\n\nformat_list(list)\n\nFormats stack trace information for printing. listis a list of tuples as returned by extract_tb() or extract_stack().\n\nformat_exception_only(type, value)\n\nFormats exception information for printing.\n\nformat_exception(type, value, traceback [, limit])\n\nFormats an exception and stack trace for printing.\n\nformat_tb(traceback [, limit])\n\nSame as format_list(extract_tb(traceback, limit)).\n\nformat_stack([frame [, limit]])\n\nSame as format_list(extract_stack(frame, limit)).\n\ntb_lineno(traceback)\n\nReturns the line number set in a traceback object.\n\nF h Lib f L Bdff\n\ntypes\n\n237\n\ntypes The types module defines names for the built-in types that correspond to functions, modules, generators, stack frames, and other program elements.The contents of this module are often used in conjunction with the built-in isinstance() function and other type-related operations.\n\nVariable BuiltinFunctionType\n\nCodeType\n\nFrameType\n\nFunctionType\n\nGeneratorType\n\nGetSetDescriptorType\n\nLambdaType\n\nMemberDescriptorType\n\nMethodType\n\nModuleType\n\nDescription Type of built-in functions Type of code objects Type of execution frame object Type of user-defined functions and lambdas Type of generator-iterator objects Type of getset descriptor objects Alternative name for FunctionType Type of member descriptor objects Type of user-defined class methods Type of modules Type of traceback objects\n\nTracebackType\n\nMost of the preceding type objects serve as constructors that can be used to create an object of that type.The following descriptions provide the parameters used to create functions, modules, code objects, and methods. Chapter 3 contains detailed information about the attributes of the objects created and the arguments that need to be supplied to the functions described next.\n\nFunctionType(code, globals [, name [, defarags [, closure]]])\n\nCreates a new function object.\n\nCodeType(argcount, nlocals, stacksize, flags, codestring, constants, names, varnames, filename, name, firstlineno, lnotab [, freevars [, cellvars ]])\n\nCreates a new code object.\n\nMethodType(function, instance, class)\n\nCreates a new bound instance method.\n\nModuleType(name [, doc])\n\nCreates a new module object.\n\nNotes\n\nn The types module should not be used to refer the type of built-in objects such as integers, lists, or dictionaries. In Python 2, types contains other names such as IntType and DictType. However, these names are just aliases for the built-in type names of int and dict. In modern code, you should just use the built-in type names because the types module only contains the names listed previously in Python 3.\n\nF h Lib f L Bdff\n\n238\n\nChapter 13 Python Runtime Services\n\nwarnings The warnings module provides functions to issue and filter warning messages. Unlike exceptions, warnings are intended to alert the user to potential problems, but without generating an exception or causing execution to stop. One of the primary uses of the warnings module is to inform users about deprecated language features that may not be supported in future versions of Python. For example:\n\n>>> import regex __main__:1: DeprecationWarning: the regex module is deprecated; use the re module >>>\n\nLike exceptions, warnings are organized into a class hierarchy that describes general cat- egories of warnings.The following lists the currently supported categories:\n\nWarning Object Warning\n\nUserWarning\n\nDeprecationWarning\n\nSyntaxWarning\n\nRuntimeWarning\n\nFutureWarning\n\nDescription Base class of all warning types User-defined warning Warning for use of a deprecated feature Potential syntax problem Potential runtime problem Warning that the semantics of a particular feature will change in a future release\n\nEach of these classes is available in the _ _builtin_ _ module as well as the exceptions module. In addition, they are also instances of Exception.This makes it possible to easily convert warnings into errors.\n\nWarnings are issued using the warn() function. For example:\n\nwarnings.warn(\"feature X is deprecated.\") warnings.warn(\"feature Y might be broken.\", RuntimeWarning)\n\nIf desired, warnings can be filtered.The filtering process can be used to alter the output behavior of warning messages, to ignore warnings, or to turn warnings into exceptions. The filterwarnings() function is used to add a filter for a specific type of warning. For example:\n\nwarnings.filterwarnings(action=\"ignore\",\n\nmessage=\".*regex.*\", category=DeprecationWarning)\n\nimport regex # Warning message disappears\n\nLimited forms of filtering can also be specified using the –W option to the interpreter. For example:\n\n% python –Wignore:the\\ regex:DeprecationWarning\n\nThe following functions are defined in the warnings module:\n\nF h Lib f L Bdff\n\nwarnings\n\n239\n\nwarn(message[, category[, stacklevel]])\n\nIssues a warning. messageis a string containing the warning message, categoryis the warning class (such as DeprecationWarning), and stacklevelis an integer that speci- fies the stack frame from which the warning message should originate. By default, categoryis UserWarning and stacklevelis 1.\n\nwarn_explicit(message, category, filename, lineno[, module[, registry]])\n\nThis is a low-level version of the warn() function. messageand categoryhave the same meaning as for warn(). filename, lineno, and moduleexplicitly specify the location of the warning. registryis an object representing all the currently active fil- ters. If registryis omitted, the warning message is not suppressed.\n\nshowwarning(message, category, filename, lineno[, file])\n\nWrites a warning to a file. If fileis omitted, the warning is printed to sys.stderr.\n\nformatwarning(message, category, filename, lineno)\n\nCreates the formatted string that is printed when a warning is issued.\n\nfilterwarnings(action[, message[, category[, module[, lineno[, append]]]]])\n\nAdds an entry to the list of warning filters. actionis one of 'error', 'ignore', 'always', 'default', 'once', or 'module'.The following list provides an explana- tion of each:\n\nAction 'error'\n\n'ignore'\n\n'always'\n\n'default'\n\n'module'\n\nDescription Convert the warning into an exception Ignore the warning Always print a warning message Print the warning once for each location where the warning occurs Print the warning once for each module in which the warning occurs Print the warning once regardless of where it occurs\n\n'once'\n\nmessageis a regular expression string that is used to match against the warning mes- sage. categoryis a warning class such as DeprecationError. moduleis a regular expression string that is matched against the module name. linenois a specific line number or 0 to match against all lines. appendspecifies that the filter should be appended to the list of all filters (checked last). By default, new filters are added to the beginning of the filter list. If any argument is omitted, it defaults to a value that matches all warnings.\n\nresetwarnings()\n\nResets all the warning filters.This discards all previous calls to filterwarnings() as well as options specified with –W.\n\nNotes\n\nn The list of currently active filters is found in the warnings.filters variable. n When warnings are converted to exceptions, the warning category becomes the exception type. For instance, an error on DeprecationWarning will raise a DeprecationWarning exception.\n\nF h Lib f L Bdff\n\n240\n\nChapter 13 Python Runtime Services\n\nn The –W option can be used to specify a warning filter on the command line.The\n\ngeneral format of this option is\n\nWaction:message:category:module:lineno\n\nwhere each part has the same meaning as for the filterwarning() function. However, in this case, the messageand modulefields specify substrings (instead of regular expressions) for the first part of the warning message and module name to be filtered, respectively.\n\nweakref The weakref module is used to provide support for weak references. Normally, a refer- ence to an object causes its reference count to increase—effectively keeping the object alive until the reference goes away.A weak reference, on the other hand, provides a way of referring to an object without increasing its reference count.This can be useful in certain kinds of applications that must manage objects in unusual ways. For example, in an object-oriented program, where you might implement a relationship such as the Observer pattern, a weak reference can be used to avoid the creation of reference cycles.An example of this is shown in the “Object Memory Management” section of Chapter 7.\n\nA weak reference is created using the weakref.ref() function as follows:\n\n>>> class A: pass >>> a = A() >>> ar = weakref.ref(a) # Create a weak reference to a >>> print ar <weakref at 0x135a24; to 'instance' at 0x12ce0c>\n\nOnce a weak reference is created, the original object can be obtained from the weak reference by simply calling it as a function with no arguments. If the underlying object still exists, it will be returned. Otherwise, None is returned to indicate that the original object no longer exists. For example:\n\n>>> print ar() # Print original object <__main__.A instance at 12ce0c> >>> del a # Delete the original object >>> print ar() # a is gone, so this now returns None None >>>\n\nThe following functions are defined by the weakref module:\n\nref(object[, callback])\n\nCreates a weak reference to object. callbackis an optional function that will be called when objectis about to be destroyed. If supplied, this function should accept a single argument, which is the corresponding weak reference object. More than one weak reference may refer to the same object. In this case, the callback functions will be called in order from the most recently applied reference to the oldest reference. objectcan be obtained from a weak reference by calling the returned weak reference object as a function with no arguments. If the original object no longer exists, None\n\nF h Lib f L Bdff\n\nweakref\n\n241\n\nwill be returned. ref() actually defines a type, ReferenceType, that can be used for type-checking and subclasses.\n\nproxy(object[, callback])\n\nCreates a proxy using a weak reference to object.The returned proxy object is really a wrapper around the original object that provides access to its attributes and methods.As long as the original object exists, manipulation of the proxy object will transparently mimic the behavior of the underlying object. On the other hand, if the original object has been destroyed, operations on the proxy will raise a weakref.ReferenceError to indicate that the object no longer exists. callbackis a callback function with the same meaning as for the ref() function.The type of a proxy object is either ProxyType or CallableProxyType, depending on whether or not the original object is callable.\n\ngetweakrefcount(object)\n\nReturns the number of weak references and proxies that refer to object.\n\ngetweakrefs(object)\n\nReturns a list of all weak reference and proxy objects that refer to object.\n\nWeakKeyDictionary([dict])\n\nCreates a dictionary in which the keys are referenced weakly.When there are no more strong references to a key, the corresponding entry in the dictionary is automatically removed. If supplied, the items in dictare initially added to the returned WeakKeyDictionary object. Because only certain types of objects can be weakly refer- enced, there are numerous restrictions on acceptable key values. In particular, built-in strings cannot be used as weak keys. However, instances of user-defined classes that define a _ _hash_ _() method can be used as keys.An instance of WeakKeyDictionary has two methods, iterkeyrefs() and keyrefs(), that return the weak key references.\n\nWeakValueDictionary([dict])\n\nCreates a dictionary in which the values are referenced weakly.When there are no more strong references to a value, corresponding entries in the dictionary will be discarded. If supplied, the entries in dictare added to the returned WeakValueDictionary.An instance of WeakValueDictionary has two methods, itervaluerefs() and valuerefs(), that return the weak value references.\n\nProxyTypes\n\nThis is a tuple (ProxyType, CallableProxyType) that can be used for testing if an object is one of the two kinds of proxy objects created by the proxy() function—for example, isinstance(object, ProxyTypes).\n\nF h Lib f L Bdff\n\n242\n\nChapter 13 Python Runtime Services\n\nExample One application of weak references is to create caches of recently computed results. For instance, if a function takes a long time to compute a result, it might make sense to cache these results and to reuse them as long as they are still in use someplace in the application. For example:\n\n_resultcache = { } def foocache(x):\n\nif resultcache.has_key(x):\n\nr = _resultcache[x]() # Get weak ref and dereference it if r is not None: return r\n\nr = foo(x) _resultcache[x] = weakref.ref(r) return r\n\nNotes\n\nn Only class instances, functions, methods, sets, frozen sets, files, generators, type\n\nobjects, and certain object types defined in library modules (for example, sockets, arrays, and regular expression patterns) support weak references. Built-in functions and most built-in types such as lists, dictionaries, strings, and numbers cannot be used.\n\nn If iteration is ever used on a WeakKeyDictionary or WeakValueDictionary, great care should be taken to ensure that the dictionary does not change size because this may produce bizarre side effects such as items mysteriously disap- pearing from the dictionary for no apparent reason.\n\nn If an exception occurs during the execution of a callback registered with ref()\n\nor proxy(), the exception is printed to standard error and ignored.\n\nn Weak references are hashable as long as the original object is hashable. Moreover, the weak reference will maintain its hash value after the original object has been deleted, provided that the original hash value is computed while the object still exists.\n\nn Weak references can be tested for equality but not for ordering. If the objects are\n\nstill alive, references are equal if the underlying objects have the same value. Otherwise, references are equal if they are the same reference.\n\nF h Lib f L Bdff\n\n14\n\nMathematics\n\nThis chapter describes modules for performing various kinds of mathematical opera-\n\ntions. In addition, the decimal module, which provides generalized support for decimal floating-point numbers, is described.\n\ndecimal The Python float data type is represented using a double-precision binary floating- point encoding (usually as defined by the IEEE 754 standard).A subtle consequence of this encoding is that decimal values such as 0.1 can’t be represented exactly. Instead, the closest value is 0.10000000000000001.This inexactness carries over to calculations involving floating-point numbers and can sometimes lead to unexpected results (for example, 3*0.1 == 0.3 evaluates as False).\n\nThe decimal module provides an implementation of the IBM General Decimal Arithmetic Standard, which allows for the exact representation of decimals. It also gives precise control over mathematical precision, significant digits, and rounding behavior. These features can be useful if interacting with external systems that precisely define properties of decimal numbers. For example, if writing Python programs that must interact with business applications.\n\nThe decimal module defines two basic data types: a Decimal type that represents a\n\ndecimal number and a Context type that represents various parameters concerning computation such as precision and round-off error-handling. Here are a few simple examples that illustrate the basics of how the module works:\n\nimport decimal x = decimal.Decimal('3.4') # Create some decimal numbers y = decimal.Decimal('4.5')\n\n# Perform some math calculations using the default context a = x * y # a = decimal.Decimal('15.30') b = x / y # b = decimal.Decimal('0.7555555555555555555555555556')\n\n# Change the precision and perform calculations decimal.getcontext().prec = 3 c = x * y # c = decimal.Decimal('15.3') d = x / y # d = decimal.Decimal('0.756')\n\n# Change the precision for just a single block of statements with decimal.localcontext(decimal.Context(prec=10)): e = x * y # e = decimal.Decimal('15.30') f = x / y # f = decimal.Decimal('0.7555555556')\n\nF h Lib f L Bdff\n\n244\n\nChapter 14 Mathematics\n\nDecimal Objects Decimal numbers are represented by the following class:\n\nDecimal([value [, context]])\n\nvalueis the value of the number specified as either an integer, a string containing a decimal value such as '4.5', or a tuple (sign, digits, exponent). If a tuple is sup- plied, signis 0 for positive, 1 for negative; digitsis a tuple of digits specified as integers; and exponentis an integer exponent.The special strings 'Infinity', '-Infinity', 'NaN', and 'sNaN' may be used to specify positive and negative infinity as well as Not a Number (NaN). 'sNaN' is a variant of NaN that results in an excep- tion if it is ever subsequently used in a calculation.An ordinary float object may not be used as the initial value because that value may not be exact (which defeats the pur- pose of using decimal in the first place).The contextparameter is a Context object, which is described later. If supplied, contextdetermines what happens if the initial value is not a valid number—raising an exception or returning a decimal with the value NaN.\n\nThe following examples show how to create various decimal numbers:\n\na = decimal.Decimal(42) # Creates Decimal(\"42\") b = decimal.Decimal(\"37.45\") # Creates Decimal(\"37.45\") c = decimal.Decimal((1,(2,3,4,5),-2)) # Creates Decimal(\"-23.45\") d = decimal.Decimal(\"Infinity\") e = decimal.Decimal(\"NaN\")\n\nDecimal objects are immutable and have all the usual numeric properties of the built-in int and float types.They can also be used as dictionary keys, placed in sets, sorted, and so forth. For the most part, you manipulate Decimal objects using the standard Python math operators. However, the methods in the following list can be used to carry out several common mathematical operations.All operations take an optional context parameter that controls the behavior of precision, rounding, and other aspects of the cal- culation. If omitted, the current context is used.\n\nMethod x.exp([context])\n\nx.fma(y, z [, context])\n\nx.ln([context])\n\nx.log10([context]) x.sqrt([context])\n\nDescription Natural exponent e**d x*y + zwith no rounding of x*ycomponent Natural logarithm (base e) of x Base-10 logarithm of x Square root of x\n\nContext Objects Various properties of decimal numbers, such as rounding and precision, are controlled through the use of a Context object:\n\nF h Lib f L Bdff\n\ndecimal\n\n245\n\nContext(prec=None, rounding=None, traps=None, flags=None, Emin=None, Emax=None, capitals=1)\n\nThis creates a new decimal context.The parameters should be specified using keyword arguments with the names shown. precis an integer that sets the number of digits of precision for arithmetic operations, roundingdetermines the rounding behavior, and trapsis a list of signals that produce a Python exception when certain events occur during computation (such as division by zero). flagsis a list of signals that indicate the initial state of the context (such as overflow). Normally, flagsis not specified. Emin and Emaxare integers representing the minimum and maximum range for exponents, respectively. capitalsis a boolean flag that indicates whether to use 'E' or 'e' for exponents.The default is 1 ('E').\n\nNormally, new Context objects aren’t created directly. Instead, the function getcontext() or localcontext() is used to return the currently active Context object.That object is then modified as needed. Examples of this appear later in this sec- tion. However, in order to better understand those examples, it is necessary to explain these context parameters in further detail.\n\nRounding behavior is determined by setting the roundingparameter to one of the\n\nfollowing values:\n\nConstant ROUND_CEILING\n\nROUND_DOWN\n\nROUND_FLOOR\n\nDescription Rounds toward positive infinity. For example, 2.52 rounds up to 2.6 and -2.58 rounds up to -2.5. Rounds toward zero. For example, 2.58 rounds down to 2.5 and -2.58 rounds up to -2.5. Rounds toward negative infinity. For example, 2.58 rounds down to 2.5 and -2.52 rounds down to -2.6.\n\nROUND_HALF_DOWN Rounds away from zero if the fractional part is greater than half;\n\notherwise, rounds toward zero. For example, 2.58 rounds up to 2.6, 2.55 rounds down to 2.5 -2.55 rounds up to -2.5, and -2.58 rounds down to -2.6.\n\nROUND_HALF_EVEN The same as ROUND_HALF_DOWN except that if the fractional part is exactly half, the result is rounded down if the preceding digit is even and rounded up if the preceding digit is odd. For example, 2.65 is rounded down to 2.6 and 2.55 is rounded up to 2.6. The same as ROUND_HALF_DOWN except that if the fractional part is exactly half, it is rounded away from zero. For example 2.55 rounds up to 2.6, and -2.55 rounds down to -2.6. Rounds away from zero. For example, 2.52 rounds up to 2.6 and - 2.52 rounds down to -2.6. Rounds away from zero if the last digit after toward zero would have been 0 or 5. Otherwise, rounds toward zero. For example, 2.54 rounds to 2.6 and 2.64 rounds to 2.6.\n\nROUND_HALF_UP\n\nROUND_UP\n\nROUND_05UP\n\nThe trapsand flagsparameters of Context() are lists of signals.A signal represents a type of arithmetic exception that may occur during computation. Unless listed in traps, signals are ignored. Otherwise, an exception is raised.The following signals are defined:\n\nF h Lib f L Bdff\n\n246\n\nChapter 14 Mathematics\n\nSignal Clamped\n\nDivisionByZero\n\nInexact\n\nInvalidOperation\n\nOverflow\n\nRounded\n\nSubnormal\n\nUnderflow\n\nDescription Exponent adjusted to fit the allowed range. Division of non-infinite number by 0. Rounding error occurred. Invalid operation performed. Exponent exceeds Emaxafter rounding. Also generates Inexact and Rounded. Rounding occurred. May occur even if no information was lost (for example, “1.00 “ rounded to “1.0”). Exponent is less than Eminprior to rounding. Numerical underflow. Result rounded to 0. Also generates Inexact and Subnormal.\n\nThese signal names correspond to Python exceptions that can be used for error check- ing. Here’s an example: try:\n\nx = a/b\n\nexcept decimal.DivisionByZero: print \"Division by zero\"\n\nLike exceptions, the signals are organized into a hierarchy:\n\nArithmeticError (built-in exception)\n\nDecimalException\n\nClamped\n\nDivisionByZero\n\nInexact\n\nOverflow\n\nUnderflow\n\nInvalidOperation\n\nRounded\n\nOverflow\n\nUnderflow\n\nSubnormal\n\nUnderflow\n\nThe Overflow and Underflow signals appear more than once in the table because those signals also result in the parent signal (for example, an Underflow also signals Subnormal).The decimal.DivisionByZero signal also derives from the built-in DivisionByZero exception.\n\nIn many cases, arithmetic signals are silently ignored. For instance, a computation may produce a round-off error but generate no exception. In this case, the signal names can be used to check a set of sticky flags that indicate computation state. Here’s an example:\n\nctxt = decimal.getcontext() # Get current context x = a + b if ctxt.flags[Rounded]:\n\nprint \"Result was rounded!\"\n\nF h Lib f L Bdff\n\ndecimal\n\n247\n\nWhen flags get set, they stay set until they are cleared using the clear_flags() method.Thus, one could perform an entire sequence of calculations and only check for errors at the end.\n\nThe settings on an existing Context object ccan be changed through the following\n\nattributes and methods:\n\nc.capitals\n\nFlag set to 1 or 0 that determines whether to use E or e as the exponent character.\n\nc.Emax\n\nInteger specifying maximum exponent.\n\nc.Emin\n\nInteger specifying minimum exponent.\n\nc.prec\n\nInteger specifying digits of precision.\n\nc.flags\n\nDictionary containing current flag values corresponding to signals. For example, c.flags[Rounded] returns the current flag value for the Rounded signal.\n\nc.rounding\n\nRounding rule in effect.An example is ROUND_HALF_EVEN.\n\nc.traps\n\nDictionary containing True/False settings for the signals that result in Python excep- tions. For example, c.traps[DivisionByZero] is usually True, whereas c.traps[Rounded] is False.\n\nc.clear_flags()\n\nResets all sticky flags (clears c.flags).\n\nc.copy()\n\nReturns a copy of context c.\n\nc.create_decimal(value)\n\nCreates a new Decimal object using cas the context.This may be useful in generating numbers whose precision and rounding behavior override that of the default context.\n\nFunctions and Constants The following functions and constants are defined by the decimal module.\n\ngetcontext()\n\nReturns the current decimal context. Each thread has its own decimal context so this returns the context of the calling thread.\n\nF h Lib f L Bdff\n\n248\n\nChapter 14 Mathematics\n\nlocalcontext([c])\n\nCreates a context manager that sets the current decimal context to a copy of cfor state- ments defined inside the body of a with statement. If cis omitted, a copy of the cur- rent context is created. Here is an example of using this function that temporarily sets the precision to five decimal places for a series of statements:\n\nwith localcontext() as c:\n\nc.prec = 5 statements\n\nsetcontext(c)\n\nSets the decimal context of the calling thread to c.\n\nBasicContext\n\nA premade context with nine digits of precision. Rounding is ROUND_HALF_UP; Emin is -999999999; Emax is 999999999; and all traps are enabled except for Inexact, Rounded, and Subnormal.\n\nDefaultContext\n\nThe default context used when creating new contexts (the values stored here are used as default values for the new context). Defines 28 digits of precision; ROUND_HALF_EVEN rounding; and traps for Overflow, InvalidOperation, and DivisionByZero.\n\nExtendedContext\n\nA premade context with nine digits of precision. Rounding is ROUND_HALF_EVEN, Emin is -999999999, Emax is 999999999, and all traps are disabled. Never raises exceptions. Instead, results may be set to NaN or Infinity.\n\nInf\n\nThe same as Decimal(\"Infinity\").\n\nnegInf\n\nThe same as Decimal(\"-Infinity\").\n\nNaN\n\nThe same as Decimal(\"NaN\").\n\nExamples Here are some more examples showing basic usage of decimal numbers:\n\n>>> a = Decimal(\"42.5\") >>> b = Decimal(\"37.1\") >>> a + b Decimal(\"79.6\") >>> a / b Decimal(\"1.145552560646900269541778976\") >>> divmod(a,b) (Decimal(\"1\"), Decimal(\"5.4\")) >>> max(a,b) Decimal(\"42.5\") >>> c = [Decimal(\"4.5\"), Decimal(\"3\"), Decimal(\"1.23e3\")] >>> sum(c) Decimal(\"1237.5\")\n\nF h Lib f L Bdff\n\ndecimal\n\n249\n\n>>> [10*x for x in c] [Decimal(\"45.0\"), Decimal(\"30\"), Decimal(\"1.230e4\")] >>> float(a) 42.5 >>> str(a) '42.5'\n\nHere’s an example of changing parameters in the context:\n\n>>> getcontext().prec = 4 >>> a = Decimal(\"3.4562384105\") >>> a Decimal(\"3.4562384105\") >>> b = Decimal(\"5.6273833\") >>> getcontext().flags[Rounded] 0 >>> a + b 9.084 >>> getcontext().flags[Rounded] 1 >>> a / Decimal(\"0\") Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in ?\n\ndecimal.DivisionByZero: x / 0 >>> getcontext().traps[DivisionByZero] = False >>> a / Decimal(\"0\") Decimal(\"Infinity\")\n\nNotes\n\nn The Decimal and Context objects have a large number of methods related to low-level details concerning the representation and behavior of decimal opera- tions.These have not been documented here because they are not essential for the basic use of this module. However, you should consult the online documenta- tion at http://docs.python.org/library/decimal.html for more information.\n\nn The decimal context is unique to each thread. Changes to the context only affect\n\nthat thread and not others.\n\nn A special number, Decimal(\"sNaN\"), may be used as a signaled-NaN.This num- ber is never generated by any of the built-in functions. However, if it appears in a computation, an error is always signaled.You can use this to indicate invalid com- putations that must result in an error and must not be silently ignored. For exam- ple, a function could return sNaN as a result.\n\nn The value of 0 may be positive or negative (that is, Decimal(0) and Decimal\n\n(\"-0\")).The distinct zeros still compare as equals.\n\nn This module is probably unsuitable for high-performance scientific computing due to the significant amount of overhead involved in calculations.Also, there is often little practical benefit in using decimal floating point over binary floating point in such applications.\n\nn A full mathematical discussion of floating-point representation and error analysis is beyond the scope of this book. Readers should consult a book on numerical analysis for further details.The article “What Every Computer Scientist Should\n\nF h Lib f L Bdff\n\n250\n\nChapter 14 Mathematics\n\nKnow About Floating-Point Arithmetic” by David Goldberg, in Computing Surveys,Association for Computing Machinery, March 1991 is also a worthy read (this article is easy to find on the Internet if you simply search for the title). n The IBM General Decimal Arithmetic Specification contains more information\n\nand can be easily located online through search engines.\n\nfractions The fractions module defines a class Fraction that represents a rational number. Instances can be created in three different ways using the class constructor:\n\nFraction([numerator [,denominator]])\n\nCreates a new rational number. numeratorand denominatorhave integral values and default to 0 and 1, respectively.\n\nFraction(fraction)\n\nIf fractionis an instance of numbers.Rational, creates a new rational number with the same value as fraction.\n\nFraction(s)\n\nIf sis a string containing a fraction such as \"3/7\" or \"-4/7\", a fraction with the same value is created. If sis a decimal number such as \"1.25\", a fraction with that value is created (e.g., Fraction(5,4)).\n\nThe following class methods can create Fraction instances from other types of\n\nobjects:\n\nFraction.from_float(f)\n\nCreates a fraction representing the exact value of the floating-point number f.\n\nFraction.from_decimal(d)\n\nCreates a fraction representing the exact value of the Decimal number d.\n\nHere are some examples of using these functions:\n\n>>> f = fractions.Fraction(3,4) >>> g = fractions.Fraction(\"1.75\") >>> g Fraction(7, 4) >>> h = fractions.Fraction.from_float(3.1415926) Fraction(3537118815677477, 1125899906842624) >>>\n\nAn instance fof Fraction supports all of the usual mathematical operations.The numerator and denominator are stored in the f.numerator and f.denominator attributes, respectively. In addition, the following method is defined:\n\nf.limit_denominator([max_denominator])\n\nReturns the fraction that has the closest value to f. max_denominator specifies the largest denominator to use and defaults to 1000000.\n\nF h Lib f L Bdff\n\nmath\n\n251\n\nHere are some examples of using Fraction instances (using the values created in\n\nthe earlier example):\n\n>>> f + g Fraction(5, 2) >>> f * g Fraction(21, 16) >>> h.limit_denominator(10) Fraction(22, 7) >>>\n\nThe fractions module also defines a single function:\n\ngcd(a, b)\n\nComputes the greatest common divisor of integers aand b.The result has the same sign as bif bis nonzero; otherwise, it’s the same sign as a.\n\nmath The math module defines the following standard mathematical functions.These func- tions operate on integers and floats but don’t work with complex numbers (a separate module cmath can be used to perform similar operations on complex numbers).The return value of all functions is a float.All trigonometric functions assume the use of radians.\n\nFunction acos(x)\n\nacosh(x)\n\nasin(x)\n\nasinh(x)\n\natan(x)\n\natan2(y, x)\n\natanh(x)\n\nceil(x)\n\ncopysign(x,y)\n\ncos(x)\n\ncosh(x)\n\ndegrees(x)\n\nradians(x)\n\nexp(x)\n\nfabs(x)\n\nfactorial(x)\n\nfloor(x)\n\nfmod(x, y)\n\nfrexp(x)\n\nfsum(s)\n\nDescription Returns the arc cosine of x. Returns the hyperbolic arc cosine of x. Returns the arc sine of x. Returns the hyperbolic arc sine of x. Returns the arc tangent of x. Returns atan(y / x). Returns the hyperbolic arc tangent of x. Returns the ceiling of x. Returns xwith the same sign as y. Returns the cosine of x. Returns the hyperbolic cosine of x. Converts xfrom radians to degrees. Converts xfrom degrees to radians. Returns e ** x. Returns the absolute value of x. Returns xfactorial. Returns the floor of x. Returns x % yas computed by the C fmod() function. Returns the positive mantissa and exponent of xas a tuple. Returns the full precision sum of floating-point values in the iter- able sequence s. See the following note for a description. Returns the Euclidean distance, sqrt(x * x + y * y).\n\nhypot(x, y)\n\ncontinues\n\nF h Lib f L Bdff\n\n252\n\nChapter 14 Mathematics\n\nFunction isinf(x)\n\nDescription Return True if xis infinity. Returns True if xis NaN. Returns x * (2 ** i).\n\nisnan(x)\n\nldexp(x, i) log(x [, base]) Returns the logarithm of xto the given base. If baseis omitted,\n\nlog10(x)\n\nlog1p(x)\n\nmodf(x)\n\npow(x, y)\n\nsin(x)\n\nsinh(x)\n\nsqrt(x)\n\ntan(x)\n\ntanh(x)\n\nthis function computes the natural logarithm. Returns the base 10 logarithm of x. Returns the natural logarithm of 1+x. Returns the fractional and integer parts of x as a tuple. Both have the same sign as x. Returns x ** y. Returns the sine of x. Returns the hyperbolic sine of x. Returns the square root of x. Returns the tangent of x. Returns the hyperbolic tangent of x. Truncates xto the nearest integer towards 0.\n\ntrunc(x)\n\nThe following constants are defined:\n\nConstant pi\n\ne\n\nDescription Mathematical constant pi Mathematical constant e\n\nNotes\n\nn The floating-point values +inf, -inf, and nan can be created by passing strings into the float() function—for example, float(\"inf\"), float(\"-inf\"), or float(\"nan\").\n\nn The math.fsum() function is more accurate than the built-in sum() function\n\nbecause it uses a different algorithm that tries to avoid floating-point errors intro- duced by cancellation effects. For example, consider the sequence s = [1, 1e100, -1e100]. If you use sum(s), you will get a result of 0.0 (because the value of 1 is lost when added to the large value 1e100). However, using math.sum(s) produces the correct result of 1.0.The algorithm used by math.sum() is described in “Adaptive Precision Floating-Point Arithmetic and Fast Robust Geometric Predicates” by Jonathan Richard Shewchuk, Carnegie Mellon University School of Computer Science Technical Report CMU-CS-96- 140, 1996.\n\nnumbers The numbers module defines a series of abstract base classes that serve to organize vari- ous kinds of numbers.The numeric classes are organized into a hierarchy in which each level progressively adds more capabilities.\n\nF h Lib f L Bdff\n\nnumbers\n\n253\n\nNumber\n\nA class that serves as the top of the numeric hierarchy.\n\nComplex\n\nA class that represents the complex numbers. Numbers of this type have real and imag attributes.This class inherits from Number.\n\nReal\n\nA class that represents the real numbers. Inherits from Complex.\n\nRational\n\nA class that represents fractions. Numbers of this type have numerator and denominator attributes. Inherits from Real.\n\nIntegral\n\nA class that represents the integers. Inherits from Rational.\n\nThe classes in this module are not meant to be instantiated. Instead, they can be used\n\nto perform various kinds of type checks on values. For example:\n\nif isinstance(x, numbers.Number) # x is any kind of number\n\nstatements\n\nif isinstance(x, numbers.Integral) # x is an integral value\n\nstatements\n\nIf one of these type checks returns True, it means that xis compatible with all of the usual mathematical operations associated with that type and that a conversion to one of the built-in types such as complex(), float(), or int() will work.\n\nThe abstract base classes can also be used as a base class for user-defined classes that are meant to emulate numbers. Doing this is not only just a good idea for type check- ing, but it adds extra safety checks that make sure you implement all of the required methods. For example:\n\n>>> class Foo(numbers.Real): pass ... >>> f = Foo() Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: Can't instantiate abstract class Foo with abstract methods\n\n__abs__, __add__, __div__, __eq__, __float__, __floordiv__, __le__, __lt__, __mod__, __mul__, __neg__, __pos__, __pow__, __radd__, __rdiv__, ➥__rfloordiv__, __rmod__, __rmul__, __rpow__, __rtruediv__, __truediv__, __trunc__\n\n>>>\n\nNotes\n\nn Refer to Chapter 7 (“Classes and Object-Oriented Programming”) for more\n\ninformation on abstract base classes.\n\nn PEP 3141 (http://www.python.org/dev/peps/pep-3141) has more information\n\nabout the type hierarchy and intended use of this module.\n\nF h Lib f L Bdff\n\n254\n\nChapter 14 Mathematics\n\nrandom The random module provides a variety of functions for generating pseudo-random numbers as well as functions for randomly generating values according to various distri- butions on the real numbers. Most of the functions in this module depend on the func- tion random(), which generates uniformly distributed numbers in the range [0.0, 1.0) using the Mersenne Twister generator.\n\nSeeding and Initialization The following functions are used to control the state of the underlying random number generator:\n\nseed([x])\n\nInitializes the random number generator. If xis omitted or None, the system time is used to seed the generator. Otherwise, if xis an integer or long integer, its value is used. If xis not an integer, it must be a hashable object and the value of hash(x) is used as a seed.\n\ngetstate()\n\nReturns an object representing the current state of the generator.This object can later be passed to setstate() to restore the state.\n\nsetstate(state)\n\nRestores the state of the random number generator from an object returned by getstate().\n\njumpahead(n)\n\nQuickly changes the state of the generator to what it would be if random() were called ntimes in a row. nmust be a nonnegative integer.\n\nRandom Integers The following functions are used to manipulate random integers.\n\ngetrandbits(k)\n\nCreates a long integer containing krandom bits.\n\nrandint(a,b)\n\nReturns a random integer, x, in the range a <= x <= b.\n\nrandrange(start,stop [,step])\n\nReturns a random integer in range(start,stop,step). Does not include the end- point.\n\nRandom Sequences The following functions are used to randomize sequence data.\n\nchoice(seq)\n\nReturns a random element from the nonempty sequence seq.\n\nF h Lib f L Bdff\n\nrandom\n\n255\n\nsample(s, len)\n\nReturns a sequence length, len, containing elements chosen randomly from the sequence s.The elements in the resulting sequence are placed in the order in which they were selected.\n\nshuffle(x [,random])\n\nRandomly shuffles the items in the list xin place. randomis an optional argument that specifies a random generation function. If supplied, it must be a function that takes no arguments and returns a floating-point number in the range [0.0, 1.0).\n\nReal-Valued Random Distributions The following functions generate random numbers on real numbers. Distribution and parameter names correspond to the standard names used in probability and statistics.You will need to consult an appropriate text to find out more details.\n\nrandom()\n\nReturns a random number in the range [0.0, 1.0).\n\nuniform(a,b)\n\nReturns a uniformly distributed random number in the range [a, b).\n\nbetavariate(alpha, beta)\n\nReturns a value between 0 and 1 from the Beta distribution. alpha > -1 and beta > -1.\n\ncunifvariate(mean, arc)\n\nCircular uniform distribution. meanis the mean angle, and arcis the range of the dis- tribution, centered around the mean angle. Both of these values must be specified in radians in the range between 0 and pi. Returned values are in the range (mean - arc/2, mean + arc/2).\n\nexpovariate(lambd)\n\nExponential distribution. lambdis 1.0 divided by the desired mean. Returns values in the range [0, +Infinity).\n\ngammavariate(alpha, beta)\n\nGamma distribution. alpha > -1, beta > 0.\n\ngauss(mu, sigma)\n\nGaussian distribution with mean muand standard deviation sigma. Slightly faster than normalvariate().\n\nlognormvariate(mu, sigma)\n\nLog normal distribution.Taking the natural logarithm of this distribution results in a normal distribution with mean muand standard deviation sigma.\n\nnormalvariate(mu, sigma)\n\nNormal distribution with mean muand standard deviation sigma.\n\nF h Lib f L Bdff",
      "page_number": 257
    },
    {
      "number": 14,
      "title": "Segment 14 (pages 280-301)",
      "start_page": 280,
      "end_page": 301,
      "detection_method": "synthetic",
      "content": "256\n\nChapter 14 Mathematics\n\nparetovariate(alpha)\n\nPareto distribution with shape parameter alpha.\n\ntriangular([low [, high [, mode]]])\n\nTriangular distribution.A random number nin the range low <= n < highwith mode mode. By default, lowis 0, highis 1.0, and modeis set to the midpoint of low and high.\n\nvonmisesvariate(mu, kappa)\n\nvon Mises distribution, where muis the mean angle in radians between 0 and 2 * pi and kappais a nonnegative concentration factor. If kappais zero, the distribution reduces to a uniform random angle over the range 0 to 2 * pi.\n\nweibullvariate(alpha, beta)\n\nWeibull distribution with scale parameter alphaand shape parameter beta.\n\nNotes\n\nn The functions in this module are not thread-safe. If you are generating random numbers in different threads, you should use locking to prevent concurrent access.\n\nn The period of the random number generator (before numbers start repeating) is\n\n2**19937–1.\n\nn The random numbers generated by this module are deterministic and should not\n\nbe used for cryptography.\n\nn New types of random number generators can be created by subclassing\n\nrandom.Random and implementing the random(), seed(), getstate(), getstate(), and jumpahead() methods.All the other functions in this module are actually internally implemented as methods of Random.Thus, they could be accessed as methods of an instance of the new random number generator. n The module provides two alternative random number generators classes—\n\nWichmannHill and SystemRandom—that are used by instantiating the appropri- ate class and calling the preceding functions as methods.The WichmannHill class implements the Wichmann-Hill generator that was used in earlier Python releas- es.The SystemRandom class generates random numbers using the system random number generator os.urandom().\n\nF h Lib f L Bdff\n\n15\n\nData Structures, Algorithms, and Code Simplification\n\nThe modules in this chapter are used to address common programming problems\n\nrelated to data structures; algorithms; and the simplification of code involving iteration, function programming, context managers, and classes.These modules should be viewed as a extension of Python’s built-in types and functions. In many cases, the underlying implementation is highly efficient and may be better suited to certain kinds of problems than what is available with the built-ins.\n\nabc The abc module defines a metaclass and a pair of decorators for defining new abstract base classes.\n\nABCMeta\n\nA metaclass that represents an abstract base class.To define an abstract class, you define a class that uses ABCMeta as a metaclass. For example:\n\nimport abc class Stackable: # In Python 3, use the syntax\n\n__metaclass__ = abc.ABCMeta # class Stackable(metaclass=abc.ABCMETA) ...\n\nA class created in this manner differs from an ordinary class in a few critical ways:\n\nn First, if the abstract class defines methods or properties that are decorated with the abstractmethod and abstractproperty decorators described later, then instances of derived classes can’t be created unless those classes provide a non- abstract implementation of those methods and properties.\n\nn Second, an abstract class has a class method register(subclass) that can be\n\nused to register additional types as a logical subclass. For any type subclassreg- istered with this function, the operation isinstance(x, AbstractClass) will return True if xis an instance of subclass.\n\nn A final feature of abstract classes is that they can optionally define a special class method _ _subclasshook_ _(cls, subclass).This method should return True if the type subclassis considered to be a subclass, return False if subclassis not a subclass, or raise a NotImplemented exception if nothing is known.\n\nF h Lib f L Bdff\n\n258\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nabstractmethod(method)\n\nA decorator that declares methodto be abstract.When used in an abstract base class, derived classes defined directly via inheritance can only be instantiated if they define a nonabstract implementation of the method.This decorator has no effect on subclasses registered using the register() method of an abstract base.\n\nabstractproperty(fget [, fset [, fdel [, doc]]])\n\nCreates an abstract property.The parameters are the same as the normal property() function.When used in an abstract base, derived classes defined directly via inheritance can only be instantiated if they define a nonabstract implementation of the property.\n\nThe following code provides an example of defining a simple abstract class:\n\nfrom abc import ABCMeta, abstractmethod, abstractproperty class Stackable: # In Python 3, use the syntax\n\n__metaclass__ = ABCMeta # class Stackable(metaclass=ABCMeta) @abstractmethod def push(self,item):\n\npass\n\n@abstractmethod def pop(self):\n\npass\n\n@abstractproperty def size(self):\n\npass\n\nHere is an example of a class that derives from Stackable:\n\nclass Stack(Stackable): def __init__(self): self.items = []\n\ndef push(self,item):\n\nself.items.append(item)\n\ndef pop(self):\n\nreturn self.items.pop()\n\nHere is the error message that you get if you try to create a Stack:\n\n>>> s = Stack() Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: Can't instantiate abstract class Stack with abstract methods size >>>\n\nThis error can be fixed by adding a size() property to Stack.You can either do this by modifying the definition of Stack itself or inheriting from it and adding the required method or property:\n\nclass CompleteStack(Stack):\n\n@property def size(self):\n\nreturn len(self.items)\n\nHere is an example of using the complete stack object:\n\n>>> s = CompleteStack() >>> s.push(\"foo\") >>> s.size 1 >>>\n\nF h Lib f L Bdff\n\narray\n\n259\n\nSee Also:\n\nChapter 7, “Classes and Object-Oriented Programming,” numbers (p. 252), collections (p. 262).\n\narray The array module defines a new object type, array, that works almost exactly like a list, except that its contents are constrained to a single type.The type of an array is determined at the time of creation, using one of the type codes shown in Table 15.1.\n\nTable 15.1 Type Codes\n\nType Code\n\nDescription\n\nC Type\n\nMinimum Size (in Bytes)\n\n'c'\n\n'b'\n\n'B'\n\n'u'\n\n'h'\n\n'H'\n\n'i'\n\n'I'\n\n'l'\n\n'L'\n\n'f'\n\n8-bit character 8-bit integer 8-bit unsigned integer Unicode character 16-bit integer 16-bit unsigned integer Integer Unsigned integer Long integer Unsigned long integer Single-precision float Double-precision float\n\nchar\n\nsigned char\n\nunsigned char\n\nPY_UNICODE\n\nshort\n\nunsigned short\n\nint\n\nunsigned int\n\nlong\n\nunsigned long\n\nfloat\n\n1 1 1 2 or 4 2 2 4 or 8 4 or 8 4 or 8 4 or 8 4 8\n\n'd'\n\ndouble\n\nThe representation of integers and long integers is determined by the machine architec- ture (they may be 32 or 64 bits).When values stored as 'L' or 'I' are returned, they’re returned as long integers in Python 2.\n\nThe module defines the following type:\n\narray(typecode [, initializer])\n\nCreates an array of type typecode. initializeris a string or list of values used to initialize values in the array.The following attributes and methods apply to an array object, a:\n\nItem a.typecode\n\nDescription Type code character used to create the array. Size of items stored in the array (in bytes). Appends xto the end of the array.\n\na.itemsize\n\na.append(x) a.buffer_info() Returns (address, length), giving the memory location and length of the buffer used to store the array. Swaps the byte ordering of all items in the array from big-endian to little-endian, or vice versa. This is only supported for integer values.\n\na.byteswap()\n\ncontinues\n\nF h Lib f L Bdff\n\n260\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nItem a.count(x)\n\na.extend(b)\n\nDescription Returns the number of occurrences of xin a. Appends bto the end of array a. bcan be an array or an iterable object whose elements are the same type as in a.\n\na.fromfile(f, n) Reads nitems (in binary format) from the file object fand\n\nappends to the end of the array. fmust be a file object. Raises EOFError if fewer than nitems can be read.\n\na.fromlist(list) Appends items from listto the end of the array. listcan be\n\nany iterable object.\n\na.fromstring(s) Appends items from string s, where sis interpreted as a string\n\na.index(x)\n\na.insert(i, x)\n\na.pop([i])\n\na.remove(x)\n\na.reverse()\n\na.tofile(f)\n\na.tolist()\n\na.tostring()\n\na.tounicode()\n\nof binary values—same as would have been read using fromfile(). Returns the index of the first occurrence of xin a. Raises ValueError if not found. Inserts xbefore position i. Removes item ifrom the array and returns it. If iis omitted, the last element is removed. Removes the first occurrence of xfrom the array. Raises ValueError if not found. Reverses the order of the array. Writes all items to file f. Data is saved in native binary format. Converts the array to an ordinary list of values. Converts to a string of binary data—the same data as would be written using tofile(). Converts the array to a Unicode string. Raises ValueError if the array is not of type 'u'.\n\nWhen items are inserted into an array, a TypeError exception is generated if the type of the item doesn’t match the type used to create the array.\n\nThe array module is useful if you need to have space-efficient storage for lists of data and you know that all items in the list are going to be the same type. For example, storing 10 million integers in a list requires about 160MB of memory whereas an array of 10 million integers requires only 40MB. Despite this space savings, none of the basic operations on an array tend to be faster than their list counterparts—in fact, they may be slower.\n\nIn performing calculations with arrays, you will want to be careful with operations that create lists. For example, using a list comprehension on an array will convert the entire array into a list, defeating any space-saving benefit.A better way to handle this is to create new arrays using generator expressions. For example:\n\na = array.array(\"i\", [1,2,3,4,5]) b = array.array(a.typecode, (2*x for x in a)) # Create a new array from b\n\nBecause the point of using an array is to save space, it may be more desirable to perform “in-place” operations.An efficient way to do this is with code that uses enumerate(), like this:\n\na = array.array(\"i\", [1,2,3,4,5]) for i, x in enumerate(a):\n\na[i] = 2*x\n\nF h Lib f L Bdff\n\nbisect\n\n261\n\nFor large arrays, this in-place modification runs about 15 percent faster than the code that creates a new array with a generator expression.\n\nNotes\n\nn The arrays created by this module are not suitable for numeric work such as\n\nmatrix or vector math. For example, the addition operator doesn’t add the corre- sponding elements of the arrays; instead, it appends one array to the other.To cre- ate storage and calculation efficient arrays, use the numpy extension available at http://numpy.sourceforge.net/. Note that the numpy API is completely different.\n\nn The += operator can be used to append the contents of another array.The *=\n\noperator can be used to repeat an array.\n\nSee Also:\n\nstruct (p. 290)\n\nbisect The bisect module provides support for keeping lists in sorted order. It uses a bisec- tion algorithm to do most of its work.\n\nbisect(list, item [, low [, high]])\n\nReturns the index of the insertion point for itemto be placed in listin order to maintain listin sorted order. lowand highare indices specifying a subset of the list to examine. If itemsis already in the list, the insertion point will always be to the right of existing entries in the list.\n\nbisect_left(list, item [, low [, high]])\n\nReturns the index of the insertion point for itemto be placed in listin order to maintain listin sorted order. lowand highare indices specifying a subset of the list to examine. If itemsis already in the list, the insertion point will always be to the left of existing entries in the list.\n\nbisect_right(list, item [, low [, high]])\n\nThe same as bisect().\n\ninsort(list, item [, low [, high]])\n\nInserts iteminto listin sorted order. If itemis already in the list, the new entry is inserted to the right of any existing entries.\n\ninsort_left(list, item [, low [, high]])\n\nInserts iteminto listin sorted order. If itemis already in the list, the new entry is inserted to the left of any existing entries.\n\ninsort_right(list, item [, low [, high]])\n\nThe same as insort().\n\nF h Lib f L Bdff\n\n262\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\ncollections The collections module contains high-performance implementations of a few useful container types, abstract base classes for various kinds of containers, and a utility func- tion for creating name-tuple objects. Each is described in the sections that follow.\n\ndeque and defaultdict Two new containers are defined in the collections module: deque and defaultdict.\n\ndeque([iterable [, maxlen]])\n\nType representing a double-ended queue (deque, pronounced “deck”) object. iterable is an iterable object used to populate the deque.A deque allows items to be inserted or removed from either end of the queue.The implementation has been optimized so that the performance of these operations is approximately the same as (O(1)).This is slightly different from a list where operations at the front of the list may require shifting of all the elements that follow. If the optional maxlenargument is supplied, the resulting deque object becomes a circular buffer of that size.That is, if new items are added, but there is no more space, items are deleted from the opposite end to make room.\n\nAn instance, d, of deque has the following methods:\n\nd.append(x)\n\nAdds xto the right side of d.\n\nd.appendleft(x)\n\nAdds xto the left side of d.\n\nd.clear()\n\nRemoves all items from d.\n\nd.extend(iterable)\n\nExtends dby adding all the items in iterableon the right.\n\nd.extendleft(iterable)\n\nExtends dby adding all the items in iterableon the left. Due to the sequence of left appends that occur, items in iterablewill appear in reverse order in d.\n\nd.pop()\n\nReturns and removes an item from the right side of d. Raises IndexError if dis empty.\n\nd.popleft()\n\nReturns and removes an item from the left side of d. Raises IndexError if dis empty.\n\nd.remove(item)\n\nRemoves the first occurrence of item. Raises ValueError if no match is found.\n\nF h Lib f L Bdff\n\ncollections\n\n263\n\nd.rotate(n)\n\nRotates all the items nsteps to the right. If nis negative, items are rotated to the left. Deques are often overlooked by many Python programmers. However, this type offers many advantages. First, the implementation is highly efficient—even to a level of using internal data structures that provide good processor cache behavior.Appending items at the end is only slightly slower than the built-in list type, whereas inserting items at the front is significantly faster. Operations that add new items to a deque are also thread-safe, making this type appropriate for implementing queues. deques can also be serialized using the pickle module.\n\ndefaultdict([default_factory], ...)\n\nA type that is exactly the same as a dictionary except for the handling of missing keys. When a lookup occurs on a key that does not yet exist, the function supplied as default_factory is called to provide a default value which is then saved as the value of the associated key.The remaining arguments to defaultdict are exactly the same as the built-in dict() function.An instance dof defaultdictionary has the same operations as a built-in dictionary.The attribute d.default_factory contains the function passed as the first argument and can be modified as necessary.\n\nA defaultdict object is useful if you are trying to use a dictionary as a container\n\nfor tracking data. For example, suppose you wanted to keep track of the position of each word in a string s. Here is how you could use a defaultdict to do this easily:\n\n>>> from collections import defaultdict >>> s = \"yeah but no but yeah but no but yeah\" >>> words = s.split() >>> wordlocations = defaultdict(list) >>> for n, w in enumerate(words): ... ... >>> wordlocations defaultdict(<type 'list'>, {'yeah': [0, 4, 8], 'but': [1, 3, 5, 7], 'no': [2, 6]}) >>>\n\nwordlocations[w].append(n)\n\nIn this example, the lookup wordlocations[w] will “fail” the first time a word is encountered. However, instead of raising a KeyError, the function list supplied as default_factory is called to create a new value. Built-in dictionaries have a method setdefault() that can be used to achieve a similar result, but it often makes code confusing to read and run slower. For example, the statement that appends a new item shown previously could be replaced by wordlocations.setdefault(w,[]).append(n).This is not nearly as clear and in a simple timing test, it runs nearly twice as slow as using a defaultdict object.\n\nNamed Tuples Tuples are frequently used to represent simple data structures. For example, a network address might be represented as a tuple addr = (hostname, port).A common com- plaint with tuples is that the individual items have to be accessed by numerical index— for example, addr[0] or addr[1].This leads to code that is confusing to read and hard to maintain unless you can remember what all of the index values mean (and the prob- lem gets worse the larger the tuple gets).\n\nF h Lib f L Bdff\n\n264\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nThe collections module contains a function namedtuple() that is used to create\n\nsubclasses of tuple in which attribute names can be used to access tuple elements.\n\nnamedtuple(typename, fieldnames [, verbose])\n\nCreates a subclass of tuple with name typename. fieldnamesis a list of attribute names specified as strings.The names in this list must be valid Python identifiers, must not start with an underscore, and are specified in the same order as the items appearing in the tuple—for example, ['hostname','port']. Alternatively, fieldnamescan be specified as a string such as 'hostname port' or 'hostname, port'.The value returned by this function is a class whose name has been set to the value supplied in typename.You use this class to create instances of named tuples.The verboseflag, if set to True, prints the resulting class definition to standard output.\n\nHere is an example of using this function:\n\n>>> from collections import namedtuple >>> NetworkAddress = namedtuple('NetworkAddress',['hostname','port']) >>> a = NetworkAddress('www.python.org',80) >>> a.hostname 'www.python.org' >>> a.port 80 >>> host, port = a >>> len(a) 2 >>> type(a) <class '__main__.NetworkAddress'> >>> isinstance(a, tuple) True >>>\n\nIn this example, the named tuple NetworkAddress is, in every way, indistinguished from a normal tuple except for the added support of being able to use attribute lookup such as a.hostname or a.port to access tuple components.The underlying implementation is efficient—the class that is created does not use an instance dictionary or add any additional memory overhead in a built-in tuple.All of the normal tuple operations still work.\n\nA named tuple can be useful if defining objects that really only serve as a data struc-\n\ntures. For example, instead of a defining a class, like this:\n\nclass Stock(object):\n\ndef __init__(self,name,shares,price):\n\nself.name = name self.shares = shares self.price = price\n\nyou could define a named tuple instead:\n\nimport collections Stock = collections.namedtuple('Stock','name shares price')\n\nBoth versions are going to work in a nearly identical manner. For example, in either case, you would access fields by writing s.name, s.shares, and so on. However, the benefit of the named tuple is that it is more memory-efficient and supports various tuple operations such as unpacking (for example, if you had a list of named tuples, you could unpack values in a for-loop with a statement such as for name, shares,\n\nF h Lib f L Bdff\n\ncollections\n\n265\n\nprice in stockList).The downside to a named tuple is that attribute access is not as efficient as with a class. For example, accessing s.shares is more than twice as slow if s is an instance of a named tuple instead of an ordinary class.\n\nNamed tuples are frequently used in other parts of the Python standard library. Here, their use is partly historical—in many library modules, tuples were originally used as the return value of various functions that would return information about files, stack frames, or other low-level details. Code that used these tuples wasn’t always so elegant. Thus, the switch to a named tuple was made to clean up their usage without breaking backwards compatibility.Another subtle problem with tuples is that once you start using a tuple, the expected number of fields is locked forever (e.g., if you suddenly add a new field, old code will break).Variants of named tuples have been used in the library to add new fields to the data returned by certain functions. For example, an object might sup- port a legacy tuple interface, but then provide additional values that are only available as named attributes.\n\nAbstract Base Classes The collections module defines a series of abstract base classes.The purpose of these classes is to describe programming interfaces on various kinds of containers such as lists, sets, and dictionaries.There are two primary uses of these classes. First, they can be used as a base class for user-defined objects that want to emulate the functionality of built-in container types. Second, they can be used for type checking. For example, if you wanted to check that sworked like a sequence, you could use isinstance(s, collections.Sequence).\n\nContainer\n\nBase class for all containers. Defines a single abstract method __contains_ _(), which implements the in operator.\n\nHashable\n\nBase class for objects that can be used as a hash table key. Defines a single abstract method _ _hash_ _().\n\nIterable\n\nBase class for objects that support the iteration protocol. Defines a single abstract method _ _iter_ _().\n\nIterator\n\nBase class for iterator objects. Defines the abstract method next() but also inherits from Iterable and provides a default implementation of _ _iter_ _() that simply does nothing.\n\nSized\n\nBase class for containers whose size can be determined. Defines the abstract method _ _len_ _().\n\nCallable\n\nBase class for objects that support function call. Defines the abstract method _ _call_ _().\n\nF h Lib f L Bdff\n\n266\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nSequence\n\nBase class for objects that look like sequences. Inherits from Container, Iterable, and Sized and defines the abstract methods _ _getitem_ _() and _ _len_ _().Also provides a default implementation of _ _contains_ _(), _ _iter_ _(), _ _reversed_ _(), index(), and count() that are implemented using nothing but the _ _getitem_ _() and _ _len_ _() methods.\n\nMutableSequence\n\nBase class for mutable sequences. Inherits from Sequence and adds the abstract methods _ _setitem_ _() and _ _delitem_ _().Also provides a default implementation of append(), reverse(), extend(), pop(), remove(), and _ _iadd_ _().\n\nSet\n\nBase class for objects that work like sets. Inherits from Container, Iterable, and Sized and defines the abstract methods _ _len_ _(), _ _iter_ _(), and _ _contains_ _().Also provides a default implementation of the set operators _ _le_ _(), _ _lt_ _(), _ _eq_ _(), _ _ne_ _(), _ _gt_ _(), _ _ge_ _(), _ _and_ _(), _ _or_ _(), _ _xor_ _(), _ _sub_ _(), and isdisjoint().\n\nMutableSet\n\nBase class for mutable sets. Inherits from Set and adds the abstract methods add() and discard().Also provides a default implementation of clear(), pop(), remove(), _ _ior_ _(), _ _iand_ _(), _ _ixor_ _(), and _ _isub_ _().\n\nMapping\n\nBase class for objects that support mapping (dictionary) lookup. Inherits from Sized, Iterable, and Container and defines the abstract methods _ _getitem_ _(), _ _len_ _(), and _ _iter_ _().A default implementation of _ _contains_ _(), keys(), items(), values(), get(), _ _eq_ _(), and _ _ne_ _() is also provided.\n\nMutableMapping\n\nBase class for mutable mapping objects. Inherits from Mapping and adds the abstract methods _ _setitem_ _() and _ _delitem_ _().An implementation of pop(), popitem(), clear(), update(), and setdefault() is also added.\n\nMappingView\n\nBase class for mapping views.A mapping view is an object that is used for accessing the internals of a mapping object as a set. For example, a key view is a set-like object that shows the keys in a mapping. See Appendix A,“Python 3” for more details.\n\nKeysView\n\nBase class for a key view of a mapping. Inherits from MappingView and Set.\n\nItemsView\n\nBase class for item view of a mapping. Inherits from MappingView and Set.\n\nValuesView\n\nBase class for a (key, item) view of a mapping. Inherits from MappingView and Set.\n\nF h Lib f L Bdff\n\ncontextlib\n\n267\n\nPython’s built-in types are already registered with all of these base classes as appro-\n\npriate.Also, by using these base classes, it is possible to write programs that are more precise in their type checking. Here are some examples:\n\n# Pull off the last item of a sequence if isinstance(x, collections.Sequence):\n\nlast = x[-1]\n\n# Only iterate over an object if its size is known if isinstance(x, collections.Iterable) and isinstance(x, collections.Sized):\n\nfor item in x: statements\n\n# Add a new item to a set if isinstance(x, collections.MutableSet):\n\nx.add(item)\n\nSee Also:\n\nChapter 7, “Classes and Object-Oriented Programming.”\n\ncontextlib The contextlib module provides a decorator and utility functions for creating context managers used in conjunction with the with statement.\n\ncontextmanager(func)\n\nA decorator that creates a context manager from a generator function func.The way in which you use this decorator is as follows:\n\n@contextmanager def foo(args): statements try:\n\nyield value\n\nexcept Exception as e:\n\nerror handling (if any)\n\nstatements\n\nWhen the statement with foo(args) as valueappears, the generator function is executed with the supplied arguments until the first yield statement is reached.The value returned by yield is placed into the variable value.At this point, the body of the with statement executes. Upon completion, the generator function resumes. If any kind of exception is raised inside the with-body, that exception is raised inside the gen- erator function where it can be handled as appropriate. If the error is to be propagated, the generator should use raise to re-raise the exception.An example of using this deco- rator can be found in the “Context Managers” section of Chapter 5.\n\nnested(mgr1, mgr2, ..., mgrN)\n\nA function that invokes more than one context manager mgr1, mgr2, and so on as a sin- gle operation. Returns a tuple containing the different return values of the with state- ments.The statement with nested(m1,m2) as (x,y): statementsis the same as\n\nF h Lib f L Bdff\n\n268\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nsaying with m1 as x: with m2 as y: statements. Be aware that if an inner con- text manager traps and suppresses an exception, no exception information is passed along to the outer managers.\n\nclosing(object)\n\nCreates a context manager that automatically executes object.close() when execu- tion leaves the body of the with statement.The value returned by the with statement is the same as object.\n\nfunctools The functools module contains functions and decorators that are useful for creating higher-order functions, functional programming, and decorators.\n\npartial(function [, *args [, **kwargs]])\n\nCreates a function-like object, partial, that when called, calls functionwith posi- tional arguments args, keyword arguments kwargs, and any additional positional or keyword arguments that are supplied.Additional positional arguments are added to the end of args, and additional keyword arguments are merged into kwargs, overwriting any previously defined values (if any).A typical use of partial() is when making a large number of function calls where many of the arguments are held fixed. For example:\n\nfrom functools import partial mybutton = partial(Button, root, fg=\"black\",bg=\"white\",font=\"times\",size=\"12\") b1 = mybutton(text=\"Ok\") # Calls Button() with text=\"Ok\" and all of the b2 = mybutton(text=\"Cancel\") # additional arguments supplied to partial() above b3 = mybutton(text=\"Restart\")\n\nAn instance pof the object created by partialhas the following attributes:\n\nItem p.func\n\np.args\n\np.keywords\n\nDescription Function that is called when pis called. Tuple containing the leftmost positional arguments supplied to p.func when called. Additional positional arguments are con- catenated to the end of this value. Dictionary containing the keyword arguments supplied to p.func when called. Additional keyword arguments are merged into this dictionary.\n\nUse caution when using a partial object as a stand-in for a regular function.The result is not exactly the same as a normal function. For instance, if you use partial() inside a class definition, it behaves like a static method, not an instance method.\n\nreduce(function, items [, initial])\n\nApplies a function, function, cumulatively to the items in the iterable itemsand returns a single value. functionmust take two arguments and is first applied to the first two items of items.This result and subsequent elements of itemsare then combined one at a time in a similar manner, until all elements of itemshave been consumed. initialis an optional starting value used in the first computation and when itemsis\n\nF h Lib f L Bdff\n\nheapq\n\n269\n\nempty.This function is the same as the reduce() function that was a built-in in Python 2. For future compatibility, use this version instead.\n\nupdate_wrapper(wrapper, wrapped [, assigned [, updated]])\n\nThis is a utility function that is useful when writing decorators. Copies attributes from a function wrappedto a wrapper function wrapperin order to make the wrapped func- tion look like the original function. assignedis a tuple of attribute names to copy and is set to ('_ _name_ _','_ _module_ _','_ _doc_ _') by default. updatedis a tuple containing the names of function attributes that are dictionaries and which you want values merged in the wrapper. By default, it is a tuple ('_ _dict_ _',).\n\nwraps(function [, assigned [, updated ]])\n\nA decorator carries out the same task as update_wrapper() on the function to which it is applied. assignedand updatedhave the same meaning.A typical use of this deco- rator is when writing other decorators. For example:\n\nfrom functools import wraps def debug(func): @wraps(func) def wrapped(*args,**kwargs):\n\nprint(\"Calling %s\" % func.__name__) r = func(*args,**kwargs) print(\"Done calling %s\" % func.__name__)\n\nreturn wrapped\n\n@debug def add(x,y):\n\nreturn x+y\n\nSee Also:\n\nChapter 6, “Functions and Functional Programming.”\n\nheapq The heapq module implements a priority queue using a heap. Heaps are simply lists of ordered items in which the heap condition has been imposed. Specifically, heap[n] <= heap[2*n+1] and heap[n] <= heap[2*n+2] for all n, starting with n = 0. heap[0] always contains the smallest item.\n\nheapify(x)\n\nConverts a list, x, into a heap, in place.\n\nheappop(heap)\n\nReturns and removes the smallest item from heap, preserving the heap condition. Raises IndexError if heapis empty.\n\nheappush(heap, item)\n\nAdds itemto the heap, preserving the heap condition.\n\nF h Lib f L Bdff\n\n270\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nheappushpop(heap, item)\n\nAdds itemto the heap and removes the smallest item from heapin a single operation. This is more efficient than calling heappush() and heappop() separately.\n\nheapreplace(heap, item)\n\nReturns and removes the smallest itemfrom the heap.At the same time, a new itemis added.The heap condition is preserved in the process.This function is more efficient than calling heappop() and heappush() in sequence. In addition, the returned value is obtained prior to adding the new item.Therefore, the return value could be larger than item. Raises IndexError if heapis empty.\n\nmerge(s1, s2, ...)\n\nCreates an iterator that merges the sorted iterables s1, s2, and so on into a single sorted sequence.This function does not consume the inputs but returns an iterator that incre- mentally processes the data.\n\nnlargest(n, iterable [, key])\n\nCreates a list consisting of the nlargest items in iterable.The largest item appears first in the returned list. keyis an optional function that takes a single input parameter and computes the comparison key for each item in iterable.\n\nnsmallest(n, iterable [, key])\n\nCreates a list consisting of the nsmallest items in iterable.The smallest item appears first in the returned list. keyis an optional key function.\n\nNote\n\nThe theory and implementation of heap queues can be found in most books on algo- rithms.\n\nitertools The itertools module contains functions for creating efficient iterators, useful for looping over data in various ways.All the functions in this module return iterators that can be used with the for statement and other functions involving iterators such as gen- erators and generator expressions.\n\nchain(iter1, iter2, ..., iterN)\n\nGiven a group of iterators (iter1, … , iterN), this function creates a new iterator that chains all the iterators together.The returned iterator produces items from iter1until it is exhausted.Then items from iter2are produced.This continues until all the items in iterNare exhausted.\n\nchain.from_iterable(iterables)\n\nAn alternative constructor for a chain where the iterablesis an iterable that produces a sequence of iterable objects.The result of this operation is the same as what would be produced by the following fragment of generator code:\n\nF h Lib f L Bdff\n\nitertools\n\n271\n\nfor it in iterables: for x in it:\n\nyield x\n\ncombinations(iterable, r)\n\nCreates an iterator that returns all r-length subsequences of items taken from iterable.The items in the returned subsequences are ordered in the same way in which they were ordered in the input iterable. For example, if iterableis the list [1,2,3,4], the sequence produced by combinations([1,2,3,4], 2) is [1,2], [1,3], [1,4], [2,3], [3,4].\n\ncount([n])\n\nCreates an iterator that produces consecutive integers starting with n. If nis omitted, counting starts at 0. (Note that this iterator does not support long integers. If sys.maxintis exceeded, the counter overflows and continues to count starting with -sys.maxint - 1.)\n\ncycle(iterable)\n\nCreates an iterator that cycles over the elements in iterableover and over again. Internally, a copy of the elements in iterableis made.This copy is used to return the repeated items in the cycle.\n\ndropwhile(predicate, iterable)\n\nCreates an iterator that discards items from iterableas long as the function predicate(item) is True. Once predicatereturns False, that item and all subse- quent items in iterableare produced.\n\ngroupby(iterable [, key])\n\nCreates an iterator that groups consecutive items produced by iterable.The grouping process works by looking for duplicate items. For instance, if iterableproduces the same item on several consecutive iterations, that defines a group. If this is applied to a sorted list, the groups would define all the unique items in the list. key, if supplied, is a function that is applied to each item. If present, the return value of this function is used to compare successive items instead of the items themselves.The iterator returned by this function produces tuples (key, group), where keyis the key value for the group and groupis an iterator that yields all the items that made up the group.\n\nifilter(predicate, iterable)\n\nCreates an iterator that only produces items from iterablefor which predicate(item) is True. If predicateis None, all the items in iterablethat evalu- ate as True are returned.\n\nifilterfalse(predicate, iterable)\n\nCreates an iterator that only produces items from iterablefor which predicate(item) is False. If predicateis None, all the items in iterablethat eval- uate as False are returned.\n\nF h Lib f L Bdff\n\n272\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nimap(function, iter1, iter2, ..., iterN)\n\nCreates an iterator that produces items function(i1,i2, .. iN), where i1, i2, …, iNare items taken from the iterators iter1, iter2, …, iterN, respectively. If function is None, the tuples of the form (i1, i2, ..., iN) are returned. Iteration stops whenever one of the supplied iterators no longer produces any values.\n\nislice(iterable, [start,] stop [, step])\n\nCreates an iterator that produces items in a manner similar to what would be returned by a slice, iterable[start:stop:step].The first startitems are skipped and itera- tion stops at the position specified in stop. stepspecifies a stride that’s used to skip items. Unlike slices, negative values may not be used for any of start, stop, or step. If startis omitted, iteration starts at 0. If stepis omitted, a step of 1 is used.\n\nizip(iter1, iter2, ... iterN)\n\nCreates an iterator that produces tuples (i1, i2, ..., iN), where i1, i2, …, iNare taken from the iterators iter1, iter2, …, iterN, respectively. Iteration stops whenever one of the supplied iterators no longer produces any values.This function produces the same values as the built-in zip() function.\n\nizip_longest(iter1, iter2, ..., iterN [,fillvalue=None])\n\nThe same as izip() except that iteration continues until all of the input iterables iter1, iter2, and so on are exhausted. None is used to fill in values for the iterables that are already consumed unless a different value is specified with the fillvalue key- word argument.\n\npermutations(iterable [, r])\n\nCreates an iterator that returns all r-length permutations of items from iterable. If r is omitted, then permutations have the same length as the number of items in iterable.\n\nproduct(iter1, iter2, ... iterN, [repeat=1])\n\nCreates an iterator that produces tuples representing the Cartesian product of items in item1, item2, and so on. repeatis a keyword argument that specifies the number of times to repeat the produced sequence.\n\nrepeat(object [, times])\n\nCreates an iterator that repeatedly produces object. times, if supplied, specifies a repeat count. Otherwise, the object is returned indefinitely.\n\nstarmap(func [, iterable])\n\nCreates an iterator that produces the values func(*item), where itemis taken from iterable.This only works if iterableproduces items suitable for calling a function in this manner.\n\ntakewhile(predicate [, iterable])\n\nCreates an iterator that produces items from iterableas long as predicate(item) is True. Iteration stops immediately once predicateevaluates as False.\n\nF h Lib f L Bdff\n\noperator\n\n273\n\ntee(iterable [, n])\n\nCreates nindependent iterators from iterable.The created iterators are returned as an n-tuple.The default value of nis 2.This function works with any iterable object. However, in order to clone the original iterator, the items produced are cached and used in all the newly created iterators. Great care should be taken not to use the origi- nal iterator iterableafter tee() has been called. Otherwise, the caching mechanism may not work correctly.\n\nExamples The following examples illustrate how some of the functions in the itertools module operate:\n\nfrom itertools import * # Iterate over the numbers 0,1,...,10,9,8,...,1 in an endless cycle for i in cycle(chain(range(10),range(10,0,-1))):\n\nprint i\n\n# Create a list of unique items in a a = [1,4,5,4,9,1,2,3,4,5,1] a.sort() b = [k for k,g in groupby(a)] # b = [1,2,3,4,5,9]\n\n# Iterate over all possible combinations of pairs of values from x and y x = [1,2,3,4,5] y = [10,11,12] for r in product(x,y):\n\nprint(r)\n\n# Produces output (1,10),(1,11),(1,12), ... (5,10),(5,11),(5,12)\n\noperator The operator module provides functions that access the built-in operators and special methods of the interpreter described in Chapter 3,“Types and Objects.” For example, add(3, 4) is the same as 3 + 4. For operations that also have an in-place version, you can use a function such as iadd(x,y) which is the same as x += y.The following list shows functions defined in the operator module and how they are mapped onto vari- ous operators:\n\nFunction add(a, b)\n\nsub(a, b)\n\nmul(a, b)\n\ndiv(a, b)\n\nfloordiv(a, b)\n\ntruediv(a, b)\n\nmod(a, b)\n\nneg(a)\n\npos(a)\n\nabs(a)\n\nDescription Returns a + bfor numbers Returns a – b Returns a * bfor numbers Returns a / b(old division) Returns a // b Returns a / b(new division) Returns a % b Returns -a Returns +a Returns the absolute value of a Returns the inverse of a\n\ninv(a), invert(a)\n\ncontinues\n\nF h Lib f L Bdff\n\n274\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nFunction lshift(a, b)\n\nrshift(a, b)\n\nand_(a, b)\n\nor_(a, b)\n\nxor(a, b)\n\nnot_(a)\n\nlt(a, b)\n\nle(a, b)\n\neq(a, b)\n\nne(a, b)\n\ngt(a, b)\n\nge(a, b)\n\ntruth(a)\n\nconcat(a, b)\n\nrepeat(a, b)\n\ncontains(a, b)\n\ncountOf(a, b)\n\nindexOf(a, b)\n\nDescription Returns a << b Returns a >> b Returns a & b(bitwise AND) Returns a | b(bitwise OR) Returns a ^ b(bitwise XOR) Returns not a Returns a < b Returns a <= b Returns a == b Returns a != b Returns a > b Returns a >= b Returns True if ais true, False otherwise Returns a + bfor sequences Returns a * bfor sequence aand integer b Returns the result of bin a Returns the number of occurrences of bin a Returns the index of the first occurrence of bin a Returns a [b] a [b] = c\n\ngetitem(a, b)\n\nsetitem(a, b, c)\n\ndelitem(a, b)\n\ndel a [b] Returns a[b:c]\n\ngetslice(a, b, c) setslice(a, b, c, v) Sets a[b:c] = v delslice(a, b, c)\n\ndel a[b:c] ais b ais not b\n\nis_(a, b)\n\nis_not(a, b)\n\nAt first glance, it might not be obvious why anyone would want to use these functions because the operations they perform can easily be accomplished by simply typing the normal syntax.Where these functions are useful is when working with code uses call- back functions and where you might otherwise be defining an anonymous function with lambda. For example, consider the following timing benchmark that uses the functools.reduce() function:\n\n>>> from timeit import timeit >>> timeit(\"reduce(operator.add,a)\",\"import operator; a = range(100)\") 12.055853843688965 >>> timeit(\"reduce(lambda x,y: x+y,a)\",\"import operator; a = range(100)\") 25.012306928634644 >>>\n\nIn the example, notice how using operator.add as the callback runs more than twice as fast as the version that uses lambda x,y: x+y.\n\nF h Lib f L Bdff\n\noperator\n\n275\n\nThe operator module also defines the following functions that create wrappers\n\naround attribute access, item lookup, and method calls.\n\nattrgetter(name [, name2 [, ... [, nameN]]])\n\nCreates a callable object, f, where a call to f(obj) returns obj.name. If more than one argument is given, a tuple of results is returned. For example, attrgetter('name','shares') returns (obj.name, obj.shares) when called. namecan also include additional dot lookups. For example, if nameis \"address.hostname\", then f(obj) returns obj.address.hostname.\n\nitemgetter(item [, item2 [, ... [, itemN]]])\n\nCreates a callable object, f, where a call to f(obj) returns obj[item]. If more than one item is given as arguments, a call to f(obj) returns a tuple containing (obj[item], obj[item2], ..., obj[itemN]).\n\nmethodcaller(name [, *args [, **kwargs]])\n\nCreates a callable object, f, where a call to f(obj) returns obj.name(*args, **kwargs).\n\nThese functions are also useful for optimizing the performance of operations involv-\n\ning callback function, especially those involving common data processing operations such as sorting. For example, if you wanted to sort a list of tuples rowson column 2, you could either use sorted(rows, key=lambda r: r[2]) or use sorted(rows, key=itemgetter(2)).The second version runs much faster because it avoids the over- head associated with lambda.\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n16\n\nString and Text Handling\n\nThis chapter describes the most commonly used Python modules related to basic\n\nstring and text processing.The focus of this chapter is on the most common string operations such as processing text, regular expression pattern matching, and text format- ting.\n\ncodecs The codecs module is used to handle different character encodings used with Unicode text I/O.The module is used both to define new character encodings and to process character data using a wide range of existing encodings such as UTF-8, UTF-16, etc. It is far more common for programmers to simply use one of the existing encodings, so that is what is discussed here. If you want to create new encodings, consult the online documentation for further details.\n\nLow-Level codecs Interface Each character encoding is assigned a common name such as 'utf-8' or 'big5'.The following function is used to perform a lookup.\n\nlookup(encoding)\n\nLooks up a codec in the codec registry. encodingis a string such as 'utf-8'. If noth- ing is known about the requested encoding, LookupError is raised. Otherwise, an instance cof CodecInfo is returned.\n\nA CodecInfo instance chas the following methods:\n\nc.encode(s [, errors])\n\nA stateless encoding function that encodes the Unicode string sand returns a tuple (bytes, length_consumed). bytesis an 8-bit string or byte-array containing the encoded data. length_consumedis the number of characters in sthat were encoded. errorsis the error handling policy and is set to 'strict' by default.\n\nc.decode(bytes [, errors])\n\nA stateless encoding function that decodes a byte string bytesand returns a tuple (s, length_consumed). sis a Unicode string, and length_consumedis the number of bytes in bytesthat were consumed during decoding. errorsis the error-handling pol- icy and is set to 'strict’ by default.\n\nF h Lib f L Bdff",
      "page_number": 280
    },
    {
      "number": 15,
      "title": "Segment 15 (pages 302-322)",
      "start_page": 302,
      "end_page": 322,
      "detection_method": "synthetic",
      "content": "278\n\nChapter 16 String and Text Handling\n\nc.streamreader(bytestream [, errors])\n\nReturns a StreamReader instance that is used to read encoded data. bytestreamis a file-like object that has been opened in binary mode. errorsis the error-handling pol- icy and is 'strict' by default.An instance rof StreamReader supports the following low-level I/O operations:\n\nMethod r.read([size [, chars [, firstline]]]) Returns at most charscharacters of decoded text. sizeis the maxi- mum number of bytes to read from low-level byte-stream and is used to control internal buffering. firstlineis a flag that, if set, returns the first line even if a decod- ing error occurs later in the file. Returns a single line of decoded text. keependsis a flag that con- trols whether or not the line endings are preserved (true by default). Reads all of the lines into a list. Resets the internal buffers and state.\n\nDescription\n\nr.readline([size [, keepends]])\n\nr.readlines([size [, keepends]])\n\nr.reset()\n\nc.streamwriter(bytestream [, errors])\n\nReturns a StreamWriter instance that is used to write encoded data. bytestreamis a file-like object that has been opened in byte-mode. errorsis the error handling policy and is 'strict' by default.An instance wof StreamWriter supports the following low-level I/O operations:\n\nMethod w.write(s)\n\nw.writelines(lines)\n\nw.reset()\n\nDescription Writes an encoded representation of string s Writes a list of strings in lines to the file Resets the internal buffers and state\n\nc.incrementalencoder([errors])\n\nReturns an IncrementalEncoder instance that can be used to encode strings in multi- ple steps. errorsis 'strict' by default.An instance eof IncrementalEncoder has these methods:\n\nMethod e.encode(s [,final])\n\ne.reset()\n\nDescription Returns an encoded representation of string sas a byte string. finalis a flag that should be set to True on the final call to encode(). Resets the internal buffers and state.\n\nF h Lib f L Bdff\n\ncodecs\n\n279\n\nc.incrementaldecoder([errors])\n\nReturns an IncrementalDecoder instance that can be used to decode byte strings in multiple steps. errorsis 'strict' by default.An instance dof IncrementalDecoder has these methods:\n\nMethod d.decode(bytes [,final])\n\nd.reset()\n\nDescription Returns a decoded string from the encoded bytes in bytes. finalis a flag that should be set to True on the final call to decode(). Resets the internal buffers and state.\n\nI/O-Related Functions The codecs module provides a collection of high-level functions that are used to sim- plify I/O involving encoded text. Most programmers will use one of these functions instead of the low-level codecs interface described in the first section.\n\nopen(filename, mode[, encoding[, errors[, buffering]]])\n\nOpens filenamein the given modeand provides transparent data encoding/decoding according to the encoding specified in encoding. errorsis one of 'strict', 'ignore', 'replace', 'backslashreplace', or 'xmlcharrefreplace'.The default is 'strict'. bufferinghas the same meaning as for the built-in open() function. Regardless of the mode specified in mode, the underlying file is always opened in binary mode. In Python 3, you can use the built-in open() function instead of codecs.open().\n\nEncodedFile(file, inputenc[, outputenc [, errors]])\n\nA class that provides an encoding wrapper around an existing file object, file. Data written to the file is first interpreted according to the input encoding inputencand then written to the file using the output encoding outputenc. Data read from the file is decoded according to inputenc. If outputencis omitted, it defaults to inputenc. errorshas the same meaning as for open() and defaults to 'strict'.\n\niterencode(iterable, encoding [, errors])\n\nA generator function that incrementally encodes all of the strings in iterableto the specified encoding. errorsis 'strict' by default.\n\niterdecode(iterable, encoding [, errors])\n\nA generator function that incrementally decodes all of the byte strings in iterable according to the specified encoding. errorsis 'strict' by default.\n\nUseful Constants codecs defines the following byte-order marker constants that can be used to help interpret files when you don’t know anything about the underlying encoding.These\n\nF h Lib f L Bdff\n\n280\n\nChapter 16 String and Text Handling\n\nbyte-order markers are sometimes written at the beginning of a file to indicate its char- acter encoding and can be used to pick an appropriate codec to use.\n\nConstant BOM\n\nBOM_BE\n\nBOM_LE\n\nBOM_UTF8\n\nBOM_UTF16_BE\n\nBOM_UTF16_LE\n\nBOM_UTF32_BE\n\nDescription Native byte-order marker for the machine (BOM_BE or BOM_LE) Big-endian byte-order marker ('\\xfe\\xff') Little-endian byte-order marker ('\\xff\\xfe') UTF-8 marker ('\\xef\\xbb\\xbf') 16-bit UTF-16 big-endian marker ('\\xfe\\xff') 16-bit UTF-16 little-endian marker ('\\xff\\xfe') 32-bit UTF-32 big-endian marker ('\\x00\\x00\\xfe\\xff') 32-bit UTF-32 little-endian marker ('\\xff\\xfe\\x00\\x00')\n\nBOM_UTF32_LE\n\nStandard Encodings The following is a list of some of the most commonly used character encodings.The encoding name is what you would pass to functions such as open() or lookup() when specifying an encoding.A full list of encodings can be found by consulting the online documentation for the codecs module (http://docs.python.org/library/codecs).\n\nCodec Name ascii cp437 cp1252 latin-1, iso-8859-1 utf-16 utf-16-be utf-16-le utf-32 utf-32-be utf-32-le utf-8\n\nDescription 7-bit ASCII characters Extended ASCII character set from MS-DOS Extended ASCII character set from Windows ASCII extended with Latin characters UTF-16 UTF-16 big-endian UTF-16 little-endian UTF-32 UTF-32 big-endian UTF-32 little-endian UTF-8\n\nNotes\n\nn Further use of the codecs module is described in Chapter 9,“Input and\n\nOutput.”\n\nn Consult the online documentation for information on how to create new kinds\n\nof character encodings.\n\nn Great care needs to be taken with the inputs to encode() and decode() opera-\n\ntions.All encode() operations should be given Unicode strings, and all decode() operations should be given byte strings. Python 2 is not entirely con- sistent in this regard, whereas Python 3 strictly enforces the distinction between strings. For example, Python 2 has some codecs that map byte-strings to byte- strings (e.g., the “bz2” codec).These are unavailable in Python 3 and should not be used if you care about compatibility.\n\nF h Lib f L Bdff\n\nre\n\n281\n\nre The re module is used to perform regular-expression pattern matching and replacement in strings. Both unicode and byte-strings are supported. Regular-expression patterns are specified as strings containing a mix of text and special-character sequences. Because patterns often make extensive use of special characters and the backslash, they’re usually written as “raw” strings, such as r'(?P<int>\\d+)\\.(\\d*)'. For the remainder of this section, all regular-expression patterns are denoted using the raw string syntax.\n\nPattern Syntax The following special-character sequences are recognized in regular expression patterns:\n\nCharacter(s) text\n\n.\n\n^\n\n$\n\n\n\n+\n\n?\n\n?\n\n+?\n\n??\n\n{m}\n\n{m, n}\n\n{m, n}?\n\n[...]\n\n[^...]\n\nA|B\n\n(...)\n\nDescription Matches the literal string text. Matches any character except newline. Matches the start of a string. Matches the end of a string. Matches zero or more repetitions of the preceding expres- sion, matching as many repetitions as possible. Matches one or more repetitions of the preceding expres- sion, matching as many repetitions as possible. Matches zero repetitions or one repetition of the preceding expression. Matches zero or more repetitions of the preceding expres- sion, matching as few repetitions as possible. Matches one or more repetitions of the preceding expres- sion, matching as few repetitions as possible. Matches zero or one repetitions of the preceding expres- sion, matching as few repetitions as possible. Matches exactly mrepetitions of the preceding expression. Matches from mto nrepetitions of the preceding expres- sion, matching as many repetitions as possible. If mis omit- ted, it defaults to 0. If nis omitted, it defaults to infinity. Matches from mto nrepetitions of the preceding expres- sion, matching as few repetitions as possible. Matches a set of characters such as r'[abcdef]' or r'[a-zA-z]'. Special characters such as * are not active inside a set. Matches the characters not in the set, such as r'[^0-9]'. Matches either Aor B, where Aand Bare both regular expressions. Matches the regular expression inside the parentheses as a group and saves the matched substring. The contents of a group can be obtained using the group() method of MatchObject objects obtained while matching.\n\ncontinues\n\nF h Lib f L Bdff\n\n282\n\nChapter 16 String and Text Handling\n\nCharacter(s) (?aiLmsux)\n\n(?:...)\n\n(?P<name>...)\n\n(?P=name)\n\n(?#...)\n\n(?=...)\n\n(?!...)\n\n(?<=...)\n\n(?<!...)\n\nDescription Interprets the letters \"a\", \"i\", \"L\", \"m\", \"s\", \"u\", and \"x\" as flag settings corresponding to the re.A, re.I, re.L, re.M, re.S, re.U, re.X flag settings given to re.compile(). \"a\" only available in Python 3. Matches the regular expression inside the parentheses but discards the matched substring. Matches the regular expression in the parentheses and creates a named group. The group name must be a valid Python identifier. Matches the same text that was matched by an earlier named group. A comment. The contents of the parentheses are ignored. Matches the preceding expression only if followed by the pattern in the parentheses. For example, r'Hello (?=World)' matches 'Hello ' only if followed by 'World'. Matches the preceding expression only if it’s not followed by the pattern in parentheses. For example, r'Hello (?!World)' matches 'Hello ' only if it’s not followed by 'World'. Matches the following expression if it’s preceded by a match of the pattern in parentheses. For example, r'(?<=abc)def' matches 'def' only if it’s preceded by 'abc'. Matches the following expression only if it’s not preceded by a match of the pattern in parentheses. For example, r'(?<!abc)def' matches 'def' only if it’s not preceded by 'abc'.\n\n(?(id|name)ypat|npat) Checks to see whether the regular expression group identi-\n\nfied by idor nameexists. If so, the regular expression ypatis matched. If not, the optional expression npatis matched. For example, the pattern r'(Hello)?(?(1) World|Howdy)' matches the string 'Hello World' or the string 'Howdy'.\n\nStandard character escape sequences such as '\\n' and '\\t' are recognized as standard characters in a regular expression (for example, r'\\n+' would match one or more new- line characters). In addition, literal symbols that normally have special meaning in a reg- ular expression can be specified by preceding them with a backslash. For example, r'\\*' matches the character *. In addition, a number of backslash sequences corre- spond to special sets of characters:\n\nCharacter(s) Description \\number\n\nMatches the text that was matched by a previous group number. Groups are numbered from 1 to 99, starting from the left. Matches only at the start of the string. Matches the empty string at the beginning or end of a word. A word is a sequence of alphanumeric characters terminated by whitespace or any other nonalphanumeric character.\n\n\\A\n\n\\b\n\nF h Lib f L Bdff\n\nre\n\n283\n\nCharacter(s) Description \\B\n\nMatches the empty string not at the beginning or end of a word. Matches any decimal digit. Same as r'[0-9]'. Matches any nondigit character. Same as r'[^0-9]'. Matches any whitespace character. Same as r'[\\t\\n\\r\\f\\v]'. Matches any nonwhitespace character. Same as r'[^ \\t\\n\\r\\f\\v]'. Matches any alphanumeric character. Matches any character not contained in the set defined by \\w. Matches only at the end of the string. Matches a literal backslash.\n\n\\d\n\n\\D\n\n\\s\n\n\\S\n\n\\w\n\n\\W\n\n\\Z\n\n\\\\\n\nThe \\d, \\D, \\s, \\S, \\w, and \\W special characters are interpreted differently if matching Unicode strings. In this case, they match all Unicode characters that match the described property. For example, \\d matches any Unicode character that is classified as a digit such as European,Arabic, and Indic digits which each occupy a different range of Unicode characters.\n\nFunctions The following functions are used to perform pattern matching and replacement:\n\ncompile(str [, flags])\n\nCompiles a regular-expression pattern string into a regular-expression object.This object can be passed as the pattern argument to all the functions that follow.The object also provides a number of methods that are described shortly. flagsis the bitwise OR of the following:\n\nFlag A or ASCII I or IGNORECASE L or LOCALE M or MULTILINE\n\nS or DOTALL\n\nU or UNICODE\n\nX or VERBOSE\n\nDescription Perform 8-bit ASCII-only matching (Python 3 only). Performs non–case-sensitive matching. Uses locale settings for \\w, \\W, \\b, and \\B. Makes ^ and $ apply to each line in addition to the beginning and end of the entire string. (Normally ^ and $ apply only to the begin- ning and end of an entire string.) Makes the dot (.) character match all characters, including the newline. Uses information from the Unicode character properties database for \\w, \\W, \\b, and \\B. (Python 2 only. Python 3 uses Unicode by default.) Ignores unescaped whitespace and comments in the pattern string.\n\nescape(string)\n\nReturns a string with all nonalphanumerics backslashed.\n\nfindall(pattern, string [,flags])\n\nReturns a list of all nonoverlapping matches of patternin string, including empty matches. If the pattern has groups, a list of the text matched by the groups is returned.\n\nF h Lib f L Bdff\n\n284\n\nChapter 16 String and Text Handling\n\nIf more than one group is used, each item in the list is a tuple containing the text for each group. flagshas the same meaning as for compile().\n\nfinditer(pattern, string, [, flags])\n\nThe same as findall(), but returns an iterator object instead.The iterator returns items of type MatchObject.\n\nmatch(pattern, string [, flags])\n\nChecks whether zero or more characters at the beginning of stringmatch pattern. Returns a MatchObject on success or None otherwise. flagshas the same meaning as for compile().\n\nsearch(pattern, string [, flags])\n\nSearches stringfor the first match of pattern. flagshas the same meaning as for compile(). Returns a MatchObject on success or None if no match was found.\n\nsplit(pattern, string [, maxsplit = 0])\n\nSplits stringby the occurrences of pattern. Returns a list of strings including the text matched by any groups in the pattern. maxsplitis the maximum number of splits to perform. By default, all possible splits are performed.\n\nsub(pattern, repl, string [, count = 0])\n\nReplaces the leftmost nonoverlapping occurrences of patternin stringby using the replacement repl. replcan be a string or a function. If it’s a function, it’s called with a MatchObject and should return the replacement string. If replis a string, back- references such as '\\6' are used to refer to groups in the pattern.The sequence '\\g<name>' is used to refer to a named group. countis the maximum number of sub- stitutions to perform. By default, all occurrences are replaced.Although these functions don’t accept a flagsparameter like compile(), the same effect can be achieved by using the (?iLmsux) notation described earlier in this section.\n\nsubn(pattern, repl, string [, count = 0])\n\nSame as sub(), but returns a tuple containing the new string and the number of substi- tutions.\n\nRegular Expression Objects A compiled regular-expression object, r, created by the compile() function has the fol- lowing methods and attributes:\n\nr.flags\n\nThe flags argument used when the regular expression object was compiled, or 0 if no flags were specified.\n\nr.groupindex\n\nA dictionary mapping symbolic group names defined by r'(?P<id>)' to group numbers.\n\nr.pattern\n\nThe pattern string from which the regular expression object was compiled.\n\nF h Lib f L Bdff\n\nre\n\n285\n\nr.findall(string [, pos [, endpos]])\n\nIdentical to the findall() function. posand endposspecify the starting and ending positions for the search.\n\nr.finditer(string [, pos [, endpos]])\n\nIdentical to the finditer() function. posand endposspecify the starting and ending positions for the search.\n\nr.match(string [, pos] [, endpos])\n\nChecks whether zero or more characters at the beginning of stringmatch. posand endposspecify the range of stringto be searched. Returns a MatchObject for a match and returns None otherwise.\n\nr.search(string [, pos] [, endpos])\n\nSearches stringfor a match. posand endposspecify the starting and ending positions for the search. Returns a MatchObject for a match and returns None otherwise.\n\nr.split(string [, maxsplit = 0])\n\nIdentical to the split() function.\n\nr.sub(repl, string [, count = 0])\n\nIdentical to the sub() function.\n\nr.subn(repl, string [, count = 0])\n\nIdentical to the subn() function.\n\nMatch Objects The MatchObject instances returned by search() and match() contain information about the contents of groups as well as positional data about where matches occurred.A MatchObject instance, m, has the following methods and attributes:\n\nm.expand(template)\n\nReturns a string that would be obtained by doing regular-expression backslash substitu- tion on the string template. Numeric back-references such as \"\\1\" and \"\\2\" and named references such as \"\\g<n>\" and \"\\g<name>\" are replaced by the contents of the corresponding group. Note that these sequences should be specified using raw strings or with a literal backslash character such as r'\\1' or '\\\\1'.\n\nm.group([group1, group2, ...])\n\nReturns one or more subgroups of the match.The arguments specify group numbers or group names. If no group name is given, the entire match is returned. If only one group is given, a string containing the text matched by the group is returned. Otherwise, a tuple containing the text matched by each of the requested groups is returned.An IndexError is raised if an invalid group number or name is given.\n\nm.groups([default])\n\nReturns a tuple containing the text matched by all groups in a pattern. defaultis the value returned for groups that didn’t participate in the match (the default is None).\n\nF h Lib f L Bdff\n\n286\n\nChapter 16 String and Text Handling\n\nm.groupdict([default])\n\nReturns a dictionary containing all the named subgroups of the match. defaultis the value returned for groups that didn’t participate in the match (the default is None).\n\nm.start([group]) m.end([group])\n\nThese two methods return the indices of the start and end of the substring matched by a group. If groupis omitted, the entire matched substring is used. Returns None if the group exists but didn’t participate in the match.\n\nm.span([group])\n\nReturns a 2-tuple (m.start(group), m.end(group)). If groupdidn’t contribute to the match, this returns (None, None). If groupis omitted, the entire matched sub- string is used.\n\nm.pos\n\nThe value of pospassed to the search() or match() function.\n\nm.endpos\n\nThe value of endpospassed to the search() or match() function.\n\nm.lastindex\n\nThe numerical index of the last group that was matched. It’s None if no groups were matched.\n\nm.lastgroup\n\nThe name of the last named group that was matched. It’s None if no named groups were matched or present in the pattern.\n\nm.re\n\nThe regular-expression object whose match() or search() method produced this MatchObject instance.\n\nm.string\n\nThe string passed to match() or search().\n\nExample The following example shows how to use the re module to search for, extract data from, and replace a text pattern in a string.\n\nimport re text = \"Guido will be out of the office from 12/15/2012 - 1/3/2013.\"\n\n# A regex pattern for a date. datepat = re.compile('(\\d+)/(\\d+)/(\\d+)')\n\n# Find and print all dates for m in datepat.finditer(text):\n\nprint(m.group())\n\nF h Lib f L Bdff\n\nstring\n\n287\n\n# Find all dates, but print in a different format monthnames = [None,'Jan','Feb','Mar','Apr','May','Jun',\n\n'Jul','Aug','Sep','Oct','Nov','Dec']\n\nfor m in datepat.finditer(text):\n\nprint (\"%s %s, %s\" % (monthnames[int(m.group(1)], m.group(2), m.group(3)))\n\n# Replace all dates with fields in the European format (day/month/year) def fix_date(m):\n\nreturn \"%s/%s/%s\" % (m.group(2),m.group(1),m.group(3))\n\nnewtext = datepat.sub(fix_date, text)\n\n# An alternative replacement newtext = datepat.sub(r'\\2/\\1/\\3', text)\n\nNotes\n\nn Detailed information about the theory and implementation of regular expressions can be found in textbooks on compiler construction.The book Mastering Regular Expressions by Jeffrey Friedl (O’Reilly & Associates, 1997) may also be useful. n The most difficult part of using the re module is writing the regular expression\n\npatterns. For writing patterns, consider using a tool such as Kodos (http://kodos.sourceforget.net).\n\nstring The string module contains a number of useful constants and functions for manipulat- ing strings. It also contains classes for implementing new string formatters.\n\nConstants The following constants define various sets of characters that may be useful in various string processing operations.\n\nConstant ascii_letters\n\nascii_lowercase\n\nascii_uppercase\n\ndigits\n\nhexdigits\n\nletters\n\nlowercase\n\noctdigits\n\npunctuation\n\nprintable\n\nuppercase\n\nDescription A string containing all lowercase and uppercase ASCII letters. The string 'abcdefghijklmnopqrstuvwxyz'. The string 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'. The string '0123456789'. The string '0123456789abcdefABCDEF'. Concatenation of lowercase and uppercase. String containing all lowercase letters specific to the current locale setting. The string '01234567'. String of ASCII punctuation characters. String of printable characters—a combination of letters, digits, punctuation, and whitespace. String containing all uppercase letters specific to the current locale setting. String containing all whitespace characters. This usually includes space, tab, linefeed, return, formfeed, and vertical tab.\n\nwhitespace\n\nF h Lib f L Bdff\n\n288\n\nChapter 16 String and Text Handling\n\nNote that some of these constants (for example, letters and uppercase) will vary depending on the locale settings of the system.\n\nFormatter Objects The str.format() method of strings is used to perform advanced string formatting operations.As seen in Chapter 3,“Types and Objects,” and Chapter 4,“Operators and Expressions,” this method can access items of sequences or mappings, attributes of objects, and other kinds of related operations.The string module defines a class Formatter that can be used to implement your own customized formatting operation. This class exposes the pieces that implement the string formatting operation and allow you to customize them.\n\nFormatter()\n\nCreates a new Formatter instance.An instance fof Formatter supports the following operations.\n\nf.format(format_string, *args, **kwargs)\n\nFormats the string format_string. By default, the output is the same as calling format_string.format(*args, **kwargs). For example, f.format(\"{name} is {0:d} years old\", 39,name=\"Dave\") creates the string \"Dave is 39 years old\".\n\nf.vformat(format_string, args, kwargs)\n\nA method that actually carries out the work of f.format(). argsis a tuple of posi- tional arguments, and kwargsis a dictionary of keyword arguments.This is a faster method to use if you have already captured argument information in a tuple and dic- tionary.\n\nf.parse(format_string)\n\nA function that creates an iterator for parsing the contents of the format string format_string.The iterator sweeps over the format string and produces tuples of the format (literal_text, field_name, format_spec, conversion). literal_textis any literal text that precedes the next format specifier enclosed in braces { ... }. It may be an empty string if there is no leading text. field_nameis a string that specifies the field name in the format specifier. For example, if the specifier is '{0:d}', then the field name is '0'. format_specis the format specifier that appears after the colon—for example, 'd' in the previous example. It will be an empty string if it wasn’t specified. conversionis a string containing the conversion specifier (if any). In the previous example, it is None, but if the specifier was '{0!s:d}', it would be set to 's'. field_name, format_spec, and conversionwill all be None for the last frag- ment of the format string.\n\nf.get_field(fieldname, args, kwargs)\n\nExtracts the value associated with a given fieldnamefrom argsand kwargs. fieldnameis a string such as \"0\" or \"name\" as returned by the parse() method shown previously. Returns a tuple (value, key) where valueis the field value and keyis used to locate the value in argsor kwargs. If keyis an integer, it is an index in args. If it is a string, it is the key used in kwargs.The fieldname may include additional indexing and attribute lookup such as '0.name’ or '0[name]'. In this case, the method\n\nF h Lib f L Bdff\n\nstring\n\n289\n\ncarries out the extra lookup and returns the appropriate value. However, the value of keyin the returned tuple is just set to '0'.\n\nf.get_value(key, args, kwargs)\n\nExtracts the object from argsor kwargscorresponding to key. If keyis an integer, the object is taken from args. If it is a string, it is taken from kwargs.\n\nf.check_unused_args(used_args, args, kwargs)\n\nChecks for unused arguments in the format() operation. used_argsis a set of all of the used argument keys (see get_field()) that were found in the format string. args and kwargsare the positional and keyword arguments passed to format().The default behavior is to raise a TypeError for unused arguments.\n\nf.format_value(value, format_spec)\n\nFormats a single value according to the given format specification. By default, this sim- ply executes the built-in function format(value, format_spec).\n\nf.convert_field(value, conversion)\n\nConverts a valuereturned by get_field() according to the specified conversion code. If conversionis None, valueis returned unmodified. If conversion is 's' or 'r', valueis converted to a string using str() or repr(), respectively.\n\nIf you want to create your own customized string formatting, you can create a Formatter object and simply use the default methods to carry out the formatting as you wish. It is also possible to define a new class that inherits from Formatter and reimplements any of the methods shown earlier.\n\nFor details on the syntax of format specifiers and advanced string formatting, refer to\n\nChapter 3 and Chapter 4.\n\nTemplate Strings The string module defines a new string type, Template, that simplifies certain string substitutions.An example can be found in Chapter 9.\n\nThe following creates a new template string object:\n\nTemplate(s)\n\nHere, sis a string and Template is defined as a class.\n\nA Template object, t, supports the following methods:\n\nt.substitute(m [, **kwargs])\n\nThis method takes a mapping object, m(for example, a dictionary), or a list of keyword arguments and performs a keyword substitution on the string t.This substitution replaces the string '$$' with a single '$' and the strings '$key' or '${key}' with m['key’] or kwargs['key'] if keyword arguments were supplied. keymust spell a valid Python identifier. If the final string contains any unresolved '$key' patterns, a KeyError exception is raised.\n\nt.safe_substitute(m [, **kwargs])\n\nThe same as substitute() except that no exceptions or errors will be generated. Instead, unresolved $keyreferences will be left in the string unmodified.\n\nF h Lib f L Bdff\n\n290\n\nChapter 16 String and Text Handling\n\nt.template\n\nContains the original strings passed to Template().\n\nThe behavior of the Template class can be modified by subclassing it and redefining\n\nthe attributes delimiter and idpattern. For example, this code changes the escape character $ to @ and restricts key names to letters only:\n\nclass MyTemplate(string.Template):\n\ndelimiter = '@' # Literal character for escape sequence idpattern = '[A-Z]*' # Identifier regular expression pattern\n\nUtility Functions The string module also defines a couple of functions for manipulating strings that aren’t defined as a method on string objects.\n\ncapwords(s)\n\nCapitalizes the first letter of each word in s, replaces repeated whitespace characters with a single space, and removes leading and trailing whitespace.\n\nmaketrans(from, to)\n\nCreates a translation table that maps each character in fromto the character in the same position in to. fromand tomust be the same length.This function is used to create arguments suitable for use with the translate() method of strings.\n\nstruct The struct module is used to convert data between Python and binary data structures (represented as Python byte strings).These data structures are often used when interact- ing with functions written in C, binary file formats, network protocols, or binary com- munication over serial ports.\n\nPacking and Unpacking Functions The following module-level functions are used to pack and unpack data in byte strings. If your program is repeatedly performing these operations, consider the use of a Struct object described in the next section.\n\npack(fmt, v1, v2, ...)\n\nPacks the values v1, v2, and so on into a byte string according to the format string in fmt.\n\npack_into(fmt, buffer, offset, v1, v2 ...)\n\nPacks the values v1, v2, and so forth into a writable buffer object bufferstarting at byte offset offset.This only works with objects that support the buffer interface. Examples include array.array and bytearray objects.\n\nunpack(fmt, string)\n\nUnpacks the contents of a byte stringaccording to the format string in fmt. Returns a tuple of the unpacked values.The length of stringmust exactly match the size of the format as determined by the calcsize() function.\n\nF h Lib f L Bdff\n\nstruct\n\n291\n\nunpack_from(fmt, buffer, offset)\n\nUnpacks the contents of a bufferobject according to the format string in fmtstarting at offset offset. Returns a tuple of the unpacked values.\n\ncalcsize(fmt)\n\nCalculates the size in bytes of the structure corresponding to a format string fmt.\n\nStruct Objects The struct module defines a class Struct that provides an alternative interface for packing and unpacking. Using this class is more efficient because the format string is only interpreted once.\n\nStruct(fmt)\n\nCreates a Struct instance representing data packed according to the given format code. An instance sof Struct has the following methods that work exactly the same as their functional counterparts described in the previous section:\n\nMethod s.pack(v1, v2, ...) s.pack_into(buffer, offset, v1, v2, ...) Packs values into a buffer object s.unpack(bytes)\n\nDescription Packs values into a byte string\n\nUnpacks values from a byte string Unpacks values from a buffer object The format code being used The size in bytes of the format\n\ns.unpack_from(buffer, offset)\n\ns.format\n\ns.size\n\nFormat Codes The format strings used in the struct module are a sequence of characters with the following interpretations:\n\nFormat 'x'\n\n'c'\n\n'b'\n\n'B'\n\n'?'\n\n'h'\n\n'H'\n\n'i'\n\n'I'\n\n'l'\n\n'L'\n\n'q'\n\nC Type pad byte\n\nchar\n\nsigned char\n\nunsigned char _Bool (C99) short\n\nunsigned short\n\nint\n\nunsigned int\n\nlong\n\nunsigned long\n\nlong long\n\nPython Type No value String of length 1 Integer Integer Boolean Integer Integer Integer Integer Integer Integer Long Long\n\n'Q'\n\nunsigned long long\n\ncontinues\n\nF h Lib f L Bdff\n\n292\n\nChapter 16 String and Text Handling\n\nFormat 'f'\n\n'd'\n\n's'\n\n'p'\n\n'P'\n\nC Type float\n\ndouble\n\nchar[]\n\nchar[]\n\nvoid *\n\nPython Type Float Float String String with length encoded in the first byte Integer\n\nEach format character can be preceded by an integer to indicate a repeat count (for example, '4i' is the same as 'iiii'). For the 's' format, the count represents the maximum length of the string, so '10s' represents a 10-byte string.A format of '0s' indicates a string of zero length.The 'p' format is used to encode a string in which the length appears in the first byte, followed by the string data.This is useful when dealing with Pascal code, as is sometimes necessary on the Macintosh. Note that the length of the string in this case is limited to 255 characters.\n\nWhen the 'I' and 'L' formats are used to unpack a value, the return value is a Python long integer. In addition, the 'P' format may return an integer or long integer, depending on the word size of the machine.\n\nThe first character of each format string can also specify a byte ordering and align-\n\nment of the packed data, as shown here:\n\nFormat '@'\n\n'='\n\n'<'\n\n'>'\n\n'!'\n\nByte Order Native Native Little-endian Big-endian Network (big-endian)\n\nSize and Alignment Native Standard Standard Standard Standard\n\nNative byte ordering may be little-endian or big-endian, depending on the machine architecture.The native sizes and alignment correspond to the values used by the C compiler and are implementation-specific.The standard alignment assumes that no alignment is needed for any type.The standard size assumes that short is 2 bytes, int is 4 bytes, long is 4 bytes, float is 32 bits, and double is 64 bits.The 'P' format can only use native byte ordering.\n\nNotes\n\nn Sometimes it’s necessary to align the end of a structure to the alignment require- ments of a particular type.To do this, end the structure-format string with the code for that type with a repeat count of zero. For example, the format 'llh0l' specifies a structure that ends on a 4-byte boundary (assuming that longs are aligned on 4-byte boundaries). In this case, two pad bytes would be inserted after the short value specified by the 'h' code.This only works when native size and alignment are being used—standard size and alignment don’t enforce alignment rules.\n\nn The 'q’ and 'Q' formats are only available in “native” mode if the C compiler\n\nused to build Python supports the long long data type.\n\nF h Lib f L Bdff\n\nunicodedata\n\n293\n\nSee Also:\n\narray (p. 259), ctypes (p. 612)\n\nunicodedata The unicodedata module provides access to the Unicode character database, which contains character properties for all Unicode characters.\n\nbidirectional(unichr)\n\nReturns the bidirectional category assigned to unichras a string or an empty string if no such value is defined. Returns one of the following:\n\nValue L\n\nLRE\n\nLRO\n\nR\n\nAL\n\nRLE\n\nRLO\n\nPDF\n\nEN\n\nES\n\nET\n\nAN\n\nCS\n\nNSM\n\nBN\n\nB\n\nS\n\nDescription Left-to-Right Left-to-Right embedding Left-to-Right override Right-to-Left Right-to-Left Arabic Right-to-Left embedding Right-to-Left override Pop directional format European number European number separator European number terminator Arabic number Common number separator Nonspacing mark Boundary neutral Paragraph separator Segment separator Whitespace Other neutrals\n\nWS\n\nON\n\ncategory(unichr)\n\nReturns a string describing the general category of unichr.The returned string is one of the following values:\n\nValue Lu\n\nLl\n\nLt\n\nMn\n\nMc\n\nDescription Letter, uppercase Letter, lowercase Letter, title case Mark, nonspacing Mark, spacing combining Mark, enclosing\n\nMe\n\ncontinues\n\nF h Lib f L Bdff\n\n294\n\nChapter 16 String and Text Handling\n\nValue Nd\n\nNl\n\nNo\n\nZs\n\nZl\n\nZp\n\nCc\n\nCf\n\nCs\n\nCo\n\nCn\n\nLm\n\nLo\n\nPc\n\nPd\n\nPs\n\nPe\n\nPi\n\nPf\n\nPo\n\nSm\n\nSc\n\nDescription Number, decimal digit Number, letter Number, other Separator, space Separator, line Separator, paragraph Other, control Other, format Other, surrogate Other, private use Other, not assigned Letter, modifier Letter, other Punctuation, connector Punctuation, dash Punctuation, open Punctuation, close Punctuation, initial quote Punctuation, final quote Punctuation, other Symbol, math Symbol, currency Symbol, modifier Symbol, other\n\nSk\n\nSo\n\ncombining(unichr)\n\nReturns an integer describing the combining class for unichror 0 if no combining class is defined. One of the following values is returned:\n\nValue 0\n\n1\n\n7\n\n8\n\n9\n\n10-199\n\n200\n\n202\n\n204\n\n208\n\n210\n\n212\n\n214\n\nDescription Spacing, split, enclosing, reordrant, and Tibetan subjoined Overlays and interior Nuktas Hiragana/Katakana voicing marks Viramas Fixed-position classes Below left attached Below attached Below right attached Left attached Right attached Above left attached Above attached Above right attached\n\n216\n\nF h Lib f L Bdff\n\nunicodedata\n\n295\n\nValue 218\n\n220\n\n222\n\n224\n\n226\n\n228\n\n230\n\n232\n\n233\n\n234\n\nDescription Below left Below Below right Left Right Above left Above Above right Double below Double above Below (iota subscript)\n\n240\n\ndecimal(unichr[, default])\n\nReturns the decimal integer value assigned to the character unichr. If unichris not a decimal digit, defaultis returned or ValueError is raised.\n\ndecomposition(unichr)\n\nReturns a string containing the decomposition mapping of unichror the empty string if no such mapping is defined.Typically, characters containing accent marks can be decomposed into multicharacter sequences. For example, decomposition(u\"\\u00fc\") (\"ü\") returns the string \"0075 0308\" corresponding to the letter u and the umlaut (¨) accent mark.The string returned by this function may also include the following strings:\n\nValue <font>\n\n<noBreak>\n\n<initial>\n\n<medial>\n\n<final>\n\n<isolated>\n\n<circle>\n\n<super>\n\n<sub>\n\n<vertical>\n\n<wide>\n\n<narrow>\n\n<small>\n\n<square>\n\n<fraction>\n\nDescription A font variant (for example, a blackletter form) A nonbreaking version of a space or hyphen An initial presentation form (Arabic) A medial presentation form (Arabic) A final presentation form (Arabic) An isolated presentation form (Arabic) An encircled form A superscript form A subscript form A vertical layout presentation form A wide (or zenkaku) compatibility character A narrow (or hankaku) compatibility character A small variant form (CNS compatibility) A CJK squared-font variant A vulgar fraction form Otherwise unspecified compatibility character\n\n<compat>\n\ndigit(unichr[, default])\n\nReturns the integer digit value assigned to the character unichr. If unichris not a digit, defaultis returned or ValueError is raised.This function differs from\n\nF h Lib f L Bdff\n\n296\n\nChapter 16 String and Text Handling\n\ndecimal() in that it works with characters that may represent digits but that are not decimal digits.\n\neast_asian_width(unichr)\n\nReturns the east Asian width assigned to unichr.\n\nlookup(name)\n\nLooks up a character by name. For example, lookup('COPYRIGHT SIGN') returns the corresponding Unicode character. Common names can be found at http://www.unicode.org/charts.\n\nmirrored(unichr)\n\nReturns 1 if unichris a “mirrored” character in bidirectional text and returns 0 other- wise.A mirrored character is one whose appearance might be changed to appear prop- erly if text is rendered in reverse order. For example, the character '(' is mirrored because it might make sense to flip it to ')' in cases where text is printed from right to left.\n\nname(unichr [, default])\n\nReturns the name of a Unicode character, unichr. Raises ValueError if no name is defined or returns defaultif provided. For example, name(u'\\xfc') returns 'LATIN SMALL LETTER U WITH DIAERESIS'.\n\nnormalize(form, unistr)\n\nNormalizes the Unicode string unistraccording to normal form form. formis one of 'NFC', 'NFKC', 'NFD', or 'NFKD'.The normalization of a string partly pertains to the composition and decomposition of certain characters. For example, the Unicode string for the word “resumé” could be represented as u'resum\\u00e9' or as the string u'resume\\u0301'. In the first string, the accented character é is represented as a single character. In the second string, the accented character is represented by the letter e fol- lowed by a combining accent mark (´). 'NFC' normalization converts the string unistr so that all of the characters are fully composed (for example, é is a single character). 'NFD' normalization converts unistrso that characters are decomposed (for example, é is the letter e followed by an accent). 'NFKC' and 'NFKD' perform the same function as 'NFC' and 'NFD' except that they additionally transform certain characters that may be represented by more than one Unicode character value into a single standard value. For example, Roman numerals have their own Unicode character values but are also just represented by the Latin letters I, V, M, and so on. 'NFKC' and 'NFKD' would con- vert the special Roman numeral characters into their Latin equivalents.\n\nnumeric(unichr[, default])\n\nReturns the value assigned to the Unicode character unichras a floating-point num- ber. If no numeric value is defined, defaultis returned or ValueError is raised. For example, the numeric value of U+2155 (the character for the fraction \"1/5\") is 0.2.\n\nunidata_version\n\nA string containing the Unicode database version used (for example, '5.1.0').\n\nNote\n\nFor further details about the Unicode character database, see http://www.unicode.org.\n\nF h Lib f L Bdff\n\n17\n\nPython Database Access\n\nThis chapter describes the programming interfaces that Python uses to interface with\n\nrelational and hash table style databases. Unlike other chapters that describe specific library modules, the material in this chapter partly applies to third-party extensions. For example, if you want Python to interface with a MySQL or Oracle database, you would first have to download a third-party extension module.That module, in turn, would then follow the basic conventions described here.\n\nRelational Database API Specification For accessing relational databases, the Python community has developed a standard known as the Python Database API Specification V2.0, or PEP 249 for short (the formal description can be found at http://www.python.org/dev/peps/pep-249/). Specific database modules (e.g., MySQL, Oracle, and so on) follow this specification, but may add even more features.This section covers the essential elements needed to use it for most applications.\n\nAt a high level, the database API defines a set of functions and objects for connecting to a database server, executing SQL queries, and obtaining results. Two primary objects are used for this: a Connection object that manages the connection to the database and a Cursor object that is used to perform queries.\n\nConnections To connect to a database, every database module provides a module-level function connect(parameters).The exact parameters depend on the database but typically include information such as the data source name, user name, password, host name, and database name.Typically these are provided with keyword arguments dsn, user, pass- word, host, and database, respectively. So, a call to connect() might look like this:\n\nconnect(dsn=\"hostname:DBNAME\",user=\"michael\",password=\"peekaboo\")\n\nIf successful, a Connection object is returned.An instance cof Connection has the following methods:\n\nc.close()\n\nCloses the connection to the server.\n\nF h Lib f L Bdff\n\n298\n\nChapter 17 Python Database Access\n\nc.commit()\n\nCommits all pending transactions to the database. If the database supports transactions, this must be called for any changes to take effect. If the underlying database does not support transactions, this method does nothing.\n\nc.rollback()\n\nRolls back the database to the start of any pending transactions.This method is some- times used in databases that do not support transactions in order to undo any changes made to the database. For example, if an exception occurred in code that was in the middle of updating a database, you might use this to undo changes made before the exception.\n\nc.cursor()\n\nCreates a new Cursor object that uses the connection.A cursor is an object that you will use to execute SQL queries and obtain results.This is described in the next section.\n\nCursors In order to perform any operations on the database, you first create a connection cand then you call c.cursor() method to create a Cursor object.An instance curof a Cursor has a number of standard methods and attributes that are used to execute queries:\n\ncur.callproc(procname [, parameters])\n\nCalls a stored procedure with name procname. parameters, which is a sequence of values that are used as the arguments to the procedure.The result of this function is a sequence with the same number of items as parameters.This sequence is a copy of parameterswhere the values of any output arguments have been replaced with their modified values after execution. If a procedure also produces an output set, it can be read using the fetch*() methods described next.\n\ncur.close()\n\nCloses the cursor, preventing any further operations on it.\n\ncur.execute(query [, parameters])\n\nExecutes a query or command queryon the database. queryis a string containing the command (usually SQL), and parametersis either a sequence or mapping that is used to supply values to variables in the query string (this is described in the next section).\n\ncur.executemany(query [, parametersequence])\n\nRepeatedly executes a query or command. queryis a query string, and parametersquenceis a sequence of parameters. Each item in this sequence is a sequence or mapping object that you would have used with the execute() method shown earlier.\n\ncur.fetchone()\n\nReturns the next row of the result set produced by execute() or executemany(). The result is typically a list or tuple containing values for the different columns of the result. None is returned if there are no more rows available.An exception is raised if there is no pending result or if the previously executed operation didn’t create a result set.\n\nF h Lib f L Bdff",
      "page_number": 302
    },
    {
      "number": 16,
      "title": "Segment 16 (pages 323-341)",
      "start_page": 323,
      "end_page": 341,
      "detection_method": "synthetic",
      "content": "Relational Database API Specification\n\n299\n\ncur.fetchmany([size])\n\nReturns a sequence of result rows (e.g., a list of tuples). sizeis the number of rows to return. If omitted, the value of cur.arraysize is used as a default.The actual number of rows returned may be less than requested.An empty sequence is returned if no more rows are available.\n\ncur.fetchall()\n\nReturns a sequence of all remaining result rows (e.g., a list of tuples).\n\ncur.nextset()\n\nDiscards all remaining rows in the current result set and skips to the next result set (if any). Returns None if there are no more result sets; otherwise, a True value is returned and subsequent fetch*() operations return data from the new set.\n\ncur.setinputsize(sizes)\n\nGives the cursor a hint about the parameters to be passed on subsequent execute*() methods. sizesis a sequence of type objects (described shortly) or integers which give the maximum expected string length for each parameter. Internally, this is used to pre- define memory buffers for creating the queries and commands sent to the database. Using this can speed up subsequent execute*() operations.\n\ncur.setoutputsize(size [, column])\n\nSets the buffer size for a specific column in result sets. columnis an integer index into the result row, and sizeis the number of bytes.A typical use of this method is to set limits on large database columns such as strings, BLOBs, and LONGs prior to making any execute*() calls. If columnis omitted, it sets a limit for all columns in the result. Cursors have a number of attributes that describe the current result set and give\n\ninformation about the cursor itself.\n\ncur.arraysize\n\nAn integer that gives the default value used for the fetchmany() operation.This value may vary between database modules and may be initially set to a value that the module considers to be “optimal.”\n\ncur.description\n\nA sequence of tuples that give information about each column in the current result set. Each tuple has the form (name, type_code, display_size, internal_size, precision, scale, null_ok).The first field is always defined and corresponds to the column name.The type_codecan be used in comparisons involving the type objects described in the “Type Objects” section.The other fields may be set to None if they don’t apply to the column.\n\ncur.rowcount\n\nThe number of rows in the last result produced by one of the execute*() methods. If set to -1, it means that there is either no result set or that the row count can’t be deter- mined.\n\nAlthough not required by the specification, the Cursor object in most database modules also implements the iteration protocol. In this case, a statement such as for row in cur: will iterate over the rows the result set created by the last execute*() method.\n\nF h Lib f L Bdff\n\n300\n\nChapter 17 Python Database Access\n\nHere is a simple example showing how some of these operations are used with the\n\nsqlite3 database module, which is a built-in library:\n\nimport sqlite3 conn = sqlite3.connect(\"dbfile\") cur = conn.cursor()\n\n# Example of a simple query cur.execute(\"select name, shares, price from portfolio where account=12345\")\n\n# Looping over the results while True:\n\nrow = cur.fetchone()\n\nif not row: break # Process the row name, shares, price = row ...\n\n# An alternative approach (using iteration) cur.execute(\"select name, shares, price from portfolio where account=12345\") for name, shares, price in cur:\n\n# Process the row ...\n\nForming Queries A critical part of using the database API involves forming SQL query strings to pass into the execute*() methods of cursor objects. Part of the problem here is that you need to fill in parts of the query string with parameters supplied by the user. For exam- ple, you might be inclined to write code like this:\n\nsymbol = \"AIG\" account = 12345\n\ncur.execute(\"select shares from portfolio where name='%s' and account=%d\" %\n\n(symbol, account))\n\nAlthough this “works,” you should never manually form queries using Python string operations like this. If you do, it opens up your code to a potential SQL injection attack—a vulnerability that someone can use to execute arbitrary statements on the database server. For example, in the previous code, someone might supply a value for symbol that looks like \"EVIL LAUGH'; drop table portfolio;--\" which probably does something other than what you anticipated.\n\nAll database modules provide their own mechanism for value substitution. For exam-\n\nple, instead of forming the entire query as shown, you might do this instead:\n\nsymbol = \"AIG\"\n\naccount = 12345\n\ncur.execute(\"select shares from portfolio where name=? and account=?\",\n\n(symbol, account))\n\nHere, the '?' placeholders are successively replaced with values from the tuple (symbol, account).\n\nSadly, there is no standard convention for placeholders across database module imple-\n\nmentations. However, each module defines a variable paramstyle that indicates the formatting of value substitutions to be used in queries. Possible values of this variable are as follows:\n\nF h Lib f L Bdff\n\nRelational Database API Specification\n\n301\n\nParameter Style Description 'qmark'\n\nQuestion mark style where each ? in the query is replaced by suc- cessive items in a sequence. For example, cur.execute(\"... where name=? and account=?\", (symbol, account)). The parameters are specified as a tuple. Numeric style where :nis filled in with the parameter value at index n. For example, cur.execute(\"... where name=:0 and account=:1\",(symbol, account)). Named style where :nameis filled in with a named value. For this style, the parameters must be given as a mapping. For example, cur.execute(\"... where name=:symbol and account=:account\", {'symbol':symbol, 'account': account}). Printf-style format codes such as %s, %d, etc. For example, cur.execute(\"... where name=%s and account=%d\", (symbol, account)). Python extended format codes such as %(name)s. Similar to the 'named' style. Parameters must be specified as a mapping instead of a tuple.\n\n'numeric'\n\n'named'\n\n'format'\n\n'pyformat'\n\nType Objects When working with database data, built-in types such as integers and strings are usually mapped to an equivalent type in the database. However, for dates, binary data, and other special types, data management is more tricky.To assist with this mapping, database modules implement a set of constructor functions for creating objects of various types.\n\nDate(year, month, day)\n\nCreates an object representing a date.\n\nTime(hour, minute, second)\n\nCreates an object representing a time.\n\nTimestamp(year, month, day, hour, minute, second)\n\nCreates an object representing a timestamp.\n\nDateFromTicks(ticks)\n\nCreates a date object from a value of the system time. ticksis the number of seconds as returned by a function such as time.time().\n\nTimeFromTicks(ticks)\n\nCreates a time object from a value of the system time.\n\nTimestampFromTicks(ticks)\n\nCreates a timestamp object from a value of the system time.\n\nBinary(s)\n\nCreates a binary object from a byte-string s.\n\nF h Lib f L Bdff\n\n302\n\nChapter 17 Python Database Access\n\nIn addition to these constructor functions, the following type objects might be\n\ndefined.The purpose of these codes is to perform type checking against the type_code field of cur.description, which describes the contents of the current result set.\n\nType Object STRING\n\nBINARY\n\nNUMBER\n\nDATETIME\n\nROWID\n\nDescription Character or text data Binary data such as BLOBs Numeric data Date and time data Row ID data\n\nError Handling Database modules define a top-level exception Error that is a base class for all other errors.The following exceptions are for more specific kinds of database errors:\n\nException InterfaceError\n\nDatabaseError\n\nDataError\n\nOperationalError\n\nIntegrityError\n\nInternalError\n\nProgrammingError\n\nNotSupportedError\n\nDescription Errors related to the database interface, but not the database itself. Errors related to the database itself. Errors related to the processed data. For example, bad type conversions, division by zero, etc. Errors related to the operation of the database itself. For example, a lost connection. Error when relational integrity of the database is broken. Internal error in the database. For example, if a stale cursor. Errors in SQL queries. Error for methods in the database API that aren’t supported by the underlying database.\n\nModules may also define a Warning exception that is used by the database module to warn about things such as data truncation during updates.\n\nMultithreading If you are mixing database access with multithreading, the underlying database module may or may not be thread-safe.The following variable is defined in each module to provide more information.\n\nthreadsafety\n\nAn integer that indicates the thread safety of the module. Possible values are:\n\n0\n\n1\n\n2\n\n3\n\nNo thread safety. Threads may not share any part of the module. The module is thread-safe, but connections may not be shared. The module and connections are thread-safe, but cursors may not be shared. The module, connections, and cursors are all thread-safe.\n\nF h Lib f L Bdff\n\nsqlite3 Module\n\n303\n\nMapping Results into Dictionaries A common issue concerning database results is the mapping of tuples or lists into a dic- tionary of named fields. For example, if the result set of a query contains a large number of columns, it may be easier to work with this data using descriptive field names instead of hard-coding the numeric index of specific fields within a tuple.\n\nThere are many ways to handle this, but one of the most elegant ways to process\n\nresult data is through the use of generator functions. For example:\n\ndef generate_dicts(cur): import itertools fieldnames = [d[0].lower() for d in cur.description ] while True:\n\nrows = cur.fetchmany() if not row: return for row in rows:\n\nyield dict(itertools.izip(fieldnames,row))\n\n# Sample use cur.execute(\"select name, shares, price from portfolio\") for r in generate_dicts(cur):\n\nprint r['name'],r['shares'],r['price']\n\nBe aware that the naming of columns is not entirely consistent between databases— especially with respect to things such as case sensitivity. So, you’ll need to be a little careful if you try to apply this technique to code that’s meant to work with a variety of different database modules.\n\nDatabase API Extensions Finally, many extensions and advanced features can be added to specific database modules—for example, support for two-phase commits and extended error handling. PEP-249 has additional information about the recommended interface for these features and should be consulted by advanced users.Third-party library modules also may sim- plify the use of relational database interfaces.\n\nsqlite3 Module The sqlite3 module provides a Python interface to the SQLite database library (http://www.sqlite.org). SQLite is a C library that implements a self-contained relation- al database entirely within a file or in memory.Although it is simple, this library is attractive for various reasons. For one, it does not rely upon a separate database server nor does it require any kind of special configuration—you can start to use it right away in your programs by simply connecting to a database file (and if it doesn’t exist, a new file is created).The database also supports transactions for improved reliability (even across system crashes) as well as locking to allow the same database file to be simultane- ously accessed from multiple processes.\n\nThe programming interface to the library follows the conventions described in the\n\nprevious section on the Database API, so much of that detail is not repeated here. Instead, this section focuses on the technical details of using this module as well as fea- tures that are specific to the sqlite3 module.\n\nF h Lib f L Bdff\n\n304\n\nChapter 17 Python Database Access\n\nModule-Level Functions The following functions are defined by the sqlite3 module:\n\nconnect(database [, timeout [, isolation_level [, detect_types]]])\n\nCreates a connection to a SQLite database. databaseis a string that specifies the name of the database file. It can also be a string \":memory:\", in which case an in-memory database is used (note that this kind of database only persists as long as the Python process remains running and would be lost on program exit).The timeoutparameter specifies the amount of time to wait for an internal reader-writer lock to be released when other connections are updating the database. By default, timeoutis 5 seconds. When SQL statements such as INSERT or UPDATE are used, a new transaction is auto- matically started if one wasn’t already in effect.The isolation_levelparameter is a string that provides an optional modifier to the underlying SQL BEGIN statement that is used to start this transaction. Possible values are \"\" (the default), \"DEFERRED\", \"EXCLUSIVE\", or \"IMMEDIATE\".The meaning of these settings is related to the under- lying database lock and is as follows:\n\nIsolation Level \"\" (empty string) \"DEFERRED\"\n\n\"EXCLUSIVE\"\n\n\"IMMEDIATE\"\n\nDescription Use the default setting (DEFERRED). Starts a new transaction, but does not acquire the lock until the first database operation is actually performed. Starts a new transaction and guarantees that no other connections can read or write the database until changes are committed. Starts a new transaction and guarantees that no other connection can make database modifications until changes are committed. Other connections can still read from the database, however.\n\nThe detect_typesparameter enables some extra type detection (implemented by extra parsing of SQL queries) when returning results. By default it is 0 (meaning no extra detection). It can be set to the bitwise-or of PARSE_DECLTYPES and PARSE_COLNAMES. If PARSE_DECLTYPES is enabled, queries are examined for SQL type- names such as \"integer\" or \"number(8)\" in order to determine the type of result columns. If PARSE_COLNAMES is enabled, special strings of the form \"colname [typename]\" (including the double quotes) can be embedded into queries where colnameis the column name and typenameis the name of a type registered with the register_converter() function described next.These strings are simply transformed into colnamewhen passed to the SQLite engine, but the extra type specifier is used when converting values in the results of a query. For example, a query such as 'select price as \"price [decimal]\" from portfolio' is interpreted as 'select price as price from portfolio', and the results will be converted according to the “dec- imal” conversion rule.\n\nregister_converter(typename, func)\n\nRegisters a new type name for use with the detect_typesoption to connect(). typenameis a string containing the type name as it will be used in queries, and funcis a function that takes a single bytestring as input and returns a Python datatype as a result.\n\nF h Lib f L Bdff\n\nsqlite3 Module\n\n305\n\nFor example, if you call sqlite3.register_converter('decimal', decimal. Decimal), then you can have values in queries converted to Decimal objects by writing queries such as 'select price as \"price [decimal]\" from stocks'.\n\nregister_adapter(type, func)\n\nRegisters an adapter function for a Python type typethat is used when storing values of that type in the datatype. funcis a function that accepts an instance of type typeas input and returns a int, float, UTF-8–encoded byte string, Unicode string, or buffer as a result. For example, if you wanted to store Decimal objects, you might use sqlite3.register_adapter(decimal.Decimal,float).\n\ncomplete_statement(s)\n\nReturns True if the string srepresents one or more complete SQL statements separat- ed by semicolons.This might be useful if writing an interactive program that reads queries from the user.\n\nenable_callback_tracebacks(flag)\n\nDetermines the handling of exceptions in user-defined callback functions such as con- verters and adapters. By default, exceptions are ignored. If flagis set to True, traceback messages will be printed on sys.stderr.\n\nConnection Objects The Connection object creturned by the connect() function supports the standard operations described in the Database API. In addition, the following methods specific to the sqlite3 module are provided.\n\nc.create_function(name, num_params, func)\n\nCreates a user-defined function that can be used in SQL statements. nameis a string containing the name of the function, num_paramsis an integer giving the number of parameters, and funcis a Python function that provides the implementation. Here is a simple example:\n\ndef toupper(s):\n\nreturn s.upper()\n\nc.create_function(\"toupper\",1,toupper) # Sample use in a query c.execute(\"select toupper(name),foo,bar from sometable\")\n\nAlthough a Python function is being defined, the parameters and inputs of this function should only be int, float, str, unicode, buffer, or None.\n\nc.create_aggregate(name, num_params, aggregate_class)\n\nCreates a user-defined aggregation function for use in SQL statements. nameis a string containing the name of the function, and num_paramsis an integer giving the number of input parameters. aggregate_classis a class that implements the aggregation operation. This class must support initialization with no arguments and implements a step(params) method that accepts the same number of parameters as given in num_paramsand a finalize() method that returns the final result. Here is a simple example:\n\nclass Averager(object): def __init__(self): self.total = 0.0 self.count = 0\n\nF h Lib f L Bdff\n\n306\n\nChapter 17 Python Database Access\n\ndef step(self,value):\n\nself.total += value self.count += 1 def finalize(self):\n\nreturn self.total / self.count\n\nc.create_aggregate(\"myavg\",1,Averager) # Sample use in a query\n\nc.execute(\"select myavg(num) from sometable\")\n\nAggregation works by making repeated calls to the step() method with input values and then calling finalize() to obtain the final value.\n\nc.create_collation(name, func)\n\nRegisters a user-defined collation function for use in SQL statements. nameis a string containing the name of the collation function, and funcis a function that accepts two inputs and returns -1, 0, 1 depending on whether or not the first input is below, equal to, or above the second input.You use the user-defined function using a SQL expression such as \"select * from table order by colname collate name\".\n\nc.execute(sql [, params])\n\nA shortcut method that creates a cursor object using c.cursor() and executes the cur- sor’s execute() method with SQL statements in sqlwith the parameters in params.\n\nc.executemany(sql [, params])\n\nA shortcut method that creates a cursor object using c.cursor() and executes the cur- sor’s executemany() method with SQL statements in sqlwith the parameters in params.\n\nc.executescript(sql)\n\nA shortcut method that creates a cursor object using c.cursor() and executes the cur- sor’s executescript() method with SQL statements in sql.\n\nc.interrupt()\n\nAborts any currently executing queries on the connection.This is meant to be called from a separate thread.\n\nc.iterdump()\n\nReturns an iterator that dumps the entire database contents to a series of SQL state- ments that could be executed to recreate the database.This could be useful if exporting the database elsewhere or if you need to dump the contents of an in-memory database to a file for later restoration.\n\nc.set_authorizer(auth_callback)\n\nRegisters an authorization callback function that gets executed on every access to a col- umn of data in the database.The callback function must take five arguments as auth_callback(code, arg1, arg2, dbname, innername).The value returned by this callback is one of SQLITE_OK if access is allowed, SQLITE_DENY if the SQL state- ment should fail with an error, or SQLITE_IGNORE if the column should be ignored by treating it as a Null value.The first argument codeis an integer action code. arg1and\n\nF h Lib f L Bdff\n\nsqlite3 Module\n\n307\n\narg2are parameters whose values depend on the value of code. dbnameis a string con- taining the name of the database (usually \"main\"), and innernameis the name of the innermost view or trigger that is attempting access or None if no view or trigger is active.The following table lists the values for codeand meaning of the arg1and arg2 parameters:\n\nCode SQLITE_CREATE_INDEX\n\nSQLITE_CREATE_TABLE\n\nSQLITE_CREATE_TEMP_INDEX\n\nSQLITE_CREATE_TEMP_TABLE\n\nSQLITE_CREATE_TEMP_TRIGGER\n\nSQLITE_CREATE_TEMP_VIEW\n\nSQLITE_CREATE_TRIGGER\n\nSQLITE_CREATE_VIEW\n\nSQLITE_DELETE\n\nSQLITE_DROP_INDEX\n\nSQLITE_DROP_TABLE\n\nSQLITE_DROP_TEMP_INDEX\n\nSQLITE_DROP_TEMP_TABLE\n\nSQLITE_DROP_TEMP_TRIGGER\n\nSQLITE_DROP_TEMP_VIEW\n\nSQLITE_DROP_TRIGGER\n\nSQLITE_DROP_VIEW\n\nSQLITE_INSERT\n\nSQLITE_PRAGMA\n\nSQLITE_READ\n\nSQLITE_SELECT\n\nArg1 Index name Table name Index name Table name Trigger name View name Trigger name View name Table name Index name Table name Index name Table name Trigger name View name Trigger name View name Table name Pragma name Table name None\n\nArg2 Table name None Table name None Table name None Table name None\n\nNone Table name None Table name None Table name None Table name None\n\nNone\n\nNone Column name None\n\nSQLITE_TRANSACTION\n\nSQLITE_UPDATE\n\nSQLITE_ATTACH\n\nSQLITE_DETACH\n\nSQLITE_ALTER_TABLE\n\nSQLITE_REINDEX\n\nSQLITE_ANALYZE\n\nSQLITE_CREATE_VTABLE\n\nSQLITE_DROP_VTABLE\n\nSQLITE_FUNCTION\n\nNone Table name Filename Database name Database name Index name Table name Table name Table name Function name\n\nNone Column name None\n\nNone Table name None\n\nNone Module name Module name None\n\nc.set_progress_handler(handler, n)\n\nRegisters a callback function that gets executed every ninstructions of the SQLite vir- tual machine. handleris a function that takes no arguments.\n\nF h Lib f L Bdff\n\n308\n\nChapter 17 Python Database Access\n\nThe following attributes are also defined on connection objects.\n\nc.row_factory\n\nA function that gets called to create the object representing the contents of each result row.This function takes two arguments: the cursor object used to obtain the result and a tuple with the raw result row.\n\nc.text_factory\n\nA function that is called to create the objects representing text values in the database. The function must take a single argument that is a UTF-8–encoded byte string.The return value should be some kind of string. By default, a Unicode string is returned.\n\nc.total_changes\n\nAn integer representing the number of rows that have been modified since the database connection was opened.\n\nA final feature of connection objects is that they can be used with the context-\n\nmanager protocol to automatically handle transactions. For example:\n\nconn = sqlite.connect(\"somedb\") with conn:\n\nconn.execute(\"insert into sometable values (?,?)\", (\"foo\",\"bar\")))\n\nIn this example, a commit() operation is automatically performed after all statements in the with block have executed and no errors have occurred. If any kind of exception is raised, a rollback() operation is performed and the exception is reraised.\n\nCursors and Basic Operations To perform basic operations on a sqlite3 database, you first have to create a cursor object using the cursor() method of a connection.You then use the execute(), executemany(), or executescript() methods of the cursor to execute SQL state- ments. See the Database API section for further details about the general operation of these methods. Instead of repeating that information here, a set of common database use cases are presented along with sample code.The goal is to show both the operation of cursor objects and some common SQL operations for those programmers who might need a brief refresher on the syntax.\n\nCreating New Database Tables The following code shows how to open a database and create a new table:\n\nimport sqlite3 conn = sqlite3.connect(\"mydb\") cur = conn.cursor() cur.execute(\"create table stocks (symbol text, shares integer, price real)\") conn.commit()\n\nWhen defining tables, a few primitive SQLite datatypes should be used: text, integer, real, and blob.The blob type is a bytestring, whereas the text type is assumed to be UTF-8–encoded Unicode.\n\nF h Lib f L Bdff\n\nsqlite3 Module\n\n309\n\nInserting New Values into a Table The following code shows how to insert new items into a table:\n\nimport sqlite3 conn = sqlite3.connect(\"mydb\") cur = conn.cursor() cur.execute(\"insert into stocks values (?,?,?)\",('IBM',50,91.10)) cur.execute(\"insert into stocks values (?,?,?)\",('AAPL',100,123.45)) conn.commit()\n\nWhen inserting values, you should always use the ? substitutions as shown. Each ? is replaced by a value from a tuple of values supplied as parameters.\n\nIf you have a sequence of data to insert, you can use the executemany() method of\n\na cursor like this:\n\nstocks = [ ('GOOG',75,380.13),\n\n('AA',60,14.20), ('AIG',125, 0.99) ]\n\ncur.executemany(\"insert into stocks values (?,?,?)\",stocks)\n\nUpdating an Existing Row The following code shows how you might update columns for an existing row:\n\ncur.execute(\"update stocks set shares=? where symbol=?\",(50,'IBM'))\n\nAgain, when you need to insert values into the SQL statement, make sure you use the ? placeholders and supply a tuple of values as parameters.\n\nDeleting Rows The following code shows how to delete rows:\n\ncur.execute(\"delete from stocks where symbol=?\",('SCOX',))\n\nPerforming Basic Queries The following code shows how you can perform basic queries and obtain the results:\n\n# Select all columns from a table for row in cur.execute(\"select * from stocks\"):\n\nstatements\n\n# Select a few columns for shares, price in cur.execute(\"select shares,price from stocks\"):\n\nstatements\n\n# Select matching rows for row in cur.execute(\"select * from stocks where symbol=?\",('IBM',))\n\nstatements\n\n# Select matching rows with ordering for row in cur.execute(\"select * from stocks order by shares\"):\n\nstatements\n\n# Select matching rows with ordering in reverse for row in cur.execute(\"select * from stocks order by shares desc\"):\n\nstatements\n\n# Joining tables on a common column name (symbol) for row in cur.execute(\"\"\"select s.symbol, s.shares, p.price\n\nfrom stocks as s, prices as p using(symbol)\"\"\"):\n\nstatements\n\nF h Lib f L Bdff\n\n310\n\nChapter 17 Python Database Access\n\nDBM-Style Database Modules Python includes a number of library modules for supporting UNIX DBM-style data- base files. Several standard types of these databases are supported.The dbm module is used to read standard UNIX-dbm database files.The gdbm module is used to read GNU dbm database files (http://www.gnu.org/software/gdbm).The dbhash module is used to read database files created by the Berkeley DB library (http://www.oracle.com/ database/berkeley-db/index.html).The dumbdbm module is a pure-Python module that implements a simple DBM-style database on its own.\n\nAll of these modules provide an object that implements a persistent string-based dic-\n\ntionary.That is, it works like a Python dictionary except that all keys and values are restricted to strings.A database file is typically opened using a variation of the open() function.\n\nopen(filename [, flag [, mode]])\n\nThis function opens the database file filenameand returns a database object. flagis 'r' for read-only access, 'w' for read-write access, 'c' to create the database if it doesn’t exist, or 'n' to force the creation of a new database. modeis the integer file- access mode used when creating the database (the default is 0666 on UNIX).\n\nThe object returned by the open() function minimally supports the following\n\ndictionary-like operations:\n\nOperation d[key] = value\n\nvalue = d[key]\n\ndel d[key]\n\nd.close()\n\nkey in d\n\nDescription Inserts valueinto the database Gets data from the database Removes a database entry Closes the database Tests for a key Writes all changes out to the database\n\nd.sync()\n\nSpecific implementations may also add additional features (consult the appropriate mod- ule reference for details).\n\nOne issue with the various DBM-style database modules is that not every module is\n\ninstalled on every platform. For example, if you use Python on Windows, the dbm and gdbm modules are typically unavailable. However, a program may still want to create a DBM-style database for its own use.To address this issue, Python provides a module anydbm that can be used to open and create a DBM-style database file.This module provides an open() function as described previously, but it is guaranteed to work on all platforms. It does this by looking at the set of available DBM modules and picking the most advanced library that is available (typically dbhash if it’s installed).As a fallback, it uses the dumbdbm module which is always available.\n\nAnother module is whichdb, which has a function whichdb(filename) that can be\n\nused to probe a file in order to determine what kind of DBM-database created it.\n\nAs a general rule, it is probably best not to rely upon these low-level modules for any application where portability is important. For example, if you create a DBM data- base on one machine and then transfer the database file to another machine, there is a chance that Python won’t be able to read it if the underlying DBM module isn’t\n\nF h Lib f L Bdff\n\nshelve Module\n\n311\n\ninstalled.A high degree of caution is also in order if you are using these database mod- ules to store large amounts of data, have a situation where multiple Python programs might be opening the same database file concurrently, or need high reliability and trans- actions (the sqlite3 module might be a safer choice for that).\n\nshelve Module The shelve module provides support for persistent objects using a special “shelf” object.This object behaves like a dictionary except that all the objects it contains are stored on disk using a hash-table based database such as dbhash, dbm or gdbm. Unlike those modules, however, the values stored in a shelf are not restricted to strings. Instead, any object that is compatible with the pickle module may be stored.A shelf is created using the shelve.open() function.\n\nopen(filename [,flag='c' [, protocol [, writeback]]])\n\nOpens a shelf file. If the file doesn’t exist, it’s created. filenameshould be the database filename and should not include a suffix. flaghas the same meaning as described in the chapter introduction and is one of 'r', 'w', 'c', or 'n'. If the database file doesn’t exist, it is created. protocolspecifies the protocol used to pickle objects stored in the database. It has the same meaning as described in the pickle module. writebackcon- trols the caching behavior of the database object. If True, all accessed entries are cached in memory and only written back when the shelf is closed.The default value is False. Returns a shelf object.\n\nOnce a shelf is opened, the following dictionary operations can be performed on it:\n\nOperation d[key] = data\n\ndata = d[key]\n\ndel d[key]\n\nd.has_key(key)\n\nd.keys()\n\nd.close()\n\nDescription Stores data at key. Overwrites existing data. Retrieves data at key. Deletes data at key. Tests for the existence of key. Returns all keys. Closes the shelf. Writes unsaved data to disk.\n\nd.sync()\n\nThe key values for a shelf must be strings.The objects stored in a shelf must be serializ- able using the pickle module.\n\nShelf(dict [, protocol [, writeback]])\n\nA mixin class that implements the functionality of a shelf on top of a dictionary object, dict.When this is used, objects stored in the returned shelf object will be pickled and stored in the underlying dictionary dict. Both protocoland writebackhave the same meaning as for shelve.open().\n\nThe shelve module uses the anydbm module to select an appropriate DBM module\n\nfor use. In most standard Python installations, it is likely to be the dbhash, which relies upon the Berkeley DB library.\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n18\n\nFile and Directory Handling\n\nThis chapter describes Python modules for high-level file and directory handling.\n\nTopics include modules for processing various kinds of basic file encodings such as gzip and bzip2 files, modules for extracting file archives such as zip and tar files, and modules for manipulating the file system itself (e.g., directory listings, moving, renaming, copy- ing, and so on). Low-level operating system calls related to files are covered in Chapter 19,“Operating System Services.” Modules for parsing the contents of files such as XML and HTML are mostly covered in Chapter 24,“Internet Data Handling and Encoding.”\n\nbz2 The bz2 module is used to read and write data compressed according to the bzip2 compression algorithm.\n\nBZ2File(filename [, mode [, buffering [, compresslevel]]])\n\nOpens a .bz2 file, filename, and returns a file-like object. modeis 'r' for reading or 'w' for writing. Universal newline support is also available by specifying a mode of 'rU'. bufferingspecifies the buffer size in bytes with a default value of 0 (no buffer- ing). compresslevelis a number between 1 and 9.A value of 9 (the default) provides the highest level of compression but consumes the most processing time.The returned object supports all the common file operations, including close(), read(), readline(), readlines(), seek(), tell(), write(), and writelines().\n\nBZ2Compressor([compresslevel])\n\nCreates a compressor object that can be used to sequentially compress a sequence of data blocks. compresslevelspecifies the compression level as a number between 1 and 9 (the default).\n\nAn instance, c, of BZ2Compressor has the following two methods:\n\nc.compress(data)\n\nFeeds new string data to the compressor object, c. Returns a string of compressed data if possible. Because compression involves chunks of data, the returned string may not include all the data and may include compressed data from previous calls to compress().The flush() method should be used to return any remaining data stored in the compressor after all input data has been supplied.\n\nF h Lib f L Bdff\n\n314\n\nChapter 18 File and Directory Handling\n\nc.flush()\n\nFlushes the internal buffers and returns a string containing the compressed version of all remaining data.After this operation, no further compress() calls should be made on the object.\n\nBZ2Decompressor()\n\nCreates a decompressor object.\n\nAn instance, d, of BZ2Decompressor supports just one method:\n\nd.decompress(data)\n\nGiven a chunk of compressed data in the string data, this method returns uncom- pressed data. Because data is processed in chunks, the returned string may or may not include a decompressed version of everything supplied in data. Repeated calls to this method will continue to decompress data blocks until an end-of-stream marker is found in the input. If subsequent attempts are made to decompress data after that, an EOFError exception will be raised.\n\ncompress(data [, compresslevel])\n\nReturns a compressed version of the data supplied in the string data. compresslevel is a number between 1 and 9 (the default).\n\ndecompress(data)\n\nReturns a string containing the decompressed data in the string data.\n\nfilecmp The filecmp module provides the following functions, which can be used to compare files and directories:\n\ncmp(file1, file2 [, shallow])\n\nCompares the files file1and file2and returns True if they’re equal, False if not. By default, files that have identical attributes as returned by os.stat() are considered to be equal. If the shallowparameter is specified and is False, the contents of the two files are compared to determine equality.\n\ncmpfiles(dir1, dir2, common [, shallow])\n\nCompares the contents of the files contained in the list commonin the two directories dir1and dir2. Returns a tuple containing three lists of filenames (match, mismatch, errors). matchlists the files that are the same in both directories, mismatchlists the files that don’t match, and errorslists the files that could not be compared for some reason.The shallowparameter has the same meaning as for cmp().\n\ndircmp(dir1, dir2 [, ignore[, hide]])\n\nCreates a directory comparison object that can be used to perform various comparison operations on the directories dir1and dir2. ignoreis a list of filenames to ignore and has a default value of ['RCS','CVS','tags']. hideis a list of filenames to hide and defaults to the list [os.curdir, os.pardir] (['.', '..'] on UNIX).\n\nF h Lib f L Bdff\n\nfilecmp\n\n315\n\nA directory object, d, returned by dircmp() has the following methods and\n\nattributes:\n\nd.report()\n\nCompares directories dir1and dir2and prints a report to sys.stdout.\n\nd.report_partial_closure()\n\nCompares dir1and dir2and common immediate subdirectories. Results are printed to sys.stdout.\n\nd.report_full_closure()\n\nCompares dir1and dir2and all subdirectories recursively. Results are printed to sys.stdout.\n\nd.left_list\n\nLists the files and subdirectories in dir1.The contents are filtered by hideand ignore.\n\nd.right_list\n\nLists the files and subdirectories in dir2.The contents are filtered by hideand ignore.\n\nd.common\n\nLists the files and subdirectories found in both dir1and dir2.\n\nd.left_only\n\nLists the files and subdirectories found only in dir1.\n\nd.right_only\n\nLists the files and subdirectories found only in dir2.\n\nd.common_dirs\n\nLists the subdirectories that are common to dir1and dir2.\n\nd.common_files\n\nLists the files that are common to dir1and dir2.\n\nd.common_funny\n\nLists the files in dir1and dir2with different types or for which no information can be obtained from os.stat().\n\nd.same_files\n\nLists the files with identical contents in dir1and dir2.\n\nd.diff_files\n\nLists the files with different contents in dir1and dir2.\n\nd.funny_files\n\nLists the files that are in both dir1and dir2but that could not be compared for some reason (for example, insufficient permission to access).\n\nd.subdirs\n\nA dictionary that maps names in d.common_dirs to additional dircmp objects.\n\nF h Lib f L Bdff\n\n316\n\nChapter 18 File and Directory Handling\n\nNote\n\nThe attributes of a dircmp object are evaluated lazily and not determined at the time the dircmp object is first created. Thus, if you’re interested in only some of the attrib- utes, there’s no added performance penalty related to the other unused attributes.\n\nfnmatch The fnmatch module provides support for matching filenames using UNIX shell-style wildcard characters.This module only performs filename matching, whereas the glob module can be used to actually obtain file listings.The pattern syntax is as follows:\n\nCharacter(s) *\n\n?\n\n[seq]\n\n[!seq]\n\nDescription Matches everything Matches any single character Matches any character in seq Matches any character not in seq\n\nThe following functions can be used to test for a wildcard match:\n\nfnmatch(filename, pattern)\n\nReturns True or False depending on whether filenamematches pattern. Case sen- sitivity depends on the operating system (and may be non–case-sensitive on certain platforms such as Windows).\n\nfnmatchcase(filename, pattern)\n\nPerforms a case-sensitive comparison of filenameagainst pattern.\n\nfilter(names, pattern)\n\nApplies the fnmatch() function to all of the names in the sequence namesand returns a list of all names that match pattern.\n\nExamples\n\nfnmatch('foo.gif', '*.gif') # Returns True fnmatch('part37.html', 'part3[0-5].html') # Returns False\n\n# Example of finding files in an entire directory tree # using os.walk(), fnmatch, and generators def findall(topdir, pattern):\n\nfor path, files, dirs in os.walk(topdir):\n\nfor name in files:\n\nif fnmatch.fnmatch(name,pattern): yield os.path.join(path,name)\n\n# Find all .py files for pyfile in findall(\".\",\"*.py\"):\n\nprint pyfile\n\nF h Lib f L Bdff\n\ngzip\n\n317\n\nglob The glob module returns all filenames in a directory that match a pattern specified using the rules of the UNIX shell (as described in the fnmatch module).\n\nglob(pattern)\n\nReturns a list of pathnames that match pattern.\n\niglob(pattern)\n\nReturns the same results as glob() but using an iterator.\n\nExample\n\nhtmlfile = glob('*.html') imgfiles = glob('image[0-5]*.gif')\n\nNote\n\nTilde (˜) and shell variable expansion are not performed. Use os.path.expanduser() and os.path.expandvars(), respectively, to perform these expansions prior to call- ing glob().\n\ngzip The gzip module provides a class, GzipFile, that can be used to read and write files compatible with the GNU gzip program. GzipFile objects work like ordinary files except that data is automatically compressed or decompressed.\n\nGzipFile([filename [, mode [, compresslevel [, fileobj]]]])\n\nOpens a GzipFile. filenameis the name of a file, and modeis one of 'r', 'rb', 'a', 'ab', 'w', or 'wb'.The default is 'rb'. compresslevelis an integer from 1 to 9 that controls the level of compression. 1 is the fastest and produces the least compression; 9 is the slowest and produces the most compression (the default). fileobjis an existing file object that should be used. If supplied, it’s used instead of the file named by filename.\n\nopen(filename [, mode [, compresslevel]])\n\nSame as GzipFile(filename, mode, compresslevel).The default mode is 'rb'. The default compresslevelis 9.\n\nNotes\n\nn Calling the close() method of a GzipFile object doesn’t close files passed in\n\nfileobj.This allows additional information to be written to a file after the com- pressed data.\n\nn Files produced by the UNIX compress program are not supported. n This module requires the zlib module.\n\nF h Lib f L Bdff",
      "page_number": 323
    },
    {
      "number": 17,
      "title": "Segment 17 (pages 342-361)",
      "start_page": 342,
      "end_page": 361,
      "detection_method": "synthetic",
      "content": "318\n\nChapter 18 File and Directory Handling\n\nshutil The shutil module is used to perform high-level file operations such as copying, removing, and renaming.The functions in this module should only be used for proper files and directories. In particular, they do not work for special kinds of files on the file system such as named pipes, block devices, etc.Also, be aware that these functions don’t always correctly deal with advanced kinds of file metadata (e.g., resource forks, creator codes, etc.).\n\ncopy(src,dst)\n\nCopies the file srcto the file or directory dst, retaining file permissions. srcand dst are strings.\n\ncopy2(src, dst)\n\nLike copy() but also copies the last access and modification times.\n\ncopyfile(src, dst)\n\nCopies the contents of srcto dst. srcand dstare strings.\n\ncopyfileobj(f1, f2 [, length])\n\nCopies all data from open file object f1to open file object f2. lengthspecifies a max- imum buffer size to use.A negative length will attempt to copy the data entirely with one operation (that is, all data will be read as a single chunk and then written).\n\ncopymode(src, dst)\n\nCopies the permission bits from srcto dst.\n\ncopystat(src, dst)\n\nCopies the permission bits, last access time, and last modification time from srcto dst. The contents, owner, and group of dstare unchanged.\n\ncopytree(src, dst, symlinks [,ignore]])\n\nRecursively copies an entire directory tree rooted at src.The destination directory dst will be created (and should not already exist). Individual files are copied using copy2(). If symlinksis true, symbolic links in the source tree are represented as symbolic links in the new tree. If symlinksis false or omitted, the contents of linked files are copied to the new directory tree. ignoreis an optional function that can be used to filter out specific files.As input, this function should accept a directory name and a list of directo- ry contents.As a return value, it should return a list of filenames to be ignored. If errors occur during the copy process, they are collected and the Error exception is raised at the end of processing.The exception argument is a list of tuples containing (srcname, dstname, exception) for all errors that occurred.\n\nignore_pattern(pattern1, pattern2, ...)\n\nCreates a function that can be used for ignoring all of the glob-style patterns given in pattern1, pattern2, etc.The returned function accepts as input two arguments, the first of which is a directory name and the second of which is a list of directory con- tents.As a result, a list of filenames to be ignored is returned. The primary use of the returned function is as the ignoreparameter to the copytree() function shown earli- er. However, the resulting function might also be used for operations involving the os.walk() function.\n\nF h Lib f L Bdff\n\ntarfile\n\n319\n\nmove(src, dst)\n\nMoves a file or directory srcto dst.Will recursively copy srcif it is being moved to a different file system.\n\nrmtree(path [, ignore_errors [, onerror]])\n\nDeletes an entire directory tree. If ignore_errorsis true, errors will be ignored. Otherwise, errors are handled by the onerrorfunction (if supplied).This function must accept three parameters (func, path, and excinfo), where funcis the function that caused the error (os.remove() or os.rmdir()), pathis the pathname passed to the function, and excinfois the exception information returned by sys.exc_info(). If an error occurs and onerroris omitted, an exception is raised.\n\ntarfile The tarfile module is used to manipulate tar archive files. Using this module, it is possible to read and write tar files, with or without compression.\n\nis_tarfile(name)\n\nReturns True if nameappears to be a valid tar file that can be read by this module.\n\nopen([name [, mode [, fileobj [, bufsize]]]])\n\nCreates a new TarFile object with the pathname name. modeis a string that specifies how the tar file is to be opened.The modestring is a combination of a file mode and a compression scheme specified as 'filemode[:compression]'.Valid combinations include the following:\n\nMode 'r'\n\n'r:' 'r:gz'\n\n'r:bz2' 'a', 'a:' 'w', 'w:' 'w:gz'\n\nDescription Open for reading. If the file is compressed, it is decompressed trans- parently. This is the default mode. Open for reading without compression. Open for reading with gzip compression. Open for reading with bzip2 compression. Open for appending with no compression. Open for writing with no compression. Open for writing with gzip compression. Open for writing with bzip2 compression.\n\n'w:bz2'\n\nThe following modes are used when creating a TarFile object that only allows sequential I/O access (no random seeks):\n\nMode 'r|'\n\n'r|gz'\n\n'r|bz2'\n\n'w|'\n\n'w|gz'\n\nDescription Open a stream of uncompressed blocks for reading Open a gzip compressed stream for reading Open a bzip2 compressed stream for reading Open an uncompressed stream for writing Open a gzip compressed stream for writing Open a bzip2 compressed stream for writing\n\n'w|bz2'\n\nF h Lib f L Bdff\n\n320\n\nChapter 18 File and Directory Handling\n\nIf the parameter fileobjis specified, it must be an open file object. In this case, the file overrides any filename specified with name. bufsizespecifies the block size used in a tar file.The default is 20*512 bytes.\n\nA TarFile instance, t, returned by open() supports the following methods and\n\nattributes:\n\nt.add(name [, arcname [, recursive]])\n\nAdds a new file to the tar archive. nameis the name of any kind of file (directory, sym- bolic link, and so on). arcnamespecifies an alternative name to use for the file inside the archive. recursiveis a Boolean flag that indicates whether or not to recursively add the contents of directories. By default, it is set to True.\n\nt.addfile(tarinfo [, fileobj])\n\nAdds a new object to the tar archive. tarinfois a TarInfo structure that contains information about the archive member. fileobjis an open file object from which data will be read and saved in the archive.The amount of data to read is determined by the size attribute of tarinfo.\n\nt.close()\n\nCloses the tar archive, writing two zero blocks to the end if the archive was opened for writing.\n\nt.debug\n\nControls the amount of debugging information produced, with 0 producing no output and 3 producing all debugging messages. Messages are written to sys.stderr.\n\nt.dereference\n\nIf this attribute is set to True, symbolic and hard links are dereferenced and the entire contents of the referenced file are added to the archive. If it’s set to False, just the link is added.\n\nt.errorlevel\n\nDetermines how errors are handled when an archive member is being extracted. If this attribute is set to 0, errors are ignored. If it’s set to 1, errors result in OSError or IOError exceptions. If it’s set to 2, nonfatal errors additionally result in TarError exceptions.\n\nt.extract(member [, path])\n\nExtracts a member from the archive, saving it to the current directory. memberis either an archive member name or a TarInfo instance. pathis used to specify a different des- tination directory.\n\nt.extractfile(member)\n\nExtracts a member from the archive, returning a read-only file-like object that can be used to read its contents using read(), readline(), readlines(), seek(), and tell() operations. memberis either an archive member name or a TarInfo object. If memberrefers to a link, an attempt will be made to open the target of the link.\n\nt.getmember(name)\n\nLooks up archive member nameand returns a TarInfo object containing information about it. Raises KeyError if no such archive member exists. If member nameappears\n\nF h Lib f L Bdff\n\ntarfile\n\n321\n\nmore than once in the archive, information for the last entry is returned (which is assumed to be the more recent).\n\nt.getmembers()\n\nReturns a list of TarInfo objects for all members of the archive.\n\nt.getnames()\n\nReturns a list of all archive member names.\n\nt.gettarinfo([name [, arcname [, fileobj]]])\n\nReturns a TarInfo object corresponding to a file, name, on the file system or an open file object, fileobj. arcnameis an alternative name for the object in the archive.The primary use of this function is to create an appropriate TarInfo object for use in meth- ods such as add().\n\nt.ignore_zeros\n\nIf this attribute is set to True, empty blocks are skipped when reading an archive. If it’s set to False (the default), an empty block signals the end of the archive. Setting this method to True may be useful for reading a damaged archive.\n\nt.list([verbose])\n\nLists the contents of the archive to sys.stdout. verbosedetermines the level of detail. If this method is set to False, only the archive names are printed. Otherwise, full details are printed (the default).\n\nt.next()\n\nA method used for iterating over the members of an archive. Returns the TarInfo structure for the next archive member or None.\n\nt.posix\n\nIf this attribute is set to True, the tar file is created according to the POSIX 1003.1- 1990 standard.This places restrictions on filename lengths and file size (filenames must be less than 256 characters and files must be less than 8GB in size). If this attribute is set to False, the archive is created using GNU extensions that lift these restrictions.The default value is False.\n\nMany of the previous methods manipulate TarInfo instances.The following table\n\nshows the methods and attributes of a TarInfo instance ti.\n\nAttribute ti.gid\n\nDescription Group ID Group name Returns True if the object is a block device Returns True if the object is a character device Returns True if the object is a device (character, block, or FIFO) Returns True if the object is a directory\n\nti.gname\n\nti.isblk()\n\nti.ischr()\n\nti.isdev()\n\nti.isdir() ti.isfifo() Returns True if the object is a FIFO ti.isfile() Returns True if the object is a regular file ti.islnk() ti.isreg()\n\nReturns True if the object is a hard link Same as isfile()\n\nF h Lib f L Bdff\n\n322\n\nChapter 18 File and Directory Handling\n\nAttribute ti.issym() ti.linkname Target filename of a hard or symbolic link ti.mode\n\nDescription Returns True if the object is a symbolic link\n\nPermission bits Last modification time Archive member name Size in bytes File type that is one of the constants REGTYPE, AREGTYPE, LNKTYPE, SYMTYPE, DIRTYPE, FIFOTYPE, CONTTYPE, CHRTYPE, BLKTYPE, or GNUTYPE_SPARSE User ID Username\n\nti.mtime\n\nti.name\n\nti.size\n\nti.type\n\nti.uid\n\nti.uname\n\nExceptions The following exceptions are defined by the tarfile module:\n\nTarError\n\nBase class for all other exceptions.\n\nReadError\n\nRaised when an error occurs while opening a tar file (for example, when opening an invalid file).\n\nCompressionError\n\nRaised when data can’t be decompressed.\n\nStreamError\n\nRaised when an unsupported operation is performed on a stream-like TarFile object (for instance, an operation that requires random access).\n\nExtractError\n\nRaised for nonfatal errors during extraction (only if errorlevel is set to 2).\n\nExample\n\n# Open a tar file and put some files into it t = tarfile.open(\"foo.tar\",\"w\") t.add(\"README\") import glob for pyfile in glob.glob(\"*.py\"):\n\nt.add(pyfile)\n\nt.close()\n\n# Open a tar file and iterate over all of its members t = tarfile.open(\"foo.tar\") for f in t:\n\nprint(\"%s %d\" % (f.name, f.size))\n\n# Scan a tar file and print the contents of \"README\" files t = tarfile.open(\"foo.tar\")\n\nF h Lib f L Bdff\n\ntempfile\n\n323\n\nfor f in t:\n\nif os.path.basename(f.name) == \"README\":\n\ndata = t.extractfile(f).read() print(\"**** %s ****\" % f.name)\n\ntempfile The tempfile module is used to generate temporary filenames and files.\n\nmkdtemp([suffix [,prefix [, dir]]])\n\nCreates a temporary directory accessible only by the owner of the calling process and returns its absolute pathname. suffixis an optional suffix that will be appended to the directory name, prefixis an optional prefix that will be inserted at the beginning of the directory name, and diris a directory where the temporary directory should be created.\n\nmkstemp([suffix [,prefix [, dir [,text]]]])\n\nCreates a temporary file and returns a tuple (fd, pathname), where fdis an integer file descriptor returned by os.open() and pathnameis absolute pathname of the file. suffixis an optional suffix appended to the filename, prefixis an optional prefix inserted at the beginning of the filename, diris the directory in which the file should be created, and textis a boolean flag that indicates whether to open the file in text mode or binary mode (the default).The creation of the file is guaranteed to be atomic (and secure) provided that the system supports the O_EXCL flag for os.open().\n\nmktemp([suffix [, prefix [,dir]]])\n\nReturns a unique temporary filename. suffixis an optional file suffix to append to the filename, prefixis an optional prefix inserted at the beginning of the filename, and diris the directory in which the file is created.This function only generates a unique filename and doesn’t actually create or open a temporary file. Because this function gen- erates a name before the file is actually opened, it introduces a potential security prob- lem.To address this, consider using mkstemp() instead.\n\ngettempdir()\n\nReturns the directory in which temporary files are created.\n\ngettempprefix()\n\nReturns the prefix used to generate temporary files. Does not include the directory in which the file would reside.\n\nTemporaryFile([mode [, bufsize [, suffix [,prefix [, dir]]]]])\n\nCreates a temporary file using mkstemp() and returns a file-like object that supports the same methods as an ordinary file object. modeis the file mode and defaults to 'w+b'. bufsizespecifies the buffering behavior and has the same meaning as for the open() function. suffix, prefix, and dirhave the same meaning as for mkstemp(). The object returned by this function is only a wrapper around a built-in file object that’s accessible in the file attribute.The file created by this function is automatically destroyed when the temporary file object is destroyed.\n\nF h Lib f L Bdff\n\n324\n\nChapter 18 File and Directory Handling\n\nNamedTemporaryFile([mode [, bufsize [, suffix [,prefix [, dir [, delete ]]]]]])\n\nCreates a temporary file just like TemporaryFile() but makes sure the filename is visi- ble on the file system.The filename can be obtained by accessing the name attribute of the returned file object. Note that certain systems may prevent the file from being reopened using this name until the temporary file has been closed.The deleteparame- ter, if set to True (the default), forces the temporary file to be deleted as soon as it is closed.\n\nSpooledTemporaryFile([max_size [, mode [, bufsize [, suffix [, prefix [, dir]]]]]])\n\nCreates a temporary file such as TemporaryFile except that the file contents are entirely held in memory until they exceed the size given in max_size.This internal spooling is implemented by first holding the file contents in a StringIO object until it is necessary to actually go to the file system. If any kind of low-level file I/O operation is performed involving the fileno() method, the memory contents are immediately written to a proper temporary file as defined by the TemporaryFile object. The file object returned by SpooledTemporaryFile also has a method rollover() that can be used to force the contents to be written to the file system.\n\nTwo global variables are used to construct temporary names.They can be assigned to\n\nnew values if desired.Their default values are system-dependent.\n\nVariable tempdir\n\ntemplate\n\nDescription The directory in which filenames returned by mktemp() reside. The prefix of filenames generated by mktemp(). A string of decimal dig- its is added to template to generate unique filenames.\n\nNote\n\nBy default, the tempfile module creates files by checking a few standard locations. For example, on UNIX, files are created in one of /tmp, /var/tmp, or /usr/tmp. On Windows, files are created in one of C:\\TEMP, C:\\TMP, \\TEMP, or \\TMP. These directo- ries can be overridden by setting one or more of the TMPDIR, TEMP, and TMP environ- ment variables. If, for whatever reason, temporary files can’t be created in any of the usual locations, they will be created in the current working directory.\n\nzipfile The zipfile module is used to manipulate files encoded in the popular zip format (originally known as PKZIP, although now supported by a wide variety of programs). Zip files are widely used by Python, mainly for the purpose of packaging. For example, if zip files containing Python source code are added to sys.path, then files contained within the zip file can be loaded via import (the zipimport library module implements this functionality, although it’s never necessary to use that library directly). Packages dis- tributed as .egg files (created by the setuptools extension) are also just zip files in dis- guise (an .egg file is actually just a zip file with some extra metadata added to it).\n\nF h Lib f L Bdff\n\nzipfile\n\n325\n\nThe following functions and classes are defined by the zipfile module:\n\nis_zipfile(filename)\n\nTests filenameto see if it’s a valid zip file. Returns True if filenameis a zip file; returns False otherwise.\n\nZipFile(filename [, mode [, compression [,allowZip64]]])\n\nOpens a zip file, filename, and returns a ZipFile instance. modeis 'r' to read from an existing file, 'w' to truncate the file and write a new file, or 'a' to append to an existing file. For 'a' mode, if filenameis an existing zip file, new files are added to it. If filenameis not a zip file, the archive is simply appended to the end of the file. compressionis the zip compression method used when writing to the archive and is either ZIP_STORED or ZIP_DEFLATED.The default is ZIP_STORED.The allowZip64 argument enables the use of ZIP64 extensions, which can be used to create zip files that exceed 2GB in size. By default, this is set to False.\n\nPyZipFile(filename [, mode[, compression [,allowZip64]]])\n\nOpens a zip file like ZipFile() but returns a special PyZipFile instance with one extra method, writepy(), used to add Python source files to the archive.\n\nZipInfo([filename [, date_time]])\n\nManually creates a new ZipInfo instance, used to contain information about an archive member. Normally, it’s not necessary to call this function except when using the z.writestr() method of a ZipFile instance (described later).The filenameand date_timearguments supply values for the filenameand date_timeattributes described below.\n\nAn instance, z, of ZipFile or PyZipFile supports the following methods and\n\nattributes:\n\nz.close()\n\nCloses the archive file.This must be called in order to flush records to the zip file before program termination.\n\nz.debug\n\nDebugging level in the range of 0 (no output) to 3 (most output).\n\nz.extract(name [, path [, pwd ]])\n\nExtracts a file from the archive and places it in the current working directory. nameis either a string that fully specifies the archive member or a ZipInfo instance. pathspec- ifies a different directory in which the file will extracted, and pwdis the password to use for encrypted archives.\n\nz.extractall([path [members [, pwd]]])\n\nExtracts all members of an archive into the current working directory. pathspecifies a different directory, and pwdis a password for encrypted archives. membersis a list of members to extract, which must be a proper subset of the list returned by the namelist() method (described next).\n\nF h Lib f L Bdff\n\n326\n\nChapter 18 File and Directory Handling\n\nz.getinfo(name)\n\nReturns information about the archive member name as a ZipInfo instance (described shortly).\n\nz.infolist()\n\nReturns a list of ZipInfo objects for all the members of the archive.\n\nz.namelist()\n\nReturns a list of the archive member names.\n\nz.open(name [, mode [, pwd]])\n\nOpens an archive member named nameand returns a file-like object for reading the contents. namecan either be a string or a ZipInfo instance describing one of the archive members. modeis the file mode and must be one of the read-only file modes such as 'r', 'rU', or 'U'. pwdis the password to use for encrypted archive members. The file object that is returned supports the read(), readline(), and readlines() methods as well as iteration with the for statement.\n\nz.printdir()\n\nPrints the archive directory to sys.stdout.\n\nz.read(name [,pwd])\n\nReads archive contents for member nameand returns the data as a string. nameis either a string or a ZipInfo instance describing the archive member. pwdis the password to use for encrypted archive members.\n\nz.setpassword(pwd)\n\nSets the default password used to extract encrypted files from the archive.\n\nz.testzip()\n\nReads all the files in the archive and verifies their CRC checksums. Returns the name of the first corrupted file or None if all files are intact.\n\nz.write(filename[, arcname[, compress_type]])\n\nWrites filenameto the archive with the archive name arcname. compress_typeis the compression parameter and is either ZIP_STORED or ZIP_DEFLATED. By default, the compression parameter given to the ZipFile() or PyZipFile() function is used.The archive must be opened in 'w' or 'a' mode for writes to work.\n\nz.writepy(pathname)\n\nThis method, available only with PyZipFile instances, is used to write Python source files (*.py files) to a zip archive and can be used to easily package Python applications for distribution. If pathnameis a file, it must end with .py. In this case, one of the cor- responding .pyo, .pyc, or .py files will be added (in that order). If pathnameis a directory and the directory is not a Python package directory, all the corresponding .pyo, .pyc, or .py files are added at the top level. If the directory is a package, the files are added under the package name as a file path. If any subdirectories are also package directories, they are added recursively.\n\nF h Lib f L Bdff\n\nzipfile\n\n327\n\nz.writestr(arcinfo, s)\n\nWrites the string sinto the zip file. arcinfois either a filename within the archive in which the data will be stored or a ZipInfo instance containing a filename, date, and time.\n\nZipInfo instances ireturned by the ZipInfo(), z.getinfo(), and z.infolist()\n\nfunctions have the following attributes:\n\nAttribute i.filename\n\nDescription Archive member name. Tuple (year,month,day,hours,minutes,seconds) con- taining the last modification time. monthand dayare numbers in the range 1–12 and 1–31, respectively. All other values start at 0. Compression type for the archive member. Only ZIP_STORED and ZIP_DEFLATED are currently supported by this module. Archive member comment. Expansion field data, used to contain additional file attributes. The data stored here depends on the system that created the file. Integer code describing the system that created the archive. Common values are 0 (MS-DOS FAT), 3 (UNIX), 7 (Macintosh), and 10 (Windows NTFS). PKZIP version code that created the zip archive. i.create_version i.extract_version Minimum version needed to extract the archive. i.reserved\n\ni.date_time\n\ni.compress_type\n\ni.comment\n\ni.extra\n\ni.create_system\n\ni.flag_bits\n\ni.volume\n\ni.internal_attr\n\ni.external_attr\n\ni.header_offset\n\ni.file_offset\n\ni.CRC\n\ni.compress_size\n\nReserved field. Currently set to 0. Zip flag bits that describe the data encoding including encryp- tion and compression. Volume number of the file header. Describes the internal structure of the archive contents. If the low-order bit is 1, the data is ASCII text. Otherwise, binary data is assumed. External file attributes which are operating system dependent. Byte offset to the file header. Byte offset to the start of the file data. CRC checksum of the uncompressed file. Size of the compressed file data. Size of the uncompressed file.\n\ni.file_size\n\nNote\n\nDetailed documentation about the internal structure of zip files can be found as a PKZIP Application Note at http://www.pkware.com/appnote.html.\n\nF h Lib f L Bdff\n\n328\n\nChapter 18 File and Directory Handling\n\nzlib The zlib module supports data compression by providing access to the zlib library.\n\nadler32(string [, value])\n\nComputes the Adler-32 checksum of string. valueis used as the starting value (which can be used to compute a checksum over the concatenation of several strings). Otherwise, a fixed default value is used.\n\ncompress(string [, level])\n\nCompresses the data in string, where levelis an integer from 1 to 9 controlling the level of compression. 1 is the least (fastest) compression, and 9 is the best (slowest) com- pression.The default value is 6. Returns a string containing the compressed data or rais- es error if an error occurs.\n\ncompressobj([level])\n\nReturns a compression object. levelhas the same meaning as in the compress() function.\n\ncrc32(string [, value])\n\nComputes a CRC checksum of string. If valueis present, it’s used as the starting value of the checksum. Otherwise, a fixed value is used.\n\ndecompress(string [, wbits [, buffsize]])\n\nDecompresses the data in string. wbitscontrols the size of the window buffer, and buffsizeis the initial size of the output buffer. Raises error if an error occurs.\n\ndecompressobj([wbits])\n\nReturns a compression object.The wbitsparameter controls the size of the window buffer.\n\nA compression object, c, has the following methods:\n\nc.compress(string)\n\nCompresses string. Returns a string containing compressed data for at least part of the data in string.This data should be concatenated to the output produced by earlier calls to c.compress() to create the output stream. Some input data may be stored in internal buffers for later processing.\n\nc.flush([mode])\n\nCompresses all pending input and returns a string containing the remaining compressed output. modeis Z_SYNC_FLUSH, Z_FULL_FLUSH, or Z_FINISH (the default). Z_SYNC_FLUSH and Z_FULL_FLUSH allow further compression and are used to allow partial error recovery on decompression. Z_FINISH terminates the compression stream.\n\nA decompression object, d, has the following methods and attributes:\n\nd.decompress(string [,max_length])\n\nDecompresses stringand returns a string containing uncompressed data for at least part of the data in string.This data should be concatenated with data produced by earlier calls to decompress() to form the output stream. Some input data may be\n\nF h Lib f L Bdff\n\nzlib\n\n329\n\nstored in internal buffers for later processing. max_lengthspecifies the maximum size of returned data. If exceeded, unprocessed data will be placed in the d.unconsumed_tail attribute.\n\nd.flush()\n\nAll pending input is processed, and a string containing the remaining uncompressed output is returned.The decompression object cannot be used again after this call.\n\nd.unconsumed_tail\n\nString containing data not yet processed by the last decompress() call.This would contain data if decompression needs to be performed in stages due to buffer size limita- tions. In this case, this variable would be passed to subsequent decompress() calls.\n\nd.unused_data\n\nString containing extra bytes that remain past the end of the compressed data.\n\nNote\n\nThe zlib library is available at http://www.zlib.net.\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n19\n\nOperating System Services\n\nThe modules in this chapter provide access to a wide variety of operating system\n\nservices with an emphasis on low-level I/O, process management, and the operating environment. Modules that are commonly used in conjunction with writing systems programs are also included—for example, modules to read configuration files, write log files, and so forth. Chapter 18,“File and Directory Handling,” covers high-level modules related to file and filesystem manipulation—the material presented here tends be at a lower level than that.\n\nMost of Python’s operating system modules are based on POSIX interfaces. POSIX is a standard that defines a core set of operating system interfaces. Most UNIX systems support POSIX, and other platforms such as Windows support large portions of the interface.Throughout this chapter, functions and modules that only apply to a specific platform are noted as such. UNIX systems include both Linux and Mac OS X. Windows systems include all versions of Windows unless otherwise noted.\n\nReaders may want to supplement the material presented here with additional refer- ences. The C Programming Language, Second Edition by Brian W. Kernighan and Dennis M. Ritchie (Prentice Hall, 1989) provides a good overview of files, file descriptors, and the low-level interfaces on which many of the modules in this section are based. More advanced readers may want to consult a book such as Advanced Programming in the UNIX Environment, 2nd Edition by W. Richard Stevens and Stephen Rago (Addison Wesley, 2005). For an overview of general concepts, you may want to locate a college textbook on operating systems. However, given the high cost and limited day-to-day practical utility of these books, you’re probably better off asking a nearby computer science stu- dent to loan you their copy for a weekend.\n\ncommands The commands module is used to execute simple system commands specified as a string and return their output as a string. It only works on UNIX systems.The functionality provided by this module is somewhat similar to using backquotes (`) in a UNIX shell script. For example, typing x = commands.getoutput('ls –l') is similar to saying x=`ls –l`.\n\ngetoutput(cmd)\n\nExecutes cmdin a shell and returns a string containing both the standard output and standard error streams of the command.\n\nF h Lib f L Bdff\n\n332\n\nChapter 19 Operating System Services\n\ngetstatusoutput(cmd)\n\nLike getoutput(), except that a 2-tuple (status, output) is returned, where statusis the exit code, as returned by the os.wait() function, and outputis the string returned by getoutput().\n\nNotes\n\nn This module is only available in Python 2. In Python 3, both of the previous\n\nfunctions are found in the subprocess module.\n\nn Although this module can be used for simple shell operations, you are almost\n\nalways better off using the subprocess module for launching subprocesses and collecting their output.\n\nSee Also:\n\nsubprocess (p. 402)\n\nConfigParser, configparser The ConfigParser module (called configparser in Python 3) is used to read .ini format configuration files based on the Windows INI format.These files consist of named sections, each with its own variable assignments such as the following:\n\n# A comment ; A comment [section1] name1 = value1 name2 = value2\n\n[section2] ; Alternative syntax for assigning values name1: value1 name2: value2 ...\n\nThe ConfigParser Class The following class is used to manage configuration variables:\n\nConfigParser([defaults [, dict_type]])\n\nCreates a new ConfigParser instance. defaultsis an optional dictionary of values that can be referenced in configuration variables by including string format specifiers such as '%(key)s’ where keyis a key of defaults. dict_typespecifies the type of dictionary that is used internally for storing configuration variables. By default, it is dict (the built-in dictionary).\n\nAn instance cof ConfigParser has the following operations:\n\nc.add_section(section)\n\nAdds a new section to the stored configuration parameters. sectionis a string with the section name.\n\nF h Lib f L Bdff\n\nConfigParser, configparser\n\n333\n\nc.defaults()\n\nReturns the dictionary of default values.\n\nc.get(section, option [, raw [, vars]])\n\nReturns the value of option optionfrom section sectionas a string. By default, the returned string is processed through an interpolation step where format strings such as '%(option)s' are expanded. In this case, optionmay the name of another configura- tion option in the same section or one of the default values supplied in the defaults parameter to ConfigParser. rawis a Boolean flag that disables this interpolation fea- ture, returning the option unmodified. varsis an optional dictionary containing more values for use in '%' expansions.\n\nc.getboolean(section, option)\n\nReturns the value of optionfrom section sectionconverted to Boolean value.Values such as \"0\", \"true\", \"yes\", \"no\", \"on\", and \"off\" are all understood and checked in a case-insensitive manner.Variable interpolation is always performed by this method (see c.get()).\n\nc.getfloat(section, option)\n\nReturns the value of optionfrom section sectionconverted to a float with variable interpolation.\n\nc.getint(section, option)\n\nReturns the value of optionfrom section sectionconverted to an integer with vari- able interpolation.\n\nc.has_option(section, option)\n\nReturns True if section sectionhas an option named option.\n\nc.has_section(section)\n\nReturns True if there is a section named section.\n\nc.items(section [, raw [, vars]])\n\nReturns a list of (option, value) pairs from section section. rawis a Boolean flag that disables the interpolation feature if set to True. varsis a dictionary of additional values that can be used in '%’ expansions.\n\nc.options(section)\n\nReturns a list of all options in section section.\n\nc.optionxform(option)\n\nTransforms the option name optionto the string that’s used to refer to the option. By default, this is a lowercase conversion.\n\nc.read(filenames)\n\nReads configuration options from a list of filenames and stores them. filenamesis either a single string, in which case that is the filename that is read, or a list of file- names. If any of the given filenames can’t be found, they are ignored.This is useful if you want to read configuration files from many possible locations, but where such files may or may not be defined.A list of the successfully parsed filenames is returned.\n\nF h Lib f L Bdff\n\n334\n\nChapter 19 Operating System Services\n\nc.readfp(fp [, filename])\n\nReads configuration options from a file-like object that has already been opened in fp. filenamespecifies the filename associated with fp(if any). By default, the filename is taken from fp.name or is set to '<???>' if no such attribute is defined.\n\nc.remove_option(section, option)\n\nRemoves optionfrom section section.\n\nc.remove_section(section)\n\nRemoves section section.\n\nc.sections()\n\nReturns a list of all section names.\n\nc.set(section, option, value)\n\nSets a configuration option optionto valuein section section. valueshould be a string.\n\nc.write(file)\n\nWrites all of the currently held configuration data to file. fileis a file-like object that has already been opened.\n\nExample The ConfigParser module is often overlooked, but it is an extremely useful tool for controlling programs that have an extremely complicated user configuration or runtime environment. For example, if you’re writing a component that has to run inside of a large framework, a configuration file is often an elegant way to supply runtime parame- ters. Similarly, a configuration file may be a more elegant approach than having a pro- gram read large numbers of command-line options using the optparse module.There are also subtle, but important, differences between using configuration files and simply reading configuration data from a Python source script.\n\nThe following few examples illustrate some of the more interesting features of the\n\nConfigParser module. First, consider a sample .ini file:\n\n# appconfig.ini # Configuration file for my mondo application\n\n[output] LOGFILE=%(LOGDIR)s/app.log LOGGING=on LOGDIR=%(BASEDIR)s/logs\n\n[input] INFILE=%(INDIR)s/initial.dat INDIR=%(BASEDIR)s/input\n\nF h Lib f L Bdff\n\nConfigParser, configparser\n\n335\n\nThe following code illustrates how you read a configuration file and supply default val- ues to some of the variables:\n\nfrom configparser import ConfigParser # Use from ConfigParser in Python 2\n\n# Dictionary of default variable settings defaults = {\n\n'basedir' : '/Users/beazley/app'\n\n}\n\n# Create a ConfigParser object and read the .ini file cfg = ConfigParser(defaults) cfg.read('appconfig.ini')\n\nAfter you have read a configuration file, you use the get() method to retrieve option values. For example:\n\n>>> cfg.get('output','logfile') '/Users/beazley/app/logs/app.log' >>> cfg.get('input','infile') '/Users/beazley/app/input/initial.dat' >>> cfg.getboolean('output','logging') True >>>\n\nHere, you immediately see some interesting features. First, configuration parameters are case insensitive.Thus, if your program is reading a parameter 'logfile', it does not matter if the configuration file uses 'logfile', 'LOGFILE', or 'LogFile'. Second, configuration parameters can include variable substitutions such as '%(BASEDIR)s' and '%(LOGDIR)s' as seen in the file.These substitutions are also case insensitive. Moreover, the definition order of configuration parameters does not matter in these substitutions. For example, in appconfig.ini, the LOGFILE parameter makes a reference to the LOGDIR parameter, which is defined later in the file. Finally, values in configuration files are often interpreted correctly even if they don’t exactly match Python syntax or datatypes. For example, the 'on' value of the LOGGING parameter is interpreted as True by the cfg.getboolean() method.\n\nConfiguration files also have the ability to be merged together. For example, suppose\n\nthe user had their own configuration file with custom settings:\n\n; userconfig.ini ; ; Per-user settings\n\n[output] logging=off\n\n[input] BASEDIR=/tmp\n\nYou can merge the contents of this file in with already loaded configuration parameters. For example:\n\n>>> cfg.read('userconfig.ini') ['userconfig.ini'] >>> cfg.get('output','logfile') '/Users/beazley/app/logs/app.log' >>> cfg.get('output','logging') 'off' >>> cfg.get('input','infile') '/tmp/input/initial.dat' >>>\n\nF h Lib f L Bdff\n\n336\n\nChapter 19 Operating System Services\n\nHere, you will notice that the newly loaded configuration selectively replaces the parameters that were already defined. Moreover, if you change one of the configuration parameters that’s used in variable substitutions of other configuration parameters, the changes correctly propagate. For example, the new setting of BASEDIR in the input section affects previously defined configuration parameters in that section such as INFILE.This behavior is an important but subtle difference between using a config file and simply defining a set of program parameters in a Python script.\n\nNotes Two other classes can be used in place of ConfigParser.The class RawConfigParser provides all of the functionality of ConfigParser but doesn’t perform any variable interpolation.The SafeConfigParser class provides the same functionality as ConfigParser, but it addresses some subtle problems that arise if configuration values themselves literally include special formatting characters used by the interpolation fea- ture (e.g., '%').\n\ndatetime The datetime module provides a variety of classes for representing and manipulating dates and times. Large parts of this module are simply related to different ways of creat- ing and outputting date and time information. Other major features include mathemati- cal operations such as comparisons and calculations of time deltas. Date manipulation is a complex subject, and readers would be strongly advised to consult Python’s online documentation for an introductory background concerning the design of this module.\n\ndate Objects A date object represents a simple date consisting of a year, month, and day.The follow- ing four functions are used to create dates:\n\ndate(year, month, day)\n\nCreates a new date object. yearis an integer in the range datetime.MINYEAR to datetime.MAXYEAR. monthis an integer in the range 1 to 12, and dayis an integer in the range 1 to the number of days in the given month.The returned date object is immutable and has the attributes year, month, and daycorresponding to the values of the supplied arguments.\n\ndate.today()\n\nA class method that returns a date object corresponding to the current date.\n\ndate.fromtimestamp(timestamp)\n\nA class method that returns a date object corresponding to the timestamp timestamp. timestampis a value returned by the time.time() function.\n\ndate.fromordinal(ordinal)\n\nA class method that returns a date object corresponding to an ordinalnumber of days from the minimum allowable date (January 1 of year 1 has ordinal value 1 and January 1, 2006 has ordinal value 732312).\n\nF h Lib f L Bdff\n\ndatetime\n\n337\n\nThe following class attributes describe the maximum rate and resolution of date\n\ninstances.\n\ndate.min\n\nClass attribute representing the earliest date that can be represented (datetime.date(1,1,1)).\n\ndate.max\n\nClass attribute representing the latest possible date (datetime.date(9999,12,31)).\n\ndate.resolution\n\nSmallest resolvable difference between non-equal date objects (datetime.timedelta(1)).\n\nAn instance, d, of date has read-only attributes d.year, d.month, and d.day and\n\nadditionally provides the following methods:\n\nd.ctime()\n\nReturns a string representing the date in the same format as normally used by the time.ctime() function.\n\nd.isocalendar()\n\nReturns the date as a tuple (iso_year, iso_week, iso_weekday), where iso_week is in the range 1 to 53 and iso_weekdayis the range 1 (Monday) to 7 (Sunday).The first iso_weekis the first week of the year that contains a Thursday.The range of values for the three tuple components are determined by the ISO 8601 standard.\n\nd.isoformat()\n\nReturns an ISO 8601–formatted string of the form 'YYYY-MM-DD' representing the date.\n\nd.isoweekday()\n\nReturns the day of the week in the range 1 (Monday) to 7 (Sunday).\n\nd.replace([year [, month [, day ]]])\n\nReturns a new date object with one or more of the supplied components replaced by a new value. For example, d.replace(month=4) returns a new date where the month has been replaced by 4.\n\nd.strftime(format)\n\nReturns a string representing the date formatted according to the same rules as the time.strftime() function.This function only works for dates later than the year 1900. Moreover, format codes for components missing from date objects (such as hours, minutes, and so on) should not be used.\n\nd.timetuple()\n\nReturns a time.struct_time object suitable for use by functions in the time module. Values related to the time of day (hours, minutes, seconds) will be set to 0.\n\nd.toordinal()\n\nConverts dto an ordinal value. January 1 of year 1 has ordinal value 1.\n\nF h Lib f L Bdff",
      "page_number": 342
    },
    {
      "number": 18,
      "title": "Segment 18 (pages 362-380)",
      "start_page": 362,
      "end_page": 380,
      "detection_method": "synthetic",
      "content": "338\n\nChapter 19 Operating System Services\n\nd.weekday()\n\nReturns the day of the week in the range 0 (Monday) to 6 (Sunday).\n\ntime Objects time objects are used to represent a time in hours, minutes, seconds, and microseconds. Times are created using the following class constructor:\n\ntime(hour [, minute [, second [, microsecond [, tzinfo]]]])\n\nCreates a time object representing a time where 0 <= hour < 24, 0 <= minute < 60, 0 <= second < 60, and 0 <= microsecond < 1000000. tzinfoprovides time zone information and is an instance of the tzinfo class described later in this section. The returned time object has the attributes hour, minute, second, microsecond, and tzinfo, which hold the corresponding values supplied as arguments.\n\nThe following class attributes of time describe the range of allowed values and reso-\n\nlution of time instances:\n\ntime.min\n\nClass attribute representing the minimum representable time (datetime.time(0,0)).\n\ntime.max\n\nClass attribute representing the maximum representable time (datetime.time(23,59, 59, 999999)).\n\ntime.resolution\n\nSmallest resolvable difference between non-equal time objects (datetime.timedelta(0,0,1)).\n\nAn instance, t, of a time object has attributes t.hour, t.minute, t.second,\n\nt.microsecond, and t.tzinfo in addition to the following methods:\n\nt.dst()\n\nReturns the value of t.tzinfo.dst(None).The returned object is a timedelta object. If no time zone is set, None is returned.\n\nt.isoformat()\n\nReturns a string representing the time as 'HH:MM:SS.mmmmmm'. If the microseconds are 0, that part of the string is omitted. If time zone information has been supplied, the time may have an offset added to it (for example, 'HH:MM:SS.mmmmmm+HH:MM').\n\nt.replace([hour [, minute [, second [, microsecond [, tzinfo ]]]]])\n\nReturns a new time object, where one or more components have been replaced by the supplied values. For example, t.replace(second=30) changes the seconds field to 30 and returns a new time object.The arguments have the same meaning as those supplied to the time() function shown earlier.\n\nt.strftime(format)\n\nReturns a string formatted according to the same rules as the time.strftime() func- tion in the time module. Because date information is unavailable, only the formatting codes for time-related information should be used.\n\nF h Lib f L Bdff\n\ndatetime\n\n339\n\nt.tzname()\n\nReturns the value of t.tzinfo.tzname(). If no time zone is set, None is returned.\n\nt.utcoffset()\n\nReturns the value of t.tzinfo.utcoffset(None).The returned object is a timedelta object. If no time zone has been set, None is returned.\n\ndatetime objects datetime objects are used to represent dates and times together.There are many possi- ble ways to create a datetime instance:\n\ndatetime(year, month, day [, hour [, minute [, second [, microsecond [, tzinfo]]]]])\n\nCreates a new datetime object that combines all the features of date and time objects.The arguments have the same meaning as arguments provided to date() and time().\n\ndatetime.combine(date,time)\n\nA class method that creates a datetime object by combining the contents of a date object, date, and a time object, time.\n\ndatetime.fromordinal(ordinal)\n\nA class method that creates a datetime object given an ordinal day (integer number of days since datetime.min).The time components are all set to 0, and tzinfois set to None.\n\ndatetime.fromtimestamp(timestamp [, tz])\n\nA class method that creates a datetime object from a timestamp returned by the time.time() function. tzprovides optional time zone information and is a tzinfo instance.\n\ndatetime.now([tz])\n\nA class method that creates a datetime object from the current local date and time. tz provides optional time zone information and is an instance of tzinfo.\n\ndatetime.strptime(datestring, format)\n\nA class method that creates a datetime object by parsing the date string in datestringaccording to the date format in format.The parsing is performed using the strptime() function in the time module.\n\ndatetime.utcfromtimestamp(timestamp)\n\nA class method that creates a datetime object from a timestamp typically returned by time.gmtime().\n\ndatetime.utcnow()\n\nA class method that creates a datetime object from the current UTC date and time.\n\nF h Lib f L Bdff\n\n340\n\nChapter 19 Operating System Services\n\nThe following class attributes describe the range of allowed dates and resolution:\n\ndatetime.min\n\nEarliest representable date and time (datetime.datetime(1,1,1,0,0)).\n\ndatetime.max\n\nLatest representable date and time (datetime. datetime(9999,12,31,23,59,59,999999)).\n\ndatetime.resolution\n\nSmallest resolvable difference between non-equal datetime objects (datetime.timedelta(0,0,1)).\n\nAn instance, d, of a datetime object has the same methods as date and time\n\nobjects combined. In additional, the following methods are available:\n\nd.astimezone(tz)\n\nReturns a new datetime object but in a different time zone, tz.The members of the new object will be adjusted to represent the same UTC time but in the time zone tz.\n\nd.date()\n\nReturns a date object with the same date.\n\nd.replace([year [, month [, day [, hour [, minute [, second [, microsecond [, tzinfo]]]]]]])\n\nReturns a new datetime object with one or more of the listed parameters replaced by new values. Use keyword arguments to replace an individual value.\n\nd.time()\n\nReturns a time object with the same time.The resulting time object has no time zone information set.\n\nd.timetz()\n\nReturns a time object with the same time and time zone information.\n\nd.utctimetuple()\n\nReturns a time.struct_time object containing date and time information normalized to UTC time.\n\ntimedelta objects timedelta objects represent the difference between two dates or times.These objects are normally created as the result of computing a difference between two datetime instances using the - operator. However, they can be manually constructed using the following class:\n\ntimedelta([days [, seconds [, microseconds [, milliseconds [, minutes [, hours [, weeks ]]]]]]])\n\nCreates a timedelta object that represents the difference between two dates and times. The only significant parameters are days, seconds, and microseconds, which are used internally to represent a difference.The other parameters, if supplied, are converted into days, seconds, and microseconds.The attributes days, seconds, and microseconds of the returned timedelta object contain these values.\n\nF h Lib f L Bdff\n\ndatetime\n\n341\n\nThe following class attributes describe the maximum range and resolution of\n\ntimedelta instances:\n\ntimedelta.min\n\nThe most negative timedelta object that can be represented (timedelta(-999999999))\n\ntimedelta.max\n\nThe most positive timedelta object that can be represented (timedelta(days=999999999, hours=23, minutes=59, seconds=59, microseconds=999999)).\n\ntimedelta.resolution\n\nA timedelta object representing the smallest resolvable difference between non-equal timedelta objects (timedelta(microseconds=1)).\n\nMathematical Operations Involving Dates A significant feature of the datetime module is that it supports mathematical opera- tions involving dates. Both date and datetime objects support the following operations:\n\nOperation td = date1 - date2\n\ndate2 = date1 + td\n\ndate2 = date1 - td\n\ndate1 < date2\n\nDescription Returns a timedelta object Adds a timedelta to a date Subtracts a timedelta from a date Date comparison\n\ndate1 <= date2\n\ndate1 == date2\n\ndate1 != date2\n\ndate1 > date2\n\ndate1 >= date2\n\nWhen comparing dates, you must use care when time zone information has been sup- plied. If a date includes tzinfo information, that date can only be compared with other dates that include tzinfo; otherwise, a TypeError is generated.When two dates in dif- ferent time zones are compared, they are first adjusted to UTC before being compared.\n\ntimedelta objects also support a variety of mathematical operations:\n\nOperation td3 = td2 + td1\n\ntd3 = td2 - td1\n\ntd2 = td1 * i\n\nDescription Adds two time deltas Subtracts two time deltas Multiplication by an integer\n\ntd2 = i * td2\n\ntd2 = td1 // i\n\ntd2 = -td1\n\nFloor division by an integer, i Unary subtraction, addition\n\ntd2 = +td1\n\nabs(td)\n\nAbsolute value\n\nF h Lib f L Bdff\n\n342\n\nChapter 19 Operating System Services\n\nOperation td1 < td2\n\nDescription Comparison\n\ntd1 <= td2\n\ntd1 == td2\n\ntd1 != td2\n\ntd1 > td2\n\ntd1 >= td2\n\nHere are some examples:\n\n>>> today = datetime.datetime.now() >>> today.ctime() 'Thu Oct 20 11:10:10 2005' >>> oneday = datetime.timedelta(days=1) >>> tomorrow = today + oneday >>> tomorrow.ctime() 'Fri Oct 21 11:10:10 2005' >>>\n\nIn addition to these operations, all date, datetime, time, and timedelta objects are immutable.This means that they can be used as dictionary keys, placed in sets, and used in a variety of other operations.\n\ntzinfo Objects Many of the methods in the datetime module manipulate special tzinfo objects that represent information about a time zone. tzinfo is merely a base class. Individual time zones are created by inheriting from tzinfo and implementing the following methods:\n\ntz.dst(dt)\n\nReturns a timedelta object representing daylight savings time adjustments, if applica- ble. Returns None if no information is known about DST.The argument dtis either a datetime object or None.\n\ntz.fromutc(dt)\n\nConverts a datetime object, dt, from UTC time to the local time zone and returns a new datetime object.This method is called by the astimezone() method on datetime objects.A default implementation is already provided by tzinfo, so it’s usu- ally not necessary to redefine this method.\n\ntz.tzname(dt)\n\nReturns a string with the name of the time zone (for example, \"US/Central\"). dtis either a datetime object or None.\n\ntz.utcoffset(dt)\n\nReturns a timedelta object representing the offset of local time from UTC in minutes east of UTC.The offset incorporates all elements that make up the local time, including daylight savings time, if applicable.The argument dtis either a datetimeobject or None.\n\nF h Lib f L Bdff\n\nerrno\n\n343\n\nThe following example shows a basic prototype of how one would define a time\n\nzone:\n\n# Variables that must be defined # TZOFFSET - Timezone offset in hours from UTC. For # example, US/CST is -6 hours # DSTNAME - Name of timezone when DST is in effect # STDNAME - Name of timezone when DST not in effect\n\nclass SomeZone(datetime.tzinfo):\n\ndef utcoffset(self,dt):\n\nreturn datetime.timedelta(hours=TZOFFSET) + self.dst(dt)\n\ndef dst(self,dt):\n\n# is_dst() is a function you must implement to see\n\n# whether DST is in effect according to local timezone rules. if is_dst(dt):\n\nreturn datetime.timedelta(hours=1)\n\nelse:\n\nreturn datetime.timedelta(0)\n\ndef tzname(self,dt):\n\nif is_dst(dt):\n\nreturn DSTNAME\n\nelse:\n\nreturn STDNAME\n\nA number of examples of defining time zones can also be found in the online docu- mentation for datetime.\n\nDate and Time Parsing A common question that arises with date handling is how to parse different kinds of time and date strings into an appropriate datetime object.The only parsing function that is really provided by the datetime module is datetime.strptime(). However, in order to use this, you need to specify the precise date format using various combina- tions of format codes (see time.strptime()). For example, to parse the date string s=\"Aug 23, 2008\", you would have to use d = datetime.datetime.strptime(s, \"%b %d, %Y\").\n\nFor “fuzzy” date parsing that automatically understands a number of common date\n\nformats, you must turn to third-party modules. Go to the Python Package Index (http://pypi.python.org) and do a search for “datetime” to find a wide variety of utili- ty modules that expand the feature set of the datetime module.\n\nSee also:\n\ntime (p. 405)\n\nerrno The errno module defines symbolic names for the integer error codes returned by var- ious operating system calls, especially those found in the os and socket modules.These codes are typically found in the errno attribute of an OSError or IOError exception. The os.strerror() function can be used to translate an error code into a string error message.The following dictionary can also be used to translate an integer error code into its symbolic name:\n\nF h Lib f L Bdff\n\n344\n\nChapter 19 Operating System Services\n\nerrorcode\n\nThis dictionary maps errno integers to symbolic names (such as 'EPERM').\n\nPOSIX Error Codes The following table shows the POSIX symbolic names for common system error codes. The error codes listed here are supported on almost every version of UNIX, Macintosh OS-X, and Windows. Different UNIX systems may provide additional error codes that are less common and not listed here. If such errors occur, you can consult the errorcode dictionary to find the appropriate symbolic name to use in your program.\n\nError Code E2BIG\n\nEACCES\n\nEADDRINUSE\n\nEADDRNOTAVAIL\n\nEAFNOSUPPORT\n\nEAGAIN\n\nEALREADY\n\nEBADF\n\nEBUSY\n\nECHILD\n\nECONNABORTED\n\nECONNREFUSED\n\nECONNRESET\n\nEDEADLK\n\nEDEADLOCK\n\nEDESTADDRREQ\n\nEDOM EDQUOT\n\nEEXIST\n\nEFAULT\n\nEFBIG\n\nEHOSTDOWN\n\nEHOSTUNREACH\n\nEILSEQ\n\nEINPROGRESS\n\nEINTR\n\nEINVAL\n\nEIO\n\nEISCONN\n\nEISDIR\n\nDescription Arg list too long. Permission denied. Address already in use. Cannot assign requested address. Address family not supported by protocol. Try again. Operation already in progress. Bad file number. Device or resource busy. No child processes. Software caused connection abort. Connection refused. Connection reset by peer. Resource deadlock would occur. File-locking deadlock error. Destination address required. Math argument out of domain of function. Quota exceeded. File exists. Bad address. File too large. Host is down. No route to host. Illegal byte sequence. Operation now in progress. Interrupted system call. Invalid argument. I/O error. Transport endpoint is already connected. Is a directory. Too many symbolic links encountered. Too many open files. Too many links.\n\nELOOP\n\nEMFILE\n\nEMLINK\n\nF h Lib f L Bdff\n\nError Code EMSGSIZE\n\nENETDOWN\n\nENETRESET\n\nENETUNREACH\n\nENFILE\n\nENOBUFS\n\nENODEV\n\nENOENT\n\nENOEXEC\n\nENOLCK\n\nENOMEM\n\nENOPROTOOPT\n\nENOSPC\n\nENOSYS\n\nENOTCONN\n\nENOTDIR\n\nENOTEMPTY\n\nENOTSOCK\n\nENOTTY\n\nENXIO\n\nEOPNOTSUPP\n\nEPERM\n\nEPFNOSUPPORT\n\nEPIPE\n\nEPROTONOSUPPORT\n\nEPROTOTYPE\n\nERANGE\n\nEREMOTE\n\nEROFS\n\nESHUTDOWN\n\nESOCKTNOSUPPORT\n\nESPIPE\n\nESRCH\n\nESTALE\n\nETIMEDOUT\n\nETOOMANYREFS\n\nEUSERS\n\nEWOULDBLOCK\n\nEXDEV\n\nerrno\n\n345\n\nDescription Message too long. Network is down. Network dropped connection due to reset. Network is unreachable. File table overflow. No buffer space available. No such device. No such file or directory. Exec format error. No record locks available. Out of memory. Protocol not available. No space left on device. Function not implemented. Transport endpoint is not connected. Not a directory. Directory not empty. Socket operation on non-socket. Not a terminal. No such device or address. Operation not supported on transport endpoint. Operation not permitted. Protocol family not supported. Broken pipe. Protocol not supported. Protocol wrong type for socket. Math result not representable. Object is remote. Read-only file system. Cannot send after transport endpoint shutdown. Socket type not supported. Illegal seek. No such process. Stale NFS file handle. Connection timed out. Too many references: Cannot splice. Too many users. Operation would block. Cross-device link.\n\nF h Lib f L Bdff\n\n346\n\nChapter 19 Operating System Services\n\nWindows Error Codes The error codes in the following table are only available on Windows.\n\nError Code WSAEACCES\n\nWSAEADDRINUSE\n\nWSAEADDRNOTAVAIL\n\nWSAEAFNOSUPPORT\n\nWSAEALREADY\n\nWSAEBADF\n\nWSAECONNABORTED\n\nWSAECONNREFUSED\n\nWSAECONNRESET\n\nWSAEDESTADDRREQ\n\nWSAEDISCON\n\nWSAEDQUOT\n\nWSAEFAULT\n\nWSAEHOSTDOWN\n\nWSAEHOSTUNREACH\n\nWSAEINPROGRESS\n\nWSAEINTR\n\nWSAEINVAL\n\nWSAEISCONN\n\nWSAELOOP\n\nWSAEMFILE\n\nWSAEMSGSIZE\n\nWSAENAMETOOLONG\n\nWSAENETDOWN\n\nWSAENETRESET\n\nWSAENETUNREACH\n\nWSAENOBUFS\n\nWSAENOPROTOOPT\n\nWSAENOTCONN\n\nWSAENOTEMPTY\n\nWSAENOTSOCK\n\nWSAEOPNOTSUPP\n\nWSAEPFNOSUPPORT\n\nWSAEPROCLIM\n\nWSAEPROTONOSUPPORT\n\nWSAEPROTOTYPE\n\nWSAEREMOTE\n\nDescription Permission denied. Address already in use. Cannot assign requested address. Address family not supported by protocol family. Operation already in progress. Invalid file handle. Software caused connection abort. Connection refused. Connection reset by peer. Destination address required. Remote shutdown. Disk quota exceeded. Bad address. Host is down. No route to host. Operation now in progress. Interrupted system call. Invalid argument. Socket already connected. Cannot translate name. Too many open files. Message too long. Name too long. Network is down. Network dropped connection on reset. Network is unreachable. No buffer space is available. Bad protocol option. Socket is not connected. Cannot remove non-empty directory. Socket operation on non-socket. Operation not supported. Protocol family not supported. Too many processes. Protocol not supported. Protocol wrong type for socket. Item not available locally. Cannot send after socket shutdown. Socket type not supported. File handle no longer available. Connection timed out.\n\nWSAESHUTDOWN\n\nWSAESOCKTNOSUPPORT WSAESTALE WSAETIMEDOUT\n\nF h Lib f L Bdff\n\nfcntl\n\n347\n\nError Code WSAETOOMANYREFS\n\nDescription Too many references to a kernel object. Quota exceeded. Resource temporarily unavailable. Successful WSA startup not performed. Network subsystem not available. WSASYSNOTREADY WSAVERNOTSUPPORTED Winsock.dll version out of range.\n\nWSAEUSERS\n\nWSAEWOULDBLOCK\n\nWSANOTINITIALISED\n\nfcntl The fcntl module performs file and I/O control on UNIX file descriptors. File descriptors can be obtained using the fileno() method of a file or socket object.\n\nfcntl(fd, cmd [, arg])\n\nPerforms a command, cmd, on an open file descriptor, fd. cmdis an integer command code. argis an optional argument that’s either an integer or a string. If argis passed as an integer, the return value of this function is an integer. If argis a string, it’s interpret- ed as a binary data structure, and the return value of the call is the contents of the buffer converted back into a string object. In this case, the supplied argument and return value should be less than 1,024 bytes to avoid possible data corruption.The fol- lowing commands are available:\n\nCommand F_DUPFD\n\nF_SETFD\n\nF_GETFD\n\nF_SETFL\n\nF_GETFL\n\nF_GETOWN\n\nF_SETOWN\n\nF_GETLK\n\nDescription Duplicates a file descriptor. argis the lowest number that the new file descriptor can assume. Similar to the os.dup() system call. Sets the close-on-exec flag to arg(0 or 1). If set, the file is closed on an exec() system call. Returns the close-on-exec flag. Sets status flags to arg, which is the bitwise OR of the following: O_NDELAY—Nonblocking I/O (System V) O_APPEND—Append mode (System V) O_SYNC—Synchronous write (System V) FNDELAY—Nonblocking I/O (BSD) FAPPEND—Append mode (BSD) FASYNC—Sends SIGIO signal to process group when I/O is possi- ble (BSD) Gets status flags as set by F_SETFL. Gets process ID or process group ID set to receive SIGIO and SIGURG signals (BSD). Sets process ID or process group ID to receive SIGIO and SIGURG signals (BSD). Returns flock structure used in file-locking operations. Locks a file, returning -1 if the file is already locked. Locks a file but waits if the lock cannot be acquired.\n\nF_SETLK\n\nF_SETLKW\n\nF h Lib f L Bdff\n\n348\n\nChapter 19 Operating System Services\n\nAn IOError exception is raised if the fcntl() function fails.The F_GETLK and F_SETLK commands are supported through the lockf() function.\n\nioctl(fd, op, arg [, mutate_flag])\n\nThis function is like the fcntl() function, except that the operations supplied in op are generally defined in the library module termios.The extra mutate_flagcontrols the behavior of this function when a mutable buffer object is passed as an argument. Further details about this can be found in the online documentation. Because the pri- mary use of ioctl()is to interact with device-drivers and other low-level components of the operating system, its use depends highly on the underlying platform. It should not be used in code that aims to be portable.\n\nflock(fd, op)\n\nPerforms a lock operation, op, on the file descriptor fd. opis the bitwise OR of the following constants, which are found in fnctl:\n\nItem LOCK_EX\n\nLOCK_NB\n\nLOCK_SH\n\nDescription Exclusive lock. All further attempts to acquire the lock will block until the lock is released. Non-blocking mode. Returns immediately with an IOError if the lock is already in use. Shared lock. Blocks any attempts to acquire an exclusive lock (LOCK_EX), but shared locks can still be acquired. Unlock. Releases any previous held lock.\n\nLOCK_UN\n\nIn nonblocking mode, an IOError exception is raised if the lock cannot be acquired. On some systems, the process of opening and locking a file can be performed in a sin- gle operation by adding special flags to the os.open() operation. Consult the os mod- ule for more details.\n\nlockf(fd, op [, len [, start [, whence]]])\n\nPerforms record or range locking on part of a file. opis the same as for the flock() function. lenis the number of bytes to lock. startis the starting position of the lock relative to the value of whence. whenceis 0 for the beginning of the file, 1 for the cur- rent position, and 2 for the end of the file.\n\nExample\n\nimport fcntl\n\n# Open a file f = open(\"foo\",\"w\")\n\n# Set the close-on-exec bit for a file object f fcntl.fcntl(f.fileno(), fcntl.F_SETFD, 1)\n\n# Lock a file (blocking) fcntl.flock(f.fileno(), fcntl.LOCK_EX)\n\nF h Lib f L Bdff\n\nio\n\n349\n\n# Lock the first 8192 bytes of a file (non-blocking) try:\n\nfcntl.lockf(f.fileno(), fcntl.LOCK_EX | fcntl.LOCK_NB, 8192, 0, 0)\n\nexcept IOError,e:\n\nprint \"Unable to acquire lock\", e\n\nNotes\n\nn The set of available fcntl() commands and options is system-dependent.The\n\nfcntl module may contain more than 100 constants on some platforms. n Although locking operations defined in other modules often make use of the\n\ncontext-manager protocol, this is not the case for file locking. If you acquire a file lock, make sure your code is written to properly release the lock.\n\nn Many of the functions in this module can also be applied to the file descriptors of\n\nsockets.\n\nio The io module implements classes for various forms of I/O as well as the built-in open() function that is used in Python 3.The module is also available for use in Python 2.6.\n\nThe central problem addressed by the io module is the seamless handling of differ- ent forms of basic I/O. For example, working with text is slightly different than work- ing with binary data because of issues related to newlines and character encodings.To handle these differences, the module is built as a series of layers, each of which adds more functionality to the last.\n\nBase I/O Interface The io module defines a basic I/O programming interface that all file-like objects implement.This interface is defined by a base class IOBase.An instance fof IOBase supports these basic operations:\n\nAttribute f.closed\n\nf.close()\n\nf.fileno()\n\nf.flush()\n\nf.isatty()\n\nf.readable()\n\nf.readline([limit])\n\nf.readlines([limit])\n\nDescription Flag indicating whether or not the file is closed. Closes the file. Returns the integer file descriptor. Flushes the I/O buffers (if any). Returns True if fis a terminal. Returns True if fwas opened for reading. Reads one line from the stream. limitis the maxi- mum number of bytes to read. Reads all lines from fand return as a list. limit, if provided, is the maximum number of bytes that can be read before stopping. The actual number of bytes read will be slightly greater to accommodate the last line, which is kept intact.\n\nF h Lib f L Bdff\n\n350\n\nChapter 19 Operating System Services\n\nAttribute f.seek(offset, [whence]) Moves the file pointer to a new position relative to the location specified in whence. offsetis the number of bytes. whenceis 0 for the start of the file, 1 for the current position, and 2 for the end of the file. Returns True if fis seekable. Returns the current value of the file pointer. Truncates the file size so that it is at most sizebytes. If sizeisn’t given, it truncates the file to 0 bytes. Returns True if fwas opened for writing. Writes a sequence of lines to f. Line endings are not added so they must already be part of each line.\n\nDescription\n\nf.seekable()\n\nf.tell()\n\nf.truncate([size])\n\nf.writable()\n\nf.writelines(lines)\n\nRaw I/O The lowest level of the I/O system is related to direct I/O involving raw bytes.The core object for this is FileIO, which provides a fairly direct interface to low-level sys- tem calls such as read() and write().\n\nFileIO(name [, mode [, closefd]])\n\nA class for performing raw low-level I/O on a file or system file descriptor. nameis either a filename or an integer file descriptor such as that returned by the os.open() function or the fileno() method of other file objects. modeis one of 'r' (the default); 'w'; or 'a' for reading, writing, or appending.A '+’ can be added to the mode for update mode in which both reading and writing is supported. closefdis a flag that determines if the close() method actually closes the underlying file. By default, this is True, but it can be set False if you’re using FileIO to put a wrapper around a file that was already opened elsewhere. If a filename was given, the resulting file object is opened directly using the operating system’s open() call.There is no internal buffering, and all data is processed as raw byte strings.An instance fof FileIO has all of the basic I/O operations described earlier plus the following attributes and methods:\n\nAttribute f.closefd\n\nf.mode\n\nf.name\n\nf.read([size])\n\nf.readall()\n\nf.write(bytes)\n\nDescription Flag that determines if the underlying file descriptor will be closed on f.close() (read-only). File mode used when opening (read-only). filename (read-only). Reads at most sizebytes using a single system call. If size is omitted, as much data as possible is returned using f.readall(). This operation may returns fewer bytes than requested so you must use len() to check. None is returned if no data is available in non-blocking mode. Reads as much data as is available and returns as a single byte string. An empty string is returned on EOF. In non-blocking mode, only as much data as is immediately available is returned. Writes a byte string or byte-array to fusing a single system call. The number of bytes actually written is returned—which may be less than the number supplied in bytes.\n\nF h Lib f L Bdff\n\nio\n\n351\n\nIt is important to emphasize that FileIO objects are extremely low-level, providing a rather thin layer over operating system calls such as read() and write(). Specifically, users of this object will need to diligently check return codes as there is no guarantee that the f.read() or f.write() operations will read or write all of the requested data. The fcntl module can be used to change low-level aspects of files such as file locking, blocking behavior, and so forth.\n\nFileIO objects should not be used for line-oriented data such as text.Although methods such as f.readline() and f.readlines() are defined, these come from the IOBase base class where they are both implemented entirely in Python and work by issuing f.read() operations for a single byte at a time. Needless to say, the resulting performance is horrible. For example, using f.readline() on a FileIO object fis more than 750 times slower than using f.readline() on a standard file object created by the open() function in Python 2.6.\n\nBuffered Binary I/O The buffered I/O layer contains a collection of file objects that read and write raw binary data, but with in-memory buffering.As input, these objects all require a file object that implements raw I/O such as the FileIO object in the previous section.All of the classes in this section inherit from BufferedIOBase.\n\nBufferedReader(raw [, buffer_size])\n\nA class for buffered binary reading on a raw file specified in raw. buffer_sizespecifies the buffer size to use in bytes. If omitted, the value of DEFAULT_BUFFER_SIZE is used (8,192 bytes as of this writing).An instance fof BufferedReader supports all of the operations provided on IOBase in addition to these operations:\n\nMethod f.peek([n])\n\nf.read([n])\n\nf.read1([n])\n\nf.readinto(b)\n\nDescription Returns at most nbytes of data from the I/O buffer without mov- ing the file pointer. If nis omitted, a single byte is returned. If necessary, a read operation will be issued to fill the buffer if it is currently empty. This operation never returns more bytes than the current buffer size, so the result may be smaller than the request- ed number of bytes in n. Reads nbytes and returns as a byte string. If nis omitted, all available data (up to EOF) is read and returned. If the underlying file is non-blocking, any available data is read and returned. If a non-blocking file is read and no data is available, a BlockingIOError exception is raised. Reads up to nbytes and returns as a byte string using a single system call. If any data is already loaded in the buffer, it is simply returned. Otherwise, a single read() is made on the raw file to return data. Unlike f.read(), this operation may return less data than requested even if the underlying file is not at EOF. Reads len(b) bytes of data from the file into an existing bytearray object b. The actual number of bytes read is returned. If the underlying file is in non-blocking mode, a BlockingIOError exception is raised if no data is available.\n\nF h Lib f L Bdff\n\n352\n\nChapter 19 Operating System Services\n\nBufferedWriter(raw [, buffer_size [, max_buffer_size]])\n\nA class for buffered binary writing on a raw file specified in raw. buffer_sizespecifies the number of bytes that can be saved in the buffer before data is flushed to the under- lying I/O stream.The default value is DEFAULT_BUFFER_SIZE. max_buffer_size specifies the maximum buffer size to use for storing output data that is being written to a non-blocking stream and defaults to twice the value of buffer_size.This value is larger to allow for continued writing while the previous buffer contents are written to the I/O stream by the operating system.An instance fof BufferedWriter supports the following operations:\n\nMethod f.flush()\n\nf.write(bytes)\n\nDescription Writes all bytes stored in the buffer to the underlying I/O stream. Raises a BlockingIOError exception if the file is in non- blocking mode and the operation would block (e.g., if the stream can’t accept any new data at the moment). Writes the bytes in bytesto the I/O stream and returns the number of bytes actually written. If the underlying stream is non- blocking, a BlockingIOError exception is raised if write opera- tion would block.\n\nBufferedRWPair(reader, writer [, buffer_size [, max_buffer_size]])\n\nA class for buffered binary reading and writing on a pair of raw I/O streams. readeris a raw file that supports reading, and writingis a raw file that supports writing.These files may be different, which may be useful for certain kinds of communication involv- ing pipes and sockets.The buffer size parameters have the same meaning as for BufferedWriter.An instance fof BufferedRWPair supports all of the operations for BufferedReader and BufferedWriter.\n\nBufferedRandom(raw [, buffer_size [, max_buffer_size]])\n\nA class for buffered binary reading and writing on a raw I/O stream that supports ran- dom access (e.g., seeking). rawmust be a raw file that supports both read, write, and seek operations.The buffer size parameters have the same meaning as for BufferedWriter.An instance fof BufferedRandom supports all of the operations for BufferedReader and BufferedWriter.\n\nBytesIO([bytes])\n\nAn in-memory file that implements the functionality of a buffered I/O stream. bytesis a byte string that specifies the initial contents of the file.An instance bof BytesIO sup- ports all of the operations of BufferedReader and BufferedWriter objects. In addi- tion, a method b.getvalue() can be used to return the current contents of the file as a byte string.\n\nAs with FileIO objects, all the file objects in this section should not be used with\n\nline-oriented data such as text.Although it’s not quite as bad due to buffering, the resulting performance is still quite poor (e.g., more than 50 times slower than reading lines with files created using the Python 2.6 built-in open() function).Also, because of internal buffering, you need to take care to manage flush() operations when writing. For example, if you use f.seek() to move the file pointer to a new location, you should first use f.flush() to flush any previously written data (if any).\n\nF h Lib f L Bdff\n\nio\n\n353\n\nAlso, be aware that the buffer size parameters only specify a limit at which writes occur and do not necessarily set a limit on internal resource use. For example, when you do a f.write(data) on a buffered file f, all of the bytes in dataare first copied into the internal buffers. If datarepresents a very large byte array, this copying will substan- tially increase the memory use of your program.Thus, it is better to write large amounts of data in reasonably sized chunks, not all at once with a single write() operation. It should be noted that because the io module is relatively new, this behavior might be different in future versions.\n\nText I/O The text I/O layer is used to process line-oriented character data.The classes defined in this section build upon buffered I/O streams and add line-oriented processing as well as Unicode character encoding and decoding.All of the classes here inherit from TextIOBase.\n\nTextIOWrapper(buffered [, encoding [, errors [, newline [, line_buffering]]]])\n\nA class for a buffered text stream. bufferedis a buffered I/O as described in the previ- ous section. encodingis a string such as 'ascii' or 'utf-8' that specifies the text encoding. errorsspecifies the Unicode error-handling policy and is 'strict' by default (see Chapter 9,“Input and Output,” for a description). newlineis the character sequence representing a newline and may be None, '', '\\n', '\\r', or '\\r\\n'. If None is given, then universal newline mode is enabled in which any of the other line endings are translated into '\\n' when reading and os.linesep is used as the newline on out- put. If newlineis one of the other values, then all '\\n' characters are translated into the specified newline on output. line_bufferingis a flag that controls whether or not a flush() operation is performed when any write operation contains the newline char- acter. By default, this is False.An instance fof TextIOWrapper supports all of the operations defined on IOBase as well as the following:\n\nMethod f.encoding\n\nf.errors\n\nf.line_buffering\n\nf.newlines\n\nf.read([n])\n\nf.readline([limit])\n\nf.write(s)\n\nDescription The name of the text encoding being used. Encoding and decoding error handling policy. Flag that determines line buffering behavior. None, a string, or a tuple giving all of the different forms of newlines translated. Reads at most ncharacters from the underlying stream and returns as a string. If nis omitted, then this reads all avail- able data to the end of file. Returns the empty string at EOF. The returned strings are decoded according to the encoding setting in f.encoding. Reads a single line of text and returns as a string. Returns an empty string at EOF. limitis the maximum number of bytes to read. Writes string sto the underlying stream using the text encoding in f.encoding.\n\nStringIO([initial [, encoding [, errors [, newline]]]])\n\nAn in-memory file object with the same behavior as a TextIOWrapper. initialis a string that specifies the initial contents of the file.The other parameters have the same\n\nF h Lib f L Bdff\n\n354\n\nChapter 19 Operating System Services\n\nmeaning as with TextIOWrapper.An instance sof StringIO supports all of the usual file operations, in addition to a method s.getvalue() that returns the current con- tents of the memory buffer.\n\nThe open() Function The io module defines the following open() function, which is the same as the built- in open() function in Python 3.\n\nopen(file [, mode [, buffering [, encoding [, errors [, newline [, closefd]]]]]])\n\nOpens fileand returns an appropriate I/O object. fileis either a string specifying the name of a file or an integer file descriptor for an I/O stream that has already been opened.The result of this function is one of the I/O classes defined in the io module depending on the settings of modeand buffering. If modeis any of the text modes such as 'r', 'w', 'a', or 'U', then an instance of TextIOWrapper is returned. If mode is a binary mode such as 'rb' or 'wb', then the result depends on the setting of buffering. If bufferingis 0, then an instance of FileIO is returned for performing raw unbuffered I/O. If bufferingis any other value, then an instance of BufferReader, BufferedWriter, or BufferedRandom is returned depending on the file mode.The encoding, errors, and errorsparameters are only applicable to files opened in text mode and passed to the TextIOWrapper constructor.The closefdis only applicable if fileis an integer descriptor and is passed to the FileIO constructor.\n\nAbstract Base Classes The io module defines the following abstract base classes that can be used for type checking and defining new I/O classes:\n\nAbstract Class IOBase\n\nRawIOBase\n\nBufferedIOBase\n\nTextIOBase\n\nDescription Base class for all I/O classes. Base class for objects that support raw binary I/O. Inherits from IOBase. Base class for objects that support buffered binary I/O. Inherits from IOBase. Base class for objects that support text streams. Inherits from IOBase.\n\nIt is rare for most programmers to work with these classes directly.You should refer to the online documentation for details concerning their use and definition.\n\nNote\n\nThe io module is a new addition to Python, first appearing in Python 3 and backported to Python 2.6. As of this writing, the module is immature and has extremely poor run- time performance—especially for any application that involves heavy amounts of text I/O. If you are using Python 2, you will be better served by the built-in open() function than using the I/O classes defined in the io module. If you are using Python 3, there seems to be no other alternative. Although performance improvements are likely in future releases, this layered approach to I/O coupled with Unicode decoding is unlikely to match the raw I/O performance found in the C standard library, which is the basis for I/O in Python 2.\n\nF h Lib f L Bdff\n\nlogging\n\n355\n\nlogging The logging module provides a flexible facility for applications to log events, errors, warnings, and debugging information.This information can be collected, filtered, writ- ten to files, sent to the system log, and even sent over the network to remote machines. This section covers the essential details of using this module for most common cases.\n\nLogging Levels The main focus of the logging module concerns the issuing and handling of log mes- sages. Each message consists of some text along with an associated level that indicates its severity. Levels have both a symbolic name and numerical value as follows:\n\nLevel CRITICAL\n\nERROR\n\nWARNING\n\nINFO\n\nDEBUG\n\nNOTSET\n\nValue 50\n\n40\n\n30\n\n20\n\n10\n\n0\n\nDescription Critical errors/messages Errors Warning messages Informative messages Debugging No level set\n\nThese different levels are the basis for various functions and methods throughout the logging module. For example, there are methods to issue log messages at each level as well as filters that work by blocking messages that don’t meet a certain threshold value.\n\nBasic Configuration Before using any other functions in the logging module, you should first perform some basic configuration of a special object known as the root logger.The root logger is responsible for managing the default behavior of log messages including the logging level, output destination, message format, and other basic details.The following function is used for configuration:\n\nbasicConfig([**kwargs])\n\nPerforms basic configuration of the root logger.This function should be called before any other logging calls are made.The function accepts a number of keyword arguments:\n\nKeyword Argument Description filename\n\nAppends log messages to a file with the given filename. Specifies the mode used to open the file. By default, mode 'a' (append) is used. Format string used to produce log messages. Format string used to output dates and times. Sets the level of the root logger. All log messages with a level equal to or above this level will be processed. Lower-level mes- sages will be silently ignored. Provides an open file to which log messages are sent. The default stream is sys.stderr. This parameter may not be used simultaneously with the filename parameter.\n\nfilemode\n\nformat datefmt level\n\nstream\n\nF h Lib f L Bdff\n\n356\n\nChapter 19 Operating System Services\n\nMost of these parameters are self-explanatory.The formatargument is used to specify the format of log messages along with optional contextual information such as file- names, levels, line numbers, and so forth. datefmtis a date format string compatible with the time.strftime() function. If omitted, the date format is set to the ISO8601 format.\n\nThe following expansions are recognized in format:\n\nFormat %(name)s\n\n%(levelno)s\n\n%(levelname)s\n\n%(pathname)s\n\n%(filename)s\n\n%(funcName)s\n\n%(module)s\n\n%(lineno)d\n\n%(created)f\n\n%(asctime)s\n\n%(msecs)s\n\nDescription Name of the logger. Numeric logging level. Text name of the logging level. Pathname of the source file where the logging call was executed. filename of the source file where the logging call was executed. Function name in which the logging call was made. Module name where the logging call executed. Line number where the logging call executed. Time when the logging call executed. The value is a number as returned by time.time(). ASCII-formatted date and time when the logging call was executed. Millisecond portion of the time when the logging call executed. Thread ID.\n\n%(thread)d %(threadName)s Thread name. %(process)d\n\nProcess ID. The logged message (supplied by user).\n\n%(message)s\n\nHere is an example that illustrates a single configuration where log messages with a level of INFO or higher are appended to a file:\n\nimport logging logging.basicConfig(\n\nfilename = \"app.log\", format = \"%(levelname)-10s %(asctime)s %(message)s\" level = logging.INFO\n\n)\n\nWith this configuration, a CRITICAL log message of 'Hello World' will appear as fol- lows in the log file 'app.log'.\n\nCRITICAL 2005-10-25 20:46:57,126 Hello World\n\nLogger Objects In order to issue log messages, you have to obtain a Logger object.This section describes the process of creating, configuring, and using these objects.\n\nCreating a Logger To create a new Logger object, you use the following function:\n\ngetLogger([logname])\n\nReturns a Logger instance associated with the name logname. If no such object exists, a new Logger instance is created and returned. lognameis a string that specifies a name\n\nF h Lib f L Bdff",
      "page_number": 362
    },
    {
      "number": 19,
      "title": "Segment 19 (pages 381-399)",
      "start_page": 381,
      "end_page": 399,
      "detection_method": "synthetic",
      "content": "logging\n\n357\n\nor series of names separated by periods (for example 'app' or 'app.net'). If you omit logname, you will get the Logger object associated with the root logger.\n\nThe creation of Logger instances is different than what you find in most other library modules.When you create a Logger, you always give it a name which is passed to getLogger() as the lognameparameter. Internally, getLogger() keeps a cache of the Logger instances along with their associated names. If another part of the program requests a logger with the same name, the previously created instance is returned.This arrangement greatly simplifies the handling of log messages in large applications because you don’t have to figure out how to pass Logger instances around between different program modules. Instead, in each module where you want logging, you just use getLogger() to get a reference to the appropriate Logger object.\n\nPicking Names For reasons that will become clear later, you should always pick meaningful names when using getLogger(). For example, if your application is called 'app', then you should minimally use getLogger('app') at the top of every program module that makes up the application. For example:\n\nimport logging log = logging.getLogger('app')\n\nYou might also consider adding the module name to the logger such as getLogger('app.net') or getLogger('app.user') in order to more clearly indi- cate the source of log messages.This can be done using statements such as this:\n\nimport logging log = logging.getLogger('app.'+__name__)\n\nAdding the module name makes it easier to selectively turn off or reconfigure the log- ging for specific program modules as will be described later.\n\nIssuing Log Messages If logis an instance of a Logger object (created using the getLogger() function in the previous section), the following methods are used to issue log messages at the differ- ent logging levels:\n\nLogging Level CRITICAL\n\nMethod log.critical(fmt [, *args [, exc_info [, extra]]])\n\nERROR\n\nlog.error(fmt [, *args [, exc_info [, extra]]])\n\nWARNING\n\nlog.warning(fmt [, *args [, exc_info [, extra]]])\n\nINFO\n\nlog.info(fmt [, *args [, exc_info [, extra]]])\n\nDEBUG\n\nlog.debug(fmt [, *args [, exc_info [, extra]]])\n\nThe fmtargument is a format string that specifies the format of the log message.Any remaining arguments in argsserve as arguments for format specifiers in the format string.The string formatting operator % is used to form the resulting message from these arguments. If multiple arguments are provided, they are placed into a tuple for format- ting. If a single argument is provided, it is placed directly after the % when formatting.\n\nF h Lib f L Bdff\n\n358\n\nChapter 19 Operating System Services\n\nThus, if you pass a single dictionary as an argument, the format string can include dic- tionary key names. Here are a few examples that illustrate how this works:\n\nlog = logging.getLogger(\"app\") # A log message using positional formatting log.critical(\"Can't connect to %s at port %d\", host, port)\n\n# A log message using dictionary formatting parms = {\n\n'host' : 'www.python.org', 'port' : 80\n\n} log.critical(\"Can't connect to %(host)s at port %(port)d\", parms)\n\nThe keyword argument exc_info, if set to True, adds exception information from sys.exc_info() to the log message. If exc_infois set to an exception tuple such as that returned by sys.exc_info(), then that information is used.The extrakeyword argument is a dictionary that supplies additional values for use in log message format strings (described later). Both exc_infoand extramust be specified as keyword argu- ments.\n\nWhen issuing log messages, you should avoid code that carries out string formatting\n\nat the time the message is issued (that is, formatting a message and then passing the result into the logging module). For example,\n\nlog.critical(\"Can't connect to %s at port %d\" % (host, port))\n\nIn this example, the string formatting operation always occurs before the call to log.critical() because the arguments to a function or method have to be fully eval- uated. However, in the example at the top of the page, the parameters used for string formatting operation are merely passed to the logging module and used only if the log message is actually going to be handled.This is a very subtle distinction, but because many applications choose to filter log messages or only emit logs during debugging, the first approach performs less work and runs faster when logging is disabled.\n\nIn addition to the methods shown, there are a few additional methods for issuing log\n\nmessages on a Logger instance log.\n\nlog.exception(fmt [, *args ])\n\nIssues a message at the ERROR level but adds exception information from the current exception being handled.This can only be used inside except blocks.\n\nlog.log(level, fmt [, *args [, exc_info [, extra]]])\n\nIssues a logging message at the level specified by level.This can be used if the logging level is determined by a variable or if you want to have additional logging levels not covered by the five basic levels.\n\nlog.findCaller()\n\nReturns a tuple (filename, lineno, funcname) corresponding to the caller’s source filename, line number, and function name.This information is sometimes useful when issuing log messages—for example, if you want to add information about the location of the logging call to a message.\n\nF h Lib f L Bdff\n\nlogging\n\n359\n\nFiltering Log Messages Each Logger object loghas an internal level and filtering mechanism that determines which log messages get handled.The following two methods are used to perform sim- ple filtering based on the numeric level of log messages:\n\nlog.setLevel(level)\n\nSets the level of log. Only logging messages with a level greater than or equal to levelwill be handled.All other messages are simply ignored. By default, the level is logging.NOTSET which processes all log messages.\n\nlog.isEnabledFor(level)\n\nReturns True if a logging message at level levelwould be processed.\n\nLogging messages can also be filtered based on information associated with the mes- sage itself—for example, the filename, the line number, and other details.The following methods are used for this:\n\nlog.addFilter(filt)\n\nAdds a filter object, filt, to the logger.\n\nlog.removeFilter(filt)\n\nRemoves a filter object, filt, from the logger.\n\nIn both methods, filtis an instance of a Filter object.\n\nFilter(logname)\n\nCreates a filter that only allows log messages from lognameor its children to pass through. For example, if lognameis 'app', then messages from loggers such as 'app', 'app.net', or 'app.user' will pass, but messages from a logger such as 'spam' will not.\n\nCustom filters can be created by subclassing Filter and implementing the method\n\nfilter(record) that receives as input a record containing information about a log- ging message.As output, True or False is returned depending on whether or not the message should be handled.The recordobject passed to this method typically has the following attributes:\n\nAttribute record.name\n\nrecord.levelname\n\nrecord.levelno\n\nrecord.pathname\n\nrecord.filename\n\nrecord.module\n\nrecord.exc_info\n\nrecord.lineno\n\nrecord.funcName\n\nrecord.created\n\nrecord.thread\n\nrecord.threadName\n\nDescription Logger name Level name Level number Pathname of the module Base filename Module name Exception information Line number where log message was issued Function name where log message was issued Time at which issued Thread identifier Thread name PID of currently executing process\n\nrecord.process\n\nF h Lib f L Bdff\n\n360\n\nChapter 19 Operating System Services\n\nThe following example illustrates how you create a custom filter:\n\nclass FilterFunc(logging.Filter): def __init__(self,name): self.funcName = name\n\ndef filter(self, record):\n\nif record.funcName == self.funcName: return False else: return True\n\nlog.addFilter(FilterFunc('foo')) # Ignore all messages originating from foo() log.addFilter(FilterFunc('bar')) # Ignore all messages originating from bar()\n\nMessage Propagation and Hierarchical Loggers In advanced logging applications, Logger objects can be organized into a hierarchy.This is done by giving a logger object a name such as 'app.net.client'. Here, there are actually three different Logger objects called 'app', 'app.net', and 'app.net.client'.When a message is issued on any of the loggers and it successfully passes that logger’s filter, it propagates to and is handled by all of the parents. For exam- ple, a message successfully issued on 'app.net.client' also propagates to 'app.net', 'app' and the root logger.\n\nThe following attributes and methods of a Logger object logcontrol this propaga-\n\ntion.\n\nlog.propagate\n\nA Boolean flag that indicates whether or not messages propagate to the parent logger. By default, this is set to True.\n\nlog.getEffectiveLevel()\n\nReturns the effective level of the logger. If a level has been set using setLevel(), that level is returned. If no level has been explicitly set (the level is logging.NOTSET in this case), this function returns the effective level of the parent logger instead. If none of the parent loggers have a level set, the effective level of the root logger will be returned. The primary purpose of hierarchical logging is to be able to more easily filter log\n\nmessages originating from different parts of a large application. For example, if you wanted to shut down log messages from the 'app.net.client' part of an application, you might add configuration code such as the following:\n\nimport logging logging.getLogger('app.net.client').propagate = False\n\nOr, in this code, we’re ignoring all but the most severe messages from a program module:\n\nimport logging logging.getLogger('app.net.client').setLevel(logging.CRITICAL)\n\nA subtle aspect of hierarchical loggers is that the decision to handle a log message is made entirely by the level and filters on the Logger object on which the message was issued, not by the filters on any of the parents.Thus, if a message passes the first set of filters, it is propagated to and handled by all the parent loggers regardless of their own fil- ter and level settings—even if these filters would have rejected the message.At first glance, the behavior is counterintuitive and might even seem like a bug. However, set- ting the level of a child logger to a value that is lower than its parent is one way to\n\nF h Lib f L Bdff\n\nlogging\n\n361\n\noverride the settings on the parent, achieving a kind of level promotion. Here is an example:\n\nimport logging\n\n# The top-level logger 'app'. log = logging.getLogger('app') log.setLevel(logging.CRITICAL) # Only accept CRITICAL level messages.\n\n# A child logger 'app.net' net_log = logging.getLogger('app.net') net_log.setLevel(logging.ERROR) # Accept ERROR messages on 'app.net'.\n\n# These messages will now be handled by the # 'app' logger even though its level is # CRITICAL.\n\nWhen using hierarchical loggers, you only have to configure the logging objects where you want to change the filtering or propagation behavior. Because messages naturally propagate to the root logger, it will ultimately be responsible for producing the output and any configuration that you made using basicConfig() will apply.\n\nMessage Handling Normally, messages are handled by the root logger. However, any Logger object can have special handlers added to it that receive and process log messages.This is done using these methods of a Logger instance log.\n\nlog.addHandler(handler)\n\nAdds a Handler object to the logger.\n\nlog.removeHandler(handler)\n\nRemoves the Handler object handlerfrom the logger.\n\nThe logging module has a variety of pre-built handlers for writing log messages to files, streams, system logs, and so forth.These are described in further detail in the next section. However, the following example shows how loggers and handlers are hooked together using these methods.\n\nimport logging import sys\n\n# Create a top-level logger called 'app' app_log = logging.getLogger(\"app\") app_log.setLevel(logging.INFO) app_log.propagate = False\n\n# Add some message handlers to the 'app' log app_log.addHandler(logging.FileHandler('app.log')) app_log.addHandler(logging.StreamHandler(sys.stderr))\n\n# Issue some messages. These go to app.log and sys.stderr app_log.critical(\"Creeping death detected!\") app_log.info(\"FYI\")\n\nWhen you add your own handlers to process messages, it is often your intent to over- ride the behavior of the root logger.This is why message propagation is disabled in the previous example (i.e., the 'app' logger is simply going to handle all of the messages).\n\nF h Lib f L Bdff\n\n362\n\nChapter 19 Operating System Services\n\nHandler Objects The logging module provides a collection of pre-built handlers that can process log messages in various in ways.These handlers are added to Logger objects using their addHandler() method. In addition, each handler can be configured with its own filter- ing and levels.\n\nBuilt-In Handlers The following handler objects are built-in. Some of these handlers are defined in a sub- module logging.handlers, which must be imported specifically if necessary.\n\nhandlers.DatagramHandler(host,port)\n\nSends log messages to a UDP server located on the given hostand port. Log messages are encoded by taking the dictionary of the corresponding LogRecord object and encoding it using the pickle module.The transmitted network message consists of a 4- byte network order (big-endian) length followed by the pickled record data.To recon- struct the message, the receiver must strip the length header, read the entire message, unpickle the contents, and call logging.makeLogRecord(). Because UDP is unreli- able, network errors may result in lost log messages.\n\nFileHandler(filename [, mode [, encoding [, delay]]])\n\nWrites log messages to the file filename. modeis the file mode to use when opening the file and defaults to 'a'. encodingis the file encoding. delayis a Boolean flag that, if set True, defers the opening of the log file until the first log message is issued. By default, it is False.\n\nhandlers.HTTPHandler(host, url [, method])\n\nUploads log messages to an HTTP server using HTTP GET or POST methods. host specifies the host machine, urlis the URL to use, and methodis either 'GET' (the default) or 'POST'.The log message is encoded by taking the dictionary of the corre- sponding LogRecord object and encoding it as a set of URL query-string variables using the urllib.urlencode() function.\n\nhandlers.MemoryHandler(capacity [, flushLevel [, target]])\n\nThis handler is used to collect log messages in memory and to flush them to another handler, target, periodically. capacityis the size of the memory buffer in bytes. flushLevelis a numeric logging level that forces a memory flush should a logging message of that level or higher appear.The default value is ERROR. targetis another Handler object that receives the messages. If targetis omitted, you will need to set a target using the setTarget() method of the resulting handler object in order for this handler to do anything.\n\nhandlers.NTEventLogHandler(appname [, dllname [, logtype]])\n\nSends messages to the event log on Windows NT,Windows 2000, or Windows XP. appnameis the name of the application name to use in the event log. dllnameis a full path name to a .DLL or .EXE file that provides message definitions to hold in the log. If omitted, dllname is set to 'win32service.pyd'. logtype is either 'Application', 'System', or 'Security'.The default value is 'Application'.This handler is only available if Win32 extensions for Python have been installed.\n\nF h Lib f L Bdff\n\nlogging\n\n363\n\nhandlers.RotatingFileHandler(filename [, mode [, maxBytes [, backupCount [, encoding [, delay]]]]])\n\nWrites log messages to the file filename. However, if the file exceeds the size specified by maxBytes, the file is rotated to filename.1 and a new log file, filename, is opened. backupCountspecifies the maximum number of backup files to create. By default, the value of backupCountis 0. However, when specified, backup files are rotat- ed through the sequence filename.1, filename.2, … ,filename.N, where filename.1 is always the most recent backup and filename.Nis always the oldest backup. modespecifies the file mode to use when opening the log file.The default mode is 'a'. If maxBytesis 0 (the default), the log file is never rolled over and is allowed to grow indefinitely. encodingand delayhave the same meaning as with FileHandler.\n\nhandlers.SMTPHandler(mailhost, fromaddr, toaddrs, subject [, credentials])\n\nSends log messages to a remote host using email. mailhostis the address of an SMTP server that can receive the message.The address can be a simple host name specified as a string or a tuple (host, port). fromaddris the from address, toaddrsis the destina- tion address, and subjectis the subject to use in the message. credentialsis a tuple (username, password) with the username and password.\n\nhandlers.SocketHandler(host, port)\n\nSends log messages to a remote host using a TCP socket connection. hostand port specify the destination. Messages are sent in the same format as described for DatagramHandler. Unlike DatagramHandler, this handler reliably delivers log mes- sages.\n\nStreamHandler([fileobj])\n\nWrites log messages to an already open file-like object, fileobj. If no argument is pro- vided, messages are written to sys.stderr.\n\nhandlers.SysLogHandler([address [, facility]])\n\nSends log messages to a UNIX system logging daemon. addressspecifies the destina- tion as a (host, port) tuple. If omitted, a destination of ('localhost', 514) is used. facilityis an integer facility code and is set to SysLogHandler.LOG_USER by default.A full list of facility codes can be found in the definition of SysLogHandler.\n\nhandlers.TimedRotatingFileHandler(filename [, when [, interval [, backupCount [, encoding [, delay [, utc]]]]]])\n\nThe same as RotatingFileHandler, but the rotation of files is controlled by time instead of file size. intervalis a number, and whenis a string that specifies units. Possible values for whenare 'S' (seconds), 'M' (minutes), 'H' (hours), 'D' (days), 'W' (weeks), and 'midnight' (roll over at midnight). For example, setting intervalto 3 and whento 'D' rolls the log every three days. backupCountspecifies the maximum number of backup files to keep. utcis a Boolean flag that determines whether or not to use local time (the default) or UTC time.\n\nhandlers.WatchedFileHandler(filename [, mode [, encoding [, delay]]])\n\nThe same as FileHandler, but the inode and device of the opened log file is moni- tored. If it changes since the last log message was issued, the file is closed and reopened\n\nF h Lib f L Bdff\n\n364\n\nChapter 19 Operating System Services\n\nagain using the same filename.These changes might occur if a log file has been deleted or moved as a result of a log rotation operation carried out externally to the running program.This handler only works on UNIX systems.\n\nHandler Configuration Each Handler object hcan be configured with its own level and filtering.The follow- ing methods are used to do this:\n\nh.setLevel(level)\n\nSets the threshold of messages to be handled. levelis a numeric code such as ERROR or CRITICAL.\n\nh.addFilter(filt)\n\nAdds a Filter object, filt, to the handler. See the addFilter() method of Logger objects for more information.\n\nh.removeFilter(filt)\n\nRemoves a Filter object, filt, from the handler.\n\nIt is important to stress that levels and filters can be set on handlers independently from any settings used on the Logger objects to which handlers are attached. Here is an example that illustrates this:\n\nimport logging import sys\n\n# Create a handler that prints CRITICAL level messages to stderr crit_hand = logging.StreamHandler(sys.stderr) crit_hand.setLevel(logging.CRITICAL)\n\n# Create a top-level logger called 'app' app_log = logging.getLogger(\"app\") app_log.setLevel(logging.INFO) app_log.addHandler(logging.FileHandler('app.log')) app_log.addHandler(crit_handler)\n\nIn this example, there is a single logger called 'app’ with a level of INFO.Two handlers are attached to it, but one of the handlers (crit_handler) has its own level setting of CRITICAL.Although this handler will receive log messages with a level of INFO or higher, it selectively discards those that are not CRITICAL.\n\nHandler Cleanup The following methods are used on handlers to perform cleanup.\n\nh.flush()\n\nFlushes all logging output.\n\nh.close()\n\nCloses the handler.\n\nMessage Formatting By default, Handler objects emit log messages exactly as they are formatted in logging calls. However, sometimes you want to add additional contextual information to the messages such as timestamps, filenames, line numbers, and so forth.This section\n\nF h Lib f L Bdff\n\nlogging\n\n365\n\ndescribes how this extra information can be automatically added to log messages.\n\nFormatter Objects To change the log message format, you must first create a Formatter object:\n\nFormatter([fmt [, datefmt]])\n\nCreates a new Formatter object. fmtprovides a format string for messages.Within fmt, you can place various expansions as previously described for the basicConfig() function. datefmtis a date format string compatible with the time.strftime() func- tion. If omitted, the date format is set to the ISO8601 format.\n\nTo take effect, Formatter objects must be attached to handler objects.This is done\n\nusing the h.setFormatter() method of a Handler instance h.\n\nh.setFormatter(format)\n\nSets the message formatter object used to create log messages on the Handler instance h. formatmust be an instance of Formatter.\n\nHere is an example that illustrates how to customize the log message format on a\n\nhandler:\n\nimport logging import sys\n\n# Set the message format format = logging.Formatter(\"%(levelname)-10s %(asctime)s %(message)s\")\n\n# Create a handler that prints CRITICAL level messages to stderr crit_hand = logging.StreamHandler(sys.stderr) crit_hand.setLevel(logging.CRITICAL) crit_hand.setFormatter(format)\n\nIn this example, a custom Formatter is set on the crit_hand handler. If a logging message such as \"Creeping death detected.\" is processed by this handler, the fol- lowing log message is produced:\n\nCRITICAL 2005-10-25 20:46:57,126 Creeping death detected.\n\nAdding Extra Context to Messages In certain applications, it is useful to add additional context information to log mes- sages.This extra information can be provided in one of two ways. First, all of the basic logging operations (e.g., log.critical(), log.warning(), etc.) have a keyword parameter extra that is used to supply a dictionary of additional fields for use in mes- sage format strings.These fields are merged in with the context data previously described for Formatter objects. Here is an example:\n\nimport logging, socket logging.basicConfig(\n\nformat = \"%(hostname)s %(levelname)-10s %(asctime)s %(message)s\"\n\n) # Some extra context netinfo = {\n\n'hostname' : socket.gethostname(), 'ip' : socket.gethostbyname(socket.gethostname())\n\n} log = logging.getLogger('app')\n\n# Issue a log message with the extra context data\n\nF h Lib f L Bdff\n\n366\n\nChapter 19 Operating System Services\n\nlog.critical(\"Could not connect to server\", extra=netinfo)\n\nThe downside of this approach is that you have to make sure every logging operation includes the extra information or else the program will crash.An alternative approach is to use the LogAdapter class as a wrapper for an existing logger.\n\nLogAdapter(log [, extra])\n\nCreates a wrapper around a Logger object log. extrais a dictionary of extra context information to be supplied to message formatters.An instance of LogAdapter has the same interface as a Logger object. However, operations that issue log messages will automatically add the extra information supplied in extra. Here is an example of using a LogAdapter object:\n\nimport logging, socket logging.basicConfig(\n\nformat = \"%(hostname)s %(levelname)-10s %(asctime)s %(message)s\"\n\n) # Some extra context netinfo = {\n\n'hostname' : socket.gethostname(), 'ip' : socket.gethostbyname(socket.gethostname())\n\n}\n\n# Create a logger log = logging.LogAdapter(logging.getLogger(\"app\"), netinfo)\n\n# Issue a log message. Extra context data is supplied by the LogAdapter log.critical(\"Could not connect to server\")\n\nMiscellaneous Utility Functions The following functions in logging control a few other aspects of logging:\n\ndisable(level)\n\nGlobally disables all logging messages below the level specified in level. This can be used to turn off logging on a applicationwide basis—for instance, if you want to tem- porarily disable or reduce the amount of logging output.\n\naddLevelName(level, levelName)\n\nCreates an entirely new logging level and name. levelis a number and levelNameis a string.This can be used to change the names of the built-in levels or to add more levels than are supported by default.\n\ngetLevelName(level)\n\nReturns the name of the level corresponding to the numeric value level.\n\nshutdown()\n\nShuts down all logging objects, flushing output if necessary.\n\nLogging Configuration Setting an application to use the logging module typically involves the following basic steps:\n\n1. Use getLogger() to create various Logger objects. Set parameters such as the\n\nF h Lib f L Bdff\n\nlogging\n\n367\n\nlevel, as appropriate.\n\n2. Create Handler objects by instantiating one of the various types of handlers (FileHandler, StreamHandler, SocketHandler, and so on) and set an appro- priate level.\n\n3. Create message Formatter objects and attach them to the Handler objects using the setFormatter() method.\n\n4. Attach the Handler objects to the Logger objects using the addHandler() method.\n\nBecause the configuration of each step can be somewhat involved, your best bet is to put all the logging configuration into a single well-documented location. For example, you might create a file applogconfig.py that is imported by the main program of your application:\n\n# applogconfig.py import logging import sys\n\n# Set the message format format = logging.Formatter(\"%(levelname)-10s %(asctime)s %(message)s\")\n\n# Create a handler that prints CRITICAL level messages to stderr crit_hand = logging.StreamHandler(sys.stderr) crit_hand.setLevel(logging.CRITICAL) crit_hand.setFormatter(format)\n\n# Create a handler that prints messages to a file applog_hand = logging.FileHandler('app.log') applog_hand.setFormatter(format)\n\n# Create a top-level logger called 'app' app_log = logging.getLogger(\"app\") app_log.setLevel(logging.INFO) app_log.addHandler(applog_hand) app_log.addHandler(crit_hand)\n\n# Change the level on the 'app.net' logger logging.getLogger(\"app.net\").setLevel(logging.ERROR)\n\nIf changes need to be made to any part of the logging configuration, having everything in one location makes things easier to maintain. Keep in mind that this special file only needs to be imported once and in only one location in the program. In other parts of the code where you want to issue log messages, you simply include code like this:\n\nimport logging app_log = logging.getLogger(\"app\") ... app_log.critical(\"An error occurred\")\n\nThe logging.config Submodule As an alternative to hard-coding the logging configuration in Python code, it is also possible to configure the logging module through the use of an INI-format configura- tion file.To do this, use the following functions found in logging.config.\n\nfileConfig(filename [, defaults [, disable_existing_loggers]])\n\nReads the logging configuration from the configuration file filename. defaultsis a\n\nF h Lib f L Bdff\n\n368\n\nChapter 19 Operating System Services\n\ndictionary of default configuration parameters for use in the config file.The specified filename is read using the ConfigParser module. disable_existing_loggersis a Boolean flag that specifies whether or not any existing loggers are disabled when new configuration data is read. By default, this is True.\n\nThe online documentation for the logging module goes into some detail on the expected format of configuration files. However, experienced programmers can proba- bly extrapolate from the following example, which is a configuration file version of applogconfig.py shown in the previous section.\n\n; applogconfig.ini ; ; Configuration file for setting up logging\n\n; The following sections provide names for Logger, Handler, and Formatter ; objects that will be configured later in the file.\n\n[loggers] keys=root,app,app_net\n\n[handlers] keys=crit,applog\n\n[formatters] keys=format\n\n[logger_root] level=NOTSET handlers=\n\n[logger_app] level=INFO propagate=0 qualname=app handlers=crit,applog\n\n[logger_app_net] level=ERROR propagate=1 qualname=app.net handlers=\n\n[handler_crit] class=StreamHandler level=CRITICAL formatter=format args=(sys.stderr,)\n\n[handler_applog] class=FileHandler level=NOTSET formatter=format args=('app.log',)\n\n[formatter_format] format=%(levelname)-10s %(asctime)s %(message)s datefmt=\n\nTo read this configuration file and set up logging, you would use this code:\n\nimport logging.config\n\nF h Lib f L Bdff\n\nmmap\n\n369\n\nlogging.config.fileConfig('applogconfig.ini')\n\nAs before, modules that want to issue log messages do not need to worry about the details of loading the logging configuration.They merely import the logging module and get a reference to the appropriate Logger object. For example:\n\nimport logging app_log = logging.getLogger(\"app\") ... app_log.critical(\"An error occurred\")\n\nPerformance Considerations Adding logging to an application can severely degrade its performance if you aren’t careful. However, there are some techniques that can be used to reduce the overhead. First, Python’s optimized mode (-O) removes all code that is conditionally executed using statements such as if __debug__: statements. If the sole purpose of logging is debugging, you could conditionally execute all of the logging calls and have the calls removed in optimized mode.\n\nA second technique would be to use a Null object in place of a Logger object when logging is to be completely disabled.This is different than using None. Instead, you want to use an instance of an object that silently swallows all operations that get performed on it. For example:\n\nclass Null(object):\n\ndef __init__(self, *args, **kwargs): pass def __call__(self, *args, **kwargs): return self def __getattribute__(self, name): return self def __setattr__(self, name, value): pass def __delattr__(self,name): pass\n\nlog = Null() log.critical(\"An error occurred.\") # Does nothing\n\nDepending on your cleverness, logging can also be managed through the use of decora- tors and metaclasses. Because these features of Python operate at the time that func- tions, methods, and classes are defined, they can be used to selectively add or remove logging features from parts of a program in a way that does not impact performance when logging is disabled. Please refer to Chapter 6,“Functions and Functional Programming,” and Chapter 7,“Classes and Object-Oriented Programming,” for further details.\n\nNotes\n\nn The logging module provides a large number of customization options not dis- cussed here. Readers should consult online documentation for further details. n It is safe to use the logging module with programs that use threads. In particu- lar, it is not necessary to add locking operations around code that is issuing log messages.\n\nmmap The mmap module provides support for a memory-mapped file object.This object behaves both like a file and a byte string and can be used in most places where an ordi-\n\nF h Lib f L Bdff\n\n370\n\nChapter 19 Operating System Services\n\nnary file or byte string is expected. Furthermore, the contents of a memory-mapped file are mutable.This means that modifications can be made using index-assignment and slice-assignment operators. Unless a private mapping of the file has been made, such changes directly alter the contents of the underlying file.\n\nA memory-mapping file is created by the mmap() function, which is slightly differ-\n\nent on UNIX and Windows.\n\nmmap(fileno, length [, flags, [prot [,access [, offset]]]])\n\n(UNIX). Returns an mmap object that maps lengthbytes from the file with an integer file descriptor, fileno. If filenois -1, anonymous memory is mapped. flagsspecifies the nature of the mapping and is one of the following:\n\nFlag MAP_PRIVATE\n\nMAP_SHARED\n\nMeaning Creates a private copy-on-write mapping. Changes to the object will be private to this process. Shares the mapping with all other processes mapping the same areas of the file. Changes to the object will affect all mappings.\n\nThe default flagssetting is MAP_SHARED. protspecifies the memory protections of the object and is the bitwise OR of the following:\n\nSetting PROT_READ\n\nPROT_WRITE\n\nPROT_EXEC\n\nMeaning Data can be read from the object. Modifications can be made to the object. The object can contain executable instructions.\n\nThe default value of protis PROT_READ | PROT_WRITE.The modes specified in prot must match the access permissions used to open the underlying file descriptor fileno. In most cases, this means that the file should be opened in read/write mode (for exam- ple, os.open(name, os.O_RDWR)).\n\nThe optional accessparameter may be used as an alternative to flagsand prot. If\n\ngiven, it has one of the following values:\n\nAccess ACCESS_READ ACCESS_WRITE Read/write access with write-through. Modifications affect the under-\n\nMeaning Read-only access.\n\nACCESS_COPY\n\nlying file. Read/write access with copy-on-write. Modifications affect memory but do not change the underlying file.\n\nWhen accessis supplied, it is typically given as a keyword argument—for example, mmap(fileno, length, access=ACCESS_READ). It is an error to supply values for both accessand flags. The offsetparameter specifies the number of bytes from the start of the file and defaults to 0. It must be a multiple of mmap.ALLOCATIONGRANULARITY.\n\nmmap(fileno, length[, tagname [,access [, offset]]])\n\n(Windows) Returns an mmap object that maps lengthbytes from the file specified by the integer file descriptor fileno. Use a filenoof -1 for anonymous memory. If\n\nF h Lib f L Bdff\n\nmmap\n\n371\n\nlengthis larger than the current size of the file, the file is extended to lengthbytes. If lengthis 0, the current length of the file is used as the length as long as the file is non- empty (otherwise, an exception will be raised). tagnameis an optional string that can be used to name the mapping. If tagnamerefers to an existing mapping, that mapping is opened. Otherwise, a new mapping is created. If tagnameis None, an unnamed map- ping is created. accessis an optional parameter that specifies the access mode. It takes the same values for accessas described for the UNIX version of mmap() shown earli- er. By default, accessis ACCESS_WRITE. offsetis the number of bytes from the beginning of the file and defaults to 0. It must be a multiple of mmap.ALLOCATIONGRANULARITY.\n\nA memory-mapped file object, m, supports the following methods.\n\nm.close()\n\nCloses the file. Subsequent operations will result in an exception.\n\nm.find(string[, start])\n\nReturns the index of the first occurrence of string. startspecifies an optional start- ing position. Returns -1 if no match is found.\n\nm.flush([offset, size])\n\nFlushes modifications of the in-memory copy back to the file system. offsetand size specify an optional range of bytes to flush. Otherwise, the entire mapping is flushed.\n\nm.move(dst,src,count)\n\nCopies countbytes starting at index srcto the destination index dst.This copy is per- formed using the C memmove() function, which is guaranteed to work correctly when the source and destination regions happen to overlap.\n\nm.read(n)\n\nReads up to nbytes from the current file position and returns the data as a string.\n\nm.read_byte()\n\nReads a single byte from the current file position and returns as a string of length 1.\n\nm.readline()\n\nReturns a line of input starting at the current file position.\n\nm.resize(newsize)\n\nResizes the memory-mapped object to contain newsizebytes.\n\nm.seek(pos[, whence])\n\nSets the file position to a new value. posand whencehave the same meaning as for the seek() method on file objects.\n\nm.size()\n\nReturns the length of the file.This value may be larger than the size of the memory- mapped region.\n\nm.tell()\n\nReturns the value of the file pointer.\n\nF h Lib f L Bdff\n\n372\n\nChapter 19 Operating System Services\n\nm.write(string)\n\nWrites a string of bytes to the file at the current file pointer.\n\nm.write_byte(byte)\n\nWrites a single byte into memory at the current file pointer.\n\nNotes\n\nn Although UNIX and Windows supply slightly different mmap() functions, this module can be used in a portable manner by relying on the optional access parameter that is common to both functions. For example, mmap(fileno,length,access=ACCESS_WRITE) will work on both UNIX and Windows.\n\nn Certain memory mapping may only work with a length that’s a multiple of the\n\nsystem page size, which is contained in the constant mmap.PAGESIZE.\n\nn On UNIX SVR4 systems, anonymous mapped memory can be obtained by call-\n\ning mmap() on the file /dev/zero, opened with appropriate permissions.\n\nn On UNIX BSD systems, anonymous mapped memory can be obtained by calling\n\nmmap() with a negative file descriptor and the flag mmap.MAP_ANON.\n\nmsvcrt The msvcrt module provides access to a number of useful functions in the Microsoft Visual C runtime library.This module is available only on Windows.\n\ngetch()\n\nReads a keypress and returns the resulting character.This call blocks if a keypress is not available. If the pressed key was a special function key, the call returns '\\000' or '\\xe0' and the next call returns the keycode.This function doesn’t echo characters to the console, nor can the function be used to read Ctrl+C.\n\ngetwch()\n\nThe same as getch() except that a Unicode character is returned.\n\ngetche()\n\nLike getch() except that characters are echoed (if printable).\n\ngetwche()\n\nThe same as getche() except that a Unicode character is returned.\n\nget_osfhandle(fd)\n\nReturns the file handle for file descriptor fd. Raises IOError if fdis not recognized.\n\nheapmin()\n\nForces the internal Python memory manager to return unused blocks to the operating system.This works only on Windows NT and raises IOError on failure.\n\nF h Lib f L Bdff\n\nmsvcrt\n\n373\n\nkbhit()\n\nReturns True if a keypress is waiting to be read.\n\nlocking(fd, mode, nbytes)\n\nLocks part of a file, given a file descriptor from the C runtime. nbytesis the number of bytes to lock relative to the current file pointer. modeis one of the following integers:\n\nSetting 0\n\n1\n\n2 3\n\n4\n\nDescription Unlocks the file region (LK_UNLCK) Locks the file region (LK_LOCK) Locks the file region; nonblocking (LK_NBLCK) Locks for writing (LK_RLCK) Locks for writing; nonblocking (LK_NBRLCK)\n\nAttempts to acquire a lock that takes more than approximately 10 seconds results in an IOError exception.\n\nopen_osfhandle(handle, flags)\n\nCreates a C runtime file descriptor from the file handle handle. flagsis the bitwise OR of os.O_APPEND, os.O_RDONLY, and os.O_TEXT. Returns an integer file descriptor that can be used as a parameter to os.fdopen() to create a file object.\n\nputch(char)\n\nPrints the character charto the console without buffering.\n\nputwch(char)\n\nThe same as putch() except that charis a Unicode character.\n\nsetmode(fd, flags)\n\nSets the line-end translation mode for file descriptor fd. flagsis os.O_TEXT for text mode and os.O_BINARY for binary mode.\n\nungetch(char)\n\nCauses the character charto be “pushed back” into the console buffer. It will be the next character read by getch() or getche().\n\nungetwch(char)\n\nThe same as ungetch() except that charis a Unicode character.\n\nNote\n\nA wide variety of Win32 extensions are available that provide access to the Microsoft Foundation Classes, COM components, graphical user interfaces, and so forth. These topics are far beyond the scope of this book, but detailed information about many of these topics is available in Python Programming on Win32 by Mark Hammond and Andy Robinson (O’Reilly & Associates, 2000). Also, http://www.python.org maintains an extensive list of contributed modules for use under Windows.\n\nF h Lib f L Bdff\n\n374\n\nChapter 19 Operating System Services\n\nSee Also:\n\nwinreg (p. 408)\n\noptparse The optparse module provides high-level support for processing UNIX-style command-line options supplied in sys.argv.A simple example of using the module is found in Chapter 9. Use of optparse primarily focuses on the OptionParser class.\n\nOptionParser([**args])\n\nCreates a new command option parser and returns an OptionParser instance.A variety of optional keyword arguments can be supplied to control configuration.These keyword arguments are described in the following list:\n\nKeyword Argument add_help_option\n\nDescription Specifies whether or not a special help option (--help and -h) is supported. By default, this is set to True.\n\nconflict_handler Specifies the handling of conflicting command-line options. May be set to either 'error' (the default value) or 'resolve'. In 'error' mode, an optparse.OptionConflictError excep- tion will be raised if conflicting option strings are added to the parser. In 'resolve' mode, conflicts are resolved so that options added later take priority. However, earlier options may still be available if they were added under multiple names and no con- flicts exist for at least one of the names. A string that provides a description of the program for display dur- ing help. This string will automatically be reformatted to fit the screen when displayed. Instance of an optparse.HelpFormatter class used to format text when printing help. May be either optparse. IndentedHelpFormatter (the default) or optparse. TitledHelpFormatter. The Python class that’s used to hold information about each command-line option. The default class is optparse.Option. A list of options used to populate the parser. By default, this list is empty, and options are added using the add_option() method instead. If supplied, this list contains objects of type Option. The program name used to replace '%prog' in help text. The usage string that’s printed when the --help option is used or incorrect options are passed. The default value is the string '%prog [options]', where the '%prog' keyword gets replaced with either the value of os.path.basename (sys.argv[0]) or the value of the prog keyword argument (if supplied). The value optparse.SUPPRESS_USAGE can be given to suppress the usage message entirely. Version string that’s printed when the -version option is supplied. By default, version is None and no --version option is added. When this string is supplied, -version is automatically added. The special keyword '%prog' is replaced by the program name.\n\ndescription\n\nformatter\n\noption_class\n\noption_list\n\nprog\n\nusage\n\nversion\n\nF h Lib f L Bdff\n\noptparse\n\n375\n\nUnless you really need to customize option processing in some way, an OptionParser will usually be created with no arguments. For example:\n\np = optparse.OptionParser()\n\nAn instance, p, of OptionParser supports the following methods:\n\np.add_option(name1, ..., nameN [, **parms])\n\nAdds a new option to p.The arguments name1, name2, and so on are all of the various names for the option. For example, you might include short and long option names such as '-f' and '--file’. Following the option names, an optional set of keyword arguments is supplied that specifies how the option will be processed when parsed. These keyword arguments are described in the following list:\n\nKeyword Argument action\n\ncallback\n\nDescription Action to perform when the option is parsed. Acceptable values are as follows: 'store'—Option has an argument that is read and stored. This is the default if no action is specified explicitly. 'store_const'—The option takes no arguments, but when the option is encountered, a constant value specified with the const keyword argument is stored. 'store_true'—Like 'store_const' but stores a Boolean True when the option is parsed. 'store_false'—Like 'store_true' but stores False instead. 'append'—Option has an argument that is appended to a list when parsed. This is used if the same command-line option is used to specify multiple values. 'count'—Option takes no arguments, but a counter value is stored. The counter value is increased by one each time the argument is encountered. 'callback'—Invokes a callback function specified with the callback keyword argument when the option is encountered. 'help'—Prints a help message when the option is parsed. This is only needed if you want help to be displayed via a different option than the standard -h or --help option. 'version’—Prints the version number supplied to OptionParser(), if any. Only used if you want to display ver- sion information using an option other than the standard -v or --version option. Specifies a callback function to be invoked when the option is encountered. This callback function is a Python callable object that is invoked as callback(option, opt_str, value, parser, *args, **kwargs). The optionargument is an instance of optparse.Option, opt_stris the option string supplied on the command line that triggered the callback, valueis the value of the option (if any), parseris the instance of OptionParser that’s running, argsare positional argu- ments supplied using the callback_args keyword argument, and kwargsare keyword arguments supplied using the callback_kwargs keyword argument.\n\nF h Lib f L Bdff",
      "page_number": 381
    },
    {
      "number": 20,
      "title": "Segment 20 (pages 400-419)",
      "start_page": 400,
      "end_page": 419,
      "detection_method": "synthetic",
      "content": "376\n\nChapter 19 Operating System Services\n\nKeyword Argument callback_args\n\ncallback_kwargs\n\nchoices\n\nconst\n\ndefault\n\ndest\n\nhelp\n\nmetavar\n\nnargs\n\nDescription Optional positional arguments supplied to a callback function specified with the callback argument. Optional keyword arguments supplied to a callback function specified with the callback argument. A list of strings that specifies all possible option values. Used when an option only has a limited set of values (for example, ['small’, 'medium', 'large']). The constant value that’s stored with the 'store_const' action. Sets the default value of the option if not supplied. By default, the default value is None. Sets the name of the attribute used to store option values dur- ing parsing. Normally the name is derived from the option name itself. Help text for this particular option. If this is not supplied, the option will be listed in help without a description. The value optparse.SUPPRESS_HELP can be used to hide an option. The special keyword '%default’ is replaced by the option default value in the help string. Specifies the name of an option argument that’s used when printing help text. Specifies the number of option arguments for actions that expect arguments. The default value is 1. If a number greater than 1 is used, option arguments will be collected into a tuple that is then used whenever arguments are handled. Specifies the type of an option. Valid types are 'string' (the default), 'int', 'long’, 'choice’, 'float’, and 'complex’.\n\ntype\n\np.disable_interspersed_args()\n\nDisallows the mixing of simple options with positional arguments. For example, if '-x’ and '-y' are options that take no parameters, the options must appear before any argu- ments (for example, 'prog -x -y arg1 arg2 arg3').\n\np.enable_interspersed_args()\n\nAllows the mixing of options with positional arguments. For example, if '-x’ and '-y' are simple options that take no parameters, they may be mixed with the arguments, such as in 'prog -x arg1 arg2 -y arg3'.This is the default behavior.\n\np.parse_args([arglist])\n\nParses command-line options and returns a tuple (options, args) where optionsis an object containing the values of all the options and argsis a list of all the remaining positional arguments left over.The optionsobject stores all the option data in attrib- utes with names that match the option name. For example, the option '--output' would have its value stored in options.output.If the option does not appear, the value will be None.The name of the attribute can be set using the dest keyword argu- ment to add_option(), described previously. By default, arguments are taken from sys.argv[1:]. However, a different source of arguments can be supplied as an optional argument, arglist.\n\nF h Lib f L Bdff\n\noptparse\n\n377\n\np.set_defaults(dest=value, ... dest=value)\n\nSets the default values of particular option destinations.You simply supply keyword arguments that specify the destinations you wish to set.The name of the keyword argu- ments should match the names specified using the dest parameter in add_option(), described earlier.\n\np.set_usage(usage)\n\nChanges the usage string displayed in text produced by the --help option.\n\nExample\n\n# foo.py import optparse p = optparse.OptionParser()\n\n# A simple option, with no arguments p.add_option(\"-t\", action=\"store_true\", dest=\"tracing\")\n\n# An option that accepts a string argument p.add_option(\"-o\", \"--outfile\", action=\"store\", type=\"string\", dest=\"outfile\")\n\n# An option requires an integer argument p.add_option(\"-d\", \"--debuglevel\", action=\"store\", type=\"int\", dest=\"debug\")\n\n# An option with a few choices p.add_option(\"--speed\", action=\"store\", type=\"choice\", dest=\"speed\",\n\nchoices=[\"slow\",\"fast\",\"ludicrous\"])\n\n# An option taking multiple arguments p.add_option(\"--coord\", action=\"store\", type=\"int\", dest=\"coord\", nargs=2)\n\n# A set of options that control a common destination p.add_option(\"--novice\", action=\"store_const\", const=\"novice\", dest=\"mode\") p.add_option(\"--guru\", action=\"store_const\", const=\"guru\", dest=\"mode\")\n\n# Set default values for the various option destinations p.set_defaults(tracing=False,\n\ndebug=0, speed=\"fast\", coord=(0,0), mode=\"novice\")\n\n# Parse the arguments opt, args = p.parse_args()\n\n# Print option values print \"tracing :\", opt.tracing print \"outfile :\", opt.outfile print \"debug :\", opt.debug print \"speed :\", opt.speed print \"coord :\", opt.coord print \"mode :\", opt.mode\n\n# Print remaining arguments print \"args :\", args\n\nF h Lib f L Bdff\n\n378\n\nChapter 19 Operating System Services\n\nHere is a short interactive UNIX session that shows how the previous code works:\n\n% python foo.py -h usage: foo.py [options]\n\noptions:\n\nh, --help show this help message and exit -t -o OUTFILE, --outfile=OUTFILE -d DEBUG, --debuglevel=DEBUG --speed=SPEED --coord=COORD --novice --guru\n\n% python foo.py -t -o outfile.dat -d 3 --coord 3 4 --speed=ludicrous blah tracing : True outfile : outfile.dat debug : 3 speed : ludicrous coord : (3, 4) mode : novice args : ['blah']\n\n% python foo.py --speed=insane usage: foo.py [options]\n\nfoo.py:error:option --speed:invalid choice:'insane' (choose from 'slow', 'fast', 'ludicrous')\n\nNotes\n\nn When specifying option names, use a single dash to specify a short name such as\n\n'-x' and a double-dash to specify a long name such as '--exclude'.An OptionError exception will be raised if you attempt to define an option that is a mix of the two styles, such as '-exclude'.\n\nn Python also includes a module getopt that provides support for command-line\n\nparsing in a style similar to a C library of the same name. For all practical purpos- es, there is no benefit to using that module over optparse (which is much high- er level and requires far less coding).\n\nn The optparse module contains a considerable number of advanced features\n\nrelated to customization and specialized handling of certain kinds of command- line options. However, none of these features are required for the most common types of command-line option parsing. Readers should consult the online library documentation for more details and additional examples.\n\nos The os module provides a portable interface to common operating-system services. It does this by searching for an OS-dependent built-in module such as nt or posix and exporting the functions and data as found there. Unless otherwise noted, functions are available on Windows and UNIX. UNIX systems include both Linux and Mac OS X.\n\nF h Lib f L Bdff\n\nos\n\n379\n\nThe following general-purpose variables are defined:\n\nenviron\n\nA mapping object representing the current environment variables. Changes to the map- ping are reflected in the current environment. If the putenv() function is also available, then changes are also reflected in subprocesses.\n\nlinesep\n\nThe string used to separate lines on the current platform. May be a single character such as '\\n' for POSIX or multiple characters such as '\\r\\n' for Windows.\n\nname\n\nThe name of the OS-dependent module imported: 'posix', 'nt', 'dos', 'mac', 'ce', 'java', 'os2', or 'riscos'.\n\npath\n\nThe OS-dependent standard module for pathname operations.This module can also be loaded using import os.path.\n\nProcess Environment The following functions are used to access and modify various parameters related to the environment in which a process runs. Process, group, process group, and session IDs are integers unless otherwise noted.\n\nchdir(path)\n\nChanges the current working directory to path.\n\nchroot(path)\n\nChanges the root directory of the current process (UNIX).\n\nctermid()\n\nReturns a string with the filename of the control terminal for the process (UNIX).\n\nfchdir(fd)\n\nChanges the current working directory. fdis a file descriptor to an opened directory (UNIX).\n\ngetcwd()\n\nReturns a string with the current working directory.\n\ngetcwdu()\n\nReturns a Unicode string with the current working directory.\n\ngetegid()\n\nReturns the effective group ID (UNIX).\n\ngeteuid()\n\nReturns the effective user ID (UNIX).\n\nF h Lib f L Bdff\n\n380\n\nChapter 19 Operating System Services\n\ngetgid()\n\nReturns the real group ID of the process (UNIX).\n\ngetgroups()\n\nReturns a list of integer group IDs to which the process owner belongs (UNIX).\n\ngetlogin()\n\nReturns the user name associated with the effective user ID (UNIX).\n\ngetpgid(pid)\n\nReturns the process group ID of the process with process ID pid. If pidis 0, the process group of the calling process is returned (UNIX).\n\ngetpgrp()\n\nReturns the ID of the current process group. Process groups are typically used in con- junction with job control.The process group is not necessarily the same as the group ID of the process (UNIX).\n\ngetpid()\n\nReturns the real process ID of the current process (UNIX and Windows).\n\ngetppid()\n\nReturns the process ID of the parent process (UNIX).\n\ngetsid(pid)\n\nReturns the process session identifier of process pid. If pidis 0, the identifier of the current process is returned (UNIX).\n\ngetuid()\n\nReturns the real user ID of the current process (UNIX).\n\nputenv(varname, value)\n\nSets environment variable varnameto value. Changes affect subprocesses started with os.system(), popen(), fork(), and execv().Assignments to items in os.environ automatically call putenv(). However, calls to putenv() don’t update os.environ (UNIX and Windows).\n\nsetegid(egid)\n\nSets the effective group ID (UNIX).\n\nseteuid(euid)\n\nSets the effective user ID (UNIX).\n\nsetgid(gid)\n\nSets the group ID of the current process (UNIX).\n\nsetgroups(groups)\n\nSets the group access list of the current process. groupsis a sequence of integers speci- fying group identifiers. Can only be called by root (UNIX).\n\nF h Lib f L Bdff\n\nos\n\n381\n\nsetpgrp()\n\nCreates a new process group by calling the system call setpgrp() or setpgrp(0, 0), depending on which version is implemented (if any). Returns the ID of the new process group (UNIX).\n\nsetpgid(pid, pgrp)\n\nAssigns process pidto process group pgrp. If pidis equal to pgrp, the process becomes a new process group leader. If pidis not equal to pgrp, the process joins an existing group. If pidis 0, the process ID of the calling process is used. If pgrpis 0, the process specified by pidbecomes a process group leader (UNIX).\n\nsetreuid(ruid,euid)\n\nSets the real and effective user ID of the calling process (UNIX).\n\nsetregid(rgid,egid)\n\nSets the real and effective group ID of the calling process (UNIX).\n\nsetsid()\n\nCreates a new session and returns the newly created session ID. Sessions are typically associated with terminal devices and the job control of processes that are started within them (UNIX).\n\nsetuid(uid)\n\nSets the real user ID of the current process.This function is privileged and often can be performed only by processes running as root (UNIX).\n\nstrerror(code)\n\nReturns the error message corresponding to the integer error code(UNIX and Windows).The errno module defines symbolic names for these error codes.\n\numask(mask)\n\nSets the current numeric umask and returns the previous umask.The umask is used to clear permissions bits on files that are created by the process (UNIX and Windows).\n\nuname()\n\nReturns a tuple of strings (sysname, nodename, release, version, machine) identifying the system type (UNIX).\n\nunsetenv(name)\n\nUnsets the environment variable name.\n\nFile Creation and File Descriptors The following functions provide a low-level interface for manipulating files and pipes. In these functions, files are manipulated in terms of an integer file descriptor, fd.The file descriptor can be extracted from a file object by invoking its fileno() method.\n\nclose(fd)\n\nCloses the file descriptor fdpreviously returned by open() or pipe().\n\nF h Lib f L Bdff\n\n382\n\nChapter 19 Operating System Services\n\ncloserange(low, high)\n\nCloses all file descriptors fdin the range low <= fd < high. Errors are ignored.\n\ndup(fd)\n\nDuplicates file descriptor fd. Returns a new file descriptor that’s the lowest-numbered unused file descriptor for the process.The new and old file descriptors can be used interchangeably. Furthermore, they share state, such as the current file pointer and locks (UNIX and Windows).\n\ndup2(oldfd, newfd)\n\nDuplicates file descriptor oldfdto newfd. If newfdalready corresponds to a valid file descriptor, it’s closed first (UNIX and Windows).\n\nfchmod(fd, mode)\n\nChanges the mode of the file associated with fdto mode. See the description of os.open() for a description of mode(UNIX).\n\nfchown(fd, uid, gid)\n\nChanges the owner and group ID of the file associated with fdto uidand gid. Use a valid of -1 for uidor gidto keep the value unchanged (UNIX).\n\nfdatasync(fd)\n\nForces all cached data written to fdto be flushed to disk (UNIX).\n\nfdopen(fd [, mode [, bufsize]])\n\nCreates an open file object connected to file descriptor fd.The modeand bufsize arguments have the same meaning as in the built-in open() function. modeshould be a string such as 'r', 'w', or 'a'. On Python 3, this function accepts any additional parameters that work with the built-in open() function such as specifications for the encoding and line ending. However, if portability with Python 2 is a concern, you should only use the modeand bufsizearguments described here.\n\nfpathconf(fd, name)\n\nReturns configurable pathname variables associated with the open file with descriptor fd. nameis a string that specifies the name of the value to retrieve.The values are usual- ly taken from parameters contained in system header files such as <limits.h> and <unistd.h>. POSIX defines the following constants for name:\n\nConstant \"PC_ASYNC_IO\"\n\n\"PC_CHOWN_RESTRICTED\"\n\n\"PC_FILESIZEBITS\"\n\n\"PC_LINK_MAX\"\n\n\"PC_MAX_CANON\"\n\nDescription Indicates whether asynchronous I/O can be performed on fd. Indicates whether the chown() function can be used. If fdrefers to a directory, this applies to all files in the directory. Maximum size of a file. Maximum value of the file’s link count. Maximum length of a formatted input line. fdrefers to a terminal. Maximum length of an input line. fdrefers to a terminal.\n\n\"PC_MAX_INPUT\"\n\nF h Lib f L Bdff\n\nos\n\n383\n\nConstant \"PC_NAME_MAX\"\n\n\"PC_NO_TRUNC\"\n\n\"PC_PATH_MAX\"\n\n\"PC_PIPE_BUF\"\n\n\"PC_PRIO_IO\"\n\n\"PC_SYNC_IO\"\n\n\"PC_VDISABLE\"\n\nDescription Maximum length of a filename in a directory. Indicates whether an attempt to create a file with a name longer than PC_NAME_MAX for a directory will fail with an ENAMETOOLONG error. Maximum length of a relative path name when the direc- tory fdis the current working directory. Size of the pipe buffer when fdrefers to a pipe or FIFO. Indicates whether priority I/O can be performed on fd. Indicates whether synchronous I/O can be performed on fd. Indicates whether fdallows special-character processing to be disabled. fdmust refer to a terminal.\n\nNot all names are available on all platforms, and some systems may define additional configuration parameters. However, a list of the names known to the operating system can be found in the dictionary os.pathconf_names. If a known configuration name is not included in os.pathconf_names, its integer value can also be passed as name. Even if a name is recognized by Python, this function may still raise an OSError if the host operating system doesn’t recognize the parameter or associate it with the file fd.This function is only available on some versions of UNIX.\n\nfstat(fd)\n\nReturns the status for file descriptor fd. Returns the same values as the os.stat() function (UNIX and Windows).\n\nfstatvfs(fd)\n\nReturns information about the file system containing the file associated with file descriptor fd. Returns the same values as the os.statvfs() function (UNIX).\n\nfsync(fd)\n\nForces any unwritten data on fdto be written to disk. Note that if you are using an object with buffered I/O (for example, a Python file object), you should first flush the data before calling fsync().Available on UNIX and Windows.\n\nftruncate(fd, length)\n\nTruncates the file corresponding to file descriptor fdso that it’s at most lengthbytes in size (UNIX).\n\nisatty(fd)\n\nReturns True if fdis associated with a TTY-like device such as a terminal (UNIX).\n\nlseek(fd, pos, how)\n\nSets the current position of file descriptor fdto position pos.Values of howare as fol- lows: SEEK_SET sets the position relative to the beginning of the file, SEEK_CUR sets it relative to the current position, and SEEK_END sets it relative to the end of the file. In older Python code, it is common to see these constants replaced with their numeric values of 0, 1, or 2, respectively.\n\nF h Lib f L Bdff\n\n384\n\nChapter 19 Operating System Services\n\nopen(file [, flags [, mode]])\n\nOpens the file file. flagsis the bitwise OR of the following constant values:\n\nValue O_RDONLY\n\nO_WRONLY\n\nO_RDWR\n\nO_APPEND\n\nO_CREAT\n\nO_NONBLOCK\n\nO_NDELAY\n\nO_DSYNC\n\nO_NOCTTY\n\nO_TRUNC\n\nO_RSYNC\n\nO_SYNC\n\nO_EXCL\n\nO_EXLOCK\n\nO_SHLOCK\n\nO_ASYNC\n\nO_DIRECT\n\nO_DIRECTORY\n\nO_NOFOLLOW\n\nO_NOATIME\n\nO_TEXT\n\nDescription Open the file for reading. Open the file for writing. Open for reading and writing (updates). Append bytes to the end of the file. Create the file if it doesn’t exist. Don’t block on open, read, or write (UNIX). Same as O_NONBLOCK (UNIX). Synchronous writes (UNIX). When opening a device, don’t set controlling terminal (UNIX). If the file exists, truncates to zero length. Synchronous reads (UNIX). Synchronous writes (UNIX). Error if O_CREAT and the file already exists. Set an exclusive lock on the file. Set a shared lock on the file. Enables asynchronous input mode in which a SIGIO signal is gen- erated with input is available. Use direct I/O mode where reads and writes go directly to the disk instead of the operating system read/write caches. Raises an error if the file is not a directory. Don’t follow symbolic links. Don’t update the last access time of the file. Text mode (Windows). Binary mode (Windows). File not inherited by child processes (Windows).\n\nO_BINARY O_NOINHERIT O_SHORT_LIVED Hint to system that the file is used for short-term storage\n\nO_TEMPORARY\n\nO_RANDOM\n\nO_SEQUENTIAL\n\n(Windows). Delete file when closed (Windows). Hint to system that file will be used for random access (Windows). Hint to system that file will be accessed sequentially (Windows).\n\nSynchronous I/O modes (O_SYNC, O_DSYNC, O_RSYNC) force I/O operations to block until they’ve been completed at the hardware level (for example, a write will block until the bytes have been physically written to disk).The modeparameter contains the file permissions represented as the bitwise OR of the following octal values (which are defined as constants in the stat module as indicated):\n\nMode 0100\n\n0200\n\n0400\n\n0700\n\nMeaning User has execute permission (stat.S_IXUSR). User has write permission (stat.S_IWUSR). User has read permission (stat.S_IRUSR). User has read/write/exec permission (stat.S_IRWXU).\n\nF h Lib f L Bdff\n\nos\n\n385\n\nMode 0010\n\n0020\n\n0040\n\n0070\n\n0001\n\n0002\n\n0004\n\n0007\n\n4000\n\n2000\n\nMeaning Group has execute permission (stat.S_IXGRP). Group has write permission (stat.S_IWGRP). Group has read permission (stat.S_IRGRP). Group has read/write/exec permission (stat.S_IRWXG). Others have execute permission (stat.S_IXOTH). Others have write permission (stat.S_IWOTH). Others have read permission (stat.S_IROTH). Others have read/write/exec permission (stat.S_IRWXO). Set UID mode (stat.S_ISUID). Set GID mode (stat.S_ISGID). Set the sticky bit (stat.S_ISVTX).\n\n1000\n\nThe default mode of a file is (0777 & ˜umask), where the umask setting is used to remove selected permissions. For example, a umask of 0022 removes the write permis- sion for groups and others.The umask can be changed using the os.umask() function. The umask setting has no effect on Windows.\n\nopenpty()\n\nOpens a psuedo-terminal and returns a pair of file descriptors (master,slave) for the PTY and TTY.Available on some versions of UNIX.\n\npipe()\n\nCreates a pipe that can be used to establish unidirectional communication with another process. Returns a pair of file descriptors (r, w) usable for reading and writing, respec- tively.This function is usually called prior to executing a fork() function.After the fork(), the sending process closes the read end of the pipe and the receiving process closes the write end of the pipe.At this point, the pipe is activated and data can be sent from one process to another using read() and write() functions (UNIX).\n\nread(fd, n)\n\nReads at most nbytes from file descriptor fd. Returns a byte string containing the bytes read.\n\ntcgetpgrp(fd)\n\nReturns the process group associated with the control terminal given by fd(UNIX).\n\ntcsetpgrp(fd, pg)\n\nSets the process group associated with the control terminal given by fd(UNIX).\n\nttyname(fd)\n\nReturns a string that specifies the terminal device associated with file descriptor fd. If fdis not associated with a terminal device, an OSError exception is raised (UNIX).\n\nwrite(fd, str)\n\nWrites the byte string strto file descriptor fd. Returns the number of bytes actually written.\n\nF h Lib f L Bdff\n\n386\n\nChapter 19 Operating System Services\n\nFiles and Directories The following functions and variables are used to manipulate files and directories on the file system.To handle variances in filenaming schemes, the following variables con- tain information about the construction of path names:\n\nVariable altsep\n\ncurdir\n\ndevnull\n\nextsep\n\npardir\n\npathsep\n\nsep\n\nDescription An alternative character used by the OS to separate pathname compo- nents, or None if only one separator character exists. This is set to '/' on DOS and Windows systems, where sepis a backslash. The string used to refer to the current working directory: '.' for UNIX and Windows and ':' for the Macintosh. The path of the null device (for example, /dev/null). Character that separates the base filename from its type (for example, the '.' in 'foo.txt'). The string used to refer to the parent directory: '..' for UNIX and Windows and '::' for the Macintosh. The character used to separate search path components (as contained in the $PATH environment variable): ':' for UNIX and ';' for DOS and Windows. The character used to separate pathname components: '/' for UNIX and Windows and ':' for the Macintosh.\n\nThe following functions are used to manipulate files:\n\naccess(path, accessmode)\n\nChecks read/write/execute permissions for this process to access the file path. accessmodeis R_OK, W_OK, X_OK, or F_OK for read, write, execute, or existence, respectively. Returns 1 if access is granted, 0 if not.\n\nchflags(path, flags)\n\nChanges the file flags on path. flagsis the bitwise-or of the constants listed next. Flags starting with UF_ can be set by any user, whereas SF_ flags can only be changed by the superuser (UNIX).\n\nFlag stat.UF_NODUMP\n\nstat.UF_IMMUTABLE\n\nstat.UF_APPEND\n\nstat.UF_OPAQUE\n\nstat.UF_NOUNLINK\n\nstat.SF_ARCHIVED\n\nstat.SF_IMMUTABLE\n\nstat.SF_APPEND\n\nstat.SF_NOUNLINK\n\nMeaning Do not dump the file. The file is read-only. The file only supports append operations. The directory is opaque. The file may not be deleted or renamed. The file can be archived. The file is read-only. The file only supports append operations. The file may not be deleted or renamed. The file is a snapshot file.\n\nstat.SF_SNAPSHOT\n\nF h Lib f L Bdff\n\nos\n\n387\n\nchmod(path, mode)\n\nChanges the mode of path. modehas the same values as described for the open() function (UNIX and Windows).\n\nchown(path, uid, gid)\n\nChanges the owner and group ID of pathto the numeric uidand gid. Setting uidor gidto -1 causes that parameter to remain unmodified (UNIX).\n\nlchflags(path, flags)\n\nThe same as chflags(), but doesn’t follow symbolic links (UNIX).\n\nlchmod(path, mode)\n\nThe same as chmod() except that if pathis a symbolic link, it modifies the link itself, not the file the link refers to.\n\nlchown(path, uid, gid)\n\nThe same as chown() but doesn’t follow symbolic links (UNIX).\n\nlink(src, dst)\n\nCreates a hard link named dstthat points to src(UNIX).\n\nlistdir(path)\n\nReturns a list containing the names of the entries in the directory path.The list is returned in arbitrary order and doesn’t include the special entries of '.' and '..'. If pathis Unicode, the resulting list will only contain Unicode strings. Be aware that if any filenames in the directory can’t be properly encoded into Unicode, they are silently skipped. If pathis given as a byte string, then all filenames are returned as a list of byte strings.\n\nlstat(path)\n\nLike stat() but doesn’t follow symbolic links (UNIX).\n\nmakedev(major, minor)\n\nCreates a raw device number given major and minor device numbers (UNIX).\n\nmajor(devicenum)\n\nReturns the major device number from a raw device number devicenumcreated by makedev().\n\nminor(devicenum)\n\nReturns the minor device number from a raw device number devicenumcreated by makedev().\n\nmakedirs(path [, mode])\n\nRecursive directory-creation function. Like mkdir() but makes all the intermediate- level directories needed to contain the leaf directory. Raises an OSError exception if the leaf directory already exists or cannot be created.\n\nF h Lib f L Bdff\n\n388\n\nChapter 19 Operating System Services\n\nmkdir(path [, mode])\n\nCreates a directory named pathwith numeric mode mode.The default mode is 0777. On non-UNIX systems, the mode setting may have no effect or be ignored.\n\nmkfifo(path [, mode])\n\nCreates a FIFO (a named pipe) named pathwith numeric mode mode.The default mode is 0666 (UNIX).\n\nmknod(path [, mode, device])\n\nCreates a device-special file. pathis the name of the file, modespecifies the permissions and type of file, and deviceis the raw device number created using os.makedev(). The modeparameter accepts the same parameters as open() when setting the file’s access permissions. In addition, the flags stat.S_IFREG, stat.S_IFCHR, stat.S_IFBLK, and stat.S_IFIFO are added to modeto indicate a file type (UNIX).\n\npathconf(path, name)\n\nReturns configurable system parameters related to the path name path. nameis a string that specifies the name of the parameter and is the same as described for the fpathconf() function (UNIX).\n\nreadlink(path)\n\nReturns a string representing the path to which a symbolic link, path, points (UNIX).\n\nremove(path)\n\nRemoves the file path.This is identical to the unlink() function.\n\nremovedirs(path)\n\nRecursive directory-removal function.Works like rmdir() except that, if the leaf direc- tory is successfully removed, directories corresponding to the rightmost path segments will be pruned away until either the whole path is consumed or an error is raised (which is ignored because it generally means that a parent directory isn’t empty). Raises an OSError exception if the leaf directory could not be removed successfully.\n\nrename(src, dst)\n\nRenames the file or directory srcto dst.\n\nrenames(old, new)\n\nRecursive directory-renaming or file-renaming function.Works like rename() except it first attempts to create any intermediate directories needed to make the new path name. After the rename, directories corresponding to the rightmost path segments of the old name will be pruned away using removedirs().\n\nrmdir(path)\n\nRemoves the directory path.\n\nstat(path)\n\nPerforms a stat() system call on the given pathto extract information about a file. The return value is an object whose attributes contain file information. Common attributes include:\n\nF h Lib f L Bdff\n\nos\n\n389\n\nAttribute st_mode\n\nst_ino\n\nst_dev\n\nst_nlink\n\nst_uid\n\nst_gid\n\nst_size\n\nst_atime\n\nst_mtime\n\nDescription Inode protection mode Inode number Device the inode resides on Number of links to the inode User ID of the owner Group ID of the owner File size in bytes Time of last access Time of last modification Time of last status change\n\nst_ctime\n\nHowever, additional attributes may be available depending on the system.The object returned by stat() also looks like a 10-tuple containing the parameters (st_mode, st_ino, st_dev, st_nlink, st_uid, st_gid, st_size, st_atime, st_mtime, st_ctime).This latter form is provided for backward compatibility.The stat module defines constants that are used to extract fields from this tuple.\n\nstat_float_times([newvalue])\n\nReturns True if the times returned by stat() are floating-point numbers instead of integers.The behavior can be changed by supplying a Boolean value for newvalue.\n\nstatvfs(path)\n\nPerforms a statvfs() system call on the given pathto get information about the file system.The return value is an object whose attributes describe the file system. Common attributes include:\n\nAttribute f_bsize\n\nf_frsize\n\nf_blocks\n\nf_bfree\n\nf_bavail\n\nf_files\n\nf_ffree\n\nf_favail\n\nf_flag\n\nDescription Preferred system block size Fundamental file system block size Total number of blocks in the file system Total number of free blocks Free blocks available to a non-superuser Total number of file inodes Total number of free file inodes Free nodes available to a non-superuser Flags (system-dependent) Maximum filename length\n\nf_namemax\n\nThe returned object also behaves like a tuple containing these attributes in the order listed.The standard module statvfs defines constants that can be used to extract infor- mation from the returned statvfs data (UNIX).\n\nsymlink(src, dst)\n\nCreates a symbolic link named dstthat points to src.\n\nF h Lib f L Bdff\n\n390\n\nChapter 19 Operating System Services\n\nunlink(path)\n\nRemoves the file path. Same as remove().\n\nutime(path, (atime, mtime))\n\nSets the access and modified time of the file to the given values. (The second argument is a tuple of two items.) The time arguments are specified in terms of the numbers returned by the time.time() function.\n\nwalk(top [, topdown [, onerror [,followlinks]]])\n\nCreates a generator object that walks through a directory tree. topspecifies the top of the directory, and topdownis a Boolean that indicates whether to traverse directories in a top-down (the default) or bottom-up order.The returned generator produces tuples (dirpath, dirnames, filenames) where dirpathis a string containing the path to the directory, dirnamesis a list of all subdirectories in dirpath, and filenamesis a list of the files in dirpath, not including directories.The onerrorparameter is a func- tion accepting a single argument. If any errors occur during processing, this function will be called with an instance of os.error.The default behavior is to ignore errors. If a directory is walked in a top-down manner, modifications to dirnameswill affect the walking process. For example, if directories are removed from dirnames, those directo- ries will be skipped. By default, symbolic links are not followed unless the fol- lowlinksargument is set to True.\n\nProcess Management The following functions and variables are used to create, destroy, and manage processes:\n\nabort()\n\nGenerates a SIGABRT signal that’s sent to the calling process. Unless the signal is caught with a signal handler, the default is for the process to terminate with an error.\n\ndefpath\n\nThis variable contains the default search path used by the exec*p*() functions if the environment doesn’t have a 'PATH' variable.\n\nexecl(path, arg0, arg1, ...)\n\nEquivalent to execv(path, (arg0, arg1, ...)).\n\nexecle(path, arg0, arg1, ..., env)\n\nEquivalent to execve(path, (arg0, arg1, ...), env).\n\nexeclp(path, arg0, arg1, ...)\n\nEquivalent to execvp(path, (arg0, arg1, ...)).\n\nexecv(path, args)\n\nExecutes the program pathwith the argument list args, replacing the current process (that is, the Python interpreter).The argument list may be a tuple or list of strings.\n\nF h Lib f L Bdff\n\nos\n\n391\n\nexecve(path, args, env)\n\nExecutes a new program like execv() but additionally accepts a dictionary, env, that defines the environment in which the program runs. envmust be a dictionary mapping strings to strings.\n\nexecvp(path, args)\n\nLike execv(path, args) but duplicates the shell’s actions in searching for an exe- cutable file in a list of directories.The directory list is obtained from environ['PATH'].\n\nexecvpe(path, args, env)\n\nLike execvp() but with an additional environment variable as in the execve() func- tion.\n\n_exit(n)\n\nExits immediately to the system with status n, without performing any cleanup actions. This is typically only done in child processes created by fork().This is also different than calling sys.exit(), which performs a graceful shutdown of the interpreter.The exit code nis application-dependent, but a value of 0 usually indicates success, whereas a nonzero value indicates an error of some kind. Depending on the system, a number of standard exit code values may be defined:\n\nValue EX_OK\n\nEX_USAGE\n\nEX_DATAERR\n\nEX_NOINPUT\n\nEX_NOUSER\n\nEX_NOHOST\n\nEX_NOTFOUND\n\nEX_UNAVAILABLE\n\nEX_SOFTWARE\n\nEX_OSERR\n\nEX_OSFILE\n\nEX_CANTCREAT\n\nEX_IOERR\n\nEX_TEMPFAIL\n\nEX_PROTOCOL\n\nDescription No errors. Incorrect command usage. Incorrect input data. Missing input. User doesn’t exist. Host doesn’t exist. Not found. Service unavailable. Internal software error. Operating system error. File system error. Can’t create output. I/O error. Temporary failure. Protocol error. Insufficient permissions. Configuration error.\n\nEX_NOPERM\n\nEX_CONFIG\n\nfork()\n\nCreates a child process. Returns 0 in the newly created child process and the child’s process ID in the original process.The child process is a clone of the original process and shares many resources such as open files (UNIX).\n\nF h Lib f L Bdff\n\n392\n\nChapter 19 Operating System Services\n\nforkpty()\n\nCreates a child process using a new pseudo-terminal as the child’s controlling terminal. Returns a pair (pid, fd), in which pidis 0 in the child and fdis a file descriptor of the master end of the pseudo-terminal.This function is available only in certain versions of UNIX.\n\nkill(pid, sig)\n\nSends the process pidthe signal sig.A list of signal names can be found in the signal module (UNIX).\n\nkillpg(pgid, sig)\n\nSends the process group pgidthe signal sig. A list of signal names can be found in the signal module (UNIX).\n\nnice(increment)\n\nAdds an increment to the scheduling priority (the “niceness”) of the process. Returns the new niceness.Typically, users can only decrease the priority of a process because increasing the priority requires root access.The effect of changing the priority is system-dependent, but decreasing the priority is commonly done to make a process run in the background in a way such that it doesn’t noticeably impact the performance of other processes (UNIX).\n\nplock(op)\n\nLocks program segments into memory, preventing them from being swapped.The value of opis an integer that determines which segments are locked.The value of opis platform-specific but is typically one of UNLOCK, PROCLOCK, TXTLOCK, or DATLOCK. These constants are not defined by Python but might be found in the <sys/lock.h> header file.This function is not available on all platforms and often can be performed only by a process with an effective user ID of 0 (root) (UNIX).\n\npopen(command [, mode [, bufsize]])\n\nOpens a pipe to or from a command.The return value is an open file object connected to the pipe, which can be read or written depending on whether modeis 'r' (the default) or 'w'. bufsizehas the same meaning as in the built-in open() function.The exit status of the command is returned by the close() method of the returned file object, except that when the exit status is zero, None is returned.\n\nspawnv(mode, path, args)\n\nExecutes the program pathin a new process, passing the arguments specified in argsas command-line parameters. argscan be a list or a tuple.The first element of args should be the name of the program. modeis one of the following constants:\n\nConstant P_WAIT\n\nP_NOWAIT\n\nP_NOWAITO\n\nDescription Executes the program and waits for it to terminate. Returns the pro- gram’s exit code. Executes the program and returns the process handle. Same as P_NOWAIT.\n\nF h Lib f L Bdff\n\nos\n\n393\n\nConstant P_OVERLAY\n\nP_DETACH\n\nDescription Executes the program and destroys the calling process (same as the exec functions). Executes the program and detaches from it. The calling program contin- ues to run but cannot wait for the spawned process.\n\nspawnv() is available on Windows and some versions of UNIX.\n\nspawnve(mode, path, args, env)\n\nExecutes the program pathin a new process, passing the arguments specified in argsas command-line parameters and the contents of the mapping envas the environment. argscan be a list or a tuple. modehas the same meaning as described for spawnv().\n\nspawnl(mode, path, arg1, ..., argn)\n\nThe same as spawnv() except that all the arguments are supplied as extra parameters.\n\nspawnle(mode, path, arg1, ... , argn, env)\n\nThe same as spawnve() except that the arguments are supplied as parameters.The last parameter is a mapping containing the environment variables.\n\nspawnlp(mode, file, arg1, ... , argn)\n\nThe same as spawnl() but looks for fileusing the settings of the PATH environment variable (UNIX).\n\nspawnlpe(mode, file, arg1, ... , argn, env)\n\nThe same as spawnle() but looks for fileusing the settings of the PATH environment variable (UNIX).\n\nspawnvp(mode, file, args)\n\nThe same as spawnv() but looks for fileusing the settings of the PATH environment variable (UNIX).\n\nspawnvpe(mode, file, args, env)\n\nThe same as spawnve() but looks for fileusing the settings of the PATH environment variable (UNIX).\n\nstartfile(path [, operation])\n\nLaunches the application associated with the file path.This performs the same action as would occur if you double-clicked the file in Windows Explorer.The function returns as soon as the application is launched. Furthermore, there is no way to wait for comple- tion or to obtain exit codes from the application. pathis a relative to the current direc- tory. operationis an optional string that specifies the action to perform when opening path. By default, it is set to 'open’, but it may be set to 'print', 'edit', 'explore', or 'find' (the exact list depends on the type of path(Windows)).\n\nsystem(command)\n\nExecutes command(a string) in a subshell. On UNIX, the return value is the exit status of the process as returned by wait(). On Windows, the exit code is always 0.The subprocess module provides considerably more power and is the preferred way to launch subprocesses.\n\nF h Lib f L Bdff\n\n394\n\nChapter 19 Operating System Services\n\ntimes()\n\nReturns a 5-tuple of floating-point numbers indicating accumulated times in seconds. On UNIX, the tuple contains the user time, system time, children’s user time, children’s system time, and elapsed real time in that order. On Windows, the tuple contains the user time, system time, and zeros for the other three values.\n\nwait([pid])\n\nWaits for completion of a child process and returns a tuple containing its process ID and exit status.The exit status is a 16-bit number whose low byte is the signal number that killed the process and whose high byte is the exit status (if the signal number is zero).The high bit of the low byte is set if a core file was produced. pid, if given, speci- fies the process to wait for. If it’s omitted, wait() returns when any child process exits (UNIX).\n\nwaitpid(pid, options)\n\nWaits for a change in the state of a child process given by process ID pidand returns a tuple containing its process ID and exit status indication, encoded as for wait(). optionsshould be 0 for normal operation or WNOHANG to avoid hanging if no child process status is available immediately.This function can also be used to gather informa- tion about child processes that have only stopped executing for some reason. Setting optionsto WCONTINUED gathers information from a child when it resumes operation after being stopped via job control. Setting optionsto WUNTRACED gathers information from a child that has been stopped, but from which no status information has been reported yet.\n\nwait3([options])\n\nThe same as waitpid() except that the function waits for a change in any child process. Returns a 3-tuple (pid, status, rusage), where pidis the child process ID, statusis the exit status code, and rusagecontains resource usage information as returned by resource.getrusage().The optionsparameter has the same meaning as for waitpid().\n\nwait4(pid, options)\n\nThe same as waitpid() except that the return result is the same tuple as returned by wait3().\n\nThe following functions take a process status code as returned by waitpid(), wait3(), or wait4() and are used to examine the state of the process (UNIX).\n\nWCOREDUMP(status)\n\nReturns True if the process dumped core.\n\nWIFEXITED(status)\n\nReturns True if the process exited using the exit() system call.\n\nWEXITSTATUS(status)\n\nIf WIFEXITED(status) is true, the integer parameter to the exit() system call is returned. Otherwise, the return value is meaningless.\n\nF h Lib f L Bdff\n\nos\n\n395\n\nWIFCONTINUED(status)\n\nReturns True if the process has resumed from a job-control stop.\n\nWIFSIGNALED(status)\n\nReturns True if the process exited due to a signal.\n\nWIFSTOPPED(status)\n\nReturns True if the process has been stopped.\n\nWSTOPSIG(status)\n\nReturns the signal that caused the process to stop.\n\nWTERMSIG(status)\n\nReturns the signal that caused the process to exit.\n\nSystem Configuration The following functions are used to obtain system configuration information:\n\nconfstr(name)\n\nReturns a string-valued system configuration variable. nameis a string specifying the name of the variable.The acceptable names are platform-specific, but a dictionary of known names for the host system is found in os.confstr_names. If a configuration value for a specified name is not defined, the empty string is returned. If nameis unknown, ValueError is raised.An OSError may also be raised if the host system doesn’t support the configuration name.The parameters returned by this function most- ly pertain to the build environment on the host machine and include paths of system utilities, compiler options for various program configurations (for example, 32-bit, 64- bit, and large-file support), and linker options (UNIX).\n\ngetloadavg()\n\nReturns a 3-tuple containing the average number of items in the system run-queue over the last 1, 5, and 15 minutes (UNIX).\n\nsysconf(name)\n\nReturns an integer-valued system-configuration variable. nameis a string specifying the name of the variable.The names defined on the host system can be found in the dic- tionary os.sysconf_names. Returns -1 if the configuration name is known but the value is not defined. Otherwise, a ValueError or OSError may be raised. Some sys- tems may define more than 100 different system parameters. However, the following list details the parameters defined by POSIX.1 that should be available on most UNIX systems:\n\nParameter \"SC_ARG_MAX\"\n\nDescription Maximum length of the arguments that can be used with exec(). Maximum number of processes per user ID. Number of clock ticks per second.\n\n\"SC_CHILD_MAX\"\n\n\"SC_CLK_TCK\" \"SC_NGROUPS_MAX\" Maximum number of simultaneous supplementary group IDs. \"SC_STREAM_MAX\" Maximum number of streams a process can open at one time.\n\nF h Lib f L Bdff",
      "page_number": 400
    },
    {
      "number": 21,
      "title": "Segment 21 (pages 420-438)",
      "start_page": 420,
      "end_page": 438,
      "detection_method": "synthetic",
      "content": "396\n\nChapter 19 Operating System Services\n\nParameter \"SC_TZNAME_MAX\" Maximum number of bytes in a time zone name. \"SC_OPEN_MAX\" \"SC_JOB_CONTROL\" System supports job control. \"SC_SAVED_IDS\"\n\nDescription\n\nMaximum number of files a process can open at one time.\n\nIndicates whether each process has a saved set-user-ID and a saved set-group-ID.\n\nurandom(n)\n\nReturns a string containing nrandom bytes generated by the system (for example, /dev/urandom on UNIX).The returned bytes are suitable for cryptography.\n\nExceptions The os module defines a single exception to indicate errors.\n\nerror\n\nException raised when a function returns a system-related error.This is the same as the built-in exception OSError.The exception carries two values: errno and strerr.The first contains the integer error value as described for the errno module.The latter con- tains a string error message. For exceptions involving the file system, the exception also contains a third attribute, filename, which is the filename passed to the function.\n\nos.path The os.path module is used to manipulate pathnames in a portable manner. It’s imported by the os module.\n\nabspath(path)\n\nReturns an absolute version of the path name path, taking the current working direc- tory into account. For example, abspath('../Python/foo') might return '/home/beazley/Python/foo'.\n\nbasename(path)\n\nReturns the base name of path name path. For example, basename('/usr/local/ python') returns 'python'.\n\ncommonprefix(list)\n\nReturns the longest string that’s a prefix of all strings in list. If listis empty, the empty string is returned.\n\ndirname(path)\n\nReturns the directory name of path name path. For example, dirname('/usr/local/ python') returns '/usr/local'.\n\nexists(path)\n\nReturns True if pathrefers to an existing path. Returns False if pathrefers to a bro- ken symbolic link.\n\nF h Lib f L Bdff\n\nos.path\n\n397\n\nexpanduser(path)\n\nReplaces path names of the form '~user' with a user’s home directory. If the expan- sion fails or pathdoes not begin with '~', the path is returned unmodified.\n\nexpandvars(path)\n\nExpands environment variables of the form '$name' or '${name}' in path. Malformed or nonexistent variable names are left unchanged.\n\ngetatime(path)\n\nReturns the time of last access as the number of seconds since the epoch (see the time module).The return value may be a floating-point number if os.stat_float_times() returns True.\n\ngetctime(path)\n\nReturns the time of last modification on UNIX and the time of creation on Windows. The time is returned as the number of seconds since the epoch (see the time module). The return value may be a floating-point number in certain cases (see getatime()).\n\ngetmtime(path)\n\nReturns the time of last modification as the number of seconds since the epoch (see the time module).The return value may be a floating-point number in certain cases (see getatime()).\n\ngetsize(path)\n\nReturns the file size in bytes.\n\nisabs(path)\n\nReturns True if pathis an absolute path name (begins with a slash).\n\nisfile(path)\n\nReturns True if pathis a regular file.This function follows symbolic links, so both islink() and isfile() can be true for the same path.\n\nisdir(path)\n\nReturns True if pathis a directory. Follows symbolic links.\n\nislink(path)\n\nReturns True if pathrefers to a symbolic link. Returns False if symbolic links are unsupported.\n\nismount(path)\n\nReturns True if pathis a mount point.\n\njoin(path1 [, path2 [, ...]])\n\nIntelligently joins one or more path components into a pathname. For example, join('home', 'beazley', 'Python') returns 'home/beazley/Python'.\n\nlexists(path)\n\nReturns True if pathexists. Returns True for all symbolic links, even if the link is bro- ken.\n\nF h Lib f L Bdff\n\n398\n\nChapter 19 Operating System Services\n\nnormcase(path)\n\nNormalizes the case of a path name. On non-case-sensitive file systems, this converts pathto lowercase. On Windows, forward slashes are also converted to backslashes.\n\nnormpath(path)\n\nNormalizes a path name.This collapses redundant separators and up-level references so that 'A//B', 'A/./B', and 'A/foo/../B' all become 'A/B'. On Windows, forward slashes are converted to backslashes.\n\nrealpath(path)\n\nReturns the real path of path, eliminating symbolic links if any (UNIX).\n\nrelpath(path [, start])\n\nReturns a relative path to pathfrom the current working directory. startcan be sup- plied to specify a different starting directory.\n\nsamefile(path1, path2)\n\nReturns True if path1and path2refer to the same file or directory (UNIX).\n\nsameopenfile(fp1, fp2)\n\nReturns True if the open file objects fp1and fp2refer to the same file (UNIX).\n\nsamestat(stat1, stat2)\n\nReturns True if the stat tuples stat1and stat2as returned by fstat(), lstat(), or stat() refer to the same file (UNIX).\n\nsplit(path)\n\nSplits pathinto a pair (head, tail), where tailis the last pathname component and headis everything leading up to that. For example, '/home/user/foo' gets split into ('/home/ user', 'foo').This tuple is the same as would be returned by (dirname(), basename()).\n\nsplitdrive(path)\n\nSplits pathinto a pair (drive, filename) where driveis either a drive specification or the empty string. driveis always the empty string on machines without drive speci- fications.\n\nsplitext(path)\n\nSplits a path name into a base filename and suffix. For example, splitext('foo.txt') returns ('foo', '.txt').\n\nsplitunc(path)\n\nSplits a path name into a pair (unc,rest) where uncis a UNC (Universal Naming Convention) mount point and restthe remainder of the path (Windows).\n\nsupports_unicode_filenames\n\nVariable set to True if the file system allows Unicode filenames.\n\nF h Lib f L Bdff\n\nsignal\n\n399\n\nNote\n\nOn Windows, some care is required when working with filenames that include a drive let- ter (for example, 'C:spam.txt'). In most cases, filenames are interpreted as being relative to the current working directory. For example, if the current directory is 'C:\\Foo\\', then the file 'C:spam.txt' is interpreted as the file 'C:\\Foo\\C:spam.txt', not the file 'C:\\spam.txt'.\n\nSee Also:\n\nfnmatch (p. 316), glob (p. 317), os (p. 378).\n\nsignal The signal module is used to write signal handlers in Python. Signals usually corre- spond to asynchronous events that are sent to a program due to the expiration of a timer, arrival of incoming data, or some action performed by a user.The signal interface emulates that of UNIX, although parts of the module are supported on other platforms.\n\nalarm(time)\n\nIf timeis nonzero, a SIGALRM signal is scheduled to be sent to the program in time seconds.Any previously scheduled alarm is canceled. If timeis zero, no alarm is sched- uled and any previously set alarm is canceled. Returns the number of seconds remain- ing before any previously scheduled alarm or zero if no alarm was scheduled (UNIX).\n\ngetsignal(signalnum)\n\nReturns the signal handler for signal signalnum.The returned object is a callable Python object.The function may also return SIG_IGN for an ignored signal, SIG_DFL for the default signal handler, or None if the signal handler was not installed from the Python interpreter.\n\ngetitimer(which)\n\nReturns the current value of an internal timer identified by which.\n\npause()\n\nGoes to sleep until the next signal is received (UNIX).\n\nset_wakeup_fd(fd)\n\nSets a file descriptor fdon which a '\\0' byte will be written when a signal is received. This, in turn, can be used to handle signals in programs that are polling file descriptors using functions such as those found in the select module.The file described by fd must be opened in non-blocking mode for this to work.\n\nsetitimer(which, seconds [, interval])\n\nSets an internal timer to generate a signal after secondsseconds and repeatedly there- after every intervalseconds. Both of these parameters are specified as floating-point numbers.The whichparameter is one of ITIMER_REAL, ITIMER_VIRTUAL, or ITIMER_PROF.The choice of whichdetermines what signal is generated after the timer has expired. SIGALRM is generated for ITIMER_REAL, SIGVTALRM is generated for\n\nF h Lib f L Bdff\n\n400\n\nChapter 19 Operating System Services\n\nITIMER_VIRTUAL, and SIGPROF is generated for ITIMER_PROF. Set secondsto 0 to clear a timer. Returns a tuple (seconds, interval) with the previous settings of the timer.\n\nsiginterrupt(signalnum, flag)\n\nSets the system call restart behavior for a given signal number. If flagis False, system calls interrupted by signal signalnumwill be automatically restarted. If set True, the system call will be interrupted.An interrupted system call will typically result in an OSError or IOError exception where the associated error number is set to errno.EINTR or errno.EAGAIN.\n\nsignal(signalnum, handler)\n\nSets a signal handler for signal signalnumto the function handler. handlermust be a callable Python object taking two arguments: the signal number and frame object. SIG_IGN or SIG_DFL can also be given to ignore a signal or use the default signal han- dler, respectively.The return value is the previous signal handler, SIG_IGN, or SIG_DFL. When threads are enabled, this function can only be called from the main thread. Otherwise, a ValueError exception is raised.\n\nIndividual signals are identified using symbolic constants of the form SIG*.These\n\nnames correspond to integer values that are machine-specific.Typical values are as follows:\n\nSignal Name SIGABRT\n\nSIGALRM\n\nSIGBUS\n\nSIGCHLD\n\nSIGCLD\n\nSIGCONT\n\nSIGFPE\n\nSIGHUP\n\nSIGILL\n\nSIGINT\n\nSIGIO\n\nSIGIOT\n\nSIGKILL\n\nSIGPIPE\n\nSIGPOLL\n\nSIGPROF\n\nSIGPWR\n\nSIGQUIT\n\nSIGSEGV\n\nSIGSTOP\n\nSIGTERM\n\nSIGTRAP\n\nDescription Abnormal termination Alarm Bus error Change in child status Change in child status Continue Floating-point error Hang up Illegal instruction Terminal interrupt character Asynchronous I/O Hardware fault Terminate Write to pipe, no readers Pollable event Profiling alarm Power failure Terminal quit character Segmentation fault Stop Termination Hardware fault Terminal stop character Control TTY\n\nSIGTSTP SIGTTIN\n\nF h Lib f L Bdff\n\nsignal\n\n401\n\nSignal Name SIGTTOU\n\nSIGURG\n\nSIGUSR1\n\nSIGUSR2\n\nSIGVTALRM\n\nSIGWINCH\n\nSIGXCPU\n\nDescription Control TTY Urgent condition User defined User defined Virtual time alarm Window size change CPU limit exceeded File size limit exceeded\n\nSIGXFSZ\n\nIn addition, the module defines the following variables:\n\nVariable SIG_DFL\n\nSIG_IGN\n\nNSIG\n\nDescription Signal handler that invokes the default signal handler Signal handler that ignores a signal One more than the highest signal number\n\nExample The following example illustrates a timeout on establishing a network connection (the socket module already provides a timeout option so this example is merely meant to illustrate the basic concept of using the signal module).\n\nimport signal, socket def handler(signum, frame): print 'Timeout!' raise IOError, 'Host not responding.'\n\nsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) signal.signal(signal.SIGALRM, handler) signal.alarm(5) # 5-second alarm sock.connect('www.python.org', 80) # Connect signal.alarm(0) # Clear alarm\n\nNotes\n\nn Signal handlers remain installed until explicitly reset, with the exception of\n\nSIGCHLD (whose behavior is implementation-specific).\n\nn It’s not possible to temporarily disable signals. n Signals are only handled between the atomic instructions of the Python inter-\n\npreter.The delivery of a signal can be delayed by long-running calculations writ- ten in C (as might be performed in an extension module).\n\nn If a signal occurs during an I/O operation, the I/O operation may fail with an exception. In this case, the errno value is set to errno.EINTR to indicate an interrupted system call.\n\nn Certain signals such as SIGSEGV cannot be handled from Python. n Python installs a small number of signal handlers by default. SIGPIPE is ignored, SIGINT is translated into a KeyboardInterrupt exception, and SIGTERM is caught in order to perform cleanup and invoke sys.exitfunc.\n\nF h Lib f L Bdff\n\n402\n\nChapter 19 Operating System Services\n\nn Extreme care is needed if signals and threads are used in the same program. Currently, only the main thread of execution can set new signal handlers or receive signals.\n\nn Signal handling on Windows is of only limited functionality.The number of sup-\n\nported signals is extremely limited on this platform.\n\nsubprocess The subprocess module contains functions and objects that generalize the task of cre- ating new processes, controlling input and output streams, and handling return codes. The module centralizes functionality contained in a variety of other modules such as os, popen2, and commands.\n\nPopen(args, **parms)\n\nExecutes a new command as a subprocess and returns a Popen object representing the new process.The command is specified in argsas either a string, such as 'ls -l', or as a list of strings, such as ['ls', '-l']. parmsrepresents a collection of keyword arguments that can be set to control various properties of the subprocess.The following keyword parameters are understood:\n\nKeyword bufsize\n\nclose_fds\n\ncreation_flags\n\ncwd\n\nenv\n\nexecutable\n\npreexec_fn\n\nshell\n\nDescription Specifies the buffering behavior, where 0 is unbuffered, 1 is line-buffered, a negative value uses the system default, and other positive values specify the approximate buffer size. The default value is 0. If True, all file descriptors except 0, 1, and 2 are closed prior to execution of the child process. The default value is False. Specifies process-creation flags on Windows. The only flag currently available is CREATE_NEW_CONSOLE. The default value is 0. The directory in which the command will execute. The current directory of the child process is changed to cwd prior to exe- cution. The default value is None, which uses the current directory of the parent process. Dictionary of environment variables for the new process. The default value is None, which uses the environment variables of the parent process. Specifies the name of the executable program to use. This is rarely needed because the program name is already included in args. If shell has been given, this parameter specifies the name of the shell to use. The default value is None. Specifies a function that will be called in the child process just before the command is executed. The function should take no arguments. If True, the command is executed using the UNIX shell like the os.system() function. The default shell is /bin/sh, but this can be changed by also setting executable. The default value of shell is None.\n\nF h Lib f L Bdff\n\nsubprocess\n\n403\n\nKeyword startupinfo\n\nstderr\n\nstdin\n\nstdout\n\nDescription Provides startup flags used when creating processes on Windows. The default value is None. Possible values include STARTF_USESHOWWINDOW and STARTF_USESTDHANDLERS. File object representing the file to use for stderr in the child process. May be a file object created via open(), an integer file descriptor, or the special value PIPE, which indicates that a new pipe should be created. The default value is None. File object representing the file to use for stdin in the child process. May be set to the same values as stderr. The default value is None. File object representing the file to use for stdout in the child process. May be set to the same values as stderr. The default value is None.\n\nuniversal_newlines If True, the files representing stdin, stdout, and stderr\n\nare opened in text mode with universal newline mode enabled. See the open() function for a full description.\n\ncall(args, **parms)\n\nThis function is exactly the same as Popen(), except that it simply executes the com- mand and returns its status code instead (that is, it does not return a Popen object).This function is useful if you just want to execute a command but are not concerned with capturing its output or controlling it in other ways.The parameters have the same meaning as with Popen().\n\ncheck_call(args, **parms)\n\nThe same as call() except that if the exit code is non-zero, the CalledProcessError exception is raised.This exception has the exit code stored in its returncode attribute. The Popen object preturned by Popen() has a variety of methods and attributes\n\nthat can be used for interacting with the subprocess.\n\np.communicate([input])\n\nCommunicates with the child process by sending the data supplied in inputto the standard input of the process. Once data is sent, the method waits for the process to ter- minate while collecting output received on standard output and standard error. Returns a tuple (stdout, stderr) where stdoutand stderrare strings. If no data is sent to the child process, inputis set to None (the default).\n\np.kill()\n\nKills the subprocess by sending it a SIGKILL signal on UNIX or calling the p.terminate() method on Windows.\n\np.poll()\n\nChecks to see if phas terminated. If so, the return code of the subprocess is returned. Otherwise, None is returned.\n\np.send_signal(signal)\n\nSends a signal to the subprocess. signalis a signal number as defined in the signal module. On Windows, the only supported signal is SIGTERM.\n\nF h Lib f L Bdff\n\n404\n\nChapter 19 Operating System Services\n\np.terminate()\n\nTerminates the subprocess by sending it a SIGTERM signal on UNIX or calling the Win32 API TerminateProcess function on Windows.\n\np.wait()\n\nWaits for pto terminate and returns the return code.\n\np.pid\n\nProcess ID of the child process.\n\np.returncode\n\nNumeric return code of the process. If None, the process has not terminated yet. If neg- ative, it indicates the process was terminated by a signal (UNIX).\n\np.stdin, p.stdout, p.stderr\n\nThese three attributes are set to open file objects whenever the corresponding I/O stream is opened as a pipe (for example, setting the stdoutargument in Popen() to PIPE).These file objects are provided so that the pipe can be connected to other sub- processes.These attributes are set to None if pipes are not in use.\n\nExamples\n\n# Execute a basic system command. Like os.system() ret = subprocess.call(\"ls -l\", shell=True)\n\n# Silently execute a basic system command ret = subprocess.call(\"rm –f *.java\",shell=True, stdout=open(\"/dev/null\"))\n\n# Execute a system command, but capture the output p = subprocess.Popen(\"ls -l\", shell=True, stdout=subprocess.PIPE) out = p.stdout.read()\n\n# Execute a command, but send input and receive output p = subprocess.Popen(\"wc\", shell=True, stdin=subprocess.PIPE,\n\nstdout=subprocess.PIPE, stderr=subprocess.PIPE)\n\nout, err = p.communicate(s) # Send string s to the process\n\n# Create two subprocesses and link them together via a pipe p1 = subprocess.Popen(\"ls -l\", shell=True, stdout=subprocess.PIPE) p2 = subprocess.Popen(\"wc\",shell=True, stdin=p1.stdout,\n\nstdout=subprocess.PIPE)\n\nout = p2.stdout.read()\n\nNotes\n\nn As a general rule, it is better to supply the command line as a list of strings instead of a single string with a shell command (for example, ['wc','filename'] instead of 'wc filename'). On many systems, it is com- mon for filenames to include funny characters and spaces (for example, the “Documents and Settings” folder on Windows). If you stick to supplying com- mand arguments as a list, everything will work normally. If you try to form a shell command, you will have to take additional steps to make sure special charac- ters and spaces are properly escaped.\n\nF h Lib f L Bdff\n\ntime\n\n405\n\nn On Windows, pipes are opened in binary file mode.Thus, if you are reading text output from a subprocess, line endings will include the extra carriage return character ('\\r\\n' instead of '\\n'). If this is a concern, supply the universal_newlines option to Popen().\n\nn The subprocess module can not be used to control processes that expect to be running in a terminal or TTY.The most common example is any program that expects a user to enter a password (such as ssh, ftp, svn, and so on).To control these programs, look for third-party modules based on the popular “Expect” UNIX utility.\n\ntime The time module provides various time-related functions. In Python, time is measured as the number of seconds since the epoch.The epoch is the beginning of time (the point at which time = 0 seconds).The epoch is January 1, 1970, on UNIX and can be deter- mined by calling time.gmtime(0) on other systems.\n\nThe following variables are defined:\n\naccept2dyear\n\nA Boolean value that indicates whether two-digit years are accepted. Normally this is True, but it’s set to False if the environment variable $PYTHONY2K is set to a non- empty string.The value can be changed manually as well.\n\naltzone\n\nThe time zone used during daylight saving time (DST), if applicable.\n\ndaylight\n\nIs set to a nonzero value if a DST time zone has been defined.\n\ntimezone\n\nThe local (non-DST) time zone.\n\ntzname\n\nA tuple containing the name of the local time zone and the name of the local daylight saving time zone (if defined).\n\nThe following functions can be used:\n\nasctime([tuple])\n\nConverts a tuple representing a time as returned by gmtime() or localtime() to a string of the form 'Mon Jul 12 14:45:23 1999'. If no arguments are supplied, the current time is used.\n\nclock()\n\nReturns the current CPU time in seconds as a floating-point number.\n\nctime([secs])\n\nConverts a time expressed in seconds since the epoch to a string representing local time. ctime(secs) is the same as asctime(localtime(secs)). If secsis omitted or None, the current time is used.\n\nF h Lib f L Bdff\n\n406\n\nChapter 19 Operating System Services\n\ngmtime([secs])\n\nConverts a time expressed in seconds since the epoch to a time in UTC Coordinated Universal Time (a.k.a. Greenwich Mean Time).This function returns a struct_time object with the following attributes:\n\nAttribute tm_year\n\ntm_mon\n\nValue A four-digit value such as 1998 1-12\n\ntm_mday\n\n1-31\n\ntm_hour\n\n0-23\n\ntm_min\n\n0-59\n\ntm_sec\n\ntm_wday\n\ntm_yday\n\n0-61 0-6 (0=Monday) 1-366\n\ntm_isdst\n\n1, 0, 1\n\nThe tm_isdst attribute is 1 if DST is in effect, 0 if not, and -1 if no information is available. If secsis omitted or None, the current time is used. For backward compatibil- ity, the returned struct_time object also behaves like a 9-tuple containing the preced- ing attribute values in the same order as listed.\n\nlocaltime([secs])\n\nReturns a struct_time object as with gmtime(), but corresponding to the local time zone. If secsis omitted or None, the current time is used.\n\nmktime(tuple)\n\nThis function takes a struct_time object or tuple representing a time in the local time zone (in the same format as returned by localtime()) and returns a floating-point number representing the number of seconds since the epoch.An OverflowError exception is raised if the input value is not a valid time.\n\nsleep(secs)\n\nPuts the current process to sleep for secsseconds. secsis a floating-point number.\n\nstrftime(format [, tm])\n\nConverts a struct_time object tmrepresenting a time as returned by gmtime() or localtime() to a string (for backwards compatibility, tmmay also be a tuple represent- ing a time value). formatis a format string in which the following format codes can be embedded:\n\nDirective %a\n\n%A\n\n%b\n\n%B\n\n%c\n\n%d\n\nMeaning Locale’s abbreviated weekday name Locale’s full weekday name Locale’s abbreviated month name Locale’s full month name Locale’s appropriate date and time representation Day of the month as a decimal number [01-31] Hour (24-hour clock) as a decimal number [00-23]\n\n%H\n\nF h Lib f L Bdff\n\ntime\n\n407\n\nDirective %I\n\n%j\n\n%m\n\n%M\n\n%p\n\n%S\n\n%U\n\n%w\n\n%W\n\n%x\n\n%X\n\n%y\n\n%Y\n\n%Z\n\nMeaning Hour (12-hour clock) as a decimal number [01-12] Day of the year as a decimal number [001-366] Month as a decimal number [01-12] Minute as a decimal number [00-59] Locale’s equivalent of either AM or PM Seconds as a decimal number [00-61] Week number of the year [00-53] (Sunday as first day) Weekday as a decimal number [0-6] (0 = Sunday) Week number of the year (Monday as first day) Locale’s appropriate date representation Locale’s appropriate time representation Year without century as a decimal number [00-99] Year with century as a decimal number Time zone name (or by no characters if no time zone exists) The % character\n\n%%\n\nThe format codes can include a width and precision in the same manner as used with the % operator on strings. ValueError is raised if any of the tuple fields are out of range. If tupleis omitted, the time tuple corresponding to the current time is used.\n\nstrptime(string [, format])\n\nParses a string representing a time and returns a struct_time object as returned by localtime() or gmtime().The formatparameter uses the same specifiers as used by strftime() and defaults to '%a %b %d %H:%M:%S %Y'.This is the same format as produced by the ctime() function. If the string cannot be parsed, a ValueError exception is raised.\n\ntime()\n\nReturns the current time as the number of seconds since the epoch in UTC (Coordinated Universal Time).\n\ntzset()\n\nResets the time zone setting based on the value of the TZ environment variable on UNIX. For example:\n\nos.environ['TZ'] = 'US/Mountain' time.tzset()\n\nos.environ['TZ'] = \"CST+06CDT,M4.1.0,M10.5.0\" time.tzset()\n\nNotes\n\nn When two-digit years are accepted, they’re converted to four-digit years accord- ing to the POSIX X/Open standard, where the values 69-99 are mapped to 1969-1999 and the values 0-68 are mapped to 2000-2068.\n\nF h Lib f L Bdff\n\n408\n\nChapter 19 Operating System Services\n\nn The accuracy of the time functions is often much less than what might be sug- gested by the units in which time is represented. For example, the operating sys- tem might only update the time 50–100 times a second.\n\nSee Also:\n\ndatetime (p. 336)\n\nwinreg The winreg module (_winreg in Python 2) provides a low-level interface to the Windows registry.The registry is a large hierarchical tree in which each node is called a key.The children of a particular key are known as subkeys and may contain additional subkeys or values. For example, the setting of the Python sys.path variable is typically contained in the registry as follows:\n\n\\HKEY_LOCAL_MACHINE\\Software\\Python\\PythonCore\\2.6\\PythonPath\n\nIn this case, Software is a subkey of HKEY_LOCAL_MACHINE, Python is a subkey of Software, and so forth.The value of the PythonPath key contains the actual path set- ting.\n\nKeys are accessed through open and close operations. Open keys are represented by special handles (which are wrappers around the integer handle identifiers normally used by Windows).\n\nCloseKey(key)\n\nCloses a previously opened registry key with handle key.\n\nConnectRegistry(computer_name, key)\n\nReturns a handle to a predefined registry key on another computer. computer_nameis the name of the remote machine as a string of the \\\\computername. If computer_nameis None, the local registry is used. keyis a predefined handle such as HKEY_CURRENT_USER or HKEY_ USERS. Raises EnvironmentError on failure.The fol- lowing list shows all HKEY_* values defined in the _winreg module:\n\nn HKEY_CLASSES_ROOT\n\nn HKEY_CURRENT_CONFIG\n\nn HKEY_CURRENT_USER\n\nn HKEY_DYN_DATA\n\nn HKEY_LOCAL_MACHINE\n\nn HKEY_PERFORMANCE_DATA\n\nn HKEY_USERS\n\nCreateKey(key, sub_key)\n\nCreates or opens a key and returns a handle. keyis a previously opened key or a prede- fined key defined by the HKEY_* constants. sub_keyis the name of the key that will be opened or created. If keyis a predefined key, sub_keymay be None, in which case key is returned.\n\nF h Lib f L Bdff\n\nwinreg\n\n409\n\nDeleteKey(key, sub_key)\n\nDeletes sub_key. keyis an open key or one of the predefined HKEY_* constants. sub_keyis a string that identifies the key to delete. sub_keymust not have any sub- keys; otherwise, EnvironmentError is raised.\n\nDeleteValue(key, value)\n\nDeletes a named value from a registry key. keyis an open key or one of the predefined HKEY_* constants. valueis a string containing the name of the value to remove.\n\nEnumKey(key, index)\n\nReturns the name of a subkey by index. keyis an open key or one of the predefined HKEY_* constants. indexis an integer that specifies the key to retrieve. If indexis out of range, an EnvironmentError is raised.\n\nEnumValue(key, index)\n\nReturns a value of an open key. keyis an open key or a predefined HKEY_* constant. indexis an integer specifying the value to retrieve.The function returns a tuple (name, data, type) in which nameis the value name, datais an object holding the value data, and typeis an integer that specifies the type of the value data.The following type codes are currently defined:\n\nCode REG_BINARY\n\nREG_DWORD\n\nREG_DWORD_LITTLE_ENDIAN\n\nREG_DWORD_BIG_ENDIAN\n\nREG_EXPAND_SZ\n\nREG_LINK\n\nREG_MULTI_SZ REG_NONE\n\nREG_RESOURCE_LIST\n\nDescription Binary data 32-bit number 32-bit little-endian number 32-bit number in big-endian format Null-terminated string with unexpanded references to environment variables Unicode symbolic link Sequence of null-terminated strings No defined value type Device driver resource list Null-terminated string\n\nREG_SZ\n\nExpandEnvironmentStrings(s)\n\nExpands environment strings of the form %name% in Unicode string s.\n\nFlushKey(key)\n\nWrites the attributes of keyto the registry, forcing changes to disk.This function should only be called if an application requires absolute certainty that registry data is stored on disk. It does not return until data is written. It is not necessary to use this function under normal circumstances.\n\nRegLoadKey(key, sub_key, filename)\n\nCreates a subkey and stores registration information from a file into it. keyis an open key or a predefined HKEY_* constant. sub_keyis a string identifying the subkey to load. filenameis the name of the file from which to load data.The contents of this file must\n\nF h Lib f L Bdff\n\n410\n\nChapter 19 Operating System Services\n\nbe created with the SaveKey() function, and the calling process must have SE_RESTORE_ PRIVILEGE for this to work. If keywas returned by ConnectRegistry(), filename should be a path that’s relative to the remote computer.\n\nOpenKey(key, sub_key[, res [, sam]])\n\nOpens a key. keyis an open key or an HKEY_* constant. sub_keyis a string identifying the subkey to open. resis a reserved integer that must be zero (the default). samis an integer defining the security access mask for the key.The default is KEY_READ. Here are the other possible values for sam:\n\nn KEY_ALL_ACCESS\n\nn KEY_CREATE_LINK\n\nn KEY_CREATE_SUB_KEY\n\nn KEY_ENUMERATE_SUB_KEYS\n\nn KEY_EXECUTE\n\nn KEY_NOTIFY\n\nn KEY_QUERY_VALUE\n\nn KEY_READ\n\nn KEY_SET_VALUE\n\nn KEY_WRITE\n\nOpenKeyEx()\n\nSame as OpenKey().\n\nQueryInfoKey(key)\n\nReturns information about a key as a tuple (num_subkeys, num_values, last_modified) in which num_subkeysis the number of subkeys, num_valuesis the number of values, and last_modifiedis a long integer containing the time of last modification.Time is measured from January 1, 1601, in units of 100 nanoseconds.\n\nQueryValue(key,sub_key)\n\nReturns the unnamed value for a key as a string. keyis an open key or an HKEY_* con- stant. sub_keyis the name of the subkey to use, if any. If omitted, the function returns the value associated with keyinstead.This function returns the data for the first value with a null name. However, the type is returned (use QueryValueEx instead).\n\nQueryValueEx(key, value_name)\n\nReturns a tuple (value, type) containing the data value and type for a key. keyis an open key or HKEY_* constant. value_nameis the name of the value to return.The returned type is one of the integer codes as described for the EnumValue() function.\n\nSaveKey(key, filename)\n\nSaves keyand all its subkeys to a file. keyis an open key or a predefined HKEY_* con- stant. filenamemust not already exist and should not include a filename extension. Furthermore, the caller must have backup privileges for the operation to succeed.\n\nF h Lib f L Bdff\n\nwinreg\n\n411\n\nSetValue(key, sub_key, type, value)\n\nSets the value of a key. keyis an open key or HKEY_* constant. sub_keyis the name of the subkey with which to associate the value. typeis an integer type code, currently limited to REG_SZ. valueis a string containing the value data. If sub_keydoes not exist, it is created. keymust have been opened with KEY_SET_VALUE access for this function to succeed.\n\nSetValueEx(key, value_name, reserved, type, value)\n\nSets the value field of a key. keyis an open key or an HKEY_* constant. value_nameis the name of the value. typeis an integer type code as described for the EnumValue() function. valueis a string containing the new value.When the values of numeric types (for example, REG_DWORD) are being set, valueis still a string containing the raw data. This string can be created using the struct module. reservedis currently ignored and can be set to anything (the value is not used).\n\nNotes\n\nn Functions that return a Windows HKEY object return a special registry handle\n\nobject described by the class PyHKEY.This object can be converted into a Windows handle value using int().This object can also be used with the context-management protocol to automatically close the underlying handle—for example:\n\nwith winreg.OpenKey(winreg.HKEY_LOCAL_MACHINE, \"spam\") as key:\n\nstatements\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n20\n\nThreads and Concurrency\n\nThis chapter describes library modules and programming strategies for writing con-\n\ncurrent programs in Python.Topics include threads, message passing, multiprocessing, and coroutines. Before covering specific library modules, some basic concepts are first described.\n\nBasic Concepts A running program is called a process. Each process has its own system state, which includes memory, lists of open files, a program counter that keeps track of the instruc- tion being executed, and a call stack used to hold the local variables of functions. Normally, a process executes statements one after the other in a single sequence of con- trol flow, which is sometimes called the main thread of the process.At any given time, the program is only doing one thing.\n\nA program can create new processes using library functions such as those found in\n\nthe os or subprocess modules (e.g., os.fork(), subprocess.Popen(), etc.). However, these processes, known as subprocesses, run as completely independent entities—each with their own private system state and main thread of execution. Because a subprocess is independent, it executes concurrently with the original process. That is, the process that created the subprocess can go on to work on other things while the subprocess carries out its own work behind the scenes.\n\nAlthough processes are isolated, they can communicate with each other—something\n\nknown as interprocess communication (IPC). One of the most common forms of IPC is based on message passing.A message is simply a buffer of raw bytes. Primitive operations such as send() and recv() are then used to transmit or receive messages through an I/O channel such as a pipe or network socket.Another somewhat less common IPC mechanism relies upon memory-mapped regions (see the mmap module).With memory mapping, processes can create shared regions of memory. Modifications to these regions are then visible in all processes that happen to be viewing them.\n\nMultiple processes can be used by an application if it wants to work on multiple\n\ntasks at the same time—with each process responsible for part of the processing. However, another approach for subdividing work into tasks is to use threads.A thread is similar to a process in that it has its own control flow and execution stack. However, a thread runs inside the process that created it, sharing all of the data and system resources.Threads are useful when an application wants to perform tasks concurrently, but there is a potentially large amount of system state that needs to be shared by the tasks.\n\nF h Lib f L Bdff\n\n414\n\nChapter 20 Threads and Concurrency\n\nWhen multiple processes or threads are used, the host operating system is responsible\n\nfor scheduling their work.This is done by giving each process (or thread) a small time slice and rapidly cycling between all of the active tasks—giving each a portion of the available CPU cycles. For example, if your system had 10 active processes running, the operating system would allocate approximately 1/10th of its CPU time to each process and cycle between processes in rapid succession. On systems with more than one CPU core, the operating system can schedule processes so that each CPU is kept busy, exe- cuting processes in parallel.\n\nWriting programs that take advantage of concurrent execution is something that is intrinsically complicated.A major source of complexity concerns synchronization and access to shared data. In particular, attempts to update a data structure by multiple tasks at approximately the same time can lead to a corrupted and inconsistent program state (a problem formally known as a race condition).To fix these problems, concurrent pro- grams must identify critical sections of code and protect them using mutual-exclusion locks and other similar synchronization primitives. For example, if different threads were trying to write data to the same file at the same time, you might use a mutual exclusion lock to synchronize their operation so that once one of the threads starts writing, the other threads have to wait until it has finished before they are allowed to start writing. The code for this scenario typically looks like this:\n\nwrite_lock = Lock() ... # Critical section where writing occurs write_lock.acquire() f.write(\"Here's some data.\\n\") f.write(\"Here's more data.\\n\") ... write_lock.release()\n\nThere’s a joke attributed to Jason Whittington that goes as like this:“Why did the mul- tithreaded chicken cross the road? to To other side. get the”.This joke typifies the kinds of problems that arise with task synchronization and concurrent programming. If you’re scratching your head saying,“I don’t get it,” then it might be wise to do a bit more reading before diving into the rest of this chapter.\n\nConcurrent Programming and Python Python supports both message passing and thread-based concurrent programming on most systems.Although most programmers tend to be familiar with the thread interface, Python threads are actually rather restricted.Although minimally thread-safe, the Python interpreter uses an internal global interpreter lock (the GIL) that only allows a single Python thread to execute at any given moment.This restricts Python programs to run on a single processor regardless of how many CPU cores might be available on the sys- tem.Although the GIL is often a heated source of debate in the Python community, it is unlikely to be removed at any time in the foreseeable future.\n\nThe presence of the GIL has a direct impact on how many Python programmers address concurrent programming problems. If an application is mostly I/O bound, it is generally fine to use threads because extra processors aren’t going to do much to help a program that spends most of its time waiting for events. For applications that involve heavy amounts of CPU processing, using threads to subdivide work doesn’t provide any benefit and will make the program run slower (often much slower than you would guess). For this, you’ll want to rely on subprocesses and message passing.\n\nF h Lib f L Bdff",
      "page_number": 420
    },
    {
      "number": 22,
      "title": "Segment 22 (pages 439-461)",
      "start_page": 439,
      "end_page": 461,
      "detection_method": "synthetic",
      "content": "multiprocessing\n\n415\n\nEven when threads are used, many programmers find their scaling properties to be\n\nrather mysterious. For example, a threaded network server that works fine with 100 threads may have horrible performance if it’s scaled up to 10,000 threads.As a general rule, you really don’t want to be writing programs with 10,000 threads because each thread requires its own system resources and the overhead associated with thread con- text switching, locking, and other matters starts to become significant (not to mention the fact that all threads are constrained to run on a single CPU).To deal with this, it is somewhat common to see such applications restructured as asynchronous event- handling systems. For example, a central event loop might monitor all of the I/O sources using the select module and dispatch asynchronous events to a large collec- tion of I/O handlers.This is the basis for library modules such as asyncore as well as popular third-party modules such as Twisted (http://twistedmatrix/com).\n\nLooking forward, message passing is a concept that you should probably embrace for\n\nany kind of concurrent programming in Python. Even when working with threads, an often-recommended approach is to structure your application as a collection of inde- pendent threads that exchange data through message queues.This particular approach tends to be less error-prone because it greatly reduces the need to use locks and other synchronization primitives. Message passing also naturally extends into networking and distributed systems. For example, if part of a program starts out as a thread to which you send messages, that component can later be migrated to a separate process or onto a dif- ferent machine by sending the messages over a network connection.The message pass- ing abstraction is also tied to advanced Python features such as coroutines. For example, a coroutine is a function that can receive and processe messages that are sent to it. So, by embracing message passing, you will find that you can write programs that have a great deal of flexibility.\n\nThe remainder of this chapter looks at different library modules for supporting con- current programming.At the end, more detailed information on common programming idioms is provided.\n\nmultiprocessing The multiprocessing module provides support for launching tasks in a subprocess, communicating and sharing data, and performing various forms of synchronization.The programming interface is meant to mimic the programming interface for threads in the threading module. However, unlike threads, it is important to emphasize that processes do not have any shared state.Thus, if a process modifies data, that change is local only to that process.\n\nThe features of the multiprocessing module are vast, making it one of the larger and most advanced built-in libraries. Covering every detail of the module is impossible here, but the essential parts of it along with examples will be given. Experienced pro- grammers should be able to take the examples and expand them to larger problems.\n\nProcesses All of the features of the multiprocessing module are focused on processes.They are described by the following class.\n\nF h Lib f L Bdff\n\n416\n\nChapter 20 Threads and Concurrency\n\nProcess([group [, target [, name [, args [, kwargs]]]]])\n\nA class that represents a task running in a subprocess.The arguments in the constructor should always been specified using keyword arguments. targetis a callable object that will execute when the process starts, argsis a tuple of positional arguments passed to target, and kwargsis a dictionary of keyword arguments passed to target. If args and kwargsare omitted, targetis called with no arguments. nameis a string that gives a descriptive name to the process. groupis unused and is always set to None. Its pres- ence here is simply to make the construction of a Process mimic the creation of a thread in the threading module.\n\nAn instance pof Process has the following methods:\n\np.is_alive()\n\nReturns True if pis still running.\n\np.join([timeout])\n\nWaits for process pto terminate. timeoutspecifies an optional timeout period.A process can be joined as many times as you wish, but it is an error for a process to try and join itself.\n\np.run()\n\nThe method that runs when the process starts. By default, this invokes targetthat was passed to the Process constructor.As an alternative, a process can be defined by inher- iting from Process and reimplementing run().\n\np.start()\n\nStarts the process.This launches the subprocess that represents the process and invokes p.run() in that subprocess.\n\np.terminate()\n\nForcefully terminates the process. If this is invoked, the process pis terminated immedi- ately without performing any kind of cleanup actions. If the process pcreated sub- processes of its own, those processes will turn into zombies. Some care is required when using this method. If pholds a lock or is involved with interprocess communication, terminating it might cause a deadlock or corrupted I/O.\n\nA Process instance palso has the following data attributes:\n\np.authkey\n\nThe process’ authentication key. Unless explicitly set, this is a 32-character string gener- ated by os.urandom().The purpose of this key is to provide security for low-level interprocess communication involving network connections. Such connections only work if both ends have the same authentication key.\n\np.daemon\n\nA Boolean flag that indicates whether or not the process is daemonic.A daemonic process is automatically terminated when the Python process that created it terminates. In addition, a daemonic process is prohibited from creating new processes on its own. The value of p.daemon must be set before a process is started using p.start().\n\nF h Lib f L Bdff\n\nmultiprocessing\n\n417\n\np.exitcode\n\nThe integer exit code of the process. If the process is still running, this is None. If the value is negative, a value of –Nmeans the process was terminated by signal N.\n\np.name\n\nThe name of the process.\n\np.pid\n\nThe integer process ID of the process.\n\nHere is an example that shows how to create and launch a function (or other\n\ncallable) as a separate process:\n\nimport multiprocessing import time\n\ndef clock(interval): while True:\n\nprint(\"The time is %s\" % time.ctime()) time.sleep(interval)\n\nif __name__ == '__main__':\n\np = multiprocessing.Process(target=clock, args=(15,)) p.start()\n\nHere is an example that shows how to define this process as a class that inherits from Process:\n\nimport multiprocessing import time\n\nclass ClockProcess(multiprocessing.Process):\n\ndef __init__(self,interval):\n\nmultiprocessing.Process.__init__(self) self.interval = interval\n\ndef run(self):\n\nwhile True:\n\nprint(\"The time is %s\" % time.ctime()) time.sleep(self.interval)\n\nif __name__ == '__main__': p = ClockProcess(15) p.start()\n\nIn both examples, the time should be printed by the subprocess every 15 seconds. It is important to emphasize that for cross-platform portability, new processes should only be created by the main program as shown.Although this is optional on UNIX, it is required on Windows. It should also be noted that on Windows, you will probably need to run the preceding examples in the command shell (command.exe) instead of a Python IDE, such as IDLE.\n\nInterprocess Communication Two primary forms of interprocess communication are supported by the multiprocessing module: pipes and queues. Both methods are implemented using message passing. However, the queue interface is meant to mimic the use of queues commonly used with thread programs.\n\nF h Lib f L Bdff\n\n418\n\nChapter 20 Threads and Concurrency\n\nQueue([maxsize])\n\nCreates a shared process queue. maxsizeis the maximum number of items allowed in the queue. If omitted, there is no size limit.The underlying queue is implemented using pipes and locks. In addition, a support thread is launched in order to feed queued data into the underlying pipe.\n\nAn instance qof Queue has the following methods:\n\nq.cancel_join_thread()\n\nDon’t automatically join the background thread on process exit.This prevents the join_thread() method from blocking.\n\nq.close()\n\nCloses the queue, preventing any more data from being added to it.When this is called, the background thread will continue to write any queued data not yet written but will shut down as soon as this is complete.This method is called automatically if qis garbage-collected. Closing a queue does not generate any kind of end-of-data signal or exception in queue consumers. For example, if a consumer is blocking on a get() operation, closing the queue in the producer does not cause the get() to return with an error.\n\nq.empty()\n\nReturns True if qis empty at the time of the call. If other processes or threads are being used to add queue items, be aware that the result is not reliable (e.g., new items could have been added to the queue in between the time that the result is returned and used).\n\nq.full()\n\nReturns True if qis full.The result is also not reliable due to threads (see q.empty()).\n\nq.get([block [, timeout]])\n\nReturns an item from q. If qis empty, blocks until a queue item becomes available. blockcontrols the blocking behavior and is True by default. If set to False, a Queue.Empty exception (defined in the Queue library module) is raised if the queue is empty. timeoutis an optional timeout to use in blocking mode. If no items become available in the specified time interval, a Queue.Empty exception is raised.\n\nq.get_nowait()\n\nThe same as q.get(False).\n\nq.join_thread()\n\nJoins the queue’s background thread.This is used to wait for all queue items to be con- sumed after q.close() has been called.This method gets called by default in all processes that are not the original creator of q.This behavior can be disabled by called q.cancel_join_thread().\n\nq.put(item [, block [, timeout]])\n\nPuts itemonto the queue. If the queue is full, block until space becomes available. blockcontrols the blocking behavior and is True by default. If set to False, a Queue.Full exception (defined in the Queue library module) is raised if the queue is full. timeoutspecifies how long to wait for space to become available in blocking mode.A Queue.Full exception is raised on timeout.\n\nF h Lib f L Bdff\n\nmultiprocessing\n\n419\n\nq.put_nowait(item)\n\nThe same as q.put(item, False).\n\nq.qsize()\n\nReturns the approximate number of items currently in the queue.The result of this function is not reliable because items may have been added or removed from the queue in between the time the result is returned and later used in a program. On some sys- tems, this method may raise an NotImplementedError.\n\nJoinableQueue([maxsize])\n\nCreates a joinable shared process queue.This is just like a Queue except that the queue allows a consumer of items to notify the producer that the items have been successfully been processed.The notification process is implemented using a shared semaphore and condition variable.\n\nAn instance qof JoinableQueue has the same methods as Queue, but it has the fol-\n\nlowing additional methods:\n\nq.task_done()\n\nUsed by a consumer to signal that an enqueued item returned by q.get() has been processed.A ValueError exception is raised if this is called more times than have been removed from the queue.\n\nq.join()\n\nUsed by a producer to block until all items placed in a queue have been processed.This blocks until q.task_done() is called for every item placed into the queue.\n\nThe following example shows how you set up a process that runs forever, consuming and processing items on a queue.The producer feeds items into the queue and waits for them to be processed.\n\nimport multiprocessing\n\ndef consumer(input_q):\n\nwhile True:\n\nitem = input_q.get() # Process item print(item) # Replace with useful work # Signal task completion input_q.task_done()\n\ndef producer(sequence, output_q):\n\nfor item in sequence:\n\n# Put the item on the queue output_q.put(item)\n\n# Set up if __name__ == '__main__':\n\nq = multiprocessing.JoinableQueue() # Launch the consumer process cons_p = multiprocessing.Process(target=consumer,args=(q,)) cons_p.daemon=True cons_p.start()\n\n# Produce items. sequence represents a sequence of items to # be sent to the consumer. In practice, this could be the output\n\nF h Lib f L Bdff\n\n420\n\nChapter 20 Threads and Concurrency\n\n# of a generator or produced in some other manner. sequence = [1,2,3,4] producer(sequence, q)\n\n# Wait for all items to be processed q.join()\n\nIn this example, the consumer process is set to daemonic because it runs forever and we want it to terminate when the main program finishes (if you forget this, the program will hang).A JoinableQueue is being used so that the producer actually knows when all of the items put in the queue have been successfully processed.The join() opera- tion ensures this; if you forget this step, the consumer will be terminated before it has had time to complete all of its work.\n\nIf desired, multiple processes can put and get items from the same queue. For exam- ple, if you wanted to have a pool of consumer processes, you could just write code like this:\n\nif __name__ == '__main__':\n\nq = multiprocessing.JoinableQueue() # Launch some consumer processes cons_p1 = multiprocessing.Process(target=consumer,args=(q,)) cons_p1.daemon=True cons_p1.start()\n\ncons_p2 = multiprocessing.Process(target=consumer,args=(q,)) cons_p2.daemon=True cons_p2.start()\n\n# Produce items. sequence represents a sequence of items to # be sent to the consumer. In practice, this could be the output # of a generator or produced in some other manner. sequence = [1,2,3,4] producer(sequence, q)\n\n# Wait for all items to be processed q.join()\n\nWhen writing code such as this, be aware that every item placed into the queue is pick- led and sent to the process over a pipe or socket connection.As a general rule, it is bet- ter to send fewer large objects than many small objects.\n\nIn certain applications, a producer may want to signal consumers that no more items\n\nwill be produced and that they should shut down.To do this, you should write code that uses a sentinel—a special value that indicates completion. Here is an example that illustrates this concept using None as a sentinel:\n\nimport multiprocessing\n\ndef consumer(input_q):\n\nwhile True:\n\nitem = input_q.get() if item is None:\n\nbreak # Process item print(item) # Replace with useful work\n\n# Shutdown print(\"Consumer done\")\n\ndef producer(sequence, output_q):\n\nfor item in sequence:\n\nF h Lib f L Bdff\n\nmultiprocessing\n\n421\n\n# Put the item on the queue output_q.put(item)\n\nif __name__ == '__main__':\n\nq = multiprocessing.Queue() # Launch the consumer process cons_p = multiprocessing.Process(target=consumer,args=(q,)) cons_p.start()\n\n# Produce items sequence = [1,2,3,4] producer(sequence, q)\n\n# Signal completion by putting the sentinel on the queue q.put(None) # Wait for the consumer process to shutdown cons_p.join()\n\nIf you are using sentinels as shown in this example, be aware that you will need to put a sentinel on the queue for every single consumer. For example, if there were three con- sumer processes consuming items on the queue, the producer needs to put three sen- tinels on the queue to get all of the consumers to shut down.\n\nAs an alternative to using queues, a pipe can be used to perform message passing\n\nbetween processes.\n\nPipe([duplex])\n\nCreates a pipe between processes and returns a tuple (conn1, conn2) where conn1 and conn2are Connection objects representing the ends of the pipe. By default, the pipe is bidirectional. If duplexis set False, then conn1can only be used for receiving and conn2can only be used for sending. Pipe() must be called prior to creating and launching any Process objects that use the pipe.\n\nAn instance cof a Connection object returned by Pipe() has the following meth-\n\nods and attributes:\n\nc.close()\n\nCloses the connection. Called automatically if cis garbage collected.\n\nc.fileno()\n\nReturns the integer file descriptor used by the connection.\n\nc.poll([timeout])\n\nReturns True if data is available on the connection. timeoutspecifies the maximum amount of time to wait. If omitted, the method returns immediately with a result. If timeoutis set to None, then the operation will wait indefinitely for data to arrive.\n\nc.recv()\n\nReceives an object sent by c.send(). Raises EOFError if the other end of the connec- tion has been closed and there is no more data.\n\nc.recv_bytes([maxlength])\n\nReceives a complete byte message sent by c.send_bytes(). maxlengthspecifies the maximum number of bytes to receive. If an incoming message exceeds this, an IOError is raised and no further reads can be made on the connection. Raises EOFError if the other end of the connection has been closed and there is no more data.\n\nF h Lib f L Bdff\n\n422\n\nChapter 20 Threads and Concurrency\n\nc.recv_bytes_into(buffer [, offset])\n\nReceives a complete byte message and stores it in the object buffer, which supports the writable buffer interface (e.g., a bytearray object or similar). offsetspecifies the byte offset into the buffer where to place the message. Returns the number of bytes received. Raises BufferTooShort if the length of the message exceeds available buffer space.\n\nc.send(obj)\n\nSends an object through the connection. objis any object that is compatible with pickle.\n\nc.send_bytes(buffer [, offset [, size]])\n\nSends a buffer of byte data through the connection. bufferis any object that supports the buffer interface, offsetis the byte offset into the buffer, and sizeis the number of bytes to send.The resulting data is sent as a single message to be received using a single call to c.recv_bytes().\n\nPipes can be used in a similar manner as queues. Here is an example that shows the\n\nprevious producer-consumer problem implemented using pipes:\n\nimport multiprocessing # Consume items on a pipe. def consumer(pipe):\n\noutput_p, input_p = pipe input_p.close() # Close the input end of the pipe while True: try:\n\nitem = output_p.recv()\n\nexcept EOFError:\n\nbreak # Process item print(item) # Replace with useful work\n\n# Shutdown print(\"Consumer done\")\n\n# Produce items and put on a queue. sequence is an # iterable representing items to be processed. def producer(sequence, input_p):\n\nfor item in sequence:\n\n# Put the item on the queue input_p.send(item)\n\nif __name__ == '__main__':\n\n(output_p, input_p) = multiprocessing.Pipe() # Launch the consumer process cons_p = multiprocessing.Process(target=consumer,args=((output_p, input_p),)) cons_p.start()\n\n# Close the output pipe in the producer output_p.close()\n\n# Produce items sequence = [1,2,3,4] producer(sequence, input_p)\n\n# Signal completion by closing the input pipe input_p.close()\n\n# Wait for the consumer process to shutdown cons_p.join()\n\nF h Lib f L Bdff\n\nmultiprocessing\n\n423\n\nGreat attention should be given to proper management of the pipe endpoints. If one of the ends of the pipe is not used in either the producer or consumer, it should be closed. This explains, for instance, why the output end of the pipe is closed in the producer and the input end of the pipe is closed in the consumer. If you forget one of these steps, the program may hang on the recv() operation in the consumer. Pipes are reference counted by the operating system and have to be closed in all processes to produce the EOFError exception.Thus, closing the pipe in the producer doesn’t have any effect unless the consumer also closes the same end of the pipe.\n\nPipes can be used for bidirectional communication.This can be used to write pro- grams that interact with a process using a request/response model typically associated with client/server computing or remote procedure call. Here is an example:\n\nimport multiprocessing # A server process def adder(pipe):\n\nserver_p, client_p = pipe client_p.close() while True: try:\n\nx,y = server_p.recv()\n\nexcept EOFError:\n\nbreak result = x + y server_p.send(result)\n\n# Shutdown print(\"Server done\")\n\nif __name__ == '__main__':\n\n(server_p, client_p) = multiprocessing.Pipe() # Launch the server process adder_p = multiprocessing.Process(target=adder,args=((server_p, client_p),)) adder_p.start()\n\n# Close the server pipe in the client server_p.close()\n\n# Make some requests on the server client_p.send((3,4)) print(client_p.recv())\n\nclient_p.send(('Hello','World')) print(client_p.recv())\n\n# Done. Close the pipe client_p.close()\n\n# Wait for the consumer process to shutdown adder_p.join()\n\nIn this example, the adder() function runs as a server waiting for messages to arrive on its end of the pipe.When received, it performs some processing and sends the result back on the pipe. Keep in mind that send() and recv() use the pickle module to serialize objects. In the example, the server receives a tuple (x, y) as input and returns the result x + y. For more advanced applications that use remote procedure call, how- ever, you should use a process pool as described next.\n\nF h Lib f L Bdff\n\n424\n\nChapter 20 Threads and Concurrency\n\nProcess Pools The following class allows you to create a pool of processes to which various kind of data processing tasks can be submitted.The functionality provided by a pool is some- what similar to that provided by list comprehensions and functional programming oper- ations such as map-reduce.\n\nPool([numprocess [,initializer [, initargs]]])\n\nCreates a pool of worker processes. numprocessis the number of processes to create. If omitted, the value of cpu_count() is used. initializeris a callable object that will be executed in each worker process upon startup. initargsis a tuple of arguments to pass to initializer. By default, initializeris None.\n\nAn instance pof Pool supports the following operations:\n\np.apply(func [, args [, kwargs]])\n\nExecutes func(*args, **kwargs) in one of the pool workers and returns the result. It is important to emphasize this does not execute funcin parallel in all pool workers. If you want functo execute concurrently with different arguments, you either have to call p.apply() from different threads or use p.apply_async().\n\np.apply_async(func [, args [, kwargs [, callback]]])\n\nExecutes func(*args, **kwargs) in one of the pool workers and returns the result asynchronously.The result of this method is an instance of AsyncResult which can be used to obtain the final result at a later time. callbackis a callable object that accepts a single input argument.When the result of funcbecomes available, it is immediately passed to callback. callbackshould not perform any blocking operations or else it will block the reception of results in other asynchronous operations.\n\np.close()\n\nCloses the process pool, preventing any further operations. If any operations are still pending, they will be completed before the worker processes terminate.\n\np.join()\n\nWaits for all worker processes to exit.This can only be called after close() or terminate().\n\np.imap(func, iterable [, chunksize])\n\nA version of map() that returns an iterator instead of a list of results.\n\np.imap_unordered(func, iterable [, chunksize]])\n\nThe same as imap() except that the results are returned in an arbitrary order based on when they are received from the worker processes.\n\np.map(func, iterable [, chunksize])\n\nApplies the callable object functo all of the items in iterableand returns the result as a list.The operation is carried out in parallel by splitting iterableinto chunks and farming out the work to the worker processes. chunksizespecifies the number of items in each chunk. For large amounts of data, increasing the chunksizewill improve performance.\n\nF h Lib f L Bdff\n\nmultiprocessing\n\n425\n\np.map_async(func, iterable [, chunksize [, callback]])\n\nThe same as map() except that the result is returned asynchronously.The return value is an instance of AsyncResult that can be used to later obtain the result. callbackis a callable object accepting a single argument. If supplied, callbackis called with the result when it becomes available.\n\np.terminate()\n\nImmediately terminates all of the worker processes without performing any cleanup or finishing any pending work. If pis garbage-collected, this is called.\n\nThe methods apply_async() and map_async() return an AsyncResult instance\n\nas a result.An instance aof AsyncResult has the following methods:\n\na.get([timeout])\n\nReturns the result, waiting for it to arrive if necessary. timeoutis an optional timeout. If the result does not arrive in the given time, a multiprocessing.TimeoutError exception is raised. If an exception was raised in the remote operation, it is reraised when this method is called.\n\na.ready()\n\nReturns True if the call has completed.\n\na.sucessful()\n\nReturns True if the call completed without any exceptions.An AssertionError is raised if this method is called prior to the result being ready.\n\na.wait([timeout])\n\nWaits for the result to become available. timeoutis an optional timeout.\n\nThe following example illustrates the use of a process pool to build a dictionary\n\nmapping filenames to SHA512 digest values for an entire directory of files:\n\nimport os import multiprocessing import hashlib\n\n# Some parameters you can tweak BUFSIZE = 8192 # Read buffer size POOLSIZE = 2 # Number of workers\n\ndef compute_digest(filename):\n\ntry:\n\nf = open(filename,\"rb\")\n\nexcept IOError: return None\n\ndigest = hashlib.sha512() while True:\n\nchunk = f.read(BUFSIZE) if not chunk: break digest.update(chunk)\n\nf.close() return filename, digest.digest()\n\ndef build_digest_map(topdir):\n\ndigest_pool = multiprocessing.Pool(POOLSIZE)\n\nF h Lib f L Bdff\n\n426\n\nChapter 20 Threads and Concurrency\n\nallfiles = (os.path.join(path,name)\n\nfor path, dirs, files in os.walk(topdir)\n\nfor name in files)\n\ndigest_map = dict(digest_pool.imap_unordered(compute_digest,allfiles,20)) digest_pool.close() return digest_map\n\n# Try it out. Change the directory name as desired. if __name__ == '__main__':\n\ndigest_map = build_digest_map(\"/Users/beazley/Software/Python-3.0\") print(len(digest_map))\n\nIn the example, a sequence of pathnames for all files in a directory tree is specified using a generator expression.This sequence is then chopped up and farmed out to a process pool using the imap_unordered() function. Each pool worker computes a SHA512 digest value for its files using the compute_digest() function.The results are sent back to the master and collected into a Python dictionary.Although it’s by no means a scien- tific result, this example gives a 75 percent speedup over a single-process solution when run on the author’s dual-core Macbook.\n\nKeep in mind that it only makes sense to use a process pool if the pool workers per-\n\nform enough work to justify the extra communication overhead.As a general rule, it would not make sense to use a pool for simple calculations such as just adding two numbers together.\n\nShared Data and Synchronization Normally, processes are completed isolated from each other with the only means of communication being queues or pipes. However, two objects can be used to represent shared data. Underneath the covers, these objects use shared memory (via mmap) to make access possible in multiple processes.\n\nValue(typecode, arg1, ... argN, lock)\n\nCreates a ctypes object in shared memory. typecodeis either a string containing a type code as used by the array module (e.g., 'i', 'd', etc.) or a type object from the ctypes module (e.g., ctypes.c_int, ctypes.c_double, etc.).All extra positional arguments arg1, arg2, ... argNare passed to the constructor for the given type. lockis a keyword-only argument that if set to True (the default), a new lock is created to protect access to the value. If you pass in an existing lock such as a Lock or RLock instance, then that lock is used for synchronization. If vis an instance of a shared value created by Value, then the underlying value is accessed used v.value. For example, reading v.value will get the value and assigning v.value will change the value.\n\nRawValue(typecode, arg1, ..., argN)\n\nThe same as Value except that there is no locking.\n\nArray(typecode, initializer, lock)\n\nCreates a ctypes array in shared memory. typecodedescribes the contents of the array and has the same meaning as described for Value(). initializeris either an integer that sets the initial size of the array or a sequence of items whose values and size are used to initialize the array. lockis a keyword-only argument with the same meaning as described for Value(). If ais an instance of a shared array created by Array, then you\n\nF h Lib f L Bdff\n\nmultiprocessing\n\n427\n\naccess its contents using the standard Python indexing, slicing, and iteration operations, each of which are synchronized by the lock. For byte strings, awill also have an a.value attribute to access the entire array as a single string.\n\nRawArray(typecode, initializer)\n\nThe same as Array except that there is no locking. If you are writing programs that must manipulate a large number of array items all at once, the performance will be sig- nificantly better if you use this datatype along with a separate lock for synchronization (if needed).\n\nIn addition to shared values created using Value() and Array(), the\n\nmultiprocessing module provides shared versions of the following synchronization primitives:\n\nPrimitive Lock\n\nRLock\n\nSemaphore\n\nBoundedSemaphore\n\nEvent\n\nDescription Mutual exclusion lock Reentrant mutual exclusion lock (can be acquired multiple times by the same process without blocking) Semaphore Bounded semaphore Event Condition variable\n\nCondition\n\nThe behavior of these objects mimics the synchronization primitives defined in the threading module with identical names. Please refer to the threading documentation for further details.\n\nIt should be noted that with multiprocessing, it is not normally necessary to worry\n\nabout low-level synchronization with locks, semaphores, or similar constructs to the same degree as with threads. In part, send() and receive() operations on pipes and put() and get() operations on queues already provide synchronization. However, shared values and locks can have uses in certain specialized settings. Here is an example that sends a Python list of floats to another process using a shared array instead of a pipe:\n\nimport multiprocessing\n\nclass FloatChannel(object):\n\ndef __init__(self, maxsize):\n\nself.buffer = multiprocessing.RawArray('d',maxsize) self.buffer_len = multiprocessing.Value('i') self.empty = multiprocessing.Semaphore(1) self.full = multiprocessing.Semaphore(0)\n\ndef send(self,values):\n\nself.empty.acquire() # Only proceed if buffer empty nitems = len(values) self.buffer_len = nitems # Set the buffer size self.buffer[:nitems] = values # Copy values into the buffer self.full.release() # Signal that buffer is full\n\ndef recv(self):\n\nself.full.acquire() # Only proceed if buffer full values = self.buffer[:self.buffer_len.value] # Copy values self.empty.release() # Signal that buffer is empty return values\n\nF h Lib f L Bdff\n\n428\n\nChapter 20 Threads and Concurrency\n\n# Performance test. Receive a bunch of messages def consume_test(count, ch):\n\nfor i in xrange(count):\n\nvalues = ch.recv()\n\n# Performance test. Send a bunch of messages def produce_test(count, values, ch):\n\nfor i in xrange(count): ch.send(values)\n\nif __name__ == '__main__': ch = FloatChannel(100000) p = multiprocessing.Process(target=consume_test,\n\nargs=(1000,ch))\n\np.start() values = [float(x) for x in xrange(100000)] produce_test(1000, values, ch) print(\"Done\") p.join()\n\nFurther study of this example is left to the reader. However, in a performance test on the author’s machine, sending a large list of floats through the FloatChannel is about 80 percent faster than sending the list through a Pipe (which has to pickle and unpick- le all of the values).\n\nManaged Objects Unlike threads, processes do not support shared objects.Although you can create shared values and arrays as shown in the previous section, this doesn’t work for more advanced Python objects such as dictionaries, lists, or instances of user-defined classes.The multiprocessing module does, however, provide a way to work with shared objects if they run under the control of a so-called manager.A manager is a separate subprocess where the real objects exist and which operates as a server. Other processes access the shared objects through the use of proxies that operate as clients of the manager server. The most straightforward way to work with simple managed objects is to use the\n\nManager() function.\n\nManager()\n\nCreates a running manager server in a separate process. Returns an instance of type SyncManager which is defined in the multiprocessing.managers submodule.\n\nAn instance mof SyncManager as returned by Manager() has a series of methods\n\nfor creating shared objects and returning a proxy which can be used to access them. Normally, you would create a manager and use these methods to create shared objects before launching any new processes.The following methods are defined:\n\nm.Array(typecode, sequence)\n\nCreates a shared Array instance on the server and returns a proxy to it. See the “Shared Data and Synchronization” section for a description of the arguments.\n\nm.BoundedSemaphore([value])\n\nCreates a shared threading.BoundedSemaphore instance on the server and returns a proxy to it.\n\nF h Lib f L Bdff\n\nmultiprocessing\n\n429\n\nm.Condition([lock])\n\nCreates a shared threading.Condition instance on the server and returns a proxy to it. lockis a proxy instance created by m.Lock() or m.Rlock().\n\nm.dict([args])\n\nCreates a shared dict instance on the server and returns a proxy to it.The arguments to this method are the same as for the built-in dict() function.\n\nm.Event()\n\nCreates a shared threading.Event instance on the server and returns a proxy to it.\n\nm.list([sequence])\n\nCreates a shared list instance on the server and returns a proxy to it.The arguments to this method are the same as for the built-in list() function.\n\nm.Lock()\n\nCreates a shared threading.Lock instance on the server and returns a proxy to it.\n\nm.Namespace()\n\nCreates a shared namespace object on the server and returns a proxy to it.A namespace is an object that is somewhat similar to a Python module. For example, if nis a namespace proxy, you can assign and read attributes using (.) such as n.name = valueor value = n.name. However, the choice of nameis significant. If namestarts with a letter, then that value is part of the shared object held by the manager and is accessible in all other processes. If namestarts with an underscore, it is only part of the proxy object and is not shared.\n\nm.Queue()\n\nCreates a shared Queue.Queue object on the server and returns a proxy to it.\n\nm.RLock()\n\nCreates a shared threading.Rlock object on the server and returns a proxy to it.\n\nm.Semaphore([value])\n\nCreates a shared threading.Semaphore object on the server and returns a proxy to it.\n\nm.Value(typecode, value)\n\nCreates a shared Value object on the server and returns a proxy to it. See the “Shared Data and Synchronization” section for a description of the arguments.\n\nThe following example shows how you would use a manager in order to create a\n\ndictionary shared between processes.\n\nimport multiprocessing import time\n\n# print out d whenever the passed event gets set def watch(d, evt): while True:\n\nevt.wait() print(d) evt.clear()\n\nF h Lib f L Bdff\n\n430\n\nChapter 20 Threads and Concurrency\n\nif __name__ == '__main__':\n\nm = multiprocessing.Manager() d = m.dict() # Create a shared dict evt = m.Event() # Create a shared Event\n\n# Launch a process that watches the dictionary p = multiprocessing.Process(target=watch,args=(d,evt)) p.daemon=True p.start()\n\n# Update the dictionary and notify the watcher d['foo'] = 42 evt.set() time.sleep(5)\n\n# Update the dictionary and notify the watcher d['bar'] = 37 evt.set() time.sleep(5)\n\n# Terminate the process and manager p.terminate() m.shutdown()\n\nIf you run this example, the watch() function prints out the value of d every time the passed event gets set. In the main program, a shared dictionary and event are created and manipulated in the main process.When you run this, you will see the child process printing data.\n\nIf you want to have shared objects of other types such as instances of user-defined classes, you have to create your custom manager object.To do this, you create a class that inherits from BaseManager, which is defined in the multiprocessing.managers submodule.\n\nmanagers.BaseManager([address [, authkey]])\n\nBase class used to create custom manager servers for user-defined objects. addressis an optional tuple (hostname, port) that specifies a network address for the server. If omitted, the operating system will simply assign an address corresponding to some free port number. authkeyis a string that is used to authenticate clients connecting to the server. If omitted, the value of current_process().authkey is used.\n\nIf mgrclassis a class that inherits from BaseManager, the following class method is\n\nused to create methods for returning proxies to shared objects.\n\nmgrclass.register(typeid [, callable [, proxytype [, exposed [, method_to_typeid [, create_method]]]]])\n\nRegisters a new data type with the manager class. typeidis a string that is used to name a particular kind of shared object.This string should be a valid Python identifier. callableis a callable object that creates or returns the instance to be shared. proxy- typeis a class that provides the implementation of the proxy objects to be used in clients. Normally, these classes are generated by default so this is normally set to None. exposedis a sequence of method names on the shared object that will be exposed to proxy objects. If omitted, the value of proxytype._exposed_ is used and if that is undefined, then all public methods (all callable methods that don’t start with an under- score (_) are used). method_to_typeidis a mapping from method names to type IDS that is used to specify which methods should return their results using proxy objects. If\n\nF h Lib f L Bdff\n\nmultiprocessing\n\n431\n\na method is not found in this mapping, the return value is copied and returned. If method_to_typeidis None, the value of proxytype._method_to_typeid_ is used if it is defined. create_methodis a Boolean flag that specifies whether a method with the name typeidshould be created in mgrclass. By default, this is True.\n\nAn instance mof a manager derived from BaseManager must be manually started to\n\noperate.The following attributes and methods are related to this:\n\nm.address\n\nA tuple (hostname, port) that has the address being used by the manager server.\n\nm.connect()\n\nConnects to a remote manager object, the address of which was given to the BaseManager constructor.\n\nm.serve_forever()\n\nRuns the manager server in the current process.\n\nm.shutdown()\n\nShuts down a manager server launched by the m.start() method.\n\nm.start()\n\nStarts a separate subprocess and starts the manager server in that process.\n\nThe following example shows how to create a manager for a user-defined class:\n\nimport multiprocessing from multiprocessing.managers import BaseManager\n\nclass A(object):\n\ndef __init__(self,value):\n\nself.x = value def __repr__(self):\n\nreturn \"A(%s)\" % self.x\n\ndef getX(self):\n\nreturn self.x def setX(self,value): self.x = value\n\ndef __iadd__(self,value):\n\nself.x += value return self\n\nclass MyManager(BaseManager): pass MyManager.register(\"A\",A)\n\nif __name__ == '__main__':\n\nm = MyManager() m.start() # Create a managed object a = m.A(37) ...\n\nIn this example, the last statement creates an instance of A that lives on the manager server.The variable a in the previous code is only a proxy for this instance.The behav- ior of this proxy is similar to (but not completely identical to) referent, the object on the\n\nF h Lib f L Bdff\n\n432\n\nChapter 20 Threads and Concurrency\n\nserver. First, you will find that data attributes and properties cannot be accessed. Instead, you have to use access functions:\n\n>>> a.x Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nAttributeError: 'AutoProxy[A]' object has no attribute 'x' >>> a.getX() 37 >>> a.setX(42) >>>\n\nWith proxies, the repr() function returns a string representing the proxy, whereas str() returns the output of __repr__() on the referent. For example:\n\n>>> a <AutoProxy[A] object, typeid 'A' at 0xcef230> >>> print(a) A(37) >>>\n\nSpecial methods and any method starting with an underscore (_) are not accessible on proxies. For example, if you tried to invoke a.__iadd__(), it doesn’t work:\n\n>>> a += 37 Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: unsupported operand type(s) for +=: 'AutoProxy[A]' and 'int' >>> a.__iadd__(37) Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nAttributeError: 'AutoProxy[A]' object has no attribute '__iadd__' >>>\n\nIn more advanced applications, it is possible to customize proxies to more carefully con- trol access.This is done by defining a class that inherits from BaseProxy, which is defined in multiprocessing.managers.The following code shows how you could make a custom proxy to the A class in the previous example that properly exposes the __iadd__() method and which uses a property to expose the x attribute:\n\nfrom multiprocessing.managers import BaseProxy\n\nclass AProxy(BaseProxy):\n\n# A list of all methods exposed on the referent _exposed_ = ['__iadd__','getX','setX'] # Implement the public interface of the proxy def __iadd__(self,value):\n\nself._callmethod('__iadd__',(value,)) return self\n\n@property def x(self):\n\nreturn self._callmethod('getX',())\n\n@x.setter def x(self,value):\n\nself._callmethod('setX',(value,))\n\nclass MyManager(BaseManager): pass MyManager.register(\"A\", A, proxytype=AProxy)\n\nAn instance proxyof a class derived from BaseProxy has the following methods:\n\nF h Lib f L Bdff\n\nmultiprocessing\n\n433\n\nproxy._callmethod(name [, args [, kwargs]])\n\nCalls the method nameon the proxy’s referent object. nameis a string with the method name, argsis a tuple containing positional arguments, and kwargsis a dictionary of keyword arguments.The method namemust be explicitly exposed. Normally this is done by including the name in the _exposed_ class attribute of the proxy class.\n\nproxy._getvalue()\n\nReturns a copy of the referent in the caller. If this call is made in a different process, the referent object is pickled, sent to the caller, and is unpickled.An exception is raised if the referent can’t be pickled.\n\nConnections Programs that use the multiprocessing module can perform message passing with other processes running on the same machine or with processes located on remote sys- tems.This can be useful if you want to take a program written to work on a single sys- tem and expand it work on a computing cluster.The multiprocessing.connection submodule has functions and classes for this purpose:\n\nconnections.Client(address [, family [, authenticate [, authkey]]])\n\nConnects to another process which must already be listening at address address. addressis a tuple (hostname , port) representing a network address, a file name representing a UNIX domain socket, or a string of the form r'\\\\servername\\pipe\\pipename' representing a Windows named pipe on a remote system servername(use a servernameof '.' for the local machine). familyis a string representing the addess format and is typically one of 'AF_INET', 'AF_UNIX', or 'AF_PIPE'. If omitted, the family is inferred from the format of address. authenticationis a Boolean flag that specifies whether digest authentica- tion is to be used. authkeyis a string containing the authentication key. If omitted, then the value of current_process().authkey is used.The return value from this function is a Connection object, which was previously described in the pipes section of “Interprocess Communication.”\n\nconnections.Listener([address [, family [, backlog [, authenticate [, authkey]]]]])\n\nA class that implements a server for listening for and handling connections made by the Client() function.The address, family, authenticate, and authkeyarguments have the same meaning as for Client(). backlogis an integer corresponding to the value passed to the listen() method of sockets if the addressparameter specifies a network connection. By default, backlogis 1. If addressis omitted, then a default address is chosen. If both addressand familyare omitted, then the fastest available communications scheme on the local system is chosen.\n\nAn instance sof Listener supports the following methods and attributes:\n\ns.accept()\n\nAccepts a new connection and returns a Connection object. Raises AuthenticationError if authentication fails.\n\ns.address\n\nThe address that the listener is using.\n\nF h Lib f L Bdff\n\n434\n\nChapter 20 Threads and Concurrency\n\ns.close()\n\nCloses the pipe or socket being used by the listener.\n\ns.last_accepted\n\nThe address of the last client that was accepted.\n\nHere is an example of a server program that listens for clients and implements a sim-\n\nple remote operation (adding):\n\nfrom multiprocessing.connection import Listener\n\nserv = Listener(('',15000),authkey='12345') while True:\n\nconn = serv.accept() while True: try:\n\nx,y = conn.recv()\n\nexcept EOFError:\n\nbreak result = x + y conn.send(result)\n\nconn.close()\n\nHere is a simple client program that connects to this server and sends some messages:\n\nfrom multiprocessing.connection import Client conn = Client(('localhost',15000), authkey=\"12345\")\n\nconn.send((3,4)) r = conn.recv() print(r) # Prints '7'\n\nconn.send((\"Hello\",\"World\")) r = conn.recv() print(r) # Prints 'HelloWorld'\n\nconn.close()\n\nMiscellaneous Utility Functions The following utility functions are also defined:\n\nactive_children()\n\nReturns a list of Process objects for all active child processes.\n\ncpu_count()\n\nReturns the number of CPUs on the system if it can be determined.\n\ncurrent_process()\n\nReturns the Process object for the current process.\n\nfreeze_support()\n\nA function that should be included as the first statement of the main program in an application that will be “frozen” using various packaging tools such as py2exe.This is needed to prevent runtime errors associated with launching subprocesses in a frozen application.\n\nF h Lib f L Bdff\n\nmultiprocessing\n\n435\n\nget_logger()\n\nReturns the logging object associated with the multiprocessing module, creating it if it doesn’t already exist.The returned logger does not propagate messages to the root log- ger, has a level of logging.NOTSET, and prints all logging messages to standard error.\n\nset_executable(executable)\n\nSets the name of the Python executable used to execute subprocesses.This is only defined on Windows.\n\nGeneral Advice on Multiprocessing The multiprocessing module is one of the most advanced and powerful modules in the Python library. Here are some general tips for keeping your head from exploding: n Carefully read the online documentation before building a large application.\n\nAlthough this section has covered the essential basics, the official documentation covers some of the more sneaky issues that can arise.\n\nn Make sure that all data passed between processes is compatible with pickle. n Avoid shared data and learn to love message passing and queues.With message passing, you don’t have to worry so much about synchronization, locking, and other issues. It also tends to provide better scaling as the number of processes increases.\n\nn Don’t use global variables inside functions that are meant to run in separate\n\nprocesses. It is better to explicitly pass parameters instead.\n\nn Try not to mix threads and multiprocessing together in the same program unless you’re vastly trying to improve your job security (or to have it reduced depend- ing on who is doing the code review).\n\nn Pay very careful attention to how processes get shut down.As a general rule, you\n\nwill want to explicitly close processes and have a well-defined termination scheme in place as opposed to just relying on garbage collection or having to forcefully terminate children using the terminate() operation.\n\nn The use of managers and proxies is closely related to a variety of concepts in dis-\n\ntributed computing (e.g., distributed objects).A good distributed computing book might be a useful reference.\n\nn The multiprocessing module originated from a third-party library known as\n\npyprocessing. Searching for usage tips and information on this library may be a useful resource.\n\nn Although this module works on Windows, you should carefully read the official documentation for a variety of subtle details. For example, to launch a new process on Windows, the multiprocessing module implements its own clone of the UNIX fork() operation, in which process state is copied to the child process over a pipe.As a general rule, this module is much more tuned to UNIX systems.\n\nn Above all else, try to keep things as simple as possible.\n\nF h Lib f L Bdff\n\n436\n\nChapter 20 Threads and Concurrency\n\nthreading The threading module provides a Thread class and a variety of synchronization prim- itives for writing multithreaded programs.\n\nThread Objects The Thread class is used to represent a separate thread of control.A new thread can be created as follows:\n\nThread(group=None, target=None, name=None, args=(), kwargs={})\n\nThis creates a new Thread instance. groupis None and is reserved for future exten- sions. targetis a callable object invoked by the run() method when the thread starts. By default, it’s None, meaning that nothing is called. nameis the thread name. By default, a unique name of the form \"Thread-N\" is created. argsis a tuple of arguments passed to the targetfunction. kwargsis a dictionary of keyword arguments passed to target.\n\nA Thread instance tsupports the following methods and attributes:\n\nt.start()\n\nStarts the thread by invoking the run() method in a separate thread of control.This method can be invoked only once.\n\nt.run()\n\nThis method is called when the thread starts. By default, it calls the target function passed in the constructor.This method can also be redefined in subclasses of Thread.\n\nt.join([timeout])\n\nWaits until the thread terminates or a timeout occurs. timeoutis a floating-point num- ber specifying a timeout in seconds.A thread cannot join itself, and it’s an error to join a thread before it has been started.\n\nt.is_alive()\n\nReturns True if the thread is alive and False otherwise.A thread is alive from the moment the start() method returns until its run() method terminates. t.isAlive() is an alias for this method in older code.\n\nt.name\n\nThe thread name.This is a string that is used for identification only and which can be changed to a more meaningful value if desired (which may simplify debugging). In older code, t.getName() and t.setName(name) are used to manipulate the thread name.\n\nt.ident\n\nAn integer thread identifier. If the thread has not yet started, the value is None.\n\nt.daemon\n\nThe thread’s Boolean daemonic flag.This must be set prior to calling start() and the initial value is inherited from daemonic status of the creating thread.The entire Python program exits when no active non-daemon threads are left.All programs have a main\n\nF h Lib f L Bdff\n\nthreading\n\n437\n\nthread that represents the initial thread of control and which is not daemonic. In older code, t.setDaemon(flag) and t.isDaemon() are used to manipulate this value. Here is an example that shows how to create and launch a function (or other\n\ncallable) as a thread:\n\nimport threading import time\n\ndef clock(interval): while True:\n\nprint(\"The time is %s\" % time.ctime()) time.sleep(interval)\n\nt = threading.Thread(target=clock, args=(15,)) t.daemon = True t.start()\n\nHere is an example that shows how to define the same thread as a class:\n\nimport threading import time\n\nclass ClockThread(threading.Thread): def __init__(self,interval):\n\nthreading.Thread.__init__(self) self.daemon = True self.interval = interval\n\ndef run(self):\n\nwhile True:\n\nprint(\"The time is %s\" % time.ctime()) time.sleep(self.interval)\n\nt = ClockProcess(15) t.start()\n\nIf you define a thread as a class and define your own __init__() method, it is criti- cally important to call the base class constructor Thread.__init__() as shown. If you forget this, you will get a nasty error. Other than run(), it is an error to override any of the other methods already defined for a thread.\n\nThe setting of the daemon attribute in these examples is a common feature of threads that will run forever in the background. Normally, Python waits for all threads to terminate before the interpreter exits. However, for nonterminating background tasks, this behavior is often undesirable. Setting the daemon flag makes the interpreter quit immediately after the main program exits. In this case, the daemonic threads are simply destroyed.\n\nTimer Objects A Timer object is used to execute a function at some later time.\n\nTimer(interval, func [, args [, kwargs]])\n\nCreates a timer object that runs the function funcafter intervalseconds have elapsed. argsand kwargsprovide the arguments and keyword arguments passed to func.The timer does not start until the start() method is called.\n\nF h Lib f L Bdff",
      "page_number": 439
    },
    {
      "number": 23,
      "title": "Segment 23 (pages 462-484)",
      "start_page": 462,
      "end_page": 484,
      "detection_method": "synthetic",
      "content": "438\n\nChapter 20 Threads and Concurrency\n\nA Timer object, t, has the following methods:\n\nt.start()\n\nStarts the timer.The function funcsupplied to Timer() will be executed after the specified timer interval.\n\nt.cancel()\n\nCancels the timer if the function has not executed yet.\n\nLock Objects A primitive lock (or mutual exclusion lock) is a synchronization primitive that’s in either a “locked” or “unlocked” state.Two methods, acquire() and release(), are used to change the state of the lock. If the state is locked, attempts to acquire the lock are blocked until the lock is released. If more than one thread is waiting to acquire the lock, only one is allowed to proceed when the lock is released.The order in which waiting threads proceed is undefined.\n\nA new Lock instance is created using the following constructor:\n\nLock()\n\nCreates a new Lock object that’s initially unlocked.\n\nA Lock instance, lock, supports the following methods:\n\nlock.acquire([blocking ])\n\nAcquires the lock, blocking until the lock is released if necessary. If blocking is supplied and set to False, the function returns immediately with a value of False if the lock could not be acquired or True if locking was successful.\n\nlock.release()\n\nReleases a lock. It’s an error to call this method when the lock is in an unlocked state or from a different thread than the one that originally called acquire().\n\nRLock A reentrant lock is a synchronization primitive that’s similar to a Lock object, but it can be acquired multiple times by the same thread.This allows the thread owning the lock to perform nested acquire() and release() operations. In this case, only the outer- most release() operation resets the lock to its unlocked state.\n\nA new RLock object is created using the following constructor:\n\nRLock()\n\nCreates a new reentrant lock object.An RLock object, rlock, supports the following methods:\n\nrlock.acquire([blocking ])\n\nAcquires the lock, blocking until the lock is released if necessary. If no thread owns the lock, it’s locked and the recursion level is set to 1. If this thread already owns the lock, the recursion level of the lock is increased by one and the function returns immediately.\n\nF h Lib f L Bdff\n\nthreading\n\n439\n\nrlock.release()\n\nReleases a lock by decrementing its recursion level. If the recursion level is zero after the decrement, the lock is reset to the unlocked state. Otherwise, the lock remains locked.This function should only be called by the thread that currently owns the lock.\n\nSemaphore and Bounded Semaphore A semaphore is a synchronization primitive based on a counter that’s decremented by each acquire() call and incremented by each release() call. If the counter ever reaches zero, the acquire() method blocks until some other thread calls release().\n\nSemaphore([value])\n\nCreates a new semaphore. valueis the initial value for the counter. If omitted, the counter is set to a value of 1.\n\nA Semaphore instance, s, supports the following methods:\n\ns.acquire([blocking])\n\nAcquires the semaphore. If the internal counter is larger than zero on entry, this method decrements it by 1 and returns immediately. If it’s zero, this method blocks until another thread calls release().The blocking argument has the same behavior as described for Lock and RLock objects.\n\ns.release()\n\nReleases a semaphore by incrementing the internal counter by 1. If the counter is zero and another thread is waiting, that thread is awakened. If multiple threads are waiting, only one will be returned from its acquire() call.The order in which threads are released is not deterministic.\n\nBoundedSemaphore([value])\n\nCreates a new semaphore. valueis the initial value for the counter. If valueis omitted, the counter is set to a value of 1.A BoundedSemaphore works exactly like a Semaphore except the number of release() operations cannot exceed the number of acquire() operations.\n\nA subtle difference between a semaphore and a mutex lock is that a semaphore can\n\nbe used for signaling. For example, the acquire() and release() methods can be called from different threads to communicate between producer and consumer threads.\n\nproduced = threading.Semaphore(0) consumed = threading.Semaphore(1)\n\ndef producer(): while True:\n\nconsumed.acquire() produce_item() produced.release()\n\ndef consumer(): while True:\n\nproduced.acquire() item = get_item() consumed.release()\n\nF h Lib f L Bdff\n\n440\n\nChapter 20 Threads and Concurrency\n\nThe kind of signaling shown in this example is often instead carried out using condi- tion variables, which will be described shortly.\n\nEvents Events are used to communicate between threads. One thread signals an “event,” and one or more other threads wait for it.An Event instance manages an internal flag that can be set to true with the set() method and reset to false with the clear() method. The wait() method blocks until the flag is true.\n\nEvent()\n\nCreates a new Event instance with the internal flag set to false.An Event instance, e, supports the following methods:\n\ne.is_set()\n\nReturns true only if the internal flag is true.This method is called isSet() in older code.\n\ne.set()\n\nSets the internal flag to true.All threads waiting for it to become true are awakened.\n\ne.clear()\n\nResets the internal flag to false.\n\ne.wait([timeout])\n\nBlocks until the internal flag is true. If the internal flag is true on entry, this method returns immediately. Otherwise, it blocks until another thread calls set() to set the flag to true or until the optional timeout occurs. timeoutis a floating-point number speci- fying a timeout period in seconds.\n\nAlthough Event objects can be used to signal other threads, they should not be used\n\nto implement the kind of notification that is typical in producer/consumer problems. For example, you should avoid code like this:\n\nevt = Event()\n\ndef producer(): while True:\n\n# produce item ... evt.signal()\n\ndef consumer(): while True:\n\n# Wait for an item evt.wait() # Consume the item ... # Clear the event and wait again evt.clear()\n\nThis code does not work reliably because the producer might produce a new item in between the evt.wait() and evt.clear() operations. However, by clearing the event, this new item won’t be seen by the consumer until the producer creates a new item. In the best case, the program will experience a minor hiccup where the processing\n\nF h Lib f L Bdff\n\nthreading\n\n441\n\nof an item is inexplicably delayed. In the worst case, the whole program will hang due to the loss of an event signal. For these types of problems, you are better off using con- dition variables.\n\nCondition Variables A condition variable is a synchronization primitive, built on top of another lock that’s used when a thread is interested in a particular change of state or event occurring.A typical use is a producer-consumer problem where one thread is producing data to be con- sumed by another thread.A new Condition instance is created using the following constructor:\n\nCondition([lock])\n\nCreates a new condition variable. lockis an optional Lock or RLock instance. If not supplied, a new RLock instance is created for use with the condition variable.\n\nA condition variable, cv, supports the following methods:\n\ncv.acquire(*args)\n\nAcquires the underlying lock.This method calls the corresponding acquire(*args) method on the underlying lock and returns the result.\n\ncv.release()\n\nReleases the underlying lock.This method calls the corresponding release() method on the underlying lock.\n\ncv.wait([timeout])\n\nWaits until notified or until a timeout occurs.This method is called after the calling thread has already acquired the lock.When called, the underlying lock is released, and the thread goes to sleep until it’s awakened by a notify() or notifyAll() call per- formed on the condition variable by another thread. Once awakened, the thread reac- quires the lock and the method returns. timeout is a floating-point number in seconds. If this time expires, the thread is awakened, the lock reacquired, and control returned.\n\ncv.notify([n])\n\nWakes up one or more threads waiting on this condition variable.This method is called only after the calling thread has acquired the lock, and it does nothing if no threads are waiting. nspecifies the number of threads to awaken and defaults to 1.Awakened threads don’t return from the wait() call until they can reacquire the lock.\n\ncv.notify_all()\n\nWakes up all threads waiting on this condition.This method is called notifyAll() in older code.\n\nHere is an example that provides a template of using condition variables:\n\ncv = threading.Condition() def producer(): while True:\n\ncv.acquire() produce_item() cv.notify() cv.release()\n\nF h Lib f L Bdff\n\n442\n\nChapter 20 Threads and Concurrency\n\ndef consumer(): while True:\n\ncv.acquire() while not item_is_available():\n\ncv.wait() # Wait for an item to show up\n\ncv.release() consume_item()\n\nA subtle aspect of using condition variables is that if there are multiple threads waiting on the same condition, the notify() operation may awaken one or more of them (this behavior often depends on the underlying operating system). Because of this, there is always a possibility that a thread will awaken only to find that the condition of interest no longer holds.This explains, for instance, why a while loop is used in the consumer() function. If the thread awakens, but the produced item is already gone, it just goes back to waiting for the next signal.\n\nWorking with Locks Great care must be taken when working with any of the locking primitives such as Lock, RLock, or Semaphore. Mismanagement of locks is a frequent source of deadlock or race conditions. Code that relies on a lock should always make sure locks get proper- ly released even when exceptions occur.Typical code looks like this:\n\ntry:\n\nlock.acquire() # critical section statements ... finally:\n\nlock.release()\n\nAlternatively, all of the locks also support the context management protocol which is a little cleaner:\n\nwith lock:\n\n# critical section statements ...\n\nIn this last example, the lock is automatically acquired by the with statement and released when control flow leaves the context.\n\nAlso, as a general rule you should avoid writing code where more than one lock is\n\nacquired at any given time. For example:\n\nwith lock_A:\n\n# critical section statements ... with lock_B:\n\n# critical section on B statements\n\n...\n\nThis is usually a good way to have your application mysteriously deadlock.Although there are strategies for avoiding this (for example, hierarchical locking), you’re often bet- ter off writing code that avoids this altogether.\n\nF h Lib f L Bdff\n\nthreading\n\n443\n\nThread Termination and Suspension Threads do not have any methods for forceful termination or suspension.This omission is by design and due to the intrinsic complexity of writing threaded programs. For example, if a thread has acquired a lock, forcefully terminating or suspending it before it is able to release the lock may cause the entire application to deadlock. Moreover, it is generally not possible to simply “release all locks” on termination either because com- plicated thread synchronization often involves locking and unlocking operations that must be carried out in a very precise sequence to work.\n\nIf you want to support termination or suspension, you need to build these features yourself.Typically, it’s done by making a thread run in a loop that periodically checks its status to see if it should terminate. For example:\n\nclass StoppableThread(threading.Thread):\n\ndef __init__(self):\n\nthreading.Thread.__init__() self._terminate = False self._suspend_lock = threading.Lock()\n\ndef terminate(self):\n\nself._terminate = True\n\ndef suspend(self):\n\nself._suspend_lock.acquire()\n\ndef resume(self):\n\nself._suspend_lock.release()\n\ndef run(self):\n\nwhile True:\n\nif self._terminate:\n\nbreak\n\nself._suspend_lock.acquire() self._suspend_lock.release() statements ...\n\nKeep in mind that to make this approach work reliability, the thread should take great care not to perform any kind of blocking I/O operation. For example, if the thread blocks waiting for data to arrive, it won’t terminate until it wakes up from that opera- tion. Because of this, you would probably want to make the implementation use timeouts, non-blocking I/O, and other advanced features to make sure that that the termination check executes every so often.\n\nUtility Functions The following utility functions are available:\n\nactive_count()\n\nReturns the number of currently active Thread objects.\n\ncurrent_thread()\n\nReturns the Thread object corresponding to the caller’s thread of control.\n\nenumerate()\n\nReturns a list of all currently active Thread objects.\n\nlocal()\n\nReturns a local object that allows for the storage of thread-local data.This object is guaranteed to be unique in each thread.\n\nF h Lib f L Bdff\n\n444\n\nChapter 20 Threads and Concurrency\n\nsetprofile(func)\n\nSets a profile function that will be used for all threads created. funcis passed to sys.setprofile() before each thread starts running.\n\nsettrace(func)\n\nSets a tracing function that will be used for all threads created. funcis passed to sys.settrace() before each thread starts running.\n\nstack_size([size])\n\nReturns the stack size used when creating new threads. If an optional integer sizeis given, it sets the stack size to be used for creating new threads. sizecan be a value that is 32768 (32KB) or greater and a multiple of 4096 (4KB) for maximum portability.A ThreadError exception is raised if this operation isn’t supported on the system.\n\nThe Global Interpreter Lock The Python interpreter is protected by a lock that only allows one thread to execute at a time even if there are multiple processors available.This severely limits the usefulness of threads in compute-intensive programs—in fact, the use of threads will often make CPU-bound programs run significantly worse than would be the case if they just sequentially carried out the same work.Thus, threads should really only be reserved for programs that are primarily concerned with I/O such as network servers. For more compute-intensive tasks, consider using C extension modules or the multiprocessing module instead. C extensions have the option of releasing the interpreter lock and run- ning in parallel, provided that they don’t interact with the interpreter when the lock is released.The multiprocessing module farms work out to independent subprocesses that aren’t restricted by the lock.\n\nProgramming with Threads Although it is possible to write very traditional multithreaded programs in Python using various combinations of locks and synchronization primitives, there is one style of pro- gramming that is recommended over all others—and that’s to try and organize multi- threaded programs as a collection of independent tasks that communicate through message queues.This is described in the next section (the queue module) along with an example.\n\nqueue, Queue The queue module (named Queue in Python 2) implements various multiproducer, multiconsumer queues that can be used to safely exchange information between multi- ple threads of execution.\n\nThe queue module defines three different queue classes:\n\nQueue([maxsize])\n\nCreates a FIFO (first-in first-out) queue. maxsizeis the maximum number of items that can be placed in the queue. If maxsizeomitted or 0, the queue size is infinite.\n\nLifoQueue([maxsize])\n\nCreates a LIFO (last-in, first-out) queue (also known as a stack).\n\nF h Lib f L Bdff\n\nQueue, queue\n\n445\n\nPriorityQueue([maxsize])\n\nCreates a priority queue in which items are ordered from lowest to highest priority. When working with this queue, items should be tuples of the form (priority, data) where priorityis a number.\n\nAn instance qof any of the queue classes has the following methods:\n\nq.qsize()\n\nReturns the approximate size of the queue. Because other threads may be updating the queue, this number is not entirely reliable.\n\nq.empty()\n\nReturns True if the queue is empty and returns False otherwise.\n\nq.full()\n\nReturns True if the queue is full and returns False otherwise.\n\nq.put(item [, block [, timeout]])\n\nPuts iteminto the queue. If optional argument blockis True (the default), the caller blocks until a free slot is available. Otherwise (blockis False), the Full exception is raised if the queue is full. timeoutsupplies an optional timeout value in seconds. If a timeout occurs, the Full exception is raised.\n\nq.put_nowait(item)\n\nEquivalent to q.put(item, False).\n\nq.get([block [, timeout]])\n\nRemoves and returns an item from the queue. If optional argument blockis True (the default), the caller blocks until an item is available. Otherwise (blockis False), the Empty exception is raised if the queue is empty. timeoutsupplies an optional timeout value in seconds. If a timeout occurs, the Empty exception is raised.\n\nq.get_nowait()\n\nEquivalent to get(0).\n\nq.task_done()\n\nUsed by consumers of queued data to indicate that processing of an item has been fin- ished. If this is used, it should be called once for every item removed from the queue.\n\nq.join()\n\nBlocks until all items on the queue have been removed and processed.This will only return once q.task_done() has been called for every item placed on the queue.\n\nQueue Example with Threads Multithreaded programs are often simplified with the use of queues. For example, instead of relying upon shared state that must be protected by locks, threads can be linked together using shared queues. In this model, worker threads typically operate as consumers of data. Here is an example that illustrates the concept:\n\nF h Lib f L Bdff\n\n446\n\nChapter 20 Threads and Concurrency\n\nimport threading from queue import Queue # Use from Queue on Python 2\n\nclass WorkerThread(threading.Thread):\n\ndef __init__(self,*args,**kwargs):\n\nthreading.Thread.__init__(self,*args,**kwargs) self.input_queue = Queue()\n\ndef send(self,item):\n\nself.input_queue.put(item)\n\ndef close(self):\n\nself.input_queue.put(None) self.input_queue.join()\n\ndef run(self):\n\nwhile True:\n\nitem = self.input_queue.get() if item is None:\n\nbreak\n\n# Process the item (replace with useful work) print(item) self.input_queue.task_done()\n\n# Done. Indicate that sentinel was received and return self.input_queue.task_done() return\n\n# Example use w = WorkerThread() w.start() w.send(\"hello\") # Send items to the worker (via queue) w.send(\"world\") w.close()\n\nThe design of this class has been chosen very carefully. First, you will notice that the programming API is a subset of the Connection objects that get created by pipes in the multiprocessing module.This allows for future expansion. For example, workers could later be migrated into a separate process without breaking the code that sends them data.\n\nSecond, the programming interface allows for thread termination.The close() method places a sentinel onto the queue which, in turn, causes the thread to shut down when processed.\n\nFinally, the programming API is also almost identical to a coroutine. If the work to\n\nbe performed doesn’t involve any blocking operations, you could reimplement the run() method as a coroutine and dispense with threads altogether.This latter approach might run faster because there would no longer be any overhead due to thread context switching.\n\nCoroutines and Microthreading In certain kinds of applications, it is possible to implement cooperative user-space mul- tithreading using a task scheduler and a collection of generators or coroutines.This is sometimes called microthreading, although the terminology varies—sometimes this is described in the context of tasklets, green threads, greenlets, etc.A common use of this technique is in programs that need to manage a large collection of open files or sockets. For example, a network server that wants to simultaneously manage 1,000 client con- nections. Instead of creating 1,000 threads to do that, asynchronous I/O or polling (using the select module) is used in conjunction with a task scheduler that processes I/O events.\n\nF h Lib f L Bdff\n\nCoroutines and Microthreading\n\n447\n\nThe underlying concept that drives this programming technique is the fact that the\n\nyield statement in a generator or coroutine function suspends the execution of the function until it is later resumed with a next() or send() operation.This makes it possible to cooperatively multitask between a set of generator functions using a sched- uler loop. Here is an example that illustrates the idea:\n\ndef foo():\n\nfor n in xrange(5):\n\nprint(\"I'm foo %d\" % n) yield\n\ndef bar():\n\nfor n in xrange(10):\n\nprint(\"I'm bar %d\" % n) yield\n\ndef spam():\n\nfor n in xrange(7):\n\nprint(\"I'm spam %d\" % n) yield\n\n# Create and populate a task queue from collections import deque taskqueue = deque() taskqueue.append(foo()) # Add some tasks (generators) taskqueue.append(bar()) taskqueue.append(spam())\n\n# Run all of the tasks while taskqueue:\n\n# Get the next task task = taskqueue.pop() try:\n\n# Run it to the next yield and enqueue next(task) taskqueue.appendleft(task)\n\nexcept StopIteration: # Task is done pass\n\nIt is uncommon for a program to define a series of CPU-bound coroutines and sched- ule them as shown. Instead, you are more likely to see this technique used with I/O bound tasks, polling, or event handling.An advanced example showing this technique is found in the select module section of Chapter 21,“Network Programming and Sockets.”\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n21\n\nNetwork Programming and Sockets\n\nThis chapter describes the modules used to implement low-level network servers and\n\nclients. Python provides extensive network support, ranging from programming directly with sockets to working with high-level application protocols such as HTTP.To begin, a very brief (and admittedly terse) introduction to network programming is presented. Readers are advised to consult a book such as UNIX Network Programming,Volume 1: Networking APIs: Sockets and XTI by W. Richard Stevens (Prentice Hall, 1997, ISBN 0-13-490012-X) for many of the advanced details. Chapter 22,“Internet Application Programming,” describes modules related to application-level protocols.\n\nNetwork Programming Basics Python’s network programming modules primarily support two Internet protocols:TCP and UDP.The TCP protocol is a reliable connection-oriented protocol used to establish a two-way communications stream between machines. UDP is a lower-level packet-based protocol (connectionless) in which machines send and receive discrete packets of infor- mation without formally establishing a connection. Unlike TCP, UDP communication is unreliable and thus inherently more complicated to manage in applications that require reliable communications. Consequently, most Internet applications utilize TCP connections.\n\nBoth network protocols are handled through a programming abstraction known as a\n\nsocket.A socket is an object similar to a file that allows a program to accept incoming connections, make outgoing connections, and send and receive data. Before two machines can communicate, both must create a socket object.\n\nThe machine receiving the connection (the server) must bind its socket object to a known port number.A port is a 16-bit number in the range 0–65535 that’s managed by the operating system and used by clients to uniquely identify servers. Ports 0–1023 are reserved by the system and used by common network protocols.The following table shows the port assignments for a couple of common protocols (a more complete list can be found at http://www.iana.org/assignments/port-numbers):\n\nF h Lib f L Bdff\n\n450\n\nChapter 21 Network Programming and Sockets\n\nService FTP-Data FTP-Control SSH Telnet SMTP (Mail) HTTP (WWW) POP3 IMAP HTTPS (Secure WWW)\n\nPort Number 20 21 22 23 25 80 110 143 443\n\nThe process of establishing a TCP connection involves a precise sequence of steps on both the server and client, as shown in Figure 21.1.\n\nServer\n\nClient\n\nsocket()\n\nsocket()\n\nbind()\n\nlisten()\n\naccept()\n\nwait for connection\n\nestablish connection\n\nconnect()\n\nread()\n\nrequest\n\nwrite()\n\nprocess request\n\nwrite()\n\nresponse\n\nread()\n\nFigure 21.1 TCP connection protocol.\n\nFor TCP servers, the socket object used to receive connections is not the same socket used to perform subsequent communication with the client. In particular, the accept() system call returns a new socket object that’s actually used for the connection.This allows a server to manage connections from a large number of clients simultaneously.\n\nF h Lib f L Bdff\n\nNetwork Programming Basics\n\n451\n\nUDP communication is performed in a similar manner, except that clients and\n\nservers don’t establish a “connection” with each other, as shown in Figure 21.2.\n\nServer\n\nClient\n\nsocket()\n\nsocket()\n\nbind()\n\nbind()\n\nrecvfrom()\n\nwait for data\n\nrequest\n\nsendto()\n\nprocess request\n\nsendto()\n\nresponse\n\nrecvfrom()\n\nFigure 21.2 UDP connection protocol.\n\nThe following example illustrates the TCP protocol with a client and server written using the socket module. In this case, the server simply returns the current time to the client as a string.\n\n# Time server program from socket import * import time\n\ns = socket(AF_INET, SOCK_STREAM) # Create a TCP socket s.bind(('',8888)) # Bind to port 8888 s.listen(5) # Listen, but allow no more than\n\n# 5 pending connections.\n\nwhile True:\n\nclient,addr = s.accept() # Get a connection print(\"Got a connection from %s\" % str(addr)) timestr = time.ctime(time.time()) + \"\\r\\n\" client.send(timestr.encode('ascii')) client.close()\n\nHere’s the client program:\n\n# Time client program from socket import * s = socket(AF_INET,SOCK_STREAM) # Create a TCP socket s.connect(('localhost', 8888)) # Connect to the server tm = s.recv(1024) # Receive no more than 1024 bytes s.close() print(\"The time is %s\" % tm.decode('ascii'))\n\nF h Lib f L Bdff\n\n452\n\nChapter 21 Network Programming and Sockets\n\nAn example of establishing a UDP connection appears in the socket module section later in this chapter.\n\nIt is common for network protocols to exchange data in the form of text. However, great attention needs to be given to text encoding. In Python 3, all strings are Unicode. Therefore, if any kind of text string is to be sent across the network, it needs to be encoded.This is why the server is using the encode('ascii') method on the data it transmits. Likewise, when a client receives network data, that data is first received as raw unencoded bytes. If you print it out or try to process it as text, you’re unlikely to get what you expected. Instead, you need to decode it first.This is why the client code is using decode('ascii') on the result.\n\nThe remainder of this chapter describes modules that are related to socket program-\n\nming. Chapter 22 describes higher-level modules that provide support for various Internet applications such as email and the Web.\n\nasynchat The asynchat module simplifies the implementation of applications that implement asynchronous networking using the asyncore module. It does this by wrapping the low-level I/O functionality of asyncore with a higher-level programming interface that is designed for network protocols based on simple request/response mechanisms (for example, HTTP).\n\nTo use this module, you must define a class that inherits from async_chat.Within\n\nthis class, you must define two methods: collect_incoming_data() and found_terminator().The first method is invoked whenever data is received on the network connection.Typically, it would simply take the data and store it someplace.The found_terminator() method is called when the end of a request has been detected. For example, in HTTP, requests are terminated by a blank line.\n\nFor data output, async_chat maintains a producer FIFO queue. If you need to out-\n\nput data, it is simply added to this queue.Then, whenever writes are possible on the network connection, data is transparently taken from this queue.\n\nasync_chat([sock])\n\nBase class used to define new handlers. async_chat inherits from asyncore.dispatcher and provides the same methods. sockis a socket object that’s used for communication.\n\nAn instance, a, of async_chat has the following methods in addition to those\n\nalready provided by the asyncore.dispatcher base class:\n\na.close_when_done()\n\nSignals an end-of-file on the outgoing data stream by pushing None onto the producer FIFO queue.When this is reached by the writer, the channel will be closed.\n\na.collect_incoming_data(data)\n\nCalled whenever data is received on the channel. datais the received data and is typi- cally stored for later processing.This method must be implemented by the user.\n\na.discard_buffers()\n\nDiscards all data held in input/output buffers and the producer FIFO queue.\n\nF h Lib f L Bdff\n\nasynchat\n\n453\n\na.found_terminator()\n\nCalled when the termination condition set by set_terminator() holds.This method must be implemented by the user.Typically, it would process data previously collected by the collect_incoming_data() method.\n\na.get_terminator()\n\nReturns the terminator for the channel.\n\na.push(data)\n\nPushes data onto the channel’s outgoing producer FIFO queue. datais a string con- taining the data to be sent.\n\na.push_with_producer(producer)\n\nPushes a producer object, producer, onto the producer FIFO queue. producermay be any object that has a simple method, more().The more() method should produce a string each time it is invoked.An empty string is returned to signal the end of data. Internally, the async_chat class repeatedly calls more() to obtain data to write on the outgoing channel. More than one producer object can be pushed onto the FIFO by calling push_with_producer() repeatedly.\n\ns.set_terminator(term)\n\nSets the termination condition on the channel. termmay either be a string, an integer, or None. If termis a string, the method found_terminator() is called whenever that string appears in the input stream. If termis an integer, it specifies a byte count.After many bytes have been read, found_terminator() will be called. If termis None, data is collected forever.\n\nThe module defines one class that can produce data for the\n\na.push_with_producer() method.\n\nsimple_producer(data [, buffer_size])\n\nCreates a simple producer object that produces chunks from a byte string data. buffer_sizespecifies the chunk size and is 512 by default.\n\nThe asynchat module is always used in conjunction with the asyncore module. For instance, asyncore is used to set up the high-level server, which accepts incoming connections. asynchat is then used to implement handlers for each connection.The following example shows how this works by implementing a minimalistic web server that handles GET requests.The example omits a lot of error checking and details but should be enough to get you started. Readers should compare this example to the example in the asyncore module, which is covered next.\n\n# An asynchronous HTTP server using asynchat import asynchat, asyncore, socket import os import mimetypes try:\n\nfrom http.client import responses # Python 3\n\nexcept ImportError:\n\nfrom httplib import responses # Python 2\n\nF h Lib f L Bdff\n\n454\n\nChapter 21 Network Programming and Sockets\n\n# This class plugs into the asyncore module and merely handles accept events class async_http(asyncore.dispatcher):\n\ndef __init__(self,port):\n\nasyncore.dispatcher.__init__(self) self.create_socket(socket.AF_INET,socket.SOCK_STREAM) self.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) self.bind(('',port)) self.listen(5)\n\ndef handle_accept(self):\n\nclient,addr = self.accept() return async_http_handler(client)\n\n# Class that handles asynchronous HTTP requests. class async_http_handler(asynchat.async_chat):\n\ndef __init__(self,conn=None):\n\nasynchat.async_chat.__init__(self,conn) self.data = [] self.got_header = False self.set_terminator(b\"\\r\\n\\r\\n\")\n\n# Get incoming data and append to data buffer def collect_incoming_data(self,data):\n\nif not self.got_header:\n\nself.data.append(data)\n\n# Got a terminator (the blank line) def found_terminator(self):\n\nself.got_header = True header_data = b\"\".join(self.data) # Decode header data (binary) into text for further processing header_text = header_data.decode('latin-1') header_lines = header_text.splitlines() request = header_lines[0].split() op = request[0] url = request[1][1:] self.process_request(op,url)\n\n# Push text onto the outgoing stream, but encode it first def push_text(self,text):\n\nself.push(text.encode('latin-1'))\n\n# Process the request def process_request(self, op, url):\n\nif op == \"GET\":\n\nif not os.path.exists(url):\n\nself.send_error(404,\"File %s not found\\r\\n\")\n\nelse:\n\ntype, encoding = mimetypes.guess_type(url) size = os.path.getsize(url) self.push_text(\"HTTP/1.0 200 OK\\r\\n\") self.push_text(\"Content-length: %s\\r\\n\" % size) self.push_text(\"Content-type: %s\\r\\n\" % type) self.push_text(\"\\r\\n\") self.push_with_producer(file_producer(url))\n\nelse:\n\nself.send_error(501,\"%s method not implemented\" % op)\n\nself.close_when_done()\n\nF h Lib f L Bdff\n\nasyncore\n\n455\n\n# Error handling def send_error(self,code,message):\n\nself.push_text(\"HTTP/1.0 %s %s\\r\\n\" % (code, responses[code])) self.push_text(\"Content-type: text/plain\\r\\n\") self.push_text(\"\\r\\n\") self.push_text(message)\n\nclass file_producer(object):\n\ndef __init__(self,filename,buffer_size=512):\n\nself.f = open(filename,\"rb\") self.buffer_size = buffer_size\n\ndef more(self):\n\ndata = self.f.read(self.buffer_size) if not data:\n\nself.f.close()\n\nreturn data\n\na = async_http(8080) asyncore.loop()\n\nTo test this example, you will need to supply a URL corresponding to a file in the same directory as where you are running the server.\n\nasyncore The asyncore module is used to build network applications in which network activity is handled asynchronously as a series of events dispatched by an event loop, built using the select() system call. Such an approach is useful in network programs that want to provide concurrency, but without the use of threads or processes.This method can also provide high performance for short transactions.All the functionality of this module is provided by the dispatcher class, which is a thin wrapper around an ordinary socket object.\n\ndispatcher([sock])\n\nBase class defining an event-driven nonblocking socket object. sockis an existing sock- et object. If omitted, a socket must be created using the create_socket() method (described shortly). Once it’s created, network events are handled by special handler methods. In addition, all open dispatcher objects are saved in an internal list that’s used by a number of polling functions.\n\nThe following methods of the dispatcher class are called to handle network\n\nevents.They should be defined in classes derived from dispatcher.\n\nd.handle_accept()\n\nCalled on listening sockets when a new connection arrives.\n\nd.handle_close()\n\nCalled when the socket is closed.\n\nd.handle_connect()\n\nCalled when a connection is made.\n\nd.handle_error()\n\nCalled when an uncaught Python exception occurs.\n\nF h Lib f L Bdff\n\n456\n\nChapter 21 Network Programming and Sockets\n\nd.handle_expt()\n\nCalled when out-of-band data for a socket is received.\n\nd.handle_read()\n\nCalled when new data is available to be read from a socket.\n\nd.handle_write()\n\nCalled when an attempt to write data is made.\n\nd.readable()\n\nThis function is used by the select() loop to see whether the object is willing to read data. Returns True if so, False if not.This method is called to see if the handle_read() method should be called with new data.\n\nd.writable()\n\nCalled by the select() loop to see if the object wants to write data. Returns True if so, False otherwise.This method is always called to see whether the handle_write() method should be called to produce output.\n\nIn addition to the preceding methods, the following methods are used to perform\n\nlow-level socket operations.They’re similar to those available on a socket object.\n\nd.accept()\n\nAccepts a connection. Returns a pair (client, addr) where clientis a socket object used to send and receive data on the connection and addris the address of the client.\n\nd.bind(address)\n\nBinds the socket to address. addressis typically a tuple (host, port), but this depends the address family being used.\n\nd.close()\n\nCloses the socket.\n\nd.connect(address)\n\nMakes a connection. addressis a tuple (host, port).\n\nd.create_socket(family, type)\n\nCreates a new socket.Arguments are the same as for socket.socket().\n\nd.listen([backlog])\n\nListens for incoming connections. backlogis an integer that is passed to the underlying socket.listen() function.\n\nd.recv(size)\n\nReceives at most sizebytes.An empty string indicates the client has closed the chan- nel.\n\nd.send(data)\n\nSends data. datais a byte string.\n\nF h Lib f L Bdff\n\nasyncore\n\n457\n\nThe following function is used to start the event loop and process events:\n\nloop([timeout [, use_poll [, map [, count]]]])\n\nPolls for events indefinitely.The select() function is used for polling unless the use_pollparameter is True, in which case poll() is used instead. timeoutis the timeout period and is set to 30 seconds by default. mapis a dictionary containing all the channels to monitor. countspecifies how many polling operations to perform before returning. If countis None (the default), loop() polls forever until all channels are closed. If count is 1, the function will execute a single poll for events and return.\n\nExample The following example implements a minimalistic web server using asyncore. It implements two classes—asynhttp for accepting connections and asynclient for processing client requests.This should be compared with the example in the asynchat module.The main difference is that this example is somewhat lower-level—requiring us to worry about breaking the input stream into lines, buffering excess data, and identify- ing the blank line that terminates the request header.\n\n# An asynchronous HTTP server import asyncore, socket import os import mimetypes import collections try:\n\nfrom http.client import responses # Python 3\n\nexcept ImportError:\n\nfrom httplib import responses # Python 2\n\n# This class merely handles accept events class async_http(asyncore.dispatcher):\n\ndef __init__(self,port):\n\nasyncore.dispatcher.__init__(self) self.create_socket(socket.AF_INET,socket.SOCK_STREAM) self.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) self.bind(('',port)) self.listen(5)\n\ndef handle_accept(self):\n\nclient,addr = self.accept() return async_http_handler(client)\n\n# Handle clients class async_http_handler(asyncore.dispatcher):\n\ndef __init__(self, sock = None):\n\nasyncore.dispatcher.__init__(self,sock) self.got_request = False # Read HTTP request? self.request_data = b\"\" self.write_queue = collections.deque() self.responding = False\n\n# Only readable if request header not read def readable(self):\n\nreturn not self.got_request\n\nF h Lib f L Bdff\n\n458\n\nChapter 21 Network Programming and Sockets\n\n# Read incoming request data def handle_read(self):\n\nchunk = self.recv(8192) self.request_data += chunk if b'\\r\\n\\r\\n' in self.request_data:\n\nself.handle_request()\n\n# Handle an incoming request def handle_request(self):\n\nself.got_request = True header_data = self.request_data[:self.request_data.find(b'\\r\\n\\r\\n')] header_text = header_data.decode('latin-1') header_lines = header_text.splitlines() request = header_lines[0].split() op = request[0] url = request[1][1:] self.process_request(op,url)\n\n# Process the request def process_request(self,op,url):\n\nself.responding = True if op == \"GET\":\n\nif not os.path.exists(url):\n\nself.send_error(404,\"File %s not found\\r\\n\" % url)\n\nelse:\n\ntype, encoding = mimetypes.guess_type(url) size = os.path.getsize(url) self.push_text('HTTP/1.0 200 OK\\r\\n') self.push_text('Content-length: %d\\r\\n' % size) self.push_text('Content-type: %s\\r\\n' % type) self.push_text('\\r\\n') self.push(open(url,\"rb\").read())\n\nelse:\n\nself.send_error(501,\"%s method not implemented\" % self.op)\n\n# Error handling def send_error(self,code,message):\n\nself.push_text('HTTP/1.0 %s %s\\r\\n' % (code, responses[code])) self.push_text('Content-type: text/plain\\r\\n') self.push_text('\\r\\n') self.push_text(message)\n\n# Add binary data to the output queue def push(self,data):\n\nself.write_queue.append(data)\n\n# Add text data to the output queue def push_text(self,text):\n\nself.push(text.encode('latin-1'))\n\n# Only writable if a response is ready def writable(self):\n\nreturn self.responding and self.write_queue\n\n# Write response data def handle_write(self):\n\nchunk = self.write_queue.popleft() bytes_sent = self.send(chunk) if bytes_sent != len(chunk):\n\nself.write_queue.appendleft(chunk[bytes_sent:])\n\nif not self.write_queue:\n\nself.close()\n\nF h Lib f L Bdff\n\nselect\n\n459\n\n# Create the server a = async_http(8080) # Poll forever asyncore.loop()\n\nSee Also:\n\nsocket (p. 469), select (p. 459), http (p. 500), SocketServer (p. 489)\n\nselect The select module provides access to the select() and poll() system calls. select() is typically used to implement polling or to multiplex processing across mul- tiple input/output streams without using threads or subprocesses. On UNIX, it works for files, sockets, pipes, and most other file types. On Windows, it only works for sock- ets.\n\nselect(iwtd, owtd, ewtd [, timeout])\n\nQueries the input, output, and exceptional status of a group of file descriptors.The first three arguments are lists containing either integer file descriptors or objects with a method, fileno(), that can be used to return a file descriptor.The iwtdparameter specifies objects waiting for input, owtdspecifies objects waiting for output, and ewtd specifies objects waiting for an exceptional condition. Each list may be empty. timeout is a floating-point number specifying a timeout period in seconds. If timeoutis omit- ted, the function waits until at least one file descriptor is ready. If it’s 0, the function merely performs a poll and returns immediately.The return value is a tuple of lists con- taining the objects that are ready.These are subsets of the first three arguments. If none of the objects is ready before the timeout occurs, three empty lists are returned. If an error occurs, a select.error exception raised. Its value is the same as that returned by IOError and OSError.\n\npoll()\n\nCreates a polling object that utilizes the poll() system call.This is only available on systems that support poll().\n\nA polling object, p, returned by poll() supports the following methods:\n\np.register(fd [, eventmask])\n\nRegisters a new file descriptor, fd. fdis either an integer file descriptor or an object that provides the fileno() method from which the descriptor can be obtained. eventmaskis the bitwise OR of the following flags, which indicate events of interest:\n\nConstant POLLIN\n\nPOLLPRI\n\nPOLLOUT\n\nPOLLERR\n\nDescription Data is available for reading. Urgent data is available for reading. Ready for writing. Error condition.\n\nF h Lib f L Bdff\n\n460\n\nChapter 21 Network Programming and Sockets\n\nConstant POLLHUP\n\nPOLLNVAL\n\nDescription Hang up. Invalid request.\n\nIf eventmaskis omitted, the POLLIN, POLLPRI, and POLLOUT events are checked.\n\np.unregister(fd)\n\nRemoves the file descriptor fdfrom the polling object. Raises KeyError if the file is not registered.\n\np.poll([timeout])\n\nPolls for events on all the registered file descriptors. timeoutis an optional timeout specified in milliseconds. Returns a list of tuples (fd, event), where fdis a file descriptor and eventis a bitmask indicating events.The fields of this bitmask corre- spond to the constants POLLIN, POLLOUT, and so on. For example, to check for the POLLIN event, simply test the value using event & POLLIN. If an empty list is returned, it means a timeout occurred and no events occurred.\n\nAdvanced Module Features The select() and poll() functions are the most generally portable functions defined by this module. On Linux systems, the select module also provides an interface to the edge and level trigger polling (epoll) interface which can offer significantly better per- formance. On BSD systems, access to kernel queue and event objects is provided.These programming interfaces are described in the online documentation for select at http://docs.python.org/library/select.\n\nAdvanced Asynchronous I/O Example The select module is sometimes used to implement servers based on tasklets or coroutines—a technique that can be used to provide concurrent execution without threads or processes.The following advanced example illustrates this concept by imple- menting an I/O-based task scheduler for coroutines. Be forewarned—this is the most advanced example in the book and it will require some study for it to make sense.You might also want to consult my PyCON’09 tutorial “A Curious Course on Coroutines and Concurrency” (http://www.dabeaz.com/coroutines) for additional reference material.\n\nimport select import types import collections\n\nF h Lib f L Bdff",
      "page_number": 462
    },
    {
      "number": 24,
      "title": "Segment 24 (pages 485-507)",
      "start_page": 485,
      "end_page": 507,
      "detection_method": "synthetic",
      "content": "# Object that represents a running task class Task(object):\n\ndef __init__(self,target):\n\nself.target = target # A coroutine self.sendval = None # Value to send when resuming self.stack = [] # Call stack\n\ndef run(self):\n\ntry:\n\nresult = self.target.send(self.sendval) if isinstance(result,SystemCall):\n\nreturn result\n\nif isinstance(result,types.GeneratorType):\n\nself.stack.append(self.target) self.sendval = None self.target = result\n\nelse:\n\nif not self.stack: return self.sendval = result self.target = self.stack.pop()\n\nexcept StopIteration:\n\nif not self.stack: raise self.sendval = None self.target = self.stack.pop()\n\n# Object that represents a \"system call\" class SystemCall(object):\n\ndef handle(self,sched,task):\n\npass\n\n# Scheduler object class Scheduler(object): def __init__(self):\n\nself.task_queue = collections.deque() self.read_waiting = {} self.write_waiting = {} self.numtasks = 0\n\n# Create a new task out of a coroutine def new(self,target):\n\nnewtask = Task(target) self.schedule(newtask) self.numtasks += 1\n\n# Put a task on the task queue def schedule(self,task):\n\nself.task_queue.append(task)\n\n# Have a task wait for data on a file descriptor def readwait(self,task,fd):\n\nself.read_waiting[fd] = task\n\nselect\n\n461\n\nF h Lib f L Bdff\n\n462\n\nChapter 21 Network Programming and Sockets\n\n# Have a task wait for writing on a file descriptor def writewait(self,task,fd):\n\nself.write_waiting[fd] = task\n\n# Main scheduler loop def mainloop(self,count=-1,timeout=None):\n\nwhile self.numtasks:\n\n# Check for I/O events to handle if self.read_waiting or self.write_waiting:\n\nwait = 0 if self.task_queue else timeout r,w,e = select.select(self.read_waiting, self.write_waiting, [],\n\nwait)\n\nfor fileno in r:\n\nself.schedule(self.read_waiting.pop(fileno))\n\nfor fileno in w:\n\nself.schedule(self.write_waiting.pop(fileno))\n\n# Run all of the tasks on the queue that are ready to run while self.task_queue:\n\ntask = self.task_queue.popleft() try:\n\nresult = task.run() if isinstance(result,SystemCall): result.handle(self,task)\n\nelse:\n\nself.schedule(task)\n\nexcept StopIteration:\n\nself.numtasks -= 1\n\n# If no tasks can run, we decide if we wait or return else:\n\nif count > 0: count -= 1 if count == 0: return\n\n# Implementation of different system calls class ReadWait(SystemCall):\n\ndef __init__(self,f):\n\nself.f = f\n\ndef handle(self,sched,task): fileno = self.f.fileno() sched.readwait(task,fileno)\n\nclass WriteWait(SystemCall): def __init__(self,f):\n\nself.f = f\n\ndef handle(self,sched,task): fileno = self.f.fileno() sched.writewait(task,fileno)\n\nclass NewTask(SystemCall):\n\ndef __init__(self,target): self.target = target def handle(self,sched,task):\n\nsched.new(self.target) sched.schedule(task)\n\nThe code in this example implements a very tiny “operating system.” Here are some details concerning its operation:\n\nn All work is carried out by coroutine functions. Recall that a coroutine uses the\n\nyield statement like a generator except that instead of iterating on it, you send it values using a send(value) method.\n\nF h Lib f L Bdff\n\nselect\n\n463\n\nn The Task class represents a running task and is just a thin layer on top of a coroutine.A Task object taskhas only one operation, task.run().This resumes the task and runs it until it hits the next yield statement, at which point the task suspends.When running a task, the task.sendval attribute contains the value that is to be sent into the task’s corresponding yield expression.Tasks run until they encounter the next yield statement.The value produced by this yield controls what happens next in the task:\n\nn If the value is another coroutine (type.GeneratorType), it means that the\n\ntask wants to temporarily transfer control to that coroutine.The stack attribute of Task objects represents a call-stack of coroutines that is built up when this happens.The next time the task runs, control will be transferred into this new coroutine.\n\nn If the value is a SystemCall instance, it means that the task wants the\n\nscheduler to do something on its behalf (such as launch a new task, wait for I/O, and so on).The purpose of this object is described shortly.\n\nn If the value is any other value, one of two things happens. If the currently\n\nexecuting coroutine was running as a subroutine, it is popped from the task call stack and the value saved so that it can be sent to the caller.The caller will receive this value the next time the task executes. If the coroutine is the only executing coroutine, the return value is simply discarded.\n\nn The handling of StopIteration is to deal with coroutines that have termi- nated.When this happens, control is returned to the previous coroutine (if there was one) or the exception is propagated to the scheduler so that it knows that the task terminated.\n\nn The SystemCall class represents a system call in the scheduler.When a running\n\ntask wants the scheduler to carry out an operation on its behalf, it yields a SystemCall instance.This object is called a “system call” because it mimics the behavior of how programs request the services of a real multitasking operating system such as UNIX or Windows. In particular, if a program wants the services of the operating system, it yields control and provides some information back to the system so that it knows what to do. In this respect, yielding a SystemCall is similar to executing a kind of system “trap.”\n\nn The Scheduler class represents a collection of Task objects that are being man- aged.At its core, the scheduler is built around a task queue (the task_queue attribute) that keeps track of tasks that are ready to run.There are four basic operations concerning the task queue. new() takes a new coroutine, wraps it with a Task object, and places it on the work queue. schedule() takes an existing Task and puts it back on the work queue. mainloop() runs the scheduler in a loop, processing tasks one by one until there are no more tasks.The readwait() and writewait() methods put a Task object into temporary staging areas where it will wait for I/O events. In this case, the Task isn’t running, but it’s not dead either—it’s just sitting around biding its time.\n\nn The mainloop() method is the heart of the scheduler.This method first checks to see if any tasks are waiting for I/O events. If so, it arranges a call to select() in order to poll for I/O activity. If there are any events of interest, the associated tasks are placed back onto the task queue so that they can run. Next, the mainloop() method pops tasks off of the task queue and calls their run()\n\nF h Lib f L Bdff\n\n464\n\nChapter 21 Network Programming and Sockets\n\nmethod. If any task exits (StopIteration), it is discarded. If a task merely yields, it is just placed back onto the task queue so that it can run again.This continues until there are either no more tasks or all tasks are blocked, waiting for more I/O events.As an option, the mainloop() function accepts a count parameter that can be used to make it return after a specified number of I/O polling operations. This might be useful if the scheduler is to be integrated into another event loop.\n\nn Perhaps the most subtle aspect of the scheduler is the handling of SystemCall\n\ninstances in the mainloop() method. If a task yields a SystemCall instance, the scheduler invokes its handle() method, passing in the associated Scheduler and Task objects as parameters.The purpose of a system call is to carry out some kind of internal operation concerning tasks or the scheduler itself.The ReadWait(), WriteWait(), and NewTask() classes are examples of system calls that suspend a task for I/O or create a new task. For example, ReadWait() takes a task and invokes the readwait() method on the scheduler.The scheduler then takes the task and places it into an appropriate holding area.Again, there is a criti- cal decoupling of objects going on here.Tasks yield SystemCall objects to request service, but do not directly interact with the scheduler. SystemCall objects, in turn, can perform operations on tasks and schedulers but are not tied to any specific scheduler or task implementation. So, in theory, you could write a completely different scheduler implementation (maybe using threads) that could just be plugged into this whole framework and it would still work.\n\nHere is an example of a simple network time server implemented using this I/O task scheduler. It will illuminate many of the concepts described in the previous list:\n\nfrom socket import socket, AF_INET, SOCK_STREAM def time_server(address):\n\nimport time s = socket(AF_INET,SOCK_STREAM) s.bind(address) s.listen(5) while True:\n\nyield ReadWait(s) conn,addr = s.accept() print(\"Connection from %s\" % str(addr)) yield WriteWait(conn) resp = time.ctime() + \"\\r\\n\" conn.send(resp.encode('latin-1')) conn.close()\n\nsched = Scheduler() sched.new(time_server(('',10000))) # Server on port 10000 sched.new(time_server(('',11000))) # Server on port 11000 sched.run()\n\nIn this example, two different servers are running concurrently—each listening on a dif- ferent port number (use telnet to connect and test).The yield ReadWait() and yield WriteWait() statements cause the coroutine running each server to suspend until I/O is possible on the associated socket.When these statements return, the code immediately proceeds with an I/O operation such as accept() or send().\n\nF h Lib f L Bdff\n\nselect\n\n465\n\nThe use of ReadWait and WriteWait might look rather low-level. Fortunately, our\n\ndesign allows these operations to be hidden behind library functions and methods— provided that they are also coroutines. Consider the following object that wraps a socket object and mimics its interface:\n\nclass CoSocket(object):\n\ndef __init__(self,sock): self.sock = sock\n\ndef close(self):\n\nyield self.sock.close()\n\ndef bind(self,addr):\n\nyield self.sock.bind(addr)\n\ndef listen(self,backlog):\n\nyield self.sock.listen(backlog)\n\ndef connect(self,addr):\n\nyield WriteWait(self.sock) yield self.sock.connect(addr)\n\ndef accept(self):\n\nyield ReadWait(self.sock) conn, addr = self.sock.accept() yield CoSocket(conn), addr\n\ndef send(self,bytes): while bytes:\n\nevt = yield WriteWait(self.sock) nsent = self.sock.send(bytes) bytes = bytes[nsent:]\n\ndef recv(self,maxsize):\n\nyield ReadWait(self.sock) yield self.sock.recv(maxsize)\n\nHere is a reimplementation of the time server using the CoSocket class:\n\nfrom socket import socket, AF_INET, SOCK_STREAM def time_server(address):\n\nimport time s = CoSocket(socket(AF_INET,SOCK_STREAM)) yield s.bind(address) yield s.listen(5) while True:\n\nconn,addr = yield s.accept() print(conn) print(\"Connection from %s\" % str(addr)) resp = time.ctime()+\"\\r\\n\" yield conn.send(resp.encode('latin-1')) yield conn.close()\n\nsched = Scheduler() sched.new(time_server(('',10000))) # Server on port 10000 sched.new(time_server(('',11000))) # Server on port 11000 sched.run()\n\nIn this example, the programming interface of a CoSocket object looks a lot like a nor- mal socket.The only difference is that every operation must be prefaced with yield (since every method is defined as a coroutine).At first, it looks crazy so you might ask what does all of this madness buy you? If you run the above server, you will find that it is able to run concurrently without using threads or subprocesses. Not only that, it has “normal” looking control flow as long as you ignore all of the yield keywords.\n\nF h Lib f L Bdff\n\n466\n\nChapter 21 Network Programming and Sockets\n\nHere is an asynchronous web server that concurrently handles multiple client con- nections, but which does not use callback functions, threads, or processes.This should be compared to examples in the asynchat and asyncore modules.\n\nimport os import mimetypes try:\n\nfrom http.client import responses # Python 3\n\nexcept ImportError:\n\nfrom httplib import responses # Python 2\n\nfrom socket import *\n\ndef http_server(address):\n\ns = CoSocket(socket(AF_INET,SOCK_STREAM)) yield s.bind(address) yield s.listen(50)\n\nwhile True:\n\nconn,addr = yield s.accept() yield NewTask(http_request(conn,addr)) del conn, addr\n\ndef http_request(conn,addr):\n\nrequest = b\"\" while True:\n\ndata = yield conn.recv(8192) request += data if b'\\r\\n\\r\\n' in request: break\n\nheader_data = request[:request.find(b'\\r\\n\\r\\n')] header_text = header_data.decode('latin-1') header_lines = header_text.splitlines() method, url, proto = header_lines[0].split() if method == 'GET':\n\nif os.path.exists(url[1:]):\n\nyield serve_file(conn,url[1:])\n\nelse:\n\nyield error_response(conn,404,\"File %s not found\" % url)\n\nelse:\n\nyield error_response(conn,501,\"%s method not implemented\" % method)\n\nyield conn.close()\n\ndef serve_file(conn,filename):\n\ncontent,encoding = mimetypes.guess_type(filename) yield conn.send(b\"HTTP/1.0 200 OK\\r\\n\") yield conn.send((\"Content-type: %s\\r\\n\" % content).encode('latin-1')) yield conn.send((\"Content-length: %d\\r\\n\" %\n\nos.path.getsize(filename)).encode('latin-1'))\n\nyield conn.send(b\"\\r\\n\") f = open(filename,\"rb\") while True:\n\ndata = f.read(8192) if not data: break yield conn.send(data)\n\ndef error_response(conn,code,message):\n\nyield conn.send((\"HTTP/1.0 %d %s\\r\\n\" %\n\n(code, responses[code])).encode('latin-1'))\n\nyield conn.send(b\"Content-type: text/plain\\r\\n\") yield conn.send(b\"\\r\\n\") yield conn.send(message.encode('latin-1'))\n\nF h Lib f L Bdff\n\nselect\n\n467\n\nsched = Scheduler() sched.new(http_server(('',8080))) sched.mainloop()\n\nCareful study of this example will yield tremendous insight into coroutines and concur- rent programming techniques used by some very advanced third-party modules. However, excessive usage of these techniques might get you fired after your next code review.\n\nWhen to Consider Asynchronous Networking Use of asynchronous I/O (asyncore and asynchat), polling, and coroutines as shown in previous examples remains one of the most mysterious aspects of Python develop- ment.Yet, these techniques are used more often than you might think.An often-cited reason for using asynchronous I/O is to minimize the perceived overhead of program- ming with a large number of threads, especially when managing a large number of clients and in light of restrictions related to the global interpreter lock (refer to Chapter 20,“Threads and Concurrency”).\n\nHistorically, the asyncore module was one of the first library modules to support asynchronous I/O.The asynchat module followed some time later with the aim of simplifying much of the coding. However, both of these modules take the approach of processing I/O as events. For example, when an I/O event occurs, a callback function is triggered.The callback then reacts in response to the I/O event and carries out some processing. If you build a large application in this style, you will find that event handling infects almost every part of the application (e.g., I/O events trigger callbacks, which trigger more callbacks, which trigger other callbacks, ad nauseum). One of the more popular networking packages,Twisted (http://twistedmatrix.com), takes this approach and significantly builds upon it.\n\nCoroutines are more modern but less commonly understood and used since they were only first introduced in Python 2.5.An important feature of coroutines is that you can write programs that look more like threaded programs in their overall control flow. For instance, the web server in the example does not use any callback functions and looks almost identical to what you would write if you were using threads—you just have to become comfortable with the use of the yield statement. Stackless Python (http://www.stackless.com) takes this idea even further.\n\nAs a general rule, you probably should resist the urge to use asynchronous I/O tech-\n\nniques for most network applications. For instance, if you need to write a server that constantly transmits data over hundreds or even thousands of simultaneous network connections, threads will tend to have superior performance.This is because the per- formance of select() degrades significantly as the number of connections it must monitor increases. On Linux, this penalty can be reduced using special functions such as epoll(), but this limits the portability of your code. Perhaps the main benefit of asyn- chronous I/O is in applications where networking needs to be integrated with other event loops (e.g., GUIs) or in applications where networking is added into code that also performs a significant amount of CPU processing. In these cases, the use of asyn- chronous networking may result in quicker response time.\n\nF h Lib f L Bdff\n\n468\n\nChapter 21 Network Programming and Sockets\n\nJust to illustrate, consider the following program that carries out the task described\n\nin the song “10 million bottles of beer on the wall”:\n\nbottles = 10000000\n\ndef drink_beer():\n\nremaining = 12.0 while remaining > 0.0: remaining -= 0.1\n\ndef drink_bottles():\n\nglobal bottles while bottles > 0: drink_beer() bottles -= 1\n\nNow, suppose you wanted to add a remote monitoring capability to this code that allows clients to connect and see how many bottles are remaining. One approach is to launch a server in its own thread and have it run alongside the main application like this:\n\ndef server(port):\n\ns = socket.socket(socket.AF_INET,socket.SOCK_STREAM) s.bind(('',port)) s.listen(5) while True:\n\nclient,addr = s.accept() client.send((\"%d bottles\\r\\n\" % bottles).encode('latin-1') client.close()\n\n# Launch the monitor server thr = threading.Thread(target=server,args=(10000,)) thr.daemon=True thr.start() drink_bottles()\n\nThe other approach is to write a server based on I/O polling and embed a polling operation directly into the main computation loop. Here is an example that uses the coroutine scheduler developed earlier:\n\ndef drink_bottles():\n\nglobal bottles while bottles > 0: drink_beer() bottles -= 1 scheduler.mainloop(count=1,timeout=0) # Poll for connections\n\n# An asynchronous server based on coroutines. def server(port):\n\ns = CoSocket(socket.socket(socket.AF_INET,socket.SOCK_STREAM)) yield s.bind(('',port)) yield s.listen(5) while True:\n\nclient,addr = yield s.accept() yield client.send((\"%d bottles\\r\\n\" % bottles).encode('latin-1') yield client.close()\n\nscheduler = Scheduler() scheduler.new(server(10000)) drink_bottles()\n\nIf you write a separate program that periodically connects to the bottles of beer pro- gram and measures the response time required to receive a status message, the results are\n\nF h Lib f L Bdff\n\nsocket\n\n469\n\nsurprising. On the author’s machine (a dual-core 2 GHZ MacBook), the average response time (measured over 1,000 requests) for the coroutine-based server is about 1ms versus 5ms for threads.This difference is explained by the fact that the coroutine- based code is able to respond as soon as it detects a connection whereas the threaded server doesn’t get to run until it is scheduled by the operating system. In the presence of a CPU-bound thread and the Python global interpreter lock, the server may be delayed until the CPU-bound thread exceeds its allotted time slice. On many systems, the time slice is about 10ms so the above rough measurement of thread response time is exactly the average time you might expect to wait for a CPU-bound task to be preempted by the operating system.\n\nThe downside to polling is that it introduces significant overhead if it occurs too often. For instance, even though the response time is lower in this example, the program instrumented with polling takes more than 50% longer to run to completion. If you change the code to only poll after every six-pack of beer, the response time increases slightly to 1.2ms whereas the run time of the program is only 3% greater than the pro- gram without any polling. Unfortunately, there is often no clear-cut way to know how often to poll other than to make measurements of your application.\n\nEven though this improved response time might look like a win, there are still horri- ble problems associated with trying to implement your own concurrency. For example, tasks need to be especially careful when performing any kind of blocking operation. In the web server example, there is a fragment of code that opens and reads data from a file.When this operation occurs, the entire program will be frozen—potentially for a long period of time if the file access involves a disk seek.The only way to fix this would be to additionally implement asynchronous file access and add it as a feature to the scheduler. For more complicated operations such as performing a database query, figur- ing out how to carry out the work in an asynchronous manner becomes rather com- plex. One way to do it would be to carry out the work in a separate thread and to communicate the results back to the task scheduler when available—something that could be carried out with careful use of message queues. On some systems, there are low-level system calls for asynchronous I/O (such as the aio_* family of functions on UNIX).As of this writing, the Python library provides no access to those functions, although you can probably find bindings through third-party modules. In the author’s experience, using such functionality is a lot trickier than it looks and is not really worth the added complexity that gets introduced into your program—you’re often better off letting the thread library deal with such matters.\n\nsocket The socket module provides access to the standard BSD socket interface.Although it’s based on UNIX, this module is available on all platforms.The socket interface is designed to be generic and is capable of supporting a wide variety of networking pro- tocols (Internet,TIPC, Bluetooth, and so on). However, the most common protocol is the Internet Protocol (IP), which includes both TCP and UDP. Python supports both IPv4 and IPv6, although IPv4 is far more common.\n\nIt should be noted that this module is relatively low-level, providing direct access to the network functions provided by the operating system. If you are writing a network application, it may be easier to use the modules described in Chapter 22 or the SocketServer module described at the end of this chapter.\n\nF h Lib f L Bdff\n\n470\n\nChapter 21 Network Programming and Sockets\n\nAddress Families Some of the socket functions require the specification of an address family.The family specifies the network protocol being used.The following constants are defined for this purpose:\n\nConstant AF_BLUETOOTH\n\nAF_INET\n\nAF_INET6\n\nAF_NETLINK AF_PACKET\n\nAF_TIPC\n\nDescription Bluetooth protocol IPv4 protocols (TCP, UDP) IPv6 protocols (TCP, UDP) Netlink Interprocess Communication Link-level packets Transparent Inter-Process Communication protocol UNIX domain protocols\n\nAF_UNIX\n\nOf these, AF_INET and AF_INET6 are the most commonly used because they represent standard Internet connections. AF_BLUETOOTH is only available on systems that support it (typically embedded systems). AF_NETLINK, AF_PACKET, and AF_TIPC are only sup- ported on Linux. AF_NETLINK is used for fast interprocess communication between user applications and the Linux kernel. AF_PACKET is used for working directly at the data- link layer (e.g., raw ethernet packets). AF_TIPC is a protocol used for high-performance IPC on Linux clusters (http://tipc.sourceforge.net/).\n\nSocket Types Some socket functions also require the specification of a socket type.The socket type specifies the type of communications (streams or packets) to be used within a given protocol family.The following constants are used for this purpose:\n\nConstant SOCK_STREAM\n\nSOCK_DGRAM\n\nSOCK_RAW\n\nSOCK_RDM\n\nSOCK_SEQPACKET\n\nDescription A reliable connection-oriented byte stream (TCP) Datagrams (UDP) Raw socket Reliable datagrams Sequenced connection-mode transfer of records\n\nThe most common socket types are SOCK_STREAM and SOCK_DGRAM because they cor- respond to TCP and UDP in the Internet Protocol suite. SOCK_RDM is a reliable form of UDP that guarantees the delivery of a datagram but doesn’t preserve ordering (data- grams might be received in a different order than sent). SOCK_SEQPACKET is used to send packets through a stream-oriented connection in a manner that preserves their order and packet boundaries. Neither SOCK_RDM or SOCK_SEQPACKET are widely sup- ported, so it’s best not to use them if you care about portability. SOCK_RAW is used to provide low-level access to the raw protocol and is used if you want to carry out special-purpose operations such as sending control messages (e.g., ICMP messages). Use of SOCK_RAW is usually restricted to programs running with superuser or administrator access.\n\nF h Lib f L Bdff\n\nsocket\n\n471\n\nNot every socket type is supported by every protocol family. For example, if you’re\n\nusing AF_PACKET to sniff ethernet packets on Linux, you can’t establish a stream- oriented connection using SOCK_STREAM. Instead, you have to use SOCK_DGRAM or SOCK_RAW. For AF_NETLINK sockets, SOCK_RAW is the only supported type.\n\nAddressing In order to perform any communication on a socket, you have to specify a destination address.The form of the address depends on the address family of the socket.\n\nAF_INET (IPv4) For Internet applications using IPv4, addresses are specified as a tuple (host, port). Here are two examples:\n\n('www.python.org', 80) ('66.113.130.182', 25)\n\nIf hostis the empty string, it has the same meaning as INADDR_ANY, which means any address.This is typically used by servers when creating sockets that any client can con- nect to. If hostis set to '<broadcast>', it has the same meaning as the INADDR_BROADCAST constant in the socket API.\n\nBe aware that when host names such as 'www.python.org' are used, Python uses DNS to resolve the host name into an IP address. Depending on how DNS has been configured, you may get a different IP address each time. Use a raw IP address such as '66.113.130.182' to avoid this behavior, if needed.\n\nAF_INET6 (IPv6) For IPv6, addresses are specified as a 4-tuple (host, port, flowinfo, scopeid). With IPv6, the hostand portcomponents work in the same way as IPv4, except that the numerical form of an IPv6 host address is typically specified by a string of eight colon-separated hexadecimal numbers, such as 'FEDC:BA98:7654:3210:FEDC:BA98:7654:3210' or '080A::4:1' (in this case, the double colon fills in a range of address components with 0s).\n\nThe flowinfoparameter is a 32-bit number consisting of a 24-bit flow label (the low 24 bits), a 4-bit priority (the next 4 bits), and four reserved bits (the high 4 bits).A flow label is typically only used when a sender wants to enable special handling by routers. Otherwise, flowinfois set to 0.\n\nThe scopeidparameter is a 32-bit number that’s only needed when working with\n\nlink-local and site-local addresses.A link-local address always starts with the prefix 'FE80:...' and is used between machines on the same LAN (routers will not forward link-local packets). In this case, scopeidan interface index that identifies a specific net- work interface on the host.This information can be viewed using a command such as 'ifconfig' on UNIX or 'ipv6 if' on Windows.A site-local address always starts with the prefix 'FEC0:...' and is used between machines within the same site (for example, all machines on a given subnet). In this case, scopeidis a site-identifier num- ber.\n\nIf no data is given for flowinfoor scopeid, an IPv6 address can be given as the\n\ntuple (host, port), as with IPv4.\n\nF h Lib f L Bdff\n\n472\n\nChapter 21 Network Programming and Sockets\n\nAF_UNIX For UNIX domain sockets, the address is a string containing a path name—for example, '/tmp/myserver'.\n\nAF_PACKET For the Linux packet protocol, the address is a tuple (device, protonum [, pkttype [, hatype [, addr]]]) where deviceis a string specifying the device name such as \"eth0\" and protonumis an integer specifying the ethernet protocol number as defined in the <linux/if_ether.h> header file (e.g., 0x0800 for an IP packet). packet_typeis an integer specifying the packet type and is one of the following constants:\n\nConstant PACKET_HOST\n\nPACKET_BROADCAST\n\nPACKET_MULTICAST\n\nPACKET_OTHERHOST\n\nPACKET_OUTGOING\n\nDescription Packet address to the local host. Physical layer broadcast packet. Physical layer multicast. Packet destined for a different host, but caught by a device driver in promiscuous mode. Packet originating on the machine, but which has looped back to a packet socket.\n\nhatypeis an integer specifying the hardware address type as used in the ARP protocol and defined in the <linux/if_arp.h> header file. addris a byte string containing a hardware address, the structure of which depends on the value of hatype. For ethernet, addrwill be a 6-byte string holding the hardware address.\n\nAF_NETLINK For the Linux Netlink protocol, the address is a tuple (pid, groups) where pidand groupsare both unsigned integers. pidis the unicast address of the socket and is usually the same as the process ID of the process that created the socket or 0 for the kernel. groupsis a bit mask used to specify multicast groups to join. Refer to the Netlink doc- umentation for more information.\n\nAF_BLUETOOTH Bluetooth addresses depend on the protocol being used. For L2CAP, the address is a tuple (addr, psm) where addris a string such as '01:23:45:67:89:ab' and psmis an unsigned integer. For RFCOMM, the address is a tuple (addr, channel) where addris an address string and channelis an integer. For HCI, the address is a 1-tuple (deviceno,) where devicenois an integer device number. For SCO, the address is a string host.\n\nThe constant BDADDR_ANY represents any address and is a string '00:00:00:00:00:00'.\n\nThe constant BDADDR_LOCAL is a string '00:00:00:ff:ff:ff'.\n\nAF_TIPC For TIPC sockets, the address is a tuple (addr_type, v1, v2, v3 [, scope]) where all fields are unsigned integers. addr_typeis one of the following values, which also determines the values of v1, v2, and v3:\n\nF h Lib f L Bdff\n\nsocket\n\n473\n\nAddress Type TIPC_ADDR_NAMESEQ\n\nTIPC_ADDR_NAME\n\nTIPC_ADDR_ID\n\nDescription v1is the server type, v2is the port identifier, and v3is 0. v1is the server type, v2is the lower port number, and v3is the upper port number. v1is the node, v2is the reference, and v3is 0.\n\nThe optional scopefield is one of TIPC_ZONE_SCOPE, TIPC_CLUSTER_SCOPE, or TIPC_NODE_SCOPE.\n\nFunctions The socket module defines the following functions:\n\ncreate_connection(address [, timeout])\n\nEstablishes a SOCK_STREAM connection to addressand returns an already connected socket object. addressis tuple of the form (host, port), and timeoutspecifies an optional timeout.This function works by first calling getaddrinfo() and then trying to connect to each of the tuples that gets returned.\n\nfromfd(fd, family, socktype [, proto])\n\nCreates a socket object from an integer file descriptor, fd.The address family, socket type, and protocol number are the same as for socket().The file descriptor must refer to a previously created socket. It returns an instance of SocketType.\n\ngetaddrinfo(host, port [,family [, socktype [, proto [, flags]]]])\n\nGiven hostand portinformation about a host, this function returns a list of tuples containing information needed to open up a socket connection. hostis a string con- taining a host name or numerical IP address. portis a number or a string representing a service name (for example, \"http\", \"ftp\", \"smtp\"). Each returned tuple consists of five elements (family, socktype, proto, canonname, sockaddr).The family, socktype, and protoitems have the same values as would be passed to the socket() function. canonnameis a string representing the canonical name of the host. sockaddr is a tuple containing a socket address as described in the earlier section on Internet addresses. Here’s an example:\n\n>>> getaddrinfo(\"www.python.org\",80) [(2,2,17,'',('194.109.137.226',80)), (2,1,6,'',('194.109.137.226'),80))]\n\nIn this example, getaddrinfo() has returned information about two possible socket connections.The first one (proto=17) is a UDP connection, and the second one (proto=6) is a TCP connection.The additional parameters to getaddrinfo() can be used to narrow the selection. For instance, this example returns information about establishing an IPv4 TCP connection:\n\n>>> getaddrinfo(\"www.python.org\",80,AF_INET,SOCK_STREAM) [(2,1,6,'',('194.109.137.226',80))]\n\nF h Lib f L Bdff\n\n474\n\nChapter 21 Network Programming and Sockets\n\nThe special constant AF_UNSPEC can be used for the address family to look for any kind of connection. For example, this code gets information about any TCP-like connection and may return information for either IPv4 or IPv6:\n\n>>> getaddrinfo(\"www.python.org\",\"http\", AF_UNSPEC, SOCK_STREAM) [(2,1,6,'',('194.109.137.226',80))]\n\ngetaddrinfo() is intended for a very generic purpose and is applicable to all support- ed network protocols (IPv4, IPv6, and so on). Use it if you are concerned about com- patibility and supporting future protocols, especially if you intend to support IPv6.\n\ngetdefaulttimeout()\n\nReturns the default socket timeout in seconds.A value of None indicates that no time- out has been set.\n\ngetfqdn([name])\n\nReturns the fully qualified domain name of name. If nameis omitted, the local machine is assumed. For example, getfqdn(\"foo\") might return \"foo.quasievil.org\".\n\ngethostbyname(hostname)\n\nTranslates a host name such as 'www.python.org' to an IPv4 address.The IP address is returned as a string, such as '132.151.1.90'. It does not support IPv6.\n\ngethostbyname_ex(hostname)\n\nTranslates a host name to an IPv4 address but returns a tuple (hostname, aliaslist, ipaddrlist) in which hostnameis the primary host name, aliaslistis a list of alternative host names for the same address, and ipaddrlistis a list of IPv4 address- es for the same interface on the same host. For example, gethostbyname_ex('www.python.org') returns something like ('fang.python.org', ['www.python.org'], ['194.109.137.226']).This func- tion does not support IPv6.\n\ngethostname()\n\nReturns the host name of the local machine.\n\ngethostbyaddr(ip_address)\n\nReturns the same information as gethostbyname_ex(), given an IP address such as '132.151.1.90'. If ip_addressis an IPv6 address such as 'FEDC:BA98:7654:3210:FEDC:BA98:7654:3210', information regarding IPv6 will be returned.\n\ngetnameinfo(address, flags)\n\nGiven a socket address, address, this function translates the address into a 2-tuple (host, port), depending on the value of flags.The addressparameter is a tuple specifying an address—for example, ('www.python.org',80). flagsis the bitwise OR of the following constants:\n\nF h Lib f L Bdff\n\nsocket\n\n475\n\nConstant NI_NOFQDN\n\nNI_NUMERICHOST\n\nNI_NAMEREQD\n\nNI_NUMERICSERV\n\nNI_DGRAM\n\nDescription Don’t use fully qualified name for local hosts. Returns the address in numeric form. Requires a host name. Returns an error if addresshas no DNS entry. The returned portis returned as a string containing a port num- ber. Specifies that the service being looked up is a datagram service (UDP) instead of TCP (the default).\n\nThe main purpose of this function is to get additional information about an address. Here’s an example:\n\n>>> getnameinfo(('194.109.137.226',80),0) ('fang.python.org', 'http') >>> getnameinfo(('194.109.137.226',80),NI_NUMERICSERV) ('fang.python.org','80')\n\ngetprotobyname(protocolname)\n\nTranslates an Internet protocol name (such as 'icmp') to a protocol number (such as the value of IPPROTO_ICMP) that can be passed to the third argument of the socket() function. Raises socket.error if the protocol name isn’t recognized. Normally, this is only used with raw sockets.\n\ngetservbyname(servicename [, protocolname])\n\nTranslates an Internet service name and protocol name to a port number for that serv- ice. For example, getservbyname('ftp', 'tcp') returns 21.The protocol name, if supplied, should be 'tcp' or 'udp’. Raises socket.error if servicenamedoesn’t match any known service.\n\ngetservbyport(port [, protocolname])\n\nThis is the opposite of getservbyname(). Given a numeric port number, port, this function returns a string giving the service name, if any. For example, getservbyport(21, 'tcp') returns 'ftp'.The protocol name, if supplied, should be 'tcp' or 'udp'. Raises socket.error if no service name is available for port.\n\nhas_ipv6\n\nBoolean constant that is True if IPv6 support is available.\n\nhtonl(x)\n\nConverts 32-bit integers from host to network byte order (big-endian).\n\nhtons(x)\n\nConverts 16-bit integers from host to network byte order (big-endian).\n\ninet_aton(ip_string)\n\nConverts an IPv4 address provided as a string (for example, '135.128.11.209') to a 32-bit packed binary format for use as the raw-encoding of the address.The returned\n\nF h Lib f L Bdff\n\n476\n\nChapter 21 Network Programming and Sockets\n\nvalue is a four-character string containing the binary encoding.This may be useful if passing the address to C or if the address must be packed into a data structure passed to other programs. Does not support IPv6.\n\ninet_ntoa(packedip)\n\nConverts a binary-packaged IPv4 address into a string that uses the standard dotted rep- resentation (for example, '135.128.11.209'). packedipis a four-character string con- taining the raw 32-bit encoding of an IP address.The function may be useful if an address has been received from C or is being unpacked from a data structure. It does not support IPv6.\n\ninet_ntop(address_family, packed_ip)\n\nConverts a packed binary string packed_iprepresenting an IP network address into a string such as '123.45.67.89'. address_familyis the address family and is usually AF_INET or AF_INET6.This can be used to obtain a network address string from a buffer of raw bytes (for instance, from the contents of a low-level network packet).\n\ninet_pton(address_family, ip_string)\n\nConverts an IP address such as '123.45.67.89' into a packed byte string. address_familyis the address family and is usually AF_INET or AF_INET6.This can be used if you’re trying to encode a network address into a raw binary data packet.\n\nntohl(x)\n\nConverts 32-bit integers from network (big-endian) to host byte order.\n\nntohs(x)\n\nConverts 16-bit integers from network (big-endian) to host byte order.\n\nsetdefaulttimeout(timeout)\n\nSets the default timeout for newly created socket objects. timeoutis a floating-point number specified in seconds.A value of None may be supplied to indicate no timeout (this is the default).\n\nsocket(family, type [, proto])\n\nCreates a new socket using the given address family, socket type, and protocol number. familyis the address family and typeis the socket type as discussed in the first part of this section.To open a TCP connection, use socket(AF_INET, SOCK_STREAM).To open a UDP connection, use socket(AF_INET, SOCK_DGRAM).The function returns an instance of SocketType (described shortly).\n\nThe protocol number is usually omitted (and defaults to 0).This is typically only used with raw sockets (SOCK_RAW) and is set to a constant that depends on the address family being used.The following list shows all of the protocol numbers that Python may define for AF_INET and AF_INET6, depending on their availability on the host system:\n\nConstant IPPROTO_AH\n\nIPPROTO_BIP\n\nIPPROTO_DSTOPTS\n\nIPPROTO_EGP\n\nDescription IPv6 authentication header Banyan VINES IPv6 destination options Exterior gateway protocol\n\nF h Lib f L Bdff\n\nsocket\n\n477\n\nConstant IPPROTO_EON\n\nIPPROTO_ESP\n\nIPPROTO_FRAGMENT\n\nIPPROTO_GGP\n\nIPPROTO_GRE\n\nIPPROTO_HELLO\n\nIPPROTO_HOPOPTS\n\nIPPROTO_ICMP\n\nIPPROTO_ICMPV6\n\nIPPROTO_IDP\n\nIPPROTO_IGMP\n\nIPPROTO_IP\n\nIPPROTO_IPCOMP\n\nIPPROTO_IPIP\n\nIPPROTO_IPV4\n\nIPPROTO_IPV6\n\nIPPROTO_MOBILE\n\nIPPROTO_ND\n\nIPPROTO_NONE\n\nIPPROTO_PIM\n\nIPPROTO_PUP\n\nIPPROTO_RAW\n\nIPPROTO_ROUTING\n\nIPPROTO_RSVP\n\nIPPROTO_TCP\n\nIPPROTO_TP\n\nDescription ISO CNLP (Connectionless Network Protocol) IPv6 encapsulating security payload IPv6 fragmentation header Gateway to Gateway Protocol (RFC823) Generic Routing Encapsulation (RFC1701) Fuzzball HELLO protocol IPv6 hop-by-hop options IPv4 ICMP IPv6 ICMP XNS IDP Group management protocol IPv4 IP Payload compression protocol IP inside IP IPv4 header IPv6 header IP Mobility Netdisk protocol IPv6 no next header Protocol Independent Multicast Xerox PARC Universal Packet (PUP) Raw IP packet IPv6 routing header Resource reservation TCP OSI Transport Protocol (TP-4) UDP Virtual Router Redundancy Protocol eXpress Transfer Protocol\n\nIPPROTO_UDP\n\nIPPROTO_VRRP\n\nIPPROTO_XTP\n\nThe following protocol numbers are used with AF_BLUETOOTH:\n\nConstant BTPROTO_L2CAP\n\nBTPROTO_HCI\n\nBTPROTO_RFCOMM\n\nBTPROTO_SCO\n\nDescription Logical Link Control and Adaption Protocol Host/Controller Interface Cable replacement protocol Synchronous Connection Oriented Link\n\nsocketpair([family [, type [, proto ]]])\n\nCreates a pair of connected socket objects using the given family, type, and proto options, which have the same meaning as for the socket() function.This function only applies to UNIX domain sockets (family=AF_UNIX). typemay be either SOCK_DGRAM or SOCK_STREAM. If typeis SOCK_STREAM, an object known as a stream pipe is created. protois usually 0 (the default).The primary use of this function would\n\nF h Lib f L Bdff\n\n478\n\nChapter 21 Network Programming and Sockets\n\nbe to set up interprocess communication between processes created by os.fork(). For example, the parent process would call socketpair() to create a pair of sockets and call os.fork().The parent and child processes would then communicate with each other using these sockets.\n\nSockets are represented by an instance of type SocketType.The following methods\n\nare available on a socket, s:\n\ns.accept()\n\nAccepts a connection and returns a pair (conn, address), where connis a new socket object that can be used to send and receive data on the connection and addressis the address of the socket on the other end of the connection.\n\ns.bind(address)\n\nBinds the socket to an address.The format of addressdepends on the address family. In most cases, it’s a tuple of the form (hostname, port). For IP addresses, the empty string represents INADDR_ANY and the string '<broadcast>' represents INADDR_BROADCAST.The INADDR_ANY host name (the empty string) is used to indicate that the server allows connections on any Internet interface on the system.This is often used when a server is multihomed.The INADDR_BROADCAST host name ('<broadcast>') is used when a socket is being used to send a broadcast message.\n\ns.close()\n\nCloses the socket. Sockets are also closed when they’re garbage-collected.\n\ns.connect(address)\n\nConnects to a remote socket at address.The format of addressdepends on the address family, but it’s normally a tuple (hostname, port). It raises socket.error if an error occurs. If you’re connecting to a server on the same computer, you can use the name 'localhost' as hostname.\n\ns.connect_ex(address)\n\nLike connect(address), but returns 0 on success or the value of errno on failure.\n\ns.fileno()\n\nReturns the socket’s file descriptor.\n\ns.getpeername()\n\nReturns the remote address to which the socket is connected. Usually the return value is a tuple (ipaddr, port), but this depends on the address family being used.This is not supported on all systems.\n\ns.getsockname()\n\nReturns the socket’s own address. Usually this is a tuple (ipaddr, port).\n\ns.getsockopt(level, optname [, buflen])\n\nReturns the value of a socket option. leveldefines the level of the option and is SOL_SOCKET for socket-level options or a protocol number such as IPPROTO_IP for protocol-related options. optnameselects a specific option. If buflenis omitted, an integer option is assumed and its integer value is returned. If buflenis given, it speci- fies the maximum length of the buffer used to receive the option.This buffer is\n\nF h Lib f L Bdff\n\nsocket\n\n479\n\nreturned as a byte string, where it’s up to the caller to decode its contents using the struct module or other means.\n\nThe following tables list the socket options defined by Python. Most of these options\n\nare considered part of the Advanced Sockets API and control low-level details of the network.You will need to consult other documentation to find more detailed descrip- tions.When type names are listed in the value column, that name is same as the standard C data structure associated with the value and used in the standard socket programming interface. Not all options are available on all machines.\n\nThe following are commonly used option names for level SOL_SOCKET:\n\nOption Name SO_ACCEPTCONN\n\nSO_BROADCAST\n\nSO_DEBUG\n\nSO_DONTROUTE\n\nSO_ERROR\n\nSO_EXCLUSIVEADDRUSE\n\nSO_KEEPALIVE\n\nSO_LINGER\n\nSO_OOBINLINE\n\nSO_RCVBUF\n\nValue 0, 1\n\n0, 1\n\n0, 1\n\n0, 1\n\nint\n\n0,1\n\n0, 1\n\nlinger\n\n0, 1\n\nint\n\nDescription Determines whether or not the socket is accept- ing connections. Allows sending of broadcast datagrams. Determines whether or not debugging informa- tion is being recorded. Bypasses routing table lookups. Gets error status. Prevents other sockets from being forcibly bound to the same address and port. This disables the SO_REUSEADDR option. Periodically probes the other end of the connec- tion and terminates if it’s half-open. Lingers on close() if the send buffer contains data. linger is a packed binary string contain- ing two 32-bit integers (onoff, seconds). Places out-of-band data into the input queue. Size of receive buffer (in bytes). Number of bytes read before select() returns the socket as readable.\n\nSO_RCVLOWAT\n\nint\n\nSO_RCVTIMEO\n\ntimeval Timeout on receive calls in seconds. timeval is\n\nSO_REUSEADDR\n\nSO_REUSEPORT\n\nSO_SNDBUF\n\nSO_SNDLOWAT\n\n0, 1\n\n0, 1\n\nint\n\nint\n\na packed binary string containing two 32-bit unsigned integers (seconds, microseconds). Allows local address reuse. Allows multiple processes to bind to the same address as long as this socket option is set in all processes. Size of send buffer (in bytes). Number of bytes available in send buffer before select() returns the socket as writable.\n\nSO_SNDTIMEO\n\ntimeval Timeout on send calls in seconds. See\n\nSO_TYPE\n\nSO_USELOOPBACK\n\nint\n\n0, 1\n\nSO_RCVTIMEO for a description of timeval. Gets socket type. Routing socket gets copy of what it sends.\n\nF h Lib f L Bdff\n\n480\n\nChapter 21 Network Programming and Sockets\n\nThe following options are available for level IPPROTO_IP:\n\nOption Name IP_ADD_MEMBERSHIP\n\nIP_DROP_MEMBERSHIP\n\nIP_HDRINCL\n\nIP_MAX_MEMBERSHIPS IP_MULTICAST_IF\n\nIP_MULTICAST_LOOP\n\nIP_MULTICAST_TTL\n\nIP_OPTIONS\n\nIP_RECVDSTADDR\n\nIP_RECVOPTS\n\nIP_RECVRETOPTS\n\nIP_RETOPTS\n\nValue ip_mreg\n\nip_mreg\n\nint\n\nint in_addr\n\n0,1\n\nuint8\n\nipopts\n\n0,1\n\n0,1\n\n0,1\n\n0,1\n\nDescription Join a multicast group (set only). ip_mreg is a packed binary string containing two 32- bit IP addresses (multiaddr, localaddr), where multiaddris the multicast address and localaddris the IP of the local interface being used. Leave a multicast group (set only). ip_mreg is described above. IP header included with data. Maximum number of multicast groups. Outgoing interface. in_addr is a packed binary string containing a 32-bit IP address. Loopback. Time to live. uint8 is a packed binary string containing a 1-byte unsigned char. IP header options. ipoptsis a packed binary string of no more than 44 bytes. The contents of this string are described in RFC 791. Receive IP destination address with data- gram. Receive all IP options with datagram. Receive IP options with response. Same as IP_RECVOPTS, leaves the options unprocessed with no timestamp or route record options filled in. Type of service. Time to live.\n\nIP_TOS\n\nint\n\nIP_TTL\n\nint\n\nThe following options are available for level IPPROTO_IPV6:\n\nOption Name IPV6_CHECKSUM\n\nIPV6_DONTFRAG\n\nIPV6_DSTOPTS\n\nIPV6_HOPLIMIT\n\nIPV6_HOPOPTS\n\nValue 0,1\n\n0,1\n\nip6_dest\n\nint\n\nip6_hbh\n\nDescription Have system compute checksum. Don’t fragment packets if they exceed the MTU size. Destination options. ip6_destis a packed binary string of the form (next, len, options) where nextis an 8-bit integer giving the option type of the next header; lenis an 8-bit integer specifying the length of the header in units of 8 bytes, not includ- ing the first 8 bytes; and optionsis the encoded options. Hop limit. Hop-by-hop options. ip6_hbhhas the same encoding as ip6_dest.\n\nF h Lib f L Bdff\n\nsocket\n\n481\n\nOption Name IPV6_JOIN_GROUP\n\nValue ip6_mreq\n\nIPV6_LEAVE_GROUP\n\nip6_mreq\n\nIPV6_MULTICAST_HOPS int\n\nIPV6_MULTICAST_IF\n\nint\n\nIPV6_MULTICAST_LOOP 0,1\n\nDescription Join multicast group. ip6_mreqis a packed binary string containing (multiaddr, index) where multiaddr is a 128-bit IPv6 multicast address and indexis a 32-bit unsigned integer inter- face index for the local interface. Leave multicast group. Hop-limit for multicast packets. Interface index for outgoing multicast pack- ets. Deliver outgoing multicast packets back to local application.\n\nIPV6_NEXTHOP\n\nsockaddr_in6 Set the next hop address for outgoing pack-\n\nets. sockaddr_in6is a packed binary string containing the C sockaddr_in6 structure as typically defined in <netinet/in.h>.\n\nIPV6_PKTINFO\n\nip6_pktinfo Packet information structure.\n\nIPV6_RECVDSTOPTS\n\nIPV6_RECVHOPLIMIT\n\nIPV6_RECVHOPOPTS\n\nIPV6_RECVPKTINFO\n\nIPV6_RECVRTHDR\n\nIPV6_RECVTCLASS\n\nIPV6_RTHDR\n\nIPV6_RTHDRDSTOPTS\n\nIPV6_RECVPATHMTU\n\nIPV6_TCLASS\n\nIPV6_UNICAST_HOPS\n\nIPV6_USE_MIN_MTU\n\n0,1\n\n0,1\n\n0,1\n\n0,1\n\n0,1\n\n0,1\n\nip6_rthdr\n\nip6_dest\n\n0,1\n\nint int\n\n1,0,1\n\nip6_pktinfois a packed binary string containing (addr, index) where addris a 128-bit IPv6 address and indexis a 32- bit unsigned integer with the interface index. Receive destination options. Receive the hop limit. Receive hop-by-hop options. Receive packet information. Receive routing header. Receive the traffic class. Routing header. ip6_rthdris a packed binary string containing (next, len, type, segleft, data) where next, len, type, and segleftare all 8-bit unsigned integers and datais routing data. See RFC 2460. Destination options header before the rout- ing options header. Enable the receipt of IPV6_PATHMTU ancil- lary data items. Traffic class. Hop limit for unicast packets. Path MTU discovery. 1 disables it for all desinations. -1 disables it only for multicast destinations. Only connect to other IPV6 nodes.\n\nIPV6_V6ONLY\n\n0,1\n\nF h Lib f L Bdff\n\n482\n\nChapter 21 Network Programming and Sockets\n\nThe following options are available for level SOL_TCP:\n\nOption Name TCP_CORK\n\nTCP_DEFER_ACCEPT\n\nTCP_INFO\n\nTCP_KEEPCNT\n\nTCP_KEEPIDLE\n\nTCP_KEEPINTVL\n\nTCP_LINGER2\n\nTCP_MAXSEG\n\nTCP_NODELAY\n\nTCP_QUICKACK\n\nTCP_SYNCNT\n\nValue 0,1\n\n0,1\n\ntcp_info\n\nint\n\nint\n\nint\n\nint\n\nint\n\n0,1\n\n0,1\n\nint\n\nDescription Don’t send out partial frames if set. Awake listener only when data arrives on socket. Returns a structure containing information about the socket. tcp_infois implemen- tation specific. Maximum number of keepalive probes TCP should send before dropping a connection. Time in seconds the connection should be idle before TCP starts sending keepalive probes if the TCP_KEEPALIVE option has been set. Time in seconds between keepalive probes. Lifetime of orphaned FIN_WAIT2 state sockets. Maximum segment size for outgoing TCP packets. If set, disables the Nagle algorithm. If set, ACKs are sent immediately. Disables the TCP delayed ACK algorithm. Number of SYN retransmits before aborting a connection request. Sets an upper bound on the advertised TCP window size.\n\nTCP_WINDOW_CLAMP\n\nint\n\ns.gettimeout()\n\nReturns the current timeout value if any. Returns a floating-point number in seconds or None if no timeout is set.\n\ns.ioctl(control, option)\n\nProvides limited access to the WSAIoctl interface on Windows.The only supported value for controlis SIO_RCVALL which is used to capture all received IP packets on the network.This requires Administrator access.The following values can be used for options:\n\nOption RCVALL_OFF\n\nRCVALL_ON\n\nRCVALL_IPLEVEL\n\nDescription Prevent the socket from receiving all IPv4 or IPv6 packets. Enable promiscuous mode, allowing the socket to receive all IPv4 or IPv6 packets on the network. The type of packet received depends on the socket address family. This does not capture packets associated with other network protocols such as ARP. Receive all IP packets received on the network, but do not enable promiscuous mode. This will capture all IP packets directed at the host for any configured IP address.\n\nF h Lib f L Bdff\n\nsocket\n\n483\n\ns.listen(backlog)\n\nStarts listening for incoming connections. backlogspecifies the maximum number of pending connections the operating system should queue before connections are refused. The value should be at least 1, with 5 being sufficient for most applications.\n\ns.makefile([mode [, bufsize]])\n\nCreates a file object associated with the socket. modeand bufsizehave the same meaning as with the built-in open() function.The file object uses a duplicated version of the socket file descriptor, created using os.dup(), so the file object and socket object can be closed or garbage-collected independently.The socket sshould not have a time- out and should not be configured in nonblocking mode.\n\ns.recv(bufsize [, flags])\n\nReceives data from the socket.The data is returned as a string.The maximum amount of data to be received is specified by bufsize. flagsprovides additional information about the message and is usually omitted (in which case it defaults to zero). If used, it’s usually set to one of the following constants (system-dependent):\n\nConstant MSG_DONTROUTE\n\nMSG_DONTWAIT\n\nMSG_EOR\n\nMSG_PEEK\n\nMSG_OOB\n\nMSG_WAITALL\n\nDescription Bypasses routing table lookup (sends only). Non-blocking operation. Indicates that the message is last in a record. Usually only used when sending data on SOCK_SEQPACKET sockets. Looks at data but doesn’t discard (receives only). Receives/sends out-of-band data. Doesn’t return until the requested number of bytes have been read (receives only).\n\ns.recv_into(buffer [, nbytes [, flags]])\n\nThe same as recv() except that data is written into a an object buffersupporting the buffer interface. nbytesis the maximum number of bytes to receive. If omitted, the maximum size is taken from the buffer size. flagshas the same meaning as for recv().\n\ns.recvfrom(bufsize [, flags])\n\nLike the recv() method except that the return value is a pair (data, address) in which datais a string containing the data received and addressis the address of the socket sending the data.The optional flagsargument has the same meaning as for recv().This function is primarily used in conjunction with the UDP protocol.\n\ns.recvfrom_info(buffer [, nbytes [, flags]])\n\nThe same as recvfrom() but the received data is stored in the buffer object buffer. nbytesspecifies the maximum number of bytes of receive. If omitted, the maximum size is taken from the size of buffer. flagshas the same meaning as for recv().\n\nF h Lib f L Bdff",
      "page_number": 485
    },
    {
      "number": 25,
      "title": "Segment 25 (pages 508-530)",
      "start_page": 508,
      "end_page": 530,
      "detection_method": "synthetic",
      "content": "484\n\nChapter 21 Network Programming and Sockets\n\ns.send(string [, flags])\n\nSends data in stringto a connected socket.The optional flagsargument has the same meaning as for recv(), described earlier. Returns the number of bytes sent, which may be fewer than the number of bytes in string. Raises an exception if an error occurs.\n\ns.sendall(string [, flags])\n\nSends data in stringto a connected socket, except that an attempt is made to send all of the data before returning. Returns None on success; raises an exception on failure. flagshas the same meaning as for send().\n\ns.sendto(string [, flags], address)\n\nSends data to the socket. flagshas the same meaning as for recv(). addressis a tuple of the form (host, port), which specifies the remote address.The socket should not already be connected. Returns the number of bytes sent.This function is primarily used in conjunction with the UDP protocol.\n\ns.setblocking(flag)\n\nIf flagis zero, the socket is set to nonblocking mode. Otherwise, the socket is set to blocking mode (the default). In nonblocking mode, if a recv() call doesn’t find any data or if a send() call cannot immediately send the data, the socket.error excep- tion is raised. In blocking mode, these calls block until they can proceed.\n\ns.setsockopt(level, optname, value)\n\nSets the value of the given socket option. leveland optnamehave the same meaning as for getsockopt().The value can be an integer or a string representing the contents of a buffer. In the latter case, it’s up to the caller to ensure that the string contains the proper data. See getsockopt() for socket option names, values, and descriptions.\n\ns.settimeout(timeout)\n\nSets a timeout on socket operations. timeoutis a floating-point number in seconds.A value of None means no timeout. If a timeout occurs, a socket.timeout exception is raised.As a general rule, timeouts should be set as soon as a socket is created because they can be applied to operations involved in establishing a connection (such as connect()).\n\ns.shutdown(how)\n\nShuts down one or both halves of the connection. If howis 0, further receives are dis- allowed. If howis 1, further sends are disallowed. If howis 2, further sends and receives are disallowed.\n\nIn addition to these methods, a socket instance salso has the following read-only\n\nproperties which correspond to the arguments passed to the socket() function.\n\nProperty s.family\n\ns.proto\n\ns.type\n\nDescription The socket address family (e.g., AF_INET) The socket protocol The socket type (e.g., SOCK_STREAM)\n\nF h Lib f L Bdff\n\nsocket\n\n485\n\nExceptions The following exceptions are defined by the socket module.\n\nerror\n\nThis exception is raised for socket- or address-related errors. It returns a pair (errno, mesg) with the error returned by the underlying system call. Inherits from IOError.\n\nherror\n\nError raised for address-related errors. Returns a tuple (herrno, hmesg) containing an error number and error message. Inherits from error.\n\ngaierror\n\nError raised for address-related errors in the getaddrinfo() and getnameinfo() func- tions.The error value is a tuple (errno, mesg), where errnois an error number and mesgis a string containing a message. errnois set to one of the following constants defined in the socket module:\n\nConstant EAI_ADDRFAMILY\n\nEAI_AGAIN\n\nEAI_BADFLAGS\n\nEAI_BADHINTS\n\nEAI_FAIL\n\nEAI_FAMILY\n\nEAI_MEMORY\n\nEAI_NODATA\n\nEAI_NONAME\n\nEAI_PROTOCOL\n\nEAI_SERVICE\n\nEAI_SOCKTYPE\n\nDescription Address family not supported. Temporary failure in name resolution. Invalid flags. Bad hints. Nonrecoverable failure in name resolution. Address family not supported by host. Memory allocation failure. No address associated with node name. No node name or service name provided. Protocol not supported. Service name not supported for socket type. Socket type not supported. System error.\n\nEAI_SYSTEM\n\ntimeout\n\nException raised when a socket operation times out.This only occurs if a timeout has been set using the setdefaulttimeout() function or settimeout() method of a socket object. Exception value is a string, 'timeout'. Inherits from error.\n\nExample A simple example of a TCP connection is shown in the introduction to this chapter. The following example illustrates a simple UDP echo server:\n\n# UDP message server # Receive small packets from anywhere and print them out import socket s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) s.bind((\"\",10000)) while True:\n\ndata, address = s.recvfrom(256) print(\"Received a connection from %s\" % str(address)) s.sendto(b\"echo:\" + data, address)\n\nF h Lib f L Bdff\n\n486\n\nChapter 21 Network Programming and Sockets\n\nHere a client that sends messages to the previous server:\n\n# UDP message client import socket s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) s.sendto(b\"Hello World\", (\"\", 10000)) resp, addr = s.recvfrom(256) print(resp) s.sendto(b\"Spam\", (\"\", 10000)) resp, addr = s.recvfrom(256) print(resp) s.close()\n\nNotes\n\nn Not all constants and socket options are available on all platforms. If portability is\n\nyour goal, you should only rely upon options that are documented in major sources such as the W. Richard Stevens UNIX Network Programming book cited at the beginning of this section.\n\nn Notable omissions from the socket module are recvmsg() and sendmsg()\n\nsystem calls, commonly used to work with ancillary data and advanced network options related to packet headers, routing, and other details. For this functionality, you must install a third-party module such as PyXAPI (http://pypi.python.org/pypi/PyXAPI).\n\nn There is a subtle difference between nonblocking socket operations and opera-\n\ntions involving a timeout.When a socket function is used in nonblocking mode, it will return immediately with an error if the operation would have blocked. When a timeout is set, a function returns an error only if the operation doesn’t complete within a specified timeout.\n\nssl The ssl module is used to wrap socket objects with the Secure Sockets Layer (SSL), which provides data encryption and peer authentication. Python uses the OpenSSL library (http://www.openssl.org) to implement this module.A full discussion concern- ing the theory and operation of SSL is beyond the scope of what can be covered here. So, just the essential elements of using this module are covered here with the assump- tion that you know what you’re doing when it comes to SSL configuration, keys, cer- tificates, and other related matters:\n\nwrap_socket(sock [, **opts])\n\nWraps an existing socket sock(created by the socket module) with SSL support and returns an instance of SSLSocket.This function should be used before subsequent connect() or accept() operations are made. optsrepresents a number of keyword arguments that are used to specify additional configuration data.\n\nF h Lib f L Bdff\n\nssl\n\n487\n\nKeyword Argument server_side\n\nkeyfile\n\ncertfile\n\ncert_reqs\n\nca_certs\n\nssl_version\n\nDescription A Boolean flag that indicates whether or not the socket is operating as a server (True) or a client (False). By default, this is False. The key file used to identify the local side of the con- nection. This should be a PEM-format file and usually only included if the file specified with the certfile doesn’t include the key. The certificate file used to identify the local side of the connection. This should be a PEM-format file. Specifies whether a certificate is required from the other side of the connection and whether or not it will be validated. A value of CERT_NONE means that certifi- cates are ignored, CERT_OPTIONAL means that certifi- cates are not required but will be validated if given, and CERT_REQUIRED means that certificates are required and will be validated. If certificates are going to be vali- dated, the ca_certs parameter must also be given. Filename of the file holding certificate authority certifi- cates used for validation. SSL protocol version to use. Possible values are PROTOCOL_TLSv1, PROTOCOL_SSLv2, PROTOCOL_SSLv23, or PROTOCOL_SSLv3. The default protocol is PROTOCOL_SSLv3.\n\ndo_handshake_on_connect Boolean flag that specifies whether or not the SSL\n\nsuppress_ragged_eofs\n\nhandshake is performed automatically on connect. By default, this is True. Specifies how read() handles an unexpected EOF on the connection. If True (the default), a normal EOF is signaled. If False, an exception is raised.\n\nAn instance sof SSLSocket inherits from socket.socket and additionally supports the following operations:\n\ns.cipher()\n\nReturns a tuple (name, version, secretbits) where nameis the cipher name being used, versionis the SSL protocol, and secretbitsis the number of secret bits being used.\n\ns.do_handshake()\n\nPerforms the SSL handshake. Normally this is done automatically unless the do_handshake_on_connect option was set to False in the wrap_socket() function. If the underlying socket sis nonblocking, an SSLError exception will be raised if the operation couldn’t be completed.The e.args[0] attribute of an SSLError exception e will have the value SSL_ERROR_WANT_READ or SSL_ERROR_WANT_WRITE depending on the operation that needs to be performed.To continue the handshake process once reading or writing can continue, simply call s.do_handshake() again.\n\nF h Lib f L Bdff\n\n488\n\nChapter 21 Network Programming and Sockets\n\ns.getpeercert([binary_form])\n\nReturns the certificate from the other end of the connection, if any. If there is no cer- tificate None is returned. If there was a certificate but it wasn’t validated, an empty dic- tionary is returned. If a validated certificate is received, a dictionary with the keys 'subject' and 'notAfter' is returned. If binary_formis set True, the certificate is returned as a DER-encoded byte sequence.\n\ns.read([nbytes])\n\nReads up to nbytesof data and returns it. If nbytesis omitted, up to 1,024 bytes are returned.\n\ns.write(data)\n\nWrites the byte string data. Returns the number of bytes written.\n\ns.unwrap()\n\nShuts down the SSL connection and returns the underlying socket object on which further unencrypted communication can be carried out.\n\nThe following utility functions are also defined by the module:\n\ncert_time_to_seconds(timestring)\n\nConverts a string timestringfrom the format used in certificates to a floating-point number as compatible with the time.time() function.\n\nDER_cert_to_PEM_cert(derbytes)\n\nGiven a byte string derbytescontaining a DER-encoded certificate, returns a PEM- encoded string version of the certificate.\n\nPEM_cert_to_DER_cert(pemstring)\n\nGiven a string pemstringcontaining a PEM-encoded string version of a certificate, returns a DER-encoded byte string version of the certificate.\n\nget_server_certificate(addr [, ssl_version [, ca_certs]])\n\nRetrieves the certificate of an SSL server and returns it as a PEM-encoded string. addr is an address of the form (hostname, port). ssl_versionis the SSL version num- ber, and ca_certsis the name of a file containing certificate authority certificates as described for the wrap_socket() function.\n\nRAND_status()\n\nReturns True or False if the SSL layer thinks that the pseudorandom number genera- tor has been seeded with enough randomness.\n\nRAND_egd(path)\n\nReads 256 bytes of randomness from an entropy-gathering daemon and adds it to the pseudorandom number generator. pathis the name of a UNIX-domain socket for the daemon.\n\nRAND_add(bytes, entropy)\n\nAdds the bytes in byte string bytesinto the pseudorandom number generator. entropyis a nonnegative floating-point number giving the lower bound on the entropy.\n\nF h Lib f L Bdff\n\nSocketServer\n\n489\n\nExamples The following example shows how to use this module to open an SSL-client connection:\n\nimport socket, ssl\n\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM) ssl_s = ssl.wrap_socket(s) ssl_s.connect(('gmail.google.com',443)) print(ssl_s.cipher()) # Send a request ssl_s.write(b\"GET / HTTP/1.0\\r\\n\\r\\n\") # Get the response while True:\n\ndata = ssl_s.read() if not data: break print(data)\n\nssl_s.close()\n\nHere is an example of an SSL-secured time server:\n\nimport socket, ssl, time\n\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR,1) s.bind(('',12345)) s.listen(5)\n\nwhile True:\n\nclient, addr = s.accept() # Get a connection print \"Connection from\", addr client_ssl = ssl.wrap_socket(client,\n\nserver_side=True, certfile=\"timecert.pem\")\n\nclient_ssl.sendall(b\"HTTP/1.0 200 OK\\r\\n\") client_ssl.sendall(b\"Connection: Close\\r\\n\") client_ssl.sendall(b\"Content-type: text/plain\\r\\n\\r\\n\") resp = time.ctime() + \"\\r\\n\" client_ssl.sendall(resp.encode('latin-1')) client_ssl.close() client.close()\n\nIn order to run this server, you will need to have a signed server certificate in the file timecert.pem. For the purposes of testing, you can create one using this UNIX command:\n\n% openssl req –new –x509 –days 30 –nodes –out timecert.pem –keyout timecert.pem\n\nTo test this server, try connecting with a browser using a URL such as 'https://localhost:1234'. If it works, the browser will issue a warning message about you using a self-signed certificate. If you agree, you should see the output of the server.\n\nSocketServer This module is called socketserver in Python 3.The SocketServer module pro- vides classes that simplify the implementation of TCP, UDP, and UNIX domain socket servers.\n\nF h Lib f L Bdff\n\n490\n\nChapter 21 Network Programming and Sockets\n\nHandlers To use the module, you define a handler class that inherits from the base class BaseRequestHandler.An instance hof BaseRequestHandler implements one or more of the following methods:\n\nh.finish()\n\nCalled to perform cleanup actions after the handle() method has completed. By default, it does nothing. It’s not called if either the setup() or handle() method gen- erates an exception.\n\nh.handle()\n\nThis method is called to perform the actual work of a request. It’s called with no argu- ments, but several instance variables contain useful values. h.request contains the request, h.client_address contains the client address, and h.server contains an instance of the server that called the handler. For stream services such as TCP, the h.request attribute is a socket object. For datagram services, it’s a byte string contain- ing the received data.\n\nh.setup()\n\nThis method is called before the handle() method to perform initialization actions. By default, it does nothing. If you wanted a server to implement further connection setup such as establishing a SSL connection, you could implement it here.\n\nHere is an example of a handler class that implements a simple time server that\n\noperates with streams or datagrams:\n\ntry:\n\nfrom socketserver import BaseRequestHandler # Python 3\n\nexcept ImportError:\n\nfrom SocketServer import BaseRequestHandler # Python 2\n\nimport socket import time\n\nclass TimeServer(BaseRequestHandler):\n\ndef handle(self):\n\nresp = time.ctime() + \"\\r\\n\" if isinstance(self.request,socket.socket):\n\n# A stream-oriented connection self.request.sendall(resp.encode('latin-1'))\n\nelse:\n\n# A datagram-oriented connection self.server.socket.sendto(resp.encode('latin-1'),self.client_address)\n\nIf you know that a handler is only going to operate on stream-oriented connections such as TCP, have it inherit from StreamRequestHandler instead of BaseRequestHandler.This class sets two attributes: h.wfile is a file-like object that writes data to the client, and h.rfile is a file-like object that reads data from the client. Here is an example:\n\ntry:\n\nfrom socketserver import StreamRequestHandler # Python 3\n\nexcept ImportError:\n\nfrom SocketServer import StreamRequestHandler # Python 2\n\nimport time\n\nF h Lib f L Bdff\n\nSocketServer\n\n491\n\nclass TimeServer(StreamRequestHandler):\n\ndef handle(self):\n\nresp = time.ctime() + \"\\r\\n\" self.wfile.write(resp.encode('latin-1'))\n\nIf you are writing a handler that only operates with packets and always sends a response back to the sender, have it inherit from DatagramRequestHandler instead of BaseRequestHandler. It provides the same file-like interface as StreamRequestHandler. For example:\n\ntry:\n\nfrom socketserver import DatagramRequestHandler # Python 3\n\nexcept ImportError:\n\nfrom SocketServer import DatagramRequestHandler # Python 2\n\nimport time\n\nclass TimeServer(DatagramRequestHandler):\n\ndef handle(self):\n\nresp = time.ctime() + \"\\r\\n\" self.wfile.write(resp.encode('latin-1')\n\nIn this case, all of the data written to self.wfile is collected into a single packet that is returned after the handle() method returns.\n\nServers To use a handler, it has to be plugged into a server object.There are four basic server classes defined:\n\nTCPServer(address, handler)\n\nA server supporting the TCP protocol using IPv4. addressis a tuple of the form (host, port). handleris an instance of a subclass of the BaseRequestHandler class described later.\n\nUDPServer(address, handler)\n\nA server supporting the Internet UDP protocol using IPv4. addressand handlerare the same as for TCPServer().\n\nUnixStreamServer(address, handler)\n\nA server implementing a stream-oriented protocol using UNIX domain sockets. Inherits from TCPServer.\n\nUnixDatagramServer(address, handler)\n\nA server implementing a datagram protocol using UNIX domain sockets.This inherits from UDPServer.\n\nInstances of all four server classes have the following basic methods:\n\ns.fileno()\n\nReturns the integer file descriptor for the server socket.The presence of this method makes it legal to use server instances with polling operations such as the select() function.\n\ns.serve_forever()\n\nHandles an infinite number of requests.\n\nF h Lib f L Bdff\n\n492\n\nChapter 21 Network Programming and Sockets\n\ns.shutdown()\n\nStops the serve_forever() loop.\n\nThe following attributes give some basic information about the configuration of a\n\nrunning server:\n\ns.RequestHandlerClass\n\nThe user-provided request handler class that was passed to the server constructor.\n\ns.server_address\n\nThe address on which the server is listening, such as the tuple ('127.0.0.1', 80).\n\ns.socket\n\nThe socket object being used for incoming requests.\n\nHere is an example of running the TimeHandler as a TCP server:\n\nfrom SocketServer import TCPServer\n\nserv = TCPServer(('',10000,TimeHandler) serv.serve_forever()\n\nHere is an example of running the handler as a UDP server:\n\nfrom SocketServer import UDPServer\n\nserv = UDPServer(('',10000,TimeHandler) serv.serve_forever()\n\nA key aspect of the SocketServer module is that handlers are decoupled from servers. That is, once you have written a handler, you can plug it into many different kinds of servers without having to change its implementation.\n\nDefining Customized Servers Servers often need special configuration to account for different network address fami- lies, timeouts, concurrency, and other features.This customization is carried out by inheriting from one of the four basic servers described in the previous section.The fol- lowing class attributes can be defined to customize basic settings of the underlying net- work socket:\n\nServer.address_family\n\nThe address family used by the server socket.The default value is socket.AF_INET. Use socket.AF_INET6 if you want to use IPv6.\n\nServer.allow_reuse_address\n\nA Boolean flag that indicates whether or not a socket should reuse an address.This is useful when you want to immediately restart a server on the same port after a program has terminated (otherwise, you have to wait a few minutes).The default value is False.\n\nServer.request_queue_size\n\nThe size of the request queue that’s passed to the socket’s listen() method.The default value is 5.\n\nF h Lib f L Bdff\n\nSocketServer\n\n493\n\nServer.socket_type\n\nThe socket type used by the server, such as socket.SOCK_STREAM or socket.SOCK_DGRAM.\n\nServer.timeout\n\nTimeout period in seconds that the server waits for a new request. On timeout, the server calls the handle_timeout() method (described below) and goes back to wait- ing.This timeout is not used to set a socket timeout. However, if a socket timeout has been set, its value is used instead of this value.\n\nHere is an example of how to create a server that allows the port number to be\n\nreused:\n\nfrom SocketServer import TCPServer\n\nclass TimeServer(TCPServer):\n\nallow_reuse_address = True\n\nserv = TimeServer(('',10000,TimeHandler) serv.serve_forever()\n\nIf desired, the following methods are most useful to extend in classes that inherit from one of the servers. If you define any of these methods in your own server, make sure you call the same method in the superclass.\n\nServer.activate()\n\nMethod that carries out the listen() operation on the server.The server socket is ref- erenced as self.socket.\n\nServer.bind()\n\nMethod that carries out the bind() operation on the server.\n\nServer.handle_error(request, client_address)\n\nMethod that handles uncaught exceptions that occur in handling.To get information about the last exception, use sys.exc_info() or functions in the traceback module.\n\nServer.handle_timeout()\n\nMethod that is called when the server timeout occurs. By redefining this method and adjusting the timeout setting, you can integrate other processing into the server event loop.\n\nServer.verify_request(request, client_address)\n\nRedefine this method if you want to verify the connection before any further process- ing.This is what you define if you wanted to implement a firewall or perform some other kind of a validation.\n\nFinally, addition server features are available through the use of mixin classes.This is\n\nhow concurrency via threads or processing forking is added.The following classes are defined for this purpose:\n\nForkingMixIn\n\nA mixin class that adds UNIX process forking to a server, allowing it to serve multiple clients.The class variable max_children controls the maximum number of child\n\nF h Lib f L Bdff\n\n494\n\nChapter 21 Network Programming and Sockets\n\nprocesses, and the timeout variable determines how much time elapses between attempts to collect zombie processes.An instance variable active_children keeps track of how many active processes are running.\n\nThreadingMixIn\n\nA mixin class that modifies a server so that it can serve multiple clients with threads. There is no limit placed on the number of threads that can be created. By default, threads are non-daemonic unless the class variable daemon_threads is set to True.\n\nTo add these features to a server, you use multiple inheritance where the mixin class\n\nis listed first. For example, here is a forking time server:\n\nfrom SocketServer import TCPServer, ForkingMixIn\n\nclass TimeServer(ForkingMixIn, TCPServer):\n\nallow_reuse_address = True max_children = 10\n\nserv = TimeServer(('',10000,TimeHandler) serv.serve_forever()\n\nSince concurrent servers are relatively common, the SocketServer predefines the fol- lowing server classes for this purpose.\n\nn ForkingUDPServer(address, handler)\n\nn ForkingTCPServer(address, handler)\n\nn ThreadingUDPServer(address, handler)\n\nn ThreadingTCPServer(address, handler)\n\nThese classes are actually just defined in terms of the mixins and server classes. For example, here is the definition of ForkingTCPServer:\n\nclass ForkingTCPServer(ForkingMixIn, TCPServer): pass\n\nCustomization of Application Servers Other library modules often use the SocketServer class to implement servers for application-level protocols such as HTTP and XML-RPC.Those servers can also be customized via inheritance and extending the methods defined for basic server opera- tion. For example, here is a forking XML-RPC server that only accepts connections originating on the loopback interface:\n\ntry:\n\nfrom xmlrpc.server import SimpleXMLRPCServer # Python 3 from socketserver import ForkingMixIn\n\nexcept ImportError: # Python 2\n\nfrom SimpleXMLRPCServer import SimpleXMLRPCServer from SocketServer import ForkingMixIn\n\nclass MyXMLRPCServer(ForkingMixIn,SimpleXMLRPCServer): def verify_request(self, request, client_address):\n\nhost, port = client_address if host != '127.0.0.1':\n\nreturn False\n\nreturn SimpleXMLRPCServer.verify_request(self,request,client_address)\n\nF h Lib f L Bdff\n\nSocketServer\n\n495\n\n# Sample use def add(x,y):\n\nreturn x+y\n\nserver = MyXMLRPCServer((\"\",45000)) server.register_function(add) server.serve_forever()\n\nTo test this, you will need to use the xmlrpclib module. Run the previous server and then start a separate Python process:\n\n>>> import xmlrpclib >>> s = xmlrpclib.ServerProxy(\"http://localhost:45000\") >>> s.add(3,4) 7 >>>\n\nTo test the rejection of connections, try the same code, but from a different machine on the network. For this, you will need to replace “localhost” with the hostname of the machine that’s running the server.\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n22\n\nInternet Application Programming\n\nThis chapter describes modules related to Internet application protocols including\n\nHTTP, XML-RPC, FTP, and SMTP.Web programming topics such as CGI scripting are covered in Chapter 23,“Web Programming.” Modules related to dealing with com- mon Internet-related data formats are covered in Chapter 24,“Internet Data Handling and Encoding.”\n\nThe organization of network-related library modules is one area where there are sig-\n\nnificant differences between Python 2 and 3. In the interest of looking forward, this chapter assumes the Python 3 library organization because it is more logical. However, the functionality provided by the library modules is virtually identical between Python versions as of this writing.When applicable, Python 2 module names are noted in each section.\n\nftplib The ftplib module implements the client side of the FTP protocol. It’s rarely neces- sary to use this module directly because the urllib package provides a higher-level interface. However, this module may still be useful if you want to have more control over the low-level details of an FTP connection. In order to use this module, it may be helpful to know some of the details of the FTP protocol which is described in Internet RFC 959.\n\nA single class is defined for establishing an FTP connection:\n\nFTP([host [, user [, passwd [, acct [, timeout]]]]])\n\nCreates an object representing an FTP connection. hostis a string specifying a host name. user, passwd, and acctoptionally specify a username, password, and account. If no arguments are given, the connect() and login() methods must be called explicitly to initiate the actual connection. If hostis given, connect()is automatically invoked. If user, passwd, and acctare given, login() is invoked. timeoutis a timeout period in seconds.\n\nAn instance fof FTP has the following methods:\n\nf.abort()\n\nAttempts to abort a file transfer that is in progress.This may or may not work depend- ing the remote server.\n\nF h Lib f L Bdff\n\n498\n\nChapter 22 Internet Application Programming\n\nf.close()\n\nCloses the FTP connection.After this has been invoked, no further operations can be performed on the FTP object f.\n\nf.connect(host [, port [, timeout]])\n\nOpens an FTP connection to a given host and port. hostis a string specifying the host name. portis the integer port number of the FTP server and defaults to port 21. timeoutis the timeout period in seconds. It is not necessary to call this if a host name was already given to FTP().\n\nf.cwd(pathname)\n\nChanges the current working directory on the server to pathname.\n\nf.delete(filename)\n\nRemoves the file filenamefrom the server.\n\nf.dir([dirname [, ... [, callback]]])\n\nGenerates a directory listing as produced by the 'LIST' command. dirnameoptionally supplies the name of a directory to list. In addition, if any additional arguments are sup- plied, they are simply passed as additional arguments to 'LIST’. If the last argument callbackis a function, it is used as a callback function to process the returned directo- ry listing data.This callback function works in the same way as the callback used by the retrlines() method. By default, this method prints the directory list to sys.stdout.\n\nf.login([user, [passwd [, acct]]])\n\nLogs in to the server using the specified username, password, and account. useris a string giving the username and defaults to 'anonymous'. passwdis a string containing the password and defaults to the empty string ''. acctis a string and defaults to the empty string. It is not necessary to call this method if this information was already given to FTP().\n\nf.mkd(pathname)\n\nCreates a new directory on the server.\n\nf.ntransfercmd(command [, rest])\n\nThe same as transfercmd() except that a tuple (sock, size) is returned where sockis a socket object corresponding to the data connection and sizeis the expected size of the data in bytes, or None if the size could not be determined.\n\nf.pwd()\n\nReturns a string containing the current working directory on the server.\n\nf.quit()\n\nCloses the FTP connection by sending the 'QUIT' command to the server.\n\nf.rename(oldname,newname)\n\nRenames a file on the server.\n\nF h Lib f L Bdff\n\nftplib\n\n499\n\nf.retrbinary(command, callback [, blocksize [, rest]])\n\nReturns the results of executing a command on the server using binary transfer mode. commandis a string that specifies the appropriate file retrieval command and is almost always 'RETR filename'. callbackis a callback function that is invoked each time a block of data is received.This callback function is invoked with a single argument which is the received data in the form of a string. blocksizeis the maximum block size to use and defaults to 8192 bytes. restis an optional offset into the file. If supplied, this specifies the position in the file where you want to start the transfer. However, this is not supported by all FTP servers so this may result in an error_reply exception.\n\nf.retrlines(command [, callback])\n\nReturns the results of executing a command on the server using text transfer mode. commandis a string that specifies the command and is usually something like 'RETR filename’. callbackis a callback function that is invoked each time a line of data is received.This callback function is called with a single argument which is a string con- taining the received data. If callbackis omitted, the returned data is printed to sys.stdout.\n\nf.rmd(pathname)\n\nRemoves a directory from the server.\n\nf.sendcmd(command)\n\nSends a simple command to the server and returns the server response. commandis a string containing the command.This method should only be used for commands that don’t involve the transfer of data.\n\nf.set_pasv(pasv)\n\nSets passive mode. pasvis a Boolean flag that turns passive mode on if True or off if False. By default, passive mode is on.\n\nf.size(filename)\n\nReturns the size of filenamein bytes. Returns None if the size can’t be determined for some reason.\n\nf.storbinary(command, file [, blocksize])\n\nExecutes a command on the server and transmits data using binary transfer mode. commandis a string that specifies the low-level command. It is almost always set to 'STOR filename', where filenameis the name of a file you want to place on the server. fileis an open file-object from which data will be read using file.read(blocksize) and transferred to the server. blocksizeis the blocksize to use in the transfer. By default, it is 8192 bytes.\n\nf.storlines(command, file)\n\nExecutes a command on the server and transfers data using text transfer mode. command is a string which specifies the low-level command. It is usually 'STOR filename'. fileis an open file-object from which data will be read using file.readline() and sent to the server.\n\nF h Lib f L Bdff\n\n500\n\nChapter 22 Internet Application Programming\n\nf.transfercmd(command [, rest])\n\nInitiates a transfer over the FTP data connection. If active mode is being used, this sends a 'PORT' or 'EPRT' command and accepts the resulting connection from the server. If passive mode is being used, this sends a 'EPSV' or 'PASV' command followed by a connection to the server. In either case, once the data connection has been established, the FTP command in commandis then issued.This function returns a socket object cor- responding to the open data connection.The optional restparameter specifies a start- ing byte offset into files requested on the server. However, this is not supported on all servers and could result in an error_reply exception.\n\nExample The following example shows how to use this module to upload a file to a FTP server:\n\nhost = \"ftp.foo.com\" username = \"dave\" password = \"1235\" filename = \"somefile.dat\"\n\nimport ftplib ftp_serv = ftplib.FTP(host,username,password) # Open the file you want to send f = open(filename,\"rb\") # Send it to the FTP server resp = ftp_serv.storbinary(\"STOR \"+filename, f) # Close the connection ftp_serv.close\n\nTo fetch documents from an FTP server, use the urllib package. For example:\n\ntry:\n\nfrom urllib.request import urlopen # Python 3\n\nexcept ImportError:\n\nfrom urllib2 import urlopen # Python 2\n\nu = urlopen(\"ftp://username:password@somehostname/somefile\") contents = u.read()\n\nhttp Package The http package consists of modules for writing HTTP clients and servers as well as support for state management (cookies).The Hypertext Transfer Protocol (HTTP) is a simple text-based protocol that works as follows:\n\n1. A client makes a connection to an HTTP server and sends a request header of the following form:\n\nGET /document.html HTTP/1.0 Connection: Keep-Alive User-Agent: Mozilla/4.61 [en] (X11; U; SunOS 5.6 sun4u) Host: rustler.cs.uchicago.edu:8000 Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, image/png, */* Accept-Encoding: gzip Accept-Language: en Accept-Charset: iso-8859-1,*,utf-8\n\nOptional data ...\n\nF h Lib f L Bdff\n\nhttp package\n\n501\n\nThe first line defines the request type, document (the selector), and protocol ver- sion. Following the request line is a series of header lines containing various information about the client, such as passwords, cookies, cache preferences, and client software. Following the header lines, a single blank line indicates the end of the header lines.After the header, data may appear in the event that the request is sending information from a form or uploading a file. Each of the lines in the header should be terminated by a carriage return and a newline ('\\r\\n').\n\n2. The server sends a response of the following form:\n\nHTTP/1.0 200 OK Content-type: text/html Content-length: 72883 bytes ... Header: data\n\nData ...\n\nThe first line of the server response indicates the HTTP protocol version, a suc- cess code, and a return message. Following the response line is a series of header fields that contain information about the type of the returned document, the document size, web server software, cookies, and so forth.The header is terminat- ed by a single blank line followed by the raw data of the requested document.\n\nThe following request methods are the most common:\n\nMethod GET\n\nPOST\n\nHEAD\n\nPUT\n\nDescription Get a document. Post data to a form. Return header information only. Upload data to the server.\n\nThe response codes detailed in Table 22.1 are most commonly returned by servers.The Symbolic Constant column is the name of a predefined variable in http.client that holds the integer response code value and which can be used in code to improve read- ability.\n\nTable 22.1 Response Codes Commonly Returned by Servers\n\nCode\n\nDescription\n\nSymbolic Constant\n\nSuccess Codes (2xx)\n\n200\n\n201\n\n202\n\n204\n\nOK Created Accepted No content\n\nOK\n\nCREATED\n\nACCEPTED\n\nNO_CONTENT\n\nRedirection (3xx)\n\n300\n\n301\n\n302\n\n303\n\nMultiple choices Moved permanently Moved temporarily Not modified\n\nMULTIPLE_CHOICES\n\nMOVED_PERMANENTLY\n\nMOVED_TEMPORARILY\n\nNOT_MODIFIED\n\nF h Lib f L Bdff\n\n502\n\nChapter 22 Internet Application Programming\n\nTable 22.1\n\nContinued\n\nCode\n\nDescription\n\nSymbolic Constant\n\nClient Error (4xx)\n\n400\n\n401\n\n403\n\n404\n\nBad request Unauthorized Forbidden Not found\n\nBAD_REQUEST\n\nUNAUTHORIZED\n\nFORBIDDEN\n\nNOT_FOUND\n\nServer Error (5xx)\n\n500\n\n501\n\n502\n\n503\n\nInternal server error Not implemented Bad gateway Service unavailable\n\nINTERNAL_SERVER_ERROR\n\nNOT_IMPLEMENTED\n\nBAD_GATEWAY\n\nSERVICE_UNAVAILABLE\n\nThe headers that appear in both requests and responses are encoded in a format widely known as RFC-822.Then general form of each header is Headername: data, although further details can be found in the RFC. It is almost never necessary to parse these headers as Python usually does it for you when applicable.\n\nhttp.client (httplib) The http.client module provides low-level support for the client side of HTTP. In Python 2, this module is called httplib. Use functions in the urllib package instead. The module supports both HTTP/1.0 and HTTP/1.1 and additionally allows connec- tions via SSL if Python is built with OpenSSL support. Normally, you do not use this package directly; instead, you should consider using the urllib package. However, because HTTP is such an important protocol, you may encounter situations where you need to work with the low-level details in a way that urllib cannot easily address—for example, if you wanted to send requests with commands other than GET or POST. For more details about HTTP, consult RFC 2616 (HTTP/1.1) and RFC 1945 (HTTP/1.0).\n\nThe following classes can be used to establish an HTTP connection with a server:\n\nHTTPConnection(host [,port])\n\nCreates an HTTP connection. hostis the host name, and portis the remote port number.The default port is 80. Returns an HTTPConnection instance.\n\nHTTPSConnection(host [, port [, key_file=kfile [, cert_file=cfile ]]])\n\nCreates an HTTP connection but uses a secure socket.The default port is 443. key_file and cert_file are optional keyword arguments that specify client PEM- formatted private-key and certificate chain files, should they be needed for client authentication. However, no validation of server certificates is performed. Returns an HTTPSConnection instance.\n\nF h Lib f L Bdff\n\nhttp package\n\n503\n\nAn instance, h, of HTTPConnection or HTTPSConnection supports the following\n\nmethods:\n\nh.connect()\n\nInitializes the connection to the host and port given to HTTPConnection() or HTTPSConnection(). Other methods call this automatically if a connection hasn’t been made yet.\n\nh.close()\n\nCloses the connection.\n\nh.send(bytes)\n\nSends a byte string, bytes, to the server. Direct use of this function is discouraged because it may break the underlying response/request protocol. It’s most commonly used to send data to the server after h.endheaders() has been called.\n\nh.putrequest(method, selector [, skip_host [, skip_accept_encoding]])\n\nSends a request to the server. methodis the HTTP method, such as 'GET' or 'POST'. selectorspecifies the object to be returned, such as '/index.html'.The skip_host and skip_accept_encodingparameters are flags that disable the sending of Host: and Accept-Encoding: headers in the HTTP request. By default, both of these arguments are False. Because the HTTP/1.1 protocol allows multiple requests to be sent over a single connection, a CannotSendRequest exception may be raised if the connection is in a state that prohibits new requests from being issued.\n\nh.putheader(header, value, ...)\n\nSends an RFC-822–style header to the server. It sends a line to the server, consisting of the header, a colon and a space, and the value.Additional arguments are encoded as continuation lines in the header. Raises a CannotSendHeader exception if his not in a state that allows headers to be sent.\n\nh.endheaders()\n\nSends a blank line to the server, indicating the end of the header lines.\n\nh.request(method, url [, body [, headers]])\n\nSends a complete HTTP request to the server. methodand urlhave the same meaning as for h.putrequest(). bodyis an optional string containing data to upload to the server after the request has been sent. If bodyis supplied, the Context-length: header will automatically be set to an appropriate value. headersis a dictionary containing header:valuepairs to be given to the h.putheader() method.\n\nh.getresponse()\n\nGets a response from the server and returns an HTTPResponse instance that can be used to read data. Raises a ResponseNotReady exception if his not in a state where a response would be received.\n\nAn HTTPResponse instance, r, as returned by the getresponse() method, supports\n\nthe following methods:\n\nF h Lib f L Bdff\n\n504\n\nChapter 22 Internet Application Programming\n\nr.read([size])\n\nReads up to sizebytes from the server. If sizeis omitted, all the data for this request is returned.\n\nr.getheader(name [,default])\n\nGets a response header. nameis the name of the header. defaultis the default value to return if the header is not found.\n\nr.getheaders()\n\nReturns a list of (header, value) tuples.\n\nAn HTTPResponse instance ralso has the following attributes:\n\nr.version\n\nHTTP version used by the server.\n\nr.status\n\nHTTP status code returned by the server.\n\nr.reason\n\nHTTP error message returned by the server.\n\nr.length\n\nNumber of bytes left in the response.\n\nExceptions The following exceptions may be raised in the course of handling HTTP connections:\n\nException HTTPException\n\nNotConnected\n\nInvalidURL\n\nUnknownProtocol\n\nUnknownTransferEncoding\n\nUnimplementedFileMode\n\nIncompleteRead\n\nDescription Base class of all HTTP-related errors. Request was made but not connected. Bad URL or port number given. Unknown HTTP protocol number. Unknown transfer encoding. Unimplemented file mode. Incomplete data received. Unknown status code received.\n\nBadStatusLine\n\nThe following exceptions are related to the state of HTTP/1.1 connections. Because HTTP/1.1 allows multiple requests/responses to be sent over a single connection, extra rules are imposed as to when requests can be sent and responses received. Performing operations in the wrong order will generate an exception.\n\nException ImproperConnectionState\n\nCannotSendRequest\n\nCannotSendHeader\n\nResponseNotReady\n\nDescription Base class of all HTTP-connection state errors. Can’t send a request. Can’t send headers. Can’t read a response.\n\nF h Lib f L Bdff\n\nhttp package\n\n505\n\nExample The following example shows how the HTTPConnection class can be used to perform a memory-efficient file upload to a server using a POST request—something that is not easily accomplished within the urllib framework.\n\nimport os try:\n\nfrom httplib import HTTPConnection # Python 2\n\nexcept ImportError:\n\nfrom http.client import HTTPConnection # Python 3\n\nBOUNDARY = \"$Python-Essential-Reference$\" CRLF = '\\r\\n'\n\ndef upload(addr, url, formfields, filefields): # Create the sections for form fields formsections = [] for name in formfields:\n\nsection = [\n\n'--'+BOUNDARY, 'Content-disposition: form-data; name=\"%s\"' % name, '', formfields[name] ]\n\nformsections.append(CRLF.join(section)+CRLF)\n\n# Collect information about all of the files to be uploaded fileinfo = [(os.path.getsize(filename), formname, filename)\n\nfor formname, filename in filefields.items()]\n\n# Create the HTTP headers for each file filebytes = 0 fileheaders = [] for filesize, formname,filename in fileinfo:\n\nheaders = [\n\n'--'+BOUNDARY, 'Content-Disposition: form-data; name=\"%s\"; filename=\"%s\"' % \\\n\n(formname, filename),\n\n'Content-length: %d' % filesize, '' ]\n\nfileheaders.append(CRLF.join(headers)+CRLF) filebytes += filesize\n\n# Closing marker closing = \"--\"+BOUNDARY+\"--\\r\\n\"\n\n# Determine the entire length of the request content_size = (sum(len(f) for f in formsections) +\n\nsum(len(f) for f in fileheaders) + filebytes+len(closing))\n\n# Upload it conn = HTTPConnection(*addr) conn.putrequest(\"POST\",url) conn.putheader(\"Content-type\", 'multipart/form-data; boundary=%s' % BOUNDARY) conn.putheader(\"Content-length\", str(content_size)) conn.endheaders()\n\nF h Lib f L Bdff\n\n506\n\nChapter 22 Internet Application Programming\n\n# Send all form sections for s in formsections:\n\nconn.send(s.encode('latin-1'))\n\n# Send all files for head,filename in zip(fileheaders,filefields.values()):\n\nconn.send(head.encode('latin-1')) f = open(filename,\"rb\") while True:\n\nchunk = f.read(16384) if not chunk: break conn.send(chunk)\n\nf.close()\n\nconn.send(closing.encode('latin-1')) r = conn.getresponse() responsedata = r.read() conn.close() return responsedata\n\n# Sample: Upload some files. The form fields 'name', 'email' # 'file_1','file_2', and so forth are what the remote server # is expecting (obviously this will vary). server = ('localhost', 8080) url = '/cgi-bin/upload.py' formfields = {\n\n'name' : 'Dave', 'email' : 'dave@dabeaz.com'\n\n} filefields = {\n\n'file_1' : 'IMG_1008.JPG', 'file_2' : 'IMG_1757.JPG'\n\n} resp = upload(server, url,formfields,filefields) print(resp)\n\nhttp.server (BaseHTTPServer, CGIHTTPServer, SimpleHTTPServer) The http.server module provides various classes for implementing HTTP servers. In Python 2, the contents of this module are split across three library modules: BaseHTTPServer, CGIHTTPServer, and SimpleHTTPServer.\n\nHTTPServer The following class implements a basic HTTP server. In Python 2, it is located in the BaseHTTPServer module.\n\nHTTPServer(server_address, request_handler)\n\nCreates a new HTTPServer object. server_addressis a tuple of the form (host, port) on which the server will listen. request_handleris a handler class derived from BaseHTTPRequestHandler, which is described later.\n\nHTTPServer inherits directly from TCPServer defined in the socketserver mod- ule.Thus, if you want to customize the operation of the HTTP server in any way, you\n\nF h Lib f L Bdff",
      "page_number": 508
    },
    {
      "number": 26,
      "title": "Segment 26 (pages 531-548)",
      "start_page": 531,
      "end_page": 548,
      "detection_method": "synthetic",
      "content": "http package\n\n507\n\ninherit from HTTPServer and extend it. Here is how you would define a multithreaded HTTP server that only accepts connections from a specific subnet:\n\ntry:\n\nfrom http.server import HTTPServer # Python 3 from socketserver import ThreadingMixIn\n\nexcept ImportError:\n\nfrom BaseHTTPServer import HTTPServer # Python 2 from SocketServer import ThreadingMixIn\n\nclass MyHTTPServer(ThreadingMixIn,HTTPServer):\n\ndef __init__(self,addr,handler,subnet):\n\nHTTPServer.__init__(self,addr,handler) self.subnet = subnet\n\ndef verify_request(self, request, client_address):\n\nhost, port = client_address if not host.startswith(subnet):\n\nreturn False\n\nreturn HTTPServer.verify_request(self,request,client_address)\n\n# Example of how the server runs serv = MyHTTPServer(('',8080), SomeHandler, '192.168.69.') serv.serve_forever()\n\nThe HTTPServer class only deals with the low-level HTTP protocol.To get the server to actually do anything, you have to supply a handler class.There are two built-in han- dlers and a base class that can be used for defining your own custom handling.These are described next.\n\nSimpleHTTPRequestHandler and CGIHTTPRequestHandler Two prebuilt web server handler classes can be used if you want to quickly set up a simple stand-alone web server.These classes operate independently of any third-party web server such as Apache.\n\nCGIHTTPRequestHandler(request, client_address, server)\n\nServes files from the current directory and all its subdirectories. In addition, the handler will run a file as a CGI script if it’s located in a special CGI directory (defined by the cgi_directories class variable which is set to ['/cgi-bin', '/htbin'] by default).The handler supports GET, HEAD, and POST methods. However, it does not sup- port HTTP redirects (HTTP code 302), which limits its use to only more simple CGI applications. For security purposes, CGI scripts are executed with a UID of nobody. In Python 2, this class is defined in the CGIHTTPServer module.\n\nSimpleHTTPRequestHandler(request, client_address, server)\n\nServes files from the current directory and all its subdirectories.The class provides sup- port for HEAD and GET requests, respectively.All IOError exceptions result in a \"404 File not found\" error.Attempts to access a directory result in a \"403 Directory listing not supported\" error. In Python 2, this class is defined in the SimpleHTTPServer module.\n\nBoth of these handlers define the following class variables that can be changed via\n\ninheritance if desired:\n\nhandler.server_version\n\nServer version string returned to clients. By default, this is set to a string such as 'SimpleHTTP/0.6'.\n\nF h Lib f L Bdff\n\n508\n\nChapter 22 Internet Application Programming\n\nhandler.extensions_map\n\nA dictionary mapping suffixes to MIME types. Unrecognized file types are considered to be of type 'application/octet-stream'.\n\nHere is an example of using these handler classes to run a stand-alone web server\n\ncapable of running CGI scripts:\n\ntry:\n\nfrom http.server import HTTPServer, CGIHTTPRequestHandler # Python 3\n\nexcept ImportError:\n\nfrom BaseHTTPServer import HTTPServer # Python 2 from CGIHTTPServer import CGIHTTPRequestHandler\n\nimport os\n\n# Change to the document root os.chdir(\"/home/httpd/html\") # Start the CGIHTTP server on port 8080 serv = HTTPServer((\"\",8080),CGIHTTPRequestHandler) serv.serve_forever()\n\nBaseHTTPRequestHandler The BaseHTTPRequestHandler class is a base class that’s used if you want to define your own custom HTTP server handling.The prebuilt handlers such as SimpleHTTPRequestHandler and CGIHTTPRequestHandler inherit from this. In Python 2, this class is defined in the BaseHTTPServer module.\n\nBaseHTTPRequestHandler(request, client_address, server)\n\nBase handler class used to handle HTTP requests.When a connection is received, the request and HTTP headers are parsed.An attempt is then made to execute a method of the form do_REQUESTbased on the request type. For example, a 'GET' method invokes do_GET() and a 'POST' method invokes do_POST. By default, this class does nothing, so these methods are expected to be defined in subclasses.\n\nThe following class variables are defined for BaseHTTPRequestHandler and can be\n\nredefined in subclasses.\n\nBaseHTTPRequestHandler.server_version\n\nSpecifies the server software version string that the server reports to clients—for exam- ple, 'ServerName/1.2'.\n\nBaseHTTPRequestHandler.sys_version\n\nPython system version, such as 'Python/2.6'.\n\nBaseHTTPRequestHandler.error_message_format\n\nFormat string used to build error messages sent to the client.The format string is applied to a dictionary containing the attributes code, message, and explain. For example:\n\n'''<head>\n\n<title>Error response</title> </head> <body> <h1>Error response</h1> <p>Error code %(code)d. <p>Message: %(message)s. <p>Error code explanation: %(code)s = %(explain)s. </body>'''\n\nF h Lib f L Bdff\n\nhttp package\n\n509\n\nBaseHTTPRequestHandler.protocol_version\n\nHTTP protocol version used in responses.The default is 'HTTP/1.0'.\n\nBaseHTTPRequestHandler.responses\n\nMapping of integer HTTP error codes to two-element tuples (message, explain) that describe the problem. For example, the integer code 404 is mapped to (\"Not Found\", \"Nothing matches the given URI\").The integer code and strings in this mapping are use when creating error messages as defined in the error_message_format attribute shown previously.\n\nWhen created to handle a connection, an instance, b, of BaseHTTPRequestHandler\n\nhas the following attributes:\n\nAttribute b.client_address\n\nb.command\n\nb.path\n\nb.request_version\n\nb.headers\n\nb.rfile\n\nDescription Client address as a tuple (host, port). Request type, such as 'GET', 'POST', 'HEAD', and so on. The request path such as '/index.html'. HTTP version string from the request, such as 'HTTP/1.0'. HTTP headers stored in a mapping object. To test for or extract the contents of a header, use dictionary operations such as headername in b.headers or headerval = b.headers[headername]. Input stream for reading optional input data. This is used when a client is uploading data (for example, during a POST request). Output stream for writing a response back to the client.\n\nb.wfile\n\nThe following methods are commonly used or redefined in subclasses:\n\nb.send_error(code [, message])\n\nSends a response for an unsuccessful request. codeis the numeric HTTP response code. messageis an optional error message. log_error() is called to record the error.This method creates a complete error response using the error_message_format class vari- able, sends it to the client, and closes the connection. No further operations should be performed after calling this.\n\nb.send_response(code [, message])\n\nSends a response for a successful request.The HTTP response line is sent, followed by Server and Date headers. codeis an HTTP response code, and messageis an optional message. log_request() is called to record the request.\n\nb.send_header(keyword, value)\n\nWrites a MIME header entry to the output stream. keywordis the header keyword, and valueis its value.This should only be called after send_response().\n\nb.end_headers()\n\nSends a blank line to signal the end of the MIME headers.\n\nF h Lib f L Bdff\n\n510\n\nChapter 22 Internet Application Programming\n\nb.log_request([code [, size]])\n\nLogs a successful request. codeis the HTTP code, and sizeis the size of the response in bytes (if available). By default, log_message() is called for logging.\n\nb.log_error(format, ...)\n\nLogs an error message. By default, log_message() is called for logging.\n\nb.log_message(format, ...)\n\nLogs an arbitrary message to sys.stderr. formatis a format string applied to any additional arguments passed.The client address and current time are prefixed to every message.\n\nHere is an example of creating a custom HTTP server that runs in a separate thread and lets you monitor the contents of a dictionary, interpreting the request path as a key.\n\ntry:\n\nfrom http.server import BaseHTTPRequestHandler, HTTPServer # Py 3\n\nexcept ImportError:\n\nfrom BaseHTTPServer import BaseHTTPRequestHandler, HTTPServer # Py 2\n\nclass DictRequestHandler(BaseHTTPRequestHandler):\n\ndef __init__(self,thedict,*args,**kwargs):\n\nself.thedict = thedict BaseHTTPRequestHandler.__init__(self,*args,**kwargs)\n\ndef do_GET(self):\n\nkey = self.path[1:] # Strip the leading '/' if not key in self.thedict:\n\nself.send_error(404, \"No such key\")\n\nelse:\n\nself.send_response(200) self.send_header('content-type','text/plain') self.end_headers() resp = \"Key : %s\\n\" % key resp += \"Value: %s\\n\" % self.thedict[key] self.wfile.write(resp.encode('latin-1'))\n\n# Example use d = {\n\n'name' : 'Dave', 'values' : [1,2,3,4,5], 'email' : 'dave@dabeaz.com'\n\n} from functools import partial serv = HTTPServer((\"\",9000), partial(DictRequestHandler,d))\n\nimport threading d_mon = threading.Thread(target=serv.serve_forever) d_mon.start()\n\nTo test this example, run the server and then enter a URL such as http://localhost: 9000/name or http://localhost:9000/values into a browser. If it works, you’ll see the contents of the dictionary being displayed.\n\nThis example also shows a technique for how to get servers to instantiate handler classes with extra parameters. Normally, servers create handlers using a predefined set of arguments that are passed to __init__(). If you want to add additional parameters, use the functools.partial() function as shown.This creates a callable object that includes your extra parameter but preserves the calling signature expected by the server.\n\nF h Lib f L Bdff\n\nhttp package\n\n511\n\nhttp.cookies (Cookie) The http.cookies module provides server-side support for working with HTTP cookies. In Python 2, the module is called Cookie.\n\nCookies are used to provide state management in servers that implement sessions, user logins, and related features.To drop a cookie on a user’s browser, an HTTP server typically adds an HTTP header similar to the following to an HTTP response:\n\nSet-Cookie: session=8273612; expires=Sun, 18-Feb-2001 15:00:00 GMT; \\\n\npath=/; domain=foo.bar.com\n\nAlternatively, a cookie can be set by embedding JavaScript in the <head> section of an HTML document:\n\n<SCRIPT LANGUAGE=\"JavaScript\"> document.cookie = \"session=8273612; expires=Sun, 18-Feb-2001 15:00:00 GMT; \\\n\nFeb 17; Path=/; Domain=foo.bar.com;\"\n\n</SCRIPT>\n\nThe http.cookies module simplifies the task of generating cookie values by providing a special dictionary-like object which stores and manages collections of cookie values known as morsels. Each morsel has a name, a value, and a set of optional attributes con- taining metadata to be supplied to the browser {expires, path, comment, domain, max-age, secure, version, httponly}.The name is usually a simple identifier such as \"name\" and must not be the same as one of the metadata names such as \"expires\" or \"path\".The value is usually a short string.To create a cookie, simply create a cookie object like this:\n\nc = SimpleCookie()\n\nNext, cookie values (morsels) can be set using ordinary dictionary assignment:\n\nc[\"session\"] = 8273612 c[\"user\"] = \"beazley\"\n\nAdditional attributes of a specific morsel are set as follows:\n\nc[\"session\"][\"path\"] = \"/\" c[\"session\"][\"domain\"] = \"foo.bar.com\" c[\"session\"][\"expires\"] = \"18-Feb-2001 15:00:00 GMT\"\n\nTo create output representing the cookie data as a set of HTTP headers, use the c.output() method. For example:\n\nprint(c.output()) # Produces two lines of output # Set-Cookie: session=8273612; expires=...; path=/; domain=... # Set-Cookie: user=beazley\n\nWhen a browser sends a cookie back to an HTTP server, it is encoded as a string of key=valuepairs, such as \"session=8273612; user=beazley\". Optional attributes such as expires, path, and domain are not returned.The cookie string can usually be found in the HTTP_COOKIE environment variable, which can be read by CGI applica- tions.To recover cookie values, use code similar to the following:\n\nc = SimpleCookie(os.environ[\"HTTP_COOKIE\"]) session = c[\"session\"].value user = c[\"user\"].value\n\nThe following documentation describes the SimpleCookie object in more detail.\n\nF h Lib f L Bdff\n\n512\n\nChapter 22 Internet Application Programming\n\nSimpleCookie([input])\n\nDefines a cookie object in which cookie values are stored as simple strings.\n\nA cookie instance, c, provides the following methods:\n\nc.output([attrs [,header [,sep]]])\n\nGenerates a string suitable for use in setting cookie values in HTTP headers. attrsis an optional list of the optional attributes to include (\"expires\", \"path\", \"domain\", and so on). By default, all cookie attributes are included. headeris the HTTP header to use ('Set-Cookie:' by default). sepis the character used to join the headers together and is a newline by default.\n\nc.js_output([attrs])\n\nGenerates a string containing JavaScript code that will set the cookie if executed on a browser supporting JavaScript. attrsis an optional list of the attributes to include.\n\nc.load(rawdata)\n\nLoads the cookie cwith data found in rawdata. If rawdatais a string, it’s assumed to be in the same format as the HTTP_COOKIE environment variable in a CGI program. If rawdatais a dictionary, each key-valuepair is interpreted by setting c[key]=value.\n\nInternally, the key/valuepairs used to store a cookie value are instances of a\n\nMorsel class.An instance, m, of Morsel behaves like a dictionary and allows the option- al \"expires\", \"path\", \"comment\", \"domain\", \"max-age\", \"secure\", \"version\", and \"httponly\" keys to be set. In addition, the morsel mhas the following methods and attributes:\n\nm.value\n\nA string containing the raw value of the cookie.\n\nm.coded_value\n\nA string containing the encoded value of the cookie that would be sent to or received from the browser.\n\nm.key\n\nThe cookie name.\n\nm.set(key,value,coded_value)\n\nSets the values of m.key, m.value, and m.coded_value shown previously.\n\nm.isReservedKey(k)\n\nTests whether kis a reserved keyword, such as \"expires\", \"path\", \"domain\", and so on.\n\nm.output([attrs [,header]])\n\nProduces the HTTP header string for this morsel. attrsis an optional list of the addi- tional attributes to include (\"expires\", \"path\", and so on). headeris the header string to use ('Set-Cookie:' by default).\n\nm.js_output([attrs])\n\nOutputs JavaScript code that sets the cookie when executed.\n\nF h Lib f L Bdff\n\nsmtplib\n\n513\n\nm.OutputString([attrs])\n\nReturns the cookie string without any HTTP headers or JavaScript code.\n\nExceptions If an error occurs during the parsing or generation of cookie values, a CookieError exception is raised.\n\nhttp.cookiejar (cookielib) The http.cookiejar module provides client-side support for storing and managing HTTP cookies. In Python 2, the module is called cookielib.\n\nThe primary role of this module is to provide objects in which HTTP cookies can be stored so that they can be used in conjunction with the urllib package, which is used to access documents on the Internet. For instance, the http.cookiejar module can be used to capture cookies and to retransmit them on subsequent connection requests. It can also be used to work with files containing cookie data such as files creat- ed by various browsers.\n\nThe following objects are defined by the module:\n\nCookieJar()\n\nAn object that manages HTTP cookie values, storing cookies received as a result of HTTP requests, and adding cookies to outgoing HTTP requests. Cookies are stored entirely in memory and lost when the CookieJar instance is garbage-collected.\n\nFileCookieJar(filename [, delayload ])\n\nCreates a FileCookieJar instance that retrieves and stores cookie information to a file. filenameis the name of the file. delayload, if True, enables lazy access to the file. That is, the file won’t be read or stored except by demand.\n\nMozillaCookieJar(filename [, delayload ])\n\nCreates a FileCookieJar instance that is compatible with the Mozilla cookies.txt file.\n\nLWPCookieJar(filename [, delayload ])\n\nCreates a FileCookieJar instance that is compatible with the libwww-perl Set-Cookie3 file format.\n\nIt is somewhat rare to work with the methods and attributes of these objects directly.\n\nIf you need to know their low-level programming interface, consult the online docu- mentation. Instead, it is more common to simply instantiate one of the cookie jar objects and plug it into something else that wants to work with cookies.An example of this is shown in the urllib.request section of this chapter.\n\nsmtplib The smtplib module provides a low-level SMTP client interface that can be used to send mail using the SMTP protocol described in RFC 821 and RFC 1869.This mod- ule contains a number of low-level functions and methods that are described in detail in the online documentation. However, the following covers the most useful parts of this module:\n\nF h Lib f L Bdff\n\n514\n\nChapter 22 Internet Application Programming\n\nSMTP([host [, port]])\n\nCreates an object representing a connection to an SMTP server. If hostis given, it specifies the name of the SMTP server. portis an optional port number.The default port is 25. If hostis supplied, the connect() method is called automatically. Otherwise, you will need to manually call connect() on the returned object to estab- lish the connection.\n\nAn instance sof SMTP has the following methods:\n\ns.connect([host [, port]])\n\nConnects to the SMTP server on host. If hostis omitted, a connection is made to the local host ('127.0.0.1'). portis an optional port number that defaults to 25 if omit- ted. It is not necessary to call connect() if a host name was given to SMTP().\n\ns.login(user, password)\n\nLogs into the server if authentication is required. useris a username, and passwordis a password.\n\ns.quit()\n\nTerminates the session by sending a 'QUIT' command to the server.\n\ns.sendmail(fromaddr, toaddrs, message)\n\nSends a mail message to the server. fromaddris a string containing the email address of the sender. toaddrsis a list of strings containing the email addresses of recipients. messageis a string containing a completely formatted RFC-822 compliant message. The email package is commonly used to create such messages. It is important to note that although messagecan be given as a text string, it should only contain valid ASCII characters with values in the range 0 to 127. Otherwise, you will get an encoding error. If you need to send a message in a different encoding such as UTF-8, encode it into a byte string first and supply the byte string as message.\n\nExample The following example shows how the module can be used to send a message:\n\nimport smtplib fromaddr = \"someone@some.com\" toaddrs = [\"recipient@other.com\"] msg = \"From: %s\\r\\nTo: %s\\r\\n\\r\\n\" % (fromaddr, \",\".join(toaddrs)) msg += \"\"\" Refinance your mortgage to buy stocks and Viagra! \"\"\"\n\nserver = smtplib.SMTP('localhost') server.sendmail(fromaddr, toaddrs, msg) server.quit()\n\nurllib Package The urllib package provides a high-level interface for writing clients that need to interact with HTTP servers, FTP servers, and local files.Typical applications include scraping data from web pages, automation, proxies, web crawlers, and so forth.This is one of the most highly configurable library modules, so every last detail is not presented here. Instead, the most common uses of the package are described.\n\nF h Lib f L Bdff\n\nurllib Package\n\n515\n\nIn Python 2, the urllib functionality is spread across several different library mod- ules including urllib, urllib2, urlparse, and robotparser. In Python 3, all of this functionality has been consolidated and reorganized under the urllib package.\n\nurllib.request (urllib2) The urllib.request module provides functions and classes to open and fetch data from URLs. In Python 2, this functionality is found in a module urllib2.\n\nThe most common use of this module is to fetch data from web servers using HTTP. For example, this code shows the easiest way to simply fetch a web page:\n\ntry:\n\nfrom urllib.request import urlopen # Python 3\n\nexcept ImportError:\n\nfrom urllib2 import urlopen # Python 2\n\nu = urlopen(\"http://docs.python.org/3.0/library/urllib.request.html\") data = u.read()\n\nOf course, many complexities arise when interacting with servers in the real world. For example, you might have to worry about proxy servers, authentication, cookies, user agents, and other matters.All of these are supported, but the code is more complicated (keep reading).\n\nurlopen() and Requests The most straightforward way to make a request is to use the urlopen() function.\n\nurlopen(url [, data [, timeout]])\n\nOpens the URL urland returns a file-like object that can be used to read the returned data. urlmay either be a string containing a URL or an instance of the Request class, described shortly. datais a URL-encoded string containing form data to be uploaded to the server.When supplied, the HTTP 'POST' method is used instead of 'GET' (the default). Data is generally created using a function such as urllib.parse.urlencode(). timeoutis an optional timeout in seconds for all blocking operations used internally.\n\nThe file-like object ureturned by urlopen() supports the following methods:\n\nMethod u.read([nbytes])\n\nu.readline()\n\nu.readlines()\n\nu.fileno()\n\nu.close()\n\nu.info()\n\nu.getcode()\n\nu.geturl()\n\nDescription Reads nbytesof data as a byte string. Reads a single line of text as a byte string. Reads all input lines and returns a list. Returns the integer file descriptor. Closes the connection. Returns a mapping object with meta-information associated with the URL. For HTTP, the HTTP headers included with the server response are returned. For FTP, the headers include 'content-length'. For local files, the headers include a date, 'content-length', and 'content-type' field. Returns the HTTP response code as an integer—for example, 200 for success or 404 for file not found. Returns the real URL of the returned data, taking into account any redirection that may have occurred.\n\nF h Lib f L Bdff\n\n516\n\nChapter 22 Internet Application Programming\n\nIt is important to emphasize that the file-like object uoperates in binary mode. If you need to process the response data as text, you will need to decode it using the codecs module or some other means.\n\nIf an error occurs during download, an URLError exception is raised.This includes\n\nerrors related to the HTTP protocol itself such as forbidden access or requests for authentication. For these kinds of errors, a server typically returns content that gives more descriptive information.To get this content, the exception instance itself operates as a file-like object that can be read. For example:\n\ntry:\n\nu = urlopen(\"http://www.python.org/perl.html\") resp = u.read() except HTTPError as e: resp = e.read()\n\nA very common error that arises with urlopen() is accessing web pages through a proxy server. For example, if your organization routes all web traffic through a proxy, requests may fail. If the proxy server doesn’t require any kind of authentication, you may be able to fix this by merely setting the HTTP_PROXY environment variable in the os.environ dictionary. For example, os.environ['HTTP_PROXY'] = 'http://example.com:12345'.\n\nFor simple requests, the urlparameter to urlopen() is a string such as\n\n'http://www.python.org'. If you need to do anything more complicated such as make modifications to HTTP request headers, create a Request instance and use that as the urlparameter.\n\nRequest(url [, data [, headers [, origin_req_host [, unverifiable]]]])\n\nCreates a new Request instance. urlspecifies the URL (for example, 'http://www.foo.bar/spam.html'). datais URL-encoded data to be uploaded to the server in HTTP requests.When this is supplied, it changes the HTTP request type from 'GET' to 'POST'. headersis a dictionary containing key-value mappings repre- senting the contents of the HTTP headers. origin_req_hostis set to the request-host of the transaction—typically it’s the host name from which the request is originating. unverifiableis set to True if the request is for an unverifiable URL.An unverifiable URL is informally defined as a URL not directly entered by the user—for instance, a URL embedded within a page that loads an image.The default value of unverifiable is False.\n\nAn instance rof Request has the following methods:\n\nr.add_data(data)\n\nAdds data to a request. If the request is an HTTP request, the method is changed to 'POST'. datais URL-encoded data as described for Request().This does not append datato any previously set data; it simply replaces the old data with data.\n\nr.add_header(key, val)\n\nAdds header information to the request. keyis the header name, and valis the header value. Both arguments are strings.\n\nF h Lib f L Bdff\n\nurllib Package\n\n517\n\nr.add_unredirected_header(key, val)\n\nAdds header information to a request that will not be added to redirected requests. key and valhave the same meaning as for add_header().\n\nr.get_data()\n\nReturns the request data (if any).\n\nr.get_full_url()\n\nReturns the full URL of a request.\n\nr.get_host()\n\nReturns the host to which the request will be sent.\n\nr.get_method()\n\nReturns the HTTP method, which is either 'GET' or 'POST'.\n\nr.get_origin_req_host()\n\nReturns the request-host of the originating transaction.\n\nr.get_selector()\n\nReturns the selector part of the URL (for example, '/index.html').\n\nr.get_type()\n\nReturns the URL type (for example, 'http').\n\nr.has_data()\n\nReturns True if data is part of the request.\n\nr.is_unverifiable()\n\nReturns True if the request is unverifiable.\n\nr.has_header(header)\n\nReturns True if the request has header header.\n\nr.set_proxy(host, type)\n\nPrepares the request for connecting to a proxy server.This replaces the original host with hostand the original type of the request with type.The selector part of the URL is set to the original URL.\n\nHere is an example that uses a Request object to change the 'User-Agent' header used by urlopen().You might use this if you wanted a server to think you were mak- ing a connection from Internet Explorer, Firefox, or some other browser.\n\nheaders = {\n\n'User-Agent':\n\n'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR 2.0.50727)'\n\n}\n\nr = Request(\"http://somedomain.com/\",headers=headers) u = urlopen(r)\n\nF h Lib f L Bdff\n\n518\n\nChapter 22 Internet Application Programming\n\nCustom Openers The basic urlopen() function does not provide support for authentication, cookies, or other advanced features of HTTP. To add support, you must create your own custom opener object using the build_opener() function:\n\nbuild_opener([handler1 [, handler2, ... ]])\n\nBuilds a custom opener object for opening URLs.The arguments handler1, handler2, and so on are all instances of special handler objects.The purpose of these handlers is to add various capabilities to the resulting opener object.The following lists all the available handler objects:\n\nHandler CacheFTPHandler\n\nFileHandler\n\nFTPHandler\n\nHTTPBasicAuthHandler\n\nHTTPCookieProcessor\n\nHTTPDefaultErrorHandler\n\nHTTPDigestAuthHandler\n\nHTTPHandler\n\nHTTPRedirectHandler\n\nHTTPSHandler\n\nProxyHandler\n\nProxyBasicAuthHandler\n\nProxyDigestAuthHandler\n\nDescription FTP handler with persistent FTP connections Opens local files Opens URLs via FTP Basic HTTP authentication handling Processing of HTTP cookies Handles HTTP errors by raising an HTTPError excep- tion HTTP digest authentication handling Opens URLs via HTTP Handles HTTP redirects Opens URLs via secure HTTP Redirects requests through a proxy Basic proxy authentication Digest proxy authentication Handler that deals with all unknown URLs\n\nUnknownHandler\n\nBy default, an opener is always created with the handlers ProxyHandler, UnknownHandler, HTTPHandler, HTTPSHandler, HTTPDefaultErrorHandler, HTTPRedirectHandler, FTPHandler, FileHandler, and HTTPErrorProcessor.These handlers provide a basic level of functionality. Extra handlers supplied as arguments are added to this list. However, if any of the extra handlers are of the same type as the defaults, they take precedence. For example, if you added an instance of HTTPHandler or some class that derived from HTTPHandler, it would be used instead of the default. The object returned by build_opener() has a method, open(url [, data [, timeout]]), that is used to open URLs according to all the rules provided by the vari- ous handlers.The arguments to open() are the same as what are passed to the urlopen() function.\n\ninstall_opener(opener)\n\nInstalls a different opener object for use as the global URL opener used by urlopen(). openeris usually of an opener object created by build_opener().\n\nThe next few sections show how to create custom openers for some of the more\n\ncommon scenarios that arise when using urlib.request module.\n\nF h Lib f L Bdff\n\nurllib Package\n\n519\n\nPassword Authentication To handle requests involving password authentication, you create an opener with some combination of HTTPBasicAuthHandler, HTTPDigestAuthHandler, ProxyBasicAuthHandler, or ProxyDigestAuthHandler handlers added to it. Each of these handlers has the following method which can be used to set password:\n\nh.add_password(realm, uri, user, passwd)\n\nAdds user and password information for a given realm and URI.All parameters are strings. urican optionally be a sequence of URIs, in which case the user and password information is applied to all the URIs in the sequence.The realmis a name or descrip- tion associated with the authentication. Its value depends on the remote server. However, it’s usually a common name associated with a collection of related web pages. uriis a base URL associated with the authentication. Typical values for realmand uri might be something like ('Administrator', 'http://www.somesite.com'). user and passwordspecify a username and password, respectively.\n\nHere is an example of how to set up an opener with basic authentication:\n\nauth = HTTPBasicAuthHandler() auth.add_password(\"Administrator\",\"http://www.secretlair.com\",\"drevil\",\"12345\")\n\n# Create opener with authentication added opener = build_opener(auth)\n\n# Open URL u = opener.open(\"http://www.secretlair.com/evilplan.html\")\n\nHTTP Cookies To manage HTTP cookies, create an opener object with an HTTPCookieProcessor handler added to it. For example:\n\ncookiehand = HTTPCookieProcessor() opener = build_opener(cookiehand) u = opener.open(\"http://www.example.com/\")\n\nBy default, the HTTPCookieProcessor uses the CookieJar object found in the http.cookiejar module. Different types of cookie processing can be supported by supplying a different CookieJar object as an argument to HTTPCookieProcessor. For example:\n\ncookiehand = HTTPCookieProcessor(\n\nhttp.cookiejar.MozillaCookieJar(\"cookies.txt\")\n\n)\n\nopener = build_opener(cookiehand) u = opener.open(\"http://www.example.com/\")\n\nProxies If requests need to be redirected through a proxy, create an instance of ProxyHandler.\n\nProxyHandler([proxies])\n\nCreates a proxy handler that routes requests through a proxy.The argument proxiesis a dictionary that maps protocol names (for example, 'http', 'ftp', and so on) to the URLs of the corresponding proxy server.\n\nF h Lib f L Bdff\n\n520\n\nChapter 22 Internet Application Programming\n\nThe following example shows how to use this:\n\nproxy = ProxyHandler({'http': 'http://someproxy.com:8080/'} auth = HTTPBasicAuthHandler() auth.add_password(\"realm\",\"host\", \"username\", \"password\") opener = build_opener(proxy, auth)\n\nu = opener.open(\"http://www.example.com/doc.html\")\n\nurllib.response This is an internal module that implements the file-like objects returned by functions in the urllib.request module.There is no public API.\n\nurllib.parse The urllib.parse module is used to manipulate URL strings such as \"http://www.python.org\".\n\nURL Parsing (urlparse Module in Python 2) The general form of a URL is \"scheme://netloc/ path;parameters?query#fragment\". In addition, the netlocpart of a URL may include a port number such as \"hostname:port\" or user authentication information such as \"user:pass@hostname\".The following function is used to parse a URL:\n\nurlparse(urlstring [, default_scheme [, allow_fragments]])\n\nParses the URL in urlstring and returns a ParseResult instance. default_scheme specifies the scheme (\"http\", \"ftp\", and so on) to be used if none is present in the URL. If allow_fragmentsis zero, fragment identifiers are not allowed.A ParseResult instance ris a named tuple the form (scheme, netloc, path, parameters, query, fragment). However, the following read-only attributes are also defined:\n\nDescription URL scheme specifier (for example, 'http') Netloc specifier (for example, 'www.python.org') Hierarchical path (for example, '/index.html') Parameters for the last path element Query string (for example, 'name=Dave&id=42') Fragment identifier without the leading '#' r.fragment r.username Username component if the netloc specifier is of the form\n\nAttribute r.scheme\n\nr.netloc\n\nr.path\n\nr.params\n\nr.query\n\n'username:password@hostname' Password component from the netloc specifier\n\nr.password r.hostname Host name component from the netloc specifier r.port\n\nPort number from the netloc specifier if it is of the form 'hostname:port'\n\nA ParseResult instance can be turned back into a URL string using r.geturl().\n\nF h Lib f L Bdff\n\nurllib Package\n\n521\n\nurlunparse(parts)\n\nConstructs a URL string from a tuple-representation of a URL as returned by urlparse(). partsmust be a tuple or iterable with six components.\n\nurlsplit(url [, default_scheme [, allow_fragments]])\n\nThe same as urlparse() except that the parametersportion of a URL is left unmodified in the path.This allows for parsing of URLs where parameters might be attached to individual path components such as 'scheme://netloc/path1;param1/path2;param2/path3?query#fragment'.The result is an instance of SplitResult, which is a named tuple containing (scheme, netloc, path, query, fragment).The following read-only attributes are also defined:\n\nAttribute r.scheme\n\nr.netloc\n\nr.path\n\nr.query\n\nr.fragment\n\nr.username\n\nr.password\n\nr.hostname\n\nr.port\n\nDescription URL scheme specifier (for example, 'http') Netloc specifier (for example, 'www.python.org') Hierarchical path (for example, '/index.html') Query string (for example, 'name=Dave&id=42') Fragment identifier without the leading '#' Username component if the netloc specifier is of the form 'username:password@hostname' Password component from the netloc specifier Host name component from the netloc specifier Port number from the netloc specifier if it is of the form 'hostname:port'\n\nA SplitResult instance can be turned back into a URL string using r.geturl().\n\nurlunsplit(parts)\n\nConstructs a URL from the tuple-representation created by urlsplit(). partsis a tuple or iterable with the five URL components.\n\nurldefrag(url)\n\nReturns a tuple (newurl, fragment) where newurlis urlstripped of fragments and fragmentis a string containing the fragment part (if any). If there are no fragments in url, then newurlis the same as urland fragmentis an empty string.\n\nurljoin(base, url [, allow_fragments])\n\nConstructs an absolute URL by combining a base URL, base, with a relative URL. url. allow_fragmentshas the same meaning as for urlparse(). If the last compo- nent of the base URL is not a directory, it’s stripped.\n\nparse_qs(qs [, keep_blank_values [, strict_parsing]])\n\nParses a URL-encoded (MIME type application/x-www-form-urlencoded) query string qsand returns a dictionary where the keys are the query variable names and the values are lists of values defined for each name. keep_blank_valuesis a Boolean flag\n\nF h Lib f L Bdff\n\n522\n\nChapter 22 Internet Application Programming\n\nthat controls how blank values are handled. If True, they are included in the dictionary with a value set to the empty string. If False (the default), they are discarded. strict_parsingis a Boolean flag that if True, turns parsing errors into a ValueError exception. By default, errors are silently ignored.\n\nparse_qsl(qs [, keep_blank_values [, strict_parsing]])\n\nThe same as parse_qs() except that the result is a list of pairs (name, value) where nameis the name of a query variable and valueis the value.\n\nURL Encoding (urllib Module in Python 2) The following functions are used to encode and decode data that make up URLs.\n\nquote(string [, safe [, encoding [, errors]]])\n\nReplaces special characters in stringwith escape sequences suitable for including in a URL. Letters, digits, and the underscore ( _ ), comma (,), period (.), and hyphen ( - ) characters are unchanged.All other characters are converted into escape sequences of the form '%xx'. safeprovides a string of additional characters that should not be quoted and is '/' by default. encodingspecifies the encoding to use for non-ASCII characters. By default, it is 'utf-8'. errorsspecifies what to do when encoding errors are encountered and is 'strict' by default.The encodingand errorsparameters are only available in Python 3.\n\nquote_plus(string [, safe [, encoding [, errors]]])\n\nCalls quote() and additionally replaces all spaces with plus signs. stringand safeare the same as in quote(). encodingand errorsare the same as with quote().\n\nquote_from_bytes(bytes [, safe])\n\nThe same as quote() but accepts a byte-string and performs no encoding.The return result is a text string. Python 3 only.\n\nunquote(string [, encoding [, errors]])\n\nReplaces escape sequences of the form '%xx' with their single-character equivalent. encodingand errorsspecify the encoding and error handling for decoding data in '%xx' escapes.The default encoding is 'utf-8', and the default errorspolicy is 'replace'. encodingand errorsare Python 3 only.\n\nunquote_plus(string [, encoding [, errors]])\n\nLike unquote() but also replaces plus signs with spaces.\n\nunquote_to_bytes(string)\n\nThe same as unquote() but performs no decoding and returns a byte string.\n\nurlencode(query [, doseq])\n\nConverts query values in queryto a URL-encoded string suitable for inclusion as the queryparameter of a URL or for uploading as part of a POST request. queryis either a dictionary or a sequence of (key, value) pairs.The resulting string is a series of 'key=value' pairs separated by '&' characters, where both keyand valueare quoted using quote_plus().The doseqparameter is a Boolean flag that should be set to True if any valuein queryis a sequence, representing multiple values for the same key. In this case, a separate 'key=v' string is created for each vin value.\n\nF h Lib f L Bdff\n\nurllib Package\n\n523\n\nExamples The following examples show how to turn a dictionary of query variables into a URL suitable for use in an HTTP GET request and how you can parse a URL:\n\ntry:\n\nfrom urllib.parse import urlparse, urlencode, parse_qsl # Python 3\n\nexcept ImportError:\n\nfrom urlparse import urlparse, parse_qsl # Python 2 from urllib import urlencode\n\n# Example of creating a URL with properly encoded query varibles form_fields = {\n\n'name' : 'Dave', 'email' : 'dave@dabeaz.com', 'uid' : '12345'\n\n} form_data = urlencode(form_fields) url = \"http://www.somehost.com/cgi-bin/view.py?\"+form_data\n\n# Example of parsing a URL into components r = urlparse(url) print(r.scheme) # 'http' print(r.netloc) # 'www.somehost.com' print(r.path) # '/cgi-bin/view.py' print(r.params) # '' print(r.query) # 'uid=12345&name=Dave&email=dave%40dabeaz.com' print(r.fragment) # ''\n\n# Extract query data parsed_fields = dict(parse_qsl(r.query)) assert form_fields == parsed_fields\n\nurllib.error The urllib.error module defines exceptions used by the urllib package.\n\nContentTooShort\n\nRaised when the amount of downloaded data is less than the expected amount (as defined by the 'Content-Length' header). Defined in the urllib module in Python 2.\n\nHTTPError\n\nRaised to indicate problems with the HTTP protocol.This error may be used to signal events such as authentication required.This exception can also be used as a file object to read the data returned by the server that’s associated with the error.This is a subclass of URLError. It is defined in the urllib2 module in Python 2.\n\nURLError\n\nError raised by handlers when a problem is detected.This is a subclass of IOError.The reason attribute of the exception instance has more information about the problem. This is defined in the urllib2 module in Python 2.\n\nurllib.robotparser (robotparser) The urllib.robotparser module (robotparser in Python 2) is used to fetch and parse the contents of 'robots.txt' files used to instruct web crawlers. Consult the online documentation for further usage information.\n\nF h Lib f L Bdff\n\n524\n\nChapter 22 Internet Application Programming\n\nNotes\n\nn Advanced users of the urllib package can customize its behavior in almost every way imaginable.This includes creating new kinds of openers, handlers, requests, protocols, etc.This topic is beyond the scope of what can be covered here, but the online documentation has some further details.\n\nn Users of Python 2 should take note that the urllib.urlopen() function, which is in widespread use, is officially deprecated in Python 2.6 and eliminated in Python 3. Instead of using urllib.urlopen(), you should use urllib2.urlopen(), which provides the same functionality as urllib.request.urlopen() described here.\n\nxmlrpc Package The xmlrpc package contains modules for implement XML-RPC servers and clients. XML-RPC is a remote procedure call mechanism that uses XML for data encoding and HTTP as a transport mechanism.The underlying protocol is not specific to Python so programs using these modules can potentially interact with programs written in other languages. More information about XML-RPC can be obtained at http://www. xmlrpc.com.\n\nxmlrpc.client (xmlrpclib) The xmlrpc.client module is used to write XML-RPC clients. In Python 2, this module is called xmlrpclib.To operate as a client, you create an instance of ServerProxy:\n\nServerProxy(uri [, transport [, encoding [, verbose [, allow_none [, use_datetime]]]])\n\nuriis the location of the remote XML-RPC server—for example, \"http://www. foo.com/RPC2\". If necessary, basic authentication information can be added to the URI using the format \"http://user:pass@host:port/path\", where user:passis the username and password.This information is base-64 encoded and put in an 'Authorization:' header on transport. If Python is configured with OpenSSL sup- port, HTTPS can also be used. transportspecifies a factory function for creating an internal transport object used for low-level communication.This argument is only used if XML-RPC is being used over some kind of connection other than HTTP or HTTPS. It is almost never necessary to supply this argument in normal use (consult the online documentation for details). encodingspecifies the encoding, which is UTF-8 by default. verbosedisplays some debugging information if True. allow_none, if True, allows the value None to be sent to remote servers. By default, this is disabled because it’s not universally supported. use_datetimeis a Boolean flag that if set to True, uses the datetime module to represent dates and times. By default, this is False.\n\nAn instance, s, of ServerProxy transparently exposes all the methods on the remote server.The methods are accessed as attributes of s. For example, this code gets the cur- rent time from a remote server providing that service:\n\n>>> s = ServerProxy(\"http://www.xmlrpc.com/RPC2\") >>> s.currentTime.getCurrentTime() <DateTime u'20051102T20:08:24' at 2c77d8> >>>\n\nF h Lib f L Bdff",
      "page_number": 531
    },
    {
      "number": 27,
      "title": "Segment 27 (pages 549-570)",
      "start_page": 549,
      "end_page": 570,
      "detection_method": "synthetic",
      "content": "xmlrpc Package\n\n525\n\nFor the most part, RPC calls work just like ordinary Python functions. However, only a limited number of argument types and return values are supported by the XML-RPC protocol:\n\nXML-RPC Type boolean integer float string array structure dates binary\n\nPython Equivalent True and False int float string or unicode (must only contain characters valid in XML) Any sequence containing valid XML-RPC types Dictionary containing string keys and values of valid types Date and time (xmlrpc.client.DateTime) Binary data (xmlrpc.client.Binary)\n\nWhen dates are received, they are stored in an xmlrpc.client.DateTime instance d. The d.value attribute contains the date as an ISO 8601 time/date string.To convert it into a time tuple compatible with the time module, use d.timetuple().When binary data is received, it is stored in an xmlrpc.client.Binary instance b.The b.data attribute contains the data as a byte string. Be aware that strings are assumed to be Unicode and that you will have to worry about using proper encodings. Sending raw Python 2 byte strings will work if they contain ASCII but will break otherwise.To deal with this, convert to a Unicode string first.\n\nIf you make an RPC call with arguments involving invalid types, you may get a\n\nTypeError or an xmlrpclib.Fault exception.\n\nIf the remote XML-RPC server supports introspection, the following methods may\n\nbe available:\n\ns.system.listMethods()\n\nReturns a list of strings listing all the methods provided by the XML-RPC server.\n\ns.methodSignatures(name)\n\nGiven the name of a method, name, returns a list of possible calling signatures for the method. Each signature is a list of types in the form of a comma-separated string (for example, 'string, int, int'), where the first item is the return type and the remaining items are argument types. Multiple signatures may be returned due to over- loading. In XML-RPC servers implemented in Python, signatures are typically empty because functions and methods are dynamically typed.\n\ns.methodHelp(name)\n\nGiven the name of a method, name, returns a documentation string describing the use of that method. Documentation strings may contain HTML markup.An empty string is returned if no documentation is available.\n\nThe following utility functions are available in the xmlrpclib module:\n\nboolean(value)\n\nCreates an XML-RPC Boolean object from value.This function predates the exis- tence of the Python Boolean type, so you may see it used in older code.\n\nF h Lib f L Bdff\n\n526\n\nChapter 22 Internet Application Programming\n\nBinary(data)\n\nCreates an XML-RPC object containing binary data. datais a string containing the raw data. Returns a Binary instance.The returned Binary instance is transparently encoded/decoded using base 64 during transmission.To extract binary from Binary instance b, use b.data.\n\nDateTime(daytime)\n\nCreates an XML-RPC object containing a date. daytimeis either an ISO 8601 format date string, a time tuple or struct as returned by time.localtime(), or a datetime instance from the datetime module.\n\ndumps(params [, methodname [, methodresponse [, encoding [, allow_none]]]])\n\nConverts paramsinto an XML-RPC request or response, where paramsis either a tuple of arguments or an instance of the Fault exception. methodnameis the name of the method as a string. methodresponseis a Boolean flag. If True, then the result is an XML-RPC response. In this case, only one value can be supplied in params. encoding specifies the text encoding in the generated XML and defaults to UTF-8. allow_none is a flag that specifies whether or not None is supported as a parameter type. None is not explicitly mentioned by the XML-RPC specification, but many servers support it. By default, allow_noneis False.\n\nloads(data)\n\nConverts datacontaining an XML-RPC request or response into a tuple (params, methodname) where paramsis a tuple of parameters and methodnameis a string con- taining the method name. If the request represents a fault condition instead of an actual value, then the Fault exception is raised.\n\nMultiCall(server)\n\nCreates a MultiCall object that allows multiple XML-RPC requests to be packaged together and sent as a single request.This can be a useful performance optimization if many different RPC requests need to be made on the same server. serveris an instance of ServerProxy, representing a connection to a remote server.The returned MultiCall object is used in exactly the same way as ServerProxy. However, instead of immediately executing the remote methods, the method calls as queued until the MultiCall object is called as a function. Once this occurs, the RPC requests are trans- mitted.The return value of this operation is a generator that yields the return result of each RPC operation in sequence. Note that MultiCall() only works if the remote server provides a system.multicall() method.\n\nHere is an example that illustrates the use of MultiCall:\n\nmulti = MultiCall(server) multi.foo(4,6,7) # Remote method foo multi.bar(\"hello world\") # Remote method bar multi.spam() # Remote method spam # Now, actually send the XML-RPC request and get return results foo_result, bar_result, spam_result = multi()\n\nF h Lib f L Bdff\n\nxmlrpc Package\n\n527\n\nExceptions The following exceptions are defined in xmlrpc.client:\n\nFault\n\nIndicates an XML-RPC fault.The faultCode attribute contains a string with the fault type.The faultString attribute contains a descriptive message related to the fault.\n\nProtocolError\n\nIndicates a problem with the underlying networking—for example, a bad URL or a connection problem of some kind.The url attribute contains the URI that triggered the error.The errcode attribute contains an error code.The errmsg attribute contains a descriptive string.The headers attribute contains all the HTTP headers of the request that triggered the error.\n\nxmlrpc.server (SimpleXMLRPCServer, DocXMLRPCServer) The xmlrpc.server module contains classes for implementing different variants of XML-RPC servers. In Python 2, this functionality is found in two separate modules: SimpleXMLRPCServer and DocXMLRPCServer.\n\nSimpleXMLRPCServer(addr [, requestHandler [, logRequests]])\n\nCreates an XML-RPC server listening on the socket address addr(for example, ('localhost',8080)). requestHandleris factory function that creates handler request objects when connections are received. By default, it is set to SimpleXMLRPCRequestHandler, which is currently the only available handler. logRequestsis a Boolean flag that indicates whether or not to log incoming requests. The default value is True.\n\nDocXMLRPCServer(addr [, requestHandler [, logRequest])\n\nCreates a documenting XML-RPC that additionally responds to HTTP GET requests (normally sent by a browser). If received, the server generates documentation from the documentation strings found in all of the registered methods and objects.The arguments have the same meaning as for SimpleXMLRPCServer.\n\nAn instance, s, of SimpleXMLRPCServer or DocXMLRPCServer has the following\n\nmethods:\n\ns.register_function(func [, name])\n\nRegisters a new function, func, with the XML-RPC server. nameis an optional name to use for the function. If nameis supplied, it’s the name clients will use to access the function.This name may contain characters that are not part of valid Python identifiers, including periods (.). If nameis not supplied, then the actual function name of funcis used instead.\n\ns.register_instance(instance [, allow_dotted_names])\n\nRegisters an object that’s used to resolve method names not registered with the register_function() method.If the instance instancedefines the method _dispatch(self, methodname, params),it is called to process requests.methodnameis the name of the method,and paramsis a tuple containing arguments.The return value of _dispatch() is returned to clients.If no _dispatch() method is defined,the instance is\n\nF h Lib f L Bdff\n\n528\n\nChapter 22 Internet Application Programming\n\nchecked to see if the method name matches the names of any methods defined for instance.If so,the method is called directly.The allow_dotted_namesparameter is a flag that indicates whether a hierarchical search should be performed when checking for method names.For example,if a request for method 'foo.bar.spam' is received,this determines whether or not a search for instance.foo.bar.spam is made.By default,this is False.It should not be set to True unless the client has been verified.Otherwise,it opens up a security hole that can allow intruders to execute arbitrary Python code.Note that,at most,only one instance can be registered at a time.\n\ns.register_introspection_functions()\n\nAdds XML-RPC introspection functions system.listMethods(), system.methodHelp(), and system.methodSignature() to the XML-RPC server. system.methodHelp() returns the documentation string for a method (if any).The system.methodSignature() function simply returns a message indicating that the operation is unsupported (because Python is dynamically typed, type information is available).\n\ns.register_multicall_functions()\n\nAdds XML-RPC multicall function support by adding the system.multicall() function to the server.\n\nAn instance of DocXMLRPCServer additionally provides these methods:\n\ns.set_server_title(server_title)\n\nSets the title of the server in HTML documentation.The string is placed in the HTML <title> tag.\n\ns.set_server_name(server_name)\n\nSets the name of the server in HTML documentation.The string appears at the top of the page in an <h1> tag.\n\ns.set_server_documentation(server_documentation)\n\nAdds a descriptive paragraph to the generated HTML output.This string is added right after the server name, but before a description of the XML-RPC functions.\n\nAlthough it is common for an XML-RPC server to operate as a stand-alone process,\n\nit can also run inside a CGI script.The following classes are used for this:\n\nCGIXMLRPCRequestHandler([allow_none [, encoding]])\n\nA CGI Request handler that operates in the same manner as SimpleXMLRPCServer. The arguments have the same meaning as described for SimpleXMLRPCServer.\n\nDocCGIXMLRPCRequestHandler()\n\nA CGI Request handler that operates in the same manner as DocXMLRPCServer. Please note that as of this writing, the calling arguments are different than CGIXMLRPCRequestHandler().This might be a Python bug so you should consult the online documentation in future releases.\n\nAn instance, c, of either CGI handler has the same methods as a normal XML-RPC server for registering functions and instances. However, they additionally define the fol- lowing method:\n\nF h Lib f L Bdff\n\nxmlrpc Package\n\n529\n\nc.handle_request([request_text])\n\nProcesses an XML-RPC request. By default, the request is read from standard input. If request_textis supplied, it contains the request data in the form received by an HTTP POST request.\n\nExamples Here is a very simple example of writing a standalone server. It adds a single function, add. In addition, it adds the entire contents of the math module as an instance, exposing all the functions it contains.\n\ntry:\n\nfrom xmlrpc.server import SimpleXMLRPCServer # Python 3\n\nexcept ImportError:\n\nfrom SimpleXMLRPCServer import SimpleXMLRPCServer # Python 2\n\nimport math\n\ndef add(x,y):\n\n\"Adds two numbers\" return x+y\n\ns = SimpleXMLRPCServer(('',8080)) s.register_function(add) s.register_instance(math) s.register_introspection_functions() s.serve_forever()\n\nHere is the same functionality implemented as CGI-script:\n\ntry:\n\nfrom xmlrpc.server import CGIXMLRPCRequestHandler # Python 3\n\nexcept ImportError:\n\nfrom SimpleXMLRPCServer import CGIXMLRPCRequestHandler # Python 2\n\nimport math\n\ndef add(x,y):\n\n\"Adds two numbers\" return x+y\n\ns = CGIXMLRPCRequestHandler() s.register_function(add) s.register_instance(math) s.register_introspection_functions() s.handle_request()\n\nTo access XML-RPC functions from other Python programs, use the xmlrpc.client or xmlrpclib module. Here is a short interactive session that shows how it works:\n\n>>> from xmlrpc.client import ServerProxy >>> s = ServerProxy(\"http://localhost:8080\") >>> s.add(3,5) 8 >>> s.system.listMethods() ['acos', 'add', 'asin', 'atan', 'atan2', 'ceil', 'cos', 'cosh', 'degrees', 'exp', 'fabs', 'floor', 'fmod', 'frexp', 'hypot', 'ldexp', 'log', 'log10', 'modf', 'pow', 'radians', 'sin', 'sinh', 'sqrt', 'system.listMethods', 'system.methodHelp', 'system.methodSignature', 'tan', 'tanh'] >>> s.tan(4.5) 4.6373320545511847 >>>\n\nF h Lib f L Bdff\n\n530\n\nChapter 22 Internet Application Programming\n\nAdvanced Server Customization The XML-RPC server modules are easy to use for basic kinds of distributed comput- ing. For example, XML-RPC could be used as a protocol for high-level control of other systems on the network, provided they were all running a suitable XML-RPC server. More interesting objects can also be passed between systems if you additionally use the pickle module.\n\nOne concern with XML-RPC is that of security. By default, an XML-RPC server runs as an open service on the network, so anyone who knows the address and port of the server can connect to it (unless it’s shielded by a firewall). In addition, XML-RPC servers place no limit on the amount of data that can be sent in a request.An attacker could potentially crash the server by sending an HTTP POST request with a payload so large as to exhaust memory.\n\nIf you want to address any of these issues, you will need to customize the XML- RPC server classes or request handlers.All of the server classes inherit from TCPServer in the socketserver module.Thus, the servers can be customized in the same manner as other socket server classes (for example, adding threading, forking, or validating client addresses).A validation wrapper can be placed around the request handlers by inheriting from SimpleXMLRPCRequestHandler or DocXMLRPCRequestHandler and extending the do_POST() method. Here is an example that limits the size of incoming requests:\n\ntry:\n\nfrom xmlrpc.server import (SimpleXMLRPCServer,\n\nSimpleXMLRPCRequestHandler)\n\nexcept ImportError:\n\nfrom SimpleXMLRPCServer import (SimpleXMLRPCServer,\n\nSimpleXMLRPCRequestHandler)\n\nclass MaxSizeXMLRPCHandler(SimpleXMLRPCRequestHandler):\n\nMAXSIZE = 1024*1024 # 1MB def do_POST(self):\n\nsize = int(self.headers.get('content-length',0)) if size >= self.MAXSIZE:\n\nself.send_error(400,\"Bad request\")\n\nelse:\n\nSimpleXMLRPCRequestHandler.do_POST(self)\n\ns = SimpleXMLRPCServer(('',8080),MaxSizeXMLRPCHandler)\n\nIf you wanted to add any kind of HTTP-based authentication, it could also be imple- mented in a similar manner.\n\nF h Lib f L Bdff\n\n23\n\nWeb Programming\n\nPython is widely used when building websites and serves several different roles in this\n\ncapacity. First, Python scripts are often a useful way to simply generate a set of static HTML pages to be delivered by a web server. For example, a script can be used to take raw content and decorate it with additional features that you typically see on a website (navigation bars, sidebars, advertisements, stylesheets, etc.).This is mainly just a matter of file handling and text processing—topics that have been covered in other sections of the book.\n\nSecond, Python scripts are used to generate dynamic content. For example, a website might operate using a standard webserver such as Apache but would use Python scripts to dynamically handle certain kinds of requests.This use of Python is primarily associat- ed with form processing. For example, an HTML page might include a form like this:\n\n<FORM ACTION='/cgi-bin/subscribe.py' METHOD='GET'> Your name : <INPUT type='Text' name='name' size='30'> Your email address: <INPUT type='Text' name='email' size='30'> <INPUT type='Submit' name='submit-button' value='Subscribe'> </FORM>\n\nWithin the form, the ACTION attribute names a Python script 'subscribe.py' that will execute on the server when the form is submitted.\n\nAnother common scenario involving dynamic content generation is with AJAX (Asynchronous Javascript and XML).With AJAX, JavaScript event handlers are associat- ed with certain HTML elements on a page. For example, when the mouse hovers over a specific document element, a JavaScript function might execute and send an HTTP request to the webserver that gets processed (possibly by a Python script).When the associated response is received, another JavaScript function executes to process the response data and displays the result.There are many ways in which results might be returned. For example, a server might return data as plaintext, XML, JSON, or any number of other formats. Here is an example HTML document that illustrates one way to implement a hover popup where moving the mouse over selected elements causes a popup window to appear.\n\n<html>\n\n<head>\n\n<title>ACME Officials Quiet After Corruption Probe</title> <style type=\"text/css\">\n\n.popup { border-bottom:1px dashed green; } .popup:hover { background-color: #c0c0ff; }\n\n</style>\n\n</head> <body>\n\nF h Lib f L Bdff\n\n532\n\nChapter 23 Web Programming\n\n<span id=\"popupbox\"\n\nstyle=\"visibility:hidden; position:absolute; background-color:\n\n#ffffff;\">\n\n<span id=\"popupcontent\"></span>\n\n</span> <script>\n\n/* Get a reference to the popup box element */ var popup = document.getElementById(\"popupbox\"); var popupcontent = document.getElementById(\"popupcontent\");\n\n/* Get pop-up data from the server and display when received */ function ShowPopup(hoveritem,name) {\n\nvar request = new XMLHttpRequest(); request.open(\"GET\",\"cgi-bin/popupdata.py?name=\"+name, true); request.onreadystatechange = function() {\n\nvar done = 4, ok = 200; if (request.readyState == done && request.status == ok) {\n\nif (request.responseText) {\n\npopupcontent.innerHTML = request.responseText; popup.style.left = hoveritem.offsetLeft+10; popup.style.top = hoveritem.offsetTop+20; popup.style.visibility = \"Visible\";\n\n}\n\n}\n\n}; request.send();\n\n}\n\n/* Hide the popup box */ function HidePopup() {\n\npopup.style.visibility = \"Hidden\";\n\n}\n\n</script>\n\n<h3>ACME Officials Quiet After Corruption Probe</h3> <p> Today, shares of ACME corporation (<span class=\"popup\" onMouseOver=\"ShowPopup(this,'ACME');\"\n\nonMouseOut=\"HidePopup();\">ACME</span>)\n\nplummetted by more than 75% after federal investigators revealed that the board of directors is the target of a corruption probe involving the Governor, state lottery officials, and the archbishop.\n\n</p>\n\n</body>\n\n</html>\n\nIn this example, the JavaScript function ShowPopup() initiates a request to a Python script popupdata.py on the server.The result of this script is just a fragment of HTML, which is then displayed in a popup window. Figure 23.1 shows what this might look like in the browser.\n\nFinally, the entire website might run under the control of Python within the context\n\nof a framework written in Python. It has been humorously noted that Python has “more web programming frameworks than language keywords.”The topics of web frameworks is far beyond the scope of this book, but http://wiki.python.org/ moin/WebFrameworks is a good starting point for finding more information.\n\nF h Lib f L Bdff\n\ncgi\n\n533\n\nFigure 23.1 Possible browser display where the background text is just an ordinary HTML document and the pop-up window is dynamically generated by the popupdata.py script.\n\nThe rest of this chapter describes built-in modules related to the low-level interface\n\nby which Python interfaces with webservers and frameworks.Topics include CGI scripting, a technique used to access Python from third-party web servers and WSGI, a middleware layer used for writing components that integrate with Python’s various web frameworks.\n\ncgi The cgi module is used to implement CGI scripts, which are programs typically execut- ed by a webserver when it wants to process user input from a form or generate dynam- ic content of some kind.\n\nWhen a request corresponding to a CGI script is submitted, the webserver executes\n\nthe CGI program as a subprocess. CGI programs receive input from two sources: sys.stdin and environment variables set by the server.The following list details com- mon environment variables set by webservers:\n\nVariable AUTH_TYPE\n\nCONTENT_LENGTH\n\nCONTENT_TYPE\n\nDOCUMENT_ROOT\n\nGATEWAY_INTERFACE\n\nHTTP_ACCEPT\n\nHTTP_COOKIE\n\nHTTP_FROM\n\nHTTP_REFERER\n\nHTTP_USER_AGENT\n\nPATH_INFO\n\nPATH_TRANSLATED\n\nQUERY_STRING\n\nREMOTE_ADDR\n\nDescription Authentication method Length of data passed in sys.stdin Type of query data Document root directory CGI revision string MIME types accepted by the client Netscape persistent cookie value Email address of client (often disabled) Referring URL Client browser Extra path information passed Translated version of PATH_INFO Query string Remote IP address of the client Remote host name of the client\n\nREMOTE_HOST\n\nF h Lib f L Bdff\n\n534\n\nChapter 23 Web Programming\n\nVariable REMOTE_IDENT\n\nREMOTE_USER\n\nREQUEST_METHOD\n\nSCRIPT_NAME\n\nSERVER_NAME\n\nSERVER_PORT\n\nSERVER_PROTOCOL\n\nDescription User making the request Authenticated username Method ('GET' or 'POST') Name of the program Server host name Server port number Server protocol Name and version of the server software\n\nSERVER_SOFTWARE\n\nAs output, a CGI program writes to standard output sys.stdout.The gory details of CGI programming can be found in a book such as CGI Programming with Perl, 2nd Edition, by Shishir Gundavaram (O’Reilly & Associates, 2000). For our purposes, there are really only two things to know. First, the contents of an HTML form are passed to a CGI program in a sequence of text known as a query string. In Python, the contents of the query string are accessed using the FieldStorage class. For example:\n\nimport cgi form = cgi.FieldStorage() name = form.getvalue('name') # Get 'name' field from a form email = form.getvalue('email') # Get 'email' field from a form\n\nSecond, the output of a CGI program consists of two parts: an HTTP header and the raw data (which is typically HTML).A blank line always separates these two compo- nents.A simple HTTP header looks like this:\n\nprint 'Content-type: text/html\\r' # HTML Output print '\\r' # Blank line (required!)\n\nThe rest of the output is the raw output. For example:\n\nprint '<TITLE>My CGI Script</TITLE>' print '<H1>Hello World!</H1>' print 'You are %s (%s)' % (name, email)\n\nIt is standard practice that HTTP headers are terminated using the Windows line- ending convention of '\\r\\n'.That is why the '\\r' appears in the example. If you need to signal an error, include a special 'Status:' header in the output. For example:\n\nprint 'Status: 401 Forbidden\\r' # HTTP Error code print 'Content-type: text/plain\\r' print '\\r' # Blank line (required) print 'You're not worthy of accessing this page!'\n\nIf you need to redirect the client to a different page, create output like this:\n\nprint 'Status: 302 Moved\\r' print 'Location: http://www.foo.com/orderconfirm.html\\r' print '\\r'\n\nMost of the work in the cgi module is performed by creating an instance of the FieldStorage class.\n\nFieldStorage([input [, headers [, outerboundary [, environ [, keep_blank_values [, strict_parsing]]]]]])\n\nRead the contents of a form by reading and parsing the query string passed in an envi- ronment variable or standard input. inputspecifies a file-like object from which form\n\nF h Lib f L Bdff\n\ncgi\n\n535\n\ndata will be read in a POST request. By default, sys.stdin is used. headersand outerboundaryare used internally and should not be given. environis a dictionary from which CGI environment variables are read. keep_blank_valuesis a Boolean flag that controls whether blank values are retained or not. By default, it is False. strict_parsingis a Boolean flag that causes an exception to be raised if there is any kind of parsing problem. By default, it is False.\n\nA FieldStorage instance formworks similarly to a dictionary. For example, f = form[key] will extract an entry for a given parameter key.An instance fextracted in this manner is either another instance of FieldStorage or an instance of MiniFieldStorage.The following attributes are defined on f:\n\nAttribute f.name f.filename\n\nf.value\n\nf.file\n\nf.type\n\nf.type_options\n\nf.disposition\n\nf.disposition_options\n\nf.headers\n\nDescription The field name, if specified Client-side filename used in uploads Value as a string File-like object from which data can be read Content type Dictionary of options specified on the content-type line of the HTTP request The 'content-disposition' field; None if not speci- fied Dictionary of disposition options A dictionary-like object containing all the HTTP header contents\n\nValues from a form can be extracted using the following methods:\n\nform.getvalue(fieldname [, default])\n\nReturns the value of a given field with the name fieldname. If a field is defined twice, this function will return a list of all values defined. If defaultis supplied, it specifies the value to return if the field is not present. One caution with this method is that if the same form field name is included twice in the request, the returned value will be a list containing both values.To simplify programming, you can use form.getfirst(), which simply returns the first value found.\n\nform.getfirst(fieldname [, default])\n\nReturns the first value defined for a field with the name fieldname. If defaultis sup- plied, it specifies the value to return if the field is not present.\n\nform.getlist(fieldname)\n\nReturns a list of all values defined for fieldname. It always returns a list, even if only one value is defined, and returns an empty list if no values exist.\n\nIn addition, the cgi module defines a class, MiniFieldStorage, that contains only the attribute’s name and value.This class is used to represent individual fields of a form passed in the query string, whereas FieldStorage is used to contain multiple fields and multipart data.\n\nF h Lib f L Bdff\n\n536\n\nChapter 23 Web Programming\n\nInstances of FieldStorage are accessed like a Python dictionary, where the keys are\n\nthe field names on the form.When accessed in this manner, the objects returned are themselves an instance of FieldStorage for multipart data (content type is 'multipart/form-data') or file uploads, an instance of MiniFieldStorage for sim- ple fields (content type is 'application/x-www-form-urlencoded'), or a list of such instances in cases where a form contains multiple fields with the same name. For example:\n\nform = cgi.FieldStorage() if \"name\" not in form:\n\nerror(\"Name is missing\") return\n\nname = form['name'].value # Get 'name' field from a form email = form['email'].value # Get 'email' field from a form\n\nIf a field represents an uploaded file, accessing the value attribute reads the entire file into memory as a byte string. Because this may consume a large amount of memory on the server, it may be preferable to read uploaded data in smaller pieces by reading from the file attribute directly. For instance, the following example reads uploaded data line by line:\n\nfileitem = form['userfile'] if fileitem.file:\n\n# It's an uploaded file; count lines linecount = 0 while True:\n\nline = fileitem.file.readline() if not line: break linecount = linecount + 1\n\nThe following utility functions are often used in CGI scripts:\n\nescape(s [, quote])\n\nConverts the characters '&', '<', and '>' in string sto HTML-safe sequences such as '&amp;', '&lt;', and '&gt;'. If the optional flag quoteis true, the double-quote character (\") is also translated to '&quot;'.\n\nparse_header(string)\n\nParses the data supplied after an HTTP header field such as 'content-type'.The data is split into a primary value and a dictionary of secondary parameters that are returned in a tuple. For example, the command\n\nparse_header('text/html; a=hello; b=\"world\"')\n\nreturns this result:\n\n('text/html', {'a':'hello', 'b':'world'}). parse_multipart(fp, pdict)\n\nparse_multipart(fp,pdict)\n\nParses input of type 'multipart/form-data' as is commonly used with file uploads. fpis the input file, and pdictis a dictionary containing parameters of the content-type header. It returns a dictionary mapping field names to lists of values.This function doesn’t work with nested multipart data.The FieldStorage class should be used instead.\n\nF h Lib f L Bdff\n\ncgi\n\n537\n\nprint_directory()\n\nFormats the name of the current working directory in HTML and prints it out.The resulting output will be sent back to the browser, which can be useful for debugging.\n\nprint_environ()\n\nCreates a list of all environment variables formatted in HTML and is used for debug- ging.\n\nprint_environ_usage()\n\nPrints a more selected list of useful environment variables in HTML and is used for debugging.\n\nprint_form(form)\n\nFormats the data supplied on a form in HTML. formmust be an instance of FieldStorage. Used for debugging.\n\ntest()\n\nWrites a minimal HTTP header and prints all the information provided to the script in HTML format. Primarily used for debugging to make sure your CGI environment is set up correctly.\n\nCGI Programming Advice In the current age of web frameworks, CGI scripting seems to have fallen out of fash- ion. However, if you are going to use it, there are a couple of programming tips that can simplify your life.\n\nFirst, don’t write CGI scripts where you are using a huge number of print state- ments to produce hard-coded HTML output.The resulting program will be a horrible tangled mess of Python and HTML that is not only impossible to read, but also impos- sible to maintain.A better approach is to rely on templates. Minimally, the string.Template object can be used for this. Here is an example that outlines the concept:\n\nimport cgi from string import Template\n\ndef error(message):\n\ntemp = Template(open(\"errormsg.html\").read()) print 'Content-type: text/html\\r' print '\\r' print temp.substitute({'message' : message})\n\nform = cgi.FieldStorage() name = form.getfirst('name') email = form.getfirst('email') if not name:\n\nerror(\"name not specified\") raise SystemExit\n\nelif not email:\n\nerror(\"email not specified\") raise SystemExit\n\n# Do various processing confirmation = subscribe(name, email)\n\nF h Lib f L Bdff\n\n538\n\nChapter 23 Web Programming\n\n# Print the output page values = {\n\n'name' : name, 'email' : email, 'confirmation: ': confirmation, # Add other values here...\n\n} temp = Template(open(\"success.html\").read() print temp.substitute(values)\n\nIn this example, the files 'error.html' and 'success.html' are HTML pages that have all of the output but include $variablesubstitutions corresponding to dynami- cally generated values used in the CGI script. For example, the 'success.html' file might look like this:\n\n<HTML>\n\n<HEAD>\n\n<TITLE>Success</TITLE>\n\n</HEAD> <BODY> Welcome $name. You have successfully subscribed to our newsletter. Your confirmation code is $confirmation. </BODY>\n\n</HTML>\n\nThe temp.substitute() operation in the script is simply filling in the variables in this file.An obvious benefit of this approach is that if you want to change the appearance of the output, you just modify the template files, not the CGI script.There are many third- party template engines available for Python—maybe in even greater numbers than web frameworks.These take the templating concept and build upon it in substantial ways. See http://wiki.python.org/moin/Templating more details.\n\nSecond, if you need to save data from a CGI script, try to use a database.Although it is easy enough to write data directly to files, webservers operate concurrently, and unless you’ve taken steps to properly lock and synchronize resources, it is possible that files will get corrupted. Database servers and their associated Python interface usually don’t have this problem. So if you need to save data, try to use a module such as sqlite3 or a third-party module for something like MySQL.\n\nFinally, if you find yourself writing dozens of CGI scripts and code that has to deal with low-level details of HTTP such as cookies, authentication, encoding, and so forth, you may want to consider a web framework instead.The whole point of using a frame- work is so that you don’t have to worry about those details—well, at least not as much. So, don’t reinvent the wheel.\n\nNotes\n\nn The process of installing a CGI program varies widely according to the type of\n\nwebserver being used.Typically programs are placed in a special cgi-bin directo- ry.A server may also require additional configuration.You should consult the doc- umentation for the server or the server’s administrator for more details.\n\nF h Lib f L Bdff\n\ncgitb\n\n539\n\nn On UNIX, Python CGI programs may require appropriate execute permissions\n\nto be set and a line such as the following to appear as the first line of the program:\n\n#!/usr/bin/env python import cgi ...\n\nn To simplify debugging, import the cgitb module—for example, import cgitb; cgitb.enable().This modifies exception handling so that errors are displayed in the web browser.\n\nn If you invoke an external program—for example, via the os.system() or\n\nos.popen() function—be careful not to pass arbitrary strings received from the client to the shell.This is a well-known security hole that hackers can use to exe- cute arbitrary shell commands on the server (because the command passed to these functions is first interpreted by the UNIX shell as opposed to being execut- ed directly). In particular, never pass any part of a URL or form data to a shell command unless it has first been thoroughly checked by making sure that the string contains only alphanumeric characters, dashes, underscores, and periods. n On UNIX, don’t give a CGI program setuid mode.This is a security liability\n\nand not supported on all machines.\n\nn Don’t use 'from cgi import *' with this module.The cgi module defines a wide variety of names and symbols that you probably don’t want in your name- space.\n\ncgitb This module provides an alternative exception handler that displays a detailed report whenever an uncaught exception occurs.The report contains source code, values of parameters, and local variables. Originally, this module was developed to help debug CGI scripts, but it can be used in any application.\n\nenable([display [, logdir [, context [, format]]]])\n\nEnables special exception handling. displayis a flag that determines whether any information is displayed when an error occurs.The default value is 1. logdirspecifies a directory in which error reports will be written to files instead of printed to standard output.When logdiris given, each error report is written to a unique file created by the tempfile.mkstemp() function. contextis an integer specifying the number of lines of source code to display around lines upon which the exception occurred. formatis a string that specifies the output format.A format of 'html' specifies HTML (the default).Any other value results in plain-text format.\n\nhandle([info])\n\nHandles an exception using the default settings of the enable() function. infois a tuple (exctype, excvalue, tb)where exctypeis an exception type, excvalueis an exception value, and tbis a traceback object.This tuple is normally obtained using sys.exc_info(). If infois omitted, the current exception is used.\n\nF h Lib f L Bdff\n\n540\n\nChapter 23 Web Programming\n\nNote\n\nTo enable special exception handling in CGI scripts, include the line import cgitb; enable() at the beginning of the script.\n\nwsgiref WSGI (Python Web Server Gateway Interface) is a standardized interface between web- servers and web applications that is designed to promote portability of applications across different webservers and frameworks.An official description of the standard is found in PEP 333 (http://www.python.org/dev/peps/pep-0333). More information about the standard and its use can also be found at http://www.wsgi.org.The wsgiref package is a reference implementation that can be used for testing, validation, and simple deployments.\n\nThe WSGI Specification With WSGI, a web application is implemented as a function or callable object webapp(environ, start_response) that accepts two arguments. environis a dic- tionary of environment settings that is minimally required to have the following values which have the same meaning and names as is used in CGI scripting:\n\nenvironVariables CONTENT_LENGTH\n\nCONTENT_TYPE\n\nHTTP_ACCEPT\n\nHTTP_COOKIE\n\nHTTP_REFERER\n\nHTTP_USER_AGENT\n\nPATH_INFO\n\nQUERY_STRING\n\nREQUEST_METHOD\n\nSCRIPT_NAME\n\nSERVER_NAME\n\nSERVER_PORT\n\nDescription Length of data passed Type of query data MIME types accepted by the client Netscape persistent cookie value Referring URL Client browser Extra path information passed Query string Method ('GET' or 'POST') Name of the program Server host name Server port number Server protocol\n\nSERVER_PROTOCOL\n\nIn addition, the environdictionary is required to contain the following WSGI-specific values:\n\nenviron Variables wsgi.version\n\nwsgi.url_scheme\n\nwsgi.input\n\nwsgi.errors\n\nDescription Tuple representing the WSGI version (e.g., (1,0) for WSGI 1.0). String representing the scheme component of the URL. For example, 'http' or 'https'. A file-like object representing the input stream. Additional data such as form data or uploads are read from this. A file-like object opened in text mode for writing error output.\n\nF h Lib f L Bdff\n\nwsgiref\n\n541\n\nenviron Variables wsgi.multithread\n\nDescription A Boolean flag that’s True if the application can be executed concurrently by another thread in the same process.\n\nwsgi.multiprocess A Boolean flag that’s True if the application can be executed\n\nwsgi.run_once\n\nconcurrently by another process. A Boolean flag that’s True if the application will only be exe- cuted once during the lifetime of the executing process.\n\nThe start_responseparameter is a callable object of the form start_response(status, headers) that is used by the application to start a response. statusis a string such as '200 OK' or '404 Not Found'. headersis a list of tuples, each of the form (name, value) corresponding to a HTTP header to be included in the response—for example, ('Content-type','text/html').\n\nThe data or body of a response is returned by the web application function as an iterable object that produces a sequence of byte strings or text strings that only contain characters which can be encoded as a single byte (e.g., compatible with the ISO-8859-1 or Latin-1 character set). Examples include a list of byte strings or a generator function producing byte strings. If an application needs to do any kind of character encoding such as UTF-8, it must do this itself.\n\nHere is an example of a simple WSGI application that reads form fields and produces\n\nsome output, similar to what was shown in the cgi module section:\n\nimport cgi def subscribe_app(environ, start_response):\n\nfields = cgi.FieldStorage(environ['wsgi.input'],\n\nenviron=environ)\n\nname = fields.getvalue(\"name\") email = fields.getvalue(\"email\")\n\n# Various processing\n\nstatus = \"200 OK\" headers = [('Content-type','text/plain')] start_response(status, headers)\n\nresponse = [\n\n'Hi %s. Thank you for subscribing.' % name, 'You should expect a response soon.' ]\n\nreturn (line.encode('utf-8') for line in response)\n\nThere are a few critical details in this example. First,WSGI application components are not tied to specific framework, webserver, or set of library modules. In the example, we’re only using one library module, cgi, simply because it has some convenience functions for parsing query variables.The example shows how the start_response() function is used to initiate a response and supply headers.The response itself is con- structed as a list of strings.The final statement in this application is a generator expres- sion that turns all strings into byte strings. If you’re using Python 3, this is a critical step—all WSGI applications are expected to return encoded bytes, not unencoded Unicode data.\n\nTo deploy a WSGI application, it has to be registered with the web programming\n\nframework you happen to be using. For this, you’ll have to read the manual.\n\nF h Lib f L Bdff\n\n542\n\nChapter 23 Web Programming\n\nwsgiref Package The wsgiref package provides a reference implementation of the WSGI standard that allows applications to be tested in stand-alone servers or executed as normal CGI scripts.\n\nwsgiref.simple_server The wsgiref.simple_server module implements a simple stand-alone HTTP server that runs a single WSGI application.There are just two functions of interest:\n\nmake_server(host, port, app)\n\nCreates an HTTP server that accepts connections on the given host name hostand port number port. appis a function or callable object that implements a WSGI appli- cation.To run the server, use s.serve_forever() where sis an instance of the server that is returned.\n\ndemo_app(environ, start_response)\n\nA complete WSGI application that returns a page with a “Hello World” message on it. This can be used as the appargument to make_server() to verify that the server is working correctly.\n\nHere is an example of running a simple WSGI server:\n\ndef my_app(environ, start_response):\n\n# Some application start_response(\"200 OK\",[('Content-type','text/plain')]) return ['Hello World']\n\nif __name__ == '__main__':\n\nfrom wsgiref.simple_server import make_server serv = make_server('',8080, my_app) serv.serve_forever()\n\nwsgiref.handlers The wsgiref.handlers module contains handler objects for setting up a WSGI exe- cution environment so that applications can run within another webserver (e.g., CGI scripting under Apache).There are few different objects.\n\nCGIHandler()\n\nCreates a WSGI handler object that runs inside a standard CGI environment.This han- dler collects information from the standard environment variables and I/O streams as described in the cgi library module.\n\nBaseCGIHandler(stdin, stdout, stderr, environ [, multithread [, multiprocess]])\n\nCreates a WSGI handler that operates within a CGI environment, but where the stan- dard I/O streams and environment variables might be set up in a different way. stdin, stdout, and stderrspecify file-like objects for the standard I/O streams. environis a dictionary of environment variables that is expected to already contain the standard CGI environment variables. multithreadand multiprocessare Boolean flags that are used to set the wsgi.multithread and wsgi.multiprocess environment vari- ables. By default, multithreadis True and multiprocessis False.\n\nF h Lib f L Bdff\n\nwsgiref\n\n543\n\nSimpleHandler(stdin, stdout, stderr, environ [, multithread [, multiprocess]])\n\nCreates a WSGI handler that is similar to BaseCGIHandler, but which gives the under- lying application direct access to stdin, stdout, stderr, and environ.This is slightly different than BaseCGIHandler that provides extra logic to process certain features cor- rectly (e.g., in BaseCGIHandler, response codes are translated into Status: headers). All of these handlers have a method run(app) that is used to run a WSGI applica- tion within the handler. Here is an example of a WSGI application running as a tradi- tional CGI script:\n\n#!/usr/bin/env python def my_app(environ, start_response):\n\n# Some application start_response(\"200 OK\",[('Content-type','text/plain')]) return ['Hello World']\n\nfrom wgiref.handlers import CGIHandler hand = CGIHandler() hand.run(my_app)\n\nwsgiref.validate The wsgiref.validate module has a function that wraps a WSGI application with a validation wrapper to ensure that both it and the server are operating according to the standard.\n\nvalidator(app)\n\nCreates a new WSGI application that wraps the WSGI application app.The new appli- cation transparently works in the same way as appexcept that extensive error-checking is added to make sure the application and the server are following the WSGI standard. Any violation results in an AssertionError exception.\n\nHere is an example of using the validator:\n\ndef my_app(environ, start_response):\n\n# Some application start_response(\"200 OK\",[('Content-type','text/plain')]) return ['Hello World']\n\nif __name__ == '__main__':\n\nfrom wsgiref.simple_server import make_server from wsgiref.validate import validator serv = make_server('',8080, validator(my_app)) serv.serve_forever()\n\nNote\n\nThe material in this section is primarily aimed at users of WSGI who want to create application objects. If, on the other hand, you are implementing yet another web frame- work for Python, you should consult PEP 333 for official details on precisely what is needed to make your framework support WSGI. If you are using a third-party web frame- work, you will need to consult the framework documentation for details concerning its support for WSGI objects. Given that WSGI is an officially blessed specification with a reference implementation in the standard library, it is increasingly common for frame- works to provide some level of support for it.\n\nF h Lib f L Bdff\n\n544\n\nChapter 23 Web Programming\n\nwebbrowser The webbrowser module provides utility functions for opening documents in a web browser in a platform-independent manner.The main use of this module is in develop- ment and testing situations. For example, if you wrote a script that generated HTML output, you could use the functions in this module to automatically direct your system’s browser to view the results.\n\nopen(url [, new [, autoraise]])\n\nDisplays urlwith the default browser on the system. If newis 0, the URL is opened in the same window as a running browser, if possible. If newis 1, a new browser window is created. If new is 2, the URL is opened within a new tab within the browser. If autoraiseis True, the browser window is raised.\n\nopen_new(url)\n\nDisplays urlin a new window of the default browser.The same as open(url, 1).\n\nopen_new_tab(url)\n\nDisplays urlin a new tab of the default browser.The same as open(url, 2).\n\nget([name])\n\nReturns a controller object for manipulating a browser. nameis the name of the brows- er type and is typically a string such as 'netscape', 'mozilla', 'kfm', 'grail', 'windows-default', 'internet-config', or 'command-line'.The returned con- troller object has methods open() and open_new() that accept the same arguments and perform the same operation as the two previous functions. If nameis omitted, a controller object for the default browser is returned.\n\nregister(name, constructor[, controller])\n\nRegisters a new browser type for use with the get() function. nameis the name of the browser. constructoris called without arguments to create a controller object for opening pages in the browser. controlleris a controller instance to use instead. If sup- plied, constructoris ignored and may be None.\n\nA controller instance, c, returned by the get() function has the following methods:\n\nc.open(url[, new])\n\nSame as the open() function.\n\nc.open_new(url)\n\nSame as the open_new() function.\n\nF h Lib f L Bdff\n\n24\n\nInternet Data Handling and Encoding\n\nThis chapter describes modules related to processing common Internet data formats\n\nand encodings such as base 64, HTML, XML, and JSON.\n\nbase64 The base64 module is used to encode and decode binary data into text using base 64, base 32, or base 16 encoding. Base 64 is commonly used to embed binary data in mail attachments and with parts of the HTTP protocol. Official details can be found in RFC-3548 and RFC-1421.\n\nBase 64 encoding works by grouping the data to be encoded into groups of 24 bits (3 bytes). Each 24-bit group is then subdivided into four 6-bit components. Each 6-bit value is then represented by a printable ASCII character from the following alphabet:\n\nValue 0–25 26–51 52–61 62 63 pad\n\nEncoding ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz 0123456789 + / =\n\nIf the number of bytes in the input stream is not a multiple of 3 (24 bits), the data is padded to form a complete 24-bit group.The extra padding is then indicated by special '=' characters that appear at the end of the encoding. For example, if you encode a 16- byte character sequence, there are five 3-byte groups with 1 byte left over.The remain- ing byte is padded to form a 3-byte group.This group then produces two characters from the base 64 alphabet (the first 12 bits, which include 8 bits of real data), followed by the sequence '==', representing the bits of extra padding.A valid base 64 encoding will only have zero, one (=), or two (==) padding characters at the end of the encod- ing.\n\nF h Lib f L Bdff\n\n546\n\nChapter 24 Internet Data Handling and Encoding\n\nBase 32 encoding works by grouping binary data into groups of 40 bits (5 bytes). Each 40-bit group is subdivided into eight 5-bit components. Each 5-bit value is then encoded using the following alphabet:\n\nValue 0–25 26–31\n\nEncoding ABCDEFGHIJKLMNOPQRSTUVWXYZ 2–7\n\nAs with base 64, if the end of the input stream does not form a 40-bit group, it is padded to 40 bits and the '=' character is used to represent the extra padding in the output.At most, there will be six padding characters ('======'), which occurs if the final group only includes 1 byte of data.\n\nBase 16 encoding is the standard hexadecimal encoding of data. Each 4-bit group is represented by the digits '0'–'9' and the letters 'A'–'F'.There is no extra padding or pad characters for base 16 encoding.\n\nb64encode(s [, altchars])\n\nEncodes a byte string susing base 64 encoding. altchars, if given, is a two-character string that specifies alternative characters to use for '+' and '/' characters that normal- ly appear in base 64 output.This is useful if base 64 encoding is being used with file- names or URLs.\n\nb64decode(s [, altchars])\n\nDecodes string s, which is encoded as base 64 and returns a byte string with the decoded data. altchars, if given, is a two-character string that specifies the alternative characters for '+' and '/' that normally appear in base 64–encoded data. TypeError is raised if the input scontains extraneous characters or is incorrectly padded.\n\nstandard_b64encode(s)\n\nEncodes a byte string susing the standard base 64 encoding.\n\nstandard_b64decode(s)\n\nDecodes string susing standard base 64 encoding.\n\nurlsafe_b64encode(s)\n\nEncodes a byte string susing base 64 but uses the characters '-' and '_' instead of '+' and '/', respectively.The same as b64encode(s, '-_').\n\nurlsafe_b64decode(s)\n\nDecodes string sencoded with a URL-safe base 64 encoding.\n\nb32encode(s)\n\nEncodes a byte string susing base 32 encoding.\n\nb32decode(s [, casefold [, map01]])\n\nDecodes string susing base 32 encoding. If casefoldis True, both uppercase and lowercase letters are accepted. Otherwise, only uppercase letters may appear (the default). map01, if present, specifies which letter the digit 1 maps to (for example, the letter 'I' or the letter 'L'). If this argument is given, the digit '0' is also mapped to\n\nF h Lib f L Bdff",
      "page_number": 549
    },
    {
      "number": 28,
      "title": "Segment 28 (pages 571-593)",
      "start_page": 571,
      "end_page": 593,
      "detection_method": "synthetic",
      "content": "binascii\n\n547\n\nthe letter 'O'.A TypeError is raised if the input string contains extraneous characters or is incorrectly padded.\n\nb16encode(s)\n\nEncodes a byte string susing base 16 (hex) encoding.\n\nb16decode(s [,casefold])\n\nDecodes string susing base 16 (hex) encoding. If casefoldis True, letters may be uppercase or lowercase. Otherwise, hexadecimal letters 'A'–'F' must be uppercase (the default). Raises TypeError if the input string contains extraneous characters or is mal- formed in any way.\n\nThe following functions are part of an older base 64 module interface that you may\n\nsee used in existing Python code:\n\ndecode(input, output)\n\nDecodes base 64–encoded data. inputis a filename or a file object open for reading. outputis a filename or a file object open for writing in binary mode.\n\ndecodestring(s)\n\nDecodes a base 64–encoded string, s. Returns a string containing the decoded binary data.\n\nencode(input, output)\n\nEncodes data using base 64. inputis a filename or a file object open for reading in binary mode. outputis a filename or a file object open for writing.\n\nencodestring(s)\n\nEncodes a byte string, s, using base 64.\n\nbinascii The binascii module contains low-level functions for converting data between binary and a variety of ASCII encodings, such as base 64, BinHex, and UUencoding.\n\na2b_uu(s)\n\nConverts a line of uuencoded text sto binary and returns a byte string. Lines normally contain 45 (binary) bytes, except for the last line that may be less. Line data may be fol- lowed by whitespace.\n\nb2a_uu(data)\n\nConverts a string of binary data to a line of uuencoded ASCII characters.The length of datashould not be more than 45 bytes. Otherwise, the Error exception is raised.\n\na2b_base64(string)\n\nConverts a string of base 64–encoded text to binary and returns a byte string.\n\nb2a_base64(data)\n\nConverts a string of binary data to a line of base 64–encoded ASCII characters.The length of datashould not be more than 57 bytes if the resulting output is to be trans- mitted through email (otherwise it might get truncated).\n\nF h Lib f L Bdff\n\n548\n\nChapter 24 Internet Data Handling and Encoding\n\na2b_hex(string)\n\nConverts a string of hexadecimal digits to binary data.This function is also called as unhexlify(string).\n\nb2a_hex(data)\n\nConverts a string of binary data to a hexadecimal encoding.This function is also called as hexlify(data).\n\na2b_hqx(string)\n\nConverts a string of BinHex 4–encoded data to binary without performing RLE (Run- Length Encoding) decompression.\n\nrledecode_hqx(data)\n\nPerforms an RLE decompression of the binary data in data. Returns the decompressed data unless the data input is incomplete, in which case the Incomplete exception is raised.\n\nrlecode_hqx(data)\n\nPerforms a BinHex 4 RLE compression of data.\n\nb2a_hqx(data)\n\nConverts the binary data to a string of BinHex 4–encoded ASCII characters. data should already be RLE-coded.Also, unless datais the last data fragment, the length of datashould be divisible by 3.\n\ncrc_hqx(data, crc)\n\nComputes the BinHex 4 CRC checksum of the byte string data. crcis a starting value of the checksum.\n\ncrc32(data [, crc])\n\nComputes the CRC-32 checksum of the byte string data. crcis an optional initial CRC value. If omitted, crcdefaults to 0.\n\ncsv The csv module is used to read and write files consisting of comma-separated values (CSV).A CSV file consists of rows of text, each row consisting of values separated by a delimiter character, typically a comma (,) or a tab. Here’s an example:\n\nBlues,Elwood,\"1060 W Addison\",\"Chicago, IL 60613\",\"B263-1655-2187\",116,56\n\nVariants of this format commonly occur when working with databases and spreadsheets. For instance, a database might export tables in CSV format, allowing the tables to be read by other programs. Subtle complexities arise when fields contain the delimiter character. For instance, in the preceding example, one of the fields contains a comma and must be placed in quotes.This is why using basic string operations such as split(',') are often not enough to work with such files.\n\nF h Lib f L Bdff\n\ncsv\n\n549\n\nreader(csvfile [, dialect [, **fmtparams])\n\nReturns a reader object that produces the values for each line of input of the input file csvfile. csvfileis any iterable object that produces a complete line of text on each iteration.The returned reader object is an iterator that produces a list of strings on each iteration.The dialectparameter is either a string containing the name of a dialect or a Dialect object.The purpose of the dialectparameter is to account for differences between different CSV encodings.The only built-in dialects supported by this module are 'excel' (which is the default value) and 'excel-tab', but others can be defined by the user as described later in this section. fmtparamsis a set of keyword arguments that customize various aspects of the dialect.The following keyword arguments can be given:\n\nKeyword Argument delimiter\n\ndoublequote\n\nescapechar\n\nlineterminator\n\nquotechar\n\nskipinitialspace\n\nDescription Character used to separate fields (the default is ','). Boolean flag that determines how the quote character (quotechar) is handled when it appears in a field. If True, the character is simply doubled. If False, an escape character (escapechar) is used as a prefix. The default is True. Character used as an escape character when the delimiter appears in a field and quoting is QUOTE_NONE. The default value is None. Line termination sequence ('\\r\\n' is the default). Character used to quote fields that contain the delimiter ('\"' is the default). If True, whitespace immediately following the delimiter is ignored (False is the default).\n\nwriter(csvfile [, dialect [, **fmtparam]])\n\nReturns a writer object that can be used to create a CSV file. csvfileis any file-like object that supports a write() method. dialecthas the same meaning as for reader() and is used to handle differences between various CSV encodings. fmt- paramshas the same meaning as for readers. However, one additional keyword argu- ment is available:\n\nKeyword Argument quoting\n\nDescription Controls the quoting behavior of output data. It’s set to one of QUOTE_ALL (quotes all fields), QUOTE_MINIMAL (only quote fields that contain the delimiter or start with the quote charac- ter), QUOTE_NONNUMERIC (quote all nonnumeric fields), or QUOTE_NONE (never quote fields). The default value is QUOTE_MINIMAL.\n\nA writer instance, w, supports the following methods:\n\nw.writerow(row)\n\nWrites a single row of data to the file. rowmust be a sequence of strings or numbers.\n\nF h Lib f L Bdff\n\n550\n\nChapter 24 Internet Data Handling and Encoding\n\nw.writerows(rows)\n\nWrites multiple rows of data. rowsmust be a sequence of rows as passed to the writerow() method.\n\nDictReader(csvfile [, fieldnames [, restkey [, restval [, dialect [, ➥**fmtparams]]]]])\n\nReturns a reader object that operates like the ordinary reader but returns dictionary objects instead of lists of strings when reading the file. fieldnamesprovides a list of field names used as keys in the returned dictionary. If omitted, the dictionary key names are taken from the first row of the input file. restkeyprovides the name of a diction- ary key that’s used to store excess data—for instance, if a row has more data fields than field names. restvalis a default value that’s used as the value for fields that are missing from the input—for instance, if a row does not have enough fields.The default value of restkeyand restvalis None. dialectand fmtparamshave the same meaning as for reader().\n\nDictWriter(csvfile, fieldnames [, restval [, extrasaction [, dialect [, ➥**fmtparams]]]])\n\nReturns a writer object that operates like the ordinary writer but writes dictionaries into output rows. fieldnamesspecifies the order and names of attributes that will be written to the file. restvalis the value that’s written if the dictionary being written is missing one of the field names in fieldnames. extrasactionis a string that specifies what to do if a dictionary being written has keys not listed in fieldnames.The default value of extrasactionis 'raise', which raises a ValueError exception.A value of 'ignore' may be used, in which case extra values in the dictionary are ignored. dialectand fmtparamshave the same meaning as with writer().\n\nA DictWriter instance, w, supports the following methods:\n\nw.writerow(row)\n\nWrites a single row of data to the file. rowmust be a dictionary that maps field names to values.\n\nw.writerows(rows)\n\nWrites multiple rows of data. rowsmust be a sequence of rows as passed to the writerow() method.\n\nSniffer()\n\nCreates a Sniffer object that is used to try and automatically detect the format of a CSV file.\n\nA Sniffer instance, s, has the following methods:\n\ns.sniff(sample [, delimiters])\n\nLooks at data in sampleand returns an appropriate Dialect object representing the data format. sampleis a portion of a CSV file containing at least one row of data. delimiters, if supplied, is a string containing possible field delimiter characters.\n\ns.has_header(sample)\n\nLooks at the CSV data in sampleand returns True if the first row looks like a collec- tion of column headers.\n\nF h Lib f L Bdff\n\ncsv\n\n551\n\nDialects Many of the functions and methods in the csv module involve a special dialect param- eter.The purpose of this parameter is to accommodate different formatting conventions of CSV files (for which there is no official “standard” format)—for example, differences between comma-separated values and tab-delimited values, quoting conventions, and so forth.\n\nDialects are defined by inheriting from the class Dialect and defining the same set of attributes as the formatting parameters given to the reader() and writer() func- tions (delimiter, doublequote, escapechar, lineterminator, quotechar, quoting, skipinitialspace).\n\nThe following utility functions are used to manage dialects:\n\nregister_dialect(name, dialect)\n\nRegisters a new Dialect object, dialect, under the name name.\n\nunregister_dislect(name)\n\nRemoves the Dialect object with name name.\n\nget_dialect(name)\n\nReturns the Dialect object with name name.\n\nlist_dialects()\n\nReturns a list of all registered dialect names. Currently, there are only two built-in dialects: 'excel' and 'excel-tab'.\n\nExample\n\nimport csv # Read a basic CSV file f = open(\"scmods.csv\",\"r\") for r in csv.reader(f):\n\nlastname, firstname, street, city, zip = r print(\"{0} {1} {2} {3} {4}\".format(*r))\n\n# Using a DictReader instead f = open(\"address.csv\") r = csv.DictReader(f,['lastname','firstname','street','city','zip']) for a in r:\n\nprint(\"{firstname} {lastname} {street} {city} {zip}\".format(**a))\n\n# Write a basic CSV file data = [\n\n['Blues','Elwood','1060 W Addison','Chicago','IL','60613' ], ['McGurn','Jack','4802 N Broadway','Chicago','IL','60640' ],\n\n] f = open(\"address.csv\",\"w\") w = csv.writer(f) w.writerows(data) f.close()\n\nF h Lib f L Bdff\n\n552\n\nChapter 24 Internet Data Handling and Encoding\n\nemail Package The email package provides a wide variety of functions and objects for representing, parsing and manipulating email messages encoded according to the MIME standard.\n\nCovering every detail of the email package is not practical here, nor would it be of interest to most readers.Thus, the rest of this section focuses on two common practical problems—parsing email messages in order to extract useful information and creating email messages so that they can be sent using the smtplib module.\n\nParsing Email At the top level, the email module provides two functions for parsing messages:\n\nmessage_from_file(f)\n\nParses an email message read from the file-like object fwhich must be opened in text mode.The input message should be a complete MIME-encoded email message includ- ing all headers, text, and attachments. Returns a Message instance.\n\nmessage_from_string(str)\n\nParses an email message by reading an email message from the text string str. Returns a Message instance.\n\nA Message instance mreturned by the previous functions emulates a dictionary and\n\nsupports the following operations for looking up message data:\n\nOperation m[name]\n\nm.keys()\n\nm.values()\n\nm.items()\n\nDescription Returns the value of header name. Returns a list of all message header names. Returns a list of message header values. Returns a list of tuples containing message header names and values.\n\nm.get(name [,def]) Returns a header value for header name. defspecifies a\n\nlen(m)\n\nstr(m)\n\nname in m\n\ndefault value to return if not found. Returns the number of message headers. Turns the message into a string. The same as the as_string() method. Returns True if nameis the name of a header in the mes- sage.\n\nIn addition to these operators, mhas the following methods that can be used to extract information:\n\nm.get_all(name [, default])\n\nReturns a list of all values for a header with name name. Returns defaultif no such header exists.\n\nm.get_boundary([default])\n\nReturns the boundary parameter found within the 'Content-type' header of a mes- sage.Typically the boundary is a string such as '===============0995017162==' that’s used to separate the different subparts of a message. Returns defaultif no boundary parameter could be found.\n\nF h Lib f L Bdff\n\nemail Package\n\n553\n\nm.get_charset()\n\nReturns the character set associated with the message payload (for instance, 'iso-8859-1').\n\nm.get_charsets([default])\n\nReturns a list of all character sets that appear in the message. For multipart messages, the list will represent the character set of each subpart.The character set of each part is taken from 'Content-type' headers that appear in the message. If no character set is specified or the content-type header is missing, the character set for that part is set to the value of default(which is None by default).\n\nm.get_content_charset([default])\n\nReturns the character set from the first 'Content-type' header in the message. If the header is not found or no character set is specified, defaultis returned.\n\nm.get_content_maintype()\n\nReturns the main content type (for example, 'text' or 'multipart').\n\nm.get_content_subtype()\n\nReturns the subcontent type (for example, 'plain' or 'mixed').\n\nm.get_content_type()\n\nReturns a string containing the message content type (for example, 'multipart/mixed' or 'text/plain').\n\nm.get_default_type()\n\nReturns the default content type (for example, 'text/plain' for simple messages).\n\nm.get_filename([default])\n\nReturns the filename parameter from a 'Content-Disposition' header, if any. Returns defaultif the header is missing or does not have a filename parameter.\n\nm.get_param(param [, default [, header [, unquote]]])\n\nEmail headers often have parameters attached to them such as the 'charset' and 'format' parts of the header 'Content-Type: text/plain; charset=\"utf-8\"; format=flowed'.This method returns the value of a specific header parameter. param is a parameter name, defaultis a default value to return if the parameter is not found, headeris the name of the header, and unquotespecifies whether or not to unquote the parameter. If no value is given for header, parameters are taken from the 'Content-type' header.The default value of unquoteis True.The return value is either a string or a 3-tuple (charset, language, value) in the event the parameter was encoded according to RFC-2231 conventions. In this case, charsetis a string such as 'iso-8859-1', languageis a string containing a language code such as 'en', and valueis the parameter value.\n\nm.get_params([default [, header [, unquote]]])\n\nReturns all parameters for headeras a list. defaultspecifies the value to return if the header isn’t found. If headeris omitted, the 'Content-type' header is used. unquote is a flag that specifies whether or not to unquote values (True by default).The contents\n\nF h Lib f L Bdff\n\n554\n\nChapter 24 Internet Data Handling and Encoding\n\nof the returned list are tuples (name, value) where nameis the parameter name and valueis the value as returned by the get_param() method.\n\nm.get_payload([i [, decode]])\n\nReturns the payload of a message. If the message is a simple message, a byte string con- taining the message body is returned. If the message is a multipart message, a list con- taining all the subparts is returned. For multipart messages, ispecifies an optional index in this list. If supplied, only that message component will be returned. If decodeis True, the payload is decoded according to the setting of any 'Content-Transfer-Encoding' header that might be present (for example, 'quoted-printable', 'base64', and so on).To decode the payload of a simple non- multipart message, set ito None and decodeto True or specify decodeusing a key- word argument. It should be emphasized that the payload is returned as a byte string containing the raw content. If the payload represents text encoded in UTF-8 or some other encoding, you will need to use the decode() method on the result to convert it.\n\nm.get_unixfrom()\n\nReturns the UNIX-style 'From ...' line, if any.\n\nm.is_multipart()\n\nReturns True if mis a multipart message.\n\nm.walk()\n\nCreates a generator that iterates over all the subparts of a message, each of which is also represented by a Message instance.The iteration is a depth-first traversal of the message. Typically, this function could be used to process all the components of a multipart mes- sage.\n\nFinally, Message instances have a few attributes that are related to low-level parsing\n\nprocess.\n\nm.preamble\n\nAny text that appears in a multipart message between the blank line that signals the end of the headers and the first occurrence of the multipart boundary string that marks the first subpart of the message.\n\nm.epilogue\n\nAny text in the message that appears after the last multipart boundary string and the end of the message.\n\nm.defects\n\nA list of all message defects found when parsing the message. Consult the online docu- mentation for the email.errors module for further details.\n\nThe following example illustrates how the Message class is used while parsing an email message.The following code reads an email message, prints a short summary of useful headers, prints the plain text portions of the message, and saves any attachments.\n\nimport email import sys\n\nf = open(sys.argv[1],\"r\") # Open message file m = email.message_from_file(f) # Parse message\n\nF h Lib f L Bdff\n\nemail Package\n\n555\n\n# Print short summary of sender/recipient print(\"From : %s\" % m[\"from\"]) print(\"To : %s\" % m[\"to\"]) print(\"Subject : %s\" % m[\"subject\"]) print(\"\")\n\nif not m.is_multipart():\n\n# Simple message. Just print the payload payload = m.get_payload(decode=True) charset = m.get_content_charset('iso-8859-1') print(payload.decode(charset))\n\nelse:\n\n# Multipart message. Walk over all subparts and # 1. Print text/plain fragments # 2. Save any attachments for s in m.walk():\n\nfilename = s.get_filename() if filename:\n\nprint(\"Saving attachment: %s\" % filename) data = s.get_payload(decode=True) open(filename,\"wb\").write(data)\n\nelse:\n\nif s.get_content_type() == 'text/plain': payload = s.get_payload(decode=True) charset = s.get_content_charset('iso-8859-1') print(payload.decode(charset))\n\nIn this example, it is important to emphasize that operations that extract the payload of a message always return byte strings. If the payload represents text, you also need to decode it according to some character set.The m.get_content_charset() and payload.decode() operations in the example are carrying out this conversion.\n\nComposing Email To compose an email message, you can either create an empty instance of a Message object, which is defined in the email.message module, or you can use a Message object that was created by parsing an email message (see the previous section).\n\nMessage()\n\nCreates a new message that is initially empty.\n\nAn instance mof Message supports the following methods for populating a message\n\nwith content, headers, and other information.\n\nm.add_header(name, value, **params)\n\nAdds a new message header. nameis the name of the header, valueis the value of the header, and paramsis a set of keyword arguments that supply additional optional parameters. For example, add_header('Foo','Bar',spam='major') adds the header line 'Foo: Bar; spam=\"major\"' to the message.\n\nm.as_string([unixfrom])\n\nConverts the entire message to a string. unixfromis a Boolean flag. If this is set to True, a UNIX-style 'From ...’ line appears as the first line. By default, unixfromis False.\n\nF h Lib f L Bdff\n\n556\n\nChapter 24 Internet Data Handling and Encoding\n\nm.attach(payload)\n\nAdds an attachment to a multipart message. payloadmust be another Message object (for example, email.mime.text.MIMEText). Internally, payloadis appended to a list that keeps track of the different parts of the message. If the message is not a multipart message, use set_payload() to set the body of a message to a simple string.\n\nm.del_param(param [, header [, requote]])\n\nDeletes the parameter paramfrom header header. For example, if a message has the header 'Foo: Bar; spam=\"major\"', del_param('spam','Foo') would delete the 'spam=\"major\"' portion of the header. If requoteis True (the default), all remaining values are quoted when the header is rewritten. If headeris omitted, the operation is applied to the 'Content-type' header.\n\nm.replace_header(name, value)\n\nReplaces the value of the first occurrence of the header namewith value value. Raises KeyError if the header is not found.\n\nm.set_boundary(boundary)\n\nSets the boundary parameter of a message to the string boundary.This string gets added as the boundary parameter to the 'Content-type' header in the message. Raises HeaderParseError if the message has no content-type header.\n\nm.set_charset(charset)\n\nSets the default character set used by a message. charsetmay be a string such as 'iso-8859-1' or 'euc-jp'. Setting a character set normally adds a parameter to the 'Content-type' header of a message (for example, 'Content-type: text/html; charset=\"iso-8859-1\"').\n\nm.set_default_type(ctype)\n\nSets the default message content type to ctype. ctypeis a string containing a MIME type such as 'text/plain’ or 'message/rfc822'.This type is not stored in the 'Content-type' header of the message.\n\nm.set_param(param, value [, header [, requote [, charset [, language]]]])\n\nSets the value of a header parameter. paramis the parameter name, and valueis the parameter value. headerspecifies the name of the header and defaults to 'Content-type'. requotespecifies whether or not to requote all the values in the header after adding the parameter. By default, this is True. charsetand language specify optional character set and language information. If these are supplied, the parameter is encoded according to RFC-2231.This produces parameter text such as param*=\"'iso-8859-1'en-us'some%20value\".\n\nm.set_payload(payload [, charset])\n\nSets the entire message payload to payload. For simple messages, payloadcan be a byte string containing the message body. For multipart messages, payloadis a list of Message objects. charsetoptionally specifies the character set that was used to encode the text (see set_charset).\n\nF h Lib f L Bdff\n\nemail Package\n\n557\n\nm.set_type(type [, header [, requote]])\n\nSets the type used in the 'Content-type' header. typeis a string specifying the type, such as 'text/plain' or 'multipart/mixed'. headerspecifies an alternative header other than the default 'Content-type' header. requotequotes the value of any parameters already attached to the header. By default, this is True.\n\nm.set_unixfrom(unixfrom)\n\nSets the text of the UNIX-style 'From ...' line. unixfromis a string containing the complete text including the 'From' text.This text is only output if the unixfrom parameter of m.as_string() is set to True.\n\nRather than creating raw Message objects and building them up from scratch each time, there are a collection of prebuilt message objects corresponding to different types of content.These message objects are especially useful for creating multipart MIME messages. For instance, you would create a new message and attach different parts using the attach() method of Message. Each of these objects is defined in a different sub- module, which is noted in each description.\n\nMIMEApplication(data [, subtype [, encoder [, **params]]])\n\nDefined in email.mime.application. Creates a message containing application data. datais a byte string containing the raw data. subtypespecifies the data subtype and is 'octet-stream' by default. encoderis an optional encoding function from the email.encoders subpackage. By default, data is encoded as base 64. paramsrepresents optional keyword arguments and values that will be added to the 'Content-type' header of the message.\n\nMIMEAudio(data [, subtype [, encoder [, **params]]])\n\nDefined in email.mime.audio. Creates a message containing audio data. datais a byte string containing the raw binary audio data. subtypespecifies the type of the data and is a string such as 'mpeg' or 'wav'. If no subtype is provided, the audio type will be guessed by looking at the data using the sndhdr module. encoderand paramshave the same meaning as for MIMEApplication.\n\nMIMEImage(data [, subtype [, encoder [, **params]]])\n\nDefined in email.mime.image. Creates a message containing image data. datais a byte string containing the raw image data. subtypespecifies the image type and is a string such as 'jpg' or 'png'. If no subtypeis provided, the type will be guessed using a function in the imghdr module. encoderand paramshave the same meaning as for MIMEApplication.\n\nMIMEMessage(msg [, subtype])\n\nDefined in email.mime.message. Creates a new non-multipart MIME message. msgis a message object containing the initial payload of the message. subtypeis the type of the message and defaults to 'rfc822'.\n\nMIMEMultipart([subtype [, boundary [, subparts [, **params]]]])\n\nDefined in email.mime.multipart. Creates a new MIME multipart message. subtypespecifies the optional subtype to be added to the ‘Content-type: multipart/subtype' header. By default, subtypeis 'mixed'. boundaryis a string that specifies the boundary separator used to make each message subpart. If set to None\n\nF h Lib f L Bdff\n\n558\n\nChapter 24 Internet Data Handling and Encoding\n\nor omitted, a suitable boundary is determined automatically. subpartsis a sequence of Message objects that make up the contents of the message. paramsrepresents optional keyword arguments and values that are added to the 'Content-type' header of the message. Once a multipart message has been created, additional subparts can be added using the Message.attach() method.\n\nMIMEText(data [, subtype [, charset]])\n\nDefined in email.mime.text. Creates a message containing textual data. datais a string containing the message payload. subtypespecifies the text type and is a string such as 'plain' (the default) or 'html'. charsetis the character set, which defaults to 'us-ascii'.The message may be encoded depending on the contents of the mes- sage.\n\nThe following example shows how to compose and send an email message using the\n\nclasses in this section:\n\nimport smtplib from email.mime.text import MIMEText from email.mime.multipart import MIMEMultipart from email.mime.audio import MIMEAudio\n\nsender = \"jon@nogodiggydie.net\" receiver= \"dave@dabeaz.com\" subject = \"Faders up!\" body = \"I never should have moved out of Texas. -J.\\n\" audio = \"TexasFuneral.mp3\"\n\nm = MIMEMultipart() m[\"to\"] = receiver m[\"from\"] = sender m[\"subject\"] = subject\n\nm.attach(MIMEText(body)) apart = MIMEAudio(open(audio,\"rb\").read(),\"mpeg\") apart.add_header(\"Content-Disposition\",\"attachment\",filename=audio) m.attach(apart)\n\n# Send the email message s = smtplib.SMTP() s.connect() s.sendmail(sender, [receiver],m.as_string()) s.close()\n\nNotes\n\nn A number of advanced customization and configuration options have not been\n\ndiscussed. Readers should consult the online documentation for advanced uses of this module.\n\nn The email package has gone through at least four different versions, where the\n\nunderlying programming interface has been changed (i.e., submodules renamed, classes moved to different locations, etc.).This section has documented version 4.0 of the interface that is used in both Python 2.6 and Python 3.0. If you are working with legacy code, the basic concepts still apply, but you may have to adjust the locations of classes and submodules.\n\nF h Lib f L Bdff\n\nhmac\n\n559\n\nhashlib The hashlib module implements a variety of secure hash and message digest algo- rithms such as MD5 and SHA1.To compute a hash value, you start by calling one of the following functions, the name of which is the same as represented algorithm:\n\nFunction md5()\n\nsha1()\n\nsha224()\n\nsha256()\n\nsha384() sha512()\n\nDescription MD5 hash (128 bits) SHA1 hash (160 bits) SHA224 hash (224 bits) SHA256 hash (256 bits) SHA384 hash (384 bits) SHA512 hash (512 bits)\n\nAn instance dof the digest object returned by any of these functions has the following interface:\n\nMethod or Attribute Description d.update(data)\n\nUpdates the hash with new data. datamust be a byte string. Repeated calls are the same as a single call with concatenated data. Returns the value of the digest as a raw byte string. Returns a text string with the value of the digest encoded as a series of hex digits. Returns a copy of the digest. The copy preserves the internal state of the original digest. Size of the resulting hash in bytes. Internal block size of the hash algorithm in bytes.\n\nd.digest()\n\nd.hexdigest()\n\nd.copy()\n\nd.digest_size\n\nd.block_size\n\nAn alternative construction interface is also provided by the module:\n\nnew(hashname)\n\nCreates a new digest object. hashnameis a string such as 'md5' or 'sha256' specifying the name of the hashing algorithm to use.The name of the hash can minimally be any of the previous hashing algorithms or a hashing algorithm exposed by the OpenSSL library (which depends on the installation).\n\nhmac The hmac module provides support for HMAC (Keyed-Hashing for Message Authentication), which is described in RFC-2104. HMAC is a mechanism used for message authentication that is built upon cryptographic hashing functions such as MD5 and SHA-1.\n\nnew(key [, msg [, digest]])\n\nCreates a new HMAC object. Here, keyis a byte string containing the starting key for the hash, msgcontains initial data to process, and digestis the digest constructor that should be used for cryptographic hashing. By default, digestis hashlib.md5.\n\nF h Lib f L Bdff\n\n560\n\nChapter 24 Internet Data Handling and Encoding\n\nNormally, the initial key value is determined at random using a cryptographically strong random number generator.\n\nAn HMAC object, h, has the following methods:\n\nh.update(msg)\n\nAdds the string msgto the HMAC object.\n\nh.digest()\n\nReturns the digest of all data processed so far and returns a byte string containing the digest value.The length of the string depends on the underlying hashing function. For MD5, it is 16 characters; for SHA-1, it is 20 characters.\n\nh.hexdigest()\n\nReturns the digest as a string of hexadecimal digits.\n\nh.copy()\n\nMakes a copy of the HMAC object.\n\nExample The primary use of the hmac module is in applications that need to authenticate the sender of a message.To do this, the keyparameter to new() is a byte string representing a secret key known by both the sender and receiver of a message.When sending a mes- sage, the sender will create a new HMAC object with the given key, update the object with message data to be sent, and then send the message data along with the resulting HMAC digest value to the receiver.The receiver can verify the message by computing its own HMAC digest value (using the same key and message data) and comparing the result to the digest value received. Here is an example:\n\nimport hmac secret_key = b\"peekaboo\" # Byte string only known to me. Typically\n\n# you would want to use a string of random bytes # computed using os.urandom() or similar.\n\ndata = b\"Hello World\" # The message to send\n\n# Send the message somewhere. out represents a socket or some # other I/O channel on which we are sending data. h = hmac.new(secret_key) h.update(data) out.send(data) # Send the data out.send(h.digest()) # Send the digest\n\n# Receive the message # in represents a socket or some other I/O channel # out which we are receiving data. h = hmac.new(secret_key) data = in.receive() # Get the message data h.update(data) digest = in.receive() # Get the digest sent by the sender if digest != h.digest():\n\nraise AuthenticationError('Message not authenticated')\n\nF h Lib f L Bdff\n\nHTMLParser\n\n561\n\nHTMLParser In Python 3, this module is called html.parser.The HTMLParser module defines a class HTMLParser that can be used to parse HTML and XHTML documents.To use this module, you define your own class that inherits from HTMLParser and redefines methods as appropriate.\n\nHTMLParser()\n\nThis is a base class that is used to create HTML parsers. It is initialized without any arguments.\n\nAn instance hof HTMLParser has the following methods:\n\nh.close()\n\nCloses the parser and forces the processing of any remaining unparsed data.This method is called after all HTML data has been fed to the parser.\n\nh.feed(data)\n\nSupplies new data to the parser.This data will be immediately parsed. However, if the data is incomplete (for example, it ends with an incomplete HTML element), the incomplete portion will be buffered and parsed the next time feed() is called with more data.\n\nh.getpos()\n\nReturns the current line number and character offset into that line as a tuple (line, offset).\n\nh.get_starttag_text()\n\nReturns the text corresponding to the most recently opened start tag.\n\nh.handle_charref(name)\n\nThis handler method is called whenever a character reference such as '&#ref;' is encountered. nameis a string containing the name of the reference. For example, when parsing '&#229;', namewill be set to '229'.\n\nh.handle_comment(data)\n\nThis handler method is called whenever a comment is encountered. datais a string containing the text of the comment. For example, when parsing the comment '<!--comment-->', datawill contain the text 'comment'.\n\nh.handle_data(data)\n\nThis handler is called to process data that appears between tags. datais a string contain- ing text.\n\nh.handle_decl(decl)\n\nThis handler is called to process declarations such as '<!DOCTYPE HTML ...>'. decl is a string containing the text of the declaration not including the leading '<!' and trailing '>'.\n\nF h Lib f L Bdff\n\n562\n\nChapter 24 Internet Data Handling and Encoding\n\nh.handle_endtag(tag)\n\nThis handler is called whenever end tags are encountered. tagis the name of the tag converted to lowercase. For example, if the end tag is '</BODY>', tagis the string 'body'.\n\nh.handle_entityref(name)\n\nThis handler is called to handle entity references such as '&name;'. nameis a string containing the name of the reference. For example, if parsing '&lt;', namewill be set to 'lt'.\n\nh.handle_pi(data)\n\nThis handler is called to handle processing instructions such as '<?processing instruction>'. datais a string containing the text of the processing instruction not including the leading '<?' or trailing '>'.When called on XHTML-style instructions of the form '<?...?>', the last '?' will be included in data.\n\nh.handle_startendtag(tag, attrs)\n\nThis handler processes XHTML-style empty tags such as '<tag name=\"value\"... />'. tagis a string containing the name of the tag. attrscontains attribute informa- tion and is a list of tuples of the form (name, value) where nameis the attribute name converted to lowercase and valueis the attribute value.When extracting values, quotes and character entities are replaced. For example, if parsing '<a href=\"http://www.foo.com\"/>', tagis 'a' and attrsis [('href','http://www.foo.com')]. If not defined in derived classes, the default implementation of this method simply calls handle_starttag() and handle_endtag().\n\nh.handle_starttag(tag, attrs)\n\nThis handler processes start tags such as '<tag name=\"value\" ...>'. tagand attrs have the same meaning as described for handle_startendtag().\n\nh.reset()\n\nResets the parser, discarding any unprocessed data.\n\nThe following exception is provided:\n\nHTMLParserError\n\nException raised as a result of parsing errors.The exception has three attributes.The msg attribute contains a message describing the error, the lineno attribute is the line number where the parsing error occurred, and the offset attribute is the character off- set into the line.\n\nExample The following example fetches an HTML document using the urllib package and prints all links that have been specified with '<a href=\"...\">' declarations:\n\n# printlinks.py try:\n\nfrom HTMLParser import HTMLParser from urllib2 import urlopen\n\nexcept ImportError:\n\nfrom html.parser import HTMLParser\n\nF h Lib f L Bdff\n\njson\n\n563\n\nfrom urllib.request import urlopen\n\nimport sys\n\nclass PrintLinks(HTMLParser):\n\ndef handle_starttag(self,tag,attrs):\n\nif tag == 'a':\n\nfor name,value in attrs:\n\nif name == 'href': print(value)\n\np = PrintLinks() u = urlopen(sys.argv[1]) data = u.read() charset = u.info().getparam('charset') # Python 2 #charset = u.info().get_content_charset() # Python 3 p.feed(data.decode(charset)) p.close()\n\nIn the example, it must be noted that any HTML fetched using urllib is returned as a byte string.To properly parse it, it must be decoded into text according to the docu- ment character set encoding.The example shows how to obtain this in Python 2 and Python 3.\n\nNote\n\nThe parsing capabilities of HTMLParser tend to be rather limited. In fact, with very com- plicated and/or malformed HTML, the parser can break. Users also find this module to be lower-level than is useful. If you are writing programs that must scrape data from HTML pages, consider the Beautiful Soup package (http://pypi.python.org/ pypi/BeautifulSoup).\n\njson The json module is used to serialize and unserialize objects represented using JavaScript Object Notation (JSON). More information about JSON is available at http://json.org, but the format is really just a subset of JavaScript syntax. Incidentally, it’s almost the same as Python syntax for representing lists and dictionaries. For example, a JSON array is written as [value1, value2, ... ], and a JSON object is written as {name:value, name:value, .... }.\n\nThe following list shows how JSON values and Python values are mapped.The Python types listed in parentheses are accepted when encoding but are not returned when decoding (instead, the first listed type is returned).\n\nJSON Type object\n\narray\n\nstring\n\nnumber\n\ntrue\n\nPython Type dict list (tuple) unicode (str, bytes) int, float True\n\nfalse\n\nFalse\n\nnull\n\nNone\n\nF h Lib f L Bdff\n\n564\n\nChapter 24 Internet Data Handling and Encoding\n\nFor string data, you should assume the use of Unicode. If byte strings are encountered during encoding, they will be decoded into a Unicode string using 'utf-8' by default (although this can be controlled). JSON strings are always returned as Unicode when decoding.\n\nThe following functions are used to encode/decode JSON documents:\n\ndump(obj, f, **opts)\n\nSerializes objto a file-like object f. optsrepresents a collection of keyword arguments that can be specified to control the serialization process:\n\nKeyword Argument skipkeys\n\nensure_ascii\n\ncheck_circular\n\nallow_nan\n\ncls\n\nindent\n\nseparators\n\nencoding\n\ndefault\n\nDescription Boolean flag that controls what to do when dictionary keys (not the values) are not a basic type such as a string or number. If True, the keys are skipped. If False (the default), a TypeError is raised. Boolean flag that determines whether or not Unicode strings can be written to the file f. By default, this is False. Only set this to True if fis a file that correctly handles Unicode, such as a file created by the codecs module or opened with a specific encod- ing set. Boolean flag that determines whether circular references are checked for containers. By default, this is True. If set to False and a circular reference is encountered, an OverflowError exception is raised. Boolean flag that determines whether out-of-range floating-point values are serialized (e.g., NaN, inf, -inf). By default this is True. A subclass of JSONEncoder to use. You would specify this if you created your own custom encoder by inheriting from JSONEncoder. If there are any additional keyword arguments given to dump(), they are passed as arguments to the construc- tor of this class. A non-negative integer that sets the amount indentation to use when printing array and object members. Setting this results in a kind of pretty-printing. By default, it is None, which causes the result to be in the most compact representation. A tuple of the form (item_separator, dict_separator) where item_separatoris a string containing the separator used between array items and dict_separatoris a string con- taining the separator used between dictionary keys and values. By default, the value is (', ', ': '). Encoding to use for Unicode strings—'utf-8' by default. A function used to serialize objects that are not any of the basic supported types. It should either return a value that can be seri- alized (i.e., a string) or raise TypeError. By default, a TypeError is raised for unsupported types.\n\ndumps(obj, **opts)\n\nThe same as dump() except that a string containing the result is returned.\n\nF h Lib f L Bdff\n\njson\n\n565\n\nload(f, **opts)\n\nDeserializes a JSON object on the file-like object fand returns it. optsrepresents a set of keyword arguments that can be specified to control the decoding process and are described next. Be aware that this function calls f.read() to consume the entire con- tents of f. Because of this, it should not be used on any kind of streaming file such as a socket where JSON data might be received as part of a larger or ongoing data stream.\n\nKeyword Argument encoding\n\nstrict\n\ncls\n\nobject_hook\n\nparse_float\n\nparse_int\n\nDescription Encoding used to interpret any of the string values that are decoded. By default, this is 'utf-8'. Boolean flag that determines whether or not literal (unescaped) newlines are allowed to appear in JSON strings. By default, this is True, which means that an exception is generated for such strings. A subclass of JSONDecoder to use for decoding. Only speci- fied if you’ve created a custom decoder by inheriting from JSONDecoder. Any extra keyword arguments to load() are supplied to the class constructor. A function that’s called with the result of every JSON object that is decoded. By default, this is the built-in dict() function. A function that’s called to decode JSON floating-point values. By default, this is the built-in float() function. A function that’s called to decode JSON integer values. By default, this is the built-in int() function. A function that’s called to decode JSON constants such as 'NaN', 'true', 'false', etc.\n\nparse_constant\n\nloads(s, **opts)\n\nThe same as load() except that an object is deserialized from the string s.\n\nAlthough these functions share the same names as functions from the pickle and marshal modules and they serialize data, they are not used in the same way. Specifically, you should not use dump() to write more than one JSON-encoded object to the same file. Similarly, load() cannot be used to read more than one JSON-encoded object from the same file (if the input file has more than one object in it, you’ll get an error). JSON-encoded objects should be treated in the same manner as HTML or XML. For example, you usually don’t take two completely separate XML documents and just con- catenate them together in the same file.\n\nIf you want to customize the encoding or decoding process, inherit from these base\n\nclasses:\n\nJSONDecoder(**opts)\n\nA class that decodes JSON data. optsrepresents a set of keyword arguments that are identical to those used by the load() function.An instance dof JSONDecoder has the following two methods:\n\nd.decode(s)\n\nReturns the Python representation of the JSON object in s. sis a string.\n\nF h Lib f L Bdff\n\n566\n\nChapter 24 Internet Data Handling and Encoding\n\nd.raw_decode(s)\n\nReturns a tuple (pyobj, index) where pyobjis the Python representation of a JSON object in sand indexis the position in swhere the JSON object ended.This can be used if you are trying to parse an object out of an input stream where there is extra data at the end.\n\nJSONEncoder(**opts)\n\nA class that encodes a Python object into JSON. optsrepresents a set of keyword argu- ments that are identical to those used by the dump() function.An instance eof JSONEncoder has the following methods:\n\ne.default(obj)\n\nMethod called when a Python object objcan’t be encoded according to any of the normal encoding rules.The method should return a result which is one of the types that can be encoded (for example, a string, list, or dictionary).\n\ne.encode(obj)\n\nMethod that’s called to create a JSON representation of Python object obj.\n\ne.iterencode(obj)\n\nCreates an iterator that produces the strings making up the JSON representation of Python object objas they are computed.The process of creating a JSON string is high- ly recursive in nature. For instance, it involves iterating over the keys of a dictionary and traversing down into other dictionaries and lists found along the way. If you use this method, you can process the output in a piecemeal manner as opposed to having every- thing collected into a huge in-memory string.\n\nIf you define subclasses that inherit from JSONDecoder or JSONEncoder, you need to exercise caution if your class also defines __init__().To deal with all of the key- word arguments, here is how you should define it:\n\nclass MyJSONDecoder(JSONDecoder):\n\ndef __init__(self, **kwargs): # Get my own arguments foo = kwargs.pop('foo',None) bar = kwargs.pop('bar',None) # Initialize the parent with everything left over JSONDecoder.__init__(self,**kwargs)\n\nmimetypes The mimetypes module is used to guess the MIME type associated with a file, based on its filename extension. It also converts MIME types to their standard filename exten- sions. MIME types consist of a type/subtype pair—for example 'text/html', 'image/png', or 'audio/mpeg'.\n\nguess_type(filename [, strict])\n\nGuesses the MIME type of a file based on its filename or URL. Returns a tuple (type, encoding) in which typeis a string of the form \"type/subtype\" and encodingis the program used to encode the data for transfer (for example, compress or gzip). Returns (None, None) if the type cannot be guessed. If strictis True (the\n\nF h Lib f L Bdff\n\nquopri\n\n567\n\ndefault), then only official MIME types registered with IANA are recognized (see http://www.iana.org/assignments/media-types). Otherwise, some common, but unoffi- cial MIME types are also recognized.\n\nguess_extension(type [, strict])\n\nGuesses the standard file extension for a file based on its MIME type. Returns a string with the filename extension including the leading dot (.). Returns None for unknown types. If strictis True (the default), then only official MIME types are recognized.\n\nguess_all_extensions(type [, strict])\n\nThe same as guess_extension() but returns a list of all possible filename extensions.\n\ninit([files])\n\nInitializes the module. filesis a sequence of filenames that are read to extract type information.These files contain lines that map a MIME type to a list of acceptable file suffixes such as the following:\n\nimage/jpeg: jpe jpeg jpg text/html: htm html ...\n\nread_mime_types(filename)\n\nLoads type mapping from a given filename. Returns a dictionary mapping filename extensions to MIME type strings. Returns None if filenamedoesn’t exist or cannot be read.\n\nadd_type(type, ext [, strict])\n\nAdds a new MIME type to the mapping. typeis a MIME type such as 'text/plain', extis a filename extension such as '.txt', and strictis a Boolean indicating whether the type is an officially registered MIME type. By default, strictis True.\n\nquopri The quopri module performs quoted-printable transport encoding and decoding of byte strings.This format is used primarily to encode 8-bit text files that are mostly read- able as ASCII but which may contain a small number of non-printing or special charac- ters (for example, control characters or non-ASCII characters in the range 128-255). The following rules describe how the quoted-printable encoding works:\n\nn Any printable non-whitespace ASCII character, with the exception of '=', is rep-\n\nresented as is.\n\nn The '=' character is used as an escape character.When followed by two hexadec- imal digits, it represents a character with that value (for example, '=0C').The equals sign is represented by '=3D'. If '=' appears at the end of a line, it denotes a soft line break.This only occurs if a long line of input text must be split into multiple output lines.\n\nn Spaces and tabs are left as is but may not appear at the end of line.\n\nF h Lib f L Bdff\n\n568\n\nChapter 24 Internet Data Handling and Encoding\n\nIt is fairly common to see this format used when documents make use of special char- acters in the extended ASCII character set. For example, if a document contained the text “Copyright © 2009”, this might be represented by the Python byte string b'Copyright \\xa9 2009'.The quoted-printed version of the string is b'Copyright =A9 2009' where the special character '\\xa9' has been replaced by the escape sequence '=A9'.\n\ndecode(input, output [, header])\n\nDecodes bytes into quopri format. inputand outputare file objects opened in binary mode. If header is True, then the underscore (_) will be interpreted as a space. Otherwise, it is left alone.This is used when decoding MIME headers that have been encoded. By default, headeris False.\n\ndecodestring(s [, header])\n\nDecodes a string s. smay be a Unicode or byte string, but the result is always a byte string. headerhas the same meaning as with decode().\n\nencode(input, output, quotetabs [, header])\n\nEncodes bytes into quopri format. inputand outputare file objects opened in binary mode. quotetabs, if set to True, forces tab characters to be quoted in addition to the normal quoting rules. Otherwise, tabs are left as is. By default, quotetabsis False. headerhas the same meaning as for decode().\n\nencodestring(s [, quotetabs [, header]])\n\nEncodes byte string s.The result is also a byte string. quotetabsand headerhave the same meaning as with encode().\n\nNotes\n\nThe quoted-printable data encoding predates Unicode and is only applicable to 8-bit data. Even though it is most commonly applied to text, it really only applies to ASCII and extended ASCII characters represented as single bytes. When you use this module, make sure all files are in binary mode and that you are working with byte strings.\n\nxml Package Python includes a variety of modules for processing XML data.The topic of XML pro- cessing is large, and covering every detail is beyond the scope of this book.This section assumes the reader is already familiar with some basic XML concepts.A book such as Inside XML by Steve Holzner (New Riders) or XML in a Nutshell by Elliotte Harold and W. Scott Means (O’Reilly and Associates) will be useful in explaining basic XML concepts. Several books discuss XML processing with Python including Python & XML by Christopher Jones (O’Reilly and Associates) and XML Processing with Python by Sean McGrath (Prentice Hall).\n\nPython provides two kinds of XML support. First, there is basic support for two industry-standard approaches to XML parsing—SAX and DOM. SAX (Simple API for XML) is based on event handling where an XML document is read sequentially and as XML elements are encountered, handler functions get triggered to perform processing. DOM (Document Object Model) builds a tree structure representing an entire XML\n\nF h Lib f L Bdff\n\nxml Package\n\n569\n\ndocument. Once the tree has been built, DOM provides an interface for traversing the tree and extracting data. Neither the SAX nor DOM APIs originate with Python. Instead, Python simply copies the standard programming interface that was developed for Java and JavaScript.\n\nAlthough you can certainly process XML using the SAX and DOM interfaces, the\n\nmost convenient programming interface in the standard library is the ElementTree interface.This is a Python-specific approach to XML parsing that takes full advantage of Python language features and which most users find to be significantly easier and faster than SAX or DOM.The rest of this section covers all three XML parsing approaches, but the ElementTree approach is given the most detail.\n\nReaders are advised that the coverage here is really only focused on basic parsing of XML data. Python also includes XML modules related to implementing new kinds of parsers, building XML documents from scratch, and so forth. In addition, a variety of third-party extensions extend Python’s capabilities with additional XML features such as support for XSLT and XPATH. Links to further information can be found at http:// wiki.python.org/moin/PythonXml.\n\nXML Example Document The following example illustrates a typical XML document, in this case a description of a recipe.\n\n<?xml version=\"1.0\" encoding=\"iso-8859-1\"?> <recipe>\n\n<title> Famous Guacamole </title> <description> A southwest favorite! </description> <ingredients>\n\n<item num=\"4\"> Large avocados, chopped </item> <item num=\"1\"> Tomato, chopped </item> <item num=\"1/2\" units=\"C\"> White onion, chopped </item> <item num=\"2\" units=\"tbl\"> Fresh squeezed lemon juice </item> <item num=\"1\"> Jalapeno pepper, diced </item> <item num=\"1\" units=\"tbl\"> Fresh cilantro, minced </item> <item num=\"1\" units=\"tbl\"> Garlic, minced </item> <item num=\"3\" units=\"tsp\"> Salt </item> <item num=\"12\" units=\"bottles\"> Ice-cold beer </item>\n\n</ingredients> <directions> Combine all ingredients and hand whisk to desired consistency. Serve and enjoy with ice-cold beers. </directions>\n\n</recipe>\n\nThe document consists of elementsthat start and end with tags such as <title>...</title>. Elements are typically nested and organized into a hierarchy— for example, the <item> elements that appear under <ingredients>.Within each doc- ument, a single element is the document root. In the example, this is the <receipe> element. Elements optionally have attributes as shown for the item elements <item num=\"4\">Large avocados, chopped</item>.\n\nWorking with XML documents typically involves all of these basic features. For example, you may want to extract text and attributes from specific element types.To\n\nF h Lib f L Bdff",
      "page_number": 571
    },
    {
      "number": 29,
      "title": "Segment 29 (pages 594-616)",
      "start_page": 594,
      "end_page": 616,
      "detection_method": "synthetic",
      "content": "570\n\nChapter 24 Internet Data Handling and Encoding\n\nlocate elements, you have to navigate through the document hierarchy starting at the root element.\n\nxml.dom.minidom The xml.dom.minicom module provides basic support for parsing an XML document and storing it in memory as a tree structure according to the conventions of DOM. There are two parsing functions:\n\nparse(file [, parser])\n\nParses the contents of fileand returns a node representing the top of the document tree. ileis a filename or an already-open file object. parseris an optional SAX2-com- patible parser object that will be used to construct the tree. If omitted, a default parser will be used.\n\nparseString(string [, parser])\n\nThe same as parse(), except that the input data is supplied in a string instead of a file.\n\nNodes The document tree returned by the parsing functions consists of a collection of nodes linked together. Each node nhas the following attributes which can be used to extract information and navigate through the tree structure:\n\nNode Attribute n.attributes\n\nn.childNodes\n\nn.firstChild\n\nn.lastChild\n\nn.localName\n\nn.namespaceURI\n\nn.nextSibling\n\nn.nodeName\n\nn.nodeType\n\nn.nodeValue\n\nn.parentNode\n\nDescription Mapping object that holds attribute values (if any). A list of all child nodes of n. The first child of node n. The last child of node n. Local tag name of an element. If a colon appears in the tag (for example, '<foo:bar ...>'), then this only contains the part after the colon. Namespace associated with n, if any. The node that appears after nin the tree and has the same parent. Is None if nis the last sibling. The name of the node. The meaning depends on the node type. Integer describing the node type. It is set to one of the follow- ing values which are class variables of the Node class: ATTRIBUTE_NODE, CDATA_SECTION_NODE, COMMENT_NODE, DOCUMENT_FRAGMENT_NODE, DOCUMENT_NODE, DOCUMENT_TYPE_NODE, ELEMENT_NODE, ENTITY_NODE, ENTITY_REFERENCE_NODE, NOTATION_NODE, PROCESSING_INSTRUCTION_NODE, or TEXT_NODE. The value of the node. The meaning depends on the node type. A reference to the parent node. Part of a tag name that appears before a colon. For example, the element '<foo:bar ...>' would have a prefix of 'foo'.\n\nn.prefix\n\nn.previousSibling The node that appears before nin the tree and has the same\n\nparent.\n\nF h Lib f L Bdff\n\nxml Package\n\n571\n\nIn addition to these attributes, all nodes have the following methods.Typically, these are used to manipulate the tree structure.\n\nn.appendChild(child)\n\nAdds a new child node, child, to n.The new child is added at the end of any other children.\n\nn.cloneNode(deep)\n\nMakes a copy of the node n. If deepis True, all child nodes are also cloned.\n\nn.hasAttributes()\n\nReturns True if the node has any attributes.\n\nn.hasChildNodes()\n\nReturns True if the node has any children.\n\nn.insertBefore(newchild, ichild)\n\nInserts a new child, newchild, before another child, ichild. ichildmust already be a child of n.\n\nn.isSameNode(other)\n\nReturns True if the node otherrefers to the same DOM node as n.\n\nn.normalize()\n\nJoins adjacent text nodes into a single text node.\n\nn.removeChild(child)\n\nRemoves child childfrom n.\n\nn.replaceChild(newchild,oldchild)\n\nReplaces the child oldchildwith newchild. oldchildmust already be a child of n. Although there are many different types of nodes that might appear in a tree, it is\n\nmost common to work with Document, Element, and Text nodes. Each is briefly described next.\n\nDocument Nodes A Document node dappears at the top of the entire document tree and represents the entire document as a whole. It has the following methods and attributes:\n\nd.documentElement\n\nContains the root element of the entire document.\n\nd.getElementsByTagName(tagname)\n\nSearches all child nodes and returns a list of elements with a given tag name tagname.\n\nd.getElementsByTagNameNS(namespaceuri, localname)\n\nSearches all child nodes and returns a list of elements with a given namespace URI and local name.The returned list is an object of type NodeList.\n\nF h Lib f L Bdff\n\n572\n\nChapter 24 Internet Data Handling and Encoding\n\nElement Nodes An Element node erepresents a single XML element such as '<foo>...</foo>'.To get the text from an element, you need to look for Text nodes as children.The follow- ing attributes and methods are defined to get other information:\n\ne.tagName\n\nThe tag name of the element. For example, if the element is defined by '<foo ...>', the tag name is 'foo'.\n\ne.getElementsByTagName(tagname)\n\nReturns a list of all children with a given tag name.\n\ne.getElementsByTagNameNS(namespaceuri, localname)\n\nReturns a list of all children with a given tag name in a namespace. namespaceuriand localnameare strings that specify the namespace and tag name. If a namespace has been declared using a declaration such as '<foo xmlns:foo=\"http://www.spam.com/foo\">', namespaceuriis set to 'http://www.spam.com/foo'. If searching for a subsequent element '<foo:bar>', localnameis set to 'bar'.The returned object is of type NodeList.\n\ne.hasAttribute(name)\n\nReturns True if an element has an attribute with name name.\n\ne.hasAttributeNS(namespaceuri, localname)\n\nReturns True if an element has an attribute named by namespaceuriand localname. The arguments have the same meaning as described for getElementsByTagNameNS().\n\ne.getAttribute(name)\n\nReturns the value of attribute name.The return value is a string. If the attribute doesn’t exist, an empty string is returned.\n\ne.getAttributeNS(namespaceuri, localname)\n\nReturns the value of the attributed named by namespaceuriand localname.The return value is a string.An empty string is returned if the attribute does not exist.The arguments are the same as described for getElementsByTagNameNS().\n\nText Nodes Text nodes are used to represent text data.Text data is stored in the t.data attribute of a Text object t.The text associated with a given document element is always stored in Text nodes that are children of the element.\n\nUtility Functions The following utility methods are defined on nodes.These are not part of the DOM standard, but are provided by Python for general convenience and for debugging.\n\nn.toprettyxml([indent [, newl]])\n\nCreates a nicely formatted string containing the XML represented by node nand its children. indentspecifies an indentation string and defaults to a tab ('\\t'). newlspec- ifies the newline character and defaults to '\\n'.\n\nF h Lib f L Bdff\n\nxml Package\n\n573\n\nn.toxml([encoding])\n\nCreates a string containing the XML represented by node nand its children. encoding specifies the encoding (for example, 'utf-8'). If no encoding is given, none is specified in the output text.\n\nn.writexml(writer [, indent [, addindent [, newl]]])\n\nWrites XML to writer. writercan be any object that provides a write() method that is compatible with the file interface. indentspecifies the indentation of n. It is a string that is prepended to the start of node nin the output. addindentis a string that specifies the incremental indentation to apply to child nodes of n. newlspecifies the newline character.\n\nDOM Example The following example shows how to use the xml.dom.minidom module to parse and extract information from an XML file:\n\nfrom xml.dom import minidom doc = minidom.parse(\"recipe.xml\")\n\ningredients = doc.getElementsByTagName(\"ingredients\")[0] items = ingredients.getElementsByTagName(\"item\")\n\nfor item in items:\n\nnum = item.getAttribute(\"num\") units = item.getAttribute(\"units\") text = item.firstChild.data.strip() quantity = \"%s %s\" % (num,units) print(\"%-10s %s\" % (quantity,text))\n\nNote\n\nThe xml.dom.minidom module has many more features for changing the parse tree and working with different kinds of XML node types. More information can be found in the online documentation.\n\nxml.etree.ElementTree The xml.etree.ElementTree module defines a flexible container object ElementTree for storing and manipulating hierarchical data.Although this object is commonly used in conjunction with XML processing, it is actually quite general-purpose—serving a role that’s a cross between a list and dictionary.\n\nElementTree objects The following class is used to define a new ElementTree object and represents the top level of a hierarchy.\n\nElementTree([element [, file]])\n\nCreates a new ElementTree object. elementis an instance representing the root node of the tree.This instance supports the element interface described next. fileis either a filename or a file-like object from which XML data will be read to populate the tree.\n\nF h Lib f L Bdff\n\n574\n\nChapter 24 Internet Data Handling and Encoding\n\nAn instance treeof ElementTree has the following methods:\n\ntree._setroot(element)\n\nSets the root element to element.\n\ntree.find(path)\n\nFinds and returns the first top-level element in the tree whose type matches the given path. pathis a string that describes the element type and its location relative to other elements.The following list describes the path syntax:\n\nPath 'tag'\n\nDescription Matches only top-level elements with the given tag—for example, <tag>...</tag>. Does not match elements defined at lower levels. A element of type tagembedded inside another element such as <foo><tag>...</tag></foo> is not matched. 'parent/tag' Matches an element with tag 'tag' if it’s a child of an element with tag 'parent'. As many path name components can be specified as desired. Selects all child elements. For example, '*/tag' would match all grandchild elements with a tag name of 'tag'. Starts the search with the current node. Selects all subelements on all levels beneath an element. For exam- ple, './/tag' matches all elements with tag 'tag' at all sublevels.\n\n'*'\n\n'.'\n\n'//'\n\nIf you are working with a document involving XML namespaces, the tagstrings in a path should have the form '{uri}tag' where uriis a string such as 'http://www.w3.org/TR/html4/'.\n\ntree.findall(path)\n\nFinds all top-level elements in the tree that match the given path and returns them in document order as a list or an iterator.\n\ntree.findtext(path [, default])\n\nReturns the element text for the first top-level element in the tree matching the given path. defaultis a string to return if no matching element can be found.\n\ntree.getiterator([tag])\n\nCreates an iterator that produces all elements in the tree, in section order, whose tag matches tag. If tagis omitted, then every element in the tree is returned in order.\n\ntree.getroot()\n\nReturns the root element for the tree.\n\ntree.parse(source [, parser])\n\nParses external XML data and replaces the root element with the result. sourceis either a filename or file-like object representing XML data. parseris an optional instance of TreeBuilder, which is described later.\n\nF h Lib f L Bdff\n\nxml Package\n\n575\n\ntree.write(file [, encoding])\n\nWrites the entire contents of the tree to a file. fileis either a filename or a file-like object opened for writing. encodingis the output encoding to use and defaults to the interpreter default encoding if not specified ('utf-8' or 'ascii' in most cases).\n\nCreating Elements The types of elements held in an ElementTree are represented by instances of varying types that are either created internally by parsing a file or with the following construc- tion functions:\n\nComment([text])\n\nCreates a new comment element. textis a string or byte string containing the element text.This element is mapped to XML comments when parsing or writing output.\n\nElement(tag [, attrib [, **extra]])\n\nCreates a new element. tagis the name of the element name. For example, if you were creating an element '<foo>....</foo>', tagwould be 'foo'. attribis a dictionary of element attributes specified as strings or byte strings.Any extra keyword arguments supplied in extraare also used to set element attributes.\n\nfromstring(text)\n\nCreates an element from a fragment of XML text in text—the same as XML() described next.\n\nProcessingInstruction(target [, text])\n\nCreates a new element corresponding to a processing instruction. targetand textare both strings or byte strings.When mapped to XML, this element corresponds to '<?target text?>'.\n\nSubElement(parent, tag [, attrib [, **extra]])\n\nThe same as Element(), but it automatically adds the new element as a child of the element in parent.\n\nXML(text)\n\nCreates an element by parsing a fragment of XML code in text. For example, if you set textto '<foo>....</foo>', this will create a standard element with a tag of 'foo'.\n\nXMLID(text)\n\nThe same as XML(text) except that 'id' attributes are collected and used to build a dictionary mapping ID values to elements. Returns a tuple (elem, idmap) where elemis the new element and idmapis the ID mapping dictionary. For example, XMLID('<foo id=\"123\"><bar id=\"456\">Hello</bar></foo>') returns (<Element foo>, {'123': <Element foo>, '456': <Element bar>}).\n\nF h Lib f L Bdff\n\n576\n\nChapter 24 Internet Data Handling and Encoding\n\nThe Element Interface Although the elements stored in an ElementTree may have varying types, they all sup- port a common interface. If elemis any element, then the following Python operators are defined:\n\nOperator elem[n] elem[n] = newelem Changes the nth child element of elemto a different element\n\nDescription Returns the nth child element of elem.\n\ndel elem[n]\n\nlen(elem)\n\nnewelem. Deletes the nth child element of elem. Number of child elements of elem.\n\nAll elements have the following basic data attributes:\n\nAttribute elem.tag\n\nelem.text\n\nelem.tail\n\nDescription String identifying the element type. For example, <foo>...</foo> has a tag of 'foo'. Data associated with the element. Usually a string containing text between the start and ending tags of an XML element. Additional data stored with the attribute. For XML, this is usu- ally a string containing whitespace found after the element’s end tag but before the next tag starts. Dictionary containing the element attributes.\n\nelem.attrib\n\nElements support the following methods, some of which emulate methods on dictionaries:\n\nelem.append(subelement)\n\nAppends the element subelementto the list of children.\n\nelem.clear()\n\nClears all of the data in an element including attributes, text, and children.\n\nelem.find(path)\n\nFinds the first subelement whose type matches path.\n\nelem.findall(path)\n\nFinds all subelements whose type matches path. Returns a list or an iterable with the matching elements in document order.\n\nelem.findtext(path [, default])\n\nFinds the text for the first element whose type patches path. defaultis a string giving the value to return if there is no match.\n\nelem.get(key [, default])\n\nGets the value of attribute key. defaultis a default value to return if the attribute doesn’t exist. If XML namespaces are involved, then keywill be a string of the form '{uri}key}' where uriis a string such as 'http://www.w3.org/TR/html4/'.\n\nF h Lib f L Bdff\n\nxml Package\n\n577\n\nelem.getchildren()\n\nReturns all subelements in document order.\n\nelem.getiterator([tag])\n\nReturns an iterator that produces all subelements whose type matches tag.\n\nelem.insert(index, subelement)\n\nInserts a subelement at position indexin the list of children.\n\nelem.items()\n\nReturns all element attributes as a list of (name, value) pairs.\n\nelem.keys()\n\nReturns a list of all of the attribute names.\n\nelem.remove(subelement)\n\nRemoves element subelementfrom the list of children.\n\nelem.set(key, value)\n\nSets attribute keyto value value.\n\nTree Building An ElementTree object is easy to create from other tree-like structures.The following object is used for this purpose.\n\nTreeBuilder([element_factory])\n\nA class that builds an ElementTree structure using a series of start(), end(), and data() calls as would be triggered while parsing a file or traversing another tree struc- ture. element_factoryis an operation function that is called to create new element instances.\n\nAn instance tof TreeBuilder has these methods:\n\nt.close()\n\nCloses the tree builder and returns the top-level ElementTree object that has been cre- ated.\n\nt.data(data)\n\nAdds text data to the current element being processed.\n\nt.end(tag)\n\nCloses the current element being processed and returns the final element object.\n\nt.start(tag, attrs)\n\nCreates a new element. tagis the element name, and attrsis a dictionary with the attribute values.\n\nF h Lib f L Bdff\n\n578\n\nChapter 24 Internet Data Handling and Encoding\n\nUtility Functions The following utility functions are defined:\n\ndump(elem)\n\nDumps the element structure of elemto sys.stdout for debugging.The output is usually XML.\n\niselement(elem)\n\nChecks if elemis a valid element object.\n\niterparse(source [, events])\n\nIncrementally parses XML from source. sourceis a filename or a file-like object referring to XML data. eventsis a list of event types to produce. Possible event types are 'start', 'end', 'start-ns', and 'end-ns'. If omitted, only 'end' events are produced.The value returned by this function is an iterator that produces tuples (event, elem) where eventis a string such as 'start' or 'end' and elemis the element being processed. For 'start' events, the element is newly created and initially empty except for attributes. For 'end' events, the element is fully populated and includes all subelements.\n\nparse(source)\n\nFully parses an XML source into an ElementTree object. sourceis a filename or file- like object with XML data.\n\ntostring(elem)\n\nCreates an XML string representing elemand all of its subelements.\n\nXML Examples Here is an example of using ElementTree to parse the sample recipe file and print an ingredient list. It is similar to the example shown for DOM.\n\nfrom xml.etree.ElementTree import ElementTree\n\ndoc = ElementTree(file=\"recipe.xml\") ingredients = doc.find('ingredients')\n\nfor item in ingredients.findall('item'):\n\nnum = item.get('num') units = item.get('units','') text = item.text.strip() quantity = \"%s %s\" % (num, units) print(\"%-10s %s\" % (quantity, text))\n\nThe path syntax of ElementTree makes it easier to simplify certain tasks and to take shortcuts as necessary. For example, here is a different version of the previous code that uses the path syntax to simply extract all <item>...</item> elements.\n\nfrom xml.etree.ElementTree import ElementTree\n\ndoc = ElementTree(file=\"recipe.xml\") for item in doc.findall(\".//item\"):\n\nnum = item.get('num') units = item.get('units','') text = item.text.strip() quantity = \"%s %s\" % (num, units) print(\"%-10s %s\" % (quantity, text))\n\nF h Lib f L Bdff\n\nxml Package\n\n579\n\nConsider an XML file 'recipens.xml' that makes use of namespaces:\n\n<?xml version=\"1.0\" encoding=\"iso-8859-1\"?> <recipe xmlns:r=\"http://www.dabeaz.com/namespaces/recipe\">\n\n<r:title> Famous Guacamole </r:title> <r:description> A southwest favorite! </r:description> <r:ingredients>\n\n<r:item num=\"4\"> Large avocados, chopped </r:item> ...\n\n</r:ingredients> <r:directions> Combine all ingredients and hand whisk to desired consistency. Serve and enjoy with ice-cold beers. </r:directions>\n\n</recipe>\n\nTo work with the namespaces, it is usually easiest to use a dictionary that maps the namespace prefix to the associated namespace URI.You then use string formatting operators to fill in the URI as shown here:\n\nfrom xml.etree.ElementTree import ElementTree doc = ElementTree(file=\"recipens.xml\") ns = {\n\n'r' : 'http://www.dabeaz.com/namespaces/recipe'\n\n} ingredients = doc.find('{%(r)s}ingredients' % ns) for item in ingredients.findall('{%(r)s}item' % ns):\n\nnum = item.get('num') units = item.get('units','') text = item.text.strip() quantity = \"%s %s\" % (num, units) print(\"%-10s %s\" % (quantity, text))\n\nFor small XML files, it is fine to use the ElementTree module to quickly load them into memory so that you can work with them. However, suppose you are working with a huge XML file with a structure such as this:\n\n<?xml version=\"1.0\" encoding=\"utf-8\"?> <music>\n\n<album>\n\n<title>A Texas Funeral</title> <artist>Jon Wayne</artist> ... </album> <album>\n\n<title>Metaphysical Graffiti</title> <artist>The Dead Milkmen</artist> ...\n\n</album> ... continues for 100000 more albums ...\n\n</music>\n\nReading a large XML file into memory tends to consume vast amounts of memory. For example, reading a 10MB XML file may result in an in-memory data structure of more than 100MB. If you’re trying to extract information from such files, the easiest way to\n\nF h Lib f L Bdff\n\n580\n\nChapter 24 Internet Data Handling and Encoding\n\ndo it is to use the ElementTree.iterparse() function. Here is an example of itera- tively processing <album> nodes in the previous file:\n\nfrom xml.etree.ElementTree import iterparse\n\niparse = iterparse(\"music.xml\", ['start','end']) # Find the top-level music element for event, elem in iparse:\n\nif event == 'start' and elem.tag == 'music':\n\nmusicNode = elem break\n\n# Get all albums albums = (elem for event, elem in iparse\n\nif event == 'end' and elem.tag == 'album')\n\nfor album in albums:\n\n# Do some kind of processing ... musicNode.remove(album) # Throw away the album when done\n\nThe key to using iterparse() effectively is to get rid of data that you’re no longer using.The last statement musicNode.remove(album) is throwing away each <album> element after we are done processing it (by removing it from its parent). If you monitor the memory footprint of the previous program, you will find that it stays low even if the input file is massive.\n\nNotes\n\nn The ElementTree module is by far the easiest and most flexible way of handling simple XML documents in Python. However, it does not provide a lot of bells and whistles. For example, there is no support for validation, nor does it provide any apparent way to handle complex aspects of XML documents such as DTDs. For these things, you’ll need to install third-party packages. One such package, lxml.etree (at http://codespeak.net/lxml/), provides an ElementTree API to the popular libxml2 and libxslt libraries and provides full support for XPATH, XSLT, and other features.\n\nn The ElementTree module itself is a third-party package maintained by Fredrik Lundh at http://effbot.org/zone/element-index.htm.At this site you can find versions that are more modern than what is included in the standard library and which offer additional features.\n\nxml.sax The xml.sax module provides support for parsing XML documents using the SAX2 API.\n\nparse(file, handler [, error_handler])\n\nParses an XML document, file. fileis either the name of a file or an open file object. handleris a content handler object. error_handleris an optional SAX error- handler object that is described further in the online documentation.\n\nparseString(string, handler [, error_handler])\n\nThe same as parse() but parses XML data contained in a string instead.\n\nF h Lib f L Bdff\n\nxml Package\n\n581\n\nHandler Objects To perform any processing, you have to supply a content handler object to the parse() or parseString() functions.To define a handler, you define a class that inherits from ContentHandler.An instance cof ContentHandler has the following methods, all of which can be overridden in your handler class as needed:\n\nc.characters(content)\n\nCalled by the parser to supply raw character data. contentis a string containing the characters.\n\nc.endDocument()\n\nCalled by the parser when the end of the document is reached.\n\nc.endElement(name)\n\nCalled when the end of element nameis reached. For example, if '</foo>’ is parsed, this method is called with nameset to 'foo'.\n\nc.endElementNS(name, qname)\n\nCalled when the end of an element involving an XML namespace is reached. nameis a tuple of strings (uri, localname) and qnameis the fully qualified name. Usually qnameis None unless the SAX namespace-prefixes feature has been enabled. For example, if the element is defined as '<foo:bar xmlns:foo=\"http://spam.com\">', then the nametuple is (u'http://spam.com', u'bar').\n\nc.endPrefixMapping(prefix)\n\nCalled when the end of an XML namespace is reached. prefixis the name of the namespace.\n\nc.ignorableWhitespace(whitespace)\n\nCalled when ignorable whitespace is encountered in a document. whitespaceis a string containing the whitespace.\n\nc.processingInstruction(target, data)\n\nCalled when an XML processing instruction enclosed in <? ... ?> is encountered. targetis the type of instruction, and datais the instruction data. For example, if the instruction is '<?xml-stylesheet href=\"mystyle.css\" type=\"text/css\"?>, targetis set to 'xml-stylesheet' and datais the remainder of the instruction text 'href=\"mystyle.css\" type=\"text/css\"'.\n\nc.setDocumentLocator(locator)\n\nCalled by the parser to supply a locator object that can be used for tracking line num- bers, columns, and other information.The primary purpose of this method is simply to store the locator someplace so that you can use it later—for instance, if you needed to print an error message.The locator object supplied in locatorprovides four methods—getColumnNumber(), getLineNumber(), getPublicId(), and getSystemId()—that can be used to get location information.\n\nc.skippedEntity(name)\n\nCalled whenever the parser skips an entity. nameis the name of the entity that was skipped.\n\nF h Lib f L Bdff\n\n582\n\nChapter 24 Internet Data Handling and Encoding\n\nc.startDocument()\n\nCalled at the start of a document.\n\nc.startElement(name, attrs)\n\nCalled whenever a new XML element is encountered. nameis the name of the ele- ment, and attrsis an object containing attribute information. For example, if the XML element is '<foo bar=\"whatever\" spam=\"yes\">', nameis set to 'foo' and attrscontains information about the bar and spam attributes.The attrsobject pro- vides a number of methods for obtaining attribute information:\n\nMethod attrs.getLength() attrs.getNames()\n\nattrs.getType(name)\n\nattrs.getValue(name)\n\nDescription Returns the number of attributes Returns a list of attribute names Gets the type of attribute name Gets the value of attribute name\n\nc.startElementNS(name, qname, attrs)\n\nCalled when a new XML element is encountered and XML namespaces are being used. nameis a tuple (uri, localname) and qnameis a fully qualified element name (normally set to None unless the SAX2 namespace-prefixes feature has been enabled). attrsis an object containing attribute information. For example, if the XML element is '<foo:bar xmlns:foo=\"http://spam.com\" blah=\"whatever\">', then nameis (u'http://spam.com', u'bar'), qnameis None, and attrscontains infor- mation about the attribute blah.The attrsobject has the same methods as used in when accessing attributes in the startElement() method shown earlier. In addition, the following additional methods are added to deal with namespaces:\n\nMethod attrs.getValueByQName(qname) attrs.getNameByQName(qname)\n\nattrs.getQNameByName(name)\n\nattrs.getQNames()\n\nDescription Returns value for qualified name. Returns (namespace, localname) tuple for a name. Returns qualified name for namespecified as a tuple (namespace, localname). Returns qualified names of all attributes.\n\nc.startPrefixMapping(prefix, uri)\n\nCalled at the start of an XML namespace declaration. For example, if an element is defined as '<foo:bar xmlns:foo=\"http://spam.com\">', then prefixis set to 'foo' and uriis set to 'http://spam.com'.\n\nExample The following example illustrates a SAX-based parser, by printing out the ingredient list from the recipe file shown earlier.This should be compared with the example in the xml.dom.minidom section.\n\nF h Lib f L Bdff\n\nxml Package\n\n583\n\nfrom xml.sax import ContentHandler, parse\n\nclass RecipeHandler(ContentHandler):\n\ndef startDocument(self):\n\nself.initem = False\n\ndef startElement(self,name,attrs):\n\nif name == 'item':\n\nself.num = attrs.get('num','1') self.units = attrs.get('units','none') self.text = [] self.initem = True def endElement(self,name): if name == 'item':\n\ntext = \"\".join(self.text) if self.units == 'none': self.units = \"\" unitstr = \"%s %s\" % (self.num, self.units) print(\"%-10s %s\" % (unitstr,text.strip())) self.initem = False\n\ndef characters(self,data):\n\nif self.initem:\n\nself.text.append(data)\n\nparse(\"recipe.xml\",RecipeHandler())\n\nNotes The xml.sax module has many more features for working with different kinds of XML data and creating custom parsers. For example, there are handler objects that can be defined to parse DTD data and other parts of the document. More information can be found in the online documentation.\n\nxml.sax.saxutils The xml.sax.saxutils module defines some utility functions and objects that are often used with SAX parsers, but are often generally useful elsewhere.\n\nescape(data [, entities])\n\nGiven a string, data, this function replaces certain characters with escape sequences. For example, '<' gets replaced by '&lt;'. entitiesis an optional dictionary that maps characters to the escape sequences. For example, setting entitiesto { u'\\xf1' : '&ntilde;' } would replace occurences of ñ with '&ntilde;'.\n\nunescape(data [, entities])\n\nUnescapes special escape sequences that appear in data. For instance, '&lt;' is replaced by '<'. entitiesis an optional dictionary mapping entities to unescaped character values. entitiesis the inverse of the dictionary used with escape()—for example, { '&ntilde;' : u'\\xf1' }.\n\nquoteattr(data [, entities])\n\nEscapes the string data, but performs additional processing that allows the result value to be used as an XML attribute value.The return value can be printed directly as an attribute value—for example, print \"<element attr=%s>\" % quoteattr(somevalue). entitiesis a dictionary compatible for use with the escape() function.\n\nF h Lib f L Bdff\n\n584\n\nChapter 24 Internet Data Handling and Encoding\n\nXMLGenerator([out [, encoding]])\n\nA ContentHandler object that merely echoes parsed XML data back to the output stream as an XML document.This re-creates the original XML document. outis the output document and defaults to sys.stdout. encodingis the character encoding to use and defaults to 'iso-8859-1'.This can be useful if you’re trying to debug your parsing code and use a handler that is known to work.\n\nF h Lib f L Bdff\n\n25\n\nMiscellaneous Library Modules\n\nThe modules listed in this section are not covered in detail in this book but are still\n\nconsidered to be part of the standard library.These modules have mostly been omitted from previous chapters because they are either extremely low-level and of limited use, restricted to very specific platforms, obsolete, or so complicated that coverage would require a complete book on the topic.Although these modules are have been omitted from this book, online documentation is available for each module at http:// docs.python.org/library/modname.An index of all modules is also available at http://docs.python.org/library/modindex.html.\n\nThe modules listed here represent a common subset of functionality between Python 2 and Python 3. If you are using a module that is not listed here, chances are it has been officially deprecated. Some modules have changed names in Python 3.The new name is shown in parentheses, if applicable.\n\nPython Services The following modules provide additional services related to the Python language and execution of the Python interpreter. Many of these modules are related to parsing and compilation of Python source code.\n\nModule bdb\n\ncode\n\ncodeop\n\ncompileall copy_reg (copyreg) dis\n\ndistutils\n\nfpectl\n\nimp\n\nkeyword\n\nlinecache\n\nDescription Access to the debugger framework Interpreter base classes Compiles Python code Byte-compiles Python files in a directory Register built-in types for use with the pickle module Disassembler Distribution of Python modules Floating-point exception control Provides access to the implementation of the import statement Tests whether a string is a Python keyword Retrieves lines from source files Finds modules used by a script\n\nmodulefinder\n\nF h Lib f L Bdff\n\n586\n\nChapter 25 Miscellaneous Library Modules\n\nModule parser\n\npickletools\n\npkgutil\n\npprint\n\npyclbr\n\npy_compile repr (reprlib) symbol\n\ntabnanny\n\ntest\n\ntoken\n\ntokenize\n\nuser\n\nDescription Accesses parse trees of Python source code Tools for pickle developers Package extension utility Prettyprinter for objects Extracts information for class browsers Compiles Python source to bytecode files Alternate implementation of the repr() function Constants used to represent internal nodes of parse trees Detection of ambiguous indentation Regression testing package Terminal nodes of the parse tree Scanner for Python source code User configuration file parsing Import modules from zip archives\n\nzipimport\n\nString Processing The following modules are some older, now obsolete, modules used for string processing.\n\nModule difflib\n\nfpformat\n\nstringprep\n\ntextwrap\n\nDescription Compute deltas between strings Floating-point number formatting Internet string preparation Text wrapping\n\nOperating System Modules These modules provide additional operating system services. In some cases, the func- tionality of a module listed here is already incorporated into the functionality of other modules covered in Chapter 19,“Operating System Services.”\n\nModule crypt\n\ncurses\n\ngrp\n\npty\n\npipes\n\nnis\n\nplatform\n\npwd\n\nreadline\n\nDescription Access to the UNIX crypt function Curses library interface Access to the group database Pseudo terminal handling Interface to shell pipelines Interface to Sun’s NIS Access to platform-specific information Access to the password database Access to GNU readline library Completion function for GNU readline\n\nrlcompleter\n\nF h Lib f L Bdff\n\nInternationalization\n\n587\n\nModule resource\n\nsched\n\nspwd\n\nstat\n\nsyslog\n\ntermios\n\nDescription Resource usage information Event scheduler Access to the shadow password database Support for interpreting results of os.stat() Interface to UNIX syslog daemon UNIX TTY control Terminal control functions\n\ntty\n\nNetwork The following modules provide support for lesser-used network protocols:\n\nModule imaplib\n\nnntplib\n\npoplib\n\nsmtpd\n\ntelnetlib\n\nDescription IMAP protocol NNTP protocol POP3 protocol SMTP server Telnet protocol\n\nInternet Data Handling The following modules provide additional support for Internet data processing not cov- ered in Chapter 24,“Internet Data Handling and Encoding.”\n\nModule binhex\n\nformatter\n\nmailcap\n\nmailbox\n\nnetrc\n\nplistlib\n\nuu\n\nDescription BinHex4 file format support Generic output formatting Mailcap file handling Reading various mailbox formats Netrc file processing Macintosh plist file processing UUencode file support Encode and decode Sun XDR data\n\nxdrlib\n\nInternationalization The following modules are used for writing internationalized applications:\n\nModule gettext\n\nlocale\n\nDescription Multilingual text handling services Internationalization functions provided by the system\n\nF h Lib f L Bdff\n\n588\n\nChapter 25 Miscellaneous Library Modules\n\nMultimedia Services The following modules provide support for handling various kinds of multimedia files:\n\nModule audioop\n\naifc\n\nsunau\n\nwave\n\nchunk\n\ncolorsys\n\nimghdr\n\nsndhdr\n\nDescription Manipulates raw audio data Reads and writes AIFF and AIFC files Reads and writes Sun AU files Reads and writes WAV files Reads IFF chunked data Conversions between color systems Determines the type of an image Determines the type of a sound file Access to OSS-compatible audio devices\n\nossaudiodev\n\nMiscellaneous The following modules round out the list and don’t really neatly fall into any of the other categories:\n\nModule cmd\n\ncalendar\n\nshlex\n\nsched Tkinter (tkinter) winsound\n\nDescription Line-oriented command interpreters Calendar-generation functions Simple lexical analysis module Event scheduler Python interface to Tcl/Tk Playing sounds on Windows\n\nF h Lib f L Bdff\n\nIII\n\nExtending and Embedding\n\n26\n\nExtending and Embedding Python\n\nAppendix: Python 3\n\nF h Lib f L Bdff\n\nThis page intentionally left blank\n\nF h Lib f L Bdff\n\n26\n\nExtending and Embedding Python\n\nOne of the most powerful features of Python is its ability to interface with software\n\nwritten in C.There are two common strategies for integrating Python with foreign code. First, foreign functions can be packaged into a Python library module for use with the import statement. Such modules are known as extension modules because they extend the interpreter with additional functionality not written in Python.This is, by far, the most common form of Python-C integration because it gives Python applica- tions access to high-performance programming libraries.The other form of Python-C integration is embedding.This is a process by which Python programs and the interpreter are accessed as a library from C.This latter approach is sometimes used by programmers who want to embed the Python interpreter into an existing C application framework for some reason—usually as some kind of scripting engine.\n\nThis chapter covers the absolute basics of the Python-C programming interface. First, the essential parts of the C API used to build extension modules and embed the Python interpreter are covered.This section is not intended to be a tutorial, so readers new to this topic should consult the “Embedding and Extending the Python Interpreter” document available at http://docs.python.org/extending, as well as the “Python/C API Reference Manual” available at http://docs.python.org/c-api. Next, the ctypes library module is covered.This is an extremely useful module that allows you to access functions in C libraries without writing any additional C code or using a C compiler.\n\nIt should be noted that for advanced extension and embedding applications, most programmers tend to turn to advanced code generators and programming libraries. For example, the SWIG project (http://www.swig.org) is a compiler that creates Python extension modules by parsing the contents of C header files. References to this and other extension building tools can be found at http://wiki.python.org/moin/ IntegratingPythonWithOtherLanguages.\n\nExtension Modules This section outlines the basic process of creating a handwritten C extension module for Python.When you create an extension module, you are building an interface\n\nF h Lib f L Bdff\n\n592\n\nChapter 26 Extending and Embedding Python\n\nbetween Python and existing functionality written in C. For C libraries, you usually start from a header file such as the following:\n\n/* file : example.h */ #include <stdio.h> #include <string.h> #include <math.h>\n\ntypedef struct Point {\n\ndouble x; double y;\n\n} Point;\n\n/* Compute the GCD of two integers x and y */ extern int gcd(int x, int y);\n\n/* Replace och with nch in s and return the number of replacements */ extern int replace(char *s, char och, char nch);\n\n/* Compute the distance between two points */ extern double distance(Point *a, Point *b);\n\n/* A preprocessor constant */ #define MAGIC 0x31337\n\nThese function prototypes have some kind of implementation in a separate file. For example:\n\n/* example.c */ #include \"example.h\" /* Compute GCD of two positive integers x and y */ int gcd(int x, int y) {\n\nint g; g = y; while (x > 0) { g = x; x = y % x; y = g;\n\n} return g;\n\n}\n\n/* Replace a character in a string */ int replace(char *s, char oldch, char newch) {\n\nint nrep = 0; while (s = strchr(s,oldch)) {\n\n(s++) = newch; nrep++;\n\n} return nrep;\n\n}\n\n/* Distance between two points */ double distance(Point *a, Point *b) {\n\ndouble dx,dy; dx = a->x - b->x; dy = a->y - b->y; return sqrt(dx*dx + dy*dy);\n\n}\n\nF h Lib f L Bdff",
      "page_number": 594
    },
    {
      "number": 30,
      "title": "Segment 30 (pages 617-637)",
      "start_page": 617,
      "end_page": 637,
      "detection_method": "synthetic",
      "content": "Extension Modules\n\n593\n\nHere is a C main() program that illustrates the use of these functions:\n\n/* main.c */ #include \"example.h\" int main() {\n\n/* Test the gcd() function */ {\n\nprintf(\"%d\\n\", gcd(128,72)); printf(\"%d\\n\", gcd(37,42));\n\n} /* Test the replace() function */ {\n\nchar s[] = \"Skipping along unaware of the unspeakable peril.\"; int nrep; nrep = replace(s,' ','-'); printf(\"%d\\n\", nrep); printf(\"%s\\n\",s);\n\n} /* Test the distance() function */ {\n\nPoint a = { 10.0, 15.0 }; Point b = { 13.0, 11.0 }; printf(\"%0.2f\\n\", distance(&a,&b));\n\n}\n\n}\n\nHere is the output of the previous program:\n\n% a.out 8 1 6 Skipping-along-unaware-of-the-unspeakable-peril. 5.00\n\nAn Extension Module Prototype Extension modules are built by writing a separate C source file that contains a set of wrapper functions which provide the glue between the Python interpreter and the underlying C code. Here is an example of a basic extension module called _example:\n\n/* pyexample.c */\n\n#include \"Python.h\" #include \"example.h\"\n\nstatic char py_gcd_doc[] = \"Computes the GCD of two integers\"; static PyObject * py_gcd(PyObject *self, PyObject *args) {\n\nint x,y,r; if (!PyArg_ParseTuple(args,\"ii:gcd\",&x,&y)) {\n\nreturn NULL;\n\n} r = gcd(x,y); return Py_BuildValue(\"i\",r);\n\n}\n\nstatic char py_replace_doc[] = \"Replaces all characters in a string\"; static PyObject *\n\nF h Lib f L Bdff\n\n594\n\nChapter 26 Extending and Embedding Python\n\npy_replace(PyObject *self, PyObject *args, PyObject *kwargs) {\n\nstatic char *argnames[] = {\"s\",\"och\",\"nch\",NULL}; char *s,*sdup; char och, nch; int nrep; PyObject *result; if (!PyArg_ParseTupleAndKeywords(args,kwargs, \"scc:replace\", argnames, &s, &och, &nch)) {\n\nreturn NULL;\n\n} sdup = (char *) malloc(strlen(s)+1); strcpy(sdup,s); nrep = replace(sdup,och,nch); result = Py_BuildValue(\"(is)\",nrep,sdup); free(sdup); return result;\n\n}\n\nstatic char py_distance_doc[] = \"Computes the distance between two points\"; static PyObject * py_distance(PyObject *self, PyObject *args) {\n\nPyErr_SetString(PyExc_NotImplementedError,\"distance() not implemented.\"); return NULL;\n\n}\n\nstatic PyMethodDef _examplemethods[] = {\n\n{\"gcd\", py_gcd, METH_VARARGS, py_gcd_doc}, {\"replace\", py_replace, METH_VARARGS | METH_KEYWORDS, py_replace_doc}, {\"distance\",py_distance,METH_VARARGS, py_distance_doc}, {NULL, NULL, 0, NULL}\n\n};\n\n#if PY_MAJOR_VERSION < 3 /* Python 2 module initialization */ void init_example(void) {\n\nPyObject *mod; mod = Py_InitModule(\"_example\", _examplemethods); PyModule_AddIntMacro(mod,MAGIC);\n\n} #else /* Python 3 module initialization */ static struct PyModuleDef _examplemodule = {\n\nPyModuleDef_HEAD_INIT, \"_example\", /* name of module */ NULL, /* module documentation, may be NULL */ -1, _examplemethods\n\n}; PyMODINIT_FUNC PyInit__example(void) {\n\nPyObject *mod; mod = PyModule_Create(&_examplemodule); PyModule_AddIntMacro(mod, MAGIC); return mod;\n\n} #endif\n\nExtension modules always need to include \"Python.h\". For each C function to be accessed, a wrapper function is written.These wrapper functions accept either two arguments (self and args, both of type PyObject *) or three arguments (self, args,\n\nF h Lib f L Bdff\n\nExtension Modules\n\n595\n\nand kwargs, all of type PyObject *).The self parameter is used when the wrapper function is implementing a built-in method to be applied to an instance of some object. In this case, the instance is placed in the self parameter. Otherwise, self is set to NULL. args is a tuple containing the function arguments passed by the interpreter. kwargs is a dictionary containing keyword arguments.\n\nArguments are converted from Python to C using the PyArg_ParseTuple() or PyArg_ParseTupleAndKeywords() function. Similarly, the Py_BuildValue() func- tion is used to construct an acceptable return value.These functions are described in later sections.\n\nDocumentation strings for extension functions should be placed in separate string variables such as py_gcd_doc and py_replace_doc as shown.These variables are refer- enced during module initialization (described shortly).\n\nWrapper functions should never, under penalty of certain flaming death, mutate data\n\nreceived by reference from the interpreter.This is why the py_replace() wrapper is making a copy of the received string before passing it to the C function (which modi- fies it in place). If this step is omitted, the wrapper function may violate Python’s string immutability.\n\nIf you want to raise an exception, you use the PyExc_SetString() function as shown in the py_distance() wrapper. NULL is returned to signal that an error has occurred.\n\nThe method table _examplemethods is used to associate Python names with the C\n\nwrapper functions.These are the names used to call the function from the interpreter. The METH_VARARGS flag indicates the calling conventions for a wrapper. In this case, only positional arguments in the form of a tuple are accepted. It can also be set to METH_VARARGS | METH_KEYWORDS to indicate a wrapper function accepting keyword arguments.The method table additionally sets the documentation strings for each wrap- per function.\n\nThe final part of an extension module performs an initialization procedure that varies between Python 2 and Python 3. In Python 2, the module initialization function init_example is used to initialize the contents of the module. In this case, the Py_InitModule(\"_example\",_examplemethods) function creates a module, _example, and populates it with built-in function objects corresponding to the func- tions listed in the method table. For Python 3, you have to create an PyModuleDef object _examplemodule that describes the module.You then write a function PyInit__example() that initializes the module as shown.The module initialization function is also the place where you install constants and other parts of a module, if necessary. For example, the PyModule_AddIntMacro() is adding the value of a pre- processor to the module.\n\nIt is important to note that naming is critically important for module initialization. If\n\nyou are creating a module called modname, the module initialization function must be called initmodname() in Python 2 and PyInit_modname() in Python 3. If you don’t do this, the interpreter won’t be able to correctly load your module.\n\nNaming Extension Modules It is standard practice to name C extension modules with a leading underscore such as '_example'.This convention is followed by the Python standard library itself. For\n\nF h Lib f L Bdff\n\n596\n\nChapter 26 Extending and Embedding Python\n\ninstance, there are modules named _socket, _thread, _sre, and _fileio correspon- ding to the C programming components of the socket, threading, re, and io mod- ules. Generally, you do not use these C extension modules directly. Instead, you create a high-level Python module such as the following:\n\n# example.py from _example import * # Add additional support code below ...\n\nThe purpose of this Python wrapper is to supply additional support code for your module or to provide a higher-level interface. In many cases, it is easier to implement parts of an extension module in Python instead of C.This design makes it easy to do this. If you look at many standard library modules, you will find that they have been implemented as a mix of C and Python in this manner.\n\nCompiling and Packaging Extensions The preferred mechanism for compiling and packaging an extension module is to use distutils.To do this, you create a setup.py file that looks like this:\n\n# setup.py from distutils.core import setup, Extension\n\nsetup(name=\"example\",\n\nversion=\"1.0\", py_modules = ['example.py'], ext_modules = [\n\nExtension(\"_example\",\n\n[\"pyexample.c\",\"example.c\"])\n\n]\n\n)\n\nIn this file, you need to include the high-level Python file (example.py) and the source files making up the extension module (pyexample.c, example.c).To build the module for testing, type the following:\n\n% python setup.py build_ext --inplace\n\nThis will compile the extension code into a shared library and leave it in the current working directory.The name of this library will be _examplemodule.so, _examplemodule.pyd, or some similar variant.\n\nIf the compilation was successful, using your module is straightforward. For example:\n\n% python3.0 Python 3.0 (r30:67503, Dec 4 2008, 09:40:15) [GCC 4.0.1 (Apple Inc. build 5465)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> import example >>> example.gcd(78,120) 6 >>> example.replace(\"Hello World\",' ','-') (1, 'Hello-World') >>> example.distance() Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nNotImplementedError: distance() not implemented. >>>\n\nF h Lib f L Bdff\n\nExtension Modules\n\n597\n\nMore complicated extension modules may need to supply additional build information, such as include directories, libraries, and preprocessor macros.They can also be included in setup.py, as follows:\n\n# setup.py from distutils.core import setup, Extension\n\nsetup(name=\"example\",\n\nversion=\"1.0\", py_modules = ['example.py'], ext_modules = [\n\nExtension(\"_example\",\n\n[\"pyexample.c\",\"example.c\"], include_dirs = [\"/usr/include/X11\",\"/opt/include\"], define_macros = [('DEBUG',1'),\n\n('MONDO_FLAG',1)],\n\nundef_macros = ['HAVE_FOO','HAVE_NOT'], library_dirs= [\"/usr/lib/X11\", \"/opt/lib\"], libraries = [ \"X11\", \"Xt\", \"blah\" ])\n\n]\n\n)\n\nIf you want to install an extension module for general use, you simply type python setup.py install. Further details about this are found in Chapter 8,“Modules, Packages, and Distribution.”\n\nIn some situations, you may want to build an extension module manually.This\n\nalmost always requires advanced knowledge of various compiler and linker options.The following is an example on Linux:\n\nlinux % gcc -c -fpic -I/usr/local/include/python2.6 example.c pyexample.c linux % gcc -shared example.o pyexample.o -o _examplemodule.so\n\nType Conversion from Python to C The following functions are used by extension modules to convert arguments passed from Python to C.Their prototypes are defined by including the Python.h header file.\n\nint PyArg_ParseTuple(PyObject *args, char *format, ...);\n\nParses a tuple of positional arguments in argsinto a series of C variables. formatis a format string containing zero or more of the specifier strings from Tables 26.1–26.3, which describe the expected contents of args.All the remaining arguments contain the addresses of C variables into which the results will be placed.The order and types of these arguments must match the specifiers used in format. Zero is returned if the argu- ments could not be parsed.\n\nint PyArg_ParseTupleAndKeywords(PyObject *args, PyObject *kwargs,\n\nchar *format, char **kwlist, ...);\n\nParses both a tuple of positional arguments and a dictionary of keyword arguments con- tained in kwargs. formathas the same meaning as for PyArg_ParseTuple().The only difference is that kwlistis a null-terminated list of strings containing the names of all the arguments. Returns 1 on success, 0 on error.\n\nTable 26.1 lists the format codes that are placed in the formatargument to convert\n\nnumbers.The C argument type column lists the C data type that should be passed to the PyArg_Parse*() functions. For numbers, it is always a pointer to a location where the result should be stored.\n\nF h Lib f L Bdff\n\n598\n\nChapter 26 Extending and Embedding Python\n\nTable 26.1 Numeric Conversions and Associated C Data Types for PyArg_Parse*\n\nFormat\n\nPython Type\n\nC Argument Type\n\n\"b\"\n\n\"B\"\n\n\"h\"\n\n\"H\"\n\n\"i\"\n\n\"I\"\n\n\"l\"\n\n\"k\"\n\n\"L\"\n\n\"K\"\n\n\"n\"\n\n\"f\"\n\n\"d\"\n\nInteger Integer Integer Integer Integer Integer Integer Integer Integer Integer Integer Float Float Complex\n\nsigned char *r\n\nunsigned char *r\n\nshort *r\n\nunsigned short *r\n\nint *r\n\nunsigned int *r\n\nlong int *r\n\nunsigned long *r\n\nlong long *r\n\nunsigned long long *r\n\nPy_ssize_t *r\n\nfloat *r\n\ndouble *r\n\n\"D\"\n\nPy_complex *r\n\nWhen signed integer values are converted, an OverflowError exception is raised if the Python integer is too large to fit into the requested C data type. However, conversions that accept unsigned values (e.g., 'I', 'H', 'K', and so on) do not check for overflow and will silently truncate the value if it exceeds the supported range. For floating-point conversions, a Python int or float may be supplied as input. In this case, integers will be promoted to a float. User-defined classes are accepted as numbers as long as they provide appropriate conversion methods such as __int__() or __float__(). For example, a user-defined class that implements __int__() will be accepted as input for any of the previously shown integer conversions (and __int__() invoked automatical- ly to do the conversion).\n\nTable 26.2 shows the conversions that apply to strings and bytes. Many of the string\n\nconversions return both a pointer and length as a result.\n\nTable 26.2\n\nString Conversions and Associated C Data Types for PyArg_Parse*\n\nFormat\n\nPython Type\n\nC Argument Type\n\n\"c\"\n\n\"s\"\n\n\"s#\"\n\n\"s*\"\n\n\"z\"\n\n\"z#\"\n\n\"z*\"\n\n\"y\"\n\n\"y#\"\n\n\"y*\"\n\n\"u\"\n\n\"u#\"\n\nString or byte string of length 1 String String, bytes, or buffer String, bytes, or buffer String or None String, bytes, or None String, bytes, buffer, or None Bytes (null-terminated) Bytes Bytes or buffer String (Unicode) String (Unicode) String\n\nchar *r\n\nchar **r\n\nchar **r, int *len\n\nPy_buffer *r\n\nchar **r\n\nchar **r, int *len\n\nPy_buffer *r\n\nchar **r\n\nchar **r, int *len\n\nPy_buffer *r\n\nPy_UNICODE **r\n\nPy_UNICODE **r, int *len\n\n\"es\"\n\nconst char *enc, char **r\n\nF h Lib f L Bdff\n\nExtension Modules\n\n599\n\nTable 26.2\n\nContinued\n\nFormat\n\nPython Type\n\nC Argument Type\n\n\"es#\"\n\nString or bytes\n\nconst char *enc, char **r, int *len\n\n\"et\"\n\nString or null-terminated bytes\n\nconst char *enc, char **r, int *len\n\n\"et#\"\n\nString or bytes\n\nconst char *enc, char **r, int *len\n\n\"t#\"\n\n\"w\"\n\n\"w#\"\n\n\"w*\"\n\nRead-only buffer Read-write buffer Read-write buffer Read-write buffer\n\nchar **r, int *len\n\nchar **r\n\nchar **r, int *len\n\nPy_buffer *r\n\nString handling presents a special problem for C extensions because the char * datatype is used for many different purposes. For instance, it might refer to text, a single character, or a buffer of raw binary data.There is also the issue of what to do with embedded NULL characters ('\\x00') that C uses to signal the end of text strings.\n\nIn Table 26.2, the conversion codes of \"s\", \"z\", \"u\", \"es\", and \"et\" should be used\n\nif you are passing text. For these codes, Python assumes that the input text does not contain any embedded NULLs—if so, a TypeError exception is raised. However, the resulting string in C can be safely assumed to be NULL-terminated. In Python 2, both 8-bit and Unicode strings can be passed, but in Python 3, all conversions except for \"et\" require the Python str type and do not work with bytes.When Unicode strings are passed to C, they are always encoded using the default Unicode encoding used by the interpreter (usually UTF-8).The one exception is the \"u\" conversion code that returns a string using Python’s internal Unicode representation.This is an array of Py_UNICODE values where Unicode characters are typically represented by the wchar_t type in C.\n\nThe \"es\" and \"et\" codes allow you to specify an alternative encoding for the text.\n\nFor these, you supply an encoding name such as 'utf-8' or 'iso-8859-1', and the text will be encoded into a buffer and returned in that format.The \"et\" code differs from \"es\" in that if a Python byte-string is given, it is assumed to have already been encoded and is passed through unmodified. One caution with \"es\" and \"et\" conver- sions is that they dynamically allocate memory for the result and require the user to explicitly release it using PyMem_Free().Thus, code that uses these conversions should look similar to this:\n\nPyObject *py_wrapper(PyObject *self, PyObject *args) {\n\nchar *buffer; if (!PyArg_ParseTuple(args,\"es\",\"utf-8\",&buffer)) {\n\nreturn NULL;\n\n} /* Do something. */ ... /* Cleanup and return the result */ PyMem_Free(buffer); return result;\n\n}\n\nF h Lib f L Bdff\n\n600\n\nChapter 26 Extending and Embedding Python\n\nFor handling text or binary data, use the \"s#\", \"z#\", \"u#\", \"es#\", or \"et#\" codes. These conversions work exactly the same as before except that they additionally return a length. Because of this, the restriction on embedded NULL characters is lifted. In addition, these conversions add support for byte strings and any other objects that sup- port something known as the buffer interface.The buffer interface is a means by which a Python object can expose a raw binary buffer representing its contents.Typically, you find it on strings, bytes, and arrays (e.g., the arrays created in the array module support it). In this case, if an object provides a readable buffer interface, a pointer to the buffer and its size is returned. Finally, if a non-NULL pointer and length are given to the \"es#\" and \"et#\" conversions, it is assumed that these represent a pre-allocated buffer into which the result of the encoding can be placed. In this case, the interpreter does not allocate new memory for the result and you don’t have to call PyMem_Free().\n\nThe conversion codes of \"s*\" and \"z*\" are similar to \"s#\" and \"z#\" except that they populate a Py_buffer structure with information about the received data. More information about this can be found in PEP-3118, but this structure minimally has attributes char *buf, int len, and int itemsize that point to the buffer, the buffer length (in bytes), and the size of items held in the buffer. In addition, the interpreter places a lock on the buffer that prevents it from being changed by other threads as long as it is held by extension code.This allows the extension to work with the buffer con- tents independently, possibly in a different thread than the interpreter. It is up to the user to call PyBuffer_Release() on the buffer after all processing is complete.\n\nThe conversion codes of \"t#\", \"w\", \"w#\", and \"w*\" are just like the \"s\" family of\n\ncodes except that they only accept objects implementing the buffer interface. \"t#\" requires the buffer to be readable.The \"w\" code requires the buffer to be both readable and writable.A Python object supporting a writable buffer is assumed to be mutable. Thus, it is legal for a C extension to overwrite or modify the buffer contents.\n\nThe conversion codes of \"y\", \"y#\", and \"y*\" are just like the \"s\" family of codes except that they only accept byte strings. Use these to write functions that must only take bytes, not Unicode strings.The \"y\" code only accepts byte strings that do not con- tain embedded NULL characters.\n\nTable 26.3 lists conversion codes that are used to accept arbitrary Python objects as\n\ninput and to leave the result as type PyObject *.These are sometimes used for C extensions that need to work with Python objects that are more complicated than sim- ple numbers or strings—for example, if you needed a C extension function to accept an instance of a Python class or dictionary.\n\nTable 26.3 Python Object Conversions and Associated C Data Types for PyArg_Parse*\n\nFormat Python Type C Type\n\n\"O\"\n\n\"O!\"\n\n\"O&\"\n\n\"S\"\n\n\"U\"\n\nAny Any Any String Unicode\n\nPyObject **r\n\nPyTypeObject *type, PyObject **r\n\nint (*converter)(PyObject *, void *), void *r\n\nPyObject **r\n\nPyObject **r\n\nF h Lib f L Bdff\n\nExtension Modules\n\n601\n\nThe \"O\", \"S\", and \"U\" specifiers return raw Python objects of type PyObject *. \"S\" and \"U\" restrict this object to be a string or Unicode string, respectively.\n\nThe \"O!\" conversion requires two C arguments: a pointer to a Python type object\n\nand a pointer to a PyObject * into which a pointer to the object is placed.A TypeError is raised if the type of the object doesn’t match the type object. For example:\n\n/* Parse a List Argument */ PyObject *listobj; PyArg_ParseTuple(args,\"O!\", &PyList_Type, &listobj);\n\nThe following list shows the C type names corresponding to some Python container types that might be commonly used with this conversion.\n\nC Name PyList_Type\n\nPython Type list\n\nPyDict_Type\n\ndict\n\nPySet_Type\n\nset\n\nPyFrozenSet_Type\n\nfrozen_set\n\nPyTuple_Type\n\ntuple\n\nPySlice_Type\n\nslice\n\nPyByteArray_Type\n\nbytearray\n\nThe \"O&\" conversion takes two arguments (converter, addr) and uses a function to convert a PyObject * to a C data type. converteris a pointer to a function with the prototype int converter(PyObject *obj, void *addr), where objis the passed Python object and addris the address supplied as the second argument in PyArg_ParseTuple(). converter() should return 1 on success, 0 on failure. On error, the converter should also raise an exception.This kind of conversion can be used to map Python objects such as lists or tuples into C data structures. For example, here is a possible implementation of the distance() wrapper from our earlier code:\n\n/* Convert a tuple into a Point structure. */ int convert_point(PyObject *obj, void *addr) {\n\nPoint *p = (Point *) addr; return PyArg_ParseTuple(obj,\"ii\", &p->x, &p->y);\n\n} PyObject *py_distance(PyObject *self, PyObject *args) {\n\nPoint p1, p2; double result; if (!PyArg_ParseTuple(args,\"O&O&\",\n\nconvert_point, &p1, convert_point, &p2)) {\n\nreturn NULL;\n\n} result = distance(&p1,&p2); return Py_BuildValue(\"d\",result);\n\n}\n\nF h Lib f L Bdff\n\n602\n\nChapter 26 Extending and Embedding Python\n\nFinally, argument format strings can contain a few additional modifiers related to tuple unpacking, documentation, error messages, and default arguments.The following is a list of these modifiers:\n\nFormat String \"(items)\"\n\n\"|\"\n\n\":\"\n\n\";\"\n\nDescription Unpack a tuple of objects. Items consist of format conversions. Start of optional arguments. End of arguments. The remaining text is the function name. End of arguments. The remaining text is the error message.\n\nThe \"(items)\" unpacks values from a Python tuple.This can be a useful way to map tuples into simple C structures. For example, here is another possible implementation of the py_distance() wrapper function:\n\nPyObject *py_distance(PyObject *self, PyObject *args) {\n\nPoint p1, p2; double result; if (!PyArg_ParseTuple(args,\"(dd)(dd)\",\n\n&p1.x, &p1.y, &p2.x, &p2.y)) {\n\nreturn NULL;\n\n} result = distance(&p1,&p2); return Py_BuildValue(\"d\",result);\n\n}\n\nThe modifier \"|\" specifies that all remaining arguments are optional.This can appear only once in a format specifier and cannot be nested.The modifier \":\" indicates the end of the arguments.Any text that follows is used as the function name in any error messages.The modifier \";\" signals the end of the arguments.Any following text is used as the error message. Note that only one of : and ; should be used. Here are some examples:\n\nPyArg_ParseTuple(args,\"ii:gcd\", &x, &y); PyArg_ParseTuple(args,\"ii; gcd requires 2 integers\", &x, &y);\n\n/* Parse with optional arguments */ PyArg_ParseTuple(args,\"s|s\", &buffer, &delimiter);\n\nType Conversion from C to Python The following C function is used to convert the values contained in C variables to a Python object:\n\nPyObject *Py_BuildValue(char *format, ...)\n\nThis constructs a Python object from a series of C variables. formatis a string describ- ing the desired conversion.The remaining arguments are the values of C variables to be converted.\n\nThe formatspecifier is similar to that used with the PyArg_ParseTuple* func-\n\ntions, as shown in Table 26.4.\n\nF h Lib f L Bdff\n\nTable 26.4\n\nFormat\n\n\"\"\n\n\"s\"\n\n\"s#\"\n\n\"y\"\n\n\"y#\"\n\n\"z\"\n\n\"z#\"\n\n\"u\"\n\n\"u#\"\n\n\"U\"\n\n\"U#\"\n\n\"b\"\n\n\"B\"\n\n\"h\"\n\n\"H\"\n\n\"i\"\n\n\"I\"\n\n\"l\"\n\n\"L\"\n\n\"k\"\n\n\"K\"\n\n\"n\"\n\n\"c\"\n\n\"f\"\n\n\"d\"\n\n\"D\"\n\n\"O\"\n\nExtension Modules\n\n603\n\nFormat Specifiers for Py_BuildValue()\n\nPython Type\n\nC Type\n\nDescription\n\nNone String\n\nNothing. Null-terminated string. If the C string pointer is NULL, None is returned. String and length. May contain null bytes. If the C string point- er is NULL, None is returned. Same as \"s\" except a byte string is returned. Same as \"s# except a byte string is returned. Same as \"s\". Same as \"s#\". Null-terminated Unicode string. If the string pointer is NULL, None is returned. Unicode string and length. Converts a null-terminated C string into a Unicode string. Converts a C string into Unicode. 8-bit integer. 8-bit unsigned integer. Short 16-bit integer. Unsigned short 16-bit integer. Integer. Unsigned integer Long integer. Unsigned long integer. Long long.\n\nvoid\n\nchar *\n\nString\n\nchar *, int\n\nBytes\n\nchar *\n\nchar *, int\n\nBytes\n\nString or None char * String or None char *, int Unicode\n\nPy_UNICODE *\n\nPy_UNICODE *\n\nUnicode Unicode\n\nchar *\n\nUnicode\n\nchar *, int\n\nchar\n\nInteger Integer Integer Integer Integer Integer Integer Integer Integer Integer Integer String\n\nunsigned char\n\nshort\n\nunsigned short\n\nint\n\nunsigned int\n\nlong\n\nunsigned long\n\nlong long unsigned long long Unsigned long long. Py_ssize_t\n\nPython size type. Single character. Creates a Python string of length 1. Single-precision floating point. Double-precision floating point. Complex number. Any Python object. The object is unchanged except for its ref- erence count, which is incre- mented by 1. If a NULL pointer is given, a NULL pointer is returned. This is useful if an error has been signaled else- where and you want it to propa- gate.\n\nchar\n\nfloat\n\nFloat Float Complex Any\n\ndouble\n\nPy_complex\n\nPyObject *\n\nF h Lib f L Bdff\n\n604\n\nChapter 26 Extending and Embedding Python\n\nTable 26.4\n\nContinued\n\nFormat\n\nPython Type\n\nC Type\n\nDescription\n\n\"O&\"\n\nAny\n\n\"S\"\n\n\"N\"\n\nString Any\n\n\"(items)\" Tuple\n\n\"[items]\" List\n\nconverter, any\n\nPyObject *\n\nPyObject *\n\nvars\n\nvars\n\nC data processed through a converter function. Same as \"O\". Same as \"O\" except that the reference count is not incre- mented. Creates a tuple of items. itemsis a string of format specifiers from this table. varsis a list of C variables corresponding to the items in items. Creates a list of items. items is a string of format specifiers. varsis a list of C variables corresponding to the items in items. Creates a dictionary of items.\n\n\"{items}\" Dictionary\n\nvars\n\nHere are some examples of building different kinds of values:\n\nPy_BuildValue(\"\") None Py_BuildValue(\"i\",37) 37 Py_BuildValue(\"ids\",37,3.4,\"hello\") (37, 3.5, \"hello\") Py_BuildValue(\"s#\",\"hello\",4) \"hell\" Py_BuildValue(\"()\") () Py_BuildValue(\"(i)\",37) (37,) Py_BuildValue(\"[ii]\",1,2) [1,2] Py_BuildValue(\"[i,i]\",1,2) [1,2] Py_BuildValue(\"{s:i,s:i}\",\"x\",1,\"y\",2) {'x':1, 'y':2}\n\nFor Unicode string conversions involving char *, it is assumed that the data consists of a series of bytes encoded using the default Unicode encoding (usually UTF-8).The data will be automatically decoded into a Unicode string when passed to Python.The only exceptions are the \"y\" and \"y#\" conversions that return a raw byte string.\n\nAdding Values to a Module In the module initialization function of an extension module, it is common to add con- stants and other support values.The following functions can be used to do this:\n\nint PyModule_AddObject(PyObject *module, const char *name, PyObject *value)\n\nAdds a new value to a module. nameis the name of the value, and valueis a Python object containing the value.You can build this value using Py_BuildValue().\n\nint PyModule_AddIntConstant(PyObject *module, const char *name, long value)\n\nAdds an integer value to a module.\n\nvoid PyModule_AddStringConstant(PyObject *module, const char *name, const char *value)\n\nAdds a string value to a module. valuemust be a null-terminated string.\n\nF h Lib f L Bdff\n\nExtension Modules\n\n605\n\nvoid PyModule_AddIntMacro(PyObject *module, macro)\n\nAdds a macro value to a module as an integer. macromust be the name of preprocessor macro.\n\nvoid PyModule_AddStringMacro(PyObject *module, macro)\n\nAdds a macro value to a module as a string.\n\nError Handling Extension modules indicate errors by returning NULL to the interpreter. Prior to return- ing NULL, an exception should be set using one of the following functions:\n\nvoid PyErr_NoMemory()\n\nRaises a MemoryError exception.\n\nvoid PyErr_SetFromErrno(PyObject *exc)\n\nRaises an exception. excis an exception object.The value of the exception is taken from the errno variable in the C library.\n\nvoid PyErr_SetFromErrnoWithFilename(PyObject *exc, char *filename)\n\nLike PyErr_SetFromErrno(), but includes the file name in the exception value as well.\n\nvoid PyErr_SetObject(PyObject *exc, PyObject *val)\n\nRaises an exception. excis an exception object, and valis an object containing the value of the exception.\n\nvoid PyErr_SetString(PyObject *exc, char *msg)\n\nRaises an exception. excis an exception object, and msgis a message describing what went wrong.\n\nThe excargument in these functions can be set to one of the following:\n\nC Name PyExc_ArithmeticError\n\nPython Exception ArithmeticError\n\nPyExc_AssertionError\n\nAssertionError\n\nPyExc_AttributeError\n\nAttributeError\n\nPyExc_EnvironmentError\n\nEnvironmentError\n\nPyExc_EOFError\n\nEOFError\n\nPyExc_Exception\n\nException\n\nPyExc_FloatingPointError\n\nFloatingPointError\n\nPyExc_ImportError\n\nImportError\n\nPyExc_IndexError\n\nIndexError\n\nPyExc_IOError\n\nIOError\n\nPyExc_KeyError\n\nKeyError\n\nPyExc_KeyboardInterrupt\n\nKeyboardInterrupt\n\nPyExc_LookupError\n\nLookupError\n\nPyExc_MemoryError\n\nMemoryError\n\nPyExc_NameError\n\nNameError\n\nPyExc_NotImplementedError\n\nNotImplementedError\n\nF h Lib f L Bdff\n\n606\n\nChapter 26 Extending and Embedding Python\n\nC Name PyExc_OSError\n\nPython Exception OSError\n\nPyExc_OverflowError\n\nOverflowError\n\nPyExc_ReferenceError\n\nReferenceError\n\nPyExc_RuntimeError\n\nRuntimeError\n\nPyExc_StandardError\n\nStandardError\n\nPyExc_StopIteration\n\nStopIteration\n\nPyExc_SyntaxError\n\nSyntaxError\n\nPyExc_SystemError\n\nSystemError\n\nPyExc_SystemExit\n\nSystemExit\n\nPyExc_TypeError\n\nTypeError\n\nPyExc_UnicodeError\n\nUnicodeError\n\nPyExc_UnicodeEncodeError\n\nUnicodeEncodeError\n\nPyExc_UnicodeDecodeError\n\nUnicodeDecodeError\n\nPyExc_UnicodeTranslateError\n\nUnicodeTranslateError\n\nPyExc_ValueError\n\nValueError\n\nPyExc_WindowsError\n\nWindowsError\n\nPyExc_ZeroDivisionError\n\nZeroDivisionError\n\nThe following functions are used to query or clear the exception status of the interpreter:\n\nvoid PyErr_Clear()\n\nClears any previously raised exceptions.\n\nPyObject *PyErr_Occurred()\n\nChecks to see whether or not an exception has been raised. If so, the current exception value is returned. Otherwise, NULL is returned.\n\nint PyErr_ExceptionMatches(PyObject *exc)\n\nChecks to see if the current exception matches the exception exc. Returns 1 if true, 0 otherwise.This function follows the same exception matching rules as in Python code. Therefore, exccould be a superclass of the current exception or a tuple of exception classes.\n\nThe following prototype shows how to implement a try-except block in C:\n\n/* Carry out some operation involving Python objects */ if (PyErr_Occurred()) {\n\nif (PyErr_ExceptionMatches(PyExc_ValueError)) { /* Take some kind of recovery action */ ... PyErr_Clear(); return result; /* A valid PyObject * */\n\n} else {\n\nreturn NULL; /* Propagate the exception to the interpreter */\n\n}\n\n}\n\nF h Lib f L Bdff\n\nExtension Modules\n\n607\n\nReference Counting Unlike programs written in Python, C extensions may have to manipulate the reference count of Python objects.This is done using the following macros, all of which are applied to objects of type PyObject *.\n\nMacro Py_INCREF(obj) Increments the reference count of obj, which must be non-null. Py_DECREF(obj) Decrements the reference count of obj, which must be non-null. Py_XINCREF(obj) Increments the reference count of obj, which may be null. Py_XDECREF(obj) Decrements the reference count of obj, which may be null.\n\nDescription\n\nManipulating the reference count of Python objects in C is a delicate topic, and readers are strongly advised to consult the “Extending and Embedding the Python Interpreter” document available at http://docs.python.org/extending before proceeding any further. As a general rule, it is not necessary to worry about reference counting in C extension functions except in the following cases:\n\nn If you save a reference to a Python object for later use or in a C structure, you\n\nmust increase the reference count.\n\nn Similarly, to dispose of an object that was previously saved, decrease its reference\n\ncount.\n\nn If you are manipulating Python containers (lists, dicts, and so on) from C, you may have to manually manipulate reference counts of the individual items. For example, high-level operations that get or set items in a container typically increase the reference count.\n\nYou will know that you have a reference counting problem if your extension code crashes the interpreter (you forgot to increase the reference count) or the interpreter leaks memory as your extension functions are used (you forgot to decrease a reference count).\n\nThreads A global interpreter lock is used to prevent more than one thread from executing in the interpreter at once. If a function written in an extension module executes for a long time, it will block the execution of other threads until it completes.This is because the lock is held whenever an extension function is invoked. If the extension module is thread-safe, the following macros can be used to release and reacquire the global inter- preter lock:\n\nPy_BEGIN_ALLOW_THREADS\n\nReleases the global interpreter lock and allows other threads to run in the interpreter. The C extension must not invoke any functions in the Python C API while the lock is released.\n\nPy_END_ALLOW_THREADS\n\nReacquires the global interpreter lock.The extension will block until the lock can be acquired successfully in this case.\n\nF h Lib f L Bdff\n\n608\n\nChapter 26 Extending and Embedding Python\n\nThe following example illustrates the use of these macros:\n\nPyObject *py_wrapper(PyObject *self, PyObject *args) {\n\n... PyArg_ParseTuple(args, ...) Py_BEGIN_ALLOW_THREADS result = run_long_calculation(args); Py_END_ALLOW_THREADS ... return Py_BuildValue(fmt,result);\n\n}\n\nEmbedding the Python Interpreter The Python interpreter can also be embedded into C applications.With embedding, the Python interpreter operates as a programming library where C programs can initialize the interpreter, have the interpreter run scripts and code fragments, load library mod- ules, and manipulate functions and objects implemented in Python.\n\nAn Embedding Template With embedding, your C program is in charge of the interpreter. Here is a simple C program that illustrates the most minimal embedding possible:\n\n#include <Python.h>\n\nint main(int argc, char **argv) {\n\nPy_Initialize(); PyRun_SimpleString(\"print('Hello World')\"); Py_Finalize(); return 0;\n\n}\n\nIn this example, the interpreter is initialized, a short script is executed as a string, and the interpreter is shut down. Before proceeding any further, it is usually a good idea to get the prior example working first.\n\nCompilation and Linking To compile an embedded interpreter on UNIX, your code must include the \"Python.h\" header file and link against the interpreter library such as libpython2.6.a.The header file is typically found in /usr/local/include/python2.6, and the library is typically found in /usr/local/lib/python2.6/config. For Windows, you will need to locate these files in the Python installation directory. Be aware that the interpreter may depend on other libraries you need to include when linking. Unfortunately, this tends to be platform-specific and related to how Python was configured on your machine—you may have to fiddle around for a bit.\n\nBasic Interpreter Operation and Setup The following functions are used to set up the interpreter and to run scripts:\n\nint PyRun_AnyFile(FILE *fp, char *filename)\n\nIf fpis an interactive device such as tty in UNIX, this function calls PyRun_InteractiveLoop(). Otherwise, PyRun_SimpleFile() is called. filenameis\n\nF h Lib f L Bdff\n\nEmbedding the Python Interpreter\n\n609\n\na string that gives a name for the input stream.This name will appear when the inter- preter reports errors. If filenameis NULL, a default string of \"???\" is used as the file name.\n\nint PyRun_SimpleFile(FILE *fp, char *filename)\n\nSimilar to PyRun_SimpleString(), except that the program is read from the file fp.\n\nint PyRun_SimpleString(char *command)\n\nExecutes commandin the __main__ module of the interpreter. Returns 0 on success, -1 if an exception occurred.\n\nint PyRun_InteractiveOne(FILE *fp, char *filename)\n\nExecutes a single interactive command.\n\nint PyRun_InterativeLoop(FILE *fp, char *filename)\n\nRuns the interpreter in interactive mode.\n\nvoid Py_Initialize()\n\nInitializes the Python interpreter.This function should be called before using any other functions in the C API, with the exception of Py_SetProgramName(), PyEval_InitThreads(), PyEval_ReleaseLock(), and PyEval_AcquireLock().\n\nint Py_IsInitialized()\n\nReturns 1 if the interpreter has been initialized, 0 if not.\n\nvoid Py_Finalize()\n\nCleans up the interpreter by destroying all the sub-interpreters and objects that were created since calling Py_Initialize(). Normally, this function frees all the memory allocated by the interpreter. However, circular references and extension modules may introduce memory leaks that cannot be recovered by this function.\n\nvoid Py_SetProgramName(char *name)\n\nSets the program name that’s normally found in the argv[0] argument of the sys module.This function should only be called before Py_Initialize().\n\nchar *Py_GetPrefix()\n\nReturns the prefix for installed platform-independent files.This is the same value as found in sys.prefix.\n\nchar *Py_GetExecPrefix()\n\nReturns the exec-prefix for installed platform-dependent files.This is the same value as found in sys.exec_prefix.\n\nchar *Py_GetProgramFullPath()\n\nReturns the full path name of the Python executable.\n\nchar *Py_GetPath()\n\nReturns the default module search path.The path is returned as a string consisting of directory names separated by a platform-dependent delimiters (: on UNIX, ; on DOS/Windows).\n\nF h Lib f L Bdff\n\n610\n\nChapter 26 Extending and Embedding Python\n\nint PySys_SetArgv(int argc, char **argv)\n\nSets command-line options used to populate the value of sys.argv.This should only be called before Py_Initialize().\n\nAccessing Python from C Although there are many ways that the interpreter can be accessed from C, four essen- tial tasks are the most common with embedding:\n\nn Importing Python library modules (emulating the import statement) n Getting references to objects defined in modules n Calling Python functions, classes, and methods n Accessing the attributes of objects (data, methods, and so on)\n\nAll of these operations can be carried out using these basic operations defined in the Python C API:\n\nPyObject *PyImport_ImportModule(const char *modname)\n\nImports a module modnameand returns a reference to the associated module object.\n\nPyObject *PyObject_GetAttrString(PyObject *obj, const char *name)\n\nGets an attribute from an object.This is the same as obj.name.\n\nint PyObject_SetAttrString(PyObject *obj, const char *name, PyObject *value)\n\nSets an attribute on an object.This is the same as obj.name = value.\n\nPyObject *PyEval_CallObject(PyObject *func, PyObject *args)\n\nCalls funcwith arguments args. funcis a Python callable object (function, method, class, and so on). argsis a tuple of arguments.\n\nPyObject * PyEval_CallObjectWithKeywords(PyObject *func, PyObject *args, PyObject *kwargs)\n\nCalls funcwith positional arguments argsand keyword arguments kwargs. funcis a callable object, argsis a tuple, and kwargsis a dictionary.\n\nThe following example illustrates the use of these functions by calling and using var-\n\nious parts of the re module from C.This program prints out all of the lines read from stdin that contain a Python regular expression supplied by the user.\n\n#include \"Python.h\"\n\nint main(int argc, char **argv) {\n\nPyObject *re; PyObject *re_compile; PyObject *pat; PyObject *pat_search; PyObject *args; char buffer[256];\n\nif (argc != 2) {\n\nfprintf(stderr,\"Usage: %s pattern\\n\",argv[0]); exit(1);\n\n}\n\nPy_Initialize();\n\nF h Lib f L Bdff\n\nEmbedding the Python Interpreter\n\n611\n\n/* import re */ re = PyImport_ImportModule(\"re\");\n\n/* pat = re.compile(pat,flags) */ re_compile = PyObject_GetAttrString(re,\"compile\"); args = Py_BuildValue(\"(s)\", argv[1]); pat = PyEval_CallObject(re_compile, args); Py_DECREF(args);\n\n/* pat_search = pat.search - bound method*/ pat_search = PyObject_GetAttrString(pat,\"search\");\n\n/* Read lines and perform matches */ while (fgets(buffer,255,stdin)) {\n\nPyObject *match; args = Py_BuildValue(\"(s)\", buffer);\n\n/* match = pat.search(buffer) */ match = PyEval_CallObject(pat_search,args); Py_DECREF(args); if (match != Py_None) {\n\nprintf(\"%s\",buffer);\n\n} Py_XDECREF(match);\n\n} Py_DECREF(pat); Py_DECREF(re_compile); Py_DECREF(re); Py_Finalize(); return 0;\n\n}\n\nIn any embedding code, it is critically important to properly manage reference counts. In particular, you will need to decrease the reference count on any objects created from C or returned to C as a result of evaluating functions.\n\nConverting Python Objects to C A major problem with embedded use of the interpreter is converting the result of a Python function or method call into a suitable C representation.As a general rule, you need to know in advance exactly what kind of data an operation is going to return. Sadly, there is no high-level convenience function like PyArg_ParseTuple() for con- verting a single object value. However, the following lists some low-level conversion functions that will convert a few primitive Python data types into an appropriate C rep- resentation as long as you know exactly what kind of Python object you are working with:\n\nPython-to-C Conversion Functions long PyInt_AsLong(PyObject *)\n\nlong PyLong_AsLong(PyObject *)\n\ndouble PyFloat_AsDouble(PyObject *) char *PyString_AsString(PyObject *) (Python 2 only) char *PyBytes_AsString(PyObject *) (Python 3 only)\n\nFor any types more complicated than this, you will need to consult the C API docu- mentation (http://docs.python.org/c-api).\n\nF h Lib f L Bdff\n\n612\n\nChapter 26 Extending and Embedding Python\n\nctypes The ctypes module provides Python with access to C functions defined in DLLs and shared libraries.Although you need to know some details about the underlying C library (names, calling arguments, types, and so on), you can use ctypes to access C code without having to write C extension wrapper code or compile anything with a C compiler. ctypes is a sizable library module with a lot of advanced functionality. Here, we cover the essential parts of it that are needed to get going.\n\nLoading Shared Libraries The following classes are used to load a C shared library and return an instance repre- senting its contents:\n\nCDLL(name [, mode [, handle [, use_errno [, use_last_error]]]])\n\nA class representing a standard C shared library. nameis the name of the library such as 'libc.so.6' or 'msvcrt.dll'. modeprovides flags that determine how the library is loaded and are passed to the underlying dlopen() function on UNIX. It can be set to the bitwise-or of RTLD_LOCAL, RTLD_GLOBAL, or RTLD_DEFAULT (the default). On Windows, modeis ignored. handlespecifies a handle to an already loaded library (if available). By default, it is None. use_errnois a Boolean flag that adds an extra layer of safety around the handling of the C errno variable in the loaded library.This layer saves a thread-local copy of errno prior to calling any foreign function and restores the value afterwards. By default, use_errnois False. use_last_erroris a Boolean flag that enables a pair of functions get_last_error() and set_last_error() that can be used to manipulate the system error code.These are more commonly used on Windows. By default, use_last_erroris False.\n\nWinDLL(name [, mode [, handle [, use_errno [, use_last_error]]]])\n\nThe same as CDLL() except that the functions in the library are assumed to follow the Windows stdcall calling conventions (Windows).\n\nThe following utility function can be used to locate shared libraries on the system and construct a name suitable for use as the nameparameter in the previous classes. It is defined in the ctypes.util submodule:\n\nfind_library(name)\n\nDefined in ctypes.util. Returns a path name corresponding to the library name. nameis a library name without any file suffix such as 'libc', 'libm', and so on The string returned by the function is a full path name such as '/usr/lib/libc.so.6'. The behavior of this function is highly system-dependent and depends on the under- lying configuration of shared libraries and environment (for example, the setting of LD_LIBRARY_PATH and other parameters). Returns None if the library can’t be located.\n\nForeign Functions The shared library instances created by the CDLL() class operates as a proxy to the underlying C library.To access library contents, you just use attribute lookup (the oper- ator). For example:\n\nF h Lib f L Bdff\n\nEmbedding the Python Interpreter\n\n613\n\n>>> import ctypes >>> libc = ctypes.CDLL(\"/usr/lib/libc.dylib\") >>> libc.rand() 16807 >>> libc.atoi(\"12345\") 12345 >>>\n\nIn this example, operations such as libc.rand() and libc.atoi() are directly calling functions in the loaded C library.\n\nctypes assumes that all functions accept parameters of type int or char * and return results of type int.Thus, even though the previous function calls “worked,” calls to other C library functions do not work as expected. For example:\n\n>>> libc.atof(\"34.5\") -1073746168 >>>\n\nTo address this problem, the type signature and handling of any foreign function func can be set by changing the following attributes:\n\nfunc.argtypes\n\nA tuple of ctypes datatypes (described here) describing the input arguments to func.\n\nfunc.restype\n\nA ctypes datatype describing the return value of func. None is used for functions returning void.\n\nfunc.errcheck\n\nA Python callable object taking three parameters (result, func, args) where resultis the value returned by a foreign function, funcis a reference to the foreign function itself, and argsis a tuple of the input arguments.This function is called after a foreign function call and can be used to perform error checking and other actions.\n\nHere is an example of fixing the atof() function interface, as shown in the previous\n\nexample:\n\n>>> libc.atof.restype=ctypes.c_double >>> libc.atof(\"34.5\") 34.5 >>>\n\nThe ctypes.d_double is a reference to a predefined datatype.The next section describes these datatypes.\n\nDatatypes Table 26.5 shows the ctypes datatypes that can be used in the argtypes and restype attributes of foreign functions.The “Python Value” column describes the type of Python data that is accepted for the given data type.\n\nF h Lib f L Bdff",
      "page_number": 617
    },
    {
      "number": 31,
      "title": "Segment 31 (pages 638-658)",
      "start_page": 638,
      "end_page": 658,
      "detection_method": "synthetic",
      "content": "614\n\nChapter 26 Extending and Embedding Python\n\nTable 26.5\n\nctypes Datatypes\n\nctypes Type Name\n\nC Datatype\n\nPython Value\n\nc_bool\n\nc_bytes\n\nc_char\n\nc_char_p\n\nc_double\n\nc_longdouble\n\nc_float\n\nc_int\n\nc_int8\n\nc_int16\n\nc_int32\n\nc_int64\n\nc_long\n\nc_longlong\n\nc_short\n\nc_size_t\n\nc_ubyte\n\nc_uint\n\nc_uint8\n\nc_uint16\n\nc_uint32\n\nc_uint64\n\nc_ulong\n\nc_ulonglong\n\nc_ushort\n\nbool\n\nsigned char\n\nchar\n\nchar *\n\ndouble\n\nlong double\n\nfloat\n\nint\n\nsigned char\n\nshort\n\nint\n\nlong long\n\nlong\n\nlong long\n\nshort\n\nsize_t\n\nunsigned char\n\nunsigned int\n\nunsigned char\n\nunsigned short\n\nunsigned int\n\nunsigned long long\n\nunsigned long\n\nunsigned long long\n\nunsigned short\n\nTrue or False Small integer Single character Null-terminated string or bytes Floating point Floating point Floating point Integer 8-bit integer 16-bit integer 32-bit integer 64-bit integer Integer Integer Integer Integer Unsigned integer Unsigned integer 8-bit unsigned integer 16-bit unsigned integer 32-bit unsigned integer 64-bit unsigned integer Unsigned integer Unsigned integer Unsigned integer Integer Single Unicode character Null-terminated Unicode\n\nc_void_p\n\nvoid *\n\nc_wchar\n\nwchar_t\n\nc_wchar_p\n\nwchar_t *\n\nTo create a type representing a C pointer, apply the following function to one of the other types:\n\nPOINTER(type)\n\nDefines a type that is a pointer to type type. For example, POINTER(c_int) represents the C type int *.\n\nTo define a type representing a fixed-size C array, multiply an existing type by the number of array dimensions. For example, c_int*4 represents the C datatype int[4]. To define a type representing a C structure or union, you inherit from one of the base classes Structure or Union.Within each derived class, you define a class variable _fields_ that describes the contents. _fields_ is a list of 2 or 3 tuples of the form (name, ctype) or (name, ctype, width), where nameis an identifier for the\n\nF h Lib f L Bdff\n\nEmbedding the Python Interpreter\n\n615\n\nstructure field, ctypeis a ctype class describing the type, and widthis an integer bit- field width. For example, consider the following C structure:\n\nstruct Point {\n\ndouble x, y;\n\n};\n\nThe ctypes description of this structure is\n\nclass Point(Structure):\n\n_fields_ = [ (\"x\", c_double),\n\n(\"y\", c_double) ]\n\nCalling Foreign Functions To call functions in a library, you simply call the appropriate function with a set of arguments that are compatible with its type signature. For simple datatypes such as c_int, c_double, and so forth, you can just pass compatible Python types as input (integers, floats, and so on). It is also possible to pass instances of c_int, c_double and similar types as input. For arrays, you can just pass a Python sequence of compatible types.\n\nTo pass a pointer to a foreign function, you must first create a ctypes instance that represents the value that will be pointed at and then create a pointer object using one of the following functions:\n\nbyref(cvalue [, offset])\n\nRepresents a lightweight pointer to cvalue. cvaluemust be an instance of a ctypes datatype. offsetis a byte offset to add to the pointer value.The value returned by the function can only be used in function calls.\n\npointer(cvalue)\n\nCreates a pointer instance pointing to cvalue. cvaluemust be an instance of a ctypes datatype.This creates an instance of the POINTER type described earlier.\n\nHere is an example showing how you would pass a parameter of type double *\n\ninto a C function:\n\ndval = c_double(0.0) # Create a double instance r = foo(byref(dval)) # Calls foo(&dval)\n\np_dval = pointer(dval) # Creates a pointer variable r = foo(p_dval) # Calls foo(p_dval)\n\n# Inspect the value of dval afterwards print (dval.value)\n\nIt should be noted that you cannot create pointers to built-in types such as int or float. Passing pointers to such types would violate mutability if the underlying C function changed the value.\n\nThe cobj.value attribute of a ctypes instance cobjcontains the internal data. For example, the reference to dval.value in the previous code returns the floating-point value stored inside the ctypes c_double instance dval.\n\nF h Lib f L Bdff\n\n616\n\nChapter 26 Extending and Embedding Python\n\nTo pass a structure to a C function, you must create an instance of the structure or union.To do this, you call a previous defined structure or union type StructureType as follows:\n\nStructureType(*args, **kwargs)\n\nCreates an instance of StructureTypewhere StructureTypeis a class derived from Structure or Union. Positional arguments in *argsare used to initialize the structure members in the same order as they are listed in _fields_. Keyword arguments in **kwargsinitialize just the named structure members.\n\nAlternative Type Construction Methods All instances of ctypes types such as c_int, POINTER, and so forth have some class methods that are used to create instances of ctypes types from memory locations and other objects.\n\nty.from_buffer(source [,offset])\n\nCreates an instance of ctypes type tythat shares the same memory buffer as source. sourcemust be any other object that supports the writable buffer interface (e.g., bytearray, array objects in the array module, mmap, and so on). offsetis the num- ber of bytes from the start of the buffer to use.\n\nty.from_buffer_copy(source [, offset])\n\nThe same as ty.from_buffer() except that a copy of the memory is made and that sourcecan be read-only.\n\nty.from_address(address)\n\nCreates an instance of ctypes type tyfrom a raw memory address addressspecified as an integer.\n\nty.from_param(obj)\n\nCreates an instance of ctypes type tyfrom a Python object obj.This only works if the passed object objcan be adapted into the appropriate type. For example, a Python inte- ger can be adapted into a c_int instance.\n\nty.in_dll(library, name)\n\nCreates an instance of ctypes type tyfrom a symbol in a shared library. libraryis an instance of the loaded library such as the object created by the CDLL class. nameis the name of a symbol.This method can be used to put a ctypes wrapper around global vari- ables defined in a library.\n\nThe following example shows how you might create a reference to a global variable\n\nint status defined in a library libexample.so.\n\nlibexample = ctypes.CDLL(\"libexample.so\") status = ctypes.c_int.in_dll(libexample,\"status\")\n\nF h Lib f L Bdff\n\nEmbedding the Python Interpreter\n\n617\n\nUtility Functions The following utility functions are defined by ctypes:\n\naddressof(cobj)\n\nReturns the memory address of cobjas an integer. cobjmust be an instance of a ctypes type.\n\nalignment(ctype_or_obj)\n\nReturns the integer alignment requirements of a ctypes type or object. ctype_or_obj must be a ctypes type or an instance of a type.\n\ncast(cobj, ctype)\n\nCasts a ctypes object cobjto a new type given in ctype.This only works for pointers, so cobjmust be a pointer or array and ctypemust be a pointer type.\n\ncreate_string_buffer(init [, size])\n\nCreates a mutable character buffer as a ctypes array of type c_char. initis either an integer size or a string representing the initial contents. sizeis an optional parameter that specifies the size to use if initis a string. By default, the size is set to be one greater than the number of characters in init. Unicode strings are encoded into bytes using the default encoding.\n\ncreate_unicode_buffer(init [, size])\n\nThe same as create_string_buffer(), except that a ctypes array of type c_wchar is created.\n\nget_errno()\n\nReturns the current value of the ctypes private copy of errno.\n\nget_last_error()\n\nReturns the current value of the ctypes private copy of LastError on Windows.\n\nmemmove(dst, src, count)\n\nCopies countbytes from srcto dst. srcand dstare either integers representing memory addresses or instances of ctypes types that can be converted to pointers.The same as the C memmove() library function.\n\nmemset(dst, c, count)\n\nSets countbytes of memory starting at dstto the byte value c. dstis either an integer or a ctypes instance. cis an integer representing a byte in the range 0-255.\n\nresize(cobj, size)\n\nResizes the internal memory used to represent ctypes object cobj. sizeis the new size in bytes.\n\nset_conversion_mode(encoding, errors)\n\nSets the Unicode encoding used when converting from Unicode strings to 8-bit strings. encodingis the encoding name such as 'utf-8', and errorsis the error-handling policy such as 'strict' or 'ignore'. Returns a tuple (encoding, errors) with the previous setting.\n\nF h Lib f L Bdff\n\n618\n\nChapter 26 Extending and Embedding Python\n\nset_errno(value)\n\nSets the ctypes-private copy of the system errnovariable. Returns the previous value.\n\nset_last_error(value)\n\nSets the Windows LastError variable and returns the previous value.\n\nsizeof(type_or_cobj)\n\nReturns the size of a ctypes type or object in bytes.\n\nstring_at(address [, size])\n\nReturns a byte string representing sizebytes of memory starting at address address. If sizeis omitted, it is assumed that the byte string is NULL-terminated.\n\nwstring_at(address [, size])\n\nReturns a Unicode string representing sizewide characters starting at address address. If sizeis omitted, the character string is assumed to be NULL-terminated.\n\nExample The following example illustrates the use of the ctypes module by building an inter- face to the set of C functions used in the very first part of this chapter that covered the details of creating Python extension modules by hand.\n\n# example.py\n\nimport ctypes _example = ctypes.CDLL(\"./libexample.so\")\n\n# int gcd(int, int) gcd = _example.gcd gcd.argtypes = (ctypes.c_int,\n\nctypes.c_int)\n\ngcd.restype = ctypes.c_int\n\n# int replace(char *s, char olcdh, char newch) _example.replace.argtypes = (ctypes.c_char_p,\n\nctypes.c_char, ctypes.c_char)\n\n_example.replace.restype = ctypes.c_int\n\ndef replace(s, oldch, newch):\n\nsbuffer = ctypes.create_string_buffer(s) nrep = _example.replace(sbuffer,oldch,newch) return (nrep,sbuffer.value)\n\n# double distance(Point *p1, Point *p2) class Point(ctypes.Structure):\n\n_fields_ = [ (\"x\", ctypes.c_double),\n\n(\"y\", ctypes.c_double) ]\n\n_example.distance.argtypes = (ctypes.POINTER(Point),\n\nctypes.POINTER(Point))\n\n_example.distance.restype = ctypes.c_double\n\ndef distance(a,b): p1 = Point(*a) p2 = Point(*b) return _example.distance(byref(p1),byref(p2))\n\nF h Lib f L Bdff\n\nAdvanced Extending and Embedding\n\n619\n\nAs a general note, usage of ctypes is always going to involve a Python wrapper layer of varying complexity. For example, it may be the case that you can call a C function directly. However, you may also have to implement a small wrapping layer to account for certain aspects of the underlying C code. In this example, the replace() function is taking extra steps to account for the fact that the C library mutates the input buffer.The distance() function is performing extra steps to create Point instances from tuples and to pass pointers.\n\nNote\n\nThe ctypes module has a large number of advanced features not covered here. For example, the library can access many different kinds of libraries on Windows, and there is support for callback functions, incomplete types, and other details. The online docu- mentation is filled with many examples so that should be a starting point for further use.\n\nAdvanced Extending and Embedding Creating handwritten extension modules or using ctypes is usually straightforward if you are extending Python with simple C code. However, for anything more complex, it can quickly become tedious. For this, you will want to look for a suitable extension building tool.These tools either automate much of the extension building process or provide a pro- gramming interface that operates at a much higher level. Links to a variety of such tools can be found at http://wiki.python.org/moin/IntegratingPythonWithOtherLanguages. However, a short example with SWIG (http://www.swig.org) will be shown just to illus- trate. In the interest of full disclosure, it should be noted that SWIG was originally created by the author.\n\nWith automated tools, you usually just describe the contents of an extension module\n\nat a high level. For example, with SWIG, you write a short interface specification that looks like this:\n\n/* example.i : Sample Swig specification */ %module example %{ /* Preamble. Include all required header files here */ #include \"example.h\" %}\n\n/* Module contents. List all C declarations here */ typedef struct Point {\n\ndouble x; double y;\n\n} Point; extern int gcd(int, int); extern int replace(char *s, char oldch, char newch); extern double distance(Point *a, Point *b);\n\nUsing this specification, SWIG automatically generates everything needed to make a Python extension module.To run SWIG, you just invoke it like a compiler:\n\n% swig –python example.i %\n\nF h Lib f L Bdff\n\n620\n\nChapter 26 Extending and Embedding Python\n\nAs output, it generates a set of .c and .py files. However, you often don’t have to worry much about this. If you are using distutils and include a .i file in the setup specification, it will run SWIG automatically for you when building an extension. For example, this setup.py file automatically runs SWIG on the listed example.i file.\n\n# setup.py from distutils.core import setup, Extension setup(name=\"example\",\n\nversion=\"1.0\", py_modules = ['example.py'], ext_modules = [\n\nExtension(\"_example\",\n\n[\"example.i\",\"example.c\"])\n\n]\n\n)\n\nIt turns out that this example.i file and the setup.py file are all that are needed to have a working extension module in this example. If you type python setup.py build_ext --inplace, you will find that you have a fully working extension in your directory.\n\nJython and IronPython Extending and embedding is not restricted to C programs. If you are working with Java, consider the use of Jython (http://www.jython.org), a complete reimplementation of the Python interpreter in Java.With jython, you can simply import Java libraries using the import statement. For example:\n\nbash-3.2$ jython Jython 2.2.1 on java1.5.0_16 Type \"copyright\", \"credits\" or \"license\" for more information. >>> from java.lang import System >>> System.out.println(\"Hello World\") Hello World >>>\n\nIf you are working with the .NET framework on Windows, consider the use of IronPython (http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython), a complete reimplementation of the Python interpreter in C#.With IronPython, you can easily access all of the .NET libraries from Python in a similar manner. For example:\n\n% ipy IronPython 1.1.2 (1.1.2) on .NET 2.0.50727.42 Copyright (c) Microsoft Corporation. All rights reserved. >>> import System.Math >>> dir(System.Math) ['Abs', 'Acos', 'Asin', 'Atan', 'Atan2', 'BigMul', 'Ceiling', 'Cos', 'Cosh', ...] >>> System.Math.Cos(3) -0.9899924966 >>>\n\nCovering jython and IronPython in more detail is beyond the scope of this book. However, just keep in mind that they’re both Python—the most major differences are in their libraries.\n\nF h Lib f L Bdff\n\nAppendix\n\nPython 3\n\nIn December 2008, Python 3.0 was released—a major update to the Python language\n\nthat breaks backwards compatibility with Python 2 in a number of critical areas.A fairly complete survey of the changes made to Python 3 can be found in the “What’s New in Python 3.0” document available at http://docs.python.org/3.0/whatsnew/3.0.html. In some sense, the first 26 chapters of this book can be viewed as the polar opposite of the “What’s New” document.That is, all of the material covered so far has focused on fea- tures that are shared by both Python 2 and Python 3.This includes all of the standard library modules, major language features, and examples.Aside from a few minor naming differences and the fact that print() is a function, no unique Python 3 features have been described.\n\nThe main focus of this appendix is to describe new features to the Python language\n\nthat are only available in version 3 as well as some important differences to keep in mind if you are going to migrate existing code.At the end of this appendix, some port- ing strategies and use of the 2to3 code conversion tool is described.\n\nWho Should Be Using Python 3? Before going any further, it is important to address the question of who should be using the Python 3.0 release.Within the Python community, it has always been known that the transition to Python 3 would not happen overnight and that the Python 2 branch would continue to be maintained for some time (years) into the future. So, as of this writing, there is no urgent need to drop Python 2 code. I suspect that huge amounts of Python 2 code will continue to be in development when the 5th edition of this book is written years from now.\n\nA major problem facing Python 3.0 concerns the compatibility of third-party libraries. Much of Python’s power comes from its large variety of frameworks and libraries. However, unless these libraries are explicitly ported to Python 3, they are almost certain not to work.This problem is amplified by the fact that many libraries depend upon other libraries that depend on yet more libraries.As of this writing (2009), there are major libraries and frameworks for Python that haven’t even been ported to Python 2.4, let alone 2.6 or 3.0. So, if you are using Python with the inten- tion of running third-party code, you are better off sticking with Python 2 for now. If you’ve picked up this book and it’s the year 2012, then hopefully the situation will have improved.\n\nAlthough Python 3 cleans up a lot of minor warts in the language, it is unclear if Python 3 is currently a wise choice for new users just trying to learn the basics.Almost all existing documentation, tutorials, cookbooks, and examples assume Python 2 and use\n\nF h Lib f L Bdff\n\n622\n\nAppendix Python 3\n\ncoding conventions that are incompatible. Needless to say, someone is not going to have a positive learning experience if everything appears to be broken. Even the official doc- umentation is not entirely up-to-date with Python 3 coding requirements; while writ- ing this book, the author submitted numerous bug reports concerning documentation errors and omissions.\n\nFinally, even though Python 3.0 is described as the latest and greatest, it suffers from\n\nnumerous performance and behavioral problems. For example, the I/O system in the initial release exhibits truly horrific and unacceptable runtime performance.The separa- tion of bytes and Unicode is also not without problem. Even some of the built-in library modules are broken due to changes related to I/O and string handling. Obviously these issues will improve with time as more programmers stress-test the release. However, in the opinion of this author, Python 3.0 is really only suitable for experimental use by seasoned Python veterans. If you’re looking for stability and pro- duction quality code, stick with Python 2 until some of the kinks have had time to be worked out of the Python 3 series.\n\nNew Language Features This section outlines some features of Python 3 that are not supported in Python 2.\n\nSource Code Encoding and Identifiers Python 3 assumes that source code is encoded as UTF-8. In addition, the rules on what characters are legal in an identifier have been relaxed. Specifically, identifiers can contain any valid Unicode character with a code point of U+0080 or greater. For example:\n\np = 3.141592654 r = 4.0 print(2*p*r)\n\nJust because you can use such characters in your source code doesn’t mean that it’s a good idea. Not all editors, terminals, or development tools are equally adept at Unicode handling. Plus, it is extremely annoying to force programmers to type awkward key sequences for characters not visibly present on a standard keyboard (not to mention the fact that it might make some of the gray-bearded hackers in the office tell everyone another amusing APL story). So, it’s probably better to reserve the use of Unicode char- acters for comments and string literals.\n\nSet Literals A set of items can now be defined by enclosing a collection of values in braces { items }. For example:\n\ndays = { 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun' }\n\nThis syntax is the same as using the set() function:\n\ndays = set(['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'])\n\nF h Lib f L Bdff\n\nNew Language Features\n\n623\n\nSet and Dictionary Comprehensions The syntax { expr for x in s if conditional} is a set comprehension. It applies an operation to all of the elements of a set sand can be used in a similar manner as list comprehensions. For example:\n\n>>> values = { 1, 2, 3, 4 } >>> squares = {x*x for x in values} >>> squares {16, 1, 4, 9} >>>\n\nThe syntax { kexpr:vexpr for k,v in s if condition } is a dictionary com- prehension. It applies an operation to all of the keys and values in sequence sof (key, value) tuples and returns a dictionary.The keys of the new dictionary are described by an expression kexpr, and the values are described by the expression vexpr.This can be viewed as a more powerful version of the dict() function.\n\nTo illustrate, suppose you had a file of stock prices 'prices.dat' like this:\n\nGOOG 509.71 YHOO 28.34 IBM 106.11 MSFT 30.47 AAPL 122.13\n\nHere is a program that reads this file into a dictionary mapping stock names to price using a dictionary comprehension:\n\nfields = (line.split() for line in open(\"prices.dat\")) prices = {sym:float(val) for sym,val in fields}\n\nHere is an example that converts all of the keys of the prices dictionary to lowercase:\n\nd = {sym.lower():price for sym,price in prices.items()}\n\nHere is an example that creates a dictionary of prices for stocks over $100.00:\n\nd = {sym:price for sym,price in prices.items() if price >= 100.0}\n\nExtended Iterable Unpacking In Python 2, items in an iterable can be unpacked into variables using syntax such as the following:\n\nitems = [1,2,3,4] a,b,c,d = items # Unpack items into variables\n\nIn order for this unpacking to work, the number of variables and items to be unpacked must exactly match.\n\nIn Python 3, you can use a wildcard variable to only unpack some of the items in a\n\nsequence, placing any remaining values in a list. For example:\n\na,*rest = items # a = 1, rest = [2,3,4] a,*rest,d = items # a = 1, rest = [2,3], d = 4 *rest, d = items # rest = [1,2,3], d = 4\n\nF h Lib f L Bdff\n\n624\n\nAppendix Python 3\n\nIn these examples, the variable prefixed by a * receives all of the extra values and places them in a list.The list may be empty if there are no extra items. One use of this feature is in looping over lists of tuples (or sequences) where the tuples may have differing sizes. For example:\n\npoints = [ (1,2), (3,4,\"red\"), (4,5,\"blue\"), (6,7) ] for x,y, *opt in points:\n\nif opt:\n\n# Additional fields were found\n\nstatements\n\nNo more than one starred variable can appear in any expansion.\n\nNonlocal Variables Inner functions can modify variables in outer functions by using the nonlocal declara- tion. For example:\n\ndef countdown(n):\n\ndef decrement():\n\nnonlocal n n -= 1\n\nwhile n > 0:\n\nprint(\"T-minus\", n) decrement()\n\nIn Python 2, inner functions can read variables in outer functions but cannot modify them.The nonlocal declaration enables this.\n\nFunction Annotations The arguments and return value of functions can be annotated with arbitrary values. For example:\n\ndef foo(x:1,y:2) -> 3:\n\npass\n\nThe function attribute __annotations__ is a dictionary mapping argument names to the annotation values.The special 'return' key is mapped to the return value annota- tion. For example:\n\n>>> foo.__annotations__ {'y': 4, 'x': 3, 'return': 5} >>>\n\nThe interpreter does not attach any significance to these annotations. In fact, they can be any values whatsoever. However, it is expected that type information will be most useful in the future. For example, you could write this:\n\ndef foo(x:int, y:int) -> str:\n\nstatements\n\nAnnotations are not limited to single values.An annotation can be any valid Python expression. For variable positional and keyword arguments, the same syntax applies. For example:\n\ndef bar(x, *args:\"additional\", **kwargs:\"options\"):\n\nstatements\n\nF h Lib f L Bdff\n\nNew Language Features\n\n625\n\nAgain, it is important to emphasize that Python does not attach any significance to annotations.The intended use is in third-party libraries and frameworks that may want to use them for various applications involving metaprogramming. Examples include, but are not limited to, static analysis tools, documentation, testing, function overloading, marshalling, remote procedure call, IDEs, contracts, etc. Here is an example of a decora- tor function that enforces assertions on function arguments and return values:\n\ndef ensure(func):\n\n# Extract annotation data return_check = func.__annotations__.get('return',None) arg_checks = [(name,func.__annotations__.get(name))\n\nfor name in func.__code__.co_varnames]\n\n# Create a wrapper that checks argument values and the return # result using the functions specified in annotations\n\ndef assert_call(*args,**kwargs):\n\nfor (name,check),value in zip(arg_checks,args):\n\nif check: assert check(value), \"%s %s\" % (name, check.__doc__)\n\nfor name,check in arg_checks[len(args):]:\n\nif check: assert check(kwargs[name]), \"%s %s\" % (name, check.__doc__)\n\nresult = func(*args,**kwargs) assert return_check(result), \"return %s\" % return_check.__doc__ return result\n\nreturn assert_call\n\nHere is an example of code that uses the previous decorator:\n\ndef positive(x):\n\n\"must be positive\" return x > 0\n\ndef negative(x):\n\n\"must be negative\" return x < 0\n\n@ensure def foo(a:positive, b:negative) -> positive:\n\nreturn a – b\n\nFollowing is some sample output of using the function:\n\n>>> foo(3,-2) 5 >>> foo(-5,2) Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module> File \"meta.py\", line 19, in call\n\ndef assert_call(*args,**kwargs):\n\nAssertionError: a must be positive >>>\n\nKeyword-Only Arguments Functions can specify keyword-only arguments.This is indicated by defining extra parameters after the first starred parameter. For example:\n\ndef foo(x, *args, strict=False):\n\nstatements\n\nF h Lib f L Bdff\n\n626\n\nAppendix Python 3\n\nWhen calling this function, the strict parameter can only be specified as a keyword. For example:\n\na = foo(1, strict=True)\n\nAny additional positional arguments would just be placed in args and not used to set the value of strict. If you don’t want to accept a variable number of arguments but want keyword-only arguments, use a bare * in the parameter list. For example:\n\ndef foo(x, *, strict=False):\n\nstatements\n\nHere is an example of usage:\n\nfoo(1,True) # Fails. TypeError: foo() takes 1 positional argument foo(1,strict=True) # Ok.\n\nEllipsis as an Expression The Ellipsis object (...) can now appear as an expression.This allows it to be placed in containers and assigned to variables. For example:\n\n>>> x = ... >>> x Ellipsis >>> a = [1,2,...] >>> a [1, 2, Ellipsis] >>> ... in a True >>> x is ... True >>>\n\n# Assignment of Ellipsis\n\nThe interpretation of the ellipsis is still left up to the application that uses it.This feature allows the ... to be used as an interesting piece of syntax in libraries and frameworks (for example, to indicate a wild-card, continuation, or some similar concept).\n\nChained Exceptions Exceptions can now be chained together. Essentially this is a way for the current excep- tion to carry information about the previous exception.The from qualifier is used with the raise statement to explicitly chain exceptions. For example:\n\ntry:\n\nstatements\n\nexcept ValueError as e:\n\nraise SyntaxError(\"Couldn't parse configuration\") from e\n\nWhen the SyntaxError exception is raised, a traceback message such as the following will be generated—showing both exceptions:\n\nTraceback (most recent call last):\n\nFile \"<stdin>\", line 2, in <module>\n\nValueError: invalid literal for int() with base 10: 'nine'\n\nThe above exception was the direct cause of the following exception:\n\nF h Lib f L Bdff\n\nNew Language Features\n\n627\n\nTraceback (most recent call last):\n\nFile \"<stdin>\", line 4, in <module>\n\nSyntaxError: Couldn't parse configuration\n\nException objects have a __cause__ attribute, which is set to the previous exception. Use of the from qualifier with raise sets this attribute.\n\nA more subtle example of exception chaining involves exceptions raised within\n\nanother exception handler. For example:\n\ndef error(msg):\n\nprint(m) # Note: typo is intentional (m undefined)\n\ntry:\n\nstatements\n\nexcept ValueError as e:\n\nerror(\"Couldn't parse configuration\")\n\nIf you try this in Python 2, you only get an exception related to the NameError in error(). In Python 3, the previous exception being handled is chained with the result. For example, you get this message:\n\nTraceback (most recent call last):\n\nFile \"<stdin>\", line 2, in <module>\n\nValueError: invalid literal for int() with base 10: 'nine'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n\nFile \"<stdin>\", line 4, in <module> File \"<stdin>\", line 2, in error\n\nNameError: global name 'm' is not defined\n\nFor implicit chaining, the __context__ attribute of an exception instance econtains a reference to previous exception.\n\nImproved super() The super() function, used to look up methods in base classes, can be used without any arguments in Python 3. For example:\n\nclass C(A,B):\n\ndef bar(self):\n\nreturn super().bar() # Call bar() in bases\n\nIn Python 2, you had to use super(C,self).bar().The old syntax is still supported but is significantly more clunky.\n\nAdvanced Metaclasses In Python 2, you can define metaclasses that alter the behavior of classes.A subtle facet of the implementation is that the processing carried out by a metaclass only occurs after the body of a class has executed.That is, the interpreter executes the entire body of a class and populates a dictionary. Once the dictionary has been populated, the dictionary is passed to the metaclass constructor (after the body of the class has executed).\n\nIn Python 3, metaclasses can additionally carry out extra work before the class body\n\nexecutes.This is done by defining a special class method called __prepare__(cls, name, bases, **kwargs) in the metaclass.This method must return a dictionary as a\n\nF h Lib f L Bdff\n\n628\n\nAppendix Python 3\n\nresult.This dictionary is what gets populated as the body of the class definition exe- cutes. Here is an example that outlines the basic procedure:\n\nclass MyMeta(type): @classmethod def __prepare__(cls,name,bases,**kwargs): print(\"preparing\",name,bases,kwargs) return {}\n\ndef __new__(cls,name,bases,classdict):\n\nprint(\"creating\",name,bases,classdict) return type.__new__(cls,name,bases,classdict)\n\nPython 3 uses an alternative syntax for specifying a metaclass. For example, to define a class that uses MyMeta, you use this:\n\nclass Foo(metaclass=MyMeta):\n\nprint(\"About to define methods\") def __init__(self):\n\npass\n\ndef bar(self):\n\npass\n\nprint(\"Done defining methods\")\n\nIf you run the following code, you will see the following output that illustrates the con- trol flow:\n\npreparing Foo () {} About to define methods Done defining methods creating Foo () {'__module__': '__main__',\n\n'bar': <function bar at 0x3845d0>, '__init__': <function __init__ at 0x384588>}\n\nThe additional keyword arguments on the __prepare__() method of the metaclass are passed from keyword arguments used in the bases list of a class statement. For example, the statement class Foo(metaclass=MyMeta,spam=42,blah=\"Hello\") passes the keyword arguments spam and blah to MyMeta.__prepare__().This con- vention can be used to pass arbitrary configuration information to a metaclass.\n\nTo perform any kind of useful processing with the new __prepare__() method of\n\nmetaclasses, you generally have the method return a customized dictionary object. For example, if you wanted to perform special processing as a class is defined, you define a class that inherits from dict and reimplements the __setitem__() method to capture assignments to the class dictionary.The following example illustrates this by defining a metaclass that reports errors if any method or class variable is multiply defined.\n\nclass MultipleDef(dict): def __init__(self):\n\nself.multiple= set()\n\ndef __setitem__(self,name,value):\n\nif name in self:\n\nself.multiple.add(name)\n\ndict.__setitem__(self,name,value)\n\nclass MultiMeta(type):\n\n@classmethod def __prepare__(cls,name,bases,**kwargs):\n\nreturn MultipleDef()\n\ndef __new__(cls,name,bases,classdict): for name in classdict.multiple:\n\nprint(name,\"multiply defined\")\n\nF h Lib f L Bdff\n\nCommon Pitfalls\n\n629\n\nif classdict.multiple:\n\nraise TypeError(\"Multiple definitions exist\")\n\nreturn type.__new__(cls,name,bases,classdict)\n\nIf you apply this metaclass to another class definition, it will report an error if any method is redefined. For example:\n\nclass Foo(metaclass=MultiMeta):\n\ndef __init__(self):\n\npass\n\ndef __init__(self,x): # Error. __init__ multiply defined.\n\npass\n\nCommon Pitfalls If you are migrating from Python 2 to 3, be aware that Python 3 is more than just new syntax and language features. Major parts of the core language and library have been reworked in ways that are sometimes subtle.There are aspects of Python 3 that may seem like bugs to a Python 2 programmer. In other cases, things that used to be “easy” in Python 2 are now forbidden.\n\nThis section outlines some of the most major pitfalls that are likely to be encoun-\n\ntered by Python 2 programmers making the switch.\n\nText Versus Bytes Python 3 makes a very strict distinction between text strings (characters) and binary data (bytes).A literal such as \"hello\" represents a text string stored as Unicode, where- as b\"hello\" represents a string of bytes (containing ASCII letters in this case).\n\nUnder no circumstances can the str and bytes type be mixed in Python 3. For example, if you try to concatenate strings and bytes together, you will get a TypeError exception.This differs from Python 2 where byte strings would be automatically coerced into Unicode as needed.\n\nTo convert a text string sinto bytes, you must use s.encode(encoding). For example, s.encode('utf-8') converts sinto a UTF-8 encoded byte string.To con- vert a byte string tback into text, you must use t.decode(encoding).You can view the encode() and decode() methods as a kind of “type cast” between strings and bytes.\n\nKeeping a clean separation between text and bytes is ultimately a good thing—the rules for mixing string types in Python 2 were obscure and difficult to understand at best. However, one consequence of the Python 3 approach is that byte strings are much more restricted in their ability to actually behave like “text.”Although there are the standard string methods like split() and replace(), other aspects of byte strings are not the same as in Python 2. For instance, if you print a byte string, you simply get its repr() output with quotes such as b'contents'. Similarly, none of the string format- ting operations (%, .format()) work. For example:\n\nx = b'Hello World' print(x) # Produces b'Hello World' print(b\"You said '%s'\" % x) # TypeError: % operator not supported\n\nThe loss of text-like behavior with bytes is a potential pitfall for system programmers. Despite the invasion of Unicode, there are many cases where one actually does want to\n\nF h Lib f L Bdff\n\n630\n\nAppendix Python 3\n\nwork with and manipulate byte-oriented data such as ASCII.You might be inclined to use the bytes type to avoid all of the overhead and complexity of Unicode. However, this will actually make everything related to byte-oriented text handling more difficult. Here is an example that illustrates the potential problems:\n\n>>> # Create a response message using strings (Unicode) >>> status = 200 >>> msg = \"OK\" >>> proto = \"HTTP/1.0\" >>> response = \"%s %d %s\" % (proto, status, msg) >>> print(response) HTTP/1.0 200 OK\n\n>>> # Create a response message using only bytes (ASCII) >>> status = 200 >>> msg = b\"OK\" >>> proto = b\"HTTP/1.0\" >>> response = b\"%s %d %s\" % (proto, status, msg) Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: unsupported operand type(s) for %: 'bytes' and 'tuple'\n\n>>> response = proto + b\" \" + str(status) + b\" \" + msg Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: can't concat bytes to str\n\n>>> bytes(status) b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00....'\n\n>>> bytes(str(status)) Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: string argument without an encoding\n\n>>> bytes(str(status),'ascii') b'200'\n\n>>> response = proto + b\" \" + bytes(str(status),'ascii') + b\" \" + msg >>> print(response) b'HTTP/1.0 200 OK'\n\n>>> print(response.decode('ascii')) HTTP/1.0 200 OK >>>\n\nIn the example, you can see how Python 3 is strictly enforcing the text/bytes separa- tion. Even operations that seem like they should be simple, such as converting an inte- ger into ASCII characters, are much more complicated with bytes.\n\nThe bottom line is that if you’re performing any kind of text-based processing or formatting, you are probably always better off using standard text strings. If you need to obtain a byte-string after the completion of such processing, you can use s.encode('latin-1') to convert from Unicode.\n\nThe text/bytes distinction is somewhat more subtle when working with various library modules. Some libraries work equally well with text or bytes, while some forbid bytes altogether. In other cases, the behavior is different depending on what kind of input is received. For example, the os.listdir(dirname) function only returns file-\n\nF h Lib f L Bdff\n\nCommon Pitfalls\n\n631\n\nnames that can be successfully decoded as Unicode if dirnameis a string. If dirnameis a byte string, then all filenames are returned as byte strings.\n\nNew I/O System Python 3 implements an entirely new I/O system, the details of which are described in the io module section of Chapter 19,“Operating System Services.”The new I/O sys- tem also reflects the strong distinction between text and binary data present with strings.\n\nIf you are performing any kind of I/O with text, Python 3 forces you to open files in “text mode” and to supply an optional encoding if you want anything other than the default (usually UTF-8). If you are performing I/O with binary data, you must open files in “binary mode” and use byte strings.A common source of errors is passing out- put data to a file or I/O stream opened in the wrong mode. For example:\n\n>>> f = open(\"foo.txt\",\"wb\") >>> f.write(\"Hello World\\n\") Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module> File \"/tmp/lib/python3.0/io.py\", line 1035, in write\n\nraise TypeError(\"can't write str to binary stream\")\n\nTypeError: can't write str to binary stream >>>\n\nSockets, pipes, and other kinds of I/O channels should always be assumed to be in bina- ry mode. One potential problem with network code in particular is that many network protocols involve text-based request/response processing (e.g., HTTP, SMTP, FTP, etc.). Given that sockets are binary, this mix of binary I/O and text processing can lead to some of the problems related to mixing text and bytes that were described in the previ- ous section.You’ll need to be careful.\n\nprint() and exec() Functions The print and exec statements from Python 2 are now functions. Use of the print() function compared to its Python 2 counterpart is as follows:\n\nprint(x,y,z) # Same as : print x, y, z print(x,y,z,end=' ') # Same as : print x, y, z, print(a,file=f) # Same as : print >>f, a\n\nThe fact that print() is a function that means you can replace it with an alternative definition if you want.\n\nexec() is also now a function, but its behavior in Python 3 is subtly different than\n\nin Python 2. For example, consider this code:\n\ndef foo():\n\nexec(\"a = 42\") print(a)\n\nIn Python 2, calling foo() will print the number '42'. In Python 3, you get a NameError exception with the variable a being undefined.What has happened here is that exec(), as a function, only operates on the dictionaries returned by the globals() and locals() functions. However, the dictionary returned by locals() is actually a copy of the local variables.The assignment made in the exec() function is\n\nF h Lib f L Bdff\n\n632\n\nAppendix Python 3\n\nmerely modifying this copy of the locals, not the local variables themselves. Here is one workaround:\n\ndef foo():\n\n_locals = locals() exec(\"a = 42\",globals(),_locals) a = _locals['a'] # Extract the set variable print(a)\n\nAs a general rule, don’t expect Python 3 to support the same degree of “magic” that was possible using exec(), eval(), and execfile() in Python 2. In fact, execfile() is gone entirely (you can emulate its functionality by passing an open file-like object to exec()).\n\nUse of Iterators and Views Python 3 makes much greater use of iterators and generators than Python 2. Built-in functions such as zip(), map(), and range() that used to return lists now return iter- ables. If you need to make a list from the result, use the list() function.\n\nPython 3 takes a slightly different approach to extracting key and value information from a dictionary. In Python 2, you could use methods such as d.keys(), d.values(), or d.items() to obtain lists of keys, values, or key/value pairs, respectively. In Python 3, these methods return so-called view objects. For example:\n\n>>> s = { 'GOOG': 490.10, 'AAPL': 123.45, 'IBM': 91.10 } >>> k = s.keys() >>> k <dict_keys object at 0x33d950> >>> v = s.values() >>> v <dict_values object at 0x33d960> >>>\n\nThese objects support iteration so if you want to view the contents, you can use a for loop. For example:\n\n>>> for x in k: ... ... GOOG AAPL IBM >>>\n\nprint(x)\n\nView objects are always tied back to the dictionary from which they were created.A subtle aspect of this is that if the underlying dictionary changes, the items produced by the view change as well. For example:\n\n>>> s['ACME'] = 5612.25 >>> for x in k: ... ... GOOG AAPL IBM ACME >>>\n\nprint(x)\n\nShould it be necessary to build a list of dictionary keys or values, simply use the list() function—for example, list(s.keys()).\n\nF h Lib f L Bdff\n\nCommon Pitfalls\n\n633\n\nIntegers and Integer Division Python 3 no longer has an int type for 32-bit integers and a separate long type for long integers.The int type now represents an integer of arbitrary precision (the inter- nal details of which are not exposed to the user).\n\nIn addition, integer division now always produces a floating-point result. For exam-\n\nple, 3/5 is 0.6, not 0.The conversion to a float applies even if the result would have been an integer. For example, 8/2 is 4.0, not 4.\n\nComparisons Python 3 is much more strict about how values are compared. In Python 2, it is the case that any two objects can be compared even if it doesn’t make sense. For example:\n\n>>> 3 < \"Hello\" True >>>\n\nIn Python 3, this results in a TypeError. For example:\n\n>>> 3 < \"Hello\" Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: unorderable types: int() < str() >>>\n\nThis change is minor, but it means that in Python 3, you have to be much more careful about making sure data is of appropriate types. For example, if you use the sort() method of a list, all of the items in the list must be compatible with the < operator, or you get an error. In Python 2, the operation would be silently carried out anyways with a usually meaningless result.\n\nIterators and Generators Python 3 has made a slight change to the iterator protocol. Instead of calling __iter__() and the next() method to perform iteration, the next() method has been renamed to __next__(). Most users will be unaffected by this change except if you have written code that manually iterates over an iterable or if you have defined your own custom iterator objects.You will need to make sure you change the name of the next() method in your classes. Use the built-in next() function to invoke the next() or __next__() method of an iterator in a portable manner.\n\nFile Names, Arguments, and Environment Variables In Python 3, filenames, command-line arguments in sys.argv, and environment vari- ables in os.environ may or may not be treated as Unicode depending on local set- tings.The only problem is that the usage of Unicode within the operating system envi- ronment is not entirely universal. For example, on many systems it may be technically possible to specify filenames, command-line options, and environment variables that are just a raw sequence of bytes that don’t correspond to a valid Unicode encoding. Although these situations might be rare in practice, it may be of some concern for programming using Python to perform tasks related to systems administration.As previ- ously noted, supplying file and directory names as byte strings will fix many of the problems. For example, os.listdir(b'/foo').\n\nF h Lib f L Bdff\n\n634\n\nAppendix Python 3\n\nLibrary Reorganization Python 3 reorganizes and changes the names of several parts of the standard library, most notably modules related to networking and Internet data formats. In addition, a wide variety of legacy modules have been dropped from the library (e.g., gopherlib, rfc822, and so on).\n\nIt is now standard practice to use lowercase names for modules. Several modules such\n\nas ConfigParser, Queue, and SocketServer have been renamed to configparser, queue, and socketserver, respectively.You should try to follow similar conventions in your own code.\n\nPackages have been created to reorganize code that was formerly contained in dis-\n\nparate modules—for example, the http package containing all the module used to write HTTP servers, the html package has modules for parsing HTML, the xmlrpc package has modules for XML-RPC, and so forth.\n\nAs for deprecated modules, this book has been careful to only document modules that are in current use with Python 2.6 and Python 3.0. If you are working with exist- ing Python 2 code and see it using a module not documented here, there is a good chance that the module has been deprecated in favor of something more modern. Just as an example, Python 3 doesn’t have the popen2 module commonly used in Python 2 to launch subprocesses. Instead, you should use the subprocess module.\n\nAbsolute Imports Related to library reorganization, all import statements appearing in submodules of a package use absolute names.This is covered in more detailed in Chapter 8,“Modules, Packages, and Distribution,” but suppose you have a package organized like this:\n\nfoo/\n\n__init__.py spam.py bar.py\n\nIf the file spam.py uses the statement import bar, you get an ImportError exception even though bar.py is located in the same directory.To load this submodule, spam.py either needs to use import foo.bar or a package relative import such as from . import bar.\n\nThis differs from Python 2 where import always checks the current directory for a\n\nmatch before moving onto checking other directories in sys.path.\n\nCode Migration and 2to3 Converting code from Python 2 to Python 3 is a delicate topic. Just to be absolutely clear, there are no magic imports, flags, environment variables, or tools that will enable Python 3 to run an arbitrary Python 2 program. However, there are some very specific steps that can be taken to migrate code, each of which is now described.\n\nPorting Code to Python 2.6 It is recommended that anyone porting code to Python 3 first port to Python 2.6. Python 2.6 is not only backwards-compatible with Python 2.5, but it also supports a subset of new features found in Python 3. Examples include advanced string formatting, the new exception syntax, byte literals, I/O library, and abstract base classes.Thus, a\n\nF h Lib f L Bdff",
      "page_number": 638
    },
    {
      "number": 32,
      "title": "Segment 32 (pages 659-681)",
      "start_page": 659,
      "end_page": 681,
      "detection_method": "synthetic",
      "content": "Code Migration and 2to3\n\n635\n\nPython 2 program can start to take advantage of useful Python 3 features now even if it is not yet ready to make the full migration.\n\nThe other reason to port to Python 2.6 is that Python 2.6 issues warning messages for deprecated features if you run it with the -3 command-line option. For example:\n\nbash-3.2$ python -3 Python 2.6 (trunk:66714:66715M, Oct 1 2008, 18:36:04) [GCC 4.0.1 (Apple Computer, Inc. build 5370)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> a = { } >>> a.has_key('foo') __main__:1: DeprecationWarning: dict.has_key() not supported in 3.x; use the in operator False >>\n\nUsing these warning messages as a guide, you should take great care to make sure that your program runs warning-free on Python 2.6 before moving forward with a Python 3 port.\n\nProviding Test Coverage Python has useful testing modules including doctest and unittest. Make sure your application has thorough test coverage before attempting a Python 3 port. If your pro- gram has not had any tests to this point, now would be a good time to start.You will want to make sure your tests cover as much as possible and that all tests pass without any warning messages when run on Python 2.6.\n\nUsing the 2to3 Tool Python 3 includes a tool called 2to3 that can assist with code migration from Python 2.6 to Python 3.This tool is normally found in the Tools/scripts directory of the Python source distribution and is also installed in the same directory as the python3.0 binary on most systems. It is a command-line tool that would normally run from a UNIX or Windows command shell.\n\nAs an example, consider the following program that contains a number of deprecated\n\nfeatures.\n\n# example.py import ConfigParser\n\nfor i in xrange(10): print i, 2*i\n\ndef spam(d):\n\nif not d.has_key(\"spam\"):\n\nd[\"spam\"] = load_spam()\n\nreturn d[\"spam\"]\n\nTo run 2to3 on this program, type “2to3 example.py”. For example:\n\n% 2to3 example.py RefactoringTool: Skipping implicit fixer: buffer RefactoringTool: Skipping implicit fixer: idioms RefactoringTool: Skipping implicit fixer: set_literal RefactoringTool: Skipping implicit fixer: ws_comma --- example.py (original) +++ example.py (refactored) @@ -1,10 +1,10 @@\n\nF h Lib f L Bdff\n\n636\n\nAppendix Python 3\n\n# example.py\n\nimport ConfigParser +import configparser\n\nfor i in xrange(10): - print i, 2*i +for i in range(10): + print(i, 2*i) def spam(d):\n\nif not d.has_key(\"spam\"): + if \"spam\" not in d: d[\"spam\"] = load_spam()\n\nreturn d[\"spam\"]\n\nRefactoringTool: Files that need to be modified: RefactoringTool: example.py\n\nAs output, 2to3 will identify parts of the program that it considers to be problematic and that might need to be changed.These are shown as context-diffs in the output. Although we have used 2to3 on a single file, if you give it the name of a directory, it recursively looks for all Python files contained in the directory structure and generates a report for everything.\n\nBy default, 2to3 does not actually fix any of the source code it scans—it merely reports parts of the code that might need to be changed.A challenge faced by 2to3 is that it often only has incomplete information. For example, consider the spam() func- tion in the example code.This function calls a method d.has_key(). For dictionaries, has_key() has been removed in favor of the in operator. 2to3 reports this change, but without more information, it is not clear if spam() is actually manipulating a dictionary or not. It might be the case that d is some other kind of object (a database perhaps) that happens to provide a has_key() method, but where using the in operator would fail. Another problematic area for 2to3 is in the handling of byte strings and Unicode. Given that Python 2 would automatically promote byte strings to Unicode, it is some- what common to see code that carelessly mixes the two string types together. Unfortunately, 2to3 is unable to sort all of this out.This is one reason why it’s impor- tant to have good unit test coverage. Of course, all of this depends on the application. As an option, 2to3 can be instructed to fix selected incompatibilities. First, a list of\n\n“fixers” can be obtained by typing 2to3 -l. For example:\n\n% 2to3 -l Available transformations for the -f/--fix option: apply basestring buffer callable ... ... xrange xreadlines zip\n\nUsing names from this list, you can see what a selected fix would actually change by simply typing “2to3 -f fixname filename”. If you want to apply multiple fixes, just specify each one with a separate -f option. If you actually want to apply the fix to a source file, add the -w option as in 2to3 -f fixname -w filename. Here is an example:\n\nF h Lib f L Bdff\n\nCode Migration and 2to3\n\n637\n\n% 2to3 -f xrange -w example.py --- example.py (original) +++ example.py (refactored) @@ -1,7 +1,7 @@ # example.py import ConfigParser\n\nfor i in xrange(10): +for i in range(10): print i, 2*i\n\ndef spam(d):\n\nRefactoringTool: Files that were modified: RefactoringTool: example.py\n\nIf you look at example.py after this operation, you will find that xrange() has been changed to range() and that no other changes have been made.A backup of the origi- nal example.py file is found in example.py.bak.\n\nA counterpart to the -f option is the -x option. If you use 2to3 -x fixname filename, it will run all of the fixers except for the ones you listed with the -x option. Although it is possible to instruct 2to3 to fix everything and to overwrite all of your files, this is probably something best avoided in practice. Keep in mind that code transla- tion is an inexact science and that 2to3 is not always going to do the “right thing.” It is always better to approach code migration in a methodical calculated manner as opposed to crossing your fingers and hoping that it all just magically “works.”\n\n2to3 has a couple of additional options that may be useful.The -v option enables a\n\nverbose mode that prints additional information that might be useful for debugging. The -p option tells 2to3 that you are already using the print statement as a function in your code and that it shouldn’t be converted (enabled by the from __future__ import print_statement statement).\n\nA Practical Porting Strategy Here is a practical strategy for porting Python 2 code to Python 3.Again, it is better to approach migration in a methodical manner as opposed to doing everything at once. 1. Make sure your code has an adequate unit testing suite and that all tests pass\n\nunder Python 2.\n\n2. Port your code and testing suite to Python 2.6 and make sure that all tests still pass.\n\n3. Turn on the -3 option to Python 2.6.Address all warning messages and make sure your program runs and passes all tests without any warning messages. If you’ve done this correctly, chances are that your code will still work with Python 2.5 and maybe even earlier releases.You’re really just cleaning out some of the cruft that’s accumulated in your program.\n\n4. Make a backup of your code (this goes without saying). 5. Port the unit testing suite to Python 3 and make sure that the testing environ- ment itself is working.The individual unit tests themselves will fail (because you haven’t yet ported any code). However, a properly written test suite should be able to deal with test failures without having an internal crash of the test software itself.\n\nF h Lib f L Bdff\n\n638\n\nAppendix Python 3\n\n6. Convert the program itself to Python 3 using 2to3. Run the unit testing suite on the resulting code and fix all of the issues that arise.There are varying strategies for doing this. If you’re feeling lucky, you can always tell 2to3 to just fix every- thing and see what happens. If you’re more cautious, you might start by having 2to3 fix the really obvious things (print, except statements, xrange(), library module names, etc.) and then proceed in a more piecemeal manner with the remaining issues.\n\nBy the end of this process, your code should pass all unit tests and operate in the same manner as before.\n\nIn theory, it is possible to structure code in a way so that it both runs in Python 2.6\n\nand automatically translates to Python 3 without any user intervention. However, this will require very careful adherence to modern Python coding conventions—at the very least you will absolutely need to make sure there are no warnings in Python 2.6. If the automatic translation process requires very specific use of 2to3 (such as running only a selected set of fixers), you should probably write a shell script that automatically carries out the required operations as opposed to requiring users to run 2to3 on their own.\n\nSimultaneous Python 2 and Python 3 Support A final question concerning Python 3 migration is whether or not it’s possible to have a single code base that works unmodified on Python 2 and Python 3.Although this is possible in certain cases, the resulting code runs the risk of becoming a contorted mess. For instance, you will have to avoid all print statements and make sure all except clauses never take any exception values (extracting them from sys.exc_info() instead). Other Python features can’t be made to work at all. For example, due to syntax differences, there is no possible way to use metaclasses in a way that would be portable between Python 2 and Python 3.\n\nThus, if you’re maintaining code that must work on Python 2 and 3, your best bet is\n\nto make sure your code is as clean as possible and runs under Python 2.6, make sure you have a unit testing suite, and try to develop a set of 2to3 fixes to make automatic translation possible.\n\nOne case where it might make sense to have a single code base is with unit testing. A test suite that operates without modification on Python 2.6 and Python 3 could be useful in verifying the correct behavior of the application after being translated by 2to3.\n\nParticipate As an open-source project, Python continues to be developed with the contributions of its users. For Python 3, especially, it is critically to report bugs, performance problems, and other issues.To report a bug, go to http://bugs.python.org. Don’t be shy—your feedback makes Python better for everyone.\n\nF h Lib f L Bdff\n\nSymbols & Numbers\n\n! debugger command, pdb module, 187\n\n!= not equal to operator, 66\n\n‘ single quotes, 11, 27\n\n‘’’ triple quotes, 11, 27\n\n“ double quotes, 11, 27\n\n“”” triple quotes, 11, 27\n\n# comment, 6, 26\n\n#! in Unix shell scripts, 6, 176\n\nrewriting on package installation, 153\n\n% modulo operator, 65\n\n% string formatting operator, 8, 70, 162\n\n%= operator, 75\n\n& bitwise-and operator, 65\n\n& set intersection operator, 15, 75\n\n&= operator, 75\n\n() function call operator, 76\n\n() tuple, 14, 29\n\nkeyword only arguments, Python 3, 625\n\nmultiplication operator, 65\n\npassing sequences as function argu- ments, 94\n\nsequence replication operator, 67\n\nvariable arguments in function definition, 94\n\nwildcard\n\nfrom module import, 24, 145 iterable unpacking in Python 3, 623 ** passing dictionaries as keyword argu-\n\nments, 95\n\n** power operator, 65\n\n** variable keyword arguments in function\n\ndefinition, 95\n\n**= operator, 75\n\n*= operator, 75\n\nIndex\n\n+ addition operator, 65\n\n+ list concatenation operator, 12\n\n+ sequence concatenation operator, 67\n\n+ string concatenation operator, 11\n\n+ unary plus operator, 65\n\n+= operator, 75\n\nhyphen character, used as filename, 174\n\nset difference operator, 15, 75\n\nsubtraction operator, 65\n\nunary minus operator, 65\n\n-*- coding: comment, in source code, 31\n\n= operator, 75\n\n. attribute binding operator, 33, 48, 76, 118\n\nand modules, 51 special methods for, 57\n\n. directory reference in relative import\n\nstatements, 150\n\n... Ellipsis, 30, 54, 59\n\n... interpreter prompt, 175\n\n/ division operator, 65\n\n// truncating division operator, 65\n\n//= operator, 75\n\n/= operator, 75\n\n: colon in string formatting specifiers, 72\n\n; semicolon, 7, 26\n\n< left alignment in string format specifiers,\n\n73\n\n< less than operator, 66\n\n<< left shift operator, 65\n\n<<= operator, 75\n\n<= less than or equal to operator, 66\n\n== equal to operator, 66, 78\n\n> greater than operator, 66\n\n> right alignment in string format speci-\n\nfiers, 73\n\nF h Lib f L Bdff\n\n640\n\n>= greater than or equal to operator\n\n>= greater than or equal to operator, 66\n\n>> file redirection modifier to print, 10,\n\n163\n\n>> right shift operator, 65\n\n>>= operator, 75\n\n>>> interpreter prompt, 5, 175\n\n@ decorator, 30, 101\n\n[::] extended slicing operator, 39-40, 67-68\n\n[:] slicing operator, 39-40, 67-68\n\n[] indexing operator, 39-40, 67 and special methods, 58 on mappings, 45 on sequences, 68\n\n[] list, 12, 29\n\n\\ line continuation character, 9, 25, 29\n\n\\ string escape codes, 27\n\n^ bitwise-xor operator, 65\n\n^ centered alignment in string format spec-\n\nifiers, 73\n\n^ set symmetric difference operator, 15, 75\n\n^= operator, 75\n\n_ variable, interactive mode, 6, 176\n\n{} dict, 16, 29\n\n{} placeholder in format strings, 72\n\n{} set literal, Python 3, 622\n\n| bitwise-or operator, 65\n\n| set union operator, 15, 75\n\n|= operator, 75\n\n~ bitwise-negation operator, 65\n\n~ expanding user home directory in file-\n\nnames, 397\n\n$variables in strings, 72\n\n0b binary integer literal, 27\n\n0o octal integer literal, 27\n\n0x hexadecimal integer literal, 27\n\n2’s complement and integers, 66\n\n2to3 tool, 635-637\n\nlimitations of, 636\n\n3 command line option, 173, 635\n\nA\n\n‘a’ mode, to open() function, 159\n\na(args) debugger command, pdb module,\n\n187\n\na2b_base64() function, binascii module,\n\n547\n\na2b_hex() function, binascii module, 548\n\na2b_hqx() function, binascii module, 548\n\na2b_uu() function, binascii module, 547\n\nabc module, 136, 257\n\nABCMeta metaclass, 136, 257\n\nabort() function, os module, 390\n\nabort() method, of FTP objects, 497\n\nabs() function, 66, 201\n\noperator module, 273\n\n__abs__() method, 61\n\nabsolute imports, 151 Python 3, 634 compared to relative imports, 151\n\nabsolute value, 66\n\nabspath() function, os.path module, 396\n\nabstract base class, 34, 136, 257\n\ncalling methods in subclasses, 137 checking performed, 137 container objects, 265 error if instantiated, 137 example, 258 files and I/O, 354 numeric types, 253 registering pre-existing classes, 137 special methods for, 57\n\n@abstractmethod decorator, 136-137,\n\n257-258\n\n__abstractmethods__ attribute, of types,\n\n50\n\n@abstractproperty decorator, 136-137,\n\n257-258\n\naccept() method\n\nof Listener objects, 433 of dispatcher objects, 456 of socket objects, 478\n\naccept2dyear variable, time module, 405\n\naccess control specifiers, lack of, 127\n\nF h Lib f L Bdff\n\n%APPDATA% environment variable, Windows\n\n641\n\naccess() function, os module, 386\n\naddLevelName() function, logging module,\n\nacos() function, math module, 251\n\n366\n\nacosh() function, math module, 251\n\naddress attribute\n\nacquire() method\n\nof Condition objects, 441 of Lock objects, 438 of RLock objects, 438 of Semaphore objects, 439\n\nof BaseManager objects, 431 of Listener objects, 433 address families, of sockets, 470\n\naddress_family attribute, of SocketServer\n\nclass, 492\n\nactivate() method, of SocketServer class,\n\naddresses, network, 471\n\n493\n\naddressof() function, ctypes module, 617\n\nactive_children() function, multiprocessing\n\nadjacent string literals, concatenation of, 27\n\nmodule, 434\n\nadler32() function, zlib module, 328\n\nactive_count() function, threading module,\n\nadvanced string formatting, 8, 42, 72\n\n443\n\nAF_* constants, socket module, 470\n\nActivePython, 5\n\naifc module, 588\n\nadd() function, operator module, 273\n\naio_* family of system calls, lack of, 469\n\nadd() method\n\nof TarFile objects, 320 of sets, 15, 46 __add__() method, 60\n\nAJAX, example of, 531\n\nalarm() function, signal module, 399\n\nalarms, 399\n\nadd_data() method, of Request objects,\n\n516\n\nalias debugger command, pdb module, 187\n\nalignment() function, ctypes module, 617\n\nadd_header() method\n\n__all__ variable\n\nof Message objects, 555 of Request objects, 516\n\nadd_option() method, of OptionParser\n\nand import statements, 145 in packages, 150 all() function, 40, 67, 201\n\nobjects, 158, 375\n\nallow_reuse_address attribute, of\n\nadd_password() method, of AuthHandler\n\nSocketServer class, 492\n\nobjects, 519\n\naltsep variable, os module, 386\n\nadd_section() method, of ConfigParser\n\naltzone variable, time module, 405\n\nobjects, 332\n\nand operator, boolean expressions, 9, 77\n\nadd_type() function, mimetypes module,\n\n567\n\nadd_unredirected_header() method, of\n\nRequest objects, 517\n\naddfile() method, of TarFile objects, 320\n\naddFilter() method\n\nof Handler objects, 364 of Logger objects, 359\n\nand_() function, operator module, 274\n\n__and__() method, 60\n\n__annotations__ attribute, of functions,\n\n624\n\nanonymous functions, 112\n\nany() function, 40, 67, 201\n\nanydbm module, 310\n\naddHandler() method, of Logger objects,\n\napi_version variable, sys module, 229\n\n361\n\n%APPDATA% environment variable,\n\naddition operator +, 65\n\nWindows, 177\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n642\n\nappend() method\n\nappend() method\n\nof Element objects, 576 of array objects, 259 of deque objects, 262 of lists, 12, 40\n\nappendChild() method, of DOM Node\n\nobjects, 571\n\nappendleft() method, of deque objects, 262\n\napplication logging, 355\n\napplications, WSGI, 540\n\napplicative order evaluation, 76\n\napply() method, of Pool objects, 424\n\napply_async() method, of Pool objects, 424\n\nargs attribute\n\nof Exception objects, 213 of exceptions, 88 of partial objects, 268\n\nargtypes attribute, of ctypes function\n\nobjects, 613\n\nargv variable, sys module, 13, 157, 174,\n\n229\n\nArithmeticError exception, 87, 212\n\narray module, 259\n\nArray() function, multiprocessing module,\n\n426\n\nArray() method, of Manager objects, 428\n\narray() function, array module, 259\n\narrays, creating from uniform type, 259\n\narraysize attribute, of Cursor objects, 299\n\nas qualifier\n\nof except statement, 22, 85 of from-import statement, 145 of import statement, 24, 144 of with statement, 62, 90\n\nas_integer_ratio() method, of floating point,\n\n39\n\nas_string() method, of Message objects,\n\n555\n\nascii encoding, description of, 169\n\nascii() function, 201\n\nand Python 3, 201 future_builtins module, 217\n\nASCII, and compatibility with UTF-8, 170\n\nascii_letters variable, string module, 287\n\nascii_lowercase variable, string module,\n\n287\n\nascii_uppercase variable, string module,\n\n287\n\nasctime() function, time module, 405\n\nasin() function, math module, 251\n\nasinh() function, math module, 251\n\nassert statement, 91\n\nassert_() method, of TestCase objects, 185\n\nassertAlmostEqual() method, of TestCase\n\nobjects, 185\n\nassertEqual() method, of TestCase objects,\n\n185\n\nAssertionError exception, 87, 91, 213\n\nassertions, 91\n\nstripping with -O option, 148 assertNotAlmostEqual() method, of\n\nTestCase objects, 185\n\nassertNotEqual() method, of TestCase\n\nobjects, 185\n\nassertRaises() method, of TestCase objects,\n\n185\n\nassignment\n\nand reference counting, 34 augmented, 61 in-place operators, 61 of instance attributes, 131 of variables, 7 to variables in nested functions, 97\n\nassociative array, 16, 44\n\nassociativity of operators, 78\n\nastimezone() method, of datetime objects,\n\n340\n\nasynchat class, asynchat module, 452\n\nasynchat module, 452\n\nuse of, 467\n\nasynchronous I/O, 415\n\nasynchronous networking\n\nand blocking operations, 469 when to consider, 467 asyncore module, 415, 455\n\nuse of, 467\n\nAsyncResult objects, multiprocessing mod-\n\nule, 425\n\nF h Lib f L Bdff\n\nBaseProxy class, multiprocessing module\n\n643\n\natan() function, math module, 251\n\nB\n\natan2() function, math module, 251\n\natanh() function, math module, 251\n\natexit module, 179, 219\n\natomic operations, disassembly, 193\n\nB command line option, 173\n\nb character, before a string literal, 29\n\nb(reak) debugger command, pdb module,\n\n187\n\nattach() method, of Message objects, 556\n\nb16decode() function, base64 module, 547\n\nattrgetter() function, operator module, 275\n\nb16encode() function, base64 module, 547\n\nattrib attribute, of Element objects, 576\n\nb2a_base64() function, binascii module,\n\nattribute assignment, on instances, 131\n\n547\n\nattribute binding operator ., 33, 76\n\nb2a_hex() function, binascii module, 548\n\noptimization of, 196\n\nb2a_hqx() function, binascii module, 548\n\nattribute binding\n\nb2a_uu() function, binascii module, 547\n\nand inheritance, 119 and methods, 48 instances and classes, 118 of user-defined objects, 131 process of, 57 redefining in classes, 132 special methods for, 57\n\nb32decode() function, base64 module, 546\n\nb32encode() function, base64 module, 546\n\nb64decode() function, base64 module, 546\n\nb64encode() function, base64 module, 546\n\nbackslash rules, and raw strings, 29\n\n‘backslashreplace’ error handling, Unicode\n\nattribute deletion, on instances, 131\n\nattribute lookup in string formatting, 72\n\nencoding, 166\n\nBadStatusLine exception, http.client mod-\n\nule, 504\n\nAttributeError exception, 87, 213 and attribute binding, 132\n\nbase class, 21\n\nbase-10 decimals, 243\n\nattributes attribute, of DOM Node objects,\n\n570\n\nattributes\n\ncomputed as properties, 117, 124 creation in __init__() method, 118 descriptors, 58, 126 encapsulation of, 127 lookup in composite string formatting,\n\nand floating point, 12\n\nbase64 encoding, description of, 545\n\nbase64 module, 545\n\nBaseCGIHandler() function, wsgiref.handlers\n\nmodule, 542\n\nBaseException class, 212\n\nBaseException exception, 87\n\n42\n\nof objects, 33 private, 127 restricting names with __slots__, 132 user defined on functions, 114\n\nBaseHTTPRequestHandler class, http.server\n\nmodule, 508\n\nBaseHTTPserver module, see http.server,\n\n506\n\nBaseManager() function, multiprocessing\n\naudioop module, 588\n\naugmented assignment operators, 61, 75\n\nmodule, 430\n\nbasename() function, os.path module, 396,\n\n398\n\nauthentication, fetching URLs, 519\n\nBaseProxy class, multiprocessing module,\n\nauthkey attribute, of Process objects, 416\n\n432\n\nawk UNIX command, similarity to list com-\n\nprehensions, 111\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n644\n\nBaseRequestHandler class, SocketServer module\n\nBaseRequestHandler class, SocketServer\n\nbitwise-negation operator ~, 65\n\nmodule, 490\n\nbitwise-or operator |, 65\n\n__bases__ attribute of classes, 131 of types, 50\n\nbitwise-xor operator ^, 65\n\nblank lines, 26\n\nblock_size attribute, of digest objects, 559\n\nbasestring variable, 202\n\nblocking operations, and asynchronous net-\n\nbasicConfig() function, logging module, 355\n\nworking, 469\n\nBasicContext variable, decimal module,\n\n248\n\nBluetooth protocol, 470 address format, 472\n\n.bat files, Windows, 176\n\nBOM (byte order marker), 280\n\nbdb module, 585\n\nand Unicode, 168\n\nBeautiful Soup package, 563\n\nBOM_* constants, codecs module, 280\n\nbetavariate() function, random module, 255\n\nbool type, 38\n\nbidirectional() function, unicodedata mod-\n\nule, 293\n\nbig endian format, 167\n\nbig endian, packing and unpacking, 292\n\nbin() function, 77, 202\n\nbool() function, 202\n\n__bool__() method, 56, 58\n\nboolean expressions, 9, 77 evaluation rules, 78 boolean operators, 66\n\nbinary data structures, packing and\n\nunpacking, 290\n\nboolean values, 27, 38\n\nbinary distribution, creating with distutils,\n\n153\n\nboolean() function, xmlrpc.client module,\n\n525\n\nbinary file mode, 159\n\nbound method, 49, 125\n\nbinary files, 350\n\nbuffered I/O, 351 caution on using line-oriented func-\n\nBoundedSemaphore object\n\nmultiprocessing module, 427 threading module, 439\n\ntions, 351-352\n\nBoundedSemaphore() method, of Manager\n\nbinary integer literals, 27\n\nobjects, 428\n\nBinary() function\n\ndatabase API, 301 xmlrpc.client module, 526\n\nbreak statement, 83-84 and generators, 103\n\nbreaking long statements on multiple lines,\n\nbinascii module, 547\n\nbind() method\n\nof SocketServer class, 493 of dispatcher objects, 456 of socket objects, 478\n\n9\n\nbreakpoint\n\nsetting in debugger, 187 setting manually, 186\n\nbrowser, launching from Python, 544\n\nbinhex module, 587\n\nBSD, kqueue interface, 460\n\nbisect module, 261\n\nBTPROTO_* constants, socket module, 477\n\nbisect() function, bisect module, 261\n\nbuffer, circular, 262\n\nbisect_left() function, bisect module, 261\n\nbuffer_info() method, of array objects, 259\n\nbisect_right() function, bisect module, 261\n\nbuffered binary I/O, 351\n\nbitwise operations and native integers, 66\n\nBufferedIOBase abstract base class, 354\n\nbitwise-and operator &, 65\n\nBufferedRandom class, io module, 352\n\nBufferedReader class, io module, 351\n\nF h Lib f L Bdff\n\ncancel() method, of Timer objects\n\n645\n\nBufferedRWPair class, io module, 352\n\nC\n\nBufferedWriter class, io module, 352\n\nbuffering, and generators, 165\n\nbuild_opener() function, urllib.request mod-\n\nule, 518\n\nbuilt-in exceptions, 23, 87\n\nbuilt-in functions and types, 201\n\nbuilt-in functions, using Python 3 functions\n\nC extensions, 591\n\nand .egg files, 147 and module reloading, 149 compiling with distutils, 596 creating with SWIG, 619 example with ctypes, 618 releasing global interpreter lock, 444\n\nin Python 2, 217\n\nbuilt-in types, 37\n\n__builtin__ module, 201\n\nbuiltin_module_names variable, sys mod-\n\nule, 229\n\nBuiltinFunctionType, 49\n\nBuiltinFunctionType type, 47, 237\n\nbuiltins module, Python 3, 201\n\nbyref() function, ctypes module, 615\n\nc command line option, 173-174\n\nC#, 620\n\nc(ont(inue)) debugger command, pdb mod-\n\nule, 188\n\nC++, difference in class system, 119\n\nC\n\nPython variables compared to, 7 implementation of functions, 49 C/C++ code, in third-party packages, 154\n\nbyte literals, 29\n\nC3 linearization algorithm, and inheritance,\n\nbyte strings, 41\n\n121\n\nand WSGI, 541 and files, 160 and system interfaces in Python 3, 630 as in-memory binary files, 352 decoding as Unicode, 165 different behavior in Python 3, 629 lack of formatting in Python 3, 629 mixing with Unicode strings, 70, 167 mutable byte arrays, 202 use in system interfaces, 633\n\nc_* datatypes, ctypes module, 614\n\nCacheFTPHandler class, urllib.request mod-\n\nule, 518\n\ncaching results of a function, 242\n\ncalcsize() function, struct module, 291\n\ncalendar module, 588\n\ncall() function, subprocess module, 403\n\n__call__() method, 50, 62\n\nCallable abstract base class, 265\n\nbytearray() function, 202\n\nbyteorder variable, sys module, 229\n\nbytes datatype, Python 3, 29\n\nbytes() function, 202-203\n\nbytes, escape code in strings, 28\n\ncallable objects\n\nand __call__() method, 62 classes, 50 instances, 50 types of, 47 callback functions, 98\n\nBytesIO class, io module, 352\n\nand lambda, 112\n\nbyteswap() method, of array objects, 259\n\ncalling Python functions from C, 610\n\nbz2 module, 313\n\ncalling a function, 18, 93\n\nBZ2Compressor() function, bz2 module,\n\n313\n\n_callmethod() method, of BaseProxy\n\nobjects, 433\n\nBZ2Decompressor() function, bz2 module,\n\n314\n\nBZ2File() function, bz2 module, 313\n\ncallproc() method, of Cursor objects, 298\n\ncancel() method, of Timer objects, 438\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n646\n\ncancel_join_thread() method, of Queue objects\n\ncancel_join_thread() method, of Queue\n\nchained comparisons, 66\n\nobjects, 418\n\nchained exceptions, Python 3, 627\n\nCannotSendHeader exception, http.client\n\nmodule, 504\n\nchanging display of results, interactive\n\nmode, 176\n\nCannotSendRequest exception, http.client\n\nmodule, 504\n\ncapitalize() method, of strings, 41-42\n\ncapitals attribute, of Context objects, 247\n\nchanging module name on import, 144\n\nchanging the working directory, 379\n\nchanging user-agent header in HTTP\n\nrequests, 517\n\ncapwords() function, string module, 290\n\ncharacter substitution, 42\n\ncase conversion, of strings, 43-44\n\ncharacters() method, of ContentHandler\n\ncase sensitivity, of identifiers, 26\n\nobjects, 581\n\ncase statement, lack of, 9\n\ncharacters\n\ncast() function, ctypes module, 617\n\ncatching all exceptions, 85\n\ncatching multiple exceptions, 85\n\nescape codes, 28 specifying Unicode, 28 chdir() function, os module, 379\n\ncategory() function, unicodedata module,\n\ncheck_call() function, subprocess module,\n\n170, 293\n\n403\n\n__cause__ attribute, of Exception objects,\n\ncheck_unused_args() method, of Formatter\n\n213, 627\n\nobjects, 289\n\ncaution with range() function, 17\n\nchecking if running as main program, 146\n\nCDLL() function, ctypes module, 612\n\nchecking multiple cases with a conditional,\n\nceil() function, math module, 251\n\ncenter() method, of strings, 41-42\n\ncert_time_to_seconds() function, ssl mod-\n\nule, 488\n\nCGI script, 533\n\nadvice for writing, 537 environment variables, 533 executing XML-RPC server within,\n\n9\n\nchflags() function, os module, 386\n\nchicken, multithreaded, 414\n\nchildNodes attribute, of DOM Node objects,\n\n570\n\nchmod() function, os module, 387\n\nchoice() function, random module, 254\n\nchown() function, os module, 387\n\n529\n\nchr() function, 77, 203\n\nrunning WSGI application, 542 use of databases, 538 web frameworks, 538\n\nchroot() function, os module, 379\n\nchunk module, 588\n\ncipher() method, of ssl objects, 487\n\ncgi module, 533\n\ncircular buffer or queue with deque objects,\n\nCGIHandler() function, wsgiref.handlers\n\n262\n\nmodule, 542\n\nCGIHTTPRequestHandler class, http.server\n\ncl(ear) debugger command, pdb module,\n\n188\n\nmodule, 507\n\nCGIHTTPServer module, see http.server,\n\n506\n\ncgitb module, 539\n\nCGIXMLRPCRequestHandler class,\n\nxmlrpc.server module, 528\n\nclass decorators, 102, 141\n\nclass method, 48, 123\n\nattribute binding of, 124 practical use of, 124 class statement, 21, 117\n\nchain() function, itertools module, 270\n\nand inheritance, 21, 119 execution of class body, 138\n\nF h Lib f L Bdff\n\nclose() method\n\n647\n\nclass variables, 117\n\nsharing by all instances, 118\n\n__class__ attribute\n\nof instances, 50, 131 of methods, 49\n\nclasses, 21\n\nstatic methods, 22 super() function in methods, 120 supporting pickle module, 228 type of, 47 uniform access principle, 125 versus dicts for storing data, 195\n\n__del__() method and garbage collec-\n\n@classmethod decorator, 48, 123, 125, 203\n\ntion, 221-222\n\nClassType type, old-style classes, 139\n\n__init__() method, 118 __init__() method and inheritance,\n\n120\n\ncleandoc() function, inspect module, 222\n\nclear() method\n\n__slots__ attribute, 132 abstract base class, 136, 257 access control specifiers, lack of, 127 accessing in modules, 144 and metaclasses, 138 as callable, 50 as namespaces, 117 attribute binding rules, 118 class method, 203 creation of instances, 22, 55, 118 customizing attribute access, 57-58 decorators applied to, 102, 141 defining methods, 21 descriptor attributes, 58, 126 difference from C++ or Java, 119 inheritance, 21, 119 inheriting from built-in types, 22 memory management, 128 mixin, 122 multiple inheritance, 120-121 object base class, 119 old-style, 139 operating overloading, 54 optimization of, 195 optimization of inheritance, 233 performance of __slots__, 196 pickling of, 228 private members, 26 redefining attribute binding, 132 scoping rules within, 118 self parameter of methods, 119 special methods, 54\n\nof Element objects, 576 of Event objects, 440 of deque objects, 262 of dicts, 45 of sets, 46\n\nclear_flags() method, of Context objects,\n\n247\n\nclear_memo() method, of Pickler objects,\n\n228\n\n_clear_type_cache() function, sys module,\n\n233\n\nclearing a dictionary, 45\n\nclearing last exception, 233\n\nClient class, multiprocessing module, 433\n\nclient program, 449\n\nTCP example, 451 UDP example, 486 client_address attribute\n\nof BaseHTTPRequestHandler objects,\n\n509\n\nof BaseRequestHandler objects, 490 clock() function, time module, 191, 405\n\ncloneNode() method, of DOM Node objects,\n\n571\n\nclose() function, os module, 381\n\nclose() method\n\nof Connection objects, 297, 421 of Cursor objects, 298 of FTP objects, 498 of HTMLParser objects, 561 of HTTPConnection objects, 503 of Handler objects, 364\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n648\n\nclose() method\n\nof IOBase objects, 349 of Listener objects, 434 of Pool objects, 424 of Queue objects, 418 of TarFile objects, 320 of TreeBuilder objects, 577 of ZipFile objects, 325 of dbm-style database objects, 310 of dispatcher objects, 456 of files, 159 of generators, 20, 53, 103, 105 of generators and synchronization, 104 of mmap objects, 371 of shelve objects, 311 of socket objects, 478 of urlopen objects, 515\n\nclose_when_done() method, of asynchat\n\nobjects, 452\n\nclosed attribute\n\nof IOBase objects, 349 of files, 161\n\nclosefd attribute, of FileIO objects, 350\n\nclosefd parameter, to open() function, 159\n\nCloseKey() function, winreg module, 408\n\ncloserange() function, os module, 382\n\nclosing() function, contextlib module, 268\n\n__closure__ attribute, of functions, 48, 100\n\nclosures, 98-99\n\nand decorators, 101 and nested functions, 99 and wrappers, 100 speedup over classes, 100\n\ncmath module, 251\n\ncmd module, 588\n\ncmp() function, 203\n\nfilecmp module, 314\n\ncmpfiles() function, filecmp module, 314\n\nco_* attributes, of code objects, 51-52\n\ncode execution, in modules, 143-144\n\ncode migration\n\nPython 2 to 3, 634 practical strategy for, 637\n\ncode module, 585\n\ncode objects, 51\n\nattributes of, 51 creating with compile() function, 115\n\ncode point, Unicode, 28\n\n__code__ attribute, of functions, 48\n\ncode, executing strings, 115\n\nCodecInfo class, codecs module, 277\n\ncodecs module, 167, 277\n\nremoval of compression codecs, 280 use of byte strings, 280\n\ncoded_value attribute, of Morsel objects,\n\n512\n\ncodeop module, 585\n\nCodeType type, 51, 237\n\n__coerce__() method, deprecation of, 134\n\ncoercion of numeric types, 66-67\n\ncollect function, gc module, 179\n\ncollect() function, gc module, 220\n\ncollect_incoming_data() method, of asyn-\n\nchat objects, 452\n\ncollection, definition of, 33\n\ncollections module, 138, 262\n\ncolorsys module, 588\n\ncombinations() function, itertools module,\n\n271\n\ncombine() method, of datetime class, 339\n\ncombining() function, unicodedata module,\n\n294\n\ncommand attribute, of\n\nBaseHTTPRequestHandler objects, 509\n\ncommand line options, 13, 157\n\nPython 3, 633 detecting settings in a program, 230 for interpreter, 173 parsing with optparse, 374\n\ncommands debugger command, pdb mod-\n\nule, 188\n\ncommands module, 331\n\ncomment attribute, of ZipInfo objects, 327\n\nComment() function, xml.etree.ElementTree\n\nmodule, 575\n\ncomments, 6, 26\n\ncommit() method, of Connection objects,\n\n298\n\nF h Lib f L Bdff\n\nConfigParser class, configparser module\n\n649\n\ncommon attribute, of dircmp objects, 315\n\ncompress() method\n\ncommon_dirs attribute, of dircmp objects,\n\n315\n\nof BZ2Compressor objects, 313 of compressobj objects, 328\n\ncommon_files attribute, of dircmp objects,\n\ncompress_size attribute, of ZipInfo objects,\n\n315\n\n327\n\ncommon_funny attribute, of dircmp objects,\n\ncompress_type attribute, of ZipInfo objects,\n\n315\n\n327\n\ncommonprefix() function, os.path module,\n\ncompression\n\n396\n\ncommunicate() method, of Popen objects,\n\nof files, 313, 317 zlib compression, 328\n\n403\n\nCompressionError exception, tarfile module,\n\ncomparison operators, 56\n\n322\n\ncomparison, 66\n\ncompressobj() function, zlib module, 328\n\nPython 3, 633 chained, 66 of incompatible objects, 78 of objects, 34 of sequences, 70 of weak references, 242 compilation into bytecode, 148\n\ncomputed attributes and properties, 124\n\nconcat() function, operator module, 274\n\nconcatenation\n\nof adjacent string literals, 27 of lists, 12 of strings, 11 concurrency, 413\n\ncompile() function, 115, 203 re module, 283-284 compileall module, 585\n\ncompiler, lack of, 181\n\ncomplete_statement() function, sqlite3\n\nmodule, 305\n\nComplex abstract base class, 253\n\ncomplex numbers, 27, 39\n\ncmath library module, 251 comparison of, 66\n\nadvice on multiprocessing, 435 and Python programs, 414 and side effects, 96 coroutines, 446 global interpreter lock, 414 limitations on multicore, 414 message passing, 413-415 multitasking with generators, 447 scaling issues, 415 synchronization problems, 414\n\ncomplex type, 38\n\nconcurrent programming, 413\n\ncomplex() function, 76, 203\n\nCondition object\n\n__complex__() method, 61-62 and type coercion, 134 composing email messages, 555\n\nmultiprocessing module, 427 threading module, 441\n\ncondition debugger command, pdb module,\n\ncomposite string formatting, 8, 42, 72\n\n188\n\nand __format__(), 56 and lookups, 42 compress() function bz2 module, 314 zlib module, 328\n\ncondition variable, 441\n\nCondition() method, of Manager objects,\n\n429\n\nconditional expressions, 79\n\nconditionals, 9, 81\n\nConfigParser class, configparser module,\n\n332\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n650\n\nconfigparser module\n\nconfigparser module, 332\n\nconfiguration files, 332\n\ndifference from Python script, 334-335 for logging module, 368 variable substitution, 335 confstr() function, os module, 395\n\nconjugate() method\n\nof complex numbers, 39 of floating point, 39\n\nconnect() function\n\ndatabase API, 297 sqlite3 module, 304\n\nconnect() method\n\nof BaseManager objects, 431 of FTP objects, 498 of HTTPConnection objects, 503 of SMTP objects, 514 of dispatcher objects, 456 of socket objects, 478\n\nconnect_ex() method, of socket objects,\n\n478\n\nconnecting processes, multiprocessing\n\nmodule, 433\n\nConnection class\n\ndatabase API, 297 sqlite3 module, 305\n\nConnectRegistry() function, winreg module,\n\n408\n\nconsole window, Windows, 176\n\nContainer abstract base class, 265\n\ncontainer objects, 29\n\nand reference counting, 34 definition of, 33\n\ncontainment test, in operator, 9\n\ncontains() function, operator module, 274\n\n__contains__() method, 58\n\nContentHandler class, xml.sax module, 581\n\nContentTooShort exception, urllib.error\n\nmodule, 523\n\nContext class, decimal module, 244\n\ncontext management protocol, 62\n\ncontext managers, 62, 89 decimal module, 248 defining with generator, 267\n\nlocking, 442 nested, 267\n\n__context__ attribute, of Exception objects,\n\n213, 627\n\ncontextlib module, 90, 267\n\n@contextmanager decorator, 90\n\ncontinue statement, 83-84\n\ncontrol characters, stripping from a string,\n\n42\n\nconversion of strings to numbers, 11\n\nconversion operations, 76\n\nconvert_field() method, of Formatter\n\nobjects, 289\n\nconverting Python types to C, 611\n\nconverting dictionaries to a list, 16\n\nconverting sequences to a list, 77\n\nconverting sequences to a set, 15\n\nconverting sequences to a tuple, 77\n\nconverting types from C to Python, 602\n\nconverting types from Python to C, 597\n\nCookie module, see http.cookies, 511\n\nCookieError exception, http.cookies mod-\n\nule, 513\n\nCookieJar class, http.cookiejar module, 513\n\ncookielib module, see http.cookiejar, 513\n\ncookies\n\nHTTP, 511 fetching URLs with cookie support,\n\n519\n\ncopy module, 36, 67, 219 limitations of, 220\n\ncopy() function\n\ncopy module, 219 shutil module, 318\n\ncopy() method\n\nof Context objects, 247 of dicts, 45 of digest objects, 559 of hmac objects, 560 of sets, 46\n\ncopy2() function, shutil module, 318\n\n__copy__() method, 220\n\ncopy_reg module, 585\n\nF h Lib f L Bdff\n\ncreating custom string formatters\n\n651\n\ncopyfile() function, shutil module, 318\n\ncounting, in loops, 83\n\ncopyfileobj() function, shutil module, 318\n\ncountOf() function, operator module, 274\n\ncopying directories, 318\n\ncp1252 encoding, description of, 169\n\ncopying files, 318\n\ncp437 encoding, description of, 169\n\ncopying\n\ncPickle module, 229\n\nand reference counting, 35 deep copy, 36 dictionary, 45 of mutable objects, 35 shallow copy, 36\n\ncProfile module, 190\n\nCPU time, obtaining, 191, 405\n\nCPU, obtaining number on system, 434\n\nCPU-bound tasks and threads, 444\n\ncpu_count() function, multiprocessing mod-\n\ncopymode() function, shutil module, 318\n\nule, 434\n\ncopyright variable, sys module, 230\n\nCRC attribute, of ZipInfo objects, 327\n\ncopysign() function, math module, 251\n\ncrc32() function\n\ncopystat() function, shutil module, 318\n\ncopytree() function, shutil module, 318\n\nbinascii module, 548 zlib module, 328\n\n@coroutine decorator example, 105\n\ncrc_hqx() function, binascii module, 548\n\ncoroutines, 20, 104\n\ncreate_aggregate() method, of Connection\n\nadvanced example, 460 asynchronous I/O handling, 460 building a call stack of, 463 concurrency, 108 concurrent programming, 446 example of, 20 execution behavior, 105 message passing, 108, 415 multitasking example, 447 practical use of, 107 recursion, 112 sending and returning values, 106 task scheduler with select(), 460 transferring control to another corou-\n\nobjects, 305\n\ncreate_collation() method, of Connection\n\nobjects, 306\n\ncreate_connection() function, socket mod-\n\nule, 473\n\ncreate_decimal() method, of Context\n\nobjects, 247\n\ncreate_function() method, of Connection\n\nobjects, 305\n\ncreate_socket() method, of dispatcher\n\nobjects, 456\n\ncreate_string_buffer() function, ctypes mod-\n\nule, 617\n\ncreate_system attribute, of ZipInfo objects,\n\ntine, 463\n\nuse of next() method, 104 use with network programming, 467\n\ncos() function, math module, 251\n\n327\n\ncreate_unicode_buffer() function, ctypes\n\nmodule, 617\n\ncreate_version attribute, of ZipInfo objects,\n\n327\n\ncosh() function, math module, 251\n\ncreated attribute, of Record objects, 359\n\ncount() function, itertools module, 271\n\nCreateKey() function, winreg module, 408\n\ncount() method\n\ncreating a Windows installer, 153\n\nof array objects, 260 of lists, 40 of strings, 42\n\ncreating a binary distribution, 153\n\ncreating a source distribution, 153\n\ncreating custom string formatters, 288\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n652\n\ncreating programs\n\ncreating programs, 6\n\ncreating random numbers, 254\n\ncreating user-defined instances, 22\n\ncreation of instances, 118 steps involved, 129\n\ncreation of .pyc and .pyo files, 148\n\ncritical sections, locking of, 414\n\ncritical() method, of Logger objects, 357\n\ncrypt module, 586\n\ncrytographic hashing functions, 559\n\nCSV data, example of reading, 14\n\nCSV files\n\nparsing, 548 type conversion of columns, 37\n\ncsv module, 548\n\nctermid() function, os module, 379\n\nctime() function, time module, 405\n\nctime() method, of date objects, 337\n\nCtrl-C, keyboard interrupt, 162\n\nctypes module, 612 array types, 614 available datatypes, 614 casting datatypes, 617 creating byte strings, 617 creating objects from buffers, 616 example of, 618 finding library modules, 612 loading shared libraries, 612 memory copying, 617 passing pointers and references, 615 pointer types, 614 setting function prototypes, 613 shared data with multiprocessing, 426 structure types, 615\n\ncunifvariate() function, random module,\n\n255\n\ncurdir variable, os module, 386\n\ncurly braces, and dictionary, 16\n\ncurrent time, obtaining, 405\n\n_current_frames() function, sys module,\n\n233\n\ncurrent_process() function, multiprocessing\n\nmodule, 434\n\ncurrent_thread() function, threading mod-\n\nule, 443\n\ncurrentframe() function, inspect module,\n\n222\n\ncurrying, and partial function evaluation,\n\n76\n\ncurses module, 586\n\nCursor class, database API, 298\n\ncursor() method, of Connection objects,\n\n298\n\ncwd() method, of FTP objects, 498\n\ncycle() function, itertools module, 271\n\ncycles, and garbage collection, 35\n\ncyclic data structures, and __del__()\n\nmethod, 129\n\nD\n\nd(own) debugger command, pdb module,\n\n188\n\ndaemon attribute\n\nof Process objects, 416 of Thread objects, 436\n\ndaemonic process, 415\n\ndaemonic thread, 436\n\ndangling comma\n\nand print statement, 10 and tuples, 14 print statement, 162\n\ndata attribute, of DOM Text objects, 572\n\ndata encapsulation, 127\n\ndata structures\n\nand dictionaries, 16 lists and tuples, 14 named tuples, 264\n\ndata() method, of TreeBuilder objects, 577\n\ndata-flow processing, and coroutines, 107\n\ndatabase API, 297\n\ndatabase interface, 297 and threads, 302\n\ndatabase results, converting into dictionar-\n\nies, 303\n\nF h Lib f L Bdff\n\ndecorators\n\n653\n\ndatabase\n\nentire programs from command shell,\n\nand CGI script, 538 persistent dictionary, 171\n\nDatabaseError exception, database API,\n\n302\n\ndatabases, DBM-style, 310\n\nDataError exception, database API, 302\n\n189\n\nmanually setting a breakpoint, 186 pdb module, 186 running a function, 186 specifying a breakpoint, 187 use of logging module, 355 Decimal class, decimal module, 243\n\nDatagramHandler class, logging module,\n\n362\n\nDecimal object, converting to a fraction,\n\nDatagramRequestHandler class, SocketServer module, 491\n\n250\n\ndecimal module, 39, 243\n\ndatagrams, 470\n\ndate and time manipulation, 336\n\ndate class, datetime module, 336\n\nand sum() function, 69 and threads, 249 rounding behavior, 245\n\ndate parsing, 343, 407\n\nDate() function, database API, 301\n\ndate() method, of datetime objects, 340\n\ndate_time attribute, of ZipInfo objects, 327\n\nDateFromTicks() function, database API,\n\n301\n\ndecimal() function, unicodedata module,\n\n295\n\ndeclarative programming, 110\n\ndecode() function\n\nbase64 module, 547 quopri module, 568\n\ndatetime class, datetime module, 339\n\ndatetime module, 336\n\nDateTime() function, xmlrpc.client module,\n\n526\n\nday attribute, of date objects, 337\n\ndaylight variable, time module, 405\n\ndbhash module, 310\n\ndbm module, 310\n\nDBM-style databases, 310\n\ndecode() method\n\nin Python 3, 629 of CodecInfo objects, 277 of IncrementalDecoder objects, 279 of JSONDecoder objects, 565 of strings, 29, 42, 165-166 proper use of, 166 decodestring() function base64 module, 547 quopri module, 568\n\ndeadlock, source with locking, 442\n\ndecomposition() function, unicodedata\n\ndebug attribute\n\nmodule, 295\n\nof TarFile objects, 320 of ZipFile objects, 325 of sys.flags, 230\n\n__debug__ variable, 91, 369\n\ndecompress() function\n\nbz2 module, 314 zlib module, 328 decompress() method\n\ndebug() method, of Logger objects, 357\n\ndebugging\n\nof BZ2Decompressor objects, 314 of decompressobj objects, 328\n\nCGI scripts, 539 after an uncaught exception, 186 checking for memory leaks, 221 configuring the debugger, 190\n\ndecompressobj() function, zlib module, 328\n\ndecorators, 22, 101\n\napplied to class definitions, 102, 141 copying function attributes, 269\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n654\n\ndecorators\n\ndocumentation strings, 102, 113 example of, 101 multiple, 31 performance benefits, 197 placement of, 30, 101 recursive functions, 102, 113 user-defined function attributes, 102,\n\n114\n\nwith arguments, 102\n\ndeep copy, 36\n\ndeepcopy() function, copy module, 219\n\n__deepcopy__() method, 220\n\ndef statement, 18, 48, 93\n\ndefault Unicode encoding, 166, 177\n\ndefault Unicode error handling policy, 167\n\ndefault arguments, 18, 93 and mutable values, 94 binding of values, 93\n\ndefault() method, of JSONEncoder objects,\n\n566\n\ndefault_factory attribute, of defaultdict\n\nobjects, 263\n\nDefaultContext variable, decimal module,\n\n248\n\ndefaultdict() function, collections module,\n\n263\n\n__defaults__ attribute, of functions, 48\n\ndefaults() method, of ConfigParser objects,\n\n333\n\ndefects attribute, of Message objects, 554\n\ndefining functions, 18\n\ndefining multiple instance creation meth-\n\nods, 123\n\ndefining new exceptions, 88\n\ndegrees() function, math module, 251\n\ndel operator, on dictionaries, 16, 74\n\ndel statement, 35, 69\n\nand __del__() method, 129 and slices, 40 deleting mapping items, 45\n\n__del__() method, 55, 129\n\nand program termination, 179 danger of defining, 129\n\ngarbage collection, 129, 221-222 uses of, 55\n\ndel_param() method, of Message objects,\n\n556\n\ndelattr() function, 203\n\nand private attributes, 128 __delattr__() method, 57-58, 131\n\ndelayed evaluation, 99\n\ndelayed execution, using threads, 437\n\ndelete() method, of FTP objects, 498\n\n__delete__() method, of descriptors, 58,\n\n126\n\nDeleteKey() function, winreg module, 409\n\n@deleter decorator of properties, 126\n\nDeleteValue() function, winreg module, 409\n\ndeleting items from a dictionary, 16\n\ndeleting sequence items, 40\n\ndeleting slices, 40, 69\n\ndeletion of instance attributes, 131\n\ndelimiters, 30\n\ndelitem() function, operator module, 274\n\n__delitem__() method, 58-59\n\nand slices, 59\n\ndelslice() function, operator module, 274\n\ndemo_app() function, wsgiref.simple_server\n\nmodule, 542\n\ndenominator attribute\n\nof Fraction objects, 250 of integers, 39\n\nDeprecationWarning warning, 216, 238\n\ndeque object\n\ncollections module, 194 versus list, 194\n\ndeque() function, collections module, 262\n\nDER_cert_to_PEM_cert() function, ssl mod-\n\nule, 488\n\ndereference attribute, of TarFile objects,\n\n320\n\nderived class, 119\n\ndescription attribute, of Cursor objects, 299\n\ndescriptors, 58, 126\n\nand metaclasses, 140\n\ndetecting end of file (EOF), 160\n\nF h Lib f L Bdff\n\ndirectories\n\n655\n\ndetecting the settings of interpreter com-\n\nmand line options, 230\n\ndevnull variable, os module, 386\n\nDialect class, csv module, 551\n\ndict type, 38\n\n__dict__ attribute of classes, 131 of functions, 48, 114 of instances, 50, 131 of modules, 51, 144 of types, 50 of user-defined objects, 63\n\nobtaining keys, 45-46 obtaining values, 45 performance of, 16 performance of in operator, 197 persistent with shelve module, 171 removing items, 16 shared by multiple processes, 429 tuples as keys, 74 updating, 45 use as a data structure, 16 use as a lookup table, 16 using functions as values, 37 using to pass keyword function argu-\n\ndict() function, 16, 77, 204\n\nperformance properties, 195\n\ndict() method, of Manager objects, 429\n\nments, 95\n\nview objects in Python 3, 632 DictReader() function, csv module, 550\n\ndictionary comprehension, Python 3, 623\n\ndictionary, 16, 44\n\nacceptable key types, 16 accessing items, 16 and Python 3 caution, 45 and __hash__() method, 56 and string formatting, 70, 72 automatic creation of initial values, 263 clearing, 45 compared to defaultdict objects, 263 converting to a list, 16 copying, 45 creating from database results, 303 creation with dict() function, 204 defining empty, 16 deleting items, 16, 45 equality of, 78 indexing operator, 74 inserting items, 16 item assignment, 74 item deletion, 74 iterating over keys, 17 key values, 44, 74 list of items, 45 lookup in composite string formatting,\n\ndicts, versus classes for storing data, 195\n\nDictWriter() function, csv module, 550\n\ndiff_files attribute, of dircmp objects, 315\n\ndifference operator -, of sets, 15\n\ndifference() method, of sets, 46\n\ndifference_update() method, of sets, 46\n\ndifflib module, 586\n\ndig attribute, of sys.float_info, 231\n\ndigest() method\n\nof digest objects, 559 of hmac objects, 560\n\ndigest_size attribute, of digest objects, 559\n\ndigit() function, unicodedata module, 295\n\ndigits variable, string module, 287\n\ndir() function, 21, 24, 204\n\nhiding attribute names in classes, 128,\n\n204\n\ndir() method, of FTP objects, 498\n\n__dir__() method, 63, 128, 204\n\ndircmp() function, filecmp module, 314\n\ndirectories\n\n42, 72\n\nlookup with default value, 16\n\ncomparing, 314 copying, 318 reading files with shell wildcards, 317 recursive traversal, 390\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n656\n\ndirectories\n\nsystem functions for accessing, 386 temporary, 323 testing filenames for, 397\n\ndirname() function, os.path module, 396\n\ndis module, 585\n\ndis(), dis module, 193\n\ndisable debugger command, pdb module,\n\n188\n\ndisable() function\n\ngc module, 220 logging module, 366\n\ndisable_interspersed_args() method, of\n\nOptionParser objects, 376\n\ndisabling garbage collection, 220\n\ndisabling newline translation, 159\n\ndisassembly, 193\n\ndiscard() method, of sets, 47\n\ndiscard_buffers() method, of asynchat\n\nobjects, 452\n\ndispatcher class, asyncore module, 455\n\n__displayhook__ variable, sys module, 230\n\ndisplayhook() function, sys module, 176,\n\n233\n\ndisposition attribute, of FieldStorage\n\nobjects, 535\n\ndisposition_options attribute, of\n\nFieldStorage objects, 535\n\ndistributed computing, and multiprocessing\n\nmodule, 435\n\ndistributing programs, 152\n\ndistutils module, 152-153, 585, 596 and extension modules, 596 creating binary distributions, 153 creating extensions with SWIG, 620\n\ndiv() function, operator module, 273\n\n__div__() method, 60\n\ndivision of integers, Python 3, 633\n\ndivision operator /, 65\n\ndivision operator, Python 2 versus Python\n\n3, 61\n\ndivision, truncation of integers, 61-62, 65\n\ndivision_new attribute, of sys.flags, 230\n\ndivision_warning attribute, of sys.flags, 230\n\ndivmod() function, 66, 204\n\n__divmod__() method, 60\n\ndllhandle variable, sys module, 230\n\nDLLs\n\ncreating with distutils, 596 extension modules, 148 loading with ctypes, 612\n\ndo_handshake() method, of ssl objects,\n\n487\n\n__doc__ attribute\n\nof built-in functions, 49 of functions, 24, 48, 113 of methods, 49 of modules, 51 of objects, 30 of types, 50\n\nDocCGIXMLRPCRequestHandler class, xmlr-\n\npc.server module, 528\n\ndoctest module, 181-182\n\nverbose option, 182\n\nDocument class, xml.dom.minidom mod-\n\nule, 571\n\ndocumentation string, copying to decorator,\n\n269\n\ndocumentation strings, 24, 30, 48, 113\n\nand XML-RPC, 527 and decorators, 102, 113 and indentation, 30 doctest module, 181 in extension modules, 595 stripping with -OO option, 148 testing, 181\n\ndocumentElement attribute, of DOM\n\nDocument objects, 571\n\nDocXMLRPCServer class, xmlrpc.server\n\nmodule, 527\n\nDocXMLRPCServer module, 527\n\ndollar-variable substitution, 163\n\nDOM interface\n\nXML parsing, 568 example of, 573\n\ndont_write_bytecode attribute, of sys.flags,\n\n230\n\ndont_write_bytecode variable, sys module,\n\n230\n\nF h Lib f L Bdff\n\nenable() function\n\n657\n\ndouble precision floating point, 38\n\nElement() function, xml.etree.ElementTree\n\ndouble-clicking on .py files, 6\n\nmodule, 575\n\ndouble-underscores, use in identifiers, 26\n\ndropwhile() function, itertools module, 271\n\ndst() method\n\nof time objects, 338 of tzinfo objects, 342\n\nElementTree class, xml.etree.ElementTree\n\nmodule, 573\n\nElementTree interface, XML parsing, 569\n\nElementTree, examples of, 578\n\nelif statement, 9, 81\n\nduck typing, 122\n\nEllipsis, 30, 51, 54\n\ndumbdbm module, 310\n\ndump() function\n\njson module, 564 marshal module, 226 pickle module, 171, 227 xml.etree.ElementTree module, 578 dump() method, of Pickler objects, 228\n\nexpression in Python 3, 626 type of, 51 use in extended slicing, 59 use in indexing methods, 54\n\nelse clause\n\nof try statement, 86 of while and for loops, 84\n\ndumps() function\n\njson module, 564 marshal module, 226 pickle module, 227 xmlrpc.client module, 526 dup() function, os module, 382\n\ndup2() function, os module, 382\n\nelse statement, 9, 81\n\nemail messages\n\ncomposing, 555 example of composing and sending,\n\n558\n\nexample of sending, 514 parsing, 552 email package, 552\n\ndynamic binding, of object attributes, 122\n\nEmax attribute, of Context objects, 247\n\ndynamic loading, of modules, 144\n\nembedding Unicode characters in web\n\ndynamic scope, lack of, 97\n\npages, 167\n\ndynamic typing of variables, 7\n\nembedding the interpreter in C programs,\n\n591, 608\n\nE\n\nE command line option, 173\n\ne variable, math module, 252\n\nembedding\n\ncalling functions from C, 610 converting Python types to C, 611 Emin attribute, of Context objects, 247\n\nEAI_* constants, socket module, 485\n\nEmpty exception, Queue module, 418, 445\n\neast_asian_width() function, unicodedata\n\nmodule, 296\n\neasy_install command, setuptools package,\n\n155\n\n.egg files, 154\n\nand modules, 147 and site configuration, 177 structure of, 147\n\nElement class, xml.dom.minidom module,\n\n572\n\nempty dictionary, 16\n\nempty list, 12\n\nempty() method, of Queue objects, 418,\n\n445\n\nenable debugger command, pdb module,\n\n188\n\nenable() function\n\ncgitb module, 539 gc module, 220\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "page_number": 659
    },
    {
      "number": 33,
      "title": "Segment 33 (pages 682-699)",
      "start_page": 682,
      "end_page": 699,
      "detection_method": "synthetic",
      "content": "658\n\nenable_callback_tracebacks() function, sqlite3 module\n\nenable_callback_tracebacks() function,\n\nendpos attribute, of MatchObject objects,\n\nsqlite3 module, 305\n\n286\n\nenable_interspersed_args() method, of\n\nOptionParser objects, 376\n\nendPrefixMapping() method, of ContentHandler objects, 581\n\nenabling the print() function in Python 2.6,\n\nendswith() method, of strings, 42\n\n163\n\n__enter__() method, of context managers,\n\nencapsulation, 127\n\n62, 89\n\nencode() function\n\nbase64 module, 547 quopri module, 568\n\nenumerate() function, 83, 204 threading module, 443\n\nEnumKey() function, winreg module, 409\n\nencode() method\n\nEnumValue() function, winreg module, 409\n\nin Python 3, 629 of CodecInfo objects, 277 of IncrementalEncoder objects, 278 of JSONEncoder objects, 566 of strings, 42, 165-166 proper use of, 166\n\nEncodedFile class, codecs module, 279\n\nEncodedFile object, codecs module, 167\n\nencodestring() function base64 module, 547 quopri module, 568\n\nenviron variable, os module, 158\n\nenviron variable, os module, 379\n\nenvironment variables, 158, 379\n\nPython 3, 633 WSGI, 540 expanding in filenames, 397 in CGI script, 533 unsetting, 381 used by interpreter, 174\n\nEnvironmentError exception, 87, 212\n\nEOF character, interactive mode, 7\n\nencoding argument to open() function, 159\n\nEOF indication, file I/O, 160\n\nencoding attribute\n\nEOFError exception, 87, 213\n\nof TextIOWrapper objects, 353 of files, 161\n\nepilogue attribute, of Message objects, 554\n\nepoll interface, Linux, 460\n\nencoding issues with network program-\n\nming, 452\n\nepsilon attribute, of sys.float_info, 231\n\nencoding, of source code, 31\n\neq() function, operator module, 274\n\nend attribute, of slices, 54\n\n__eq__() method, 57\n\nend keyword argument, to print() function,\n\nequal to operator ==, 66, 78\n\n163\n\nequality comparison of objects, 34\n\nend() method\n\nerrcheck attribute, of ctypes function\n\nof MatchObject objects, 286 of TreeBuilder objects, 577\n\nobjects, 613\n\nerrno module, 343\n\nend_headers() method, of\n\nerror codes, list of system errors, 344\n\nBaseHTTPRequestHandler objects, 509\n\nerror exception, 396\n\nendDocument() method, of ContentHandler\n\nsocket module, 485\n\nobjects, 581\n\nerror messages, 157\n\nendElement() method, of ContentHandler\n\nerror() method, of Logger objects, 357\n\nobjects, 581\n\nerror_message_format attribute, of\n\nendElementNS() method, of\n\nBaseHTTPRequestHandler class, 508\n\nContentHandler objects, 581\n\nerrorcode variable, errno module, 344\n\nendheaders() method, of HTTPConnection\n\nobjects, 503\n\nerrorlevel attribute, of TarFile objects, 320\n\nF h Lib f L Bdff\n\nexecutemany() method\n\n659\n\nerrors attribute, of TextIOWrapper objects,\n\nException exception, 87\n\n353\n\nexception handling, in extension modules,\n\nerrors parameter\n\n605\n\nof encoding functions, 166 to open() function, 159\n\nescape codes\n\ndisabling in a string literal, 29 in string literals, 27 non-printing characters, 28\n\nescape() function\n\ncgi module, 536 re module, 283 xml.sax.saxutils module, 583\n\nescaping characters for use in HTML, 536\n\neval() function, 55, 77, 115, 204, 206\n\nand repr(), 55\n\nevaluation\n\nof function arguments, 76 operator precedence and associativity,\n\n78\n\norder of, 78\n\nEvent object\n\nmultiprocessing module, 427 threading module, 440\n\nexception() method, of Logger objects, 358\n\nexceptions, 22, 84-85 and locks, 23 attributes of, 212 catching all, 85 catching multiple types, 85 caution with catching all exceptions, 86 chained in Python 3, 626 clearing last exception, 233 defining new, 88 difference from warnings, 216 error codes for system errors, 344 finally statement, 86 handling of, 22-23 hierarchy of, 88 ignoring, 85 list of built-in, 87 matching rules, 85 optimization strategies, 196 performance of, 197 propagation of, 85 reraising the last exception, 84 value of, 23, 85\n\nevent loop\n\nand asyncore module, 455 coroutines, 108\n\n.exe file, creating with distutils, 153\n\nEvent() method, of Manager objects, 429\n\nexec statement, caution with legacy code,\n\nevent-driven I/O, 415\n\n115\n\npolling for signals, 399 when to consider, 467 EX_* exit code constants, 391\n\nexec() function, 115, 204\n\nPython 3, 631\n\nexec_prefix variable, sys module, 177, 230\n\nexc_clear() function, sys module, 233\n\nexecl() function, os module, 390\n\nexc_info attribute, of Record objects, 359\n\nexecle() function, os module, 390\n\nexc_info() function, sys module, 53, 89,\n\nexeclp() function, os module, 390\n\n233\n\nexecutable variable, sys module, 230\n\nexcept statement, 22, 84-85 change of syntax, 85\n\n__excepthook__ variable, sys module, 230\n\nexecute() method\n\nof Connection objects, 306 of Cursor objects, 298\n\nexcepthook() function, sys module, 85, 233\n\nexecutemany() method\n\nException class, 212\n\nof Connection objects, 306 of Cursor objects, 298\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n660\n\nexecutescript() method, of Connection objects\n\nexecutescript() method, of Connection\n\nextended slicing operator [::], 67\n\nobjects, 306\n\nextended unpacking of iterables, Python 3,\n\nexecuting programs, 6\n\n623\n\nexecuting strings as code, 115\n\nExtendedContext, decimal module, 248\n\nexecuting system commands, 331\n\nextending with C, 591\n\npopen() function, 392 subprocess module, 402 system() function, 393\n\nextendleft() method, of deque objects, 262\n\nextensible code, with modules, 144\n\nextension modules, 591\n\nexecution model, 81\n\nexecution of __init__.py files, 150\n\ncompilation with distutils, 596 converting types from C to Python,\n\nexecution of class bodies, 117, 138\n\n602\n\nexecv() function, os module, 390\n\nexecve() function, os module, 391\n\nexecvp() function, os module, 391\n\nexecvpe() function, os module, 391\n\nexists() function, os.path module, 396\n\n_exit() function, os module, 179, 391\n\nexit() function, sys module, 179, 233\n\n__exit__() method, 63\n\nof context managers, 62, 89\n\nexitcode attribute, of Process objects, 417\n\nexp() function, math module, 251\n\nconverting types from Python to C,\n\n597\n\nctypes module, 612 difference in Python 3, 595 documentation strings, 595 exception handling, 605 global interpreter lock, 607 hand-written, 593 manual compilation, 597 naming of, 595 reference counting, 607 threads, 607 wrapper functions, 594\n\nexp() method, of Decimal objects, 243\n\nexpand() method, of MatchObject objects,\n\nExtension() function, distutils module, 596\n\n285\n\nextensions_map attribute, of\n\nExpandEnvironmentStrings() function, win-\n\nHTTPRequestHandler class, 508\n\nreg module, 409\n\nexternal_attr attribute, of ZipInfo objects,\n\nexpandtabs() method, of strings, 41-42\n\n327\n\nexpanduser() function, os.path module, 397\n\nextra attribute, of ZipInfo objects, 327\n\nexpandvars() function, os.path module, 397\n\nexponents, range on floating point, 38\n\nextract() method\n\nof TarFile objects, 320 of ZipFile objects, 325\n\nexpovariate() function, random module,\n\n255\n\nexpressions, 7\n\nextend() method\n\nextract_stack() function, traceback module,\n\n236\n\nextract_tb() function, traceback module,\n\n236\n\nof array objects, 260 of deque objects, 262 of lists, 40\n\nextract_version attribute, of ZipInfo objects,\n\n327\n\nextractall() method, of ZipFile objects, 325\n\nextended slices, 39, 59\n\nExtractError exception, tarfile module, 322\n\nassignment to, 40, 69 deletion of, 40, 69 on sequences, 68\n\nextractfile() method, of TarFile objects, 320\n\nextsep variable, os module, 386\n\nF h Lib f L Bdff\n\nfilenames\n\n661\n\nF\n\nFieldStorage() function, cgi module, 534\n\nF_* constants, fcntl() function, 347\n\nf_* attributes\n\nof frame objects, 52 of statvfs objects, 389\n\nfabs() function, math module, 251\n\nfile I/O, 10\n\nfile attribute, of FieldStorage objects, 535\n\nfile descriptors, 347\n\nfunctions for manipulation, 382 file keyword argument, to print() function,\n\n10, 163\n\nfactorial() function, math module, 251\n\nfile locking, 348\n\nfail() method, of TestCase objects, 185\n\nfailIf() method, of TestCase objects, 185\n\nWindows, 373 by sqlite3 module, 303\n\nfailIfAlmostEqual() method, of TestCase\n\nobjects, 185\n\nfailIfEqual() method, of TestCase objects,\n\n185\n\nfile modes, use with open() function, 159\n\nfile upload, in CGI scripts, 536\n\n__file__ attribute, of modules, 51\n\nfailUnless() method, of TestCase objects,\n\nfile-like objects, 122\n\n185\n\nfile_offset attribute, of ZipInfo objects, 327\n\nfailUnlessAlmostEqual() method, of\n\nfile_size attribute, of ZipInfo objects, 327\n\nTestCase objects, 185\n\nfilecmp module, 314\n\nfailUnlessEqual() method, of TestCase\n\nfileConfig() function, logging module, 367\n\nobjects, 185\n\nFileCookieJar class, http.cookiejar module,\n\nfailUnlessRaises() method, of TestCase\n\n513\n\nobjects, 185\n\nFileHandler class\n\nfailureException attribute, of TestCase\n\nobjects, 185\n\nlogging module, 362 urllib.request module, 518\n\nFalse value, 9, 27, 38\n\nfamily attribute, of socket objects, 484\n\nFault exception, xmlrpc.client module, 527\n\nfchdir() function, os module, 379\n\nfchmod() function, os module, 382\n\nFileIO class, io module, 350\n\nfilename attribute\n\nof FieldStorage objects, 535 of Record objects, 359 of ZipInfo objects, 327\n\nfchown() function, os module, 382\n\nfilenames\n\nfcntl module, 347\n\nfcntl() function, fcntl module, 347\n\nfdatasync() function, os module, 382\n\nfdopen() function, os module, 382\n\nfeed() method, of HTMLParser objects, 561\n\nWindows drive letters, 399 absolute path of, 396 in Python 3, 633 matching with shell wildcards, 316 portable manipulation of, 396 splitting into directory and base name,\n\nfetchall() method, of Cursor objects, 299\n\nfetching URLs\n\nexample of, 514 example with authentication, 519 example with cookies, 519\n\n398\n\ntesting for existence, 396 testing if directory, 397 testing if link, 397\n\nfetchmany() method, of Cursor objects, 299\n\nfetchone() method, of Cursor objects, 298\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n662\n\nfileno() method\n\nfileno() method\n\nof Connection objects, 421 of IOBase objects, 349 of SocketServer objects, 491 of files, 160-161 of files and sockets, 459 of socket objects, 478 of urlopen objects, 515\n\nfiles, 10\n\nabsolute path of, 396 and Python 3, 160 attributes of, 161 buffer size, 159 buffered binary I/O, 351 bz2 compression, 313 comparing, 314 copying, 318 creation time, 397 decoding as Unicode, 167 description of file modes, 159 detecting end of file (EOF), 160 file pointer, 161, 352 finding on the filesystem, 390 functions for manipulating metadata,\n\n386\n\ngzip compression, 317 iterating over lines, 17-18 last modification time, 397 locking on Windows, 373 low-level control, 347 low-level system calls, 382 memory mapped, 370 methods on, 159 opening, 10, 158-159 opening with Unicode decoding, 167 parsing CSV, 548 problems with io library module, 354 raw binary I/O, 350 reading line by line, 10 seeking, 161 size of, 397 softspace attribute and print statement,\n\n162\n\ntemporary, 323 testing for existence, 396\n\ntypes of, 159 writing to, 159\n\nfill characters in string format specifiers,\n\n73\n\nFilter class, logging module, 359\n\nfilter() function, 205\n\nand Python 3, 205 and optimization, 197 fnmatch module, 316 future_builtins module, 217\n\nfilterwarnings() function, warnings module,\n\n239\n\nfinally statement, 86 and locks, 442\n\nfind() method\n\nof Element objects, 576 of ElementTree objects, 574 of mmap objects, 371 of strings, 41-42\n\nfind_library() function, ctypes module, 612\n\nfindall() function, re module, 283\n\nfindall() method\n\nof Element objects, 576 of ElementTree objects, 574 of Regex objects, 285\n\nfindCaller() method, of Logger objects, 358\n\nfinding all loaded modules, 144\n\nfinding files, 390\n\nfinditer() function, re module, 284\n\nfinditer() method, of Regex objects, 285\n\nfindtext() method\n\nof Element objects, 576 of ElementTree objects, 574\n\nfinish() method, of BaseRequestHandler\n\nobjects, 490\n\nfirst-class objects, 36\n\nuse of, 37\n\nfirstChild attribute, of DOM Node objects,\n\n570\n\nflag_bits attribute, of ZipInfo objects, 327\n\nflags attribute\n\nof Context objects, 247 of Regex objects, 284 flags variable, sys module, 230\n\nF h Lib f L Bdff\n\nformat_stack() function, traceback module\n\n663\n\nflaming death, in extension modules, 595\n\nfor statement, 10, 17, 59, 69, 82\n\nfloat type, 38\n\nfloat() function, 13, 62, 76, 205\n\n__float__() method, 61-62 and type coercion, 134\n\nand files, 10, 160 and generators, 19 and tuple unpacking, 15 forcing garbage collection, 220\n\nfloat_info variable, sys module, 231\n\nforeign function interface, ctypes module,\n\nfloating point, 27\n\n612\n\nas dictionary key, 16 binary representation, 39 compared to decimal numbers, 243 converting to a fraction, 39, 250 defining NaN and Inf, 213, 252 inexact representation, 12, 243 low-level properties of, 231 mixing with complex numbers, 39 precision of, 38 random number distributions, 255 representation of, 38\n\nFloatingPointError exception, 87, 213\n\nfork() function, os module, 391\n\nForkingMixIn class, SocketServer module,\n\n493\n\nForkingTCPServer class, SocketServer mod-\n\nule, 494\n\nForkingUDPServer class, SocketServer mod-\n\nule, 494\n\nforkpty() function, os module, 392\n\nformat attribute, of Struct objects, 291\n\nformat codes\n\nfor dates and times, 406 for string formatting operator %, 70-71\n\nflock() function, fcntl module, 348\n\nfloor division, 65\n\nfloor() function, math module, 251\n\nfloordiv() function, operator module, 273\n\n__floordiv__() method, 60\n\nformat specifiers\n\nalignment characters, 73 customized, 74 fill character, 73 format() method of strings, 72-74 nesting of fields, 74\n\nflush() method\n\nformat() function, 8, 11-12, 56, 77, 205\n\nof BZ2Compressor objects, 314 of BufferWriter objects, 352 of Handler objects, 364 of IOBase objects, 349 of compressobj objects, 328 of decompressobj objects, 329 of files, 160 of mmap objects, 371\n\nformat() method\n\nformat specifier codes, 72 of Formatter objects, 288 of strings, 8, 42-43, 56, 72-73, 162 of strings and variable interpolation,\n\n164\n\n__format__() method, 55-56, 74\n\nformat_exc() function, traceback module,\n\nFlushKey() function, winreg module, 409\n\n236\n\nfma() method, of Decimal objects, 243\n\nformat_exception() function, traceback\n\nfmod() function, math module, 251\n\nmodule, 236\n\nfnmatch module, 316\n\nfnmatch() function, fnmatch module, 316\n\nfnmatchcase() function, fnmatch module,\n\n316\n\nfoot, how to shoot, 36, 86, 442, 617\n\nformat_exception_only() function, traceback\n\nmodule, 236\n\nformat_list() function, traceback module,\n\n236\n\nformat_stack() function, traceback module,\n\n236\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n664\n\nformat_tb() function, traceback module\n\nformat_tb() function, traceback module,\n\n236\n\nformat_value() method, of Formatter\n\nobjects, 289\n\nformatargspec() function, inspect module,\n\n222\n\nformatargvalues() function, inspect module,\n\n222\n\nformatted printing, 8, 70-71, 162\n\nformatted strings, 42, 71-72\n\nFormatter class\n\nlogging module, 365 string module, 288 formatter module, 587\n\nformatting, of log messages, 358, 365\n\nformatwarning() function, warnings module,\n\n239\n\nFortran common blocks, lack of, 146\n\nfound_terminator() method, of asynchat\n\nobjects, 453\n\nfpathconf() function, os module, 382\n\nfpectl module, 585\n\nfpformat module, 586\n\nFraction class, fractions module, 250\n\nfractions module, 39, 250\n\nfragment attribute\n\nof urlparse objects, 520 of urlsplit objects, 521\n\nframe objects, 51-52 attributes of, 52 FrameType type, 51, 237\n\nfree variables, in functions, 98\n\nfreeze_support() function, multiprocessing\n\nmodule, 434\n\nfrexp() function, math module, 251\n\nfrom __future__ import, 178\n\nfrom module import *, 24, 145\n\nglobal variables, 146 identifiers with underscores, 26 __all__ variable, 145\n\nfrom statement\n\nand import statement, 24 module imports, 145\n\nfrom_address() method, of ctypes type\n\nobjects, 616\n\nfrom_buffer() method, of ctypes type\n\nobjects, 616\n\nfrom_buffer_copy() method, of ctypes type\n\nobjects, 616\n\nfrom_decimal() method, of Fraction class,\n\n250\n\nfrom_float() method, of Fraction class, 250\n\nfrom_iterable() method, of objects, 270\n\nfrom_param() method, of ctypes type\n\nobjects, 616\n\nfromfd() function, socket module, 473\n\nfromfile() method, of array objects, 260\n\nfromhex() method, of floating point, 39\n\nfromkeys() method, of dicts, 45\n\nfromlist() method, of array objects, 260\n\nfromordinal() method of date class, 336 of datetime class, 339\n\nfromstring() function,\n\nxml.etree.ElementTree module, 575\n\nfromstring() method, of array objects, 260\n\nfromtimestamp() method of date class, 336 of datetime class, 339\n\nfromutc() method, of tzinfo objects, 342\n\nfrozenset type, 38, 46, 75\n\nfrozenset() function, 77, 205\n\nfstat() function, os module, 383\n\nfstatvfs() function, os module, 383\n\nfsum() function, math module, 251\n\nfsync() function, os module, 383\n\nFTP server, uploading files to, 500\n\nFTP() function, ftplib module, 497\n\nFTPHandler class, urllib.request module,\n\n518\n\nftplib module, 497\n\nftruncate() function, os module, 383\n\nFull exception, Queue module, 418, 445\n\nfull() method, of Queue objects, 418, 445\n\nfunc attribute, of partial objects, 268\n\n__func__ attribute, of methods, 49\n\nF h Lib f L Bdff\n\ngenerator expressions\n\n665\n\nfuncName attribute, of Record objects, 359\n\nfunction call operator (), 47, 76\n\nfunctions, 18\n\n__doc__ attribute, 24 and coroutines, 20 and generators, 19 annotations in Python 3, 624 anonymous, 112 as closures, 98 as dictionary values, 37 as objects, 98 attributes and decorators, 102 attributes of, 48 binding of default values, 93 built-in, 201 callback, 98 calling, 18, 93 change in func_* attribute names, 48 changing recursion limit, 112, 235 copying attributes to decorator, 269 creating wrappers for, 100 decorators, 101 decorators and attributes, 114 default arguments, 18, 93 defining, 93 delayed execution with threads, 437 documentation strings, 48, 113 evaluation of arguments, 76 example of taking any number of argu-\n\nscoping rules, 18, 96 side effects, 95 termination functions, 219 type of built-in, 49 type of user-defined, 47 user-defined, 48 user-defined attributes, 114 variable arguments, 94 variable number of keyword arguments,\n\n95\n\nFunctionType type, 47, 237\n\nfunctools module, 76, 114, 268\n\nfunctor, 62\n\nfunny_files attribute, of dircmp objects, 315\n\nfuture features, enabling, 178\n\n__future__ module, 178 and division, 62 list of features, 178 future_builtins module, 217\n\nFutureWarning warning, 216, 238\n\nfuzzy date and time parsing, 343\n\nG\n\ngaierror exception, socket module, 485\n\ngammavariate() function, random module,\n\n255\n\ngarbage collection, 34-35, 220\n\nments, 95 free variables, 98 keyword arguments, 18, 94 lambda operator, 112 modifying global variables, 18 mutable parameters, 95 nested, 97, 99 optional arguments and None, 38 parameter passing, 95 partial evaluation, 76, 268 pickling of, 228 recursion, 112 returning multiple values from, 18, 96 running in the debugger, 186\n\nand __del__() method, 129 and cycles, 35 and program termination, 179 description of process, 221 observer pattern example, 130 problem with __del__() method, 221\n\ngarbage variable, gc module, 220\n\ngauss() function, random module, 255\n\ngc module, 35, 179, 220\n\ngcd() function, fractions module, 251\n\ngdbm module, 310\n\nge() function, operator module, 274\n\n__ge__() method, 56\n\ngenerator expressions, 109-110\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n666\n\ngenerator expressions\n\nconditional expressions, 79 converting into a list, 110 difference from list comprehension, 110 generator function, and context managers,\n\n90\n\ngenerator objects, 51, 53 attributes of, 53\n\nGeneratorExit exception, 87, 104, 213\n\ngenerators, 19, 102-103\n\nand break statement in iteration, 103 and memory efficiency, 107 and processing pipelines, 19 closing, 53 concurrent programming, 446 execution model, 19 handling of GeneratorExit exception,\n\n213\n\nmultitasking example, 447 practical use of, 106 recursion, 112 throwing exception in, 53 use with I/O, 164-165 use with WSGI, 165 GeneratorType type, 51, 237\n\nget() function, webbrowser module, 544\n\nget() method\n\nof AsyncResult objects, 425 of ConfigParser objects, 333 of Element objects, 576 of Message objects, 552 of Queue objects, 418, 445 of dicts, 16, 45\n\n__get__() method, of descriptors, 58, 126\n\nget_all() method, of Message objects, 552\n\nget_boundary() method, of Message\n\nobjects, 552\n\nget_charset() method, of Message objects,\n\n553\n\nget_charsets() method, of Message objects,\n\n553\n\nget_content_charset() method, of Message\n\nobjects, 553\n\nget_content_maintype() method, of\n\nMessage objects, 553\n\nget_content_subtype() method, of Message\n\nobjects, 553\n\nget_content_type() method, of Message\n\nobjects, 553\n\nget_count() function, gc module, 221\n\nget_data() method, of Request objects, 517\n\nget_debug() function, gc module, 221\n\nget_default_type() method, of Message\n\nobjects, 553\n\nget_dialect() function, csv module, 551\n\nget_errno() function, ctypes module, 617\n\nget_field() method, of Formatter objects,\n\n288\n\nget_filename() method, of Message\n\nobjects, 553\n\nget_full_url() method, of Request objects,\n\n517\n\nget_host() method, of Request objects, 517\n\nget_last_error() function, ctypes module,\n\n617\n\nget_logger() function, multiprocessing mod-\n\nule, 435\n\nget_method() method, of Request objects,\n\n517\n\nget_nowait() method, of Queue objects,\n\n418, 445\n\nget_objects() function, gc module, 221\n\nget_origin_req_host() method, of Request\n\nobjects, 517\n\nget_osfhandle() function, msvcrt module,\n\n372\n\nget_param() method, of Message objects,\n\n553\n\nget_params() method, of Message objects,\n\n553\n\nget_payload() method, of Message objects,\n\n554\n\nget_referents() function, gc module, 221\n\nget_referrers() function, gc module, 221\n\nget_selector() method, of Request objects,\n\n517\n\nget_server_certificate() function, ssl mod-\n\nule, 488\n\nget_starttag_text() method, of HTMLParser\n\nobjects, 561\n\nF h Lib f L Bdff\n\ngetinnerframes() function, inspect module\n\n667\n\nget_terminator() method, of asynchat\n\ngetdefaulttimeout() function, socket mod-\n\nobjects, 453\n\nule, 474\n\nget_threshold() function, gc module, 221\n\ngetdlopenflags() function, sys module, 234\n\nget_type() method, of Request objects, 517\n\ngetdoc() function, inspect module, 223\n\nget_unixfrom() method, of Message\n\ngetEffectiveLevel() method, of Logger\n\nobjects, 554\n\nobjects, 360\n\nget_value() method, of Formatter objects,\n\ngetegid() function, os module, 379\n\n289\n\ngetElementsByTagName() method\n\ngetaddrinfo() function, socket module, 473\n\ngetargspec() function, inspect module, 222\n\ngetargvalues() function, inspect module,\n\n222\n\ngetatime() function, os.path module, 397\n\ngetattr() function, 205\n\nof DOM Document objects, 571 of DOM Element objects, 572 getElementsByTagNameNS() method of DOM Document objects, 571 of DOM Element objects, 572 geteuid() function, os module, 380\n\nand private attributes, 128\n\ngetfile() function, inspect module, 223\n\n__getattr__() method, 57 and __slots__, 133\n\ngetfilesystemencoding() function, sys mod-\n\nule, 234\n\ngetAttribute() method, of DOM Element\n\ngetfirst() method, of FieldStorage objects,\n\nobjects, 572\n\n535\n\n__getattribute__() method, 57-58, 132\n\ngetfloat() method, of ConfigParser objects,\n\nand __slots__, 133\n\n333\n\ngetAttributeNS() method, of DOM Element\n\ngetfqdn() function, socket module, 474\n\nobjects, 572\n\n_getframe() function, sys module, 234\n\ngetboolean() method, of ConfigParser\n\ngetframeinfo() function, inspect module,\n\nobjects, 333\n\n223\n\ngetch() function, msvcrt module, 372\n\ngetgid() function, os module, 380\n\ngetche() function, msvcrt module, 372\n\ngetgroups() function, os module, 380\n\ngetcheckinterval() function, sys module,\n\ngetheader() method, of HTTPResponse\n\n234\n\nobjects, 504\n\ngetchildren() method, of Element objects,\n\ngetheaders() method, of HTTPResponse\n\n577\n\nobjects, 504\n\ngetclasstree() function, inspect module,\n\ngethostbyaddr() function, socket module,\n\n222\n\n474\n\ngetcode() method, of urlopen objects, 515\n\ngethostbyname() function, socket module,\n\ngetcomments() function, inspect module,\n\n474\n\n223\n\ngethostbyname_ex() function, socket mod-\n\ngetcontext() function, decimal module, 247\n\nule, 474\n\ngetctime() function, os.path module, 397\n\ngethostname() function, socket module,\n\ngetcwd() function, os module, 379\n\n474\n\ngetcwdu() function, os module, 379\n\ngetinfo() method, of ZipFile objects, 326\n\ngetdefaultencoding() function, sys module,\n\n166, 234\n\ngetinnerframes() function, inspect module,\n\n223\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n668\n\ngetint() method, of ConfigParser objects\n\ngetint() method, of ConfigParser objects,\n\n333\n\ngetitem() function, operator module, 274\n\n__getitem__() method, 58-59\n\nand slices, 59 getiterator() method\n\nof Element objects, 577 of ElementTree objects, 574\n\ngetitimer() function, signal module, 399\n\ngetLength() method, of SAX attributes\n\nobjects, 582\n\ngetLevelName() function, logging module,\n\n366\n\ngetlist() method, of FieldStorage objects,\n\n535\n\ngetloadavg() function, os module, 395\n\ngetLogger() function, logging module, 356\n\ngetlogin() function, os module, 380\n\ngetmember() method, of TarFile objects,\n\n320\n\ngetmembers() function, inspect module,\n\n223\n\ngetmembers() method, of TarFile objects,\n\n321\n\ngetmodule() function, inspect module, 223\n\ngetmoduleinfo() function, inspect module,\n\n223\n\ngetmodulename() function, inspect module,\n\n224\n\ngetmro() function, inspect module, 224\n\ngetmtime() function, os.path module, 397\n\ngetName() method, of Thread objects, 436\n\ngetNameByQName() method, of SAX attrib-\n\nutes objects, 582\n\ngetnameinfo() function, socket module,\n\n474\n\ngetNames() method, of SAX attributes\n\nobjects, 582\n\ngetnames() method, of TarFile objects, 321\n\ngetopt module, 378\n\ngetouterframes() function, inspect module,\n\n224\n\ngetoutput() function, commands module,\n\n331\n\ngetpeercert() method, of ssl objects, 488\n\ngetpeername() method, of socket objects,\n\n478\n\ngetpgid() function, os module, 380\n\ngetpgrp() function, os module, 380\n\ngetpid() function, os module, 380\n\ngetpos() method, of HTMLParser objects,\n\n561\n\ngetppid() function, os module, 380\n\ngetprofile() function, sys module, 234\n\ngetprotobyname() function, socket module,\n\n475\n\ngetQNameByName() method, of SAX attrib-\n\nutes objects, 582\n\ngetQNames() method, of SAX attributes\n\nobjects, 582\n\ngetrandbits() function, random module, 254\n\ngetrecursionlimit() function, sys module,\n\n112, 234\n\ngetrefcount() function, sys module, 35, 234\n\ngetresponse() method, of HTTPConnection\n\nobjects, 503\n\ngetroot() method, of ElementTree objects,\n\n574\n\ngetservbyname() function, socket module,\n\n475\n\ngetservbyport() function, socket module,\n\n475\n\nGetSetDescriptorType type, 237\n\ngetsid() function, os module, 380\n\ngetsignal() function, signal module, 399\n\ngetsize() function, os.path module, 397\n\ngetsizeof() function, sys module, 192, 234\n\ngetslice() function, operator module, 274\n\ngetsockname() method, of socket objects,\n\n478\n\ngetsockopt() method, of socket objects,\n\n478\n\ngetsource() function, inspect module, 224\n\ngetsourcefile() function, inspect module,\n\n224\n\ngetsourcelines() function, inspect module,\n\n224\n\ngetstate() function, random module, 254\n\nF h Lib f L Bdff\n\nGUIs, and network programming\n\n669\n\n__getstate__() method, 228\n\nglobal interpreter lock, 414, 444\n\nand copying, 220 and pickle module, 172\n\nand multiprocessing module, 444 releasing in extensions, 607\n\ngetstatusoutput() function, commands\n\nmodule, 332\n\nglobal statement, 18, 96 and modules, 143\n\ngettarinfo() method, of TarFile objects, 321\n\ngettempdir() function, tempfile module,\n\n323\n\ngettempprefix() function, tempfile module,\n\n323\n\ngettext module, 587\n\nglobal variables, 96 and eval(), 115 and modules, 146 difference from C and Fortran, 146 modifying in a function, 18 storage of in stack frames, 52\n\ngettimeout() method, of socket objects,\n\n482\n\ngetting help, help() function, 24\n\ngetting the current working directory, 379\n\ngettrace() function, sys module, 234\n\ngetType() method, of SAX attributes\n\nobjects, 582\n\n__globals__ attribute, of functions, 48, 99\n\nglobals() function, 205\n\ngmtime() function, time module, 406\n\ngname attribute, of TarInfo objects, 321\n\ngoto statement, lack of, 84\n\ngray-bearded hacker, 622\n\ngetuid() function, os module, 380\n\ngreater than operator >, 66\n\ngeturl() method, of urlopen objects, 515\n\ngreater than or equal to operator >=, 66\n\n_getvalue() method, of BaseProxy objects,\n\ngreen threads, 446\n\n433\n\ngreenlets, 446\n\ngetValue() method, of SAX attributes\n\ngroup() method, of MatchObject objects,\n\nobjects, 582\n\n285\n\ngetvalue() method\n\ngroupby() function, itertools module, 271\n\nof BytesIO objects, 352 of FieldStorage objects, 535 of StringIO objects, 354\n\ngroupdict() method, of MatchObject objects,\n\n286\n\ngroupindex attribute, of Regex objects, 284\n\ngetValueByQName() method, of SAX attrib-\n\ngroups() method, of MatchObject objects,\n\nutes objects, 582\n\n285\n\ngetwch() function, msvcrt module, 372\n\ngrp module, 586\n\ngetwche() function, msvcrt module, 372\n\ngt() function, operator module, 274\n\ngetweakrefcount() function, weakref mod-\n\n__gt__() method, 56\n\nule, 241\n\nguess_all_extensions() function, mimetypes\n\ngetweakrefs() function, weakref module,\n\nmodule, 567\n\n241\n\nguess_extension() function, mimetypes\n\ngetwindowsversion() function, sys module,\n\nmodule, 567\n\n234\n\nguess_type() function, mimetypes module,\n\ngi_* attributes, of generator objects, 53\n\n566\n\ngid attribute, of TarInfo objects, 321\n\nGUI programming, use of partial function\n\nglob module, 317\n\nevaluation, 268\n\nglob() function, glob module, 317\n\nGUIs, and network programming, 467\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n670\n\ngzip module\n\ngzip module, 317\n\nGzipFile() function, gzip module, 317\n\nH\n\nh command line option, 173\n\nh(elp) debugger command, pdb module,\n\n188\n\nhandle() function, cgitb module, 539\n\nhandle() method, of BaseRequestHandler\n\nobjects, 490\n\nhandle_accept() method, of dispatcher\n\nobjects, 455\n\nhandle_charref() method, of HTMLParser\n\nobjects, 561\n\nhandle_close() method, of dispatcher\n\nobjects, 455\n\nhandle_comment() method, of HTMLParser\n\nobjects, 561\n\nhandle_connect() method, of dispatcher\n\nobjects, 455\n\nhandle_data() method, of HTMLParser\n\nobjects, 561\n\nhandle_decl() method, of HTMLParser\n\nobjects, 561\n\nhandle_endtag() method, of HTMLParser\n\nobjects, 562\n\nhandle_entityref() method, of HTMLParser\n\nobjects, 562\n\nhandle_error() method\n\nof SocketServer class, 493 of dispatcher objects, 455\n\nhandle_expt() method, of dispatcher\n\nobjects, 456\n\nhandle_pi() method, of HTMLParser objects,\n\n562\n\nhandle_read() method, of dispatcher\n\nobjects, 456\n\nhandle_startendtag() method, of\n\nHTMLParser objects, 562\n\nhandle_starttag() method, of HTMLParser\n\nobjects, 562\n\nhandle_timeout() method, of SocketServer\n\nclass, 493\n\nhandle_write() method, of dispatcher\n\nobjects, 456\n\nhas_data() method, of Request objects,\n\n517\n\nhas_header() method\n\nof Request objects, 517 of Sniffer objects, 550\n\nhas_ipv6 variable, socket module, 475\n\nhas_key() method, of dicts, 45\n\nhas_option() method, of ConfigParser\n\nobjects, 333\n\nhas_section() method, of ConfigParser\n\nobjects, 333\n\nhasattr() function, 205\n\nand private attributes, 128\n\nhasAttribute() method, of DOM Element\n\nobjects, 572\n\nhasAttributeNS() method, of DOM Element\n\nobjects, 572\n\nhasAttributes() method, of DOM Node\n\nobjects, 571\n\nhasChildNodes() method, of DOM Node\n\nobjects, 571\n\nhash table, 16, 44\n\nhash table based databases, 310\n\nhash() function, 205\n\n__hash__() method, 56\n\nHashable abstract base class, 265\n\nhashlib module, 559 example of, 425\n\nheader_offset attribute, of ZipInfo objects,\n\n327\n\nheaders attribute\n\nof BaseHTTPRequestHandler objects,\n\n509\n\nof FieldStorage objects, 535\n\nheap, 269\n\nheapify() function, heapq module, 269\n\nheapmin() function, msvcrt module, 372\n\nheappop() function, heapq module, 269\n\nheappush() function, heapq module, 269\n\nheappushpop() function, heapq module,\n\n270\n\nheapq module, 269\n\nheapreplace() function, heapq module, 270\n\nhello world program, 5\n\nF h Lib f L Bdff\n\nHTTPResponse objects, http.client module\n\n671\n\nhelp() function, 24, 206\n\nhtons() function, socket module, 475\n\nbizarre output with decorators, 113\n\nHTTP cookies, 511\n\nherror exception, socket module, 485\n\nHTTP protocol\n\nhex() function, 77, 206\n\nfuture_builtins module, 217 hex() method, of floating point, 39\n\ndescription of, 500 request methods, 501 response codes, 501\n\nhexadecimal\n\nHTTP server\n\ncreating strings from integers, 77 integer literals, 27\n\nhexdigest() method\n\nof digest objects, 559 of hmac objects, 560\n\nhexdigits variable, string module, 287\n\ncustom handling of requests, 510 example with asynchat module, 453 example with asyncore module, 457 example with coroutines, 466 example with firewall, 507 standalone example, 508 uploading files in POST request, 505\n\nhexversion variable, sys module, 231\n\nhiding attribute names from dir() function,\n\nhttp package, 500\n\n128\n\nhttp.client module, 502\n\nhierarchical locking, 442\n\nhttp.cookiejar module, 513\n\nhierarchical logging, logging module, 360\n\nhttp.cookies module, 511\n\nhierarchy of exceptions, 87-88\n\nhttp.server module, 506\n\nhierarchy of objects, 137\n\nHTTPBasicAuthHandler class, urllib.request\n\nHIGHEST_PROTOCOL constant, pickle mod-\n\nmodule, 518-519\n\nule, 172\n\nHTTPConnection() function, http.client mod-\n\nHKEY_* constants, winreg module, 408\n\nule, 502\n\nHMAC authentication, 559\n\nhmac module, 559\n\nhostname attribute\n\nHTTPCookieProcessor class, urllib.request\n\nmodule, 518-519\n\nHTTPDefaultErrorHandler class, urllib.request module, 518\n\nof urlparse objects, 520 of urlsplit objects, 521\n\nHTTPDigestAuthHandler class, urllib.request\n\nmodule, 518-519\n\nhostname, obtaining for host machine, 474\n\nHTTPError exception, urllib.error module,\n\nhour attribute, of time objects, 338\n\n523\n\nHTML forms\n\nHTTPException exception, http.client mod-\n\nexample of, 531 uploading with urllib package, 515\n\nule, 504\n\nHTTPHandler class\n\nHTML parsing, 561\n\nhtml.parser module, 561\n\nHTMLParser class, html.parser module,\n\nlogging module, 362 urllib.request module, 518 httplib module, see http.client, 502\n\n561\n\nHTTPRedirectHandler class, urllib.request\n\nHTMLParser module, see html.parser, 561\n\nmodule, 518\n\nHTMLParserError exception, html.parser\n\nmodule, 562\n\nHTTPResponse objects, http.client module,\n\n504\n\nhtonl() function, socket module, 475\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n672\n\nHTTPSConnection() function, http.client module\n\nHTTPSConnection() function, http.client\n\nignore_environment attribute, of sys.flags,\n\nmodule, 502\n\n230\n\nHTTPServer class, http.server module, 506\n\nignore_pattern() function, shutil module,\n\nHTTPSHandler class, urllib.request module,\n\n318\n\n518\n\nignore_zeros attribute, of TarFile objects,\n\nhypot() function, math module, 251\n\n321\n\nignored NameError exception in __del__,\n\nI\n\n179\n\nignoring exceptions, 85\n\ni command line option, 173-174\n\n__ilshift__() method, 61\n\nI/O buffering, and generators, 165\n\nimag attribute\n\nI/O multiplexing, 459\n\n__iadd__() method, 61\n\nof complex numbers, 39 of floating point, 39\n\n__iand__() method, 61\n\nimap() function, itertools module, 272\n\nIBM General Decimal Arithmetic Standard,\n\nimap() method, of Pool objects, 424\n\n243\n\nimap_unordered() method, of Pool objects,\n\nid() function, 33, 206\n\n424\n\nident attribute, of Thread objects, 436\n\nimaplib module, 587\n\nidentifiers, 26\n\nimghdr module, 588\n\nand first-class data, 36 case sensitivity, 26 reserved words, 26 usage of underscores, 26 use of Unicode in Python 3, 622\n\nimmutability, of tuples, 14\n\nimmutable types, inheriting from, 55\n\nimmutable, definition of, 33\n\n__imod__() method, 61\n\nimp module, 224, 585\n\nidentity comparison of objects, 34\n\nimplicit type conversion, lack of, 62\n\nidentity of objects, 33\n\nimport statement, 13, 23-24, 50, 143-144\n\nidentity operator is, 78\n\n__idiv__() method, 61\n\n__idivmod__() method, 61\n\nIDLE, 5-6\n\nand standard I/O streams, 162\n\nIEEE 754, 243\n\nif statement, 9, 81\n\nand __debug__ variable, 91 ifilter() function, itertools module, 271\n\nifilterfalse() function, itertools module, 271\n\n__ifloordiv__() method, 61\n\niglob() function, glob module, 317\n\nignorableWhitespace() method, of ContentHandler objects, 581\n\nignore debugger command, pdb module,\n\nPython 3, 151 absolute imports in packages, 151 and main program, 146 and sys.modules, 144 and sys.path variable, 147 as qualifier, 144 case sensitivity, 148 compilation of .pyc files, 148 execution of modules, 143 module search path, 147 multiple modules, 144 one-time execution of modules, 144 packages, 150 placement within a program, 144 relative package imports, 150-151 scoping rules of loaded code, 145 types of modules, 148\n\n188\n\n‘ignore’ error handling, Unicode encoding,\n\n166\n\nImportError exception, 87, 148, 214\n\nF h Lib f L Bdff\n\ninit() function, mimetypes module\n\n673\n\nimporting selected symbols from a mod-\n\nule, 145\n\nImproperConnectionState exception,\n\non strings, 11 on tuples, 14 indexing, 0-based, 11\n\nhttp.client module, 504\n\n__imul__() method, 61\n\nin operator, 9\n\nand __contains__ method, 58 and checking for substrings, 69 on dicts, 16, 45, 74 on sequences, 67, 69\n\nindexOf() function, operator module, 274\n\nindices() method, of slices, 54\n\ninet_aton() function, socket module, 475\n\ninet_ntoa() function, socket module, 476\n\ninet_ntop() function, socket module, 476\n\ninet_pton() function, socket module, 476\n\nin-place assignment operators, 75\n\ninexact representation of floating point, 12\n\nin-place file updates, 159\n\nInf variable, decimal module, 248\n\nin-place mathematical operators, 61\n\nInf\n\nin-place modification\n\nof lists, 40 of sets, 47\n\ndecimal module, 244 infinity, 213\n\ninfo() method\n\nin_dll() method, of ctypes type objects, 616\n\nINADDR_* constants, socket module, 478\n\nof Logger objects, 357 of urlopen objects, 515\n\nIncompleteRead exception, http.client mod-\n\ninfolist() method, of ZipFile objects, 326\n\nule, 504\n\ninheritance, 21, 119\n\nIncrementalDecoder class, codecs module,\n\n279\n\nincrementaldecoder() method, of CodecInfo\n\nobjects, 279\n\nIncrementalEncoder class, codecs module,\n\n278\n\nincrementalencoder() method, of CodecInfo\n\nobjects, 278\n\nindentation, 8, 25\n\nand documentation strings, 30 and line continuation character \\, 9 and tabs, 26 preferred style, 8 putting statements on the same line, 25\n\nIndentationError exception, 87, 214\n\n__mro__ attribute of classes, 121 abstract base classes, 137 attribute binding, 119 calling methods in superclasses, 120 from built-in types, 22 from immutable types, 55 initialization of superclasses, 120 interaction with__slots__, 133 internal optimization of, 233 isinstance() function, 34 issubclass() function, 135 metaclasses, 139 method resolution order, 121 multiple inheritance, 121 preventing redefinition of methods, 128 private methods, 128 use with exceptions, 88\n\nindex() method\n\nof array objects, 260 of lists, 40-41 of strings, 41, 43\n\nIndexError exception, 69, 87, 214\n\n.ini files\n\nconfiguring logging with, 368 reading from Python, 332\n\nindexing operator [], 39, 67\n\ninit() function, mimetypes module, 567\n\non lists, 12 on sequences, 68\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n674\n\n__init__() method\n\n__init__() method, 50, 54-55 and exceptions, 88 and inheritance, 120 and instance creation, 129 and metaclasses, 139 and pickle, 228 defining multiple instance creation\n\nmethods, 123 of classes, 22, 118\n\n__init__.py files in packages, 149\n\ninput() function, 162, 206\n\nPython 3, 11\n\ninsert() method\n\nof Element objects, 577 of array objects, 260 of lists, 12, 41\n\ninsertBefore() method, of DOM Node\n\nobjects, 571\n\ninserting items into a dictionary, 16\n\ninserting items into a list, 41\n\ninsort() function, bisect module, 261\n\ninsort_left() function, bisect module, 261\n\ninsort_right() function, bisect module, 261\n\ninspect attribute, of sys.flags, 230\n\ninspect module, 222\n\ninspecting objects, with dir(), 63\n\ninstall command, of setup.py files, 154\n\ninstall_opener() function, urllib.request\n\nmodule, 518\n\ninstallation of third-party packages, 154\n\nin user directory, 154 installing a package, 153\n\ninstance methods, 48, 118\n\n__instancecheck__() method, 57, 136\n\ninstances, 117\n\nas callable, 50 attribute assignment, 131 attribute deletion, 131 creation of, 55, 118, 129 definition of, 33 pickling of, 228 type of, 50\n\ninstantiation of abstract base class, 137\n\nint type, 38\n\nint() function, 11, 62, 76, 206\n\n__int__() method, 61-62\n\nand type coercion, 134 integer division, Python 3, 633\n\nintegers, 27\n\n2’s complement representation, 66 as dictionary key, 16 automatic promotion to long, 27 conversion to longs, 38 creating hexadecimal strings, 77 creating random, 254 overflow behavior, 66 range of, 38 specifying as hex, octal, or binary, 27\n\nIntegral abstract base class, 253\n\nIntegrityError exception, database API, 302\n\ninteractive attribute, of sys.flags, 230\n\ninteractive mode, 6, 175 and blank lines, 26 display of results, 55, 176\n\ninteractive terminal, 174\n\nInterfaceError exception, database API, 302\n\ninternal_attr attribute, of ZipInfo objects,\n\n327\n\nInternalError exception, database API, 302\n\ninternational characters\n\nand string comparison, 70 in source code, 31\n\ninterpolation, of values in strings, 72\n\ninterpreter, 5\n\ninterpreter command line options, 173\n\ninterpreter environment variables, 174\n\ninterpreter prompts, 175\n\ninterpreter, -t and -tt options, 26\n\ninterprocess communication (IPC), 413\n\ninterrupt() method, of Connection objects,\n\n306\n\nintersection operator &, of sets, 15\n\nintersection() method, of sets, 46\n\nintersection_update() method, of sets, 47\n\ninterval timer, 399\n\nintrospection of objects, 222\n\ninv() function, operator module, 273\n\nF h Lib f L Bdff\n\nislower() method, of strings\n\n675\n\nInvalidURL exception, http.client module,\n\nisalnum() method, of strings, 41, 43\n\n504\n\nisalpha() method, of strings, 43\n\ninvert() function, operator module, 274\n\nisatty() function, os module, 383\n\n__invert__() method, 61\n\nisatty() method\n\nio module, 349\n\nPython 3, 631 problems associated with, 354\n\nof IOBase objects, 349 of files, 160\n\nisblk() method, of TarInfo objects, 321\n\nIOBase abstract base class, 354\n\nisbuiltin() function, inspect module, 224\n\nIOBase class, io module, 349\n\nischr() method, of TarInfo objects, 321\n\nioctl() function, fcntl module, 348\n\nisclass() function, inspect module, 224\n\nioctl() method, of socket objects, 482\n\niscode() function, inspect module, 225\n\nIOError exception, 87, 214\n\nisDaemon() method, of Thread objects, 437\n\n__ior__() method, 61\n\nisdatadescriptor() function, inspect module,\n\nIP_* socket options, socket module, 480\n\n225\n\n__ipow__() method, 61\n\nisdev() method, of TarInfo objects, 321\n\nIPPROTO_* constants, socket module, 476\n\nisdigit() method, of strings, 43\n\nIPv4 protocol, 470\n\nisdir() function, os.path module, 397\n\naddress format, 471\n\nisdir() method, of TarInfo objects, 321\n\nIPv6 protocol, 470\n\nisdisjoint() method, of sets, 46\n\naddress format, 471\n\niselement() function, xml.etree.ElementTree\n\nIPV6_* socket options, socket module,\n\nmodule, 578\n\n480-481\n\nisenabled() function, gc module, 221\n\nIronPython, 5\n\nisEnabledFor() method, of Logger objects,\n\nexample of, 620 __irshift__() method, 61\n\n359\n\nisfifo() method, of TarInfo objects, 321\n\nis operator, object identity, 34, 78\n\nisfile() function, os.path module, 397\n\nis_() function, operator module, 274\n\nisfile() method, of TarInfo objects, 321\n\nis_alive() method\n\nisframe() function, inspect module, 225\n\nof Process objects, 416 of Thread objects, 436\n\nisfunction() function, inspect module, 225\n\nisgenerator() function, inspect module, 225\n\nis_multipart() method, of Message objects,\n\n554\n\nisgeneratorfunction() function, inspect mod-\n\nule, 225\n\nis_not() function, operator module, 274\n\nisinf() function, math module, 252\n\nis_set() method, of Event objects, 440\n\nisinstance() function, 34, 37, 135, 206-207\n\nis_tarfile() function, tarfile module, 319\n\nis_unverifiable() method, of Request\n\nobjects, 517\n\nand inheritance, 134 and proxy objects, 135 redefining behavior of, 136\n\nis_zipfile() function, zipfile module, 325\n\nislice() function, itertools module, 272\n\nisabs() function, os.path module, 397\n\nislink() function, os.path module, 397\n\nisabstract() function, inspect module, 224\n\nislnk() method, of TarInfo objects, 321\n\nisAlive() method, of Thread objects, 436\n\nislower() method, of strings, 43\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "page_number": 682
    },
    {
      "number": 34,
      "title": "Segment 34 (pages 700-717)",
      "start_page": 700,
      "end_page": 717,
      "detection_method": "synthetic",
      "content": "676\n\nismethod() function, inspect module\n\nismethod() function, inspect module, 225\n\nismethoddescriptor() function, inspect mod-\n\nule, 225\n\nismodule() function, inspect module, 225\n\nismount() function, os.path module, 397\n\nisnan() function, math module, 252\n\niso-8859-1 encoding, description of, 169\n\nisocalendar() method, of date objects, 337\n\nisoformat() method\n\nof date objects, 337 of time objects, 338\n\nisoweekday() method, of date objects, 337\n\nisreg() method, of TarInfo objects, 321\n\nisReservedKey() method, of Morsel objects,\n\n512\n\nisroutine() function, inspect module, 225\n\nisSameNode() method, of DOM Node\n\nobjects, 571\n\nisspace() method, of strings, 43\n\nissubclass() function, 135, 206 redefining behavior of, 136\n\nissubset() method, of sets, 46\n\nissuperset() method, of sets, 46\n\nissym() method, of TarInfo objects, 322\n\nistitle() method, of strings, 43\n\nistraceback() function, inspect module, 225\n\n__isub__() method, 61\n\nisupper() method, of strings, 41, 43\n\nitemgetter() function, operator module, 275\n\nitems() method\n\nof ConfigParser objects, 333 of Element objects, 577 of Message objects, 552 of dicts, 45 of dicts in Python 3, 632\n\nitemsize attribute, of array objects, 259\n\nItemsView abstract base class, 266\n\niter() function, 206\n\n__iter__() method, 59, 82\n\nIterable abstract base class, 265\n\niteration, 10, 17, 59, 82\n\nbreaking out of a loop, 83 iteration variable, 82\n\nover a sequence, 39, 69 over dictionary keys, 17 over dictionary values, 45 over multiple sequences, 83 portable function for next() operation,\n\n207\n\nprotocol change in Python 3, 633 protocol of, 60, 82 scope of iteration variable, 82 supported objects, 17 unpacking of tuples, 82 Iterator abstract base class, 265\n\niterators, use in Python 3, 632\n\niterdecode() function, codecs module, 279\n\niterdump() method, of Connection objects,\n\n306\n\niterencode() function, codecs module, 279\n\niterencode() method, of JSONEncoder\n\nobjects, 566\n\niterkeyrefs() method, of WeakKeyDictionary\n\nobjects, 241\n\niterparse() function, xml.etree.ElementTree\n\nmodule, 578\n\nitertools module, 83, 270\n\nitervaluerefs() method, of\n\nWeakValueDictionary objects, 241\n\n__itruediv__() method, 61\n\n__ixor__() method, 61\n\nizip() function, itertools module, 83, 212,\n\n272\n\nizip_longest() function, itertools module,\n\n272\n\nJ\n\nJ character, on complex number literals, 27\n\nj(ump) debugger command, pdb module,\n\n188\n\nJava, 620\n\ndifference in class system, 119 Javascript, pop-up window example, 531\n\njoin() function, os.path module, 397\n\njoin() method\n\nof JoinableQueue objects, 419 of Pool objects, 424\n\nF h Lib f L Bdff\n\nlchown() function, os module\n\n677\n\nof Process objects, 416 of Queue objects, 445 of Thread objects, 436 of strings, 43\n\nkeys\n\nacceptable types for dictionaries, 16 of dicts, 44\n\nKeysView abstract base class, 266\n\njoin_thread() method, of Queue objects,\n\nkeyword arguments, 18, 94\n\n418\n\nmixing with positional arguments, 94\n\nJoinableQueue() function, multiprocessing\n\nkeyword module, 585\n\nmodule, 419\n\nkeyword-only arguments, Python 3, 625\n\njs_output() method\n\nof Morsel objects, 512 of SimpleCookie objects, 512 JSON (JavaScript Object Notation), 563\n\nkeywords attribute, of partial objects, 268\n\nkill() function, os module, 392\n\nkill() method, of Popen objects, 403\n\njson module, 563\n\ndifference from pickle and marshal, 565\n\nkillpg() function, os module, 392\n\nkqueue, BSD, 460\n\nJSONDecoder class, json module, 565\n\nJSONEncoder class, json module, 566\n\nL\n\njumpahead() function, random module,\n\nL character, on long integers, 27\n\n254\n\nl(ist) debugger command, pdb module, 188\n\nJython, 5\n\nlambda operator, 48, 112\n\nexample of, 620\n\nalternatives to, 274-275\n\nLambdaType type, 237\n\nK\n\nlast_accepted attribute, of Listener objects,\n\nkbhit() function, msvcrt module, 373\n\n434\n\nkey attribute, of Morsel objects, 512\n\nlast_traceback variable, sys module, 231\n\nkey index operator [], 44\n\nlast_type variable, sys module, 231\n\nof dicts, 16\n\nlast_value variable, sys module, 231\n\nkey keyword argument, to sort(), 40\n\nKEY_* constants, winreg module, 410\n\nkeyboard interrupts, 162\n\nlastChild attribute, of DOM Node objects,\n\n570\n\nlastgroup attribute, of MatchObject objects,\n\n286\n\nKeyboardInterrupt class, 214\n\nlastindex attribute, of MatchObject objects,\n\nKeyboardInterrupt exception, 87-88, 162\n\n286\n\nKeyError exception, 44, 87, 214\n\nlatin-1 encoding, description of, 169\n\nkeyrefs() method, of WeakKeyDictionary\n\nlaunching a web browser, 544\n\nobjects, 241\n\nlaunching python applications, 176\n\nkeys() method\n\nlaunching subprocesses, 402\n\nof Element objects, 577 of Message objects, 552 of dicts, 45 of dicts in Python 3, 632\n\nexamples, 404 lazy evaluation, 99\n\nlchflags() function, os module, 387\n\nlchmod() function, os module, 387\n\nlchown() function, os module, 387\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n678\n\nldexp() function, math module\n\nldexp() function, math module, 252\n\nle() function, operator module, 274\n\n__le__() method, 56\n\nleading 0b on integers, binary, 27\n\nleading 0o on integers, octal, 27\n\nleading 0x on integers, hexadecimal, 27\n\nleading b character on string literals, byte\n\nstrings, 29\n\nleading r character on strings, raw strings,\n\n29\n\nleading u character on string literals,\n\nUnicode strings, 28\n\nleft shift operator <\n\nleft_list attribute, of dircmp objects, 315\n\nleft_only attribute, of dircmp objects, 315\n\nlegacy code, and exec statement, 115\n\nlen() function, 58, 206\n\non dicts, 74 on mappings, 44-45 on sequences, 39-40, 67, 69 on sets, 46, 75\n\n__len__() method, 56, 58\n\nand truth testing, 56\n\nlength attribute, of HTTPResponse objects,\n\n504\n\nless than operator\n\nless than or equal to operator <=, 66\n\nletters variable, string module, 287\n\nlevelname attribute, of Record objects, 359\n\nlevelno attribute, of Record objects, 359\n\nlexical scoping, 97\n\nlexicographical ordering of UTF-8, 170 of strings, 70\n\nlexists() function, os.path module, 397\n\nLifoQueue() function, queue module, 444\n\nlimit_denominator() method, of Fraction\n\nobjects, 250\n\nlimiting the output of error tracebacks, 232\n\nline continuation character \\, 9, 25, 29\n\nline continuation, and parentheses, braces,\n\nor brackets, 25\n\nline separator character for files, 379\n\nline structure of programs, 25\n\nline_buffering attribute, of TextIOWrapper\n\nobjects, 353\n\nlinecache module, 585\n\nlineno attribute, of Record objects, 359\n\nlinesep variable, os module, 379\n\nlink() function, os module, 387\n\nlinkname attribute, of TarInfo objects, 322\n\nLinux, 331\n\nLinux link-level packet protocol, 470\n\naddress format, 472 Linux, epoll interface, 460\n\nlist comprehensions, 13\n\nand declarative programming, 110 conditional expressions, 79 creation of tuples within, 109 difference from generator expression,\n\n110\n\ngeneral syntax of, 108 scope of iteration variable, 109 similiarity to SQL queries, 111 similiarity to awk command, 111\n\nlist of Unix signal names, 400\n\nlist type, 38\n\nlist() function, 12, 40, 77, 207 applied to dictionaries, 16\n\nlist() method\n\nof Manager objects, 429 of TarFile objects, 321\n\nlist_dialects() function, csv module, 551\n\nlistdir() function\n\nPython 3, 630, 633 os module, 387\n\nlisten() method\n\nof dispatcher objects, 456 of socket objects, 483\n\nListener class, multiprocessing module,\n\n433\n\nlists, 12, 40\n\nappending to, 12, 40 as sequence, 39 compared to array objects, 260 comparison of, 70 concatenation, 12\n\nF h Lib f L Bdff\n\nlog_message() method, of BaseHTTPRequestHandler objects\n\n679\n\ncounting items, 40 deletion of items, 69 empty, 12 equality of, 78 indexing operator, 12 inefficiency of insert(), 194 inserting items, 12, 40, 69 item assignment, 12, 69 keeping in sorted order, 261 list comprehension, 108 making shallow copy of, 40 nested, 13 random shuffling, 254 reassigning a slice, 12 removing items, 40 reversing, 40 searching, 40 shared by multiple processes, 429 slice assignment, 69 slice deletion, 69 slices, 12 sorting, 40 versus deque, 194, 262 versus tuples, 14 little endian format, 167\n\nlittle endian, packing and unpacking, 292\n\nljust() method, of strings, 43\n\nlocal variables, 96 and eval(), 115 storage of in stack frames, 52 use before defined, 98\n\nlocal() function, threading module, 443\n\nlocalcontext() function, decimal module,\n\n248\n\nlocale module, 587\n\nlocale setting, and string comparison, 70\n\nlocalName attribute, of DOM Node objects,\n\n570\n\nlocals() function, 207\n\nlocaltime() function, time module, 406\n\nLock object\n\nmultiprocessing module, 427 threading module, 438\n\nLock() method, of Manager objects, 429\n\nLOCK_* constants, flock() function, 348\n\nlockf() function, fcntl module, 348\n\nlocking() function, msvcrt module, 373\n\nlocking\n\navoiding deadlock, 442 files on Windows, 373 multiprocessing module, 427 of critical sections, 414 of files, 348 threading module, 439\n\nln() method, of Decimal objects, 243\n\nlocks\n\nload() function\n\njson module, 565 marshal module, 226 pickle module, 171, 227\n\nand context managers, 89 and exceptions, 23 proper management of, 442\n\nlog files, real-time monitoring example, 19\n\nload() method\n\nof SimpleCookie objects, 512 of Unpickler objects, 228\n\nlog() function, math module, 252\n\nlog() method, of Logger objects, 358\n\nloads() function\n\njson module, 565 marshal module, 226 pickle module, 227 xmlrpc.client module, 526 local storage for threads, 443\n\nlog10() function, math module, 252\n\nlog10() method, of Decimal objects, 243\n\nlog1p() function, math module, 252\n\nlog_error() method, of\n\nBaseHTTPRequestHandler objects, 510\n\nlog_message() method, of\n\nBaseHTTPRequestHandler objects, 510\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n680\n\nlog_request() method, of BaseHTTPRequestHandler objects\n\nlog_request() method, of\n\nlowercase variable, string module, 287\n\nBaseHTTPRequestHandler objects, 510\n\nlseek() function, os module, 383\n\nLogAdapter() function, logging module, 366\n\nlshift() function, operator module, 274\n\nlogging module, 355\n\n__lshift__() method, 60\n\nadding extra fields to log messages, 365 and multiprocessing module, 435 basic configuration, 355 configuring with .ini files, 368 filtering messages, 359 formatting of messages, 365 handler objects, 362 how to configure, 367 including exceptions in log messages,\n\nlstat() function, os module, 387\n\nlstrip() method, of strings, 43\n\nlt() function, operator module, 274\n\n__lt__() method, 56\n\nLWPCookieJar class, http.cookiejar module,\n\n513\n\nM\n\n358\n\nissuing log messages, 356 logger hierarchy, 360 message handling, 361 message propagation, 360 picking logger names, 356 using a null logger, 369\n\nm command line option, 173-174\n\nm pdb option to interpreter, 189\n\nmailbox module, 587\n\nmailcap module, 587\n\nmain program execution, 146\n\nmain program, and pickle module, 228\n\nlogin() method\n\nmain thread, 413\n\nof FTP objects, 498 of SMTP objects, 514\n\n__main__ module, 146, 174\n\nmain() function, unittest module, 184\n\nlognormvariate() function, random module,\n\n__main__, check needed for multiprocess-\n\n255\n\ning module, 417\n\nlong integers, 27\n\nmajor() function, os module, 387\n\nand integers, 38 automatic promotion from integers, 27\n\nmake_server() function,\n\nwsgiref.simple_server module, 542\n\nlong type, 38\n\nmakedev() function, os module, 387\n\nlong() function, 207\n\nmakedirs() function, os module, 387\n\n__long__() method, 61-62\n\nmakefile() method, of socket objects, 483\n\nlookup table, and dictionaries, 16\n\nmaketrans() function, string module, 290\n\nlookup() function\n\nmaking timing measurements, 191\n\ncodecs module, 277 unicodedata module, 296 LookupError exception, 87, 212\n\nmanaged objects, multiprocessing module,\n\n428\n\nManager() function, multiprocessing mod-\n\nloop() function, asyncore module, 457\n\nule, 428\n\nlooping, 17, 82\n\nmant_dig attribute, of sys.float_info, 231\n\nbreaking out prematurely, 83 keeping a loop counter, 83 while statement, 8\n\nloose-coupling of objects, 122\n\nmap() function, 207\n\nand Python 3, 207 and optimization, 197 future_builtins module, 217 map() method, of Pool objects, 424\n\nlow-level file manipulation, 382\n\nlower() method, of strings, 43\n\nmap-reduce, multiprocessing module, 424\n\nF h Lib f L Bdff\n\nmessage_from_string() function, email package\n\n681\n\nmap_async() method, of Pool objects, 425\n\nmemory efficiency\n\nMapping abstract base class, 266\n\nmappings, 44\n\ndeletion of items, 45 key index operator, 44 special methods of, 58\n\nMappingView abstract base class, 266\n\nmarshal module, 226\n\nmatch() function, re module, 284\n\nand __slots__, 133 of generator expressions, 110 of generators, 107 memory management, 128 checking for leaks, 221 creation of instances, 129 garbage collection, 35, 220 reference counting, 129 memory mapped files, 370\n\nmatch() method, of Regex objects, 285\n\nMatchObject objects, re module, 285\n\nand IPC, 413\n\nmath module, 251\n\nmathematical operators\n\nin-place, 61 mixed types, 66-67\n\nmemory use\n\narray objects, 260 measuring, 192 obtaining size of objects, 234 tuples versus lists, 14\n\nmathematical special methods, 60\n\nmax attribute\n\nof date class, 337 of datetime class, 340 of sys.float_info, 231 of time class, 338 of timedelta class, 341\n\nmemory, location of objects, 33\n\nMemoryError exception, 87, 214\n\nMemoryHandler class, logging module, 362\n\nmemset() function, ctypes module, 617\n\nmerge() function, heapq module, 270\n\nMersenne Twister, 254\n\nmax() function, 13, 39-40, 67, 69, 207\n\nMessage class, email package, 552, 555\n\non sets, 75 required methods for user-defined\n\nmessage attribute, of Exception objects,\n\n213\n\nobjects, 57\n\nmessage digests, 559\n\nmax_10_exp attribute, of sys.float_info,\n\n231\n\nmax_exp attribute, of sys.float_info, 231\n\nmaxint variable, sys module, 231\n\nmaxsize variable, sys module, 231\n\nmaxunicode variable, sys module, 231\n\nmessage passing, 414-415 and coroutines, 415 and synchronization, 415 coroutines, 108 definition of, 413 sending byte buffers, 421 sending objects between processes, 421\n\nmd5() function, hashlib module, 559\n\nMemberDescriptorType type, 237\n\nmessage propagation, of log messages,\n\nmembership test\n\n360\n\nof dicts, 16, 74 of sequences, 67\n\nmemmove() function, ctypes module, 617\n\nmessage queues, 415 coroutines, 108 multiprocessing module, 418\n\nmemoization of results, 242\n\nmessage_from_file() function, email pack-\n\nage, 552\n\nmessage_from_string() function, email\n\npackage, 552\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n682\n\nmetaclass keyword argument, of class definitions\n\nmetaclass keyword argument, of class defi-\n\nmigrating code\n\nnitions, 139\n\n__metaclass__ attribute, of classes, 139\n\nPython 2 to 3, 634 practical strategy, 637\n\n__metaclass__ global variable, 139\n\nMIMEApplication class, email package, 557\n\nmetaclasses, 138\n\nMIMEAudio class, email package, 557\n\n__prepare__() method, 627-628 and descriptors, 140 and inheritance, 139 caution on use, 141 example of, 140 how to define, 139 performance benefits, 197 use of __new__() method, 55, 129 use of a custom dictionary object, 628\n\nmethod resolution order, and TypeError\n\nexception, 122\n\nMIMEImage class, email package, 557\n\nMIMEMessage class, email package, 557\n\nMIMEMultipart class, email package, 557\n\nMIMEText class, email package, 558\n\nmimetypes module, 566\n\nmin attribute\n\nof date class, 337 of datetime class, 340 of sys.float_info, 231 of time class, 338 of timedelta class, 341\n\nmethod resolution\n\n__mro__ attribute, 121 multiple inheritance, 121 single inheritance, 120\n\nmethodcaller() function, operator module,\n\n275\n\nmin() function, 13, 39-40, 67, 69, 207\n\non sets, 75 required methods for user-defined\n\nobjects, 57\n\nmin_10_exp attribute, of sys.float_info, 231\n\nmethodHelp() method, of ServerProxy\n\nmin_exp attribute, of sys.float_info, 231\n\nobjects, 525\n\nminimum requirements for supporting\n\nmethods, 48, 117 bound, 49, 125 calling process, 48 class, 125 @classmethod decorator, 48 defining in classes, 21 definition of, 118 handling as properties, 125 preventing redefinition in subclasses,\n\nequality, 57\n\nminor() function, os module, 387\n\nminute attribute, of time objects, 338\n\nmirrored() function, unicodedata module,\n\n296\n\nmissing parenthesese, and tuples, 14\n\nmixed-type mathematical operations, 66-67\n\nmixin classes, 122\n\nmixing byte strings and Unicode, 167\n\n128 static, 125 @staticmethod decorator, 48 type of, 47 type of built-in, 49 unbound, 49 use of super() function, 120\n\nmkd() method, of FTP objects, 498\n\nmkdir() function, os module, 388\n\nmkdtemp() function, tempfile module, 323\n\nmkfifo() function, os module, 388\n\nmknod() function, os module, 388\n\nmkstemp() function, tempfile module, 323\n\nmethodSignatures() method, of ServerProxy\n\nmktemp() function, tempfile module, 323\n\nobjects, 525\n\nmktime() function, time module, 406\n\nMethodType type, 47-48, 237\n\nmmap module, 369\n\nmicrosecond attribute, of time objects, 338\n\nmmap() function, mmap module, 370\n\nmicrothreading, 446\n\nmod() function, operator module, 273\n\nF h Lib f L Bdff\n\nmutability\n\n683\n\n__mod__() method, 60\n\nmove() function, shutil module, 319\n\nmode attribute\n\nmove() method, of mmap objects, 371\n\nof FileIO objects, 350 of TarInfo objects, 322 of files, 161\n\nmoving the file pointer, 161\n\nMozillaCookieJar class, http.cookiejar mod-\n\nule, 513\n\nmodf() function, math module, 252\n\n__mro__ attribute, of classes, 121\n\nmodifying global variables from a function,\n\nMSG_* constants, socket module, 483\n\n18\n\nmsvcrt module, 372\n\nmodifying the module search path, 147\n\nmtime attribute, of TarInfo objects, 322\n\nmodule attribute, of Record objects, 359\n\nmul() function, operator module, 273\n\nmodule loading, 147\n\n__mul__() method, 60\n\nmodule reloading, 149\n\nmulti-dimensional lists, 13\n\nmodule search path\n\nMultiCall() function, xmlrpc.client module,\n\nand site module, 177 and zip files, 147 modifying, 147 setting with environment variable, 174\n\n526\n\nmulticore, and program execution, 414\n\nmultiple inheritance, 120-121\n\nmultiple statements on the same line, 26\n\nmodule unloading, 149\n\nmultiplexing, of I/O, 459\n\n__module__ attribute, of types, 50\n\nmultiplication operator *, 65\n\nmodulefinder module, 585\n\nmultiprocessing module, 415\n\nmodules variable, sys module, 149, 231\n\nmodules, 23, 143\n\naccessing classes, 144 and .pyc files, 148 as objects, 144 attribute access, 51 attributes of, 51 dynamic loading, 144 global namespace for functions, 96 importing multiple, 144 one-time execution, 144 search path of, 147 self-testing with doctest, 182 type of, 50 type of module object, 47 types of recognized files, 148 using to write extensible programs, 144\n\nand global interpreter lock, 444 and pickle, 435 connecting separate processes, 433 distributed computing, 435 logging, 435 managed objects, 428 passing a list through shared memory,\n\n427 pipes, 421 process pools, 424 queues, 418 shared memory, 426 synchronization primitives, 427 use of __main__ check, 417\n\nmultithreaded chicken, 414\n\nmutability\n\nModuleType type, 47, 237\n\nmodulo operator %, 65\n\nmonth attribute, of date objects, 337\n\nMorsel class, http.cookies module, 512\n\ndefault function arguments, 94 dictionary keys, 44 function parameters, 95 in-place assignment operators, 75 reference counting, 35\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n684\n\nmutable, definition of\n\nmutable, definition of, 33\n\nMutableMapping abstract base class, 266\n\nMutableSequence abstract base class, 266\n\nMutableSet abstract base class, 266\n\nmutual exclusion lock, 438\n\nMySQL, accesing from Python, 297\n\nN\n\n\\N escape code, in strings, 28\n\nn(ext) debugger command, pdb module,\n\n189\n\nname attribute\n\nof FieldStorage objects, 535 of FileIO objects, 350 of Process objects, 417 of Record objects, 359 of TarInfo objects, 322 of Thread objects, 436 of files, 161\n\nname mangling, of private attributes, 127\n\nname variable, os module, 379\n\n__name__ attribute\n\nof built-in functions, 49 of functions, 48 of methods, 49 of modules, 51 of types, 50\n\n__name__ variable, of modules, 146\n\nname() function, unicodedata module, 296\n\nnamed tuples\n\nuse as tuples, 264 use by standard library, 265\n\nNamedTemporaryFile() function, tempfile\n\nmodule, 324\n\nnamedtuple() function, collections module,\n\n264\n\nNameError exception, 87, 214\n\nNameError exception in __del__ ignored,\n\n179\n\nNameError exception, and variable lookup,\n\n96\n\nnamelist() method, of ZipFile objects, 326\n\nNamespace() method, of Manager objects,\n\n429\n\nnamespace\n\nand classes, 117 and import statement, 24, 143 local variables of function, 96 namespaceURI attribute, of DOM Node\n\nobjects, 570\n\nNaN variable, decimal module, 248\n\nNaN\n\nnot a number, 213 not a number, decimal module, 244\n\nne() function, operator module, 274\n\n__ne__() method, 57\n\nneg() function, operator module, 273\n\n__neg__() method, 61\n\nnegative indices, 68-69\n\nnegInf variable, decimal module, 248\n\nnested classes, problem with pickle, 228\n\nnested functions, 97 and closures, 99\n\nnested lists, 13\n\nnested() function, contextlib module, 267\n\nNetlink protocol, 470\n\naddress format, 472\n\nnetloc attribute\n\nof urlparse objects, 520 of urlsplit objects, 521\n\nnetrc module, 587\n\nnetwork programming modules, Python 3\n\nreorganization, 497\n\nnetwork programming\n\nUnicode encoding, 452 asynchronous, 467 event-driven programming, 455 getting hostname, 474 introduction, 449 performance of polling, 468\n\nnew() function\n\nhashlib module, 559 hmac module, 559 __new__() method, 54-55\n\nand instance creation, 129 and metaclasses, 139\n\nF h Lib f L Bdff\n\nnumerator attribute\n\n685\n\ncaution when reading code, 129 use by immutable types, 129 uses of, 55\n\nnewline character, difference on\n\nNone, 38\n\nand default arguments, 94 return statement in functions, 96 nonlocal statement, Python 3, 97, 624\n\nUnix/Windows, 159\n\nnormalization of Unicode strings, 171\n\nnewline escape code in strings, 28\n\nnormalize() function, unicodedata module,\n\nnewline parameter, to open() function, 159\n\n171, 296\n\nnewline suppression, print statement, 162\n\nnormalize() method, of DOM Node objects,\n\nnewline termination of statements, 7\n\n571\n\nnewlines attribute\n\nof TextIOWrapper objects, 353 of files, 161 next() function, 207\n\nnormalvariate() function, random module,\n\n255\n\nnormcase() function, os.path module, 398\n\nnormpath() function, os.path module, 398\n\nnext() method, 59\n\nnot equal to operator !=, 66\n\nof TarFile objects, 321 of files, 160 of generators, 19, 53, 103 of iterators, 82 use with coroutines, 104\n\nnot operator, boolean expressions, 9, 77\n\nnot_() function, operator module, 274\n\nNotConnected exception, http.client mod-\n\nule, 504\n\nnotify() method, of Condition objects, 441\n\n__next__() method, 59 Python 3, 633 of generators, 19, 103 of iterators, 82\n\nnotify_all() method, of Condition objects,\n\n441\n\nNotImplementedError exception, 87, 214\n\nNotSupportedError exception, database API,\n\nnextset() method, of Cursor objects, 299\n\nnextSibling attribute, of DOM Node objects,\n\n570\n\n302\n\nnow() method, of datetime class, 339\n\nnsmallest() function, heapq module, 270\n\nNI_* constants, socket module, 475\n\nnice() function, os module, 392\n\nnis module, 586\n\nnlargest() function, heapq module, 270\n\nnntplib module, 587\n\nno_site attribute, of sys.flags, 230\n\nnodeName attribute, of DOM Node objects,\n\n570\n\nNTEventLogHandler class, logging module,\n\n362\n\nntohl() function, socket module, 476\n\nntohs() function, socket module, 476\n\nntransfercmd() method, of FTP objects, 498\n\nnull object, 369\n\nnull values, 38\n\nNULL-terminated strings, and UTF-8, 170\n\nnodeType attribute, of DOM Node objects,\n\nNumber abstract base class, 253\n\n570\n\nnumber of CPUs on system, 434\n\nnodeValue attribute, of DOM Node objects,\n\nnumbers module, 138, 252\n\n570\n\nnumbers, example of defining new type,\n\nnon-printing characters, specifying in string\n\n133\n\nliterals, 28\n\nnumerator attribute\n\nof Fraction objects, 250 of integers, 39\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n686\n\nnumeric data, and strings\n\nnumeric data, and strings, 11\n\nnumeric literals, 26-27\n\nnumeric type coercision, 66-67\n\nnumeric type hierarchy, 137, 253\n\nnumeric types, 38\n\nnumeric() function, unicodedata module,\n\n296\n\nnumpy extension, 39, 261\n\nO\n\nO command line option, 91, 148, 173-174, 369\n\nobject, 47\n\nobject base class, 21, 119\n\nobject() function, 208\n\nobjects, 21\n\nattributes of, 33 class of, 34 comparison, 34 comparison in Python 3, 633 container or collection, 33 defining a null object, 369 definition of, 33 first-class status, 36 getting a list of referrers, 221 getting the size of, 192 hierarchy of, 137 how to copy, 36 identity of, 33 inspecting with dir(), 63 instance of, 33 introspection of, 222 methods for comparison, 56 name of, 35 obtaining size of, 234 persistence, 171 proxies in multiprocessing module, 431 reference counting of, 34 representation of, 131 requirements for ordering, 57 sending between processes with pipes,\n\n421\n\nsending between processes with\n\nqueues, 418\n\nserializing with marshal, 226 serializing with pickle, 227 sharing in the interpreter, 35 supporting iteration, 82 type of, 33 weak references to, 240 observer pattern, 130, 240\n\noct() function, 77, 208\n\nfuture_builtins module, 217\n\noctal integer literals, 27\n\noctdigits variable, string module, 287\n\nold-style classes, 139\n\nOO command line option, 148, 173-174\n\nopen() function, 10, 158, 208\n\nPython 3, 159 codecs module, 167, 279 codecs module and Python 3, 279 dbm module, 310 description of file modes, 159 difference between Python 2 and 3,\n\n208\n\ngzip module, 317 io module, 354 os module, 384 shelve module, 171, 311 tarfile module, 319 webbrowser module, 544\n\nopen() method\n\nof ZipFile objects, 326 of controller objects, 544\n\nopen_new() function, webbrowser module,\n\n544\n\nopen_new() method, of controller objects,\n\n544\n\nopen_new_tab() function, webbrowser mod-\n\nule, 544\n\nopen_osfhandle() function, msvcrt module,\n\n373\n\nOpenKey() function, winreg module, 410\n\nOpenKeyEx() function, winreg module, 410\n\nopenpty() function, os module, 385\n\nOpenSSL, 486\n\nexample of creating certificates, 489\n\noperating system, scheduling by, 414\n\nF h Lib f L Bdff\n\nOverflowError exception\n\n687\n\nOperationalError exception, database API,\n\n302\n\noperator module, 273\n\nalternative to lambda, 274 use in optimization, 274\n\ntuning strategies, 194 use of io module, 354 use of multiprocessing pools, 426 use of operator module, 274 user defined classes, 195\n\noperator overloading, 54 example of, 133 order of operands, 134 reversed operands, 60 type coercion, 134\n\noptimize attribute, of sys.flags, 230\n\noptimized mode, enabling with an environ-\n\nment variable, 174\n\noptional function arguments, 18, 93\n\nand None, 38\n\noperators, 30, 65\n\nOptionParser() function, optparse module,\n\nmathematical, 60 precedence of, 78\n\n374\n\noptions() method, of ConfigParser objects,\n\noptimization\n\n333\n\n__slots__ attribute of classes, 132, 196 array objects, 260 attribute binding, 195-196 built-in types, 194 creation of instances, 195 decorators and metaclasses, 197 definition of speedup, 192 deque objects, 263 dict() function, 195 dict lookups, 197 dicts versus classes, 195 disassembly, 193 effect of adding layers, 195 exceptions, 196-197 formatting of log messages, 358 functional programming, 197 impact of I/O polling, 469 internal type cache, 233 lists versus array objects, 260 logging module, 369 making timing measurements, 191 map() and filter() functions, 197 marshal versus pickle, 226 measuring memory use, 192 repeated timing measurements, 192 select() function, 467 sorting callback functions, 275 speedup, 194\n\noptionxform() method, of ConfigParser\n\nobjects, 333\n\noptparse module, 374 example, 157\n\nor operator, boolean expressions, 9, 77\n\nor_() function, operator module, 274\n\n__or__() method, 60\n\nord() function, 77, 208\n\norder of evaluation, 78\n\nattempts to modify, 79\n\norder of operands, operator overloading,\n\n134\n\norganizing code for distribution, 152\n\nOS X, 331\n\nos module, 158, 378\n\nos.environ variable, 158\n\nos.path module, 396\n\nOSError exception, 87, 214\n\nossaudiodev module, 588\n\noutput() method\n\nof Morsel objects, 512 of SimpleCookie objects, 512\n\nOutputString() method, of Morsel objects,\n\n513\n\noverflow, lack of with integers, 66\n\nOverflowError exception, 214\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n688\n\np debugger command, pdb module\n\nP\n\np debugger command, pdb module, 189\n\nP_* constants, spawnv() function, 392\n\npack() function, struct module, 290\n\npack() method, of Struct objects, 291\n\npack_into() function, struct module, 290\n\npack_into() method, of Struct objects, 291\n\npackages, 149\n\nrelative import, 150-151\n\nPACKET_* constants, socket module, 472\n\npacking\n\nbinary data structures, 290 of tuples, 14\n\npairs, creating a list of from dictionary, 45\n\nparallel iteration over sequences, 83\n\nparameter passing to functions, 95\n\nparams attribute, of urlparse objects, 520\n\nparamstyle variable, database API, 300\n\npardir variable, os module, 386\n\nparent class, 119\n\nparentNode attribute, of DOM Node objects,\n\n570\n\nparetovariate() function, random module,\n\n256\n\nparse() function\n\nxml.dom.minidom module, 570 xml.etree.ElementTree module, 578 xml.sax module, 580\n\nparse() method\n\nof ElementTree objects, 574 of Formatter objects, 288\n\nparse_args() method, of OptionParser\n\nobjects, 158, 376\n\nparse_header() function, cgi module, 536\n\nparse_multipart() function, cgi module, 536\n\nparse_qs() function, urllib.parse module,\n\n521\n\nparse_qsl() function, urllib.parse module,\n\n522\n\nparser module, 586\n\nparseString() function\n\nxml.dom.minidom module, 570 xml.sax module, 580\n\nparsing\n\nCSV files, 548 HTML, 561 URLs, 520 XML, 568 command line options, 157, 374 email messages, 552 form fields in CGI scripts, 534 large XML documents with\n\nElementTree, 579\n\nrobots.txt file, 523\n\npartial() function\n\nfunctools module, 76, 268 use with network handlers, 510 partition() method, of strings, 41, 43\n\npass statement, 9, 25, 82\n\npassword attribute\n\nof urlparse objects, 520 of urlsplit objects, 521\n\npath attribute\n\nof BaseHTTPRequestHandler objects,\n\n509\n\nof urlparse objects, 520 of urlsplit objects, 521\n\npath variable\n\nos module, 379 sys module, 147, 177, 232 __path__ attribute, of modules, 51\n\n__path__ variable, in packages, 151\n\npathconf() function, os module, 388\n\npathname attribute, of Record objects, 359\n\npathsep variable, os module, 386\n\npattern attribute, of Regex objects, 284\n\npattern syntax, regular expressions, 281\n\npause() function, signal module, 399\n\npdb module, 186\n\ndebugging programs from command\n\nshell, 189\n\n.pdbrc configuration file, 190\n\n.pdbrc configuration file, 190\n\npeek() method, of BufferReader objects,\n\n351\n\nPEM_cert_to_DER_cert() function, ssl mod-\n\nule, 488\n\nF h Lib f L Bdff\n\nportable manipulation of filenames\n\n689\n\nPEP 249, Python Database API\n\npipes, creating with subprocess module,\n\nSpecification, 297\n\n403\n\nPEP 333 (WSGI), 540\n\npkgutil module, 586\n\nper-user site directory, 154, 177 installing packages in, 178\n\nplacement of decorators, 101\n\nplatform module, 586\n\nperformance\n\nplatform variable, sys module, 232\n\nof binary file I/O, 351-352 of generator expressions, 110 of logging module, 369 of type checking, 34\n\nplistlib module, 587\n\nplock() function, os module, 392\n\npm() function, pdb module, 186\n\nPOINTER() function, ctypes module, 614\n\nPerl\n\nand dynamic scope, 97 interpretation of numeric strings vs.\n\npointer() function, ctypes module, 615\n\npoll() function, select module, 459\n\nPython, 11\n\npoll() method\n\npermutations() function, itertools module,\n\n272\n\npersistent dictionary, shelve module, 171\n\nof Connection objects, 421 of Poll objects, 460 of Popen objects, 403\n\nPHP, interpretation of numeric strings vs.\n\nPOLL* constants, select module, 459\n\nPython, 11\n\npolling, 459\n\npi variable, math module, 252\n\nperformance of, 468-469\n\npickle module, 171, 226\n\npolymorphism, 122\n\n__main__ module, 228 and multiprocessing module, 435 cPickle, 229 incompatible objects, 171 interaction with copy module, 220 protocol selection, 171-172 security concerns, 172 used by shelve, 311\n\nPool() function, multiprocessing module,\n\n424\n\npop() method\n\nof array objects, 260 of deque objects, 262 of dicts, 45, 95 of lists, 41 of sets, 47\n\npickle protocol, selecting in shelve module,\n\nPopen() function, subprocess module, 402\n\n172\n\npopen() function, os module, 392\n\nPickler class, pickle module, 228\n\npopitem() method, of dicts, 45\n\npickletools module, 586\n\npopleft() method, of deque objects, 262\n\npid attribute\n\npoplib module, 587\n\nof Popen objects, 404 of Process objects, 417\n\nPipe() function, multiprocessing module,\n\nport attribute\n\nof urlparse objects, 520 of urlsplit objects, 521\n\n421\n\npipe() function, os module, 385\n\npipelines and generators, 19\n\nport number\n\nin network programs, 449 list of well known, 450\n\npipelines, and generators, 106-107\n\nportability, of marshal module, 226\n\npipes module, 586\n\nportable manipulation of filenames, 396\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n690\n\npos attribute, of MatchObject objects\n\npos attribute, of MatchObject objects, 286\n\npos() function, operator module, 273\n\n__pos__() method, 61\n\nPOSIX interface, 331\n\nposix attribute, of TarFile objects, 321\n\npost_mortem() function, pdb module, 186\n\npow() function, 66, 208 math module, 252 __pow__() method, 60\n\npower operator **, 65\n\npp debugger command, pdb module, 189\n\npprint module, 586\n\npreamble attribute, of Message objects,\n\n554\n\nprec attribute, of Context objects, 247\n\nprecision, of floating point, 38\n\npredicate() function, itertools module, 271\n\nprefix attribute, of DOM Node objects, 570\n\n—prefix option to setup.py, 154\n\nprefix variable, sys module, 177, 232\n\n__prepare__() method, Python 3 meta-\n\nclasses, 627-628\n\npreventing the creation of .pyc files, 230\n\npreviousSibling attribute, of DOM Node\n\nobjects, 570\n\nprint statement, 6, 162\n\nand __str__(), 56 and sys.stdout, 161 file redirection, 10, 163 formatted output, 8, 162 newline suppression, 162 softspace attribute of files, 162 syntax error with Python 3, 6 trailing comma, 10 print() function, 163, 209\n\nPython 3, 631 enabling in Python 2.6, 163 file redirection, 163 newline suppression, 163 separator character, 163\n\nprint_directory() function, cgi module, 537\n\nprint_environ() function, cgi module, 537\n\nprint_environ_usage() function, cgi module,\n\n537\n\nprint_exc() function, traceback module, 236\n\nprint_exception() function, traceback mod-\n\nule, 236\n\nprint_form() function, cgi module, 537\n\nprint_last() function, traceback module,\n\n236\n\nprint_stack() function, traceback module,\n\n236\n\nprint_tb() function, traceback module,\n\n235-236\n\nprintable variable, string module, 287\n\nprintdir() method, of ZipFile objects, 326\n\nprintf() function equivalent, 8\n\nprinting to the screen, 10\n\nprinting\n\ncreating custom formatters, 288 dates and times, 406 formatted, 8 priority queue, 269\n\nPriorityQueue() function, queue module,\n\n445\n\nprivate attributes, 127 and properties, 128 name mangling of, 127 private class members, 26\n\nprivate methods, and inheritance, 128\n\nprivate specifier, lack of, 127\n\nprobability, random number distributions,\n\n255\n\nprocess attribute, of Record objects, 359\n\nprocess id, getting, 380\n\nProcess() function, multiprocessing module,\n\n416\n\nprocesses\n\nconnecting with pipes, 421 daemonic, 415 definition of, 413 joining, 415 scheduling of, 414 sending signals to, 392 terminating, 392, 403-404, 415 worker pools, 424\n\nF h Lib f L Bdff\n\npwd() method, of FTP objects\n\n691\n\nProcessingInstruction() function,\n\nproto attribute, of socket objects, 484\n\nxml.etree.ElementTree module, 575\n\nprotocol parameter, to pickle functions, 171\n\nprocessingInstruction() method, of ContentHandler objects, 581\n\nprotocol_version attribute, of\n\nBaseHTTPRequestHandler class, 509\n\nproducer-consumer\n\nProtocolError exception, xmlrpc.client mod-\n\nwith coroutines, 20 with pipes, 422 with queues, 419 with threads and condition variables,\n\n441\n\nwith threads and semaphores, 439 product() function, itertools module, 272\n\nprofile module, 190\n\nule, 527\n\nproxies, and attribute binding methods, 132\n\nproxy, 62\n\nproxy functions, 95\n\nproxy objects\n\nand multiprocessing module, 428, 431 problem with type checking, 135 proxy() function, weakref module, 241\n\nprofiling, 190\n\ninterpreting output, 191\n\nProxyBasicAuthHandler class, urllib.request\n\nmodule, 518-519\n\nprogram execution model, 81\n\nProxyDigestAuthHandler class, urllib.request\n\nprogram execution, main program, 146\n\nmodule, 518-519\n\nprogram structure, 81\n\nProxyHandler class, urllib.request module,\n\nprogram termination, 7, 179, 233 and garbage collection, 179 brutal, 179 brute force, 391 ignored NameError exception, 179 registering cleanup functions, 219 programming errors, lack of compiler\n\n518-519\n\nProxyTypes class, weakref module, 241\n\nps1 variable, sys module, 232\n\nps2 variable, sys module, 232\n\n.pth files, site configuration, 177\n\npty module, 586\n\nchecking, 181\n\nProgrammingError exception, database API,\n\n302\n\nprompts\n\nchanging, 176 interactive mode, 175\n\npropagate attribute, of Logger objects, 360\n\nproperties, 117\n\nand __setattr_() method, 131 and private attributes, 128 definition of, 124 set and delete functions, 126 uniform access principle, 125 use by methods, 125 @property decorator, 124\n\npunctuation variable, string module, 287\n\npush() method, of asynchat objects, 453\n\npush_with_producer() method, of asynchat\n\nobjects, 453\n\nput() method, of Queue objects, 418, 445\n\nput_nowait() method, of Queue objects,\n\n419, 445\n\nputch() function, msvcrt module, 373\n\nputenv() function, os module, 380\n\nputheader() method, of HTTPConnection\n\nobjects, 503\n\nputrequest() method, of HTTPConnection\n\nobjects, 503\n\nputwch() function, msvcrt module, 373\n\npwd module, 586\n\nproperty() function, 126, 209\n\npwd() method, of FTP objects, 498\n\nprotected specifier, lack of, 127\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n692\n\n.py files\n\n.py files, 6, 147\n\nand library modules, 23\n\npy2app package, 154\n\npy2exe package, 154\n\npy3k_warning attribute, of sys.flags, 230\n\npy3kwarning variable, sys module, 232\n\nPy_BEGIN_ALLOW_THREADS macro, 607\n\nPy_BuildValue() function, 602\n\npy_compile module, 586\n\nPy_DECREF() macro, 607\n\nPy_END_ALLOW_THREADS macro, 607\n\nPy_Finalize() function, 609\n\nPy_GetExecPrefix() function, 609\n\nPy_GetPath() function, 609\n\nPy_GetPrefix() function, 609\n\nPy_GetProgramFullPath() function, 609\n\nPy_INCREF() macro, 607\n\nPy_Initialize() function, 609\n\nPy_IsInitialized() function, 609\n\nPy_SetProgramName() function, 609\n\nPy_XDECREF() macro, 607\n\nPy_XINCREF() macro, 607\n\nPyArg_ParseTuple() function, 597\n\nPyArg_ParseTupleAndKeywords() function,\n\n597\n\nPyBytes_AsString() function, 611\n\n.pyc files, 147\n\ncompilation on import, 148 preventing the creation of, 230 when created, 148\n\npyclbr module, 586\n\n.pyd files, compiled extensions, 148\n\npydev, 5\n\npydoc command, 24\n\nPyErr_Clear() function, 606\n\nPyErr_ExceptionMatches() function, 606\n\nPyErr_NoMemory() function, 605\n\nPyErr_Occurred() function, 606\n\nPyErr_SetFromErrno() function, 605\n\nPyErr_SetFromErrnoWithFilename() func-\n\ntion, 605\n\nPyErr_SetObject() function, 605\n\nPyErr_SetString() function, 605\n\nPyEval_CallObject() function, 610\n\nPyEval_CallObjectWithKeywords() function,\n\n610\n\nPyExc_* exceptions, in extension modules,\n\n605\n\nPyFloat_AsDouble() function, 611\n\nPyImport_ImportModule() function, 610\n\nPyInt_AsLong() function, 611\n\nPyLong_AsLong() function, 611\n\nPyModule_AddIntConstant() function, 604\n\nPyModule_AddIntMacro() function, 605\n\nPyModule_AddObject() function, 604\n\nPyModule_AddStringConstant() function,\n\n604\n\nPyModule_AddStringMacro() function, 605\n\n.pyo files, 147\n\nwhen created, 148\n\nPyObject_GetAttrString() function, 610\n\nPyObject_SetAttrString() function, 610\n\npypi (Python Package Index), 154\n\npyprocessing library, 435\n\nPyRun_AnyFile() function, 608\n\nPyRun_InteractiveLoop() function, 609\n\nPyRun_InteractiveOne() function, 609\n\nPyRun_SimpleFile() function, 609\n\nPyRun_SimpleString() function, 609\n\nPyString_AsString() function, 611\n\nPySys_SetArgv() function, 610\n\nPython 3\n\n2to3 tool, 635-637 Ellipsis as an expression, 626 I/O system, 349, 631 Unicode characters in identifiers, 622 __next__() method, 633 absolute imports, 634 abstract base class, 137 adoption of, 621 and WSGI, 541 byte strings and system interfaces, 630 chained exceptions, 626 command line options, 633 commands module, 332\n\nF h Lib f L Bdff\n\nqueues\n\n693\n\ncomparison, 633 dictionary comprehension, 623 dictionary operations, 45 difference in extension modules, 595 different behavior of byte strings, 629 division operator, 65 encode() and encode() methods, 629 environment variables, 633 exception attributes, 213 exec() function, 631 extended iterable unpacking, 623 filenames, 633 files, 160 filter() function, 205 function annotations, 624 generator changes, 103 import statement, 151 incompatibility with Python 2, 621 integer division, 633 interactive mode encoding issues, 175 iterator protocol, 633 keyword-only arguments, 625 map() function, 207 metaclasses, 139, 627-628 migration pitfalls, 629 network programming, 452 next() method of generators, 53 nonlocal statement, 624 open() function, 159, 208, 279 practical porting strategy, 637 print() function, 209, 631 raw_input() function, 209 reorganization of network modules,\n\ntypes module, 237 unbound methods, 49 unicode() function removal, 211 using new built-in functions in Python\n\n2, 217\n\nview objects on dicts, 632 viewing objects in ASCII, 201 who should use, 621 xrange() and range() functions, 17 xrange() function removal, 44, 211 zip() function, 83, 211\n\npython interpreter, 6\n\nPYTHON* environment variables, 174\n\nPython.h header file, in extensions, 594\n\n.pyw files, 147, 176\n\nPyZipFile() function, zipfile module, 325\n\nQ\n\nQ command line option, 173\n\nq(uit) debugger command, pdb module,\n\n189\n\nqsize() method, of Queue objects, 419, 445\n\nqueries, how to safely form for databases,\n\n300\n\nquery attribute\n\nof urlparse objects, 520 of urlsplit objects, 521\n\nQueryInfoKey() function, winreg module,\n\n410\n\nQueryValue() function, winreg module, 410\n\nQueryValueEx() function, winreg module,\n\n410\n\n497\n\nqueue module, 444\n\nround() function, 209 set comprehension, 623 set literals, 622 socketserver module, 489 standard library reorganization, 634 super() function, 120, 210, 627 supporting both Python 2 and 3, 638 syntax error with print, 6 third party libraries, 621\n\nQueue() function\n\nmultiprocessing module, 418 queue module, 444\n\nQueue() method, of Manager objects, 429\n\nqueue, circular, 262\n\nqueues\n\ncoroutines, 108 example with threads, 446\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "page_number": 700
    },
    {
      "number": 35,
      "title": "Segment 35 (pages 718-738)",
      "start_page": 718,
      "end_page": 738,
      "detection_method": "synthetic",
      "content": "694\n\nqueues\n\nmessage passing, 415 multiple consumers and producers, 420 priority, 269 shared by multiple processes, 429 thread programming, 444\n\nquit() method\n\nof FTP objects, 498 of SMTP objects, 514\n\nquitting the interactive interpreter, 7\n\nquopri module, 567\n\nquote() function, urllib.parse module, 522\n\nquote_from_bytes() function, urllib.parse\n\nmodule, 522\n\nquote_plus() function, urllib.parse module,\n\n522\n\nquoteattr() function, xml.sax.saxutils mod-\n\nule, 583\n\nquotes, difference between styles, 27\n\nquoting, characters in URLs, 522\n\nR\n\n!r specifier in string formatting, 74\n\nr character, before a string literal, 29\n\n‘r’ mode, to open() function, 159\n\nr(eturn) debugger command, pdb module,\n\n189\n\nrace condition, 193, 414\n\n__radd__() method, 60\n\nwhen invoked over __add__(), 134\n\nradians() function, math module, 251\n\nradix attribute, of sys.float_info, 231\n\nraise statement, 23, 84-85, 88\n\n__rand__() method, 61\n\nRAND_add() function, ssl module, 488\n\nRAND_egd() function, ssl module, 488\n\nRAND_status() function, ssl module, 488\n\nrandint() function, random module, 254\n\nrandom module, 254\n\nrandom numbers, and threads, 256\n\nrandom() function, random module, 255\n\nrandrange() function, random module, 254\n\nrange of integer values, 38\n\nrange() function, 17, 209\n\nremoval in Python 3, 17 Rational abstract base class, 253\n\nrational numbers, 250\n\nraw I/O on files, 350\n\nraw socket, 470\n\nraw strings, 29\n\nUnicode, 29 backslash rules, 29 use in regular expressions, 281\n\nraw-unicode-escape encoding, description\n\nof, 170\n\nraw_decode() method, of JSONDecoder\n\nobjects, 566\n\nraw_input() function, 10, 162, 209\n\nPython 3, 11, 209\n\nRawArray() function, multiprocessing mod-\n\nule, 427\n\nRawConfigParser class, configparser mod-\n\nule, 336\n\nRawIOBase abstract base class, 354\n\nRawValue() function, multiprocessing mod-\n\nule, 426\n\nRCVALL_* constants, socket module, 482\n\n__rdiv__() method, 60\n\n__rdivmod__() method, 60\n\nre attribute, of MatchObject objects, 286\n\nre module, 41, 69, 281\n\nread() function, os module, 385\n\nread() method\n\nof BufferReader objects, 351 of ConfigParser objects, 333 of FileIO objects, 350 of HTTPResponse objects, 504 of StreamReder objects, 278 of TextIOWrapper objects, 353 of ZipFile objects, 326 of files, 159-160 of mmap objects, 371 of ssl objects, 488 of urlopen objects, 515\n\nread-eval loop, 5\n\nread1() method, of BufferReader objects,\n\n351\n\nF h Lib f L Bdff\n\nregister command of setup.py file\n\n695\n\nread_byte() method, of mmap objects, 371\n\nreassigning part of a list, 12\n\nread_mime_types() function, mimetypes\n\nRecord objects, logging module, 359\n\nmodule, 567\n\nrecursion limit, changing, 112, 235\n\nreadable() method\n\nrecursion, 112\n\nof IOBase objects, 349 of dispatcher objects, 456\n\nand decorators, 102, 113 and generator functions, 112\n\nreadall() method, of FileIO objects, 350\n\nrecursive traversal of directory trees, 390\n\nreader() function, csv module, 549\n\nrecv() method\n\nReadError exception, tarfile module, 322\n\nreadfp() method, of ConfigParser objects,\n\n334\n\nof Connection objects, 421 of dispatcher objects, 456 of socket objects, 483\n\nreading CSV data, example of, 14\n\nrecv_bytes() method, of Connection objects,\n\nreading configuration files, 332\n\n421\n\nreading lines, files, 10\n\nrecv_bytes_into() method, of Connection\n\nreading user input, 10, 162\n\nobjects, 422\n\nreadinto() method, of BufferReader objects,\n\nrecv_into() method, of socket objects, 483\n\n351\n\nrecvfrom() method, of socket objects, 483\n\nreadline library, 176\n\nrecvfrom_info() method, of socket objects,\n\nreadline module, 586\n\n483\n\nreadline() method\n\nrecvmsg() system call, lack of support, 486\n\nof IOBase objects, 349 of StreamReder objects, 278 of TextIOWrapper objects, 353 of files, 10, 159-160 of mmap objects, 371 of urlopen objects, 515\n\nreduce() function, functools module, 268\n\n__reduce__() method, 229\n\n__reduce_ex__() method, 229\n\nreentrant mutex lock, 438\n\nref() function, weakref module, 240\n\nreference counting, 34, 129\n\nreadlines() method\n\nof IOBase objects, 349 of StreamReder objects, 278 of files, 13, 159-160 of urlopen objects, 515\n\nreadlink() function, os module, 388\n\nready() method, of AsyncResult objects,\n\nand copying, 35 and del statement, 35 and memory use, 192 and mutable objects, 36 in extension modules, 607 obtaining, 35 reference cycles\n\n425\n\nReal abstract base class, 253\n\nand garbage collection, 221 avoiding with weak references, 130,\n\nreal attribute\n\n240\n\nof complex numbers, 39 of floating point, 39\n\nReferenceError exception, 87, 214\n\nREG_* constants, winreg module, 409\n\nrealpath() function, os.path module, 398\n\nRegex objects, re module, 284\n\nreason attribute, of HTTPResponse objects,\n\nregister command of setup.py file, 155\n\n504\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n696\n\nregister() function\n\nregister() function\n\natexit module, 179, 219 webbrowser module, 544\n\nregister() method\n\nof BaseManager class, 430 of Poll objects, 459 of abstract base classes, 137\n\nregister_adapter() function, sqlite3 module,\n\n305\n\nregister_converter() function, sqlite3 mod-\n\nule, 304\n\nregister_dialect() function, csv module, 551\n\nregister_function() method, of XMLRPCServer objects, 527\n\nregister_instance() method, of XMLRPCServer objects, 527\n\nregister_introspection_functions() method,\n\nof XMLRPCServer objects, 528\n\nregister_multicall_functions() method, of\n\nXMLRPCServer objects, 528\n\nRegLoadKey() function, winreg module, 409\n\nregular expressions\n\npattern syntax, 281 re module, 281 use of raw strings, 281\n\nrelational databases, accessing from\n\nPython, 297\n\nrelational operators, 9, 56\n\nrelative package imports, 150-151\n\nrelease() method\n\nof Condition objects, 441 of Lock objects, 438 of RLock objects, 439 of Semaphore objects, 439\n\nreliable datagrams, 470\n\nreload() function, 149\n\nreloading modules, 149\n\nrelpath() function, os.path module, 398\n\nremote procedure call\n\nXML-RPC, 524 multiprocessing module, 423-424\n\nremove() function, os module, 388\n\nremove() method\n\nof Element objects, 577 of array objects, 260\n\nof deque objects, 262 of lists, 40-41 of sets, 15, 47\n\nremove_option() method, of ConfigParser\n\nobjects, 334\n\nremove_section() method, of ConfigParser\n\nobjects, 334\n\nremoveChild() method, of DOM Node\n\nobjects, 571\n\nremovedirs() function, os module, 388\n\nremoveFilter() method\n\nof Handler objects, 364 of Logger objects, 359\n\nremoveHandler() method, of Logger\n\nobjects, 361\n\nremoving directories, 318\n\nremoving files, 388\n\nremoving sequence items, 40\n\nremoving slices, 40\n\nrename() function, os module, 388\n\nrename() method, of FTP objects, 498\n\nrenames() function, os module, 388\n\nrepeat() function\n\ncProfile module, 190 itertools module, 272 operator module, 274 timeit module, 192\n\n‘replace’ error handling, Unicode encoding,\n\n166\n\nreplace() method\n\nof date objects, 337 of datetime objects, 340 of strings, 41, 43 of time objects, 338\n\nreplace_header() method, of Message\n\nobjects, 556\n\nreplaceChild() method, of DOM Node\n\nobjects, 571\n\nreplacing substrings, 41\n\nreplication, of sequences and shallow\n\ncopies, 67\n\nreport() method, of dircmp objects, 315\n\nreport_full_closure() method, of dircmp\n\nobjects, 315\n\nF h Lib f L Bdff\n\nrledecode_hqx() function, binascii module\n\n697\n\nreport_partial_closure() method, of dircmp\n\nResponseNotReady exception, http.client\n\nobjects, 315\n\nmodule, 504\n\nrepr (reprlib) module, 586\n\nresponses attribute, of\n\nrepr() function, 11, 55, 77, 176, 209\n\nBaseHTTPRequestHandler class, 509\n\nand eval(), 55 difference from str(), 12\n\nrestricting attribute names, 132\n\nrestype attribute, of ctypes function objects,\n\n__repr__() method, 55-56\n\n613\n\nrepresenting dates and times, 336\n\nrequest attribute, of BaseRequestHandler\n\nobjects, 490\n\nresult of last operation in interactive mode,\n\n6, 176\n\nretrbinary() method, of FTP objects, 499\n\nRequest() function, urllib.request module,\n\nretrlines() method, of FTP objects, 499\n\n516\n\nreturn statement, 96\n\nrequest() method, of HTTPConnection\n\nreturncode attribute, of Popen objects, 404\n\nobjects, 503\n\nreturning multiple values from a function,\n\nrequest_queue_size attribute, of\n\n18, 96\n\nSocketServer class, 492\n\nreverse keyword argument, to sort(), 40\n\nrequest_version attribute, of\n\nreverse() method\n\nBaseHTTPRequestHandler objects, 509\n\nRequestHandlerClass attribute, of\n\nof array objects, 260 of lists, 40-41\n\nSocketServer objects, 492\n\nreraising the last exception, 84\n\nreversed operand methods, when invoked,\n\n134\n\nreserved attribute, of ZipInfo objects, 327\n\nreversed operands, operator overloading,\n\nreserved words, 26\n\n60\n\nreset() method\n\nreversed() function, 209\n\nof HTMLParser objects, 562 of IncrementalDecoder objects, 279 of IncrementalEncoder objects, 278 of StreamReder objects, 278 of StreamWriter objects, 278\n\nreversing a list, 40\n\nrfile attribute\n\nof BaseHTTPRequestHandler objects,\n\n509\n\nof StreamRequestHandler objects, 491\n\nresetwarnings() function, warnings module,\n\nrfind() method, of strings, 41, 43\n\n239\n\n__rfloordiv__() method, 60\n\nresize() function, ctypes module, 617\n\nright shift operator >>, 65\n\nresize() method, of mmap objects, 371\n\nright_list attribute, of dircmp objects, 315\n\nresolution attribute\n\nright_only attribute, of dircmp objects, 315\n\nof date class, 337 of datetime class, 340 of time class, 338 of timedelta class, 341\n\nrindex() method, of strings, 41, 43\n\nrjust() method, of strings, 43\n\nrlcompleter module, 586\n\nresource module, 587\n\nrlecode_hqx() function, binascii module,\n\n548\n\nresponse time, asynchronous networking,\n\n467\n\nrledecode_hqx() function, binascii module,\n\n548\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n698\n\nRLock object\n\nRLock object\n\nmultiprocessing module, 427 threading module, 438\n\nRLock() method, of Manager objects, 429\n\n__rlshift__() method, 61\n\nrmd() method, of FTP objects, 499\n\nrmdir() function, os module, 388\n\n__rmod__() method, 60\n\nrmtree() function, shutil module, 319\n\n__rmul__() method, 60\n\nrobotparser module, 523\n\nrobots.txt file, 523\n\nrollback() method, of Connection objects,\n\n298\n\nrollover() method, of SpoolTemporaryFile\n\nobjects, 324\n\nroot logger, logging module, 355\n\n__ror__() method, 61\n\nrotate() method, of deque objects, 263\n\nrotating log files, 363\n\nRotatingFileHandler class, logging module,\n\n363\n\nround() function, 66, 209 and Python 3, 209\n\nrounding attribute, of Context objects, 247\n\nrounding behavior, 66\n\nchange in Python 3, 66 rounding, decimal module, 245\n\nrounds attribute, of sys.float_info, 231\n\nrow_factory attribute, of Connection\n\nobjects, 308\n\nrowcount attribute, of Cursor objects, 299\n\nrpartition() method, of strings, 41\n\n__rpow__() method, 61\n\n__rrshift__() method, 61\n\nrshift() function, operator module, 274\n\n__rshift__() method, 60\n\nrsplit() method, of strings, 41, 43\n\nrstrip() method, of strings, 43\n\n__rsub__() method, 60\n\n__rtruediv__() method, 60\n\nRuby, differences in object system, 124\n\nrun debugger command, pdb module, 189\n\nrun() function\n\ncProfile module, 190 pdb module, 186 profile module, 190\n\nrun() method\n\nof Process objects, 416 of Thread objects, 436\n\nruncall() function, pdb module, 186\n\nruneval() function, pdb module, 186\n\nrunning programs, 6\n\nRuntimeError exception, 87, 214\n\nRuntimeWarning warning, 216, 238\n\n__rxor__() method, 61\n\nS\n\n!s specifier in string formatting, 74\n\nS command line option, 173-174\n\ns command line option, 173\n\ns(tep) debugger command, pdb module,\n\n189\n\nsafe_substitute() method, of Template\n\nobjects, 289\n\nSafeConfigParser class, configparser mod-\n\nule, 336\n\nsame_files attribute, of dircmp objects, 315\n\nsamefile() function, os.path module, 398\n\nsameopenfile() function, os.path module,\n\n398\n\nsamestat() function, os.path module, 398\n\nsample() function, random module, 255\n\nSaveKey() function, winreg module, 410\n\nSAX interface\n\nXML parsing, 568 example of, 583\n\nscaling, with concurrency, 415\n\nsched module, 587-588\n\nscheduler, for generators and coroutines,\n\n447\n\nscheme attribute\n\nof urlparse objects, 520 of urlsplit objects, 521\n\nscientific notation, floating point, 27\n\nF h Lib f L Bdff\n\nsequences\n\n699\n\nscoping rules\n\nSemaphore object\n\nand module imports, 145 and self parameter in methods, 118 lexical scoping of functions, 97 of classes, 118 of function variables, 18, 96 of iteration variable in list comprehen-\n\nmultiprocessing module, 427 threading module, 439\n\nSemaphore objects, use for signaling, 439\n\nSemaphore() method, of Manager objects,\n\n429\n\nsemicolon ;, 26\n\nsion, 109\n\nof iteration variables, 82\n\nscript name, 157\n\nsearch path, for modules, 147\n\nsearch() function, re module, 284\n\nsearch() method, of Regex objects, 285\n\nsend() method\n\nof Connection objects, 422 of HTTPConnection objects, 503 of dispatcher objects, 456 of generators, 20, 53, 104 of socket objects, 484\n\nsearching, strings with an offset, 41\n\nsend_bytes() method, of Connection\n\nsecond attribute, of time objects, 338\n\nobjects, 422\n\nsections() method, of ConfigParser objects,\n\nsend_error() method, of\n\n334\n\nBaseHTTPRequestHandler objects, 509\n\nsecure sockets layer (SSL), 486\n\nsend_header() method, of\n\nsecurity\n\nBaseHTTPRequestHandler objects, 509\n\nXML-RPC servers, 530 database queries, 300 marshal module, 226 pickle module, 172, 229\n\nsend_response() method, of\n\nBaseHTTPRequestHandler objects, 509\n\nsend_signal() method, of Popen objects,\n\n403\n\nseed() function, random module, 254\n\nseek() method\n\nof IOBase objects, 350 of files, 160-161, 352 of mmap objects, 371\n\nsendall() method, of socket objects, 484\n\nsendcmd() method, of FTP objects, 499\n\nsending email, example of, 514, 558\n\nsendmail() method, of SMTP objects, 514\n\nsendmsg() system call, lack of support, 486\n\nseekable() method, of IOBase objects, 350\n\nsendto() method, of socket objects, 484\n\nselect module, 415, 459 signal handling, 399\n\nsentinel, use with queuing, 420, 446\n\nsep keyword argument, to print() function,\n\nselect() function\n\nand asyncore module, 455 performance problems, 467 select module, 459\n\n163\n\nsep variable, os module, 386\n\nseparator character, print() function, 163\n\nSequence abstract base class, 266\n\nself parameter of methods, 22, 118\n\nsequences, 39\n\nwhy required, 119\n\n__self__ attribute\n\nof built-in functions, 49 of methods, 49\n\ncomparison of, 70 concatenation, 67 extended slicing of, 68 in operator, 67 indexing in string formatting, 72 item assignment, 40\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n700\n\nsequences\n\niteration over, 39, 69 lookup in composite string formatting,\n\n42\n\nnegative indices, 68 operators, 67 picking random elements, 254 random sampling, 254 replication, 67 shallow copies in replication, 67 slice assignment, 40 slicing operator, 68 special methods of, 58 unpacking, 67-68\n\nserve_forever() method\n\nof BaseManager objects, 431 of SocketServer objects, 491\n\nserver attribute, of BaseRequestHandler\n\nobjects, 490\n\nserver program, 449\n\nTCP example, 451 UDP example, 485 example of restricting access with\n\nHTTP, 507\n\nexample with SocketServer module,\n\n490\n\nexample with coroutines, 464\n\nserver_address attribute, of SocketServer\n\nobjects, 492\n\nserver_version attribute\n\nof BaseHTTPRequestHandler class,\n\n508\n\nof HTTPRequestHandler class, 507 ServerProxy() function, xmlrpc.client mod-\n\nule, 524\n\nSet abstract base class, 266\n\nset comprehension, Python 3, 623\n\nset difference operator -, 75\n\nset intersection operator &, 75\n\nset literals, Python 3, 622\n\nset symmetric difference operator ^, 75\n\nset theory, similarity to list comprehen-\n\nsions, 110\n\nset type, 38, 46, 75\n\nset union operator |, 75\n\nset() function, 15, 77, 210\n\nset() method\n\nof ConfigParser objects, 334 of Element objects, 577 of Event objects, 440 of Morsel objects, 512\n\n__set__() method, of descriptors, 58, 126\n\nset_authorizer() method, of Connection\n\nobjects, 306\n\nset_boundary() method, of Message\n\nobjects, 556\n\nset_charset() method, of Message objects,\n\n556\n\nset_conversion_mode() function, ctypes\n\nmodule, 617\n\nset_debug() function, gc module, 221\n\nset_default_type() method, of Message\n\nobjects, 556\n\nset_defaults() method, of OptionParser\n\nobjects, 158, 377\n\nset_errno() function, ctypes module, 618\n\nset_executable() function, multiprocessing\n\nmodule, 435\n\nset_last_error() function, ctypes module,\n\n618\n\nset_param() method, of Message objects,\n\n556\n\nset_pasv() method, of FTP objects, 499\n\nset_payload() method, of Message objects,\n\n556\n\nset_progress_handler() method, of\n\nConnection objects, 307\n\nset_proxy() method, of Request objects,\n\n517\n\nset_server_documentation() method, of\n\nXMLRPCServer objects, 528\n\nset_server_name() method, of XMLRPCServer objects, 528\n\nset_server_title() method, of XMLRPCServer\n\nobjects, 528\n\nset_terminator() method, of asynchat\n\nobjects, 453\n\nset_threshold() function, gc module, 221\n\nset_trace() function, pdb module, 186\n\nset_type() method, of Message objects,\n\n557\n\nF h Lib f L Bdff\n\nsettimeout() method, of socket objects\n\n701\n\nset_unixfrom() method, of Message\n\nsetLevel() method\n\nobjects, 557\n\nset_usage() method, of OptionParser\n\nof Handler objects, 364 of Logger objects, 359\n\nobjects, 377\n\nsetmode() function, msvcrt module, 373\n\nset_wakeup_fd() function, signal module,\n\n399\n\nsetattr() function, 210\n\nsetName() method, of Thread objects, 436\n\nsetoutputsize() method, of Cursor objects,\n\n299\n\nand private attributes, 128 __setattr__() method, 57-58, 131\n\nsetpassword() method, of ZipFile objects,\n\n326\n\nand __slots__, 133\n\nsetpgid() function, os module, 381\n\nsetblocking() method, of socket objects,\n\n484\n\nsetcheckinterval() function, sys module,\n\n235\n\nsetpgrp() function, os module, 381\n\nsetprofile() function sys module, 235 threading module, 444\n\nsetcontext() function, decimal module, 248\n\nsetDaemon() method, of Thread objects,\n\n437\n\nsetdefault() method of dicts, 45 of dicts and defaultdict objects, 263 setdefaultencoding() function, sys module,\n\nsetrecursionlimit() function, sys module,\n\n235\n\nsetregid() function, os module, 381\n\nsetreuid() function, os module, 381\n\n_setroot() method, of ElementTree objects,\n\n574\n\n235\n\nsets, 15\n\nsetdefaultencoding() method, sys module,\n\n177\n\nsetdefaulttimeout() function, socket mod-\n\nule, 476\n\nsetdlopenflags() function, sys module, 235\n\nsetDocumentLocator() method, of ContentHandler objects, 581\n\nsetegid() function, os module, 380\n\nseteuid() function, os module, 380\n\nsetFormatter() method, of Handler objects,\n\nadding items, 15 creating from iterable objects, 46 difference operator, 15 equality of, 78 in-place modification of, 47 intersection operator, 15 length of, 75 removing items, 15 symmetric difference operator, 15 union operator, 15 updating, 15\n\n365\n\nsetgid() function, os module, 380\n\nsetsid() function, os module, 381\n\nsetgroups() function, os module, 380\n\nsetslice() function, operator module, 274\n\nsetinputsize() method, of Cursor objects,\n\nsetsockopt() method, of socket objects, 484\n\n299\n\nsetstate() function, random module, 254\n\nsetitem() function, operator module, 274\n\n__setstate__() method, 228\n\n__setitem__() method, 58-59\n\nand slices, 59\n\nand copying, 220 and pickle module, 172\n\nsetitimer() function, signal module, 399\n\n@setter decorator of properties, 126\n\nsettimeout() method, of socket objects, 484\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n702\n\nsetting default encoding of standard I/O\n\nsetting default encoding of standard I/O,\n\n175\n\nsettrace() function\n\nsys module, 235 threading module, 444 setuid() function, os module, 381\n\nsetUp() method\n\nTestCase objects, 184 of TestCase objects, 184\n\nsetup() function, distutils module, 152, 596\n\nsetup() method, of BaseRequestHandler\n\nobjects, 490\n\nsetup.py file\n\nC extensions, 596 SWIG extensions, 620 and setuptools, 154 creating, 152-153 install command, 153-154 installing in per-user site directory, 178\n\nsetuptools library, 147, 154\n\nSetValue() function, winreg module, 411\n\nSetValueEx() function, winreg module, 411\n\nsha1() function, hashlib module, 559\n\nsha224() function, hashlib module, 559\n\nsha256() function, hashlib module, 559\n\nsha384() function, hashlib module, 559\n\nsha512() function, hashlib module, 559\n\nshallow copy, 36\n\nof dicts, 45 of lists, 40 sequence replication, 67\n\nshared arrays, multiprocessing module,\n\n426\n\nshared libraries\n\nextension modules, 148 loading with ctypes, 612\n\nshared memory\n\nexample of passing a list, 427 multiprocessing module, 426\n\nsharing of objects, 35\n\nShelf class, shelve module, 311\n\nshell commands\n\ncollecting output from, 331 emulating in Python, 318\n\nshell pipes, similarity to generators, 106\n\nshelve module, 171, 311 dbhash module, 311 selecting the pickle protocol, 172\n\nshlex module, 588\n\nshort-circuit evaluations, of boolean expres-\n\nsions, 78\n\nshowwarning() function, warnings module,\n\n239\n\nshuffle() function, random module, 255\n\nshutdown() function, logging module, 366\n\nshutdown() method\n\nof BaseManager objects, 431 of SocketServer objects, 492 of socket objects, 484\n\nshutil module, 318\n\nside effects\n\nin functions, 95 reasons to avoid, 96 SIG* signal names, 400\n\nSIGHUP signal, 179\n\nsiginterrupt() function, signal module, 400\n\nsignal handling, 399\n\nsignal module, 399\n\nsignal() function, signal module, 400\n\nsignaling, with semaphores, 439\n\nsignals\n\nclose() method of generators, 104 list of, 400 mixing with threads, 402 throw() method of generators, 105\n\nSIGTERM signal, 179\n\nsimple_producer() function, asynchat mod-\n\nule, 453\n\nSimpleCookie() function, http.cookies mod-\n\nule, 512\n\nSimpleHandler() function, wsgiref.handlers\n\nmodule, 543\n\nSimpleHTTPRequestHandler class,\n\nhttp.server module, 507\n\nSimpleHTTPServer module, see http.server,\n\n506\n\nSimpleXMLRPCServer class, xmlrpc.server\n\nmodule, 527\n\nF h Lib f L Bdff\n\nsorting\n\n703\n\nSimpleXMLRPCServer module, 527\n\nsin() function, math module, 252\n\nof class definitions, 132 optimization, 196\n\nsingle precision floating point, 39\n\nSmalltalk, differences in object system, 124\n\nsingleton tuple, 14\n\nSMTP protocol, example of sending a mes-\n\nsinh() function, math module, 252\n\nsage, 514\n\nsite configuration files, 177\n\nSMTP() function, smtplib module, 514\n\nsite module, 166, 174, 177\n\nsmtpd module, 587\n\nsite-packages directory, 175\n\nSMTPHandler class, logging module, 363\n\nsitecustomize module, 177\n\nsmtplib module, 513\n\nsize attribute\n\nsndhdr module, 588\n\nof Struct objects, 291 of TarInfo objects, 322\n\nsniff() method, of Sniffer objects, 550\n\nSniffer() function, csv module, 550\n\nsize() method\n\nSO_* socket options, socket module, 479\n\nof FTP objects, 499 of mmap objects, 371 Sized abstract base class, 265\n\nSOCK_* constants, socket module, 470\n\nsocket attribute, of SocketServer objects,\n\n492\n\nsizeof() function, ctypes module, 618\n\nsocket module, 469\n\nskippedEntity() method, of ContentHandler\n\nsocket() function, socket module, 476\n\nobjects, 581\n\nsocket, definition of, 449\n\nsleep() function, time module, 406\n\nsocket_type attribute, of SocketServer\n\nsleeping, 406\n\nclass, 493\n\nuntil signal received, 399\n\nSocketHandler class, logging module, 363\n\nslice assignment, lists, 12\n\nsocketpair() function, socket module, 477\n\nslice objects, 51, 53\n\nsockets\n\nand indexing methods, 59 attributes of, 54\n\nslice type, 51\n\nslice() function, 53, 210\n\naddress families, 470 methods on, 478 polling with select(), 459 specifying network addresses, 471 types of, 470\n\nslices, 39\n\nand special methods, 59 and xrange objects, 44 assignment to, 40, 69 deletion of, 40, 69 multidimensional, 59 slicing operator [:], 67-68\n\nSocketServer module, 489 and Python 3, 489 changing server parameters, 492\n\nsoftspace attribute, of files, 161\n\nsort() method, of lists, 40-41\n\nsorted() function, 210\n\non lists, 12 on strings, 11\n\n__slots__ attribute\n\nand __dict__ attribute of instances, 50 compatibility with other code, 133 inheritance, 133\n\nsorting\n\nchanging behavior of, 40 in-place on lists, 40 requirements for objects, 57 reverse order, 40 use of operator module, 275\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n704\n\nsource code encoding\n\nsource code encoding, 31\n\nPython 3, 622\n\nspan() method, of MatchObject objects,\n\n286\n\nspawnl() function, os module, 393\n\nspawnle() function, os module, 393\n\nspawnlp() function, os module, 393\n\nspawnlpe() function, os module, 393\n\nspawnv() function, os module, 392\n\nspawnve() function, os module, 393\n\nspawnvp() function, os module, 393\n\nspawnvpe() function, os module, 393\n\nspecial methods, 21, 54\n\nspecial symbols, 30\n\nspeedup, definition of, 192\n\nsplit() function\n\nos.path module, 398 re module, 284\n\nsplit() method\n\nof Regex objects, 285 of strings, 14, 41, 43\n\nsplitdrive() function, os.path module, 398\n\nsplitext() function, os.path module, 398\n\nsplitlines() method, of strings, 44\n\nsplitting, strings, 14, 43\n\nsplitunc() function, os.path module, 398\n\nSpooledTemporaryFile() function, tempfile\n\nmodule, 324\n\nsprintf() function equivalent, 70\n\nspwd module, 587\n\nSQL queries\n\nSQL injection attack, 300 examples of, 309 executing on database, 297 how to form, 300 similarity to list comprehensions, 111\n\nSQLite database, 303\n\nsqlite3 module, 303\n\nsqrt() function, math module, 252\n\nsqrt() method, of Decimal objects, 243\n\nssl module, 486\n\nSSL, example of creating certificates, 489\n\nst_* attributes, of stat objects, 389\n\nstack frames, 52\n\nin tracebacks, 53 stack size, for threads, 444\n\nstack() function, inspect module, 225\n\nstack_size() function, threading module,\n\n444\n\nStackless Python, 467\n\nstandard I/O streams, 161\n\nand integrated development environ-\n\nments, 162\n\nsetting the default encoding, 175\n\nstandard error, 157\n\nstandard input and output, 10\n\nstandard library reorganization, Python 3,\n\n634\n\nstandard_b64decode() function, base64\n\nmodule, 546\n\nstandard_b64encode() function, base64\n\nmodule, 546\n\nStandardError exception, 87\n\nstarmap() function, itertools module, 272\n\nstart attribute, of slices, 54\n\nstart() method\n\nof BaseManager objects, 431 of MatchObject objects, 286 of Process objects, 416 of Thread objects, 436 of Timer objects, 438 of TreeBuilder objects, 577\n\nstartDocument() method, of\n\nContentHandler objects, 582\n\nstartElement() method, of ContentHandler\n\nobjects, 582\n\nstartElementNS() method, of\n\nContentHandler objects, 582\n\nstartfile() function, os module, 393\n\nstartPrefixMapping() method, of ContentHandler objects, 582\n\nstartswith() method, of strings, 44\n\nstartup script, in interactive mode, 174\n\nstat module, 387, 587\n\nstat() function\n\nos module, 388 os.path module, 398\n\nF h Lib f L Bdff\n\nstrings\n\n705\n\nstat_float_times() function, os module, 389\n\nStreamRequestHandler class, SocketServer\n\nstatement termination, 7 and semicolons, 7\n\nmodule, 491\n\nstreams, 470\n\nstatements\n\nStreamWriter class, codecs module, 278\n\nbreaking across multiple lines, 9 putting on the same line, 25-26 running in the debugger, 186\n\nstreamwriter() method, of CodecInfo\n\nobjects, 278\n\nstrerror() function, os module, 381\n\nstatic method, 22, 48, 123, 125\n\nstrftime() function, time module, 406\n\npractical use of, 123\n\nstrftime() method\n\n@staticmethod decorator, 22, 48, 123, 125,\n\n210\n\nof date objects, 337 of time objects, 338\n\nstatistics, random number distributions,\n\n‘strict’ error handling, Unicode encoding,\n\n255\n\n166\n\nstatus attribute, of HTTPResponse objects,\n\nstring attribute, of MatchObject objects,\n\n504\n\n286\n\nstatvfs() function, os module, 389\n\nstderr attribute, of Popen objects, 404\n\nstderr variable, sys module, 161, 232\n\n__stderr__ variable, sys module, 162, 232\n\nstdin attribute, of Popen objects, 404\n\nstdin variable, sys module, 10, 161, 232\n\n__stdin__ variable, sys module, 162, 232\n\nstdout attribute, of Popen objects, 404\n\nstdout variable, sys module, 10, 161, 232\n\n__stdout__ variable, sys module, 162, 232\n\nstring formatting, 70 !r specifier, 74 !s specifier, 74 alignment, 73 attribute lookup, 72 codes for % operator, 70-71 customizing format() method, 74 dictionaries, 72 dictionary lookup, 72 fill characters, 73 format specifiers, 72 formatting operator %, 70\n\nstep attribute, of slices, 54\n\nStopIteration exception, 59, 87, 215\n\nstring interpolation, 72, 163\n\nand generators, 103\n\nstring literals, 27\n\nstorbinary() method, of FTP objects, 499\n\nstorlines() method, of FTP objects, 499\n\nstr type, 38\n\nstr() function, 11, 56, 76, 210\n\nand print, 162 difference from repr(), 12\n\nUnicode characters, 28 and Unicode encodings, 29 and documentation strings, 30 byte strings, 29 unicode characters in source code, 31\n\nstring module, 287\n\n__str__() method, 55-56\n\nTemplate strings, 164\n\nStreamError exception, tarfile module, 322\n\nstring_at() function, ctypes module, 618\n\nStreamHandler class, logging module, 363\n\nStringIO class, io module, 353\n\nStreamReader class, codecs module, 278\n\nstringprep module, 586\n\nstreamreader() method, of CodecInfo\n\nstrings, 11\n\nobjects, 278\n\nUnicode, 41, 165 and numeric calculations, 11\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n706\n\nstrings\n\nas a dictionary key, 16 as in-memory text files, 353 as sequences, 39 basestring object for type checking,\n\n202\n\nbyte literals, 29 byte strings, 41, 202 case conversion, 43-44 character substitution, 42 comparison of, 70 concatenation, 11 concatenation of adjacent literals, 27 creating custom formatters, 288 disabling escape codes in literals, 29 encoding for URLs, 522 escape codes in literals, 27 escaping characters for use in HTML,\n\n536\n\nescaping characters for use in XML,\n\n583\n\nexecuting Python code contained\n\nwithin, 115\n\nformat() method, 8, 72 formatting, 8, 42 formatting in log messages, 358 immutability of, 41, 69 indexing, 11 internal representation, 28 iterating over characters, 17 joining, 43 line structure, 11 mixing byte strings and Unicode, 70 mutable byte arrays, 202 partitioning, 41 regular expressions, 281 replacing substrings, 41 searching for substrings, 41 slices, 11 sorting and internationalization, 70 specifiers for format() method, 72-73 splitting, 43 splitting into fields, 14, 41 stripping, 43 unescaping XML character references,\n\n583\n\nstrip() method, of strings, 44\n\nstripping\n\ncontrol characters from a string, 42 strings, 44\n\nstrptime() function, time module, 343, 407\n\nstrptime() method, of datetime class, 339\n\nStruct class, struct module, 291\n\nstruct module, 290\n\nStructure class, ctypes module, 614\n\nstructures, and tuples, 14\n\nsub() function\n\noperator module, 273 re module, 284\n\nsub() method, of Regex objects, 285\n\n__sub__() method, 60\n\nsubclass, 119\n\n__subclasscheck__() method, 57, 136\n\nsubdirs attribute, of dircmp objects, 315\n\nSubElement() function,\n\nxml.etree.ElementTree module, 575\n\nsubn() function, re module, 284\n\nsubn() method, of Regex objects, 285\n\nsubprocess module, 402\n\nsubprocess, definition of, 413\n\nsubstitute() method\n\nof Template objects, 289 of Template strings, 164\n\nsubstrings\n\nchecking for existence using in, 69 searching for, 41 subtraction operator -, 65\n\nsucessful() method, of AsyncResult objects,\n\n425\n\nsum() function, 39-40, 67, 210\n\naccuracy of, 252 and decimal module, 69 restriction to numeric data, 39 versus math.fsum() function, 252\n\nsunau module, 588\n\nsuper() function, 120, 210 Python 3, 210, 627\n\nsuperclass, 119\n\ncalling methods in, 120 super() function, 120\n\nF h Lib f L Bdff\n\nTarInfo objects, tarfile module\n\n707\n\nsupporting both Python 2 and 3, 638\n\nsys.prefix variable, 177\n\nsupports_unicode_filenames variable,\n\nsys.ps1 variable, 176\n\nos.path module, 398\n\nsys.ps2 variable, 176\n\nsurrogate pair, 28, 41\n\nsys.stderr variable, 157, 161\n\nsuspension, of threads, 443\n\nsys.stdin variable, 161\n\nswapcase() method, of strings, 44\n\nsys.stdout variable, 161\n\nSWIG, 591\n\nsys_version attribute, of\n\nexample of, 619 interface file, 619 switch statement, lack of, 9\n\nBaseHTTPRequestHandler class, 508\n\nsysconf() function, os module, 395\n\nsyslog module, 587\n\nsymbol module, 586\n\nSysLogHandler class, logging module, 363\n\nsymbolic links, testing a filename for, 397\n\nsystem calls, os module, 378\n\nsymlink() function, os module, 389\n\nsystem error codes, 344\n\nsymmetric difference operator ^, of sets,\n\nsystem() function, os module, 393\n\n15\n\nsystem.listMethods() method, of\n\nsymmetric_difference() method, of sets, 46\n\nServerProxy objects, 525\n\nsymmetric_difference_update() method, of\n\nSystemError exception, 87, 215\n\nsets, 47\n\nsync() method\n\nSystemExit exception, 7, 87-88, 157, 179,\n\n215\n\nof dbm-style database objects, 310 of shelve objects, 311 synchronization primitives\n\nT\n\nmultiprocessing module, 427 threading module, 438\n\nt command line option, 26, 173-174\n\ntab escape code in strings, 28\n\nsynchronization\n\ntabcheck attribute, of sys.flags, 230\n\nof close() method of generators, 104 of concurrent programs, 414 of throw() method of generators, 105\n\nTabError exception, 26, 87, 215\n\ntabnanny module, 586\n\ntabs, and indentation, 26\n\nSyntaxError exception, 87, 215 Python 3 print statement, 6 and default arguments, 93 and except statements, 85 SyntaxWarning warning, 216, 238\n\ntag attribute, of Element objects, 576\n\ntagName attribute, of DOM Element\n\nobjects, 572\n\ntail attribute, of Element objects, 576\n\ntail command, example with generators, 19\n\nsys module, 13, 229\n\ntail-recursion optimization, lack of, 112\n\nsys.argv variable, 13, 157, 174\n\ntakewhile() function, itertools module, 272\n\nsys.displayhook variable, 176\n\ntan() function, math module, 252\n\nsys.exec_prefix variable, 177\n\ntanh() function, math module, 252\n\nsys.exit() function, 179\n\nTarError exception, tarfile module, 322\n\nsys.modules variable, 144, 149\n\nTarFile objects, tarfile module, 320\n\nsys.path variable, 147\n\ntarfile module, 319\n\nand site module, 177 third-party modules, 154\n\nTarInfo objects, tarfile module, 321\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n708\n\ntask scheduler, example with coroutines and select()\n\ntask scheduler, example with coroutines\n\nterminate() method\n\nand select(), 460\n\ntask_done() method\n\nof JoinableQueue objects, 419 of Queue objects, 445\n\nof Pool objects, 425 of Popen objects, 403-404 of Process objects, 416\n\nterminating statements with semicolons, 7\n\ntasklets, 446\n\ntermination\n\nasynchronous I/O, 460\n\nimmediate without garbage collection,\n\ntasks, and coroutines, 20\n\n391\n\ntb_* attributes, of traceback objects, 53\n\ntb_lineno() function, traceback module, 236\n\ntbreak debugger command, pdb module,\n\n189\n\nof programs, 179 of threads, 443 registering cleanup functions, 219 sys.exit() function, 233 without garbage collection, 179\n\ntcgetpgrp() function, os module, 385\n\nTCP connection, diagram of, 450\n\ntermios module, 587\n\nTCP protocol, 449\n\ntest module, 586\n\nexample code, 451\n\ntest() function, cgi module, 537\n\nTCP_* socket options, socket module, 482\n\nTestCase class, unittest module, 184\n\nTCPServer class, SocketServer module, 491\n\ntesting\n\ntcsetpgrp() function, os module, 385\n\ntearDown() method\n\nTestCase objects, 184 of TestCase objects, 184\n\ndoctest module, 181 documentation strings, 181 limitations of doctest, 183 unit testing, 183\n\ntee() function, itertools module, 273\n\ntell() method\n\nof IOBase objects, 350 of files, 160-161 of mmap objects, 371\n\ntestmod() function\n\ndoctest() module, 182 doctest module, 182\n\ntestzip() method, of ZipFile objects, 326\n\nText class, xml.dom.minidom module, 572\n\ntelnetlib module, 587\n\ntext I/O, 353\n\ntempdir variable, tempfile module, 324\n\ntext attribute, of Element objects, 576\n\ntempfile module, 323\n\ntext file mode, 159\n\nTemplate class, string module, 289\n\nTemplate strings\n\nstring module, 164 use in CGI script, 537\n\ntext replacement, replace() method of\n\nstrings, 41\n\ntext versus bytes in Python 3, 629\n\ntext_factory attribute, of Connection\n\nobjects, 308\n\ntemplate attribute, of Template objects,\n\n290\n\nTextIOBase abstract base class, 354\n\ntemplate variable, tempfile module, 324\n\nTextIOWrapper class, io module, 353\n\ntemporary files, 323\n\ntextwrap module, 586\n\nTemporaryFile() function, tempfile module,\n\nthird-party libraries, and Python 3, 621\n\n323\n\nthird-party packages\n\nand C/C++ code, 154 and sys.path variable, 154\n\nF h Lib f L Bdff\n\ntimezone variable, time module\n\n709\n\ninstallation of, 154 installing in per-user site directory, 154,\n\n178\n\nthis pointer, self parameter of methods,\n\n119\n\nThread class, threading module, 436\n\nthread attribute, of Record objects, 359\n\nsignal handling, 402 signaling with semaphores, 439 suspending, 443 synchronization of, 414 termination of, 443 throw() method of generators, 105 use of queues, 444 worker thread example, 446\n\nthreading module, 436\n\nsynchronization primitives, 438 ThreadingMixIn class, SocketServer mod-\n\nthreadsafety variable, database API, 302\n\nthrow() method, of generators, 53, 105-106\n\nule, 494\n\ntime and date parsing, 407\n\nThreadingTCPServer class, SocketServer\n\nmodule, 494\n\ntime class, datetime module, 338\n\nThreadingUDPServer class, SocketServer\n\ntime manipulation, 336\n\nmodule, 494\n\ntime module, 191, 405\n\nthreadName attribute, of Record objects,\n\n359\n\naccuracy of time functions, 408 current time, 405\n\nthreads\n\ntime parsing, 343\n\nCPU-bound tasks, 444 adding to network servers, 494 atomic operations and disassembly, 193 check interval, 234 close() method of generators, 104 compared to coroutines, 467 condition variables, 441 daemonic, 436 database modules, 302 decimal module, 249 definition of, 413 events, 440 extension modules, 607 global interpreter lock, 414, 444 local storage, 443 main thread, 413 mutex lock, 438 obtaining number of active, 443 random number generation, 256 reentrant mutex lock, 438 scaling properties, 415 scheduling of, 414 semaphores, 439 setting stack size, 444 setting the name, 436\n\nTime() function, database API, 301\n\ntime() function, time module, 191, 407\n\ntime() method, of datetime objects, 340\n\ntimedelta class, datetime module, 340\n\nTimedRotatingFileHandler class, logging\n\nmodule, 363\n\nTimeFromTicks() function, database API,\n\n301\n\ntimeit module, 191\n\ntimeit() function\n\ncProfile module, 190 timeit module, 191\n\ntimeout attribute, of SocketServer class,\n\n493\n\ntimeout exception, socket module, 485\n\ntimeout, example with alarm signals, 401\n\nTimer() function, threading module, 437\n\ntimes() function, os module, 394\n\nTimestamp() function, database API, 301\n\nTimestampFromTicks() function, database\n\nAPI, 301\n\ntimetuple() method, of date objects, 337\n\ntimetz() method, of datetime objects, 340\n\ntimezone variable, time module, 405\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n710\n\ntiming measurements\n\ntiming measurements, 191\n\nTIPC protocol, 470\n\naddress format, 472\n\nTIPC_* constants, socket module, 473\n\ntitle() method, of strings, 44\n\nTkinter module, 588\n\ntoday() method, of date class, 336\n\ntofile() method, of array objects, 260\n\ntoken module, 586\n\ntokenize module, 586\n\ntolist() method, of array objects, 260\n\ntoordinal() method, of date objects, 337\n\ntoprettyxml() method, of DOM Node\n\nobjects, 572\n\ntostring() function, xml.etree.ElementTree\n\nmodule, 578\n\ntostring() method, of array objects, 260\n\ntotal_changes attribute, of Connection\n\nobjects, 308\n\ntounicode() method, of array objects, 260\n\ntoxml() method, of DOM Node objects, 573\n\ntrace() function, inspect module, 225\n\ntraceback messages, 22\n\ntraceback module, 235\n\ntraceback objects, 51-52 attributes of, 53 stack frames, 53\n\n__traceback__ attribute, of Exception\n\nobjects, 213\n\ntracebacklimit variable, sys module, 232\n\ntracebacks\n\ncreating with traceback module, 236 limiting the amount of output, 232\n\nTracebackType type, 51, 237\n\ntrailing J on complex number literals, 27\n\ntrailing L on long integers, 27\n\ntrailing comma\n\nand tuples, 14 print statement, 162\n\ntransfercmd() method, of FTP objects, 500\n\ntranslate() method, of strings, 42, 44\n\ntraps attribute, of Context objects, 247\n\nTreeBuilder() function,\n\nxml.etree.ElementTree module, 577\n\ntriangular() function, random module, 256\n\ntriple-quoted strings, 11\n\nand variable interpolation, 163\n\nTrue value, 9, 27, 38\n\ntruediv() function, operator module, 273\n\n__truediv__() method, 60\n\ntrunc() function, math module, 252\n\ntruncate() method\n\nof IOBase objects, 350 of files, 160\n\ntruncating division operator //, 65\n\ntruncation, of integer division, 61, 65\n\ntruth value testing, 78\n\ntruth values, 9\n\ntruth() function, operator module, 274\n\ntry statement, 22, 84-85\n\ntt command line option, 26, 173-174\n\ntty module, 587\n\nttyname() function, os module, 385\n\ntuning strategies, 194\n\ntuple type, 38\n\ntuple unpacking, and for-loops, 15\n\ntuple() function, 77, 211\n\ntuples, 14\n\nand string formatting, 70 as dictionary key, 16 as dictionary keys, 74 as sequence, 39 comparison on, 70 concatenation, 14 creating a list of from dictionary, 45 creating with named attributes, 264 immutability, 14 immutability of, 69 indexing, 14 memory savings of, 14 omission of parantheses, 14 problems with using as data structure,\n\n264\n\nrepresenting records, 14 singleton, 14\n\nF h Lib f L Bdff\n\nunary plus operator +\n\n711\n\nslicing, 14 unpacking in Python 3, 623 unpacking in iteration, 82 use by standard library, 265 use in list comprehensions, 109 versus lists, 14\n\nTwisted library, 415, 467\n\ntwo-dimensional lists, 13, 15\n\ntype, 47\n\ntype attribute\n\ntypes\n\nboolean, 38 built-in, 37, 201 callable, 47 dictionary, 44 floating point, 38 frozenset, 46 integers, 38 of sockets, 470 set, 46 type of, 47\n\nof FieldStorage objects, 535 of TarInfo objects, 322 of socket objects, 484\n\ntzinfo attribute, of time objects, 338\n\ntzname variable, time module, 405\n\ntype checking\n\ntzname() method\n\nexample with metaclass, 140 of objects, 34 performance impact of, 34 problem with proxy objects, 135 type coercion, and operator overloading,\n\nof time objects, 339 of tzinfo objects, 342\n\ntzset() function, time module, 407\n\nU\n\n134\n\ntype comparison of objects, 34\n\ntype conversion, 76\n\nlack of implicit conversion, 62 of columns in a datafile, 37 special methods for, 62\n\n\\U escape code, in strings, 28\n\n\\u escape code, in strings, 28\n\nU command line option, 28, 173\n\n‘U’ mode, to open() function, 159\n\nu character, before a string literal, 28\n\ntype hierarchies, 138\n\nu command line option, 173\n\ntype objects, 50\n\nu(p) debugger command, pdb module, 189\n\ntype of objects, 33\n\nUDP client example, 486\n\ntype() function, 34, 211 and exceptions, 89 type() metaclass, 138\n\nUDP communication, diagram of, 451\n\nUDP protocol, 449\n\nUDP server example, 485\n\ntype_options attribute, of FieldStorage\n\nUDPServer class, SocketServer module,\n\nobjects, 535\n\n491\n\ntypecode attribute, of array objects, 259\n\nuid attribute, of TarInfo objects, 322\n\nTypeError exception, 87, 215 and function calls, 94 and type coercion, 62 method resolution order, 122\n\numask() function, os module, 381\n\nunalias debugger command, pdb module,\n\n189\n\nuname attribute, of TarInfo objects, 322\n\ntypes module, 47, 237 and Python 3, 237\n\nuname() function, os module, 381\n\nunary minus operator -, 65\n\nunary plus operator +, 65\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n712\n\nunbound method\n\nunbound method, 49 and Python 3, 49\n\nUnboundLocalError exception, 87, 98, 215\n\nunbuffered file I/O, 159\n\nunconsumed_tail attribute, of decompres-\n\nsobj objects, 329\n\nunderscores, usage in identifiers, 26\n\nunescape() function, xml.sax.saxutils mod-\n\nule, 583\n\nungetch() function, msvcrt module, 373\n\nungetwch() function, msvcrt module, 373\n\nunhexlify() function, binascii module, 548\n\nunichr() function, 77, 211\n\nUnicode character database, 293\n\nUnicode characters, representation of, 41\n\nUnicode string literals, 28\n\nUnicode strings, 41 and WSGI, 541 common encodings, 166 decomposing, 295 encoding and decoing, 165 encoding in network programs, 452 error handling options, 166 handling of, 165 mixing with byte strings, 167 normalizing, 296 regular expressions, 281\n\nunicode attribute, of sys.flags, 230\n\nunicode type, 38\n\nunicode() function, 211 and Python 3, 211\n\nUnicode\n\nPython 2 vs. Python 3, 28 and BOM characters, 168 and XML, 168 byte order marker, 280 character encoding and decoding, 42 character properties database, 170 code points, 28 common encodings, 168-169 encoding in string literals, 29 encoding of source code, 31 file I/O, 167 mixing with byte strings, 70\n\nnormalization of strings, 171 specifying characters in string literals,\n\n28\n\nsurrogate pairs, 28, 41 using 32-bit character code points, 41\n\nunicode-escape encoding, description of,\n\n170\n\nunicodedata module, 170, 293\n\nUnicodeDecodeError exception, 87, 215\n\nUnicodeEncodeError exception, 87, 215 Python 3 interactive mode, 175 UnicodeError exception, 87, 166, 215\n\nUnicodeTranslateError exception, 87, 215\n\nunidata_version variable, unicodedata mod-\n\nule, 296\n\nunification of integer and long types, 38\n\nuniform access principle, 125\n\nuniform type arrays, 259\n\nuniform() function, random module, 255\n\nUnimplementedFileMode exception,\n\nhttp.client module, 504\n\nUnion class, ctypes module, 614\n\nunion operator |, of sets, 15\n\nunion() method, of sets, 46\n\nunit testing\n\nPython 3 migration, 635 example, 184 unittest module, 183\n\nunittest module, 183 example, 184\n\nuniversal newline mode, 159\n\nUNIX domain protocol, 470 address format, 472\n\nUnix systems log, issuing message to, 363\n\nUnix\n\n#! execution of programs, 6 per-user site directory, 177 time epoch definition, 405\n\nUnixDatagramServer class, SocketServer\n\nmodule, 491\n\nUnixStreamServer class, SocketServer mod-\n\nule, 491\n\nUnknownHandler class, urllib.request mod-\n\nule, 518\n\nF h Lib f L Bdff\n\nUserWarning warning\n\n713\n\nUnknownProtocol exception, http.client\n\nupper() method, of strings, 44\n\nmodule, 504\n\nuppercase variable, string module, 287\n\nUnknownTransferEncoding exception,\n\nhttp.client module, 504\n\nunlink() function, os module, 390\n\nurandom() function, os module, 396\n\nurldefrag() function, urllib.parse module,\n\n521\n\nunloading modules, 149\n\nurlencode() function, urllib.parse module,\n\nunpack() function, struct module, 290\n\n522\n\nunpack() method, of Struct objects, 291\n\nURLError exception, 516\n\nunpack_from() function, struct module, 291\n\nurllib.error module, 523\n\nunpack_from() method, of Struct objects,\n\nurljoin() function, urllib.parse module, 521\n\n291\n\nurllib module, 522\n\nunpacking\n\nsee urllib.request, 515\n\nbinary data structures, 290 of sequences, 67-68 of tuples, 14\n\nurllib package, 514\n\nurllib.error module, 523\n\nurllib.parse module, 520\n\nUnpickler class, pickle module, 228\n\nurllib.request module, 515\n\nunquote() function, urllib.parse module,\n\n522\n\nunquote_plus() function, urllib.parse mod-\n\nule, 522\n\nurllib.response module, 520\n\nurllib.robotparser module, 523\n\nurllib2 module, see urllib.request, 515\n\nunquote_to_bytes() function, urllib.parse\n\nmodule, 522\n\nurlopen() function, urllib.request module,\n\n515\n\nunregister() method, of Poll objects, 460\n\nurlparse module, 520\n\nunregister_dislect() function, csv module,\n\n551\n\nurlparse() function, urllib.parse module,\n\n520\n\nunsetenv() function, os module, 381\n\nuntil debugger command, pdb module, 189\n\nunused_data attribute, of decompressobj\n\nobjects, 329\n\nunwrap() method, of ssl objects, 488\n\nupdate() method of dicts, 45 of digest objects, 559 of hmac objects, 560 of sets, 15, 47\n\nurlsafe_b64decode() function, base64 mod-\n\nule, 546\n\nurlsafe_b64encode() function, base64 mod-\n\nule, 546\n\nurlsplit() function, urllib.parse module, 521\n\nurlunparse() function, urllib.parse module,\n\n521\n\nurlunsplit() function, urllib.parse module,\n\n521\n\nuser directory, installation of packages, 154\n\nuser module, 586\n\nupdate_wrapper() function, functools mod-\n\nule, 269\n\n—user option to setup.py, 154\n\nupdating a dictionary, 45\n\nuploading\n\nfiles in CGI scripts, 536 files to a HTTP server with POST, 505 files to an FTP server, 500 packages to pypi, 155\n\nuser-agent header in HTTP requests, chang-\n\ning, 517\n\nusername attribute\n\nof urlparse objects, 520 of urlsplit objects, 521 UserWarning warning, 216, 238\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n714\n\nusing Python as a calculator\n\nusing Python as a calculator, 6\n\nutcfromtimestamp() method, of datetime\n\nclass, 339\n\nutcnow() method, of datetime class, 339\n\nutcoffset() method\n\nof time objects, 339 of tzinfo objects, 342\n\nutctimetuple() method, of datetime objects,\n\n340\n\nUTF-16 encoding, description of, 170\n\nUTF-8\n\ncompatibility with ASCII, 170 description of, 169-170 encoding and decoding, 42 including in string literals, 29 lexicographic ordering, 170\n\nutime() function, os module, 390\n\nuu module, 587\n\nV\n\nV command line option, 173\n\nv command line option, 173-174\n\nvalidator() function, wsgiref.handlers mod-\n\nule, 543\n\nvalue attribute\n\nof FieldStorage objects, 535 of Morsel objects, 512\n\nValue() function, multiprocessing module,\n\n426\n\nValue() method, of Manager objects, 429\n\nValueError exception, 87, 215\n\nand lists, 40 and strings, 41\n\nvaluerefs() method, of WeakValueDictionary\n\nobjects, 241\n\nvalues() method\n\nof Message objects, 552 of dicts, 45 of dicts in Python 3, 632\n\nValuesView abstract base class, 266\n\nvariable interpolation in strings, 163\n\nvariable keyword arguments in function\n\ndefinition, 95\n\nvariable number of arguments in function\n\ndefinition, 94\n\nvariables, 7\n\nas names of objects, 35 binding and module imports, 145 binding of globals in functions, 98 class, 117-118 in nested functions, 97 iteration, 82 naming rules, 26 scope of, 96, 98 vars() function, 72, 211\n\nverbose attribute, of sys.flags, 230\n\nverify_request() method, of SocketServer\n\nclass, 493\n\nversion attribute, of HTTPResponse objects,\n\n504\n\nversion information, of interpreter, 231\n\nversion variable, sys module, 232\n\nversion_info variable, sys module, 232\n\nvformat() method, of Formatter objects,\n\n288\n\nview objects, Python 3, 632\n\nvolume attribute, of ZipInfo objects, 327\n\nvonmisesvariate() function, random mod-\n\nule, 256\n\nW\n\nW command line option, 216, 239-240\n\n‘w’ mode, to open() function, 159\n\nw(here) debugger command, pdb module,\n\n189\n\nwait() function, os module, 394\n\nwait() method\n\nof AsyncResult objects, 425 of Condition objects, 441 of Event objects, 440 of Popen objects, 404\n\nwait3() function, os module, 394\n\nwait4() function, os module, 394\n\nwaitpid() function, os module, 394\n\nwalk() function, os module, 390\n\nwalk() method, of Message objects, 554\n\nF h Lib f L Bdff",
      "page_number": 718
    },
    {
      "number": 36,
      "title": "Segment 36 (pages 739-742)",
      "start_page": 739,
      "end_page": 742,
      "detection_method": "synthetic",
      "content": "wrappers, and attribute binding methods\n\n715\n\nwall-clock time, obtaining, 191\n\nwhile statement, 8, 82\n\nwarn() function, warnings module, 216,\n\nwhitespace variable, string module, 287\n\n239\n\nWIFCONTINUED() function, os module, 395\n\nwarn_explicit() function, warnings module,\n\n239\n\nWarning warning, 216, 238\n\nwarning() method, of Logger objects, 357\n\nwarnings module, 238\n\nwarnings\n\nconverting into exceptions, 239 difference from exceptions, 216 suppression of, 238\n\nWIFEXITED() function, os module, 394\n\nWIFSIGNALED() function, os module, 395\n\nWIFSTOPPED() function, os module, 395\n\nWinDLL() function, ctypes module, 612\n\nWindows, 331\n\naccesing registry, 408 accessing registry, 175 creating a binary distribution with dis-\n\ntutils, 153\n\nwarnoptions variable, sys module, 232\n\ndouble-clicking on Python programs,\n\nWatchedFileHandler class, logging module,\n\n176\n\n363\n\nwave module, 588\n\nWCOREDUMP() function, os module, 394\n\nweak reference, 130\n\ndrive letters in filenames, 399 file locking, 373 issuing message to event log, 362 list of error codes, 346 main program with multiprocessing\n\nweak references, 240\n\nmodule, 417\n\nWeakKeyDictionary class, weakref module,\n\n241\n\nweakref module, 130, 240\n\nWeakValueDictionary class, weakref mod-\n\nper-user site directory, 177 process fork with multiprocessing, 435 running programs, 6 WindowsError exception, 215\n\nule, 241\n\nweb frameworks, 538\n\nand template strings, 164\n\nweb programming, 531\n\nWing IDE, 5\n\nwinreg module, 408\n\nwinsound module, 588\n\nweb server\n\nwinver variable, sys module, 232\n\ncustom handling of requests, 510 running standalone in Python, 508\n\nwebbrowser module, 544\n\nweekday() method, of date objects, 338\n\nweibullvariate() function, random module,\n\nwith statement, 62, 89 and exceptions, 23 and locking, 89 decimal module, 248 locking primitives, 442 work pools, of processes, 424\n\n256\n\nwell known port numbers, 450\n\nwrap_socket() function, ssl module, 486\n\nWEXITSTATUS() function, os module, 394\n\nwfile attribute\n\nof BaseHTTPRequestHandler objects,\n\n509\n\nwrapper functions, 95 and closures, 100 example of, 101 in extension modules, 594\n\nof StreamRequestHandler objects, 491\n\nwrappers, and attribute binding methods,\n\nwhichdb module, 310\n\n132\n\nwhichdb() function, dbm module, 310\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff\n\n716\n\nwraps decorator, functools module\n\n@wraps decorator, functools module, 114,\n\n269\n\nwritable() method\n\nof IOBase objects, 350 of dispatcher objects, 456 write() function, os module, 385\n\nwrite() method\n\nof BufferWriter objects, 352 of ConfigParser objects, 334 of ElementTree objects, 575 of FileIO objects, 350 of StreamWriter objects, 278 of TextIOWrapper objects, 353 of ZipFile objects, 326 of files, 10, 159-160 of mmap objects, 372 of ssl objects, 488\n\nwrite_byte() method, of mmap objects, 372\n\nwritelines() method\n\nof IOBase objects, 350 of StreamWriter objects, 278 of files, 159-160\n\nwritepy() method, of ZipFile objects, 326\n\nwriter() function, csv module, 549\n\nwriterow() method\n\nof csv DictWriter objects, 550 of csv writer objects, 549\n\nwriterows() method\n\nof csv DictWriter objects, 550 of csv writer objects, 550\n\nwritestr() method, of ZipFile objects, 327\n\nwritexml() method, of DOM Node objects,\n\n573\n\nwriting to a file, 159\n\nWSGI (Web Server Gateway Interface), 540\n\nWSGI\n\napplication specification, 540 example of, 541 integration with web frameworks, 543 processing form fields, 541 running a stand-alone server, 542 running in CGI scripts, 542 use of generators for I/O, 165 validation of applications, 543\n\nwsgi.* environment variables, 540\n\nwsgiref package, 542\n\nwsgiref.handlers module, 542\n\nwsgiref.simple_server module, 542\n\nWSTOPSIG() function, os module, 395\n\nwstring_at() function, ctypes module, 618\n\nWTERMSIG() function, os module, 395\n\nX\n\n\\x escape code, in strings, 28\n\nx command line option, 173-174\n\nxdrlib module, 587\n\nxml package, 568\n\nXML() function, xml.etree.ElementTree mod-\n\nule, 575\n\nXML\n\nescaping and unescaping characters,\n\n583\n\nexample document, 569 incremental parsing of large files, 579 namespaces in ElementTree module,\n\n578\n\nparsing, 568\n\nXML-RPC, 524\n\nXML-RPC server, multithreaded example,\n\n494\n\nXML-RPC\n\nexample of, 529 server customization, 530 xml.dom.minidom module, 570\n\nxml.etree.ElementTree module, 573\n\nxml.sax module, 580\n\nxml.sax.saxutils module, 583\n\n‘xmlcharrefreplace’ error handling, 166-167\n\nXMLGenerator() function, xml.sax.saxutils\n\nmodule, 584\n\nXMLID() function, xml.etree.ElementTree\n\nmodule, 575\n\nxmlrpc package, 524\n\nxmlrpc.client module, 524\n\nxmlrpc.server module, 527\n\nxmlrpclib module, 524\n\nF h Lib f L Bdff\n\nZipInfo() function, zipfile module\n\n717\n\nXMLRPCServer class, xmlrpc.server mod-\n\nule, 527\n\nxor() function, operator module, 274\n\n__xor__() method, 60\n\nXPATH, 569\n\nxrange type, 38\n\nxrange() compared to a list, 44\n\nxrange() function, 17, 44, 211 and Python 3, 17, 44, 211\n\nXSLT, 569\n\nY\n\nY2K handling, 407\n\nyear attribute, of date objects, 337\n\nyield expressions, 20, 104\n\nyield statement, 19, 53, 102 and context managers, 90 use with I/O, 164-165\n\nZ\n\nZeroDivisionError exception, 87, 215\n\nzfill() method, of strings, 44\n\n.zip files\n\nand modules, 147 decoding and encoding, 324 use as a code archive, 147\n\nzip() function, 83, 211 and Python 3, 211 future_builtins module, 217 type-conversion example, 37\n\nzipfile module, 324\n\nZipFile() function, zipfile module, 325\n\nzipimport module, 586\n\nZipInfo() function, zipfile module, 325\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "page_number": 739
    }
  ],
  "pages": [
    {
      "page_number": 2,
      "content": "Python\n\nE S S E N T I A L R E F E R E N C E\n\nFourth Edition\n\nF h Lib f L Bdff",
      "content_length": 77,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 3,
      "content": "Developer’s Library ESSENTIAL REFERENCES FOR PROGRAMMING PROFESSIONALS\n\nDeveloper’s Library books are designed to provide practicing programmers with unique, high-quality references and tutorials on the programming languages and technologies they use in their daily work.\n\nAll books in the Developer’s Library are written by expert technology practitioners who are especially skilled at organizing and presenting information in a way that’s useful for other programmers.\n\nKey titles include some of the best, most widely acclaimed books within their topic areas:\n\nPHP and MySQL Web Development Luke Welling & Laura Thomson ISBN 978-0-672-32916-6\n\nPython Essential Reference David Beazley ISBN-13: 978-0-672-32862-6\n\nMySQL Paul DuBois ISBN-13: 978-0-672-32938-8\n\nProgramming in Objective-C Stephen G. Kochan ISBN-13: 978-0-321-56615-7\n\nLinux Kernel Development Robert Love ISBN-13: 978-0-672-32946-3\n\nPostgreSQL Korry Douglas ISBN-13: 978-0-672-33015-5\n\nDeveloper’s Library books are available at most retail and online bookstores, as well as by subscription from Safari Books Online at safari.informit.com\n\nDeveloper’s Library informit.com/devlibrary\n\nF h Lib f L Bdff",
      "content_length": 1168,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 4,
      "content": "Python\n\nE S S E N T I A L R E F E R E N C E\n\nFourth Edition\n\nDavid M. Beazley\n\nUpper Saddle River, NJ • Boston • Indianapolis • San Francisco New York • Toronto • Montreal • London • Munich • Paris • Madrid Cape Town • Sydney • Tokyo • Singapore • Mexico City\n\nF h Lib f L Bdff",
      "content_length": 277,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 5,
      "content": "Python Essential Reference Fourth Edition Copyright © 2009 by Pearson Education, Inc.\n\nAll rights reserved. No part of this book shall be reproduced, stored in a retrieval system, or transmitted by any means, electronic, mechani- cal, photocopying, recording, or otherwise, without written permission from the publisher. No patent liability is assumed with respect to the use of the information contained herein. Although every precaution has been taken in the preparation of this book, the publisher and author assume no responsibility for errors or omissions. Nor is any liability assumed for damages resulting from the use of the informa- tion contained herein.\n\nISBN-13: 978-0-672-32978-4 ISBN-10: 0-672-32978-6\n\nPrinted in the United States of America\n\nFirst Printing June 2009\n\nLibrary of Congress Cataloging-in-Publication data is on file.\n\nTrademarks All terms mentioned in this book that are known to be trademarks or service marks have been appropriately capitalized. Addison-Wesley cannot attest to the accuracy of this information. Use of a term in this book should not be regarded as affecting the validity of any trade- mark or service mark.\n\nWarning and Disclaimer Every effort has been made to make this book as complete and as accurate as possible, but no warranty or fitness is implied. The infor- mation provided is on an “as is” basis. The author and the publisher shall have neither liability nor responsibility to any person or entity with respect to any loss or damages arising from the information con- tained in this book.\n\nBulk Sales Addison-Wesley offers excellent discounts on this book when ordered in quantity for bulk purchases or special sales. For more information, please contact\n\nU.S. Corporate and Government Sales\n\n1-800-382-3419\n\ncorpsales@pearsontechgroup.com\n\nFor sales outside of the U.S., please contact\n\nInternational Sales\n\ninternational@pearson.com\n\nTo register this product and gain access to bonus content, go to www.informit.com/register to sign in and enter the ISBN. After you register the product, a link to the additional content will be listed on your Account page, under Registered Products.\n\nAcquisitions Editor Mark Taber\n\nDevelopment Editor Michael Thurston\n\nManaging Editor Patrick Kanouse\n\nProject Editor Seth Kerney\n\nCopy Editor Lisa Thibault\n\nIndexer David Beazley\n\nProofreader Megan Wade\n\nTechnical Editors Noah Gift Kurt Grandis\n\nPublishing Coordinator Vanessa Evans\n\nBook Designer Gary Adair\n\nCompositor Bronkella Publishing\n\nF h Lib f L Bdff",
      "content_length": 2506,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 6,
      "content": "❖\n\nFor Paula,Thomas., and his brother on the way.\n\n❖\n\nF h Lib f L Bdff",
      "content_length": 70,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 7,
      "content": "Contents at a Glance\n\nIntroduction\n\n1\n\nPart I: The Python Language\n\n1 A Tutorial Introduction\n\n5\n\n2 Lexical Conventions and Syntax\n\n25\n\n3 Types and Objects\n\n33\n\n4 Operators and Expressions\n\n65\n\n5 Program Structure and Control Flow 81\n\n6 Functions and Functional Programming\n\n93\n\n7 Classes and Object-Oriented Programming\n\n117\n\n8 Modules, Packages, and Distribution\n\n143\n\n9 Input and Output\n\n157\n\n10 Execution Environment\n\n173\n\n11 Testing, Debugging, Profiling, and Tuning\n\n181\n\nPart II: The Python Library\n\n12 Built-In Functions\n\n201\n\n13 Python Runtime Services\n\n219\n\n14 Mathematics\n\n243\n\n15 Data Structures, Algorithms, and Code Simplification\n\n16 String and Text Handling\n\n277\n\n17 Python Database Access\n\n297\n\n18 File and Directory Handling\n\n313\n\n19 Operating System Services\n\n331\n\n20 Threads and Concurrency\n\n413\n\n21 Network Programming and Sockets\n\n449\n\n22 Internet Application Programming\n\n497\n\n23 Web Programming\n\n531\n\n24 Internet Data Handling and Encoding\n\n545\n\n25 Miscellaneous Library Modules\n\n585\n\nPart III: Extending and Embedding\n\n26 Extending and Embedding Python\n\n591\n\nAppendix: Python 3 621\n\nIndex\n\n639\n\n257\n\nF h Lib f L Bdff",
      "content_length": 1141,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 8,
      "content": "Table of Contents\n\nIntroduction 1\n\nI: The Python Language\n\n1 A Tutorial Introduction 5\n\nRunning Python 5\n\nVariables and Arithmetic Expressions 7\n\nConditionals 9\n\nFile Input and Output 10\n\nStrings 11\n\nLists 12\n\nTuples 14\n\nSets 15\n\nDictionaries 16\n\nIteration and Looping 17\n\nFunctions 18\n\nGenerators 19\n\nCoroutines 20\n\nObjects and Classes 21\n\nExceptions 22\n\nModules 23\n\nGetting Help 24\n\n2 Lexical Conventions and Syntax 25\n\nLine Structure and Indentation 25\n\nIdentifiers and Reserved Words 26\n\nNumeric Literals 26\n\nString Literals 27\n\nContainers 29\n\nOperators, Delimiters, and Special Symbols 30\n\nDocumentation Strings 30\n\nDecorators 30\n\nSource Code Encoding 31\n\n3 Types and Objects 33\n\nTerminology 33\n\nObject Identity and Type 33\n\nReference Counting and Garbage Collection 34\n\nReferences and Copies 35\n\nF h Lib f L Bdff",
      "content_length": 818,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 9,
      "content": "viii\n\nContents\n\nFirst-Class Objects 36\n\nBuilt-in Types for Representing Data 37\n\nThe None Type 38\n\nNumeric Types 38\n\nSequence Types 39\n\nMapping Types 44\n\nSet Types 46\n\nBuilt-in Types for Representing Program Structure 47\n\nCallable Types 47\n\nClasses, Types, and Instances 50\n\nModules 50\n\nBuilt-in Types for Interpreter Internals 51\n\nCode Objects 51\n\nFrame Objects 52\n\nTraceback Objects 52\n\nGenerator Objects 53\n\nSlice Objects 53\n\nEllipsis Object 54\n\nObject Behavior and Special Methods 54\n\nObject Creation and Destruction 54\n\nObject String Representation 55\n\nObject Comparison and Ordering 56\n\nType Checking 57\n\nAttribute Access 57\n\nAttribute Wrapping and Descriptors 58\n\nSequence and Mapping Methods 58\n\nIteration 59\n\nMathematical Operations 60\n\nCallable Interface 62\n\nContext Management Protocol 62\n\nObject Inspection and dir()\n\n63\n\n4 Operators and Expressions 65\n\nOperations on Numbers 65\n\nOperations on Sequences 67\n\nString Formatting 70\n\nAdvanced String Formatting 72\n\nOperations on Dictionaries 74\n\nOperations on Sets 75\n\nAugmented Assignment 75\n\nF h Lib f L Bdff",
      "content_length": 1068,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 10,
      "content": "Contents\n\nix\n\nThe Attribute (.) Operator 76\n\nThe Function Call () Operator 76\n\nConversion Functions 76\n\nBoolean Expressions and Truth Values 77\n\nObject Equality and Identity 78\n\nOrder of Evaluation 78\n\nConditional Expressions 79\n\n5 Program Structure and Control Flow 81\n\nProgram Structure and Execution 81\n\nConditional Execution 81\n\nLoops and Iteration 82\n\nExceptions 84\n\nBuilt-in Exceptions 86\n\nDefining New Exceptions 88\n\nContext Managers and the with Statement 89 Assertions and __debug__ 91\n\n6 Functions and Functional Programming 93\n\nFunctions 93\n\nParameter Passing and Return Values 95\n\nScoping Rules 96\n\nFunctions as Objects and Closures 98\n\nDecorators 101\n\nGenerators and yield 102\n\nCoroutines and yield Expressions 104\n\nUsing Generators and Coroutines 106\n\nList Comprehensions 108\n\nGenerator Expressions 109\n\nDeclarative Programming 110\n\nThe lambda Operator 112\n\nRecursion 112\n\nDocumentation Strings 113\n\nFunction Attributes 114 eval(), exec(), and compile() 115\n\n7 Classes and Object-Oriented Programming 117\n\nThe class Statement 117\n\nClass Instances 118\n\nScoping Rules 118\n\nInheritance 119\n\nF h Lib f L Bdff",
      "content_length": 1118,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 11,
      "content": "x\n\nContents\n\nPolymorphism Dynamic Binding and Duck Typing 122\n\nStatic Methods and Class Methods 123\n\nProperties 124\n\nDescriptors 126\n\nData Encapsulation and Private Attributes 127\n\nObject Memory Management 128\n\nObject Representation and Attribute Binding 131 __slots__ 132\n\nOperator Overloading 133\n\nTypes and Class Membership Tests 134\n\nAbstract Base Classes 136\n\nMetaclasses 138\n\nClass Decorators 141\n\n8 Modules, Packages, and Distribution 143\n\nModules and the import Statement 143\n\nImporting Selected Symbols from a Module 145\n\nExecution as the Main Program 146\n\nThe Module Search Path 147\n\nModule Loading and Compilation 147\n\nModule Reloading and Unloading 149\n\nPackages 149\n\nDistributing Python Programs and Libraries 152\n\nInstalling Third-Party Libraries 154\n\n9 Input and Output 157\n\nReading Command-Line Options 157\n\nEnvironment Variables 158\n\nFiles and File Objects 158\n\nStandard Input, Output, and Error 161 The print Statement 162 The print() Function 163\n\nVariable Interpolation in Text Output 163\n\nGenerating Output 164\n\nUnicode String Handling 165\n\nUnicode I/O 167\n\nUnicode Data Encodings 168\n\nUnicode Character Properties 170\n\nObject Persistence and the pickle Module 171\n\nF h Lib f L Bdff",
      "content_length": 1203,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 12,
      "content": "Contents\n\nxi\n\n10 Execution Environment 173\n\nInterpreter Options and Environment 173\n\nInteractive Sessions 175\n\nLaunching Python Applications 176\n\nSite Configuration Files 177\n\nPer-user Site Packages 177\n\nEnabling Future Features 178\n\nProgram Termination 179\n\n11 Testing, Debugging, Profiling, and Tuning 181\n\nDocumentation Strings and the doctest Module 181\n\nUnit Testing and the unittest Module 183\n\nThe Python Debugger and the pdb Module 186\n\nDebugger Commands 187\n\nDebugging from the Command Line 189\n\nConfiguring the Debugger 190\n\nProgram Profiling 190\n\nTuning and Optimization 191\n\nMaking Timing Measurements 191\n\nMaking Memory Measurements 192\n\nDisassembly 193\n\nTuning Strategies 194\n\nII: The Python Library 199\n\n12 Built-In Functions and Exceptions 201\n\nBuilt-in Functions and Types 201\n\nBuilt-In Exceptions 212\n\nException Base Classes 212\n\nException Instances 212\n\nPredefined Exception Classes 213\n\nBuilt-In Warnings 216\n\nfuture_builtins 217\n\n13 Python Runtime Services 219\n\natexit 219\n\ncopy 219\n\nNotes 220\n\nF h Lib f L Bdff",
      "content_length": 1032,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 13,
      "content": "xii\n\nContents\n\ngc 220\n\nNotes 222\n\ninspect 222\n\nmarshal 226\n\nNotes 226\n\npickle 226\n\nNotes 229\n\nsys 229\n\nVariables 229\n\nFunctions 233\n\ntraceback 235\n\ntypes 237\n\nNotes 237\n\nwarnings 238\n\nNotes 239\n\nweakref 240\n\nExample 242\n\nNotes 242\n\n14 Mathematics 243\n\ndecimal 243\n\nDecimal Objects 244\n\nContext Objects 244\n\nFunctions and Constants 247\n\nExamples 248\n\nNotes 249\n\nfractions 250\n\nmath 251\n\nNotes 252\n\nnumbers 252\n\nNotes 253\n\nrandom 254\n\nSeeding and Initialization 254\n\nRandom Integers 254\n\nRandom Sequences 254\n\nReal-Valued Random Distributions 255\n\nNotes 256\n\nF h Lib f L Bdff",
      "content_length": 573,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 14,
      "content": "Contents\n\nxiii\n\n15 Data Structures, Algorithms, and Code Simplification 257\n\nabc 257\n\narray 259\n\nNotes 261\n\nbisect 261\n\ncollections 262\n\ndeque and defaultdict 262\n\nNamed Tuples 263\n\nAbstract Base Classes 265\n\ncontextlib 267\n\nfunctools 268\n\nheapq 269\n\nitertools 270\n\nExamples 273\n\noperator 273\n\n16 String and Text Handling 277\n\ncodecs 277\n\nLow-Level codecs Interface 277\n\nI/O-Related Functions 279\n\nUseful Constants 279\n\nStandard Encodings 280\n\nNotes 280\n\nre 281\n\nPattern Syntax 281\n\nFunctions 283\n\nRegular Expression Objects 284\n\nMatch Objects 285\n\nExample 286\n\nNotes 287\n\nstring 287\n\nConstants 287\n\nFormatter Objects 288\n\nTemplate Strings 289\n\nUtility Functions 290\n\nstruct 290\n\nPacking and Unpacking Functions 290\n\nStruct Objects 291\n\nF h Lib f L Bdff",
      "content_length": 753,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 15,
      "content": "xiv\n\nContents\n\nFormat Codes 291\n\nNotes 292\n\nunicodedata 293\n\n17 Python Database Access 297\n\nRelational Database API Specification 297\n\nConnections 297\n\nCursors 298\n\nForming Queries 300\n\nType Objects 301\n\nError Handling 302\n\nMultithreading 302\n\nMapping Results into Dictionaries 303\n\nDatabase API Extensions 303\n\nsqlite3 Module 303\n\nModule-Level Functions 304\n\nConnection Objects 305\n\nCursors and Basic Operations 308\n\nDBM-Style Database Modules 310\n\nshelve Module 311\n\n18 File and Directory Handling 313\n\nbz2 313\n\nfilecmp 314\n\nfnmatch 316\n\nExamples 316\n\nglob 317\n\nExample 317\n\ngzip 317\n\nNotes 317\n\nshutil 318\n\ntarfile 319\n\nExceptions 322\n\nExample 322\n\ntempfile 323\n\nzipfile 324\n\nzlib 328\n\nF h Lib f L Bdff",
      "content_length": 705,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 16,
      "content": "Contents\n\nxv\n\n19 Operating System Services 331\n\ncommands 331\n\nNotes 332\n\nconfigParser, Configparser 332\n\nThe ConfigParser Class 332\n\nExample 334\n\nNotes 336\n\ndatetime 336\n\ndate Objects 336\n\ntime Objects 338\n\ndatetime objects 339\n\ntimedelta objects 340\n\nMathematical Operations Involving Dates 341\n\ntzinfo Objects 342\n\nDate and Time Parsing 343\n\nerrno 343\n\nPOSIX Error Codes 344\n\nWindows Error Codes 346\n\nfcntl 347\n\nExample 348\n\nNotes 349\n\nio 349\n\nBase I/O Interface 349\n\nRaw I/O 350\n\nBuffered Binary I/O 351\n\nText I/O 353\n\nThe open() Function 354\n\nAbstract Base Classes 354\n\nlogging 355\n\nLogging Levels 355\n\nBasic Configuration 355\n\nLogger Objects 356\n\nHandler Objects 362\n\nMessage Formatting 364\n\nMiscellaneous Utility Functions 366\n\nLogging Configuration 366\n\nPerformance Considerations 369\n\nNotes 369\n\nF h Lib f L Bdff",
      "content_length": 820,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 17,
      "content": "xvi\n\nContents\n\nmmap 369\n\nNotes 372\n\nmsvcrt 372\n\noptparse 374\n\nExample 377\n\nNotes 378\n\nos 378\n\nProcess Environment 379\n\nFile Creation and File Descriptors 381\n\nFiles and Directories 386\n\nProcess Management 390\n\nSystem Configuration 395\n\nExceptions 396\n\nos.path 396\n\nsignal 399\n\nExample 401\n\nNotes 401\n\nsubprocess 402\n\nExamples 404\n\nNotes 404\n\ntime 405\n\nNotes 407\n\nwinreg 408\n\nNotes 411\n\n20 Threads and Concurrency 413\n\nBasic Concepts 413\n\nConcurrent Programming and Python 414\n\nmultiprocessing 415\n\nProcesses 415\n\nInterprocess Communication 417\n\nProcess Pools 424\n\nShared Data and Synchronization 426\n\nManaged Objects 428\n\nConnections 433\n\nMiscellaneous Utility Functions 434\n\nGeneral Advice on Multiprocessing 435\n\nthreading 436\n\nThread Objects 436\n\nTimer Objects 437\n\nF h Lib f L Bdff",
      "content_length": 785,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 18,
      "content": "Contents\n\nxvii\n\nLock Objects 438\n\nRLock 438\n\nSemaphore and Bounded Semaphore 439\n\nEvents 440\n\nCondition Variables 441\n\nWorking with Locks 442\n\nThread Termination and Suspension 443\n\nUtility Functions 443\n\nThe Global Interpreter Lock 444\n\nProgramming with Threads 444\n\nqueue, Queue 444\n\nQueue Example with Threads 445\n\nCoroutines and Microthreading 446\n\n21 Network Programming and Sockets 449\n\nNetwork Programming Basics 449\n\nasynchat 452\n\nasyncore 455\n\nExample 457\n\nselect 459\n\nAdvanced Module Features 460\n\nAdvanced Asynchronous I/O Example 460\n\nWhen to Consider Asynchronous Networking 467\n\nsocket 469\n\nAddress Families 470\n\nSocket Types 470\n\nAddressing 471\n\nFunctions 473\n\nExceptions 485\n\nExample 485\n\nNotes 486\n\nssl 486\n\nExamples 489\n\nSocketServer 489\n\nHandlers 490\n\nServers 491\n\nDefining Customized Servers 492\n\nCustomization of Application Servers 494\n\nF h Lib f L Bdff",
      "content_length": 875,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 19,
      "content": "xviii\n\nContents\n\n22 Internet Application Programming 497\n\nftplib 497\n\nExample 500\n\nhttp Package 500\n\nhttp.client (httplib) 502\n\nhttp.server (BaseHTTPServer, CGIHTTPServer, SimpleHTTPServer) 506\n\nhttp.cookies (Cookie) 511\n\nhttp.cookiejar (cookielib) 513\n\nsmtplib 513\n\nExample 514\n\nurllib Package 514\n\nurllib.request (urllib2) 515\n\nurllib.response 520\n\nurllib.parse 520\n\nurllib.error 523\n\nurllib.robotparser (robotparser) 523\n\nNotes 524\n\nxmlrpc Package 524\n\nxmlrpc.client (xmlrpclib) 524\n\nxmlrpc.server (SimpleXMLRPCServer, DocXMLRPCServer) 527\n\n23 Web Programming 531\n\ncgi 533\n\nCGI Programming Advice 537\n\nNotes 538\n\ncgitb 539\n\nwsgiref 540\n\nThe WSGI Specification 540\n\nwsgiref Package 542\n\nwebbrowser 544\n\n24 Internet Data Handling and Encoding 545\n\nbase64 545\n\nbinascii 547\n\ncsv 548\n\nDialects 551\n\nExample 551\n\nF h Lib f L Bdff",
      "content_length": 827,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 20,
      "content": "Contents\n\nxix\n\nemail Package 552\n\nParsing Email 552\n\nComposing Email 555\n\nNotes 558\n\nhashlib 559\n\nhmac 559\n\nExample 560\n\nHTMLParser 561\n\nExample 562\n\njson 563\n\nmimetypes 566\n\nquopri 567\n\nxml Package 568\n\nXML Example Document 569\n\nxml.dom.minidom 570\n\nxml.etree.ElementTree 573\n\nxml.sax 580\n\nxml.sax.saxutils 583\n\n25 Miscellaneous Library Modules 585\n\nPython Services 585\n\nString Processing 586\n\nOperating System Modules 586\n\nNetwork 587\n\nInternet Data Handling 587\n\nInternationalization 587\n\nMultimedia Services 588\n\nMiscellaneous 588\n\nIII: Extending and Embedding 589\n\n26 Extending and Embedding Python 591\n\nExtension Modules 591\n\nAn Extension Module Prototype 593\n\nNaming Extension Modules 595\n\nCompiling and Packaging Extensions 596\n\nType Conversion from Python to C 597\n\nType Conversion from C to Python 602\n\nF h Lib f L Bdff",
      "content_length": 829,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 21,
      "content": "xx\n\nContents\n\nAdding Values to a Module 604\n\nError Handling 605\n\nReference Counting 607\n\nThreads 607\n\nEmbedding the Python Interpreter 608\n\nAn Embedding Template 608\n\nCompilation and Linking 608\n\nBasic Interpreter Operation and Setup 608\n\nAccessing Python from C 610\n\nConverting Python Objects to C 611\n\nctypes 612\n\nLoading Shared Libraries 612\n\nForeign Functions 612\n\nDatatypes 613\n\nCalling Foreign Functions 615\n\nAlternative Type Construction Methods 616\n\nUtility Functions 617\n\nExample 618\n\nAdvanced Extending and Embedding 619\n\nJython and IronPython 620\n\nAppendix Python 3 621\n\nWho Should Be Using Python 3? 621\n\nNew Language Features 622\n\nSource Code Encoding and Identifiers 622\n\nSet Literals 622\n\nSet and Dictionary Comprehensions 623\n\nExtended Iterable Unpacking 623\n\nNonlocal Variables 624\n\nFunction Annotations 624\n\nKeyword-Only Arguments 625\n\nEllipsis as an Expression 626\n\nChained Exceptions 626\n\nImproved super()\n\n627\n\nAdvanced Metaclasses 627\n\nCommon Pitfalls 629\n\nText Versus Bytes 629\n\nNew I/O System 631\n\nF h Lib f L Bdff",
      "content_length": 1038,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 22,
      "content": "Contents\n\nxxi\n\nprint() and exec() Functions 631\n\nUse of Iterators and Views 632\n\nIntegers and Integer Division 633\n\nComparisons 633\n\nIterators and Generators 633\n\nFile Names, Arguments, and Environment Variables 633\n\nLibrary Reorganization 634\n\nAbsolute Imports 634\n\nCode Migration and 2to3 634\n\nPorting Code to Python 2.6 634\n\nProviding Test Coverage 635\n\nUsing the 2to3 Tool 635\n\nA Practical Porting Strategy 637\n\nSimultaneous Python 2 and Python 3 Support 638\n\nParticipate 638\n\nIndex 639\n\nF h Lib f L Bdff",
      "content_length": 508,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 23,
      "content": "About the Author David M. Beazley is a long-time Python enthusiast, having been involved with the Python community since 1996. He is probably best known for his work on SWIG, a popular software package for integrating C/C++ programs with other programming languages, including Python, Perl, Ruby,Tcl, and Java. He has also written a number of other programming tools, including PLY, a Python implementation of lex and yacc. Dave spent seven years working in the Theoretical Physics Division at Los Alamos National Laboratory, where he helped pioneer the use of Python with massively parallel supercomputers.After that, Dave went off to work as an evil professor, where he enjoyed tormenting college students with a variety of insane programming projects. However, he has since seen the error of his ways and is now working as an independent software developer, consultant, Python trainer, and occasional jazz musician living in Chicago. He can be contacted at http://www.dabeaz.com.\n\nAbout the Technical Editor Noah Gift is the co-author of Python For UNIX and Linux System Administration (O’Reilly) and is also working on Google App Engine In Action (Manning). He is an author, speaker, consultant, and community leader, writing for publications such as IBM developerWorks, Red Hat Magazine, O’Reilly, and MacTech. His consulting company’s website is http://www.giftcs.com, and much of his writing can be found at http://noahgift.com.You can also follow Noah on Twitter.\n\nNoah has a master’s degree in CIS from Cal State, Los Angeles, a B.S. in nutritional\n\nscience from Cal Poly San Luis Obispo, is an Apple and LPI-certified SysAdmin, and has worked at companies such as Caltech, Disney Feature Animation, Sony Imageworks, and Turner Studios. He is currently working at Weta Digital in New Zealand. In his free time he enjoys spending time with his wife Leah and their son Liam, composing for the piano, running marathons, and exercising religiously.\n\nF h Lib f L Bdff",
      "content_length": 1971,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 24,
      "content": "Acknowledgments This book would not be possible without the support of many people. First and fore- most, I’d like to thank Noah Gift for jumping into the project and providing his amaz- ing feedback on the fourth edition. Kurt Grandis also provided useful comments for many chapters. I’d also like to acknowledge past technical reviewers Timothy Boronczyk, Paul DuBois, Mats Wichmann, David Ascher, and Tim Bell for their valuable comments and advice that made earlier editions a success. Guido van Rossum, Jeremy Hylton, Fred Drake, Roger Masse, and Barry Warsaw also provided tremendous assis- tance with the first edition while hosting me for a few weeks back in the hot summer of 1999. Last, but not least, this book would not be possible without all of the feedback I received from readers.There are far too many people to list individually, but I have done my best to incorporate your suggestions for making the book even better. I’d also like to thank all the folks at Addison-Wesley and Pearson Education for their continued commitment to the project and assistance. Mark Taber, Michael Thurston, Seth Kerney, and Lisa Thibault all helped out to get this edition out the door in good shape.A special thanks is in order for Robin Drake, whose tremendous effort in editing previous edi- tions made the third edition possible. Finally, I’d like to acknowledge my amazing wife and partner Paula Kamen for all of her encouragement, diabolical humor, and love.\n\nF h Lib f L Bdff",
      "content_length": 1481,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 25,
      "content": "We Want to Hear from You! As the reader of this book, you are our most important critic and commentator.We value your opinion and want to know what we’re doing right, what we could do better, what areas you’d like to see us publish in, and any other words of wisdom you’re willing to pass our way.\n\nYou can email or write me directly to let me know what you did or didn’t like about this book—as well as what we can do to make our books stronger.\n\nPlease note that I cannot help you with technical problems related to the topic of this book, and that due to the high volume of mail I receive, I might not be able to reply to every message.\n\nWhen you write, please be sure to include this book’s title and author as well as your name and phone or email address. I will carefully review your comments and share them with the author and editors who worked on the book.\n\nEmail: Mail: Mark Taber\n\nfeedback@developers-library.info\n\nAssociate Publisher Pearson Education 800 East 96th Street Indianapolis, IN 46240 USA\n\nReader Services Visit our website and register this book at informit.com/register for convenient access to any updates, downloads, or errata that might be available for this book.\n\nF h Lib f L Bdff",
      "content_length": 1210,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 26,
      "content": "Introduction\n\nThis book is intended to be a concise reference to the Python programming language.\n\nAlthough an experienced programmer will probably be able to learn Python from this book, it’s not intended to be an extended tutorial or a treatise on how to program. Rather, the goal is to present the core Python language, and the most essential parts of the Python library in a manner that’s accurate and concise.This book assumes that the reader has prior programming experience with Python or another language such as C or Java. In addition, a general familiarity with systems programming topics (for example, basic operating system concepts and network programming) may be useful in under- standing certain parts of the library reference.\n\nPython is freely available for download at http://www.python.org.Versions are avail-\n\nable for almost every operating system, including UNIX,Windows, and Macintosh. In addition, the Python website includes links to documentation, how-to guides, and a wide assortment of third-party software.\n\nThis edition of Python Essential Reference comes at a pivotal time in Python’s evolu- tion. Python 2.6 and Python 3.0 are being released almost simultaneously.Yet, Python 3 is a release that breaks backwards compatibility with prior Python versions.As an author and programmer, I’m faced with a dilemma: do I simply jump forward to Python 3.0 or do I build upon the Python 2.x releases that are more familiar to most programmers?\n\nYears ago, as a C programmer I used to treat certain books as the ultimate authority on what programming language features should be used. For example, if you were using something that wasn’t documented in the K&R book, it probably wasn’t going to be portable and should be approached with caution.This approach served me very well as a programmer and it’s the approach I have decided to take in this edition of the Essential Reference. Namely, I have chosen to omit features of Python 2 that have been removed from Python 3. Likewise, I don’t focus on features of Python 3 that have not been back-ported (although such features are still covered in an appendix).As a result, I hope this book can be a useful companion for Python programmers, regardless of what Python version is being used.\n\nThe fourth edition of Python Essential Reference also includes some of the most excit- ing changes since its initial publication nearly ten years ago. Much of Python’s develop- ment throughout the last few years has focused on new programming language fea- tures—especially related to functional and meta programming.As a result, the chapters on functions and object-oriented programming have been greatly expanded to cover topics such as generators, iterators, coroutines, decorators, and metaclasses.The library chapters have been updated to focus on more modern modules. Examples and code fragments have also been updated throughout the book. I think most programmers will be quite pleased with the expanded coverage.\n\nFinally, it should be noted that Python already includes thousands of pages of useful documentation.The contents of this book are largely based on that documentation, but with a number of key differences. First, this reference presents information in a much more compact form, with different examples and alternative descriptions of many top- ics. Second, a significant number of topics in the library reference have been expanded\n\nF h Lib f L Bdff",
      "content_length": 3431,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 27,
      "content": "2\n\nIntroduction\n\nto include outside reference material.This is especially true for low-level system and networking modules in which effective use of a module normally relies on a myriad of options listed in manuals and outside references. In addition, in order to produce a more concise reference, a number of deprecated and relatively obscure library modules have been omitted.\n\nIn writing this book, it has been my goal to produce a reference containing virtually\n\neverything I have needed to use Python and its large collection of modules.Although this is by no means a gentle introduction to the Python language, I hope that you find the contents of this book to be a useful addition to your programming reference library for many years to come. I welcome your comments.\n\nDavid Beazley Chicago, Illinois June, 2009\n\nF h Lib f L Bdff",
      "content_length": 836,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 28,
      "content": "I\n\nThe Python Language\n\n1\n\nA Tutorial Introduction\n\n2\n\nLexical Conventions and Syntax\n\n3\n\nTypes and Objects\n\n4 Operators and Expressions\n\n5\n\nProgram Structure and Control Flow\n\n6\n\nFunctions and Functional Programming\n\n7 Classes and Object-Oriented Programming\n\n8 Modules, Packages, and Distribution\n\n9\n\nInput and Output\n\n10\n\nExecution Environment\n\n11\n\nTesting, Debugging, Profiling, and Tuning\n\nF h Lib f L Bdff",
      "content_length": 411,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 29,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 30,
      "content": "1\n\nA Tutorial Introduction\n\nThis chapter provides a quick introduction to Python.The goal is to illustrate most of\n\nPython’s essential features without getting too bogged down in special rules or details. To do this, the chapter briefly covers basic concepts such as variables, expressions, con- trol flow, functions, generators, classes, and input/output.This chapter is not intended to provide comprehensive coverage. However, experienced programmers should be able to extrapolate from the material in this chapter to create more advanced programs. Beginners are encouraged to try a few examples to get a feel for the language. If you are new to Python and using Python 3, you might want to follow this chapter using Python 2.6 instead.Virtually all the major concepts apply to both versions, but there are a small number of critical syntax changes in Python 3—mostly related to printing and I/O—that might break many of the examples shown in this section. Please refer to Appendix A,“Python 3,” for further details.\n\nRunning Python Python programs are executed by an interpreter. Usually, the interpreter is started by simply typing python into a command shell. However, there are many different imple- mentations of the interpreter and Python development environments (for example, Jython, IronPython, IDLE,ActivePython,Wing IDE, pydev, etc.), so you should consult the documentation for startup details.When the interpreter starts, a prompt appears at which you can start typing programs into a simple read-evaluation loop. For example, in the following output, the interpreter displays its copyright message and presents the user with the >>> prompt, at which the user types the familiar “Hello World” command:\n\nPython 2.6rc2 (r26rc2:66504, Sep 19 2008, 08:50:24) [GCC 4.0.1 (Apple Inc. build 5465)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> print \"Hello World\" Hello World >>>\n\nF h Lib f L Bdff",
      "content_length": 1944,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 31,
      "content": "6\n\nChapter 1 A Tutorial Introduction\n\nNote\n\nIf you try the preceding example and it fails with a SyntaxError, you are probably using Python 3. If this is the case, you can continue to follow along with this chapter, but be aware that the print statement turned into a function in Python 3. Simply add parentheses around the items to be printed in the examples that follow. For instance:\n\n>>> print(\"Hello World\") Hello World >>>\n\nPutting parentheses around the item to be printed also works in Python 2 as long as you are printing just a single item. However, it’s not a syntax that you commonly see in existing Python code. In later chapters, this syntax is sometimes used in examples in which the primary focus is a feature not directly related to printing, but where the exam- ple is supposed to work with both Python 2 and 3.\n\nPython’s interactive mode is one of its most useful features. In the interactive shell, you can type any valid statement or sequence of statements and immediately view the results. Many people, including the author, even use interactive Python as their desktop calculator. For example:\n\n>>> 6000 + 4523.50 + 134.12 10657.620000000001 >>> _ + 8192.32 18849.940000000002 >>>\n\nWhen you use Python interactively, the special variable _ holds the result of the last operation.This can be useful if you want to save or use the result of the last operation in subsequent statements. However, it’s important to stress that this variable is only defined when working interactively.\n\nIf you want to create a program that you can run repeatedly, put statements in a file\n\nsuch as the following:\n\n# helloworld.py print \"Hello World\"\n\nPython source files are ordinary text files and normally have a .py suffix.The # charac- ter denotes a comment that extends to the end of the line.\n\nTo execute the helloworld.py file, you provide the filename to the interpreter as\n\nfollows:\n\n% python helloworld.py Hello World %\n\nOn Windows, Python programs can be started by double-clicking a .py file or typing the name of the program into the Run command on the Windows Start menu.This launches the interpreter and runs the program in a console window. However, be aware that the console window will disappear immediately after the program completes its execution (often before you can read its output). For debugging, it is better to run the program within a Python development tool such as IDLE.\n\nOn UNIX, you can use #! on the first line of the program, like this:\n\n#!/usr/bin/env python print \"Hello World\"\n\nF h Lib f L Bdff",
      "content_length": 2534,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 32,
      "content": "Variables and Arithmetic Expressions\n\n7\n\nThe interpreter runs statements until it reaches the end of the input file. If it’s running interactively, you can exit the interpreter by typing the EOF (end of file) character or by selecting Exit from pull-down menu of a Python IDE. On UNIX, EOF is Ctrl+D; on Windows, it’s Ctrl+Z.A program can request to exit by raising the SystemExit exception.\n\n>>> raise SystemExit\n\nVariables and Arithmetic Expressions The program in Listing 1.1 shows the use of variables and expressions by performing a simple compound-interest calculation.\n\nListing 1.1 principal = 1000 # Initial amount rate = 0.05 # Interest rate numyears = 5 # Number of years year = 1 while year <= numyears:\n\nSimple Compound-Interest Calculation\n\nprincipal = principal * (1 + rate) print year, principal # Reminder: print(year, principal) in Python 3 year += 1\n\nThe output of this program is the following table:\n\n1 1050.0 2 1102.5 3 1157.625 4 1215.50625 5 1276.2815625\n\nPython is a dynamically typed language where variable names are bound to different values, possibly of varying types, during program execution.The assignment operator simply creates an association between a name and a value.Although each value has an associated type such as an integer or string, variable names are untyped and can be made to refer to any type of data during execution.This is different from C, for exam- ple, in which a name represents a fixed type, size, and location in memory into which a value is stored.The dynamic behavior of Python can be seen in Listing 1.1 with the principal variable. Initially, it’s assigned to an integer value. However, later in the pro- gram it’s reassigned as follows:\n\nprincipal = principal * (1 + rate)\n\nThis statement evaluates the expression and reassociates the name principal with the result. Although the original value of principal was an integer 1000, the new value is now a floating-point number (rate is defined as a float, so the value of the above expression is also a float).Thus, the apparent “type” of principal dynamically changes from an integer to a float in the middle of the program. However, to be precise, it’s not the type of principal that has changed, but rather the value to which the principal name refers.\n\nA newline terminates each statement. However, you can use a semicolon to separate\n\nstatements on the same line, as shown here:\n\nprincipal = 1000; rate = 0.05; numyears = 5;\n\nF h Lib f L Bdff",
      "content_length": 2455,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 33,
      "content": "8\n\nChapter 1 A Tutorial Introduction\n\nThe while statement tests the conditional expression that immediately follows. If the tested statement is true, the body of the while statement executes.The condition is then retested and the body executed again until the condition becomes false. Because the body of the loop is denoted by indentation, the three statements following while in Listing 1.1 execute on each iteration. Python doesn’t specify the amount of required indentation, as long as it’s consistent within a block. However, it is most common (and generally recommended) to use four spaces per indentation level.\n\nOne problem with the program in Listing 1.1 is that the output isn’t very pretty.To make it better, you could right-align the columns and limit the precision of principal to two digits.There are several ways to achieve this formatting.The most widely used approach is to use the string formatting operator (%) like this:\n\nprint \"%3d %0.2f\" % (year, principal) print(\"%3d %0.2f\" % (year, principal)) # Python 3\n\nNow the output of the program looks like this:\n\n1 1050.00 2 1102.50 3 1157.63 4 1215.51 5 1276.28\n\nFormat strings contain ordinary text and special formatting-character sequences such as \"%d\", \"%s\", and \"%f\".These sequences specify the formatting of a particular type of data such as an integer, string, or floating-point number, respectively.The special- character sequences can also contain modifiers that specify a width and precision. For example, \"%3d\" formats an integer right-aligned in a column of width 3, and \"%0.2f\" formats a floating-point number so that only two digits appear after the decimal point. The behavior of format strings is almost identical to the C printf() function and is described in detail in Chapter 4,“Operators and Expressions.”\n\nA more modern approach to string formatting is to format each part individually\n\nusing the format() function. For example:\n\nprint format(year,\"3d\"),format(principal,\"0.2f\") print(format(year,\"3d\"),format(principal,\"0.2f\")) # Python 3\n\nformat() uses format specifiers that are similar to those used with the traditional string formatting operator (%). For example, \"3d\" formats an integer right-aligned in a col- umn of width 3, and \"0.2f\" formats a float-point number to have two digits of accura- cy. Strings also have a format() method that can be used to format many values at once. For example:\n\nprint \"{0:3d} {1:0.2f}\".format(year,principal) print(\"{0:3d} {1:0.2f}\".format(year,principal)) # Python 3\n\nIn this example, the number before the colon in \"{0:3d}\" and \"{1:0.2f}\" refers to the associated argument passed to the format() method and the part after the colon is the format specifier.\n\nF h Lib f L Bdff",
      "content_length": 2708,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 34,
      "content": "Conditionals\n\n9\n\nConditionals The if and else statements can perform simple tests. Here’s an example:\n\nif a < b:\n\nprint \"Computer says Yes\"\n\nelse:\n\nprint \"Computer says No\"\n\nThe bodies of the if and else clauses are denoted by indentation.The else clause is optional.\n\nTo create an empty clause, use the pass statement, as follows:\n\nif a < b:\n\npass # Do nothing\n\nelse:\n\nprint \"Computer says No\"\n\nYou can form Boolean expressions by using the or, and, and not keywords:\n\nif product == \"game\" and type == \"pirate memory\" \\ and not (age < 4 or age > 8):\n\nprint \"I'll take it!\"\n\nNote\n\nWriting complex test cases commonly results in statements that involve an annoyingly long line of code. To improve readability, you can continue any statement to the next line by using a backslash (\\) at the end of a line as shown. If you do this, the normal inden- tation rules don’t apply to the next line, so you are free to format the continued lines as you wish.\n\nPython does not have a special switch or case statement for testing values.To handle multiple-test cases, use the elif statement, like this:\n\nif suffix == \".htm\":\n\ncontent = \"text/html\"\n\nelif suffix == \".jpg\":\n\ncontent = \"image/jpeg\"\n\nelif suffix == \".png\":\n\ncontent = \"image/png\"\n\nelse:\n\nraise RuntimeError(\"Unknown content type\")\n\nTo denote truth values, use the Boolean values True and False. Here’s an example:\n\nif 'spam' in s:\n\nhas_spam = True\n\nelse:\n\nhas_spam = False\n\nAll relational operators such as < and > return True or False as results.The in opera- tor used in this example is commonly used to check whether a value is contained inside of another object such as a string, list, or dictionary. It also returns True or False, so the preceding example could be shortened to this:\n\nhas_spam = 'spam' in s\n\nF h Lib f L Bdff",
      "content_length": 1781,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 35,
      "content": "10\n\nChapter 1 A Tutorial Introduction\n\nFile Input and Output The following program opens a file and reads its contents line by line:\n\nf = open(\"foo.txt\") # Returns a file object line = f.readline() # Invokes readline() method on file while line:\n\nprint line, # trailing ',' omits newline character # print(line,end='') # Use in Python 3 line = f.readline()\n\nf.close()\n\nThe open() function returns a new file object. By invoking methods on this object, you can perform various file operations.The readline() method reads a single line of input, including the terminating newline.The empty string is returned at the end of the file.\n\nIn the example, the program is simply looping over all the lines in the file foo.txt.\n\nWhenever a program loops over a collection of data like this (for instance input lines, numbers, strings, etc.), it is commonly known as iteration. Because iteration is such a com- mon operation, Python provides a dedicated statement, for, that is used to iterate over items. For instance, the same program can be written much more succinctly as follows:\n\nfor line in open(\"foo.txt\"):\n\nprint line,\n\nTo make the output of a program go to a file, you can supply a file to the print state- ment using >>, as shown in the following example:\n\nf = open(\"out\",\"w\") # Open file for writing while year <= numyears:\n\nprincipal = principal * (1 + rate) print >>f,\"%3d %0.2f\" % (year,principal) year += 1\n\nf.close()\n\nThe >> syntax only works in Python 2. If you are using Python 3, change the print statement to the following:\n\nprint(\"%3d %0.2f\" % (year,principal),file=f)\n\nIn addition, file objects support a write() method that can be used to write raw data. For example, the print statement in the previous example could have been written this way:\n\nf.write(\"%3d %0.2f\\n\" % (year,principal))\n\nAlthough these examples have worked with files, the same techniques apply to the stan- dard output and input streams of the interpreter. For example, if you wanted to read user input interactively, you can read from the file sys.stdin. If you want to write data to the screen, you can write to sys.stdout, which is the same file used to output data produced by the print statement. For example:\n\nimport sys sys.stdout.write(\"Enter your name :\") name = sys.stdin.readline()\n\nIn Python 2, this code can also be shortened to the following:\n\nname = raw_input(\"Enter your name :\")\n\nF h Lib f L Bdff",
      "content_length": 2396,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 36,
      "content": "Strings\n\n11\n\nIn Python 3, the raw_input() function is called input(), but it works in exactly the same manner.\n\nStrings To create string literals, enclose them in single, double, or triple quotes as follows:\n\na = \"Hello World\" b = 'Python is groovy' c = \"\"\"Computer says 'No'\"\"\"\n\nThe same type of quote used to start a string must be used to terminate it.Triple- quoted strings capture all the text that appears prior to the terminating triple quote, as opposed to single- and double-quoted strings, which must be specified on one logical line.Triple-quoted strings are useful when the contents of a string literal span multiple lines of text such as the following:\n\nprint '''Content-type: text/html\n\n<h1> Hello World </h1> Click <a href=\"http://www.python.org\">here</a>. '''\n\nStrings are stored as sequences of characters indexed by integers, starting at zero.To extract a single character, use the indexing operator s[i] like this:\n\na = \"Hello World\" b = a[4] # b = 'o'\n\nTo extract a substring, use the slicing operator s[i:j].This extracts all characters from swhose index kis in the range i<= k< j. If either index is omitted, the beginning or end of the string is assumed, respectively:\n\nc = a[:5] # c = \"Hello\" d = a[6:] # d = \"World\" e = a[3:8] # e = \"lo Wo\"\n\nStrings are concatenated with the plus (+) operator:\n\ng = a + \" This is a test\"\n\nPython never implicitly interprets the contents of a string as numerical data (i.e., as in other languages such as Perl or PHP). For example, + always concatenates strings:\n\nx = \"37\" y = \"42\" z = x + y # z = \"3742\" (String Concatenation)\n\nTo perform mathematical calculations, strings first have to be converted into a numeric value using a function such as int() or float(). For example:\n\nz = int(x) + int(y) # z = 79 (Integer +)\n\nNon-string values can be converted into a string representation by using the str(), repr(), or format() function. Here’s an example:\n\ns = \"The value of x is \" + str(x) s = \"The value of x is \" + repr(x) s = \"The value of x is \" + format(x,\"4d\")\n\nF h Lib f L Bdff",
      "content_length": 2042,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 37,
      "content": "12\n\nChapter 1 A Tutorial Introduction\n\nAlthough str() and repr() both create strings, their output is usually slightly differ- ent. str() produces the output that you get when you use the print statement, whereas repr() creates a string that you type into a program to exactly represent the value of an object. For example:\n\n>>> x = 3.4 >>> str(x) '3.4' >>> repr(x) '3.3999999999999999' >>>\n\nThe inexact representation of 3.4 in the previous example is not a bug in Python. It is an artifact of double-precision floating-point numbers, which by their design can not exactly represent base-10 decimals on the underlying computer hardware.\n\nThe format() function is used to convert a value to a string with a specific format-\n\nting applied. For example:\n\n>>> format(x,\"0.5f\") '3.40000' >>>\n\nLists Lists are sequences of arbitrary objects.You create a list by enclosing values in square brackets, as follows:\n\nnames = [ \"Dave\", \"Mark\", \"Ann\", \"Phil\" ]\n\nLists are indexed by integers, starting with zero. Use the indexing operator to access and modify individual items of the list:\n\na = names[2] # Returns the third item of the list, \"Ann\" names[0] = \"Jeff\" # Changes the first item to \"Jeff\"\n\nTo append new items to the end of a list, use the append() method:\n\nnames.append(\"Paula\")\n\nTo insert an item into the middle of a list, use the insert() method:\n\nnames.insert(2, \"Thomas\")\n\nYou can extract or reassign a portion of a list by using the slicing operator:\n\nb = names[0:2] # Returns [ \"Jeff\", \"Mark\" ] c = names[2:] # Returns [ \"Thomas\", \"Ann\", \"Phil\", \"Paula\" ] names[1] = 'Jeff' # Replace the 2nd item in names with 'Jeff' names[0:2] = ['Dave','Mark','Jeff'] # Replace the first two items of\n\n# the list with the list on the right.\n\nUse the plus (+) operator to concatenate lists:\n\na = [1,2,3] + [4,5] # Result is [1,2,3,4,5]\n\nAn empty list is created in one of two ways:\n\nnames = [] # An empty list names = list() # An empty list\n\nF h Lib f L Bdff",
      "content_length": 1951,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 38,
      "content": "Lists\n\n13\n\nLists can contain any kind of Python object, including other lists, as in the following example:\n\na = [1,\"Dave\",3.14, [\"Mark\", 7, 9, [100,101]], 10]\n\nItems contained in nested lists are accessed by applying more than one indexing opera- tion, as follows:\n\na[1] # Returns \"Dave\" a[3][2] # Returns 9 a[3][3][1] # Returns 101\n\nThe program in Listing 1.2 illustrates a few more advanced features of lists by reading a list of numbers from a file specified on the command line and outputting the minimum and maximum values.\n\nListing 1.2 import sys # Load the sys module if len(sys.argv) != 2 # Check number of command line arguments :\n\nAdvanced List Features\n\nprint \"Please supply a filename\" raise SystemExit(1)\n\nf = open(sys.argv[1]) # Filename on the command line lines = f.readlines() # Read all lines into a list f.close()\n\n# Convert all of the input values from strings to floats fvalues = [float(line) for line in lines]\n\n# Print min and max values print \"The minimum value is \", min(fvalues) print \"The maximum value is \", max(fvalues)\n\nThe first line of this program uses the import statement to load the sys module from the Python library.This module is being loaded in order to obtain command-line argu- ments.\n\nThe open() function uses a filename that has been supplied as a command-line option and placed in the list sys.argv.The readlines() method reads all the input lines into a list of strings.\n\nThe expression [float(line) for line in lines] constructs a new list by looping over all the strings in the list lines and applying the function float() to each element.This particularly powerful method of constructing a list is known as a list com- prehension. Because the lines in a file can also be read using a for loop, the program can be shortened by converting values using a single statement like this:\n\nfvalues = [float(line) for line in open(sys.argv[1])]\n\nAfter the input lines have been converted into a list of floating-point numbers, the built-in min() and max() functions compute the minimum and maximum values.\n\nF h Lib f L Bdff",
      "content_length": 2063,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 39,
      "content": "14\n\nChapter 1 A Tutorial Introduction\n\nTuples To create simple data structures, you can pack a collection of values together into a sin- gle object using a tuple.You create a tuple by enclosing a group of values in parentheses like this:\n\nstock = ('GOOG', 100, 490.10) address = ('www.python.org', 80) person = (first_name, last_name, phone)\n\nPython often recognizes that a tuple is intended even if the parentheses are missing:\n\nstock = 'GOOG', 100, 490.10 address = 'www.python.org',80 person = first_name, last_name, phone\n\nFor completeness, 0- and 1-element tuples can be defined, but have special syntax:\n\na = () # 0-tuple (empty tuple) b = (item,) # 1-tuple (note the trailing comma) c = item, # 1-tuple (note the trailing comma)\n\nThe values in a tuple can be extracted by numerical index just like a list. However, it is more common to unpack tuples into a set of variables like this:\n\nname, shares, price = stock host, port = address first_name, last_name, phone = person\n\nAlthough tuples support most of the same operations as lists (such as indexing, slicing, and concatenation), the contents of a tuple cannot be modified after creation (that is, you cannot replace, delete, or append new elements to an existing tuple).This reflects the fact that a tuple is best viewed as a single object consisting of several parts, not as a collection of distinct objects to which you might insert or remove items.\n\nBecause there is so much overlap between tuples and lists, some programmers are inclined to ignore tuples altogether and simply use lists because they seem to be more flexible.Although this works, it wastes memory if your program is going to create a large number of small lists (that is, each containing fewer than a dozen items).This is because lists slightly overallocate memory to optimize the performance of operations that add new items. Because tuples are immutable, they use a more compact representa- tion where there is no extra space.\n\nTuples and lists are often used together to represent data. For example, this program\n\nshows how you might read a file consisting of different columns of data separated by commas:\n\n# File containing lines of the form \"name,shares,price\" filename = \"portfolio.csv\" portfolio = [] for line in open(filename):\n\nfields = line.split(\",\") # Split each line into a list name = fields[0] # Extract and convert individual fields shares = int(fields[1]) price = float(fields[2]) stock = (name,shares,price) # Create a tuple (name, shares, price) portfolio.append(stock) # Append to list of records\n\nThe split() method of strings splits a string into a list of fields separated by the given delimiter character.The resulting portfolio data structure created by this program\n\nF h Lib f L Bdff",
      "content_length": 2741,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 40,
      "content": "Sets\n\n15\n\nlooks like a two-dimension array of rows and columns. Each row is represented by a tuple and can be accessed as follows:\n\n>>> portfolio[0] ('GOOG', 100, 490.10) >>> portfolio[1] ('MSFT', 50, 54.23) >>>\n\nIndividual items of data can be accessed like this:\n\n>>> portfolio[1][1] 50 >>> portfolio[1][2] 54.23 >>>\n\nHere’s an easy way to loop over all of the records and expand fields into a set of variables:\n\ntotal = 0.0 for name, shares, price in portfolio:\n\ntotal += shares * price\n\nSets A set is used to contain an unordered collection of objects.To create a set, use the set() function and supply a sequence of items such as follows:\n\ns = set([3,5,9,10]) # Create a set of numbers t = set(\"Hello\") # Create a set of unique characters\n\nUnlike lists and tuples, sets are unordered and cannot be indexed by numbers. Moreover, the elements of a set are never duplicated. For example, if you inspect the value of t from the preceding code, you get the following:\n\n>>> t set(['H', 'e', 'l', 'o'])\n\nNotice that only one 'l' appears.\n\nSets support a standard collection of operations, including union, intersection, differ-\n\nence, and symmetric difference. Here’s an example:\n\na = t | s # Union of t and s b = t & s # Intersection of t and s c = t – s # Set difference (items in t, but not in s) d = t ^ s # Symmetric difference (items in t or s, but not both)\n\nNew items can be added to a set using add() or update():\n\nt.add('x') # Add a single item s.update([10,37,42]) # Adds multiple items to s\n\nAn item can be removed using remove():\n\nt.remove('H')\n\nF h Lib f L Bdff",
      "content_length": 1573,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 41,
      "content": "16\n\nChapter 1 A Tutorial Introduction\n\nDictionaries A dictionary is an associative array or hash table that contains objects indexed by keys. You create a dictionary by enclosing the values in curly braces ({ }), like this:\n\nstock = {\n\n\"name\" : \"GOOG\", \"shares\" : 100, \"price\" : 490.10\n\n}\n\nTo access members of a dictionary, use the key-indexing operator as follows:\n\nname = stock[\"name\"] value = stock[\"shares\"] * shares[\"price\"]\n\nInserting or modifying objects works like this:\n\nstock[\"shares\"] = 75 stock[\"date\"] = \"June 7, 2007\"\n\nAlthough strings are the most common type of key, you can use many other Python objects, including numbers and tuples. Some objects, including lists and dictionaries, cannot be used as keys because their contents can change.\n\nA dictionary is a useful way to define an object that consists of named fields as shown previously. However, dictionaries are also used as a container for performing fast lookups on unordered data. For example, here’s a dictionary of stock prices:\n\nprices = {\n\n\"GOOG\" : 490.10, \"AAPL\" : 123.50, \"IBM\" : 91.50, \"MSFT\" : 52.13\n\n}\n\nAn empty dictionary is created in one of two ways:\n\nprices = {} # An empty dict prices = dict() # An empty dict\n\nDictionary membership is tested with the in operator, as in the following example:\n\nif \"SCOX\" in prices:\n\np = prices[\"SCOX\"]\n\nelse:\n\np = 0.0\n\nThis particular sequence of steps can also be performed more compactly as follows:\n\np = prices.get(\"SCOX\",0.0)\n\nTo obtain a list of dictionary keys, convert a dictionary to a list:\n\nsyms = list(prices) # syms = [\"AAPL\", \"MSFT\", \"IBM\", \"GOOG\"]\n\nUse the del statement to remove an element of a dictionary:\n\ndel prices[\"MSFT\"]\n\nDictionaries are probably the most finely tuned data type in the Python interpreter. So, if you are merely trying to store and work with data in your program, you are almost always better off using a dictionary than trying to come up with some kind of custom data structure on your own.\n\nF h Lib f L Bdff",
      "content_length": 1973,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 42,
      "content": "Iteration and Looping\n\n17\n\nIteration and Looping The most widely used looping construct is the for statement, which is used to iterate over a collection of items. Iteration is one of Python’s richest features. However, the most common form of iteration is to simply loop over all the members of a sequence such as a string, list, or tuple. Here’s an example:\n\nfor n in [1,2,3,4,5,6,7,8,9]:\n\nprint \"2 to the %d power is %d\" % (n, 2**n)\n\nIn this example, the variable n will be assigned successive items from the list [1,2,3,4,…,9] on each iteration. Because looping over ranges of integers is quite common, the following shortcut is often used for that purpose:\n\nfor n in range(1,10):\n\nprint \"2 to the %d power is %d\" % (n, 2**n)\n\nThe range(i,j [,stride]) function creates an object that represents a range of inte- gers with values ito j-1. If the starting value is omitted, it’s taken to be zero.An optional stride can also be given as a third argument. Here’s an example:\n\na = range(5) # a = 0,1,2,3,4 b = range(1,8) # b = 1,2,3,4,5,6,7 c = range(0,14,3) # c = 0,3,6,9,12 d = range(8,1,-1) # d = 8,7,6,5,4,3,2\n\nOne caution with range() is that in Python 2, the value it creates is a fully populated list with all of the integer values. For extremely large ranges, this can inadvertently con- sume all available memory.Therefore, in older Python code, you will see programmers using an alternative function xrange(). For example:\n\nfor i in xrange(100000000): # i = 0,1,2,...,99999999\n\nstatements\n\nThe object created by xrange() computes the values it represents on demand when lookups are requested. For this reason, it is the preferred way to represent extremely large ranges of integer values. In Python 3, the xrange() function has been renamed to range() and the functionality of the old range() function has been removed.\n\nThe for statement is not limited to sequences of integers and can be used to iterate\n\nover many kinds of objects including strings, lists, dictionaries, and files. Here’s an example:\n\na = \"Hello World\" # Print out the individual characters in a for c in a: print c\n\nb = [\"Dave\",\"Mark\",\"Ann\",\"Phil\"] # Print out the members of a list for name in b: print name\n\nc = { 'GOOG' : 490.10, 'IBM' : 91.50, 'AAPL' : 123.15 } # Print out all of the members of a dictionary for key in c:\n\nprint key, c[key]\n\n# Print all of the lines in a file f = open(\"foo.txt\")\n\nF h Lib f L Bdff",
      "content_length": 2398,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 43,
      "content": "18\n\nChapter 1 A Tutorial Introduction\n\nfor line in f:\n\nprint line,\n\nThe for loop is one of Python’s most powerful language features because you can cre- ate custom iterator objects and generator functions that supply it with sequences of val- ues. More details about iterators and generators can be found later in this chapter and in Chapter 6,“Functions and Functional Programming.”\n\nFunctions You use the def statement to create a function, as shown in the following example:\n\ndef remainder(a,b):\n\nq = a // b # // is truncating division. r = a - q*b return r\n\nTo invoke a function, simply use the name of the function followed by its arguments enclosed in parentheses, such as result = remainder(37,15).You can use a tuple to return multiple values from a function, as shown here:\n\ndef divide(a,b):\n\nq = a // b # If a and b are integers, q is integer r = a - q*b return (q,r)\n\nWhen returning multiple values in a tuple, you can easily unpack the result into sepa- rate variables like this:\n\nquotient, remainder = divide(1456,33)\n\nTo assign a default value to a function parameter, use assignment:\n\ndef connect(hostname,port,timeout=300):\n\n# Function body\n\nWhen default values are given in a function definition, they can be omitted from subse- quent function calls.When omitted, the argument will simply take on the default value. Here’s an example:\n\nconnect('www.python.org', 80)\n\nYou also can invoke functions by using keyword arguments and supplying the argu- ments in arbitrary order. However, this requires you to know the names of the argu- ments in the function definition. Here’s an example:\n\nconnect(port=80,hostname=\"www.python.org\")\n\nWhen variables are created or assigned inside a function, their scope is local.That is, the variable is only defined inside the body of the function and is destroyed when the func- tion returns.To modify the value of a global variable from inside a function, use the global statement as follows:\n\ncount = 0 ... def foo():\n\nglobal count count += 1 # Changes the global variable count\n\nF h Lib f L Bdff",
      "content_length": 2047,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 44,
      "content": "Generators\n\n19\n\nGenerators Instead of returning a single value, a function can generate an entire sequence of results if it uses the yield statement. For example:\n\ndef countdown(n):\n\nprint \"Counting down!\" while n > 0:\n\nyield n # Generate a value (n) n -= 1\n\nAny function that uses yield is known as a generator. Calling a generator function cre- ates an object that produces a sequence of results through successive calls to a next() method (or __next__() in Python 3). For example:\n\n>>> c = countdown(5) >>> c.next() Counting down! 5 >>> c.next() 4 >>> c.next() 3 >>>\n\nThe next() call makes a generator function run until it reaches the next yield state- ment.At this point, the value passed to yield is returned by next(), and the function suspends execution.The function resumes execution on the statement following yield when next() is called again.This process continues until the function returns.\n\nNormally you would not manually call next() as shown. Instead, you hook it up to\n\na for loop like this:\n\n>>> for i in countdown(5): ... Counting down! 5 4 3 2 1 >>>\n\nprint i,\n\nGenerators are an extremely powerful way of writing programs based on processing pipelines, streams, or data flow. For example, the following generator function mimics the behavior of the UNIX tail -f command that’s commonly used to monitor log files:\n\n# tail a file (like tail -f) import time def tail(f):\n\nf.seek(0,2) # Move to EOF while True:\n\nline = f.readline() # Try reading a new line of text if not line: # If nothing, sleep briefly and try again\n\ntime.sleep(0.1) continue\n\nyield line\n\nHere’s a generator that looks for a specific substring in a sequence of lines:\n\ndef grep(lines, searchtext):\n\nfor line in lines:\n\nif searchtext in line: yield line\n\nF h Lib f L Bdff",
      "content_length": 1757,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 45,
      "content": "20\n\nChapter 1 A Tutorial Introduction\n\nHere’s an example of hooking both of these generators together to create a simple pro- cessing pipeline:\n\n# A python implementation of Unix \"tail -f | grep python\" wwwlog = tail(open(\"access-log\")) pylines = grep(wwwlog,\"python\") for line in pylines: print line,\n\nA subtle aspect of generators is that they are often mixed together with other iterable objects such as lists or files. Specifically, when you write a statement such as for item in s, scould represent a list of items, the lines of a file, the result of a generator func- tion, or any number of other objects that support iteration.The fact that you can just plug different objects in for scan be a powerful tool for creating extensible programs.\n\nCoroutines Normally, functions operate on a single set of input arguments. However, a function can also be written to operate as a task that processes a sequence of inputs sent to it.This type of function is known as a coroutine and is created by using the yield statement as an expression (yield) as shown in this example:\n\ndef print_matches(matchtext):\n\nprint \"Looking for\", matchtext while True:\n\nline = (yield) # Get a line of text if matchtext in line:\n\nprint line\n\nTo use this function, you first call it, advance it to the first (yield), and then start sending data to it using send(). For example:\n\n>>> matcher = print_matches(\"python\") >>> matcher.next() Looking for python >>> matcher.send(\"Hello World\") >>> matcher.send(\"python is cool\") python is cool >>> matcher.send(\"yow!\") >>> matcher.close() >>>\n\n# Advance to the first (yield)\n\n# Done with the matcher function call\n\nA coroutine is suspended until a value is sent to it using send().When this happens, that value is returned by the (yield) expression inside the coroutine and is processed by the statements that follow. Processing continues until the next (yield) expression is encountered—at which point the function suspends.This continues until the coroutine function returns or close() is called on it as shown in the previous example.\n\nCoroutines are useful when writing concurrent programs based on producer-\n\nconsumer problems where one part of a program is producing data to be consumed by another part of the program. In this model, a coroutine represents a consumer of data. Here is an example of using generators and coroutines together:\n\n# A set of matcher coroutines matchers = [\n\nprint_matches(\"python\"), print_matches(\"guido\"), print_matches(\"jython\")\n\n]\n\nF h Lib f L Bdff",
      "content_length": 2506,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 46,
      "content": "Objects and Classes\n\n21\n\n# Prep all of the matchers by calling next() for m in matchers: m.next()\n\n# Feed an active log file into all matchers. Note for this to work,\n\n# a web server must be actively writing data to the log.\n\nwwwlog = tail(open(\"access-log\")) for line in wwwlog:\n\nfor m in matchers:\n\nm.send(line) # Send data into each matcher coroutine\n\nFurther details about coroutines can be found in Chapter 6.\n\nObjects and Classes All values used in a program are objects.An object consists of internal data and methods that perform various kinds of operations involving that data.You have already used objects and methods when working with the built-in types such as strings and lists. For example:\n\nitems = [37, 42] # Create a list object items.append(73) # Call the append() method\n\nThe dir() function lists the methods available on an object and is a useful tool for interactive experimentation. For example:\n\n>>> items = [37, 42] >>> dir(items) ['__add__', '__class__', '__contains__', '__delattr__', '__delitem__', ...\n\n'append', 'count', 'extend', 'index', 'insert', 'pop', 'remove', 'reverse', 'sort']\n\n>>>\n\nWhen inspecting objects, you will see familiar methods such as append() and insert() listed. However, you will also see special methods that always begin and end with a double underscore.These methods implement various language operations. For example, the __add__() method implements the + operator:\n\n>>> items.__add__([73,101]) [37, 42, 73, 101] >>>\n\nThe class statement is used to define new types of objects and for object-oriented programming. For example, the following class defines a simple stack with push(), pop(), and length() operations:\n\nclass Stack(object):\n\ndef __init__(self): # Initialize the stack\n\nself.stack = [ ]\n\ndef push(self,object):\n\nself.stack.append(object)\n\ndef pop(self):\n\nreturn self.stack.pop()\n\ndef length(self):\n\nreturn len(self.stack)\n\nIn the first line of the class definition, the statement class Stack(object) declares Stack to be an object.The use of parentheses is how Python specifies inheritance—in this case, Stack inherits from object, which is the root of all Python types. Inside the class definition, methods are defined using the def statement.The first argument in each\n\nF h Lib f L Bdff",
      "content_length": 2256,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 47,
      "content": "22\n\nChapter 1 A Tutorial Introduction\n\nmethod always refers to the object itself. By convention, self is the name used for this argument.All operations involving the attributes of an object must explicitly refer to the self variable. Methods with leading and trailing double underscores are special meth- ods. For example, __init__ is used to initialize an object after it’s created.\n\nTo use a class, write code such as the following:\n\ns = Stack() # Create a stack s.push(\"Dave\") # Push some things onto it s.push(42) s.push([3,4,5]) x = s.pop() # x gets [3,4,5] y = s.pop() # y gets 42 del s # Destroy s\n\nIn this example, an entirely new object was created to implement the stack. However, a stack is almost identical to the built-in list object.Therefore, an alternative approach would be to inherit from list and add an extra method:\n\nclass Stack(list):\n\n# Add push() method for stack interface # Note: lists already provide a pop() method. def push(self,object):\n\nself.append(object)\n\nNormally, all of the methods defined within a class apply only to instances of that class (that is, the objects that are created). However, different kinds of methods can be defined such as static methods familiar to C++ and Java programmers. For example:\n\nclass EventHandler(object):\n\n@staticmethod def dispatcherThread():\n\nwhile (1):\n\n# Wait for requests ...\n\nEventHandler.dispatcherThread() # Call method like a function\n\nIn this case, @staticmethod declares the method that follows to be a static method. @staticmethod is an example of using an a decorator, a topic that is discussed further in Chapter 6.\n\nExceptions If an error occurs in your program, an exception is raised and a traceback message such as the following appears:\n\nTraceback (most recent call last):\n\nFile \"foo.py\", line 12, in <module>\n\nIOError: [Errno 2] No such file or directory: 'file.txt'\n\nThe traceback message indicates the type of error that occurred, along with its location. Normally, errors cause a program to terminate. However, you can catch and handle exceptions using try and except statements, like this:\n\ntry:\n\nf = open(\"file.txt\",\"r\")\n\nexcept IOError as e:\n\nprint e\n\nF h Lib f L Bdff",
      "content_length": 2163,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 48,
      "content": "Modules\n\n23\n\nIf an IOError occurs, details concerning the cause of the error are placed in e and con- trol passes to the code in the except block. If some other kind of exception is raised, it’s passed to the enclosing code block (if any). If no errors occur, the code in the except block is ignored.When an exception is handled, program execution resumes with the statement that immediately follows the last except block.The program does not return to the location where the exception occurred.\n\nThe raise statement is used to signal an exception.When raising an exception, you\n\ncan use one of the built-in exceptions, like this:\n\nraise RuntimeError(\"Computer says no\")\n\nOr you can create your own exceptions, as described in the section “Defining New Exceptions” in Chapter 5,“ Program Structure and Control Flow.”\n\nProper management of system resources such as locks, files, and network connections\n\nis often a tricky problem when combined with exception handling.To simplify such programming, you can use the with statement with certain kinds of objects. Here is an example of writing code that uses a mutex lock:\n\nimport threading message_lock = threading.Lock() ... with message_lock:\n\nmessages.add(newmessage)\n\nIn this example, the message_lock object is automatically acquired when the with statement executes.When execution leaves the context of the with block, the lock is automatically released.This management takes place regardless of what happens inside the with block. For example, if an exception occurs, the lock is released when control leaves the context of the block.\n\nThe with statement is normally only compatible with objects related to system resources or the execution environment such as files, connections, and locks. However, user-defined objects can define their own custom processing.This is covered in more detail in the “Context Management Protocol” section of Chapter 3,“Types and Objects.”\n\nModules As your programs grow in size, you will want to break them into multiple files for easi- er maintenance.To do this, Python allows you to put definitions in a file and use them as a module that can be imported into other programs and scripts.To create a module, put the relevant statements and definitions into a file that has the same name as the module. (Note that the file must have a .py suffix.) Here’s an example:\n\n# file : div.py def divide(a,b):\n\nq = a/b # If a and b are integers, q is an integer r = a - q*b return (q,r)\n\nTo use your module in other programs, you can use the import statement:\n\nimport div a, b = div.divide(2305, 29)\n\nF h Lib f L Bdff",
      "content_length": 2593,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 49,
      "content": "24\n\nChapter 1 A Tutorial Introduction\n\nThe import statement creates a new namespace and executes all the statements in the associated .py file within that namespace.To access the contents of the namespace after import, simply use the name of the module as a prefix, as in div.divide() in the pre- ceding example.\n\nIf you want to import a module using a different name, supply the import statement\n\nwith an optional as qualifier, as follows:\n\nimport div as foo a,b = foo.divide(2305,29)\n\nTo import specific definitions into the current namespace, use the from statement:\n\nfrom div import divide a,b = divide(2305,29) # No longer need the div prefix\n\nTo load all of a module’s contents into the current namespace, you can also use the following:\n\nfrom div import *\n\nAs with objects, the dir() function lists the contents of a module and is a useful tool for interactive experimentation:\n\n>>> import string >>> dir(string) ['__builtins__', '__doc__', '__file__', '__name__', '_idmap',\n\n'_idmapL', '_lower', '_swapcase', '_upper', 'atof', 'atof_error', 'atoi', 'atoi_error', 'atol', 'atol_error', 'capitalize', 'capwords', 'center', 'count', 'digits', 'expandtabs', 'find',\n\n... >>>\n\nGetting Help When working with Python, you have several sources of quickly available information. First, when Python is running in interactive mode, you can use the help() command to get information about built-in modules and other aspects of Python. Simply type help() by itself for general information or help('modulename') for information about a specific module.The help() command can also be used to return information about specific functions if you supply a function name.\n\nMost Python functions have documentation strings that describe their usage.To\n\nprint the doc string, simply print the __doc__ attribute. Here’s an example:\n\n>>> print issubclass.__doc__ issubclass(C, B) -> bool\n\nReturn whether class C is a subclass (i.e., a derived class) of class B. When using a tuple as the second argument issubclass(X, (A, B, ...)), is a shortcut for issubclass(X, A) or issubclass(X, B) or ... (etc.). >>>\n\nLast, but not least, most Python installations also include the command pydoc, which can be used to return documentation about Python modules. Simply type pydoc topicat a system command prompt.\n\nF h Lib f L Bdff",
      "content_length": 2302,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 50,
      "content": "2\n\nLexical Conventions and Syntax\n\nThis chapter describes the syntactic and lexical conventions of a Python program.\n\nTopics include line structure, grouping of statements, reserved words, literals, operators, tokens, and source code encoding.\n\nLine Structure and Indentation Each statement in a program is terminated with a newline. Long statements can span multiple lines by using the line-continuation character (\\), as shown in the following example:\n\na = math.cos(3 * (x - n)) + \\ math.sin(3 * (y - n))\n\nYou don’t need the line-continuation character when the definition of a triple-quoted string, list, tuple, or dictionary spans multiple lines. More generally, any part of a pro- gram enclosed in parentheses (...), brackets [...], braces {...}, or triple quotes can span multiple lines without use of the line-continuation character because they clearly denote the start and end of a definition.\n\nIndentation is used to denote different blocks of code, such as the bodies of func- tions, conditionals, loops, and classes.The amount of indentation used for the first state- ment of a block is arbitrary, but the indentation of the entire block must be consistent. Here’s an example:\n\nif a:\n\nstatement1 statement2\n\n# Consistent indentation\n\nelse:\n\nstatement3\n\nstatement4\n\n# Inconsistent indentation (error)\n\nIf the body of a function, conditional, loop, or class is short and contains only a single statement, it can be placed on the same line, like this:\n\nif a: statement1 else: statement2\n\nTo denote an empty body or block, use the pass statement. Here’s an example:\n\nif a:\n\npass\n\nelse:\n\nstatements\n\nF h Lib f L Bdff",
      "content_length": 1624,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 51,
      "content": "26\n\nChapter 2 Lexical Conventions and Syntax\n\nAlthough tabs can be used for indentation, this practice is discouraged.The use of spaces is universally preferred (and encouraged) by the Python programming community. When tab characters are encountered, they’re converted into the number of spaces required to move to the next column that’s a multiple of 8 (for example, a tab appear- ing in column 11 inserts enough spaces to move to column 16). Running Python with the -t option prints warning messages when tabs and spaces are mixed inconsistently within the same program block.The -tt option turns these warning messages into TabError exceptions.\n\nTo place more than one statement on a line, separate the statements with a semi- colon (;).A line containing a single statement can also be terminated by a semicolon, although this is unnecessary.\n\nThe # character denotes a comment that extends to the end of the line.A # appear-\n\ning inside a quoted string doesn’t start a comment, however.\n\nFinally, the interpreter ignores all blank lines except when running in interactive mode. In this case, a blank line signals the end of input when typing a statement that spans multiple lines.\n\nIdentifiers and Reserved Words An identifier is a name used to identify variables, functions, classes, modules, and other objects. Identifiers can include letters, numbers, and the underscore character (_) but must always start with a nonnumeric character. Letters are currently confined to the characters A–Z and a–z in the ISO–Latin character set. Because identifiers are case- sensitive, FOO is different from foo. Special symbols such as $, %, and @ are not allowed in identifiers. In addition, words such as if, else, and for are reserved and cannot be used as identifier names.The following list shows all the reserved words:\n\nand\n\ndel\n\nfrom\n\nnonlocal\n\ntry\n\nas\n\nelif\n\nglobal\n\nnot\n\nwhile\n\nassert\n\nelse\n\nif\n\nor\n\nwith\n\nbreak\n\nexcept\n\nimport\n\npass\n\nyield\n\nclass\n\nexec\n\nin\n\nprint\n\ncontinue\n\nfinally\n\nis\n\nraise\n\ndef\n\nfor\n\nlambda\n\nreturn\n\nIdentifiers starting or ending with underscores often have special meanings. For exam- ple, identifiers starting with a single underscore such as _foo are not imported by the from module import * statement. Identifiers with leading and trailing double under- scores such as __init__ are reserved for special methods, and identifiers with leading double underscores such as __bar are used to implement private class members, as described in Chapter 7,“Classes and Object-Oriented Programming.” General-purpose use of similar identifiers should be avoided.\n\nNumeric Literals There are four types of built-in numeric literals:\n\nn Booleans n Integers\n\nF h Lib f L Bdff",
      "content_length": 2689,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 52,
      "content": "String Literals\n\n27\n\nn Floating-point numbers n Complex numbers\n\nThe identifiers True and False are interpreted as Boolean values with the integer val- ues of 1 and 0, respectively.A number such as 1234 is interpreted as a decimal integer. To specify an integer using octal, hexadecimal, or binary notation, precede the value with 0, 0x, or 0b, respectively (for example, 0644, 0x100fea8, or 0b11101010).\n\nIntegers in Python can have an arbitrary number of digits, so if you want to specify a\n\nreally large integer, just write out all of the digits, as in 12345678901234567890. However, when inspecting values and looking at old Python code, you might see large numbers written with a trailing l (lowercase L) or L character, as in 12345678901234567890L.This trailing L is related to the fact that Python internally represents integers as either a fixed-precision machine integer or an arbitrary precision long integer type depending on the magnitude of the value. In older versions of Python, you could explicitly choose to use either type and would add the trailing L to explicitly indicate the long type.Today, this distinction is unnecessary and is actively dis- couraged. So, if you want a large integer value, just write it without the L.\n\nNumbers such as 123.34 and 1.2334e+02 are interpreted as floating-point num- bers.An integer or floating-point number with a trailing j or J, such as 12.34J, is an imaginary number.You can create complex numbers with real and imaginary parts by adding a real number and an imaginary number, as in 1.2 + 12.34J.\n\nString Literals String literals are used to specify a sequence of characters and are defined by enclosing text in single ('), double (\"), or triple (''' or \"\"\") quotes.There is no semantic differ- ence between quoting styles other than the requirement that you use the same type of quote to start and terminate a string. Single- and double-quoted strings must be defined on a single line, whereas triple-quoted strings can span multiple lines and include all of the enclosed formatting (that is, newlines, tabs, spaces, and so on).Adjacent strings (sepa- rated by white space, newline, or a line-continuation character) such as \"hello\" 'world' are concatenated to form a single string \"helloworld\".\n\nWithin string literals, the backslash (\\) character is used to escape special characters such as newlines, the backslash itself, quotes, and nonprinting characters.Table 2.1 shows the accepted escape codes. Unrecognized escape sequences are left in the string unmod- ified and include the leading backslash.\n\nTable 2.1\n\nStandard Character Escape Codes\n\nCharacter\n\nDescription\n\n\\\n\n\\\\\n\n\\'\n\n\\\"\n\n\\a\n\n\\b\n\n\\e\n\nNewline continuation Backslash Single quote Double quote Bell Backspace Escape Null\n\n\\0\n\nF h Lib f L Bdff",
      "content_length": 2767,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 53,
      "content": "28\n\nChapter 2 Lexical Conventions and Syntax\n\nTable 2.1\n\nContinued\n\nCharacter\n\nDescription\n\n\\n\n\n\\v\n\n\\t\n\n\\r\n\n\\f\n\n\\OOO\n\n\\uxxxx\n\n\\Uxxxxxxxx\n\n\\N{charname}\n\nLine feed Vertical tab Horizontal tab Carriage return Form feed Octal value (\\000 to \\377) Unicode character (\\u0000 to \\uffff) Unicode character (\\U00000000 to \\Uffffffff) Unicode character name Hexadecimal value (\\x00 to \\xff)\n\n\\xhh\n\nThe escape codes \\OOO and \\x are used to embed characters into a string literal that can’t be easily typed (that is, control codes, nonprinting characters, symbols, internation- al characters, and so on). For these escape codes, you have to specify an integer value corresponding to a character value. For example, if you wanted to write a string literal for the word “Jalapeño”, you might write it as \"Jalape\\xf1o\" where \\xf1 is the char- acter code for ñ.\n\nIn Python 2 string literals correspond to 8-bit character or byte-oriented data.A serious limitation of these strings is that they do not fully support international charac- ter sets and Unicode.To address this limitation, Python 2 uses a separate string type for Unicode data.To write a Unicode string literal, you prefix the first quote with the letter “u”. For example:\n\ns = u\"Jalape\\u00f1o\"\n\nIn Python 3, this prefix character is unnecessary (and is actually a syntax error) as all strings are already Unicode. Python 2 will emulate this behavior if you run the inter- preter with the -U option (in which case all string literals will be treated as Unicode and the u prefix can be omitted).\n\nRegardless of which Python version you are using, the escape codes of \\u, \\U, and\n\n\\N in Table 2.1 are used to insert arbitrary characters into a Unicode literal. Every Unicode character has an assigned code point, which is typically denoted in Unicode charts as U+XXXXwhere XXXXis a sequence of four or more hexadecimal digits. (Note that this notation is not Python syntax but is often used by authors when describing Unicode characters.) For example, the character ñ has a code point of U+00F1.The \\u escape code is used to insert Unicode characters with code points in the range U+0000 to U+FFFF (for example, \\u00f1).The \\U escape code is used to insert characters in the range U+10000 and above (for example, \\U00012345). One subtle caution concerning the \\U escape code is that Unicode characters with code points above U+10000 usually get decomposed into a pair of characters known as a surrogate pair.This has to do with the internal representation of Unicode strings and is covered in more detail in Chapter 3,“Types and Objects.”\n\nUnicode characters also have a descriptive name. If you know the name, you can use\n\nthe \\N{character name} escape sequence. For example:\n\ns = u\"Jalape\\N{LATIN SMALL LETTER N WITH TILDE}o\"\n\nF h Lib f L Bdff",
      "content_length": 2790,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 54,
      "content": "Containers\n\n29\n\nFor an authoritative reference on code points and character names, consult http://www.unicode.org/charts.\n\nOptionally,you can precede a string literal with an r or R,such as in r'\\d'.These strings are known as raw strings because all their backslash characters are left intact—that is, the string literally contains the enclosed text,including the backslashes.The main use of raw strings is to specify literals where the backslash character has some significance.Examples might include the specification of regular expression patterns with the re module or speci- fying a filename on a Windows machine (for example, r'c:\\newdata\\tests').\n\nRaw strings cannot end in a single backslash, such as r\"\\\".Within raw strings, \\uXXXXescape sequences are still interpreted as Unicode characters, provided that the number of preceding \\ characters is odd. For instance, ur\"\\u1234\" defines a raw Unicode string with the single character U+1234, whereas ur\"\\\\u1234\" defines a seven-character string in which the first two characters are slashes and the remaining five characters are the literal \"u1234\".Also, in Python 2.2, the r must appear after the u in raw Unicode strings as shown. In Python 3.0, the u prefix is unnecessary.\n\nString literals should not be defined using a sequence of raw bytes that correspond to a data encoding such as UTF-8 or UTF-16. For example, directly writing a raw UTF-8 encoded string such as 'Jalape\\xc3\\xb1o' simply produces a nine-character string U+004A, U+0061, U+006C, U+0061, U+0070, U+0065, U+00C3, U+00B1, U+006F, which is probably not what you intended.This is because in UTF-8, the multi- byte sequence \\xc3\\xb1 is supposed to represent the single character U+00F1, not the two characters U+00C3 and U+00B1.To specify an encoded byte string as a literal, pre- fix the first quote with a \"b\" as in b\"Jalape\\xc3\\xb1o\".When defined, this literally creates a string of single bytes. From this representation, it is possible to create a normal string by decoding the value of the byte literal with its decode() method. More details about this are covered in Chapter 3 and Chapter 4,“Operators and Expressions.”\n\nThe use of byte literals is quite rare in most programs because this syntax did not appear until Python 2.6, and in that version there is no difference between a byte literal and a normal string. In Python 3, however, byte literals are mapped to a new bytes datatype that behaves differently than a normal string (see Appendix A,“Python 3”).\n\nContainers Values enclosed in square brackets [...], parentheses (...), and braces {...} denote a collection of objects contained in a list, tuple, and dictionary, respectively, as in the fol- lowing example:\n\na = [ 1, 3.4, 'hello' ] # A list b = ( 10, 20, 30 ) # A tuple c = { 'a': 3, 'b': 42 } # A dictionary\n\nList, tuple, and dictionary literals can span multiple lines without using the line- continuation character (\\). In addition, a trailing comma is allowed on the last item. For example:\n\na = [ 1,\n\n3.4, 'hello',\n\n]\n\nF h Lib f L Bdff",
      "content_length": 3038,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 55,
      "content": "30\n\nChapter 2 Lexical Conventions and Syntax\n\nOperators, Delimiters, and Special Symbols The following operators are recognized:\n\n+ - * ** / // % << >> & | ^ -= *= /= //= %= **= &= |= ^= >>= <<=\n\n~\n\n< > <= >= == != <> +=\n\nThe following tokens serve as delimiters for expressions, lists, dictionaries, and various parts of a statement:\n\n( ) [ ] { } , : . ` = ;\n\nFor example, the equal (=) character serves as a delimiter between the name and value of an assignment, whereas the comma (,) character is used to delimit arguments to a function, elements in lists and tuples, and so on.The period (.) is also used in floating- point numbers and in the ellipsis (...) used in extended slicing operations.\n\nFinally, the following special symbols are also used:\n\n' \" # \\ @\n\nThe characters $ and ? have no meaning in Python and cannot appear in a program except inside a quoted string literal.\n\nDocumentation Strings If the first statement of a module, class, or function definition is a string, that string becomes a documentation string for the associated object, as in the following example:\n\ndef fact(n):\n\n\"This function computes a factorial\" if (n <= 1): return 1 else: return n * fact(n - 1)\n\nCode-browsing and documentation-generation tools sometimes use documentation strings.The strings are accessible in the __doc__ attribute of an object, as shown here:\n\n>>> print fact.__doc__ This function computes a factorial >>>\n\nThe indentation of the documentation string must be consistent with all the other statements in a definition. In addition, a documentation string cannot be computed or assigned from a variable as an expression.The documentation string always has to be a string literal enclosed in quotes.\n\nDecorators Function, method, or class definitions may be preceded by a special symbol known as a decorator, the purpose of which is to modify the behavior of the definition that follows. Decorators are denoted with the @ symbol and must be placed on a separate line imme- diately before the corresponding function, method, or class. Here’s an example:\n\nclass Foo(object):\n\n@staticmethod def bar():\n\npass\n\nF h Lib f L Bdff",
      "content_length": 2131,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 56,
      "content": "Source Code Encoding\n\n31\n\nMore than one decorator can be used, but each one must be on a separate line. Here’s an example:\n\n@foo @bar def spam(): pass\n\nMore information about decorators can be found in Chapter 6,“Functions and Functional Programming,” and Chapter 7,“Classes and Object-Oriented Programming.”\n\nSource Code Encoding Python source programs are normally written in standard 7-bit ASCII. However, users working in Unicode environments may find this awkward—especially if they must write a lot of string literals with international characters.\n\nIt is possible to write Python source code in a different encoding by including a spe-\n\ncial encoding comment in the first or second line of a Python program:\n\n#!/usr/bin/env python # -*- coding: UTF-8 -*-\n\ns = \"Jalapeño\" # String in quotes is directly encoded in UTF-8.\n\nWhen the special coding: comment is supplied, string literals may be typed in directly using a Unicode-aware editor. However, other elements of Python, including identifier names and reserved words, should still be restricted to ASCII characters.\n\nF h Lib f L Bdff",
      "content_length": 1092,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 57,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 58,
      "content": "3\n\nTypes and Objects\n\nAll the data stored in a Python program is built around the concept of an object.\n\nObjects include fundamental data types such as numbers, strings, lists, and dictionaries. However, it’s also possible to create user-defined objects in the form of classes. In addi- tion, most objects related to program structure and the internal operation of the inter- preter are also exposed.This chapter describes the inner workings of the Python object model and provides an overview of the built-in data types. Chapter 4,“Operators and Expressions,” further describes operators and expressions. Chapter 7,“Classes and Object-Oriented Programming,” describes how to create user-defined objects.\n\nTerminology Every piece of data stored in a program is an object. Each object has an identity, a type (which is also known as its class), and a value. For example, when you write a = 42, an integer object is created with the value of 42.You can view the identity of an object as a pointer to its location in memory. a is a name that refers to this specific location.\n\nThe type of an object, also known as the object’s class, describes the internal repre- sentation of the object as well as the methods and operations that it supports.When an object of a particular type is created, that object is sometimes called an instance of that type.After an instance is created, its identity and type cannot be changed. If an object’s value can be modified, the object is said to be mutable. If the value cannot be modified, the object is said to be immutable.An object that contains references to other objects is said to be a container or collection.\n\nMost objects are characterized by a number of data attributes and methods.An attrib-\n\nute is a value associated with an object.A method is a function that performs some sort of operation on an object when the method is invoked as a function.Attributes and methods are accessed using the dot (.) operator, as shown in the following example:\n\na = 3 + 4j # Create a complex number r = a.real # Get the real part (an attribute)\n\nb = [1, 2, 3] # Create a list b.append(7) # Add a new element using the append method\n\nObject Identity and Type The built-in function id() returns the identity of an object as an integer.This integer usually corresponds to the object’s location in memory, although this is specific to the Python implementation and no such interpretation of the identity should be made.The\n\nF h Lib f L Bdff",
      "content_length": 2465,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 59,
      "content": "34\n\nChapter 3 Types and Objects\n\nis operator compares the identity of two objects.The built-in function type() returns the type of an object. Here’s an example of different ways you might compare two objects:\n\n# Compare two objects def compare(a,b): if a is b:\n\n# a and b are the same object statements\n\nif a == b:\n\n# a and b have the same value statements\n\nif type(a) is type(b):\n\n# a and b have the same type statements\n\nThe type of an object is itself an object known as the object’s class.This object is uniquely defined and is always the same for all instances of a given type.Therefore, the type can be compared using the is operator.All type objects are assigned names that can be used to perform type checking. Most of these names are built-ins, such as list, dict, and file. Here’s an example:\n\nif type(s) is list:\n\ns.append(item)\n\nif type(d) is dict: d.update(t)\n\nBecause types can be specialized by defining classes, a better way to check types is to use the built-in isinstance(object, type) function. Here’s an example:\n\nif isinstance(s,list): s.append(item)\n\nif isinstance(d,dict):\n\nd.update(t)\n\nBecause the isinstance() function is aware of inheritance, it is the preferred way to check the type of any Python object.\n\nAlthough type checks can be added to a program, type checking is often not as use-\n\nful as you might imagine. For one, excessive checking severely affects performance. Second, programs don’t always define objects that neatly fit into an inheritance hierar- chy. For instance, if the purpose of the preceding isinstance(s,list) statement is to test whether s is “list-like,” it wouldn’t work with objects that had the same program- ming interface as a list but didn’t directly inherit from the built-in list type.Another option for adding type-checking to a program is to define abstract base classes.This is described in Chapter 7.\n\nReference Counting and Garbage Collection All objects are reference-counted.An object’s reference count is increased whenever it’s assigned to a new name or placed in a container such as a list, tuple, or dictionary, as shown here:\n\na = 37 # Creates an object with value 37 b = a # Increases reference count on 37 c = [] c.append(b) # Increases reference count on 37\n\nF h Lib f L Bdff",
      "content_length": 2251,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 60,
      "content": "References and Copies\n\n35\n\nThis example creates a single object containing the value 37. a is merely a name that refers to the newly created object.When b is assigned a, b becomes a new name for the same object and the object’s reference count increases. Likewise, when you place b into a list, the object’s reference count increases again.Throughout the example, only one object contains 37.All other operations are simply creating new references to the object.\n\nAn object’s reference count is decreased by the del statement or whenever a refer-\n\nence goes out of scope (or is reassigned). Here’s an example:\n\ndel a # Decrease reference count of 37 b = 42 # Decrease reference count of 37 c[0] = 2.0 # Decrease reference count of 37\n\nThe current reference count of an object can be obtained using the sys.getrefcount() function. For example:\n\n>>> a = 37 >>> import sys >>> sys.getrefcount(a) 7 >>>\n\nIn many cases, the reference count is much higher than you might guess. For immutable data such as numbers and strings, the interpreter aggressively shares objects between dif- ferent parts of the program in order to conserve memory.\n\nWhen an object’s reference count reaches zero, it is garbage-collected. However, in some cases a circular dependency may exist among a collection of objects that are no longer in use. Here’s an example:\n\na = { } b = { } a['b'] = b # a contains reference to b b['a'] = a # b contains reference to a del a del b\n\nIn this example, the del statements decrease the reference count of a and b and destroy the names used to refer to the underlying objects. However, because each object con- tains a reference to the other, the reference count doesn’t drop to zero and the objects remain allocated (resulting in a memory leak).To address this problem, the interpreter periodically executes a cycle detector that searches for cycles of inaccessible objects and deletes them.The cycle-detection algorithm runs periodically as the interpreter allocates more and more memory during execution.The exact behavior can be fine-tuned and controlled using functions in the gc module (see Chapter 13,“Python Runtime Services”).\n\nReferences and Copies When a program makes an assignment such as a = b, a new reference to b is created. For immutable objects such as numbers and strings, this assignment effectively creates a copy of b. However, the behavior is quite different for mutable objects such as lists and dictionaries. Here’s an example:\n\n>>> a = [1,2,3,4] >>> b = a >>> b is a True\n\n# b is a reference to a\n\nF h Lib f L Bdff",
      "content_length": 2549,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 61,
      "content": "36\n\nChapter 3 Types and Objects\n\n>>> b[2] = -100 >>> a [1, 2, -100, 4] >>>\n\n# Change an element in b # Notice how a also changed\n\nBecause a and b refer to the same object in this example, a change made to one of the variables is reflected in the other.To avoid this, you have to create a copy of an object rather than a new reference.\n\nTwo types of copy operations are applied to container objects such as lists and dic- tionaries: a shallow copy and a deep copy.A shallow copy creates a new object but popu- lates it with references to the items contained in the original object. Here’s an example:\n\n>>> a = [ 1, 2, [3,4] ] >>> b = list(a) >>> b is a False >>> b.append(100) >>> b [1, 2, [3, 4], 100] >>> a [1, 2, [3, 4]] >>> b[2][0] = -100 >>> b [1, 2, [-100, 4], 100] >>> a [1, 2, [-100, 4]] >>> In this case, a and b are separate list objects, but the elements they contain are shared. Therefore, a modification to one of the elements of a also modifies an element of b, as shown.\n\n# Create a shallow copy of a.\n\n# Append element to b.\n\n# Notice that a is unchanged\n\n# Modify an element inside b\n\n# Notice the change inside a\n\nA deep copy creates a new object and recursively copies all the objects it contains.\n\nThere is no built-in operation to create deep copies of objects. However, the copy.deepcopy() function in the standard library can be used, as shown in the follow- ing example:\n\n>>> import copy >>> a = [1, 2, [3, 4]] >>> b = copy.deepcopy(a) >>> b[2][0] = -100 >>> b [1, 2, [-100, 4]] >>> a [1, 2, [3, 4]] >>>\n\n# Notice that a is unchanged\n\nFirst-Class Objects All objects in Python are said to be “first class.”This means that all objects that can be named by an identifier have equal status. It also means that all objects that can be named can be treated as data. For example, here is a simple dictionary containing two values:\n\nitems = {\n\n'number' : 42 'text' : \"Hello World\"\n\n}\n\nF h Lib f L Bdff",
      "content_length": 1917,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 62,
      "content": "Built-in Types for Representing Data\n\n37\n\nThe first-class nature of objects can be seen by adding some more unusual items to this dictionary. Here are some examples:\n\nitems[\"func\"] = abs # Add the abs() function import math items[\"mod\"] = math # Add a module items[\"error\"] = ValueError # Add an exception type nums = [1,2,3,4] items[\"append\"] = nums.append # Add a method of another object\n\nIn this example, the items dictionary contains a function, a module, an exception, and a method of another object. If you want, you can use dictionary lookups on items in place of the original names and the code will still work. For example:\n\n>>> items[\"func\"](-45) 45 >>> items[\"mod\"].sqrt(4) 2.0 >>> try: x = int(\"a lot\") ... ... except items[\"error\"] as e: ... ... Couldn't convert >>> items[\"append\"](100) >>> nums [1, 2, 3, 4, 100] >>>\n\nprint(\"Couldn't convert\")\n\n# Executes abs(-45)\n\n# Executes math.sqrt(4)\n\n# Same as except ValueError as e\n\n# Executes nums.append(100)\n\nThe fact that everything in Python is first-class is often not fully appreciated by new programmers. However, it can be used to write very compact and flexible code. For example, suppose you had a line of text such as \"GOOG,100,490.10\" and you wanted to convert it into a list of fields with appropriate type-conversion. Here’s a clever way that you might do it by creating a list of types (which are first-class objects) and execut- ing a few simple list processing operations:\n\n>>> line = \"GOOG,100,490.10\" >>> field_types = [str, int, float] >>> raw_fields = line.split(',') >>> fields = [ty(val) for ty,val in zip(field_types,raw_fields)] >>> fields ['GOOG', 100, 490.10000000000002] >>>\n\nBuilt-in Types for Representing Data There are approximately a dozen built-in data types that are used to represent most of the data used in programs.These are grouped into a few major categories as shown in Table 3.1.The Type Name column in the table lists the name or expression that you can use to check for that type using isinstance() and other type-related functions. Certain types are only available in Python 2 and have been indicated as such (in Python 3, they have been deprecated or merged into one of the other types).\n\nF h Lib f L Bdff",
      "content_length": 2211,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 63,
      "content": "38\n\nChapter 3 Types and Objects\n\nTable 3.1\n\nBuilt-In Types for Data Representation\n\nType Category\n\nType Name\n\nDescription\n\nNone Numbers\n\nSequences\n\nMapping Sets\n\ntype(None) The null object None Integer int Arbitrary-precision integer (Python 2 only) Floating point Complex number Boolean (True or False) Character string Unicode character string (Python 2 only) List Tuple A range of integers created by xrange() (In Python 3, it is called range.) Dictionary Mutable set Immutable set\n\nlong\n\nfloat\n\ncomplex\n\nbool\n\nstr\n\nunicode\n\nlist\n\ntuple\n\nxrange\n\ndict\n\nset\n\nfrozenset\n\nThe None Type The None type denotes a null object (an object with no value). Python provides exactly one null object, which is written as None in a program.This object is returned by func- tions that don’t explicitly return a value. None is frequently used as the default value of optional arguments, so that the function can detect whether the caller has actually passed a value for that argument. None has no attributes and evaluates to False in Boolean expressions.\n\nNumeric Types Python uses five numeric types: Booleans, integers, long integers, floating-point num- bers, and complex numbers. Except for Booleans, all numeric objects are signed.All numeric types are immutable.\n\nBooleans are represented by two values: True and False.The names True and\n\nFalse are respectively mapped to the numerical values of 1 and 0.\n\nIntegers represent whole numbers in the range of –2147483648 to 2147483647 (the\n\nrange may be larger on some machines). Long integers represent whole numbers of unlimited range (limited only by available memory).Although there are two integer types, Python tries to make the distinction seamless (in fact, in Python 3, the two types have been unified into a single integer type).Thus, although you will sometimes see ref- erences to long integers in existing Python code, this is mostly an implementation detail that can be ignored—just use the integer type for all integer operations.The one excep- tion is in code that performs explicit type checking for integer values. In Python 2, the expression isinstance(x, int) will return False if xis an integer that has been promoted to a long.\n\nFloating-point numbers are represented using the native double-precision (64-bit) representation of floating-point numbers on the machine. Normally this is IEEE 754, which provides approximately 17 digits of precision and an exponent in the range of\n\nF h Lib f L Bdff",
      "content_length": 2455,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 64,
      "content": "Built-in Types for Representing Data\n\n39\n\n–308 to 308.This is the same as the double type in C. Python doesn’t support 32-bit single-precision floating-point numbers. If precise control over the space and precision of numbers is an issue in your program, consider using the numpy extension (which can be found at http://numpy.sourceforge.net).\n\nComplex numbers are represented as a pair of floating-point numbers.The real and\n\nimaginary parts of a complex number zare available in z.real and z.imag.The method z.conjugate() calculates the complex conjugate of z(the conjugate of a+bj is a-bj).\n\nNumeric types have a number of properties and methods that are meant to simplify operations involving mixed arithmetic. For simplified compatibility with rational num- bers (found in the fractions module), integers have the properties x.numerator and x.denominator.An integer or floating-point number yhas the properties y.real and y.imag as well as the method y.conjugate() for compatibility with complex num- bers.A floating-point number ycan be converted into a pair of integers representing a fraction using y.as_integer_ratio().The method y.is_integer() tests if a floating-point number yrepresents an integer value. Methods y.hex() and y.fromhex() can be used to work with floating-point numbers using their low-level binary representation.\n\nSeveral additional numeric types are defined in library modules.The decimal mod- ule provides support for generalized base-10 decimal arithmetic.The fractions mod- ule adds a rational number type.These modules are covered in Chapter 14, “Mathematics.”\n\nSequence Types Sequences represent ordered sets of objects indexed by non-negative integers and include strings, lists, and tuples. Strings are sequences of characters, and lists and tuples are sequences of arbitrary Python objects. Strings and tuples are immutable; lists allow inser- tion, deletion, and substitution of elements.All sequences support iteration.\n\nOperations Common to All Sequences Table 3.2 shows the operators and methods that you can apply to all sequence types. Element iof sequence sis selected using the indexing operator s[i], and subse- quences are selected using the slicing operator s[i:j] or extended slicing operator s[i:j:stride] (these operations are described in Chapter 4).The length of any sequence is returned using the built-in len(s) function.You can find the minimum and maximum values of a sequence by using the built-in min(s) and max(s) functions. However, these functions only work for sequences in which the elements can be ordered (typically numbers and strings). sum(s) sums items in sbut only works for numeric data.\n\nTable 3.3 shows the additional operators that can be applied to mutable sequences\n\nsuch as lists.\n\nTable 3.2 Operations and Methods Applicable to All Sequences\n\nItem\n\nDescription\n\ns[i] s[i:j] s[i:j:stride]\n\nReturns element iof a sequence Returns a slice Returns an extended slice\n\nF h Lib f L Bdff",
      "content_length": 2958,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 65,
      "content": "40\n\nChapter 3 Types and Objects\n\nTable 3.2\n\nContinued\n\nItem\n\nDescription\n\nlen(s)\n\nmin(s)\n\nmax(s)\n\nsum(s [,initial])\n\nall(s)\n\nany(s)\n\nNumber of elements in s Minimum value in s Maximum value in s Sum of items in s Checks whether all items in sare True. Checks whether any item in sis True.\n\nTable 3.3 Operations Applicable to Mutable Sequences\n\nItem\n\nDescription\n\ns[i] = v\n\ns[i:j] = t\n\ns[i:j:stride] = t\n\ndel s[i]\n\ndel s[i:j]\n\ndel s[i:j:stride]\n\nItem assignment Slice assignment Extended slice assignment Item deletion Slice deletion Extended slice deletion\n\nLists Lists support the methods shown in Table 3.4.The built-in function list(s) converts any iterable type to a list. If sis already a list, this function constructs a new list that’s a shallow copy of s.The s.append(x) method appends a new element, x, to the end of the list.The s.index(x) method searches the list for the first occurrence of x. If no such element is found, a ValueError exception is raised. Similarly, the s.remove(x) method removes the first occurrence of xfrom the list or raises ValueError if no such item exists.The s.extend(t) method extends the list sby appending the elements in sequence t.\n\nThe s.sort() method sorts the elements of a list and optionally accepts a key func-\n\ntion and reverse flag, both of which must be specified as keyword arguments.The key function is a function that is applied to each element prior to comparison during sort- ing. If given, this function should take a single item as input and return the value that will be used to perform the comparison while sorting. Specifying a key function is use- ful if you want to perform special kinds of sorting operations such as sorting a list of strings, but with case insensitivity.The s.reverse() method reverses the order of the items in the list. Both the sort() and reverse() methods operate on the list elements in place and return None.\n\nTable 3.4\n\nList Methods\n\nMethod\n\nDescription\n\nlist(s)\n\ns.append(x)\n\ns.extend(t)\n\ns.count(x)\n\nConverts sto a list. Appends a new element, x, to the end of s. Appends a new list, t, to the end of s. Counts occurrences of xin s.\n\nF h Lib f L Bdff",
      "content_length": 2143,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 66,
      "content": "Built-in Types for Representing Data\n\n41\n\nTable 3.4\n\nContinued\n\nMethod\n\nDescription\n\ns.index(x [,start [,stop]]) Returns the smallest iwhere s[i]==x. start\n\ns.insert(i,x)\n\ns.pop([i])\n\ns.remove(x)\n\ns.reverse()\n\ns.sort([key [, reverse]])\n\nand stopoptionally specify the starting and ending index for the search. Inserts xat index i. Returns the element iand removes it from the list. If iis omitted, the last element is returned. Searches for xand removes it from s. Reverses items of sin place. Sorts items of sin place. keyis a key function. reverseis a flag that sorts the list in reverse order. keyand reverseshould always be speci- fied as keyword arguments.\n\nStrings Python 2 provides two string object types. Byte strings are sequences of bytes contain- ing 8-bit data.They may contain binary data and embedded NULL bytes. Unicode strings are sequences of unencoded Unicode characters, which are internally represented by 16-bit integers.This allows for 65,536 unique character values.Although the Unicode standard supports up to 1 million unique character values, these extra charac- ters are not supported by Python by default. Instead, they are encoded as a special two- character (4-byte) sequence known as a surrogate pair—the interpretation of which is up to the application.As an optional feature, Python may be built to store Unicode charac- ters using 32-bit integers.When enabled, this allows Python to represent the entire range of Unicode values from U+000000 to U+110000.All Unicode-related functions are adjusted accordingly.\n\nStrings support the methods shown in Table 3.5.Although these methods operate on\n\nstring instances, none of these methods actually modifies the underlying string data. Thus, methods such as s.capitalize(), s.center(), and s.expandtabs() always return a new string as opposed to modifying the string s. Character tests such as s.isalnum() and s.isupper() return True or False if all the characters in the string ssatisfy the test. Furthermore, these tests always return False if the length of the string is zero.\n\nThe s.find(), s.index(), s.rfind(), and s.rindex() methods are used to search sfor a substring.All these functions return an integer index to the substring in s. In addition, the find() method returns -1 if the substring isn’t found, whereas the index() method raises a ValueError exception.The s.replace() method is used to replace a substring with replacement text. It is important to emphasize that all of these methods only work with simple substrings. Regular expression pattern matching and searching is handled by functions in the re library module.\n\nThe s.split() and s.rsplit() methods split a string into a list of fields separated by a delimiter.The s.partition() and s.rpartition() methods search for a separa- tor substring and partition sinto three parts corresponding to text before the separator, the separator itself, and text after the separator.\n\nMany of the string methods accept optional startand endparameters, which are integer values specifying the starting and ending indices in s. In most cases, these values\n\nF h Lib f L Bdff",
      "content_length": 3111,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 67,
      "content": "42\n\nChapter 3 Types and Objects\n\nmay be given negative values, in which case the index is taken from the end of the string.\n\nThe s.translate() method is used to perform advanced character substitutions such as quickly stripping all control characters out of a string.As an argument, it accepts a translation table containing a one-to-one mapping of characters in the original string to characters in the result. For 8-bit strings, the translation table is a 256-character string. For Unicode, the translation table can be any sequence object swhere s[n] returns an integer character code or Unicode character corresponding to the Unicode character with integer value n.\n\nThe s.encode() and s.decode() methods are used to transform string data to and\n\nfrom a specified character encoding.As input, these accept an encoding name such as 'ascii', 'utf-8', or 'utf-16'.These methods are most commonly used to convert Unicode strings into a data encoding suitable for I/O operations and are described fur- ther in Chapter 9,“Input and Output.” Be aware that in Python 3, the encode() method is only available on strings, and the decode() method is only available on the bytes datatype.\n\nThe s.format() method is used to perform string formatting.As arguments, it accepts any combination of positional and keyword arguments. Placeholders in sdenot- ed by {item} are replaced by the appropriate argument. Positional arguments can be referenced using placeholders such as {0} and {1}. Keyword arguments are referenced using a placeholder with a name such as {name}. Here is an example:\n\n>>> a = \"Your name is {0} and your age is {age}\" >>> a.format(\"Mike\", age=40) 'Your name is Mike and your age is 40' >>>\n\nWithin the special format strings, the {item} placeholders can also include simple index and attribute lookup.A placeholder of {item[n]} where nis a number performs a sequence lookup on item.A placeholder of {item[key]} where keyis a non- numeric string performs a dictionary lookup of item[\"key\"].A placeholder of {item.attr} refers to attribute attrof item. Further details on the format() method can be found in the “String Formatting” section of Chapter 4.\n\nTable 3.5\n\nString Methods\n\nMethod\n\nDescription\n\ns.capitalize()\n\ns.center(width [, pad])\n\ns.count(sub [,start [,end]])\n\ns.decode([encoding [,errors]])\n\ns.encode([encoding [,errors]])\n\ns.endswith(suffix [,start [,end]])\n\ns.expandtabs([tabsize])\n\ns.find(sub [, start [,end]])\n\nCapitalizes the first character. Centers the string in a field of length width. padis a padding character. Counts occurrences of the specified substring sub. Decodes a string and returns a Unicode string (byte strings only). Returns an encoded version of the string (unicode strings only). Checks the end of the string for a suffix. Replaces tabs with spaces. Finds the first occurrence of the speci- fied substring subor returns -1.\n\nF h Lib f L Bdff",
      "content_length": 2888,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 68,
      "content": "Table 3.5\n\nContinued\n\nMethod\n\ns.format(*args, **kwargs)\n\ns.index(sub [, start [,end]])\n\ns.isalnum()\n\ns.isalpha()\n\ns.isdigit()\n\ns.islower()\n\ns.isspace()\n\ns.istitle()\n\ns.isupper()\n\ns.join(t)\n\ns.ljust(width [, fill])\n\ns.lower()\n\ns.lstrip([chrs])\n\ns.partition(sep)\n\ns.replace(old, new [,maxreplace])\n\ns.rfind(sub [,start [,end]])\n\ns.rindex(sub [,start [,end]])\n\ns.rjust(width [, fill])\n\ns.rpartition(sep)\n\ns.rsplit([sep [,maxsplit]])\n\ns.rstrip([chrs])\n\ns.split([sep [,maxsplit]])\n\nBuilt-in Types for Representing Data\n\n43\n\nDescription\n\nFormats s. Finds the first occurrence of the speci- fied substring subor raises an error. Checks whether all characters are alphanumeric. Checks whether all characters are alphabetic. Checks whether all characters are digits. Checks whether all characters are low- ercase. Checks whether all characters are whitespace. Checks whether the string is a title- cased string (first letter of each word capitalized). Checks whether all characters are uppercase. Joins the strings in sequence twith s as a separator. Left-aligns sin a string of size width. Converts to lowercase. Removes leading whitespace or charac- ters supplied in chrs. Partitions a string based on a separa- tor string sep. Returns a tuple (head,sep,tail) or (s, \"\",\"\") if sepisn’t found. Replaces a substring. Finds the last occurrence of a substring. Finds the last occurrence or raises an error. Right-aligns sin a string of length width. Partitions sbased on a separator sep, but searches from the end of the string. Splits a string from the end of the string using sepas a delimiter. maxsplitis the maximum number of splits to per- form. If maxsplitis omitted, the result is identical to the split() method. Removes trailing whitespace or charac- ters supplied in chrs. Splits a string using sepas a delimiter. maxsplitis the maximum number of splits to perform.\n\nF h Lib f L Bdff",
      "content_length": 1882,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 69,
      "content": "44\n\nChapter 3 Types and Objects\n\nTable 3.5\n\nContinued\n\ns.splitlines([keepends])\n\nSplits a string into a list of lines. If keependsis 1, trailing newlines are preserved.\n\ns.startswith(prefix [,start [,end]]) Checks whether a string starts with\n\ns.strip([chrs])\n\ns.swapcase()\n\ns.title()\n\ns.translate(table [,deletechars])\n\ns.upper()\n\ns.zfill(width)\n\nprefix. Removes leading and trailing white- space or characters supplied in chrs. Converts uppercase to lowercase, and vice versa. Returns a title-cased version of the string. Translates a string using a character translation table table, removing char- acters in deletechars. Converts a string to uppercase. Pads a string with zeros on the left up to the specified width.\n\nxrange() Objects The built-in function xrange([i,]j [,stride]) creates an object that represents a range of integers ksuch that i <= k < j.The first index, i, and the strideare optional and have default values of 0 and 1, respectively.An xrange object calculates its values whenever it’s accessed and although an xrange object looks like a sequence, it is actually somewhat limited. For example, none of the standard slicing operations are sup- ported.This limits the utility of xrange to only a few applications such as iterating in simple loops.\n\nIt should be noted that in Python 3, xrange() has been renamed to range().\n\nHowever, it operates in exactly the same manner as described here.\n\nMapping Types A mapping object represents an arbitrary collection of objects that are indexed by another collection of nearly arbitrary key values. Unlike a sequence, a mapping object is unordered and can be indexed by numbers, strings, and other objects. Mappings are mutable.\n\nDictionaries are the only built-in mapping type and are Python’s version of a hash table or associative array.You can use any immutable object as a dictionary key value (strings, numbers, tuples, and so on). Lists, dictionaries, and tuples containing mutable objects cannot be used as keys (the dictionary type requires key values to remain con- stant).\n\nTo select an item in a mapping object, use the key index operator m[k], where kis a key value. If the key is not found, a KeyError exception is raised.The len(m) function returns the number of items contained in a mapping object.Table 3.6 lists the methods and operations.\n\nF h Lib f L Bdff",
      "content_length": 2339,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 70,
      "content": "Built-in Types for Representing Data\n\n45\n\nTable 3.6 Methods and Operations for Dictionaries\n\nItem\n\nDescription\n\nlen(m)\n\nReturns the number of items in m. Returns the item of mwith key k. Sets m[k] to x. Removes m[k] from m. Returns True if kis a key in m. Removes all items from m. Makes a copy of m.\n\nm[k]\n\nm[k]=x\n\ndel m[k]\n\nk in m\n\nm.clear()\n\nm.copy() m.fromkeys(s [,value]) Create a new dictionary with keys from sequence sand values all set to value. Returns m[k] if found; otherwise, returns v. Returns True if mhas key k; otherwise, returns False. (Deprecated, use the in operator instead. Python 2 only) Returns a sequence of (key,value) pairs. Returns a sequence of key values. Returns m[k] if found and removes it from m; otherwise, returns defaultif supplied or raises KeyError if not. Removes a random (key,value) pair from mand returns it as a tuple.\n\nm.get(k [,v])\n\nm.has_key(k)\n\nm.items()\n\nm.keys()\n\nm.pop(k [,default])\n\nm.popitem()\n\nm.setdefault(k [, v]) Returns m[k] if found; otherwise, returns vand sets\n\nm.update(b)\n\nm.values()\n\nm[k] = v. Adds all objects from bto m. Returns a sequence of all values in m.\n\nMost of the methods in Table 3.6 are used to manipulate or retrieve the contents of a dictionary.The m.clear() method removes all items.The m.update(b) method updates the current mapping object by inserting all the (key,value) pairs found in the mapping object b.The m.get(k [,v]) method retrieves an object but allows for an optional default value, v, that’s returned if no such key exists.The m.setdefault(k [,v]) method is similar to m.get(), except that in addition to returning vif no object exists, it sets m[k] = v. If vis omitted, it defaults to None.The m.pop() method returns an item from a dictionary and removes it at the same time.The m.popitem() method is used to iteratively destroy the contents of a dictionary.\n\nThe m.copy() method makes a shallow copy of the items contained in a mapping\n\nobject and places them in a new mapping object.The m.fromkeys(s [,value]) method creates a new mapping with keys all taken from a sequence s. The type of the resulting mapping will be the same as m.The value associated with all of these keys is set to None unless an alternative value is given with the optional valueparameter.The fromkeys() method is defined as a class method, so an alternative way to invoke it would be to use the class name such as dict.fromkeys().\n\nThe m.items() method returns a sequence containing (key,value) pairs.The m.keys() method returns a sequence with all the key values, and the m.values() method returns a sequence with all the values. For these methods, you should assume that the only safe operation that can be performed on the result is iteration. In Python 2 the result is a list, but in Python 3 the result is an iterator that iterates over the current contents of the mapping. If you write code that simply assumes it is an iterator, it will\n\nF h Lib f L Bdff",
      "content_length": 2934,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 71,
      "content": "46\n\nChapter 3 Types and Objects\n\nbe generally compatible with both versions of Python. If you need to store the result of these methods as data, make a copy by storing it in a list. For example, items = list(m.items()). If you simply want a list of all keys, use keys = list(m).\n\nSet Types A set is an unordered collection of unique items. Unlike sequences, sets provide no indexing or slicing operations.They are also unlike dictionaries in that there are no key values associated with the objects.The items placed into a set must be immutable.Two different set types are available: set is a mutable set, and frozenset is an immutable set. Both kinds of sets are created using a pair of built-in functions:\n\ns = set([1,5,10,15]) f = frozenset(['a',37,'hello'])\n\nBoth set() and frozenset() populate the set by iterating over the supplied argu- ment. Both kinds of sets provide the methods outlined in Table 3.7.\n\nTable 3.7 Methods and Operations for Set Types\n\nItem\n\nDescription\n\nlen(s)\n\ns.copy()\n\ns.difference(t)\n\ns.intersection(t)\n\ns.isdisjoint(t)\n\ns.issubset(t)\n\nReturns the number of items in s. Makes a copy of s. Set difference. Returns all the items in s, but not in t. Intersection. Returns all the items that are both in s and in t. Returns True if sand thave no items in common. Returns True if sis a subset of t. Returns True if sis a superset of t.\n\ns.issuperset(t) s.symmetric_difference(t) Symmetric difference. Returns all the items that are\n\ns.union(t)\n\nin sor t, but not in both sets. Union. Returns all items in sor t.\n\nThe s.difference(t), s.intersection(t), s.symmetric_difference(t), and s.union(t) methods provide the standard mathematical operations on sets.The returned value has the same type as s(set or frozenset).The parameter tcan be any Python object that supports iteration.This includes sets, lists, tuples, and strings.These set operations are also available as mathematical operators, as described further in Chapter 4.\n\nMutable sets (set) additionally provide the methods outlined in Table 3.8.\n\nTable 3.8 Methods for Mutable Set Types\n\nItem\n\nDescription\n\ns.add(item)\n\ns.clear()\n\ns.difference_update(t)\n\nAdds itemto s. Has no effect if itemis already in s. Removes all items from s. Removes all the items from sthat are also in t.\n\nF h Lib f L Bdff",
      "content_length": 2283,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 72,
      "content": "Built-in Types for Representing Program Structure\n\n47\n\nTable 3.8\n\nContinued\n\nItem\n\nDescription\n\ns.discard(item)\n\ns.intersection_update(t)\n\ns.pop()\n\ns.remove(item)\n\nRemoves itemfrom s. If itemis not a member of s, nothing happens. Computes the intersection of sand tand leaves the result in s. Returns an arbitrary set element and removes it from s. Removes itemfrom s. If itemis not a member, KeyError is raised.\n\ns.symmetric_difference_update(t) Computes the symmetric difference of sand t\n\ns.update(t)\n\nand leaves the result in s. Adds all the items in tto s. tmay be anoth- er set, a sequence, or any object that sup- ports iteration.\n\nAll these operations modify the set sin place.The parameter tcan be any object that supports iteration.\n\nBuilt-in Types for Representing Program Structure In Python, functions, classes, and modules are all objects that can be manipulated as data.Table 3.9 shows types that are used to represent various elements of a program itself.\n\nTable 3.9\n\nBuilt-in Python Types for Program Structure\n\nType Category\n\nType Name\n\nDescription\n\nCallable\n\nModules Classes Types\n\ntypes.BuiltinFunctionType Built-in function or method type\n\nType of built-in types and classes Ancestor of all types and classes User-defined function Class method Module Ancestor of all types and classes Type of built-in types and classes\n\nobject\n\ntypes.FunctionType\n\ntypes.MethodType\n\ntypes.ModuleType\n\nobject\n\ntype\n\nNote that object and type appear twice in Table 3.9 because classes and types are both callable as a function.\n\nCallable Types Callable types represent objects that support the function call operation.There are sev- eral flavors of objects with this property, including user-defined functions, built-in func- tions, instance methods, and classes.\n\nF h Lib f L Bdff",
      "content_length": 1784,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 73,
      "content": "48\n\nChapter 3 Types and Objects\n\nUser-Defined Functions User-defined functions are callable objects created at the module level by using the def statement or with the lambda operator. Here’s an example:\n\ndef foo(x,y):\n\nreturn x + y\n\nbar = lambda x,y: x + y\n\nA user-defined function fhas the following attributes:\n\nAttribute(s) f.__doc__\n\nf.__name__\n\nf.__dict__\n\nf.__code__\n\nf.__defaults__\n\nf.__globals__\n\nDescription Documentation string Function name Dictionary containing function attributes Byte-compiled code Tuple containing the default arguments Dictionary defining the global namespace Tuple containing data related to nested scopes\n\nf.__closure__\n\nIn older versions of Python 2, many of the preceding attributes had names such as func_code, func_defaults, and so on.The attribute names listed are compatible with Python 2.6 and Python 3.\n\nMethods Methods are functions that are defined inside a class definition.There are three common types of methods—instance methods, class methods, and static methods:\n\nclass Foo(object):\n\ndef instance_method(self,arg):\n\nstatements\n\n@classmethod def class_method(cls,arg):\n\nstatements\n\n@staticmethod def static_method(arg):\n\nstatements\n\nAn instance method is a method that operates on an instance belonging to a given class. The instance is passed to the method as the first argument, which is called self by convention.A class method operates on the class itself as an object.The class object is passed to a class method in the first argument, cls.A static method is a just a function that happens to be packaged inside a class. It does not receive an instance or a class object as a first argument.\n\nBoth instance and class methods are represented by a special object of type\n\ntypes.MethodType. However, understanding this special type requires a careful under- standing of how object attribute lookup (.) works.The process of looking something up on an object (.) is always a separate operation from that of making a function call. When you invoke a method, both operations occur, but as distinct steps.This example illustrates the process of invoking f.instance_method(arg) on an instance of Foo in the preceding listing:\n\nf = Foo() # Create an instance meth = f.instance_method # Lookup the method and notice the lack of () meth(37) # Now call the method\n\nF h Lib f L Bdff",
      "content_length": 2322,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 74,
      "content": "Built-in Types for Representing Program Structure\n\n49\n\nIn this example, meth is known as a bound method.A bound method is a callable object that wraps both a function (the method) and an associated instance.When you call a bound method, the instance is passed to the method as the first parameter (self).Thus, meth in the example can be viewed as a method call that is primed and ready to go but which has not been invoked using the function call operator ().\n\nMethod lookup can also occur on the class itself. For example:\n\numeth = Foo.instance_method # Lookup instance_method on Foo umeth(f,37) # Call it, but explicitly supply self\n\nIn this example, umeth is known as an unbound method.An unbound method is a callable object that wraps the method function, but which expects an instance of the proper type to be passed as the first argument. In the example, we have passed f, a an instance of Foo, as the first argument. If you pass the wrong kind of object, you get a TypeError. For example:\n\n>>> umeth(\"hello\",5) Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: descriptor 'instance_method' requires a 'Foo' object but received a 'str' >>>\n\nFor user-defined classes, bound and unbound methods are both represented as an object of type types.MethodType, which is nothing more than a thin wrapper around an ordinary function object.The following attributes are defined for method objects:\n\nAttribute m.__doc__\n\nm.__name__\n\nm.__class__\n\nm.__func__\n\nm.__self__\n\nDescription Documentation string Method name Class in which this method was defined Function object implementing the method Instance associated with the method (None if unbound)\n\nOne subtle feature of Python 3 is that unbound methods are no longer wrapped by a types.MethodType object. If you access Foo.instance_method as shown in earlier examples, you simply obtain the raw function object that implements the method. Moreover, you’ll find that there is no longer any type checking on the self parameter.\n\nBuilt-in Functions and Methods The object types.BuiltinFunctionType is used to represent functions and methods implemented in C and C++.The following attributes are available for built-in methods:\n\nAttribute b.__doc__\n\nb.__name__\n\nb.__self__\n\nDescription Documentation string Function/method name Instance associated with the method (if bound)\n\nFor built-in functions such as len(), __self__ is set to None, indicating that the func- tion isn’t bound to any specific object. For built-in methods such as x.append, where x is a list object, __self__ is set to x.\n\nF h Lib f L Bdff",
      "content_length": 2585,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 75,
      "content": "50\n\nChapter 3 Types and Objects\n\nClasses and Instances as Callables Class objects and instances also operate as callable objects.A class object is created by the class statement and is called as a function in order to create new instances. In this case, the arguments to the function are passed to the __init__() method of the class in order to initialize the newly created instance.An instance can emulate a function if it defines a special method, __call__(). If this method is defined for an instance, x, then x(args) invokes the method x.__call__(args).\n\nClasses, Types, and Instances When you define a class, the class definition normally produces an object of type type. Here’s an example:\n\n>>> class Foo(object): ... ... >>> type(Foo) <type 'type'>\n\npass\n\nThe following table shows commonly used attributes of a type object t:\n\nAttribute t.__doc__\n\nt.__name__\n\nt.__bases__\n\nt.__dict__\n\nt.__module__\n\nt.__abstractmethods__\n\nDescription Documentation string Class name Tuple of base classes Dictionary holding class methods and variables Module name in which the class is defined Set of abstract method names (may be undefined if there aren’t any)\n\nWhen an object instance is created, the type of the instance is the class that defined it. Here’s an example:\n\n>>> f = Foo() >>> type(f) <class '__main__.Foo'>\n\nThe following table shows special attributes of an instance i:\n\nAttribute i.__class__\n\ni.__dict__\n\nDescription Class to which the instance belongs Dictionary holding instance data\n\nThe __dict__ attribute is normally where all of the data associated with an instance is stored.When you make assignments such as i.attr = value, the value is stored here. However, if a user-defined class uses __slots__, a more efficient internal representation is used and instances will not have a __dict__ attribute. More details on objects and the organization of the Python object system can be found in Chapter 7.\n\nModules The module type is a container that holds objects loaded with the import statement. When the statement import foo appears in a program, for example, the name foo is\n\nF h Lib f L Bdff",
      "content_length": 2106,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 76,
      "content": "Built-in Types for Interpreter Internals\n\n51\n\nassigned to the corresponding module object. Modules define a namespace that’s imple- mented using a dictionary accessible in the attribute __dict__.Whenever an attribute of a module is referenced (using the dot operator), it’s translated into a dictionary lookup. For example, m.xis equivalent to m.__dict__[\"x\"]. Likewise, assignment to an attribute such as m.x = yis equivalent to m.__dict__[\"x\"] = y.The following attributes are available:\n\nAttribute m.__dict__\n\nm.__doc__\n\nm.__name__\n\nm.__file__\n\nm.__path__\n\nDescription Dictionary associated with the module Module documentation string Name of the module File from which the module was loaded Fully qualified package name, only defined when the module object refers to a package\n\nBuilt-in Types for Interpreter Internals A number of objects used by the internals of the interpreter are exposed to the user. These include traceback objects, code objects, frame objects, generator objects, slice objects, and the Ellipsis as shown in Table 3.10. It is relatively rare for programs to manipulate these objects directly, but they may be of practical use to tool-builders and framework designers.\n\nTable 3.10 Built-in Python Types for Interpreter Internals\n\nType Name\n\nDescription\n\ntypes.CodeType\n\ntypes.FrameType\n\ntypes.GeneratorType\n\ntypes.TracebackType\n\nslice\n\nEllipsis\n\nByte-compiled code Execution frame Generator object Stack traceback of an exception Generated by extended slices Used in extended slices\n\nCode Objects Code objects represent raw byte-compiled executable code, or bytecode, and are typically returned by the built-in compile() function. Code objects are similar to functions except that they don’t contain any context related to the namespace in which the code was defined, nor do code objects store information about default argument values.A code object, c, has the following read-only attributes:\n\nAttribute\n\nDescription\n\nc.co_name\n\nc.co_argcount\n\nc.co_nlocals c.co_varnames\n\nFunction name. Number of positional arguments (including default values). Number of local variables used by the function. Tuple containing names of local variables.\n\nF h Lib f L Bdff",
      "content_length": 2180,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 77,
      "content": "52\n\nChapter 3 Types and Objects\n\nAttribute\n\nDescription\n\nc.co_cellvars\n\nc.co_freevars\n\nc.co_code\n\nc.co_consts\n\nc.co_names\n\nTuple containing names of variables referenced by nested func- tions. Tuple containing names of free variables used by nested func- tions. String representing raw bytecode. Tuple containing the literals used by the bytecode. Tuple containing names used by the bytecode. Name of the file in which the code was compiled.\n\nc.co_filename c.co_firstlineno First line number of the function. c.co_lnotab\n\nString encoding bytecode offsets to line numbers. Required stack size (including local variables). Integer containing interpreter flags. Bit 2 is set if the function uses a variable number of positional arguments using \"*args\". Bit 3 is set if the function allows arbitrary keyword arguments using \"**kwargs\". All other bits are reserved.\n\nc.co_stacksize\n\nc.co_flags\n\nFrame Objects Frame objects are used to represent execution frames and most frequently occur in traceback objects (described next).A frame object, f, has the following read-only attributes:\n\nAttribute f.f_back\n\nf.f_code\n\nf.f_locals\n\nf.f_globals\n\nf.f_builtins\n\nf.f_lineno\n\nf.f_lasti\n\nDescription Previous stack frame (toward the caller). Code object being executed. Dictionary used for local variables. Dictionary used for global variables. Dictionary used for built-in names. Line number. Current instruction. This is an index into the bytecode string of f_code.\n\nThe following attributes can be modified (and are used by debuggers and other tools):\n\nAttribute f.f_trace\n\nf.f_exc_type\n\nf.f_exc_value\n\nf.f_exc_traceback\n\nDescription Function called at the start of each source code line Most recent exception type (Python 2 only) Most recent exception value (Python 2 only) Most recent exception traceback (Python 2 only)\n\nTraceback Objects Traceback objects are created when an exception occurs and contain stack trace infor- mation.When an exception handler is entered, the stack trace can be retrieved using the\n\nF h Lib f L Bdff",
      "content_length": 2021,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 78,
      "content": "Built-in Types for Interpreter Internals\n\n53\n\nsys.exc_info() function.The following read-only attributes are available in traceback objects:\n\nAttribute t.tb_next\n\nt.tb_frame\n\nt.tb_lineno\n\nt.tb_lasti\n\nDescription Next level in the stack trace (toward the execution frame where the exception occurred) Execution frame object of the current level Line number where the exception occurred Instruction being executed in the current level\n\nGenerator Objects Generator objects are created when a generator function is invoked (see Chapter 6, “Functions and Functional Programming”).A generator function is defined whenever a function makes use of the special yield keyword.The generator object serves as both an iterator and a container for information about the generator function itself.The fol- lowing attributes and methods are available:\n\nAttribute g.gi_code\n\nDescription Code object for the generator function. Execution frame of the generator function. Integer indicating whether or not the generator function is currently running. Execute the function until the next yield statement and return the value (this method is called __next__ in Python 3). Sends a value to a generator. The passed value is returned by the yield expression in the generator that executes until the next yield expression is encoun- tered. send() returns the value passed to yield in this expression. Closes a generator by raising a GeneratorExit excep- tion in the generator function. This method executes auto- matically when a generator object is garbage-collected. g.throw(exc [,exc_value Raises an exception in a generator at the point of the [,exc_tb ]])\n\ng.gi_frame\n\ng.gi_running\n\ng.next()\n\ng.send(value)\n\ng.close()\n\ncurrent yield statement. excis the exception type, exc_valueis the exception value, and exc_tbis an optional traceback. If the resulting exception is caught and handled, returns the value passed to the next yield statement.\n\nSlice Objects Slice objects are used to represent slices given in extended slice syntax, such as a[i:j:stride], a[i:j, n:m], or a[..., i:j]. Slice objects are also created using the built-in slice([i,] j [,stride]) function.The following read-only attributes are available:\n\nF h Lib f L Bdff",
      "content_length": 2215,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 79,
      "content": "54\n\nChapter 3 Types and Objects\n\nAttribute s.start\n\ns.stop\n\ns.step\n\nDescription Lower bound of the slice; None if omitted Upper bound of the slice; None if omitted Stride of the slice; None if omitted\n\nSlice objects also provide a single method, s.indices(length).This function takes a length and returns a tuple (start,stop,stride) that indicates how the slice would be applied to a sequence of that length. Here’s an example:\n\ns = slice(10,20) # Slice object represents [10:20] s.indices(100) # Returns (10,20,1) —> [10:20] s.indices(15) # Returns (10,15,1) —> [10:15]\n\nEllipsis Object The Ellipsis object is used to indicate the presence of an ellipsis (...) in an index lookup [].There is a single object of this type, accessed through the built-in name Ellipsis. It has no attributes and evaluates as True. None of Python’s built-in types make use of Ellipsis, but it may be useful if you are trying to build advanced func- tionality into the indexing operator [] on your own objects.The following code shows how an Ellipsis gets created and passed into the indexing operator:\n\nclass Example(object):\n\ndef __getitem__(self,index):\n\nprint(index)\n\ne = Example() e[3, ..., 4] # Calls e.__getitem__((3, Ellipsis, 4))\n\nObject Behavior and Special Methods Objects in Python are generally classified according to their behaviors and the features that they implement. For example, all of the sequence types such as strings, lists, and tuples are grouped together merely because they all happen to support a common set of sequence operations such as s[n], len(s), etc.All basic interpreter operations are implemented through special object methods.The names of special methods are always preceded and followed by double underscores (__).These methods are automatically triggered by the interpreter as a program executes. For example, the operation x + yis mapped to an internal method, x.__add__(y), and an indexing operation, x[k], is mapped to x.__getitem__(k).The behavior of each data type depends entirely on the set of special methods that it implements.\n\nUser-defined classes can define new objects that behave like the built-in types simply\n\nby supplying an appropriate subset of the special methods described in this section. In addition, built-in types such as lists and dictionaries can be specialized (via inheritance) by redefining some of the special methods.\n\nThe next few sections describe the special methods associated with different cate-\n\ngories of interpreter features.\n\nObject Creation and Destruction The methods in Table 3.11 create, initialize, and destroy instances. __new__() is a class method that is called to create an instance.The __init__() method initializes the\n\nF h Lib f L Bdff",
      "content_length": 2709,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 80,
      "content": "Object Behavior and Special Methods\n\n55\n\nattributes of an object and is called immediately after an object has been newly created. The __del__() method is invoked when an object is about to be destroyed.This method is invoked only when an object is no longer in use. It’s important to note that the statement del xonly decrements an object’s reference count and doesn’t necessari- ly result in a call to this function. Further details about these methods can be found in Chapter 7.\n\nTable 3.11\n\nSpecial Methods for Object Creation and Destruction\n\nMethod\n\nDescription\n\n__new__(cls [,*args [,**kwargs]])\n\nA class method called to create a new instance\n\n__init__(self [,*args [,**kwargs]]) Called to initialize a new instance __del__(self) Called when an instance is being destroyed\n\nThe __new__() and __init__() methods are used together to create and initialize new instances.When an object is created by calling A(args), it is translated into the following steps:\n\nx = A.__new__(A,args) is isinstance(x,A): x.__init__(args)\n\nIn user-defined objects, it is rare to define __new__() or __del__(). __new__() is usually only defined in metaclasses or in user-defined objects that happen to inherit from one of the immutable types (integers, strings, tuples, and so on). __del__() is only defined in situations in which there is some kind of critical resource management issue, such as releasing a lock or shutting down a connection.\n\nObject String Representation The methods in Table 3.12 are used to create various string representations of an object.\n\nTable 3.12\n\nSpecial Methods for Object Representation\n\nMethod\n\nDescription\n\n__format__(self, format_spec) Creates a formatted representation __repr__(self) __str__(self)\n\nCreates a string representation of an object Creates a simple string representation\n\nThe __repr__() and __str__() methods create simple string representations of an object.The __repr__() method normally returns an expression string that can be eval- uated to re-create the object.This is also the method responsible for creating the output of values you see when inspecting variables in the interactive interpreter.This method is invoked by the built-in repr() function. Here’s an example of using repr() and eval() together:\n\na = [2,3,4,5] # Create a list s = repr(a) # s = '[2, 3, 4, 5]' b = eval(s) # Turns s back into a list\n\nF h Lib f L Bdff",
      "content_length": 2368,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 81,
      "content": "56\n\nChapter 3 Types and Objects\n\nIf a string expression cannot be created, the convention is for __repr__() to return a string of the form <...message...>, as shown here:\n\nf = open(\"foo\") a = repr(f) # a = \"<open file 'foo', mode 'r' at dc030>\"\n\nThe __str__() method is called by the built-in str() function and by functions relat- ed to printing. It differs from __repr__() in that the string it returns can be more concise and informative to the user. If this method is undefined, the __repr__() method is invoked.\n\nThe __format__() method is called by the format() function or the format() method of strings.The format_specargument is a string containing the format specifi- cation.This string is the same as the format_specargument to format(). For example:\n\nformat(x,\"spec\") # Calls x.__format__(\"spec\") \"x is {0:spec}\".format(x) # Calls x.__format__(\"spec\")\n\nThe syntax of the format specification is arbitrary and can be customized on an object- by-object basis. However, a standard syntax is described in Chapter 4.\n\nObject Comparison and Ordering Table 3.13 shows methods that can be used to perform simple tests on an object.The __bool__() method is used for truth-value testing and should return True or False. If undefined, the __len__() method is a fallback that is invoked to determine truth.The __hash__() method is defined on objects that want to work as keys in a dictionary. The value returned is an integer that should be identical for two objects that compare as equal. Furthermore, mutable objects should not define this method; any changes to an object will alter the hash value and make it impossible to locate an object on subse- quent dictionary lookups.\n\nTable 3.13\n\nSpecial Methods for Object Testing and Hashing\n\nMethod\n\nDescription\n\n__bool__(self)\n\n__hash__(self)\n\nReturns False or True for truth-value testing Computes an integer hash index\n\nObjects can implement one or more of the relational operators (<, >, <=, >=, ==, !=). Each of these methods takes two arguments and is allowed to return any kind of object, including a Boolean value, a list, or any other Python type. For instance, a numerical package might use this to perform an element-wise comparison of two matrices, returning a matrix with the results. If a comparison can’t be made, these functions may also raise an exception.Table 3.14 shows the special methods for comparison operators.\n\nTable 3.14 Methods for Comparisons\n\nMethod\n\nResult\n\n__lt__(self,other)\n\nself < other\n\n__le__(self,other)\n\nself <= other\n\n__gt__(self,other)\n\nself > other\n\n__ge__(self,other)\n\nself >= other\n\nF h Lib f L Bdff",
      "content_length": 2592,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 82,
      "content": "Object Behavior and Special Methods\n\n57\n\nTable 3.14\n\nContinued\n\nMethod\n\nResult\n\n__eq__(self,other)\n\nself == other\n\n__ne__(self,other)\n\nself != other\n\nIt is not necessary for an object to implement all of the operations in Table 3.14. However, if you want to be able to compare objects using == or use an object as a dic- tionary key, the __eq__() method should be defined. If you want to be able to sort objects or use functions such as min() or max(), then __lt__() must be minimally defined.\n\nType Checking The methods in Table 3.15 can be used to redefine the behavior of the type checking functions isinstance() and issubclass().The most common application of these methods is in defining abstract base classes and interfaces, as described in Chapter 7.\n\nTable 3.15 Methods for Type Checking\n\nMethod\n\nResult\n\n__instancecheck__(cls,object)\n\nisinstance(object, cls)\n\n__subclasscheck__(cls, sub)\n\nissubclass(sub, cls)\n\nAttribute Access The methods in Table 3.16 read, write, and delete the attributes of an object using the dot (.) operator and the del operator, respectively.\n\nTable 3.16\n\nSpecial Methods for Attribute Access\n\nMethod\n\nDescription\n\n__getattribute__(self,name)\n\n__getattr__(self, name)\n\nReturns the attribute self.name. Returns the attribute self.name if not found through normal attribute lookup or raise AttributeError.\n\n__setattr__(self, name, value) Sets the attribute self.name = value.\n\n__delattr__(self, name)\n\nOverrides the default mechanism. Deletes the attribute self.name.\n\nWhenever an attribute is accessed, the __getattribute__() method is always invoked. If the attribute is located, it is returned. Otherwise, the __getattr__() method is invoked.The default behavior of __getattr__() is to raise an AttributeError exception.The __setattr__() method is always invoked when setting an attribute, and the __delattr__() method is always invoked when deleting an attribute.\n\nF h Lib f L Bdff",
      "content_length": 1918,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 83,
      "content": "58\n\nChapter 3 Types and Objects\n\nAttribute Wrapping and Descriptors A subtle aspect of attribute manipulation is that sometimes the attributes of an object are wrapped with an extra layer of logic that interact with the get, set, and delete opera- tions described in the previous section.This kind of wrapping is accomplished by creat- ing a descriptor object that implements one or more of the methods in Table 3.17. Keep in mind that descriptions are optional and rarely need to be defined.\n\nTable 3.17\n\nSpecial Methods for Descriptor Object\n\nMethod\n\nDescription\n\n__get__(self,instance,cls)\n\nReturns an attribute value or raises AttributeError\n\n__set__(self,instance,value) Sets the attribute to value __delete__(self,instance)\n\nDeletes the attribute\n\nThe __get__(), __set__(), and __delete__() methods of a descriptor are meant to interact with the default implementation of __getattribute__(), __setattr__(), and __delattr__() methods on classes and types.This interaction occurs if you place an instance of a descriptor object in the body of a user-defined class. In this case, all access to the descriptor attribute will implicitly invoke the appropriate method on the descriptor object itself.Typically, descriptors are used to implement the low-level func- tionality of the object system including bound and unbound methods, class methods, static methods, and properties. Further examples appear in Chapter 7.\n\nSequence and Mapping Methods The methods in Table 3.18 are used by objects that want to emulate sequence and map- ping objects.\n\nTable 3.18 Methods for Sequences and Mappings\n\nMethod\n\nDescription\n\n__len__(self)\n\nReturns the length of self Returns self[key]\n\n__getitem__(self, key) __setitem__(self, key, value) Sets self[key] = value __delitem__(self, key)\n\nDeletes self[key] Returns True if objis in self; otherwise, returns False\n\n__contains__(self,obj)\n\nHere’s an example:\n\na = [1,2,3,4,5,6] len(a) # a.__len__() x = a[2] # x = a.__getitem__(2) a[1] = 7 # a.__setitem__(1,7) del a[2] # a.__delitem__(2) 5 in a # a.__contains__(5)\n\nThe __len__ method is called by the built-in len() function to return a nonnegative length.This function also determines truth values unless the __bool__() method has also been defined.\n\nF h Lib f L Bdff",
      "content_length": 2256,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 84,
      "content": "Object Behavior and Special Methods\n\n59\n\nFor manipulating individual items, the __getitem__() method can return an item\n\nby key value.The key can be any Python object but is typically an integer for sequences.The __setitem__() method assigns a value to an element.The __delitem__() method is invoked whenever the del operation is applied to a single element.The __contains__() method is used to implement the in operator. The slicing operations such as x = s[i:j] are also implemented using\n\n__getitem__(), __setitem__(), and __delitem__(). However, for slices, a special slice object is passed as the key.This object has attributes that describe the range of the slice being requested. For example:\n\na = [1,2,3,4,5,6] x = a[1:5] # x = a.__getitem__(slice(1,5,None)) a[1:3] = [10,11,12] # a.__setitem__(slice(1,3,None), [10,11,12]) del a[1:4] # a.__delitem__(slice(1,4,None))\n\nThe slicing features of Python are actually more powerful than many programmers realize. For example, the following variations of extended slicing are all supported and might be useful for working with multidimensional data structures such as matrices and arrays:\n\na = m[0:100:10] # Strided slice (stride=10) b = m[1:10, 3:20] # Multidimensional slice c = m[0:100:10, 50:75:5] # Multiple dimensions with strides m[0:5, 5:10] = n # extended slice assignment del m[:10, 15:] # extended slice deletion\n\nThe general format for each dimension of an extended slice is i:j[:stride], where strideis optional.As with ordinary slices, you can omit the starting or ending values for each part of a slice. In addition, the ellipsis (written as ...) is available to denote any number of trailing or leading dimensions in an extended slice:\n\na = m[..., 10:20] # extended slice access with Ellipsis m[10:20, ...] = n\n\nWhen using extended slices, the __getitem__(), __setitem__(), and __delitem__() methods implement access, modification, and deletion, respectively. However, instead of an integer, the value passed to these methods is a tuple containing a combination of slice or Ellipsis objects. For example,\n\na = m[0:10, 0:100:5, ...]\n\ninvokes __getitem__() as follows:\n\na = m.__getitem__((slice(0,10,None), slice(0,100,5), Ellipsis))\n\nPython strings, tuples, and lists currently provide some support for extended slices, which is described in Chapter 4. Special-purpose extensions to Python, especially those with a scientific flavor, may provide new types and objects with advanced support for extended slicing operations.\n\nIteration If an object, obj, supports iteration, it must provide a method, obj.__iter__(), that returns an iterator object.The iterator object iter, in turn, must implement a single method, iter.next() (or iter.__next__() in Python 3), that returns the next object or raises StopIteration to signal the end of iteration. Both of these methods are used by the implementation of the for statement as well as other operations that\n\nF h Lib f L Bdff",
      "content_length": 2936,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 85,
      "content": "60\n\nChapter 3 Types and Objects\n\nimplicitly perform iteration. For example, the statement for x in s is carried out by performing steps equivalent to the following:\n\n_iter = s.__iter__() while 1: try:\n\nx = _iter.next()(#_iter.__next__() in Python 3)\n\nexcept StopIteration:\n\nbreak\n\n# Do statements in body of for loop ...\n\nMathematical Operations Table 3.19 lists special methods that objects must implement to emulate numbers. Mathematical operations are always evaluated from left to right according the prece- dence rules described in Chapter 4; when an expression such as x + yappears, the interpreter tries to invoke the method x.__add__(y).The special methods beginning with rsupport operations with reversed operands.These are invoked only if the left operand doesn’t implement the specified operation. For example, if xin x + ydoesn’t support the __add__() method, the interpreter tries to invoke the method y.__radd__(x).\n\nTable 3.19 Methods for Mathematical Operations\n\nMethod\n\nResult\n\n__add__(self,other)\n\nself + other\n\n__sub__(self,other)\n\nself - other\n\n__mul__(self,other)\n\n__div__(self,other)\n\n__truediv__(self,other)\n\n__floordiv__(self,other)\n\nself * other self / other (Python 2 only) self / other (Python 3) self // other\n\n__mod__(self,other)\n\nself % other\n\n__divmod__(self,other)\n\ndivmod(self,other)\n\n__pow__(self,other [,modulo]) self ** other, pow(self, other,\n\nmodulo)\n\n__lshift__(self,other)\n\nself << other\n\n__rshift__(self,other)\n\nself >> other\n\n__and__(self,other)\n\nself & other\n\n__or__(self,other)\n\nself | other\n\n__xor__(self,other)\n\nself ^ other\n\n__radd__(self,other)\n\nother + self\n\n__rsub__(self,other)\n\nother - self\n\n__rmul__(self,other)\n\n__rdiv__(self,other)\n\n__rtruediv__(self,other)\n\n__rfloordiv__(self,other)\n\nother * self other / self(Python 2 only) other / self(Python 3) other // self\n\n__rmod__(self,other) __rdivmod__(self,other)\n\nother % self divmod(other,self)\n\nF h Lib f L Bdff",
      "content_length": 1915,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 86,
      "content": "Object Behavior and Special Methods\n\n61\n\nTable 3.19\n\nContinued\n\nMethod\n\nResult\n\n__rpow__(self,other)\n\nother ** self\n\n__rlshift__(self,other)\n\nother << self\n\n__rrshift__(self,other)\n\nother >> self\n\n__rand__(self,other)\n\nother & self\n\n__ror__(self,other)\n\nother | self\n\n__rxor__(self,other)\n\nother ^ self\n\n__iadd__(self,other)\n\nself += other\n\n__isub__(self,other)\n\nself -= other\n\n__imul__(self,other)\n\n__idiv__(self,other)\n\n__itruediv__(self,other)\n\n__ifloordiv__(self,other)\n\nself *= other self /= other (Python 2 only) self /= other (Python 3) self //= other\n\n__imod__(self,other)\n\nself %= other\n\n__ipow__(self,other)\n\nself **= other\n\n__iand__(self,other)\n\nself &= other\n\n__ior__(self,other)\n\nself |= other\n\n__ixor__(self,other)\n\nself ^= other\n\n__ilshift__(self,other)\n\nself <<= other\n\n__irshift__(self,other)\n\nself >>= other\n\n__neg__(self)\n\n–self\n\n__pos__(self)\n\n+self\n\n__abs__(self)\n\nabs(self)\n\n__invert__(self)\n\n~self\n\n__int__(self)\n\nint(self)\n\n__long__(self) __float__(self)\n\nlong(self)\n\nfloat(self)\n\n(Python 2 only)\n\n__complex__(self)\n\ncomplex(self)\n\nThe methods __iadd__(), __isub__(), and so forth are used to support in-place arithmetic operators such as a+=b and a-=b (also known as augmented assignment).A dis- tinction is made between these operators and the standard arithmetic methods because the implementation of the in-place operators might be able to provide certain cus- tomizations such as performance optimizations. For instance, if the selfparameter is not shared, the value of an object could be modified in place without having to allocate a newly created object for the result.\n\nThe three flavors of division operators—__div__(), __truediv__(), and\n\n__floordiv__()—are used to implement true division (/) and truncating division (//) operations.The reasons why there are three operations deal with a change in the semantics of integer division that started in Python 2.2 but became the default behavior in Python 3. In Python 2, the default behavior of Python is to map the / operator to __div__(). For integers, this operation truncates the result to an integer. In Python 3, division is mapped to __truediv__() and for integers, a float is returned.This latter\n\nF h Lib f L Bdff",
      "content_length": 2204,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 87,
      "content": "62\n\nChapter 3 Types and Objects\n\nbehavior can be enabled in Python 2 as an optional feature by including the statement from __future__ import division in a program.\n\nThe conversion methods __int__(), __long__(), __float__(), and\n\n__complex__() convert an object into one of the four built-in numerical types.These methods are invoked by explicit type conversions such as int() and float(). However, these methods are not used to implicitly coerce types in mathematical opera- tions. For example, the expression 3 + xproduces a TypeError even if xis a user- defined object that defines __int__() for integer conversion.\n\nCallable Interface An object can emulate a function by providing the __call__(self [,*args [, **kwargs]]) method. If an object, x, provides this method, it can be invoked like a function.That is, x(arg1, arg2, ...) invokes x.__call__(self, arg1, arg2, ...). Objects that emulate functions can be useful for creating functors or proxies. Here is a simple example:\n\nclass DistanceFrom(object):\n\ndef __init__(self,origin): self.origin = origin def __call__(self, x):\n\nreturn abs(x - self.origin)\n\nnums = [1, 37, 42, 101, 13, 9, -20] nums.sort(key=DistanceFrom(10)) # Sort by distance from 10\n\nIn this example, the DistanceFrom class creates instances that emulate a single- argument function.These can be used in place of a normal function—for instance, in the call to sort() in the example.\n\nContext Management Protocol The with statement allows a sequence of statements to execute under the control of another object known as a context manager.The general syntax is as follows:\n\nwith context [ as var]:\n\nstatements\n\nThe contextobject shown here is expected to implement the methods shown in Table 3.20.The __enter__() method is invoked when the with statement executes.The value returned by this method is placed into the variable specified with the optional as varspecifier.The __exit__() method is called as soon as control-flow leaves from the block of statements associated with the with statement.As arguments, __exit__() receives the current exception type, value, and traceback if an exception has been raised. If no errors are being handled, all three values are set to None.\n\nTable 3.20\n\nSpecial Methods for Context Managers\n\nMethod\n\nDescription\n\n__enter__(self)\n\nCalled when entering a new context. The return value is placed in the variable listed with the as specifier to the with state- ment.\n\nF h Lib f L Bdff",
      "content_length": 2442,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 88,
      "content": "Object Behavior and Special Methods\n\n63\n\nTable 3.20\n\nContinued\n\nMethod\n\nDescription\n\n__exit__(self, type, value, tb)\n\nCalled when leaving a context. If an excep- tion occurred, type, value, and tbhave the exception type, value, and traceback information. The primary use of the context management interface is to allow for simpli- fied resource control on objects involving system state such as open files, network connections, and locks. By implementing this interface, an object can safely clean up resources when execution leaves a context in which an object is being used. Further details are found in Chapter 5, “Program Structure and Control Flow.”\n\nObject Inspection and dir() The dir() function is commonly used to inspect objects.An object can supply the list of names returned by dir() by implementing __dir__(self). Defining this makes it easier to hide the internal details of objects that you don’t want a user to directly access. However, keep in mind that a user can still inspect the underlying __dict__ attribute of instances and classes to see everything that is defined.\n\nF h Lib f L Bdff",
      "content_length": 1107,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 89,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 90,
      "content": "4\n\nOperators and Expressions\n\nThis chapter describes Python’s built-in operators, expressions, and evaluation rules.\n\nAlthough much of this chapter describes Python’s built-in types, user-defined objects can easily redefine any of the operators to provide their own behavior.\n\nOperations on Numbers The following operations can be applied to all numeric types:\n\nOperation x + y\n\nx - y\n\nx * y\n\nx / y\n\nx // y\n\nx ** y\n\nx % y\n\n–x\n\nDescription Addition Subtraction Multiplication Division Truncating division Power (xy) Modulo (x mod y) Unary minus Unary plus\n\n+x\n\nThe truncating division operator (//, also known as floor division) truncates the result to an integer and works with both integers and floating-point numbers. In Python 2, the true division operator (/) also truncates the result to an integer if the operands are inte- gers.Therefore, 7/4 is 1, not 1.75. However, this behavior changes in Python 3, where division produces a floating-point result.The modulo operator returns the remainder of the division x // y. For example, 7 % 4 is 3. For floating-point numbers, the modulo operator returns the floating-point remainder of x // y, which is x – (x // y) * y. For complex numbers, the modulo (%) and truncating division operators (//) are invalid.\n\nThe following shifting and bitwise logical operators can be applied only to integers:\n\nOperation x << y\n\nx >> y\n\nx & y\n\nx | y\n\nx ^ y\n\nDescription Left shift Right shift Bitwise and Bitwise or Bitwise xor (exclusive or) Bitwise negation\n\n~x\n\nF h Lib f L Bdff",
      "content_length": 1518,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 91,
      "content": "66\n\nChapter 4 Operators and Expressions\n\nThe bitwise operators assume that integers are represented in a 2’s complement binary representation and that the sign bit is infinitely extended to the left. Some care is required if you are working with raw bit-patterns that are intended to map to native integers on the hardware.This is because Python does not truncate the bits or allow val- ues to overflow—instead, the result will grow arbitrarily large in magnitude.\n\nIn addition, you can apply the following built-in functions to all the numerical\n\ntypes:\n\nFunction abs(x)\n\nDescription Absolute value Returns (x // y, x % y)\n\ndivmod(x,y) pow(x,y [,modulo]) Returns (x ** y) % modulo round(x,[n])\n\nRounds to the nearest multiple of 10-n (floating-point numbers only)\n\nThe abs() function returns the absolute value of a number.The divmod() function returns the quotient and remainder of a division operation and is only valid on non- complex numbers.The pow() function can be used in place of the ** operator but also supports the ternary power-modulo function (often used in cryptographic algorithms). The round() function rounds a floating-point number, x, to the nearest multiple of 10 to the power minus n. If nis omitted, it’s set to 0. If xis equally close to two multiples, Python 2 rounds to the nearest multiple away from zero (for example, 0.5 is rounded to 1.0 and -0.5 is rounded to -1.0). One caution here is that Python 3 rounds equally close values to the nearest even multiple (for example, 0.5 is rounded to 0.0, and 1.5 is rounded to 2.0).This is a subtle portability issue for mathematical programs being port- ed to Python 3.\n\nThe following comparison operators have the standard mathematical interpretation\n\nand return a Boolean value of True for true, False for false:\n\nOperation x < y\n\nx > y\n\nx == y\n\nx != y\n\nx >= y\n\nx <= y\n\nDescription Less than Greater than Equal to Not equal to Greater than or equal to Less than or equal to\n\nComparisons can be chained together, such as in w < x < y < z. Such expressions are evaluated as w < x and x < y and y < z. Expressions such as x < y > zare legal but are likely to confuse anyone reading the code (it’s important to note that no com- parison is made between xand zin such an expression). Comparisons involving com- plex numbers are undefined and result in a TypeError.\n\nOperations involving numbers are valid only if the operands are of the same type. For built-in numbers, a coercion operation is performed to convert one of the types to the other, as follows:\n\n1. If either operand is a complex number, the other operand is converted to a com- plex number.\n\nF h Lib f L Bdff",
      "content_length": 2642,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 92,
      "content": "Operations on Sequences\n\n67\n\n2. If either operand is a floating-point number, the other is converted to a float. 3. Otherwise, both numbers must be integers and no conversion is performed.\n\nFor user-defined objects, the behavior of expressions involving mixed operands depends on the implementation of the object.As a general rule, the interpreter does not try to perform any kind of implicit type conversion.\n\nOperations on Sequences The following operators can be applied to sequence types, including strings, lists, and tuples:\n\nOperation s + r s * n, n * s v1,v2…, vn= s s[i]\n\ns[i:j]\n\ns[i:j:stride] x in s, x not in s for x in s:\n\nall(s)\n\nany(s)\n\nlen(s)\n\nmin(s)\n\nmax(s)\n\nDescription Concatenation Makes ncopies of s, where nis an integer Variable unpacking Indexing Slicing Extended slicing Membership Iteration Returns True if all items in sare true. Returns True if any item in sis true. Length Minimum item in s Maximum item in s Sum of items with an optional initial value\n\nsum(s [, initial])\n\nThe + operator concatenates two sequences of the same type.The s * noperator makes ncopies of a sequence. However, these are shallow copies that replicate elements by reference only. For example, consider the following code:\n\n>>> a = [3,4,5] >>> b = [a] >>> c = 4*b >>> c [[3, 4, 5], [3, 4, 5], [3, 4, 5], [3, 4, 5]] >>> a[0] = -7 >>> c [[-7, 4, 5], [-7, 4, 5], [-7, 4, 5], [-7, 4, 5]] >>>\n\nNotice how the change to a modified every element of the list c. In this case, a reference to the list a was placed in the list b.When b was replicated, four additional references to a were created. Finally, when a was modified, this change was propagated to all the other “copies” of a.This behavior of sequence multiplication is often unexpected and not the intent of the programmer. One way to work around the problem is to manually construct the replicated sequence by duplicating the contents of a. Here’s an example:\n\na = [ 3, 4, 5 ] c = [list(a) for j in range(4)] # list() makes a copy of a list\n\nThe copy module in the standard library can also be used to make copies of objects.\n\nF h Lib f L Bdff",
      "content_length": 2099,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 93,
      "content": "68\n\nChapter 4 Operators and Expressions\n\nAll sequences can be unpacked into a sequence of variable names. For example:\n\nitems = [ 3, 4, 5 ] x,y,z = items # x = 3, y = 4, z = 5\n\nletters = \"abc\" x,y,z = letters # x = 'a', y = 'b', z = 'c'\n\ndatetime = ((5, 19, 2008), (10, 30, \"am\")) (month,day,year),(hour,minute,am_pm) = datetime\n\nWhen unpacking values into variables, the number of variables must exactly match the number of items in the sequence. In addition, the structure of the variables must match that of the sequence. For example, the last line of the example unpacks values into six variables, organized into two 3-tuples, which is the structure of the sequence on the right. Unpacking sequences into variables works with any kind of sequence, including those created by iterators and generators.\n\nThe indexing operator s[n] returns the nth object from a sequence in which s[0]\n\nis the first object. Negative indices can be used to fetch characters from the end of a sequence. For example, s[-1] returns the last item. Otherwise, attempts to access ele- ments that are out of range result in an IndexError exception.\n\nThe slicing operator s[i:j] extracts a subsequence from sconsisting of the ele- ments with index k, where i <= k < j. Both iand jmust be integers or long inte- gers. If the starting or ending index is omitted, the beginning or end of the sequence is assumed, respectively. Negative indices are allowed and assumed to be relative to the end of the sequence. If ior jis out of range, they’re assumed to refer to the beginning or end of a sequence, depending on whether their value refers to an element before the first item or after the last item, respectively.\n\nThe slicing operator may be given an optional stride, s[i:j:stride], that causes the slice to skip elements. However, the behavior is somewhat more subtle. If a stride is supplied, iis the starting index; jis the ending index; and the produced subsequence is the elements s[i], s[i+stride], s[i+2*stride], and so forth until index jis reached (which is not included).The stride may also be negative. If the starting index i is omitted, it is set to the beginning of the sequence if strideis positive or the end of the sequence if strideis negative. If the ending index jis omitted, it is set to the end of the sequence if strideis positive or the beginning of the sequence if strideis negative. Here are some examples:\n\na = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n\nb = a[::2] # b = [0, 2, 4, 6, 8 ] c = a[::-2] # c = [9, 7, 5, 3, 1 ] d = a[0:5:2] # d = [0,2] e = a[5:0:-2] # e = [5,3,1] f = a[:5:1] # f = [0,1,2,3,4] g = a[:5:-1] # g = [9,8,7,6] h = a[5::1] # h = [5,6,7,8,9] i = a[5::-1] # i = [5,4,3,2,1,0] j = a[5:0:-1] # j = [5,4,3,2,1]\n\nThe x in soperator tests to see whether the object xis in the sequence sand returns True or False. Similarly, the x not in soperator tests whether xis not in the sequence s. For strings, the in and not in operators accept subtrings. For example,\n\nF h Lib f L Bdff",
      "content_length": 2983,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 94,
      "content": "Operations on Sequences\n\n69\n\n'hello' in 'hello world' produces True. It is important to note that the in oper- ator does not support wildcards or any kind of pattern matching. For this, you need to use a library module such as the re module for regular expression patterns.\n\nThe for x in soperator iterates over all the elements of a sequence and is\n\ndescribed further in Chapter 5, “Program Structure and Control Flow.” len(s) returns the number of elements in a sequence. min(s) and max(s) return the minimum and maximum values of a sequence, respectively, although the result may only make sense if the elements can be ordered with respect to the < operator (for example, it would make little sense to find the maximum value of a list of file objects). sum(s) sums all of the items in sbut usually works only if the items represent numbers.An optional initial value can be given to sum().The type of this value usually determines the result. For example, if you used sum(items, decimal.Decimal(0)), the result would be a Decimal object (see more about the decimal module in Chapter 14,“Mathematics”). Strings and tuples are immutable and cannot be modified after creation. Lists can be\n\nmodified with the following operators:\n\nOperation s[i] = x\n\ns[i:j] = r\n\ns[i:j:stride] = r\n\ndel s[i]\n\ndel s[i:j]\n\nDescription Index assignment Slice assignment Extended slice assignment Deletes an element Deletes a slice Deletes an extended slice\n\ndel s[i:j:stride]\n\nThe s[i] = xoperator changes element iof a list to refer to object x, increasing the reference count of x. Negative indices are relative to the end of the list, and attempts to assign a value to an out-of-range index result in an IndexError exception.The slicing assignment operator s[i:j] = rreplaces element k, where i <= k < j, with ele- ments from sequence r. Indices may have the same values as for slicing and are adjusted to the beginning or end of the list if they’re out of range. If necessary, the sequence sis expanded or reduced to accommodate all the elements in r. Here’s an example:\n\na = [1,2,3,4,5] a[1] = 6 # a = [1,6,3,4,5] a[2:4] = [10,11] # a = [1,6,10,11,5] a[3:4] = [-1,-2,-3] # a = [1,6,10,-1,-2,-3,5] a[2:] = [0] # a = [1,6,0]\n\nSlicing assignment may be supplied with an optional stride argument. However, the behavior is somewhat more restricted in that the argument on the right side must have exactly the same number of elements as the slice that’s being replaced. Here’s an example:\n\na = [1,2,3,4,5] a[1::2] = [10,11] # a = [1,10,3,11,5] a[1::2] = [30,40,50] # ValueError. Only two elements in slice on left\n\nThe del s[i] operator removes element ifrom a list and decrements its reference count. del s[i:j] removes all the elements in a slice.A stride may also be supplied, as in del s[i:j:stride].\n\nF h Lib f L Bdff",
      "content_length": 2800,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 95,
      "content": "70\n\nChapter 4 Operators and Expressions\n\nSequences are compared using the operators <, >, <=, >=, ==, and !=.When compar- ing two sequences, the first elements of each sequence are compared. If they differ, this determines the result. If they’re the same, the comparison moves to the second element of each sequence.This process continues until two different elements are found or no more elements exist in either of the sequences. If the end of both sequences is reached, the sequences are considered equal. If ais a subsequence of b, then a < b.\n\nStrings are compared using lexicographical ordering. Each character is assigned a unique numerical index determined by the character set (such as ASCII or Unicode).A character is less than another character if its index is less. One caution concerning char- acter ordering is that the preceding simple comparison operators are not related to the character ordering rules associated with locale or language settings.Thus, you would not use these operations to order strings according to the standard conventions of a foreign language (see the unicodedata and locale modules for more information).\n\nAnother caution, this time involving strings. Python has two types of string data: byte strings and Unicode strings. Byte strings differ from their Unicode counterpart in that they are usually assumed to be encoded, whereas Unicode strings represent raw unencoded character values. Because of this, you should never mix byte strings and Unicode together in expressions or comparisons (such as using + to concatenate a byte string and Unicode string or using == to compare mixed strings). In Python 3, mixing string types results in a TypeError exception, but Python 2 attempts to perform an implicit promotion of byte strings to Unicode.This aspect of Python 2 is widely con- sidered to be a design mistake and is often a source of unanticipated exceptions and inexplicable program behavior. So, to keep your head from exploding, don’t mix string types in sequence operations.\n\nString Formatting The modulo operator (s % d) produces a formatted string, given a format string, s, and a collection of objects in a tuple or mapping object (dictionary) d.The behavior of this operator is similar to the C sprintf() function.The format string contains two types of objects: ordinary characters (which are left unmodified) and conversion specifiers, each of which is replaced with a formatted string representing an element of the associ- ated tuple or mapping. If dis a tuple, the number of conversion specifiers must exactly match the number of objects in d. If dis a mapping, each conversion specifier must be associated with a valid key name in the mapping (using parentheses, as described short- ly). Each conversion specifier starts with the % character and ends with one of the con- version characters shown in Table 4.1.\n\nTable 4.1\n\nString Formatting Conversions\n\nCharacter Output Format\n\nd,i\n\nu\n\no\n\nx\n\nX\n\nf e\n\nDecimal integer or long integer. Unsigned integer or long integer. Octal integer or long integer. Hexadecimal integer or long integer. Hexadecimal integer (uppercase letters). Floating point as [-]m.dddddd. Floating point as [-]m.dddddde±xx.\n\nF h Lib f L Bdff",
      "content_length": 3218,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 96,
      "content": "String Formatting\n\n71\n\nTable 4.1\n\nContinued\n\nCharacter Output Format\n\nE\n\ng,G\n\ns\n\nr\n\nc\n\n%\n\nFloating point as [-]m.ddddddE±xx. Use %e or %E for exponents less than –4 or greater than the precision; oth- erwise, use %f. String or any object. The formatting code uses str() to generate strings. Produces the same string as produced by repr(). Single character. Literal %.\n\nBetween the % character and the conversion character, the following modifiers may appear, in this order:\n\n1. A key name in parentheses, which selects a specific item out of the mapping object. If no such element exists, a KeyError exception is raised.\n\n2. One or more of the following:\n\nn - sign, indicating left alignment. By default, values are right-aligned. n + sign, indicating that the numeric sign should be included (even if posi-\n\ntive).\n\nn 0, indicating a zero fill.\n\n3. A number specifying the minimum field width.The converted value will be printed in a field at least this wide and padded on the left (or right if the – flag is given) to make up the field width.\n\n4. A period separating the field width from a precision. 5. A number specifying the maximum number of characters to be printed from a string, the number of digits following the decimal point in a floating-point num- ber, or the minimum number of digits for an integer.\n\nIn addition, the asterisk (*) character may be used in place of a number in any width field. If present, the width will be read from the next item in the tuple.\n\nThe following code illustrates a few examples:\n\na = 42 b = 13.142783 c = \"hello\" d = {'x':13, 'y':1.54321, 'z':'world'} e = 5628398123741234\n\nr = \"a is %d\" % a # r = \"a is 42\" r = \"%10d %f\" % (a,b) # r = \" 42 13.142783\" r = \"%+010d %E\" % (a,b) # r = \"+000000042 1.314278E+01\" r = \"%(x)-10d %(y)0.3g\" % d # r = \"13 1.54\" r = \"%0.4s %s\" % (c, d['z']) # r = \"hell world\" r = \"%*.*f\" % (5,3,b) # r = \"13.143\" r = \"e = %d\" % e # r = \"e = 5628398123741234\"\n\nWhen used with a dictionary, the string formatting operator % is often used to mimic the string interpolation feature often found in scripting languages (e.g., expansion of\n\nF h Lib f L Bdff",
      "content_length": 2120,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 97,
      "content": "72\n\nChapter 4 Operators and Expressions\n\n$var symbols in strings). For example, if you have a dictionary of values, you can expand those values into fields within a formatted string as follows:\n\nstock = {\n\n'name' : 'GOOG', 'shares' : 100, 'price' : 490.10 }\n\nr = \"%(shares)d of %(name)s at %(price)0.2f\" % stock # r = \"100 shares of GOOG at 490.10\"\n\nThe following code shows how to expand the values of currently defined variables within a string.The vars() function returns a dictionary containing all of the variables defined at the point at which vars() is called.\n\nname = \"Elwood\" age = 41 r = \"%(name)s is %(age)s years old\" % vars()\n\nAdvanced String Formatting A more advanced form of string formatting is available using the s.format(*args, *kwargs) method on strings.This method collects an arbitrary collection of positional and keyword arguments and substitutes their values into placeholders embedded in s.A placeholder of the form '{n}', where nis a number, gets replaced by positional argu- ment nsupplied to format().A placeholder of the form '{name}' gets replaced by keyword argument namesupplied to format. Use '{{' to output a single '{' and '}}' to output a single '}'. For example:\n\nr = \"{0} {1} {2}\".format('GOOG',100,490.10) r = \"{name} {shares} {price}\".format(name='GOOG',shares=100,price=490.10) r = \"Hello {0}, your age is {age}\".format(\"Elwood\",age=47) r = \"Use {{ and }} to output single curly braces\".format()\n\nWith each placeholder, you can additionally perform both indexing and attribute lookups. For example, in '{name[n]}' where nis an integer, a sequence lookup is per- formed and in '{name[key]}' where keyis a non-numeric string, a dictionary lookup of the form name['key'] is performed. In '{name.attr}', an attribute lookup is per- formed. Here are some examples:\n\nstock = { 'name' : 'GOOG', 'shares' : 100, 'price' : 490.10 }\n\nr = \"{0[name]} {0[shares]} {0[price]}\".format(stock)\n\nx = 3 + 4j r = \"{0.real} {0.imag}\".format(x)\n\nIn these expansions, you are only allowed to use names.Arbitrary expressions, method calls, and other operations are not supported.\n\nYou can optionally specify a format specifier that gives more precise control over the output.This is supplied by adding an optional format specifier to each placeholder using a colon (:), as in '{place:format_spec}'. By using this specifier, you can specify col- umn widths, decimal places, and alignment. Here is an example:\n\nr = \"{name:8} {shares:8d} {price:8.2f}\".format (name=\"GOOG\",shares=100,price=490.10)\n\nF h Lib f L Bdff",
      "content_length": 2530,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 98,
      "content": "Advanced String Formatting\n\n73\n\nThe general format of a specifier is [[fill[align]][sign][0][width] [.precision][type] where each part enclosed in [] is optional.The widthspecifier specifies the minimum field width to use, and the alignspecifier is one of '<', '>’, or '^' for left, right, and centered alignment within the field.An optional fill character fillis used to pad the space. For example:\n\nname = \"Elwood\" r = \"{0:<10}\".format(name) # r = 'Elwood ' r = \"{0:>10}\".format(name) # r = ' Elwood' r = \"{0:^10}\".format(name) # r = ' Elwood ' r = \"{0:=^10}\".format(name) # r = '==Elwood=='\n\nThe typespecifier indicates the type of data.Table 4.2 lists the supported format codes. If not supplied, the default format code is 's' for strings, 'd' for integers, and 'f' for floats.\n\nTable 4.2\n\nAdvanced String Formatting Type Specifier Codes\n\nCharacter Output Format\n\nd\n\nb\n\no\n\nx\n\nX\n\nf,F\n\ne\n\nE\n\ng,G\n\nn\n\n%\n\ns\n\nDecimal integer or long integer. Binary integer or long integer. Octal integer or long integer. Hexadecimal integer or long integer. Hexadecimal integer (uppercase letters). Floating point as [-]m.dddddd. Floating point as [-]m.dddddde±xx. Floating point as [-]m.ddddddE±xx. Use e or E for exponents less than –4 or greater than the precision; other- wise, use f. Same as g except that the current locale setting determines the decimal point character. Multiplies a number by 100 and displays it using f format followed by a % sign. String or any object. The formatting code uses str() to generate strings. Single character.\n\nc\n\nThe signpart of a format specifier is one of '+', '-', or ' '.A '+' indicates that a leading sign should be used on all numbers. '-' is the default and only adds a sign character for negative numbers.A ' ' adds a leading space to positive numbers.The precisionpart of the specifier supplies the number of digits of accuracy to use for decimals. If a leading '0' is added to the field width for numbers, numeric values are padded with leading 0s to fill the space. Here are some examples of formatting different kinds of numbers:\n\nx = 42 r = '{0:10d}'.format(x) # r = ' 42' r = '{0:10x}'.format(x) # r = ' 2a' r = '{0:10b}'.format(x) # r = ' 101010' r = '{0:010b}'.format(x) # r = '0000101010'\n\ny = 3.1415926 r = '{0:10.2f}'.format(y) # r = ' 3.14'\n\nF h Lib f L Bdff",
      "content_length": 2303,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 99,
      "content": "74\n\nChapter 4 Operators and Expressions\n\nr = '{0:10.2e}'.format(y) # r = ' 3.14e+00' r = '{0:+10.2f}'.format(y) # r = ' +3.14' r = '{0:+010.2f}'.format(y) # r = '+000003.14' r = '{0:+10.2%}'.format(y) # r = ' +314.16%'\n\nParts of a format specifier can optionally be supplied by other fields supplied to the for- mat function.They are accessed using the same syntax as normal fields in a format string. For example:\n\ny = 3.1415926 r = '{0:{width}.{precision}f}'.format(y,width=10,precision=3) r = '{0:{1}.{2}f}'.format(y,10,3)\n\nThis nesting of fields can only be one level deep and can only occur in the format specifier portion. In addition, the nested values cannot have any additional format speci- fiers of their own.\n\nOne caution on format specifiers is that objects can define their own custom set of\n\nspecifiers. Underneath the covers, advanced string formatting invokes the special method __format__(self, format_spec) on each field value.Thus, the capabilities of the format() operation are open-ended and depend on the objects to which it is applied. For example, dates, times, and other kinds of objects may define their own for- mat codes.\n\nIn certain cases, you may want to simply format the str() or repr() representation\n\nof an object, bypassing the functionality implemented by its __format__() method. To do this, you can add the '!s' or '!r' modifier before the format specifier. For example:\n\nname = \"Guido\" r = '{0!r:^20}'.format(name) # r = \" 'Guido' \"\n\nOperations on Dictionaries Dictionaries provide a mapping between names and objects.You can apply the following operations to dictionaries:\n\nOperation x = d[k]\n\nd[k] = x\n\ndel d[k]\n\nk in d\n\nlen(d)\n\nDescription Indexing by key Assignment by key Deletes an item by key Tests for the existence of a key Number of items in the dictionary\n\nKey values can be any immutable object, such as strings, numbers, and tuples. In addi- tion, dictionary keys can be specified as a comma-separated list of values, like this:\n\nd = { } d[1,2,3] = \"foo\" d[1,0,3] = \"bar\"\n\nIn this case, the key values represent a tuple, making the preceding assignments identical to the following:\n\nd[(1,2,3)] = \"foo\" d[(1,0,3)] = \"bar\"\n\nF h Lib f L Bdff",
      "content_length": 2191,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 100,
      "content": "Augmented Assignment\n\n75\n\nOperations on Sets The set and frozenset type support a number of common set operations:\n\nOperation s | t\n\ns & t\n\ns – t\n\ns ^ t\n\nlen(s) max(s) min(s)\n\nDescription Union of sand t Intersection of sand t Set difference Symmetric difference Number of items in the set Maximum value Minimum value\n\nThe result of union, intersection, and difference operations will have the same type as the left-most operand. For example, if sis a frozenset, the result will be a frozenset even if t is a set.\n\nAugmented Assignment Python provides the following set of augmented assignment operators:\n\nOperation x += y\n\nDescription x = x + y\n\nx -= y\n\nx = x - y\n\nx *= y\n\nx = x * y\n\nx /= y\n\nx = x / y\n\nx //= y\n\nx = x // y\n\nx **= y\n\nx = x ** y\n\nx %= y\n\nx = x % y\n\nx &= y\n\nx = x & y\n\nx |= y\n\nx = x | y\n\nx ^= y\n\nx = x ^ y\n\nx >>= y\n\nx = x >> y\n\nx <<= y\n\nx = x << y\n\nThese operators can be used anywhere that ordinary assignment is used. Here’s an example:\n\na = 3 b = [1,2] c = \"Hello %s %s\" a += 1 # a = 4 b[1] += 10 # b = [1, 12] c %= (\"Monty\", \"Python\") # c = \"Hello Monty Python\"\n\nAugmented assignment doesn’t violate mutability or perform in-place modification of objects.Therefore, writing x += ycreates an entirely new object xwith the value x + y. User-defined classes can redefine the augmented assignment operators using the spe- cial methods described in Chapter 3,“Types and Objects.”\n\nF h Lib f L Bdff",
      "content_length": 1411,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 101,
      "content": "76\n\nChapter 4 Operators and Expressions\n\nThe Attribute (.) Operator The dot (.) operator is used to access the attributes of an object. Here’s an example:\n\nfoo.x = 3 print foo.y a = foo.bar(3,4,5)\n\nMore than one dot operator can appear in a single expression, such as in foo.y.a.b. The dot operator can also be applied to the intermediate results of functions, as in a = foo.bar(3,4,5).spam.\n\nUser-defined classes can redefine or customize the behavior of (.). More details are\n\nfound in Chapter 3 and Chapter 7,“Classes and Object-Oriented Programming.”\n\nThe Function Call () Operator The f(args) operator is used to make a function call on f. Each argument to a func- tion is an expression. Prior to calling the function, all of the argument expressions are fully evaluated from left to right.This is sometimes known as applicative order evaluation. It is possible to partially evaluate function arguments using the partial() function\n\nin the functools module. For example:\n\ndef foo(x,y,z):\n\nreturn x + y + z\n\nfrom functools import partial f = partial(foo,1,2) # Supply values to x and y arguments of foo f(3) # Calls foo(1,2,3), result is 6\n\nThe partial() function evaluates some of the arguments to a function and returns an object that you can call to supply the remaining arguments at a later point. In the previ- ous example, the variable f represents a partially evaluated function where the first two arguments have already been calculated.You merely need to supply the last remaining argument value for the function to execute. Partial evaluation of function arguments is closely related to a process known as currying, a mechanism by which a function taking multiple arguments such as f(x,y) is decomposed into a series of functions each taking only one argument (for example, you partially evaluate f by fixing x to get a new func- tion to which you give values of y to produce a result).\n\nConversion Functions Sometimes it’s necessary to perform conversions between the built-in types.To convert between types, you simply use the type name as a function. In addition, several built-in functions are supplied to perform special kinds of conversions.All of these functions return a new object representing the converted value.\n\nFunction\n\nDescription\n\nint(x [,base])\n\nfloat(x)\n\ncomplex(real [,imag])\n\nstr(x)\n\nConverts xto an integer. basespecifies the base if x is a string. Converts xto a floating-point number. Creates a complex number. Converts object xto a string representation.\n\nF h Lib f L Bdff",
      "content_length": 2511,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 102,
      "content": "Boolean Expressions and Truth Values\n\n77\n\nFunction\n\nDescription\n\nrepr(x) format(x [,format_spec]) Converts object xto a formatted string. Evaluates a string and returns an object. eval(str) Converts sto a tuple. Converts sto a list. Converts sto a set. Creates a dictionary. dmust be a sequence of (key,value) tuples. Converts sto a frozen set. Converts an integer to a character. Converts an integer to a Unicode character (Python 2 only). Converts a single character to its integer value. Converts an integer to a hexadecimal string. Converts an integer to a binary string. Converts an integer to an octal string.\n\nConverts object xto an expression string.\n\ntuple(s)\n\nlist(s)\n\nset(s)\n\ndict(d)\n\nfrozenset(s)\n\nchr(x)\n\nunichr(x)\n\nord(x)\n\nhex(x)\n\nbin(x)\n\noct(x)\n\nNote that the str() and repr() functions may return different results. repr() typically creates an expression string that can be evaluated with eval() to re-create the object. On the other hand, str() produces a concise or nicely formatted representation of the object (and is used by the print statement).The format(x, [format_spec]) function produces the same output as that produced by the advanced string formatting operations but applied to a single object x.As input, it accepts an optional format_spec, which is a string containing the formatting code.The ord() function returns the integer ordinal value of a character. For Unicode, this value will be the integer code point.The chr() and unichr() functions convert integers back into characters.\n\nTo convert strings back into numbers, use the int(), float(), and complex() functions.The eval() function can also convert a string containing a valid expression to an object. Here’s an example:\n\na = int(\"34\") # a = 34 b = long(\"0xfe76214\", 16) # b = 266822164L (0xfe76214L) b = float(\"3.1415926\") # b = 3.1415926 c = eval(\"3, 5, 6\") # c = (3,5,6)\n\nIn functions that create containers (list(), tuple(), set(), and so on), the argument may be any object that supports iteration used to generate all the items used to populate the object that’s being created.\n\nBoolean Expressions and Truth Values The and, or, and not keywords can form Boolean expressions.The behavior of these operators is as follows:\n\nOperator x or y x and y\n\nnot x\n\nDescription If xis false, return y; otherwise, return x. If xis false, return x; otherwise, return y. If xis false, return 1; otherwise, return 0.\n\nF h Lib f L Bdff",
      "content_length": 2416,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 103,
      "content": "78\n\nChapter 4 Operators and Expressions\n\nWhen you use an expression to determine a true or false value, True, any nonzero number, nonempty string, list, tuple, or dictionary is taken to be true. False; zero; None; and empty lists, tuples, and dictionaries evaluate as false. Boolean expressions are evaluat- ed from left to right and consume the right operand only if it’s needed to determine the final value. For example, a and b evaluates b only if a is true.This is sometimes known as “short-circuit” evaluation.\n\nObject Equality and Identity The equality operator (x == y) tests the values of xand yfor equality. In the case of lists and tuples, all the elements are compared and evaluated as true if they’re of equal value. For dictionaries, a true value is returned only if xand yhave the same set of keys and all the objects with the same key have equal values.Two sets are equal if they have the same elements, which are compared using equality (==).\n\nThe identity operators (x is yand x is not y) test two objects to see whether they refer to the same object in memory. In general, it may be the case that x == y, but x is not y.\n\nComparison between objects of noncompatible types, such as a file and a floating-\n\npoint number, may be allowed, but the outcome is arbitrary and may not make any sense. It may also result in an exception depending on the type.\n\nOrder of Evaluation Table 4.3 lists the order of operation (precedence rules) for Python operators.All opera- tors except the power (**) operator are evaluated from left to right and are listed in the table from highest to lowest precedence.That is, operators listed first in the table are evaluated before operators listed later. (Note that operators included together within subsections, such as x * y, x / y, x / y, and x % y, have equal precedence.)\n\nTable 4.3 Order of Evaluation (Highest to Lowest)\n\nOperator\n\nName\n\nTuple, list, and dictionary creation Indexing and slicing Attributes Function calls Unary operators Power (right associative)\n\n(...), [...], {...}\n\ns[i], s[i:j]\n\ns.attr\n\nf(...)\n\n+x, -x, ~x\n\nx ** y x * y, x / y, x // y, x % y Multiplication, division, floor division, modulo x + y, x - y\n\nAddition, subtraction Bit-shifting Bitwise and Bitwise exclusive or Bitwise or Comparison, identity, and sequence member- ship tests\n\nx << y, x >> y\n\nx & y\n\nx ^ y\n\nx | y\n\nx < y, x <= y,\n\nx > y, x >= y,\n\nx == y, x != y\n\nF h Lib f L Bdff",
      "content_length": 2414,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 104,
      "content": "Order of Evaluation\n\n79\n\nTable 4.3\n\nContinued\n\nOperator\n\nName\n\nx is y, x is not y\n\nx in s, x not in s\n\nnot x\n\nx and y\n\nx or y\n\nlambda args: expr\n\nLogical negation Logical and Logical or Anonymous function\n\nThe order of evaluation is not determined by the types of xand yin Table 4.3. So, even though user-defined objects can redefine individual operators, it is not possible to cus- tomize the underlying evaluation order, precedence, and associativity rules.\n\nConditional Expressions A common programming pattern is that of conditionally assigning a value based on the result of an expression. For example:\n\nif a <= b:\n\nminvalue = a\n\nelse:\n\nminvalue = b\n\nThis code can be shortened using a conditional expression. For example:\n\nminvalue = a if a <=b else b\n\nIn such expressions, the condition in the middle is evaluated first.The expression to the left of the if is then evaluated if the result is True. Otherwise, the expression after the else is evaluated.\n\nConditional expressions should probably be used sparingly because they can lead to confusion (especially if they are nested or mixed with other complicated expressions). However, one particularly useful application is in list comprehensions and generator expressions. For example:\n\nvalues = [1, 100, 45, 23, 73, 37, 69 ] clamped = [x if x < 50 else 50 for x in values] print(clamped) # [1, 50, 45, 23, 50, 37, 50]\n\nF h Lib f L Bdff",
      "content_length": 1392,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 105,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 106,
      "content": "5\n\nProgram Structure and Control Flow\n\nThis chapter covers the details of program structure and control flow.Topics include\n\nconditionals, iteration, exceptions, and context managers.\n\nProgram Structure and Execution Python programs are structured as a sequence of statements.All language features, including variable assignment, function definitions, classes, and module imports, are statements that have equal status with all other statements. In fact, there are no “special” statements, and every statement can be placed anywhere in a program. For example, this code defines two different versions of a function:\n\nif debug:\n\ndef square(x):\n\nif not isinstance(x,float):\n\nraise TypeError(\"Expected a float\")\n\nreturn x * x\n\nelse:\n\ndef square(x):\n\nreturn x * x\n\nWhen loading source files, the interpreter always executes every statement in order until there are no more statements to execute.This execution model applies both to files you simply run as the main program and to library files that are loaded via import.\n\nConditional Execution The if, else, and elif statements control conditional code execution.The general format of a conditional statement is as follows:\n\nif expression: statements\n\nelif expression:\n\nstatements\n\nelif expression:\n\nstatements\n\n... else:\n\nstatements\n\nF h Lib f L Bdff",
      "content_length": 1298,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 107,
      "content": "82\n\nChapter 5 Program Structure and Control Flow\n\nIf no action is to be taken, you can omit both the else and elif clauses of a condi- tional. Use the pass statement if no statements exist for a particular clause:\n\nif expression:\n\npass # Do nothing\n\nelse:\n\nstatements\n\nLoops and Iteration You implement loops using the for and while statements. Here’s an example:\n\nwhile expression: statements\n\nfor i in s:\n\nstatements\n\nThe while statement executes statements until the associated expression evaluates to false.The for statement iterates over all the elements of s until no more elements are available.The for statement works with any object that supports iteration.This obvi- ously includes the built-in sequence types such as lists, tuples, and strings, but also any object that implements the iterator protocol.\n\nAn object, s, supports iteration if it can be used with the following code, which mir-\n\nrors the implementation of the for statement:\n\nit = s.__iter__() # Get an iterator for s while 1:\n\ntry:\n\ni = it.next() # Get next item (Use _ _next_ _ in Python 3)\n\nexcept StopIteration: # No more items\n\nbreak # Perform operations on i\n\n...\n\nIn the statement for i in s, the variable iis known as the iteration variable. On each iteration of the loop, it receives a new value from s.The scope of the iteration variable is not private to the for statement. If a previously defined variable has the same name, that value will be overwritten. Moreover, the iteration variable retains the last value after the loop has completed.\n\nIf the elements used in iteration are sequences of identical size, you can unpack their\n\nvalues into individual iteration variables using a statement such as the following:\n\nfor x,y,z in s: statements\n\nIn this example, smust contain or produce sequences, each with three elements. On each iteration, the contents of the variables x, y, and zare assigned the items of the cor- responding sequence.Although it is most common to see this used when sis a sequence of tuples, unpacking works if the items in sare any kind of sequence includ- ing lists, generators, and strings.\n\nWhen looping, it is sometimes useful to keep track of a numerical index in addition\n\nto the data values. Here’s an example:\n\ni = 0 for x in s:\n\nF h Lib f L Bdff",
      "content_length": 2265,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 108,
      "content": "Loops and Iteration\n\n83\n\nstatements i += 1\n\nPython provides a built-in function, enumerate(), that can be used to simplify this code:\n\nfor i,x in enumerate(s): statements\n\nenumerate(s) creates an iterator that simply returns a sequence of tuples (0, s[0]), (1, s[1]), (2, s[2]), and so on.\n\nAnother common looping problem concerns iterating in parallel over two or more\n\nsequences—for example, writing a loop where you want to take items from different sequences on each iteration as follows:\n\n# s and t are two sequences i = 0 while i < len(s) and i < len(t):\n\nx = s[i] # Take an item from s y = t[i] # Take an item from t statements i += 1\n\nThis code can be simplified using the zip() function. For example:\n\n# s and t are two sequences for x,y in zip(s,t): statements\n\nzip(s,t) combines sequences sand tinto a sequence of tuples (s[0],t[0]), (s[1],t[1]), (s[2], t[2]), and so forth, stopping with the shortest of the sequences sand tshould they be of unequal length. One caution with zip() is that in Python 2, it fully consumes both sand t, creating a list of tuples. For generators and sequences containing a large amount of data, this may not be what you want.The function itertools.izip() achieves the same effect as zip() but generates the zipped values one at a time rather than creating a large list of tuples. In Python 3, the zip() function also generates values in this manner.\n\nTo break out of a loop, use the break statement. For example, this code reads lines\n\nof text from a file until an empty line of text is encountered:\n\nfor line in open(\"foo.txt\"):\n\nstripped = line.strip() if not stripped:\n\nbreak # A blank line, stop reading\n\n# process the stripped line ...\n\nTo jump to the next iteration of a loop (skipping the remainder of the loop body), use the continue statement.This statement tends to be used less often but is sometimes useful when the process of reversing a test and indenting another level would make the program too deeply nested or unnecessarily complicated.As an example, the following loop skips all of the blank lines in a file:\n\nfor line in open(\"foo.txt\"):\n\nstripped = line.strip() if not stripped:\n\ncontinue # Skip the blank line\n\n# process the stripped line ...\n\nF h Lib f L Bdff",
      "content_length": 2223,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 109,
      "content": "84\n\nChapter 5 Program Structure and Control Flow\n\nThe break and continue statements apply only to the innermost loop being executed. If it’s necessary to break out of a deeply nested loop structure, you can use an excep- tion. Python doesn’t provide a “goto” statement.\n\nYou can also attach the else statement to loop constructs, as in the following\n\nexample:\n\n# for-else for line in open(\"foo.txt\"): stripped = line.strip() if not stripped:\n\nbreak\n\n# process the stripped line ...\n\nelse:\n\nraise RuntimeError(\"Missing section separator\")\n\nThe else clause of a loop executes only if the loop runs to completion.This either occurs immediately (if the loop wouldn’t execute at all) or after the last iteration. On the other hand, if the loop is terminated early using the break statement, the else clause is skipped.\n\nThe primary use case for the looping else clause is in code that iterates over data but which needs to set or check some kind of flag or condition if the loop breaks pre- maturely. For example, if you didn’t use else, the previous code might have to be rewritten with a flag variable as follows:\n\nfound_separator = False for line in open(\"foo.txt\"): stripped = line.strip() if not stripped:\n\nfound_separator = True break\n\n# process the stripped line ...\n\nif not found_separator:\n\nraise RuntimeError(\"Missing section separator\")\n\nExceptions Exceptions indicate errors and break out of the normal control flow of a program.An exception is raised using the raise statement.The general format of the raise state- ment is raise Exception([value]), where Exceptionis the exception type and valueis an optional value giving specific details about the exception. Here’s an example:\n\nraise RuntimeError(\"Unrecoverable Error\")\n\nIf the raise statement is used by itself, the last exception generated is raised again (although this works only while handling a previously raised exception).\n\nTo catch an exception, use the try and except statements, as shown here:\n\ntry:\n\nf = open('foo')\n\nexcept IOError as e: statements\n\nF h Lib f L Bdff",
      "content_length": 2040,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 110,
      "content": "Exceptions\n\n85\n\nWhen an exception occurs, the interpreter stops executing statements in the try block and looks for an except clause that matches the exception that has occurred. If one is found, control is passed to the first statement in the except clause.After the except clause is executed, control continues with the first statement that appears after the try-except block. Otherwise, the exception is propagated up to the block of code in which the try statement appeared.This code may itself be enclosed in a try-except that can handle the exception. If an exception works its way up to the top level of a program without being caught, the interpreter aborts with an error message. If desired, uncaught exceptions can also be passed to a user-defined function, sys.excepthook(), as described in Chapter 13,“Python Runtime Services.”\n\nThe optional as varmodifier to the except statement supplies the name of a vari-\n\nable in which an instance of the exception type supplied to the raise statement is placed if an exception occurs. Exception handlers can examine this value to find out more about the cause of the exception. For example, you can use isinstance() to check the exception type. One caution on the syntax: In previous versions of Python, the except statement was written as except ExcType, varwhere the exception type and variable were separated by a comma (,). In Python 2.6, this syntax still works, but it is deprecated. In new code, use the as varsyntax because it is required in Python 3.\n\nMultiple exception-handling blocks are specified using multiple except clauses, as in\n\nthe following example:\n\ntry:\n\ndo something\n\nexcept IOError as e:\n\n# Handle I/O error ...\n\nexcept TypeError as e: # Handle Type error ...\n\nexcept NameError as e: # Handle Name error ...\n\nA single handler can catch multiple exception types like this:\n\ntry:\n\ndo something\n\nexcept (IOError, TypeError, NameError) as e:\n\n# Handle I/O, Type, or Name errors ...\n\nTo ignore an exception, use the pass statement as follows:\n\ntry:\n\ndo something except IOError:\n\npass # Do nothing (oh well).\n\nTo catch all exceptions except those related to program exit, use Exception like this:\n\ntry:\n\ndo something\n\nexcept Exception as e:\n\nerror_log.write('An error occurred : %s\\n' % e)\n\nF h Lib f L Bdff",
      "content_length": 2279,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 111,
      "content": "86\n\nChapter 5 Program Structure and Control Flow\n\nWhen catching all exceptions, you should take care to report accurate error information to the user. For example, in the previous code, an error message and the associated exception value is being logged. If you don’t include any information about the excep- tion value, it can make it very difficult to debug code that is failing for reasons that you don’t expect.\n\nAll exceptions can be caught using except with no exception type as follows:\n\ntry:\n\ndo something\n\nexcept:\n\nerror_log.write('An error occurred\\n')\n\nCorrect use of this form of except is a lot trickier than it looks and should probably be avoided. For instance, this code would also catch keyboard interrupts and requests for program exit—things that you may not want to catch.\n\nThe try statement also supports an else clause, which must follow the last except\n\nclause.This code is executed if the code in the try block doesn’t raise an exception. Here’s an example:\n\ntry:\n\nf = open('foo', 'r')\n\nexcept IOError as e:\n\nerror_log.write('Unable to open foo : %s\\n' % e)\n\nelse:\n\ndata = f.read() f.close()\n\nThe finally statement defines a cleanup action for code contained in a try block. Here’s an example:\n\nf = open('foo','r') try:\n\n# Do some stuff ... finally:\n\nf.close() # File closed regardless of what happened\n\nThe finally clause isn’t used to catch errors. Rather, it’s used to provide code that must always be executed, regardless of whether an error occurs. If no exception is raised, the code in the finally clause is executed immediately after the code in the try block. If an exception occurs, control is first passed to the first statement of the finally clause.After this code has executed, the exception is re-raised to be caught by another exception handler.\n\nBuilt-in Exceptions Python defines the built-in exceptions listed in Table 5.1.\n\nF h Lib f L Bdff",
      "content_length": 1884,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 112,
      "content": "Exceptions\n\n87\n\nTable 5.1\n\nBuilt-in Exceptions\n\nException\n\nDescription\n\nBaseException\n\nGeneratorExit\n\nKeyboardInterrupt\n\nSystemExit\n\nException\n\nStopIteration\n\nStandardError\n\nArithmeticError\n\nFloatingPointError\n\nZeroDivisionError\n\nAssertionError\n\nAttributeError\n\nEnvironmentError\n\nIOError\n\nOSError\n\nEOFError\n\nImportError\n\nLookupError\n\nIndexError\n\nKeyError\n\nMemoryError\n\nNameError\n\nUnboundLocalError\n\nReferenceError\n\nRuntimeError\n\nNotImplementedError\n\nSyntaxError\n\nIndentationError\n\nTabError\n\nSystemError\n\nTypeError\n\nThe root of all exceptions. Raised by .close() method on a generator. Generated by the interrupt key (usually Ctrl+C). Program exit/termination. Base class for all non-exiting exceptions. Raised to stop iteration. Base for all built-in exceptions (Python 2 only). In Python 3, all exceptions below are grouped under Exception. Base for arithmetic exceptions. Failure of a floating-point operation. Division or modulus operation with 0. Raised by the assert statement. Raised when an attribute name is invalid. Errors that occur externally to Python. I/O or file-related error. Operating system error. Raised when the end of the file is reached. Failure of the import statement. Indexing and key errors. Out-of-range sequence index. Nonexistent dictionary key. Out of memory. Failure to find a local or global name. Unbound local variable. Weak reference used after referent destroyed. A generic catchall error. Unimplemented feature. Parsing error. Indentation error. Inconsistent tab usage (generated with -tt option). Nonfatal system error in the interpreter. Passing an inappropriate type to an operation. Invalid type. Unicode error. Unicode decoding error. Unicode encoding error.\n\nValueError\n\nUnicodeError\n\nUnicodeDecodeError\n\nUnicodeEncodeError UnicodeTranslateError Unicode translation error.\n\nF h Lib f L Bdff",
      "content_length": 1833,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 113,
      "content": "88\n\nChapter 5 Program Structure and Control Flow\n\nExceptions are organized into a hierarchy as shown in the table.All the exceptions in a particular group can be caught by specifying the group name in an except clause. Here’s an example:\n\ntry:\n\nstatements\n\nexcept LookupError: # Catch IndexError or KeyError\n\nstatements\n\nor\n\ntry:\n\nstatements\n\nexcept Exception: # Catch any program-related exception\n\nstatements\n\nAt the top of the exception hierarchy, the exceptions are grouped according to whether or not the exceptions are related to program exit. For example, the SystemExit and KeyboardInterrupt exceptions are not grouped under Exception because programs that want to catch all program-related errors usually don’t want to also capture program termination by accident.\n\nDefining New Exceptions All the built-in exceptions are defined in terms of classes.To create a new exception, create a new class definition that inherits from Exception, such as the following:\n\nclass NetworkError(Exception): pass\n\nTo use your new exception, use it with the raise statement as follows:\n\nraise NetworkError(\"Cannot find host.\")\n\nWhen raising an exception, the optional values supplied with the raise statement are used as the arguments to the exception’s class constructor. Most of the time, this is sim- ply a string indicating some kind of error message. However, user-defined exceptions can be written to take one or more exception values as shown in this example:\n\nclass DeviceError(Exception):\n\ndef __init__(self,errno,msg): self.args = (errno, msg) self.errno = errno self.errmsg = msg\n\n# Raises an exception (multiple arguments) raise DeviceError(1, 'Not Responding')\n\nWhen you create a custom exception class that redefines __init__(), it is important to assign a tuple containing the arguments to __init__() to the attribute self.args as shown.This attribute is used when printing exception traceback messages. If you leave it undefined, users won’t be able to see any useful information about the exception when an error occurs.\n\nExceptions can be organized into a hierarchy using inheritance. For instance, the NetworkError exception defined earlier could serve as a base class for a variety of more specific errors. Here’s an example:\n\nclass HostnameError(NetworkError): pass class TimeoutError(NetworkError): pass\n\nF h Lib f L Bdff",
      "content_length": 2335,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 114,
      "content": "Context Managers and the with Statement\n\n89\n\ndef error1():\n\nraise HostnameError(\"Unknown host\")\n\ndef error2():\n\nraise TimeoutError(\"Timed out\")\n\ntry:\n\nerror1()\n\nexcept NetworkError as e:\n\nif type(e) is HostnameError:\n\n# Perform special actions for this kind of error ...\n\nIn this case, the except NetworkError statement catches any exception derived from NetworkError.To find the specific type of error that was raised, examine the type of the execution value with type().Alternatively, the sys.exc_info() function can be used to retrieve information about the last raised exception.\n\nContext Managers and the with Statement Proper management of system resources such as files, locks, and connections is often a tricky problem when combined with exceptions. For example, a raised exception can cause control flow to bypass statements responsible for releasing critical resources such as a lock.\n\nThe with statement allows a series of statements to execute inside a runtime context\n\nthat is controlled by an object that serves as a context manager. Here is an example:\n\nwith open(\"debuglog\",\"a\") as f: f.write(\"Debugging\\n\") statements f.write(\"Done\\n\")\n\nimport threading lock = threading.Lock() with lock:\n\n# Critical section statements # End critical section\n\nIn the first example, the with statement automatically causes the opened file to be closed when control-flow leaves the block of statements that follows. In the second example, the with statement automatically acquires and releases a lock when control enters and leaves the block of statements that follows.\n\nThe with objstatement allows the object objto manage what happens when control-flow enters and exits the associated block of statements that follows.When the with objstatement executes, it executes the method obj.__enter__() to signal that a new context is being entered.When control flow leaves the context, the method obj.__exit__(type,value,traceback) executes. If no exception has been raised, the three arguments to __exit__() are all set to None. Otherwise, they contain the type, value, and traceback associated with the exception that has caused control-flow to leave the context.The __exit__() method returns True or False to indicate whether the raised exception was handled or not (if False is returned, any exceptions raised are propagated out of the context).\n\nF h Lib f L Bdff",
      "content_length": 2360,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 115,
      "content": "90\n\nChapter 5 Program Structure and Control Flow\n\nThe with objstatement accepts an optional as varspecifier. If given, the value returned by obj.__enter__() is placed into var. It is important to emphasize that objis not necessarily the value assigned to var.\n\nThe with statement only works with objects that support the context management protocol (the __enter__() and __exit__() methods). User-defined classes can imple- ment these methods to define their own customized context-management. Here is a simple example:\n\nclass ListTransaction(object):\n\ndef __init__(self,thelist): self.thelist = thelist\n\ndef __enter__(self):\n\nself.workingcopy = list(self.thelist) return self.workingcopy\n\ndef __exit__(self,type,value,tb):\n\nif type is None:\n\nself.thelist[:] = self.workingcopy\n\nreturn False\n\nThis class allows one to make a sequence of modifications to an existing list. However, the modifications only take effect if no exceptions occur. Otherwise, the original list is left unmodified. For example:\n\nitems = [1,2,3] with ListTransaction(items) as working:\n\nworking.append(4) working.append(5)\n\nprint(items) # Produces [1,2,3,4,5]\n\ntry:\n\nwith ListTransaction(items) as working:\n\nworking.append(6) working.append(7) raise RuntimeError(\"We're hosed!\")\n\nexcept RuntimeError:\n\npass\n\nprint(items) # Produces [1,2,3,4,5]\n\nThe contextlib module allows custom context managers to be more easily imple- mented by placing a wrapper around a generator function. Here is an example:\n\nfrom contextlib import contextmanager @contextmanager def ListTransaction(thelist):\n\nworkingcopy = list(thelist) yield workingcopy # Modify the original list only if no errors thelist[:] = workingcopy\n\nIn this example, the value passed to yield is used as the return value from __enter__().When the __exit__() method gets invoked, execution resumes after the yield. If an exception gets raised in the context, it shows up as an exception in the generator function. If desired, an exception could be caught, but in this case, exceptions will simply propagate out of the generator to be handled elsewhere.\n\nF h Lib f L Bdff",
      "content_length": 2094,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 116,
      "content": "Assertions and __debug__\n\n91\n\nAssertions and __debug__ The assert statement can introduce debugging code into a program.The general form of assert is\n\nassert test [, msg]\n\nwhere testis an expression that should evaluate to True or False. If testevaluates to False, assert raises an AssertionError exception with the optional message msg supplied to the assert statement. Here’s an example:\n\ndef write_data(file,data):\n\nassert file, \"write_data: file not defined!\" ...\n\nThe assert statement should not be used for code that must be executed to make the program correct because it won’t be executed if Python is run in optimized mode (specified with the -O option to the interpreter). In particular, it’s an error to use assert to check user input. Instead, assert statements are used to check things that should always be true; if one is violated, it represents a bug in the program, not an error by the user.\n\nFor example, if the function write_data(), shown previously, were intended for use\n\nby an end user, the assert statement should be replaced by a conventional if state- ment and the desired error-handling.\n\nIn addition to assert, Python provides the built-in read-only variable __debug__,\n\nwhich is set to True unless the interpreter is running in optimized mode (specified with the -O option). Programs can examine this variable as needed—possibly running extra error-checking procedures if set.The underlying implementation of the __debug__ variable is optimized in the interpreter so that the extra control-flow logic of the if statement itself is not actually included. If Python is running in its normal mode, the statements under the if __debug__ statement are just inlined into the pro- gram without the if statement itself. In optimized mode, the if __debug__ statement and all associated statements are completely removed from the program.\n\nThe use of assert and __debug__ allow for efficient dual-mode development of a\n\nprogram. For example, in debug mode, you can liberally instrument your code with assertions and debug checks to verify correct operation. In optimized mode, all of these extra checks get stripped, resulting in no extra performance penalty.\n\nF h Lib f L Bdff",
      "content_length": 2196,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 117,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 118,
      "content": "6\n\nFunctions and Functional Programming\n\nSubstantial programs are broken up into functions for better modularity and ease of\n\nmaintenance. Python makes it easy to define functions but also incorporates a surprising number of features from functional programming languages.This chapter describes functions, scoping rules, closures, decorators, generators, coroutines, and other functional programming features. In addition, list comprehensions and generator expressions are described—both of which are powerful tools for declarative-style programming and data processing.\n\nFunctions Functions are defined with the def statement:\n\ndef add(x,y):\n\nreturn x + y\n\nThe body of a function is simply a sequence of statements that execute when the func- tion is called.You invoke a function by writing the function name followed by a tuple of function arguments, such as a = add(3,4).The order and number of arguments must match those given in the function definition. If a mismatch exists, a TypeError exception is raised.\n\nYou can attach default arguments to function parameters by assigning values in the\n\nfunction definition. For example:\n\ndef split(line,delimiter=','):\n\nstatements\n\nWhen a function defines a parameter with a default value, that parameter and all the parameters that follow are optional. If values are not assigned to all the optional parame- ters in the function definition, a SyntaxError exception is raised.\n\nDefault parameter values are always set to the objects that were supplied as values\n\nwhen the function was defined. Here’s an example:\n\na = 10 def foo(x=a):\n\nreturn x\n\na = 5 # Reassign 'a'. foo() # returns 10 (default value not changed)\n\nF h Lib f L Bdff",
      "content_length": 1678,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 119,
      "content": "94\n\nChapter 6 Functions and Functional Programming\n\nIn addition, the use of mutable objects as default values may lead to unintended behavior:\n\ndef foo(x, items=[]):\n\nitems.append(x) return items\n\nfoo(1) # returns [1] foo(2) # returns [1, 2] foo(3) # returns [1, 2, 3]\n\nNotice how the default argument retains modifications made from previous invocations. To prevent this, it is better to use None and add a check as follows:\n\ndef foo(x, items=None):\n\nif items is None: items = []\n\nitems.append(x) return items\n\nA function can accept a variable number of parameters if an asterisk (*) is added to the last parameter name:\n\ndef fprintf(file, fmt, *args): file.write(fmt % args)\n\n# Use fprintf. args gets (42,\"hello world\", 3.45) fprintf(out,\"%d %s %f\", 42, \"hello world\", 3.45)\n\nIn this case, all the remaining arguments are placed into the argsvariable as a tuple.To pass a tuple argsto a function as if they were parameters, the *args syntax can be used in a function call as follows:\n\ndef printf(fmt, *args):\n\n# Call another function and pass along args fprintf(sys.stdout, fmt, *args)\n\nFunction arguments can also be supplied by explicitly naming each parameter and spec- ifying a value.These are known as keyword arguments. Here is an example:\n\ndef foo(w,x,y,z): statements\n\n# Keyword argument invocation foo(x=3, y=22, w='hello', z=[1,2])\n\nWith keyword arguments, the order of the parameters doesn’t matter. However, unless there are default values, you must explicitly name all of the required function parame- ters. If you omit any of the required parameters or if the name of a keyword doesn’t match any of the parameter names in the function definition, a TypeError exception is raised.Also, since any Python function can be called using the keyword calling style, it is generally a good idea to define functions with descriptive argument names.\n\nPositional arguments and keyword arguments can appear in the same function call, provided that all the positional arguments appear first, values are provided for all non- optional arguments, and no argument value is defined more than once. Here’s an example:\n\nfoo('hello', 3, z=[1,2], y=22) foo(3, 22, w='hello', z=[1,2]) # TypeError. Multiple values for w\n\nF h Lib f L Bdff",
      "content_length": 2230,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 120,
      "content": "Parameter Passing and Return Values\n\n95\n\nIf the last argument of a function definition begins with **, all the additional keyword arguments (those that don’t match any of the other parameter names) are placed in a dictionary and passed to the function.This can be a useful way to write functions that accept a large number of potentially open-ended configuration options that would be too unwieldy to list as parameters. Here’s an example:\n\ndef make_table(data, **parms):\n\n# Get configuration parameters from parms (a dict) fgcolor = parms.pop(\"fgcolor\",\"black\") bgcolor = parms.pop(\"bgcolor\",\"white\") width = parms.pop(\"width\",None) ... # No more options if parms:\n\nraise TypeError(\"Unsupported configuration options %s\" % list(parms))\n\nmake_table(items, fgcolor=\"black\", bgcolor=\"white\", border=1,\n\nborderstyle=\"grooved\", cellpadding=10, width=400)\n\nYou can combine extra keyword arguments with variable-length argument lists, as long as the ** parameter appears last:\n\n# Accept variable number of positional or keyword arguments def spam(*args, **kwargs):\n\n# args is a tuple of positional args # kwargs is dictionary of keyword args ...\n\nKeyword arguments can also be passed to another function using the **kwargs syntax:\n\ndef callfunc(*args, **kwargs):\n\nfunc(*args,**kwargs)\n\nThis use of *args and **kwargs is commonly used to write wrappers and proxies for other functions. For example, the callfunc() accepts any combination of arguments and simply passes them through to func().\n\nParameter Passing and Return Values When a function is invoked, the function parameters are simply names that refer to the passed input objects.The underlying semantics of parameter passing doesn’t neatly fit into any single style, such as “pass by value” or “pass by reference,” that you might know about from other programming languages. For example, if you pass an immutable value, the argument effectively looks like it was passed by value. However, if a mutable object (such as a list or dictionary) is passed to a function where it’s then modified, those changes will be reflected in the original object. Here’s an example:\n\na = [1, 2, 3, 4, 5] def square(items):\n\nfor i,x in enumerate(items):\n\nitems[i] = x * x # Modify items in-place\n\nsquare(a) # Changes a to [1, 4, 9, 16, 25]\n\nFunctions that mutate their input values or change the state of other parts of the pro- gram behind the scenes like this are said to have side effects.As a general rule, this is a\n\nF h Lib f L Bdff",
      "content_length": 2471,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 121,
      "content": "96\n\nChapter 6 Functions and Functional Programming\n\nprogramming style that is best avoided because such functions can become a source of subtle programming errors as programs grow in size and complexity (for example, it’s not obvious from reading a function call if a function has side effects). Such functions interact poorly with programs involving threads and concurrency because side effects typically need to be protected by locks.\n\nThe return statement returns a value from a function. If no value is specified or you omit the return statement, the None object is returned.To return multiple values, place them in a tuple:\n\ndef factor(a): d = 2 while (d <= (a / 2)):\n\nif ((a / d) * d == a):\n\nreturn ((a / d), d)\n\nd = d + 1 return (a, 1)\n\nMultiple return values returned in a tuple can be assigned to individual variables:\n\nx, y = factor(1243) # Return values placed in x and y.\n\nor\n\n(x, y) = factor(1243) # Alternate version. Same behavior.\n\nScoping Rules Each time a function executes, a new local namespace is created.This namespace repre- sents a local environment that contains the names of the function parameters, as well as the names of variables that are assigned inside the function body.When resolving names, the interpreter first searches the local namespace. If no match exists, it searches the glob- al namespace.The global namespace for a function is always the module in which the function was defined. If the interpreter finds no match in the global namespace, it makes a final check in the built-in namespace. If this fails, a NameError exception is raised.\n\nOne peculiarity of namespaces is the manipulation of global variables within a func-\n\ntion. For example, consider the following code:\n\na = 42 def foo(): a = 13\n\nfoo() # a is still 42\n\nWhen this code executes, a returns its value of 42, despite the appearance that we might be modifying the variable a inside the function foo.When variables are assigned inside a function, they’re always bound to the function’s local namespace; as a result, the variable a in the function body refers to an entirely new object containing the value 13, not the outer variable.To alter this behavior, use the global statement. global sim- ply declares names as belonging to the global namespace, and it’s necessary only when global variables will be modified. It can be placed anywhere in a function body and used repeatedly. Here’s an example:\n\nF h Lib f L Bdff",
      "content_length": 2425,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 122,
      "content": "Scoping Rules\n\n97\n\na = 42 b = 37 def foo():\n\nglobal a # 'a' is in global namespace a = 13 b = 0\n\nfoo() # a is now 13. b is still 37.\n\nPython supports nested function definitions. Here’s an example:\n\ndef countdown(start):\n\nn = start def display(): # Nested function definition\n\nprint('T-minus %d' % n)\n\nwhile n > 0:\n\ndisplay() n -= 1\n\nVariables in nested functions are bound using lexical scoping.That is, names are resolved by first checking the local scope and then all enclosing scopes of outer function defini- tions from the innermost scope to the outermost scope. If no match is found, the global and built-in namespaces are checked as before.Although names in enclosing scopes are accessible, Python 2 only allows variables to be reassigned in the innermost scope (local variables) and the global namespace (using global).Therefore, an inner function can’t reassign the value of a local variable defined in an outer function. For example, this code does not work:\n\ndef countdown(start):\n\nn = start def display():\n\nprint('T-minus %d' % n)\n\ndef decrement():\n\nn -= 1 # Fails in Python 2\n\nwhile n > 0:\n\ndisplay() decrement()\n\nIn Python 2, you can work around this by placing values you want to change in a list or dictionary. In Python 3, you can declare n as nonlocal as follows:\n\ndef countdown(start):\n\nn = start def display():\n\nprint('T-minus %d' % n)\n\ndef decrement():\n\nnonlocal n # Bind to outer n (Python 3 only) n -= 1\n\nwhile n > 0:\n\ndisplay() decrement()\n\nThe nonlocal declaration does not bind a name to local variables defined inside arbi- trary functions further down on the current call-stack (that is, dynamic scope). So, if you’re coming to Python from Perl, nonlocal is not the same as declaring a Perl local variable.\n\nF h Lib f L Bdff",
      "content_length": 1753,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 123,
      "content": "98\n\nChapter 6 Functions and Functional Programming\n\nIf a local variable is used before it’s assigned a value, an UnboundLocalError excep-\n\ntion is raised. Here’s an example that illustrates one scenario of how this might occur:\n\ni = 0 def foo():\n\ni = i + 1 # Results in UnboundLocalError exception print(i)\n\nIn this function, the variable i is defined as a local variable (because it is being assigned inside the function and there is no global statement). However, the assignment i = i + 1 tries to read the value of i before its local value has been first assigned. Even though there is a global variable i in this example, it is not used to supply a value here. Variables are determined to be either local or global at the time of function definition and cannot suddenly change scope in the middle of a function. For example, in the pre- ceding code, it is not the case that the i in the expression i + 1 refers to the global variable i, whereas the i in print(i) refers to the local variable i created in the previ- ous statement.\n\nFunctions as Objects and Closures Functions are first-class objects in Python.This means that they can be passed as argu- ments to other functions, placed in data structures, and returned by a function as a result. Here is an example of a function that accepts another function as input and calls it:\n\n# foo.py def callf(func): return func()\n\nHere is an example of using the above function:\n\n>>> import foo >>> def helloworld(): ... ... >>> foo.callf(helloworld) 'Hello World' >>>\n\nreturn 'Hello World'\n\n# Pass a function as an argument\n\nWhen a function is handled as data, it implicitly carries information related to the sur- rounding environment where the function was defined.This affects how free variables in the function are bound.As an example, consider this modified version foo.py that now contains a variable definition:\n\n# foo.py x = 42 def callf(func): return func()\n\nNow, observe the behavior of this example:\n\n>>> import foo >>> x = 37 >>> def helloworld(): ... ... >>> foo.callf(helloworld) 'Hello World. x is 37' >>>\n\nreturn \"Hello World. x is %d\" % x\n\n# Pass a function as an argument\n\nF h Lib f L Bdff",
      "content_length": 2156,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 124,
      "content": "Functions as Objects and Closures\n\n99\n\nIn this example, notice how the function helloworld() uses the value of x that’s defined in the same environment as where helloworld() was defined.Thus, even though there is also an x defined in foo.py and that’s where helloworld() is actually being called, that value of x is not the one that’s used when helloworld() executes.\n\nWhen the statements that make up a function are packaged together with the envi- ronment in which they execute, the resulting object is known as a closure.The behavior of the previous example is explained by the fact that all functions have a __globals__ attribute that points to the global namespace in which the function was defined.This always corresponds to the enclosing module in which a function was defined. For the previous example, you get the following:\n\n>>> helloworld.__globals__ {'__builtins__': <module '__builtin__' (built-in)>,\n\n'helloworld': <function helloworld at 0x7bb30>, 'x': 37, '__name__': '__main__', '__doc__': None 'foo': <module 'foo' from 'foo.py'>}\n\n>>>\n\nWhen nested functions are used, closures capture the entire environment needed for the inner function to execute. Here is an example:\n\nimport foo def bar(): x = 13 def helloworld():\n\nreturn \"Hello World. x is %d\" % x\n\nfoo.callf(helloworld) # returns 'Hello World, x is 13'\n\nClosures and nested functions are especially useful if you want to write code based on the concept of lazy or delayed evaluation. Here is another example:\n\nfrom urllib import urlopen # from urllib.request import urlopen (Python 3) def page(url): def get():\n\nreturn urlopen(url).read()\n\nreturn get\n\nIn this example, the page() function doesn’t actually carry out any interesting compu- tation. Instead, it merely creates and returns a function get() that will fetch the con- tents of a web page when it is called.Thus, the computation carried out in get() is actually delayed until some later point in a program when get() is evaluated. For example:\n\n>>> python = page(\"http://www.python.org\") >>> jython = page(\"http://www.jython.org\") >>> python <function get at 0x95d5f0> >>> jython <function get at 0x9735f0> >>> pydata = python() >>> jydata = jython() >>>\n\n# Fetches http://www.python.org # Fetches http://www.jython.org\n\nIn this example, the two variables python and jython are actually two different ver- sions of the get() function. Even though the page() function that created these values is no longer executing, both get() functions implicitly carry the values of the outer variables that were defined when the get() function was created.Thus, when get()\n\nF h Lib f L Bdff",
      "content_length": 2611,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 125,
      "content": "100\n\nChapter 6 Functions and Functional Programming\n\nexecutes, it calls urlopen(url) with the value of url that was originally supplied to page().With a little inspection, you can view the contents of variables that are carried along in a closure. For example:\n\n>>> python.__closure__ (<cell at 0x67f50: str object at 0x69230>,) >>> python.__closure__[0].cell_contents 'http://www.python.org' >>> jython.__closure__[0].cell_contents 'http://www.jython.org' >>>\n\nA closure can be a highly efficient way to preserve state across a series of function calls. For example, consider this code that runs a simple counter:\n\ndef countdown(n):\n\ndef next():\n\nnonlocal n r = n n -= 1 return r\n\nreturn next\n\n# Example use next = countdown(10) while True:\n\nv = next() # Get the next value if not v: break\n\nIn this code, a closure is being used to store the internal counter value n.The inner function next() updates and returns the previous value of this counter variable each time it is called. Programmers not familiar with closures might be inclined to imple- ment similar functionality using a class such as this:\n\nclass Countdown(object):\n\ndef __init__(self,n):\n\nself.n = n\n\ndef next(self):\n\nr = self.n self.n -= 1 return r\n\n# Example use c = Countdown(10) while True:\n\nv = c.next() # Get the next value if not v: break\n\nHowever, if you increase the starting value of the countdown and perform a simple timing benchmark, you will find that that the version using closures runs much faster (almost a 50% speedup when tested on the author’s machine).\n\nThe fact that closures capture the environment of inner functions also make them useful for applications where you want to wrap existing functions in order to add extra capabilities.This is described next.\n\nF h Lib f L Bdff",
      "content_length": 1764,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 126,
      "content": "Decorators\n\n101\n\nDecorators A decorator is a function whose primary purpose is to wrap another function or class. The primary purpose of this wrapping is to transparently alter or enhance the behavior of the object being wrapped. Syntactically, decorators are denoted using the special @ symbol as follows:\n\n@trace def square(x):\n\nreturn x*x\n\nThe preceding code is shorthand for the following:\n\ndef square(x): return x*x\n\nsquare = trace(square)\n\nIn the example, a function square() is defined. However, immediately after its defini- tion, the function object itself is passed to the function trace(), which returns an object that replaces the original square. Now, let’s consider an implementation of trace that will clarify how this might be useful:\n\nenable_tracing = True if enable_tracing:\n\ndebug_log = open(\"debug.log\",\"w\")\n\ndef trace(func):\n\nif enable_tracing:\n\ndef callf(*args,**kwargs):\n\ndebug_log.write(\"Calling %s: %s, %s\\n\" %\n\n(func.__name__, args, kwargs))\n\nr = func(*args,**kwargs) debug_log.write(\"%s returned %s\\n\" % (func.__name, r)) return r return callf\n\nelse:\n\nreturn func\n\nIn this code, trace() creates a wrapper function that writes some debugging output and then calls the original function object.Thus, if you call square(), you will see the output of the write() methods in the wrapper.The function callf that is returned from trace() is a closure that serves as a replacement for the original function.A final interesting aspect of the implementation is that the tracing feature itself is only enabled through the use of a global variable enable_tracing as shown. If set to False, the trace() decorator simply returns the original function unmodified.Thus, when tracing is disabled, there is no added performance penalty associated with using the decorator.\n\nWhen decorators are used, they must appear on their own line immediately prior to\n\na function or class definition. More than one decorator can also be applied. Here’s an example:\n\n@foo @bar @spam def grok(x):\n\npass\n\nF h Lib f L Bdff",
      "content_length": 2015,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 127,
      "content": "102\n\nChapter 6 Functions and Functional Programming\n\nIn this case, the decorators are applied in the order listed.The result is the same as this:\n\ndef grok(x): pass\n\ngrok = foo(bar(spam(grok)))\n\nA decorator can also accept arguments. Here’s an example:\n\n@eventhandler('BUTTON') def handle_button(msg):\n\n...\n\n@eventhandler('RESET') def handle_reset(msg):\n\n...\n\nIf arguments are supplied, the semantics of the decorator are as follows:\n\ndef handle_button(msg):\n\n...\n\ntemp = eventhandler('BUTTON') # Call decorator with supplied arguments handle_button = temp(handle_button) # Call the function returned by the decorator\n\nIn this case, the decorator function only accepts the arguments supplied with the @ specifier. It then returns a function that is called with the function as an argument. Here’s an example:\n\n# Event handler decorator event_handlers = { } def eventhandler(event):\n\ndef register_function(f):\n\nevent_handlers[event] = f return f\n\nreturn register_function\n\nDecorators can also be applied to class definitions. For example:\n\n@foo class Bar(object):\n\ndef __init__(self,x):\n\nself.x = x\n\ndef spam(self):\n\nstatements\n\nFor class decorators, you should always have the decorator function return a class object as a result. Code that expects to work with the original class definition may want to ref- erence members of the class directly such as Bar.spam.This won’t work correctly if the decorator function foo() returns a function.\n\nDecorators can interact strangely with other aspects of functions such as recursion, documentation strings, and function attributes.These issues are described later in this chapter.\n\nGenerators and yield If a function uses the yield keyword, it defines an object known as a generator.A gener- ator is a function that produces a sequence of values for use in iteration. Here’s an example:\n\nF h Lib f L Bdff",
      "content_length": 1847,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 128,
      "content": "Generators and yield\n\n103\n\ndef countdown(n):\n\nprint(\"Counting down from %d\" % n) while n > 0: yield n n -= 1\n\nreturn\n\nIf you call this function, you will find that none of its code starts executing. For example:\n\n>>> c = countdown(10) >>>\n\nInstead, a generator object is returned.The generator object, in turn, executes the func- tion whenever next() is called (or __next__() in Python 3). Here’s an example:\n\n>>> c.next() Counting down from 10 10 >>> c.next() 9\n\n# Use c.__next__() in Python 3\n\nWhen next() is invoked, the generator function executes statements until it reaches a yield statement.The yield statement produces a result at which point execution of the function stops until next() is invoked again. Execution then resumes with the statement following yield.\n\nYou normally don’t call next() directly on a generator but use it with the for statement, sum(), or some other operation that consumes a sequence. For example:\n\nfor n in countdown(10):\n\nstatements a = sum(countdown(10))\n\nA generator function signals completion by returning or raising StopIteration, at which point iteration stops. It is never legal for a generator to return a value other than None upon completion.\n\nA subtle problem with generators concerns the case where a generator function is\n\nonly partially consumed. For example, consider this code:\n\nfor n in countdown(10):\n\nif n == 2: break statements\n\nIn this example, the for loop aborts by calling break, and the associated generator never runs to full completion.To handle this case, generator objects have a method close() that is used to signal a shutdown.When a generator is no longer used or deleted, close() is called. Normally it is not necessary to call close(), but you can also call it manually as shown here:\n\n>>> c = countdown(10) >>> c.next() Counting down from 10 10 >>> c.next() 9 >>> c.close() >>> c.next() Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nStopIteration >>>\n\nF h Lib f L Bdff",
      "content_length": 1968,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 129,
      "content": "104\n\nChapter 6 Functions and Functional Programming\n\nInside the generator function, close() is signaled by a GeneratorExit exception occurring on the yield statement.You can optionally catch this exception to perform cleanup actions.\n\ndef countdown(n):\n\nprint(\"Counting down from %d\" % n) try:\n\nwhile n > 0: yield n n = n - 1\n\nexcept GeneratorExit:\n\nprint(\"Only made it to %d\" % n)\n\nAlthough it is possible to catch GeneratorExit, it is illegal for a generator function to handle the exception and produce another output value using yield. Moreover, if a program is currently iterating on generator, you should not call close() asynchronous- ly on that generator from a separate thread of execution or from a signal handler.\n\nCoroutines and yield Expressions Inside a function, the yield statement can also be used as an expression that appears on the right side of an assignment operator. For example:\n\ndef receiver():\n\nprint(\"Ready to receive\") while True:\n\nn = (yield) print(\"Got %s\" % n)\n\nA function that uses yield in this manner is known as a coroutine, and it executes in response to values being sent to it. Its behavior is also very similar to a generator. For example:\n\n>>> r = receiver() >>> r.next() # Advance to first yield (r.__next__() in Python 3) Ready to receive >>> r.send(1) Got 1 >>> r.send(2) Got 2 >>> r.send(\"Hello\") Got Hello >>>\n\nIn this example, the initial call to next() is necessary so that the coroutine executes statements leading to the first yield expression.At this point, the coroutine suspends, waiting for a value to be sent to it using the send() method of the associated generator object r.The value passed to send() is returned by the (yield) expression in the coroutine. Upon receiving a value, a coroutine executes statements until the next yield statement is encountered.\n\nThe requirement of first calling next() on a coroutine is easily overlooked and a common source of errors.Therefore, it is recommended that coroutines be wrapped with a decorator that automatically takes care of this step.\n\nF h Lib f L Bdff",
      "content_length": 2057,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 130,
      "content": "Coroutines and yield Expressions\n\n105\n\ndef coroutine(func):\n\ndef start(*args,**kwargs):\n\ng = func(*args,**kwargs) g.next() return g return start\n\nUsing this decorator, you would write and use coroutines using:\n\n@coroutine def receiver():\n\nprint(\"Ready to receive\") while True:\n\nn = (yield) print(\"Got %s\" % n)\n\n# Example use r = receiver() r.send(\"Hello World\") # Note : No initial .next() needed\n\nA coroutine will typically run indefinitely unless it is explicitly shut down or it exits on its own.To close the stream of input values, use the close() method like this:\n\n>>> r.close() >>> r.send(4) Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nStopIteration\n\nOnce closed, a StopIteration exception will be raised if further values are sent to a coroutine.The close() operation raises GeneratorExit inside the coroutine as described in the previous section on generators. For example:\n\ndef receiver():\n\nprint(\"Ready to receive\") try:\n\nwhile True:\n\nn = (yield) print(\"Got %s\" % n)\n\nexcept GeneratorExit:\n\nprint(\"Receiver done\")\n\nExceptions can be raised inside a coroutine using the throw(exctype [, value [, tb]]) method where exctypeis an exception type, valueis the exception value, and tbis a traceback object. For example:\n\n>>> r.throw(RuntimeError,\"You're hosed!\") Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module> File \"<stdin>\", line 4, in receiver\n\nRuntimeError: You're hosed!\n\nExceptions raised in this manner will originate at the currently executing yield state- ment in the coroutine.A coroutine can elect to catch exceptions and handle them as appropriate. It is not safe to use throw() as an asynchronous signal to a coroutine—it should never be invoked from a separate execution thread or in a signal handler.\n\nA coroutine may simultaneously receive and emit return values using yield if values\n\nare supplied in the yield expression. Here is an example that illustrates this:\n\ndef line_splitter(delimiter=None):\n\nprint(\"Ready to split\") result = None while True:\n\nline = (yield result) result = line.split(delimiter)\n\nF h Lib f L Bdff",
      "content_length": 2098,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 131,
      "content": "106\n\nChapter 6 Functions and Functional Programming\n\nIn this case, we use the coroutine in the same way as before. However, now calls to send() also produce a result. For example:\n\n>>> s = line_splitter(\",\") >>> s.next() Ready to split >>> s.send(\"A,B,C\") ['A', 'B', 'C' ] >>> s.send(\"100,200,300\") ['100', '200', '300'] >>>\n\nUnderstanding the sequencing of this example is critical.The first next() call advances the coroutine to (yield result), which returns None, the initial value of result. On subsequent send() calls, the received value is placed in line and split into result.The value returned by send() is the value passed to the next yield statement encountered. In other words, the value returned by send() comes from the next yield expression, not the one responsible for receiving the value passed by send().\n\nIf a coroutine returns values, some care is required if exceptions raised with throw()\n\nare being handled. If you raise an exception in a coroutine using throw(), the value passed to the next yield in the coroutine will be returned as the result of throw(). If you need this value and forget to save it, it will be lost.\n\nUsing Generators and Coroutines At first glance, it might not be obvious how to use generators and coroutines for practi- cal problems. However, generators and coroutines can be particularly effective when applied to certain kinds of programming problems in systems, networking, and distrib- uted computation. For example, generator functions are useful if you want to set up a processing pipeline, similar in nature to using a pipe in the UNIX shell. One example of this appeared in the Introduction. Here is another example involving a set of generator functions related to finding, opening, reading, and processing files:\n\nimport os import fnmatch\n\ndef find_files(topdir, pattern):\n\nfor path, dirname, filelist in os.walk(topdir):\n\nfor name in filelist:\n\nif fnmatch.fnmatch(name, pattern):\n\nyield os.path.join(path,name)\n\nimport gzip, bz2 def opener(filenames):\n\nfor name in filenames:\n\nif name.endswith(\".gz\"): f = gzip.open(name) elif name.endswith(\".bz2\"): f = bz2.BZ2File(name) else: f = open(name) yield f\n\ndef cat(filelist):\n\nfor f in filelist: for line in f: yield line\n\ndef grep(pattern, lines): for line in lines:\n\nif pattern in line: yield line\n\nF h Lib f L Bdff",
      "content_length": 2320,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 132,
      "content": "Using Generators and Coroutines\n\n107\n\nHere is an example of using these functions to set up a processing pipeline:\n\nwwwlogs = find(\"www\",\"access-log*\") files = opener(wwwlogs) lines = cat(files) pylines = grep(\"python\", lines) for line in pylines:\n\nsys.stdout.write(line)\n\nIn this example, the program is processing all lines in all \"access-log*\" files found within all subdirectories of a top-level directory \"www\". Each \"access-log\" is tested for file compression and opened using an appropriate file opener. Lines are concatenat- ed together and processed through a filter that is looking for a substring \"python\".The entire program is being driven by the for statement at the end. Each iteration of this loop pulls a new value through the pipeline and consumes it. Moreover, the implemen- tation is highly memory-efficient because no temporary lists or other large data struc- tures are ever created.\n\nCoroutines can be used to write programs based on data-flow processing. Programs\n\norganized in this way look like inverted pipelines. Instead of pulling values through a sequence of generator functions using a for loop, you send values into a collection of linked coroutines. Here is an example of coroutine functions written to mimic the gen- erator functions shown previously:\n\nimport os import fnmatch\n\n@coroutine def find_files(target):\n\nwhile True:\n\ntopdir, pattern = (yield) for path, dirname, filelist in os.walk(topdir):\n\nfor name in filelist:\n\nif fnmatch.fnmatch(name,pattern):\n\ntarget.send(os.path.join(path,name))\n\nimport gzip, bz2 @coroutine def opener(target): while True:\n\nname = (yield) if name.endswith(\".gz\"): f = gzip.open(name) elif name.endswith(\".bz2\"): f = bz2.BZ2File(name) else: f = open(name) target.send(f)\n\n@coroutine def cat(target):\n\nwhile True:\n\nf = (yield) for line in f:\n\ntarget.send(line)\n\nF h Lib f L Bdff",
      "content_length": 1845,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 133,
      "content": "108\n\nChapter 6 Functions and Functional Programming\n\n@coroutine def grep(pattern, target):\n\nwhile True:\n\nline = (yield) if pattern in line:\n\ntarget.send(line)\n\n@coroutine def printer():\n\nwhile True:\n\nline = (yield) sys.stdout.write(line)\n\nHere is how you would link these coroutines to create a dataflow processing pipeline:\n\nfinder = find_files(opener(cat(grep(\"python\",printer()))))\n\n# Now, send a value finder.send((\"www\",\"access-log*\")) finder.send((\"otherwww\",\"access-log*\"))\n\nIn this example, each coroutine sends data to another coroutine specified in the target argument to each coroutine. Unlike the generator example, execution is entirely driven by pushing data into the first coroutine find_files().This coroutine, in turn, pushes data to the next stage.A critical aspect of this example is that the coroutine pipeline remains active indefinitely or until close() is explicitly called on it. Because of this, a program can continue to feed data into a coroutine for as long as necessary—for exam- ple, the two repeated calls to send() shown in the example.\n\nCoroutines can be used to implement a form of concurrency. For example, a central-\n\nized task manager or event loop can schedule and send data into a large collection of hundreds or even thousands of coroutines that carry out various processing tasks.The fact that input data is “sent” to a coroutine also means that coroutines can often be easi- ly mixed with programs that use message queues and message passing to communicate between program components. Further information on this can be found in Chapter 20,“Threads.”\n\nList Comprehensions A common operation involving functions is that of applying a function to all of the items of a list, creating a new list with the results. For example:\n\nnums = [1, 2, 3, 4, 5] squares = [] for n in nums:\n\nsquares.append(n * n)\n\nBecause this type of operation is so common, it is has been turned into an operator known as a list comprehension. Here is a simple example:\n\nnums = [1, 2, 3, 4, 5] squares = [n * n for n in nums]\n\nThe general syntax for a list comprehension is as follows:\n\n[expression for item1 in iterable1 if condition1 for item2 in iterable2 if condition2 ... for itemN in iterableN if conditionN ]\n\nF h Lib f L Bdff",
      "content_length": 2246,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 134,
      "content": "Generator Expressions\n\n109\n\nThis syntax is roughly equivalent to the following code:\n\ns = [] for item1 in iterable1: if condition1:\n\nfor item2 in iterable2:\n\nif condition2:\n\n... for itemN in iterableN:\n\nif conditionN: s.append(expression)\n\nTo illustrate, here are some more examples:\n\na = [-3,5,2,-10,7,8] b = 'abc'\n\nc = [2*s for s in a] # c = [-6,10,4,-20,14,16] d = [s for s in a if s >= 0] # d = [5,2,7,8] e = [(x,y) for x in a # e = [(5,'a'),(5,'b'),(5,'c'), for y in b # (2,'a'),(2,'b'),(2,'c'), if x > 0 ] # (7,'a'),(7,'b'),(7,'c'), # (8,'a'),(8,'b'),(8,'c')]\n\nf = [(1,2), (3,4), (5,6)] g = [math.sqrt(x*x+y*y) # f = [2.23606, 5.0, 7.81024]\n\nfor x,y in f]\n\nThe sequences supplied to a list comprehension don’t have to be the same length because they’re iterated over their contents using a nested set of for loops, as previously shown.The resulting list contains successive values of expressions.The if clause is optional; however, if it’s used, expressionis evaluated and added to the result only if conditionis true.\n\nIf a list comprehension is used to construct a list of tuples, the tuple values must be enclosed in parentheses. For example, [(x,y) for x in a for y in b] is legal syn- tax, whereas [x,y for x in a for y in b] is not.\n\nFinally, it is important to note that in Python 2, the iteration variables defined within\n\na list comprehension are evaluated within the current scope and remain defined after the list comprehension has executed. For example, in [x for x in a], the iteration variable x overwrites any previously defined value of x and is set to the value of the last item in a after the resulting list is created. Fortunately, this is not the case in Python 3 where the iteration variable remains private.\n\nGenerator Expressions A generator expression is an object that carries out the same computation as a list compre- hension, but which iteratively produces the result.The syntax is the same as for list comprehensions except that you use parentheses instead of square brackets. Here’s an example:\n\n(expression for item1 in iterable1 if condition1 for item2 in iterable2 if condition2 ... for itemN in iterableN if conditionN)\n\nF h Lib f L Bdff",
      "content_length": 2177,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 135,
      "content": "110\n\nChapter 6 Functions and Functional Programming\n\nUnlike a list comprehension, a generator expression does not actually create a list or immediately evaluate the expression inside the parentheses. Instead, it creates a generator object that produces the values on demand via iteration. Here’s an example:\n\n>>> a = [1, 2, 3, 4] >>> b = (10*i for i in a) >>> b <generator object at 0x590a8> >>> b.next() 10 >>> b.next() 20 ...\n\nThe difference between list and generator expressions is important, but subtle.With a list comprehension, Python actually creates a list that contains the resulting data.With a generator expression, Python creates a generator that merely knows how to produce data on demand. In certain applications, this can greatly improve performance and memory use. Here’s an example:\n\n# Read a file f = open(\"data.txt\") # Open a file lines = (t.strip() for t in f) # Read lines, strip\n\n# trailing/leading whitespace\n\ncomments = (t for t in lines if t[0] == '#') # All comments for c in comments: print(c)\n\nIn this example, the generator expression that extracts lines and strips whitespace does not actually read the entire file into memory.The same is true of the expression that extracts comments. Instead, the lines of the file are actually read when the program starts iterating in the for loop that follows. During this iteration, the lines of the file are produced upon demand and filtered accordingly. In fact, at no time will the entire file be loaded into memory during this process.Therefore, this would be a highly efficient way to extract comments from a gigabyte-sized Python source file.\n\nUnlike a list comprehension, a generator expression does not create an object that\n\nworks like a sequence. It can’t be indexed, and none of the usual list operations will work (for example, append()). However, a generator expression can be converted into a list using the built-in list() function:\n\nclist = list(comments)\n\nDeclarative Programming List comprehensions and generator expressions are strongly tied to operations found in declarative languages. In fact, the origin of these features is loosely derived from ideas in mathematical set theory. For example, when you write a statement such as [x*x for x in a if x > 0], it’s somewhat similar to specifying a set such as { x2 | x Œa, x > 0 }. Instead of writing programs that manually iterate over data, you can use these declar-\n\native features to structure programs as a series of computations that simply operate on all of the data all at once. For example, suppose you had a file “portfolio.txt” containing stock portfolio data like this:\n\nF h Lib f L Bdff",
      "content_length": 2637,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 136,
      "content": "Declarative Programming\n\n111\n\nAA 100 32.20 IBM 50 91.10 CAT 150 83.44 MSFT 200 51.23 GE 95 40.37 MSFT 50 65.10 IBM 100 70.44\n\nHere is a declarative-style program that calculates the total cost by summing up the sec- ond column multiplied by the third column:\n\nlines = open(\"portfolio.txt\") fields = (line.split() for line in lines) print(sum(float(f[1]) * float(f[2]) for f in fields))\n\nIn this program, we really aren’t concerned with the mechanics of looping line-by-line over the file. Instead, we just declare a sequence of calculations to perform on all of the data. Not only does this approach result in highly compact code, but it also tends to run faster than this more traditional version:\n\ntotal = 0 for line in open(\"portfolio.txt\"):\n\nfields = line.split() total += float(fields[1]) * float(fields[2])\n\nprint(total)\n\nThe declarative programming style is somewhat tied to the kinds of operations a pro- grammer might perform in a UNIX shell. For instance, the preceding example using generator expressions is similar to the following one-line awk command:\n\n% awk '{ total += $2 * $3} END { print total }' portfolio.txt 44671.2 %\n\nThe declarative style of list comprehensions and generator expressions can also be used to mimic the behavior of SQL select statements, commonly used when processing databases. For example, consider these examples that work on data that has been read in a list of dictionaries:\n\nfields = (line.split() for line in open(\"portfolio.txt\")) portfolio = [ {'name' : f[0],\n\n'shares' : int(f[1]), 'price' : float(f[2]) }\n\nfor f in fields]\n\n# Some queries msft = [s for s in portfolio if s['name'] == 'MSFT'] large_holdings = [s for s in portfolio\n\nif s['shares']*s['price'] >= 10000]\n\nIn fact, if you are using a module related to database access (see Chapter 17), you can often use list comprehensions and database queries together all at once. For example:\n\nsum(shares*cost for shares,cost in\n\ncursor.execute(\"select shares, cost from portfolio\")\n\nif shares*cost >= 10000)\n\nF h Lib f L Bdff",
      "content_length": 2025,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 137,
      "content": "112\n\nChapter 6 Functions and Functional Programming\n\nThe lambda Operator Anonymous functions in the form of an expression can be created using the lambda statement:\n\nlambda args : expression\n\nargsis a comma-separated list of arguments, and expressionis an expression involv- ing those arguments. Here’s an example:\n\na = lambda x,y : x+y r = a(2,3) # r gets 5\n\nThe code defined with lambda must be a valid expression. Multiple statements and other non-expression statements, such as for and while, cannot appear in a lambda statement. lambda expressions follow the same scoping rules as functions.\n\nThe primary use of lambda is in specifying short callback functions. For example, if\n\nyou wanted to sort a list of names with case-insensitivity, you might write this:\n\nnames.sort(key=lambda n: n.lower())\n\nRecursion Recursive functions are easily defined. For example:\n\ndef factorial(n):\n\nif n <= 1: return 1 else: return n * factorial(n - 1)\n\nHowever, be aware that there is a limit on the depth of recursive function calls.The function sys.getrecursionlimit() returns the current maximum recursion depth, and the function sys.setrecursionlimit() can be used to change the value.The default value is 1000.Although it is possible to increase the value, programs are still lim- ited by the stack size limits enforced by the host operating system.When the recursion depth is exceeded, a RuntimeError exception is raised. Python does not perform tail- recursion optimization that you often find in functional languages such as Scheme.\n\nRecursion does not work as you might expect in generator functions and corou-\n\ntines. For example, this code prints all items in a nested collection of lists:\n\ndef flatten(lists): for s in lists:\n\nif isinstance(s,list):\n\nflatten(s)\n\nelse:\n\nprint(s)\n\nitems = [[1,2,3],[4,5,[5,6]],[7,8,9]] flatten(items) # Prints 1 2 3 4 5 6 7 8 9\n\nHowever, if you change the print operation to a yield, it no longer works.This is because the recursive call to flatten() merely creates a new generator object without actually iterating over it. Here’s a recursive generator version that works:\n\nF h Lib f L Bdff",
      "content_length": 2124,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 138,
      "content": "Documentation Strings\n\n113\n\ndef genflatten(lists): for s in lists:\n\nif isinstance(s,list):\n\nfor item in genflatten(s):\n\nyield item\n\nelse:\n\nyield item\n\nCare should also be taken when mixing recursive functions and decorators. If a decora- tor is applied to a recursive function, all inner recursive calls now get routed through the decorated version. For example:\n\n@locked def factorial(n):\n\nif n <= 1: return 1 else: return n * factorial(n - 1) # Calls the wrapped version of factorial\n\nIf the purpose of the decorator was related to some kind of system management such as synchronization or locking, recursion is something probably best avoided.\n\nDocumentation Strings It is common practice for the first statement of function to be a documentation string describing its usage. For example:\n\ndef factorial(n):\n\n\"\"\"Computes n factorial. For example:\n\n>>> factorial(6) 120 >>>\n\n\"\"\" if n <= 1: return 1 else: return n*factorial(n-1)\n\nThe documentation string is stored in the __doc__ attribute of the function that is commonly used by IDEs to provide interactive help.\n\nIf you are using decorators, be aware that wrapping a function with a decorator can\n\nbreak the help features associated with documentation strings. For example, consider this code:\n\ndef wrap(func):\n\ncall(*args,**kwargs):\n\nreturn func(*args,**kwargs)\n\nreturn call\n\n@wrap def factorial(n):\n\n\"\"\"Computes n factorial.\"\"\" ...\n\nIf a user requests help on this version of factorial(), he will get a rather cryptic explanation:\n\n>>> help(factorial) Help on function call in module __main__:\n\ncall(*args, **kwargs) (END) >>>\n\nF h Lib f L Bdff",
      "content_length": 1601,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 139,
      "content": "114\n\nChapter 6 Functions and Functional Programming\n\nTo fix this, write decorator functions so that they propagate the function name and documentation string. For example:\n\ndef wrap(func):\n\ncall(*args,**kwargs):\n\nreturn func(*args,**kwargs)\n\ncall.__doc__ = func.__doc__ call.__name__ = func.__name__ return call\n\nBecause this is a common problem, the functools module provides a function wraps that can automatically copy these attributes. Not surprisingly, it is also a decorator:\n\nfrom functools import wraps def wrap(func):\n\n@wraps(func) call(*args,**kwargs):\n\nreturn func(*args,**kwargs)\n\nreturn call\n\nThe @wraps(func) decorator, defined in functools, propagates attributes from func to the wrapper function that is being defined.\n\nFunction Attributes Functions can have arbitrary attributes attached to them. Here’s an example:\n\ndef foo():\n\nstatements\n\nfoo.secure = 1 foo.private = 1\n\nFunction attributes are stored in a dictionary that is available as the __dict__ attribute of a function.\n\nThe primary use of function attributes is in highly specialized applications such as parser generators and application frameworks that would like to attach additional infor- mation to function objects.\n\nAs with documentation strings, care should be given if mixing function attributes with decorators. If a function is wrapped by a decorator, access to the attributes will actually take place on the decorator function, not the original implementation.This may or may not be what you want depending on the application.To propagate already defined function attributes to a decorator function, use the following template or the functools.wraps() decorator as shown in the previous section:\n\ndef wrap(func):\n\ncall(*args,**kwargs):\n\nreturn func(*args,**kwargs)\n\ncall.__doc__ = func.__doc__ call.__name__ = func.__name__ call.__dict__.update(func.__dict__) return call\n\nF h Lib f L Bdff",
      "content_length": 1878,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 140,
      "content": "eval(), exec(), and compile()\n\n115\n\neval(), exec(), and compile() The eval(str [,globals [,locals]]) function executes an expression string and returns the result. Here’s an example:\n\na = eval('3*math.sin(3.5+x) + 7.2')\n\nSimilarly, the exec(str [, globals [, locals]]) function executes a string con- taining arbitrary Python code.The code supplied to exec() is executed as if the code actually appeared in place of the exec operation. Here’s an example:\n\na = [3, 5, 10, 13] exec(\"for i in a: print(i)\")\n\nOne caution with exec is that in Python 2, exec is actually defined as a statement. Thus, in legacy code, you might see statements invoking exec without the surrounding parentheses, such as exec \"for i in a: print i\".Although this still works in Python 2.6, it breaks in Python 3. Modern programs should use exec() as a function.\n\nBoth of these functions execute within the namespace of the caller (which is used to resolve any symbols that appear within a string or file). Optionally, eval() and exec() can accept one or two mapping objects that serve as the global and local namespaces for the code to be executed, respectively. Here’s an example:\n\nglobals = {'x': 7,\n\n'y': 10, 'birds': ['Parrot', 'Swallow', 'Albatross']\n\n}\n\nlocals = { }\n\n# Execute using the above dictionaries as the global and local namespace a = eval(\"3 * x + 4 * y\", globals, locals) exec(\"for b in birds: print(b)\", globals, locals)\n\nIf you omit one or both namespaces, the current values of the global and local name- spaces are used.Also, due to issues related to nested scopes, the use of exec() inside of a function body may result in a SyntaxError exception if that function also contains nested function definitions or uses the lambda operator.\n\nWhen a string is passed to exec() or eval() the parser first compiles it into byte-\n\ncode. Because this process is expensive, it may be better to precompile the code and reuse the bytecode on subsequent calls if the code will be executed multiple times.\n\nThe compile(str,filename,kind) function compiles a string into bytecode in which stris a string containing the code to be compiled and filenameis the file in which the string is defined (for use in traceback generation).The kindargument speci- fies the type of code being compiled—'single' for a single statement, 'exec' for a set of statements, or 'eval' for an expression.The code object returned by the compile() function can also be passed to the eval() function and exec() statement. Here’s an example:\n\ns = \"for i in range(0,10): print(i)\" c = compile(s,'','exec') # Compile into a code object exec(c) # Execute it\n\ns2 = \"3 * x + 4 * y\" c2 = compile(s2, '', 'eval') # Compile into an expression result = eval(c2) # Execute it\n\nF h Lib f L Bdff",
      "content_length": 2736,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 141,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 142,
      "content": "7\n\nClasses and Object-Oriented Programming\n\nClasses are the mechanism used to create new kinds of objects.This chapter covers\n\nthe details of classes, but is not intended to be an in-depth reference on object-oriented programming and design. It’s assumed that the reader has some prior experience with data structures and object-oriented programming in other languages such as C or Java. (Chapter 3,“Types and Objects,” contains additional information about the terminology and internal implementation of objects.)\n\nThe class Statement A class defines a set of attributes that are associated with, and shared by, a collection of objects known as instances.A class is most commonly a collection of functions (known as methods), variables (which are known as class variables), and computed attributes (which are known as properties).\n\nA class is defined using the class statement.The body of a class contains a series of\n\nstatements that execute during class definition. Here’s an example:\n\nclass Account(object):\n\nnum_accounts = 0 def __init__(self,name,balance):\n\nself.name = name self.balance = balance Account.num_accounts += 1\n\ndef __del__(self):\n\nAccount.num_accounts -= 1\n\ndef deposit(self,amt):\n\nself.balance = self.balance + amt\n\ndef withdraw(self,amt):\n\nself.balance = self.balance - amt\n\ndef inquiry(self):\n\nreturn self.balance\n\nThe values created during the execution of the class body are placed into a class object that serves as a namespace much like a module. For example, the members of the Account class are accessed as follows:\n\nAccount.num_accounts Account.__init__ Account.__del__ Account.deposit Account.withdraw Account.inquiry\n\nF h Lib f L Bdff",
      "content_length": 1666,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 143,
      "content": "118\n\nChapter 7 Classes and Object-Oriented Programming\n\nIt’s important to note that a class statement by itself doesn’t create any instances of the class (for example, no accounts are actually created in the preceding example). Rather, a class merely sets up the attributes that will be common to all the instances that will be created later. In this sense, you might think of it as a blueprint.\n\nThe functions defined inside a class are known as instance methods.An instance\n\nmethod is a function that operates on an instance of the class, which is passed as the first argument. By convention, this argument is called self, although any legal identifier name can be used. In the preceding example, deposit(), withdraw(), and inquiry() are examples of instance methods.\n\nClass variables such as num_accounts are values that are shared among all instances\n\nof a class (that is, they’re not individually assigned to each instance). In this case, it’s a variable that’s keeping track of how many Account instances are in existence.\n\nClass Instances Instances of a class are created by calling a class object as a function.This creates a new instance that is then passed to the __init__() method of the class.The arguments to __init__() consist of the newly created instance self along with the arguments sup- plied when calling the class object. For example:\n\n# Create a few accounts a = Account(\"Guido\", 1000.00) # Invokes Account.__init__(a,\"Guido\",1000.00) b = Account(\"Bill\", 10.00)\n\nInside __init__(), attributes are saved in the instance by assigning to self. For\n\nexample, self.name = name is saving a name attribute in the instance. Once the newly created instance has been returned to the user, these attributes as well as attrib- utes of the class are accessed using the dot (.) operator as follows:\n\na.deposit(100.00) # Calls Account.deposit(a,100.00) b.withdraw(50.00) # Calls Account.withdraw(b,50.00) name = a.name # Get account name\n\nThe dot (.) operator is responsible for attribute binding.When you access an attribute, the resulting value may come from several different places. For example, a.name in the previous example returns the name attribute of the instance a. However, a.deposit returns the deposit attribute (a method) of the Account class.When you access an attribute, the instance is checked first and if nothing is known, the search moves to the instance’s class instead.This is the underlying mechanism by which a class shares its attributes with all of its instances.\n\nScoping Rules Although classes define a namespace, classes do not create a scope for names used inside the bodies of methods.Therefore, when you’re implementing a class, references to attributes and methods must be fully qualified. For example, in methods you always ref- erence attributes of the instance through self. Thus, in the example you use self.balance, not balance. This also applies if you want to call a method from another method, as shown in the following example:\n\nF h Lib f L Bdff",
      "content_length": 2995,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 144,
      "content": "Inheritance\n\n119\n\nclass Foo(object): def bar(self):\n\nprint(\"bar!\")\n\ndef spam(self):\n\nbar(self) # Incorrect! 'bar' generates a NameError self.bar() # This works Foo.bar(self) # This also works\n\nThe lack of scoping in classes is one area where Python differs from C++ or Java. If you have used those languages, the self parameter in Python is the same as the this pointer.The explicit use of self is required because Python does not provide a means to explicitly declare variables (that is, a declaration such as int x or float y in C). Without this, there is no way to know whether an assignment to a variable in a method is supposed to be a local variable or if it’s supposed to be saved as an instance attribute. The explicit use of self fixes this—all values stored on self are part of the instance and all other assignments are just local variables.\n\nInheritance Inheritance is a mechanism for creating a new class that specializes or modifies the behavior of an existing class.The original class is called a base class or a superclass.The new class is called a derived class or a subclass.When a class is created via inheritance, it “inherits” the attributes defined by its base classes. However, a derived class may redefine any of these attributes and add new attributes of its own.\n\nInheritance is specified with a comma-separated list of base-class names in the class\n\nstatement. If there is no logical base class, a class inherits from object, as has been shown in prior examples. object is a class which is the root of all Python objects and which provides the default implementation of some common methods such as __str__(), which creates a string for use in printing.\n\nInheritance is often used to redefine the behavior of existing methods.As an exam-\n\nple, here’s a specialized version of Account that redefines the inquiry() method to periodically overstate the current balance with the hope that someone not paying close attention will overdraw his account and incur a big penalty when making a payment on their subprime mortgage:\n\nimport random class EvilAccount(Account): def inquiry(self):\n\nif random.randint(0,4) == 1:\n\nreturn self.balance * 1.10 # Note: Patent pending idea\n\nelse:\n\nreturn self.balance\n\nc = EvilAccount(\"George\", 1000.00) c.deposit(10.0) # Calls Account.deposit(c,10.0) available = c.inquiry() # Calls EvilAccount.inquiry(c)\n\nIn this example, instances of EvilAccount are identical to instances of Account except for the redefined inquiry() method.\n\nInheritance is implemented with only a slight enhancement of the dot (.) operator.\n\nSpecifically, if the search for an attribute doesn’t find a match in the instance or the instance’s class, the search moves on to the base class.This process continues until there are no more base classes to search. In the previous example, this explains why c.deposit() calls the implementation of deposit() defined in the Account class.\n\nF h Lib f L Bdff",
      "content_length": 2926,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 145,
      "content": "120\n\nChapter 7 Classes and Object-Oriented Programming\n\nA subclass can add new attributes to the instances by defining its own version of\n\n__init__(). For example, this version of EvilAccount adds a new attribute evilfactor:\n\nclass EvilAccount(Account):\n\ndef __init__(self,name,balance,evilfactor):\n\nAccount.__init__(self,name,balance) # Initialize Account self.evilfactor = evilfactor\n\ndef inquiry(self):\n\nif random.randint(0,4) == 1:\n\nreturn self.balance * self.evilfactor\n\nelse:\n\nreturn self.balance\n\nWhen a derived class defines __init__(), the __init__() methods of base classes are not automatically invoked.Therefore, it’s up to a derived class to perform the proper initialization of the base classes by calling their __init__() methods. In the previous example, this is shown in the statement that calls Account.__init__(). If a base class does not define __init__(), this step can be omitted. If you don’t know whether the base class defines __init__(), it is always safe to call it without any arguments because there is always a default implementation that simply does nothing.\n\nOccasionally, a derived class will reimplement a method but also want to call the original implementation.To do this, a method can explicitly call the original method in the base class, passing the instance self as the first parameter as shown here:\n\nclass MoreEvilAccount(EvilAccount):\n\ndef deposit(self,amount):\n\nself.withdraw(5.00) # Subtract the \"convenience\" fee EvilAccount.deposit(self,amount) # Now, make deposit\n\nA subtlety in this example is that the class EvilAccount doesn’t actually implement the deposit() method. Instead, it is implemented in the Account class.Although this code works, it might be confusing to someone reading the code (e.g., was EvilAccount sup- posed to implement deposit()?).Therefore, an alternative solution is to use the super() function as follows:\n\nclass MoreEvilAccount(EvilAccount):\n\ndef deposit(self,amount):\n\nself.withdraw(5.00) # Subtract convenience fee super(MoreEvilAccount,self).deposit(amount) # Now, make deposit\n\nsuper(cls, instance) returns a special object that lets you perform attribute lookups on the base classes. If you use this, Python will search for an attribute using the normal search rules that would have been used on the base classes.This frees you from hard-coding the exact location of a method and more clearly states your intentions (that is, you want to call the previous implementation without regard for which base class defines it). Unfortunately, the syntax of super() leaves much to be desired. If you are using Python 3, you can use the simplified statement super().deposit(amount) to carry out the calculation shown in the example. In Python 2, however, you have to use the more verbose version.\n\nPython supports multiple inheritance.This is specified by having a class list multiple\n\nbase classes. For example, here are a collection of classes:\n\nF h Lib f L Bdff",
      "content_length": 2934,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 146,
      "content": "Inheritance\n\n121\n\nclass DepositCharge(object):\n\nfee = 5.00 def deposit_fee(self):\n\nself.withdraw(self.fee)\n\nclass WithdrawCharge(object):\n\nfee = 2.50 def withdraw_fee(self):\n\nself.withdraw(self.fee)\n\n# Class using multiple inheritance class MostEvilAccount(EvilAccount, DepositCharge, WithdrawCharge):\n\ndef deposit(self,amt): self.deposit_fee() super(MostEvilAccount,self).deposit(amt)\n\ndef withdraw(self,amt): self.withdraw_fee() super(MostEvilAcount,self).withdraw(amt)\n\nWhen multiple inheritance is used, attribute resolution becomes considerably more complicated because there are many possible search paths that could be used to bind attributes.To illustrate the possible complexity, consider the following statements:\n\nd = MostEvilAccount(\"Dave\",500.00,1.10) d.deposit_fee() # Calls DepositCharge.deposit_fee(). Fee is 5.00 d.withdraw_fee() # Calls WithdrawCharge.withdraw_fee(). Fee is 5.00 ??\n\nIn this example, methods such as deposit_fee() and withdraw_fee() are uniquely named and found in their respective base classes. However, the withdraw_fee() func- tion doesn’t seem to work right because it doesn’t actually use the value of fee that was initialized in its own class.What has happened is that the attribute fee is a class variable defined in two different base classes. One of those values is used, but which one? (Hint: it’s DepositCharge.fee.)\n\nTo find attributes with multiple inheritance, all base classes are ordered in a list from the “most specialized” class to the “least specialized” class.Then, when searching for an attribute, this list is searched in order until the first definition of the attribute is found. In the example, the class EvilAccount is more specialized than Account because it inherits from Account. Similarly, within MostEvilAccount, DepositCharge is con- sidered to be more specialized than WithdrawCharge because it is listed first in the list of base classes. For any given class, the ordering of base classes can be viewed by print- ing its __mro__ attribute. Here’s an example:\n\n>>> MostEvilAccount.__mro__ (<class '__main__.MostEvilAccount'>,\n\n<class '__main__.EvilAccount'>, <class '__main__.Account'>, <class '__main__.DepositCharge'>, <class '__main__.WithdrawCharge'>, <type 'object'>)\n\n>>>\n\nIn most cases, this list is based on rules that “make sense.”That is, a derived class is always checked before its base classes and if a class has more than one parent, the parents are always checked in the same order as listed in the class definition. However, the pre- cise ordering of base classes is actually quite complex and not based on any sort of “simple” algorithm such as depth-first or breadth-first search. Instead, the ordering is determined according to the C3 linearization algorithm, which is described in the paper “A Monotonic Superclass Linearization for Dylan” (K. Barrett, et al, presented at\n\nF h Lib f L Bdff",
      "content_length": 2880,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 147,
      "content": "122\n\nChapter 7 Classes and Object-Oriented Programming\n\nOOPSLA’96).A subtle aspect of this algorithm is that certain class hierarchies will be rejected by Python with a TypeError. Here’s an example:\n\nclass X(object): pass class Y(X): pass class Z(X,Y): pass # TypeError.\n\n# Can't create consistent method resolution order__\n\nIn this case, the method resolution algorithm rejects class Z because it can’t determine an ordering of the base classes that makes sense. For example, the class X appears before class Y in the inheritance list, so it must be checked first. However, class Y is more spe- cialized because it inherits from X.Therefore, if X is checked first, it would not be possi- ble to resolve specialized methods in Y. In practice, these issues should rarely arise—and if they do, it usually indicates a more serious design problem with a program.\n\nAs a general rule, multiple inheritance is something best avoided in most programs. However, it is sometimes used to define what are known as mixin classes.A mixin class typically defines a set of methods that are meant to be “mixed in” to other classes in order to add extra functionality (almost like a macro).Typically, the methods in a mixin will assume that other methods are present and will build upon them.The DepositCharge and WithdrawCharge classes in the earlier example illustrate this. These classes add new methods such as deposit_fee() to classes that include them as one of the base classes. However, you would never instantiate DepositCharge by itself. In fact, if you did, it wouldn’t create an instance that could be used for anything useful (that is, the one defined method wouldn’t even execute correctly).\n\nJust as a final note, if you wanted to fix the problematic references to fee in this example, the implementation of deposit_fee() and withdraw_fee() should be changed to refer to the attribute directly using the class name instead of self (for example, DepositChange.fee).\n\nPolymorphism Dynamic Binding and Duck Typing Dynamic binding (also sometimes referred to as polymorphism when used in the context of inheritance) is the capability to use an instance without regard for its type. It is handled entirely through the attribute lookup process described for inheritance in the preceding section.Whenever an attribute is accessed as obj.attr, attris located by searching within the instance itself, the instance’s class definition, and then base classes, in that order.The first match found is returned.\n\nA critical aspect of this binding process is that it is independent of what kind of object objis.Thus, if you make a lookup such as obj.name, it will work on any obj that happens to have a name attribute.This behavior is sometimes referred to as duck typing in reference to the adage “if it looks like, quacks like, and walks like a duck, then it’s a duck.”\n\nPython programmers often write programs that rely on this behavior. For example, if\n\nyou want to make a customized version of an existing object, you can either inherit from it or you can simply create a completely new object that looks and acts like it but is otherwise unrelated.This latter approach is often used to maintain a loose coupling of program components. For example, code may be written to work with any kind of object whatsoever as long as it has a certain set of methods. One of the most common examples is with various “file-like” objects defined in the standard library.Although these objects work like files, they don’t inherit from the built-in file object.\n\nF h Lib f L Bdff",
      "content_length": 3549,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 148,
      "content": "Static Methods and Class Methods\n\n123\n\nStatic Methods and Class Methods In a class definition, all functions are assumed to operate on an instance, which is always passed as the first parameter self. However, there are two other common kinds of methods that can be defined.\n\nA static method is an ordinary function that just happens to live in the namespace\n\ndefined by a class. It does not operate on any kind of instance.To define a static method, use the @staticmethod decorator as shown here:\n\nclass Foo(object): @staticmethod def add(x,y):\n\nreturn x + y\n\nTo call a static method, you just prefix it by the class name.You do not pass it any addi- tional information. For example:\n\nx = Foo.add(3,4) # x = 7\n\nA common use of static methods is in writing classes where you might have many dif- ferent ways to create new instances. Because there can only be one __init__() func- tion, alternative creation functions are often defined as shown here:\n\nclass Date(object):\n\ndef __init__(self,year,month,day):\n\nself.year = year self.month = month self.day = day\n\n@staticmethod def now():\n\nt = time.localtime() return Date(t.tm_year, t.tm_mon, t.tm_day)\n\n@staticmethod def tomorrow():\n\nt = time.localtime(time.time()+86400) return Date(t.tm_year, t.tm_mon, t.tm_day)\n\n# Example of creating some dates a = Date(1967, 4, 9) b = Date.now() # Calls static method now() c = Date.tomorrow() # Calls static method tomorrow()\n\nClass methods are methods that operate on the class itself as an object. Defined using the @classmethod decorator, a class method is different than an instance method in that the class is passed as the first argument which is named cls by convention. For example:\n\nclass Times(object):\n\nfactor = 1 @classmethod def mul(cls,x):\n\nreturn cls.factor*x\n\nclass TwoTimes(Times):\n\nfactor = 2\n\nx = TwoTimes.mul(4) # Calls Times.mul(TwoTimes, 4) -> 8\n\nF h Lib f L Bdff",
      "content_length": 1872,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 149,
      "content": "124\n\nChapter 7 Classes and Object-Oriented Programming\n\nIn this example, notice how the class TwoTimes is passed to mul() as an object. Although this example is esoteric, there are practical, but subtle, uses of class methods. As an example, suppose that you defined a class that inherited from the Date class shown previously and customized it slightly:\n\nclass EuroDate(Date):\n\n# Modify string conversion to use European dates def __str__(self):\n\nreturn \"%02d/%02d/%4d\" % (self.day, self.month, self.year)\n\nBecause the class inherits from Date, it has all of the same features. However, the now() and tomorrow() methods are slightly broken. For example, if someone calls EuroDate.now(), a Date object is returned instead of a EuroDate object.A class method can fix this:\n\nclass Date(object):\n\n... @classmethod def now(cls):\n\nt = time.localtime() # Create an object of the appropriate type return cls(t.tm_year, t.tm_month, t.tm_day)\n\nclass EuroDate(Date):\n\n...\n\na = Date.now() # Calls Date.now(Date) and returns a Date b = EuroDate.now() # Calls Date.now(EuroDate) and returns a EuroDate\n\nOne caution about static and class methods is that Python does not manage these meth- ods in a separate namespace than the instance methods.As a result, they can be invoked on an instance. For example:\n\na = Date(1967,4,9) b = d.now() # Calls Date.now(Date)\n\nThis is potentially quite confusing because a call to d.now() doesn’t really have any- thing to do with the instance d.This behavior is one area where the Python object sys- tem differs from that found in other OO languages such as Smalltalk and Ruby. In those languages, class methods are strictly separate from instance methods.\n\nProperties Normally, when you access an attribute of an instance or a class, the associated value that is stored is returned.A property is a special kind of attribute that computes its value when accessed. Here is a simple example:\n\nclass Circle(object):\n\ndef __init__(self,radius): self.radius = radius\n\n# Some additional properties of Circles @property def area(self):\n\nreturn math.pi*self.radius**2\n\n@property def perimeter(self):\n\nreturn 2*math.pi*self.radius\n\nF h Lib f L Bdff",
      "content_length": 2161,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 150,
      "content": "Properties\n\n125\n\nThe resulting Circle object behaves as follows:\n\n>>> c = Circle(4.0) >>> c.radius 4.0 >>> c.area 50.26548245743669 >>> c.perimeter 25.132741228718345 >>> c.area = 2 Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nAttributeError: can't set attribute >>>\n\nIn this example, Circle instances have an instance variable c.radius that is stored. c.area and c.perimeter are simply computed from that value.The @property deco- rator makes it possible for the method that follows to be accessed as a simple attribute, without the extra () that you would normally have to add to call the method.To the user of the object, there is no obvious indication that an attribute is being computed other than the fact that an error message is generated if an attempt is made to redefine the attribute (as shown in the AttributeError exception above).\n\nUsing properties in this way is related to something known as the Uniform Access Principle. Essentially, if you’re defining a class, it is always a good idea to make the pro- gramming interface to it as uniform as possible.Without properties, certain attributes of an object would be accessed as a simple attribute such as c.radius whereas other attributes would be accessed as methods such as c.area(). Keeping track of when to add the extra () adds unnecessary confusion.A property can fix this.\n\nPython programmers don’t often realize that methods themselves are implicitly han-\n\ndled as a kind of property. Consider this class:\n\nclass Foo(object):\n\ndef __init__(self,name): self.name = name\n\ndef spam(self,x):\n\nprint(\"%s, %s\" % (self.name, x)\n\nWhen a user creates an instance such as f = Foo(\"Guido\") and then accesses f.spam, the original function object spam is not returned. Instead, you get something known as a bound method, which is an object that represents the method call that will execute when the () operator is invoked on it.A bound method is like a partially evaluated function where the self parameter has already been filled in, but the additional argu- ments still need to be supplied by you when you call it using ().The creation of this bound method object is silently handled through a property function that executes behind the scenes.When you define static and class methods using @staticmethod and @classmethod, you are actually specifying the use of a different property function that will handle the access to those methods in a different way. For example, @staticmethod simply returns the method function back “as is” without any special wrapping or processing.\n\nProperties can also intercept operations to set and delete an attribute.This is done by\n\nattaching additional setter and deleter methods to a property. Here is an example:\n\nF h Lib f L Bdff",
      "content_length": 2755,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 151,
      "content": "126\n\nChapter 7 Classes and Object-Oriented Programming\n\nclass Foo(object):\n\ndef __init__(self,name):\n\nself.__name = name\n\n@property def name(self):\n\nreturn self.__name\n\n@name.setter def name(self,value):\n\nif not isinstance(value,str):\n\nraise TypeError(\"Must be a string!\")\n\nself.__name = value\n\n@name.deleter def name(self):\n\nraise TypeError(\"Can't delete name\")\n\nf = Foo(\"Guido\") n = f.name # calls f.name() - get function f.name = \"Monty\" # calls setter name(f,\"Monty\") f.name = 45 # calls setter name(f,45) -> TypeError del f.name # Calls deleter name(f) -> TypeError\n\nIn this example, the attribute name is first defined as a read-only property using the @property decorator and associated method.The @name.setter and @name.deleter decorators that follow are associating additional methods with the set and deletion operations on the name attribute.The names of these methods must exactly match the name of the original property. In these methods, notice that the actual value of the name is stored in an attribute __name.The name of the stored attribute does not have to follow any convention, but it has to be different than the property in order to distin- guish it from the name of the property itself.\n\nIn older code, you will often see properties defined using the property(getf=None, setf=None, delf=None, doc=None) function with a set of uniquely named methods for carrying out each operation. For example:\n\nclass Foo(object):\n\ndef getname(self):\n\nreturn self.__name\n\ndef setname(self,value):\n\nif not isinstance(value,str):\n\nraise TypeError(\"Must be a string!\")\n\nself.__name = value\n\ndef delname(self):\n\nraise TypeError(\"Can't delete name\") name = property(getname,setname,delname)\n\nThis older approach is still supported, but the decorator version tends to lead to classes that are a little more polished. For example, if you use decorators, the get, set, and delete functions aren’t also visible as methods.\n\nDescriptors With properties, access to an attribute is controlled by a series of user-defined get, set, and delete functions.This sort of attribute control can be further generalized through the use of a descriptor object.A descriptor is simply an object that represents the value of an attribute. By implementing one or more of the special methods __get__(), __set__(), and __delete__(), it can hook into the attribute access mechanism and can customize those operations. Here is an example:\n\nF h Lib f L Bdff",
      "content_length": 2433,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 152,
      "content": "Data Encapsulation and Private Attributes\n\n127\n\nclass TypedProperty(object):\n\ndef __init__(self,name,type,default=None):\n\nself.name = \"_\" + name self.type = type\n\nself.default = default if default else type()\n\ndef __get__(self,instance,cls):\n\nreturn getattr(instance,self.name,self.default)\n\ndef __set__(self,instance,value):\n\nif not isinstance(value,self.type):\n\nraise TypeError(\"Must be a %s\" % self.type)\n\nsetattr(instance,self.name,value)\n\ndef __delete__(self,instance):\n\nraise AttributeError(\"Can't delete attribute\")\n\nclass Foo(object):\n\nname = TypedProperty(\"name\",str) num = TypedProperty(\"num\",int,42)\n\nIn this example, the class TypedProperty defines a descriptor where type checking is performed when the attribute is assigned and an error is produced if an attempt is made to delete the attribute. For example:\n\nf = Foo() a = f.name # Implicitly calls Foo.name.__get__(f,Foo) f.name = \"Guido\" # Calls Foo.name.__set__(f,\"Guido\") del f.name # Calls Foo.name.__delete__(f)\n\nDescriptors can only be instantiated at the class level. It is not legal to create descriptors on a per-instance basis by creating descriptor objects inside __init__() and other methods.Also, the attribute name used by the class to hold a descriptor takes prece- dence over attributes stored on instances. In the previous example, this is why the descriptor object takes a name parameter and why the name is changed slightly by inserting a leading underscore. In order for the descriptor to store a value on the instance, it has to pick a name that is different than that being used by the descriptor itself.\n\nData Encapsulation and Private Attributes By default, all attributes and methods of a class are “public.”This means that they are all accessible without any restrictions. It also implies that everything defined in a base class is inherited and accessible within a derived class.This behavior is often undesirable in object-oriented applications because it exposes the internal implementation of an object and can lead to namespace conflicts between objects defined in a derived class and those defined in a base class.\n\nTo fix this problem, all names in a class that start with a double underscore, such as __Foo, are automatically mangled to form a new name of the form _Classname__Foo. This effectively provides a way for a class to have private attributes and methods because private names used in a derived class won’t collide with the same private names used in a base class. Here’s an example:\n\nclass A(object):\n\ndef __init__(self):\n\nself.__X = 3 # Mangled to self._A__X def __spam(self): # Mangled to _A__spam()\n\npass\n\ndef bar(self):\n\nself.__spam() # Only calls A.__spam()\n\nF h Lib f L Bdff",
      "content_length": 2691,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 153,
      "content": "128\n\nChapter 7 Classes and Object-Oriented Programming\n\nclass B(A):\n\ndef __init__(self):\n\nA.__init__(self) self.__X = 37 # Mangled to self._B__X def __spam(self): # Mangled to _B__spam()\n\npass\n\nAlthough this scheme provides the illusion of data hiding, there’s no strict mechanism in place to actually prevent access to the “private” attributes of a class. In particular, if the name of the class and corresponding private attribute are known, they can be accessed using the mangled name.A class can make these attributes less visible by redefining the __dir__() method, which supplies the list of names returned by the dir() function that’s used to inspect objects.\n\nAlthough this name mangling might look like an extra processing step, the mangling process actually only occurs once at the time a class is defined. It does not occur during execution of the methods, nor does it add extra overhead to program execution.Also, be aware that name mangling does not occur in functions such as getattr(), hasattr(), setattr(), or delattr() where the attribute name is specified as a string. For these functions, you need to explicitly use the mangled name such as _Classname__nameto access the attribute.\n\nIt is recommended that private attributes be used when defining mutable attributes via properties. By doing so, you will encourage users to use the property name rather than accessing the underlying instance data directly (which is probably not what you intended if you wrapped it with a property to begin with).An example of this appeared in the previous section.\n\nGiving a method a private name is a technique that a superclass can use to prevent a derived class from redefining and changing the implementation of a method. For exam- ple, the A.bar() method in the example only calls A.__spam(), regardless of the type of self or the presence of a different __spam() method in a derived class.\n\nFinally, don’t confuse the naming of private class attributes with the naming of “pri-\n\nvate” definitions in a module.A common mistake is to define a class where a single leading underscore is used on attribute names in an effort to hide their values (e.g., _name). In modules, this naming convention prevents names from being exported by the from module import * statement. However, in classes, this naming convention does not hide the attribute nor does it prevent name clashes that arise if someone inherits from the class and defines a new attribute or method with the same name.\n\nObject Memory Management When a class is defined, the resulting class is a factory for creating new instances. For example:\n\nclass Circle(object):\n\ndef __init__(self,radius):\n\nself.radius = radius\n\n# Create some Circle instances c = Circle(4.0) d = Circle(5.0)\n\nF h Lib f L Bdff",
      "content_length": 2762,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 154,
      "content": "Object Memory Management\n\n129\n\nThe creation of an instance is carried out in two steps using the special method __new__(), which creates a new instance, and __init__(), which initializes it. For example, the operation c = Circle(4.0) performs these steps:\n\nc = Circle.__new__(Circle, 4.0) if isinstance(c,Circle):\n\nCircle.__init__(c,4.0)\n\nThe __new__() method of a class is something that is rarely defined by user code. If it is defined, it is typically written with the prototype __new__(cls, *args, **kwargs) where args and kwargs are the same arguments that will be passed to __init__(). __new__() is always a class method that receives the class object as the first parameter.Although __new__() creates an instance, it does not automatically call __init__().\n\nIf you see __new__() defined in a class, it usually means the class is doing one of\n\ntwo things. First, the class might be inheriting from a base class whose instances are immutable.This is common if defining objects that inherit from an immutable built-in type such as an integer, string, or tuple because __new__() is the only method that executes prior to the instance being created and is the only place where the value could be modified (in __init__(), it would be too late). For example:\n\nclass Upperstr(str):\n\ndef __new__(cls,value=\"\"):\n\nreturn str.__new__(cls, value.upper())\n\nu = Upperstr(\"hello\") # value is \"HELLO\"\n\nThe other major use of __new__() is when defining metaclasses.This is described at the end of this chapter.\n\nOnce created, instances are managed by reference counting. If the reference count reaches zero, the instance is immediately destroyed.When the instance is about to be destroyed, the interpreter first looks for a __del__() method associated with the object and calls it. In practice, it’s rarely necessary for a class to define a __del__() method.The only exception is when the destruction of an object requires a cleanup action such as closing a file, shutting down a network connection, or releasing other system resources. Even in these cases, it’s dangerous to rely on __del__() for a clean shutdown because there’s no guarantee that this method will be called when the inter- preter exits.A better approach may be to define a method such as close() that a pro- gram can use to explicitly perform a shutdown.\n\nOccasionally, a program will use the del statement to delete a reference to an object. If this causes the reference count of the object to reach zero, the __del__() method is called. However, in general, the del statement doesn’t directly call __del__().\n\nA subtle danger involving object destruction is that instances for which __del__()\n\nis defined cannot be collected by Python’s cyclic garbage collector (which is a strong reason not to define __del__ unless you need to). Programmers coming from lan- guages without automatic garbage collection (e.g., C++) should take care not to adopt a programming style where __del__() is unnecessarily defined.Although it is rare to break the garbage collector by defining __del__(), there are certain types of program- ming patterns, especially those involving parent-child relationships or graphs, where this\n\nF h Lib f L Bdff",
      "content_length": 3185,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 155,
      "content": "130\n\nChapter 7 Classes and Object-Oriented Programming\n\ncan be a problem. For example, suppose you had an object that was implementing a variant of the “Observer Pattern.”\n\nclass Account(object):\n\ndef __init__(self,name,balance):\n\nself.name = name self.balance = balance self.observers = set()\n\ndef __del__(self):\n\nfor ob in self.observers:\n\nob.close() del self.observers def register(self,observer):\n\nself.observers.add(observer)\n\ndef unregister(self,observer):\n\nself.observers.remove(observer)\n\ndef notify(self):\n\nfor ob in self.observers:\n\nob.update()\n\ndef withdraw(self,amt): self.balance -= amt self.notify()\n\nclass AccountObserver(object):\n\ndef __init__(self, theaccount): self.theaccount = theaccount theaccount.register(self)\n\ndef __del__(self):\n\nself.theaccount.unregister(self) del self.theaccount\n\ndef update(self):\n\nprint(\"Balance is %0.2f\" % self.theaccount.balance)\n\ndef close(self):\n\nprint(\"Account no longer in use\")\n\n# Example setup a = Account('Dave',1000.00) a_ob = AccountObserver(a)\n\nIn this code, the Account class allows a set of AccountObserver objects to monitor an Account instance by receiving an update whenever the balance changes.To do this, each Account keeps a set of the observers and each AccountObserver keeps a refer- ence back to the account. Each class has defined __del__() in an attempt to provide some sort of cleanup (such as unregistering and so on). However, it just doesn’t work. Instead, the classes have created a reference cycle in which the reference count never drops to 0 and there is no cleanup. Not only that, the garbage collector (the gc module) won’t even clean it up, resulting in a permanent memory leak.\n\nOne way to fix the problem shown in this example is for one of the classes to create\n\na weak reference to the other using the weakref module.A weak reference is a way of creating a reference to an object without increasing its reference count.To work with a weak reference, you have to add an extra bit of functionality to check whether the object being referred to still exists. Here is an example of a modified observer class:\n\nimport weakref class AccountObserver(object):\n\ndef __init__(self, theaccount):\n\nself.accountref = weakref.ref(theaccount) # Create a weakref theaccount.register(self)\n\nF h Lib f L Bdff",
      "content_length": 2278,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 156,
      "content": "Object Representation and Attribute Binding\n\n131\n\ndef __del__(self):\n\nacc = self.accountref() # Get account if acc: # Unregister if still exists\n\nacc.unregister(self)\n\ndef update(self):\n\nprint(\"Balance is %0.2f\" % self.accountref().balance)\n\ndef close(self):\n\nprint(\"Account no longer in use\")\n\n# Example setup a = Account('Dave',1000.00) a_ob = AccountObserver(a)\n\nIn this example, a weak reference accountref is created.To access the underlying Account, you call it like a function.This either returns the Account or None if it’s no longer around.With this modification, there is no longer a reference cycle. If the Account object is destroyed, its __del__ method runs and observers receive notifica- tion.The gc module also works properly. More information about the weakref module can be found in Chapter 13,“Python Runtime Services.”\n\nObject Representation and Attribute Binding Internally, instances are implemented using a dictionary that’s accessible as the instance’s __dict__ attribute.This dictionary contains the data that’s unique to each instance. Here’s an example:\n\n>>> a = Account('Guido', 1100.0) >>> a.__dict__ {'balance': 1100.0, 'name': 'Guido'}\n\nNew attributes can be added to an instance at any time, like this:\n\na.number = 123456 # Add attribute 'number' to a.__dict__\n\nModifications to an instance are always reflected in the local __dict__ attribute. Likewise, if you make modifications to __dict__ directly, those modifications are reflected in the attributes.\n\nInstances are linked back to their class by a special attribute __class__.The class itself is also just a thin layer over a dictionary which can be found in its own __dict__ attribute.The class dictionary is where you find the methods. For example:\n\n>>> a.__class__ <class '__main__.Account'> >>> Account.__dict__.keys() ['__dict__', '__module__', 'inquiry', 'deposit', 'withdraw', '__del__', 'num_accounts', '__weakref__', '__doc__', '__init__'] >>>\n\nFinally, classes are linked to their base classes in a special attribute __bases__, which is a tuple of the base classes.This underlying structure is the basis for all of the operations that get, set, and delete the attributes of objects.\n\nWhenever an attribute is set using obj.name = value, the special method\n\nobj.__setattr__(\"name\", value) is invoked. If an attribute is deleted using del obj.name, the special method obj.__delattr__(\"name\") is invoked.The default behavior of these methods is to modify or remove values from the local __dict__ of obj unless the requested attribute happens to correspond to a property or descriptor. In\n\nF h Lib f L Bdff",
      "content_length": 2599,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 157,
      "content": "132\n\nChapter 7 Classes and Object-Oriented Programming\n\nthat case, the set and delete operation will be carried out by the set and delete functions associated with the property.\n\nFor attribute lookup such as obj.name, the special method\n\nobj.__getattrribute__(\"name\") is invoked.This method carries out the search process for finding the attribute, which normally includes checking for properties, look- ing in the local __dict__ attribute, checking the class dictionary, and searching the base classes. If this search process fails, a final attempt to find the attribute is made by trying to invoke the __getattr__() method of the class (if defined). If this fails, an AttributeError exception is raised.\n\nUser-defined classes can implement their own versions of the attribute access func-\n\ntions, if desired. For example:\n\nclass Circle(object):\n\ndef __init__(self,radius): self.radius = radius def __getattr__(self,name): if name == 'area':\n\nreturn math.pi*self.radius**2\n\nelif name == 'perimeter':\n\nreturn 2*math.pi*self.radius\n\nelse:\n\nreturn object.__getattr__(self,name)\n\ndef __setattr__(self,name,value):\n\nif name in ['area','perimeter']:\n\nraise TypeError(\"%s is readonly\" % name)\n\nobject.__setattr__(self,name,value)\n\nA class that reimplements these methods should probably rely upon the default imple- mentation in object to carry out the actual work.This is because the default imple- mentation takes care of the more advanced features of classes such as descriptors and properties.\n\nAs a general rule, it is relatively uncommon for classes to redefine the attribute access\n\noperators. However, one application where they are often used is in writing general- purpose wrappers and proxies to existing objects. By redefining __getattr__(), __setattr__(), and __delattr__(), a proxy can capture attribute access and trans- parently forward those operations on to another object.\n\n__slots__ A class can restrict the set of legal instance attribute names by defining a special variable called __slots__. Here’s an example:\n\nclass Account(object):\n\n__slots__ = ('name','balance')\n\n...\n\nWhen __slots__ is defined, the attribute names that can be assigned on instances are restricted to the names specified. Otherwise, an AttributeError exception is raised. This restriction prevents someone from adding new attributes to existing instances and solves the problem that arises if someone assigns a value to an attribute that they can’t spell correctly.\n\nIn reality, __slots__ was never implemented to be a safety feature. Instead, it is actually a performance optimization for both memory and execution speed. Instances of a class that uses __slots__ no longer use a dictionary for storing instance data. Instead, a much more compact data structure based on an array is used. In programs that\n\nF h Lib f L Bdff",
      "content_length": 2811,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 158,
      "content": "Operator Overloading\n\n133\n\ncreate a large number of objects, using __slots__ can result in a substantial reduction in memory use and execution time.\n\nBe aware that the use of __slots__ has a tricky interaction with inheritance. If a class inherits from a base class that uses __slots__, it also needs to define __slots__ for storing its own attributes (even if it doesn’t add any) to take advantage of the bene- fits __slots__ provides. If you forget this, the derived class will run slower and use even more memory than what would have been used if __slots__ had not been used on any of the classes!\n\nThe use of __slots__ can also break code that expects instances to have an under-\n\nlying __dict__ attribute.Although this often does not apply to user code, utility libraries and other tools for supporting objects may be programmed to look at __dict__ for debugging, serializing objects, and other operations.\n\nFinally, the presence of __slots__ has no effect on the invocation of methods such as __getattribute__(), __getattr__(), and __setattr__() should they be rede- fined in a class. However, the default behavior of these methods will take __slots__ into account. In addition, it should be stressed that it is not necessary to add method or property names to __slots__, as they are stored in the class, not on a per-instance basis.\n\nOperator Overloading User-defined objects can be made to work with all of Python’s built-in operators by adding implementations of the special methods described in Chapter 3 to a class. For example, if you wanted to add a new kind of number to Python, you could define a class in which special methods such as __add__() were defined to make instances work with the standard mathematical operators.\n\nThe following example shows how this works by defining a class that implements\n\nthe complex numbers with some of the standard mathematical operators.\n\nNote\n\nBecause Python already provides a complex number type, this class is only provided for the purpose of illustration.\n\nclass Complex(object):\n\ndef __init__(self,real,imag=0): self.real = float(real) self.imag = float(imag)\n\ndef __repr__(self):\n\nreturn \"Complex(%s,%s)\" % (self.real, self.imag)\n\ndef __str__(self):\n\nreturn \"(%g+%gj)\" % (self.real, self.imag)\n\n# self + other def __add__(self,other):\n\nreturn Complex(self.real + other.real, self.imag + other.imag)\n\n# self - other def __sub__(self,other):\n\nreturn Complex(self.real - other.real, self.imag - other.imag)\n\nIn the example, the __repr__() method creates a string that can be evaluated to re- create the object (that is, \"Complex(real,imag)\").This convention should be followed for all user-defined objects as applicable. On the other hand, the __str__() method\n\nF h Lib f L Bdff",
      "content_length": 2734,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 159,
      "content": "134\n\nChapter 7 Classes and Object-Oriented Programming\n\ncreates a string that’s intended for nice output formatting (this is the string that would be produced by the print statement).\n\nThe other operators, such as __add__() and __sub__(), implement mathematical\n\noperations.A delicate matter with these operators concerns the order of operands and type coercion.As implemented in the previous example, the __add__() and __sub__() operators are applied only if a complex number appears on the left side of the operator.They do not work if they appear on the right side of the operator and the left-most operand is not a Complex. For example:\n\n>>> c = Complex(2,3) >>> c + 4.0 Complex(6.0,3.0) >>> 4.0 + c Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: unsupported operand type(s) for +: 'int' and 'Complex'\n\n>>>\n\nThe operation c + 4.0 works partly by accident.All of Python’s built-in numbers already have .real and .imag attributes, so they were used in the calculation. If the other object did not have these attributes, the implementation would break. If you want your implementation of Complex to work with objects missing these attributes, you have to add extra conversion code to extract the needed information (which might depend on the type of the other object).\n\nThe operation 4.0 + c does not work at all because the built-in floating point type\n\ndoesn’t know anything about the Complex class.To fix this, you can add reversed- operand methods to Complex:\n\nclass Complex(object):\n\n... def __radd__(self,other):\n\nreturn Complex(other.real + self.real, other.imag + self.imag)\n\ndef __rsub__(self,other):\n\nreturn Complex(other.real - self.real, other.imag - self.img)\n\n...\n\nThese methods serve as a fallback. If the operation 4.0 + c fails, Python tries to exe- cute c.__radd__(4.0) first before issuing a TypeError.\n\nOlder versions of Python have tried various approaches to coerce types in mixed- type operations. For example, you might encounter legacy Python classes that imple- ment a __coerce__() method.This is no longer used by Python 2.6 or Python 3. Also, don’t be fooled by special methods such as __int__(), __float__(), or __complex__().Although these methods are called by explicit conversions such as int(x) or float(x), they are never called implicitly to perform type conversion in mixed-type arithmetic. So, if you are writing classes where operators must work with mixed types, you have to explicitly handle the type conversion in the implementation of each operator.\n\nTypes and Class Membership Tests When you create an instance of a class, the type of that instance is the class itself.To test for membership in a class, use the built-in function isinstance(obj,cname).This\n\nF h Lib f L Bdff",
      "content_length": 2755,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 160,
      "content": "Types and Class Membership Tests\n\n135\n\nfunction returns True if an object, obj, belongs to the class cnameor any class derived from cname. Here’s an example:\n\nclass A(object): pass class B(A): pass class C(object): pass\n\na = A() # Instance of 'A' b = B() # Instance of 'B' c = C() # Instance of 'C'\n\ntype(a) # Returns the class object A isinstance(a,A) # Returns True isinstance(b,A) # Returns True, B derives from A isinstance(b,C) # Returns False, C not derived from A\n\nSimilarly, the built-in function issubclass(A,B) returns True if the class Ais a sub- class of class B. Here’s an example:\n\nissubclass(B,A) # Returns True issubclass(C,A) # Returns False\n\nA subtle problem with type-checking of objects is that programmers often bypass inher- itance and simply create objects that mimic the behavior of another object.As an exam- ple, consider these two classes:\n\nclass Foo(object):\n\ndef spam(self,a,b):\n\npass\n\nclass FooProxy(object):\n\ndef __init__(self,f):\n\nself.f = f def spam(self,a,b):\n\nreturn self.f.spam(a,b)\n\nIn this example, FooProxy is functionally identical to Foo. It implements the same methods, and it even uses Foo underneath the covers.Yet, in the type system, FooProxy is different than Foo. For example:\n\nf = Foo() # Create a Foo g = FooProxy(f) # Create a FooProxy isinstance(g, Foo) # Returns False\n\nIf a program has been written to explicitly check for a Foo using isinstance(), then it certainly won’t work with a FooProxy object. However, this degree of strictness is often not exactly what you want. Instead, it might make more sense to assert that an object can simply be used as Foo because it has the same interface.To do this, it is possible to define an object that redefines the behavior of isinstance() and issubclass() for the purpose of grouping objects together and type-checking. Here is an example:\n\nclass IClass(object):\n\ndef __init__(self):\n\nself.implementors = set()\n\ndef register(self,C):\n\nself.implementors.add(C)\n\ndef __instancecheck__(self,x):\n\nreturn self.__subclasscheck__(type(x))\n\nF h Lib f L Bdff",
      "content_length": 2047,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 161,
      "content": "136\n\nChapter 7 Classes and Object-Oriented Programming\n\ndef __subclasscheck__(self,sub):\n\nreturn any(c in self.implementors for c in sub.mro())\n\n# Now, use the above object IFoo = IClass() IFoo.register(Foo) IFoo.register(FooProxy)\n\nIn this example, the class IClass creates an object that merely groups a collection of other classes together in a set.The register() method adds a new class to the set.The special method __instancecheck__() is called if anyone performs the operation isinstance(x, IClass).The special method __subclasscheck__() is called if the operation issubclass(C,IClass) is called.\n\nBy using the IFoo object and registered implementers, one can now perform type\n\nchecks such as the following:\n\nf = Foo() # Create a Foo g = FooProxy(f) # Create a FooProxy isinstance(f, IFoo) # Returns True isinstance(g, IFoo) # Returns True issubclass(FooProxy, IFoo) # Returns True\n\nIn this example, it’s important to emphasize that no strong type-checking is occurring. The IFoo object has overloaded the instance checking operations in a way that allows a you to assert that a class belongs to a group. It doesn’t assert any information on the actual programming interface, and no other verification actually occurs. In fact, you can simply register any collection of objects you want to group together without regard to how those classes are related to each other.Typically, the grouping of classes is based on some criteria such as all classes implementing the same programming interface. However, no such meaning should be inferred when overloading __instancecheck__() or __subclasscheck__().The actual interpretation is left up to the application.\n\nPython provides a more formal mechanism for grouping objects, defining interfaces,\n\nand type-checking.This is done by defining an abstract base class, which is defined in the next section.\n\nAbstract Base Classes In the last section, it was shown that the isinstance() and issubclass() operations can be overloaded.This can be used to create objects that group similar classes together and to perform various forms of type-checking. Abstract base classes build upon this con- cept and provide a means for organizing objects into a hierarchy, making assertions about required methods, and so forth.\n\nTo define an abstract base class, you use the abc module.This module defines\n\na metaclass (ABCMeta) and a set of decorators (@abstractmethod and @abstractproperty) that are used as follows:\n\nfrom abc import ABCMeta, abstractmethod, abstractproperty class Foo: # In Python 3, you use the syntax __metaclass__ = ABCMeta # class Foo(metaclass=ABCMeta) @abstractmethod def spam(self,a,b):\n\npass\n\n@abstractproperty\n\nF h Lib f L Bdff",
      "content_length": 2687,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 162,
      "content": "Abstract Base Classes\n\n137\n\ndef name(self):\n\npass\n\nThe definition of an abstract class needs to set its metaclass to ABCMeta as shown (also, be aware that the syntax differs between Python 2 and 3).This is required because the implementation of abstract classes relies on a metaclass (described in the next section). Within the abstract class, the @abstractmethod and @abstractproperty decorators specify that a method or property must be implemented by subclasses of Foo.\n\nAn abstract class is not meant to be instantiated directly. If you try to create a Foo for\n\nthe previous class, you will get the following error:\n\n>>> f = Foo() Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: Can't instantiate abstract class Foo with abstract methods spam >>>\n\nThis restriction carries over to derived classes as well. For instance, if you have a class Bar that inherits from Foo but it doesn’t implement one or more of the abstract meth- ods, attempts to create a Bar will fail with a similar error. Because of this added check- ing, abstract classes are useful to programmers who want to make assertions on the methods and properties that must be implemented on subclasses.\n\nAlthough an abstract class enforces rules about methods and properties that must be implemented, it does not perform conformance checking on arguments or return val- ues.Thus, an abstract class will not check a subclass to see whether a method has used the same arguments as an abstract method. Likewise, an abstract class that requires the definition of a property does not check to see whether the property in a subclass sup- ports the same set of operations (get, set, and delete) of the property specified in a base.\n\nAlthough an abstract class can not be instantiated, it can define methods and proper-\n\nties for use in subclasses. Moreover, an abstract method in the base can still be called from a subclass. For example, calling Foo.spam(a,b) from the subclass is allowed.\n\nAbstract base classes allow preexisting classes to be registered as belonging to that\n\nbase.This is done using the register() method as follows:\n\nclass Grok(object):\n\ndef spam(self,a,b):\n\nprint(\"Grok.spam\")\n\nFoo.register(Grok) # Register with Foo abstract base class\n\nWhen a class is registered with an abstract base, type-checking operations involving the abstract base (such as isinstance() and issubclass()) will return True for instances of the registered class.When a class is registered with an abstract class, no checks are made to see whether the class actually implements any of the abstract methods or prop- erties.This registration process only affects type-checking. It does not add extra error checking to the class that is registered.\n\nUnlike many other object-oriented languages, Python’s built-in types are organized into a relatively flat hierarchy. For example, if you look at the built-in types such as int or float, they directly inherit from object, the root of all objects, instead of an inter- mediate base class representing numbers.This makes it clumsy to write programs that want to inspect and manipulate objects based on a generic category such as simply being an instance of a number.\n\nF h Lib f L Bdff",
      "content_length": 3216,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 163,
      "content": "138\n\nChapter 7 Classes and Object-Oriented Programming\n\nThe abstract class mechanism addresses this issue by allowing preexisting objects to be organized into user-definable type hierarchies. Moreover, some library modules aim to organize the built-in types according to different capabilities that they possess.The collections module contains abstract base classes for various kinds of operations involving sequences, sets, and dictionaries.The numbers module contains abstract base classes related to organizing a hierarchy of numbers. Further details can be found in Chapter 14,“Mathematics,” and Chapter 15,“Data Structures,Algorithms, and Utilities.”\n\nMetaclasses When you define a class in Python, the class definition itself becomes an object. Here’s an example:\n\nclass Foo(object): pass isinstance(Foo,object) # Returns True\n\nIf you think about this long enough, you will realize that something had to create the Foo object.This creation of the class object is controlled by a special kind of object called a metaclass. Simply stated, a metaclass is an object that knows how to create and manage classes.\n\nIn the preceding example, the metaclass that is controlling the creation of Foo is a\n\nclass called type. In fact, if you display the type of Foo, you will find out that it is a type:\n\n>>> type(Foo) <type 'type'>\n\nWhen a new class is defined with the class statement, a number of things happen. First, the body of the class is executed as a series of statements within its own private dictionary.The execution of statements is exactly the same as in normal code with the addition of the name mangling that occurs on private members (names that start with __). Finally, the name of the class, the list of base classes, and the dictionary are passed to the constructor of a metaclass to create the corresponding class object. Here is an example of how it works:\n\nclass_name = \"Foo\" # Name of class class_parents = (object,) # Base classes class_body = \"\"\" # Class body def __init__(self,x):\n\nself.x = x\n\ndef blah(self):\n\nprint(\"Hello World\")\n\n\"\"\" class_dict = { } # Execute the body in the local dictionary class_dict exec(class_body,globals(),class_dict)\n\n# Create the class object Foo Foo = type(class_name,class_parents,class_dict)\n\nThe final step of class creation where the metaclass type() is invoked can be cus- tomized.The choice of what happens in the final step of class definition is controlled in\n\nF h Lib f L Bdff",
      "content_length": 2437,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 164,
      "content": "Metaclasses\n\n139\n\na number of ways. First, the class can explicitly specify its metaclass by either setting a __metaclass__ class variable (Python 2), or supplying the metaclass keyword argu- ment in the tuple of base classes (Python 3).\n\nclass Foo: # In Python 3, use the syntax\n\n__metaclass__ = type # class Foo(metaclass=type) ...\n\nIf no metaclass is explicitly specified, the class statement examines the first entry in the tuple of base classes (if any). In this case, the metaclass is the same as the type of the first base class.Therefore, when you write\n\nclass Foo(object): pass\n\nFoo will be the same type of class as object.\n\nIf no base classes are specified, the class statement checks for the existence of a global variable called __metaclass__. If this variable is found, it will be used to create classes. If you set this variable, it will control how classes are created when a simple class statement is used. Here’s an example:\n\n__metaclass__ = type class Foo: pass\n\nFinally, if no __metaclass__ value can be found anywhere, Python uses the default metaclass. In Python 2, this defaults to types.ClassType, which is known as an old- style class.This kind of class, deprecated since Python 2.2, corresponds to the original implementation of classes in Python.Although these classes are still supported, they should be avoided in new code and are not covered further here. In Python 3, the default metaclass is simply type().\n\nThe primary use of metaclasses is in frameworks that want to assert more control over the definition of user-defined objects.When a custom metaclass is defined, it typi- cally inherits from type() and reimplements methods such as __init__() or __new__(). Here is an example of a metaclass that forces all methods to have a documentation string:\n\nclass DocMeta(type):\n\ndef __init__(self,name,bases,dict): for key, value in dict.items():\n\n# Skip special and private methods if key.startswith(\"__\"): continue # Skip anything not callable if not hasattr(value,\"__call__\"): continue # Check for a doc-string if not getattr(value,\"__doc__\"):\n\nraise TypeError(\"%s must have a docstring\" % key)\n\ntype.__init__(self,name,bases,dict)\n\nIn this metaclass, the __init__() method has been written to inspect the contents of the class dictionary. It scans the dictionary looking for methods and checking to see whether they all have documentation strings. If not, a TypeError exception is generat- ed. Otherwise, the default implementation of type.__init__() is called to initialize the class.\n\nTo use this metaclass, a class needs to explicitly select it.The most common tech-\n\nnique for doing this is to first define a base class such as the following:\n\nclass Documented: # In Python 3, use the syntax\n\n__metaclass_ _ = DocMeta # class Documented(metaclass=DocMeta)\n\nF h Lib f L Bdff",
      "content_length": 2810,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 165,
      "content": "140\n\nChapter 7 Classes and Object-Oriented Programming\n\nThis base class is then used as the parent for all objects that are to be documented. For example:\n\nclass Foo(Documented): spam(self,a,b):\n\n\"spam does something\" pass\n\nThis example illustrates one of the major uses of metaclasses, which is that of inspecting and gathering information about class definitions.The metaclass isn’t changing anything about the class that actually gets created but is merely adding some additional checks. In more advanced metaclass applications, a metaclass can both inspect and alter the contents of a class definition prior to the creation of the class. If alterations are going to be made, you should redefine the __new__() method that runs prior to the creation of the class itself.This technique is commonly combined with techniques that wrap attrib- utes with descriptors or properties because it is one way to capture the names being used in the class.As an example, here is a modified version of the TypedProperty descriptor that was used in the “Descriptors” section:\n\nclass TypedProperty(object):\n\ndef __init__(self,type,default=None):\n\nself.name = None self.type = type if default: self.default = default else: self.default = type()\n\ndef __get__(self,instance,cls):\n\nreturn getattr(instance,self.name,self.default)\n\ndef __set__(self,instance,value):\n\nif not isinstance(value,self.type):\n\nraise TypeError(\"Must be a %s\" % self.type)\n\nsetattr(instance,self.name,value)\n\ndef __delete__(self,instance):\n\nraise AttributeError(\"Can't delete attribute\")\n\nIn this example, the name attribute of the descriptor is simply set to None.To fill this in, we’ll rely on a meta class. For example:\n\nclass TypedMeta(type):\n\ndef __new__(cls,name,bases,dict):\n\nslots = [] for key,value in dict.items():\n\nif isinstance(value,TypedProperty):\n\nvalue.name = \"_\" + key slots.append(value.name)\n\ndict['__slots__'] = slots return type.__new__(cls,name,bases,dict)\n\n# Base class for user-defined objects to use class Typed: # In Python 3, use the syntax\n\n__metaclass__ = TypedMeta # class Typed(metaclass=TypedMeta)\n\nIn this example, the metaclass scans the class dictionary and looks for instances of TypedProperty. If found, it sets the name attribute and builds a list of names in slots. After this is done, a __slots__ attribute is added to the class dictionary, and the class is constructed by calling the __new__() method of the type() metaclass. Here is an example of using this new metaclass:\n\nclass Foo(Typed):\n\nname = TypedProperty(str) num = TypedProperty(int,42)\n\nF h Lib f L Bdff",
      "content_length": 2562,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 166,
      "content": "Class Decorators\n\n141\n\nAlthough metaclasses make it possible to drastically alter the behavior and semantics of user-defined classes, you should probably resist the urge to use metaclasses in a way that makes classes work wildly different from what is described in the standard Python doc- umentation. Users will be confused if the classes they must write don’t adhere to any of the normal coding rules expected for classes.\n\nClass Decorators In the previous section, it was shown how the process of creating a class can be cus- tomized by defining a metaclass. However, sometimes all you want to do is perform some kind of extra processing after a class is defined, such as adding a class to a registry or database.An alternative approach for such problems is to use a class decorator.A class decorator is a function that takes a class as input and returns a class as output. For example:\n\nregistry = { } def register(cls):\n\nregistry[cls.__clsid__] = cls return cls\n\nIn this example, the register function looks inside a class for a __clsid__ attribute. If found, it’s used to add the class to a dictionary mapping class identifiers to class objects. To use this function, you can use it as a decorator right before the class definition. For example:\n\n@register class Foo(object):\n\n__clsid__ = \"123-456\" def bar(self):\n\npass\n\nHere, the use of the decorator syntax is mainly one of convenience.An alternative way to accomplish the same thing would have been this:\n\nclass Foo(object):\n\n__clsid__ = \"123-456\" def bar(self):\n\npass\n\nregister(Foo) # Register the class\n\nAlthough it’s possible to think of endless diabolical things one might do to a class in a class decorator function, it’s probably best to avoid excessive magic such as putting a wrapper around the class or rewriting the class contents.\n\nF h Lib f L Bdff",
      "content_length": 1818,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 167,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 168,
      "content": "8\n\nModules, Packages, and Distribution\n\nLarge Python programs are organized into modules and packages. In addition, a large\n\nnumber of modules are included in the Python standard library.This chapter describes the module and package system in more detail. In addition, it provides information on how to install third-party modules and distribute source code.\n\nModules and the import Statement Any Python source file can be used as a module. For example, consider the following code:\n\n# spam.py a = 37 def foo():\n\nprint(\"I'm foo and a is %s\" % a)\n\ndef bar():\n\nprint(\"I'm bar and I'm calling foo\") foo()\n\nclass Spam(object): def grok(self):\n\nprint(\"I'm Spam.grok\")\n\nTo load this code as a module, use the statement import spam.The first time import is used to load a module, it does three things:\n\n1. It creates a new namespace that serves as a container for all the objects defined in the corresponding source file.This is the namespace accessed when functions and methods defined within the module use the global statement.\n\n2. It executes the code contained in the module within the newly created name- space.\n\n3. It creates a name within the caller that refers to the module namespace.This name matches the name of the module and is used as follows:\n\nimport spam # Loads and executes the module 'spam' x = spam.a # Accesses a member of module 'spam' spam.foo() # Call a function in module 'spam' s = spam.Spam() # Create an instance of spam.Spam() s.grok() ...\n\nF h Lib f L Bdff",
      "content_length": 1480,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 169,
      "content": "144\n\nChapter 8 Modules, Packages, and Distribution\n\nIt is important to emphasize that import executes all of the statements in the loaded source file. If a module carries out a computation or produces output in addition to defining variables, functions, and classes, you will see the result.Also, a common confu- sion with modules concerns the access to classes. Keep in mind that if a file spam.py defines a class Spam, you must use the name spam.Spam to refer to the class.\n\nTo import multiple modules, you can supply import with a comma-separated list of\n\nmodule names, like this:\n\nimport socket, os, re\n\nThe name used to refer to a module can be changed using the as qualifier. Here’s an example:\n\nimport spam as sp import socket as net sp.foo() sp.bar() net.gethostname()\n\nWhen a module is loaded using a different name like this, the new name only applies to the source file or context where the import statement appeared. Other program mod- ules can still load the module using its original name.\n\nChanging the name of the imported module can be a useful tool for writing extensible code. For example, suppose you have two modules, xmlreader.py and csvreader.py, that both define a function read_data(filename) for reading some data from a file, but in different input formats.You can write code that selectively picks the reader module like this:\n\nif format == 'xml':\n\nimport xmlreader as reader\n\nelif format == 'csv':\n\nimport csvreader as reader data = reader.read_data(filename)\n\nModules are first class objects in Python.This means that they can be assigned to variables, placed in data structures such as a list, and passed around in a program as a data. For instance, the reader variable in the previous example simply refers to the cor- responding module object. Underneath the covers, a module object is a layer over a dic- tionary that is used to hold the contents of the module namespace.This dictionary is available as the __dict__ of a module, and whenever you look up or change a value in a module, you’re working with this dictionary.\n\nThe import statement can appear at any point in a program. However, the code in\n\neach module is loaded and executed only once, regardless of how often you use the import statement. Subsequent import statements simply bind the module name to the module object already created by the previous import.You can find a dictionary con- taining all currently loaded modules in the variable sys.modules.This dictionary maps module names to module objects.The contents of this dictionary are used to determine whether import loads a fresh copy of a module.\n\nF h Lib f L Bdff",
      "content_length": 2621,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 170,
      "content": "Importing Selected Symbols from a Module\n\n145\n\nImporting Selected Symbols from a Module The from statement is used to load specific definitions within a module into the cur- rent namespace.The from statement is identical to import except that instead of creat- ing a name referring to the newly created module namespace, it places references to one or more of the objects defined in the module into the current namespace:\n\nfrom spam import foo # Imports spam and puts 'foo' in current namespace foo() # Calls spam.foo() spam.foo() # NameError: spam\n\nThe from statement also accepts a comma-separated list of object names. For example:\n\nfrom spam import foo, bar\n\nIf you have a very long list of names to import, the names can be enclosed in parenthe- ses.This makes it easier to break the import statement across multiple lines. Here’s an example:\n\nfrom spam import (foo, bar, Spam)\n\nIn addition, the as qualifier can be used to rename specific objects imported with from. Here’s an example:\n\nfrom spam import Spam as Sp s = Sp()\n\nThe asterisk (*) wildcard character can also be used to load all the definitions in a mod- ule, except those that start with an underscore. Here’s an example:\n\nfrom spam import * # Load all definitions into current namespace\n\nThe from module import * statement may only be used at the top level of a mod- ule. In particular, it is illegal to use this form of import inside function bodies due to the way in which it interacts with function scoping rules (e.g., when functions are com- piled into internal bytecode, all of the symbols used within the function need to be fully specified).\n\nModules can more precisely control the set of names imported by from module\n\nimport * by defining the list __all__. Here’s an example:\n\n# module: spam.py __all__ = [ 'bar', 'Spam' ] # Names I will export with from spam import *\n\nImporting definitions with the from form of import does not change their scoping rules. For example, consider this code:\n\nfrom spam import foo a = 42 foo() # Prints \"I'm foo and a is 37\"\n\nIn this example, the definition of foo() in spam.py refers to a global variable a.When a reference to foo is placed into a different namespace, it doesn’t change the binding rules for variables within that function.Thus, the global namespace for a function is always the module in which the function was defined, not the namespace into which a function is imported and called.This also applies to function calls. For example, in the\n\nF h Lib f L Bdff",
      "content_length": 2487,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 171,
      "content": "146\n\nChapter 8 Modules, Packages, and Distribution\n\nfollowing code, the call to bar() results in a call to spam.foo(), not the redefined foo() that appears in the previous code example:\n\nfrom spam import bar def foo():\n\nprint(\"I'm a different foo\")\n\nbar() # When bar calls foo(), it calls spam.foo(), not\n\n# the definition of foo() above\n\nAnother common confusion with the from form of import concerns the behavior of global variables. For example, consider this code:\n\nfrom spam import a, foo # Import a global variable a = 42 # Modify the variable foo() # Prints \"I'm foo and a is 37\" print(a) # Prints \"42\"\n\nHere, it is important to understand that variable assignment in Python is not a storage operation.That is, the assignment to a in the earlier example is not storing a new value in a, overwriting the previous value. Instead, a new object containing the value 42 is created and the name a is made to refer to it.At this point, a is no longer bound to the value in the imported module but to some other object. Because of this behavior, it is not possible to use the from statement in a way that makes variables behave similarly as global variables or common blocks in languages such as C or Fortran. If you want to have mutable global program parameters in your program, put them in a module and use the module name explicitly using the import statement (that is, use spam.a explic- itly).\n\nExecution as the Main Program There are two ways in which a Python source file can execute.The import statement executes code in its own namespace as a library module. However, code might also exe- cute as the main program or script.This occurs when you supply the program as the script name to the interpreter:\n\n% python spam.py\n\nEach module defines a variable, __name__, that contains the module name. Programs can examine this variable to determine the module in which they’re executing.The top-level module of the interpreter is named __main__. Programs specified on the command line or entered interactively run inside the __main__ module. Sometimes a program may alter its behavior, depending on whether it has been imported as a mod- ule or is running in __main__. For example, a module may include some testing code that is executed if the module is used as the main program but which is not executed if the module is simply imported by another module.This can be done as follows:\n\n# Check if running as a program if __name__ == '__main__':\n\n# Yes statements\n\nelse:\n\n# No, I must have been imported as a module statements\n\nIt is common practice for source files intended for use as libraries to use this technique for including optional testing or example code. For example, if you’re developing a\n\nF h Lib f L Bdff",
      "content_length": 2723,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 172,
      "content": "Module Loading and Compilation\n\n147\n\nmodule, you can put code for testing the features of your library inside an if statement as shown and simply run Python on your module as the main program to run it.That code won’t run for users who import your library.\n\nThe Module Search Path When loading modules, the interpreter searches the list of directories in sys.path.The first entry in sys.path is typically an empty string '', which refers to the current working directory. Other entries in sys.path may consist of directory names, .zip archive files, and .egg files.The order in which entries are listed in sys.path deter- mines the search order used when modules are loaded.To add new entries to the search path, simply add them to this list.\n\nAlthough the path usually contains directory names, zip archive files containing Python modules can also be added to the search path.This can be a convenient way to package a collection of modules as a single file. For example, suppose you created two modules, foo.py and bar.py, and placed them in a zip file called mymodules.zip.The file could be added to the Python search path as follows:\n\nimport sys sys.path.append(\"mymodules.zip\") import foo, bar\n\nSpecific locations within the directory structure of a zip file can also be used. In addi- tion, zip files can be mixed with regular pathname components. Here’s an example:\n\nsys.path.append(\"/tmp/modules.zip/lib/python\")\n\nIn addition to .zip files, you can also add .egg files to the search path. .egg files are packages created by the setuptools library.This is a common format encountered when installing third-party Python libraries and extensions.An .egg file is actually just a .zip file with some extra metadata (e.g., version number, dependencies, etc.) added to it.Thus, you can examine and extract data from an .egg file using standard tools for working with .zip files.\n\nDespite support for zip file imports, there are some restrictions to be aware of. First,\n\nit is only possible import .py, .pyw, .pyc, and .pyo files from an archive. Shared libraries and extension modules written in C cannot be loaded directly from archives, although packaging systems such as setuptools are sometimes able to provide a workaround (typically by extracting C extensions to a temporary directory and loading modules from it). Moreover, Python will not create .pyc and .pyo files when .py files are loaded from an archive (described next).Thus, it is important to make sure these files are created in advance and placed in the archive in order to avoid poor perform- ance when loading modules.\n\nModule Loading and Compilation So far, this chapter has presented modules as files containing pure Python code. However, modules loaded with import really fall into four general categories:\n\nn Code written in Python (.py files) n C or C++ extensions that have been compiled into shared libraries or DLLs\n\nF h Lib f L Bdff",
      "content_length": 2910,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 173,
      "content": "148\n\nChapter 8 Modules, Packages, and Distribution\n\nn Packages containing a collection of modules n Built-in modules written in C and linked into the Python interpreter\n\nWhen looking for a module (for example, foo), the interpreter searches each of the directories in sys.path for the following files (listed in search order):\n\n1. A directory, foo, defining a package\n\n2. foo.pyd, foo.so, foomodule.so, or foomodule.dll (compiled extensions)\n\n3. foo.pyo (only if the -O or -OO option has been used)\n\n4. foo.pyc\n\n5. foo.py (on Windows, Python also checks for .pyw files.)\n\nPackages are described shortly; compiled extensions are described in Chapter 26, “Extending and Embedding Python.” For .py files, when a module is first imported, it’s compiled into bytecode and written back to disk as a .pyc file. On subsequent imports, the interpreter loads this precompiled bytecode unless the modification date of the .py file is more recent (in which case, the .pyc file is regenerated). .pyo files are used in conjunction with the interpreter’s -O option.These files contain bytecode stripped of line numbers, assertions, and other debugging information.As a result, they’re somewhat smaller and allow the interpreter to run slightly faster. If the -OO option is specified instead of -O, documentation strings are also stripped from the file.This removal of doc- umentation strings occurs only when .pyo files are created—not when they’re loaded. If none of these files exists in any of the directories in sys.path, the interpreter checks whether the name corresponds to a built-in module name. If no match exists, an ImportError exception is raised.\n\nThe automatic compilation of files into .pyc and .pyo files occurs only in conjunc-\n\ntion with the import statement. Programs specified on the command line or standard input don’t produce such files. In addition, these files aren’t created if the directory con- taining a module’s .py file doesn’t allow writing (e.g., either due to insufficient permis- sion or if it’s part of a zip archive).The -B option to the interpreter also disables the generation of these files.\n\nIf .pyc and .pyo files are available, it is not necessary for a corresponding .py file to exist.Thus, if you are packaging code and don’t wish to include source, you can merely bundle a set of .pyc files together. However, be aware that Python has extensive sup- port for introspection and disassembly. Knowledgeable users will still be able to inspect and find out a lot of details about your program even if the source hasn’t been provid- ed.Also, be aware that .pyc files tend to be version-specific.Thus, a .pyc file generated for one version of Python might not work in a future release.\n\nWhen import searches for files, it matches filenames in a case-sensitive manner—\n\neven on machines where the underlying file system is case-insensitive, such as on Windows and OS X (such systems are case-preserving, however).Therefore, import foo will only import the file foo.py and not the file FOO.PY. However, as a general rule, you should avoid the use of module names that differ in case only.\n\nF h Lib f L Bdff",
      "content_length": 3130,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 174,
      "content": "Packages\n\n149\n\nModule Reloading and Unloading Python provides no real support for reloading or unloading of previously imported modules.Although you can remove a module from sys.modules, this does not gener- ally unload a module from memory.This is because references to the module object may still exist in other program components that used import to load that module. Moreover, if there are instances of classes defined in the module, those instances contain references back to their class object, which in turn holds references to the module in which it was defined.\n\nThe fact that module references exist in many places makes it generally impractical\n\nto reload a module after making changes to its implementation. For example, if you remove a module from sys.modules and use import to reload it, this will not retroac- tively change all of the previous references to the module used in a program. Instead, you’ll have one reference to the new module created by the most recent import state- ment and a set of references to the old module created by imports in other parts of the code.This is rarely what you want and never safe to use in any kind of sane production code unless you are able to carefully control the entire execution environment.\n\nOlder versions of Python provided a reload() function for reloading a module. However, use of this function was never really safe (for all of the aforementioned rea- sons), and its use was actively discouraged except as a possible debugging aid. Python 3 removes this feature entirely. So, it’s best not to rely upon it.\n\nFinally, it should be noted that C/C++ extensions to Python cannot be safely unloaded or reloaded in any way. No support is provided for this, and the underlying operating system may prohibit it anyways.Thus, your only recourse is to restart the Python interpreter process.\n\nPackages Packages allow a collection of modules to be grouped under a common package name. This technique helps resolve namespace conflicts between module names used in differ- ent applications.A package is defined by creating a directory with the same name as the package and creating the file __init__.py in that directory.You can then place addi- tional source files, compiled extensions, and subpackages in this directory, as needed. For example, a package might be organized as follows:\n\nGraphics/\n\n__init__.py Primitive/\n\n__init__.py lines.py fill.py text.py ... Graph2d/\n\n__init__.py plot2d.py ... Graph3d/\n\n__init__.py plot3d.py ... Formats/\n\n__init__.py gif.py\n\nF h Lib f L Bdff",
      "content_length": 2537,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 175,
      "content": "150\n\nChapter 8 Modules, Packages, and Distribution\n\npng.py tiff.py jpeg.py\n\nThe import statement is used to load modules from a package in a number of ways:\n\nn import Graphics.Primitive.fill\n\nThis loads the submodule Graphics.Primitive.fill.The contents of this module have to be explicitly named, such as Graphics.Primitive.fill.floodfill(img,x,y,color).\n\nn from Graphics.Primitive import fill\n\nThis loads the submodule fill but makes it available without the package prefix; for example, fill.floodfill(img,x,y,color).\n\nn from Graphics.Primitive.fill import floodfill\n\nThis loads the submodule fill but makes the floodfill function directly accessible; for example, floodfill(img,x,y,color).\n\nWhenever any part of a package is first imported, the code in the file __init__.py is executed. Minimally, this file may be empty, but it can also contain code to perform package-specific initializations.All the __init__.py files encountered during an import are executed.Therefore, the statement import Graphics.Primitive.fill, shown earlier, would first execute the __init__.py file in the Graphics directory and then the __init__.py file in the Primitive directory.\n\nOne peculiar problem with packages is the handling of this statement:\n\nfrom Graphics.Primitive import *\n\nA programmer who uses this statement usually wants to import all the submodules asso- ciated with a package into the current namespace. However, because filename conven- tions vary from system to system (especially with regard to case sensitivity), Python cannot accurately determine what modules those might be.As a result, this statement just imports all the names that are defined in the __init__.py file in the Primitive directory.This behavior can be modified by defining a list, __all__, that contains all the module names associated with the package.This list should be defined in the pack- age __init__.py file, like this:\n\n# Graphics/Primitive/__init__.py __all__ = [\"lines\",\"text\",\"fill\"]\n\nNow when the user issues a from Graphics.Primitive import * statement, all the listed submodules are loaded as expected.\n\nAnother subtle problem with packages concerns submodules that want to import other submodules within the same package. For example, suppose the Graphics.Primitive.fill module wants to import the Graphics.Primitive.lines module.To do this, you can simply use the fully specified named (e.g., from Graphics.Primitives import lines) or use a package relative import like this:\n\n# fill.py from . import lines\n\nIn this example, the . used in the statement from . import lines refers to the same directory of the calling module.Thus, this statement looks for a module lines in the\n\nF h Lib f L Bdff",
      "content_length": 2684,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 176,
      "content": "Packages\n\n151\n\nsame directory as the file fill.py. Great care should be taken to avoid using a state- ment such as import moduleto import a package submodule. In older versions of Python, it was unclear whether the import modulestatement was referring to a stan- dard library module or a submodule of a package. Older versions of Python would first try to load the module from the same package directory as the submodule where the import statement appeared and then move on to standard library modules if no match was found. However, in Python 3, import assumes an absolute path and will simply try to load modulefrom the standard library.A relative import more clearly states your intentions.\n\nRelative imports can also be used to load submodules contained in different directo-\n\nries of the same package. For example, if the module Graphics.Graph2D.plot2d wanted to import Graphics.Primitives.lines, it could use a statement like this:\n\n# plot2d.py from ..Primitives import lines\n\nHere, the .. moves out one directory level and Primitives drops down into a differ- ent package directory.\n\nRelative imports can only be specified using the from module import symbol form of the import statement.Thus, statements such as import ..Primitives.lines or import .lines are a syntax error.Also, symbolhas to be a valid identifier. So, a statement such as from .. import Primitives.lines is also illegal. Finally, relative imports can only be used within a package; it is illegal to use a relative import to refer to modules that are simply located in a different directory on the filesystem.\n\nImporting a package name alone doesn’t import all the submodules contained in the\n\npackage. For example, the following code doesn’t work:\n\nimport Graphics Graphics.Primitive.fill.floodfill(img,x,y,color) # Fails!\n\nHowever, because the import Graphics statement executes the __init__.py file in the Graphics directory, relative imports can be used to load all the submodules auto- matically, as follows:\n\n# Graphics/__init__.py from . import Primitive, Graph2d, Graph3d\n\n# Graphics/Primitive/__init__.py from . import lines, fill, text, ...\n\nNow the import Graphics statement imports all the submodules and makes them available using their fully qualified names.Again, it is important to stress that a package relative import should be used as shown. If you use a simple statement such as import module, standard library modules may be loaded instead.\n\nFinally, when Python imports a package, it defines a special variable, __path__, which contains a list of directories that are searched when looking for package submod- ules (__path__ is a package-specific version of the sys.path variable). __path__ is accessible to the code contained in __init__.py files and initially contains a single item with the directory name of the package. If necessary, a package can supply additional directories to the __path__ list to alter the search path used for finding submodules. This might be useful if the organization of a package on the file system is complicated and doesn’t neatly match up with the package hierarchy.\n\nF h Lib f L Bdff",
      "content_length": 3116,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 177,
      "content": "152\n\nChapter 8 Modules, Packages, and Distribution\n\nDistributing Python Programs and Libraries To distribute Python programs to others, you should use the distutils module.As preparation, you should first cleanly organize your work into a directory that has a README file, supporting documentation, and your source code.Typically, this directory will contain a mix of library modules, packages, and scripts. Modules and packages refer to source files that will be loaded with import statements. Scripts are programs that will run as the main program to the interpreter (e.g., running as python scriptname). Here is an example of a directory containing Python code:\n\nspam/\n\nREADME.txt Documentation.txt libspam.py # A single library module spampkg/ # A package of support modules\n\n__init__.py foo.py bar.py\n\nrunspam.py # A script to run as: python runspam.py\n\nYou should organize your code so that it works normally when running the Python interpreter in the top-level directory. For example, if you start Python in the spam directory, you should be able to import modules, import package components, and run scripts without having to alter any of Python’s settings such as the module search path. After you have organized your code, create a file setup.py in the top most directo-\n\nry (spam in the previous examples). In this file, put the following code:\n\n# setup.py from distutils.core import setup\n\nsetup(name = \"spam\",\n\nversion = \"1.0\", py_modules = ['libspam'], packages = ['spampkg'], scripts = ['runspam.py'], )\n\nIn the setup() call, the py_modules argument is a list of all of the single-file Python modules, packages is a list of all package directories, and scripts is a list of script files.Any of these arguments may be omitted if your software does not have any match- ing components (i.e., there are no scripts). name is the name of your package, and version is the version number as a string.\n\nThe call to setup() supports a variety of other parameters that supply various\n\nmetadata about your package.Table 8.1 shows the most common parameters that can be specified.All values are strings except for the classifiers parameter, which is a list of strings such as ['Development Status :: 4 - Beta', 'Programming Language :: Python'] (a full list can be found at http://pypi.python.org).\n\nTable 8.1 Parameters to setup()\n\nParameter\n\nDescription\n\nname\n\nversion\n\nauthor\n\nauthor_email\n\nName of the package (required) Version number (required) Author’s name Author’s email address\n\nF h Lib f L Bdff",
      "content_length": 2507,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 178,
      "content": "Distributing Python Programs and Libraries\n\n153\n\nTable 8.1\n\nContinued\n\nParameter\n\nDescription\n\nmaintainer\n\nmaintainer_email\n\nurl\n\ndescription\n\nlong_description\n\ndownload_url\n\nclassifiers\n\nMaintainer’s name Maintainer’s email Home page for the package Short description of the package Long description of the package Location where package can be downloaded List of string classifiers\n\nCreating a setup.py file is enough to create a source distribution of your software. Type the following shell command to make a source distribution:\n\n% python setup.py sdist ... %\n\nThis creates an archive file such as spam-1.0.tar.gz or spam-1.0.zip in the directo- ry spam/dist.This is the file you would give to others to install your software.To install, a user simply unpacks the archive and performs these steps:\n\n% unzip spam-1.0.zip ... % cd spam-1.0 % python setup.py install ... %\n\nThis installs the software into the local Python distribution and makes it available for general use. Modules and packages are normally installed into a directory called \"site-packages\" in the Python library.To find the exact location of this directory, inspect the value of sys.path. Scripts are normally installed into the same directory as the Python interpreter on UNIX-based systems or into a \"Scripts\" directory on Windows (found in \"C:\\Python26\\Scripts\" in a typical installation).\n\nOn UNIX, if the first line of a script starts with #! and contains the text \"python\", the installer will rewrite the line to point to the local installation of Python.Thus, if you have written scripts that have been hard-coded to a specific Python location such as /usr/local/bin/python, they should still work when installed on other systems where Python is in a different location.\n\nThe setup.py file has a number of other commands concerning the distribution of\n\nsoftware. If you type 'python setup.py bdist', a binary distribution is created in which all of the .py files have already been precompiled into .pyc files and placed into a directory structure that mimics that of the local platform.This kind of distribution is needed only if parts of your application have platform dependencies (for example, if you also have C extensions that need to be compiled). If you run 'python setup.py bdist_wininst' on a Windows machine, an .exe file will be created.When opened, a Windows installer dialog will start, prompting the user for information about where the software should be installed.This kind of distribution also adds entries to the registry, making it easy to uninstall your package at a later date.\n\nThe distutils module assumes that users already have a Python installation on their machine (downloaded separately).Although it is possible to create software pack- ages where the Python runtime and your software are bundled together into a single\n\nF h Lib f L Bdff",
      "content_length": 2844,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 179,
      "content": "154\n\nChapter 8 Modules, Packages, and Distribution\n\nbinary executable, that is beyond the scope of what can be covered here (look at a third-party module such as py2exe or py2app for further details). If all you are doing is distributing libraries or simple scripts to people, it is usually unnecessary to package your code with the Python interpreter and runtime as well.\n\nFinally, it should be noted that there are many more options to distutils than those covered here. Chapter 26 describes how distutils can be used to compile C and C++ extensions.\n\nAlthough not part of the standard Python distribution, Python software is often dis- tributed in the form of an .egg file.This format is created by the popular setuptools extension (http://pypi.python.org/pypi/setuptools).To support setuptools, you can simply change the first part of your setup.py file as follows:\n\n# setup.py try:\n\nfrom setuptools import setup\n\nexcept ImportError:\n\nfrom distutils.core import setup\n\nsetup(name = \"spam\",\n\n...\n\n)\n\nInstalling Third-Party Libraries The definitive resource for locating third-party libraries and extensions to Python is the Python Package Index (PyPI), which is located at http://pypi.python.org. Installing third- party modules is usually straightforward but can become quite involved for very large packages that also depend on other third-party modules. For the more major exten- sions, you will often find a platform-native installer that simply steps you through the process using a series of dialog screens. For other modules, you typically unpack the download, look for the setup.py file, and type python setup.py install to install the software.\n\nBy default, third-party modules are installed in the site-packages directory of the Python standard library.Access to this directory typically requires root or administrator access. If this is not the case, you can type python setup.py install --user to have the module installed in a per-user library directory.This installs the package in a per-user directory such as \"/Users/beazley/.local/lib/python2.6/site-pack- ages\" on UNIX.\n\nIf you want to install the software somewhere else entirely, use the --prefix option\n\nto setup.py. For example, typing python setup.py install --prefix=/home/ beazley/pypackages installs a module under the directory /home/beazley/ pypackages.When installing in a nonstandard location, you will probably have to adjust the setting of sys.path in order for Python to locate your newly installed modules.\n\nBe aware that many extensions to Python involve C or C++ code. If you have downloaded a source distribution, your system will have to have a C++ compiler installed in order to run the installer. On UNIX, Linux, and OS X, this is usually not an issue. On Windows, it has traditionally been necessary to have a version of Microsoft Visual Studio installed. If you’re working on that platform, you’re probably better off looking for a precompiled version of your extension.\n\nF h Lib f L Bdff",
      "content_length": 2983,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 180,
      "content": "Installing Third-Party Libraries\n\n155\n\nIf you have installed setuptools, a script easy_install is available to install pack-\n\nages. Simply type easy_install pkgnameto install a specific package. If configured correctly, this will download the appropriate software from PyPI along with any dependencies and install it for you. Of course, your mileage might vary.\n\nIf you would like to add your own software to PyPI, simply type python setup.py\n\nregister.This will upload metadata about the latest version of your software to the index (note that you will have to register a username and password first).\n\nF h Lib f L Bdff",
      "content_length": 620,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 181,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 182,
      "content": "9\n\nInput and Output\n\nThis chapter describes the basics of Python input and output (I/O), including\n\ncommand-line options, environment variables, file I/O, Unicode, and how to serialize objects using the pickle module.\n\nReading Command-Line Options When Python starts, command-line options are placed in the list sys.argv.The first element is the name of the program. Subsequent items are the options presented on the command line after the program name.The following program shows a minimal proto- type of manually processing simple command-line arguments:\n\nimport sys if len(sys.argv) != 3:\n\nsys.stderr.write(\"Usage : python %s inputfile outputfile\\n\" % sys.argv[0]) raise SystemExit(1)\n\ninputfile = sys.argv[1] outputfile = sys.argv[2]\n\nIn this program, sys.argv[0] contains the name of the script being executed.Writing an error message to sys.stderr and raising SystemExit with a non-zero exit code as shown is standard practice for reporting usage errors in command-line tools.\n\nAlthough you can manually process command options for simple scripts, use the optparse module for more complicated command-line handling. Here is a simple example:\n\nimport optparse p = optparse.OptionParser()\n\n# An option taking an argument p.add_option(\"-o\",action=\"store\",dest=\"outfile\") p.add_option(\"--output\",action=\"store\",dest=\"outfile\")\n\n# An option that sets a boolean flag p.add_option(\"-d\",action=\"store_true\",dest=\"debug\") p.add_option(\"--debug\",action=\"store_true\",dest=\"debug\")\n\n# Set default values for selected options p.set_defaults(debug=False)\n\n# Parse the command line opts, args = p.parse_args()\n\n# Retrieve the option settings outfile = opts.outfile debugmode = opts.debug\n\nF h Lib f L Bdff",
      "content_length": 1696,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 183,
      "content": "158\n\nChapter 9 Input and Output\n\nIn this example, two types of options are added.The first option, -o or --output, has a required argument.This behavior is selected by specifying action='store' in the call to p.add_option().The second option, -d or --debug, is merely setting a Boolean flag.This is enabled by specifying action='store_true' in p.add_option().The dest argument to p.add_option() selects an attribute name where the argument value will be stored after parsing.The p.set_defaults() method sets default values for one or more of the options.The argument names used with this method should match the destination names selected for each option. If no default value is selected, the default value is set to None.\n\nThe previous program recognizes all of the following command-line styles:\n\n% python prog.py -o outfile -d infile1 ... infileN % python prog.py --output=outfile --debug infile1 ... infileN % python prog.py -h % python prog.py --help\n\nParsing is performed using the p.parse_args() method.This method returns a 2-tuple (opts, args) where opts is an object containing the parsed option values and args is a list of items on the command line not parsed as options. Option values are retrieved using opts.destwhere destis the destination name used when adding an option. For example, the argument to the -o or --output argument is placed in opts.outfile, whereas args is a list of the remaining arguments such as ['infile1', ..., 'infileN'].The optparse module automatically provides a -h or --help option that lists the available options if requested by the user. Bad options also result in an error message.\n\nThis example only shows the simplest use of the optparse module. Further details on some of the more advanced options can be found in Chapter 19,“Operating System Services.”\n\nEnvironment Variables Environment variables are accessed in the dictionary os.environ. Here’s an example:\n\nimport os path = os.environ[\"PATH\"] user = os.environ[\"USER\"] editor = os.environ[\"EDITOR\"] ... etc ...\n\nTo modify the environment variables, set the os.environ variable. For example:\n\nos.environ[\"FOO\"] = \"BAR\"\n\nModifications to os.environ affect both the running program and subprocesses created by Python.\n\nFiles and File Objects The built-in function open(name [,mode [,bufsize]]) opens and creates a file object, as shown here:\n\nf = open(\"foo\") # Opens \"foo\" for reading f = open(\"foo\",'r') # Opens \"foo\" for reading (same as above) f = open(\"foo\",'w') # Open for writing\n\nF h Lib f L Bdff",
      "content_length": 2504,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 184,
      "content": "Files and File Objects\n\n159\n\nThe file mode is 'r' for read, 'w' for write, or 'a' for append.These file modes assume text-mode and may implicitly perform translation of the newline character '\\n'. For example, on Windows, writing the character '\\n' actually outputs the two- character sequence '\\r\\n' (and when reading the file back, '\\r\\n' is translated back into a single '\\n' character). If you are working with binary data, append a 'b' to the file mode such as 'rb' or 'wb'.This disables newline translation and should be includ- ed if you are concerned about portability of code that processes binary data (on UNIX, it is a common mistake to omit the 'b' because there is no distinction between text and binary files).Also, because of the distinction in modes, you might see text-mode specified as 'rt', 'wt', or 'at', which more clearly expresses your intent.\n\nA file can be opened for in-place updates by supplying a plus (+) character, such as 'r+' or 'w+'.When a file is opened for update, you can perform both input and out- put, as long as all output operations flush their data before any subsequent input opera- tions. If a file is opened using 'w+' mode, its length is first truncated to zero.\n\nIf a file is opened with mode 'U' or 'rU', it provides universal newline support for\n\nreading.This feature simplifies cross-platform work by translating different newline encodings (such as '\\n', '\\r', and '\\r\\n') to a standard '\\n' character in the strings returned by various file I/O functions.This can be useful if, for example, you are writ- ing scripts on UNIX systems that must process text files generated by programs on Windows.\n\nThe optional bufsizeparameter controls the buffering behavior of the file, where 0 is unbuffered, 1 is line buffered, and a negative number requests the system default.Any other positive number indicates the approximate buffer size in bytes that will be used.\n\nPython 3 adds four additional parameters to the open() function, which is called as\n\nopen(name [,mode [,bufsize [, encoding [, errors [, newline [, closefd]]]]]]). encodingis an encoding name such as 'utf-8' or 'ascii'. errorsis the error-handling policy to use for encoding errors (see the later sections in this chapter on Unicode for more information). newlinecontrols the behavior of uni- versal newline mode and is set to None, '', '\\n', '\\r', or '\\r\\n'. If set to None, any line ending of the form '\\n', '\\r', or '\\r\\n' is translated into '\\n'. If set to '' (the empty string), any of these line endings are recognized as newlines, but left untranslated in the input text. If newlinehas any other legal value, that value is what is used to ter- minate lines. closefdcontrols whether the underlying file descriptor is actually closed when the close() method is invoked. By default, this is set to True.\n\nTable 9.1 shows the methods supported by file objects.\n\nTable 9.1\n\nFile Methods\n\nMethod\n\nDescription\n\nf.read([n])\n\nf.readline([n])\n\nf.readlines([size])\n\nf.write(s)\n\nf.writelines(lines)\n\nReads at most nbytes. Reads a single line of input up to ncharacters. If nis omitted, this method reads the entire line. Reads all the lines and returns a list. sizeoptionally specifies the approximate number of characters to read on the file before stopping. Writes string s. Writes all strings in sequence lines. Closes the file.\n\nf.close()\n\nF h Lib f L Bdff",
      "content_length": 3365,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 185,
      "content": "160\n\nChapter 9 Input and Output\n\nTable 9.1\n\nContinued\n\nMethod\n\nDescription\n\nf.tell() f.seek(offset [, whence]) Seeks to a new file position. f.isatty()\n\nReturns the current file pointer.\n\nReturns 1 if fis an interactive terminal. Flushes the output buffers. Truncates the file to at most sizebytes. Returns an integer file descriptor. Returns the next line or raises StopIteration. In Python 3, it is called f.__next__().\n\nf.flush()\n\nf.truncate([size])\n\nf.fileno()\n\nf.next()\n\nThe read() method returns the entire file as a string unless an optional lengthparam- eter is given specifying the maximum number of characters.The readline() method returns the next line of input, including the terminating newline; the readlines() method returns all the input lines as a list of strings.The readline() method optional- ly accepts a maximum line length, n. If a line longer than ncharacters is read, the first n characters are returned.The remaining line data is not discarded and will be returned on subsequent read operations.The readlines() method accepts a size parameter that specifies the approximate number of characters to read before stopping.The actual number of characters read may be larger than this depending on how much data has been buffered.\n\nBoth the readline() and readlines() methods are platform-aware and handle different representations of newlines properly (for example, '\\n' versus '\\r\\n'). If the file is opened in universal newline mode ('U' or 'rU'), newlines are converted to '\\n'.\n\nread() and readline() indicate end-of-file (EOF) by returning an empty string.\n\nThus, the following code shows how you can detect an EOF condition:\n\nwhile True:\n\nline = f.readline() if not line: # EOF\n\nbreak\n\nA convenient way to read all lines in a file is to use iteration with a for loop. For example:\n\nfor line in f: # Iterate over all lines in the file\n\n# Do something with line ...\n\nBe aware that in Python 2, the various read operations always return 8-bit strings, regardless of the file mode that was specified (text or binary). In Python 3, these opera- tions return Unicode strings if a file has been opened in text mode and byte strings if the file is opened in binary mode.\n\nThe write() method writes a string to the file, and the writelines() method\n\nwrites a list of strings to the file. write() and writelines() do not add newline characters to the output, so all output that you produce should already include all nec- essary formatting.These methods can write raw-byte strings to a file, but only if the file has been opened in binary mode.\n\nF h Lib f L Bdff",
      "content_length": 2580,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 186,
      "content": "Standard Input, Output, and Error\n\n161\n\nInternally, each file object keeps a file pointer that stores the byte offset at which the next read or write operation will occur.The tell() method returns the current value of the file pointer as a long integer.The seek() method is used to randomly access parts of a file given an offsetand a placement rule in whence. If whenceis 0 (the default), seek() assumes that offsetis relative to the start of the file; if whenceis 1, the position is moved relative to the current position; and if whenceis 2, the offset is taken from the end of the file. seek() returns the new value of the file pointer as an integer. It should be noted that the file pointer is associated with the file object returned by open() and not the file itself.The same file can be opened more than once in the same program (or in different programs). Each instance of the open file has its own file pointer that can be manipulated independently.\n\nThe fileno() method returns the integer file descriptor for a file and is sometimes\n\nused in low-level I/O operations in certain library modules. For example, the fcntl module uses the file descriptor to provide low-level file control operations on UNIX systems.\n\nFile objects also have the read-only data attributes shown in Table 9.2.\n\nTable 9.2\n\nFile Object Attributes\n\nAttribute\n\nDescription\n\nf.closed\n\nf.mode\n\nf.name\n\nf.softspace\n\nf.newlines\n\nf.encoding\n\nBoolean value indicates the file state: False if the file is open, True if closed. The I/O mode for the file. Name of the file if created using open(). Otherwise, it will be a string indicating the source of the file. Boolean value indicating whether a space character needs to be print- ed before another value when using the print statement. Classes that emulate files must provide a writable attribute of this name that’s initially initialized to zero (Python 2 only). When a file is opened in universal newline mode, this attribute con- tains the newline representation actually found in the file. The value is None if no newlines have been encountered, a string containing '\\n', '\\r', or '\\r\\n', or a tuple containing all the different newline encod- ings seen. A string that indicates file encoding, if any (for example, 'latin-1' or 'utf-8'). The value is None if no encoding is being used.\n\nStandard Input, Output, and Error The interpreter provides three standard file objects, known as standard input, standard out- put, and standard error, which are available in the sys module as sys.stdin, sys.stdout, and sys.stderr, respectively. stdin is a file object corresponding to the stream of input characters supplied to the interpreter. stdout is the file object that receives output produced by print. stderr is a file that receives error messages. More often than not, stdin is mapped to the user’s keyboard, whereas stdout and stderr produce text onscreen.\n\nF h Lib f L Bdff",
      "content_length": 2905,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 187,
      "content": "162\n\nChapter 9 Input and Output\n\nThe methods described in the preceding section can be used to perform raw I/O with the user. For example, the following code writes to standard output and reads a line of input from standard input:\n\nimport sys sys.stdout.write(\"Enter your name : \") name = sys.stdin.readline()\n\nAlternatively, the built-in function raw_input(prompt) can read a line of text from stdin and optionally print a prompt:\n\nname = raw_input(\"Enter your name : \")\n\nLines read by raw_input() do not include the trailing newline.This is different than reading directly from sys.stdin where newlines are included in the input text. In Python 3, raw_input() has been renamed to input().\n\nKeyboard interrupts (typically generated by Ctrl+C) result in a\n\nKeyboardInterrupt exception that can be caught using an exception handler. If necessary, the values of sys.stdout, sys.stdin, and sys.stderr can be\n\nreplaced with other file objects, in which case the print statement and input functions use the new values. Should it ever be necessary to restore the original value of sys.stdout, it should be saved first.The original values of sys.stdout, sys.stdin, and sys.stderr at interpreter startup are also available in sys.__stdout__, sys.__stdin__, and sys.__stderr__, respectively.\n\nNote that in some cases sys.stdin, sys.stdout, and sys.stderr may be altered\n\nby the use of an integrated development environment (IDE). For example, when Python is run under IDLE, sys.stdin is replaced with an object that behaves like a file but is really an object in the development environment. In this case, certain low- level methods, such as read() and seek(), may be unavailable.\n\nThe print Statement Python 2 uses a special print statement to produce output on the file contained in sys.stdout. print accepts a comma-separated list of objects such as the following:\n\nprint \"The values are\", x, y, z\n\nFor each object, the str() function is invoked to produce an output string.These out- put strings are then joined and separated by a single space to produce the final output string.The output is terminated by a newline unless a trailing comma is supplied to the print statement. In this case, the next print statement will insert a space before print- ing more items.The output of this space is controlled by the softspace attribute of the file being used for output.\n\nprint \"The values are \", x, y, z, w # Print the same text, using two print statements print \"The values are \", x, y, # Omits trailing newline print z, w # A space is printed before z\n\nTo produce formatted output, use the string-formatting operator (%) or the .format() method as described in Chapter 4,“Operators and Expressions.” Here’s an example:\n\nprint \"The values are %d %7.5f %s\" % (x,y,z) # Formatted I/O print \"The values are {0:d} {1:7.5f} {2}\".format(x,y,z)\n\nF h Lib f L Bdff",
      "content_length": 2847,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 188,
      "content": "Variable Interpolation in Text Output\n\n163\n\nYou can change the destination of the print statement by adding the special >>file modifier followed by a comma, where fileis a file object that allows writes. Here’s an example:\n\nf = open(\"output\",\"w\") print >>f, \"hello world\" ... f.close()\n\nThe print() Function One of the most significant changes in Python 3 is that print is turned into a func- tion. In Python 2.6, it is also possible to use print as a function if you include the statement from __future__ import print_function in each module where used. The print() function works almost exactly the same as the print statement described in the previous section.\n\nTo print a series of values separated by spaces, just supply them all to print() like\n\nthis:\n\nprint(\"The values are\", x, y, z)\n\nTo suppress or change the line ending, use the end=endingkeyword argument. For example:\n\nprint(\"The values are\", x, y, z, end='') # Suppress the newline\n\nTo redirect the output to a file, use the file=outfilekeyword argument. For example:\n\nprint(\"The values are\", x, y, z, file=f) # Redirect to file object f\n\nTo change the separator character between items, use the sep=sepchrkeyword argu- ment. For example:\n\nprint(\"The values are\", x, y, z, sep=',') # Put commas between the values\n\nVariable Interpolation in Text Output A common problem when generating output is that of producing large text fragments containing embedded variable substitutions. Many scripting languages such as Perl and PHP allow variables to be inserted into strings using dollar-variable substitutions (that is, $name, $address, and so on). Python provides no direct equivalent of this feature, but it can be emulated using formatted I/O combined with triple-quoted strings. For example, you could write a short form letter, filling in a name, an item name, and an amount, as shown in the following example:\n\n# Note: trailing slash right after \"\"\" prevents # a blank line from appearing as the first line form = \"\"\"\\ Dear %(name)s,\n\nF h Lib f L Bdff",
      "content_length": 2016,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 189,
      "content": "164\n\nChapter 9 Input and Output\n\nPlease send back my %(item)s or pay me $%(amount)0.2f.\n\nSincerely yours,\n\nJoe Python User\n\n\"\"\" print form % { 'name': 'Mr. Bush',\n\n'item': 'blender', 'amount': 50.00,\n\n}\n\nThis produces the following output:\n\nDear Mr. Bush,\n\nPlease send back my blender or pay me $50.00.\n\nSincerely yours,\n\nJoe Python User\n\nThe format() method is a more modern alternative that cleans up some of the previ- ous code. For example:\n\nform = \"\"\"\\ Dear {name}, Please send back my {item} or pay me {amount:0.2f}.\n\nSincerely yours,\n\nJoe Python User\n\n\"\"\" print form.format(name='Mr. Bush', item='blender', amount=50.0)\n\nFor certain kinds of forms, you can also use Template strings, as follows:\n\nimport string form = string.Template(\"\"\"\\ Dear $name, Please send back my $item or pay me $amount.\n\nSincerely yours,\n\nJoe Python User\n\n\"\"\") print form.substitute({'name': 'Mr. Bush',\n\n'item': 'blender', 'amount': \"%0.2f\" % 50.0})\n\nIn this case, special $ variables in the string indicate substitutions.The form.substitute() method takes a dictionary of replacements and returns a new string.Although the previous approaches are simple, they aren’t always the most power- ful solutions to text generation.Web frameworks and other large application frameworks tend to provide their own template string engines that support embedded control-flow, variable substitutions, file inclusion, and other advanced features.\n\nGenerating Output Working directly with files is the I/O model most familiar to programmers. However, generator functions can also be used to emit an I/O stream as a sequence of data frag- ments.To do this, simply use the yield statement like you would use a write() or print statement. Here is an example:\n\nF h Lib f L Bdff",
      "content_length": 1742,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 190,
      "content": "Unicode String Handling\n\n165\n\ndef countdown(n):\n\nwhile n > 0:\n\nyield \"T-minus %d\\n\" % n n -= 1 yield \"Kaboom!\\n\"\n\nProducing an output stream in this manner provides great flexibility because the pro- duction of the output stream is decoupled from the code that actually directs the stream to its intended destination. For example, if you wanted to route the above output to a file f, you could do this:\n\ncount = countdown(5) f.writelines(count)\n\nIf, instead, you wanted to redirect the output across a socket s, you could do this:\n\nfor chunk in count:\n\ns.sendall(chunk)\n\nOr, if you simply wanted to capture all of the output in a string, you could do this:\n\nout = \"\".join(count)\n\nMore advanced applications can use this approach to implement their own I/O buffer- ing. For example, a generator could be emitting small text fragments, but another func- tion could be collecting the fragments into large buffers to create a larger, more efficient I/O operation:\n\nchunks = [] buffered_size = 0 for chunk in count:\n\nchunks.append(chunk) buffered_size += len(chunk) if buffered_size >= MAXBUFFERSIZE:\n\noutf.write(\"\".join(chunks)) chunks.clear() buffered_size = 0 outf.write(\"\".join(chunks)\n\nFor programs that are routing output to files or network connections, a generator approach can also result in a significant reduction in memory use because the entire output stream can often be generated and processed in small fragments as opposed to being first collected into one large output string or list of strings.This approach to out- put is sometimes seen when writing programs that interact with the Python Web Services Gateway Interface (WSGI) that’s used to communicate between components in certain web frameworks.\n\nUnicode String Handling A common problem associated with I/O handling is that of dealing with international characters represented as Unicode. If you have a string sof raw bytes containing an encoded representation of a Unicode string, use the s.decode([encoding [,errors]]) method to convert it into a proper Unicode string.To convert a Unicode string, u, to an encoded byte string, use the string method u.encode([encoding [, errors]]). Both of these conversion operators require the use of a special encoding name that specifies how Unicode character values are mapped to a sequence of 8-bit characters in byte strings, and vice versa.The encoding parameter is specified as a string\n\nF h Lib f L Bdff",
      "content_length": 2418,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 191,
      "content": "166\n\nChapter 9 Input and Output\n\nand is one of more than a hundred different character encodings.The following values, however, are most common:\n\nValue 'ascii' 'latin-1' or 'iso-8859-1' 'cp1252'\n\n'utf-8'\n\n'utf-16'\n\n'utf-16-le'\n\n'utf-16-be' 'unicode-escape'\n\nDescription 7-bit ASCII ISO 8859-1 Latin-1 Windows 1252 encoding 8-bit variable-length encoding 16-bit variable-length encoding (may be little or big endian) UTF-16, little endian encoding UTF-16, big endian encoding Same format as Unicode literals u\"string\" Same format as raw Unicode literals ur\"string\"\n\n'raw-unicode-escape'\n\nThe default encoding is set in the site module and can be queried using sys.getdefaultencoding(). In many cases, the default encoding is 'ascii', which means that ASCII characters with values in the range [0x00,0x7f] are directly mapped to Unicode characters in the range [U+0000, U+007F]. However, 'utf-8' is also a very common setting.Technical details concerning common encodings appears in a later section.\n\nWhen using the s.decode() method, it is always assumed that sis a string of bytes. In Python 2, this means that sis a standard string, but in Python 3, smust be a special bytes type. Similarly, the result of t.encode() is always a byte sequence. One caution if you care about portability is that these methods are a little muddled in Python 2. For instance, Python 2 strings have both decode() and encode() methods, whereas in Python 3, strings only have an encode() method and the bytes type only has a decode() method.To simplify code in Python 2, make sure you only use encode() on Unicode strings and decode() on byte strings.\n\nWhen string values are being converted, a UnicodeError exception might be raised\n\nif a character that can’t be converted is encountered. For instance, if you are trying to encode a string into 'ascii' and it contains a Unicode character such as U+1F28, you will get an encoding error because this character value is too large to be represented in the ASCII character set.The errors parameter of the encode() and decode() meth- ods determines how encoding errors are handled. It’s a string with one of the following values:\n\nValue 'strict'\n\n'ignore'\n\n'replace'\n\n'backslashreplace'\n\nDescription Raises a UnicodeError exception for encoding and decod- ing errors. Ignores invalid characters. Replaces invalid characters with a replacement character (U+FFFD in Unicode, '?' in standard strings). Replaces invalid characters with a Python character escape sequence. For example, the character U+1234 is replaced by '\\u1234'.\n\n'xmlcharrefreplace' Replaces invalid characters with an XML character reference.\n\nFor example, the character U+1234 is replaced by '&#4660;'.\n\nF h Lib f L Bdff",
      "content_length": 2711,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 192,
      "content": "Unicode I/O\n\n167\n\nThe default error handling is 'strict'.\n\nThe 'xmlcharrefreplace’ error handling policy is often a useful way to embed international characters into ASCII-encoded text on web pages. For example, if you output the Unicode string 'Jalape\\u00f1o' by encoding it to ASCII with 'xmlcharrefreplace' handling, browsers will almost always correctly render the out- put text as “Jalapeño” and not some garbled alternative.\n\nTo keep your brain from exploding, encoded byte strings and unencoded strings should never be mixed together in expressions (for example, using + to concatenate). Python 3 prohibits this altogether, but Python 2 will silently go ahead with such opera- tions by automatically promoting byte strings to Unicode according to the default encoding setting.This behavior is often a source of surprising results or inexplicable error messages.Thus, you should carefully try to maintain a strict separation between encoded and unencoded character data in your program.\n\nUnicode I/O When working with Unicode strings, it is never possible to directly write raw Unicode data to a file.This is due to the fact that Unicode characters are internally represented as multibyte integers and that writing such integers directly to an output stream causes problems related to byte ordering. For example, you would have to arbitrarily decide if the Unicode character U+HHLL is to be written in “little endian” format as the byte sequence LL HH or in “big endian” format as the byte sequence HH LL. Moreover, other tools that process Unicode would have to know which encoding you used.\n\nBecause of this problem, the external representation of Unicode strings is always done according to a specific encoding rule that precisely defines how Unicode charac- ters are to be represented as a byte sequence.Thus, to support Unicode I/O, the encod- ing and decoding concepts described in the previous section are extended to files.The built-in codecs module contains a collection of functions for converting byte-oriented data to and from Unicode strings according to a variety of different data-encoding schemes.\n\nPerhaps the most straightforward way to handle Unicode files is to use the codecs.open(filename [, mode [, encoding [, errors]]]) function, as follows:\n\nf = codecs.open('foo.txt','r','utf-8','strict') # Reading g = codecs.open('bar.txt','w','utf-8') # Writing\n\nThis creates a file object that reads or writes Unicode strings.The encoding parameter specifies the underlying character encoding that will be used to translate data as it is read or written to the file.The errorsparameter determines how errors are handled and is one of 'strict', 'ignore', 'replace', 'backslashreplace', or 'xmlcharrefreplace' as described in the previous section.\n\nIf you already have a file object, the codecs.EncodedFile(file, inputenc [, outputenc [, errors]]) function can be used to place an encoding wrapper around it. Here’s an example:\n\nf = open(\"foo.txt\",\"rb\") ... fenc = codecs.EncodedFile(f,'utf-8')\n\nF h Lib f L Bdff",
      "content_length": 3030,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 193,
      "content": "168\n\nChapter 9 Input and Output\n\nIn this case, data read from the file will be interpreted according to the encoding sup- plied in inputenc. Data written to the file will be interpreted according to the encod- ing in inputencand written according to the encoding in outputenc. If outputenc is omitted, it defaults to the same as inputenc. errorshas the same meaning as described earlier.When putting an EncodedFile wrapper around an existing file, make sure that file is in binary mode. Otherwise, newline translation might break the encod- ing.\n\nWhen you’re working with Unicode files, the data encoding is often embedded in\n\nthe file itself. For example, XML parsers may look at the first few bytes of the string '<?xml ...>' to determine the document encoding. If the first four values are 3C 3F 78 6D ('<?xm'), the encoding is assumed to be UTF-8. If the first four values are 00 3C 00 3F or 3C 00 3F 00, the encoding is assumed to be UTF-16 big endian or UTF-16 little endian, respectively.Alternatively, a document encoding may appear in MIME headers or as an attribute of other document elements. Here’s an example:\n\n<?xml ... encoding=\"ISO-8859-1\" ... ?>\n\nSimilarly, Unicode files may also include special byte-order markers (BOM) that indi- cate properties of the character encoding.The Unicode character U+FEFF is reserved for this purpose.Typically, the marker is written as the first character in the file. Programs then read this character and look at the arrangement of the bytes to determine encod- ing (for example, '\\xff\\xfe' for UTF-16-LE or '\\xfe\\xff' UTF-16-BE). Once the encoding is determined, the BOM character is discarded and the remainder of the file is processed. Unfortunately, all of this extra handling of the BOM is not something that happens behind the scenes.You often have to take care of this yourself if your applica- tion warrants it.\n\nWhen the encoding is read from a document, code similar to the following can be\n\nused to turn the input file into an encoded stream:\n\nf = open(\"somefile\",\"rb\") # Determine encoding of the file ... # Put an appropriate encoding wrapper on the file. # Assumes that the BOM (if any) has already been discarded # by earlier statements. fenc = codecs.EncodedFile(f,encoding) data = fenc.read()\n\nUnicode Data Encodings Table 9.3 lists some of the most commonly used encoders in the codecs module.\n\nTable 9.3\n\nEncoders in the codecs Module\n\nEncoder\n\nDescription\n\n'ascii' 'latin-1', 'iso-8859-1' 'cp437'\n\n'cp1252'\n\n'utf-8'\n\n'utf-16'\n\nASCII encoding Latin-1 or ISO-8859-1 encoding CP437 encoding CP1252 encoding 8-bit variable-length encoding 16-bit variable-length encoding\n\nF h Lib f L Bdff",
      "content_length": 2656,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 194,
      "content": "Unicode I/O\n\n169\n\nTable 9.3\n\nContinued\n\nEncoder\n\nDescription\n\n'utf-16-le'\n\n'utf-16-be'\n\n'unicode-escape'\n\n'raw-unicode-escape'\n\nUTF-16, but with explicit little endian encoding UTF-16, but with explicit big endian encoding Same format as u\"string\" Same format as ur\"string\"\n\nThe following sections describe each of the encoders in more detail.\n\n'ascii' Encoding In 'ascii' encoding, character values are confined to the ranges [0x00,0x7f] and [U+0000, U+007F].Any character outside this range is invalid.\n\n'iso-8859-1', 'latin-1' Encoding Characters can be any 8-bit value in the ranges [0x00,0xff] and [U+0000, U+00FF]. Values in the range [0x00,0x7f] correspond to characters from the ASCII character set.Values in the range [0x80,0xff] correspond to characters from the ISO-8859-1 or extended ASCII character set.Any characters with values outside the range [0x00,0xff] result in an error.\n\n'cp437' Encoding This encoding is similar to 'iso-8859-1' but is the default encoding used by Python when it runs as a console application on Windows. Certain characters in the range [x80,0xff] correspond to special symbols used for rendering menus, windows, and frames in legacy DOS applications.\n\n'cp1252' Encoding This is an encoding that is very similar to 'iso-8859-1' used on Windows. However, this encoding defines characters in the range [0x80-0x9f] that are undefined in 'iso-8859-1' and which have different code points in Unicode.\n\n'utf-8' Encoding UTF-8 is a variable-length encoding that allows all Unicode characters to be represent- ed.A single byte is used to represent ASCII characters in the range 0–127.All other characters are represented by multibyte sequences of 2 or 3 bytes.The encoding of these bytes is shown here:\n\nUnicode Characters U+0000 - U+007F\n\nByte 0 0nnnnnnn\n\nByte 1\n\nByte 2\n\nU+007F - U+07FF\n\n110nnnnn\n\n10nnnnnn\n\nU+0800 - U+FFFF\n\n1110nnnn\n\n10nnnnnn\n\n10nnnnnn\n\nFor 2-byte sequences, the first byte always starts with the bit sequence 110. For 3-byte sequences, the first byte starts with the bit sequence 1110.All subsequent data bytes in multibyte sequences start with the bit sequence 10.\n\nIn full generality, the UTF-8 format allows for multibyte sequences of up to 6 bytes.\n\nIn Python, 4-byte UTF-8 sequences are used to encode a pair of Unicode characters\n\nF h Lib f L Bdff",
      "content_length": 2306,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 195,
      "content": "170\n\nChapter 9 Input and Output\n\nknown as a surrogate pair. Both characters have values in the range [U+D800, U+DFFF] and are combined to encode a 20-bit character value.The surrogate encoding is as follows:The 4-byte sequence 11110nnn 10nnnnnn 10nmmmm 10mmmmmis encoded as the pair U+D800 + N, U+DC00 + M, where N is the upper 10 bits and M is the lower 10 bits of the 20-bit character encoded in the 4-byte UTF-8 sequence. Five- and 6-byte UTF-8 sequences (denoted by starting bit sequences of 111110 and 1111110, respec- tively) are used to encode character values up to 32 bits in length.These values are not supported by Python and currently result in a UnicodeError exception if they appear in an encoded data stream.\n\nUTF-8 encoding has a number of useful properties that allow it to be used by older software. First, the standard ASCII characters are represented in their standard encoding. This means that a UTF-8–encoded ASCII string is indistinguishable from a traditional ASCII string. Second, UTF-8 doesn’t introduce embedded NULL bytes for multibyte character sequences.Therefore, existing software based on the C library and programs that expect NULL-terminated 8-bit strings will work with UTF-8 strings. Finally, UTF-8 encoding preserves the lexicographic ordering of strings.That is, if a and b are Unicode strings and a < b, then a < b also holds when a and b are converted to UTF-8.Therefore, sorting algorithms and other ordering algorithms written for 8-bit strings will also work for UTF-8.\n\n'utf-16', 'utf-16-be', and 'utf-16-le' Encoding UTF-16 is a variable-length 16-bit encoding in which Unicode characters are written as 16-bit values. Unless a byte ordering is specified, big endian encoding is assumed. In addition, a byte-order marker of U+FEFF can be used to explicitly specify the byte ordering in a UTF-16 data stream. In big endian encoding, U+FEFF is the Unicode character for a zero-width nonbreaking space, whereas the reversed value U+FFFE is an illegal Unicode character.Thus, the encoder can use the byte sequence FE FF or FF FE to determine the byte ordering of a data stream.When reading Unicode data, Python removes the byte-order markers from the final Unicode string.\n\n'utf-16-be' encoding explicitly selects UTF-16 big endian encoding.\n\n'utf-16-le' encoding explicitly selects UTF-16 little ending encoding.\n\nAlthough there are extensions to UTF-16 to support character values greater than\n\n16 bits, none of these extensions are currently supported.\n\n'unicode-escape' and 'raw-unicode-escape' Encoding These encoding methods are used to convert Unicode strings to the same format as used in Python Unicode string literals and Unicode raw string literals. Here’s an example:\n\ns = u'\\u14a8\\u0345\\u2a34' t = s.encode('unicode-escape') #t = '\\u14a8\\u0345\\u2a34'\n\nUnicode Character Properties In addition to performing I/O, programs that use Unicode may need to test Unicode characters for various properties such as capitalization, numbers, and whitespace.The unicodedata module provides access to a database of character properties. General character properties can be obtained with the unicodedata.category(c) function. For example, unicodedata.category(u\"A\") returns 'Lu', signifying that the charac- ter is an uppercase letter.\n\nF h Lib f L Bdff",
      "content_length": 3293,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 196,
      "content": "Object Persistence and the pickle Module\n\n171\n\nAnother tricky problem with Unicode strings is that there might be multiple repre- sentations of the same Unicode string. For example, the character U+00F1 (ñ), might be fully composed as a single character U+00F1 or decomposed into a multicharacter sequence U+006e U+0303 (n, ˜). If consistent processing of Unicode strings is an issue, use the unicodedata.normalize() function to ensure a consistent character represen- tation. For example, unicodedata.normalize('NFC', s) will make sure that all characters in sare fully composed and not represented as a sequence of combining characters.\n\nFurther details about the Unicode character database and the unicodedata module\n\ncan be found in Chapter 16,“Strings and Text Handling.”\n\nObject Persistence and the pickle Module Finally, it’s often necessary to save and restore the contents of an object to a file. One approach to this problem is to write a pair of functions that simply read and write data from a file in a special format.An alternative approach is to use the pickle and shelve modules.\n\nThe pickle module serializes an object into a stream of bytes that can be written to\n\na file and later restored.The interface to pickle is simple, consisting of a dump() and load() operation. For example, the following code writes an object to a file:\n\nimport pickle obj = SomeObject() f = open(filename,'wb') pickle.dump(obj, f) # Save object on f f.close()\n\nTo restore the object, you can use the following code:\n\nimport pickle f = open(filename,'rb') obj = pickle.load(f) # Restore the object f.close()\n\nA sequence of objects can be saved by issuing a series of dump() operations one after the other.To restore these objects, simply use a similar sequence of load() operations. The shelve module is similar to pickle but saves objects in a dictionary-like\n\ndatabase:\n\nimport shelve obj = SomeObject() db = shelve.open(\"filename\") # Open a shelve db['key'] = obj # Save object in the shelve ... obj = db['key'] # Retrieve it db.close() # Close the shelve\n\nAlthough the object created by shelve looks like a dictionary, it also has restrictions. First, the keys must be strings. Second, the values stored in a shelf must be compatible with pickle. Most Python objects will work, but special-purpose objects such as files and network connections maintain an internal state that cannot be saved and restored in this manner.\n\nThe data format used by pickle is specific to Python. However, the format has evolved several times over Python versions.The choice of protocol can be selected using an optional protocol parameter to the pickle dump(obj, file, protocol) operation.\n\nF h Lib f L Bdff",
      "content_length": 2686,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 197,
      "content": "172\n\nChapter 9 Input and Output\n\nBy default, protocol 0 is used.This is the oldest pickle data format that stores objects in a format understood by virtually all Python versions. However, this format is also incompatible with many of Python’s more modern features of user-defined classes such as slots. Protocol 1 and 2 use a more efficient binary data representation.To use these alternative protocols, you would perform operations such as the following:\n\nimport pickle obj = SomeObject() f = open(filename,'wb') pickle.dump(obj,f,2) # Save using protocol 2 pickle.dump(obj,f,pickle.HIGHEST_PROTOCOL) # Use the most modern protocol f.close()\n\nIt is not necessary to specify the protocol when restoring an object using load().The underlying protocol is encoded into the file itself.\n\nSimilarly, a shelve can be opened to save Python objects using an alternative pickle\n\nprotocol like this:\n\nimport shelve db = shelve.open(filename,protocol=2) ... It is not normally necessary for user-defined objects to do anything extra to work with pickle or shelve. However, the special methods __getstate__() and __setstate__() can be used to assist the pickling process.The __getstate__() method, if defined, will be called to create a value representing the state of an object. The value returned by __getstate__() should typically be a string, tuple, list, or dic- tionary.The __setstate__() method receives this value during unpickling and should restore the state of an object from it. Here is an example that shows how these methods could be used with an object involving an underlying network connection.Although the actual connection can’t be pickled, the object saves enough information to reestab- lish it when it’s unpickled later:\n\nimport socket class Client(object):\n\ndef __init__(self,addr):\n\nself.server_addr = addr self.sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM) self.sock.connect(addr)\n\ndef __getstate__(self):\n\nreturn self.server_addr def __setstate__(self,value):\n\nself.server_addr = value self.sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM) self.sock.connect(self.server_addr)\n\nBecause the data format used by pickle is Python-specific, you would not use this feature as a means for exchanging data between applications written in different pro- gramming languages. Moreover, due to security concerns, programs should not process pickled data from untrusted sources (a knowledgeable attacker can manipulate the pick- le data format to execute arbitrary system commands during unpickling).\n\nThe pickle and shelve modules have many more customization features and\n\nadvanced usage options. For more details, consult Chapter 13,“Python Runtime Services.”\n\nF h Lib f L Bdff",
      "content_length": 2698,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 198,
      "content": "10\n\nExecution Environment\n\nThis chapter describes the environment in which Python programs are executed.The\n\ngoal is to describe the runtime behavior of the interpreter, including program startup, configuration, and program termination.\n\nInterpreter Options and Environment The interpreter has a number of options that control its runtime behavior and environ- ment. Options are given to the interpreter on the command line as follows:\n\npython [options] [-c cmd | filename | - ] [args]\n\nHere’s a list of the most common command-line options:\n\nTable 10.1\n\nInterpreter Command-Line Arguments\n\nOption\n\nDescription\n\nEnables warnings about features that are being removed or changed in Python 3. Prevents the creation of .pyc or .pyo files on import. Ignores environment variables. Prints a list of all available command-line options. Enters interactive mode after program execution.\n\n3\n\nB\n\nE\n\nh\n\ni -m module Runs library module moduleas a script. -O\n\nOptimized mode. Optimized mode plus removal of documentation strings when creating .pyo files. Specifies the behavior of the division operator in Python 2. One of -Qold (the default), -Qnew, -Qwarn, or -Qwarnall. Prevents the addition of the user site directory to sys.path. Prevents inclusion of the site initialization module. Reports warnings about inconsistent tab usage. Inconsistent tab usage results in a TabError exception. Unbuffered binary stdout and stdin. Unicode literals. All string literals are handled as Unicode (Python 2 only). Verbose mode. Traces import statements. Prints the version number and exits. Skips the first line of the source program. Executes cmdas a string.\n\nOO\n\nQ arg\n\ns\n\nS\n\nt\n\ntt\n\nu\n\nU\n\nv\n\nV\n\nx\n\n-c cmd\n\nF h Lib f L Bdff",
      "content_length": 1703,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 199,
      "content": "174\n\nChapter 10 Execution Environment\n\nThe -i option starts an interactive session immediately after a program has finished exe- cution and is useful for debugging.The -m option runs a library module as a script which executes inside the __main__ module prior to the execution of the main script. The -O and -OO options apply some optimization to byte-compiled files and are described in Chapter 8,“Modules, Packages, and Distribution.”The -S option omits the site initialization module described in the later section “Site Configuration Files.” The -t, -tt, and -v options report additional warnings and debugging information. -x ignores the first line of a program in the event that it’s not a valid Python statement (for example, when the first line starts the Python interpreter in a script).\n\nThe program name appears after all the interpreter options. If no name is given, or the hyphen (-) character is used as a filename, the interpreter reads the program from standard input. If standard input is an interactive terminal, a banner and prompt are pre- sented. Otherwise, the interpreter opens the specified file and executes its statements until an end-of-file marker is reached.The -c cmdoption can be used to execute short programs in the form of a command-line option—for example, python -c \"print('hello world')\".\n\nCommand-line options appearing after the program name or hyphen (-) are passed\n\nto the program in sys.argv, as described in the section “Reading Options and Environment Variables” in Chapter 9,“Input and Output.”\n\nAdditionally, the interpreter reads the following environment variables:\n\nTable 10.2\n\nInterpreter Environment Variables\n\nEnvironment Variable\n\nDescription\n\nPYTHONPATH\n\nPYTHONSTARTUP\n\nPYTHONHOME\n\nPYTHONINSPECT\n\nPYTHONUNBUFFERED\n\nPYTHONIOENCODING\n\nPYTHONDONTWRITEBYTECODE\n\nPYTHONOPTIMIZE\n\nPYTHONNOUSERSITE\n\nPYTHONVERBOSE\n\nPYTHONUSERBASE\n\nColon-separated module search path. File executed on interactive startup. Location of the Python installation. Implies the -i option. Implies the -u option. Encoding and error handling for stdin, stdout, and stderr. This is a string of the form \"encoding[:errors]\" such as \"utf-8\" or \"utf- 8:ignore\". Implies the -B option Implies the -O option. Implies the -s option. Implies the -v option. Root directory for per-user site packages. Indicates to use case-insensitive matching for module names used by import.\n\nPYTHONCASEOK\n\nPYTHONPATH specifies a module search path that is inserted into the beginning of sys.path, which is described in Chapter 9. PYTHONSTARTUP specifies a file to execute when the interpreter runs in interactive mode.The PYTHONHOME variable is used to set the location of the Python installation but is rarely needed because Python knows how\n\nF h Lib f L Bdff",
      "content_length": 2757,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 200,
      "content": "Interactive Sessions\n\n175\n\nto find its own libraries and the site-packages directory where extensions are nor- mally installed. If a single directory such as /usr/local is given, the interpreter expects to find all files in that location. If two directories are given, such as /usr/local:/usr/ local/sparc-solaris-2.6, the interpreter searches for platform-independent files in the first directory and platform-dependent files in the second. PYTHONHOME has no effect if no valid Python installation exists at the specified location.\n\nThe PYTHONIOENCODING environment setting might be of interest to users of Python 3 because it sets both the encoding and error handling of the standard I/O streams.This might be important because Python 3 directly outputs Unicode while running the interactive interpreter prompt.This, in turn, can cause unexpected excep- tions merely while inspecting data. For example:\n\n>>> a = 'Jalape\\xf1o' >>> a Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module> File \"/tmp/lib/python3.0/io.py\", line 1486, in write\n\nb = encoder.encode(s)\n\nFile \"/tmp/lib/python3.0/encodings/ascii.py\", line 22, in encode\n\nreturn codecs.ascii_encode(input, self.errors)[0]\n\nUnicodeEncodeError: 'ascii' codec can't encode character '\\xf1' in position 7: ordinal not in range(128) >>>\n\nTo fix this, you can set the environment variable PYTHONIOENCODING to something such as 'ascii:backslashreplace' or 'utf-8'. Now, you will get this:\n\n>>> a = 'Jalape\\xf1o' >>> a 'Jalape\\xf1o' >>>\n\nOn Windows, some of the environment variables such as PYTHONPATH are addition-\n\nally read from registry entries found in HKEY_LOCAL_MACHINE/Software/Python.\n\nInteractive Sessions If no program name is given and the standard input to the interpreter is an interactive terminal, Python starts in interactive mode. In this mode, a banner message is printed and the user is presented with a prompt. In addition, the interpreter evaluates the script contained in the PYTHONSTARTUP environment variable (if set).This script is evaluated as if it’s part of the input program (that is, it isn’t loaded using an import statement). One application of this script might be to read a user configuration file such as .pythonrc.\n\nWhen interactive input is being accepted, two user prompts appear.The >>> prompt appears at the beginning of a new statement; the ... prompt indicates a statement con- tinuation. Here’s an example:\n\n>>> for i in range(0,4): print i, ... ... 0 1 2 3 >>>\n\nF h Lib f L Bdff",
      "content_length": 2493,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 201,
      "content": "176\n\nChapter 10 Execution Environment\n\nIn customized applications, you can change the prompts by modifying the values of sys.ps1 and sys.ps2.\n\nOn some systems, Python may be compiled to use the GNU readline library. If enabled, this library provides command histories, completion, and other additions to Python’s interactive mode.\n\nBy default, the output of commands issued in interactive mode is generated by printing the output of the built-in repr() function on the result.This can be changed by setting the variable sys.displayhook to a function responsible for displaying results. Here’s an example that truncates long results:\n\n>>> def my_display(x): ... ... ... >>> sys.displayhook = my_display >>> 3+4 7 >>> range(100000) [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 1...] >>>\n\nr = repr(x) if len(r) > 40: print(r[:40]+\"...\"+r[-1]) else: print(r)\n\nFinally, in interactive mode, it is useful to know that the result of the last operation is stored in a special variable (_).This variable can be used to retrieve the result should you need to use it in subsequent operations. Here’s an example:\n\n>>> 7 + 3 10 >>> _ + 2 12 >>>\n\nThe setting of the _ variable occurs in the displayhook() function shown previously. If you redefine displayhook(), your replacement function should also set _ if you want to retain that functionality.\n\nLaunching Python Applications In most cases, you’ll want programs to start the interpreter automatically, rather than first having to start the interpreter manually. On UNIX, this is done by giving the pro- gram execute permission and setting the first line of a program to something like this:\n\n#!/usr/bin/env python # Python code from this point on... print \"Hello world\" ...\n\nOn Windows, double-clicking a .py, .pyw, .wpy, .pyc, or .pyo file automatically launches the interpreter. Normally, programs run in a console window unless they’re renamed with a .pyw suffix (in which case the program runs silently). If it’s necessary to supply options to the interpreter, Python can also be started from a .bat file. For exam- ple, this .bat file simply runs Python on a script and passes any options supplied on the command prompt along to the interpreter:\n\n:: foo.bat :: Runs foo.py script and passes supplied command line options along (if any) c:\\python26\\python.exe c:\\pythonscripts\\foo.py %*\n\nF h Lib f L Bdff",
      "content_length": 2342,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 202,
      "content": "Per-user Site Packages\n\n177\n\nSite Configuration Files A typical Python installation may include a number of third-party modules and pack- ages.To configure these packages, the interpreter first imports the module site.The role of site is to search for package files and to add additional directories to the mod- ule search path sys.path. In addition, the site module sets the default encoding for Unicode string conversions.\n\nThe site module works by first creating a list of directory names constructed from\n\nthe values of sys.prefix and sys.exec_prefix as follows:\n\n[ sys.prefix, # Windows only sys.exec_prefix, # Windows only sys.prefix + 'lib/pythonvers/site-packages', sys.prefix + 'lib/site-python', sys.exec_prefix + 'lib/pythonvers/site-packages', sys.exec_prefix + 'lib/site-python' ]\n\nIn addition, if enabled, a user-specific site packages directory may be added to this list (described in the next section).\n\nFor each directory in the list, a check is made to see whether the directory exists. If so, it’s added to the sys.path variable. Next, a check is made to see whether it contains any path configuration files (files with a .pth suffix).A path configuration file contains a list of directories, zip files, or .egg files relative to the location of the path file that should be added to sys.path. For example:\n\n# foo package configuration file 'foo.pth' foo bar\n\nEach directory in the path configuration file must be listed on a separate line. Comments and blank lines are ignored.When the site module loads the file, it checks to see whether each directory exists. If so, the directory is added to sys.path. Duplicated items are added to the path only once.\n\nAfter all paths have been added to sys.path, an attempt is made to import a mod-\n\nule named sitecustomize.The purpose of this module is to perform any additional (and arbitrary) site customization. If the import of sitecustomize fails with an ImportError, the error is silently ignored.The import of sitecustomize occurs prior to adding any user directories to sys.path.Thus, placing this file in your own directo- ry has no effect.\n\nThe site module is also responsible for setting the default Unicode encoding. By\n\ndefault, the encoding is set to 'ascii'. However, the encoding can be changed by placing code in sitecustomize.py that calls sys.setdefaultencoding() with a new encoding such as 'utf-8'. If you’re willing to experiment, the source code of site can also be modified to automatically set the encoding based on the machine’s locale settings.\n\nPer-user Site Packages Normally, third-party modules are installed in a way that makes them accessible to all users. However, individual users can install modules and packages in a per-user site directory. On UNIX and Macintosh systems, this directory is found under ~/.local and is named something such as ~/.local/lib/python2.6/site-packages. On Windows systems, this directory is determined by the %APPDATA% environment variable,\n\nF h Lib f L Bdff",
      "content_length": 2982,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 203,
      "content": "178\n\nChapter 10 Execution Environment\n\nwhich is usually something similar to C:\\Documents and Settings\\David Beazley\\Application Data.Within that folder, you will find a \"Python\\Python26\\ site-packages\" directory.\n\nIf you are writing your own Python modules and packages that you want to use in a library, they can be placed in the per-user site directory. If you are installing third-party modules, you can manually install them in this directory by supplying the --user option to setup.py. For example: python setup.py install --user.\n\nEnabling Future Features New language features that affect compatibility with older versions of Python are often disabled when they first appear in a release.To enable these features, the statement from __future__ import featurecan be used. Here’s an example:\n\n# Enable new division semantics from __future__ import division\n\nWhen used, this statement should appear as the first statement of a module or program. Moreover, the scope of a __future__ import is restricted only to the module in which it is used.Thus, importing a future feature does not affect the behavior of Python’s library modules or older code that requires the previous behavior of the interpreter to operate correctly.\n\nCurrently, the following features have been defined:\n\nTable 10.3\n\nFeature Names in the __future__ Module\n\nFeature Name\n\nDescription\n\nnested_scopes\n\ngenerators\n\ndivision\n\nSupport for nested scopes in functions. First introduced in Python 2.1 and made the default behavior in Python 2.2. Support for generators. First introduced in Python 2.2 and made the default behavior in Python 2.3. Modified division semantics where integer division returns a frac- tional result. For example, 1/4 yields 0.25 instead of 0. First introduced in Python 2.2 and is still an optional feature as of Python 2.6. This is the default behavior in Python 3.0.\n\nabsolute_import Modified behavior of package-relative imports. Currently, when a\n\nwith_statement\n\nprint_function\n\nsubmodule of a package makes an import statement such as import string, it first looks in the current directory of the package and then directories in sys.path. However, this makes it impos- sible to load modules in the standard library if a package hap- pens to use conflicting names. When this feature is enabled, the statement import module is an absolute import. Thus, a state- ment such as import string will always load the string mod- ule from the standard library. First introduced in Python 2.5 and still disabled in Python 2.6. It is enabled in Python 3.0. Support for context managers and the with statement. First introduced in Python 2.5 and enabled by default in Python 2.6. Use Python 3.0 print() function instead of the print state- ment. First introduced in Python 2.6 and enabled by default in Python 3.0.\n\nF h Lib f L Bdff",
      "content_length": 2822,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 204,
      "content": "Program Termination\n\n179\n\nIt should be noted that no feature name is ever deleted from __future__. Thus, even if a feature is turned on by default in a later Python version, no existing code that uses that feature name will break.\n\nProgram Termination A program terminates when no more statements exist to execute in the input program, when an uncaught SystemExit exception is raised (as generated by sys.exit()), or when the interpreter receives a SIGTERM or SIGHUP signal (on UNIX). On exit, the interpreter decrements the reference count of all objects in all the currently known namespaces (and destroys each namespace as well). If the reference count of an object reaches zero, the object is destroyed and its __del__() method is invoked.\n\nIt’s important to note that in some cases the __del__() method might not be invoked at program termination.This can occur if circular references exist between objects (in which case objects may be allocated but accessible from no known name- space).Although Python’s garbage collector can reclaim unused circular references dur- ing execution, it isn’t normally invoked on program termination.\n\nBecause there’s no guarantee that __del__() will be invoked at termination, it may\n\nbe a good idea to explicitly clean up certain objects, such as open files and network connections.To accomplish this, add specialized cleanup methods (for example, close()) to user-defined objects.Another possibility is to write a termination function and register it with the atexit module, as follows:\n\nimport atexit connection = open_connection(\"deaddot.com\")\n\ndef cleanup():\n\nprint \"Going away...\" close_connection(connection)\n\natexit.register(cleanup)\n\nThe garbage collector can also be invoked in this manner:\n\nimport atexit, gc atexit.register(gc.collect)\n\nOne final peculiarity about program termination is that the __del__ method for some objects may try to access global data or methods defined in other modules. Because these objects may already have been destroyed, a NameError exception occurs in __del__, and you may get an error such as the following:\n\nException exceptions.NameError: 'c' in <method Bar.__del__ of Bar instance at c0310> ignored\n\nIf this occurs, it means that __del__ has aborted prematurely. It also implies that it may have failed in an attempt to perform an important operation (such as cleanly shutting down a server connection). If this is a concern, it’s probably a good idea to perform an explicit shutdown step in your code, rather than rely on the interpreter to destroy objects cleanly at program termination.The peculiar NameError exception can also be\n\nF h Lib f L Bdff",
      "content_length": 2637,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 205,
      "content": "180\n\nChapter 10 Execution Environment\n\neliminated by declaring default arguments in the declaration of the __del__() method:\n\nimport foo class Bar(object):\n\ndef __del__(self, foo=foo):\n\nfoo.bar() # Use something in module foo\n\nIn some cases, it may be useful to terminate program execution without performing any cleanup actions.This can be accomplished by calling os._exit(status).This function provides an interface to the low-level exit() system call responsible for killing the Python interpreter process.When it’s invoked, the program immediately terminates without any further processing or cleanup.\n\nF h Lib f L Bdff",
      "content_length": 623,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 206,
      "content": "11\n\nTesting, Debugging, Profiling, and Tuning\n\nUnlike programs in languages such as C or Java, Python programs are not processed\n\nby a compiler that produces an executable program. In those languages, the compiler is the first line of defense against programming errors—catching mistakes such as calling functions with the wrong number of arguments or assigning improper values to vari- ables (that is, type checking). In Python, however, these kinds of checks do not occur until a program runs. Because of this, you will never really know if your program is cor- rect until you run and test it. Not only that, unless you are able to run your program in a way that executes every possible branch of its internal control-flow, there is always some chance of a hidden error just waiting to strike (fortunately, this usually only hap- pens a few days after shipping, however).\n\nTo address these kinds of problems, this chapter covers techniques and library mod- ules used to test, debug, and profile Python code.At the end, some strategies for opti- mizing Python code are discussed.\n\nDocumentation Strings and the doctest Module If the first line of a function, class, or module is a string, that string is known as a docu- mentation string.The inclusion of documentation strings is considered good style because these strings are used to supply information to Python software development tools. For example, the help() command inspects documentation strings, and Python IDEs look at the strings as well. Because programmers tend to view documentation strings while experimenting in the interactive shell, it is common for the strings to include short interactive examples. For example:\n\n# splitter.py def split(line, types=None, delimiter=None):\n\n\"\"\"Splits a line of text and optionally performs type conversion.\n\nFor example:\n\n>>> split('GOOG 100 490.50') ['GOOG', '100', '490.50'] >>> split('GOOG 100 490.50',[str, int, float]) ['GOOG', 100, 490.5] >>>\n\nF h Lib f L Bdff",
      "content_length": 1971,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 207,
      "content": "182\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nBy default, splitting is performed on whitespace, but a different delimiter can be selected with the delimiter keyword argument:\n\n>>> split('GOOG,100,490.50',delimiter=',') ['GOOG', '100', '490.50'] >>>\n\n\"\"\" fields = line.split(delimiter) if types:\n\nfields = [ ty(val) for ty,val in zip(types,fields) ]\n\nreturn fields\n\nA common problem with writing documentation is keeping the documentation syn- chronized with the actual implementation of a function. For example, a programmer might modify a function but forget to update the documentation.\n\nTo address this problem, use the doctest module. doctest collects documentation strings, scans them for interactive sessions, and executes them as a series of tests.To use doctest, you typically create a separate module for testing. For example, if the previous function is in a file splitter.py, you would create a file testsplitter.py for test- ing, as follows:\n\n# testsplitter.py import splitter import doctest\n\nnfail, ntests = doctest.testmod(splitter)\n\nIn this code, the call to doctest.testmod(module) runs tests on the specified module and returns the number of failures and total number of tests executed. No output is produced if all of the tests pass. Otherwise, you will get a failure report that shows the difference between the expected and received output. If you want to see verbose output of the tests, you can use testmod(module, verbose=True).\n\nAs an alternative to creating a separate testing file, library modules can test them-\n\nselves by including code such as this at the end of the file:\n\n... if _ _name_ _ == '_ _main_ _':\n\n# test myself import doctest doctest.testmod()\n\nWith this code, documentation tests will run if the file is run as the main program to the interpreter. Otherwise, the tests are ignored if the file is loaded with import.\n\ndoctest expects the output of functions to literally match the exact output you get in the interactive interpreter.As a result, it is quite sensitive to issues of white space and numerical precision. For example, consider this function:\n\ndef half(x):\n\n\"\"\"Halves x. For example:\n\n>>> half(6.8) 3.4 >>> \"\"\" return x/2\n\nF h Lib f L Bdff",
      "content_length": 2206,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 208,
      "content": "Unit Testing and the unittest Module\n\n183\n\nIf you run doctest on this function, you will get a failure report such as this:\n\n********************************************************************** File \"half.py\", line 4, in _ _main_ _.half Failed example:\n\nhalf(6.8)\n\nExpected:\n\n3.4\n\nGot:\n\n3.3999999999999999\n\n**********************************************************************\n\nTo fix this, you either need to make the documentation exactly match the output or need to pick a better example in the documentation.\n\nBecause using doctest is almost trivial, there is almost no excuse for not using it with your own programs. However, keep in mind that doctest is not a module you would typically use for exhaustive program testing. Doing so tends to result in exces- sively long and complicated documentation strings—which defeats the point of produc- ing useful documentation (e.g., a user will probably be annoyed if he asks for help and the documentation lists 50 examples covering all sorts of tricky corner cases). For this kind of testing, you want to use the unittest module.\n\nLast, the doctest module has a large number of configuration options that concerns various aspects of how testing is performed and how results are reported. Because these options are not required for the most common use of the module, they are not covered here. Consult http://docs.python.org/library/doctest.html for more details.\n\nUnit Testing and the unittest Module For more exhaustive program testing, use the unittest module.With unit testing, a developer writes a collection of isolated test cases for each element that makes up a pro- gram (for example, individual functions, methods, classes, and modules).These tests are then run to verify correct behavior of the basic building blocks that make up larger programs.As programs grow in size, unit tests for various components can be combined to create large testing frameworks and testing tools.This can greatly simplify the task of verifying correct behavior as well as isolating and fixing problems when they do occur. Use of this module can be illustrated by the code listing in the previous section:\n\n# splitter.py def split(line, types=None, delimiter=None):\n\n\"\"\"Splits a line of text and optionally performs type conversion.\n\n...\n\n\"\"\" fields = line.split(delimiter) if types:\n\nfields = [ ty(val) for ty,val in zip(types,fields) ]\n\nreturn fields\n\nF h Lib f L Bdff",
      "content_length": 2411,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 209,
      "content": "184\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nIf you wanted to write unit tests for testing various aspects of the split() function, you would create a separate module testsplitter.py, like this:\n\n# testsplitter.py import splitter import unittest\n\n# Unit tests class TestSplitFunction(unittest.TestCase):\n\ndef setUp(self):\n\n# Perform set up actions (if any) pass\n\ndef tearDown(self):\n\n# Perform clean-up actions (if any) pass\n\ndef testsimplestring(self):\n\nr = splitter.split('GOOG 100 490.50') self.assertEqual(r,['GOOG','100','490.50'])\n\ndef testtypeconvert(self):\n\nr = splitter.split('GOOG 100 490.50',[str, int, float]) self.assertEqual(r,['GOOG', 100, 490.5])\n\ndef testdelimiter(self):\n\nr = splitter.split('GOOG,100,490.50',delimiter=',') self.assertEqual(r,['GOOG','100','490.50'])\n\n# Run the unittests if _ _name_ _ == '_ _main_ _':\n\nunittest.main()\n\nTo run tests, simply run Python on the file testsplitter.py. Here’s an example:\n\n% python testsplitter.py ... ---------------------------------------------------------------------- Ran 3 tests in 0.014s\n\nOK\n\nBasic use of unittest involves defining a class that inherits from unittest.TestCase. Within this class, individual tests are defined by methods starting with the name 'test'—for example, 'testsimplestring', 'testtypeconvert', and so on. (It is important to emphasize that the names are entirely up to you as long as they start with 'test'.) Within each test, various assertions are used to check for different conditions. An instance, t, of unittest.TestCase has the following methods that are used\n\nwhen writing tests and for controlling the testing process:\n\nt.setUp()\n\nCalled to perform set-up steps prior to running any of the testing methods.\n\nt.tearDown()\n\nCalled to perform clean-up actions after running the tests.\n\nF h Lib f L Bdff",
      "content_length": 1819,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 210,
      "content": "Unit Testing and the unittest Module\n\n185\n\nt.assert_(expr [, msg]) t.failUnless(expr [, msg]) Signals a test failure if exprevaluates as False. msgis a message string giving an expla- nation for the failure (if any).\n\nt.assertEqual(x, y [,msg]) t.failUnlessEqual(x, y [, msg])\n\nSignals a test failure if xand yare not equal to each other. msgis a message explaining the failure (if any).\n\nt.assertNotEqual(x, y [, msg]) t.failIfEqual(x, y, [, msg])\n\nSignals a test failure if xand yare equal to each other. msgis a message explaining the failure (if any).\n\nt.assertAlmostEqual(x, y [, places [, msg]]) t.failUnlessAlmostEqual(x, y, [, places [, msg]])\n\nSignals a test failure if numbers xand yare not within placesdecimal places of each other.This is checked by computing the difference of xand y and rounding the result to the given number of places. If the result is zero, xand yare almost equal. msgis a message explaining the failure (if any).\n\nt.assertNotAlmostEqual(x, y, [, places [, msg]]) t.failIfAlmostEqual(x, y [, places [, msg]])\n\nSignals a test failure if xand yare not at least placesdecimal places apart. msgis a message explaining the failure (if any).\n\nt.assertRaises(exc, callable, ...) t.failUnlessRaises(exc, callable, ...)\n\nSignals a test failure if the callable object callabledoes not raise the exception exc. Remaining arguments are passed as arguments to callable. Multiple exceptions can be checked by using a tuple of exceptions as exc.\n\nt.failIf(expr [, msg])\n\nSignals a test failure if exprevaluates as True. msgis a message explaining the failure (if any).\n\nt.fail([msg])\n\nSignals a test failure. msgis a message explaining the failure (if any).\n\nt.failureException\n\nThis attribute is set to the last exception value caught in a test.This may be useful if you not only want to check that an exception was raised, but that the exception raises an appropriate value—for example, if you wanted to check the error message generated as part of raising an exception.\n\nF h Lib f L Bdff",
      "content_length": 2009,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 211,
      "content": "186\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nIt should be noted that the unittest module contains a large number of advanced customization options for grouping tests, creating test suites, and controlling the envi- ronment in which tests run.These features are not directly related to the process of writing tests for your code (you tend to write testing classes as shown independently of how tests actually get executed). Consult the documentation at http://docs.python.org/ library/unittest.html for more information on how to organize tests for larger programs.\n\nThe Python Debugger and the pdb Module Python includes a simple command-based debugger which is found in the pdb module. The pdb module supports post-mortem debugging, inspection of stack frames, break- points, single-stepping of source lines, and code evaluation.\n\nThere are several functions for invoking the debugger from a program or from the\n\ninteractive Python shell.\n\nrun(statement [, globals [, locals]])\n\nExecutes the string statementunder debugger control.The debugger prompt will appear immediately before any code executes.Typing 'continue' will force it to run. globalsand localsdefine the global and local namespaces, respectively, in which the code runs.\n\nruneval(expression [, globals [, locals]])\n\nEvaluates the expressionstring under debugger control.The debugger prompt will appear before any code executes, so you will need to type 'continue' to force it to execute as with run(). On success, the value of the expression is returned.\n\nruncall(function [, argument, ...])\n\nCalls a function within the debugger. functionis a callable object.Additional argu- ments are supplied as the arguments to function.The debugger prompt will appear before any code executes.The return value of the function is returned upon comple- tion.\n\nset_trace()\n\nStarts the debugger at the point at which this function is called.This can be used to hard-code a debugger breakpoint into a specific code location.\n\npost_mortem(traceback)\n\nStarts post-mortem debugging of a traceback object. tracebackis typically obtained using a function such as sys.exc_info().\n\npm()\n\nEnters post-mortem debugging using the traceback of the last exception.\n\nOf all of the functions for launching the debugger, the set_trace() function may\n\nbe the easiest to use in practice. If you are working on a complicated application but you have detected a problem in one part of it, you can insert a set_trace() call into the code and simply run the application.When encountered, this will suspend the pro- gram and go directly to the debugger where you can inspect the execution environ- ment. Execution resumes after you leave the debugger.\n\nF h Lib f L Bdff",
      "content_length": 2710,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 212,
      "content": "The Python Debugger and the pdb Module\n\n187\n\nDebugger Commands When the debugger starts, it presents a (Pdb) prompt such as the following:\n\n>>> import pdb >>> import buggymodule >>> pdb.run('buggymodule.start()') > <string>(0)?() (Pdb)\n\n(Pdb) is the debugger prompt at which the following commands are recognized. Note that some commands have a short and a long form. In this case, parentheses are used to indicate both forms. For example, h(elp) means that either h or help is acceptable.\n\n[!]statement\n\nExecutes the (one-line) statementin the context of the current stack frame.The exclamation point may be omitted, but it must be used to avoid ambiguity if the first word of the statement resembles a debugger command.To set a global variable, you can prefix the assignment command with a “global” command on the same line:\n\n(Pdb) global list_options; list_options = ['-l'] (Pdb)\n\na(rgs)\n\nPrints the argument list of the current function.\n\nalias [name [command]]\n\nCreates an alias called namethat executes command.Within the commandstring, the sub- strings '%1','%2', and so forth are replaced by parameters when the alias is typed. '%*' is replaced by all parameters. If no command is given, the current alias list is shown. Aliases can be nested and can contain anything that can be legally typed at the Pdb prompt. Here’s an example:\n\n# Print instance variables (usage \"pi classInst\") alias pi for k in %1._ _dict_ _.keys(): print \"%1.\",k,\"=\",%1._ _dict_ _[k] # Print instance variables in self alias ps pi self\n\nb(reak) [loc [, condition]]\n\nSets a breakpoint at location loc. loceither specifies a specific filename and line num- ber or is the name of a function within a module.The following syntax is used:\n\nSetting n\n\nfilename:n\n\nfunction module.function\n\nDescription A line number in the current file A line number in another file A function name in the current module A function name in a module\n\nIf locis omitted, all the current breakpoints are printed. conditionis an expression that must evaluate to true before the breakpoint is honored.All breakpoints are assigned\n\nF h Lib f L Bdff",
      "content_length": 2100,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 213,
      "content": "188\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nnumbers that are printed as output upon the completion of this command.These num- bers are used in several other debugger commands that follow.\n\ncl(ear) [bpnumber [bpnumber ...]]\n\nClears a list of breakpoint numbers. If breakpoints are specified, all breaks are cleared.\n\ncommands [bpnumber]\n\nSets a series of debugger commands to execute automatically when the breakpoint bpnumberis encountered.When listing the commands to execute, simply type them on the subsequent lines and use end to mark the end of the command sequence. If you include the continue command, the execution of the program will resume automati- cally when the breakpoint is encountered. If bpnumberis omitted, the last breakpoint set is used.\n\ncondition bpnumber [condition]\n\nPlaces a condition on a breakpoint. conditionis an expression that must evaluate to true before the breakpoint is recognized. Omitting the condition clears any previous condition.\n\nc(ont(inue))\n\nContinues execution until the next breakpoint is encountered.\n\ndisable [bpnumber [bpnumber ...]]\n\nDisables the set of specified breakpoints. Unlike with clear, they can be reenabled later.\n\nd(own)\n\nMoves the current frame one level down in the stack trace.\n\nenable [bpnumber [bpnumber ...]]\n\nEnables a specified set of breakpoints.\n\nh(elp) [command]\n\nShows the list of available commands. Specifying a command returns help for that com- mand.\n\nignore bpnumber [count]\n\nIgnores a breakpoint for countexecutions.\n\nj(ump) lineno\n\nSets the next line to execute.This can only be used to move between statements in the same execution frame. Moreover, you can’t jump into certain statements, such as state- ments in the middle of a loop.\n\nl(ist) [first [, last]]\n\nLists source code.Without arguments, this command lists 11 lines around the current line (5 lines before and 5 lines after).With one argument, it lists 11 lines around that line.With two arguments, it lists lines in a given range. If lastis less than first, it’s interpreted as a count.\n\nF h Lib f L Bdff",
      "content_length": 2062,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 214,
      "content": "The Python Debugger and the pdb Module\n\n189\n\nn(ext)\n\nExecutes until the next line of the current function. Skips the code contained in func- tion calls.\n\np expression\n\nEvaluates the expression in the current context and prints its value.\n\npp expression\n\nThe same as the p command, but the result is formatted using the pretty-printing mod- ule (pprint).\n\nq(uit)\n\nQuits from the debugger.\n\nr(eturn)\n\nRuns until the current function returns.\n\nrun [args]\n\nRestarts the program and uses the command-line arguments in argsas the new setting of sys.argv.All breakpoints and other debugger settings are preserved.\n\ns(tep)\n\nExecutes a single source line and stops inside called functions.\n\ntbreak [loc [, condition]]\n\nSets a temporary breakpoint that’s removed after its first hit.\n\nu(p)\n\nMoves the current frame one level up in the stack trace.\n\nunalias name\n\nDeletes the specified alias.\n\nuntil\n\nResumes execution until control leaves the current execution frame or until a line number greater than the current line number is reached. For example, if the debugger was stopped at the last line in a loop body, typing until will execute all of the state- ments in the loop until the loop is finished.\n\nw(here)\n\nPrints a stack trace.\n\nDebugging from the Command Line An alternative method for running the debugger is to invoke it on the command line. Here’s an example:\n\n% python -m pdb someprogram.py\n\nF h Lib f L Bdff",
      "content_length": 1410,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 215,
      "content": "190\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nIn this case, the debugger is launched automatically at the beginning of program startup where you are free to set breakpoints and make other configuration changes.To make the program run, simply use the continue command. For example, if you wanted to debug the split() function from within a program that used it, you might do this:\n\n% python –m pdb someprogram.py > /Users/beazley/Code/someprogram.py(1)<module>() -> import splitter (Pdb) b splitter.split Breakpoint 1 at /Users/beazley/Code/splitter.py:1 (Pdb) c > /Users/beazley/Code/splitter.py(18)split() -> fields = line.split(delimiter) (Pdb)\n\nConfiguring the Debugger If a .pdbrc file exists in the user’s home directory or in the current directory, it’s read in and executed as if it had been typed at the debugger prompt.This can be useful for specifying debugging commands that you want to execute each time the debugger is started (as opposed to having to interactively type the commands each time).\n\nProgram Profiling The profile and cProfile modules are used to collect profiling information. Both modules work in the same way, but cProfile is implemented as a C extension, is sig- nificantly faster, and is more modern. Either module is used to collect both coverage information (that is, what functions get executed) as well as performance statistics.The easiest way to profile a program is to execute it from the command line as follows:\n\n% python -m cProfile someprogram.py\n\nAlternatively, the following function in the profile module can be used:\n\nrun(command [, filename])\n\nExecutes the contents of commandusing the exec statement under the profiler. filenameis the name of a file in which raw profiling data is saved. If it’s omitted, a report is printed to standard output.\n\nThe result of running the profiler is a report such as the following:\n\n126 function calls (6 primitive calls) in 5.130 CPU seconds Ordered by: standard name ncalls tottime percall cumtime percall filename:lineno(function)\n\n1 0.030 0.030 5.070 5.070 <string>:1(?)\n\n121/1 5.020 0.041 5.020 5.020 book.py:11(process)\n\n1 0.020 0.020 5.040 5.040 book.py:5(?) 2 0.000 0.000 0.000 0.000 exceptions.py:101(_ _init_ _) 1 0.060 0.060 5.130 5.130 profile:0(execfile('book.py')) 0 0.000 0.000 profile:0(profiler)\n\nDifferent parts of the report generated by run() are interpreted as follows:\n\nF h Lib f L Bdff",
      "content_length": 2403,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 216,
      "content": "Tuning and Optimization\n\n191\n\nSection primitive calls\n\nncalls\n\ntottime\n\npercall\n\ncumtime\n\nDescription Number of nonrecursive function calls Total number of calls (including self-recursion) Time spent in this function (not counting subfunctions) tottime/ncalls Total time spent in the function cumtime/(primitive calls)\n\npercall filename:lineno(function) Location and name of each function\n\nWhen there are two numbers in the first column (for example, \"121/1\"), the latter is the number of primitive calls and the former is the actual number of calls.\n\nSimply inspecting the generated report of the profiler is often enough for most appli-\n\ncations of this module—for example, if you simply want to see how your program is spending its time. However, if you want to save the data and analyze it further, the pstats module can be used. Consult http://docs.python.org/library/profile.html for more details about saving and analyzing the profile data.\n\nTuning and Optimization This section covers some general rules of thumb that can be used to make Python pro- grams run faster and use less memory.The techniques described here are by no means exhaustive but should give programmers some ideas when looking at their own code.\n\nMaking Timing Measurements If you simply want to time a long-running Python program, the easiest way to do it is often just to run it until the control of something like the UNIX time command. Alternatively, if you have a block of long-running statements you want to time, you can insert calls to time.clock() to get a current reading of the elapsed CPU time or calls to time.time() to read the current wall-clock time. For example:\n\nstart_cpu = time.clock() start_real= time.time() statements statements end_cpu = time.clock() end_real = time.time() print(\"%f Real Seconds\" % (end_real – start_real)) print(\"%f CPU seconds\" % (end_cpu - start_cpu))\n\nKeep in the mind that this technique really works only if the code to be timed runs for a reasonable period of time. If you have a fine-grained statement you want to bench- mark, you can use the timeit(code [, setup]) function in the timeit module. For example:\n\n>>> from timeit import timeit >>> timeit('math.sqrt(2.0)','import math') 0.20388007164001465 >>> timeit('sqrt(2.0)','from math import sqrt') 0.14494490623474121\n\nF h Lib f L Bdff",
      "content_length": 2316,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 217,
      "content": "192\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nIn this example, the first argument to timeit() is the code you want to benchmark. The second argument is a statement that gets executed once in order to set up the exe- cution environment.The timeit() function runs the supplied statement one million times and reports the execution time.The number of repetitions can be changed by supplying a number=countkeyword argument to timeit().\n\nThe timeit module also has a function repeat() that can be used to make meas- urements.This function works the same way as timeit() except that it repeats the tim- ing measurement three times and returns a list of the results. For example:\n\n>>> from timeit import repeat >>> repeat('math.sqrt(2.0)','import math') [0.20306601524353027, 0.19715800285339355, 0.20907392501831055] >>>\n\nWhen making performance measurement, it is common to refer to the associated speedup, which usually refers to the original execution time divided by the new execu- tion time. For example, in the previous timing measurements, using sqrt(2.0) instead of math.sqrt(2.0) represents a speedup of 0.20388/0.14494 or about 1.41. Sometimes this gets reported as a percentage by saying the speedup is about 41 percent.\n\nMaking Memory Measurements The sys module has a function getsizeof() that can be used to investigate the mem- ory footprint (in bytes) of individual Python objects. For example:\n\n>>> import sys >>> sys.getsizeof(1) 14 >>> sys.getsizeof(\"Hello World\") 52 >>> sys.getsizeof([1,2,3,4]) 52 >>> sum(sys.getsizeof(x) for x in [1,2,3,4]) 56\n\nFor containers such as lists, tuples, and dictionaries, the size that gets reported is just for the container object itself, not the cumulative size of all objects contained inside of it. For instance, in the previous example, the reported size of the list [1,2,3,4] is actually smaller than the space required for four integers (which are 14 bytes each).This is because the contents of the list are not included in the total.You can use sum() as shown here to calculate the total size of the list contents.\n\nBe aware that the getsizeof() function is only going to give you a rough idea of\n\noverall memory use for various objects. Internally, the interpreter aggressively shares objects via reference counting so the actual memory consumed by an object might be far less than you first imagine.Also, given that C extensions to Python can allocate memory outside of the interpreter, it may be difficult to precisely get a measurement of overall memory use.Thus, a secondary technique for measuring the actual memory footprint is to inspect your running program from an operating system process viewer or task manager.\n\nFrankly, a better way to get a handle on memory use may be to sit down and be analytical about it. If you know your program is going to allocate various kinds of data structures and you know what kinds of data will be stored in those structures (that is, ints, floats, strings, and so on), you can use the results of the getsizeof() function to\n\nF h Lib f L Bdff",
      "content_length": 3055,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 218,
      "content": "Tuning and Optimization\n\n193\n\nobtain figures for calculating an upper bound on your program’s memory footprint—or at the very least, you can get enough information to carry out a “back of the envelope” estimate.\n\nDisassembly The dis module can be used to disassemble Python functions, methods, and classes into low-level interpreter instructions.The module defines a function dis() that can be used like this:\n\n>>> from dis import dis >>> dis(split)\n\n2 0 LOAD_FAST 0 (line)\n\n3 LOAD_ATTR 0 (split) 6 LOAD_FAST 1 (delimiter) 9 CALL_FUNCTION 1\n\n12 STORE_FAST 2 (fields)\n\n3 15 LOAD_GLOBAL 1 (types) 18 JUMP_IF_FALSE 58 (to 79) 21 POP_TOP\n\n4 22 BUILD_LIST 0\n\n25 DUP_TOP 26 STORE_FAST 3 (_[1]) 29 LOAD_GLOBAL 2 (zip) 32 LOAD_GLOBAL 1 (types) 35 LOAD_FAST 2 (fields) 38 CALL_FUNCTION 2 41 GET_ITER\n\n>> 42 FOR_ITER 25 (to 70)\n\n45 UNPACK_SEQUENCE 2 48 STORE_FAST 4 (ty) 51 STORE_FAST 5 (val) 54 LOAD_FAST 3 (_[1]) 57 LOAD_FAST 4 (ty) 60 LOAD_FAST 5 (val) 63 CALL_FUNCTION 1 66 LIST_APPEND 67 JUMP_ABSOLUTE 42\n\n>> 70 DELETE_FAST 3 (_[1])\n\n73 STORE_FAST 2 (fields) 76 JUMP_FORWARD 1 (to 80)\n\n>> 79 POP_TOP\n\n5 >> 80 LOAD_FAST 2 (fields)\n\n83 RETURN_VALUE\n\n>>>\n\nExpert programmers can use this information in two ways. First, a disassembly will show you exactly what operations are involved in executing a function.With careful study, you might spot opportunities for making speedups. Second, if you are program- ming with threads, each line printed in the disassembly represents a single interpreter operation—each of which has atomic execution.Thus, if you are trying to track down a tricky race condition, this information might be useful.\n\nF h Lib f L Bdff",
      "content_length": 1646,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 219,
      "content": "194\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nTuning Strategies The following sections outline a few optimization strategies that, in the opinion of the author, have proven to be useful with Python code.\n\nUnderstand Your Program Before you optimize anything, know that speedup obtained by optimizing part of a program is directly related to that part’s total contribution to the execution time. For example, if you optimize a function by making it run 10 times as fast but that function only contributes to 10 percent of the program’s total execution time, you’re only going to get an overall speedup of about 9%–10%. Depending on the effort involved in mak- ing the optimization, this may or may not be worth it.\n\nIt is always a good idea to first use the profiling module on code you intend to opti-\n\nmize.You really only want to focus on functions and methods where your program spends most of its time, not obscure operations that are called only occasionally.\n\nUnderstand Algorithms A poorly implemented O(n log n) algorithm will outperform the most finely tuned O(n3) algorithm. Don’t optimize inefficient algorithms—look for a better algorithm first.\n\nUse the Built-In Types Python’s built-in tuple, list, set, and dictionary types are implemented entirely in C and are the most finely tuned data structures in the interpreter.You should actively use these types to store and manipulate data in your program and resist the urge to build your own custom data structures that mimic their functionality (that is, binary search trees, linked lists, and so on).\n\nHaving said that, you should still look more closely at types in the standard library. Some library modules provide new types that outperform the built-ins at certain tasks. For instance, the collection.deque type provides similar functionality to a list but has been highly optimized for the insertion of new items at both ends.A list, in contrast, is only efficient when appending items at the end. If you insert items at the front, all of the other elements need to be shifted in order to make room.The time required to do this grows as the list gets larger and larger. Just to give you an idea of the difference, here is a timing measurement of inserting one million items at the front of a list and a deque:\n\n>>> from timeit import timeit >>> timeit('s.appendleft(37)', ... 'import collections; s = collections.deque()', ... number=1000000) 0.24434304237365723 >>> timeit('s.insert(0,37)', 's = []', number=1000000) 612.95199513435364\n\nDon’t Add Layers Any time you add an extra layer of abstraction or convenience to an object or a func- tion, you will slow down your program. However, there is also a trade-off between usability and performance. For instance, the whole point of adding an extra layer is often to simplify coding, which is also a good thing.\n\nF h Lib f L Bdff",
      "content_length": 2860,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 220,
      "content": "Tuning and Optimization\n\n195\n\nTo illustrate with a simple example, consider a program that makes use of the\n\ndict() function to create dictionaries with string keys like this:\n\ns = dict(name='GOOG',shares=100,price=490.10) # s = {'name':'GOOG', 'shares':100, 'price':490.10 }\n\nA programmer might create dictionaries in this way to save typing (you don’t have to put quotes around the key names). However, this alternative way of creating a dictionary also runs much more slowly because it adds an extra function call.\n\n>>> timeit(\"s = {'name':'GOOG','shares':100,'price':490.10}\") 0.38917303085327148 >>> timeit(\"s = dict(name='GOOG',shares=100,price=490.10)\") 0.94420003890991211\n\nIf your program creates millions of dictionaries as it runs, then you should know that the first approach is faster.With few exceptions, any feature that adds an enhancement or changes the way in which an existing Python object works will run more slowly.\n\nKnow How Classes and Instances Build Upon Dictionaries User-defined classes and instances are built using dictionaries. Because of this, operations that look up, set, or delete instance data are almost always going to run more slowly than directly performing these operations on a dictionary. If all you are doing is build- ing a simple data structure for storing data, a dictionary may be a more efficient choice than defining a class.\n\nJust to illustrate the difference, here is a simple class that represents a holding of\n\nstock:\n\nclass Stock(object):\n\ndef _ _init_ _(self,name,shares,price):\n\nself.name = name self.shares = shares self.price = price\n\nIf you compare the performance of using this class against a dictionary, the results are interesting. First, let’s compare the performance of simply creating instances:\n\n>>> from timeit import timeit >>> timeit(\"s = Stock('GOOG',100,490.10)\",\"from stock import Stock\") 1.3166780471801758 >>> timeit(\"s = {'name' : 'GOOG', 'shares' : 100, 'price' : 490.10 }\") 0.37812089920043945 >>>\n\nHere, the speedup of creating new objects is about 3.5. Next, let’s look at the perform- ance of performing a simple calculation:\n\n>>> timeit(\"s.shares*s.price\", ... 0.29100513458251953 >>> timeit(\"s['shares']*s['price']\", ... 0.23622798919677734 >>>\n\n\"from stock import Stock; s = Stock('GOOG',100,490.10)\")\n\n\"s = {'name' : 'GOOG', 'shares' : 100, 'price' : 490.10 }\")\n\nHere, the speedup is about 1.2.The lesson here is that just because you can define a new object using a class, it’s not the only way to work with data.Tuples and diction- aries are often good enough. Using them will make your program run more quickly and use less memory.\n\nF h Lib f L Bdff",
      "content_length": 2638,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 221,
      "content": "196\n\nChapter 11 Testing, Debugging, Profiling, and Tuning\n\nUse __slots__ If your program creates a large number of instances of user-defined classes, you might consider using the _ _slots_ _ attribute in a class definition. For example:\n\nclass Stock(object):\n\n__slots__ = ['name','shares','price'] def __init__(self,name,shares,price):\n\nself.name = name self.shares = shares self.price = price\n\n_ _slots_ _ is sometimes viewed as a safety feature because it restricts the set of attrib- ute names. However, it is really more of a performance optimization. Classes that use _ _slots_ _ don’t use a dictionary for storing instance data (instead, a more efficient internal data structure is used). So, not only will instances use far less memory, but access to instance data is also more efficient. In some cases, simply adding _ _slots_ _ will make a program run noticeably faster without making any other changes.\n\nThere is one caution with using _ _slots_ _, however.Adding this feature to a class\n\nmay cause other code to break mysteriously. For example, it is generally well-known that instances store their data in a dictionary that can be accessed as the _ _dict_ _ attribute.When slots are defined, this attribute doesn’t exist so any code that relies on _ _dict_ _ will fail.\n\nAvoid the (.) Operator Whenever you use the (.) to look up an attribute on an object, it always involves a name lookup. For example, when you say x.name, there is a lookup for the variable name \"x\" in the environment and then a lookup for the attribute \"name\" on x. For user-defined objects, attribute lookup may involve looking in the instance dictionary, the class dictionary, and the dictionaries of base-classes.\n\nFor calculations involving heavy use of methods or module lookups, it is almost always better to eliminate the attribute lookup by putting the operation you want to perform into a local variable first. For example, if you were performing a lot of square root operations, it is faster to use 'from math import sqrt' and 'sqrt(x)' rather than typing 'math.sqrt(x)'. In the first part of this section, we saw that this approach resulted in speedup of about 1.4.\n\nObviously you should not try to eliminate attribute lookups everywhere in your program because it will make your code very difficult to read. However, for performance-critical sections, this is a useful technique.\n\nUse Exceptions to Handle Uncommon Cases To avoid errors, you might be inclined to add extra checks to a program. For example:\n\ndef parse_header(line):\n\nfields = line.split(\":\") if len(fields) != 2:\n\nraise RuntimeError(\"Malformed header\")\n\nheader, value = fields return header.lower(), value.strip()\n\nF h Lib f L Bdff",
      "content_length": 2692,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 222,
      "content": "Tuning and Optimization\n\n197\n\nHowever, an alternative way to handle errors is to simply let the program generate an exception and to catch it. For example:\n\ndef parse_header(line):\n\nfields = line.split(\":\") try:\n\nheader, value = fields return header.lower(), value.strip()\n\nexcept ValueError:\n\nraise RuntimeError(\"Malformed header\")\n\nIf you benchmark both versions on a properly formatted line, the second version of code runs about 10 percent faster. Setting up a try block for code that normally doesn’t raise an exceptions runs more quickly than executing an if statement.\n\nAvoid Exceptions for Common Cases Don’t write code that uses exception handling for the common case. For example, sup- pose you had a program that performed a lot of dictionary lookups, but most of these lookups were for keys that didn’t exist. Now, consider two approaches to performing a lookup:\n\n# Approach 1 : Perform a lookup and catch an exception\n\ntry:\n\nvalue = items[key]\n\nexcept KeyError: value = None\n\n# Approach 2: Check if the key exists and perform a lookup if key in items:\n\nvalue = items[key]\n\nelse:\n\nvalue = None\n\nIn a simple performance measurement where the key is not found, the second approach runs more than 17 times faster! In case you were wondering, this latter approach also runs almost twice as fast as using items.get(key) because the in operator is faster to execute than a method call.\n\nEmbrace Functional Programming and Iteration List comprehensions, generator expressions, generators, coroutines, and closures are much more efficient than most Python programmers realize. For data processing espe- cially, list comprehensions and generator expressions run significantly more quickly than code that manually iterates over data and carries out similar operations.These operations also run much more quickly than legacy Python code that uses functions such as map() and filter(). Generators can be used to write code that not only runs fast, but which makes efficient use of memory.\n\nUse Decorators and Metaclasses Decorators and metaclasses are features that are used to modify functions and classes. However, because they operate at the time of function or class definition, they can be used in ways that lead to improved performance—especially if a program has many optional features that might be turned on or off. Chapter 6,“Functions and Functional Programming,” has an example of using a decorator to enable logging of functions, but in a way that does not impact performance when logging is disabled.\n\nF h Lib f L Bdff",
      "content_length": 2532,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 223,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 224,
      "content": "II\n\nThe Python Library\n\n12 Built-In Functions\n\n13\n\nPython Runtime Services\n\n14 Mathematics\n\n15 Data Structures, Algorithms, and Utilities\n\n16 String and Text Handling\n\n17\n\nPython Database Access\n\n18\n\nFile and Directory Handling\n\n19 Operating System Services\n\n20\n\nThreads and Concurrency\n\n21 Network Programming and Sockets\n\n22\n\nInternet Application Programming\n\n23 Web Programming\n\n24\n\nInternet Data Handling and Encoding\n\n25 Miscellaneous Library Modules\n\nF h Lib f L Bdff",
      "content_length": 473,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 225,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 226,
      "content": "12\n\nBuilt-In Functions and Exceptions\n\nThis chapter describes Python’s built-in functions and exceptions. Much of this mate-\n\nrial is covered less formally in earlier chapters of this book.This chapter merely consoli- dates all this information into one section and expands upon some of the more subtle features of certain functions.Also, Python 2 includes a number of built-in functions that are considered to be obsolete and which have been removed from Python 3.Those functions are not documented here—instead the focus is on modern functionality.\n\nBuilt-in Functions and Types Certain types, functions, and variables are always available to the interpreter and can be used in any source module.Although you don’t need to perform any extra imports to access these functions, they are contained in a module _ _builtin_ _ in Python 2 and in a module builtins in Python 3.Within other modules that you import, the variable _ _builtins_ _ is also bound to this module.\n\nabs(x)\n\nReturns the absolute value of x.\n\nall(s)\n\nReturns True if all of the values in the iterable sevaluate as True.\n\nany(s)\n\nReturns True if any of the values in the iterable sevaluate as True.\n\nascii(x)\n\nCreates a printable representation of the object xjust like the repr(), but only uses ASCII characters in the result. Non-ASCII characters are turned into appropriate escape sequences.This can be used to view Unicode strings in a terminal or shell that doesn’t support Unicode. Python 3 only.\n\nF h Lib f L Bdff",
      "content_length": 1487,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 227,
      "content": "202\n\nChapter 12 Built-In Functions and Exceptions\n\nbasestring\n\nThis is an abstract data type that is the superclass of all strings in Python 2 (str and unicode). It is only used for type testing of strings. For example, isinstance(s,basestring) returns True if sis either kind of string. Python 2 only.\n\nbin(x)\n\nReturns a string containing the binary representation of the integer x.\n\nbool([x])\n\nType representing Boolean values True and False. If used to convert x, it returns True if xevaluates to true using the usual truth-testing semantics (that is, nonzero number, non-empty list, and so on). Otherwise, False is returned. False is also the default value returned if bool() is called without any arguments.The bool class inherits from int so the Boolean values True and False can be used as integers with values 1 and 0 in mathematical calculations.\n\nbytearray([x])\n\nA type representing a mutable array of bytes.When creating an instance, xmay be an iterable sequence of integers in the range 0 to 255, an 8-bit string or bytes literal, or an integer that specifies the size of the byte array (in which case every entry will be initial- ized to 0).A bytearray object alooks like an array of integers. If you perform a lookup such as a[i], you will get an integer value representing the byte value at index i.Assignments such as a[i] = valso require vto be an integer byte value. However, a bytearray also provides all of the operations normally associated with strings (that is, slicing, find(), split(), replace(), and so on).When using these string operations, you should be careful to preface all string literals with b in order to indicate that you’re working with bytes. For example, if you wanted to split a byte array ainto fields using a comma character separator, you would use a.split(b',') not a.split(',').The result of these operations is always new bytearray objects, not strings.To turn a bytearray ainto a string, use the a.decode(encoding) method.An encoding of 'latin-1' will directly turn a bytearray of 8-bit characters into a string without any modification of the underlying character values.\n\nbytearray(s ,encoding)\n\nAn alternative calling convention for creating a bytearray instance from characters in a string swhere encodingspecifies the character encoding to use in the conversion.\n\nbytes([x])\n\nA type representing an immutable array of bytes. In Python 2, this is an alias for str() which creates a standard 8-bit string of characters. In Python 3, bytes is a completely separate type that is an immutable version of the bytearray type described earlier. In that case, the argument xhas the same interpretation and can be used in the same man- ner. One portability caution is that even though bytes is defined in Python 2, the resulting object does not behave consistently with Python 3. For example, if ais an instance created by bytes(), then a[i] returns a character string in Python 2, but returns an integer in Python 3.\n\nF h Lib f L Bdff",
      "content_length": 2978,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 228,
      "content": "Built-in Functions and Types\n\n203\n\nbytes(s, encoding)\n\nAn alternative calling convention for creating a bytes instance from characters in a string swhere encodingspecifies the character encoding to use. Python 3 only.\n\nchr(x)\n\nConverts an integer value, x, into a one-character string. In Python 2, xmust be in the range 0 <= x <= 255, and in Python 3, xmust represent a valid Unicode code point. If xis out of range, a ValueError exception is raised.\n\nclassmethod(func)\n\nThis function creates a class method for the function func. It is typically only used inside class definitions where it is implicitly invoked by the @classmethod decorator. Unlike a normal method, a class method receives the class as the first argument, not an instance. For example, if you had an object, f, that is an instance of class Foo, invoking a class method on f will pass the class Foo as the first argument to the method, not the instance f.\n\ncmp(x, y)\n\nCompares xand yand returns a negative number if x < y, a positive number if x > y, or 0 if x == y.Any two objects can be compared, although the result may be meaning- less if the two objects have no meaningful comparison method defined (for example, comparing a number with a file object). In certain circumstances, such comparisons may also raise an exception.\n\ncompile(string, filename, kind [, flags [, dont_inherit]])\n\nCompiles stringinto a code object for use with exec() or eval(). stringis a string containing valid Python code. If this code spans multiple lines, the lines must be terminated by a single newline ('\\n') and not platform-specific variants (for example, '\\r\\n' on Windows). filenameis a string containing the name of the file in which the string was defined. kindis 'exec' for a sequence of statements, 'eval' for a single expression, or 'single' for a single executable statement.The flagsparameter deter- mines which optional features (associated with the _ _future_ _ module) are enabled. Features are specified using the bitwise OR of flags defined in the _ _future_ _ mod- ule. For example, if you wanted to enable new division semantics, you would set flags to _ _future_ _.division.compiler_flag. If flagsis omitted or set to 0, the code is compiled with whatever features are currently in effect. If flagsis supplied, the fea- tures specified are added to those features already in effect. If dont_inherit is set, only those features specified in flagsare enabled—features currently enabled are ignored.\n\ncomplex([real [, imag]])\n\nType representing a complex number with real and imaginary components, realand imag, which can be supplied as any numeric type. If imagis omitted, the imaginary component is set to zero. If realis passed as a string, the string is parsed and converted to a complex number. In this case, imagshould be omitted. If no arguments are given, 0j is returned.\n\ndelattr(object, attr)\n\nDeletes an attribute of an object. attris a string. Same as del object.attr.\n\nF h Lib f L Bdff",
      "content_length": 2969,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 229,
      "content": "204\n\nChapter 12 Built-In Functions and Exceptions\n\ndict([m]) or dict(key1 = value1, key2 = value2, ...)\n\nType representing a dictionary. If no argument is given, an empty dictionary is returned. If mis a mapping object (such as a dictionary), a new dictionary having the same keys and same values as mis returned. For example, if mis a dictionary, dict(m) simply makes a shallow copy of it. If mis not a mapping, it must support iteration in which a sequence of (key,value) pairs is produced.These pairs are used to populate the dic- tionary. dict() can also be called with keyword arguments. For example, dict(foo=3, bar=7) creates the dictionary { 'foo' : 3, 'bar' : 7 }.\n\ndir([object])\n\nReturns a sorted list of attribute names. If objectis a module, it contains the list of symbols defined in that module. If objectis a type or class object, it returns a list of attribute names.The names are typically obtained from the object’s _ _dict_ _ attribute if defined, but other sources may be used. If no argument is given, the names in the current local symbol table are returned. It should be noted that this function is primari- ly used for informational purposes (for example, used interactively at the command line). It should not be used for formal program analysis because the information obtained may be incomplete.Also, user-defined classes can define a special method _ _dir_ _() that alters the result of this function.\n\ndivmod(a, b)\n\nReturns the quotient and remainder of long division as a tuple. For integers, the value (a // b, a % b) is returned. For floats, (math.floor(a / b), a % b) is returned.This function may not be called with complex numbers.\n\nenumerate(iter[, initial value)\n\nGiven an iterable object, iter, returns a new iterator (of type enumerate) that pro- duces tuples containing a count and the value produced from iter. For example, if iterproduces a, b, c, then enumerate(iter) produces (0,a), (1,b), (2,c).\n\neval(expr [, globals [, locals]])\n\nEvaluates an expression. expris a string or a code object created by compile(). globalsand localsare mapping objects that define the global and local namespaces, respectively, for the operation. If omitted, the expression is evaluated in the namespace of the caller. It is most common for globalsand localsto be specified as dictionaries, but advanced applications can supply custom mapping objects.\n\nexec(code [, global [, locals]])\n\nExecutes Python statements. codeis a string, a file, or a code object created by compile(). globalsand localsdefine the global and local namespaces, respectively, for the operation. If omitted, the code is executed in the namespace of the caller. If no global or local dictionaries are given, the behavior of this function is a little muddled between Python versions. In Python 2, exec is actually implemented as a special lan- guage statement, whereas Python 3 implements it as a standard library function.A subtle side effect of this implementation difference is that in Python 2, code evaluated by exec can freely mutate local variables in the caller’s namespace. In Python 3, you can execute code that makes such changes, but they don’t seem to have any lasting effect beyond the exec() call itself.This is because Python 3 uses locals() to obtain the local name- space if one isn’t supplied.As you will note in the documentation for locals(), the returned dictionary is only safe to inspect, not modify.\n\nF h Lib f L Bdff",
      "content_length": 3438,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 230,
      "content": "Built-in Functions and Types\n\n205\n\nfilter(function, iterable)\n\nIn Python 2, this creates a list consisting of the objects from iterablefor which func- tionevaluates to true. In Python 3, the result is an iterator that produces this result. If functionis None, the identity function is used and all the elements of iterablethat are false are removed. iterablecan be any object that supports iteration.As a general rule, it is significantly faster to use a generator expression or list comprehension to filter data (refer to Chapter 6).\n\nfloat([x])\n\nType representing a floating-point number. If xis a number, it is converted to a float. If xis a string, it is parsed into a float. If no argument is supplied, 0.0 is returned.\n\nformat(value [, format_spec])\n\nConverts valueto a formatted string according to the format specification string in format_spec.This operation invokes value._ _format_ _(), which is free to inter- pret the format specification as it sees fit. For simple types of data, the format specifier typically includes an alignment character of '<', '>’, or '^'; a number (which indicates the field width); and a character code of 'd', 'f', or 's' for integer, floating point, or string values, respectively. For example, a format specification of 'd' formats an integer, a specification of '8d' right aligns an integer in an 8-character field and '<8d' left aligns an integer in an 8-character field. More details on format() and format speci- fiers can be found in Chapter 3,“Types and Objects,” and Chapter 4,“Operators and Expressions.”\n\nfrozenset([items])\n\nType representing an immutable set object populated with values taken from itemsthat must be an iterable.The values must also be immutable. If no argument is given, an empty set is returned.\n\ngetattr(object, name [,default])\n\nReturns the value of a named attribute of an object. nameis a string containing the attribute name. defaultis an optional value to return if no such attribute exists. Otherwise, AttributeError is raised. Same as object.name.\n\nglobals()\n\nReturns the dictionary of the current module that represents the global namespace. When called inside another function or method, it returns the global namespace of the module in which the function or method was defined.\n\nhasattr(object, name)\n\nReturns True if nameis the name of an attribute of object. False is returned other- wise. nameis a string.\n\nhash(object)\n\nReturns an integer hash value for an object (if possible).The hash value is primarily used in the implementation of dictionaries, sets, and other mapping objects.The hash value is the same for any two objects that compare as equals. Mutable objects don’t define a hash value, although user-defined classes can define a method _ _hash_ _() to support this operation.\n\nF h Lib f L Bdff",
      "content_length": 2790,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 231,
      "content": "206\n\nChapter 12 Built-In Functions and Exceptions\n\nhelp([object])\n\nCalls the built-in help system during interactive sessions. objectmay be a string repre- senting the name of a module, class, function, method, keyword, or documentation topic. If it is any other kind of object, a help screen related to that object will be pro- duced. If no argument is supplied, an interactive help tool will start and provide more information.\n\nhex(x)\n\nCreates a hexadecimal string from an integer x.\n\nid(object)\n\nReturns the unique integer identity of object.You should not interpret the return value in any way (that is, as a memory location).\n\ninput([prompt])\n\nIn Python 2, this prints a prompt, reads a line of input, and processes it through eval() (that is, it’s the same as eval(raw_input(prompt)). In Python 3, a prompt is printed to standard output and a single line of input is read without any kind of evaluation or modification.\n\nint(x [,base])\n\nType representing an integer. If xis a number, it is converted to an integer by truncat- ing toward 0. If it is a string, it is parsed into an integer value. baseoptionally specifies a base when converting from a string. In Python 2, a long integer is created if the value exceeds the 32-bit range of the int type.\n\nisinstance(object, classobj)\n\nReturns True if objectis an instance of classobj, is a subclass of classobj, or belongs to an abstract base class classobj.The classobjparameter can also be a tuple of possible types or classes. For example, isinstance(s, (list,tuple)) returns True if sis a tuple or a list.\n\nissubclass(class1, class2)\n\nReturns True if class1is a subclass of (derived from) class2or if class1is regis- tered with an abstract base class class2. class2can also be a tuple of possible classes, in which case each class will be checked. Note that issubclass(A, A) is true.\n\niter(object [,sentinel])\n\nReturns an iterator for producing items in object. If the sentinelparameter is omit- ted, the object must either provide the method _ _iter_ _(), which creates an iterator, or implement _ _getitem_ _(), which accepts integer arguments starting at 0. If sen- tinelis specified, objectis interpreted differently. Instead, objectshould be a callable object that takes no parameters.The returned iterator object will call this function repeatedly until the returned value is equal to sentinel, at which point iteration will stop.A TypeError will be generated if objectdoes not support iteration.\n\nlen(s)\n\nReturns the number of items contained in s. sshould be a list, tuple, string, set, or dic- tionary.A TypeError is generated if sis an iterable such as a generator.\n\nF h Lib f L Bdff",
      "content_length": 2652,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 232,
      "content": "Built-in Functions and Types\n\n207\n\nlist([items])\n\nType representing a list. itemsmay be any iterable object, the values of which are used to populate the list. If itemsis already a list, a copy is made. If no argument is given, an empty list is returned.\n\nlocals()\n\nReturns a dictionary corresponding to the local namespace of the caller.This dictionary should only be used to inspect the execution environment—it is not safe to modify the contents of this dictionary.\n\nlong([x [, base]])\n\nType representing long integers in Python 2. If xis a number, it is converted to an inte- ger by truncating toward 0. If xis a string, it is parsed into a long value. If no argument is given, this function returns 0L. For portability, you should avoid direct use of long. Using int(x) will create a long as necessary. For type checking, use isinstance(x, numbers.Integral) to check if xis any integer type.\n\nmap(function, items, ...)\n\nIn Python 2, this applies functionto every item of itemsand returns a list of results. In Python 3, an iterator producing the same results is created. If multiple input sequences are supplied, functionis assumed to take that many arguments, with each argument taken from a different sequence.The behavior when processing multiple input sequences differs between Python 2 and Python 3. In Python 2, the result is the same length as the longest input sequence with None used as a padding value when the shorter input sequences are exhausted. In Python 3, the result is only as long as the shortest sequence.The functionality provided by map() is almost always better expressed using a generator expression or list comprehension (both of which provide better per- formance). For example, map(function, s) can usually be replaced by [function(x) for x in s].\n\nmax(s [, args, ...])\n\nFor a single argument, s, this function returns the maximum value of the items in s, which may be any iterable object. For multiple arguments, it returns the largest of the arguments.\n\nmin(s [, args, ...])\n\nFor a single argument, s, this function returns the minimum value of the items in s, which may be any iterable object. For multiple arguments, it returns the smallest of the arguments.\n\nnext(s [, default])\n\nReturns the next item from the iterator s. If the iterator has no more items, a StopIteration exception is raised unless a value is supplied to the defaultargument. In that case, defaultis returned instead. For portability, you should always use this function instead of calling s.next() directly on an iterator s. In Python 3, the name of the underlying iterator method changed to s._ _next_ _(). If you write your code to use the next() function, you won’t have to worry about this difference.\n\nF h Lib f L Bdff",
      "content_length": 2730,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 233,
      "content": "208\n\nChapter 12 Built-In Functions and Exceptions\n\nobject()\n\nThe base class for all objects in Python.You can call it to create an instance, but the result isn’t especially interesting.\n\noct(x)\n\nConverts an integer, x, to an octal string.\n\nopen(filename [, mode [, bufsize]])\n\nIn Python 2, opens the file filenameand returns a new file object (refer to Chapter 9, “Input and Output”). modeis a string that indicates how the file should be opened: 'r' for reading, 'w' for writing, and 'a' for appending.A second character 't' or 'b' is used to indicate text-mode (the default) or binary mode. For example, 'r' or 'rt' opens a file in text mode, whereas 'rb' opens a file in binary mode.An optional '+' can be added to the mode to open the file for updating (which allows both reading and writing).A mode of 'w+' truncates the file to zero length if it already exists.A mode of 'r+' or 'a+' opens the file for both reading and writing but leaves the original con- tents intact when the file is opened. If a mode of 'U' or 'rU' is specified, the file is opened in universal newline mode. In this mode, all variants of a newline ('\\n', '\\r', '\\r\\n') are converted to the standard '\\n' character. If the mode is omitted, a mode of 'rt' is assumed.The bufsize argument specifies the buffering behavior, where 0 is unbuffered, 1 is line buffered, and any other positive number indicates an approximate buffer size in bytes.A negative number indicates that the system default buffering should be used (this is the default behavior).\n\nopen(filename [, mode [, bufsize [, encoding [, errors [, newline [, closefd]]]]]])\n\nIn Python 3, this opens the file filenameand returns a file object.The first three argu- ments have the same meaning as for the Python 2 version of open() described earlier. encodingis an encoding name such as 'utf-8'. errorsis the error handling policy and is one of 'strict', 'ignore', 'replace', 'backslashreplace', or 'xmlcharrefreplace'. newlinecontrols the behavior of universal newline mode and is set to None, '', '\\n', '\\r', or '\\r\\n'. closefdis a Boolean flag that specifies whether the underlying file descriptor is closed when the close() method executes. Unlike Python 2, different kinds of objects are returned depending on the selected I/O mode. For example, if you open a file in binary mode, you get an object where I/O operations such as read() and write() operate on byte arrays instead of strings. File I/O is one area where there are significant differences between Python 2 and 3. Consult Appendix A,“Python 3,” for more details.\n\nord(c)\n\nReturns the integer ordinal value of a single character, c. For ordinary characters, a value in the range [0,255] is returned. For single Unicode characters, a value in the range [0,65535] is usually returned. In Python 3, cmay also be a Unicode surrogate pair, in which case it is converted into the appropriate Unicode code point.\n\npow(x, y [, z])\n\nReturns x ** y. If zis supplied, this function returns (x ** y) % z. If all three argu- ments are given, they must be integers and ymust be nonnegative.\n\nF h Lib f L Bdff",
      "content_length": 3094,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 234,
      "content": "Built-in Functions and Types\n\n209\n\nprint(value, ... [, sep=separator, end=ending, file=outfile])\n\nPython 3 function for printing a series of values.As input, you can supply any number of values, all of which are printed on the same line.The sep keyword argument is used to specify a different separator character (a space by default).The end keyword argu- ment specifies a different line ending ('\\n' by default).The file keyword argument redirects the output to a file object.This function can be used in Python 2 if you add the statement from _ _future_ _ import print_function to your code.\n\nproperty([fget [,fset [,fdel [,doc]]]])\n\nCreates a property attribute for classes. fgetis a function that returns the attribute value, fsetsets the attribute value, and fdeldeletes an attribute. docprovides a docu- mentation string.These parameters may be supplied using keyword arguments—for example, property(fget=getX, doc=\"some text\").\n\nrange([start,] stop [, step])\n\nIn Python 2, this creates a fully populated list of integers from startto stop. step indicates a stride and is set to 1 if omitted. If startis omitted (when range() is called with one argument), it defaults to 0.A negative stepcreates a list of numbers in descending order. In Python 3, range() creates a special range object that computes its values on demand (like xrange() in previous Python versions).\n\nraw_input([prompt])\n\nPython 2 function that reads a line of input from standard input (sys.stdin) and returns it as a string. If promptis supplied, it’s first printed to standard output (sys.stdout).Trailing newlines are stripped, and an EOFError exception is raised if an EOF is read. If the readline module is loaded, this function will use it to provide advanced line-editing and command-completion features. Use input() to read input in Python 3.\n\nrepr(object)\n\nReturns a string representation of object. In most cases, the returned string is an expression that can be passed to eval() to re-create the object. Be aware that in Python 3, the result of this function may be a Unicode string that can’t be displayed in the terminal or shell window (resulting in an exception). Use the ascii() function to create an ASCII representation of object.\n\nreversed(s)\n\nCreates a reverse iterator for sequence s.This function only works if simplements the sequence methods _ _len_ _() and _ _getitem_ _(). In addition, smust index items starting at 0. It does not work with generators or iterators.\n\nround(x [, n])\n\nRounds the result of rounding the floating-point number xto the closest multiple of 10 to the power minus n. If nis omitted, it defaults to 0. If two multiples are equally close, Python 2 rounds away from 0 (for example, 0.5 is rounded to 1.0 and -0.5 is rounded to -1.0). Python 3 rounds toward 0 if the previous digit is even and away from 0 oth- erwise (for example, 0.5 is rounded to 0.0 and 1.5 is rounded to 2).\n\nF h Lib f L Bdff",
      "content_length": 2918,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 235,
      "content": "210\n\nChapter 12 Built-In Functions and Exceptions\n\nset([items])\n\nCreates a set populated with items taken from the iterable object items.The items must be immutable. If itemscontains other sets, those sets must be of type frozenset. If itemsis omitted, an empty set is returned.\n\nsetattr(object, name, value)\n\nSets an attribute of an object. nameis a string. Same as object.name = value.\n\nslice([start,] stop [, step])\n\nReturns a slice object representing integers in the specified range. Slice objects are also generated by the extended slice syntax a[i:i:k]. Refer to the section “Sequence and Mapping Methods” in Chapter 3 for details.\n\nsorted(iterable [, key=keyfunc [, reverse=reverseflag]])\n\nCreates a sorted list from items in iterable.The keyword argument key is a single- argument function that transforms values before they are passed to the compare func- tion.The keyword argument reverse is a Boolean flag that specifies whether or not the resulting list is sorted in reverse order.The key and reverse arguments must be specified using keywords—for example, sorted(a,key=get_name).\n\nstaticmethod(func)\n\nCreates a static method for use in classes.This function is implicitly invoked by the @staticmethod decorator.\n\nstr([object])\n\nType representing a string. In Python 2, a string contains 8-bit characters, whereas in Python 3 strings are Unicode. If objectis supplied, a string representation of its value is created by calling its _ _str_ _() method.This is the same string that you see when you print the object. If no argument is given, an empty string is created.\n\nsum(items [,initial])\n\nComputes the sum of a sequence of items taken from the iterable object items. initialprovides the starting value and defaults to 0.This function only works with numbers.\n\nsuper(type [, object])\n\nReturns an object that represents the superclasses of type.The primary purpose of this object is to invoke methods in base classes. Here’s an example: class B(A):\n\ndef foo(self):\n\nsuper(B,self).foo()\n\nIf objectis an object, then isinstance(object, type) must be true. If objectis a type, then it must be a subclass of type. Refer to Chapter 7,“Classes and Object- Oriented Programming,” for more details. In Python 3, you can use super() in a method with no arguments. In this case, typeis set to the class in which the method is defined and objectis set to the first argument of the method.Although this cleans up the syntax, it’s not backwards-compatible with Python 2 so it should be avoided if you’re concerned about portability.\n\nF h Lib f L Bdff",
      "content_length": 2551,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 236,
      "content": "Built-in Functions and Types\n\n211\n\ntuple([items])\n\nType representing a tuple. If supplied, itemsis an iterable object that is used to popu- late the tuple. However, if itemsis already a tuple, it’s simply returned unmodified. If no argument is given, an empty tuple is returned.\n\ntype(object)\n\nThe base class of all types in Python.When called as a function, returns the type of object.This type is the same as the object’s class. For common types such as integers, floats, and lists, the type will refer to one of the other built-in classes such as int, float, list, and so forth. For user-defined objects, the type is the associated class. For objects related to Python’s internals, you will typically get a reference to one of the classes defined in the types module.\n\ntype(name,bases,dict)\n\nCreates a new typeobject (which is the same as defining a new class). nameis the name of the type, basesis a tuple of base classes, and dictis a dictionary containing definitions corresponding to a class body.This function is most commonly used when working with metaclasses.This is described further in Chapter 7.\n\nunichr(x)\n\nConverts the integer or long integer x, where 0 <= x <= 65535, to a single Unicode character. Python 2 only. In Python 3, just use chr(x).\n\nunicode(string [,encoding [,errors]])\n\nIn Python 2, this converts stringto a Unicode string. encodingspecifies the data encoding of string. If omitted, the default encoding as returned by sys.getdefaultencoding() is used. errorsspecifies how encoding errors are han- dled and is one of 'strict', 'ignore', 'replace', 'backslashreplace', or 'xmlcharrefreplace'. Refer to Chapter 9 and Chapter 3 for details. Not available in Python 3.\n\nvars([object])\n\nReturns the symbol table of object(usually found in its _ _dict_ _ attribute). If no argument is given, a dictionary corresponding to the local namespace is returned.The dictionary returned by this function should be assumed to be read-only. It’s not safe to modify its contents.\n\nxrange([start,] stop [, step])\n\nA type representing a range of integer values from startto stopthat is not included. stepprovides an optional stride.The values are not actually stored but are computed on demand when accessed. In Python 2, xrange() is the preferred function to use when you want to write loops over ranges of integer values. In Python 3, xrange() has been renamed to range() and xrange() is unavailable. start, stop, and stepare limited to the set of values supported by machine integers (typically 32 bits).\n\nzip([s1 [, s2 [,..]]])\n\nIn Python 2, returns a list of tuples where the nth tuple is (s1[n], s2[n], ...).The resulting list is truncated to the length of the shortest argument sequence. If no argu- ments are given, an empty list is returned. In Python 3, the behavior is similar, but the\n\nF h Lib f L Bdff",
      "content_length": 2825,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 237,
      "content": "212\n\nChapter 12 Built-In Functions and Exceptions\n\nresult is an iterator that produces a sequence of tuples. In Python 2, be aware that using zip() with long input sequences is something that can unintentionally consume large amounts of memory. Consider using itertools.izip() instead.\n\nBuilt-In Exceptions Built-in exceptions are contained in the exceptions module, which is always loaded prior to the execution of any program. Exceptions are defined as classes.\n\nException Base Classes The following exceptions serve as base classes for all the other exceptions:\n\nBaseException\n\nThe root class for all exceptions.All built-in exceptions are derived from this class.\n\nException\n\nThe base class for all program-related exceptions that includes all built-in exceptions except for SystemExit, GeneratorExit, and KeyboardInterrupt. User-defined exceptions should be defined by inheriting from Exception.\n\nArithmeticError\n\nThe base class for arithmetic exceptions, including OverflowError, ZeroDivisionError, and FloatingPointError.\n\nLookupError\n\nThe base class for indexing and key errors, including IndexError and KeyError.\n\nEnvironmentError\n\nThe base class for errors that occur outside Python, including IOError and OSError. The preceding exceptions are never raised explicitly. However, they can be used to catch certain classes of errors. For instance, the following code would catch any sort of numerical error:\n\ntry:\n\n# Some operation ...\n\nexcept ArithmeticError as e:\n\n# Math error\n\nException Instances When an exception is raised, an instance of an exception class is created.This instance is placed in the optional variable supplied to the except statement. Here’s an example:\n\nexcept IOError as e:\n\n# Handle error # 'e' has an instance of IOError\n\nInstances of an exception ehave a few standard attributes that can be useful to inspect and/or manipulate in certain applications.\n\nF h Lib f L Bdff",
      "content_length": 1904,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 238,
      "content": "Built-In Exceptions\n\n213\n\ne.args\n\nThe tuple of arguments supplied when raising the exception. In most cases, this is a one-item tuple with a string describing the error. For EnvironmentError exceptions, the value is a 2-tuple or 3-tuple containing an integer error number, a string error mes- sage, and an optional filename.The contents of this tuple might be useful if you need to re-create the exception in a different context; for example, to raise an exception in a different Python interpreter process.\n\ne.message\n\nA string representing the error message that gets printed when the exception is dis- played (Python 2 only).\n\ne._ _cause_ _\n\nPrevious exception when using explicit chained exceptions (Python 3 only). See Appendix A.\n\ne.__context__\n\nPrevious exception for implicitly chained exceptions (Python 3 only). See Appendix A.\n\ne.__traceback__\n\nTraceback object associated with the exception (Python 3 only). See Appendix A.\n\nPredefined Exception Classes The following exceptions are raised by programs:\n\nAssertionError\n\nFailed assert statement.\n\nAttributeError\n\nFailed attribute reference or assignment.\n\nEOFError\n\nEnd of file. Generated by the built-in functions input() and raw_input(). It should be noted that most other I/O operations such as the read() and readline() methods of files return an empty string to signal EOF instead of raising an exception.\n\nFloatingPointError\n\nFailed floating-point operation. It should be noted that floating-point exception- handling is a tricky problem and only that this exception only gets raised if Python has been configured and built in a way that enables it. It is more common for floating-point errors to silently produce results such as float('nan') or float('inf').A subclass of ArithmeticError.\n\nGeneratorExit\n\nRaised inside a generator function to signal termination.This happens when a generator is destroyed prematurely (before all generator values are consumed) or the close() method of a generator is called. If a generator ignores this exception, the generator is terminated and the exception is silently ignored.\n\nF h Lib f L Bdff",
      "content_length": 2099,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 239,
      "content": "214\n\nChapter 12 Built-In Functions and Exceptions\n\nIOError\n\nFailed I/O operation.The value is an IOError instance with the attributes errno, strerror, and filename. errno is an integer error number, strerror is a string error message, and filename is an optional filename.A subclass of EnvironmentError.\n\nImportError\n\nRaised when an import statement can’t find a module or when from can’t find a name in a module.\n\nIndentationError\n\nIndentation error.A subclass of SyntaxError.\n\nIndexError\n\nSequence subscript out of range.A subclass of LookupError.\n\nKeyError\n\nKey not found in a mapping.A subclass of LookupError.\n\nKeyboardInterrupt\n\nRaised when the user hits the interrupt key (usually Ctrl+C).\n\nMemoryError\n\nRecoverable out-of-memory error.\n\nNameError\n\nName not found in local or global namespaces.\n\nNotImplementedError\n\nUnimplemented feature. Can be raised by base classes that require derived classes to implement certain methods.A subclass of RuntimeError.\n\nOSError\n\nOperating system error. Primarily raised by functions in the os module.The value is the same as for IOError.A subclass of EnvironmentError.\n\nOverflowError\n\nResult of an integer value being too large to be represented.This exception usually only arises if large integer values are passed to objects that internally rely upon fixed- precision machine integers in their implementation. For example, this error can arise with range or xrange objects if you specify starting or ending values that exceed 32 bits in size.A subclass of ArithmeticError.\n\nReferenceError\n\nResult of accessing a weak reference after the underlying object has been destroyed. See the weakref module.\n\nRuntimeError\n\nA generic error not covered by any of the other categories.\n\nF h Lib f L Bdff",
      "content_length": 1737,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 240,
      "content": "Built-In Exceptions\n\n215\n\nStopIteration\n\nRaised to signal the end of iteration.This normally happens in the next() method of an object or in a generator function.\n\nSyntaxError\n\nParser syntax error. Instances have the attributes filename, lineno, offset, and text, which can be used to gather more information.\n\nSystemError\n\nInternal error in the interpreter.The value is a string indicating the problem.\n\nSystemExit\n\nRaised by the sys.exit() function.The value is an integer indicating the return code. If it’s necessary to exit immediately, os._exit() can be used.\n\nTabError\n\nInconsistent tab usage. Generated when Python is run with the -tt option.A subclass of SyntaxError.\n\nTypeError\n\nOccurs when an operation or a function is applied to an object of an inappropriate type.\n\nUnboundLocalError\n\nUnbound local variable referenced.This error occurs if a variable is referenced before it’s defined in a function.A subclass of NameError.\n\nUnicodeError\n\nUnicode encoding or decoding error.A subclass of ValueError.\n\nUnicodeEncodeError\n\nUnicode encoding error.A subclass of UnicodeError.\n\nUnicodeDecodeError\n\nUnicode decoding error.A subclass of UnicodeError.\n\nUnicodeTranslateError\n\nUnicode error occurred during translation.A subclass of UnicodeError.\n\nValueError\n\nGenerated when the argument to a function or an operation is the right type but an inappropriate value.\n\nWindowsError\n\nGenerated by failed system calls on Windows.A subclass of OSError.\n\nZeroDivisionError\n\nDividing by zero.A subclass of ArithmeticError.\n\nF h Lib f L Bdff",
      "content_length": 1535,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 241,
      "content": "216\n\nChapter 12 Built-In Functions and Exceptions\n\nBuilt-In Warnings Python has a warnings module that is typically used to notify programmers about dep- recated features.Warnings are issued by including code such as the following:\n\nimport warnings warnings.warn(\"The MONDO flag is no longer supported\", DeprecationWarning)\n\nAlthough warnings are issued by a library module, the names of the various warnings are built-in.Warnings are somewhat similar to exceptions.There is a hierarchy of built- in warnings that all inherit from Exception.\n\nWarning\n\nThe base class of all warnings.A subclass of Exception.\n\nUserWarning\n\nA generic user-defined warning.A subclass of Warning.\n\nDeprecationWarning\n\nA warning for deprecated features.A subclass of Warning.\n\nSyntaxWarning\n\nA warning for deprecated Python syntax.A subclass of Warning.\n\nRuntimeWarning\n\nA warning for potential runtime problems.A subclass of Warning.\n\nFutureWarning\n\nA warning that the behavior of a feature will change in the future.A subclass of Warning.\n\nWarnings are different than exceptions in that the issuing of a warning with the warn() function may or may not cause a program to stop. For example, a warning may just print something to the output or it may raise an exception.The actual behavior can be configured with the warnings module or with the -W option to the interpreter. If you are using someone else’s code that generates a warning, but you would like to pro- ceed anyways, you can catch warnings that have been turned into exceptions using try and except. For example:\n\ntry:\n\nimport md5\n\nexcept DeprecationWarning:\n\npass\n\nIt should be emphasized that code such as this is rare.Although it will catch a warning that has been turned into an exception, it doesn’t suppress warning messages (you have to use the warnings module to control that). Plus, ignoring warnings is a good way to write code that doesn’t work correctly when new versions of Python are released.\n\nF h Lib f L Bdff",
      "content_length": 1965,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 242,
      "content": "future_builtins\n\n217\n\nfuture_builtins The future_builtins module, only available in Python 2, provides implementations of the built-in functions whose behavior is changed in Python 3.The following func- tions are defined:\n\nascii(object)\n\nProduces the same output as repr(). Refer to the description in the “Built-In Functions” section of this chapter.\n\nfilter(function, iterable)\n\nCreates an iterator instead of a list.The same as itertools.ifilter().\n\nhex(object)\n\nCreates a hexadecimal string, but uses the _ _index_ _() special method to get an inte- ger value instead of calling _ _hex_ _().\n\nmap(function, iterable, ...)\n\nCreates an iterator instead of a list.The same as itertools.imap().\n\noct(object)\n\nCreates an octal string, but uses the _ _index_ _() special method to get an integer value instead of calling _ _oct_ _().\n\nzip(iterable, iterable, ... )\n\nCreates an iterator instead of a list.The same as itertools.izip().\n\nBe aware that the functions listed in this module are not a complete list of changes to the built-in module. For instance, Python 3 also renames raw_input() to input() and xrange() to range().\n\nF h Lib f L Bdff",
      "content_length": 1143,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 243,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 244,
      "content": "13\n\nPython Runtime Services\n\nThis chapter describes modules that are related to the Python interpreter runtime.\n\nTopics include garbage collection, basic management of objects (copying, marshalling, and so on), weak references, and interpreter environment.\n\natexit The atexit module is used to register functions to execute when the Python inter- preter exits.A single function is provided:\n\nregister(func [,args [,kwargs]])\n\nAdds function functo a list of functions that will execute when the interpreter exits. argsis a tuple of arguments to pass to the function. kwargsis a dictionary of keyword arguments.The function is invoked as func(*args,**kwargs). Upon exit, functions are invoked in reverse order of registration (the most recently added exit function is invoked first). If an error occurs, an exception message will be printed to standard error but will otherwise be ignored.\n\ncopy The copy module provides functions for making shallow and deep copies of compound objects, including lists, tuples, dictionaries, and instances of user-defined objects.\n\ncopy(x)\n\nMakes a shallow copy of xby creating a new compound object and duplicating the members of xby reference. For built-in types, it is somewhat uncommon to use this function. Instead, you use calls such as list(x), dict(x), set(x), and so forth to cre- ate a shallow copy of x(it should be noted that using the type name directly like this is also significantly faster than using copy()).\n\ndeepcopy(x [, visit])\n\nMakes a deep copy of xby creating a new compound object and recursively duplicating all the members of x. visitis an optional dictionary that’s used to keep track of visited objects in order to detect and avoid cycles in recursively defined data structures.This argument is typically only supplied if deepcopy() is being called recursively as described later in this chapter.\n\nF h Lib f L Bdff",
      "content_length": 1875,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 245,
      "content": "220\n\nChapter 13 Python Runtime Services\n\nAlthough it is not usually necessary, a class can implement customized copy methods by implementing the methods _ _copy_ _(self) and _ _deepcopy_ _(self, visit), which implement the shallow and deep copy operations respectively.The _ _deepcopy_ _() method must accept a dictionary, visit, which is used to keep track of previously encountered objects during the copy process. It’s not necessary for _ _deepcopy_ _() to do anything with visitother than pass it to other deepcopy() operations carried out in the implementation (if any).\n\nIf a class implements the methods _ _getstate_ _() and _ _setstate_ _() that are used by the pickle module, they will be used by the copy module to create copies.\n\nNotes\n\nn This module can be used with simple types such as integers and strings, but\n\nthere’s little need to do so.\n\nn The copy functions don’t work with modules, class objects, functions, methods, tracebacks, stack frames, files, sockets, and other similar types.When an object can’t be copied, the copy.error exception is raised.\n\ngc The gc module provides an interface for controlling the garbage collector used to col- lect cycles in objects such as lists, tuples, dictionaries, and instances.As various types of container objects are created, they’re placed on a list that’s internal to the interpreter. Whenever container objects are deallocated, they’re removed from this list. If the num- ber of allocations exceeds the number of deallocations by a user-definable threshold value, the garbage collector is invoked.The garbage collector works by scanning this list and identifying collections of objects that are no longer being used but haven’t been deallocated due to circular dependencies. In addition, the garbage collector uses a three- level generational scheme in which objects that survive the initial garbage-collection step are placed onto lists of objects that are checked less frequently.This provides better performance for programs that have a large number of long-lived objects.\n\ncollect([generation])\n\nRuns a full garbage collection.This function checks all generations and returns the number of unreachable objects found. generationis an optional integer in the range 0 - 2 that specifies the generation to collect.\n\ndisable()\n\nDisables garbage collection.\n\nenable()\n\nEnables garbage collection.\n\ngarbage\n\nA variable containing a read-only list of user-defined instances that are no longer in use, but which cannot be garbage collected because they are involved in a reference cycle and they define a _ _del_ _() method. Such objects cannot be garbage-collected because in order to break the reference cycle, the interpreter must arbitrarily destroy\n\nF h Lib f L Bdff",
      "content_length": 2732,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 246,
      "content": "gc\n\n221\n\none of the objects first. However, there is no way to know if the _ _del_ _() method of the remaining objects in the cycle needs to perform critical operations on the object that was just destroyed.\n\nget_count()\n\nReturns a tuple (count0, count1, count2) containing the number of objects cur- rently in each generation.\n\nget_debug()\n\nReturns the debugging flags currently set.\n\nget_objects()\n\nReturns a list of all objects being tracked by the garbage collector. Does not include the returned list.\n\nget_referrers(obj1, obj2, ...)\n\nReturns a list of all objects that directly refer to the objects obj1, obj2, and so on.The returned list may include objects that have not yet been garbage-collected as well as partially constructed objects.\n\nget_referents(obj1, obj2, ...)\n\nReturns a list of objects that the objects obj1, obj2, and so on refer to. For example, if obj1is a container, this would return a list of the objects in the container.\n\nget_threshold()\n\nReturns the current collection threshold as a tuple.\n\nisenabled()\n\nReturns True if garbage collection is enabled.\n\nset_debug(flags)\n\nSets the garbage-collection debugging flags, which can be used to debug the behavior of the garbage collector. flagsis the bitwise OR of the constants DEBUG_STATS, DEBUG_COLLECTABLE, DEBUG_UNCOLLECTABLE, DEBUG_INSTANCES, DEBUG_OBJECTS, DEBUG_SAVEALL, and DEBUG_LEAK.The DEBUG_LEAK flag is probably the most useful because it will have the collector print information useful for debugging programs with memory leaks.\n\nset_threshold(threshold0 [, threshold1[, threshold2]])\n\nSets the collection frequency of garbage collection. Objects are classified into three gen- erations, where generation 0 contains the youngest objects and generation 2 contains the oldest objects. Objects that survive a garbage-collection step are moved to the next- oldest generation. Once an object reaches generation 2, it stays in that generation. threshold0is the difference between the number of allocations and deallocations that must be reached before garbage collection occurs in generation 0. threshold1is the number of collections of generation 0 that must occur before generation 1 is scanned. threshold2is the number of collections that must occur in generation 1 before gener- ation 2 is collected.The default threshold is currently set to (700,10,10). Setting threshold0to 0 disables garbage collection.\n\nF h Lib f L Bdff",
      "content_length": 2410,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 247,
      "content": "222\n\nChapter 13 Python Runtime Services\n\nNotes\n\nn Circular references involving objects with a _ _del_ _() method are not\n\ngarbage-collected and are placed on the list gc.garbage (uncollectable objects). These objects are not collected due to difficulties related to object finalization. n The functions get_referrers() and get_referents() only apply to objects\n\nthat support garbage collection. In addition, these functions are only intended for debugging.They should not be used for other purposes.\n\ninspect The inspect module is used to gather information about live Python objects such as attributes, documentation strings, source code, stack frames, and so on.\n\ncleandoc(doc)\n\nCleans up a documentation string docby changing all tabs into whitespace and remov- ing indentation that might have been inserted to make the docstring line up with other statements inside a function or method.\n\ncurrentframe()\n\nReturns the frame object corresponding to the caller’s stack frame.\n\nformatargspec(args [, varags [, varkw [, defaults]]])\n\nProduces a nicely formatted string representing the values returned by getargspec().\n\nformatargvalues(args [, varargs [, varkw [, locals]]])\n\nProduces a nicely formatted string representing the values returned by getargvalues().\n\ngetargspec(func)\n\nGiven a function, func, returns a named tuple ArgSpec(args, varargs, varkw, defaults). argsis a list of argument names, and varargsis the name of the * argu- ment (if any). varkwis the name of the ** argument (if any), and defaultsis a tuple of default argument values or None if there are no default argument values. If there are default argument values, the defaultstuple represents the values of the last nargu- ments in args, where nis the len(defaults).\n\ngetargvalues(frame)\n\nReturns the values of arguments supplied to a function with execution frame frame. Returns a tuple ArgInfo(args, varargs, varkw, locals). argsis a list of argu- ment names, varargsis the name of the * argument (if any), and varkwis the name of the ** argument (if any). localsis the local dictionary of the frame.\n\ngetclasstree(classes [, unique])\n\nGiven a list of related classes, classes, this function organizes the classes into a hierar- chy based on inheritance.The hierarchy is represented as a collection of nested lists, where each entry in the list is a list of classes that inherit from the class that immediate- ly precedes the list. Each entry in the list is a 2-tuple (cls, bases), where clsis the\n\nF h Lib f L Bdff",
      "content_length": 2491,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 248,
      "content": "inspect\n\n223\n\nclass object and basesis a tuple of base classes. If uniqueis True, each class only appears once in the returned list. Otherwise, a class may appear multiple times if multi- ple inheritance is being used.\n\ngetcomments(object)\n\nReturns a string consisting of comments that immediately precede the definition of objectin Python source code. If objectis a module, comments defined at the top of the module are returned. Returns None if no comments are found.\n\ngetdoc(object)\n\nReturns the documentation string for object.The documentation string is first processed using the cleandoc() function before being returned.\n\ngetfile(object)\n\nReturns the name of the file in which objectwas defined. May return TypeError if this information is not applicable or available (for example, for built-in functions).\n\ngetframeinfo(frame [, context])\n\nReturns a named tuple Traceback(filename, lineno, function, code_context, index) containing information about the frame object frame. filenameand linespecify a source code location.The contextparameter specifies the number of lines of context from the source code to retrieve.The contextlist field in the returned tuple contains a list of source lines corresponding to this context. The indexfield is a numerical index within this list for the line corresponding to frame.\n\ngetinnerframes(traceback [, context])\n\nReturns a list of frame records for the frame of a traceback and all inner frames. Each frame-record is a 6-tuple consisting of (frame, filename, line, funcname, contextlist, index). filename, line, context, contextlist, and indexhave the same meaning as with getframeinfo().\n\ngetmembers(object [, predicate])\n\nReturns all of the members of object.Typically, the members are obtained by looking in the _ _dict_ _ attribute of an object, but this function may return attributes of objectstored elsewhere (for example, docstrings in _ _doc_ _, objects’ names in _ _name_ _, and so on).The members are returned a list of (name, value) pairs. predicateis an optional function that accepts a member object as an argument and returns True or False. Only members for which predicatereturns True are returned. Functions such as isfunction() and isclass() can be used as predicate functions.\n\ngetmodule(object)\n\nReturns the module in which objectwas defined (if possible).\n\ngetmoduleinfo(path)\n\nReturns information about how Python would interpret the file path. If pathis not a Python module, None is returned. Otherwise, a named tuple ModuleInfo(name, suffix, mode, module_type) is returned where nameis the name of the module,\n\nF h Lib f L Bdff",
      "content_length": 2599,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 249,
      "content": "224\n\nChapter 13 Python Runtime Services\n\nsuffixis the filename suffix, modeis the file mode that would be used to open the module, and module_typeis an integer code specifying the module type. Module type codes are defined in the imp module as follows:\n\nModule Type imp.PY_SOURCE\n\nimp.PY_COMPILED\n\nimp.C_EXTENSION\n\nimp.PKG_DIRECTORY\n\nimp.C_BUILTIN\n\nDescription Python source file Python compiled object file (.pyc) Dynamically loadable C extension Package directory Built-in module Frozen module\n\nimp.PY_FROZEN\n\ngetmodulename(path)\n\nReturns the name of the module that would be used for the file path. If pathdoes not look like a Python module, None is returned.\n\ngetmro(cls)\n\nReturns a tuple of classes that represent the method-resolution ordering used to resolve methods in class cls. Refer to Chapter 7,“Classes and Object-Oriented Programming,” for further details.\n\ngetouterframes(frame [, context])\n\nReturns a list of frame records for frameand all outer frames.This list represents the calling sequence where the first entry contains information for frame. Each frame record is a 6-tuple (frame, filename, line, funcname, contextlist, index) where the fields have the same meaning as for getinnerframes()The contextargu- ment has the same meaning as for getframeinfo().\n\ngetsourcefile(object)\n\nReturns the name of the Python source file in which objectwas defined.\n\ngetsourcelines(object)\n\nReturns a tuple (sourcelines, firstline) corresponding to the definition of object. sourcelinesis a list of source code lines, and firstlineis the line number of the first source code line. Raises IOError if source code can’t be found.\n\ngetsource(object)\n\nReturns source code of objectas a single string. Raises IOError if the source code can’t be found.\n\nisabstract(object)\n\nReturns True if objectis an abstract base class.\n\nisbuiltin(object)\n\nReturns True if objectis a built-in function.\n\nisclass(object)\n\nReturns True if objectis a class.\n\nF h Lib f L Bdff",
      "content_length": 1958,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 250,
      "content": "inspect\n\n225\n\niscode(object)\n\nReturns True if objectis a code object.\n\nisdatadescriptor(object)\n\nReturns True if objectis a data descriptor object.This is the case if objectdefines both a _ _get_ _() and _ _set_ _() method.\n\nisframe(object)\n\nReturns True if objectis a frame object.\n\nisfunction(object)\n\nReturns True if objectis a function object.\n\nisgenerator(object)\n\nReturns True if objectis a generator object.\n\nisgeneratorfunction(object)\n\nReturns True if objectis a generator function.This is different than isgenerator() in that it tests if objectis a function that creates a generator when called. It is not used to check if objectis an actively running generator.\n\nismethod(object)\n\nReturns True if objectis a method.\n\nismethoddescriptor(object)\n\nReturns True if objectis a method descriptor object.This is the case if objectis not a method, class, or function and it defines a _ _get_ _() method but does not define _ _set_ _().\n\nismodule(object)\n\nReturns True if objectis a module object.\n\nisroutine(object)\n\nReturns True if objectis a user-defined or built-in function or method.\n\nistraceback(object)\n\nReturns True if objectis a traceback object.\n\nstack([context])\n\nReturns a list of frame records corresponding to the stack of the caller. Each frame record is a 6-tuple (frame, filename, line, funcname, contextlist, index), which contains the same information as returned by getinnerframes(). context specifies the number of lines of source context to return in each frame record.\n\ntrace([context])\n\nReturns a list of frame records for the stack between the current frame and the frame in which the current exception was raised.The first frame record is the caller, and the last frame record is the frame where the exception occurred. contextspecifies the number of lines of source context to return in each frame record.\n\nF h Lib f L Bdff",
      "content_length": 1853,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 251,
      "content": "226\n\nChapter 13 Python Runtime Services\n\nmarshal The marshal module is used to serialize Python objects in an “undocumented” Python-specific data format. marshal is similar to the pickle and shelve modules, but it is less powerful and intended for use only with simple objects. It shouldn’t be used to implement persistent objects in general (use pickle instead). However, for sim- ple built-in types, the marshal module is a very fast approach for saving and loading data.\n\ndump(value, file [, version])\n\nWrites the object value to the open file object file. If valueis an unsupported type, a ValueError exception is raised. versionis an integer that specifies the data format to use.The default output format is found in marshal.version and is currently set to 2. Version 0 is an older format used by earlier versions of Python.\n\ndumps(value [,version])\n\nReturns the string written by the dump() function. If valueis an unsupported type, a ValueError exception is raised. versionis the same as described previously.\n\nload(file)\n\nReads and returns the next value from the open file object file. If no valid value is read, an EOFError, ValueError, or TypeError exception will be raised.The format of the input data is automatically detected.\n\nloads(string)\n\nReads and returns the next value from the string string.\n\nNotes\n\nn Data is stored in a binary architecture-independent format. n Only None, integers, long integers, floats, complex numbers, strings, Unicode\n\nstrings, tuples, lists, dictionaries, and code objects are supported. Lists, tuples, and dictionaries can only contain supported objects. Class instances and recursive ref- erences in lists, tuples, and dictionaries are not supported.\n\nn Integers may be promoted to long integers if the built-in integer type doesn’t have enough precision—for example, if the marshalled data contains a 64-bit integer, but the data is being read on a 32-bit machine.\n\nn marshal is not intended to be secure against erroneous or maliciously construct-\n\ned data and should not be used to unmarshal data from untrusted sources.\n\nn marshal is significantly faster than pickle, but it isn’t as flexible.\n\npickle The pickle module is used to serialize Python objects into a stream of bytes suitable for storing in a file, transferring across a network, or placing in a database.This process is variously called pickling, serializing, marshalling, or flattening.The resulting byte stream can also be converted back into a series of Python objects using an unpickling process.\n\nF h Lib f L Bdff",
      "content_length": 2535,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 252,
      "content": "pickle\n\n227\n\nThe following functions are used to turn an object into a byte-stream.\n\ndump(object, file [, protocol ])\n\nDumps a pickled representation of objectto the file object file. protocolspecifies the output format of the data. Protocol 0 (the default) is a text-based format that is backwards-compatible with earlier versions of Python. Protocol 1 is a binary protocol that is also compatible with most earlier Python versions. Protocol 2 is a newer protocol that provides more efficient pickling of classes and instances. Protocol 3 is used by Python 3 and is not backwards-compatible. If protocolis negative, the most modern protocol will be selected.The variable pickle.HIGHEST_PROTOCOL contains the high- est protocol available. If objectdoesn’t support pickling, a pickle.PicklingError exception is raised.\n\ndumps(object [, protocol])\n\nSame as dump(), but returns a string containing the pickled data.\n\nThe following example shows how you use these functions to save objects to a file:\n\nf = open('myfile', 'wb') pickle.dump(x, f) pickle.dump(y, f) ... dump more objects ... f.close()\n\nThe following functions are used to restore a pickled object.\n\nload(file)\n\nLoads and returns a pickled representation of an object from the file object file. It is not necessary to specify the input protocol as it is automatically detected.A pickle.UnpicklingError exception is raised if the file contains corrupted data that can’t be decoded. If an end-of-file is detected, an EOFError exception is raised.\n\nloads(string)\n\nSame as load(), but reads the pickled representation of an object from a string. The following example shows how you use these functions to load data:\n\nf = open('myfile', 'rb') x = pickle.load(f) y = pickle.load(f) ... load more objects ... f.close()\n\nWhen loading, it is not necessary to specify the protocol or any information about the type of object being loaded.That information is saved as part of the pickle data format itself.\n\nIf you are pickling more than one Python object, you can simply make repeated calls to dump() and load() as shown in the previous examples.When making multiple calls, you simply have to make sure the sequence of load() calls matches the sequence of dump() calls that were used to write the file.\n\nWhen working with complicated data structures involving cycles or shared refer- ences, using dump() and load() can be problematic because they don’t maintain any internal state about objects that have already been pickled or restored.This can result in output files that are excessively large and that don’t properly restore the relationship\n\nF h Lib f L Bdff",
      "content_length": 2612,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 253,
      "content": "228\n\nChapter 13 Python Runtime Services\n\nbetween objects when loaded.An alternative approach is to use Pickler and Unpickler objects.\n\nPickler(file [, protocol ])\n\nCreates a pickling object that writes data to the file object filewith the specified pickle protocol.An instance p of Pickler has a method p.dump(x) that dumps an object xto file. Once xhas been dumped, its identity is remembered. If a subsequent p.dump() operation is used to write the same object, a reference to the previously dumped object is saved instead of writing a new copy.The method p.clear_memo() clears the internal dictionary used to track previously dumped objects.You would use this if you wanted to write a fresh copy of a previously dumped object (that is, if its value changed since the last dump() operation).\n\nUnpickler(file)\n\nCreates an unpickling object that reads data from the file object file.An instance u of Unpickler has a method u.load() that loads and returns a new object from file.An Unpickler keeps track of objects it has returned because the input source might con- tain an object reference created by the Pickler object. In this case, u.load() returns a reference to the previously loaded object.\n\nThe pickle module works with most kinds of normal Python objects.This\n\nincludes:\n\nn None\n\nn Numbers and strings n Tuples, lists, and dictionaries containing only pickleable objects n Instances of user-defined classes defined at the top level of a module\n\nWhen instances of a user-defined class are pickled, the instance data is the only part that gets pickled.The corresponding class definition is not saved—instead, the pickled data merely contains the name of the associated class and module.When instances are unpickled, the module in which the class is defined is automatically imported in order to access the class definition when re-creating instances. It should also be noted that when restoring an instance, the _ _init_ _() method of a class is not invoked. Instead, the instance is re-created through other means and the instance data restored.\n\nOne restriction on instances is that the corresponding class definition must appear at\n\nthe top level of a module (that is, no nested classes). In addition, if the instance’s class definition was originally defined in _ _main_ _, that class definition must be manually reloaded prior to unpickling a saved object (because there’s no way for the interpreter to know how to automatically load the necessary class definitions back into _ _main_ _ when unpickling).\n\nIt is not normally necessary to do anything to make a user-defined class work with pickle. However, a class can define customized methods for saving and restoring its state by implementing the special methods _ _getstate_ _() and _ _setstate_ _().The _ _getstate_ _() method must return a pickleable object (such as a string or tuple) representing the state of the object.The _ _setstate_ _() method accepts the pickled object and restores its state. If these methods are undefined, the default behavior is to pickle an instance’s underlying _ _dict_ _ attribute. It should be noted that if these methods are defined, they will also be used by the copy module to implement the shal- low and deep copy operations.\n\nF h Lib f L Bdff",
      "content_length": 3248,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 254,
      "content": "sys\n\n229\n\nNotes\n\nn In Python 2, a module called cPickle contains a C implementation of functions in the pickle module. It is significantly faster than pickle, but is restricted in that it doesn’t allow subclassing of the Pickler and Unpickler objects. Python 3 has a support module that also contains C implementation, but it is used more transparently (pickle takes advantage of it automatically as appropriate).\n\nn The data format used by pickle is Python-specific and shouldn’t be assumed to\n\nbe compatible with any external standards such as XML.\n\nn Whenever possible, the pickle module should be used instead of the marshal module because pickle is more flexible, the data encoding is documented, and additional error-checking is performed.\n\nn Due to security concerns, programs should not unpickle data received from\n\nuntrusted sources.\n\nn Use of the pickle module with types defined in extension modules is much more involved than what is described here. Implementers of extension types should consult the online documentation for details concerning the low-level protocol required to make these objects work with pickle—in particular, details on how to implement the _ _reduce_ _() and _ _reduce_ex_ _() special methods that pickle uses to create the serialized byte sequences.\n\nsys The sys module contains variables and functions that pertain to the operation of the interpreter and its environment.\n\nVariables The following variables are defined.\n\napi_version\n\nAn integer representing the C API version of the Python interpreter. Used when work- ing with extension modules.\n\nargv\n\nList of command-line options passed to a program. argv[0] is the name of the pro- gram.\n\nbuiltin_module_names\n\nTuple containing names of modules built into the Python executable.\n\nbyteorder\n\nNative byte-ordering of the machine—'little' for little-endian or 'big' for big- endian.\n\nF h Lib f L Bdff",
      "content_length": 1888,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 255,
      "content": "230\n\nChapter 13 Python Runtime Services\n\ncopyright\n\nString containing copyright message.\n\n_ _displayhook__\n\nOriginal value of the displayhook() function.\n\ndont_write_bytecode\n\nBoolean flag that determines whether or not Python writes bytecode (.pyc or .pyo files) when importing modules.The initial value is True unless the -B option to the interpreter is given.The setting can be changed as needed in your own program.\n\ndllhandle\n\nInteger handle for the Python DLL (Windows).\n\n__excepthook__\n\nOriginal value of the excepthook() function.\n\nexec_prefix\n\nDirectory where platform-dependent Python files are installed.\n\nexecutable\n\nString containing the name of the interpreter executable.\n\nflags\n\nAn object representing the settings of different command-line options supplied to the Python interpreter itself.The following table lists the attributes of flags along with the corresponding command-line option that turns the flag on.These attributes are read- only.\n\nAttribute flags.debug flags.py3k_warning\n\nCommand-Line Option -d -3\n\nflags.division_warning\n\nQ\n\nflags.division_new\n\nQnew\n\nflags.inspect\n\ni\n\nflags.interactive\n\nflags.optimize\n\nflags.dont_write_bytecode\n\ni -O or -OO -B\n\nflags.no_site\n\nS\n\nflags.ignore_environment\n\nflags.tabcheck\n\nflags.verbose\n\nE -t or -tt -v\n\nflags.unicode\n\nU\n\nF h Lib f L Bdff",
      "content_length": 1306,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 256,
      "content": "sys\n\n231\n\nfloat_info\n\nAn object that holds information about internal representation of floating-point num- bers.The values of these attributes are taken from the float.h C header file.\n\nAttribute float_info.epsilon\n\nfloat_info.dig\n\nfloat_info.mant_dig\n\nfloat_info.max\n\nfloat_info.max_exp\n\nDescription Difference between 1.0 and the next largest float. Number of decimal digits that can be represented without any changes after rounding. Number of digits that can be represented using the numer- ic base specified in float_info.radix. Maximum floating-point number. Maximum exponent in the numeric base specified in float_info.radix.\n\nfloat_info.max_10_exp Maximum exponent in base 10. float_info.min\n\nMinimum positive floating-point value. Minimum exponent in the numeric base specified in float_info.radix.\n\nfloat_info.min_exp\n\nfloat_info.min_10_exp Minimum exponent in base 10. float_info.radix\n\nNumeric base used for exponents. Rounding behavior (-1 undetermined, 0 towards zero, 1 nearest, 2 towards positive infinity, 3 towards negative infinity).\n\nfloat_info.rounds\n\nhexversion\n\nInteger whose hexadecimal representation encodes the version information contained in sys.version_info.The value of this integer is always guaranteed to increase with newer versions of the interpreter.\n\nlast_type, last_value, last_traceback\n\nThese variables are set when an unhandled exception is encountered and the interpreter prints an error message. last_type is the last exception type, last_value is the last exception value, and last_traceback is a stack trace. Note that the use of these vari- ables is not thread-safe. sys.exc_info() should be used instead.\n\nmaxint\n\nLargest integer supported by the integer type (Python 2 only).\n\nmaxsize\n\nLargest integer value supported by the C size_t datatype on the system.This value determines the largest possible length for strings, lists, dicts, and other built-in types.\n\nmaxunicode\n\nInteger that indicates the largest Unicode code point that can be represented.The default value is 65535 for the 16-bit UCS-2 encoding.A larger value will be found if Python has been configured to use UCS-4.\n\nmodules\n\nDictionary that maps module names to module objects.\n\nF h Lib f L Bdff",
      "content_length": 2210,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 257,
      "content": "232\n\nChapter 13 Python Runtime Services\n\npath\n\nList of strings specifying the search path for modules.The first entry is always set to the directory in which the script used to start Python is located (if available). Refer to Chapter 8,“Iterators and Generators.”\n\nplatform\n\nPlatform identifier string, such as 'linux-i386'.\n\nprefix\n\nDirectory where platform-independent Python files are installed.\n\nps1, ps2\n\nStrings containing the text for the primary and secondary prompts of the interpreter. Initially, ps1 is set to '>>> ' and ps2 is set to '... '.The str() method of whatever object is assigned to these values is evaluated to generate the prompt text.\n\npy3kwarning\n\nFlag set to True in Python 2 when the interpreter is run with the -3 option.\n\nstdin, stdout, stderr\n\nFile objects corresponding to standard input, standard output, and standard error. stdin is used for the raw_input() and input() functions. stdout is used for print and the prompts of raw_input() and input(). stderr is used for the interpreter’s prompts and error messages.These variables can be assigned to any object that supports a write() method operating on a single string argument.\n\n_ _stdin_ _, _ _stdout_ _, _ _stderr_ _\n\nFile objects containing the values of stdin, stdout, and stderr at the start of the interpreter.\n\ntracebacklimit\n\nMaximum number of levels of traceback information printed when an unhandled exception occurs.The default value is 1000.A value of 0 suppresses all traceback infor- mation and causes only the exception type and value to be printed.\n\nversion\n\nVersion string.\n\nversion_info\n\nVersion information represented as a tuple (major, minor, micro, releaselevel, serial).All values are integers except releaselevel, which is the string 'alpha', 'beta', 'candidate', or 'final'.\n\nwarnoptions\n\nList of warning options supplied to the interpreter with the –W command-line option.\n\nwinver\n\nThe version number used to form registry keys on Windows.\n\nF h Lib f L Bdff",
      "content_length": 1968,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 258,
      "content": "sys\n\n233\n\nFunctions The following functions are available:\n\n_clear_type_cache()\n\nClears the internal type cache.To optimize method lookups, a small 1024-entry cache of recently used methods is maintained inside the interpreter.This cache speeds up repeated method lookups—especially in code that has deep inheritance hierarchies. Normally, you don’t need to clear this cache, but you might do so if you are trying to track down a really tricky memory reference counting issue. For example, if a method in the cache was holding a reference to an object that you were expecting to be destroyed.\n\n_current_frames()\n\nReturns a dictionary mapping thread identifiers to the topmost stack frame of the exe- cuting thread at the time of call.This information can be useful in writing tools related to thread debugging (that is, tracking down deadlock). Keep in mind that the values returned by this function only represent a snapshot of the interpreter at the time of call. Threads may be executing elsewhere by the time you look at the returned data.\n\ndisplayhook([value])\n\nThis function is called to print the result of an expression when the interpreter is run- ning in interactive mode. By default, the value of repr(value) is printed to standard output and valueis saved in the variable _ _builtin_ _._. displayhook can be rede- fined to provide different behavior if desired.\n\nexcepthook(type,value,traceback)\n\nThis function is called when an uncaught exception occurs. typeis the exception class, valueis the value supplied by the raise statement, and tracebackis a traceback object.The default behavior is to print the exception and traceback to standard error. However, this function can be redefined to provide alternative handling of uncaught exceptions (which may be useful in specialized applications such as debuggers or CGI scripts).\n\nexc_clear()\n\nClears all information related to the last exception that occurred. It only clears informa- tion specific to the calling thread.\n\nexc_info()\n\nReturns a tuple (type, value, traceback) containing information about the exception that’s currently being handled. typeis the exception type, valueis the exception parameter passed to raise, and tracebackis a traceback object containing the call stack at the point where the exception occurred. Returns None if no exception is currently being handled.\n\nexit([n])\n\nExits Python by raising the SystemExit exception. nis an integer exit code indicating a status code.A value of 0 is considered normal (the default); nonzero values are consid- ered abnormal. If a noninteger value is given to n, it’s printed to sys.stderr and an exit code of 1 is used.\n\nF h Lib f L Bdff",
      "content_length": 2665,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 259,
      "content": "234\n\nChapter 13 Python Runtime Services\n\ngetcheckinterval()\n\nReturns the value of the check interval, which specifies how often the interpreter checks for signals, thread switches, and other periodic events.\n\ngetdefaultencoding()\n\nGets the default string encoding in Unicode conversions. Returns a value such as 'ascii' or 'utf-8'.The default encoding is set by the site module.\n\ngetdlopenflags()\n\nReturns the flags parameter that is supplied to the C function dlopen() when loading extension modules on UNIX. See dl module.\n\ngetfilesystemencoding()\n\nReturns the character encoding used to map Unicode filenames to filenames used by the underlying operating system. Returns 'mbcs' on Windows or 'utf-8' on Macintosh OS X. On UNIX systems, the encoding depends on locale settings and will return the value of the locale CODESET parameter. May return None, in which case the system default encoding is used.\n\n_getframe([depth])\n\nReturns a frame object from the call stack. If depthis omitted or zero, the topmost frame is returned. Otherwise, the frame for that many calls below the current frame is returned. For example, _getframe(1) returns the caller’s frame. Raises ValueError if depthis invalid.\n\ngetprofile()\n\nReturns the profile function set by the setprofile() function.\n\ngetrecursionlimit()\n\nReturns the recursion limit for functions.\n\ngetrefcount(object)\n\nReturns the reference count of object.\n\ngetsizeof(object [, default])\n\nReturns the size of objectin bytes.This calculation is made by calling the _ _sizeof_ _() special method of object. If undefined, a TypeError will be generat- ed unless a default value has been specified with the defaultargument. Because objects are free to define _ _sizeof_ _() however they wish, there is no guarantee that the result of this function is a true measure of memory use. However, for built-in types such as lists or string, it is correct.\n\ngettrace()\n\nReturns the trace function set by the settrace() function.\n\ngetwindowsversion()\n\nReturns a tuple (major,minor,build,platform,text) that describes the version of Windows being used. majoris the major version number. For example, a value of 4 indicates Windows NT 4.0, and a value of 5 indicates Windows 2000 and Windows XP\n\nF h Lib f L Bdff",
      "content_length": 2243,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 260,
      "content": "traceback\n\n235\n\nvariants. minoris the minor version number. For example, 0 indicates Windows 2000, whereas 1 indicates Windows XP. buildis the Windows build number. platformiden- tifies the platform and is an integer with one of the following common values: 0 (Win32s on Windows 3.1), 1 (Windows 95,98, or Me), 2 (Windows NT, 2000, XP), or 3 (Windows CE). textis a string containing additional information such as \"Service Pack 3\".\n\nsetcheckinterval(n)\n\nSets the number of Python virtual machine instructions that must be executed by the interpreter before it checks for periodic events such as signals and thread context switches.The default value is 10.\n\nsetdefaultencoding(enc)\n\nSets the default encoding. encis a string such as 'ascii' or 'utf-8'.This function is only defined inside the site module. It can be called from user-definable sitecustomize modules.\n\nsetdlopenflags(flags)\n\nSets the flags passed to the C dlopen() function, which is used to load extension mod- ules on UNIX.This will affect the way in which symbols are resolved between libraries and other extension modules. flagsis the bitwise OR of values that can be found in the dl module (see Chapter 19,“Network Programming”)—for example, sys.setdlopenflags(dl.RTLD_NOW | dl.RTLD_GLOBAL).\n\nsetprofile(pfunc)\n\nSets the system profile function that can be used to implement a source code profiler.\n\nsetrecursionlimit(n)\n\nChanges the recursion limit for functions.The default value is 1000. Note that the operating system may impose a hard limit on the stack size, so setting this too high may cause the Python interpreter process to crash with a Segmentation Fault or Access Violation.\n\nsettrace(tfunc)\n\nSets the system trace function, which can be used to implement a debugger. Refer to Chapter 11 for information about the Python debugger.\n\ntraceback The traceback module is used to gather and print stack traces of a program after an exception has occurred.The functions in this module operate on traceback objects such as the third item returned by the sys.exc_info() function.The main use of this module is in code that needs to report errors in a non-standard way—for example, if you were running Python programs deeply embedded within a network server and you wanted to redirect tracebacks to a log file.\n\nprint_tb(traceback [, limit [, file]])\n\nPrints up to limitstack trace entries from tracebackto the file file. If limitis omitted, all the entries are printed. If fileis omitted, the output is sent to sys.stderr.\n\nF h Lib f L Bdff",
      "content_length": 2512,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 261,
      "content": "236\n\nChapter 13 Python Runtime Services\n\nprint_exception(type, value, traceback [, limit [, file]])\n\nPrints exception information and a stack trace to file. typeis the exception type, and valueis the exception value. limitand fileare the same as in print_tb().\n\nprint_exc([limit [, file]])\n\nSame as print_exception() applied to the information returned by the sys.exc_info() function.\n\nformat_exc([limit [, file]])\n\nReturns a string containing the same information printed by print_exc().\n\nprint_last([limit [, file]])\n\nSame as print_exception (sys.last_type, sys.last_value, sys.last_traceback, limit, file).\n\nprint_stack([frame [, limit [, file]]])\n\nPrints a stack trace from the point at which it’s invoked. framespecifies an optional stack frame from which to start. limitand filehave the same meaning as for print_tb().\n\nextract_tb(traceback [, limit])\n\nExtracts the stack trace information used by print_tb().The return value is a list of tuples of the form (filename, line, funcname, text) containing the same infor- mation that normally appears in a stack trace. limitis the number of entries to return.\n\nextract_stack([frame [, limit]])\n\nExtracts the same stack trace information used by print_stack(), but obtained from the stack frame frame. If frameis omitted, the current stack frame of the caller is used and limitis the number of entries to return.\n\nformat_list(list)\n\nFormats stack trace information for printing. listis a list of tuples as returned by extract_tb() or extract_stack().\n\nformat_exception_only(type, value)\n\nFormats exception information for printing.\n\nformat_exception(type, value, traceback [, limit])\n\nFormats an exception and stack trace for printing.\n\nformat_tb(traceback [, limit])\n\nSame as format_list(extract_tb(traceback, limit)).\n\nformat_stack([frame [, limit]])\n\nSame as format_list(extract_stack(frame, limit)).\n\ntb_lineno(traceback)\n\nReturns the line number set in a traceback object.\n\nF h Lib f L Bdff",
      "content_length": 1946,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 262,
      "content": "types\n\n237\n\ntypes The types module defines names for the built-in types that correspond to functions, modules, generators, stack frames, and other program elements.The contents of this module are often used in conjunction with the built-in isinstance() function and other type-related operations.\n\nVariable BuiltinFunctionType\n\nCodeType\n\nFrameType\n\nFunctionType\n\nGeneratorType\n\nGetSetDescriptorType\n\nLambdaType\n\nMemberDescriptorType\n\nMethodType\n\nModuleType\n\nDescription Type of built-in functions Type of code objects Type of execution frame object Type of user-defined functions and lambdas Type of generator-iterator objects Type of getset descriptor objects Alternative name for FunctionType Type of member descriptor objects Type of user-defined class methods Type of modules Type of traceback objects\n\nTracebackType\n\nMost of the preceding type objects serve as constructors that can be used to create an object of that type.The following descriptions provide the parameters used to create functions, modules, code objects, and methods. Chapter 3 contains detailed information about the attributes of the objects created and the arguments that need to be supplied to the functions described next.\n\nFunctionType(code, globals [, name [, defarags [, closure]]])\n\nCreates a new function object.\n\nCodeType(argcount, nlocals, stacksize, flags, codestring, constants, names, varnames, filename, name, firstlineno, lnotab [, freevars [, cellvars ]])\n\nCreates a new code object.\n\nMethodType(function, instance, class)\n\nCreates a new bound instance method.\n\nModuleType(name [, doc])\n\nCreates a new module object.\n\nNotes\n\nn The types module should not be used to refer the type of built-in objects such as integers, lists, or dictionaries. In Python 2, types contains other names such as IntType and DictType. However, these names are just aliases for the built-in type names of int and dict. In modern code, you should just use the built-in type names because the types module only contains the names listed previously in Python 3.\n\nF h Lib f L Bdff",
      "content_length": 2044,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 263,
      "content": "238\n\nChapter 13 Python Runtime Services\n\nwarnings The warnings module provides functions to issue and filter warning messages. Unlike exceptions, warnings are intended to alert the user to potential problems, but without generating an exception or causing execution to stop. One of the primary uses of the warnings module is to inform users about deprecated language features that may not be supported in future versions of Python. For example:\n\n>>> import regex __main__:1: DeprecationWarning: the regex module is deprecated; use the re module >>>\n\nLike exceptions, warnings are organized into a class hierarchy that describes general cat- egories of warnings.The following lists the currently supported categories:\n\nWarning Object Warning\n\nUserWarning\n\nDeprecationWarning\n\nSyntaxWarning\n\nRuntimeWarning\n\nFutureWarning\n\nDescription Base class of all warning types User-defined warning Warning for use of a deprecated feature Potential syntax problem Potential runtime problem Warning that the semantics of a particular feature will change in a future release\n\nEach of these classes is available in the _ _builtin_ _ module as well as the exceptions module. In addition, they are also instances of Exception.This makes it possible to easily convert warnings into errors.\n\nWarnings are issued using the warn() function. For example:\n\nwarnings.warn(\"feature X is deprecated.\") warnings.warn(\"feature Y might be broken.\", RuntimeWarning)\n\nIf desired, warnings can be filtered.The filtering process can be used to alter the output behavior of warning messages, to ignore warnings, or to turn warnings into exceptions. The filterwarnings() function is used to add a filter for a specific type of warning. For example:\n\nwarnings.filterwarnings(action=\"ignore\",\n\nmessage=\".*regex.*\", category=DeprecationWarning)\n\nimport regex # Warning message disappears\n\nLimited forms of filtering can also be specified using the –W option to the interpreter. For example:\n\n% python –Wignore:the\\ regex:DeprecationWarning\n\nThe following functions are defined in the warnings module:\n\nF h Lib f L Bdff",
      "content_length": 2079,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 264,
      "content": "warnings\n\n239\n\nwarn(message[, category[, stacklevel]])\n\nIssues a warning. messageis a string containing the warning message, categoryis the warning class (such as DeprecationWarning), and stacklevelis an integer that speci- fies the stack frame from which the warning message should originate. By default, categoryis UserWarning and stacklevelis 1.\n\nwarn_explicit(message, category, filename, lineno[, module[, registry]])\n\nThis is a low-level version of the warn() function. messageand categoryhave the same meaning as for warn(). filename, lineno, and moduleexplicitly specify the location of the warning. registryis an object representing all the currently active fil- ters. If registryis omitted, the warning message is not suppressed.\n\nshowwarning(message, category, filename, lineno[, file])\n\nWrites a warning to a file. If fileis omitted, the warning is printed to sys.stderr.\n\nformatwarning(message, category, filename, lineno)\n\nCreates the formatted string that is printed when a warning is issued.\n\nfilterwarnings(action[, message[, category[, module[, lineno[, append]]]]])\n\nAdds an entry to the list of warning filters. actionis one of 'error', 'ignore', 'always', 'default', 'once', or 'module'.The following list provides an explana- tion of each:\n\nAction 'error'\n\n'ignore'\n\n'always'\n\n'default'\n\n'module'\n\nDescription Convert the warning into an exception Ignore the warning Always print a warning message Print the warning once for each location where the warning occurs Print the warning once for each module in which the warning occurs Print the warning once regardless of where it occurs\n\n'once'\n\nmessageis a regular expression string that is used to match against the warning mes- sage. categoryis a warning class such as DeprecationError. moduleis a regular expression string that is matched against the module name. linenois a specific line number or 0 to match against all lines. appendspecifies that the filter should be appended to the list of all filters (checked last). By default, new filters are added to the beginning of the filter list. If any argument is omitted, it defaults to a value that matches all warnings.\n\nresetwarnings()\n\nResets all the warning filters.This discards all previous calls to filterwarnings() as well as options specified with –W.\n\nNotes\n\nn The list of currently active filters is found in the warnings.filters variable. n When warnings are converted to exceptions, the warning category becomes the exception type. For instance, an error on DeprecationWarning will raise a DeprecationWarning exception.\n\nF h Lib f L Bdff",
      "content_length": 2574,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 265,
      "content": "240\n\nChapter 13 Python Runtime Services\n\nn The –W option can be used to specify a warning filter on the command line.The\n\ngeneral format of this option is\n\nWaction:message:category:module:lineno\n\nwhere each part has the same meaning as for the filterwarning() function. However, in this case, the messageand modulefields specify substrings (instead of regular expressions) for the first part of the warning message and module name to be filtered, respectively.\n\nweakref The weakref module is used to provide support for weak references. Normally, a refer- ence to an object causes its reference count to increase—effectively keeping the object alive until the reference goes away.A weak reference, on the other hand, provides a way of referring to an object without increasing its reference count.This can be useful in certain kinds of applications that must manage objects in unusual ways. For example, in an object-oriented program, where you might implement a relationship such as the Observer pattern, a weak reference can be used to avoid the creation of reference cycles.An example of this is shown in the “Object Memory Management” section of Chapter 7.\n\nA weak reference is created using the weakref.ref() function as follows:\n\n>>> class A: pass >>> a = A() >>> ar = weakref.ref(a) # Create a weak reference to a >>> print ar <weakref at 0x135a24; to 'instance' at 0x12ce0c>\n\nOnce a weak reference is created, the original object can be obtained from the weak reference by simply calling it as a function with no arguments. If the underlying object still exists, it will be returned. Otherwise, None is returned to indicate that the original object no longer exists. For example:\n\n>>> print ar() # Print original object <__main__.A instance at 12ce0c> >>> del a # Delete the original object >>> print ar() # a is gone, so this now returns None None >>>\n\nThe following functions are defined by the weakref module:\n\nref(object[, callback])\n\nCreates a weak reference to object. callbackis an optional function that will be called when objectis about to be destroyed. If supplied, this function should accept a single argument, which is the corresponding weak reference object. More than one weak reference may refer to the same object. In this case, the callback functions will be called in order from the most recently applied reference to the oldest reference. objectcan be obtained from a weak reference by calling the returned weak reference object as a function with no arguments. If the original object no longer exists, None\n\nF h Lib f L Bdff",
      "content_length": 2554,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 266,
      "content": "weakref\n\n241\n\nwill be returned. ref() actually defines a type, ReferenceType, that can be used for type-checking and subclasses.\n\nproxy(object[, callback])\n\nCreates a proxy using a weak reference to object.The returned proxy object is really a wrapper around the original object that provides access to its attributes and methods.As long as the original object exists, manipulation of the proxy object will transparently mimic the behavior of the underlying object. On the other hand, if the original object has been destroyed, operations on the proxy will raise a weakref.ReferenceError to indicate that the object no longer exists. callbackis a callback function with the same meaning as for the ref() function.The type of a proxy object is either ProxyType or CallableProxyType, depending on whether or not the original object is callable.\n\ngetweakrefcount(object)\n\nReturns the number of weak references and proxies that refer to object.\n\ngetweakrefs(object)\n\nReturns a list of all weak reference and proxy objects that refer to object.\n\nWeakKeyDictionary([dict])\n\nCreates a dictionary in which the keys are referenced weakly.When there are no more strong references to a key, the corresponding entry in the dictionary is automatically removed. If supplied, the items in dictare initially added to the returned WeakKeyDictionary object. Because only certain types of objects can be weakly refer- enced, there are numerous restrictions on acceptable key values. In particular, built-in strings cannot be used as weak keys. However, instances of user-defined classes that define a _ _hash_ _() method can be used as keys.An instance of WeakKeyDictionary has two methods, iterkeyrefs() and keyrefs(), that return the weak key references.\n\nWeakValueDictionary([dict])\n\nCreates a dictionary in which the values are referenced weakly.When there are no more strong references to a value, corresponding entries in the dictionary will be discarded. If supplied, the entries in dictare added to the returned WeakValueDictionary.An instance of WeakValueDictionary has two methods, itervaluerefs() and valuerefs(), that return the weak value references.\n\nProxyTypes\n\nThis is a tuple (ProxyType, CallableProxyType) that can be used for testing if an object is one of the two kinds of proxy objects created by the proxy() function—for example, isinstance(object, ProxyTypes).\n\nF h Lib f L Bdff",
      "content_length": 2382,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 267,
      "content": "242\n\nChapter 13 Python Runtime Services\n\nExample One application of weak references is to create caches of recently computed results. For instance, if a function takes a long time to compute a result, it might make sense to cache these results and to reuse them as long as they are still in use someplace in the application. For example:\n\n_resultcache = { } def foocache(x):\n\nif resultcache.has_key(x):\n\nr = _resultcache[x]() # Get weak ref and dereference it if r is not None: return r\n\nr = foo(x) _resultcache[x] = weakref.ref(r) return r\n\nNotes\n\nn Only class instances, functions, methods, sets, frozen sets, files, generators, type\n\nobjects, and certain object types defined in library modules (for example, sockets, arrays, and regular expression patterns) support weak references. Built-in functions and most built-in types such as lists, dictionaries, strings, and numbers cannot be used.\n\nn If iteration is ever used on a WeakKeyDictionary or WeakValueDictionary, great care should be taken to ensure that the dictionary does not change size because this may produce bizarre side effects such as items mysteriously disap- pearing from the dictionary for no apparent reason.\n\nn If an exception occurs during the execution of a callback registered with ref()\n\nor proxy(), the exception is printed to standard error and ignored.\n\nn Weak references are hashable as long as the original object is hashable. Moreover, the weak reference will maintain its hash value after the original object has been deleted, provided that the original hash value is computed while the object still exists.\n\nn Weak references can be tested for equality but not for ordering. If the objects are\n\nstill alive, references are equal if the underlying objects have the same value. Otherwise, references are equal if they are the same reference.\n\nF h Lib f L Bdff",
      "content_length": 1843,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 268,
      "content": "14\n\nMathematics\n\nThis chapter describes modules for performing various kinds of mathematical opera-\n\ntions. In addition, the decimal module, which provides generalized support for decimal floating-point numbers, is described.\n\ndecimal The Python float data type is represented using a double-precision binary floating- point encoding (usually as defined by the IEEE 754 standard).A subtle consequence of this encoding is that decimal values such as 0.1 can’t be represented exactly. Instead, the closest value is 0.10000000000000001.This inexactness carries over to calculations involving floating-point numbers and can sometimes lead to unexpected results (for example, 3*0.1 == 0.3 evaluates as False).\n\nThe decimal module provides an implementation of the IBM General Decimal Arithmetic Standard, which allows for the exact representation of decimals. It also gives precise control over mathematical precision, significant digits, and rounding behavior. These features can be useful if interacting with external systems that precisely define properties of decimal numbers. For example, if writing Python programs that must interact with business applications.\n\nThe decimal module defines two basic data types: a Decimal type that represents a\n\ndecimal number and a Context type that represents various parameters concerning computation such as precision and round-off error-handling. Here are a few simple examples that illustrate the basics of how the module works:\n\nimport decimal x = decimal.Decimal('3.4') # Create some decimal numbers y = decimal.Decimal('4.5')\n\n# Perform some math calculations using the default context a = x * y # a = decimal.Decimal('15.30') b = x / y # b = decimal.Decimal('0.7555555555555555555555555556')\n\n# Change the precision and perform calculations decimal.getcontext().prec = 3 c = x * y # c = decimal.Decimal('15.3') d = x / y # d = decimal.Decimal('0.756')\n\n# Change the precision for just a single block of statements with decimal.localcontext(decimal.Context(prec=10)): e = x * y # e = decimal.Decimal('15.30') f = x / y # f = decimal.Decimal('0.7555555556')\n\nF h Lib f L Bdff",
      "content_length": 2118,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 269,
      "content": "244\n\nChapter 14 Mathematics\n\nDecimal Objects Decimal numbers are represented by the following class:\n\nDecimal([value [, context]])\n\nvalueis the value of the number specified as either an integer, a string containing a decimal value such as '4.5', or a tuple (sign, digits, exponent). If a tuple is sup- plied, signis 0 for positive, 1 for negative; digitsis a tuple of digits specified as integers; and exponentis an integer exponent.The special strings 'Infinity', '-Infinity', 'NaN', and 'sNaN' may be used to specify positive and negative infinity as well as Not a Number (NaN). 'sNaN' is a variant of NaN that results in an excep- tion if it is ever subsequently used in a calculation.An ordinary float object may not be used as the initial value because that value may not be exact (which defeats the pur- pose of using decimal in the first place).The contextparameter is a Context object, which is described later. If supplied, contextdetermines what happens if the initial value is not a valid number—raising an exception or returning a decimal with the value NaN.\n\nThe following examples show how to create various decimal numbers:\n\na = decimal.Decimal(42) # Creates Decimal(\"42\") b = decimal.Decimal(\"37.45\") # Creates Decimal(\"37.45\") c = decimal.Decimal((1,(2,3,4,5),-2)) # Creates Decimal(\"-23.45\") d = decimal.Decimal(\"Infinity\") e = decimal.Decimal(\"NaN\")\n\nDecimal objects are immutable and have all the usual numeric properties of the built-in int and float types.They can also be used as dictionary keys, placed in sets, sorted, and so forth. For the most part, you manipulate Decimal objects using the standard Python math operators. However, the methods in the following list can be used to carry out several common mathematical operations.All operations take an optional context parameter that controls the behavior of precision, rounding, and other aspects of the cal- culation. If omitted, the current context is used.\n\nMethod x.exp([context])\n\nx.fma(y, z [, context])\n\nx.ln([context])\n\nx.log10([context]) x.sqrt([context])\n\nDescription Natural exponent e**d x*y + zwith no rounding of x*ycomponent Natural logarithm (base e) of x Base-10 logarithm of x Square root of x\n\nContext Objects Various properties of decimal numbers, such as rounding and precision, are controlled through the use of a Context object:\n\nF h Lib f L Bdff",
      "content_length": 2349,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 270,
      "content": "decimal\n\n245\n\nContext(prec=None, rounding=None, traps=None, flags=None, Emin=None, Emax=None, capitals=1)\n\nThis creates a new decimal context.The parameters should be specified using keyword arguments with the names shown. precis an integer that sets the number of digits of precision for arithmetic operations, roundingdetermines the rounding behavior, and trapsis a list of signals that produce a Python exception when certain events occur during computation (such as division by zero). flagsis a list of signals that indicate the initial state of the context (such as overflow). Normally, flagsis not specified. Emin and Emaxare integers representing the minimum and maximum range for exponents, respectively. capitalsis a boolean flag that indicates whether to use 'E' or 'e' for exponents.The default is 1 ('E').\n\nNormally, new Context objects aren’t created directly. Instead, the function getcontext() or localcontext() is used to return the currently active Context object.That object is then modified as needed. Examples of this appear later in this sec- tion. However, in order to better understand those examples, it is necessary to explain these context parameters in further detail.\n\nRounding behavior is determined by setting the roundingparameter to one of the\n\nfollowing values:\n\nConstant ROUND_CEILING\n\nROUND_DOWN\n\nROUND_FLOOR\n\nDescription Rounds toward positive infinity. For example, 2.52 rounds up to 2.6 and -2.58 rounds up to -2.5. Rounds toward zero. For example, 2.58 rounds down to 2.5 and -2.58 rounds up to -2.5. Rounds toward negative infinity. For example, 2.58 rounds down to 2.5 and -2.52 rounds down to -2.6.\n\nROUND_HALF_DOWN Rounds away from zero if the fractional part is greater than half;\n\notherwise, rounds toward zero. For example, 2.58 rounds up to 2.6, 2.55 rounds down to 2.5 -2.55 rounds up to -2.5, and -2.58 rounds down to -2.6.\n\nROUND_HALF_EVEN The same as ROUND_HALF_DOWN except that if the fractional part is exactly half, the result is rounded down if the preceding digit is even and rounded up if the preceding digit is odd. For example, 2.65 is rounded down to 2.6 and 2.55 is rounded up to 2.6. The same as ROUND_HALF_DOWN except that if the fractional part is exactly half, it is rounded away from zero. For example 2.55 rounds up to 2.6, and -2.55 rounds down to -2.6. Rounds away from zero. For example, 2.52 rounds up to 2.6 and - 2.52 rounds down to -2.6. Rounds away from zero if the last digit after toward zero would have been 0 or 5. Otherwise, rounds toward zero. For example, 2.54 rounds to 2.6 and 2.64 rounds to 2.6.\n\nROUND_HALF_UP\n\nROUND_UP\n\nROUND_05UP\n\nThe trapsand flagsparameters of Context() are lists of signals.A signal represents a type of arithmetic exception that may occur during computation. Unless listed in traps, signals are ignored. Otherwise, an exception is raised.The following signals are defined:\n\nF h Lib f L Bdff",
      "content_length": 2899,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 271,
      "content": "246\n\nChapter 14 Mathematics\n\nSignal Clamped\n\nDivisionByZero\n\nInexact\n\nInvalidOperation\n\nOverflow\n\nRounded\n\nSubnormal\n\nUnderflow\n\nDescription Exponent adjusted to fit the allowed range. Division of non-infinite number by 0. Rounding error occurred. Invalid operation performed. Exponent exceeds Emaxafter rounding. Also generates Inexact and Rounded. Rounding occurred. May occur even if no information was lost (for example, “1.00 “ rounded to “1.0”). Exponent is less than Eminprior to rounding. Numerical underflow. Result rounded to 0. Also generates Inexact and Subnormal.\n\nThese signal names correspond to Python exceptions that can be used for error check- ing. Here’s an example: try:\n\nx = a/b\n\nexcept decimal.DivisionByZero: print \"Division by zero\"\n\nLike exceptions, the signals are organized into a hierarchy:\n\nArithmeticError (built-in exception)\n\nDecimalException\n\nClamped\n\nDivisionByZero\n\nInexact\n\nOverflow\n\nUnderflow\n\nInvalidOperation\n\nRounded\n\nOverflow\n\nUnderflow\n\nSubnormal\n\nUnderflow\n\nThe Overflow and Underflow signals appear more than once in the table because those signals also result in the parent signal (for example, an Underflow also signals Subnormal).The decimal.DivisionByZero signal also derives from the built-in DivisionByZero exception.\n\nIn many cases, arithmetic signals are silently ignored. For instance, a computation may produce a round-off error but generate no exception. In this case, the signal names can be used to check a set of sticky flags that indicate computation state. Here’s an example:\n\nctxt = decimal.getcontext() # Get current context x = a + b if ctxt.flags[Rounded]:\n\nprint \"Result was rounded!\"\n\nF h Lib f L Bdff",
      "content_length": 1668,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 272,
      "content": "decimal\n\n247\n\nWhen flags get set, they stay set until they are cleared using the clear_flags() method.Thus, one could perform an entire sequence of calculations and only check for errors at the end.\n\nThe settings on an existing Context object ccan be changed through the following\n\nattributes and methods:\n\nc.capitals\n\nFlag set to 1 or 0 that determines whether to use E or e as the exponent character.\n\nc.Emax\n\nInteger specifying maximum exponent.\n\nc.Emin\n\nInteger specifying minimum exponent.\n\nc.prec\n\nInteger specifying digits of precision.\n\nc.flags\n\nDictionary containing current flag values corresponding to signals. For example, c.flags[Rounded] returns the current flag value for the Rounded signal.\n\nc.rounding\n\nRounding rule in effect.An example is ROUND_HALF_EVEN.\n\nc.traps\n\nDictionary containing True/False settings for the signals that result in Python excep- tions. For example, c.traps[DivisionByZero] is usually True, whereas c.traps[Rounded] is False.\n\nc.clear_flags()\n\nResets all sticky flags (clears c.flags).\n\nc.copy()\n\nReturns a copy of context c.\n\nc.create_decimal(value)\n\nCreates a new Decimal object using cas the context.This may be useful in generating numbers whose precision and rounding behavior override that of the default context.\n\nFunctions and Constants The following functions and constants are defined by the decimal module.\n\ngetcontext()\n\nReturns the current decimal context. Each thread has its own decimal context so this returns the context of the calling thread.\n\nF h Lib f L Bdff",
      "content_length": 1520,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 273,
      "content": "248\n\nChapter 14 Mathematics\n\nlocalcontext([c])\n\nCreates a context manager that sets the current decimal context to a copy of cfor state- ments defined inside the body of a with statement. If cis omitted, a copy of the cur- rent context is created. Here is an example of using this function that temporarily sets the precision to five decimal places for a series of statements:\n\nwith localcontext() as c:\n\nc.prec = 5 statements\n\nsetcontext(c)\n\nSets the decimal context of the calling thread to c.\n\nBasicContext\n\nA premade context with nine digits of precision. Rounding is ROUND_HALF_UP; Emin is -999999999; Emax is 999999999; and all traps are enabled except for Inexact, Rounded, and Subnormal.\n\nDefaultContext\n\nThe default context used when creating new contexts (the values stored here are used as default values for the new context). Defines 28 digits of precision; ROUND_HALF_EVEN rounding; and traps for Overflow, InvalidOperation, and DivisionByZero.\n\nExtendedContext\n\nA premade context with nine digits of precision. Rounding is ROUND_HALF_EVEN, Emin is -999999999, Emax is 999999999, and all traps are disabled. Never raises exceptions. Instead, results may be set to NaN or Infinity.\n\nInf\n\nThe same as Decimal(\"Infinity\").\n\nnegInf\n\nThe same as Decimal(\"-Infinity\").\n\nNaN\n\nThe same as Decimal(\"NaN\").\n\nExamples Here are some more examples showing basic usage of decimal numbers:\n\n>>> a = Decimal(\"42.5\") >>> b = Decimal(\"37.1\") >>> a + b Decimal(\"79.6\") >>> a / b Decimal(\"1.145552560646900269541778976\") >>> divmod(a,b) (Decimal(\"1\"), Decimal(\"5.4\")) >>> max(a,b) Decimal(\"42.5\") >>> c = [Decimal(\"4.5\"), Decimal(\"3\"), Decimal(\"1.23e3\")] >>> sum(c) Decimal(\"1237.5\")\n\nF h Lib f L Bdff",
      "content_length": 1694,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 274,
      "content": "decimal\n\n249\n\n>>> [10*x for x in c] [Decimal(\"45.0\"), Decimal(\"30\"), Decimal(\"1.230e4\")] >>> float(a) 42.5 >>> str(a) '42.5'\n\nHere’s an example of changing parameters in the context:\n\n>>> getcontext().prec = 4 >>> a = Decimal(\"3.4562384105\") >>> a Decimal(\"3.4562384105\") >>> b = Decimal(\"5.6273833\") >>> getcontext().flags[Rounded] 0 >>> a + b 9.084 >>> getcontext().flags[Rounded] 1 >>> a / Decimal(\"0\") Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in ?\n\ndecimal.DivisionByZero: x / 0 >>> getcontext().traps[DivisionByZero] = False >>> a / Decimal(\"0\") Decimal(\"Infinity\")\n\nNotes\n\nn The Decimal and Context objects have a large number of methods related to low-level details concerning the representation and behavior of decimal opera- tions.These have not been documented here because they are not essential for the basic use of this module. However, you should consult the online documenta- tion at http://docs.python.org/library/decimal.html for more information.\n\nn The decimal context is unique to each thread. Changes to the context only affect\n\nthat thread and not others.\n\nn A special number, Decimal(\"sNaN\"), may be used as a signaled-NaN.This num- ber is never generated by any of the built-in functions. However, if it appears in a computation, an error is always signaled.You can use this to indicate invalid com- putations that must result in an error and must not be silently ignored. For exam- ple, a function could return sNaN as a result.\n\nn The value of 0 may be positive or negative (that is, Decimal(0) and Decimal\n\n(\"-0\")).The distinct zeros still compare as equals.\n\nn This module is probably unsuitable for high-performance scientific computing due to the significant amount of overhead involved in calculations.Also, there is often little practical benefit in using decimal floating point over binary floating point in such applications.\n\nn A full mathematical discussion of floating-point representation and error analysis is beyond the scope of this book. Readers should consult a book on numerical analysis for further details.The article “What Every Computer Scientist Should\n\nF h Lib f L Bdff",
      "content_length": 2138,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 275,
      "content": "250\n\nChapter 14 Mathematics\n\nKnow About Floating-Point Arithmetic” by David Goldberg, in Computing Surveys,Association for Computing Machinery, March 1991 is also a worthy read (this article is easy to find on the Internet if you simply search for the title). n The IBM General Decimal Arithmetic Specification contains more information\n\nand can be easily located online through search engines.\n\nfractions The fractions module defines a class Fraction that represents a rational number. Instances can be created in three different ways using the class constructor:\n\nFraction([numerator [,denominator]])\n\nCreates a new rational number. numeratorand denominatorhave integral values and default to 0 and 1, respectively.\n\nFraction(fraction)\n\nIf fractionis an instance of numbers.Rational, creates a new rational number with the same value as fraction.\n\nFraction(s)\n\nIf sis a string containing a fraction such as \"3/7\" or \"-4/7\", a fraction with the same value is created. If sis a decimal number such as \"1.25\", a fraction with that value is created (e.g., Fraction(5,4)).\n\nThe following class methods can create Fraction instances from other types of\n\nobjects:\n\nFraction.from_float(f)\n\nCreates a fraction representing the exact value of the floating-point number f.\n\nFraction.from_decimal(d)\n\nCreates a fraction representing the exact value of the Decimal number d.\n\nHere are some examples of using these functions:\n\n>>> f = fractions.Fraction(3,4) >>> g = fractions.Fraction(\"1.75\") >>> g Fraction(7, 4) >>> h = fractions.Fraction.from_float(3.1415926) Fraction(3537118815677477, 1125899906842624) >>>\n\nAn instance fof Fraction supports all of the usual mathematical operations.The numerator and denominator are stored in the f.numerator and f.denominator attributes, respectively. In addition, the following method is defined:\n\nf.limit_denominator([max_denominator])\n\nReturns the fraction that has the closest value to f. max_denominator specifies the largest denominator to use and defaults to 1000000.\n\nF h Lib f L Bdff",
      "content_length": 2021,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 276,
      "content": "math\n\n251\n\nHere are some examples of using Fraction instances (using the values created in\n\nthe earlier example):\n\n>>> f + g Fraction(5, 2) >>> f * g Fraction(21, 16) >>> h.limit_denominator(10) Fraction(22, 7) >>>\n\nThe fractions module also defines a single function:\n\ngcd(a, b)\n\nComputes the greatest common divisor of integers aand b.The result has the same sign as bif bis nonzero; otherwise, it’s the same sign as a.\n\nmath The math module defines the following standard mathematical functions.These func- tions operate on integers and floats but don’t work with complex numbers (a separate module cmath can be used to perform similar operations on complex numbers).The return value of all functions is a float.All trigonometric functions assume the use of radians.\n\nFunction acos(x)\n\nacosh(x)\n\nasin(x)\n\nasinh(x)\n\natan(x)\n\natan2(y, x)\n\natanh(x)\n\nceil(x)\n\ncopysign(x,y)\n\ncos(x)\n\ncosh(x)\n\ndegrees(x)\n\nradians(x)\n\nexp(x)\n\nfabs(x)\n\nfactorial(x)\n\nfloor(x)\n\nfmod(x, y)\n\nfrexp(x)\n\nfsum(s)\n\nDescription Returns the arc cosine of x. Returns the hyperbolic arc cosine of x. Returns the arc sine of x. Returns the hyperbolic arc sine of x. Returns the arc tangent of x. Returns atan(y / x). Returns the hyperbolic arc tangent of x. Returns the ceiling of x. Returns xwith the same sign as y. Returns the cosine of x. Returns the hyperbolic cosine of x. Converts xfrom radians to degrees. Converts xfrom degrees to radians. Returns e ** x. Returns the absolute value of x. Returns xfactorial. Returns the floor of x. Returns x % yas computed by the C fmod() function. Returns the positive mantissa and exponent of xas a tuple. Returns the full precision sum of floating-point values in the iter- able sequence s. See the following note for a description. Returns the Euclidean distance, sqrt(x * x + y * y).\n\nhypot(x, y)\n\ncontinues\n\nF h Lib f L Bdff",
      "content_length": 1841,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 277,
      "content": "252\n\nChapter 14 Mathematics\n\nFunction isinf(x)\n\nDescription Return True if xis infinity. Returns True if xis NaN. Returns x * (2 ** i).\n\nisnan(x)\n\nldexp(x, i) log(x [, base]) Returns the logarithm of xto the given base. If baseis omitted,\n\nlog10(x)\n\nlog1p(x)\n\nmodf(x)\n\npow(x, y)\n\nsin(x)\n\nsinh(x)\n\nsqrt(x)\n\ntan(x)\n\ntanh(x)\n\nthis function computes the natural logarithm. Returns the base 10 logarithm of x. Returns the natural logarithm of 1+x. Returns the fractional and integer parts of x as a tuple. Both have the same sign as x. Returns x ** y. Returns the sine of x. Returns the hyperbolic sine of x. Returns the square root of x. Returns the tangent of x. Returns the hyperbolic tangent of x. Truncates xto the nearest integer towards 0.\n\ntrunc(x)\n\nThe following constants are defined:\n\nConstant pi\n\ne\n\nDescription Mathematical constant pi Mathematical constant e\n\nNotes\n\nn The floating-point values +inf, -inf, and nan can be created by passing strings into the float() function—for example, float(\"inf\"), float(\"-inf\"), or float(\"nan\").\n\nn The math.fsum() function is more accurate than the built-in sum() function\n\nbecause it uses a different algorithm that tries to avoid floating-point errors intro- duced by cancellation effects. For example, consider the sequence s = [1, 1e100, -1e100]. If you use sum(s), you will get a result of 0.0 (because the value of 1 is lost when added to the large value 1e100). However, using math.sum(s) produces the correct result of 1.0.The algorithm used by math.sum() is described in “Adaptive Precision Floating-Point Arithmetic and Fast Robust Geometric Predicates” by Jonathan Richard Shewchuk, Carnegie Mellon University School of Computer Science Technical Report CMU-CS-96- 140, 1996.\n\nnumbers The numbers module defines a series of abstract base classes that serve to organize vari- ous kinds of numbers.The numeric classes are organized into a hierarchy in which each level progressively adds more capabilities.\n\nF h Lib f L Bdff",
      "content_length": 1981,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 278,
      "content": "numbers\n\n253\n\nNumber\n\nA class that serves as the top of the numeric hierarchy.\n\nComplex\n\nA class that represents the complex numbers. Numbers of this type have real and imag attributes.This class inherits from Number.\n\nReal\n\nA class that represents the real numbers. Inherits from Complex.\n\nRational\n\nA class that represents fractions. Numbers of this type have numerator and denominator attributes. Inherits from Real.\n\nIntegral\n\nA class that represents the integers. Inherits from Rational.\n\nThe classes in this module are not meant to be instantiated. Instead, they can be used\n\nto perform various kinds of type checks on values. For example:\n\nif isinstance(x, numbers.Number) # x is any kind of number\n\nstatements\n\nif isinstance(x, numbers.Integral) # x is an integral value\n\nstatements\n\nIf one of these type checks returns True, it means that xis compatible with all of the usual mathematical operations associated with that type and that a conversion to one of the built-in types such as complex(), float(), or int() will work.\n\nThe abstract base classes can also be used as a base class for user-defined classes that are meant to emulate numbers. Doing this is not only just a good idea for type check- ing, but it adds extra safety checks that make sure you implement all of the required methods. For example:\n\n>>> class Foo(numbers.Real): pass ... >>> f = Foo() Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: Can't instantiate abstract class Foo with abstract methods\n\n__abs__, __add__, __div__, __eq__, __float__, __floordiv__, __le__, __lt__, __mod__, __mul__, __neg__, __pos__, __pow__, __radd__, __rdiv__, ➥__rfloordiv__, __rmod__, __rmul__, __rpow__, __rtruediv__, __truediv__, __trunc__\n\n>>>\n\nNotes\n\nn Refer to Chapter 7 (“Classes and Object-Oriented Programming”) for more\n\ninformation on abstract base classes.\n\nn PEP 3141 (http://www.python.org/dev/peps/pep-3141) has more information\n\nabout the type hierarchy and intended use of this module.\n\nF h Lib f L Bdff",
      "content_length": 2016,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 279,
      "content": "254\n\nChapter 14 Mathematics\n\nrandom The random module provides a variety of functions for generating pseudo-random numbers as well as functions for randomly generating values according to various distri- butions on the real numbers. Most of the functions in this module depend on the func- tion random(), which generates uniformly distributed numbers in the range [0.0, 1.0) using the Mersenne Twister generator.\n\nSeeding and Initialization The following functions are used to control the state of the underlying random number generator:\n\nseed([x])\n\nInitializes the random number generator. If xis omitted or None, the system time is used to seed the generator. Otherwise, if xis an integer or long integer, its value is used. If xis not an integer, it must be a hashable object and the value of hash(x) is used as a seed.\n\ngetstate()\n\nReturns an object representing the current state of the generator.This object can later be passed to setstate() to restore the state.\n\nsetstate(state)\n\nRestores the state of the random number generator from an object returned by getstate().\n\njumpahead(n)\n\nQuickly changes the state of the generator to what it would be if random() were called ntimes in a row. nmust be a nonnegative integer.\n\nRandom Integers The following functions are used to manipulate random integers.\n\ngetrandbits(k)\n\nCreates a long integer containing krandom bits.\n\nrandint(a,b)\n\nReturns a random integer, x, in the range a <= x <= b.\n\nrandrange(start,stop [,step])\n\nReturns a random integer in range(start,stop,step). Does not include the end- point.\n\nRandom Sequences The following functions are used to randomize sequence data.\n\nchoice(seq)\n\nReturns a random element from the nonempty sequence seq.\n\nF h Lib f L Bdff",
      "content_length": 1728,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 280,
      "content": "random\n\n255\n\nsample(s, len)\n\nReturns a sequence length, len, containing elements chosen randomly from the sequence s.The elements in the resulting sequence are placed in the order in which they were selected.\n\nshuffle(x [,random])\n\nRandomly shuffles the items in the list xin place. randomis an optional argument that specifies a random generation function. If supplied, it must be a function that takes no arguments and returns a floating-point number in the range [0.0, 1.0).\n\nReal-Valued Random Distributions The following functions generate random numbers on real numbers. Distribution and parameter names correspond to the standard names used in probability and statistics.You will need to consult an appropriate text to find out more details.\n\nrandom()\n\nReturns a random number in the range [0.0, 1.0).\n\nuniform(a,b)\n\nReturns a uniformly distributed random number in the range [a, b).\n\nbetavariate(alpha, beta)\n\nReturns a value between 0 and 1 from the Beta distribution. alpha > -1 and beta > -1.\n\ncunifvariate(mean, arc)\n\nCircular uniform distribution. meanis the mean angle, and arcis the range of the dis- tribution, centered around the mean angle. Both of these values must be specified in radians in the range between 0 and pi. Returned values are in the range (mean - arc/2, mean + arc/2).\n\nexpovariate(lambd)\n\nExponential distribution. lambdis 1.0 divided by the desired mean. Returns values in the range [0, +Infinity).\n\ngammavariate(alpha, beta)\n\nGamma distribution. alpha > -1, beta > 0.\n\ngauss(mu, sigma)\n\nGaussian distribution with mean muand standard deviation sigma. Slightly faster than normalvariate().\n\nlognormvariate(mu, sigma)\n\nLog normal distribution.Taking the natural logarithm of this distribution results in a normal distribution with mean muand standard deviation sigma.\n\nnormalvariate(mu, sigma)\n\nNormal distribution with mean muand standard deviation sigma.\n\nF h Lib f L Bdff",
      "content_length": 1909,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 281,
      "content": "256\n\nChapter 14 Mathematics\n\nparetovariate(alpha)\n\nPareto distribution with shape parameter alpha.\n\ntriangular([low [, high [, mode]]])\n\nTriangular distribution.A random number nin the range low <= n < highwith mode mode. By default, lowis 0, highis 1.0, and modeis set to the midpoint of low and high.\n\nvonmisesvariate(mu, kappa)\n\nvon Mises distribution, where muis the mean angle in radians between 0 and 2 * pi and kappais a nonnegative concentration factor. If kappais zero, the distribution reduces to a uniform random angle over the range 0 to 2 * pi.\n\nweibullvariate(alpha, beta)\n\nWeibull distribution with scale parameter alphaand shape parameter beta.\n\nNotes\n\nn The functions in this module are not thread-safe. If you are generating random numbers in different threads, you should use locking to prevent concurrent access.\n\nn The period of the random number generator (before numbers start repeating) is\n\n2**19937–1.\n\nn The random numbers generated by this module are deterministic and should not\n\nbe used for cryptography.\n\nn New types of random number generators can be created by subclassing\n\nrandom.Random and implementing the random(), seed(), getstate(), getstate(), and jumpahead() methods.All the other functions in this module are actually internally implemented as methods of Random.Thus, they could be accessed as methods of an instance of the new random number generator. n The module provides two alternative random number generators classes—\n\nWichmannHill and SystemRandom—that are used by instantiating the appropri- ate class and calling the preceding functions as methods.The WichmannHill class implements the Wichmann-Hill generator that was used in earlier Python releas- es.The SystemRandom class generates random numbers using the system random number generator os.urandom().\n\nF h Lib f L Bdff",
      "content_length": 1824,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 282,
      "content": "15\n\nData Structures, Algorithms, and Code Simplification\n\nThe modules in this chapter are used to address common programming problems\n\nrelated to data structures; algorithms; and the simplification of code involving iteration, function programming, context managers, and classes.These modules should be viewed as a extension of Python’s built-in types and functions. In many cases, the underlying implementation is highly efficient and may be better suited to certain kinds of problems than what is available with the built-ins.\n\nabc The abc module defines a metaclass and a pair of decorators for defining new abstract base classes.\n\nABCMeta\n\nA metaclass that represents an abstract base class.To define an abstract class, you define a class that uses ABCMeta as a metaclass. For example:\n\nimport abc class Stackable: # In Python 3, use the syntax\n\n__metaclass__ = abc.ABCMeta # class Stackable(metaclass=abc.ABCMETA) ...\n\nA class created in this manner differs from an ordinary class in a few critical ways:\n\nn First, if the abstract class defines methods or properties that are decorated with the abstractmethod and abstractproperty decorators described later, then instances of derived classes can’t be created unless those classes provide a non- abstract implementation of those methods and properties.\n\nn Second, an abstract class has a class method register(subclass) that can be\n\nused to register additional types as a logical subclass. For any type subclassreg- istered with this function, the operation isinstance(x, AbstractClass) will return True if xis an instance of subclass.\n\nn A final feature of abstract classes is that they can optionally define a special class method _ _subclasshook_ _(cls, subclass).This method should return True if the type subclassis considered to be a subclass, return False if subclassis not a subclass, or raise a NotImplemented exception if nothing is known.\n\nF h Lib f L Bdff",
      "content_length": 1922,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 283,
      "content": "258\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nabstractmethod(method)\n\nA decorator that declares methodto be abstract.When used in an abstract base class, derived classes defined directly via inheritance can only be instantiated if they define a nonabstract implementation of the method.This decorator has no effect on subclasses registered using the register() method of an abstract base.\n\nabstractproperty(fget [, fset [, fdel [, doc]]])\n\nCreates an abstract property.The parameters are the same as the normal property() function.When used in an abstract base, derived classes defined directly via inheritance can only be instantiated if they define a nonabstract implementation of the property.\n\nThe following code provides an example of defining a simple abstract class:\n\nfrom abc import ABCMeta, abstractmethod, abstractproperty class Stackable: # In Python 3, use the syntax\n\n__metaclass__ = ABCMeta # class Stackable(metaclass=ABCMeta) @abstractmethod def push(self,item):\n\npass\n\n@abstractmethod def pop(self):\n\npass\n\n@abstractproperty def size(self):\n\npass\n\nHere is an example of a class that derives from Stackable:\n\nclass Stack(Stackable): def __init__(self): self.items = []\n\ndef push(self,item):\n\nself.items.append(item)\n\ndef pop(self):\n\nreturn self.items.pop()\n\nHere is the error message that you get if you try to create a Stack:\n\n>>> s = Stack() Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: Can't instantiate abstract class Stack with abstract methods size >>>\n\nThis error can be fixed by adding a size() property to Stack.You can either do this by modifying the definition of Stack itself or inheriting from it and adding the required method or property:\n\nclass CompleteStack(Stack):\n\n@property def size(self):\n\nreturn len(self.items)\n\nHere is an example of using the complete stack object:\n\n>>> s = CompleteStack() >>> s.push(\"foo\") >>> s.size 1 >>>\n\nF h Lib f L Bdff",
      "content_length": 1946,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 284,
      "content": "array\n\n259\n\nSee Also:\n\nChapter 7, “Classes and Object-Oriented Programming,” numbers (p. 252), collections (p. 262).\n\narray The array module defines a new object type, array, that works almost exactly like a list, except that its contents are constrained to a single type.The type of an array is determined at the time of creation, using one of the type codes shown in Table 15.1.\n\nTable 15.1 Type Codes\n\nType Code\n\nDescription\n\nC Type\n\nMinimum Size (in Bytes)\n\n'c'\n\n'b'\n\n'B'\n\n'u'\n\n'h'\n\n'H'\n\n'i'\n\n'I'\n\n'l'\n\n'L'\n\n'f'\n\n8-bit character 8-bit integer 8-bit unsigned integer Unicode character 16-bit integer 16-bit unsigned integer Integer Unsigned integer Long integer Unsigned long integer Single-precision float Double-precision float\n\nchar\n\nsigned char\n\nunsigned char\n\nPY_UNICODE\n\nshort\n\nunsigned short\n\nint\n\nunsigned int\n\nlong\n\nunsigned long\n\nfloat\n\n1 1 1 2 or 4 2 2 4 or 8 4 or 8 4 or 8 4 or 8 4 8\n\n'd'\n\ndouble\n\nThe representation of integers and long integers is determined by the machine architec- ture (they may be 32 or 64 bits).When values stored as 'L' or 'I' are returned, they’re returned as long integers in Python 2.\n\nThe module defines the following type:\n\narray(typecode [, initializer])\n\nCreates an array of type typecode. initializeris a string or list of values used to initialize values in the array.The following attributes and methods apply to an array object, a:\n\nItem a.typecode\n\nDescription Type code character used to create the array. Size of items stored in the array (in bytes). Appends xto the end of the array.\n\na.itemsize\n\na.append(x) a.buffer_info() Returns (address, length), giving the memory location and length of the buffer used to store the array. Swaps the byte ordering of all items in the array from big-endian to little-endian, or vice versa. This is only supported for integer values.\n\na.byteswap()\n\ncontinues\n\nF h Lib f L Bdff",
      "content_length": 1868,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 285,
      "content": "260\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nItem a.count(x)\n\na.extend(b)\n\nDescription Returns the number of occurrences of xin a. Appends bto the end of array a. bcan be an array or an iterable object whose elements are the same type as in a.\n\na.fromfile(f, n) Reads nitems (in binary format) from the file object fand\n\nappends to the end of the array. fmust be a file object. Raises EOFError if fewer than nitems can be read.\n\na.fromlist(list) Appends items from listto the end of the array. listcan be\n\nany iterable object.\n\na.fromstring(s) Appends items from string s, where sis interpreted as a string\n\na.index(x)\n\na.insert(i, x)\n\na.pop([i])\n\na.remove(x)\n\na.reverse()\n\na.tofile(f)\n\na.tolist()\n\na.tostring()\n\na.tounicode()\n\nof binary values—same as would have been read using fromfile(). Returns the index of the first occurrence of xin a. Raises ValueError if not found. Inserts xbefore position i. Removes item ifrom the array and returns it. If iis omitted, the last element is removed. Removes the first occurrence of xfrom the array. Raises ValueError if not found. Reverses the order of the array. Writes all items to file f. Data is saved in native binary format. Converts the array to an ordinary list of values. Converts to a string of binary data—the same data as would be written using tofile(). Converts the array to a Unicode string. Raises ValueError if the array is not of type 'u'.\n\nWhen items are inserted into an array, a TypeError exception is generated if the type of the item doesn’t match the type used to create the array.\n\nThe array module is useful if you need to have space-efficient storage for lists of data and you know that all items in the list are going to be the same type. For example, storing 10 million integers in a list requires about 160MB of memory whereas an array of 10 million integers requires only 40MB. Despite this space savings, none of the basic operations on an array tend to be faster than their list counterparts—in fact, they may be slower.\n\nIn performing calculations with arrays, you will want to be careful with operations that create lists. For example, using a list comprehension on an array will convert the entire array into a list, defeating any space-saving benefit.A better way to handle this is to create new arrays using generator expressions. For example:\n\na = array.array(\"i\", [1,2,3,4,5]) b = array.array(a.typecode, (2*x for x in a)) # Create a new array from b\n\nBecause the point of using an array is to save space, it may be more desirable to perform “in-place” operations.An efficient way to do this is with code that uses enumerate(), like this:\n\na = array.array(\"i\", [1,2,3,4,5]) for i, x in enumerate(a):\n\na[i] = 2*x\n\nF h Lib f L Bdff",
      "content_length": 2738,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 286,
      "content": "bisect\n\n261\n\nFor large arrays, this in-place modification runs about 15 percent faster than the code that creates a new array with a generator expression.\n\nNotes\n\nn The arrays created by this module are not suitable for numeric work such as\n\nmatrix or vector math. For example, the addition operator doesn’t add the corre- sponding elements of the arrays; instead, it appends one array to the other.To cre- ate storage and calculation efficient arrays, use the numpy extension available at http://numpy.sourceforge.net/. Note that the numpy API is completely different.\n\nn The += operator can be used to append the contents of another array.The *=\n\noperator can be used to repeat an array.\n\nSee Also:\n\nstruct (p. 290)\n\nbisect The bisect module provides support for keeping lists in sorted order. It uses a bisec- tion algorithm to do most of its work.\n\nbisect(list, item [, low [, high]])\n\nReturns the index of the insertion point for itemto be placed in listin order to maintain listin sorted order. lowand highare indices specifying a subset of the list to examine. If itemsis already in the list, the insertion point will always be to the right of existing entries in the list.\n\nbisect_left(list, item [, low [, high]])\n\nReturns the index of the insertion point for itemto be placed in listin order to maintain listin sorted order. lowand highare indices specifying a subset of the list to examine. If itemsis already in the list, the insertion point will always be to the left of existing entries in the list.\n\nbisect_right(list, item [, low [, high]])\n\nThe same as bisect().\n\ninsort(list, item [, low [, high]])\n\nInserts iteminto listin sorted order. If itemis already in the list, the new entry is inserted to the right of any existing entries.\n\ninsort_left(list, item [, low [, high]])\n\nInserts iteminto listin sorted order. If itemis already in the list, the new entry is inserted to the left of any existing entries.\n\ninsort_right(list, item [, low [, high]])\n\nThe same as insort().\n\nF h Lib f L Bdff",
      "content_length": 2009,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 287,
      "content": "262\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\ncollections The collections module contains high-performance implementations of a few useful container types, abstract base classes for various kinds of containers, and a utility func- tion for creating name-tuple objects. Each is described in the sections that follow.\n\ndeque and defaultdict Two new containers are defined in the collections module: deque and defaultdict.\n\ndeque([iterable [, maxlen]])\n\nType representing a double-ended queue (deque, pronounced “deck”) object. iterable is an iterable object used to populate the deque.A deque allows items to be inserted or removed from either end of the queue.The implementation has been optimized so that the performance of these operations is approximately the same as (O(1)).This is slightly different from a list where operations at the front of the list may require shifting of all the elements that follow. If the optional maxlenargument is supplied, the resulting deque object becomes a circular buffer of that size.That is, if new items are added, but there is no more space, items are deleted from the opposite end to make room.\n\nAn instance, d, of deque has the following methods:\n\nd.append(x)\n\nAdds xto the right side of d.\n\nd.appendleft(x)\n\nAdds xto the left side of d.\n\nd.clear()\n\nRemoves all items from d.\n\nd.extend(iterable)\n\nExtends dby adding all the items in iterableon the right.\n\nd.extendleft(iterable)\n\nExtends dby adding all the items in iterableon the left. Due to the sequence of left appends that occur, items in iterablewill appear in reverse order in d.\n\nd.pop()\n\nReturns and removes an item from the right side of d. Raises IndexError if dis empty.\n\nd.popleft()\n\nReturns and removes an item from the left side of d. Raises IndexError if dis empty.\n\nd.remove(item)\n\nRemoves the first occurrence of item. Raises ValueError if no match is found.\n\nF h Lib f L Bdff",
      "content_length": 1911,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 288,
      "content": "collections\n\n263\n\nd.rotate(n)\n\nRotates all the items nsteps to the right. If nis negative, items are rotated to the left. Deques are often overlooked by many Python programmers. However, this type offers many advantages. First, the implementation is highly efficient—even to a level of using internal data structures that provide good processor cache behavior.Appending items at the end is only slightly slower than the built-in list type, whereas inserting items at the front is significantly faster. Operations that add new items to a deque are also thread-safe, making this type appropriate for implementing queues. deques can also be serialized using the pickle module.\n\ndefaultdict([default_factory], ...)\n\nA type that is exactly the same as a dictionary except for the handling of missing keys. When a lookup occurs on a key that does not yet exist, the function supplied as default_factory is called to provide a default value which is then saved as the value of the associated key.The remaining arguments to defaultdict are exactly the same as the built-in dict() function.An instance dof defaultdictionary has the same operations as a built-in dictionary.The attribute d.default_factory contains the function passed as the first argument and can be modified as necessary.\n\nA defaultdict object is useful if you are trying to use a dictionary as a container\n\nfor tracking data. For example, suppose you wanted to keep track of the position of each word in a string s. Here is how you could use a defaultdict to do this easily:\n\n>>> from collections import defaultdict >>> s = \"yeah but no but yeah but no but yeah\" >>> words = s.split() >>> wordlocations = defaultdict(list) >>> for n, w in enumerate(words): ... ... >>> wordlocations defaultdict(<type 'list'>, {'yeah': [0, 4, 8], 'but': [1, 3, 5, 7], 'no': [2, 6]}) >>>\n\nwordlocations[w].append(n)\n\nIn this example, the lookup wordlocations[w] will “fail” the first time a word is encountered. However, instead of raising a KeyError, the function list supplied as default_factory is called to create a new value. Built-in dictionaries have a method setdefault() that can be used to achieve a similar result, but it often makes code confusing to read and run slower. For example, the statement that appends a new item shown previously could be replaced by wordlocations.setdefault(w,[]).append(n).This is not nearly as clear and in a simple timing test, it runs nearly twice as slow as using a defaultdict object.\n\nNamed Tuples Tuples are frequently used to represent simple data structures. For example, a network address might be represented as a tuple addr = (hostname, port).A common com- plaint with tuples is that the individual items have to be accessed by numerical index— for example, addr[0] or addr[1].This leads to code that is confusing to read and hard to maintain unless you can remember what all of the index values mean (and the prob- lem gets worse the larger the tuple gets).\n\nF h Lib f L Bdff",
      "content_length": 2971,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 289,
      "content": "264\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nThe collections module contains a function namedtuple() that is used to create\n\nsubclasses of tuple in which attribute names can be used to access tuple elements.\n\nnamedtuple(typename, fieldnames [, verbose])\n\nCreates a subclass of tuple with name typename. fieldnamesis a list of attribute names specified as strings.The names in this list must be valid Python identifiers, must not start with an underscore, and are specified in the same order as the items appearing in the tuple—for example, ['hostname','port']. Alternatively, fieldnamescan be specified as a string such as 'hostname port' or 'hostname, port'.The value returned by this function is a class whose name has been set to the value supplied in typename.You use this class to create instances of named tuples.The verboseflag, if set to True, prints the resulting class definition to standard output.\n\nHere is an example of using this function:\n\n>>> from collections import namedtuple >>> NetworkAddress = namedtuple('NetworkAddress',['hostname','port']) >>> a = NetworkAddress('www.python.org',80) >>> a.hostname 'www.python.org' >>> a.port 80 >>> host, port = a >>> len(a) 2 >>> type(a) <class '__main__.NetworkAddress'> >>> isinstance(a, tuple) True >>>\n\nIn this example, the named tuple NetworkAddress is, in every way, indistinguished from a normal tuple except for the added support of being able to use attribute lookup such as a.hostname or a.port to access tuple components.The underlying implementation is efficient—the class that is created does not use an instance dictionary or add any additional memory overhead in a built-in tuple.All of the normal tuple operations still work.\n\nA named tuple can be useful if defining objects that really only serve as a data struc-\n\ntures. For example, instead of a defining a class, like this:\n\nclass Stock(object):\n\ndef __init__(self,name,shares,price):\n\nself.name = name self.shares = shares self.price = price\n\nyou could define a named tuple instead:\n\nimport collections Stock = collections.namedtuple('Stock','name shares price')\n\nBoth versions are going to work in a nearly identical manner. For example, in either case, you would access fields by writing s.name, s.shares, and so on. However, the benefit of the named tuple is that it is more memory-efficient and supports various tuple operations such as unpacking (for example, if you had a list of named tuples, you could unpack values in a for-loop with a statement such as for name, shares,\n\nF h Lib f L Bdff",
      "content_length": 2554,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 290,
      "content": "collections\n\n265\n\nprice in stockList).The downside to a named tuple is that attribute access is not as efficient as with a class. For example, accessing s.shares is more than twice as slow if s is an instance of a named tuple instead of an ordinary class.\n\nNamed tuples are frequently used in other parts of the Python standard library. Here, their use is partly historical—in many library modules, tuples were originally used as the return value of various functions that would return information about files, stack frames, or other low-level details. Code that used these tuples wasn’t always so elegant. Thus, the switch to a named tuple was made to clean up their usage without breaking backwards compatibility.Another subtle problem with tuples is that once you start using a tuple, the expected number of fields is locked forever (e.g., if you suddenly add a new field, old code will break).Variants of named tuples have been used in the library to add new fields to the data returned by certain functions. For example, an object might sup- port a legacy tuple interface, but then provide additional values that are only available as named attributes.\n\nAbstract Base Classes The collections module defines a series of abstract base classes.The purpose of these classes is to describe programming interfaces on various kinds of containers such as lists, sets, and dictionaries.There are two primary uses of these classes. First, they can be used as a base class for user-defined objects that want to emulate the functionality of built-in container types. Second, they can be used for type checking. For example, if you wanted to check that sworked like a sequence, you could use isinstance(s, collections.Sequence).\n\nContainer\n\nBase class for all containers. Defines a single abstract method __contains_ _(), which implements the in operator.\n\nHashable\n\nBase class for objects that can be used as a hash table key. Defines a single abstract method _ _hash_ _().\n\nIterable\n\nBase class for objects that support the iteration protocol. Defines a single abstract method _ _iter_ _().\n\nIterator\n\nBase class for iterator objects. Defines the abstract method next() but also inherits from Iterable and provides a default implementation of _ _iter_ _() that simply does nothing.\n\nSized\n\nBase class for containers whose size can be determined. Defines the abstract method _ _len_ _().\n\nCallable\n\nBase class for objects that support function call. Defines the abstract method _ _call_ _().\n\nF h Lib f L Bdff",
      "content_length": 2502,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 291,
      "content": "266\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nSequence\n\nBase class for objects that look like sequences. Inherits from Container, Iterable, and Sized and defines the abstract methods _ _getitem_ _() and _ _len_ _().Also provides a default implementation of _ _contains_ _(), _ _iter_ _(), _ _reversed_ _(), index(), and count() that are implemented using nothing but the _ _getitem_ _() and _ _len_ _() methods.\n\nMutableSequence\n\nBase class for mutable sequences. Inherits from Sequence and adds the abstract methods _ _setitem_ _() and _ _delitem_ _().Also provides a default implementation of append(), reverse(), extend(), pop(), remove(), and _ _iadd_ _().\n\nSet\n\nBase class for objects that work like sets. Inherits from Container, Iterable, and Sized and defines the abstract methods _ _len_ _(), _ _iter_ _(), and _ _contains_ _().Also provides a default implementation of the set operators _ _le_ _(), _ _lt_ _(), _ _eq_ _(), _ _ne_ _(), _ _gt_ _(), _ _ge_ _(), _ _and_ _(), _ _or_ _(), _ _xor_ _(), _ _sub_ _(), and isdisjoint().\n\nMutableSet\n\nBase class for mutable sets. Inherits from Set and adds the abstract methods add() and discard().Also provides a default implementation of clear(), pop(), remove(), _ _ior_ _(), _ _iand_ _(), _ _ixor_ _(), and _ _isub_ _().\n\nMapping\n\nBase class for objects that support mapping (dictionary) lookup. Inherits from Sized, Iterable, and Container and defines the abstract methods _ _getitem_ _(), _ _len_ _(), and _ _iter_ _().A default implementation of _ _contains_ _(), keys(), items(), values(), get(), _ _eq_ _(), and _ _ne_ _() is also provided.\n\nMutableMapping\n\nBase class for mutable mapping objects. Inherits from Mapping and adds the abstract methods _ _setitem_ _() and _ _delitem_ _().An implementation of pop(), popitem(), clear(), update(), and setdefault() is also added.\n\nMappingView\n\nBase class for mapping views.A mapping view is an object that is used for accessing the internals of a mapping object as a set. For example, a key view is a set-like object that shows the keys in a mapping. See Appendix A,“Python 3” for more details.\n\nKeysView\n\nBase class for a key view of a mapping. Inherits from MappingView and Set.\n\nItemsView\n\nBase class for item view of a mapping. Inherits from MappingView and Set.\n\nValuesView\n\nBase class for a (key, item) view of a mapping. Inherits from MappingView and Set.\n\nF h Lib f L Bdff",
      "content_length": 2409,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 292,
      "content": "contextlib\n\n267\n\nPython’s built-in types are already registered with all of these base classes as appro-\n\npriate.Also, by using these base classes, it is possible to write programs that are more precise in their type checking. Here are some examples:\n\n# Pull off the last item of a sequence if isinstance(x, collections.Sequence):\n\nlast = x[-1]\n\n# Only iterate over an object if its size is known if isinstance(x, collections.Iterable) and isinstance(x, collections.Sized):\n\nfor item in x: statements\n\n# Add a new item to a set if isinstance(x, collections.MutableSet):\n\nx.add(item)\n\nSee Also:\n\nChapter 7, “Classes and Object-Oriented Programming.”\n\ncontextlib The contextlib module provides a decorator and utility functions for creating context managers used in conjunction with the with statement.\n\ncontextmanager(func)\n\nA decorator that creates a context manager from a generator function func.The way in which you use this decorator is as follows:\n\n@contextmanager def foo(args): statements try:\n\nyield value\n\nexcept Exception as e:\n\nerror handling (if any)\n\nstatements\n\nWhen the statement with foo(args) as valueappears, the generator function is executed with the supplied arguments until the first yield statement is reached.The value returned by yield is placed into the variable value.At this point, the body of the with statement executes. Upon completion, the generator function resumes. If any kind of exception is raised inside the with-body, that exception is raised inside the gen- erator function where it can be handled as appropriate. If the error is to be propagated, the generator should use raise to re-raise the exception.An example of using this deco- rator can be found in the “Context Managers” section of Chapter 5.\n\nnested(mgr1, mgr2, ..., mgrN)\n\nA function that invokes more than one context manager mgr1, mgr2, and so on as a sin- gle operation. Returns a tuple containing the different return values of the with state- ments.The statement with nested(m1,m2) as (x,y): statementsis the same as\n\nF h Lib f L Bdff",
      "content_length": 2041,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 293,
      "content": "268\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nsaying with m1 as x: with m2 as y: statements. Be aware that if an inner con- text manager traps and suppresses an exception, no exception information is passed along to the outer managers.\n\nclosing(object)\n\nCreates a context manager that automatically executes object.close() when execu- tion leaves the body of the with statement.The value returned by the with statement is the same as object.\n\nfunctools The functools module contains functions and decorators that are useful for creating higher-order functions, functional programming, and decorators.\n\npartial(function [, *args [, **kwargs]])\n\nCreates a function-like object, partial, that when called, calls functionwith posi- tional arguments args, keyword arguments kwargs, and any additional positional or keyword arguments that are supplied.Additional positional arguments are added to the end of args, and additional keyword arguments are merged into kwargs, overwriting any previously defined values (if any).A typical use of partial() is when making a large number of function calls where many of the arguments are held fixed. For example:\n\nfrom functools import partial mybutton = partial(Button, root, fg=\"black\",bg=\"white\",font=\"times\",size=\"12\") b1 = mybutton(text=\"Ok\") # Calls Button() with text=\"Ok\" and all of the b2 = mybutton(text=\"Cancel\") # additional arguments supplied to partial() above b3 = mybutton(text=\"Restart\")\n\nAn instance pof the object created by partialhas the following attributes:\n\nItem p.func\n\np.args\n\np.keywords\n\nDescription Function that is called when pis called. Tuple containing the leftmost positional arguments supplied to p.func when called. Additional positional arguments are con- catenated to the end of this value. Dictionary containing the keyword arguments supplied to p.func when called. Additional keyword arguments are merged into this dictionary.\n\nUse caution when using a partial object as a stand-in for a regular function.The result is not exactly the same as a normal function. For instance, if you use partial() inside a class definition, it behaves like a static method, not an instance method.\n\nreduce(function, items [, initial])\n\nApplies a function, function, cumulatively to the items in the iterable itemsand returns a single value. functionmust take two arguments and is first applied to the first two items of items.This result and subsequent elements of itemsare then combined one at a time in a similar manner, until all elements of itemshave been consumed. initialis an optional starting value used in the first computation and when itemsis\n\nF h Lib f L Bdff",
      "content_length": 2652,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 294,
      "content": "heapq\n\n269\n\nempty.This function is the same as the reduce() function that was a built-in in Python 2. For future compatibility, use this version instead.\n\nupdate_wrapper(wrapper, wrapped [, assigned [, updated]])\n\nThis is a utility function that is useful when writing decorators. Copies attributes from a function wrappedto a wrapper function wrapperin order to make the wrapped func- tion look like the original function. assignedis a tuple of attribute names to copy and is set to ('_ _name_ _','_ _module_ _','_ _doc_ _') by default. updatedis a tuple containing the names of function attributes that are dictionaries and which you want values merged in the wrapper. By default, it is a tuple ('_ _dict_ _',).\n\nwraps(function [, assigned [, updated ]])\n\nA decorator carries out the same task as update_wrapper() on the function to which it is applied. assignedand updatedhave the same meaning.A typical use of this deco- rator is when writing other decorators. For example:\n\nfrom functools import wraps def debug(func): @wraps(func) def wrapped(*args,**kwargs):\n\nprint(\"Calling %s\" % func.__name__) r = func(*args,**kwargs) print(\"Done calling %s\" % func.__name__)\n\nreturn wrapped\n\n@debug def add(x,y):\n\nreturn x+y\n\nSee Also:\n\nChapter 6, “Functions and Functional Programming.”\n\nheapq The heapq module implements a priority queue using a heap. Heaps are simply lists of ordered items in which the heap condition has been imposed. Specifically, heap[n] <= heap[2*n+1] and heap[n] <= heap[2*n+2] for all n, starting with n = 0. heap[0] always contains the smallest item.\n\nheapify(x)\n\nConverts a list, x, into a heap, in place.\n\nheappop(heap)\n\nReturns and removes the smallest item from heap, preserving the heap condition. Raises IndexError if heapis empty.\n\nheappush(heap, item)\n\nAdds itemto the heap, preserving the heap condition.\n\nF h Lib f L Bdff",
      "content_length": 1853,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 295,
      "content": "270\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nheappushpop(heap, item)\n\nAdds itemto the heap and removes the smallest item from heapin a single operation. This is more efficient than calling heappush() and heappop() separately.\n\nheapreplace(heap, item)\n\nReturns and removes the smallest itemfrom the heap.At the same time, a new itemis added.The heap condition is preserved in the process.This function is more efficient than calling heappop() and heappush() in sequence. In addition, the returned value is obtained prior to adding the new item.Therefore, the return value could be larger than item. Raises IndexError if heapis empty.\n\nmerge(s1, s2, ...)\n\nCreates an iterator that merges the sorted iterables s1, s2, and so on into a single sorted sequence.This function does not consume the inputs but returns an iterator that incre- mentally processes the data.\n\nnlargest(n, iterable [, key])\n\nCreates a list consisting of the nlargest items in iterable.The largest item appears first in the returned list. keyis an optional function that takes a single input parameter and computes the comparison key for each item in iterable.\n\nnsmallest(n, iterable [, key])\n\nCreates a list consisting of the nsmallest items in iterable.The smallest item appears first in the returned list. keyis an optional key function.\n\nNote\n\nThe theory and implementation of heap queues can be found in most books on algo- rithms.\n\nitertools The itertools module contains functions for creating efficient iterators, useful for looping over data in various ways.All the functions in this module return iterators that can be used with the for statement and other functions involving iterators such as gen- erators and generator expressions.\n\nchain(iter1, iter2, ..., iterN)\n\nGiven a group of iterators (iter1, … , iterN), this function creates a new iterator that chains all the iterators together.The returned iterator produces items from iter1until it is exhausted.Then items from iter2are produced.This continues until all the items in iterNare exhausted.\n\nchain.from_iterable(iterables)\n\nAn alternative constructor for a chain where the iterablesis an iterable that produces a sequence of iterable objects.The result of this operation is the same as what would be produced by the following fragment of generator code:\n\nF h Lib f L Bdff",
      "content_length": 2336,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 296,
      "content": "itertools\n\n271\n\nfor it in iterables: for x in it:\n\nyield x\n\ncombinations(iterable, r)\n\nCreates an iterator that returns all r-length subsequences of items taken from iterable.The items in the returned subsequences are ordered in the same way in which they were ordered in the input iterable. For example, if iterableis the list [1,2,3,4], the sequence produced by combinations([1,2,3,4], 2) is [1,2], [1,3], [1,4], [2,3], [3,4].\n\ncount([n])\n\nCreates an iterator that produces consecutive integers starting with n. If nis omitted, counting starts at 0. (Note that this iterator does not support long integers. If sys.maxintis exceeded, the counter overflows and continues to count starting with -sys.maxint - 1.)\n\ncycle(iterable)\n\nCreates an iterator that cycles over the elements in iterableover and over again. Internally, a copy of the elements in iterableis made.This copy is used to return the repeated items in the cycle.\n\ndropwhile(predicate, iterable)\n\nCreates an iterator that discards items from iterableas long as the function predicate(item) is True. Once predicatereturns False, that item and all subse- quent items in iterableare produced.\n\ngroupby(iterable [, key])\n\nCreates an iterator that groups consecutive items produced by iterable.The grouping process works by looking for duplicate items. For instance, if iterableproduces the same item on several consecutive iterations, that defines a group. If this is applied to a sorted list, the groups would define all the unique items in the list. key, if supplied, is a function that is applied to each item. If present, the return value of this function is used to compare successive items instead of the items themselves.The iterator returned by this function produces tuples (key, group), where keyis the key value for the group and groupis an iterator that yields all the items that made up the group.\n\nifilter(predicate, iterable)\n\nCreates an iterator that only produces items from iterablefor which predicate(item) is True. If predicateis None, all the items in iterablethat evalu- ate as True are returned.\n\nifilterfalse(predicate, iterable)\n\nCreates an iterator that only produces items from iterablefor which predicate(item) is False. If predicateis None, all the items in iterablethat eval- uate as False are returned.\n\nF h Lib f L Bdff",
      "content_length": 2310,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 297,
      "content": "272\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nimap(function, iter1, iter2, ..., iterN)\n\nCreates an iterator that produces items function(i1,i2, .. iN), where i1, i2, …, iNare items taken from the iterators iter1, iter2, …, iterN, respectively. If function is None, the tuples of the form (i1, i2, ..., iN) are returned. Iteration stops whenever one of the supplied iterators no longer produces any values.\n\nislice(iterable, [start,] stop [, step])\n\nCreates an iterator that produces items in a manner similar to what would be returned by a slice, iterable[start:stop:step].The first startitems are skipped and itera- tion stops at the position specified in stop. stepspecifies a stride that’s used to skip items. Unlike slices, negative values may not be used for any of start, stop, or step. If startis omitted, iteration starts at 0. If stepis omitted, a step of 1 is used.\n\nizip(iter1, iter2, ... iterN)\n\nCreates an iterator that produces tuples (i1, i2, ..., iN), where i1, i2, …, iNare taken from the iterators iter1, iter2, …, iterN, respectively. Iteration stops whenever one of the supplied iterators no longer produces any values.This function produces the same values as the built-in zip() function.\n\nizip_longest(iter1, iter2, ..., iterN [,fillvalue=None])\n\nThe same as izip() except that iteration continues until all of the input iterables iter1, iter2, and so on are exhausted. None is used to fill in values for the iterables that are already consumed unless a different value is specified with the fillvalue key- word argument.\n\npermutations(iterable [, r])\n\nCreates an iterator that returns all r-length permutations of items from iterable. If r is omitted, then permutations have the same length as the number of items in iterable.\n\nproduct(iter1, iter2, ... iterN, [repeat=1])\n\nCreates an iterator that produces tuples representing the Cartesian product of items in item1, item2, and so on. repeatis a keyword argument that specifies the number of times to repeat the produced sequence.\n\nrepeat(object [, times])\n\nCreates an iterator that repeatedly produces object. times, if supplied, specifies a repeat count. Otherwise, the object is returned indefinitely.\n\nstarmap(func [, iterable])\n\nCreates an iterator that produces the values func(*item), where itemis taken from iterable.This only works if iterableproduces items suitable for calling a function in this manner.\n\ntakewhile(predicate [, iterable])\n\nCreates an iterator that produces items from iterableas long as predicate(item) is True. Iteration stops immediately once predicateevaluates as False.\n\nF h Lib f L Bdff",
      "content_length": 2618,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 298,
      "content": "operator\n\n273\n\ntee(iterable [, n])\n\nCreates nindependent iterators from iterable.The created iterators are returned as an n-tuple.The default value of nis 2.This function works with any iterable object. However, in order to clone the original iterator, the items produced are cached and used in all the newly created iterators. Great care should be taken not to use the origi- nal iterator iterableafter tee() has been called. Otherwise, the caching mechanism may not work correctly.\n\nExamples The following examples illustrate how some of the functions in the itertools module operate:\n\nfrom itertools import * # Iterate over the numbers 0,1,...,10,9,8,...,1 in an endless cycle for i in cycle(chain(range(10),range(10,0,-1))):\n\nprint i\n\n# Create a list of unique items in a a = [1,4,5,4,9,1,2,3,4,5,1] a.sort() b = [k for k,g in groupby(a)] # b = [1,2,3,4,5,9]\n\n# Iterate over all possible combinations of pairs of values from x and y x = [1,2,3,4,5] y = [10,11,12] for r in product(x,y):\n\nprint(r)\n\n# Produces output (1,10),(1,11),(1,12), ... (5,10),(5,11),(5,12)\n\noperator The operator module provides functions that access the built-in operators and special methods of the interpreter described in Chapter 3,“Types and Objects.” For example, add(3, 4) is the same as 3 + 4. For operations that also have an in-place version, you can use a function such as iadd(x,y) which is the same as x += y.The following list shows functions defined in the operator module and how they are mapped onto vari- ous operators:\n\nFunction add(a, b)\n\nsub(a, b)\n\nmul(a, b)\n\ndiv(a, b)\n\nfloordiv(a, b)\n\ntruediv(a, b)\n\nmod(a, b)\n\nneg(a)\n\npos(a)\n\nabs(a)\n\nDescription Returns a + bfor numbers Returns a – b Returns a * bfor numbers Returns a / b(old division) Returns a // b Returns a / b(new division) Returns a % b Returns -a Returns +a Returns the absolute value of a Returns the inverse of a\n\ninv(a), invert(a)\n\ncontinues\n\nF h Lib f L Bdff",
      "content_length": 1922,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 299,
      "content": "274\n\nChapter 15 Data Structures, Algorithms, and Code Simplification\n\nFunction lshift(a, b)\n\nrshift(a, b)\n\nand_(a, b)\n\nor_(a, b)\n\nxor(a, b)\n\nnot_(a)\n\nlt(a, b)\n\nle(a, b)\n\neq(a, b)\n\nne(a, b)\n\ngt(a, b)\n\nge(a, b)\n\ntruth(a)\n\nconcat(a, b)\n\nrepeat(a, b)\n\ncontains(a, b)\n\ncountOf(a, b)\n\nindexOf(a, b)\n\nDescription Returns a << b Returns a >> b Returns a & b(bitwise AND) Returns a | b(bitwise OR) Returns a ^ b(bitwise XOR) Returns not a Returns a < b Returns a <= b Returns a == b Returns a != b Returns a > b Returns a >= b Returns True if ais true, False otherwise Returns a + bfor sequences Returns a * bfor sequence aand integer b Returns the result of bin a Returns the number of occurrences of bin a Returns the index of the first occurrence of bin a Returns a [b] a [b] = c\n\ngetitem(a, b)\n\nsetitem(a, b, c)\n\ndelitem(a, b)\n\ndel a [b] Returns a[b:c]\n\ngetslice(a, b, c) setslice(a, b, c, v) Sets a[b:c] = v delslice(a, b, c)\n\ndel a[b:c] ais b ais not b\n\nis_(a, b)\n\nis_not(a, b)\n\nAt first glance, it might not be obvious why anyone would want to use these functions because the operations they perform can easily be accomplished by simply typing the normal syntax.Where these functions are useful is when working with code uses call- back functions and where you might otherwise be defining an anonymous function with lambda. For example, consider the following timing benchmark that uses the functools.reduce() function:\n\n>>> from timeit import timeit >>> timeit(\"reduce(operator.add,a)\",\"import operator; a = range(100)\") 12.055853843688965 >>> timeit(\"reduce(lambda x,y: x+y,a)\",\"import operator; a = range(100)\") 25.012306928634644 >>>\n\nIn the example, notice how using operator.add as the callback runs more than twice as fast as the version that uses lambda x,y: x+y.\n\nF h Lib f L Bdff",
      "content_length": 1787,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 300,
      "content": "operator\n\n275\n\nThe operator module also defines the following functions that create wrappers\n\naround attribute access, item lookup, and method calls.\n\nattrgetter(name [, name2 [, ... [, nameN]]])\n\nCreates a callable object, f, where a call to f(obj) returns obj.name. If more than one argument is given, a tuple of results is returned. For example, attrgetter('name','shares') returns (obj.name, obj.shares) when called. namecan also include additional dot lookups. For example, if nameis \"address.hostname\", then f(obj) returns obj.address.hostname.\n\nitemgetter(item [, item2 [, ... [, itemN]]])\n\nCreates a callable object, f, where a call to f(obj) returns obj[item]. If more than one item is given as arguments, a call to f(obj) returns a tuple containing (obj[item], obj[item2], ..., obj[itemN]).\n\nmethodcaller(name [, *args [, **kwargs]])\n\nCreates a callable object, f, where a call to f(obj) returns obj.name(*args, **kwargs).\n\nThese functions are also useful for optimizing the performance of operations involv-\n\ning callback function, especially those involving common data processing operations such as sorting. For example, if you wanted to sort a list of tuples rowson column 2, you could either use sorted(rows, key=lambda r: r[2]) or use sorted(rows, key=itemgetter(2)).The second version runs much faster because it avoids the over- head associated with lambda.\n\nF h Lib f L Bdff",
      "content_length": 1393,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 301,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 302,
      "content": "16\n\nString and Text Handling\n\nThis chapter describes the most commonly used Python modules related to basic\n\nstring and text processing.The focus of this chapter is on the most common string operations such as processing text, regular expression pattern matching, and text format- ting.\n\ncodecs The codecs module is used to handle different character encodings used with Unicode text I/O.The module is used both to define new character encodings and to process character data using a wide range of existing encodings such as UTF-8, UTF-16, etc. It is far more common for programmers to simply use one of the existing encodings, so that is what is discussed here. If you want to create new encodings, consult the online documentation for further details.\n\nLow-Level codecs Interface Each character encoding is assigned a common name such as 'utf-8' or 'big5'.The following function is used to perform a lookup.\n\nlookup(encoding)\n\nLooks up a codec in the codec registry. encodingis a string such as 'utf-8'. If noth- ing is known about the requested encoding, LookupError is raised. Otherwise, an instance cof CodecInfo is returned.\n\nA CodecInfo instance chas the following methods:\n\nc.encode(s [, errors])\n\nA stateless encoding function that encodes the Unicode string sand returns a tuple (bytes, length_consumed). bytesis an 8-bit string or byte-array containing the encoded data. length_consumedis the number of characters in sthat were encoded. errorsis the error handling policy and is set to 'strict' by default.\n\nc.decode(bytes [, errors])\n\nA stateless encoding function that decodes a byte string bytesand returns a tuple (s, length_consumed). sis a Unicode string, and length_consumedis the number of bytes in bytesthat were consumed during decoding. errorsis the error-handling pol- icy and is set to 'strict’ by default.\n\nF h Lib f L Bdff",
      "content_length": 1848,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 303,
      "content": "278\n\nChapter 16 String and Text Handling\n\nc.streamreader(bytestream [, errors])\n\nReturns a StreamReader instance that is used to read encoded data. bytestreamis a file-like object that has been opened in binary mode. errorsis the error-handling pol- icy and is 'strict' by default.An instance rof StreamReader supports the following low-level I/O operations:\n\nMethod r.read([size [, chars [, firstline]]]) Returns at most charscharacters of decoded text. sizeis the maxi- mum number of bytes to read from low-level byte-stream and is used to control internal buffering. firstlineis a flag that, if set, returns the first line even if a decod- ing error occurs later in the file. Returns a single line of decoded text. keependsis a flag that con- trols whether or not the line endings are preserved (true by default). Reads all of the lines into a list. Resets the internal buffers and state.\n\nDescription\n\nr.readline([size [, keepends]])\n\nr.readlines([size [, keepends]])\n\nr.reset()\n\nc.streamwriter(bytestream [, errors])\n\nReturns a StreamWriter instance that is used to write encoded data. bytestreamis a file-like object that has been opened in byte-mode. errorsis the error handling policy and is 'strict' by default.An instance wof StreamWriter supports the following low-level I/O operations:\n\nMethod w.write(s)\n\nw.writelines(lines)\n\nw.reset()\n\nDescription Writes an encoded representation of string s Writes a list of strings in lines to the file Resets the internal buffers and state\n\nc.incrementalencoder([errors])\n\nReturns an IncrementalEncoder instance that can be used to encode strings in multi- ple steps. errorsis 'strict' by default.An instance eof IncrementalEncoder has these methods:\n\nMethod e.encode(s [,final])\n\ne.reset()\n\nDescription Returns an encoded representation of string sas a byte string. finalis a flag that should be set to True on the final call to encode(). Resets the internal buffers and state.\n\nF h Lib f L Bdff",
      "content_length": 1947,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 304,
      "content": "codecs\n\n279\n\nc.incrementaldecoder([errors])\n\nReturns an IncrementalDecoder instance that can be used to decode byte strings in multiple steps. errorsis 'strict' by default.An instance dof IncrementalDecoder has these methods:\n\nMethod d.decode(bytes [,final])\n\nd.reset()\n\nDescription Returns a decoded string from the encoded bytes in bytes. finalis a flag that should be set to True on the final call to decode(). Resets the internal buffers and state.\n\nI/O-Related Functions The codecs module provides a collection of high-level functions that are used to sim- plify I/O involving encoded text. Most programmers will use one of these functions instead of the low-level codecs interface described in the first section.\n\nopen(filename, mode[, encoding[, errors[, buffering]]])\n\nOpens filenamein the given modeand provides transparent data encoding/decoding according to the encoding specified in encoding. errorsis one of 'strict', 'ignore', 'replace', 'backslashreplace', or 'xmlcharrefreplace'.The default is 'strict'. bufferinghas the same meaning as for the built-in open() function. Regardless of the mode specified in mode, the underlying file is always opened in binary mode. In Python 3, you can use the built-in open() function instead of codecs.open().\n\nEncodedFile(file, inputenc[, outputenc [, errors]])\n\nA class that provides an encoding wrapper around an existing file object, file. Data written to the file is first interpreted according to the input encoding inputencand then written to the file using the output encoding outputenc. Data read from the file is decoded according to inputenc. If outputencis omitted, it defaults to inputenc. errorshas the same meaning as for open() and defaults to 'strict'.\n\niterencode(iterable, encoding [, errors])\n\nA generator function that incrementally encodes all of the strings in iterableto the specified encoding. errorsis 'strict' by default.\n\niterdecode(iterable, encoding [, errors])\n\nA generator function that incrementally decodes all of the byte strings in iterable according to the specified encoding. errorsis 'strict' by default.\n\nUseful Constants codecs defines the following byte-order marker constants that can be used to help interpret files when you don’t know anything about the underlying encoding.These\n\nF h Lib f L Bdff",
      "content_length": 2294,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 305,
      "content": "280\n\nChapter 16 String and Text Handling\n\nbyte-order markers are sometimes written at the beginning of a file to indicate its char- acter encoding and can be used to pick an appropriate codec to use.\n\nConstant BOM\n\nBOM_BE\n\nBOM_LE\n\nBOM_UTF8\n\nBOM_UTF16_BE\n\nBOM_UTF16_LE\n\nBOM_UTF32_BE\n\nDescription Native byte-order marker for the machine (BOM_BE or BOM_LE) Big-endian byte-order marker ('\\xfe\\xff') Little-endian byte-order marker ('\\xff\\xfe') UTF-8 marker ('\\xef\\xbb\\xbf') 16-bit UTF-16 big-endian marker ('\\xfe\\xff') 16-bit UTF-16 little-endian marker ('\\xff\\xfe') 32-bit UTF-32 big-endian marker ('\\x00\\x00\\xfe\\xff') 32-bit UTF-32 little-endian marker ('\\xff\\xfe\\x00\\x00')\n\nBOM_UTF32_LE\n\nStandard Encodings The following is a list of some of the most commonly used character encodings.The encoding name is what you would pass to functions such as open() or lookup() when specifying an encoding.A full list of encodings can be found by consulting the online documentation for the codecs module (http://docs.python.org/library/codecs).\n\nCodec Name ascii cp437 cp1252 latin-1, iso-8859-1 utf-16 utf-16-be utf-16-le utf-32 utf-32-be utf-32-le utf-8\n\nDescription 7-bit ASCII characters Extended ASCII character set from MS-DOS Extended ASCII character set from Windows ASCII extended with Latin characters UTF-16 UTF-16 big-endian UTF-16 little-endian UTF-32 UTF-32 big-endian UTF-32 little-endian UTF-8\n\nNotes\n\nn Further use of the codecs module is described in Chapter 9,“Input and\n\nOutput.”\n\nn Consult the online documentation for information on how to create new kinds\n\nof character encodings.\n\nn Great care needs to be taken with the inputs to encode() and decode() opera-\n\ntions.All encode() operations should be given Unicode strings, and all decode() operations should be given byte strings. Python 2 is not entirely con- sistent in this regard, whereas Python 3 strictly enforces the distinction between strings. For example, Python 2 has some codecs that map byte-strings to byte- strings (e.g., the “bz2” codec).These are unavailable in Python 3 and should not be used if you care about compatibility.\n\nF h Lib f L Bdff",
      "content_length": 2126,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 306,
      "content": "re\n\n281\n\nre The re module is used to perform regular-expression pattern matching and replacement in strings. Both unicode and byte-strings are supported. Regular-expression patterns are specified as strings containing a mix of text and special-character sequences. Because patterns often make extensive use of special characters and the backslash, they’re usually written as “raw” strings, such as r'(?P<int>\\d+)\\.(\\d*)'. For the remainder of this section, all regular-expression patterns are denoted using the raw string syntax.\n\nPattern Syntax The following special-character sequences are recognized in regular expression patterns:\n\nCharacter(s) text\n\n.\n\n^\n\n$\n\n\n\n+\n\n?\n\n?\n\n+?\n\n??\n\n{m}\n\n{m, n}\n\n{m, n}?\n\n[...]\n\n[^...]\n\nA|B\n\n(...)\n\nDescription Matches the literal string text. Matches any character except newline. Matches the start of a string. Matches the end of a string. Matches zero or more repetitions of the preceding expres- sion, matching as many repetitions as possible. Matches one or more repetitions of the preceding expres- sion, matching as many repetitions as possible. Matches zero repetitions or one repetition of the preceding expression. Matches zero or more repetitions of the preceding expres- sion, matching as few repetitions as possible. Matches one or more repetitions of the preceding expres- sion, matching as few repetitions as possible. Matches zero or one repetitions of the preceding expres- sion, matching as few repetitions as possible. Matches exactly mrepetitions of the preceding expression. Matches from mto nrepetitions of the preceding expres- sion, matching as many repetitions as possible. If mis omit- ted, it defaults to 0. If nis omitted, it defaults to infinity. Matches from mto nrepetitions of the preceding expres- sion, matching as few repetitions as possible. Matches a set of characters such as r'[abcdef]' or r'[a-zA-z]'. Special characters such as * are not active inside a set. Matches the characters not in the set, such as r'[^0-9]'. Matches either Aor B, where Aand Bare both regular expressions. Matches the regular expression inside the parentheses as a group and saves the matched substring. The contents of a group can be obtained using the group() method of MatchObject objects obtained while matching.\n\ncontinues\n\nF h Lib f L Bdff",
      "content_length": 2294,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 307,
      "content": "282\n\nChapter 16 String and Text Handling\n\nCharacter(s) (?aiLmsux)\n\n(?:...)\n\n(?P<name>...)\n\n(?P=name)\n\n(?#...)\n\n(?=...)\n\n(?!...)\n\n(?<=...)\n\n(?<!...)\n\nDescription Interprets the letters \"a\", \"i\", \"L\", \"m\", \"s\", \"u\", and \"x\" as flag settings corresponding to the re.A, re.I, re.L, re.M, re.S, re.U, re.X flag settings given to re.compile(). \"a\" only available in Python 3. Matches the regular expression inside the parentheses but discards the matched substring. Matches the regular expression in the parentheses and creates a named group. The group name must be a valid Python identifier. Matches the same text that was matched by an earlier named group. A comment. The contents of the parentheses are ignored. Matches the preceding expression only if followed by the pattern in the parentheses. For example, r'Hello (?=World)' matches 'Hello ' only if followed by 'World'. Matches the preceding expression only if it’s not followed by the pattern in parentheses. For example, r'Hello (?!World)' matches 'Hello ' only if it’s not followed by 'World'. Matches the following expression if it’s preceded by a match of the pattern in parentheses. For example, r'(?<=abc)def' matches 'def' only if it’s preceded by 'abc'. Matches the following expression only if it’s not preceded by a match of the pattern in parentheses. For example, r'(?<!abc)def' matches 'def' only if it’s not preceded by 'abc'.\n\n(?(id|name)ypat|npat) Checks to see whether the regular expression group identi-\n\nfied by idor nameexists. If so, the regular expression ypatis matched. If not, the optional expression npatis matched. For example, the pattern r'(Hello)?(?(1) World|Howdy)' matches the string 'Hello World' or the string 'Howdy'.\n\nStandard character escape sequences such as '\\n' and '\\t' are recognized as standard characters in a regular expression (for example, r'\\n+' would match one or more new- line characters). In addition, literal symbols that normally have special meaning in a reg- ular expression can be specified by preceding them with a backslash. For example, r'\\*' matches the character *. In addition, a number of backslash sequences corre- spond to special sets of characters:\n\nCharacter(s) Description \\number\n\nMatches the text that was matched by a previous group number. Groups are numbered from 1 to 99, starting from the left. Matches only at the start of the string. Matches the empty string at the beginning or end of a word. A word is a sequence of alphanumeric characters terminated by whitespace or any other nonalphanumeric character.\n\n\\A\n\n\\b\n\nF h Lib f L Bdff",
      "content_length": 2566,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 308,
      "content": "re\n\n283\n\nCharacter(s) Description \\B\n\nMatches the empty string not at the beginning or end of a word. Matches any decimal digit. Same as r'[0-9]'. Matches any nondigit character. Same as r'[^0-9]'. Matches any whitespace character. Same as r'[\\t\\n\\r\\f\\v]'. Matches any nonwhitespace character. Same as r'[^ \\t\\n\\r\\f\\v]'. Matches any alphanumeric character. Matches any character not contained in the set defined by \\w. Matches only at the end of the string. Matches a literal backslash.\n\n\\d\n\n\\D\n\n\\s\n\n\\S\n\n\\w\n\n\\W\n\n\\Z\n\n\\\\\n\nThe \\d, \\D, \\s, \\S, \\w, and \\W special characters are interpreted differently if matching Unicode strings. In this case, they match all Unicode characters that match the described property. For example, \\d matches any Unicode character that is classified as a digit such as European,Arabic, and Indic digits which each occupy a different range of Unicode characters.\n\nFunctions The following functions are used to perform pattern matching and replacement:\n\ncompile(str [, flags])\n\nCompiles a regular-expression pattern string into a regular-expression object.This object can be passed as the pattern argument to all the functions that follow.The object also provides a number of methods that are described shortly. flagsis the bitwise OR of the following:\n\nFlag A or ASCII I or IGNORECASE L or LOCALE M or MULTILINE\n\nS or DOTALL\n\nU or UNICODE\n\nX or VERBOSE\n\nDescription Perform 8-bit ASCII-only matching (Python 3 only). Performs non–case-sensitive matching. Uses locale settings for \\w, \\W, \\b, and \\B. Makes ^ and $ apply to each line in addition to the beginning and end of the entire string. (Normally ^ and $ apply only to the begin- ning and end of an entire string.) Makes the dot (.) character match all characters, including the newline. Uses information from the Unicode character properties database for \\w, \\W, \\b, and \\B. (Python 2 only. Python 3 uses Unicode by default.) Ignores unescaped whitespace and comments in the pattern string.\n\nescape(string)\n\nReturns a string with all nonalphanumerics backslashed.\n\nfindall(pattern, string [,flags])\n\nReturns a list of all nonoverlapping matches of patternin string, including empty matches. If the pattern has groups, a list of the text matched by the groups is returned.\n\nF h Lib f L Bdff",
      "content_length": 2269,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 309,
      "content": "284\n\nChapter 16 String and Text Handling\n\nIf more than one group is used, each item in the list is a tuple containing the text for each group. flagshas the same meaning as for compile().\n\nfinditer(pattern, string, [, flags])\n\nThe same as findall(), but returns an iterator object instead.The iterator returns items of type MatchObject.\n\nmatch(pattern, string [, flags])\n\nChecks whether zero or more characters at the beginning of stringmatch pattern. Returns a MatchObject on success or None otherwise. flagshas the same meaning as for compile().\n\nsearch(pattern, string [, flags])\n\nSearches stringfor the first match of pattern. flagshas the same meaning as for compile(). Returns a MatchObject on success or None if no match was found.\n\nsplit(pattern, string [, maxsplit = 0])\n\nSplits stringby the occurrences of pattern. Returns a list of strings including the text matched by any groups in the pattern. maxsplitis the maximum number of splits to perform. By default, all possible splits are performed.\n\nsub(pattern, repl, string [, count = 0])\n\nReplaces the leftmost nonoverlapping occurrences of patternin stringby using the replacement repl. replcan be a string or a function. If it’s a function, it’s called with a MatchObject and should return the replacement string. If replis a string, back- references such as '\\6' are used to refer to groups in the pattern.The sequence '\\g<name>' is used to refer to a named group. countis the maximum number of sub- stitutions to perform. By default, all occurrences are replaced.Although these functions don’t accept a flagsparameter like compile(), the same effect can be achieved by using the (?iLmsux) notation described earlier in this section.\n\nsubn(pattern, repl, string [, count = 0])\n\nSame as sub(), but returns a tuple containing the new string and the number of substi- tutions.\n\nRegular Expression Objects A compiled regular-expression object, r, created by the compile() function has the fol- lowing methods and attributes:\n\nr.flags\n\nThe flags argument used when the regular expression object was compiled, or 0 if no flags were specified.\n\nr.groupindex\n\nA dictionary mapping symbolic group names defined by r'(?P<id>)' to group numbers.\n\nr.pattern\n\nThe pattern string from which the regular expression object was compiled.\n\nF h Lib f L Bdff",
      "content_length": 2301,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 310,
      "content": "re\n\n285\n\nr.findall(string [, pos [, endpos]])\n\nIdentical to the findall() function. posand endposspecify the starting and ending positions for the search.\n\nr.finditer(string [, pos [, endpos]])\n\nIdentical to the finditer() function. posand endposspecify the starting and ending positions for the search.\n\nr.match(string [, pos] [, endpos])\n\nChecks whether zero or more characters at the beginning of stringmatch. posand endposspecify the range of stringto be searched. Returns a MatchObject for a match and returns None otherwise.\n\nr.search(string [, pos] [, endpos])\n\nSearches stringfor a match. posand endposspecify the starting and ending positions for the search. Returns a MatchObject for a match and returns None otherwise.\n\nr.split(string [, maxsplit = 0])\n\nIdentical to the split() function.\n\nr.sub(repl, string [, count = 0])\n\nIdentical to the sub() function.\n\nr.subn(repl, string [, count = 0])\n\nIdentical to the subn() function.\n\nMatch Objects The MatchObject instances returned by search() and match() contain information about the contents of groups as well as positional data about where matches occurred.A MatchObject instance, m, has the following methods and attributes:\n\nm.expand(template)\n\nReturns a string that would be obtained by doing regular-expression backslash substitu- tion on the string template. Numeric back-references such as \"\\1\" and \"\\2\" and named references such as \"\\g<n>\" and \"\\g<name>\" are replaced by the contents of the corresponding group. Note that these sequences should be specified using raw strings or with a literal backslash character such as r'\\1' or '\\\\1'.\n\nm.group([group1, group2, ...])\n\nReturns one or more subgroups of the match.The arguments specify group numbers or group names. If no group name is given, the entire match is returned. If only one group is given, a string containing the text matched by the group is returned. Otherwise, a tuple containing the text matched by each of the requested groups is returned.An IndexError is raised if an invalid group number or name is given.\n\nm.groups([default])\n\nReturns a tuple containing the text matched by all groups in a pattern. defaultis the value returned for groups that didn’t participate in the match (the default is None).\n\nF h Lib f L Bdff",
      "content_length": 2254,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 311,
      "content": "286\n\nChapter 16 String and Text Handling\n\nm.groupdict([default])\n\nReturns a dictionary containing all the named subgroups of the match. defaultis the value returned for groups that didn’t participate in the match (the default is None).\n\nm.start([group]) m.end([group])\n\nThese two methods return the indices of the start and end of the substring matched by a group. If groupis omitted, the entire matched substring is used. Returns None if the group exists but didn’t participate in the match.\n\nm.span([group])\n\nReturns a 2-tuple (m.start(group), m.end(group)). If groupdidn’t contribute to the match, this returns (None, None). If groupis omitted, the entire matched sub- string is used.\n\nm.pos\n\nThe value of pospassed to the search() or match() function.\n\nm.endpos\n\nThe value of endpospassed to the search() or match() function.\n\nm.lastindex\n\nThe numerical index of the last group that was matched. It’s None if no groups were matched.\n\nm.lastgroup\n\nThe name of the last named group that was matched. It’s None if no named groups were matched or present in the pattern.\n\nm.re\n\nThe regular-expression object whose match() or search() method produced this MatchObject instance.\n\nm.string\n\nThe string passed to match() or search().\n\nExample The following example shows how to use the re module to search for, extract data from, and replace a text pattern in a string.\n\nimport re text = \"Guido will be out of the office from 12/15/2012 - 1/3/2013.\"\n\n# A regex pattern for a date. datepat = re.compile('(\\d+)/(\\d+)/(\\d+)')\n\n# Find and print all dates for m in datepat.finditer(text):\n\nprint(m.group())\n\nF h Lib f L Bdff",
      "content_length": 1615,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 312,
      "content": "string\n\n287\n\n# Find all dates, but print in a different format monthnames = [None,'Jan','Feb','Mar','Apr','May','Jun',\n\n'Jul','Aug','Sep','Oct','Nov','Dec']\n\nfor m in datepat.finditer(text):\n\nprint (\"%s %s, %s\" % (monthnames[int(m.group(1)], m.group(2), m.group(3)))\n\n# Replace all dates with fields in the European format (day/month/year) def fix_date(m):\n\nreturn \"%s/%s/%s\" % (m.group(2),m.group(1),m.group(3))\n\nnewtext = datepat.sub(fix_date, text)\n\n# An alternative replacement newtext = datepat.sub(r'\\2/\\1/\\3', text)\n\nNotes\n\nn Detailed information about the theory and implementation of regular expressions can be found in textbooks on compiler construction.The book Mastering Regular Expressions by Jeffrey Friedl (O’Reilly & Associates, 1997) may also be useful. n The most difficult part of using the re module is writing the regular expression\n\npatterns. For writing patterns, consider using a tool such as Kodos (http://kodos.sourceforget.net).\n\nstring The string module contains a number of useful constants and functions for manipulat- ing strings. It also contains classes for implementing new string formatters.\n\nConstants The following constants define various sets of characters that may be useful in various string processing operations.\n\nConstant ascii_letters\n\nascii_lowercase\n\nascii_uppercase\n\ndigits\n\nhexdigits\n\nletters\n\nlowercase\n\noctdigits\n\npunctuation\n\nprintable\n\nuppercase\n\nDescription A string containing all lowercase and uppercase ASCII letters. The string 'abcdefghijklmnopqrstuvwxyz'. The string 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'. The string '0123456789'. The string '0123456789abcdefABCDEF'. Concatenation of lowercase and uppercase. String containing all lowercase letters specific to the current locale setting. The string '01234567'. String of ASCII punctuation characters. String of printable characters—a combination of letters, digits, punctuation, and whitespace. String containing all uppercase letters specific to the current locale setting. String containing all whitespace characters. This usually includes space, tab, linefeed, return, formfeed, and vertical tab.\n\nwhitespace\n\nF h Lib f L Bdff",
      "content_length": 2132,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 313,
      "content": "288\n\nChapter 16 String and Text Handling\n\nNote that some of these constants (for example, letters and uppercase) will vary depending on the locale settings of the system.\n\nFormatter Objects The str.format() method of strings is used to perform advanced string formatting operations.As seen in Chapter 3,“Types and Objects,” and Chapter 4,“Operators and Expressions,” this method can access items of sequences or mappings, attributes of objects, and other kinds of related operations.The string module defines a class Formatter that can be used to implement your own customized formatting operation. This class exposes the pieces that implement the string formatting operation and allow you to customize them.\n\nFormatter()\n\nCreates a new Formatter instance.An instance fof Formatter supports the following operations.\n\nf.format(format_string, *args, **kwargs)\n\nFormats the string format_string. By default, the output is the same as calling format_string.format(*args, **kwargs). For example, f.format(\"{name} is {0:d} years old\", 39,name=\"Dave\") creates the string \"Dave is 39 years old\".\n\nf.vformat(format_string, args, kwargs)\n\nA method that actually carries out the work of f.format(). argsis a tuple of posi- tional arguments, and kwargsis a dictionary of keyword arguments.This is a faster method to use if you have already captured argument information in a tuple and dic- tionary.\n\nf.parse(format_string)\n\nA function that creates an iterator for parsing the contents of the format string format_string.The iterator sweeps over the format string and produces tuples of the format (literal_text, field_name, format_spec, conversion). literal_textis any literal text that precedes the next format specifier enclosed in braces { ... }. It may be an empty string if there is no leading text. field_nameis a string that specifies the field name in the format specifier. For example, if the specifier is '{0:d}', then the field name is '0'. format_specis the format specifier that appears after the colon—for example, 'd' in the previous example. It will be an empty string if it wasn’t specified. conversionis a string containing the conversion specifier (if any). In the previous example, it is None, but if the specifier was '{0!s:d}', it would be set to 's'. field_name, format_spec, and conversionwill all be None for the last frag- ment of the format string.\n\nf.get_field(fieldname, args, kwargs)\n\nExtracts the value associated with a given fieldnamefrom argsand kwargs. fieldnameis a string such as \"0\" or \"name\" as returned by the parse() method shown previously. Returns a tuple (value, key) where valueis the field value and keyis used to locate the value in argsor kwargs. If keyis an integer, it is an index in args. If it is a string, it is the key used in kwargs.The fieldname may include additional indexing and attribute lookup such as '0.name’ or '0[name]'. In this case, the method\n\nF h Lib f L Bdff",
      "content_length": 2917,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 314,
      "content": "string\n\n289\n\ncarries out the extra lookup and returns the appropriate value. However, the value of keyin the returned tuple is just set to '0'.\n\nf.get_value(key, args, kwargs)\n\nExtracts the object from argsor kwargscorresponding to key. If keyis an integer, the object is taken from args. If it is a string, it is taken from kwargs.\n\nf.check_unused_args(used_args, args, kwargs)\n\nChecks for unused arguments in the format() operation. used_argsis a set of all of the used argument keys (see get_field()) that were found in the format string. args and kwargsare the positional and keyword arguments passed to format().The default behavior is to raise a TypeError for unused arguments.\n\nf.format_value(value, format_spec)\n\nFormats a single value according to the given format specification. By default, this sim- ply executes the built-in function format(value, format_spec).\n\nf.convert_field(value, conversion)\n\nConverts a valuereturned by get_field() according to the specified conversion code. If conversionis None, valueis returned unmodified. If conversion is 's' or 'r', valueis converted to a string using str() or repr(), respectively.\n\nIf you want to create your own customized string formatting, you can create a Formatter object and simply use the default methods to carry out the formatting as you wish. It is also possible to define a new class that inherits from Formatter and reimplements any of the methods shown earlier.\n\nFor details on the syntax of format specifiers and advanced string formatting, refer to\n\nChapter 3 and Chapter 4.\n\nTemplate Strings The string module defines a new string type, Template, that simplifies certain string substitutions.An example can be found in Chapter 9.\n\nThe following creates a new template string object:\n\nTemplate(s)\n\nHere, sis a string and Template is defined as a class.\n\nA Template object, t, supports the following methods:\n\nt.substitute(m [, **kwargs])\n\nThis method takes a mapping object, m(for example, a dictionary), or a list of keyword arguments and performs a keyword substitution on the string t.This substitution replaces the string '$$' with a single '$' and the strings '$key' or '${key}' with m['key’] or kwargs['key'] if keyword arguments were supplied. keymust spell a valid Python identifier. If the final string contains any unresolved '$key' patterns, a KeyError exception is raised.\n\nt.safe_substitute(m [, **kwargs])\n\nThe same as substitute() except that no exceptions or errors will be generated. Instead, unresolved $keyreferences will be left in the string unmodified.\n\nF h Lib f L Bdff",
      "content_length": 2568,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 315,
      "content": "290\n\nChapter 16 String and Text Handling\n\nt.template\n\nContains the original strings passed to Template().\n\nThe behavior of the Template class can be modified by subclassing it and redefining\n\nthe attributes delimiter and idpattern. For example, this code changes the escape character $ to @ and restricts key names to letters only:\n\nclass MyTemplate(string.Template):\n\ndelimiter = '@' # Literal character for escape sequence idpattern = '[A-Z]*' # Identifier regular expression pattern\n\nUtility Functions The string module also defines a couple of functions for manipulating strings that aren’t defined as a method on string objects.\n\ncapwords(s)\n\nCapitalizes the first letter of each word in s, replaces repeated whitespace characters with a single space, and removes leading and trailing whitespace.\n\nmaketrans(from, to)\n\nCreates a translation table that maps each character in fromto the character in the same position in to. fromand tomust be the same length.This function is used to create arguments suitable for use with the translate() method of strings.\n\nstruct The struct module is used to convert data between Python and binary data structures (represented as Python byte strings).These data structures are often used when interact- ing with functions written in C, binary file formats, network protocols, or binary com- munication over serial ports.\n\nPacking and Unpacking Functions The following module-level functions are used to pack and unpack data in byte strings. If your program is repeatedly performing these operations, consider the use of a Struct object described in the next section.\n\npack(fmt, v1, v2, ...)\n\nPacks the values v1, v2, and so on into a byte string according to the format string in fmt.\n\npack_into(fmt, buffer, offset, v1, v2 ...)\n\nPacks the values v1, v2, and so forth into a writable buffer object bufferstarting at byte offset offset.This only works with objects that support the buffer interface. Examples include array.array and bytearray objects.\n\nunpack(fmt, string)\n\nUnpacks the contents of a byte stringaccording to the format string in fmt. Returns a tuple of the unpacked values.The length of stringmust exactly match the size of the format as determined by the calcsize() function.\n\nF h Lib f L Bdff",
      "content_length": 2249,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 316,
      "content": "struct\n\n291\n\nunpack_from(fmt, buffer, offset)\n\nUnpacks the contents of a bufferobject according to the format string in fmtstarting at offset offset. Returns a tuple of the unpacked values.\n\ncalcsize(fmt)\n\nCalculates the size in bytes of the structure corresponding to a format string fmt.\n\nStruct Objects The struct module defines a class Struct that provides an alternative interface for packing and unpacking. Using this class is more efficient because the format string is only interpreted once.\n\nStruct(fmt)\n\nCreates a Struct instance representing data packed according to the given format code. An instance sof Struct has the following methods that work exactly the same as their functional counterparts described in the previous section:\n\nMethod s.pack(v1, v2, ...) s.pack_into(buffer, offset, v1, v2, ...) Packs values into a buffer object s.unpack(bytes)\n\nDescription Packs values into a byte string\n\nUnpacks values from a byte string Unpacks values from a buffer object The format code being used The size in bytes of the format\n\ns.unpack_from(buffer, offset)\n\ns.format\n\ns.size\n\nFormat Codes The format strings used in the struct module are a sequence of characters with the following interpretations:\n\nFormat 'x'\n\n'c'\n\n'b'\n\n'B'\n\n'?'\n\n'h'\n\n'H'\n\n'i'\n\n'I'\n\n'l'\n\n'L'\n\n'q'\n\nC Type pad byte\n\nchar\n\nsigned char\n\nunsigned char _Bool (C99) short\n\nunsigned short\n\nint\n\nunsigned int\n\nlong\n\nunsigned long\n\nlong long\n\nPython Type No value String of length 1 Integer Integer Boolean Integer Integer Integer Integer Integer Integer Long Long\n\n'Q'\n\nunsigned long long\n\ncontinues\n\nF h Lib f L Bdff",
      "content_length": 1591,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 317,
      "content": "292\n\nChapter 16 String and Text Handling\n\nFormat 'f'\n\n'd'\n\n's'\n\n'p'\n\n'P'\n\nC Type float\n\ndouble\n\nchar[]\n\nchar[]\n\nvoid *\n\nPython Type Float Float String String with length encoded in the first byte Integer\n\nEach format character can be preceded by an integer to indicate a repeat count (for example, '4i' is the same as 'iiii'). For the 's' format, the count represents the maximum length of the string, so '10s' represents a 10-byte string.A format of '0s' indicates a string of zero length.The 'p' format is used to encode a string in which the length appears in the first byte, followed by the string data.This is useful when dealing with Pascal code, as is sometimes necessary on the Macintosh. Note that the length of the string in this case is limited to 255 characters.\n\nWhen the 'I' and 'L' formats are used to unpack a value, the return value is a Python long integer. In addition, the 'P' format may return an integer or long integer, depending on the word size of the machine.\n\nThe first character of each format string can also specify a byte ordering and align-\n\nment of the packed data, as shown here:\n\nFormat '@'\n\n'='\n\n'<'\n\n'>'\n\n'!'\n\nByte Order Native Native Little-endian Big-endian Network (big-endian)\n\nSize and Alignment Native Standard Standard Standard Standard\n\nNative byte ordering may be little-endian or big-endian, depending on the machine architecture.The native sizes and alignment correspond to the values used by the C compiler and are implementation-specific.The standard alignment assumes that no alignment is needed for any type.The standard size assumes that short is 2 bytes, int is 4 bytes, long is 4 bytes, float is 32 bits, and double is 64 bits.The 'P' format can only use native byte ordering.\n\nNotes\n\nn Sometimes it’s necessary to align the end of a structure to the alignment require- ments of a particular type.To do this, end the structure-format string with the code for that type with a repeat count of zero. For example, the format 'llh0l' specifies a structure that ends on a 4-byte boundary (assuming that longs are aligned on 4-byte boundaries). In this case, two pad bytes would be inserted after the short value specified by the 'h' code.This only works when native size and alignment are being used—standard size and alignment don’t enforce alignment rules.\n\nn The 'q’ and 'Q' formats are only available in “native” mode if the C compiler\n\nused to build Python supports the long long data type.\n\nF h Lib f L Bdff",
      "content_length": 2463,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 318,
      "content": "unicodedata\n\n293\n\nSee Also:\n\narray (p. 259), ctypes (p. 612)\n\nunicodedata The unicodedata module provides access to the Unicode character database, which contains character properties for all Unicode characters.\n\nbidirectional(unichr)\n\nReturns the bidirectional category assigned to unichras a string or an empty string if no such value is defined. Returns one of the following:\n\nValue L\n\nLRE\n\nLRO\n\nR\n\nAL\n\nRLE\n\nRLO\n\nPDF\n\nEN\n\nES\n\nET\n\nAN\n\nCS\n\nNSM\n\nBN\n\nB\n\nS\n\nDescription Left-to-Right Left-to-Right embedding Left-to-Right override Right-to-Left Right-to-Left Arabic Right-to-Left embedding Right-to-Left override Pop directional format European number European number separator European number terminator Arabic number Common number separator Nonspacing mark Boundary neutral Paragraph separator Segment separator Whitespace Other neutrals\n\nWS\n\nON\n\ncategory(unichr)\n\nReturns a string describing the general category of unichr.The returned string is one of the following values:\n\nValue Lu\n\nLl\n\nLt\n\nMn\n\nMc\n\nDescription Letter, uppercase Letter, lowercase Letter, title case Mark, nonspacing Mark, spacing combining Mark, enclosing\n\nMe\n\ncontinues\n\nF h Lib f L Bdff",
      "content_length": 1159,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 319,
      "content": "294\n\nChapter 16 String and Text Handling\n\nValue Nd\n\nNl\n\nNo\n\nZs\n\nZl\n\nZp\n\nCc\n\nCf\n\nCs\n\nCo\n\nCn\n\nLm\n\nLo\n\nPc\n\nPd\n\nPs\n\nPe\n\nPi\n\nPf\n\nPo\n\nSm\n\nSc\n\nDescription Number, decimal digit Number, letter Number, other Separator, space Separator, line Separator, paragraph Other, control Other, format Other, surrogate Other, private use Other, not assigned Letter, modifier Letter, other Punctuation, connector Punctuation, dash Punctuation, open Punctuation, close Punctuation, initial quote Punctuation, final quote Punctuation, other Symbol, math Symbol, currency Symbol, modifier Symbol, other\n\nSk\n\nSo\n\ncombining(unichr)\n\nReturns an integer describing the combining class for unichror 0 if no combining class is defined. One of the following values is returned:\n\nValue 0\n\n1\n\n7\n\n8\n\n9\n\n10-199\n\n200\n\n202\n\n204\n\n208\n\n210\n\n212\n\n214\n\nDescription Spacing, split, enclosing, reordrant, and Tibetan subjoined Overlays and interior Nuktas Hiragana/Katakana voicing marks Viramas Fixed-position classes Below left attached Below attached Below right attached Left attached Right attached Above left attached Above attached Above right attached\n\n216\n\nF h Lib f L Bdff",
      "content_length": 1139,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 320,
      "content": "unicodedata\n\n295\n\nValue 218\n\n220\n\n222\n\n224\n\n226\n\n228\n\n230\n\n232\n\n233\n\n234\n\nDescription Below left Below Below right Left Right Above left Above Above right Double below Double above Below (iota subscript)\n\n240\n\ndecimal(unichr[, default])\n\nReturns the decimal integer value assigned to the character unichr. If unichris not a decimal digit, defaultis returned or ValueError is raised.\n\ndecomposition(unichr)\n\nReturns a string containing the decomposition mapping of unichror the empty string if no such mapping is defined.Typically, characters containing accent marks can be decomposed into multicharacter sequences. For example, decomposition(u\"\\u00fc\") (\"ü\") returns the string \"0075 0308\" corresponding to the letter u and the umlaut (¨) accent mark.The string returned by this function may also include the following strings:\n\nValue <font>\n\n<noBreak>\n\n<initial>\n\n<medial>\n\n<final>\n\n<isolated>\n\n<circle>\n\n<super>\n\n<sub>\n\n<vertical>\n\n<wide>\n\n<narrow>\n\n<small>\n\n<square>\n\n<fraction>\n\nDescription A font variant (for example, a blackletter form) A nonbreaking version of a space or hyphen An initial presentation form (Arabic) A medial presentation form (Arabic) A final presentation form (Arabic) An isolated presentation form (Arabic) An encircled form A superscript form A subscript form A vertical layout presentation form A wide (or zenkaku) compatibility character A narrow (or hankaku) compatibility character A small variant form (CNS compatibility) A CJK squared-font variant A vulgar fraction form Otherwise unspecified compatibility character\n\n<compat>\n\ndigit(unichr[, default])\n\nReturns the integer digit value assigned to the character unichr. If unichris not a digit, defaultis returned or ValueError is raised.This function differs from\n\nF h Lib f L Bdff",
      "content_length": 1767,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 321,
      "content": "296\n\nChapter 16 String and Text Handling\n\ndecimal() in that it works with characters that may represent digits but that are not decimal digits.\n\neast_asian_width(unichr)\n\nReturns the east Asian width assigned to unichr.\n\nlookup(name)\n\nLooks up a character by name. For example, lookup('COPYRIGHT SIGN') returns the corresponding Unicode character. Common names can be found at http://www.unicode.org/charts.\n\nmirrored(unichr)\n\nReturns 1 if unichris a “mirrored” character in bidirectional text and returns 0 other- wise.A mirrored character is one whose appearance might be changed to appear prop- erly if text is rendered in reverse order. For example, the character '(' is mirrored because it might make sense to flip it to ')' in cases where text is printed from right to left.\n\nname(unichr [, default])\n\nReturns the name of a Unicode character, unichr. Raises ValueError if no name is defined or returns defaultif provided. For example, name(u'\\xfc') returns 'LATIN SMALL LETTER U WITH DIAERESIS'.\n\nnormalize(form, unistr)\n\nNormalizes the Unicode string unistraccording to normal form form. formis one of 'NFC', 'NFKC', 'NFD', or 'NFKD'.The normalization of a string partly pertains to the composition and decomposition of certain characters. For example, the Unicode string for the word “resumé” could be represented as u'resum\\u00e9' or as the string u'resume\\u0301'. In the first string, the accented character é is represented as a single character. In the second string, the accented character is represented by the letter e fol- lowed by a combining accent mark (´). 'NFC' normalization converts the string unistr so that all of the characters are fully composed (for example, é is a single character). 'NFD' normalization converts unistrso that characters are decomposed (for example, é is the letter e followed by an accent). 'NFKC' and 'NFKD' perform the same function as 'NFC' and 'NFD' except that they additionally transform certain characters that may be represented by more than one Unicode character value into a single standard value. For example, Roman numerals have their own Unicode character values but are also just represented by the Latin letters I, V, M, and so on. 'NFKC' and 'NFKD' would con- vert the special Roman numeral characters into their Latin equivalents.\n\nnumeric(unichr[, default])\n\nReturns the value assigned to the Unicode character unichras a floating-point num- ber. If no numeric value is defined, defaultis returned or ValueError is raised. For example, the numeric value of U+2155 (the character for the fraction \"1/5\") is 0.2.\n\nunidata_version\n\nA string containing the Unicode database version used (for example, '5.1.0').\n\nNote\n\nFor further details about the Unicode character database, see http://www.unicode.org.\n\nF h Lib f L Bdff",
      "content_length": 2782,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 322,
      "content": "17\n\nPython Database Access\n\nThis chapter describes the programming interfaces that Python uses to interface with\n\nrelational and hash table style databases. Unlike other chapters that describe specific library modules, the material in this chapter partly applies to third-party extensions. For example, if you want Python to interface with a MySQL or Oracle database, you would first have to download a third-party extension module.That module, in turn, would then follow the basic conventions described here.\n\nRelational Database API Specification For accessing relational databases, the Python community has developed a standard known as the Python Database API Specification V2.0, or PEP 249 for short (the formal description can be found at http://www.python.org/dev/peps/pep-249/). Specific database modules (e.g., MySQL, Oracle, and so on) follow this specification, but may add even more features.This section covers the essential elements needed to use it for most applications.\n\nAt a high level, the database API defines a set of functions and objects for connecting to a database server, executing SQL queries, and obtaining results. Two primary objects are used for this: a Connection object that manages the connection to the database and a Cursor object that is used to perform queries.\n\nConnections To connect to a database, every database module provides a module-level function connect(parameters).The exact parameters depend on the database but typically include information such as the data source name, user name, password, host name, and database name.Typically these are provided with keyword arguments dsn, user, pass- word, host, and database, respectively. So, a call to connect() might look like this:\n\nconnect(dsn=\"hostname:DBNAME\",user=\"michael\",password=\"peekaboo\")\n\nIf successful, a Connection object is returned.An instance cof Connection has the following methods:\n\nc.close()\n\nCloses the connection to the server.\n\nF h Lib f L Bdff",
      "content_length": 1962,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 323,
      "content": "298\n\nChapter 17 Python Database Access\n\nc.commit()\n\nCommits all pending transactions to the database. If the database supports transactions, this must be called for any changes to take effect. If the underlying database does not support transactions, this method does nothing.\n\nc.rollback()\n\nRolls back the database to the start of any pending transactions.This method is some- times used in databases that do not support transactions in order to undo any changes made to the database. For example, if an exception occurred in code that was in the middle of updating a database, you might use this to undo changes made before the exception.\n\nc.cursor()\n\nCreates a new Cursor object that uses the connection.A cursor is an object that you will use to execute SQL queries and obtain results.This is described in the next section.\n\nCursors In order to perform any operations on the database, you first create a connection cand then you call c.cursor() method to create a Cursor object.An instance curof a Cursor has a number of standard methods and attributes that are used to execute queries:\n\ncur.callproc(procname [, parameters])\n\nCalls a stored procedure with name procname. parameters, which is a sequence of values that are used as the arguments to the procedure.The result of this function is a sequence with the same number of items as parameters.This sequence is a copy of parameterswhere the values of any output arguments have been replaced with their modified values after execution. If a procedure also produces an output set, it can be read using the fetch*() methods described next.\n\ncur.close()\n\nCloses the cursor, preventing any further operations on it.\n\ncur.execute(query [, parameters])\n\nExecutes a query or command queryon the database. queryis a string containing the command (usually SQL), and parametersis either a sequence or mapping that is used to supply values to variables in the query string (this is described in the next section).\n\ncur.executemany(query [, parametersequence])\n\nRepeatedly executes a query or command. queryis a query string, and parametersquenceis a sequence of parameters. Each item in this sequence is a sequence or mapping object that you would have used with the execute() method shown earlier.\n\ncur.fetchone()\n\nReturns the next row of the result set produced by execute() or executemany(). The result is typically a list or tuple containing values for the different columns of the result. None is returned if there are no more rows available.An exception is raised if there is no pending result or if the previously executed operation didn’t create a result set.\n\nF h Lib f L Bdff",
      "content_length": 2631,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 324,
      "content": "Relational Database API Specification\n\n299\n\ncur.fetchmany([size])\n\nReturns a sequence of result rows (e.g., a list of tuples). sizeis the number of rows to return. If omitted, the value of cur.arraysize is used as a default.The actual number of rows returned may be less than requested.An empty sequence is returned if no more rows are available.\n\ncur.fetchall()\n\nReturns a sequence of all remaining result rows (e.g., a list of tuples).\n\ncur.nextset()\n\nDiscards all remaining rows in the current result set and skips to the next result set (if any). Returns None if there are no more result sets; otherwise, a True value is returned and subsequent fetch*() operations return data from the new set.\n\ncur.setinputsize(sizes)\n\nGives the cursor a hint about the parameters to be passed on subsequent execute*() methods. sizesis a sequence of type objects (described shortly) or integers which give the maximum expected string length for each parameter. Internally, this is used to pre- define memory buffers for creating the queries and commands sent to the database. Using this can speed up subsequent execute*() operations.\n\ncur.setoutputsize(size [, column])\n\nSets the buffer size for a specific column in result sets. columnis an integer index into the result row, and sizeis the number of bytes.A typical use of this method is to set limits on large database columns such as strings, BLOBs, and LONGs prior to making any execute*() calls. If columnis omitted, it sets a limit for all columns in the result. Cursors have a number of attributes that describe the current result set and give\n\ninformation about the cursor itself.\n\ncur.arraysize\n\nAn integer that gives the default value used for the fetchmany() operation.This value may vary between database modules and may be initially set to a value that the module considers to be “optimal.”\n\ncur.description\n\nA sequence of tuples that give information about each column in the current result set. Each tuple has the form (name, type_code, display_size, internal_size, precision, scale, null_ok).The first field is always defined and corresponds to the column name.The type_codecan be used in comparisons involving the type objects described in the “Type Objects” section.The other fields may be set to None if they don’t apply to the column.\n\ncur.rowcount\n\nThe number of rows in the last result produced by one of the execute*() methods. If set to -1, it means that there is either no result set or that the row count can’t be deter- mined.\n\nAlthough not required by the specification, the Cursor object in most database modules also implements the iteration protocol. In this case, a statement such as for row in cur: will iterate over the rows the result set created by the last execute*() method.\n\nF h Lib f L Bdff",
      "content_length": 2770,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 325,
      "content": "300\n\nChapter 17 Python Database Access\n\nHere is a simple example showing how some of these operations are used with the\n\nsqlite3 database module, which is a built-in library:\n\nimport sqlite3 conn = sqlite3.connect(\"dbfile\") cur = conn.cursor()\n\n# Example of a simple query cur.execute(\"select name, shares, price from portfolio where account=12345\")\n\n# Looping over the results while True:\n\nrow = cur.fetchone()\n\nif not row: break # Process the row name, shares, price = row ...\n\n# An alternative approach (using iteration) cur.execute(\"select name, shares, price from portfolio where account=12345\") for name, shares, price in cur:\n\n# Process the row ...\n\nForming Queries A critical part of using the database API involves forming SQL query strings to pass into the execute*() methods of cursor objects. Part of the problem here is that you need to fill in parts of the query string with parameters supplied by the user. For exam- ple, you might be inclined to write code like this:\n\nsymbol = \"AIG\" account = 12345\n\ncur.execute(\"select shares from portfolio where name='%s' and account=%d\" %\n\n(symbol, account))\n\nAlthough this “works,” you should never manually form queries using Python string operations like this. If you do, it opens up your code to a potential SQL injection attack—a vulnerability that someone can use to execute arbitrary statements on the database server. For example, in the previous code, someone might supply a value for symbol that looks like \"EVIL LAUGH'; drop table portfolio;--\" which probably does something other than what you anticipated.\n\nAll database modules provide their own mechanism for value substitution. For exam-\n\nple, instead of forming the entire query as shown, you might do this instead:\n\nsymbol = \"AIG\"\n\naccount = 12345\n\ncur.execute(\"select shares from portfolio where name=? and account=?\",\n\n(symbol, account))\n\nHere, the '?' placeholders are successively replaced with values from the tuple (symbol, account).\n\nSadly, there is no standard convention for placeholders across database module imple-\n\nmentations. However, each module defines a variable paramstyle that indicates the formatting of value substitutions to be used in queries. Possible values of this variable are as follows:\n\nF h Lib f L Bdff",
      "content_length": 2254,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 326,
      "content": "Relational Database API Specification\n\n301\n\nParameter Style Description 'qmark'\n\nQuestion mark style where each ? in the query is replaced by suc- cessive items in a sequence. For example, cur.execute(\"... where name=? and account=?\", (symbol, account)). The parameters are specified as a tuple. Numeric style where :nis filled in with the parameter value at index n. For example, cur.execute(\"... where name=:0 and account=:1\",(symbol, account)). Named style where :nameis filled in with a named value. For this style, the parameters must be given as a mapping. For example, cur.execute(\"... where name=:symbol and account=:account\", {'symbol':symbol, 'account': account}). Printf-style format codes such as %s, %d, etc. For example, cur.execute(\"... where name=%s and account=%d\", (symbol, account)). Python extended format codes such as %(name)s. Similar to the 'named' style. Parameters must be specified as a mapping instead of a tuple.\n\n'numeric'\n\n'named'\n\n'format'\n\n'pyformat'\n\nType Objects When working with database data, built-in types such as integers and strings are usually mapped to an equivalent type in the database. However, for dates, binary data, and other special types, data management is more tricky.To assist with this mapping, database modules implement a set of constructor functions for creating objects of various types.\n\nDate(year, month, day)\n\nCreates an object representing a date.\n\nTime(hour, minute, second)\n\nCreates an object representing a time.\n\nTimestamp(year, month, day, hour, minute, second)\n\nCreates an object representing a timestamp.\n\nDateFromTicks(ticks)\n\nCreates a date object from a value of the system time. ticksis the number of seconds as returned by a function such as time.time().\n\nTimeFromTicks(ticks)\n\nCreates a time object from a value of the system time.\n\nTimestampFromTicks(ticks)\n\nCreates a timestamp object from a value of the system time.\n\nBinary(s)\n\nCreates a binary object from a byte-string s.\n\nF h Lib f L Bdff",
      "content_length": 1972,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 327,
      "content": "302\n\nChapter 17 Python Database Access\n\nIn addition to these constructor functions, the following type objects might be\n\ndefined.The purpose of these codes is to perform type checking against the type_code field of cur.description, which describes the contents of the current result set.\n\nType Object STRING\n\nBINARY\n\nNUMBER\n\nDATETIME\n\nROWID\n\nDescription Character or text data Binary data such as BLOBs Numeric data Date and time data Row ID data\n\nError Handling Database modules define a top-level exception Error that is a base class for all other errors.The following exceptions are for more specific kinds of database errors:\n\nException InterfaceError\n\nDatabaseError\n\nDataError\n\nOperationalError\n\nIntegrityError\n\nInternalError\n\nProgrammingError\n\nNotSupportedError\n\nDescription Errors related to the database interface, but not the database itself. Errors related to the database itself. Errors related to the processed data. For example, bad type conversions, division by zero, etc. Errors related to the operation of the database itself. For example, a lost connection. Error when relational integrity of the database is broken. Internal error in the database. For example, if a stale cursor. Errors in SQL queries. Error for methods in the database API that aren’t supported by the underlying database.\n\nModules may also define a Warning exception that is used by the database module to warn about things such as data truncation during updates.\n\nMultithreading If you are mixing database access with multithreading, the underlying database module may or may not be thread-safe.The following variable is defined in each module to provide more information.\n\nthreadsafety\n\nAn integer that indicates the thread safety of the module. Possible values are:\n\n0\n\n1\n\n2\n\n3\n\nNo thread safety. Threads may not share any part of the module. The module is thread-safe, but connections may not be shared. The module and connections are thread-safe, but cursors may not be shared. The module, connections, and cursors are all thread-safe.\n\nF h Lib f L Bdff",
      "content_length": 2045,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 328,
      "content": "sqlite3 Module\n\n303\n\nMapping Results into Dictionaries A common issue concerning database results is the mapping of tuples or lists into a dic- tionary of named fields. For example, if the result set of a query contains a large number of columns, it may be easier to work with this data using descriptive field names instead of hard-coding the numeric index of specific fields within a tuple.\n\nThere are many ways to handle this, but one of the most elegant ways to process\n\nresult data is through the use of generator functions. For example:\n\ndef generate_dicts(cur): import itertools fieldnames = [d[0].lower() for d in cur.description ] while True:\n\nrows = cur.fetchmany() if not row: return for row in rows:\n\nyield dict(itertools.izip(fieldnames,row))\n\n# Sample use cur.execute(\"select name, shares, price from portfolio\") for r in generate_dicts(cur):\n\nprint r['name'],r['shares'],r['price']\n\nBe aware that the naming of columns is not entirely consistent between databases— especially with respect to things such as case sensitivity. So, you’ll need to be a little careful if you try to apply this technique to code that’s meant to work with a variety of different database modules.\n\nDatabase API Extensions Finally, many extensions and advanced features can be added to specific database modules—for example, support for two-phase commits and extended error handling. PEP-249 has additional information about the recommended interface for these features and should be consulted by advanced users.Third-party library modules also may sim- plify the use of relational database interfaces.\n\nsqlite3 Module The sqlite3 module provides a Python interface to the SQLite database library (http://www.sqlite.org). SQLite is a C library that implements a self-contained relation- al database entirely within a file or in memory.Although it is simple, this library is attractive for various reasons. For one, it does not rely upon a separate database server nor does it require any kind of special configuration—you can start to use it right away in your programs by simply connecting to a database file (and if it doesn’t exist, a new file is created).The database also supports transactions for improved reliability (even across system crashes) as well as locking to allow the same database file to be simultane- ously accessed from multiple processes.\n\nThe programming interface to the library follows the conventions described in the\n\nprevious section on the Database API, so much of that detail is not repeated here. Instead, this section focuses on the technical details of using this module as well as fea- tures that are specific to the sqlite3 module.\n\nF h Lib f L Bdff",
      "content_length": 2675,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 329,
      "content": "304\n\nChapter 17 Python Database Access\n\nModule-Level Functions The following functions are defined by the sqlite3 module:\n\nconnect(database [, timeout [, isolation_level [, detect_types]]])\n\nCreates a connection to a SQLite database. databaseis a string that specifies the name of the database file. It can also be a string \":memory:\", in which case an in-memory database is used (note that this kind of database only persists as long as the Python process remains running and would be lost on program exit).The timeoutparameter specifies the amount of time to wait for an internal reader-writer lock to be released when other connections are updating the database. By default, timeoutis 5 seconds. When SQL statements such as INSERT or UPDATE are used, a new transaction is auto- matically started if one wasn’t already in effect.The isolation_levelparameter is a string that provides an optional modifier to the underlying SQL BEGIN statement that is used to start this transaction. Possible values are \"\" (the default), \"DEFERRED\", \"EXCLUSIVE\", or \"IMMEDIATE\".The meaning of these settings is related to the under- lying database lock and is as follows:\n\nIsolation Level \"\" (empty string) \"DEFERRED\"\n\n\"EXCLUSIVE\"\n\n\"IMMEDIATE\"\n\nDescription Use the default setting (DEFERRED). Starts a new transaction, but does not acquire the lock until the first database operation is actually performed. Starts a new transaction and guarantees that no other connections can read or write the database until changes are committed. Starts a new transaction and guarantees that no other connection can make database modifications until changes are committed. Other connections can still read from the database, however.\n\nThe detect_typesparameter enables some extra type detection (implemented by extra parsing of SQL queries) when returning results. By default it is 0 (meaning no extra detection). It can be set to the bitwise-or of PARSE_DECLTYPES and PARSE_COLNAMES. If PARSE_DECLTYPES is enabled, queries are examined for SQL type- names such as \"integer\" or \"number(8)\" in order to determine the type of result columns. If PARSE_COLNAMES is enabled, special strings of the form \"colname [typename]\" (including the double quotes) can be embedded into queries where colnameis the column name and typenameis the name of a type registered with the register_converter() function described next.These strings are simply transformed into colnamewhen passed to the SQLite engine, but the extra type specifier is used when converting values in the results of a query. For example, a query such as 'select price as \"price [decimal]\" from portfolio' is interpreted as 'select price as price from portfolio', and the results will be converted according to the “dec- imal” conversion rule.\n\nregister_converter(typename, func)\n\nRegisters a new type name for use with the detect_typesoption to connect(). typenameis a string containing the type name as it will be used in queries, and funcis a function that takes a single bytestring as input and returns a Python datatype as a result.\n\nF h Lib f L Bdff",
      "content_length": 3079,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 330,
      "content": "sqlite3 Module\n\n305\n\nFor example, if you call sqlite3.register_converter('decimal', decimal. Decimal), then you can have values in queries converted to Decimal objects by writing queries such as 'select price as \"price [decimal]\" from stocks'.\n\nregister_adapter(type, func)\n\nRegisters an adapter function for a Python type typethat is used when storing values of that type in the datatype. funcis a function that accepts an instance of type typeas input and returns a int, float, UTF-8–encoded byte string, Unicode string, or buffer as a result. For example, if you wanted to store Decimal objects, you might use sqlite3.register_adapter(decimal.Decimal,float).\n\ncomplete_statement(s)\n\nReturns True if the string srepresents one or more complete SQL statements separat- ed by semicolons.This might be useful if writing an interactive program that reads queries from the user.\n\nenable_callback_tracebacks(flag)\n\nDetermines the handling of exceptions in user-defined callback functions such as con- verters and adapters. By default, exceptions are ignored. If flagis set to True, traceback messages will be printed on sys.stderr.\n\nConnection Objects The Connection object creturned by the connect() function supports the standard operations described in the Database API. In addition, the following methods specific to the sqlite3 module are provided.\n\nc.create_function(name, num_params, func)\n\nCreates a user-defined function that can be used in SQL statements. nameis a string containing the name of the function, num_paramsis an integer giving the number of parameters, and funcis a Python function that provides the implementation. Here is a simple example:\n\ndef toupper(s):\n\nreturn s.upper()\n\nc.create_function(\"toupper\",1,toupper) # Sample use in a query c.execute(\"select toupper(name),foo,bar from sometable\")\n\nAlthough a Python function is being defined, the parameters and inputs of this function should only be int, float, str, unicode, buffer, or None.\n\nc.create_aggregate(name, num_params, aggregate_class)\n\nCreates a user-defined aggregation function for use in SQL statements. nameis a string containing the name of the function, and num_paramsis an integer giving the number of input parameters. aggregate_classis a class that implements the aggregation operation. This class must support initialization with no arguments and implements a step(params) method that accepts the same number of parameters as given in num_paramsand a finalize() method that returns the final result. Here is a simple example:\n\nclass Averager(object): def __init__(self): self.total = 0.0 self.count = 0\n\nF h Lib f L Bdff",
      "content_length": 2614,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 331,
      "content": "306\n\nChapter 17 Python Database Access\n\ndef step(self,value):\n\nself.total += value self.count += 1 def finalize(self):\n\nreturn self.total / self.count\n\nc.create_aggregate(\"myavg\",1,Averager) # Sample use in a query\n\nc.execute(\"select myavg(num) from sometable\")\n\nAggregation works by making repeated calls to the step() method with input values and then calling finalize() to obtain the final value.\n\nc.create_collation(name, func)\n\nRegisters a user-defined collation function for use in SQL statements. nameis a string containing the name of the collation function, and funcis a function that accepts two inputs and returns -1, 0, 1 depending on whether or not the first input is below, equal to, or above the second input.You use the user-defined function using a SQL expression such as \"select * from table order by colname collate name\".\n\nc.execute(sql [, params])\n\nA shortcut method that creates a cursor object using c.cursor() and executes the cur- sor’s execute() method with SQL statements in sqlwith the parameters in params.\n\nc.executemany(sql [, params])\n\nA shortcut method that creates a cursor object using c.cursor() and executes the cur- sor’s executemany() method with SQL statements in sqlwith the parameters in params.\n\nc.executescript(sql)\n\nA shortcut method that creates a cursor object using c.cursor() and executes the cur- sor’s executescript() method with SQL statements in sql.\n\nc.interrupt()\n\nAborts any currently executing queries on the connection.This is meant to be called from a separate thread.\n\nc.iterdump()\n\nReturns an iterator that dumps the entire database contents to a series of SQL state- ments that could be executed to recreate the database.This could be useful if exporting the database elsewhere or if you need to dump the contents of an in-memory database to a file for later restoration.\n\nc.set_authorizer(auth_callback)\n\nRegisters an authorization callback function that gets executed on every access to a col- umn of data in the database.The callback function must take five arguments as auth_callback(code, arg1, arg2, dbname, innername).The value returned by this callback is one of SQLITE_OK if access is allowed, SQLITE_DENY if the SQL state- ment should fail with an error, or SQLITE_IGNORE if the column should be ignored by treating it as a Null value.The first argument codeis an integer action code. arg1and\n\nF h Lib f L Bdff",
      "content_length": 2382,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 332,
      "content": "sqlite3 Module\n\n307\n\narg2are parameters whose values depend on the value of code. dbnameis a string con- taining the name of the database (usually \"main\"), and innernameis the name of the innermost view or trigger that is attempting access or None if no view or trigger is active.The following table lists the values for codeand meaning of the arg1and arg2 parameters:\n\nCode SQLITE_CREATE_INDEX\n\nSQLITE_CREATE_TABLE\n\nSQLITE_CREATE_TEMP_INDEX\n\nSQLITE_CREATE_TEMP_TABLE\n\nSQLITE_CREATE_TEMP_TRIGGER\n\nSQLITE_CREATE_TEMP_VIEW\n\nSQLITE_CREATE_TRIGGER\n\nSQLITE_CREATE_VIEW\n\nSQLITE_DELETE\n\nSQLITE_DROP_INDEX\n\nSQLITE_DROP_TABLE\n\nSQLITE_DROP_TEMP_INDEX\n\nSQLITE_DROP_TEMP_TABLE\n\nSQLITE_DROP_TEMP_TRIGGER\n\nSQLITE_DROP_TEMP_VIEW\n\nSQLITE_DROP_TRIGGER\n\nSQLITE_DROP_VIEW\n\nSQLITE_INSERT\n\nSQLITE_PRAGMA\n\nSQLITE_READ\n\nSQLITE_SELECT\n\nArg1 Index name Table name Index name Table name Trigger name View name Trigger name View name Table name Index name Table name Index name Table name Trigger name View name Trigger name View name Table name Pragma name Table name None\n\nArg2 Table name None Table name None Table name None Table name None\n\nNone Table name None Table name None Table name None Table name None\n\nNone\n\nNone Column name None\n\nSQLITE_TRANSACTION\n\nSQLITE_UPDATE\n\nSQLITE_ATTACH\n\nSQLITE_DETACH\n\nSQLITE_ALTER_TABLE\n\nSQLITE_REINDEX\n\nSQLITE_ANALYZE\n\nSQLITE_CREATE_VTABLE\n\nSQLITE_DROP_VTABLE\n\nSQLITE_FUNCTION\n\nNone Table name Filename Database name Database name Index name Table name Table name Table name Function name\n\nNone Column name None\n\nNone Table name None\n\nNone Module name Module name None\n\nc.set_progress_handler(handler, n)\n\nRegisters a callback function that gets executed every ninstructions of the SQLite vir- tual machine. handleris a function that takes no arguments.\n\nF h Lib f L Bdff",
      "content_length": 1786,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 333,
      "content": "308\n\nChapter 17 Python Database Access\n\nThe following attributes are also defined on connection objects.\n\nc.row_factory\n\nA function that gets called to create the object representing the contents of each result row.This function takes two arguments: the cursor object used to obtain the result and a tuple with the raw result row.\n\nc.text_factory\n\nA function that is called to create the objects representing text values in the database. The function must take a single argument that is a UTF-8–encoded byte string.The return value should be some kind of string. By default, a Unicode string is returned.\n\nc.total_changes\n\nAn integer representing the number of rows that have been modified since the database connection was opened.\n\nA final feature of connection objects is that they can be used with the context-\n\nmanager protocol to automatically handle transactions. For example:\n\nconn = sqlite.connect(\"somedb\") with conn:\n\nconn.execute(\"insert into sometable values (?,?)\", (\"foo\",\"bar\")))\n\nIn this example, a commit() operation is automatically performed after all statements in the with block have executed and no errors have occurred. If any kind of exception is raised, a rollback() operation is performed and the exception is reraised.\n\nCursors and Basic Operations To perform basic operations on a sqlite3 database, you first have to create a cursor object using the cursor() method of a connection.You then use the execute(), executemany(), or executescript() methods of the cursor to execute SQL state- ments. See the Database API section for further details about the general operation of these methods. Instead of repeating that information here, a set of common database use cases are presented along with sample code.The goal is to show both the operation of cursor objects and some common SQL operations for those programmers who might need a brief refresher on the syntax.\n\nCreating New Database Tables The following code shows how to open a database and create a new table:\n\nimport sqlite3 conn = sqlite3.connect(\"mydb\") cur = conn.cursor() cur.execute(\"create table stocks (symbol text, shares integer, price real)\") conn.commit()\n\nWhen defining tables, a few primitive SQLite datatypes should be used: text, integer, real, and blob.The blob type is a bytestring, whereas the text type is assumed to be UTF-8–encoded Unicode.\n\nF h Lib f L Bdff",
      "content_length": 2364,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 334,
      "content": "sqlite3 Module\n\n309\n\nInserting New Values into a Table The following code shows how to insert new items into a table:\n\nimport sqlite3 conn = sqlite3.connect(\"mydb\") cur = conn.cursor() cur.execute(\"insert into stocks values (?,?,?)\",('IBM',50,91.10)) cur.execute(\"insert into stocks values (?,?,?)\",('AAPL',100,123.45)) conn.commit()\n\nWhen inserting values, you should always use the ? substitutions as shown. Each ? is replaced by a value from a tuple of values supplied as parameters.\n\nIf you have a sequence of data to insert, you can use the executemany() method of\n\na cursor like this:\n\nstocks = [ ('GOOG',75,380.13),\n\n('AA',60,14.20), ('AIG',125, 0.99) ]\n\ncur.executemany(\"insert into stocks values (?,?,?)\",stocks)\n\nUpdating an Existing Row The following code shows how you might update columns for an existing row:\n\ncur.execute(\"update stocks set shares=? where symbol=?\",(50,'IBM'))\n\nAgain, when you need to insert values into the SQL statement, make sure you use the ? placeholders and supply a tuple of values as parameters.\n\nDeleting Rows The following code shows how to delete rows:\n\ncur.execute(\"delete from stocks where symbol=?\",('SCOX',))\n\nPerforming Basic Queries The following code shows how you can perform basic queries and obtain the results:\n\n# Select all columns from a table for row in cur.execute(\"select * from stocks\"):\n\nstatements\n\n# Select a few columns for shares, price in cur.execute(\"select shares,price from stocks\"):\n\nstatements\n\n# Select matching rows for row in cur.execute(\"select * from stocks where symbol=?\",('IBM',))\n\nstatements\n\n# Select matching rows with ordering for row in cur.execute(\"select * from stocks order by shares\"):\n\nstatements\n\n# Select matching rows with ordering in reverse for row in cur.execute(\"select * from stocks order by shares desc\"):\n\nstatements\n\n# Joining tables on a common column name (symbol) for row in cur.execute(\"\"\"select s.symbol, s.shares, p.price\n\nfrom stocks as s, prices as p using(symbol)\"\"\"):\n\nstatements\n\nF h Lib f L Bdff",
      "content_length": 2007,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 335,
      "content": "310\n\nChapter 17 Python Database Access\n\nDBM-Style Database Modules Python includes a number of library modules for supporting UNIX DBM-style data- base files. Several standard types of these databases are supported.The dbm module is used to read standard UNIX-dbm database files.The gdbm module is used to read GNU dbm database files (http://www.gnu.org/software/gdbm).The dbhash module is used to read database files created by the Berkeley DB library (http://www.oracle.com/ database/berkeley-db/index.html).The dumbdbm module is a pure-Python module that implements a simple DBM-style database on its own.\n\nAll of these modules provide an object that implements a persistent string-based dic-\n\ntionary.That is, it works like a Python dictionary except that all keys and values are restricted to strings.A database file is typically opened using a variation of the open() function.\n\nopen(filename [, flag [, mode]])\n\nThis function opens the database file filenameand returns a database object. flagis 'r' for read-only access, 'w' for read-write access, 'c' to create the database if it doesn’t exist, or 'n' to force the creation of a new database. modeis the integer file- access mode used when creating the database (the default is 0666 on UNIX).\n\nThe object returned by the open() function minimally supports the following\n\ndictionary-like operations:\n\nOperation d[key] = value\n\nvalue = d[key]\n\ndel d[key]\n\nd.close()\n\nkey in d\n\nDescription Inserts valueinto the database Gets data from the database Removes a database entry Closes the database Tests for a key Writes all changes out to the database\n\nd.sync()\n\nSpecific implementations may also add additional features (consult the appropriate mod- ule reference for details).\n\nOne issue with the various DBM-style database modules is that not every module is\n\ninstalled on every platform. For example, if you use Python on Windows, the dbm and gdbm modules are typically unavailable. However, a program may still want to create a DBM-style database for its own use.To address this issue, Python provides a module anydbm that can be used to open and create a DBM-style database file.This module provides an open() function as described previously, but it is guaranteed to work on all platforms. It does this by looking at the set of available DBM modules and picking the most advanced library that is available (typically dbhash if it’s installed).As a fallback, it uses the dumbdbm module which is always available.\n\nAnother module is whichdb, which has a function whichdb(filename) that can be\n\nused to probe a file in order to determine what kind of DBM-database created it.\n\nAs a general rule, it is probably best not to rely upon these low-level modules for any application where portability is important. For example, if you create a DBM data- base on one machine and then transfer the database file to another machine, there is a chance that Python won’t be able to read it if the underlying DBM module isn’t\n\nF h Lib f L Bdff",
      "content_length": 2988,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 336,
      "content": "shelve Module\n\n311\n\ninstalled.A high degree of caution is also in order if you are using these database mod- ules to store large amounts of data, have a situation where multiple Python programs might be opening the same database file concurrently, or need high reliability and trans- actions (the sqlite3 module might be a safer choice for that).\n\nshelve Module The shelve module provides support for persistent objects using a special “shelf” object.This object behaves like a dictionary except that all the objects it contains are stored on disk using a hash-table based database such as dbhash, dbm or gdbm. Unlike those modules, however, the values stored in a shelf are not restricted to strings. Instead, any object that is compatible with the pickle module may be stored.A shelf is created using the shelve.open() function.\n\nopen(filename [,flag='c' [, protocol [, writeback]]])\n\nOpens a shelf file. If the file doesn’t exist, it’s created. filenameshould be the database filename and should not include a suffix. flaghas the same meaning as described in the chapter introduction and is one of 'r', 'w', 'c', or 'n'. If the database file doesn’t exist, it is created. protocolspecifies the protocol used to pickle objects stored in the database. It has the same meaning as described in the pickle module. writebackcon- trols the caching behavior of the database object. If True, all accessed entries are cached in memory and only written back when the shelf is closed.The default value is False. Returns a shelf object.\n\nOnce a shelf is opened, the following dictionary operations can be performed on it:\n\nOperation d[key] = data\n\ndata = d[key]\n\ndel d[key]\n\nd.has_key(key)\n\nd.keys()\n\nd.close()\n\nDescription Stores data at key. Overwrites existing data. Retrieves data at key. Deletes data at key. Tests for the existence of key. Returns all keys. Closes the shelf. Writes unsaved data to disk.\n\nd.sync()\n\nThe key values for a shelf must be strings.The objects stored in a shelf must be serializ- able using the pickle module.\n\nShelf(dict [, protocol [, writeback]])\n\nA mixin class that implements the functionality of a shelf on top of a dictionary object, dict.When this is used, objects stored in the returned shelf object will be pickled and stored in the underlying dictionary dict. Both protocoland writebackhave the same meaning as for shelve.open().\n\nThe shelve module uses the anydbm module to select an appropriate DBM module\n\nfor use. In most standard Python installations, it is likely to be the dbhash, which relies upon the Berkeley DB library.\n\nF h Lib f L Bdff",
      "content_length": 2582,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 337,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 338,
      "content": "18\n\nFile and Directory Handling\n\nThis chapter describes Python modules for high-level file and directory handling.\n\nTopics include modules for processing various kinds of basic file encodings such as gzip and bzip2 files, modules for extracting file archives such as zip and tar files, and modules for manipulating the file system itself (e.g., directory listings, moving, renaming, copy- ing, and so on). Low-level operating system calls related to files are covered in Chapter 19,“Operating System Services.” Modules for parsing the contents of files such as XML and HTML are mostly covered in Chapter 24,“Internet Data Handling and Encoding.”\n\nbz2 The bz2 module is used to read and write data compressed according to the bzip2 compression algorithm.\n\nBZ2File(filename [, mode [, buffering [, compresslevel]]])\n\nOpens a .bz2 file, filename, and returns a file-like object. modeis 'r' for reading or 'w' for writing. Universal newline support is also available by specifying a mode of 'rU'. bufferingspecifies the buffer size in bytes with a default value of 0 (no buffer- ing). compresslevelis a number between 1 and 9.A value of 9 (the default) provides the highest level of compression but consumes the most processing time.The returned object supports all the common file operations, including close(), read(), readline(), readlines(), seek(), tell(), write(), and writelines().\n\nBZ2Compressor([compresslevel])\n\nCreates a compressor object that can be used to sequentially compress a sequence of data blocks. compresslevelspecifies the compression level as a number between 1 and 9 (the default).\n\nAn instance, c, of BZ2Compressor has the following two methods:\n\nc.compress(data)\n\nFeeds new string data to the compressor object, c. Returns a string of compressed data if possible. Because compression involves chunks of data, the returned string may not include all the data and may include compressed data from previous calls to compress().The flush() method should be used to return any remaining data stored in the compressor after all input data has been supplied.\n\nF h Lib f L Bdff",
      "content_length": 2092,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 339,
      "content": "314\n\nChapter 18 File and Directory Handling\n\nc.flush()\n\nFlushes the internal buffers and returns a string containing the compressed version of all remaining data.After this operation, no further compress() calls should be made on the object.\n\nBZ2Decompressor()\n\nCreates a decompressor object.\n\nAn instance, d, of BZ2Decompressor supports just one method:\n\nd.decompress(data)\n\nGiven a chunk of compressed data in the string data, this method returns uncom- pressed data. Because data is processed in chunks, the returned string may or may not include a decompressed version of everything supplied in data. Repeated calls to this method will continue to decompress data blocks until an end-of-stream marker is found in the input. If subsequent attempts are made to decompress data after that, an EOFError exception will be raised.\n\ncompress(data [, compresslevel])\n\nReturns a compressed version of the data supplied in the string data. compresslevel is a number between 1 and 9 (the default).\n\ndecompress(data)\n\nReturns a string containing the decompressed data in the string data.\n\nfilecmp The filecmp module provides the following functions, which can be used to compare files and directories:\n\ncmp(file1, file2 [, shallow])\n\nCompares the files file1and file2and returns True if they’re equal, False if not. By default, files that have identical attributes as returned by os.stat() are considered to be equal. If the shallowparameter is specified and is False, the contents of the two files are compared to determine equality.\n\ncmpfiles(dir1, dir2, common [, shallow])\n\nCompares the contents of the files contained in the list commonin the two directories dir1and dir2. Returns a tuple containing three lists of filenames (match, mismatch, errors). matchlists the files that are the same in both directories, mismatchlists the files that don’t match, and errorslists the files that could not be compared for some reason.The shallowparameter has the same meaning as for cmp().\n\ndircmp(dir1, dir2 [, ignore[, hide]])\n\nCreates a directory comparison object that can be used to perform various comparison operations on the directories dir1and dir2. ignoreis a list of filenames to ignore and has a default value of ['RCS','CVS','tags']. hideis a list of filenames to hide and defaults to the list [os.curdir, os.pardir] (['.', '..'] on UNIX).\n\nF h Lib f L Bdff",
      "content_length": 2356,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 340,
      "content": "filecmp\n\n315\n\nA directory object, d, returned by dircmp() has the following methods and\n\nattributes:\n\nd.report()\n\nCompares directories dir1and dir2and prints a report to sys.stdout.\n\nd.report_partial_closure()\n\nCompares dir1and dir2and common immediate subdirectories. Results are printed to sys.stdout.\n\nd.report_full_closure()\n\nCompares dir1and dir2and all subdirectories recursively. Results are printed to sys.stdout.\n\nd.left_list\n\nLists the files and subdirectories in dir1.The contents are filtered by hideand ignore.\n\nd.right_list\n\nLists the files and subdirectories in dir2.The contents are filtered by hideand ignore.\n\nd.common\n\nLists the files and subdirectories found in both dir1and dir2.\n\nd.left_only\n\nLists the files and subdirectories found only in dir1.\n\nd.right_only\n\nLists the files and subdirectories found only in dir2.\n\nd.common_dirs\n\nLists the subdirectories that are common to dir1and dir2.\n\nd.common_files\n\nLists the files that are common to dir1and dir2.\n\nd.common_funny\n\nLists the files in dir1and dir2with different types or for which no information can be obtained from os.stat().\n\nd.same_files\n\nLists the files with identical contents in dir1and dir2.\n\nd.diff_files\n\nLists the files with different contents in dir1and dir2.\n\nd.funny_files\n\nLists the files that are in both dir1and dir2but that could not be compared for some reason (for example, insufficient permission to access).\n\nd.subdirs\n\nA dictionary that maps names in d.common_dirs to additional dircmp objects.\n\nF h Lib f L Bdff",
      "content_length": 1516,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 341,
      "content": "316\n\nChapter 18 File and Directory Handling\n\nNote\n\nThe attributes of a dircmp object are evaluated lazily and not determined at the time the dircmp object is first created. Thus, if you’re interested in only some of the attrib- utes, there’s no added performance penalty related to the other unused attributes.\n\nfnmatch The fnmatch module provides support for matching filenames using UNIX shell-style wildcard characters.This module only performs filename matching, whereas the glob module can be used to actually obtain file listings.The pattern syntax is as follows:\n\nCharacter(s) *\n\n?\n\n[seq]\n\n[!seq]\n\nDescription Matches everything Matches any single character Matches any character in seq Matches any character not in seq\n\nThe following functions can be used to test for a wildcard match:\n\nfnmatch(filename, pattern)\n\nReturns True or False depending on whether filenamematches pattern. Case sen- sitivity depends on the operating system (and may be non–case-sensitive on certain platforms such as Windows).\n\nfnmatchcase(filename, pattern)\n\nPerforms a case-sensitive comparison of filenameagainst pattern.\n\nfilter(names, pattern)\n\nApplies the fnmatch() function to all of the names in the sequence namesand returns a list of all names that match pattern.\n\nExamples\n\nfnmatch('foo.gif', '*.gif') # Returns True fnmatch('part37.html', 'part3[0-5].html') # Returns False\n\n# Example of finding files in an entire directory tree # using os.walk(), fnmatch, and generators def findall(topdir, pattern):\n\nfor path, files, dirs in os.walk(topdir):\n\nfor name in files:\n\nif fnmatch.fnmatch(name,pattern): yield os.path.join(path,name)\n\n# Find all .py files for pyfile in findall(\".\",\"*.py\"):\n\nprint pyfile\n\nF h Lib f L Bdff",
      "content_length": 1716,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 342,
      "content": "gzip\n\n317\n\nglob The glob module returns all filenames in a directory that match a pattern specified using the rules of the UNIX shell (as described in the fnmatch module).\n\nglob(pattern)\n\nReturns a list of pathnames that match pattern.\n\niglob(pattern)\n\nReturns the same results as glob() but using an iterator.\n\nExample\n\nhtmlfile = glob('*.html') imgfiles = glob('image[0-5]*.gif')\n\nNote\n\nTilde (˜) and shell variable expansion are not performed. Use os.path.expanduser() and os.path.expandvars(), respectively, to perform these expansions prior to call- ing glob().\n\ngzip The gzip module provides a class, GzipFile, that can be used to read and write files compatible with the GNU gzip program. GzipFile objects work like ordinary files except that data is automatically compressed or decompressed.\n\nGzipFile([filename [, mode [, compresslevel [, fileobj]]]])\n\nOpens a GzipFile. filenameis the name of a file, and modeis one of 'r', 'rb', 'a', 'ab', 'w', or 'wb'.The default is 'rb'. compresslevelis an integer from 1 to 9 that controls the level of compression. 1 is the fastest and produces the least compression; 9 is the slowest and produces the most compression (the default). fileobjis an existing file object that should be used. If supplied, it’s used instead of the file named by filename.\n\nopen(filename [, mode [, compresslevel]])\n\nSame as GzipFile(filename, mode, compresslevel).The default mode is 'rb'. The default compresslevelis 9.\n\nNotes\n\nn Calling the close() method of a GzipFile object doesn’t close files passed in\n\nfileobj.This allows additional information to be written to a file after the com- pressed data.\n\nn Files produced by the UNIX compress program are not supported. n This module requires the zlib module.\n\nF h Lib f L Bdff",
      "content_length": 1757,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 343,
      "content": "318\n\nChapter 18 File and Directory Handling\n\nshutil The shutil module is used to perform high-level file operations such as copying, removing, and renaming.The functions in this module should only be used for proper files and directories. In particular, they do not work for special kinds of files on the file system such as named pipes, block devices, etc.Also, be aware that these functions don’t always correctly deal with advanced kinds of file metadata (e.g., resource forks, creator codes, etc.).\n\ncopy(src,dst)\n\nCopies the file srcto the file or directory dst, retaining file permissions. srcand dst are strings.\n\ncopy2(src, dst)\n\nLike copy() but also copies the last access and modification times.\n\ncopyfile(src, dst)\n\nCopies the contents of srcto dst. srcand dstare strings.\n\ncopyfileobj(f1, f2 [, length])\n\nCopies all data from open file object f1to open file object f2. lengthspecifies a max- imum buffer size to use.A negative length will attempt to copy the data entirely with one operation (that is, all data will be read as a single chunk and then written).\n\ncopymode(src, dst)\n\nCopies the permission bits from srcto dst.\n\ncopystat(src, dst)\n\nCopies the permission bits, last access time, and last modification time from srcto dst. The contents, owner, and group of dstare unchanged.\n\ncopytree(src, dst, symlinks [,ignore]])\n\nRecursively copies an entire directory tree rooted at src.The destination directory dst will be created (and should not already exist). Individual files are copied using copy2(). If symlinksis true, symbolic links in the source tree are represented as symbolic links in the new tree. If symlinksis false or omitted, the contents of linked files are copied to the new directory tree. ignoreis an optional function that can be used to filter out specific files.As input, this function should accept a directory name and a list of directo- ry contents.As a return value, it should return a list of filenames to be ignored. If errors occur during the copy process, they are collected and the Error exception is raised at the end of processing.The exception argument is a list of tuples containing (srcname, dstname, exception) for all errors that occurred.\n\nignore_pattern(pattern1, pattern2, ...)\n\nCreates a function that can be used for ignoring all of the glob-style patterns given in pattern1, pattern2, etc.The returned function accepts as input two arguments, the first of which is a directory name and the second of which is a list of directory con- tents.As a result, a list of filenames to be ignored is returned. The primary use of the returned function is as the ignoreparameter to the copytree() function shown earli- er. However, the resulting function might also be used for operations involving the os.walk() function.\n\nF h Lib f L Bdff",
      "content_length": 2788,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 344,
      "content": "tarfile\n\n319\n\nmove(src, dst)\n\nMoves a file or directory srcto dst.Will recursively copy srcif it is being moved to a different file system.\n\nrmtree(path [, ignore_errors [, onerror]])\n\nDeletes an entire directory tree. If ignore_errorsis true, errors will be ignored. Otherwise, errors are handled by the onerrorfunction (if supplied).This function must accept three parameters (func, path, and excinfo), where funcis the function that caused the error (os.remove() or os.rmdir()), pathis the pathname passed to the function, and excinfois the exception information returned by sys.exc_info(). If an error occurs and onerroris omitted, an exception is raised.\n\ntarfile The tarfile module is used to manipulate tar archive files. Using this module, it is possible to read and write tar files, with or without compression.\n\nis_tarfile(name)\n\nReturns True if nameappears to be a valid tar file that can be read by this module.\n\nopen([name [, mode [, fileobj [, bufsize]]]])\n\nCreates a new TarFile object with the pathname name. modeis a string that specifies how the tar file is to be opened.The modestring is a combination of a file mode and a compression scheme specified as 'filemode[:compression]'.Valid combinations include the following:\n\nMode 'r'\n\n'r:' 'r:gz'\n\n'r:bz2' 'a', 'a:' 'w', 'w:' 'w:gz'\n\nDescription Open for reading. If the file is compressed, it is decompressed trans- parently. This is the default mode. Open for reading without compression. Open for reading with gzip compression. Open for reading with bzip2 compression. Open for appending with no compression. Open for writing with no compression. Open for writing with gzip compression. Open for writing with bzip2 compression.\n\n'w:bz2'\n\nThe following modes are used when creating a TarFile object that only allows sequential I/O access (no random seeks):\n\nMode 'r|'\n\n'r|gz'\n\n'r|bz2'\n\n'w|'\n\n'w|gz'\n\nDescription Open a stream of uncompressed blocks for reading Open a gzip compressed stream for reading Open a bzip2 compressed stream for reading Open an uncompressed stream for writing Open a gzip compressed stream for writing Open a bzip2 compressed stream for writing\n\n'w|bz2'\n\nF h Lib f L Bdff",
      "content_length": 2166,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 345,
      "content": "320\n\nChapter 18 File and Directory Handling\n\nIf the parameter fileobjis specified, it must be an open file object. In this case, the file overrides any filename specified with name. bufsizespecifies the block size used in a tar file.The default is 20*512 bytes.\n\nA TarFile instance, t, returned by open() supports the following methods and\n\nattributes:\n\nt.add(name [, arcname [, recursive]])\n\nAdds a new file to the tar archive. nameis the name of any kind of file (directory, sym- bolic link, and so on). arcnamespecifies an alternative name to use for the file inside the archive. recursiveis a Boolean flag that indicates whether or not to recursively add the contents of directories. By default, it is set to True.\n\nt.addfile(tarinfo [, fileobj])\n\nAdds a new object to the tar archive. tarinfois a TarInfo structure that contains information about the archive member. fileobjis an open file object from which data will be read and saved in the archive.The amount of data to read is determined by the size attribute of tarinfo.\n\nt.close()\n\nCloses the tar archive, writing two zero blocks to the end if the archive was opened for writing.\n\nt.debug\n\nControls the amount of debugging information produced, with 0 producing no output and 3 producing all debugging messages. Messages are written to sys.stderr.\n\nt.dereference\n\nIf this attribute is set to True, symbolic and hard links are dereferenced and the entire contents of the referenced file are added to the archive. If it’s set to False, just the link is added.\n\nt.errorlevel\n\nDetermines how errors are handled when an archive member is being extracted. If this attribute is set to 0, errors are ignored. If it’s set to 1, errors result in OSError or IOError exceptions. If it’s set to 2, nonfatal errors additionally result in TarError exceptions.\n\nt.extract(member [, path])\n\nExtracts a member from the archive, saving it to the current directory. memberis either an archive member name or a TarInfo instance. pathis used to specify a different des- tination directory.\n\nt.extractfile(member)\n\nExtracts a member from the archive, returning a read-only file-like object that can be used to read its contents using read(), readline(), readlines(), seek(), and tell() operations. memberis either an archive member name or a TarInfo object. If memberrefers to a link, an attempt will be made to open the target of the link.\n\nt.getmember(name)\n\nLooks up archive member nameand returns a TarInfo object containing information about it. Raises KeyError if no such archive member exists. If member nameappears\n\nF h Lib f L Bdff",
      "content_length": 2578,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 346,
      "content": "tarfile\n\n321\n\nmore than once in the archive, information for the last entry is returned (which is assumed to be the more recent).\n\nt.getmembers()\n\nReturns a list of TarInfo objects for all members of the archive.\n\nt.getnames()\n\nReturns a list of all archive member names.\n\nt.gettarinfo([name [, arcname [, fileobj]]])\n\nReturns a TarInfo object corresponding to a file, name, on the file system or an open file object, fileobj. arcnameis an alternative name for the object in the archive.The primary use of this function is to create an appropriate TarInfo object for use in meth- ods such as add().\n\nt.ignore_zeros\n\nIf this attribute is set to True, empty blocks are skipped when reading an archive. If it’s set to False (the default), an empty block signals the end of the archive. Setting this method to True may be useful for reading a damaged archive.\n\nt.list([verbose])\n\nLists the contents of the archive to sys.stdout. verbosedetermines the level of detail. If this method is set to False, only the archive names are printed. Otherwise, full details are printed (the default).\n\nt.next()\n\nA method used for iterating over the members of an archive. Returns the TarInfo structure for the next archive member or None.\n\nt.posix\n\nIf this attribute is set to True, the tar file is created according to the POSIX 1003.1- 1990 standard.This places restrictions on filename lengths and file size (filenames must be less than 256 characters and files must be less than 8GB in size). If this attribute is set to False, the archive is created using GNU extensions that lift these restrictions.The default value is False.\n\nMany of the previous methods manipulate TarInfo instances.The following table\n\nshows the methods and attributes of a TarInfo instance ti.\n\nAttribute ti.gid\n\nDescription Group ID Group name Returns True if the object is a block device Returns True if the object is a character device Returns True if the object is a device (character, block, or FIFO) Returns True if the object is a directory\n\nti.gname\n\nti.isblk()\n\nti.ischr()\n\nti.isdev()\n\nti.isdir() ti.isfifo() Returns True if the object is a FIFO ti.isfile() Returns True if the object is a regular file ti.islnk() ti.isreg()\n\nReturns True if the object is a hard link Same as isfile()\n\nF h Lib f L Bdff",
      "content_length": 2271,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 347,
      "content": "322\n\nChapter 18 File and Directory Handling\n\nAttribute ti.issym() ti.linkname Target filename of a hard or symbolic link ti.mode\n\nDescription Returns True if the object is a symbolic link\n\nPermission bits Last modification time Archive member name Size in bytes File type that is one of the constants REGTYPE, AREGTYPE, LNKTYPE, SYMTYPE, DIRTYPE, FIFOTYPE, CONTTYPE, CHRTYPE, BLKTYPE, or GNUTYPE_SPARSE User ID Username\n\nti.mtime\n\nti.name\n\nti.size\n\nti.type\n\nti.uid\n\nti.uname\n\nExceptions The following exceptions are defined by the tarfile module:\n\nTarError\n\nBase class for all other exceptions.\n\nReadError\n\nRaised when an error occurs while opening a tar file (for example, when opening an invalid file).\n\nCompressionError\n\nRaised when data can’t be decompressed.\n\nStreamError\n\nRaised when an unsupported operation is performed on a stream-like TarFile object (for instance, an operation that requires random access).\n\nExtractError\n\nRaised for nonfatal errors during extraction (only if errorlevel is set to 2).\n\nExample\n\n# Open a tar file and put some files into it t = tarfile.open(\"foo.tar\",\"w\") t.add(\"README\") import glob for pyfile in glob.glob(\"*.py\"):\n\nt.add(pyfile)\n\nt.close()\n\n# Open a tar file and iterate over all of its members t = tarfile.open(\"foo.tar\") for f in t:\n\nprint(\"%s %d\" % (f.name, f.size))\n\n# Scan a tar file and print the contents of \"README\" files t = tarfile.open(\"foo.tar\")\n\nF h Lib f L Bdff",
      "content_length": 1421,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 348,
      "content": "tempfile\n\n323\n\nfor f in t:\n\nif os.path.basename(f.name) == \"README\":\n\ndata = t.extractfile(f).read() print(\"**** %s ****\" % f.name)\n\ntempfile The tempfile module is used to generate temporary filenames and files.\n\nmkdtemp([suffix [,prefix [, dir]]])\n\nCreates a temporary directory accessible only by the owner of the calling process and returns its absolute pathname. suffixis an optional suffix that will be appended to the directory name, prefixis an optional prefix that will be inserted at the beginning of the directory name, and diris a directory where the temporary directory should be created.\n\nmkstemp([suffix [,prefix [, dir [,text]]]])\n\nCreates a temporary file and returns a tuple (fd, pathname), where fdis an integer file descriptor returned by os.open() and pathnameis absolute pathname of the file. suffixis an optional suffix appended to the filename, prefixis an optional prefix inserted at the beginning of the filename, diris the directory in which the file should be created, and textis a boolean flag that indicates whether to open the file in text mode or binary mode (the default).The creation of the file is guaranteed to be atomic (and secure) provided that the system supports the O_EXCL flag for os.open().\n\nmktemp([suffix [, prefix [,dir]]])\n\nReturns a unique temporary filename. suffixis an optional file suffix to append to the filename, prefixis an optional prefix inserted at the beginning of the filename, and diris the directory in which the file is created.This function only generates a unique filename and doesn’t actually create or open a temporary file. Because this function gen- erates a name before the file is actually opened, it introduces a potential security prob- lem.To address this, consider using mkstemp() instead.\n\ngettempdir()\n\nReturns the directory in which temporary files are created.\n\ngettempprefix()\n\nReturns the prefix used to generate temporary files. Does not include the directory in which the file would reside.\n\nTemporaryFile([mode [, bufsize [, suffix [,prefix [, dir]]]]])\n\nCreates a temporary file using mkstemp() and returns a file-like object that supports the same methods as an ordinary file object. modeis the file mode and defaults to 'w+b'. bufsizespecifies the buffering behavior and has the same meaning as for the open() function. suffix, prefix, and dirhave the same meaning as for mkstemp(). The object returned by this function is only a wrapper around a built-in file object that’s accessible in the file attribute.The file created by this function is automatically destroyed when the temporary file object is destroyed.\n\nF h Lib f L Bdff",
      "content_length": 2620,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 349,
      "content": "324\n\nChapter 18 File and Directory Handling\n\nNamedTemporaryFile([mode [, bufsize [, suffix [,prefix [, dir [, delete ]]]]]])\n\nCreates a temporary file just like TemporaryFile() but makes sure the filename is visi- ble on the file system.The filename can be obtained by accessing the name attribute of the returned file object. Note that certain systems may prevent the file from being reopened using this name until the temporary file has been closed.The deleteparame- ter, if set to True (the default), forces the temporary file to be deleted as soon as it is closed.\n\nSpooledTemporaryFile([max_size [, mode [, bufsize [, suffix [, prefix [, dir]]]]]])\n\nCreates a temporary file such as TemporaryFile except that the file contents are entirely held in memory until they exceed the size given in max_size.This internal spooling is implemented by first holding the file contents in a StringIO object until it is necessary to actually go to the file system. If any kind of low-level file I/O operation is performed involving the fileno() method, the memory contents are immediately written to a proper temporary file as defined by the TemporaryFile object. The file object returned by SpooledTemporaryFile also has a method rollover() that can be used to force the contents to be written to the file system.\n\nTwo global variables are used to construct temporary names.They can be assigned to\n\nnew values if desired.Their default values are system-dependent.\n\nVariable tempdir\n\ntemplate\n\nDescription The directory in which filenames returned by mktemp() reside. The prefix of filenames generated by mktemp(). A string of decimal dig- its is added to template to generate unique filenames.\n\nNote\n\nBy default, the tempfile module creates files by checking a few standard locations. For example, on UNIX, files are created in one of /tmp, /var/tmp, or /usr/tmp. On Windows, files are created in one of C:\\TEMP, C:\\TMP, \\TEMP, or \\TMP. These directo- ries can be overridden by setting one or more of the TMPDIR, TEMP, and TMP environ- ment variables. If, for whatever reason, temporary files can’t be created in any of the usual locations, they will be created in the current working directory.\n\nzipfile The zipfile module is used to manipulate files encoded in the popular zip format (originally known as PKZIP, although now supported by a wide variety of programs). Zip files are widely used by Python, mainly for the purpose of packaging. For example, if zip files containing Python source code are added to sys.path, then files contained within the zip file can be loaded via import (the zipimport library module implements this functionality, although it’s never necessary to use that library directly). Packages dis- tributed as .egg files (created by the setuptools extension) are also just zip files in dis- guise (an .egg file is actually just a zip file with some extra metadata added to it).\n\nF h Lib f L Bdff",
      "content_length": 2913,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 350,
      "content": "zipfile\n\n325\n\nThe following functions and classes are defined by the zipfile module:\n\nis_zipfile(filename)\n\nTests filenameto see if it’s a valid zip file. Returns True if filenameis a zip file; returns False otherwise.\n\nZipFile(filename [, mode [, compression [,allowZip64]]])\n\nOpens a zip file, filename, and returns a ZipFile instance. modeis 'r' to read from an existing file, 'w' to truncate the file and write a new file, or 'a' to append to an existing file. For 'a' mode, if filenameis an existing zip file, new files are added to it. If filenameis not a zip file, the archive is simply appended to the end of the file. compressionis the zip compression method used when writing to the archive and is either ZIP_STORED or ZIP_DEFLATED.The default is ZIP_STORED.The allowZip64 argument enables the use of ZIP64 extensions, which can be used to create zip files that exceed 2GB in size. By default, this is set to False.\n\nPyZipFile(filename [, mode[, compression [,allowZip64]]])\n\nOpens a zip file like ZipFile() but returns a special PyZipFile instance with one extra method, writepy(), used to add Python source files to the archive.\n\nZipInfo([filename [, date_time]])\n\nManually creates a new ZipInfo instance, used to contain information about an archive member. Normally, it’s not necessary to call this function except when using the z.writestr() method of a ZipFile instance (described later).The filenameand date_timearguments supply values for the filenameand date_timeattributes described below.\n\nAn instance, z, of ZipFile or PyZipFile supports the following methods and\n\nattributes:\n\nz.close()\n\nCloses the archive file.This must be called in order to flush records to the zip file before program termination.\n\nz.debug\n\nDebugging level in the range of 0 (no output) to 3 (most output).\n\nz.extract(name [, path [, pwd ]])\n\nExtracts a file from the archive and places it in the current working directory. nameis either a string that fully specifies the archive member or a ZipInfo instance. pathspec- ifies a different directory in which the file will extracted, and pwdis the password to use for encrypted archives.\n\nz.extractall([path [members [, pwd]]])\n\nExtracts all members of an archive into the current working directory. pathspecifies a different directory, and pwdis a password for encrypted archives. membersis a list of members to extract, which must be a proper subset of the list returned by the namelist() method (described next).\n\nF h Lib f L Bdff",
      "content_length": 2475,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 351,
      "content": "326\n\nChapter 18 File and Directory Handling\n\nz.getinfo(name)\n\nReturns information about the archive member name as a ZipInfo instance (described shortly).\n\nz.infolist()\n\nReturns a list of ZipInfo objects for all the members of the archive.\n\nz.namelist()\n\nReturns a list of the archive member names.\n\nz.open(name [, mode [, pwd]])\n\nOpens an archive member named nameand returns a file-like object for reading the contents. namecan either be a string or a ZipInfo instance describing one of the archive members. modeis the file mode and must be one of the read-only file modes such as 'r', 'rU', or 'U'. pwdis the password to use for encrypted archive members. The file object that is returned supports the read(), readline(), and readlines() methods as well as iteration with the for statement.\n\nz.printdir()\n\nPrints the archive directory to sys.stdout.\n\nz.read(name [,pwd])\n\nReads archive contents for member nameand returns the data as a string. nameis either a string or a ZipInfo instance describing the archive member. pwdis the password to use for encrypted archive members.\n\nz.setpassword(pwd)\n\nSets the default password used to extract encrypted files from the archive.\n\nz.testzip()\n\nReads all the files in the archive and verifies their CRC checksums. Returns the name of the first corrupted file or None if all files are intact.\n\nz.write(filename[, arcname[, compress_type]])\n\nWrites filenameto the archive with the archive name arcname. compress_typeis the compression parameter and is either ZIP_STORED or ZIP_DEFLATED. By default, the compression parameter given to the ZipFile() or PyZipFile() function is used.The archive must be opened in 'w' or 'a' mode for writes to work.\n\nz.writepy(pathname)\n\nThis method, available only with PyZipFile instances, is used to write Python source files (*.py files) to a zip archive and can be used to easily package Python applications for distribution. If pathnameis a file, it must end with .py. In this case, one of the cor- responding .pyo, .pyc, or .py files will be added (in that order). If pathnameis a directory and the directory is not a Python package directory, all the corresponding .pyo, .pyc, or .py files are added at the top level. If the directory is a package, the files are added under the package name as a file path. If any subdirectories are also package directories, they are added recursively.\n\nF h Lib f L Bdff",
      "content_length": 2387,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 352,
      "content": "zipfile\n\n327\n\nz.writestr(arcinfo, s)\n\nWrites the string sinto the zip file. arcinfois either a filename within the archive in which the data will be stored or a ZipInfo instance containing a filename, date, and time.\n\nZipInfo instances ireturned by the ZipInfo(), z.getinfo(), and z.infolist()\n\nfunctions have the following attributes:\n\nAttribute i.filename\n\nDescription Archive member name. Tuple (year,month,day,hours,minutes,seconds) con- taining the last modification time. monthand dayare numbers in the range 1–12 and 1–31, respectively. All other values start at 0. Compression type for the archive member. Only ZIP_STORED and ZIP_DEFLATED are currently supported by this module. Archive member comment. Expansion field data, used to contain additional file attributes. The data stored here depends on the system that created the file. Integer code describing the system that created the archive. Common values are 0 (MS-DOS FAT), 3 (UNIX), 7 (Macintosh), and 10 (Windows NTFS). PKZIP version code that created the zip archive. i.create_version i.extract_version Minimum version needed to extract the archive. i.reserved\n\ni.date_time\n\ni.compress_type\n\ni.comment\n\ni.extra\n\ni.create_system\n\ni.flag_bits\n\ni.volume\n\ni.internal_attr\n\ni.external_attr\n\ni.header_offset\n\ni.file_offset\n\ni.CRC\n\ni.compress_size\n\nReserved field. Currently set to 0. Zip flag bits that describe the data encoding including encryp- tion and compression. Volume number of the file header. Describes the internal structure of the archive contents. If the low-order bit is 1, the data is ASCII text. Otherwise, binary data is assumed. External file attributes which are operating system dependent. Byte offset to the file header. Byte offset to the start of the file data. CRC checksum of the uncompressed file. Size of the compressed file data. Size of the uncompressed file.\n\ni.file_size\n\nNote\n\nDetailed documentation about the internal structure of zip files can be found as a PKZIP Application Note at http://www.pkware.com/appnote.html.\n\nF h Lib f L Bdff",
      "content_length": 2033,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 353,
      "content": "328\n\nChapter 18 File and Directory Handling\n\nzlib The zlib module supports data compression by providing access to the zlib library.\n\nadler32(string [, value])\n\nComputes the Adler-32 checksum of string. valueis used as the starting value (which can be used to compute a checksum over the concatenation of several strings). Otherwise, a fixed default value is used.\n\ncompress(string [, level])\n\nCompresses the data in string, where levelis an integer from 1 to 9 controlling the level of compression. 1 is the least (fastest) compression, and 9 is the best (slowest) com- pression.The default value is 6. Returns a string containing the compressed data or rais- es error if an error occurs.\n\ncompressobj([level])\n\nReturns a compression object. levelhas the same meaning as in the compress() function.\n\ncrc32(string [, value])\n\nComputes a CRC checksum of string. If valueis present, it’s used as the starting value of the checksum. Otherwise, a fixed value is used.\n\ndecompress(string [, wbits [, buffsize]])\n\nDecompresses the data in string. wbitscontrols the size of the window buffer, and buffsizeis the initial size of the output buffer. Raises error if an error occurs.\n\ndecompressobj([wbits])\n\nReturns a compression object.The wbitsparameter controls the size of the window buffer.\n\nA compression object, c, has the following methods:\n\nc.compress(string)\n\nCompresses string. Returns a string containing compressed data for at least part of the data in string.This data should be concatenated to the output produced by earlier calls to c.compress() to create the output stream. Some input data may be stored in internal buffers for later processing.\n\nc.flush([mode])\n\nCompresses all pending input and returns a string containing the remaining compressed output. modeis Z_SYNC_FLUSH, Z_FULL_FLUSH, or Z_FINISH (the default). Z_SYNC_FLUSH and Z_FULL_FLUSH allow further compression and are used to allow partial error recovery on decompression. Z_FINISH terminates the compression stream.\n\nA decompression object, d, has the following methods and attributes:\n\nd.decompress(string [,max_length])\n\nDecompresses stringand returns a string containing uncompressed data for at least part of the data in string.This data should be concatenated with data produced by earlier calls to decompress() to form the output stream. Some input data may be\n\nF h Lib f L Bdff",
      "content_length": 2358,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 354,
      "content": "zlib\n\n329\n\nstored in internal buffers for later processing. max_lengthspecifies the maximum size of returned data. If exceeded, unprocessed data will be placed in the d.unconsumed_tail attribute.\n\nd.flush()\n\nAll pending input is processed, and a string containing the remaining uncompressed output is returned.The decompression object cannot be used again after this call.\n\nd.unconsumed_tail\n\nString containing data not yet processed by the last decompress() call.This would contain data if decompression needs to be performed in stages due to buffer size limita- tions. In this case, this variable would be passed to subsequent decompress() calls.\n\nd.unused_data\n\nString containing extra bytes that remain past the end of the compressed data.\n\nNote\n\nThe zlib library is available at http://www.zlib.net.\n\nF h Lib f L Bdff",
      "content_length": 822,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 355,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 356,
      "content": "19\n\nOperating System Services\n\nThe modules in this chapter provide access to a wide variety of operating system\n\nservices with an emphasis on low-level I/O, process management, and the operating environment. Modules that are commonly used in conjunction with writing systems programs are also included—for example, modules to read configuration files, write log files, and so forth. Chapter 18,“File and Directory Handling,” covers high-level modules related to file and filesystem manipulation—the material presented here tends be at a lower level than that.\n\nMost of Python’s operating system modules are based on POSIX interfaces. POSIX is a standard that defines a core set of operating system interfaces. Most UNIX systems support POSIX, and other platforms such as Windows support large portions of the interface.Throughout this chapter, functions and modules that only apply to a specific platform are noted as such. UNIX systems include both Linux and Mac OS X. Windows systems include all versions of Windows unless otherwise noted.\n\nReaders may want to supplement the material presented here with additional refer- ences. The C Programming Language, Second Edition by Brian W. Kernighan and Dennis M. Ritchie (Prentice Hall, 1989) provides a good overview of files, file descriptors, and the low-level interfaces on which many of the modules in this section are based. More advanced readers may want to consult a book such as Advanced Programming in the UNIX Environment, 2nd Edition by W. Richard Stevens and Stephen Rago (Addison Wesley, 2005). For an overview of general concepts, you may want to locate a college textbook on operating systems. However, given the high cost and limited day-to-day practical utility of these books, you’re probably better off asking a nearby computer science stu- dent to loan you their copy for a weekend.\n\ncommands The commands module is used to execute simple system commands specified as a string and return their output as a string. It only works on UNIX systems.The functionality provided by this module is somewhat similar to using backquotes (`) in a UNIX shell script. For example, typing x = commands.getoutput('ls –l') is similar to saying x=`ls –l`.\n\ngetoutput(cmd)\n\nExecutes cmdin a shell and returns a string containing both the standard output and standard error streams of the command.\n\nF h Lib f L Bdff",
      "content_length": 2364,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 357,
      "content": "332\n\nChapter 19 Operating System Services\n\ngetstatusoutput(cmd)\n\nLike getoutput(), except that a 2-tuple (status, output) is returned, where statusis the exit code, as returned by the os.wait() function, and outputis the string returned by getoutput().\n\nNotes\n\nn This module is only available in Python 2. In Python 3, both of the previous\n\nfunctions are found in the subprocess module.\n\nn Although this module can be used for simple shell operations, you are almost\n\nalways better off using the subprocess module for launching subprocesses and collecting their output.\n\nSee Also:\n\nsubprocess (p. 402)\n\nConfigParser, configparser The ConfigParser module (called configparser in Python 3) is used to read .ini format configuration files based on the Windows INI format.These files consist of named sections, each with its own variable assignments such as the following:\n\n# A comment ; A comment [section1] name1 = value1 name2 = value2\n\n[section2] ; Alternative syntax for assigning values name1: value1 name2: value2 ...\n\nThe ConfigParser Class The following class is used to manage configuration variables:\n\nConfigParser([defaults [, dict_type]])\n\nCreates a new ConfigParser instance. defaultsis an optional dictionary of values that can be referenced in configuration variables by including string format specifiers such as '%(key)s’ where keyis a key of defaults. dict_typespecifies the type of dictionary that is used internally for storing configuration variables. By default, it is dict (the built-in dictionary).\n\nAn instance cof ConfigParser has the following operations:\n\nc.add_section(section)\n\nAdds a new section to the stored configuration parameters. sectionis a string with the section name.\n\nF h Lib f L Bdff",
      "content_length": 1723,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 358,
      "content": "ConfigParser, configparser\n\n333\n\nc.defaults()\n\nReturns the dictionary of default values.\n\nc.get(section, option [, raw [, vars]])\n\nReturns the value of option optionfrom section sectionas a string. By default, the returned string is processed through an interpolation step where format strings such as '%(option)s' are expanded. In this case, optionmay the name of another configura- tion option in the same section or one of the default values supplied in the defaults parameter to ConfigParser. rawis a Boolean flag that disables this interpolation fea- ture, returning the option unmodified. varsis an optional dictionary containing more values for use in '%' expansions.\n\nc.getboolean(section, option)\n\nReturns the value of optionfrom section sectionconverted to Boolean value.Values such as \"0\", \"true\", \"yes\", \"no\", \"on\", and \"off\" are all understood and checked in a case-insensitive manner.Variable interpolation is always performed by this method (see c.get()).\n\nc.getfloat(section, option)\n\nReturns the value of optionfrom section sectionconverted to a float with variable interpolation.\n\nc.getint(section, option)\n\nReturns the value of optionfrom section sectionconverted to an integer with vari- able interpolation.\n\nc.has_option(section, option)\n\nReturns True if section sectionhas an option named option.\n\nc.has_section(section)\n\nReturns True if there is a section named section.\n\nc.items(section [, raw [, vars]])\n\nReturns a list of (option, value) pairs from section section. rawis a Boolean flag that disables the interpolation feature if set to True. varsis a dictionary of additional values that can be used in '%’ expansions.\n\nc.options(section)\n\nReturns a list of all options in section section.\n\nc.optionxform(option)\n\nTransforms the option name optionto the string that’s used to refer to the option. By default, this is a lowercase conversion.\n\nc.read(filenames)\n\nReads configuration options from a list of filenames and stores them. filenamesis either a single string, in which case that is the filename that is read, or a list of file- names. If any of the given filenames can’t be found, they are ignored.This is useful if you want to read configuration files from many possible locations, but where such files may or may not be defined.A list of the successfully parsed filenames is returned.\n\nF h Lib f L Bdff",
      "content_length": 2338,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 359,
      "content": "334\n\nChapter 19 Operating System Services\n\nc.readfp(fp [, filename])\n\nReads configuration options from a file-like object that has already been opened in fp. filenamespecifies the filename associated with fp(if any). By default, the filename is taken from fp.name or is set to '<???>' if no such attribute is defined.\n\nc.remove_option(section, option)\n\nRemoves optionfrom section section.\n\nc.remove_section(section)\n\nRemoves section section.\n\nc.sections()\n\nReturns a list of all section names.\n\nc.set(section, option, value)\n\nSets a configuration option optionto valuein section section. valueshould be a string.\n\nc.write(file)\n\nWrites all of the currently held configuration data to file. fileis a file-like object that has already been opened.\n\nExample The ConfigParser module is often overlooked, but it is an extremely useful tool for controlling programs that have an extremely complicated user configuration or runtime environment. For example, if you’re writing a component that has to run inside of a large framework, a configuration file is often an elegant way to supply runtime parame- ters. Similarly, a configuration file may be a more elegant approach than having a pro- gram read large numbers of command-line options using the optparse module.There are also subtle, but important, differences between using configuration files and simply reading configuration data from a Python source script.\n\nThe following few examples illustrate some of the more interesting features of the\n\nConfigParser module. First, consider a sample .ini file:\n\n# appconfig.ini # Configuration file for my mondo application\n\n[output] LOGFILE=%(LOGDIR)s/app.log LOGGING=on LOGDIR=%(BASEDIR)s/logs\n\n[input] INFILE=%(INDIR)s/initial.dat INDIR=%(BASEDIR)s/input\n\nF h Lib f L Bdff",
      "content_length": 1766,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 360,
      "content": "ConfigParser, configparser\n\n335\n\nThe following code illustrates how you read a configuration file and supply default val- ues to some of the variables:\n\nfrom configparser import ConfigParser # Use from ConfigParser in Python 2\n\n# Dictionary of default variable settings defaults = {\n\n'basedir' : '/Users/beazley/app'\n\n}\n\n# Create a ConfigParser object and read the .ini file cfg = ConfigParser(defaults) cfg.read('appconfig.ini')\n\nAfter you have read a configuration file, you use the get() method to retrieve option values. For example:\n\n>>> cfg.get('output','logfile') '/Users/beazley/app/logs/app.log' >>> cfg.get('input','infile') '/Users/beazley/app/input/initial.dat' >>> cfg.getboolean('output','logging') True >>>\n\nHere, you immediately see some interesting features. First, configuration parameters are case insensitive.Thus, if your program is reading a parameter 'logfile', it does not matter if the configuration file uses 'logfile', 'LOGFILE', or 'LogFile'. Second, configuration parameters can include variable substitutions such as '%(BASEDIR)s' and '%(LOGDIR)s' as seen in the file.These substitutions are also case insensitive. Moreover, the definition order of configuration parameters does not matter in these substitutions. For example, in appconfig.ini, the LOGFILE parameter makes a reference to the LOGDIR parameter, which is defined later in the file. Finally, values in configuration files are often interpreted correctly even if they don’t exactly match Python syntax or datatypes. For example, the 'on' value of the LOGGING parameter is interpreted as True by the cfg.getboolean() method.\n\nConfiguration files also have the ability to be merged together. For example, suppose\n\nthe user had their own configuration file with custom settings:\n\n; userconfig.ini ; ; Per-user settings\n\n[output] logging=off\n\n[input] BASEDIR=/tmp\n\nYou can merge the contents of this file in with already loaded configuration parameters. For example:\n\n>>> cfg.read('userconfig.ini') ['userconfig.ini'] >>> cfg.get('output','logfile') '/Users/beazley/app/logs/app.log' >>> cfg.get('output','logging') 'off' >>> cfg.get('input','infile') '/tmp/input/initial.dat' >>>\n\nF h Lib f L Bdff",
      "content_length": 2186,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 361,
      "content": "336\n\nChapter 19 Operating System Services\n\nHere, you will notice that the newly loaded configuration selectively replaces the parameters that were already defined. Moreover, if you change one of the configuration parameters that’s used in variable substitutions of other configuration parameters, the changes correctly propagate. For example, the new setting of BASEDIR in the input section affects previously defined configuration parameters in that section such as INFILE.This behavior is an important but subtle difference between using a config file and simply defining a set of program parameters in a Python script.\n\nNotes Two other classes can be used in place of ConfigParser.The class RawConfigParser provides all of the functionality of ConfigParser but doesn’t perform any variable interpolation.The SafeConfigParser class provides the same functionality as ConfigParser, but it addresses some subtle problems that arise if configuration values themselves literally include special formatting characters used by the interpolation fea- ture (e.g., '%').\n\ndatetime The datetime module provides a variety of classes for representing and manipulating dates and times. Large parts of this module are simply related to different ways of creat- ing and outputting date and time information. Other major features include mathemati- cal operations such as comparisons and calculations of time deltas. Date manipulation is a complex subject, and readers would be strongly advised to consult Python’s online documentation for an introductory background concerning the design of this module.\n\ndate Objects A date object represents a simple date consisting of a year, month, and day.The follow- ing four functions are used to create dates:\n\ndate(year, month, day)\n\nCreates a new date object. yearis an integer in the range datetime.MINYEAR to datetime.MAXYEAR. monthis an integer in the range 1 to 12, and dayis an integer in the range 1 to the number of days in the given month.The returned date object is immutable and has the attributes year, month, and daycorresponding to the values of the supplied arguments.\n\ndate.today()\n\nA class method that returns a date object corresponding to the current date.\n\ndate.fromtimestamp(timestamp)\n\nA class method that returns a date object corresponding to the timestamp timestamp. timestampis a value returned by the time.time() function.\n\ndate.fromordinal(ordinal)\n\nA class method that returns a date object corresponding to an ordinalnumber of days from the minimum allowable date (January 1 of year 1 has ordinal value 1 and January 1, 2006 has ordinal value 732312).\n\nF h Lib f L Bdff",
      "content_length": 2628,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 362,
      "content": "datetime\n\n337\n\nThe following class attributes describe the maximum rate and resolution of date\n\ninstances.\n\ndate.min\n\nClass attribute representing the earliest date that can be represented (datetime.date(1,1,1)).\n\ndate.max\n\nClass attribute representing the latest possible date (datetime.date(9999,12,31)).\n\ndate.resolution\n\nSmallest resolvable difference between non-equal date objects (datetime.timedelta(1)).\n\nAn instance, d, of date has read-only attributes d.year, d.month, and d.day and\n\nadditionally provides the following methods:\n\nd.ctime()\n\nReturns a string representing the date in the same format as normally used by the time.ctime() function.\n\nd.isocalendar()\n\nReturns the date as a tuple (iso_year, iso_week, iso_weekday), where iso_week is in the range 1 to 53 and iso_weekdayis the range 1 (Monday) to 7 (Sunday).The first iso_weekis the first week of the year that contains a Thursday.The range of values for the three tuple components are determined by the ISO 8601 standard.\n\nd.isoformat()\n\nReturns an ISO 8601–formatted string of the form 'YYYY-MM-DD' representing the date.\n\nd.isoweekday()\n\nReturns the day of the week in the range 1 (Monday) to 7 (Sunday).\n\nd.replace([year [, month [, day ]]])\n\nReturns a new date object with one or more of the supplied components replaced by a new value. For example, d.replace(month=4) returns a new date where the month has been replaced by 4.\n\nd.strftime(format)\n\nReturns a string representing the date formatted according to the same rules as the time.strftime() function.This function only works for dates later than the year 1900. Moreover, format codes for components missing from date objects (such as hours, minutes, and so on) should not be used.\n\nd.timetuple()\n\nReturns a time.struct_time object suitable for use by functions in the time module. Values related to the time of day (hours, minutes, seconds) will be set to 0.\n\nd.toordinal()\n\nConverts dto an ordinal value. January 1 of year 1 has ordinal value 1.\n\nF h Lib f L Bdff",
      "content_length": 1998,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 363,
      "content": "338\n\nChapter 19 Operating System Services\n\nd.weekday()\n\nReturns the day of the week in the range 0 (Monday) to 6 (Sunday).\n\ntime Objects time objects are used to represent a time in hours, minutes, seconds, and microseconds. Times are created using the following class constructor:\n\ntime(hour [, minute [, second [, microsecond [, tzinfo]]]])\n\nCreates a time object representing a time where 0 <= hour < 24, 0 <= minute < 60, 0 <= second < 60, and 0 <= microsecond < 1000000. tzinfoprovides time zone information and is an instance of the tzinfo class described later in this section. The returned time object has the attributes hour, minute, second, microsecond, and tzinfo, which hold the corresponding values supplied as arguments.\n\nThe following class attributes of time describe the range of allowed values and reso-\n\nlution of time instances:\n\ntime.min\n\nClass attribute representing the minimum representable time (datetime.time(0,0)).\n\ntime.max\n\nClass attribute representing the maximum representable time (datetime.time(23,59, 59, 999999)).\n\ntime.resolution\n\nSmallest resolvable difference between non-equal time objects (datetime.timedelta(0,0,1)).\n\nAn instance, t, of a time object has attributes t.hour, t.minute, t.second,\n\nt.microsecond, and t.tzinfo in addition to the following methods:\n\nt.dst()\n\nReturns the value of t.tzinfo.dst(None).The returned object is a timedelta object. If no time zone is set, None is returned.\n\nt.isoformat()\n\nReturns a string representing the time as 'HH:MM:SS.mmmmmm'. If the microseconds are 0, that part of the string is omitted. If time zone information has been supplied, the time may have an offset added to it (for example, 'HH:MM:SS.mmmmmm+HH:MM').\n\nt.replace([hour [, minute [, second [, microsecond [, tzinfo ]]]]])\n\nReturns a new time object, where one or more components have been replaced by the supplied values. For example, t.replace(second=30) changes the seconds field to 30 and returns a new time object.The arguments have the same meaning as those supplied to the time() function shown earlier.\n\nt.strftime(format)\n\nReturns a string formatted according to the same rules as the time.strftime() func- tion in the time module. Because date information is unavailable, only the formatting codes for time-related information should be used.\n\nF h Lib f L Bdff",
      "content_length": 2317,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 364,
      "content": "datetime\n\n339\n\nt.tzname()\n\nReturns the value of t.tzinfo.tzname(). If no time zone is set, None is returned.\n\nt.utcoffset()\n\nReturns the value of t.tzinfo.utcoffset(None).The returned object is a timedelta object. If no time zone has been set, None is returned.\n\ndatetime objects datetime objects are used to represent dates and times together.There are many possi- ble ways to create a datetime instance:\n\ndatetime(year, month, day [, hour [, minute [, second [, microsecond [, tzinfo]]]]])\n\nCreates a new datetime object that combines all the features of date and time objects.The arguments have the same meaning as arguments provided to date() and time().\n\ndatetime.combine(date,time)\n\nA class method that creates a datetime object by combining the contents of a date object, date, and a time object, time.\n\ndatetime.fromordinal(ordinal)\n\nA class method that creates a datetime object given an ordinal day (integer number of days since datetime.min).The time components are all set to 0, and tzinfois set to None.\n\ndatetime.fromtimestamp(timestamp [, tz])\n\nA class method that creates a datetime object from a timestamp returned by the time.time() function. tzprovides optional time zone information and is a tzinfo instance.\n\ndatetime.now([tz])\n\nA class method that creates a datetime object from the current local date and time. tz provides optional time zone information and is an instance of tzinfo.\n\ndatetime.strptime(datestring, format)\n\nA class method that creates a datetime object by parsing the date string in datestringaccording to the date format in format.The parsing is performed using the strptime() function in the time module.\n\ndatetime.utcfromtimestamp(timestamp)\n\nA class method that creates a datetime object from a timestamp typically returned by time.gmtime().\n\ndatetime.utcnow()\n\nA class method that creates a datetime object from the current UTC date and time.\n\nF h Lib f L Bdff",
      "content_length": 1905,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 365,
      "content": "340\n\nChapter 19 Operating System Services\n\nThe following class attributes describe the range of allowed dates and resolution:\n\ndatetime.min\n\nEarliest representable date and time (datetime.datetime(1,1,1,0,0)).\n\ndatetime.max\n\nLatest representable date and time (datetime. datetime(9999,12,31,23,59,59,999999)).\n\ndatetime.resolution\n\nSmallest resolvable difference between non-equal datetime objects (datetime.timedelta(0,0,1)).\n\nAn instance, d, of a datetime object has the same methods as date and time\n\nobjects combined. In additional, the following methods are available:\n\nd.astimezone(tz)\n\nReturns a new datetime object but in a different time zone, tz.The members of the new object will be adjusted to represent the same UTC time but in the time zone tz.\n\nd.date()\n\nReturns a date object with the same date.\n\nd.replace([year [, month [, day [, hour [, minute [, second [, microsecond [, tzinfo]]]]]]])\n\nReturns a new datetime object with one or more of the listed parameters replaced by new values. Use keyword arguments to replace an individual value.\n\nd.time()\n\nReturns a time object with the same time.The resulting time object has no time zone information set.\n\nd.timetz()\n\nReturns a time object with the same time and time zone information.\n\nd.utctimetuple()\n\nReturns a time.struct_time object containing date and time information normalized to UTC time.\n\ntimedelta objects timedelta objects represent the difference between two dates or times.These objects are normally created as the result of computing a difference between two datetime instances using the - operator. However, they can be manually constructed using the following class:\n\ntimedelta([days [, seconds [, microseconds [, milliseconds [, minutes [, hours [, weeks ]]]]]]])\n\nCreates a timedelta object that represents the difference between two dates and times. The only significant parameters are days, seconds, and microseconds, which are used internally to represent a difference.The other parameters, if supplied, are converted into days, seconds, and microseconds.The attributes days, seconds, and microseconds of the returned timedelta object contain these values.\n\nF h Lib f L Bdff",
      "content_length": 2162,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 366,
      "content": "datetime\n\n341\n\nThe following class attributes describe the maximum range and resolution of\n\ntimedelta instances:\n\ntimedelta.min\n\nThe most negative timedelta object that can be represented (timedelta(-999999999))\n\ntimedelta.max\n\nThe most positive timedelta object that can be represented (timedelta(days=999999999, hours=23, minutes=59, seconds=59, microseconds=999999)).\n\ntimedelta.resolution\n\nA timedelta object representing the smallest resolvable difference between non-equal timedelta objects (timedelta(microseconds=1)).\n\nMathematical Operations Involving Dates A significant feature of the datetime module is that it supports mathematical opera- tions involving dates. Both date and datetime objects support the following operations:\n\nOperation td = date1 - date2\n\ndate2 = date1 + td\n\ndate2 = date1 - td\n\ndate1 < date2\n\nDescription Returns a timedelta object Adds a timedelta to a date Subtracts a timedelta from a date Date comparison\n\ndate1 <= date2\n\ndate1 == date2\n\ndate1 != date2\n\ndate1 > date2\n\ndate1 >= date2\n\nWhen comparing dates, you must use care when time zone information has been sup- plied. If a date includes tzinfo information, that date can only be compared with other dates that include tzinfo; otherwise, a TypeError is generated.When two dates in dif- ferent time zones are compared, they are first adjusted to UTC before being compared.\n\ntimedelta objects also support a variety of mathematical operations:\n\nOperation td3 = td2 + td1\n\ntd3 = td2 - td1\n\ntd2 = td1 * i\n\nDescription Adds two time deltas Subtracts two time deltas Multiplication by an integer\n\ntd2 = i * td2\n\ntd2 = td1 // i\n\ntd2 = -td1\n\nFloor division by an integer, i Unary subtraction, addition\n\ntd2 = +td1\n\nabs(td)\n\nAbsolute value\n\nF h Lib f L Bdff",
      "content_length": 1739,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 367,
      "content": "342\n\nChapter 19 Operating System Services\n\nOperation td1 < td2\n\nDescription Comparison\n\ntd1 <= td2\n\ntd1 == td2\n\ntd1 != td2\n\ntd1 > td2\n\ntd1 >= td2\n\nHere are some examples:\n\n>>> today = datetime.datetime.now() >>> today.ctime() 'Thu Oct 20 11:10:10 2005' >>> oneday = datetime.timedelta(days=1) >>> tomorrow = today + oneday >>> tomorrow.ctime() 'Fri Oct 21 11:10:10 2005' >>>\n\nIn addition to these operations, all date, datetime, time, and timedelta objects are immutable.This means that they can be used as dictionary keys, placed in sets, and used in a variety of other operations.\n\ntzinfo Objects Many of the methods in the datetime module manipulate special tzinfo objects that represent information about a time zone. tzinfo is merely a base class. Individual time zones are created by inheriting from tzinfo and implementing the following methods:\n\ntz.dst(dt)\n\nReturns a timedelta object representing daylight savings time adjustments, if applica- ble. Returns None if no information is known about DST.The argument dtis either a datetime object or None.\n\ntz.fromutc(dt)\n\nConverts a datetime object, dt, from UTC time to the local time zone and returns a new datetime object.This method is called by the astimezone() method on datetime objects.A default implementation is already provided by tzinfo, so it’s usu- ally not necessary to redefine this method.\n\ntz.tzname(dt)\n\nReturns a string with the name of the time zone (for example, \"US/Central\"). dtis either a datetime object or None.\n\ntz.utcoffset(dt)\n\nReturns a timedelta object representing the offset of local time from UTC in minutes east of UTC.The offset incorporates all elements that make up the local time, including daylight savings time, if applicable.The argument dtis either a datetimeobject or None.\n\nF h Lib f L Bdff",
      "content_length": 1791,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 368,
      "content": "errno\n\n343\n\nThe following example shows a basic prototype of how one would define a time\n\nzone:\n\n# Variables that must be defined # TZOFFSET - Timezone offset in hours from UTC. For # example, US/CST is -6 hours # DSTNAME - Name of timezone when DST is in effect # STDNAME - Name of timezone when DST not in effect\n\nclass SomeZone(datetime.tzinfo):\n\ndef utcoffset(self,dt):\n\nreturn datetime.timedelta(hours=TZOFFSET) + self.dst(dt)\n\ndef dst(self,dt):\n\n# is_dst() is a function you must implement to see\n\n# whether DST is in effect according to local timezone rules. if is_dst(dt):\n\nreturn datetime.timedelta(hours=1)\n\nelse:\n\nreturn datetime.timedelta(0)\n\ndef tzname(self,dt):\n\nif is_dst(dt):\n\nreturn DSTNAME\n\nelse:\n\nreturn STDNAME\n\nA number of examples of defining time zones can also be found in the online docu- mentation for datetime.\n\nDate and Time Parsing A common question that arises with date handling is how to parse different kinds of time and date strings into an appropriate datetime object.The only parsing function that is really provided by the datetime module is datetime.strptime(). However, in order to use this, you need to specify the precise date format using various combina- tions of format codes (see time.strptime()). For example, to parse the date string s=\"Aug 23, 2008\", you would have to use d = datetime.datetime.strptime(s, \"%b %d, %Y\").\n\nFor “fuzzy” date parsing that automatically understands a number of common date\n\nformats, you must turn to third-party modules. Go to the Python Package Index (http://pypi.python.org) and do a search for “datetime” to find a wide variety of utili- ty modules that expand the feature set of the datetime module.\n\nSee also:\n\ntime (p. 405)\n\nerrno The errno module defines symbolic names for the integer error codes returned by var- ious operating system calls, especially those found in the os and socket modules.These codes are typically found in the errno attribute of an OSError or IOError exception. The os.strerror() function can be used to translate an error code into a string error message.The following dictionary can also be used to translate an integer error code into its symbolic name:\n\nF h Lib f L Bdff",
      "content_length": 2183,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 369,
      "content": "344\n\nChapter 19 Operating System Services\n\nerrorcode\n\nThis dictionary maps errno integers to symbolic names (such as 'EPERM').\n\nPOSIX Error Codes The following table shows the POSIX symbolic names for common system error codes. The error codes listed here are supported on almost every version of UNIX, Macintosh OS-X, and Windows. Different UNIX systems may provide additional error codes that are less common and not listed here. If such errors occur, you can consult the errorcode dictionary to find the appropriate symbolic name to use in your program.\n\nError Code E2BIG\n\nEACCES\n\nEADDRINUSE\n\nEADDRNOTAVAIL\n\nEAFNOSUPPORT\n\nEAGAIN\n\nEALREADY\n\nEBADF\n\nEBUSY\n\nECHILD\n\nECONNABORTED\n\nECONNREFUSED\n\nECONNRESET\n\nEDEADLK\n\nEDEADLOCK\n\nEDESTADDRREQ\n\nEDOM EDQUOT\n\nEEXIST\n\nEFAULT\n\nEFBIG\n\nEHOSTDOWN\n\nEHOSTUNREACH\n\nEILSEQ\n\nEINPROGRESS\n\nEINTR\n\nEINVAL\n\nEIO\n\nEISCONN\n\nEISDIR\n\nDescription Arg list too long. Permission denied. Address already in use. Cannot assign requested address. Address family not supported by protocol. Try again. Operation already in progress. Bad file number. Device or resource busy. No child processes. Software caused connection abort. Connection refused. Connection reset by peer. Resource deadlock would occur. File-locking deadlock error. Destination address required. Math argument out of domain of function. Quota exceeded. File exists. Bad address. File too large. Host is down. No route to host. Illegal byte sequence. Operation now in progress. Interrupted system call. Invalid argument. I/O error. Transport endpoint is already connected. Is a directory. Too many symbolic links encountered. Too many open files. Too many links.\n\nELOOP\n\nEMFILE\n\nEMLINK\n\nF h Lib f L Bdff",
      "content_length": 1687,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 370,
      "content": "Error Code EMSGSIZE\n\nENETDOWN\n\nENETRESET\n\nENETUNREACH\n\nENFILE\n\nENOBUFS\n\nENODEV\n\nENOENT\n\nENOEXEC\n\nENOLCK\n\nENOMEM\n\nENOPROTOOPT\n\nENOSPC\n\nENOSYS\n\nENOTCONN\n\nENOTDIR\n\nENOTEMPTY\n\nENOTSOCK\n\nENOTTY\n\nENXIO\n\nEOPNOTSUPP\n\nEPERM\n\nEPFNOSUPPORT\n\nEPIPE\n\nEPROTONOSUPPORT\n\nEPROTOTYPE\n\nERANGE\n\nEREMOTE\n\nEROFS\n\nESHUTDOWN\n\nESOCKTNOSUPPORT\n\nESPIPE\n\nESRCH\n\nESTALE\n\nETIMEDOUT\n\nETOOMANYREFS\n\nEUSERS\n\nEWOULDBLOCK\n\nEXDEV\n\nerrno\n\n345\n\nDescription Message too long. Network is down. Network dropped connection due to reset. Network is unreachable. File table overflow. No buffer space available. No such device. No such file or directory. Exec format error. No record locks available. Out of memory. Protocol not available. No space left on device. Function not implemented. Transport endpoint is not connected. Not a directory. Directory not empty. Socket operation on non-socket. Not a terminal. No such device or address. Operation not supported on transport endpoint. Operation not permitted. Protocol family not supported. Broken pipe. Protocol not supported. Protocol wrong type for socket. Math result not representable. Object is remote. Read-only file system. Cannot send after transport endpoint shutdown. Socket type not supported. Illegal seek. No such process. Stale NFS file handle. Connection timed out. Too many references: Cannot splice. Too many users. Operation would block. Cross-device link.\n\nF h Lib f L Bdff",
      "content_length": 1400,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 371,
      "content": "346\n\nChapter 19 Operating System Services\n\nWindows Error Codes The error codes in the following table are only available on Windows.\n\nError Code WSAEACCES\n\nWSAEADDRINUSE\n\nWSAEADDRNOTAVAIL\n\nWSAEAFNOSUPPORT\n\nWSAEALREADY\n\nWSAEBADF\n\nWSAECONNABORTED\n\nWSAECONNREFUSED\n\nWSAECONNRESET\n\nWSAEDESTADDRREQ\n\nWSAEDISCON\n\nWSAEDQUOT\n\nWSAEFAULT\n\nWSAEHOSTDOWN\n\nWSAEHOSTUNREACH\n\nWSAEINPROGRESS\n\nWSAEINTR\n\nWSAEINVAL\n\nWSAEISCONN\n\nWSAELOOP\n\nWSAEMFILE\n\nWSAEMSGSIZE\n\nWSAENAMETOOLONG\n\nWSAENETDOWN\n\nWSAENETRESET\n\nWSAENETUNREACH\n\nWSAENOBUFS\n\nWSAENOPROTOOPT\n\nWSAENOTCONN\n\nWSAENOTEMPTY\n\nWSAENOTSOCK\n\nWSAEOPNOTSUPP\n\nWSAEPFNOSUPPORT\n\nWSAEPROCLIM\n\nWSAEPROTONOSUPPORT\n\nWSAEPROTOTYPE\n\nWSAEREMOTE\n\nDescription Permission denied. Address already in use. Cannot assign requested address. Address family not supported by protocol family. Operation already in progress. Invalid file handle. Software caused connection abort. Connection refused. Connection reset by peer. Destination address required. Remote shutdown. Disk quota exceeded. Bad address. Host is down. No route to host. Operation now in progress. Interrupted system call. Invalid argument. Socket already connected. Cannot translate name. Too many open files. Message too long. Name too long. Network is down. Network dropped connection on reset. Network is unreachable. No buffer space is available. Bad protocol option. Socket is not connected. Cannot remove non-empty directory. Socket operation on non-socket. Operation not supported. Protocol family not supported. Too many processes. Protocol not supported. Protocol wrong type for socket. Item not available locally. Cannot send after socket shutdown. Socket type not supported. File handle no longer available. Connection timed out.\n\nWSAESHUTDOWN\n\nWSAESOCKTNOSUPPORT WSAESTALE WSAETIMEDOUT\n\nF h Lib f L Bdff",
      "content_length": 1790,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 372,
      "content": "fcntl\n\n347\n\nError Code WSAETOOMANYREFS\n\nDescription Too many references to a kernel object. Quota exceeded. Resource temporarily unavailable. Successful WSA startup not performed. Network subsystem not available. WSASYSNOTREADY WSAVERNOTSUPPORTED Winsock.dll version out of range.\n\nWSAEUSERS\n\nWSAEWOULDBLOCK\n\nWSANOTINITIALISED\n\nfcntl The fcntl module performs file and I/O control on UNIX file descriptors. File descriptors can be obtained using the fileno() method of a file or socket object.\n\nfcntl(fd, cmd [, arg])\n\nPerforms a command, cmd, on an open file descriptor, fd. cmdis an integer command code. argis an optional argument that’s either an integer or a string. If argis passed as an integer, the return value of this function is an integer. If argis a string, it’s interpret- ed as a binary data structure, and the return value of the call is the contents of the buffer converted back into a string object. In this case, the supplied argument and return value should be less than 1,024 bytes to avoid possible data corruption.The fol- lowing commands are available:\n\nCommand F_DUPFD\n\nF_SETFD\n\nF_GETFD\n\nF_SETFL\n\nF_GETFL\n\nF_GETOWN\n\nF_SETOWN\n\nF_GETLK\n\nDescription Duplicates a file descriptor. argis the lowest number that the new file descriptor can assume. Similar to the os.dup() system call. Sets the close-on-exec flag to arg(0 or 1). If set, the file is closed on an exec() system call. Returns the close-on-exec flag. Sets status flags to arg, which is the bitwise OR of the following: O_NDELAY—Nonblocking I/O (System V) O_APPEND—Append mode (System V) O_SYNC—Synchronous write (System V) FNDELAY—Nonblocking I/O (BSD) FAPPEND—Append mode (BSD) FASYNC—Sends SIGIO signal to process group when I/O is possi- ble (BSD) Gets status flags as set by F_SETFL. Gets process ID or process group ID set to receive SIGIO and SIGURG signals (BSD). Sets process ID or process group ID to receive SIGIO and SIGURG signals (BSD). Returns flock structure used in file-locking operations. Locks a file, returning -1 if the file is already locked. Locks a file but waits if the lock cannot be acquired.\n\nF_SETLK\n\nF_SETLKW\n\nF h Lib f L Bdff",
      "content_length": 2138,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 373,
      "content": "348\n\nChapter 19 Operating System Services\n\nAn IOError exception is raised if the fcntl() function fails.The F_GETLK and F_SETLK commands are supported through the lockf() function.\n\nioctl(fd, op, arg [, mutate_flag])\n\nThis function is like the fcntl() function, except that the operations supplied in op are generally defined in the library module termios.The extra mutate_flagcontrols the behavior of this function when a mutable buffer object is passed as an argument. Further details about this can be found in the online documentation. Because the pri- mary use of ioctl()is to interact with device-drivers and other low-level components of the operating system, its use depends highly on the underlying platform. It should not be used in code that aims to be portable.\n\nflock(fd, op)\n\nPerforms a lock operation, op, on the file descriptor fd. opis the bitwise OR of the following constants, which are found in fnctl:\n\nItem LOCK_EX\n\nLOCK_NB\n\nLOCK_SH\n\nDescription Exclusive lock. All further attempts to acquire the lock will block until the lock is released. Non-blocking mode. Returns immediately with an IOError if the lock is already in use. Shared lock. Blocks any attempts to acquire an exclusive lock (LOCK_EX), but shared locks can still be acquired. Unlock. Releases any previous held lock.\n\nLOCK_UN\n\nIn nonblocking mode, an IOError exception is raised if the lock cannot be acquired. On some systems, the process of opening and locking a file can be performed in a sin- gle operation by adding special flags to the os.open() operation. Consult the os mod- ule for more details.\n\nlockf(fd, op [, len [, start [, whence]]])\n\nPerforms record or range locking on part of a file. opis the same as for the flock() function. lenis the number of bytes to lock. startis the starting position of the lock relative to the value of whence. whenceis 0 for the beginning of the file, 1 for the cur- rent position, and 2 for the end of the file.\n\nExample\n\nimport fcntl\n\n# Open a file f = open(\"foo\",\"w\")\n\n# Set the close-on-exec bit for a file object f fcntl.fcntl(f.fileno(), fcntl.F_SETFD, 1)\n\n# Lock a file (blocking) fcntl.flock(f.fileno(), fcntl.LOCK_EX)\n\nF h Lib f L Bdff",
      "content_length": 2175,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 374,
      "content": "io\n\n349\n\n# Lock the first 8192 bytes of a file (non-blocking) try:\n\nfcntl.lockf(f.fileno(), fcntl.LOCK_EX | fcntl.LOCK_NB, 8192, 0, 0)\n\nexcept IOError,e:\n\nprint \"Unable to acquire lock\", e\n\nNotes\n\nn The set of available fcntl() commands and options is system-dependent.The\n\nfcntl module may contain more than 100 constants on some platforms. n Although locking operations defined in other modules often make use of the\n\ncontext-manager protocol, this is not the case for file locking. If you acquire a file lock, make sure your code is written to properly release the lock.\n\nn Many of the functions in this module can also be applied to the file descriptors of\n\nsockets.\n\nio The io module implements classes for various forms of I/O as well as the built-in open() function that is used in Python 3.The module is also available for use in Python 2.6.\n\nThe central problem addressed by the io module is the seamless handling of differ- ent forms of basic I/O. For example, working with text is slightly different than work- ing with binary data because of issues related to newlines and character encodings.To handle these differences, the module is built as a series of layers, each of which adds more functionality to the last.\n\nBase I/O Interface The io module defines a basic I/O programming interface that all file-like objects implement.This interface is defined by a base class IOBase.An instance fof IOBase supports these basic operations:\n\nAttribute f.closed\n\nf.close()\n\nf.fileno()\n\nf.flush()\n\nf.isatty()\n\nf.readable()\n\nf.readline([limit])\n\nf.readlines([limit])\n\nDescription Flag indicating whether or not the file is closed. Closes the file. Returns the integer file descriptor. Flushes the I/O buffers (if any). Returns True if fis a terminal. Returns True if fwas opened for reading. Reads one line from the stream. limitis the maxi- mum number of bytes to read. Reads all lines from fand return as a list. limit, if provided, is the maximum number of bytes that can be read before stopping. The actual number of bytes read will be slightly greater to accommodate the last line, which is kept intact.\n\nF h Lib f L Bdff",
      "content_length": 2128,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 375,
      "content": "350\n\nChapter 19 Operating System Services\n\nAttribute f.seek(offset, [whence]) Moves the file pointer to a new position relative to the location specified in whence. offsetis the number of bytes. whenceis 0 for the start of the file, 1 for the current position, and 2 for the end of the file. Returns True if fis seekable. Returns the current value of the file pointer. Truncates the file size so that it is at most sizebytes. If sizeisn’t given, it truncates the file to 0 bytes. Returns True if fwas opened for writing. Writes a sequence of lines to f. Line endings are not added so they must already be part of each line.\n\nDescription\n\nf.seekable()\n\nf.tell()\n\nf.truncate([size])\n\nf.writable()\n\nf.writelines(lines)\n\nRaw I/O The lowest level of the I/O system is related to direct I/O involving raw bytes.The core object for this is FileIO, which provides a fairly direct interface to low-level sys- tem calls such as read() and write().\n\nFileIO(name [, mode [, closefd]])\n\nA class for performing raw low-level I/O on a file or system file descriptor. nameis either a filename or an integer file descriptor such as that returned by the os.open() function or the fileno() method of other file objects. modeis one of 'r' (the default); 'w'; or 'a' for reading, writing, or appending.A '+’ can be added to the mode for update mode in which both reading and writing is supported. closefdis a flag that determines if the close() method actually closes the underlying file. By default, this is True, but it can be set False if you’re using FileIO to put a wrapper around a file that was already opened elsewhere. If a filename was given, the resulting file object is opened directly using the operating system’s open() call.There is no internal buffering, and all data is processed as raw byte strings.An instance fof FileIO has all of the basic I/O operations described earlier plus the following attributes and methods:\n\nAttribute f.closefd\n\nf.mode\n\nf.name\n\nf.read([size])\n\nf.readall()\n\nf.write(bytes)\n\nDescription Flag that determines if the underlying file descriptor will be closed on f.close() (read-only). File mode used when opening (read-only). filename (read-only). Reads at most sizebytes using a single system call. If size is omitted, as much data as possible is returned using f.readall(). This operation may returns fewer bytes than requested so you must use len() to check. None is returned if no data is available in non-blocking mode. Reads as much data as is available and returns as a single byte string. An empty string is returned on EOF. In non-blocking mode, only as much data as is immediately available is returned. Writes a byte string or byte-array to fusing a single system call. The number of bytes actually written is returned—which may be less than the number supplied in bytes.\n\nF h Lib f L Bdff",
      "content_length": 2822,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 376,
      "content": "io\n\n351\n\nIt is important to emphasize that FileIO objects are extremely low-level, providing a rather thin layer over operating system calls such as read() and write(). Specifically, users of this object will need to diligently check return codes as there is no guarantee that the f.read() or f.write() operations will read or write all of the requested data. The fcntl module can be used to change low-level aspects of files such as file locking, blocking behavior, and so forth.\n\nFileIO objects should not be used for line-oriented data such as text.Although methods such as f.readline() and f.readlines() are defined, these come from the IOBase base class where they are both implemented entirely in Python and work by issuing f.read() operations for a single byte at a time. Needless to say, the resulting performance is horrible. For example, using f.readline() on a FileIO object fis more than 750 times slower than using f.readline() on a standard file object created by the open() function in Python 2.6.\n\nBuffered Binary I/O The buffered I/O layer contains a collection of file objects that read and write raw binary data, but with in-memory buffering.As input, these objects all require a file object that implements raw I/O such as the FileIO object in the previous section.All of the classes in this section inherit from BufferedIOBase.\n\nBufferedReader(raw [, buffer_size])\n\nA class for buffered binary reading on a raw file specified in raw. buffer_sizespecifies the buffer size to use in bytes. If omitted, the value of DEFAULT_BUFFER_SIZE is used (8,192 bytes as of this writing).An instance fof BufferedReader supports all of the operations provided on IOBase in addition to these operations:\n\nMethod f.peek([n])\n\nf.read([n])\n\nf.read1([n])\n\nf.readinto(b)\n\nDescription Returns at most nbytes of data from the I/O buffer without mov- ing the file pointer. If nis omitted, a single byte is returned. If necessary, a read operation will be issued to fill the buffer if it is currently empty. This operation never returns more bytes than the current buffer size, so the result may be smaller than the request- ed number of bytes in n. Reads nbytes and returns as a byte string. If nis omitted, all available data (up to EOF) is read and returned. If the underlying file is non-blocking, any available data is read and returned. If a non-blocking file is read and no data is available, a BlockingIOError exception is raised. Reads up to nbytes and returns as a byte string using a single system call. If any data is already loaded in the buffer, it is simply returned. Otherwise, a single read() is made on the raw file to return data. Unlike f.read(), this operation may return less data than requested even if the underlying file is not at EOF. Reads len(b) bytes of data from the file into an existing bytearray object b. The actual number of bytes read is returned. If the underlying file is in non-blocking mode, a BlockingIOError exception is raised if no data is available.\n\nF h Lib f L Bdff",
      "content_length": 3008,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 377,
      "content": "352\n\nChapter 19 Operating System Services\n\nBufferedWriter(raw [, buffer_size [, max_buffer_size]])\n\nA class for buffered binary writing on a raw file specified in raw. buffer_sizespecifies the number of bytes that can be saved in the buffer before data is flushed to the under- lying I/O stream.The default value is DEFAULT_BUFFER_SIZE. max_buffer_size specifies the maximum buffer size to use for storing output data that is being written to a non-blocking stream and defaults to twice the value of buffer_size.This value is larger to allow for continued writing while the previous buffer contents are written to the I/O stream by the operating system.An instance fof BufferedWriter supports the following operations:\n\nMethod f.flush()\n\nf.write(bytes)\n\nDescription Writes all bytes stored in the buffer to the underlying I/O stream. Raises a BlockingIOError exception if the file is in non- blocking mode and the operation would block (e.g., if the stream can’t accept any new data at the moment). Writes the bytes in bytesto the I/O stream and returns the number of bytes actually written. If the underlying stream is non- blocking, a BlockingIOError exception is raised if write opera- tion would block.\n\nBufferedRWPair(reader, writer [, buffer_size [, max_buffer_size]])\n\nA class for buffered binary reading and writing on a pair of raw I/O streams. readeris a raw file that supports reading, and writingis a raw file that supports writing.These files may be different, which may be useful for certain kinds of communication involv- ing pipes and sockets.The buffer size parameters have the same meaning as for BufferedWriter.An instance fof BufferedRWPair supports all of the operations for BufferedReader and BufferedWriter.\n\nBufferedRandom(raw [, buffer_size [, max_buffer_size]])\n\nA class for buffered binary reading and writing on a raw I/O stream that supports ran- dom access (e.g., seeking). rawmust be a raw file that supports both read, write, and seek operations.The buffer size parameters have the same meaning as for BufferedWriter.An instance fof BufferedRandom supports all of the operations for BufferedReader and BufferedWriter.\n\nBytesIO([bytes])\n\nAn in-memory file that implements the functionality of a buffered I/O stream. bytesis a byte string that specifies the initial contents of the file.An instance bof BytesIO sup- ports all of the operations of BufferedReader and BufferedWriter objects. In addi- tion, a method b.getvalue() can be used to return the current contents of the file as a byte string.\n\nAs with FileIO objects, all the file objects in this section should not be used with\n\nline-oriented data such as text.Although it’s not quite as bad due to buffering, the resulting performance is still quite poor (e.g., more than 50 times slower than reading lines with files created using the Python 2.6 built-in open() function).Also, because of internal buffering, you need to take care to manage flush() operations when writing. For example, if you use f.seek() to move the file pointer to a new location, you should first use f.flush() to flush any previously written data (if any).\n\nF h Lib f L Bdff",
      "content_length": 3136,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 378,
      "content": "io\n\n353\n\nAlso, be aware that the buffer size parameters only specify a limit at which writes occur and do not necessarily set a limit on internal resource use. For example, when you do a f.write(data) on a buffered file f, all of the bytes in dataare first copied into the internal buffers. If datarepresents a very large byte array, this copying will substan- tially increase the memory use of your program.Thus, it is better to write large amounts of data in reasonably sized chunks, not all at once with a single write() operation. It should be noted that because the io module is relatively new, this behavior might be different in future versions.\n\nText I/O The text I/O layer is used to process line-oriented character data.The classes defined in this section build upon buffered I/O streams and add line-oriented processing as well as Unicode character encoding and decoding.All of the classes here inherit from TextIOBase.\n\nTextIOWrapper(buffered [, encoding [, errors [, newline [, line_buffering]]]])\n\nA class for a buffered text stream. bufferedis a buffered I/O as described in the previ- ous section. encodingis a string such as 'ascii' or 'utf-8' that specifies the text encoding. errorsspecifies the Unicode error-handling policy and is 'strict' by default (see Chapter 9,“Input and Output,” for a description). newlineis the character sequence representing a newline and may be None, '', '\\n', '\\r', or '\\r\\n'. If None is given, then universal newline mode is enabled in which any of the other line endings are translated into '\\n' when reading and os.linesep is used as the newline on out- put. If newlineis one of the other values, then all '\\n' characters are translated into the specified newline on output. line_bufferingis a flag that controls whether or not a flush() operation is performed when any write operation contains the newline char- acter. By default, this is False.An instance fof TextIOWrapper supports all of the operations defined on IOBase as well as the following:\n\nMethod f.encoding\n\nf.errors\n\nf.line_buffering\n\nf.newlines\n\nf.read([n])\n\nf.readline([limit])\n\nf.write(s)\n\nDescription The name of the text encoding being used. Encoding and decoding error handling policy. Flag that determines line buffering behavior. None, a string, or a tuple giving all of the different forms of newlines translated. Reads at most ncharacters from the underlying stream and returns as a string. If nis omitted, then this reads all avail- able data to the end of file. Returns the empty string at EOF. The returned strings are decoded according to the encoding setting in f.encoding. Reads a single line of text and returns as a string. Returns an empty string at EOF. limitis the maximum number of bytes to read. Writes string sto the underlying stream using the text encoding in f.encoding.\n\nStringIO([initial [, encoding [, errors [, newline]]]])\n\nAn in-memory file object with the same behavior as a TextIOWrapper. initialis a string that specifies the initial contents of the file.The other parameters have the same\n\nF h Lib f L Bdff",
      "content_length": 3060,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 379,
      "content": "354\n\nChapter 19 Operating System Services\n\nmeaning as with TextIOWrapper.An instance sof StringIO supports all of the usual file operations, in addition to a method s.getvalue() that returns the current con- tents of the memory buffer.\n\nThe open() Function The io module defines the following open() function, which is the same as the built- in open() function in Python 3.\n\nopen(file [, mode [, buffering [, encoding [, errors [, newline [, closefd]]]]]])\n\nOpens fileand returns an appropriate I/O object. fileis either a string specifying the name of a file or an integer file descriptor for an I/O stream that has already been opened.The result of this function is one of the I/O classes defined in the io module depending on the settings of modeand buffering. If modeis any of the text modes such as 'r', 'w', 'a', or 'U', then an instance of TextIOWrapper is returned. If mode is a binary mode such as 'rb' or 'wb', then the result depends on the setting of buffering. If bufferingis 0, then an instance of FileIO is returned for performing raw unbuffered I/O. If bufferingis any other value, then an instance of BufferReader, BufferedWriter, or BufferedRandom is returned depending on the file mode.The encoding, errors, and errorsparameters are only applicable to files opened in text mode and passed to the TextIOWrapper constructor.The closefdis only applicable if fileis an integer descriptor and is passed to the FileIO constructor.\n\nAbstract Base Classes The io module defines the following abstract base classes that can be used for type checking and defining new I/O classes:\n\nAbstract Class IOBase\n\nRawIOBase\n\nBufferedIOBase\n\nTextIOBase\n\nDescription Base class for all I/O classes. Base class for objects that support raw binary I/O. Inherits from IOBase. Base class for objects that support buffered binary I/O. Inherits from IOBase. Base class for objects that support text streams. Inherits from IOBase.\n\nIt is rare for most programmers to work with these classes directly.You should refer to the online documentation for details concerning their use and definition.\n\nNote\n\nThe io module is a new addition to Python, first appearing in Python 3 and backported to Python 2.6. As of this writing, the module is immature and has extremely poor run- time performance—especially for any application that involves heavy amounts of text I/O. If you are using Python 2, you will be better served by the built-in open() function than using the I/O classes defined in the io module. If you are using Python 3, there seems to be no other alternative. Although performance improvements are likely in future releases, this layered approach to I/O coupled with Unicode decoding is unlikely to match the raw I/O performance found in the C standard library, which is the basis for I/O in Python 2.\n\nF h Lib f L Bdff",
      "content_length": 2817,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 380,
      "content": "logging\n\n355\n\nlogging The logging module provides a flexible facility for applications to log events, errors, warnings, and debugging information.This information can be collected, filtered, writ- ten to files, sent to the system log, and even sent over the network to remote machines. This section covers the essential details of using this module for most common cases.\n\nLogging Levels The main focus of the logging module concerns the issuing and handling of log mes- sages. Each message consists of some text along with an associated level that indicates its severity. Levels have both a symbolic name and numerical value as follows:\n\nLevel CRITICAL\n\nERROR\n\nWARNING\n\nINFO\n\nDEBUG\n\nNOTSET\n\nValue 50\n\n40\n\n30\n\n20\n\n10\n\n0\n\nDescription Critical errors/messages Errors Warning messages Informative messages Debugging No level set\n\nThese different levels are the basis for various functions and methods throughout the logging module. For example, there are methods to issue log messages at each level as well as filters that work by blocking messages that don’t meet a certain threshold value.\n\nBasic Configuration Before using any other functions in the logging module, you should first perform some basic configuration of a special object known as the root logger.The root logger is responsible for managing the default behavior of log messages including the logging level, output destination, message format, and other basic details.The following function is used for configuration:\n\nbasicConfig([**kwargs])\n\nPerforms basic configuration of the root logger.This function should be called before any other logging calls are made.The function accepts a number of keyword arguments:\n\nKeyword Argument Description filename\n\nAppends log messages to a file with the given filename. Specifies the mode used to open the file. By default, mode 'a' (append) is used. Format string used to produce log messages. Format string used to output dates and times. Sets the level of the root logger. All log messages with a level equal to or above this level will be processed. Lower-level mes- sages will be silently ignored. Provides an open file to which log messages are sent. The default stream is sys.stderr. This parameter may not be used simultaneously with the filename parameter.\n\nfilemode\n\nformat datefmt level\n\nstream\n\nF h Lib f L Bdff",
      "content_length": 2327,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 381,
      "content": "356\n\nChapter 19 Operating System Services\n\nMost of these parameters are self-explanatory.The formatargument is used to specify the format of log messages along with optional contextual information such as file- names, levels, line numbers, and so forth. datefmtis a date format string compatible with the time.strftime() function. If omitted, the date format is set to the ISO8601 format.\n\nThe following expansions are recognized in format:\n\nFormat %(name)s\n\n%(levelno)s\n\n%(levelname)s\n\n%(pathname)s\n\n%(filename)s\n\n%(funcName)s\n\n%(module)s\n\n%(lineno)d\n\n%(created)f\n\n%(asctime)s\n\n%(msecs)s\n\nDescription Name of the logger. Numeric logging level. Text name of the logging level. Pathname of the source file where the logging call was executed. filename of the source file where the logging call was executed. Function name in which the logging call was made. Module name where the logging call executed. Line number where the logging call executed. Time when the logging call executed. The value is a number as returned by time.time(). ASCII-formatted date and time when the logging call was executed. Millisecond portion of the time when the logging call executed. Thread ID.\n\n%(thread)d %(threadName)s Thread name. %(process)d\n\nProcess ID. The logged message (supplied by user).\n\n%(message)s\n\nHere is an example that illustrates a single configuration where log messages with a level of INFO or higher are appended to a file:\n\nimport logging logging.basicConfig(\n\nfilename = \"app.log\", format = \"%(levelname)-10s %(asctime)s %(message)s\" level = logging.INFO\n\n)\n\nWith this configuration, a CRITICAL log message of 'Hello World' will appear as fol- lows in the log file 'app.log'.\n\nCRITICAL 2005-10-25 20:46:57,126 Hello World\n\nLogger Objects In order to issue log messages, you have to obtain a Logger object.This section describes the process of creating, configuring, and using these objects.\n\nCreating a Logger To create a new Logger object, you use the following function:\n\ngetLogger([logname])\n\nReturns a Logger instance associated with the name logname. If no such object exists, a new Logger instance is created and returned. lognameis a string that specifies a name\n\nF h Lib f L Bdff",
      "content_length": 2191,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 382,
      "content": "logging\n\n357\n\nor series of names separated by periods (for example 'app' or 'app.net'). If you omit logname, you will get the Logger object associated with the root logger.\n\nThe creation of Logger instances is different than what you find in most other library modules.When you create a Logger, you always give it a name which is passed to getLogger() as the lognameparameter. Internally, getLogger() keeps a cache of the Logger instances along with their associated names. If another part of the program requests a logger with the same name, the previously created instance is returned.This arrangement greatly simplifies the handling of log messages in large applications because you don’t have to figure out how to pass Logger instances around between different program modules. Instead, in each module where you want logging, you just use getLogger() to get a reference to the appropriate Logger object.\n\nPicking Names For reasons that will become clear later, you should always pick meaningful names when using getLogger(). For example, if your application is called 'app', then you should minimally use getLogger('app') at the top of every program module that makes up the application. For example:\n\nimport logging log = logging.getLogger('app')\n\nYou might also consider adding the module name to the logger such as getLogger('app.net') or getLogger('app.user') in order to more clearly indi- cate the source of log messages.This can be done using statements such as this:\n\nimport logging log = logging.getLogger('app.'+__name__)\n\nAdding the module name makes it easier to selectively turn off or reconfigure the log- ging for specific program modules as will be described later.\n\nIssuing Log Messages If logis an instance of a Logger object (created using the getLogger() function in the previous section), the following methods are used to issue log messages at the differ- ent logging levels:\n\nLogging Level CRITICAL\n\nMethod log.critical(fmt [, *args [, exc_info [, extra]]])\n\nERROR\n\nlog.error(fmt [, *args [, exc_info [, extra]]])\n\nWARNING\n\nlog.warning(fmt [, *args [, exc_info [, extra]]])\n\nINFO\n\nlog.info(fmt [, *args [, exc_info [, extra]]])\n\nDEBUG\n\nlog.debug(fmt [, *args [, exc_info [, extra]]])\n\nThe fmtargument is a format string that specifies the format of the log message.Any remaining arguments in argsserve as arguments for format specifiers in the format string.The string formatting operator % is used to form the resulting message from these arguments. If multiple arguments are provided, they are placed into a tuple for format- ting. If a single argument is provided, it is placed directly after the % when formatting.\n\nF h Lib f L Bdff",
      "content_length": 2663,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 383,
      "content": "358\n\nChapter 19 Operating System Services\n\nThus, if you pass a single dictionary as an argument, the format string can include dic- tionary key names. Here are a few examples that illustrate how this works:\n\nlog = logging.getLogger(\"app\") # A log message using positional formatting log.critical(\"Can't connect to %s at port %d\", host, port)\n\n# A log message using dictionary formatting parms = {\n\n'host' : 'www.python.org', 'port' : 80\n\n} log.critical(\"Can't connect to %(host)s at port %(port)d\", parms)\n\nThe keyword argument exc_info, if set to True, adds exception information from sys.exc_info() to the log message. If exc_infois set to an exception tuple such as that returned by sys.exc_info(), then that information is used.The extrakeyword argument is a dictionary that supplies additional values for use in log message format strings (described later). Both exc_infoand extramust be specified as keyword argu- ments.\n\nWhen issuing log messages, you should avoid code that carries out string formatting\n\nat the time the message is issued (that is, formatting a message and then passing the result into the logging module). For example,\n\nlog.critical(\"Can't connect to %s at port %d\" % (host, port))\n\nIn this example, the string formatting operation always occurs before the call to log.critical() because the arguments to a function or method have to be fully eval- uated. However, in the example at the top of the page, the parameters used for string formatting operation are merely passed to the logging module and used only if the log message is actually going to be handled.This is a very subtle distinction, but because many applications choose to filter log messages or only emit logs during debugging, the first approach performs less work and runs faster when logging is disabled.\n\nIn addition to the methods shown, there are a few additional methods for issuing log\n\nmessages on a Logger instance log.\n\nlog.exception(fmt [, *args ])\n\nIssues a message at the ERROR level but adds exception information from the current exception being handled.This can only be used inside except blocks.\n\nlog.log(level, fmt [, *args [, exc_info [, extra]]])\n\nIssues a logging message at the level specified by level.This can be used if the logging level is determined by a variable or if you want to have additional logging levels not covered by the five basic levels.\n\nlog.findCaller()\n\nReturns a tuple (filename, lineno, funcname) corresponding to the caller’s source filename, line number, and function name.This information is sometimes useful when issuing log messages—for example, if you want to add information about the location of the logging call to a message.\n\nF h Lib f L Bdff",
      "content_length": 2688,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 384,
      "content": "logging\n\n359\n\nFiltering Log Messages Each Logger object loghas an internal level and filtering mechanism that determines which log messages get handled.The following two methods are used to perform sim- ple filtering based on the numeric level of log messages:\n\nlog.setLevel(level)\n\nSets the level of log. Only logging messages with a level greater than or equal to levelwill be handled.All other messages are simply ignored. By default, the level is logging.NOTSET which processes all log messages.\n\nlog.isEnabledFor(level)\n\nReturns True if a logging message at level levelwould be processed.\n\nLogging messages can also be filtered based on information associated with the mes- sage itself—for example, the filename, the line number, and other details.The following methods are used for this:\n\nlog.addFilter(filt)\n\nAdds a filter object, filt, to the logger.\n\nlog.removeFilter(filt)\n\nRemoves a filter object, filt, from the logger.\n\nIn both methods, filtis an instance of a Filter object.\n\nFilter(logname)\n\nCreates a filter that only allows log messages from lognameor its children to pass through. For example, if lognameis 'app', then messages from loggers such as 'app', 'app.net', or 'app.user' will pass, but messages from a logger such as 'spam' will not.\n\nCustom filters can be created by subclassing Filter and implementing the method\n\nfilter(record) that receives as input a record containing information about a log- ging message.As output, True or False is returned depending on whether or not the message should be handled.The recordobject passed to this method typically has the following attributes:\n\nAttribute record.name\n\nrecord.levelname\n\nrecord.levelno\n\nrecord.pathname\n\nrecord.filename\n\nrecord.module\n\nrecord.exc_info\n\nrecord.lineno\n\nrecord.funcName\n\nrecord.created\n\nrecord.thread\n\nrecord.threadName\n\nDescription Logger name Level name Level number Pathname of the module Base filename Module name Exception information Line number where log message was issued Function name where log message was issued Time at which issued Thread identifier Thread name PID of currently executing process\n\nrecord.process\n\nF h Lib f L Bdff",
      "content_length": 2142,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 385,
      "content": "360\n\nChapter 19 Operating System Services\n\nThe following example illustrates how you create a custom filter:\n\nclass FilterFunc(logging.Filter): def __init__(self,name): self.funcName = name\n\ndef filter(self, record):\n\nif record.funcName == self.funcName: return False else: return True\n\nlog.addFilter(FilterFunc('foo')) # Ignore all messages originating from foo() log.addFilter(FilterFunc('bar')) # Ignore all messages originating from bar()\n\nMessage Propagation and Hierarchical Loggers In advanced logging applications, Logger objects can be organized into a hierarchy.This is done by giving a logger object a name such as 'app.net.client'. Here, there are actually three different Logger objects called 'app', 'app.net', and 'app.net.client'.When a message is issued on any of the loggers and it successfully passes that logger’s filter, it propagates to and is handled by all of the parents. For exam- ple, a message successfully issued on 'app.net.client' also propagates to 'app.net', 'app' and the root logger.\n\nThe following attributes and methods of a Logger object logcontrol this propaga-\n\ntion.\n\nlog.propagate\n\nA Boolean flag that indicates whether or not messages propagate to the parent logger. By default, this is set to True.\n\nlog.getEffectiveLevel()\n\nReturns the effective level of the logger. If a level has been set using setLevel(), that level is returned. If no level has been explicitly set (the level is logging.NOTSET in this case), this function returns the effective level of the parent logger instead. If none of the parent loggers have a level set, the effective level of the root logger will be returned. The primary purpose of hierarchical logging is to be able to more easily filter log\n\nmessages originating from different parts of a large application. For example, if you wanted to shut down log messages from the 'app.net.client' part of an application, you might add configuration code such as the following:\n\nimport logging logging.getLogger('app.net.client').propagate = False\n\nOr, in this code, we’re ignoring all but the most severe messages from a program module:\n\nimport logging logging.getLogger('app.net.client').setLevel(logging.CRITICAL)\n\nA subtle aspect of hierarchical loggers is that the decision to handle a log message is made entirely by the level and filters on the Logger object on which the message was issued, not by the filters on any of the parents.Thus, if a message passes the first set of filters, it is propagated to and handled by all the parent loggers regardless of their own fil- ter and level settings—even if these filters would have rejected the message.At first glance, the behavior is counterintuitive and might even seem like a bug. However, set- ting the level of a child logger to a value that is lower than its parent is one way to\n\nF h Lib f L Bdff",
      "content_length": 2824,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 386,
      "content": "logging\n\n361\n\noverride the settings on the parent, achieving a kind of level promotion. Here is an example:\n\nimport logging\n\n# The top-level logger 'app'. log = logging.getLogger('app') log.setLevel(logging.CRITICAL) # Only accept CRITICAL level messages.\n\n# A child logger 'app.net' net_log = logging.getLogger('app.net') net_log.setLevel(logging.ERROR) # Accept ERROR messages on 'app.net'.\n\n# These messages will now be handled by the # 'app' logger even though its level is # CRITICAL.\n\nWhen using hierarchical loggers, you only have to configure the logging objects where you want to change the filtering or propagation behavior. Because messages naturally propagate to the root logger, it will ultimately be responsible for producing the output and any configuration that you made using basicConfig() will apply.\n\nMessage Handling Normally, messages are handled by the root logger. However, any Logger object can have special handlers added to it that receive and process log messages.This is done using these methods of a Logger instance log.\n\nlog.addHandler(handler)\n\nAdds a Handler object to the logger.\n\nlog.removeHandler(handler)\n\nRemoves the Handler object handlerfrom the logger.\n\nThe logging module has a variety of pre-built handlers for writing log messages to files, streams, system logs, and so forth.These are described in further detail in the next section. However, the following example shows how loggers and handlers are hooked together using these methods.\n\nimport logging import sys\n\n# Create a top-level logger called 'app' app_log = logging.getLogger(\"app\") app_log.setLevel(logging.INFO) app_log.propagate = False\n\n# Add some message handlers to the 'app' log app_log.addHandler(logging.FileHandler('app.log')) app_log.addHandler(logging.StreamHandler(sys.stderr))\n\n# Issue some messages. These go to app.log and sys.stderr app_log.critical(\"Creeping death detected!\") app_log.info(\"FYI\")\n\nWhen you add your own handlers to process messages, it is often your intent to over- ride the behavior of the root logger.This is why message propagation is disabled in the previous example (i.e., the 'app' logger is simply going to handle all of the messages).\n\nF h Lib f L Bdff",
      "content_length": 2197,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 387,
      "content": "362\n\nChapter 19 Operating System Services\n\nHandler Objects The logging module provides a collection of pre-built handlers that can process log messages in various in ways.These handlers are added to Logger objects using their addHandler() method. In addition, each handler can be configured with its own filter- ing and levels.\n\nBuilt-In Handlers The following handler objects are built-in. Some of these handlers are defined in a sub- module logging.handlers, which must be imported specifically if necessary.\n\nhandlers.DatagramHandler(host,port)\n\nSends log messages to a UDP server located on the given hostand port. Log messages are encoded by taking the dictionary of the corresponding LogRecord object and encoding it using the pickle module.The transmitted network message consists of a 4- byte network order (big-endian) length followed by the pickled record data.To recon- struct the message, the receiver must strip the length header, read the entire message, unpickle the contents, and call logging.makeLogRecord(). Because UDP is unreli- able, network errors may result in lost log messages.\n\nFileHandler(filename [, mode [, encoding [, delay]]])\n\nWrites log messages to the file filename. modeis the file mode to use when opening the file and defaults to 'a'. encodingis the file encoding. delayis a Boolean flag that, if set True, defers the opening of the log file until the first log message is issued. By default, it is False.\n\nhandlers.HTTPHandler(host, url [, method])\n\nUploads log messages to an HTTP server using HTTP GET or POST methods. host specifies the host machine, urlis the URL to use, and methodis either 'GET' (the default) or 'POST'.The log message is encoded by taking the dictionary of the corre- sponding LogRecord object and encoding it as a set of URL query-string variables using the urllib.urlencode() function.\n\nhandlers.MemoryHandler(capacity [, flushLevel [, target]])\n\nThis handler is used to collect log messages in memory and to flush them to another handler, target, periodically. capacityis the size of the memory buffer in bytes. flushLevelis a numeric logging level that forces a memory flush should a logging message of that level or higher appear.The default value is ERROR. targetis another Handler object that receives the messages. If targetis omitted, you will need to set a target using the setTarget() method of the resulting handler object in order for this handler to do anything.\n\nhandlers.NTEventLogHandler(appname [, dllname [, logtype]])\n\nSends messages to the event log on Windows NT,Windows 2000, or Windows XP. appnameis the name of the application name to use in the event log. dllnameis a full path name to a .DLL or .EXE file that provides message definitions to hold in the log. If omitted, dllname is set to 'win32service.pyd'. logtype is either 'Application', 'System', or 'Security'.The default value is 'Application'.This handler is only available if Win32 extensions for Python have been installed.\n\nF h Lib f L Bdff",
      "content_length": 2990,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 388,
      "content": "logging\n\n363\n\nhandlers.RotatingFileHandler(filename [, mode [, maxBytes [, backupCount [, encoding [, delay]]]]])\n\nWrites log messages to the file filename. However, if the file exceeds the size specified by maxBytes, the file is rotated to filename.1 and a new log file, filename, is opened. backupCountspecifies the maximum number of backup files to create. By default, the value of backupCountis 0. However, when specified, backup files are rotat- ed through the sequence filename.1, filename.2, … ,filename.N, where filename.1 is always the most recent backup and filename.Nis always the oldest backup. modespecifies the file mode to use when opening the log file.The default mode is 'a'. If maxBytesis 0 (the default), the log file is never rolled over and is allowed to grow indefinitely. encodingand delayhave the same meaning as with FileHandler.\n\nhandlers.SMTPHandler(mailhost, fromaddr, toaddrs, subject [, credentials])\n\nSends log messages to a remote host using email. mailhostis the address of an SMTP server that can receive the message.The address can be a simple host name specified as a string or a tuple (host, port). fromaddris the from address, toaddrsis the destina- tion address, and subjectis the subject to use in the message. credentialsis a tuple (username, password) with the username and password.\n\nhandlers.SocketHandler(host, port)\n\nSends log messages to a remote host using a TCP socket connection. hostand port specify the destination. Messages are sent in the same format as described for DatagramHandler. Unlike DatagramHandler, this handler reliably delivers log mes- sages.\n\nStreamHandler([fileobj])\n\nWrites log messages to an already open file-like object, fileobj. If no argument is pro- vided, messages are written to sys.stderr.\n\nhandlers.SysLogHandler([address [, facility]])\n\nSends log messages to a UNIX system logging daemon. addressspecifies the destina- tion as a (host, port) tuple. If omitted, a destination of ('localhost', 514) is used. facilityis an integer facility code and is set to SysLogHandler.LOG_USER by default.A full list of facility codes can be found in the definition of SysLogHandler.\n\nhandlers.TimedRotatingFileHandler(filename [, when [, interval [, backupCount [, encoding [, delay [, utc]]]]]])\n\nThe same as RotatingFileHandler, but the rotation of files is controlled by time instead of file size. intervalis a number, and whenis a string that specifies units. Possible values for whenare 'S' (seconds), 'M' (minutes), 'H' (hours), 'D' (days), 'W' (weeks), and 'midnight' (roll over at midnight). For example, setting intervalto 3 and whento 'D' rolls the log every three days. backupCountspecifies the maximum number of backup files to keep. utcis a Boolean flag that determines whether or not to use local time (the default) or UTC time.\n\nhandlers.WatchedFileHandler(filename [, mode [, encoding [, delay]]])\n\nThe same as FileHandler, but the inode and device of the opened log file is moni- tored. If it changes since the last log message was issued, the file is closed and reopened\n\nF h Lib f L Bdff",
      "content_length": 3073,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 389,
      "content": "364\n\nChapter 19 Operating System Services\n\nagain using the same filename.These changes might occur if a log file has been deleted or moved as a result of a log rotation operation carried out externally to the running program.This handler only works on UNIX systems.\n\nHandler Configuration Each Handler object hcan be configured with its own level and filtering.The follow- ing methods are used to do this:\n\nh.setLevel(level)\n\nSets the threshold of messages to be handled. levelis a numeric code such as ERROR or CRITICAL.\n\nh.addFilter(filt)\n\nAdds a Filter object, filt, to the handler. See the addFilter() method of Logger objects for more information.\n\nh.removeFilter(filt)\n\nRemoves a Filter object, filt, from the handler.\n\nIt is important to stress that levels and filters can be set on handlers independently from any settings used on the Logger objects to which handlers are attached. Here is an example that illustrates this:\n\nimport logging import sys\n\n# Create a handler that prints CRITICAL level messages to stderr crit_hand = logging.StreamHandler(sys.stderr) crit_hand.setLevel(logging.CRITICAL)\n\n# Create a top-level logger called 'app' app_log = logging.getLogger(\"app\") app_log.setLevel(logging.INFO) app_log.addHandler(logging.FileHandler('app.log')) app_log.addHandler(crit_handler)\n\nIn this example, there is a single logger called 'app’ with a level of INFO.Two handlers are attached to it, but one of the handlers (crit_handler) has its own level setting of CRITICAL.Although this handler will receive log messages with a level of INFO or higher, it selectively discards those that are not CRITICAL.\n\nHandler Cleanup The following methods are used on handlers to perform cleanup.\n\nh.flush()\n\nFlushes all logging output.\n\nh.close()\n\nCloses the handler.\n\nMessage Formatting By default, Handler objects emit log messages exactly as they are formatted in logging calls. However, sometimes you want to add additional contextual information to the messages such as timestamps, filenames, line numbers, and so forth.This section\n\nF h Lib f L Bdff",
      "content_length": 2059,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 390,
      "content": "logging\n\n365\n\ndescribes how this extra information can be automatically added to log messages.\n\nFormatter Objects To change the log message format, you must first create a Formatter object:\n\nFormatter([fmt [, datefmt]])\n\nCreates a new Formatter object. fmtprovides a format string for messages.Within fmt, you can place various expansions as previously described for the basicConfig() function. datefmtis a date format string compatible with the time.strftime() func- tion. If omitted, the date format is set to the ISO8601 format.\n\nTo take effect, Formatter objects must be attached to handler objects.This is done\n\nusing the h.setFormatter() method of a Handler instance h.\n\nh.setFormatter(format)\n\nSets the message formatter object used to create log messages on the Handler instance h. formatmust be an instance of Formatter.\n\nHere is an example that illustrates how to customize the log message format on a\n\nhandler:\n\nimport logging import sys\n\n# Set the message format format = logging.Formatter(\"%(levelname)-10s %(asctime)s %(message)s\")\n\n# Create a handler that prints CRITICAL level messages to stderr crit_hand = logging.StreamHandler(sys.stderr) crit_hand.setLevel(logging.CRITICAL) crit_hand.setFormatter(format)\n\nIn this example, a custom Formatter is set on the crit_hand handler. If a logging message such as \"Creeping death detected.\" is processed by this handler, the fol- lowing log message is produced:\n\nCRITICAL 2005-10-25 20:46:57,126 Creeping death detected.\n\nAdding Extra Context to Messages In certain applications, it is useful to add additional context information to log mes- sages.This extra information can be provided in one of two ways. First, all of the basic logging operations (e.g., log.critical(), log.warning(), etc.) have a keyword parameter extra that is used to supply a dictionary of additional fields for use in mes- sage format strings.These fields are merged in with the context data previously described for Formatter objects. Here is an example:\n\nimport logging, socket logging.basicConfig(\n\nformat = \"%(hostname)s %(levelname)-10s %(asctime)s %(message)s\"\n\n) # Some extra context netinfo = {\n\n'hostname' : socket.gethostname(), 'ip' : socket.gethostbyname(socket.gethostname())\n\n} log = logging.getLogger('app')\n\n# Issue a log message with the extra context data\n\nF h Lib f L Bdff",
      "content_length": 2328,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 391,
      "content": "366\n\nChapter 19 Operating System Services\n\nlog.critical(\"Could not connect to server\", extra=netinfo)\n\nThe downside of this approach is that you have to make sure every logging operation includes the extra information or else the program will crash.An alternative approach is to use the LogAdapter class as a wrapper for an existing logger.\n\nLogAdapter(log [, extra])\n\nCreates a wrapper around a Logger object log. extrais a dictionary of extra context information to be supplied to message formatters.An instance of LogAdapter has the same interface as a Logger object. However, operations that issue log messages will automatically add the extra information supplied in extra. Here is an example of using a LogAdapter object:\n\nimport logging, socket logging.basicConfig(\n\nformat = \"%(hostname)s %(levelname)-10s %(asctime)s %(message)s\"\n\n) # Some extra context netinfo = {\n\n'hostname' : socket.gethostname(), 'ip' : socket.gethostbyname(socket.gethostname())\n\n}\n\n# Create a logger log = logging.LogAdapter(logging.getLogger(\"app\"), netinfo)\n\n# Issue a log message. Extra context data is supplied by the LogAdapter log.critical(\"Could not connect to server\")\n\nMiscellaneous Utility Functions The following functions in logging control a few other aspects of logging:\n\ndisable(level)\n\nGlobally disables all logging messages below the level specified in level. This can be used to turn off logging on a applicationwide basis—for instance, if you want to tem- porarily disable or reduce the amount of logging output.\n\naddLevelName(level, levelName)\n\nCreates an entirely new logging level and name. levelis a number and levelNameis a string.This can be used to change the names of the built-in levels or to add more levels than are supported by default.\n\ngetLevelName(level)\n\nReturns the name of the level corresponding to the numeric value level.\n\nshutdown()\n\nShuts down all logging objects, flushing output if necessary.\n\nLogging Configuration Setting an application to use the logging module typically involves the following basic steps:\n\n1. Use getLogger() to create various Logger objects. Set parameters such as the\n\nF h Lib f L Bdff",
      "content_length": 2136,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 392,
      "content": "logging\n\n367\n\nlevel, as appropriate.\n\n2. Create Handler objects by instantiating one of the various types of handlers (FileHandler, StreamHandler, SocketHandler, and so on) and set an appro- priate level.\n\n3. Create message Formatter objects and attach them to the Handler objects using the setFormatter() method.\n\n4. Attach the Handler objects to the Logger objects using the addHandler() method.\n\nBecause the configuration of each step can be somewhat involved, your best bet is to put all the logging configuration into a single well-documented location. For example, you might create a file applogconfig.py that is imported by the main program of your application:\n\n# applogconfig.py import logging import sys\n\n# Set the message format format = logging.Formatter(\"%(levelname)-10s %(asctime)s %(message)s\")\n\n# Create a handler that prints CRITICAL level messages to stderr crit_hand = logging.StreamHandler(sys.stderr) crit_hand.setLevel(logging.CRITICAL) crit_hand.setFormatter(format)\n\n# Create a handler that prints messages to a file applog_hand = logging.FileHandler('app.log') applog_hand.setFormatter(format)\n\n# Create a top-level logger called 'app' app_log = logging.getLogger(\"app\") app_log.setLevel(logging.INFO) app_log.addHandler(applog_hand) app_log.addHandler(crit_hand)\n\n# Change the level on the 'app.net' logger logging.getLogger(\"app.net\").setLevel(logging.ERROR)\n\nIf changes need to be made to any part of the logging configuration, having everything in one location makes things easier to maintain. Keep in mind that this special file only needs to be imported once and in only one location in the program. In other parts of the code where you want to issue log messages, you simply include code like this:\n\nimport logging app_log = logging.getLogger(\"app\") ... app_log.critical(\"An error occurred\")\n\nThe logging.config Submodule As an alternative to hard-coding the logging configuration in Python code, it is also possible to configure the logging module through the use of an INI-format configura- tion file.To do this, use the following functions found in logging.config.\n\nfileConfig(filename [, defaults [, disable_existing_loggers]])\n\nReads the logging configuration from the configuration file filename. defaultsis a\n\nF h Lib f L Bdff",
      "content_length": 2266,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 393,
      "content": "368\n\nChapter 19 Operating System Services\n\ndictionary of default configuration parameters for use in the config file.The specified filename is read using the ConfigParser module. disable_existing_loggersis a Boolean flag that specifies whether or not any existing loggers are disabled when new configuration data is read. By default, this is True.\n\nThe online documentation for the logging module goes into some detail on the expected format of configuration files. However, experienced programmers can proba- bly extrapolate from the following example, which is a configuration file version of applogconfig.py shown in the previous section.\n\n; applogconfig.ini ; ; Configuration file for setting up logging\n\n; The following sections provide names for Logger, Handler, and Formatter ; objects that will be configured later in the file.\n\n[loggers] keys=root,app,app_net\n\n[handlers] keys=crit,applog\n\n[formatters] keys=format\n\n[logger_root] level=NOTSET handlers=\n\n[logger_app] level=INFO propagate=0 qualname=app handlers=crit,applog\n\n[logger_app_net] level=ERROR propagate=1 qualname=app.net handlers=\n\n[handler_crit] class=StreamHandler level=CRITICAL formatter=format args=(sys.stderr,)\n\n[handler_applog] class=FileHandler level=NOTSET formatter=format args=('app.log',)\n\n[formatter_format] format=%(levelname)-10s %(asctime)s %(message)s datefmt=\n\nTo read this configuration file and set up logging, you would use this code:\n\nimport logging.config\n\nF h Lib f L Bdff",
      "content_length": 1468,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 394,
      "content": "mmap\n\n369\n\nlogging.config.fileConfig('applogconfig.ini')\n\nAs before, modules that want to issue log messages do not need to worry about the details of loading the logging configuration.They merely import the logging module and get a reference to the appropriate Logger object. For example:\n\nimport logging app_log = logging.getLogger(\"app\") ... app_log.critical(\"An error occurred\")\n\nPerformance Considerations Adding logging to an application can severely degrade its performance if you aren’t careful. However, there are some techniques that can be used to reduce the overhead. First, Python’s optimized mode (-O) removes all code that is conditionally executed using statements such as if __debug__: statements. If the sole purpose of logging is debugging, you could conditionally execute all of the logging calls and have the calls removed in optimized mode.\n\nA second technique would be to use a Null object in place of a Logger object when logging is to be completely disabled.This is different than using None. Instead, you want to use an instance of an object that silently swallows all operations that get performed on it. For example:\n\nclass Null(object):\n\ndef __init__(self, *args, **kwargs): pass def __call__(self, *args, **kwargs): return self def __getattribute__(self, name): return self def __setattr__(self, name, value): pass def __delattr__(self,name): pass\n\nlog = Null() log.critical(\"An error occurred.\") # Does nothing\n\nDepending on your cleverness, logging can also be managed through the use of decora- tors and metaclasses. Because these features of Python operate at the time that func- tions, methods, and classes are defined, they can be used to selectively add or remove logging features from parts of a program in a way that does not impact performance when logging is disabled. Please refer to Chapter 6,“Functions and Functional Programming,” and Chapter 7,“Classes and Object-Oriented Programming,” for further details.\n\nNotes\n\nn The logging module provides a large number of customization options not dis- cussed here. Readers should consult online documentation for further details. n It is safe to use the logging module with programs that use threads. In particu- lar, it is not necessary to add locking operations around code that is issuing log messages.\n\nmmap The mmap module provides support for a memory-mapped file object.This object behaves both like a file and a byte string and can be used in most places where an ordi-\n\nF h Lib f L Bdff",
      "content_length": 2484,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 395,
      "content": "370\n\nChapter 19 Operating System Services\n\nnary file or byte string is expected. Furthermore, the contents of a memory-mapped file are mutable.This means that modifications can be made using index-assignment and slice-assignment operators. Unless a private mapping of the file has been made, such changes directly alter the contents of the underlying file.\n\nA memory-mapping file is created by the mmap() function, which is slightly differ-\n\nent on UNIX and Windows.\n\nmmap(fileno, length [, flags, [prot [,access [, offset]]]])\n\n(UNIX). Returns an mmap object that maps lengthbytes from the file with an integer file descriptor, fileno. If filenois -1, anonymous memory is mapped. flagsspecifies the nature of the mapping and is one of the following:\n\nFlag MAP_PRIVATE\n\nMAP_SHARED\n\nMeaning Creates a private copy-on-write mapping. Changes to the object will be private to this process. Shares the mapping with all other processes mapping the same areas of the file. Changes to the object will affect all mappings.\n\nThe default flagssetting is MAP_SHARED. protspecifies the memory protections of the object and is the bitwise OR of the following:\n\nSetting PROT_READ\n\nPROT_WRITE\n\nPROT_EXEC\n\nMeaning Data can be read from the object. Modifications can be made to the object. The object can contain executable instructions.\n\nThe default value of protis PROT_READ | PROT_WRITE.The modes specified in prot must match the access permissions used to open the underlying file descriptor fileno. In most cases, this means that the file should be opened in read/write mode (for exam- ple, os.open(name, os.O_RDWR)).\n\nThe optional accessparameter may be used as an alternative to flagsand prot. If\n\ngiven, it has one of the following values:\n\nAccess ACCESS_READ ACCESS_WRITE Read/write access with write-through. Modifications affect the under-\n\nMeaning Read-only access.\n\nACCESS_COPY\n\nlying file. Read/write access with copy-on-write. Modifications affect memory but do not change the underlying file.\n\nWhen accessis supplied, it is typically given as a keyword argument—for example, mmap(fileno, length, access=ACCESS_READ). It is an error to supply values for both accessand flags. The offsetparameter specifies the number of bytes from the start of the file and defaults to 0. It must be a multiple of mmap.ALLOCATIONGRANULARITY.\n\nmmap(fileno, length[, tagname [,access [, offset]]])\n\n(Windows) Returns an mmap object that maps lengthbytes from the file specified by the integer file descriptor fileno. Use a filenoof -1 for anonymous memory. If\n\nF h Lib f L Bdff",
      "content_length": 2555,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 396,
      "content": "mmap\n\n371\n\nlengthis larger than the current size of the file, the file is extended to lengthbytes. If lengthis 0, the current length of the file is used as the length as long as the file is non- empty (otherwise, an exception will be raised). tagnameis an optional string that can be used to name the mapping. If tagnamerefers to an existing mapping, that mapping is opened. Otherwise, a new mapping is created. If tagnameis None, an unnamed map- ping is created. accessis an optional parameter that specifies the access mode. It takes the same values for accessas described for the UNIX version of mmap() shown earli- er. By default, accessis ACCESS_WRITE. offsetis the number of bytes from the beginning of the file and defaults to 0. It must be a multiple of mmap.ALLOCATIONGRANULARITY.\n\nA memory-mapped file object, m, supports the following methods.\n\nm.close()\n\nCloses the file. Subsequent operations will result in an exception.\n\nm.find(string[, start])\n\nReturns the index of the first occurrence of string. startspecifies an optional start- ing position. Returns -1 if no match is found.\n\nm.flush([offset, size])\n\nFlushes modifications of the in-memory copy back to the file system. offsetand size specify an optional range of bytes to flush. Otherwise, the entire mapping is flushed.\n\nm.move(dst,src,count)\n\nCopies countbytes starting at index srcto the destination index dst.This copy is per- formed using the C memmove() function, which is guaranteed to work correctly when the source and destination regions happen to overlap.\n\nm.read(n)\n\nReads up to nbytes from the current file position and returns the data as a string.\n\nm.read_byte()\n\nReads a single byte from the current file position and returns as a string of length 1.\n\nm.readline()\n\nReturns a line of input starting at the current file position.\n\nm.resize(newsize)\n\nResizes the memory-mapped object to contain newsizebytes.\n\nm.seek(pos[, whence])\n\nSets the file position to a new value. posand whencehave the same meaning as for the seek() method on file objects.\n\nm.size()\n\nReturns the length of the file.This value may be larger than the size of the memory- mapped region.\n\nm.tell()\n\nReturns the value of the file pointer.\n\nF h Lib f L Bdff",
      "content_length": 2212,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 397,
      "content": "372\n\nChapter 19 Operating System Services\n\nm.write(string)\n\nWrites a string of bytes to the file at the current file pointer.\n\nm.write_byte(byte)\n\nWrites a single byte into memory at the current file pointer.\n\nNotes\n\nn Although UNIX and Windows supply slightly different mmap() functions, this module can be used in a portable manner by relying on the optional access parameter that is common to both functions. For example, mmap(fileno,length,access=ACCESS_WRITE) will work on both UNIX and Windows.\n\nn Certain memory mapping may only work with a length that’s a multiple of the\n\nsystem page size, which is contained in the constant mmap.PAGESIZE.\n\nn On UNIX SVR4 systems, anonymous mapped memory can be obtained by call-\n\ning mmap() on the file /dev/zero, opened with appropriate permissions.\n\nn On UNIX BSD systems, anonymous mapped memory can be obtained by calling\n\nmmap() with a negative file descriptor and the flag mmap.MAP_ANON.\n\nmsvcrt The msvcrt module provides access to a number of useful functions in the Microsoft Visual C runtime library.This module is available only on Windows.\n\ngetch()\n\nReads a keypress and returns the resulting character.This call blocks if a keypress is not available. If the pressed key was a special function key, the call returns '\\000' or '\\xe0' and the next call returns the keycode.This function doesn’t echo characters to the console, nor can the function be used to read Ctrl+C.\n\ngetwch()\n\nThe same as getch() except that a Unicode character is returned.\n\ngetche()\n\nLike getch() except that characters are echoed (if printable).\n\ngetwche()\n\nThe same as getche() except that a Unicode character is returned.\n\nget_osfhandle(fd)\n\nReturns the file handle for file descriptor fd. Raises IOError if fdis not recognized.\n\nheapmin()\n\nForces the internal Python memory manager to return unused blocks to the operating system.This works only on Windows NT and raises IOError on failure.\n\nF h Lib f L Bdff",
      "content_length": 1941,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 398,
      "content": "msvcrt\n\n373\n\nkbhit()\n\nReturns True if a keypress is waiting to be read.\n\nlocking(fd, mode, nbytes)\n\nLocks part of a file, given a file descriptor from the C runtime. nbytesis the number of bytes to lock relative to the current file pointer. modeis one of the following integers:\n\nSetting 0\n\n1\n\n2 3\n\n4\n\nDescription Unlocks the file region (LK_UNLCK) Locks the file region (LK_LOCK) Locks the file region; nonblocking (LK_NBLCK) Locks for writing (LK_RLCK) Locks for writing; nonblocking (LK_NBRLCK)\n\nAttempts to acquire a lock that takes more than approximately 10 seconds results in an IOError exception.\n\nopen_osfhandle(handle, flags)\n\nCreates a C runtime file descriptor from the file handle handle. flagsis the bitwise OR of os.O_APPEND, os.O_RDONLY, and os.O_TEXT. Returns an integer file descriptor that can be used as a parameter to os.fdopen() to create a file object.\n\nputch(char)\n\nPrints the character charto the console without buffering.\n\nputwch(char)\n\nThe same as putch() except that charis a Unicode character.\n\nsetmode(fd, flags)\n\nSets the line-end translation mode for file descriptor fd. flagsis os.O_TEXT for text mode and os.O_BINARY for binary mode.\n\nungetch(char)\n\nCauses the character charto be “pushed back” into the console buffer. It will be the next character read by getch() or getche().\n\nungetwch(char)\n\nThe same as ungetch() except that charis a Unicode character.\n\nNote\n\nA wide variety of Win32 extensions are available that provide access to the Microsoft Foundation Classes, COM components, graphical user interfaces, and so forth. These topics are far beyond the scope of this book, but detailed information about many of these topics is available in Python Programming on Win32 by Mark Hammond and Andy Robinson (O’Reilly & Associates, 2000). Also, http://www.python.org maintains an extensive list of contributed modules for use under Windows.\n\nF h Lib f L Bdff",
      "content_length": 1895,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 399,
      "content": "374\n\nChapter 19 Operating System Services\n\nSee Also:\n\nwinreg (p. 408)\n\noptparse The optparse module provides high-level support for processing UNIX-style command-line options supplied in sys.argv.A simple example of using the module is found in Chapter 9. Use of optparse primarily focuses on the OptionParser class.\n\nOptionParser([**args])\n\nCreates a new command option parser and returns an OptionParser instance.A variety of optional keyword arguments can be supplied to control configuration.These keyword arguments are described in the following list:\n\nKeyword Argument add_help_option\n\nDescription Specifies whether or not a special help option (--help and -h) is supported. By default, this is set to True.\n\nconflict_handler Specifies the handling of conflicting command-line options. May be set to either 'error' (the default value) or 'resolve'. In 'error' mode, an optparse.OptionConflictError excep- tion will be raised if conflicting option strings are added to the parser. In 'resolve' mode, conflicts are resolved so that options added later take priority. However, earlier options may still be available if they were added under multiple names and no con- flicts exist for at least one of the names. A string that provides a description of the program for display dur- ing help. This string will automatically be reformatted to fit the screen when displayed. Instance of an optparse.HelpFormatter class used to format text when printing help. May be either optparse. IndentedHelpFormatter (the default) or optparse. TitledHelpFormatter. The Python class that’s used to hold information about each command-line option. The default class is optparse.Option. A list of options used to populate the parser. By default, this list is empty, and options are added using the add_option() method instead. If supplied, this list contains objects of type Option. The program name used to replace '%prog' in help text. The usage string that’s printed when the --help option is used or incorrect options are passed. The default value is the string '%prog [options]', where the '%prog' keyword gets replaced with either the value of os.path.basename (sys.argv[0]) or the value of the prog keyword argument (if supplied). The value optparse.SUPPRESS_USAGE can be given to suppress the usage message entirely. Version string that’s printed when the -version option is supplied. By default, version is None and no --version option is added. When this string is supplied, -version is automatically added. The special keyword '%prog' is replaced by the program name.\n\ndescription\n\nformatter\n\noption_class\n\noption_list\n\nprog\n\nusage\n\nversion\n\nF h Lib f L Bdff",
      "content_length": 2653,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 400,
      "content": "optparse\n\n375\n\nUnless you really need to customize option processing in some way, an OptionParser will usually be created with no arguments. For example:\n\np = optparse.OptionParser()\n\nAn instance, p, of OptionParser supports the following methods:\n\np.add_option(name1, ..., nameN [, **parms])\n\nAdds a new option to p.The arguments name1, name2, and so on are all of the various names for the option. For example, you might include short and long option names such as '-f' and '--file’. Following the option names, an optional set of keyword arguments is supplied that specifies how the option will be processed when parsed. These keyword arguments are described in the following list:\n\nKeyword Argument action\n\ncallback\n\nDescription Action to perform when the option is parsed. Acceptable values are as follows: 'store'—Option has an argument that is read and stored. This is the default if no action is specified explicitly. 'store_const'—The option takes no arguments, but when the option is encountered, a constant value specified with the const keyword argument is stored. 'store_true'—Like 'store_const' but stores a Boolean True when the option is parsed. 'store_false'—Like 'store_true' but stores False instead. 'append'—Option has an argument that is appended to a list when parsed. This is used if the same command-line option is used to specify multiple values. 'count'—Option takes no arguments, but a counter value is stored. The counter value is increased by one each time the argument is encountered. 'callback'—Invokes a callback function specified with the callback keyword argument when the option is encountered. 'help'—Prints a help message when the option is parsed. This is only needed if you want help to be displayed via a different option than the standard -h or --help option. 'version’—Prints the version number supplied to OptionParser(), if any. Only used if you want to display ver- sion information using an option other than the standard -v or --version option. Specifies a callback function to be invoked when the option is encountered. This callback function is a Python callable object that is invoked as callback(option, opt_str, value, parser, *args, **kwargs). The optionargument is an instance of optparse.Option, opt_stris the option string supplied on the command line that triggered the callback, valueis the value of the option (if any), parseris the instance of OptionParser that’s running, argsare positional argu- ments supplied using the callback_args keyword argument, and kwargsare keyword arguments supplied using the callback_kwargs keyword argument.\n\nF h Lib f L Bdff",
      "content_length": 2619,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 401,
      "content": "376\n\nChapter 19 Operating System Services\n\nKeyword Argument callback_args\n\ncallback_kwargs\n\nchoices\n\nconst\n\ndefault\n\ndest\n\nhelp\n\nmetavar\n\nnargs\n\nDescription Optional positional arguments supplied to a callback function specified with the callback argument. Optional keyword arguments supplied to a callback function specified with the callback argument. A list of strings that specifies all possible option values. Used when an option only has a limited set of values (for example, ['small’, 'medium', 'large']). The constant value that’s stored with the 'store_const' action. Sets the default value of the option if not supplied. By default, the default value is None. Sets the name of the attribute used to store option values dur- ing parsing. Normally the name is derived from the option name itself. Help text for this particular option. If this is not supplied, the option will be listed in help without a description. The value optparse.SUPPRESS_HELP can be used to hide an option. The special keyword '%default’ is replaced by the option default value in the help string. Specifies the name of an option argument that’s used when printing help text. Specifies the number of option arguments for actions that expect arguments. The default value is 1. If a number greater than 1 is used, option arguments will be collected into a tuple that is then used whenever arguments are handled. Specifies the type of an option. Valid types are 'string' (the default), 'int', 'long’, 'choice’, 'float’, and 'complex’.\n\ntype\n\np.disable_interspersed_args()\n\nDisallows the mixing of simple options with positional arguments. For example, if '-x’ and '-y' are options that take no parameters, the options must appear before any argu- ments (for example, 'prog -x -y arg1 arg2 arg3').\n\np.enable_interspersed_args()\n\nAllows the mixing of options with positional arguments. For example, if '-x’ and '-y' are simple options that take no parameters, they may be mixed with the arguments, such as in 'prog -x arg1 arg2 -y arg3'.This is the default behavior.\n\np.parse_args([arglist])\n\nParses command-line options and returns a tuple (options, args) where optionsis an object containing the values of all the options and argsis a list of all the remaining positional arguments left over.The optionsobject stores all the option data in attrib- utes with names that match the option name. For example, the option '--output' would have its value stored in options.output.If the option does not appear, the value will be None.The name of the attribute can be set using the dest keyword argu- ment to add_option(), described previously. By default, arguments are taken from sys.argv[1:]. However, a different source of arguments can be supplied as an optional argument, arglist.\n\nF h Lib f L Bdff",
      "content_length": 2775,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 402,
      "content": "optparse\n\n377\n\np.set_defaults(dest=value, ... dest=value)\n\nSets the default values of particular option destinations.You simply supply keyword arguments that specify the destinations you wish to set.The name of the keyword argu- ments should match the names specified using the dest parameter in add_option(), described earlier.\n\np.set_usage(usage)\n\nChanges the usage string displayed in text produced by the --help option.\n\nExample\n\n# foo.py import optparse p = optparse.OptionParser()\n\n# A simple option, with no arguments p.add_option(\"-t\", action=\"store_true\", dest=\"tracing\")\n\n# An option that accepts a string argument p.add_option(\"-o\", \"--outfile\", action=\"store\", type=\"string\", dest=\"outfile\")\n\n# An option requires an integer argument p.add_option(\"-d\", \"--debuglevel\", action=\"store\", type=\"int\", dest=\"debug\")\n\n# An option with a few choices p.add_option(\"--speed\", action=\"store\", type=\"choice\", dest=\"speed\",\n\nchoices=[\"slow\",\"fast\",\"ludicrous\"])\n\n# An option taking multiple arguments p.add_option(\"--coord\", action=\"store\", type=\"int\", dest=\"coord\", nargs=2)\n\n# A set of options that control a common destination p.add_option(\"--novice\", action=\"store_const\", const=\"novice\", dest=\"mode\") p.add_option(\"--guru\", action=\"store_const\", const=\"guru\", dest=\"mode\")\n\n# Set default values for the various option destinations p.set_defaults(tracing=False,\n\ndebug=0, speed=\"fast\", coord=(0,0), mode=\"novice\")\n\n# Parse the arguments opt, args = p.parse_args()\n\n# Print option values print \"tracing :\", opt.tracing print \"outfile :\", opt.outfile print \"debug :\", opt.debug print \"speed :\", opt.speed print \"coord :\", opt.coord print \"mode :\", opt.mode\n\n# Print remaining arguments print \"args :\", args\n\nF h Lib f L Bdff",
      "content_length": 1726,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 403,
      "content": "378\n\nChapter 19 Operating System Services\n\nHere is a short interactive UNIX session that shows how the previous code works:\n\n% python foo.py -h usage: foo.py [options]\n\noptions:\n\nh, --help show this help message and exit -t -o OUTFILE, --outfile=OUTFILE -d DEBUG, --debuglevel=DEBUG --speed=SPEED --coord=COORD --novice --guru\n\n% python foo.py -t -o outfile.dat -d 3 --coord 3 4 --speed=ludicrous blah tracing : True outfile : outfile.dat debug : 3 speed : ludicrous coord : (3, 4) mode : novice args : ['blah']\n\n% python foo.py --speed=insane usage: foo.py [options]\n\nfoo.py:error:option --speed:invalid choice:'insane' (choose from 'slow', 'fast', 'ludicrous')\n\nNotes\n\nn When specifying option names, use a single dash to specify a short name such as\n\n'-x' and a double-dash to specify a long name such as '--exclude'.An OptionError exception will be raised if you attempt to define an option that is a mix of the two styles, such as '-exclude'.\n\nn Python also includes a module getopt that provides support for command-line\n\nparsing in a style similar to a C library of the same name. For all practical purpos- es, there is no benefit to using that module over optparse (which is much high- er level and requires far less coding).\n\nn The optparse module contains a considerable number of advanced features\n\nrelated to customization and specialized handling of certain kinds of command- line options. However, none of these features are required for the most common types of command-line option parsing. Readers should consult the online library documentation for more details and additional examples.\n\nos The os module provides a portable interface to common operating-system services. It does this by searching for an OS-dependent built-in module such as nt or posix and exporting the functions and data as found there. Unless otherwise noted, functions are available on Windows and UNIX. UNIX systems include both Linux and Mac OS X.\n\nF h Lib f L Bdff",
      "content_length": 1956,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 404,
      "content": "os\n\n379\n\nThe following general-purpose variables are defined:\n\nenviron\n\nA mapping object representing the current environment variables. Changes to the map- ping are reflected in the current environment. If the putenv() function is also available, then changes are also reflected in subprocesses.\n\nlinesep\n\nThe string used to separate lines on the current platform. May be a single character such as '\\n' for POSIX or multiple characters such as '\\r\\n' for Windows.\n\nname\n\nThe name of the OS-dependent module imported: 'posix', 'nt', 'dos', 'mac', 'ce', 'java', 'os2', or 'riscos'.\n\npath\n\nThe OS-dependent standard module for pathname operations.This module can also be loaded using import os.path.\n\nProcess Environment The following functions are used to access and modify various parameters related to the environment in which a process runs. Process, group, process group, and session IDs are integers unless otherwise noted.\n\nchdir(path)\n\nChanges the current working directory to path.\n\nchroot(path)\n\nChanges the root directory of the current process (UNIX).\n\nctermid()\n\nReturns a string with the filename of the control terminal for the process (UNIX).\n\nfchdir(fd)\n\nChanges the current working directory. fdis a file descriptor to an opened directory (UNIX).\n\ngetcwd()\n\nReturns a string with the current working directory.\n\ngetcwdu()\n\nReturns a Unicode string with the current working directory.\n\ngetegid()\n\nReturns the effective group ID (UNIX).\n\ngeteuid()\n\nReturns the effective user ID (UNIX).\n\nF h Lib f L Bdff",
      "content_length": 1519,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 405,
      "content": "380\n\nChapter 19 Operating System Services\n\ngetgid()\n\nReturns the real group ID of the process (UNIX).\n\ngetgroups()\n\nReturns a list of integer group IDs to which the process owner belongs (UNIX).\n\ngetlogin()\n\nReturns the user name associated with the effective user ID (UNIX).\n\ngetpgid(pid)\n\nReturns the process group ID of the process with process ID pid. If pidis 0, the process group of the calling process is returned (UNIX).\n\ngetpgrp()\n\nReturns the ID of the current process group. Process groups are typically used in con- junction with job control.The process group is not necessarily the same as the group ID of the process (UNIX).\n\ngetpid()\n\nReturns the real process ID of the current process (UNIX and Windows).\n\ngetppid()\n\nReturns the process ID of the parent process (UNIX).\n\ngetsid(pid)\n\nReturns the process session identifier of process pid. If pidis 0, the identifier of the current process is returned (UNIX).\n\ngetuid()\n\nReturns the real user ID of the current process (UNIX).\n\nputenv(varname, value)\n\nSets environment variable varnameto value. Changes affect subprocesses started with os.system(), popen(), fork(), and execv().Assignments to items in os.environ automatically call putenv(). However, calls to putenv() don’t update os.environ (UNIX and Windows).\n\nsetegid(egid)\n\nSets the effective group ID (UNIX).\n\nseteuid(euid)\n\nSets the effective user ID (UNIX).\n\nsetgid(gid)\n\nSets the group ID of the current process (UNIX).\n\nsetgroups(groups)\n\nSets the group access list of the current process. groupsis a sequence of integers speci- fying group identifiers. Can only be called by root (UNIX).\n\nF h Lib f L Bdff",
      "content_length": 1631,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 406,
      "content": "os\n\n381\n\nsetpgrp()\n\nCreates a new process group by calling the system call setpgrp() or setpgrp(0, 0), depending on which version is implemented (if any). Returns the ID of the new process group (UNIX).\n\nsetpgid(pid, pgrp)\n\nAssigns process pidto process group pgrp. If pidis equal to pgrp, the process becomes a new process group leader. If pidis not equal to pgrp, the process joins an existing group. If pidis 0, the process ID of the calling process is used. If pgrpis 0, the process specified by pidbecomes a process group leader (UNIX).\n\nsetreuid(ruid,euid)\n\nSets the real and effective user ID of the calling process (UNIX).\n\nsetregid(rgid,egid)\n\nSets the real and effective group ID of the calling process (UNIX).\n\nsetsid()\n\nCreates a new session and returns the newly created session ID. Sessions are typically associated with terminal devices and the job control of processes that are started within them (UNIX).\n\nsetuid(uid)\n\nSets the real user ID of the current process.This function is privileged and often can be performed only by processes running as root (UNIX).\n\nstrerror(code)\n\nReturns the error message corresponding to the integer error code(UNIX and Windows).The errno module defines symbolic names for these error codes.\n\numask(mask)\n\nSets the current numeric umask and returns the previous umask.The umask is used to clear permissions bits on files that are created by the process (UNIX and Windows).\n\nuname()\n\nReturns a tuple of strings (sysname, nodename, release, version, machine) identifying the system type (UNIX).\n\nunsetenv(name)\n\nUnsets the environment variable name.\n\nFile Creation and File Descriptors The following functions provide a low-level interface for manipulating files and pipes. In these functions, files are manipulated in terms of an integer file descriptor, fd.The file descriptor can be extracted from a file object by invoking its fileno() method.\n\nclose(fd)\n\nCloses the file descriptor fdpreviously returned by open() or pipe().\n\nF h Lib f L Bdff",
      "content_length": 1995,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 407,
      "content": "382\n\nChapter 19 Operating System Services\n\ncloserange(low, high)\n\nCloses all file descriptors fdin the range low <= fd < high. Errors are ignored.\n\ndup(fd)\n\nDuplicates file descriptor fd. Returns a new file descriptor that’s the lowest-numbered unused file descriptor for the process.The new and old file descriptors can be used interchangeably. Furthermore, they share state, such as the current file pointer and locks (UNIX and Windows).\n\ndup2(oldfd, newfd)\n\nDuplicates file descriptor oldfdto newfd. If newfdalready corresponds to a valid file descriptor, it’s closed first (UNIX and Windows).\n\nfchmod(fd, mode)\n\nChanges the mode of the file associated with fdto mode. See the description of os.open() for a description of mode(UNIX).\n\nfchown(fd, uid, gid)\n\nChanges the owner and group ID of the file associated with fdto uidand gid. Use a valid of -1 for uidor gidto keep the value unchanged (UNIX).\n\nfdatasync(fd)\n\nForces all cached data written to fdto be flushed to disk (UNIX).\n\nfdopen(fd [, mode [, bufsize]])\n\nCreates an open file object connected to file descriptor fd.The modeand bufsize arguments have the same meaning as in the built-in open() function. modeshould be a string such as 'r', 'w', or 'a'. On Python 3, this function accepts any additional parameters that work with the built-in open() function such as specifications for the encoding and line ending. However, if portability with Python 2 is a concern, you should only use the modeand bufsizearguments described here.\n\nfpathconf(fd, name)\n\nReturns configurable pathname variables associated with the open file with descriptor fd. nameis a string that specifies the name of the value to retrieve.The values are usual- ly taken from parameters contained in system header files such as <limits.h> and <unistd.h>. POSIX defines the following constants for name:\n\nConstant \"PC_ASYNC_IO\"\n\n\"PC_CHOWN_RESTRICTED\"\n\n\"PC_FILESIZEBITS\"\n\n\"PC_LINK_MAX\"\n\n\"PC_MAX_CANON\"\n\nDescription Indicates whether asynchronous I/O can be performed on fd. Indicates whether the chown() function can be used. If fdrefers to a directory, this applies to all files in the directory. Maximum size of a file. Maximum value of the file’s link count. Maximum length of a formatted input line. fdrefers to a terminal. Maximum length of an input line. fdrefers to a terminal.\n\n\"PC_MAX_INPUT\"\n\nF h Lib f L Bdff",
      "content_length": 2349,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 408,
      "content": "os\n\n383\n\nConstant \"PC_NAME_MAX\"\n\n\"PC_NO_TRUNC\"\n\n\"PC_PATH_MAX\"\n\n\"PC_PIPE_BUF\"\n\n\"PC_PRIO_IO\"\n\n\"PC_SYNC_IO\"\n\n\"PC_VDISABLE\"\n\nDescription Maximum length of a filename in a directory. Indicates whether an attempt to create a file with a name longer than PC_NAME_MAX for a directory will fail with an ENAMETOOLONG error. Maximum length of a relative path name when the direc- tory fdis the current working directory. Size of the pipe buffer when fdrefers to a pipe or FIFO. Indicates whether priority I/O can be performed on fd. Indicates whether synchronous I/O can be performed on fd. Indicates whether fdallows special-character processing to be disabled. fdmust refer to a terminal.\n\nNot all names are available on all platforms, and some systems may define additional configuration parameters. However, a list of the names known to the operating system can be found in the dictionary os.pathconf_names. If a known configuration name is not included in os.pathconf_names, its integer value can also be passed as name. Even if a name is recognized by Python, this function may still raise an OSError if the host operating system doesn’t recognize the parameter or associate it with the file fd.This function is only available on some versions of UNIX.\n\nfstat(fd)\n\nReturns the status for file descriptor fd. Returns the same values as the os.stat() function (UNIX and Windows).\n\nfstatvfs(fd)\n\nReturns information about the file system containing the file associated with file descriptor fd. Returns the same values as the os.statvfs() function (UNIX).\n\nfsync(fd)\n\nForces any unwritten data on fdto be written to disk. Note that if you are using an object with buffered I/O (for example, a Python file object), you should first flush the data before calling fsync().Available on UNIX and Windows.\n\nftruncate(fd, length)\n\nTruncates the file corresponding to file descriptor fdso that it’s at most lengthbytes in size (UNIX).\n\nisatty(fd)\n\nReturns True if fdis associated with a TTY-like device such as a terminal (UNIX).\n\nlseek(fd, pos, how)\n\nSets the current position of file descriptor fdto position pos.Values of howare as fol- lows: SEEK_SET sets the position relative to the beginning of the file, SEEK_CUR sets it relative to the current position, and SEEK_END sets it relative to the end of the file. In older Python code, it is common to see these constants replaced with their numeric values of 0, 1, or 2, respectively.\n\nF h Lib f L Bdff",
      "content_length": 2439,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 409,
      "content": "384\n\nChapter 19 Operating System Services\n\nopen(file [, flags [, mode]])\n\nOpens the file file. flagsis the bitwise OR of the following constant values:\n\nValue O_RDONLY\n\nO_WRONLY\n\nO_RDWR\n\nO_APPEND\n\nO_CREAT\n\nO_NONBLOCK\n\nO_NDELAY\n\nO_DSYNC\n\nO_NOCTTY\n\nO_TRUNC\n\nO_RSYNC\n\nO_SYNC\n\nO_EXCL\n\nO_EXLOCK\n\nO_SHLOCK\n\nO_ASYNC\n\nO_DIRECT\n\nO_DIRECTORY\n\nO_NOFOLLOW\n\nO_NOATIME\n\nO_TEXT\n\nDescription Open the file for reading. Open the file for writing. Open for reading and writing (updates). Append bytes to the end of the file. Create the file if it doesn’t exist. Don’t block on open, read, or write (UNIX). Same as O_NONBLOCK (UNIX). Synchronous writes (UNIX). When opening a device, don’t set controlling terminal (UNIX). If the file exists, truncates to zero length. Synchronous reads (UNIX). Synchronous writes (UNIX). Error if O_CREAT and the file already exists. Set an exclusive lock on the file. Set a shared lock on the file. Enables asynchronous input mode in which a SIGIO signal is gen- erated with input is available. Use direct I/O mode where reads and writes go directly to the disk instead of the operating system read/write caches. Raises an error if the file is not a directory. Don’t follow symbolic links. Don’t update the last access time of the file. Text mode (Windows). Binary mode (Windows). File not inherited by child processes (Windows).\n\nO_BINARY O_NOINHERIT O_SHORT_LIVED Hint to system that the file is used for short-term storage\n\nO_TEMPORARY\n\nO_RANDOM\n\nO_SEQUENTIAL\n\n(Windows). Delete file when closed (Windows). Hint to system that file will be used for random access (Windows). Hint to system that file will be accessed sequentially (Windows).\n\nSynchronous I/O modes (O_SYNC, O_DSYNC, O_RSYNC) force I/O operations to block until they’ve been completed at the hardware level (for example, a write will block until the bytes have been physically written to disk).The modeparameter contains the file permissions represented as the bitwise OR of the following octal values (which are defined as constants in the stat module as indicated):\n\nMode 0100\n\n0200\n\n0400\n\n0700\n\nMeaning User has execute permission (stat.S_IXUSR). User has write permission (stat.S_IWUSR). User has read permission (stat.S_IRUSR). User has read/write/exec permission (stat.S_IRWXU).\n\nF h Lib f L Bdff",
      "content_length": 2285,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 410,
      "content": "os\n\n385\n\nMode 0010\n\n0020\n\n0040\n\n0070\n\n0001\n\n0002\n\n0004\n\n0007\n\n4000\n\n2000\n\nMeaning Group has execute permission (stat.S_IXGRP). Group has write permission (stat.S_IWGRP). Group has read permission (stat.S_IRGRP). Group has read/write/exec permission (stat.S_IRWXG). Others have execute permission (stat.S_IXOTH). Others have write permission (stat.S_IWOTH). Others have read permission (stat.S_IROTH). Others have read/write/exec permission (stat.S_IRWXO). Set UID mode (stat.S_ISUID). Set GID mode (stat.S_ISGID). Set the sticky bit (stat.S_ISVTX).\n\n1000\n\nThe default mode of a file is (0777 & ˜umask), where the umask setting is used to remove selected permissions. For example, a umask of 0022 removes the write permis- sion for groups and others.The umask can be changed using the os.umask() function. The umask setting has no effect on Windows.\n\nopenpty()\n\nOpens a psuedo-terminal and returns a pair of file descriptors (master,slave) for the PTY and TTY.Available on some versions of UNIX.\n\npipe()\n\nCreates a pipe that can be used to establish unidirectional communication with another process. Returns a pair of file descriptors (r, w) usable for reading and writing, respec- tively.This function is usually called prior to executing a fork() function.After the fork(), the sending process closes the read end of the pipe and the receiving process closes the write end of the pipe.At this point, the pipe is activated and data can be sent from one process to another using read() and write() functions (UNIX).\n\nread(fd, n)\n\nReads at most nbytes from file descriptor fd. Returns a byte string containing the bytes read.\n\ntcgetpgrp(fd)\n\nReturns the process group associated with the control terminal given by fd(UNIX).\n\ntcsetpgrp(fd, pg)\n\nSets the process group associated with the control terminal given by fd(UNIX).\n\nttyname(fd)\n\nReturns a string that specifies the terminal device associated with file descriptor fd. If fdis not associated with a terminal device, an OSError exception is raised (UNIX).\n\nwrite(fd, str)\n\nWrites the byte string strto file descriptor fd. Returns the number of bytes actually written.\n\nF h Lib f L Bdff",
      "content_length": 2139,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 411,
      "content": "386\n\nChapter 19 Operating System Services\n\nFiles and Directories The following functions and variables are used to manipulate files and directories on the file system.To handle variances in filenaming schemes, the following variables con- tain information about the construction of path names:\n\nVariable altsep\n\ncurdir\n\ndevnull\n\nextsep\n\npardir\n\npathsep\n\nsep\n\nDescription An alternative character used by the OS to separate pathname compo- nents, or None if only one separator character exists. This is set to '/' on DOS and Windows systems, where sepis a backslash. The string used to refer to the current working directory: '.' for UNIX and Windows and ':' for the Macintosh. The path of the null device (for example, /dev/null). Character that separates the base filename from its type (for example, the '.' in 'foo.txt'). The string used to refer to the parent directory: '..' for UNIX and Windows and '::' for the Macintosh. The character used to separate search path components (as contained in the $PATH environment variable): ':' for UNIX and ';' for DOS and Windows. The character used to separate pathname components: '/' for UNIX and Windows and ':' for the Macintosh.\n\nThe following functions are used to manipulate files:\n\naccess(path, accessmode)\n\nChecks read/write/execute permissions for this process to access the file path. accessmodeis R_OK, W_OK, X_OK, or F_OK for read, write, execute, or existence, respectively. Returns 1 if access is granted, 0 if not.\n\nchflags(path, flags)\n\nChanges the file flags on path. flagsis the bitwise-or of the constants listed next. Flags starting with UF_ can be set by any user, whereas SF_ flags can only be changed by the superuser (UNIX).\n\nFlag stat.UF_NODUMP\n\nstat.UF_IMMUTABLE\n\nstat.UF_APPEND\n\nstat.UF_OPAQUE\n\nstat.UF_NOUNLINK\n\nstat.SF_ARCHIVED\n\nstat.SF_IMMUTABLE\n\nstat.SF_APPEND\n\nstat.SF_NOUNLINK\n\nMeaning Do not dump the file. The file is read-only. The file only supports append operations. The directory is opaque. The file may not be deleted or renamed. The file can be archived. The file is read-only. The file only supports append operations. The file may not be deleted or renamed. The file is a snapshot file.\n\nstat.SF_SNAPSHOT\n\nF h Lib f L Bdff",
      "content_length": 2212,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 412,
      "content": "os\n\n387\n\nchmod(path, mode)\n\nChanges the mode of path. modehas the same values as described for the open() function (UNIX and Windows).\n\nchown(path, uid, gid)\n\nChanges the owner and group ID of pathto the numeric uidand gid. Setting uidor gidto -1 causes that parameter to remain unmodified (UNIX).\n\nlchflags(path, flags)\n\nThe same as chflags(), but doesn’t follow symbolic links (UNIX).\n\nlchmod(path, mode)\n\nThe same as chmod() except that if pathis a symbolic link, it modifies the link itself, not the file the link refers to.\n\nlchown(path, uid, gid)\n\nThe same as chown() but doesn’t follow symbolic links (UNIX).\n\nlink(src, dst)\n\nCreates a hard link named dstthat points to src(UNIX).\n\nlistdir(path)\n\nReturns a list containing the names of the entries in the directory path.The list is returned in arbitrary order and doesn’t include the special entries of '.' and '..'. If pathis Unicode, the resulting list will only contain Unicode strings. Be aware that if any filenames in the directory can’t be properly encoded into Unicode, they are silently skipped. If pathis given as a byte string, then all filenames are returned as a list of byte strings.\n\nlstat(path)\n\nLike stat() but doesn’t follow symbolic links (UNIX).\n\nmakedev(major, minor)\n\nCreates a raw device number given major and minor device numbers (UNIX).\n\nmajor(devicenum)\n\nReturns the major device number from a raw device number devicenumcreated by makedev().\n\nminor(devicenum)\n\nReturns the minor device number from a raw device number devicenumcreated by makedev().\n\nmakedirs(path [, mode])\n\nRecursive directory-creation function. Like mkdir() but makes all the intermediate- level directories needed to contain the leaf directory. Raises an OSError exception if the leaf directory already exists or cannot be created.\n\nF h Lib f L Bdff",
      "content_length": 1804,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 413,
      "content": "388\n\nChapter 19 Operating System Services\n\nmkdir(path [, mode])\n\nCreates a directory named pathwith numeric mode mode.The default mode is 0777. On non-UNIX systems, the mode setting may have no effect or be ignored.\n\nmkfifo(path [, mode])\n\nCreates a FIFO (a named pipe) named pathwith numeric mode mode.The default mode is 0666 (UNIX).\n\nmknod(path [, mode, device])\n\nCreates a device-special file. pathis the name of the file, modespecifies the permissions and type of file, and deviceis the raw device number created using os.makedev(). The modeparameter accepts the same parameters as open() when setting the file’s access permissions. In addition, the flags stat.S_IFREG, stat.S_IFCHR, stat.S_IFBLK, and stat.S_IFIFO are added to modeto indicate a file type (UNIX).\n\npathconf(path, name)\n\nReturns configurable system parameters related to the path name path. nameis a string that specifies the name of the parameter and is the same as described for the fpathconf() function (UNIX).\n\nreadlink(path)\n\nReturns a string representing the path to which a symbolic link, path, points (UNIX).\n\nremove(path)\n\nRemoves the file path.This is identical to the unlink() function.\n\nremovedirs(path)\n\nRecursive directory-removal function.Works like rmdir() except that, if the leaf direc- tory is successfully removed, directories corresponding to the rightmost path segments will be pruned away until either the whole path is consumed or an error is raised (which is ignored because it generally means that a parent directory isn’t empty). Raises an OSError exception if the leaf directory could not be removed successfully.\n\nrename(src, dst)\n\nRenames the file or directory srcto dst.\n\nrenames(old, new)\n\nRecursive directory-renaming or file-renaming function.Works like rename() except it first attempts to create any intermediate directories needed to make the new path name. After the rename, directories corresponding to the rightmost path segments of the old name will be pruned away using removedirs().\n\nrmdir(path)\n\nRemoves the directory path.\n\nstat(path)\n\nPerforms a stat() system call on the given pathto extract information about a file. The return value is an object whose attributes contain file information. Common attributes include:\n\nF h Lib f L Bdff",
      "content_length": 2253,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 414,
      "content": "os\n\n389\n\nAttribute st_mode\n\nst_ino\n\nst_dev\n\nst_nlink\n\nst_uid\n\nst_gid\n\nst_size\n\nst_atime\n\nst_mtime\n\nDescription Inode protection mode Inode number Device the inode resides on Number of links to the inode User ID of the owner Group ID of the owner File size in bytes Time of last access Time of last modification Time of last status change\n\nst_ctime\n\nHowever, additional attributes may be available depending on the system.The object returned by stat() also looks like a 10-tuple containing the parameters (st_mode, st_ino, st_dev, st_nlink, st_uid, st_gid, st_size, st_atime, st_mtime, st_ctime).This latter form is provided for backward compatibility.The stat module defines constants that are used to extract fields from this tuple.\n\nstat_float_times([newvalue])\n\nReturns True if the times returned by stat() are floating-point numbers instead of integers.The behavior can be changed by supplying a Boolean value for newvalue.\n\nstatvfs(path)\n\nPerforms a statvfs() system call on the given pathto get information about the file system.The return value is an object whose attributes describe the file system. Common attributes include:\n\nAttribute f_bsize\n\nf_frsize\n\nf_blocks\n\nf_bfree\n\nf_bavail\n\nf_files\n\nf_ffree\n\nf_favail\n\nf_flag\n\nDescription Preferred system block size Fundamental file system block size Total number of blocks in the file system Total number of free blocks Free blocks available to a non-superuser Total number of file inodes Total number of free file inodes Free nodes available to a non-superuser Flags (system-dependent) Maximum filename length\n\nf_namemax\n\nThe returned object also behaves like a tuple containing these attributes in the order listed.The standard module statvfs defines constants that can be used to extract infor- mation from the returned statvfs data (UNIX).\n\nsymlink(src, dst)\n\nCreates a symbolic link named dstthat points to src.\n\nF h Lib f L Bdff",
      "content_length": 1889,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 415,
      "content": "390\n\nChapter 19 Operating System Services\n\nunlink(path)\n\nRemoves the file path. Same as remove().\n\nutime(path, (atime, mtime))\n\nSets the access and modified time of the file to the given values. (The second argument is a tuple of two items.) The time arguments are specified in terms of the numbers returned by the time.time() function.\n\nwalk(top [, topdown [, onerror [,followlinks]]])\n\nCreates a generator object that walks through a directory tree. topspecifies the top of the directory, and topdownis a Boolean that indicates whether to traverse directories in a top-down (the default) or bottom-up order.The returned generator produces tuples (dirpath, dirnames, filenames) where dirpathis a string containing the path to the directory, dirnamesis a list of all subdirectories in dirpath, and filenamesis a list of the files in dirpath, not including directories.The onerrorparameter is a func- tion accepting a single argument. If any errors occur during processing, this function will be called with an instance of os.error.The default behavior is to ignore errors. If a directory is walked in a top-down manner, modifications to dirnameswill affect the walking process. For example, if directories are removed from dirnames, those directo- ries will be skipped. By default, symbolic links are not followed unless the fol- lowlinksargument is set to True.\n\nProcess Management The following functions and variables are used to create, destroy, and manage processes:\n\nabort()\n\nGenerates a SIGABRT signal that’s sent to the calling process. Unless the signal is caught with a signal handler, the default is for the process to terminate with an error.\n\ndefpath\n\nThis variable contains the default search path used by the exec*p*() functions if the environment doesn’t have a 'PATH' variable.\n\nexecl(path, arg0, arg1, ...)\n\nEquivalent to execv(path, (arg0, arg1, ...)).\n\nexecle(path, arg0, arg1, ..., env)\n\nEquivalent to execve(path, (arg0, arg1, ...), env).\n\nexeclp(path, arg0, arg1, ...)\n\nEquivalent to execvp(path, (arg0, arg1, ...)).\n\nexecv(path, args)\n\nExecutes the program pathwith the argument list args, replacing the current process (that is, the Python interpreter).The argument list may be a tuple or list of strings.\n\nF h Lib f L Bdff",
      "content_length": 2248,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 416,
      "content": "os\n\n391\n\nexecve(path, args, env)\n\nExecutes a new program like execv() but additionally accepts a dictionary, env, that defines the environment in which the program runs. envmust be a dictionary mapping strings to strings.\n\nexecvp(path, args)\n\nLike execv(path, args) but duplicates the shell’s actions in searching for an exe- cutable file in a list of directories.The directory list is obtained from environ['PATH'].\n\nexecvpe(path, args, env)\n\nLike execvp() but with an additional environment variable as in the execve() func- tion.\n\n_exit(n)\n\nExits immediately to the system with status n, without performing any cleanup actions. This is typically only done in child processes created by fork().This is also different than calling sys.exit(), which performs a graceful shutdown of the interpreter.The exit code nis application-dependent, but a value of 0 usually indicates success, whereas a nonzero value indicates an error of some kind. Depending on the system, a number of standard exit code values may be defined:\n\nValue EX_OK\n\nEX_USAGE\n\nEX_DATAERR\n\nEX_NOINPUT\n\nEX_NOUSER\n\nEX_NOHOST\n\nEX_NOTFOUND\n\nEX_UNAVAILABLE\n\nEX_SOFTWARE\n\nEX_OSERR\n\nEX_OSFILE\n\nEX_CANTCREAT\n\nEX_IOERR\n\nEX_TEMPFAIL\n\nEX_PROTOCOL\n\nDescription No errors. Incorrect command usage. Incorrect input data. Missing input. User doesn’t exist. Host doesn’t exist. Not found. Service unavailable. Internal software error. Operating system error. File system error. Can’t create output. I/O error. Temporary failure. Protocol error. Insufficient permissions. Configuration error.\n\nEX_NOPERM\n\nEX_CONFIG\n\nfork()\n\nCreates a child process. Returns 0 in the newly created child process and the child’s process ID in the original process.The child process is a clone of the original process and shares many resources such as open files (UNIX).\n\nF h Lib f L Bdff",
      "content_length": 1816,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 417,
      "content": "392\n\nChapter 19 Operating System Services\n\nforkpty()\n\nCreates a child process using a new pseudo-terminal as the child’s controlling terminal. Returns a pair (pid, fd), in which pidis 0 in the child and fdis a file descriptor of the master end of the pseudo-terminal.This function is available only in certain versions of UNIX.\n\nkill(pid, sig)\n\nSends the process pidthe signal sig.A list of signal names can be found in the signal module (UNIX).\n\nkillpg(pgid, sig)\n\nSends the process group pgidthe signal sig. A list of signal names can be found in the signal module (UNIX).\n\nnice(increment)\n\nAdds an increment to the scheduling priority (the “niceness”) of the process. Returns the new niceness.Typically, users can only decrease the priority of a process because increasing the priority requires root access.The effect of changing the priority is system-dependent, but decreasing the priority is commonly done to make a process run in the background in a way such that it doesn’t noticeably impact the performance of other processes (UNIX).\n\nplock(op)\n\nLocks program segments into memory, preventing them from being swapped.The value of opis an integer that determines which segments are locked.The value of opis platform-specific but is typically one of UNLOCK, PROCLOCK, TXTLOCK, or DATLOCK. These constants are not defined by Python but might be found in the <sys/lock.h> header file.This function is not available on all platforms and often can be performed only by a process with an effective user ID of 0 (root) (UNIX).\n\npopen(command [, mode [, bufsize]])\n\nOpens a pipe to or from a command.The return value is an open file object connected to the pipe, which can be read or written depending on whether modeis 'r' (the default) or 'w'. bufsizehas the same meaning as in the built-in open() function.The exit status of the command is returned by the close() method of the returned file object, except that when the exit status is zero, None is returned.\n\nspawnv(mode, path, args)\n\nExecutes the program pathin a new process, passing the arguments specified in argsas command-line parameters. argscan be a list or a tuple.The first element of args should be the name of the program. modeis one of the following constants:\n\nConstant P_WAIT\n\nP_NOWAIT\n\nP_NOWAITO\n\nDescription Executes the program and waits for it to terminate. Returns the pro- gram’s exit code. Executes the program and returns the process handle. Same as P_NOWAIT.\n\nF h Lib f L Bdff",
      "content_length": 2455,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 418,
      "content": "os\n\n393\n\nConstant P_OVERLAY\n\nP_DETACH\n\nDescription Executes the program and destroys the calling process (same as the exec functions). Executes the program and detaches from it. The calling program contin- ues to run but cannot wait for the spawned process.\n\nspawnv() is available on Windows and some versions of UNIX.\n\nspawnve(mode, path, args, env)\n\nExecutes the program pathin a new process, passing the arguments specified in argsas command-line parameters and the contents of the mapping envas the environment. argscan be a list or a tuple. modehas the same meaning as described for spawnv().\n\nspawnl(mode, path, arg1, ..., argn)\n\nThe same as spawnv() except that all the arguments are supplied as extra parameters.\n\nspawnle(mode, path, arg1, ... , argn, env)\n\nThe same as spawnve() except that the arguments are supplied as parameters.The last parameter is a mapping containing the environment variables.\n\nspawnlp(mode, file, arg1, ... , argn)\n\nThe same as spawnl() but looks for fileusing the settings of the PATH environment variable (UNIX).\n\nspawnlpe(mode, file, arg1, ... , argn, env)\n\nThe same as spawnle() but looks for fileusing the settings of the PATH environment variable (UNIX).\n\nspawnvp(mode, file, args)\n\nThe same as spawnv() but looks for fileusing the settings of the PATH environment variable (UNIX).\n\nspawnvpe(mode, file, args, env)\n\nThe same as spawnve() but looks for fileusing the settings of the PATH environment variable (UNIX).\n\nstartfile(path [, operation])\n\nLaunches the application associated with the file path.This performs the same action as would occur if you double-clicked the file in Windows Explorer.The function returns as soon as the application is launched. Furthermore, there is no way to wait for comple- tion or to obtain exit codes from the application. pathis a relative to the current direc- tory. operationis an optional string that specifies the action to perform when opening path. By default, it is set to 'open’, but it may be set to 'print', 'edit', 'explore', or 'find' (the exact list depends on the type of path(Windows)).\n\nsystem(command)\n\nExecutes command(a string) in a subshell. On UNIX, the return value is the exit status of the process as returned by wait(). On Windows, the exit code is always 0.The subprocess module provides considerably more power and is the preferred way to launch subprocesses.\n\nF h Lib f L Bdff",
      "content_length": 2383,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 419,
      "content": "394\n\nChapter 19 Operating System Services\n\ntimes()\n\nReturns a 5-tuple of floating-point numbers indicating accumulated times in seconds. On UNIX, the tuple contains the user time, system time, children’s user time, children’s system time, and elapsed real time in that order. On Windows, the tuple contains the user time, system time, and zeros for the other three values.\n\nwait([pid])\n\nWaits for completion of a child process and returns a tuple containing its process ID and exit status.The exit status is a 16-bit number whose low byte is the signal number that killed the process and whose high byte is the exit status (if the signal number is zero).The high bit of the low byte is set if a core file was produced. pid, if given, speci- fies the process to wait for. If it’s omitted, wait() returns when any child process exits (UNIX).\n\nwaitpid(pid, options)\n\nWaits for a change in the state of a child process given by process ID pidand returns a tuple containing its process ID and exit status indication, encoded as for wait(). optionsshould be 0 for normal operation or WNOHANG to avoid hanging if no child process status is available immediately.This function can also be used to gather informa- tion about child processes that have only stopped executing for some reason. Setting optionsto WCONTINUED gathers information from a child when it resumes operation after being stopped via job control. Setting optionsto WUNTRACED gathers information from a child that has been stopped, but from which no status information has been reported yet.\n\nwait3([options])\n\nThe same as waitpid() except that the function waits for a change in any child process. Returns a 3-tuple (pid, status, rusage), where pidis the child process ID, statusis the exit status code, and rusagecontains resource usage information as returned by resource.getrusage().The optionsparameter has the same meaning as for waitpid().\n\nwait4(pid, options)\n\nThe same as waitpid() except that the return result is the same tuple as returned by wait3().\n\nThe following functions take a process status code as returned by waitpid(), wait3(), or wait4() and are used to examine the state of the process (UNIX).\n\nWCOREDUMP(status)\n\nReturns True if the process dumped core.\n\nWIFEXITED(status)\n\nReturns True if the process exited using the exit() system call.\n\nWEXITSTATUS(status)\n\nIf WIFEXITED(status) is true, the integer parameter to the exit() system call is returned. Otherwise, the return value is meaningless.\n\nF h Lib f L Bdff",
      "content_length": 2497,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 420,
      "content": "os\n\n395\n\nWIFCONTINUED(status)\n\nReturns True if the process has resumed from a job-control stop.\n\nWIFSIGNALED(status)\n\nReturns True if the process exited due to a signal.\n\nWIFSTOPPED(status)\n\nReturns True if the process has been stopped.\n\nWSTOPSIG(status)\n\nReturns the signal that caused the process to stop.\n\nWTERMSIG(status)\n\nReturns the signal that caused the process to exit.\n\nSystem Configuration The following functions are used to obtain system configuration information:\n\nconfstr(name)\n\nReturns a string-valued system configuration variable. nameis a string specifying the name of the variable.The acceptable names are platform-specific, but a dictionary of known names for the host system is found in os.confstr_names. If a configuration value for a specified name is not defined, the empty string is returned. If nameis unknown, ValueError is raised.An OSError may also be raised if the host system doesn’t support the configuration name.The parameters returned by this function most- ly pertain to the build environment on the host machine and include paths of system utilities, compiler options for various program configurations (for example, 32-bit, 64- bit, and large-file support), and linker options (UNIX).\n\ngetloadavg()\n\nReturns a 3-tuple containing the average number of items in the system run-queue over the last 1, 5, and 15 minutes (UNIX).\n\nsysconf(name)\n\nReturns an integer-valued system-configuration variable. nameis a string specifying the name of the variable.The names defined on the host system can be found in the dic- tionary os.sysconf_names. Returns -1 if the configuration name is known but the value is not defined. Otherwise, a ValueError or OSError may be raised. Some sys- tems may define more than 100 different system parameters. However, the following list details the parameters defined by POSIX.1 that should be available on most UNIX systems:\n\nParameter \"SC_ARG_MAX\"\n\nDescription Maximum length of the arguments that can be used with exec(). Maximum number of processes per user ID. Number of clock ticks per second.\n\n\"SC_CHILD_MAX\"\n\n\"SC_CLK_TCK\" \"SC_NGROUPS_MAX\" Maximum number of simultaneous supplementary group IDs. \"SC_STREAM_MAX\" Maximum number of streams a process can open at one time.\n\nF h Lib f L Bdff",
      "content_length": 2256,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 421,
      "content": "396\n\nChapter 19 Operating System Services\n\nParameter \"SC_TZNAME_MAX\" Maximum number of bytes in a time zone name. \"SC_OPEN_MAX\" \"SC_JOB_CONTROL\" System supports job control. \"SC_SAVED_IDS\"\n\nDescription\n\nMaximum number of files a process can open at one time.\n\nIndicates whether each process has a saved set-user-ID and a saved set-group-ID.\n\nurandom(n)\n\nReturns a string containing nrandom bytes generated by the system (for example, /dev/urandom on UNIX).The returned bytes are suitable for cryptography.\n\nExceptions The os module defines a single exception to indicate errors.\n\nerror\n\nException raised when a function returns a system-related error.This is the same as the built-in exception OSError.The exception carries two values: errno and strerr.The first contains the integer error value as described for the errno module.The latter con- tains a string error message. For exceptions involving the file system, the exception also contains a third attribute, filename, which is the filename passed to the function.\n\nos.path The os.path module is used to manipulate pathnames in a portable manner. It’s imported by the os module.\n\nabspath(path)\n\nReturns an absolute version of the path name path, taking the current working direc- tory into account. For example, abspath('../Python/foo') might return '/home/beazley/Python/foo'.\n\nbasename(path)\n\nReturns the base name of path name path. For example, basename('/usr/local/ python') returns 'python'.\n\ncommonprefix(list)\n\nReturns the longest string that’s a prefix of all strings in list. If listis empty, the empty string is returned.\n\ndirname(path)\n\nReturns the directory name of path name path. For example, dirname('/usr/local/ python') returns '/usr/local'.\n\nexists(path)\n\nReturns True if pathrefers to an existing path. Returns False if pathrefers to a bro- ken symbolic link.\n\nF h Lib f L Bdff",
      "content_length": 1853,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 422,
      "content": "os.path\n\n397\n\nexpanduser(path)\n\nReplaces path names of the form '~user' with a user’s home directory. If the expan- sion fails or pathdoes not begin with '~', the path is returned unmodified.\n\nexpandvars(path)\n\nExpands environment variables of the form '$name' or '${name}' in path. Malformed or nonexistent variable names are left unchanged.\n\ngetatime(path)\n\nReturns the time of last access as the number of seconds since the epoch (see the time module).The return value may be a floating-point number if os.stat_float_times() returns True.\n\ngetctime(path)\n\nReturns the time of last modification on UNIX and the time of creation on Windows. The time is returned as the number of seconds since the epoch (see the time module). The return value may be a floating-point number in certain cases (see getatime()).\n\ngetmtime(path)\n\nReturns the time of last modification as the number of seconds since the epoch (see the time module).The return value may be a floating-point number in certain cases (see getatime()).\n\ngetsize(path)\n\nReturns the file size in bytes.\n\nisabs(path)\n\nReturns True if pathis an absolute path name (begins with a slash).\n\nisfile(path)\n\nReturns True if pathis a regular file.This function follows symbolic links, so both islink() and isfile() can be true for the same path.\n\nisdir(path)\n\nReturns True if pathis a directory. Follows symbolic links.\n\nislink(path)\n\nReturns True if pathrefers to a symbolic link. Returns False if symbolic links are unsupported.\n\nismount(path)\n\nReturns True if pathis a mount point.\n\njoin(path1 [, path2 [, ...]])\n\nIntelligently joins one or more path components into a pathname. For example, join('home', 'beazley', 'Python') returns 'home/beazley/Python'.\n\nlexists(path)\n\nReturns True if pathexists. Returns True for all symbolic links, even if the link is bro- ken.\n\nF h Lib f L Bdff",
      "content_length": 1835,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 423,
      "content": "398\n\nChapter 19 Operating System Services\n\nnormcase(path)\n\nNormalizes the case of a path name. On non-case-sensitive file systems, this converts pathto lowercase. On Windows, forward slashes are also converted to backslashes.\n\nnormpath(path)\n\nNormalizes a path name.This collapses redundant separators and up-level references so that 'A//B', 'A/./B', and 'A/foo/../B' all become 'A/B'. On Windows, forward slashes are converted to backslashes.\n\nrealpath(path)\n\nReturns the real path of path, eliminating symbolic links if any (UNIX).\n\nrelpath(path [, start])\n\nReturns a relative path to pathfrom the current working directory. startcan be sup- plied to specify a different starting directory.\n\nsamefile(path1, path2)\n\nReturns True if path1and path2refer to the same file or directory (UNIX).\n\nsameopenfile(fp1, fp2)\n\nReturns True if the open file objects fp1and fp2refer to the same file (UNIX).\n\nsamestat(stat1, stat2)\n\nReturns True if the stat tuples stat1and stat2as returned by fstat(), lstat(), or stat() refer to the same file (UNIX).\n\nsplit(path)\n\nSplits pathinto a pair (head, tail), where tailis the last pathname component and headis everything leading up to that. For example, '/home/user/foo' gets split into ('/home/ user', 'foo').This tuple is the same as would be returned by (dirname(), basename()).\n\nsplitdrive(path)\n\nSplits pathinto a pair (drive, filename) where driveis either a drive specification or the empty string. driveis always the empty string on machines without drive speci- fications.\n\nsplitext(path)\n\nSplits a path name into a base filename and suffix. For example, splitext('foo.txt') returns ('foo', '.txt').\n\nsplitunc(path)\n\nSplits a path name into a pair (unc,rest) where uncis a UNC (Universal Naming Convention) mount point and restthe remainder of the path (Windows).\n\nsupports_unicode_filenames\n\nVariable set to True if the file system allows Unicode filenames.\n\nF h Lib f L Bdff",
      "content_length": 1919,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 424,
      "content": "signal\n\n399\n\nNote\n\nOn Windows, some care is required when working with filenames that include a drive let- ter (for example, 'C:spam.txt'). In most cases, filenames are interpreted as being relative to the current working directory. For example, if the current directory is 'C:\\Foo\\', then the file 'C:spam.txt' is interpreted as the file 'C:\\Foo\\C:spam.txt', not the file 'C:\\spam.txt'.\n\nSee Also:\n\nfnmatch (p. 316), glob (p. 317), os (p. 378).\n\nsignal The signal module is used to write signal handlers in Python. Signals usually corre- spond to asynchronous events that are sent to a program due to the expiration of a timer, arrival of incoming data, or some action performed by a user.The signal interface emulates that of UNIX, although parts of the module are supported on other platforms.\n\nalarm(time)\n\nIf timeis nonzero, a SIGALRM signal is scheduled to be sent to the program in time seconds.Any previously scheduled alarm is canceled. If timeis zero, no alarm is sched- uled and any previously set alarm is canceled. Returns the number of seconds remain- ing before any previously scheduled alarm or zero if no alarm was scheduled (UNIX).\n\ngetsignal(signalnum)\n\nReturns the signal handler for signal signalnum.The returned object is a callable Python object.The function may also return SIG_IGN for an ignored signal, SIG_DFL for the default signal handler, or None if the signal handler was not installed from the Python interpreter.\n\ngetitimer(which)\n\nReturns the current value of an internal timer identified by which.\n\npause()\n\nGoes to sleep until the next signal is received (UNIX).\n\nset_wakeup_fd(fd)\n\nSets a file descriptor fdon which a '\\0' byte will be written when a signal is received. This, in turn, can be used to handle signals in programs that are polling file descriptors using functions such as those found in the select module.The file described by fd must be opened in non-blocking mode for this to work.\n\nsetitimer(which, seconds [, interval])\n\nSets an internal timer to generate a signal after secondsseconds and repeatedly there- after every intervalseconds. Both of these parameters are specified as floating-point numbers.The whichparameter is one of ITIMER_REAL, ITIMER_VIRTUAL, or ITIMER_PROF.The choice of whichdetermines what signal is generated after the timer has expired. SIGALRM is generated for ITIMER_REAL, SIGVTALRM is generated for\n\nF h Lib f L Bdff",
      "content_length": 2396,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 425,
      "content": "400\n\nChapter 19 Operating System Services\n\nITIMER_VIRTUAL, and SIGPROF is generated for ITIMER_PROF. Set secondsto 0 to clear a timer. Returns a tuple (seconds, interval) with the previous settings of the timer.\n\nsiginterrupt(signalnum, flag)\n\nSets the system call restart behavior for a given signal number. If flagis False, system calls interrupted by signal signalnumwill be automatically restarted. If set True, the system call will be interrupted.An interrupted system call will typically result in an OSError or IOError exception where the associated error number is set to errno.EINTR or errno.EAGAIN.\n\nsignal(signalnum, handler)\n\nSets a signal handler for signal signalnumto the function handler. handlermust be a callable Python object taking two arguments: the signal number and frame object. SIG_IGN or SIG_DFL can also be given to ignore a signal or use the default signal han- dler, respectively.The return value is the previous signal handler, SIG_IGN, or SIG_DFL. When threads are enabled, this function can only be called from the main thread. Otherwise, a ValueError exception is raised.\n\nIndividual signals are identified using symbolic constants of the form SIG*.These\n\nnames correspond to integer values that are machine-specific.Typical values are as follows:\n\nSignal Name SIGABRT\n\nSIGALRM\n\nSIGBUS\n\nSIGCHLD\n\nSIGCLD\n\nSIGCONT\n\nSIGFPE\n\nSIGHUP\n\nSIGILL\n\nSIGINT\n\nSIGIO\n\nSIGIOT\n\nSIGKILL\n\nSIGPIPE\n\nSIGPOLL\n\nSIGPROF\n\nSIGPWR\n\nSIGQUIT\n\nSIGSEGV\n\nSIGSTOP\n\nSIGTERM\n\nSIGTRAP\n\nDescription Abnormal termination Alarm Bus error Change in child status Change in child status Continue Floating-point error Hang up Illegal instruction Terminal interrupt character Asynchronous I/O Hardware fault Terminate Write to pipe, no readers Pollable event Profiling alarm Power failure Terminal quit character Segmentation fault Stop Termination Hardware fault Terminal stop character Control TTY\n\nSIGTSTP SIGTTIN\n\nF h Lib f L Bdff",
      "content_length": 1922,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 426,
      "content": "signal\n\n401\n\nSignal Name SIGTTOU\n\nSIGURG\n\nSIGUSR1\n\nSIGUSR2\n\nSIGVTALRM\n\nSIGWINCH\n\nSIGXCPU\n\nDescription Control TTY Urgent condition User defined User defined Virtual time alarm Window size change CPU limit exceeded File size limit exceeded\n\nSIGXFSZ\n\nIn addition, the module defines the following variables:\n\nVariable SIG_DFL\n\nSIG_IGN\n\nNSIG\n\nDescription Signal handler that invokes the default signal handler Signal handler that ignores a signal One more than the highest signal number\n\nExample The following example illustrates a timeout on establishing a network connection (the socket module already provides a timeout option so this example is merely meant to illustrate the basic concept of using the signal module).\n\nimport signal, socket def handler(signum, frame): print 'Timeout!' raise IOError, 'Host not responding.'\n\nsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) signal.signal(signal.SIGALRM, handler) signal.alarm(5) # 5-second alarm sock.connect('www.python.org', 80) # Connect signal.alarm(0) # Clear alarm\n\nNotes\n\nn Signal handlers remain installed until explicitly reset, with the exception of\n\nSIGCHLD (whose behavior is implementation-specific).\n\nn It’s not possible to temporarily disable signals. n Signals are only handled between the atomic instructions of the Python inter-\n\npreter.The delivery of a signal can be delayed by long-running calculations writ- ten in C (as might be performed in an extension module).\n\nn If a signal occurs during an I/O operation, the I/O operation may fail with an exception. In this case, the errno value is set to errno.EINTR to indicate an interrupted system call.\n\nn Certain signals such as SIGSEGV cannot be handled from Python. n Python installs a small number of signal handlers by default. SIGPIPE is ignored, SIGINT is translated into a KeyboardInterrupt exception, and SIGTERM is caught in order to perform cleanup and invoke sys.exitfunc.\n\nF h Lib f L Bdff",
      "content_length": 1931,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 427,
      "content": "402\n\nChapter 19 Operating System Services\n\nn Extreme care is needed if signals and threads are used in the same program. Currently, only the main thread of execution can set new signal handlers or receive signals.\n\nn Signal handling on Windows is of only limited functionality.The number of sup-\n\nported signals is extremely limited on this platform.\n\nsubprocess The subprocess module contains functions and objects that generalize the task of cre- ating new processes, controlling input and output streams, and handling return codes. The module centralizes functionality contained in a variety of other modules such as os, popen2, and commands.\n\nPopen(args, **parms)\n\nExecutes a new command as a subprocess and returns a Popen object representing the new process.The command is specified in argsas either a string, such as 'ls -l', or as a list of strings, such as ['ls', '-l']. parmsrepresents a collection of keyword arguments that can be set to control various properties of the subprocess.The following keyword parameters are understood:\n\nKeyword bufsize\n\nclose_fds\n\ncreation_flags\n\ncwd\n\nenv\n\nexecutable\n\npreexec_fn\n\nshell\n\nDescription Specifies the buffering behavior, where 0 is unbuffered, 1 is line-buffered, a negative value uses the system default, and other positive values specify the approximate buffer size. The default value is 0. If True, all file descriptors except 0, 1, and 2 are closed prior to execution of the child process. The default value is False. Specifies process-creation flags on Windows. The only flag currently available is CREATE_NEW_CONSOLE. The default value is 0. The directory in which the command will execute. The current directory of the child process is changed to cwd prior to exe- cution. The default value is None, which uses the current directory of the parent process. Dictionary of environment variables for the new process. The default value is None, which uses the environment variables of the parent process. Specifies the name of the executable program to use. This is rarely needed because the program name is already included in args. If shell has been given, this parameter specifies the name of the shell to use. The default value is None. Specifies a function that will be called in the child process just before the command is executed. The function should take no arguments. If True, the command is executed using the UNIX shell like the os.system() function. The default shell is /bin/sh, but this can be changed by also setting executable. The default value of shell is None.\n\nF h Lib f L Bdff",
      "content_length": 2555,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 428,
      "content": "subprocess\n\n403\n\nKeyword startupinfo\n\nstderr\n\nstdin\n\nstdout\n\nDescription Provides startup flags used when creating processes on Windows. The default value is None. Possible values include STARTF_USESHOWWINDOW and STARTF_USESTDHANDLERS. File object representing the file to use for stderr in the child process. May be a file object created via open(), an integer file descriptor, or the special value PIPE, which indicates that a new pipe should be created. The default value is None. File object representing the file to use for stdin in the child process. May be set to the same values as stderr. The default value is None. File object representing the file to use for stdout in the child process. May be set to the same values as stderr. The default value is None.\n\nuniversal_newlines If True, the files representing stdin, stdout, and stderr\n\nare opened in text mode with universal newline mode enabled. See the open() function for a full description.\n\ncall(args, **parms)\n\nThis function is exactly the same as Popen(), except that it simply executes the com- mand and returns its status code instead (that is, it does not return a Popen object).This function is useful if you just want to execute a command but are not concerned with capturing its output or controlling it in other ways.The parameters have the same meaning as with Popen().\n\ncheck_call(args, **parms)\n\nThe same as call() except that if the exit code is non-zero, the CalledProcessError exception is raised.This exception has the exit code stored in its returncode attribute. The Popen object preturned by Popen() has a variety of methods and attributes\n\nthat can be used for interacting with the subprocess.\n\np.communicate([input])\n\nCommunicates with the child process by sending the data supplied in inputto the standard input of the process. Once data is sent, the method waits for the process to ter- minate while collecting output received on standard output and standard error. Returns a tuple (stdout, stderr) where stdoutand stderrare strings. If no data is sent to the child process, inputis set to None (the default).\n\np.kill()\n\nKills the subprocess by sending it a SIGKILL signal on UNIX or calling the p.terminate() method on Windows.\n\np.poll()\n\nChecks to see if phas terminated. If so, the return code of the subprocess is returned. Otherwise, None is returned.\n\np.send_signal(signal)\n\nSends a signal to the subprocess. signalis a signal number as defined in the signal module. On Windows, the only supported signal is SIGTERM.\n\nF h Lib f L Bdff",
      "content_length": 2528,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 429,
      "content": "404\n\nChapter 19 Operating System Services\n\np.terminate()\n\nTerminates the subprocess by sending it a SIGTERM signal on UNIX or calling the Win32 API TerminateProcess function on Windows.\n\np.wait()\n\nWaits for pto terminate and returns the return code.\n\np.pid\n\nProcess ID of the child process.\n\np.returncode\n\nNumeric return code of the process. If None, the process has not terminated yet. If neg- ative, it indicates the process was terminated by a signal (UNIX).\n\np.stdin, p.stdout, p.stderr\n\nThese three attributes are set to open file objects whenever the corresponding I/O stream is opened as a pipe (for example, setting the stdoutargument in Popen() to PIPE).These file objects are provided so that the pipe can be connected to other sub- processes.These attributes are set to None if pipes are not in use.\n\nExamples\n\n# Execute a basic system command. Like os.system() ret = subprocess.call(\"ls -l\", shell=True)\n\n# Silently execute a basic system command ret = subprocess.call(\"rm –f *.java\",shell=True, stdout=open(\"/dev/null\"))\n\n# Execute a system command, but capture the output p = subprocess.Popen(\"ls -l\", shell=True, stdout=subprocess.PIPE) out = p.stdout.read()\n\n# Execute a command, but send input and receive output p = subprocess.Popen(\"wc\", shell=True, stdin=subprocess.PIPE,\n\nstdout=subprocess.PIPE, stderr=subprocess.PIPE)\n\nout, err = p.communicate(s) # Send string s to the process\n\n# Create two subprocesses and link them together via a pipe p1 = subprocess.Popen(\"ls -l\", shell=True, stdout=subprocess.PIPE) p2 = subprocess.Popen(\"wc\",shell=True, stdin=p1.stdout,\n\nstdout=subprocess.PIPE)\n\nout = p2.stdout.read()\n\nNotes\n\nn As a general rule, it is better to supply the command line as a list of strings instead of a single string with a shell command (for example, ['wc','filename'] instead of 'wc filename'). On many systems, it is com- mon for filenames to include funny characters and spaces (for example, the “Documents and Settings” folder on Windows). If you stick to supplying com- mand arguments as a list, everything will work normally. If you try to form a shell command, you will have to take additional steps to make sure special charac- ters and spaces are properly escaped.\n\nF h Lib f L Bdff",
      "content_length": 2226,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 430,
      "content": "time\n\n405\n\nn On Windows, pipes are opened in binary file mode.Thus, if you are reading text output from a subprocess, line endings will include the extra carriage return character ('\\r\\n' instead of '\\n'). If this is a concern, supply the universal_newlines option to Popen().\n\nn The subprocess module can not be used to control processes that expect to be running in a terminal or TTY.The most common example is any program that expects a user to enter a password (such as ssh, ftp, svn, and so on).To control these programs, look for third-party modules based on the popular “Expect” UNIX utility.\n\ntime The time module provides various time-related functions. In Python, time is measured as the number of seconds since the epoch.The epoch is the beginning of time (the point at which time = 0 seconds).The epoch is January 1, 1970, on UNIX and can be deter- mined by calling time.gmtime(0) on other systems.\n\nThe following variables are defined:\n\naccept2dyear\n\nA Boolean value that indicates whether two-digit years are accepted. Normally this is True, but it’s set to False if the environment variable $PYTHONY2K is set to a non- empty string.The value can be changed manually as well.\n\naltzone\n\nThe time zone used during daylight saving time (DST), if applicable.\n\ndaylight\n\nIs set to a nonzero value if a DST time zone has been defined.\n\ntimezone\n\nThe local (non-DST) time zone.\n\ntzname\n\nA tuple containing the name of the local time zone and the name of the local daylight saving time zone (if defined).\n\nThe following functions can be used:\n\nasctime([tuple])\n\nConverts a tuple representing a time as returned by gmtime() or localtime() to a string of the form 'Mon Jul 12 14:45:23 1999'. If no arguments are supplied, the current time is used.\n\nclock()\n\nReturns the current CPU time in seconds as a floating-point number.\n\nctime([secs])\n\nConverts a time expressed in seconds since the epoch to a string representing local time. ctime(secs) is the same as asctime(localtime(secs)). If secsis omitted or None, the current time is used.\n\nF h Lib f L Bdff",
      "content_length": 2059,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 431,
      "content": "406\n\nChapter 19 Operating System Services\n\ngmtime([secs])\n\nConverts a time expressed in seconds since the epoch to a time in UTC Coordinated Universal Time (a.k.a. Greenwich Mean Time).This function returns a struct_time object with the following attributes:\n\nAttribute tm_year\n\ntm_mon\n\nValue A four-digit value such as 1998 1-12\n\ntm_mday\n\n1-31\n\ntm_hour\n\n0-23\n\ntm_min\n\n0-59\n\ntm_sec\n\ntm_wday\n\ntm_yday\n\n0-61 0-6 (0=Monday) 1-366\n\ntm_isdst\n\n1, 0, 1\n\nThe tm_isdst attribute is 1 if DST is in effect, 0 if not, and -1 if no information is available. If secsis omitted or None, the current time is used. For backward compatibil- ity, the returned struct_time object also behaves like a 9-tuple containing the preced- ing attribute values in the same order as listed.\n\nlocaltime([secs])\n\nReturns a struct_time object as with gmtime(), but corresponding to the local time zone. If secsis omitted or None, the current time is used.\n\nmktime(tuple)\n\nThis function takes a struct_time object or tuple representing a time in the local time zone (in the same format as returned by localtime()) and returns a floating-point number representing the number of seconds since the epoch.An OverflowError exception is raised if the input value is not a valid time.\n\nsleep(secs)\n\nPuts the current process to sleep for secsseconds. secsis a floating-point number.\n\nstrftime(format [, tm])\n\nConverts a struct_time object tmrepresenting a time as returned by gmtime() or localtime() to a string (for backwards compatibility, tmmay also be a tuple represent- ing a time value). formatis a format string in which the following format codes can be embedded:\n\nDirective %a\n\n%A\n\n%b\n\n%B\n\n%c\n\n%d\n\nMeaning Locale’s abbreviated weekday name Locale’s full weekday name Locale’s abbreviated month name Locale’s full month name Locale’s appropriate date and time representation Day of the month as a decimal number [01-31] Hour (24-hour clock) as a decimal number [00-23]\n\n%H\n\nF h Lib f L Bdff",
      "content_length": 1956,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 432,
      "content": "time\n\n407\n\nDirective %I\n\n%j\n\n%m\n\n%M\n\n%p\n\n%S\n\n%U\n\n%w\n\n%W\n\n%x\n\n%X\n\n%y\n\n%Y\n\n%Z\n\nMeaning Hour (12-hour clock) as a decimal number [01-12] Day of the year as a decimal number [001-366] Month as a decimal number [01-12] Minute as a decimal number [00-59] Locale’s equivalent of either AM or PM Seconds as a decimal number [00-61] Week number of the year [00-53] (Sunday as first day) Weekday as a decimal number [0-6] (0 = Sunday) Week number of the year (Monday as first day) Locale’s appropriate date representation Locale’s appropriate time representation Year without century as a decimal number [00-99] Year with century as a decimal number Time zone name (or by no characters if no time zone exists) The % character\n\n%%\n\nThe format codes can include a width and precision in the same manner as used with the % operator on strings. ValueError is raised if any of the tuple fields are out of range. If tupleis omitted, the time tuple corresponding to the current time is used.\n\nstrptime(string [, format])\n\nParses a string representing a time and returns a struct_time object as returned by localtime() or gmtime().The formatparameter uses the same specifiers as used by strftime() and defaults to '%a %b %d %H:%M:%S %Y'.This is the same format as produced by the ctime() function. If the string cannot be parsed, a ValueError exception is raised.\n\ntime()\n\nReturns the current time as the number of seconds since the epoch in UTC (Coordinated Universal Time).\n\ntzset()\n\nResets the time zone setting based on the value of the TZ environment variable on UNIX. For example:\n\nos.environ['TZ'] = 'US/Mountain' time.tzset()\n\nos.environ['TZ'] = \"CST+06CDT,M4.1.0,M10.5.0\" time.tzset()\n\nNotes\n\nn When two-digit years are accepted, they’re converted to four-digit years accord- ing to the POSIX X/Open standard, where the values 69-99 are mapped to 1969-1999 and the values 0-68 are mapped to 2000-2068.\n\nF h Lib f L Bdff",
      "content_length": 1910,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 433,
      "content": "408\n\nChapter 19 Operating System Services\n\nn The accuracy of the time functions is often much less than what might be sug- gested by the units in which time is represented. For example, the operating sys- tem might only update the time 50–100 times a second.\n\nSee Also:\n\ndatetime (p. 336)\n\nwinreg The winreg module (_winreg in Python 2) provides a low-level interface to the Windows registry.The registry is a large hierarchical tree in which each node is called a key.The children of a particular key are known as subkeys and may contain additional subkeys or values. For example, the setting of the Python sys.path variable is typically contained in the registry as follows:\n\n\\HKEY_LOCAL_MACHINE\\Software\\Python\\PythonCore\\2.6\\PythonPath\n\nIn this case, Software is a subkey of HKEY_LOCAL_MACHINE, Python is a subkey of Software, and so forth.The value of the PythonPath key contains the actual path set- ting.\n\nKeys are accessed through open and close operations. Open keys are represented by special handles (which are wrappers around the integer handle identifiers normally used by Windows).\n\nCloseKey(key)\n\nCloses a previously opened registry key with handle key.\n\nConnectRegistry(computer_name, key)\n\nReturns a handle to a predefined registry key on another computer. computer_nameis the name of the remote machine as a string of the \\\\computername. If computer_nameis None, the local registry is used. keyis a predefined handle such as HKEY_CURRENT_USER or HKEY_ USERS. Raises EnvironmentError on failure.The fol- lowing list shows all HKEY_* values defined in the _winreg module:\n\nn HKEY_CLASSES_ROOT\n\nn HKEY_CURRENT_CONFIG\n\nn HKEY_CURRENT_USER\n\nn HKEY_DYN_DATA\n\nn HKEY_LOCAL_MACHINE\n\nn HKEY_PERFORMANCE_DATA\n\nn HKEY_USERS\n\nCreateKey(key, sub_key)\n\nCreates or opens a key and returns a handle. keyis a previously opened key or a prede- fined key defined by the HKEY_* constants. sub_keyis the name of the key that will be opened or created. If keyis a predefined key, sub_keymay be None, in which case key is returned.\n\nF h Lib f L Bdff",
      "content_length": 2044,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 434,
      "content": "winreg\n\n409\n\nDeleteKey(key, sub_key)\n\nDeletes sub_key. keyis an open key or one of the predefined HKEY_* constants. sub_keyis a string that identifies the key to delete. sub_keymust not have any sub- keys; otherwise, EnvironmentError is raised.\n\nDeleteValue(key, value)\n\nDeletes a named value from a registry key. keyis an open key or one of the predefined HKEY_* constants. valueis a string containing the name of the value to remove.\n\nEnumKey(key, index)\n\nReturns the name of a subkey by index. keyis an open key or one of the predefined HKEY_* constants. indexis an integer that specifies the key to retrieve. If indexis out of range, an EnvironmentError is raised.\n\nEnumValue(key, index)\n\nReturns a value of an open key. keyis an open key or a predefined HKEY_* constant. indexis an integer specifying the value to retrieve.The function returns a tuple (name, data, type) in which nameis the value name, datais an object holding the value data, and typeis an integer that specifies the type of the value data.The following type codes are currently defined:\n\nCode REG_BINARY\n\nREG_DWORD\n\nREG_DWORD_LITTLE_ENDIAN\n\nREG_DWORD_BIG_ENDIAN\n\nREG_EXPAND_SZ\n\nREG_LINK\n\nREG_MULTI_SZ REG_NONE\n\nREG_RESOURCE_LIST\n\nDescription Binary data 32-bit number 32-bit little-endian number 32-bit number in big-endian format Null-terminated string with unexpanded references to environment variables Unicode symbolic link Sequence of null-terminated strings No defined value type Device driver resource list Null-terminated string\n\nREG_SZ\n\nExpandEnvironmentStrings(s)\n\nExpands environment strings of the form %name% in Unicode string s.\n\nFlushKey(key)\n\nWrites the attributes of keyto the registry, forcing changes to disk.This function should only be called if an application requires absolute certainty that registry data is stored on disk. It does not return until data is written. It is not necessary to use this function under normal circumstances.\n\nRegLoadKey(key, sub_key, filename)\n\nCreates a subkey and stores registration information from a file into it. keyis an open key or a predefined HKEY_* constant. sub_keyis a string identifying the subkey to load. filenameis the name of the file from which to load data.The contents of this file must\n\nF h Lib f L Bdff",
      "content_length": 2250,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 435,
      "content": "410\n\nChapter 19 Operating System Services\n\nbe created with the SaveKey() function, and the calling process must have SE_RESTORE_ PRIVILEGE for this to work. If keywas returned by ConnectRegistry(), filename should be a path that’s relative to the remote computer.\n\nOpenKey(key, sub_key[, res [, sam]])\n\nOpens a key. keyis an open key or an HKEY_* constant. sub_keyis a string identifying the subkey to open. resis a reserved integer that must be zero (the default). samis an integer defining the security access mask for the key.The default is KEY_READ. Here are the other possible values for sam:\n\nn KEY_ALL_ACCESS\n\nn KEY_CREATE_LINK\n\nn KEY_CREATE_SUB_KEY\n\nn KEY_ENUMERATE_SUB_KEYS\n\nn KEY_EXECUTE\n\nn KEY_NOTIFY\n\nn KEY_QUERY_VALUE\n\nn KEY_READ\n\nn KEY_SET_VALUE\n\nn KEY_WRITE\n\nOpenKeyEx()\n\nSame as OpenKey().\n\nQueryInfoKey(key)\n\nReturns information about a key as a tuple (num_subkeys, num_values, last_modified) in which num_subkeysis the number of subkeys, num_valuesis the number of values, and last_modifiedis a long integer containing the time of last modification.Time is measured from January 1, 1601, in units of 100 nanoseconds.\n\nQueryValue(key,sub_key)\n\nReturns the unnamed value for a key as a string. keyis an open key or an HKEY_* con- stant. sub_keyis the name of the subkey to use, if any. If omitted, the function returns the value associated with keyinstead.This function returns the data for the first value with a null name. However, the type is returned (use QueryValueEx instead).\n\nQueryValueEx(key, value_name)\n\nReturns a tuple (value, type) containing the data value and type for a key. keyis an open key or HKEY_* constant. value_nameis the name of the value to return.The returned type is one of the integer codes as described for the EnumValue() function.\n\nSaveKey(key, filename)\n\nSaves keyand all its subkeys to a file. keyis an open key or a predefined HKEY_* con- stant. filenamemust not already exist and should not include a filename extension. Furthermore, the caller must have backup privileges for the operation to succeed.\n\nF h Lib f L Bdff",
      "content_length": 2072,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 436,
      "content": "winreg\n\n411\n\nSetValue(key, sub_key, type, value)\n\nSets the value of a key. keyis an open key or HKEY_* constant. sub_keyis the name of the subkey with which to associate the value. typeis an integer type code, currently limited to REG_SZ. valueis a string containing the value data. If sub_keydoes not exist, it is created. keymust have been opened with KEY_SET_VALUE access for this function to succeed.\n\nSetValueEx(key, value_name, reserved, type, value)\n\nSets the value field of a key. keyis an open key or an HKEY_* constant. value_nameis the name of the value. typeis an integer type code as described for the EnumValue() function. valueis a string containing the new value.When the values of numeric types (for example, REG_DWORD) are being set, valueis still a string containing the raw data. This string can be created using the struct module. reservedis currently ignored and can be set to anything (the value is not used).\n\nNotes\n\nn Functions that return a Windows HKEY object return a special registry handle\n\nobject described by the class PyHKEY.This object can be converted into a Windows handle value using int().This object can also be used with the context-management protocol to automatically close the underlying handle—for example:\n\nwith winreg.OpenKey(winreg.HKEY_LOCAL_MACHINE, \"spam\") as key:\n\nstatements\n\nF h Lib f L Bdff",
      "content_length": 1344,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 437,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 438,
      "content": "20\n\nThreads and Concurrency\n\nThis chapter describes library modules and programming strategies for writing con-\n\ncurrent programs in Python.Topics include threads, message passing, multiprocessing, and coroutines. Before covering specific library modules, some basic concepts are first described.\n\nBasic Concepts A running program is called a process. Each process has its own system state, which includes memory, lists of open files, a program counter that keeps track of the instruc- tion being executed, and a call stack used to hold the local variables of functions. Normally, a process executes statements one after the other in a single sequence of con- trol flow, which is sometimes called the main thread of the process.At any given time, the program is only doing one thing.\n\nA program can create new processes using library functions such as those found in\n\nthe os or subprocess modules (e.g., os.fork(), subprocess.Popen(), etc.). However, these processes, known as subprocesses, run as completely independent entities—each with their own private system state and main thread of execution. Because a subprocess is independent, it executes concurrently with the original process. That is, the process that created the subprocess can go on to work on other things while the subprocess carries out its own work behind the scenes.\n\nAlthough processes are isolated, they can communicate with each other—something\n\nknown as interprocess communication (IPC). One of the most common forms of IPC is based on message passing.A message is simply a buffer of raw bytes. Primitive operations such as send() and recv() are then used to transmit or receive messages through an I/O channel such as a pipe or network socket.Another somewhat less common IPC mechanism relies upon memory-mapped regions (see the mmap module).With memory mapping, processes can create shared regions of memory. Modifications to these regions are then visible in all processes that happen to be viewing them.\n\nMultiple processes can be used by an application if it wants to work on multiple\n\ntasks at the same time—with each process responsible for part of the processing. However, another approach for subdividing work into tasks is to use threads.A thread is similar to a process in that it has its own control flow and execution stack. However, a thread runs inside the process that created it, sharing all of the data and system resources.Threads are useful when an application wants to perform tasks concurrently, but there is a potentially large amount of system state that needs to be shared by the tasks.\n\nF h Lib f L Bdff",
      "content_length": 2604,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 439,
      "content": "414\n\nChapter 20 Threads and Concurrency\n\nWhen multiple processes or threads are used, the host operating system is responsible\n\nfor scheduling their work.This is done by giving each process (or thread) a small time slice and rapidly cycling between all of the active tasks—giving each a portion of the available CPU cycles. For example, if your system had 10 active processes running, the operating system would allocate approximately 1/10th of its CPU time to each process and cycle between processes in rapid succession. On systems with more than one CPU core, the operating system can schedule processes so that each CPU is kept busy, exe- cuting processes in parallel.\n\nWriting programs that take advantage of concurrent execution is something that is intrinsically complicated.A major source of complexity concerns synchronization and access to shared data. In particular, attempts to update a data structure by multiple tasks at approximately the same time can lead to a corrupted and inconsistent program state (a problem formally known as a race condition).To fix these problems, concurrent pro- grams must identify critical sections of code and protect them using mutual-exclusion locks and other similar synchronization primitives. For example, if different threads were trying to write data to the same file at the same time, you might use a mutual exclusion lock to synchronize their operation so that once one of the threads starts writing, the other threads have to wait until it has finished before they are allowed to start writing. The code for this scenario typically looks like this:\n\nwrite_lock = Lock() ... # Critical section where writing occurs write_lock.acquire() f.write(\"Here's some data.\\n\") f.write(\"Here's more data.\\n\") ... write_lock.release()\n\nThere’s a joke attributed to Jason Whittington that goes as like this:“Why did the mul- tithreaded chicken cross the road? to To other side. get the”.This joke typifies the kinds of problems that arise with task synchronization and concurrent programming. If you’re scratching your head saying,“I don’t get it,” then it might be wise to do a bit more reading before diving into the rest of this chapter.\n\nConcurrent Programming and Python Python supports both message passing and thread-based concurrent programming on most systems.Although most programmers tend to be familiar with the thread interface, Python threads are actually rather restricted.Although minimally thread-safe, the Python interpreter uses an internal global interpreter lock (the GIL) that only allows a single Python thread to execute at any given moment.This restricts Python programs to run on a single processor regardless of how many CPU cores might be available on the sys- tem.Although the GIL is often a heated source of debate in the Python community, it is unlikely to be removed at any time in the foreseeable future.\n\nThe presence of the GIL has a direct impact on how many Python programmers address concurrent programming problems. If an application is mostly I/O bound, it is generally fine to use threads because extra processors aren’t going to do much to help a program that spends most of its time waiting for events. For applications that involve heavy amounts of CPU processing, using threads to subdivide work doesn’t provide any benefit and will make the program run slower (often much slower than you would guess). For this, you’ll want to rely on subprocesses and message passing.\n\nF h Lib f L Bdff",
      "content_length": 3472,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 440,
      "content": "multiprocessing\n\n415\n\nEven when threads are used, many programmers find their scaling properties to be\n\nrather mysterious. For example, a threaded network server that works fine with 100 threads may have horrible performance if it’s scaled up to 10,000 threads.As a general rule, you really don’t want to be writing programs with 10,000 threads because each thread requires its own system resources and the overhead associated with thread con- text switching, locking, and other matters starts to become significant (not to mention the fact that all threads are constrained to run on a single CPU).To deal with this, it is somewhat common to see such applications restructured as asynchronous event- handling systems. For example, a central event loop might monitor all of the I/O sources using the select module and dispatch asynchronous events to a large collec- tion of I/O handlers.This is the basis for library modules such as asyncore as well as popular third-party modules such as Twisted (http://twistedmatrix/com).\n\nLooking forward, message passing is a concept that you should probably embrace for\n\nany kind of concurrent programming in Python. Even when working with threads, an often-recommended approach is to structure your application as a collection of inde- pendent threads that exchange data through message queues.This particular approach tends to be less error-prone because it greatly reduces the need to use locks and other synchronization primitives. Message passing also naturally extends into networking and distributed systems. For example, if part of a program starts out as a thread to which you send messages, that component can later be migrated to a separate process or onto a dif- ferent machine by sending the messages over a network connection.The message pass- ing abstraction is also tied to advanced Python features such as coroutines. For example, a coroutine is a function that can receive and processe messages that are sent to it. So, by embracing message passing, you will find that you can write programs that have a great deal of flexibility.\n\nThe remainder of this chapter looks at different library modules for supporting con- current programming.At the end, more detailed information on common programming idioms is provided.\n\nmultiprocessing The multiprocessing module provides support for launching tasks in a subprocess, communicating and sharing data, and performing various forms of synchronization.The programming interface is meant to mimic the programming interface for threads in the threading module. However, unlike threads, it is important to emphasize that processes do not have any shared state.Thus, if a process modifies data, that change is local only to that process.\n\nThe features of the multiprocessing module are vast, making it one of the larger and most advanced built-in libraries. Covering every detail of the module is impossible here, but the essential parts of it along with examples will be given. Experienced pro- grammers should be able to take the examples and expand them to larger problems.\n\nProcesses All of the features of the multiprocessing module are focused on processes.They are described by the following class.\n\nF h Lib f L Bdff",
      "content_length": 3218,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 441,
      "content": "416\n\nChapter 20 Threads and Concurrency\n\nProcess([group [, target [, name [, args [, kwargs]]]]])\n\nA class that represents a task running in a subprocess.The arguments in the constructor should always been specified using keyword arguments. targetis a callable object that will execute when the process starts, argsis a tuple of positional arguments passed to target, and kwargsis a dictionary of keyword arguments passed to target. If args and kwargsare omitted, targetis called with no arguments. nameis a string that gives a descriptive name to the process. groupis unused and is always set to None. Its pres- ence here is simply to make the construction of a Process mimic the creation of a thread in the threading module.\n\nAn instance pof Process has the following methods:\n\np.is_alive()\n\nReturns True if pis still running.\n\np.join([timeout])\n\nWaits for process pto terminate. timeoutspecifies an optional timeout period.A process can be joined as many times as you wish, but it is an error for a process to try and join itself.\n\np.run()\n\nThe method that runs when the process starts. By default, this invokes targetthat was passed to the Process constructor.As an alternative, a process can be defined by inher- iting from Process and reimplementing run().\n\np.start()\n\nStarts the process.This launches the subprocess that represents the process and invokes p.run() in that subprocess.\n\np.terminate()\n\nForcefully terminates the process. If this is invoked, the process pis terminated immedi- ately without performing any kind of cleanup actions. If the process pcreated sub- processes of its own, those processes will turn into zombies. Some care is required when using this method. If pholds a lock or is involved with interprocess communication, terminating it might cause a deadlock or corrupted I/O.\n\nA Process instance palso has the following data attributes:\n\np.authkey\n\nThe process’ authentication key. Unless explicitly set, this is a 32-character string gener- ated by os.urandom().The purpose of this key is to provide security for low-level interprocess communication involving network connections. Such connections only work if both ends have the same authentication key.\n\np.daemon\n\nA Boolean flag that indicates whether or not the process is daemonic.A daemonic process is automatically terminated when the Python process that created it terminates. In addition, a daemonic process is prohibited from creating new processes on its own. The value of p.daemon must be set before a process is started using p.start().\n\nF h Lib f L Bdff",
      "content_length": 2550,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 442,
      "content": "multiprocessing\n\n417\n\np.exitcode\n\nThe integer exit code of the process. If the process is still running, this is None. If the value is negative, a value of –Nmeans the process was terminated by signal N.\n\np.name\n\nThe name of the process.\n\np.pid\n\nThe integer process ID of the process.\n\nHere is an example that shows how to create and launch a function (or other\n\ncallable) as a separate process:\n\nimport multiprocessing import time\n\ndef clock(interval): while True:\n\nprint(\"The time is %s\" % time.ctime()) time.sleep(interval)\n\nif __name__ == '__main__':\n\np = multiprocessing.Process(target=clock, args=(15,)) p.start()\n\nHere is an example that shows how to define this process as a class that inherits from Process:\n\nimport multiprocessing import time\n\nclass ClockProcess(multiprocessing.Process):\n\ndef __init__(self,interval):\n\nmultiprocessing.Process.__init__(self) self.interval = interval\n\ndef run(self):\n\nwhile True:\n\nprint(\"The time is %s\" % time.ctime()) time.sleep(self.interval)\n\nif __name__ == '__main__': p = ClockProcess(15) p.start()\n\nIn both examples, the time should be printed by the subprocess every 15 seconds. It is important to emphasize that for cross-platform portability, new processes should only be created by the main program as shown.Although this is optional on UNIX, it is required on Windows. It should also be noted that on Windows, you will probably need to run the preceding examples in the command shell (command.exe) instead of a Python IDE, such as IDLE.\n\nInterprocess Communication Two primary forms of interprocess communication are supported by the multiprocessing module: pipes and queues. Both methods are implemented using message passing. However, the queue interface is meant to mimic the use of queues commonly used with thread programs.\n\nF h Lib f L Bdff",
      "content_length": 1801,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 443,
      "content": "418\n\nChapter 20 Threads and Concurrency\n\nQueue([maxsize])\n\nCreates a shared process queue. maxsizeis the maximum number of items allowed in the queue. If omitted, there is no size limit.The underlying queue is implemented using pipes and locks. In addition, a support thread is launched in order to feed queued data into the underlying pipe.\n\nAn instance qof Queue has the following methods:\n\nq.cancel_join_thread()\n\nDon’t automatically join the background thread on process exit.This prevents the join_thread() method from blocking.\n\nq.close()\n\nCloses the queue, preventing any more data from being added to it.When this is called, the background thread will continue to write any queued data not yet written but will shut down as soon as this is complete.This method is called automatically if qis garbage-collected. Closing a queue does not generate any kind of end-of-data signal or exception in queue consumers. For example, if a consumer is blocking on a get() operation, closing the queue in the producer does not cause the get() to return with an error.\n\nq.empty()\n\nReturns True if qis empty at the time of the call. If other processes or threads are being used to add queue items, be aware that the result is not reliable (e.g., new items could have been added to the queue in between the time that the result is returned and used).\n\nq.full()\n\nReturns True if qis full.The result is also not reliable due to threads (see q.empty()).\n\nq.get([block [, timeout]])\n\nReturns an item from q. If qis empty, blocks until a queue item becomes available. blockcontrols the blocking behavior and is True by default. If set to False, a Queue.Empty exception (defined in the Queue library module) is raised if the queue is empty. timeoutis an optional timeout to use in blocking mode. If no items become available in the specified time interval, a Queue.Empty exception is raised.\n\nq.get_nowait()\n\nThe same as q.get(False).\n\nq.join_thread()\n\nJoins the queue’s background thread.This is used to wait for all queue items to be con- sumed after q.close() has been called.This method gets called by default in all processes that are not the original creator of q.This behavior can be disabled by called q.cancel_join_thread().\n\nq.put(item [, block [, timeout]])\n\nPuts itemonto the queue. If the queue is full, block until space becomes available. blockcontrols the blocking behavior and is True by default. If set to False, a Queue.Full exception (defined in the Queue library module) is raised if the queue is full. timeoutspecifies how long to wait for space to become available in blocking mode.A Queue.Full exception is raised on timeout.\n\nF h Lib f L Bdff",
      "content_length": 2652,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 444,
      "content": "multiprocessing\n\n419\n\nq.put_nowait(item)\n\nThe same as q.put(item, False).\n\nq.qsize()\n\nReturns the approximate number of items currently in the queue.The result of this function is not reliable because items may have been added or removed from the queue in between the time the result is returned and later used in a program. On some sys- tems, this method may raise an NotImplementedError.\n\nJoinableQueue([maxsize])\n\nCreates a joinable shared process queue.This is just like a Queue except that the queue allows a consumer of items to notify the producer that the items have been successfully been processed.The notification process is implemented using a shared semaphore and condition variable.\n\nAn instance qof JoinableQueue has the same methods as Queue, but it has the fol-\n\nlowing additional methods:\n\nq.task_done()\n\nUsed by a consumer to signal that an enqueued item returned by q.get() has been processed.A ValueError exception is raised if this is called more times than have been removed from the queue.\n\nq.join()\n\nUsed by a producer to block until all items placed in a queue have been processed.This blocks until q.task_done() is called for every item placed into the queue.\n\nThe following example shows how you set up a process that runs forever, consuming and processing items on a queue.The producer feeds items into the queue and waits for them to be processed.\n\nimport multiprocessing\n\ndef consumer(input_q):\n\nwhile True:\n\nitem = input_q.get() # Process item print(item) # Replace with useful work # Signal task completion input_q.task_done()\n\ndef producer(sequence, output_q):\n\nfor item in sequence:\n\n# Put the item on the queue output_q.put(item)\n\n# Set up if __name__ == '__main__':\n\nq = multiprocessing.JoinableQueue() # Launch the consumer process cons_p = multiprocessing.Process(target=consumer,args=(q,)) cons_p.daemon=True cons_p.start()\n\n# Produce items. sequence represents a sequence of items to # be sent to the consumer. In practice, this could be the output\n\nF h Lib f L Bdff",
      "content_length": 2007,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 445,
      "content": "420\n\nChapter 20 Threads and Concurrency\n\n# of a generator or produced in some other manner. sequence = [1,2,3,4] producer(sequence, q)\n\n# Wait for all items to be processed q.join()\n\nIn this example, the consumer process is set to daemonic because it runs forever and we want it to terminate when the main program finishes (if you forget this, the program will hang).A JoinableQueue is being used so that the producer actually knows when all of the items put in the queue have been successfully processed.The join() opera- tion ensures this; if you forget this step, the consumer will be terminated before it has had time to complete all of its work.\n\nIf desired, multiple processes can put and get items from the same queue. For exam- ple, if you wanted to have a pool of consumer processes, you could just write code like this:\n\nif __name__ == '__main__':\n\nq = multiprocessing.JoinableQueue() # Launch some consumer processes cons_p1 = multiprocessing.Process(target=consumer,args=(q,)) cons_p1.daemon=True cons_p1.start()\n\ncons_p2 = multiprocessing.Process(target=consumer,args=(q,)) cons_p2.daemon=True cons_p2.start()\n\n# Produce items. sequence represents a sequence of items to # be sent to the consumer. In practice, this could be the output # of a generator or produced in some other manner. sequence = [1,2,3,4] producer(sequence, q)\n\n# Wait for all items to be processed q.join()\n\nWhen writing code such as this, be aware that every item placed into the queue is pick- led and sent to the process over a pipe or socket connection.As a general rule, it is bet- ter to send fewer large objects than many small objects.\n\nIn certain applications, a producer may want to signal consumers that no more items\n\nwill be produced and that they should shut down.To do this, you should write code that uses a sentinel—a special value that indicates completion. Here is an example that illustrates this concept using None as a sentinel:\n\nimport multiprocessing\n\ndef consumer(input_q):\n\nwhile True:\n\nitem = input_q.get() if item is None:\n\nbreak # Process item print(item) # Replace with useful work\n\n# Shutdown print(\"Consumer done\")\n\ndef producer(sequence, output_q):\n\nfor item in sequence:\n\nF h Lib f L Bdff",
      "content_length": 2205,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 446,
      "content": "multiprocessing\n\n421\n\n# Put the item on the queue output_q.put(item)\n\nif __name__ == '__main__':\n\nq = multiprocessing.Queue() # Launch the consumer process cons_p = multiprocessing.Process(target=consumer,args=(q,)) cons_p.start()\n\n# Produce items sequence = [1,2,3,4] producer(sequence, q)\n\n# Signal completion by putting the sentinel on the queue q.put(None) # Wait for the consumer process to shutdown cons_p.join()\n\nIf you are using sentinels as shown in this example, be aware that you will need to put a sentinel on the queue for every single consumer. For example, if there were three con- sumer processes consuming items on the queue, the producer needs to put three sen- tinels on the queue to get all of the consumers to shut down.\n\nAs an alternative to using queues, a pipe can be used to perform message passing\n\nbetween processes.\n\nPipe([duplex])\n\nCreates a pipe between processes and returns a tuple (conn1, conn2) where conn1 and conn2are Connection objects representing the ends of the pipe. By default, the pipe is bidirectional. If duplexis set False, then conn1can only be used for receiving and conn2can only be used for sending. Pipe() must be called prior to creating and launching any Process objects that use the pipe.\n\nAn instance cof a Connection object returned by Pipe() has the following meth-\n\nods and attributes:\n\nc.close()\n\nCloses the connection. Called automatically if cis garbage collected.\n\nc.fileno()\n\nReturns the integer file descriptor used by the connection.\n\nc.poll([timeout])\n\nReturns True if data is available on the connection. timeoutspecifies the maximum amount of time to wait. If omitted, the method returns immediately with a result. If timeoutis set to None, then the operation will wait indefinitely for data to arrive.\n\nc.recv()\n\nReceives an object sent by c.send(). Raises EOFError if the other end of the connec- tion has been closed and there is no more data.\n\nc.recv_bytes([maxlength])\n\nReceives a complete byte message sent by c.send_bytes(). maxlengthspecifies the maximum number of bytes to receive. If an incoming message exceeds this, an IOError is raised and no further reads can be made on the connection. Raises EOFError if the other end of the connection has been closed and there is no more data.\n\nF h Lib f L Bdff",
      "content_length": 2280,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 447,
      "content": "422\n\nChapter 20 Threads and Concurrency\n\nc.recv_bytes_into(buffer [, offset])\n\nReceives a complete byte message and stores it in the object buffer, which supports the writable buffer interface (e.g., a bytearray object or similar). offsetspecifies the byte offset into the buffer where to place the message. Returns the number of bytes received. Raises BufferTooShort if the length of the message exceeds available buffer space.\n\nc.send(obj)\n\nSends an object through the connection. objis any object that is compatible with pickle.\n\nc.send_bytes(buffer [, offset [, size]])\n\nSends a buffer of byte data through the connection. bufferis any object that supports the buffer interface, offsetis the byte offset into the buffer, and sizeis the number of bytes to send.The resulting data is sent as a single message to be received using a single call to c.recv_bytes().\n\nPipes can be used in a similar manner as queues. Here is an example that shows the\n\nprevious producer-consumer problem implemented using pipes:\n\nimport multiprocessing # Consume items on a pipe. def consumer(pipe):\n\noutput_p, input_p = pipe input_p.close() # Close the input end of the pipe while True: try:\n\nitem = output_p.recv()\n\nexcept EOFError:\n\nbreak # Process item print(item) # Replace with useful work\n\n# Shutdown print(\"Consumer done\")\n\n# Produce items and put on a queue. sequence is an # iterable representing items to be processed. def producer(sequence, input_p):\n\nfor item in sequence:\n\n# Put the item on the queue input_p.send(item)\n\nif __name__ == '__main__':\n\n(output_p, input_p) = multiprocessing.Pipe() # Launch the consumer process cons_p = multiprocessing.Process(target=consumer,args=((output_p, input_p),)) cons_p.start()\n\n# Close the output pipe in the producer output_p.close()\n\n# Produce items sequence = [1,2,3,4] producer(sequence, input_p)\n\n# Signal completion by closing the input pipe input_p.close()\n\n# Wait for the consumer process to shutdown cons_p.join()\n\nF h Lib f L Bdff",
      "content_length": 1975,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 448,
      "content": "multiprocessing\n\n423\n\nGreat attention should be given to proper management of the pipe endpoints. If one of the ends of the pipe is not used in either the producer or consumer, it should be closed. This explains, for instance, why the output end of the pipe is closed in the producer and the input end of the pipe is closed in the consumer. If you forget one of these steps, the program may hang on the recv() operation in the consumer. Pipes are reference counted by the operating system and have to be closed in all processes to produce the EOFError exception.Thus, closing the pipe in the producer doesn’t have any effect unless the consumer also closes the same end of the pipe.\n\nPipes can be used for bidirectional communication.This can be used to write pro- grams that interact with a process using a request/response model typically associated with client/server computing or remote procedure call. Here is an example:\n\nimport multiprocessing # A server process def adder(pipe):\n\nserver_p, client_p = pipe client_p.close() while True: try:\n\nx,y = server_p.recv()\n\nexcept EOFError:\n\nbreak result = x + y server_p.send(result)\n\n# Shutdown print(\"Server done\")\n\nif __name__ == '__main__':\n\n(server_p, client_p) = multiprocessing.Pipe() # Launch the server process adder_p = multiprocessing.Process(target=adder,args=((server_p, client_p),)) adder_p.start()\n\n# Close the server pipe in the client server_p.close()\n\n# Make some requests on the server client_p.send((3,4)) print(client_p.recv())\n\nclient_p.send(('Hello','World')) print(client_p.recv())\n\n# Done. Close the pipe client_p.close()\n\n# Wait for the consumer process to shutdown adder_p.join()\n\nIn this example, the adder() function runs as a server waiting for messages to arrive on its end of the pipe.When received, it performs some processing and sends the result back on the pipe. Keep in mind that send() and recv() use the pickle module to serialize objects. In the example, the server receives a tuple (x, y) as input and returns the result x + y. For more advanced applications that use remote procedure call, how- ever, you should use a process pool as described next.\n\nF h Lib f L Bdff",
      "content_length": 2158,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 449,
      "content": "424\n\nChapter 20 Threads and Concurrency\n\nProcess Pools The following class allows you to create a pool of processes to which various kind of data processing tasks can be submitted.The functionality provided by a pool is some- what similar to that provided by list comprehensions and functional programming oper- ations such as map-reduce.\n\nPool([numprocess [,initializer [, initargs]]])\n\nCreates a pool of worker processes. numprocessis the number of processes to create. If omitted, the value of cpu_count() is used. initializeris a callable object that will be executed in each worker process upon startup. initargsis a tuple of arguments to pass to initializer. By default, initializeris None.\n\nAn instance pof Pool supports the following operations:\n\np.apply(func [, args [, kwargs]])\n\nExecutes func(*args, **kwargs) in one of the pool workers and returns the result. It is important to emphasize this does not execute funcin parallel in all pool workers. If you want functo execute concurrently with different arguments, you either have to call p.apply() from different threads or use p.apply_async().\n\np.apply_async(func [, args [, kwargs [, callback]]])\n\nExecutes func(*args, **kwargs) in one of the pool workers and returns the result asynchronously.The result of this method is an instance of AsyncResult which can be used to obtain the final result at a later time. callbackis a callable object that accepts a single input argument.When the result of funcbecomes available, it is immediately passed to callback. callbackshould not perform any blocking operations or else it will block the reception of results in other asynchronous operations.\n\np.close()\n\nCloses the process pool, preventing any further operations. If any operations are still pending, they will be completed before the worker processes terminate.\n\np.join()\n\nWaits for all worker processes to exit.This can only be called after close() or terminate().\n\np.imap(func, iterable [, chunksize])\n\nA version of map() that returns an iterator instead of a list of results.\n\np.imap_unordered(func, iterable [, chunksize]])\n\nThe same as imap() except that the results are returned in an arbitrary order based on when they are received from the worker processes.\n\np.map(func, iterable [, chunksize])\n\nApplies the callable object functo all of the items in iterableand returns the result as a list.The operation is carried out in parallel by splitting iterableinto chunks and farming out the work to the worker processes. chunksizespecifies the number of items in each chunk. For large amounts of data, increasing the chunksizewill improve performance.\n\nF h Lib f L Bdff",
      "content_length": 2635,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 450,
      "content": "multiprocessing\n\n425\n\np.map_async(func, iterable [, chunksize [, callback]])\n\nThe same as map() except that the result is returned asynchronously.The return value is an instance of AsyncResult that can be used to later obtain the result. callbackis a callable object accepting a single argument. If supplied, callbackis called with the result when it becomes available.\n\np.terminate()\n\nImmediately terminates all of the worker processes without performing any cleanup or finishing any pending work. If pis garbage-collected, this is called.\n\nThe methods apply_async() and map_async() return an AsyncResult instance\n\nas a result.An instance aof AsyncResult has the following methods:\n\na.get([timeout])\n\nReturns the result, waiting for it to arrive if necessary. timeoutis an optional timeout. If the result does not arrive in the given time, a multiprocessing.TimeoutError exception is raised. If an exception was raised in the remote operation, it is reraised when this method is called.\n\na.ready()\n\nReturns True if the call has completed.\n\na.sucessful()\n\nReturns True if the call completed without any exceptions.An AssertionError is raised if this method is called prior to the result being ready.\n\na.wait([timeout])\n\nWaits for the result to become available. timeoutis an optional timeout.\n\nThe following example illustrates the use of a process pool to build a dictionary\n\nmapping filenames to SHA512 digest values for an entire directory of files:\n\nimport os import multiprocessing import hashlib\n\n# Some parameters you can tweak BUFSIZE = 8192 # Read buffer size POOLSIZE = 2 # Number of workers\n\ndef compute_digest(filename):\n\ntry:\n\nf = open(filename,\"rb\")\n\nexcept IOError: return None\n\ndigest = hashlib.sha512() while True:\n\nchunk = f.read(BUFSIZE) if not chunk: break digest.update(chunk)\n\nf.close() return filename, digest.digest()\n\ndef build_digest_map(topdir):\n\ndigest_pool = multiprocessing.Pool(POOLSIZE)\n\nF h Lib f L Bdff",
      "content_length": 1936,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 451,
      "content": "426\n\nChapter 20 Threads and Concurrency\n\nallfiles = (os.path.join(path,name)\n\nfor path, dirs, files in os.walk(topdir)\n\nfor name in files)\n\ndigest_map = dict(digest_pool.imap_unordered(compute_digest,allfiles,20)) digest_pool.close() return digest_map\n\n# Try it out. Change the directory name as desired. if __name__ == '__main__':\n\ndigest_map = build_digest_map(\"/Users/beazley/Software/Python-3.0\") print(len(digest_map))\n\nIn the example, a sequence of pathnames for all files in a directory tree is specified using a generator expression.This sequence is then chopped up and farmed out to a process pool using the imap_unordered() function. Each pool worker computes a SHA512 digest value for its files using the compute_digest() function.The results are sent back to the master and collected into a Python dictionary.Although it’s by no means a scien- tific result, this example gives a 75 percent speedup over a single-process solution when run on the author’s dual-core Macbook.\n\nKeep in mind that it only makes sense to use a process pool if the pool workers per-\n\nform enough work to justify the extra communication overhead.As a general rule, it would not make sense to use a pool for simple calculations such as just adding two numbers together.\n\nShared Data and Synchronization Normally, processes are completed isolated from each other with the only means of communication being queues or pipes. However, two objects can be used to represent shared data. Underneath the covers, these objects use shared memory (via mmap) to make access possible in multiple processes.\n\nValue(typecode, arg1, ... argN, lock)\n\nCreates a ctypes object in shared memory. typecodeis either a string containing a type code as used by the array module (e.g., 'i', 'd', etc.) or a type object from the ctypes module (e.g., ctypes.c_int, ctypes.c_double, etc.).All extra positional arguments arg1, arg2, ... argNare passed to the constructor for the given type. lockis a keyword-only argument that if set to True (the default), a new lock is created to protect access to the value. If you pass in an existing lock such as a Lock or RLock instance, then that lock is used for synchronization. If vis an instance of a shared value created by Value, then the underlying value is accessed used v.value. For example, reading v.value will get the value and assigning v.value will change the value.\n\nRawValue(typecode, arg1, ..., argN)\n\nThe same as Value except that there is no locking.\n\nArray(typecode, initializer, lock)\n\nCreates a ctypes array in shared memory. typecodedescribes the contents of the array and has the same meaning as described for Value(). initializeris either an integer that sets the initial size of the array or a sequence of items whose values and size are used to initialize the array. lockis a keyword-only argument with the same meaning as described for Value(). If ais an instance of a shared array created by Array, then you\n\nF h Lib f L Bdff",
      "content_length": 2951,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 452,
      "content": "multiprocessing\n\n427\n\naccess its contents using the standard Python indexing, slicing, and iteration operations, each of which are synchronized by the lock. For byte strings, awill also have an a.value attribute to access the entire array as a single string.\n\nRawArray(typecode, initializer)\n\nThe same as Array except that there is no locking. If you are writing programs that must manipulate a large number of array items all at once, the performance will be sig- nificantly better if you use this datatype along with a separate lock for synchronization (if needed).\n\nIn addition to shared values created using Value() and Array(), the\n\nmultiprocessing module provides shared versions of the following synchronization primitives:\n\nPrimitive Lock\n\nRLock\n\nSemaphore\n\nBoundedSemaphore\n\nEvent\n\nDescription Mutual exclusion lock Reentrant mutual exclusion lock (can be acquired multiple times by the same process without blocking) Semaphore Bounded semaphore Event Condition variable\n\nCondition\n\nThe behavior of these objects mimics the synchronization primitives defined in the threading module with identical names. Please refer to the threading documentation for further details.\n\nIt should be noted that with multiprocessing, it is not normally necessary to worry\n\nabout low-level synchronization with locks, semaphores, or similar constructs to the same degree as with threads. In part, send() and receive() operations on pipes and put() and get() operations on queues already provide synchronization. However, shared values and locks can have uses in certain specialized settings. Here is an example that sends a Python list of floats to another process using a shared array instead of a pipe:\n\nimport multiprocessing\n\nclass FloatChannel(object):\n\ndef __init__(self, maxsize):\n\nself.buffer = multiprocessing.RawArray('d',maxsize) self.buffer_len = multiprocessing.Value('i') self.empty = multiprocessing.Semaphore(1) self.full = multiprocessing.Semaphore(0)\n\ndef send(self,values):\n\nself.empty.acquire() # Only proceed if buffer empty nitems = len(values) self.buffer_len = nitems # Set the buffer size self.buffer[:nitems] = values # Copy values into the buffer self.full.release() # Signal that buffer is full\n\ndef recv(self):\n\nself.full.acquire() # Only proceed if buffer full values = self.buffer[:self.buffer_len.value] # Copy values self.empty.release() # Signal that buffer is empty return values\n\nF h Lib f L Bdff",
      "content_length": 2423,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 453,
      "content": "428\n\nChapter 20 Threads and Concurrency\n\n# Performance test. Receive a bunch of messages def consume_test(count, ch):\n\nfor i in xrange(count):\n\nvalues = ch.recv()\n\n# Performance test. Send a bunch of messages def produce_test(count, values, ch):\n\nfor i in xrange(count): ch.send(values)\n\nif __name__ == '__main__': ch = FloatChannel(100000) p = multiprocessing.Process(target=consume_test,\n\nargs=(1000,ch))\n\np.start() values = [float(x) for x in xrange(100000)] produce_test(1000, values, ch) print(\"Done\") p.join()\n\nFurther study of this example is left to the reader. However, in a performance test on the author’s machine, sending a large list of floats through the FloatChannel is about 80 percent faster than sending the list through a Pipe (which has to pickle and unpick- le all of the values).\n\nManaged Objects Unlike threads, processes do not support shared objects.Although you can create shared values and arrays as shown in the previous section, this doesn’t work for more advanced Python objects such as dictionaries, lists, or instances of user-defined classes.The multiprocessing module does, however, provide a way to work with shared objects if they run under the control of a so-called manager.A manager is a separate subprocess where the real objects exist and which operates as a server. Other processes access the shared objects through the use of proxies that operate as clients of the manager server. The most straightforward way to work with simple managed objects is to use the\n\nManager() function.\n\nManager()\n\nCreates a running manager server in a separate process. Returns an instance of type SyncManager which is defined in the multiprocessing.managers submodule.\n\nAn instance mof SyncManager as returned by Manager() has a series of methods\n\nfor creating shared objects and returning a proxy which can be used to access them. Normally, you would create a manager and use these methods to create shared objects before launching any new processes.The following methods are defined:\n\nm.Array(typecode, sequence)\n\nCreates a shared Array instance on the server and returns a proxy to it. See the “Shared Data and Synchronization” section for a description of the arguments.\n\nm.BoundedSemaphore([value])\n\nCreates a shared threading.BoundedSemaphore instance on the server and returns a proxy to it.\n\nF h Lib f L Bdff",
      "content_length": 2339,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 454,
      "content": "multiprocessing\n\n429\n\nm.Condition([lock])\n\nCreates a shared threading.Condition instance on the server and returns a proxy to it. lockis a proxy instance created by m.Lock() or m.Rlock().\n\nm.dict([args])\n\nCreates a shared dict instance on the server and returns a proxy to it.The arguments to this method are the same as for the built-in dict() function.\n\nm.Event()\n\nCreates a shared threading.Event instance on the server and returns a proxy to it.\n\nm.list([sequence])\n\nCreates a shared list instance on the server and returns a proxy to it.The arguments to this method are the same as for the built-in list() function.\n\nm.Lock()\n\nCreates a shared threading.Lock instance on the server and returns a proxy to it.\n\nm.Namespace()\n\nCreates a shared namespace object on the server and returns a proxy to it.A namespace is an object that is somewhat similar to a Python module. For example, if nis a namespace proxy, you can assign and read attributes using (.) such as n.name = valueor value = n.name. However, the choice of nameis significant. If namestarts with a letter, then that value is part of the shared object held by the manager and is accessible in all other processes. If namestarts with an underscore, it is only part of the proxy object and is not shared.\n\nm.Queue()\n\nCreates a shared Queue.Queue object on the server and returns a proxy to it.\n\nm.RLock()\n\nCreates a shared threading.Rlock object on the server and returns a proxy to it.\n\nm.Semaphore([value])\n\nCreates a shared threading.Semaphore object on the server and returns a proxy to it.\n\nm.Value(typecode, value)\n\nCreates a shared Value object on the server and returns a proxy to it. See the “Shared Data and Synchronization” section for a description of the arguments.\n\nThe following example shows how you would use a manager in order to create a\n\ndictionary shared between processes.\n\nimport multiprocessing import time\n\n# print out d whenever the passed event gets set def watch(d, evt): while True:\n\nevt.wait() print(d) evt.clear()\n\nF h Lib f L Bdff",
      "content_length": 2024,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 455,
      "content": "430\n\nChapter 20 Threads and Concurrency\n\nif __name__ == '__main__':\n\nm = multiprocessing.Manager() d = m.dict() # Create a shared dict evt = m.Event() # Create a shared Event\n\n# Launch a process that watches the dictionary p = multiprocessing.Process(target=watch,args=(d,evt)) p.daemon=True p.start()\n\n# Update the dictionary and notify the watcher d['foo'] = 42 evt.set() time.sleep(5)\n\n# Update the dictionary and notify the watcher d['bar'] = 37 evt.set() time.sleep(5)\n\n# Terminate the process and manager p.terminate() m.shutdown()\n\nIf you run this example, the watch() function prints out the value of d every time the passed event gets set. In the main program, a shared dictionary and event are created and manipulated in the main process.When you run this, you will see the child process printing data.\n\nIf you want to have shared objects of other types such as instances of user-defined classes, you have to create your custom manager object.To do this, you create a class that inherits from BaseManager, which is defined in the multiprocessing.managers submodule.\n\nmanagers.BaseManager([address [, authkey]])\n\nBase class used to create custom manager servers for user-defined objects. addressis an optional tuple (hostname, port) that specifies a network address for the server. If omitted, the operating system will simply assign an address corresponding to some free port number. authkeyis a string that is used to authenticate clients connecting to the server. If omitted, the value of current_process().authkey is used.\n\nIf mgrclassis a class that inherits from BaseManager, the following class method is\n\nused to create methods for returning proxies to shared objects.\n\nmgrclass.register(typeid [, callable [, proxytype [, exposed [, method_to_typeid [, create_method]]]]])\n\nRegisters a new data type with the manager class. typeidis a string that is used to name a particular kind of shared object.This string should be a valid Python identifier. callableis a callable object that creates or returns the instance to be shared. proxy- typeis a class that provides the implementation of the proxy objects to be used in clients. Normally, these classes are generated by default so this is normally set to None. exposedis a sequence of method names on the shared object that will be exposed to proxy objects. If omitted, the value of proxytype._exposed_ is used and if that is undefined, then all public methods (all callable methods that don’t start with an under- score (_) are used). method_to_typeidis a mapping from method names to type IDS that is used to specify which methods should return their results using proxy objects. If\n\nF h Lib f L Bdff",
      "content_length": 2667,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 456,
      "content": "multiprocessing\n\n431\n\na method is not found in this mapping, the return value is copied and returned. If method_to_typeidis None, the value of proxytype._method_to_typeid_ is used if it is defined. create_methodis a Boolean flag that specifies whether a method with the name typeidshould be created in mgrclass. By default, this is True.\n\nAn instance mof a manager derived from BaseManager must be manually started to\n\noperate.The following attributes and methods are related to this:\n\nm.address\n\nA tuple (hostname, port) that has the address being used by the manager server.\n\nm.connect()\n\nConnects to a remote manager object, the address of which was given to the BaseManager constructor.\n\nm.serve_forever()\n\nRuns the manager server in the current process.\n\nm.shutdown()\n\nShuts down a manager server launched by the m.start() method.\n\nm.start()\n\nStarts a separate subprocess and starts the manager server in that process.\n\nThe following example shows how to create a manager for a user-defined class:\n\nimport multiprocessing from multiprocessing.managers import BaseManager\n\nclass A(object):\n\ndef __init__(self,value):\n\nself.x = value def __repr__(self):\n\nreturn \"A(%s)\" % self.x\n\ndef getX(self):\n\nreturn self.x def setX(self,value): self.x = value\n\ndef __iadd__(self,value):\n\nself.x += value return self\n\nclass MyManager(BaseManager): pass MyManager.register(\"A\",A)\n\nif __name__ == '__main__':\n\nm = MyManager() m.start() # Create a managed object a = m.A(37) ...\n\nIn this example, the last statement creates an instance of A that lives on the manager server.The variable a in the previous code is only a proxy for this instance.The behav- ior of this proxy is similar to (but not completely identical to) referent, the object on the\n\nF h Lib f L Bdff",
      "content_length": 1753,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 457,
      "content": "432\n\nChapter 20 Threads and Concurrency\n\nserver. First, you will find that data attributes and properties cannot be accessed. Instead, you have to use access functions:\n\n>>> a.x Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nAttributeError: 'AutoProxy[A]' object has no attribute 'x' >>> a.getX() 37 >>> a.setX(42) >>>\n\nWith proxies, the repr() function returns a string representing the proxy, whereas str() returns the output of __repr__() on the referent. For example:\n\n>>> a <AutoProxy[A] object, typeid 'A' at 0xcef230> >>> print(a) A(37) >>>\n\nSpecial methods and any method starting with an underscore (_) are not accessible on proxies. For example, if you tried to invoke a.__iadd__(), it doesn’t work:\n\n>>> a += 37 Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: unsupported operand type(s) for +=: 'AutoProxy[A]' and 'int' >>> a.__iadd__(37) Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nAttributeError: 'AutoProxy[A]' object has no attribute '__iadd__' >>>\n\nIn more advanced applications, it is possible to customize proxies to more carefully con- trol access.This is done by defining a class that inherits from BaseProxy, which is defined in multiprocessing.managers.The following code shows how you could make a custom proxy to the A class in the previous example that properly exposes the __iadd__() method and which uses a property to expose the x attribute:\n\nfrom multiprocessing.managers import BaseProxy\n\nclass AProxy(BaseProxy):\n\n# A list of all methods exposed on the referent _exposed_ = ['__iadd__','getX','setX'] # Implement the public interface of the proxy def __iadd__(self,value):\n\nself._callmethod('__iadd__',(value,)) return self\n\n@property def x(self):\n\nreturn self._callmethod('getX',())\n\n@x.setter def x(self,value):\n\nself._callmethod('setX',(value,))\n\nclass MyManager(BaseManager): pass MyManager.register(\"A\", A, proxytype=AProxy)\n\nAn instance proxyof a class derived from BaseProxy has the following methods:\n\nF h Lib f L Bdff",
      "content_length": 2049,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 458,
      "content": "multiprocessing\n\n433\n\nproxy._callmethod(name [, args [, kwargs]])\n\nCalls the method nameon the proxy’s referent object. nameis a string with the method name, argsis a tuple containing positional arguments, and kwargsis a dictionary of keyword arguments.The method namemust be explicitly exposed. Normally this is done by including the name in the _exposed_ class attribute of the proxy class.\n\nproxy._getvalue()\n\nReturns a copy of the referent in the caller. If this call is made in a different process, the referent object is pickled, sent to the caller, and is unpickled.An exception is raised if the referent can’t be pickled.\n\nConnections Programs that use the multiprocessing module can perform message passing with other processes running on the same machine or with processes located on remote sys- tems.This can be useful if you want to take a program written to work on a single sys- tem and expand it work on a computing cluster.The multiprocessing.connection submodule has functions and classes for this purpose:\n\nconnections.Client(address [, family [, authenticate [, authkey]]])\n\nConnects to another process which must already be listening at address address. addressis a tuple (hostname , port) representing a network address, a file name representing a UNIX domain socket, or a string of the form r'\\\\servername\\pipe\\pipename' representing a Windows named pipe on a remote system servername(use a servernameof '.' for the local machine). familyis a string representing the addess format and is typically one of 'AF_INET', 'AF_UNIX', or 'AF_PIPE'. If omitted, the family is inferred from the format of address. authenticationis a Boolean flag that specifies whether digest authentica- tion is to be used. authkeyis a string containing the authentication key. If omitted, then the value of current_process().authkey is used.The return value from this function is a Connection object, which was previously described in the pipes section of “Interprocess Communication.”\n\nconnections.Listener([address [, family [, backlog [, authenticate [, authkey]]]]])\n\nA class that implements a server for listening for and handling connections made by the Client() function.The address, family, authenticate, and authkeyarguments have the same meaning as for Client(). backlogis an integer corresponding to the value passed to the listen() method of sockets if the addressparameter specifies a network connection. By default, backlogis 1. If addressis omitted, then a default address is chosen. If both addressand familyare omitted, then the fastest available communications scheme on the local system is chosen.\n\nAn instance sof Listener supports the following methods and attributes:\n\ns.accept()\n\nAccepts a new connection and returns a Connection object. Raises AuthenticationError if authentication fails.\n\ns.address\n\nThe address that the listener is using.\n\nF h Lib f L Bdff",
      "content_length": 2879,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 459,
      "content": "434\n\nChapter 20 Threads and Concurrency\n\ns.close()\n\nCloses the pipe or socket being used by the listener.\n\ns.last_accepted\n\nThe address of the last client that was accepted.\n\nHere is an example of a server program that listens for clients and implements a sim-\n\nple remote operation (adding):\n\nfrom multiprocessing.connection import Listener\n\nserv = Listener(('',15000),authkey='12345') while True:\n\nconn = serv.accept() while True: try:\n\nx,y = conn.recv()\n\nexcept EOFError:\n\nbreak result = x + y conn.send(result)\n\nconn.close()\n\nHere is a simple client program that connects to this server and sends some messages:\n\nfrom multiprocessing.connection import Client conn = Client(('localhost',15000), authkey=\"12345\")\n\nconn.send((3,4)) r = conn.recv() print(r) # Prints '7'\n\nconn.send((\"Hello\",\"World\")) r = conn.recv() print(r) # Prints 'HelloWorld'\n\nconn.close()\n\nMiscellaneous Utility Functions The following utility functions are also defined:\n\nactive_children()\n\nReturns a list of Process objects for all active child processes.\n\ncpu_count()\n\nReturns the number of CPUs on the system if it can be determined.\n\ncurrent_process()\n\nReturns the Process object for the current process.\n\nfreeze_support()\n\nA function that should be included as the first statement of the main program in an application that will be “frozen” using various packaging tools such as py2exe.This is needed to prevent runtime errors associated with launching subprocesses in a frozen application.\n\nF h Lib f L Bdff",
      "content_length": 1487,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 460,
      "content": "multiprocessing\n\n435\n\nget_logger()\n\nReturns the logging object associated with the multiprocessing module, creating it if it doesn’t already exist.The returned logger does not propagate messages to the root log- ger, has a level of logging.NOTSET, and prints all logging messages to standard error.\n\nset_executable(executable)\n\nSets the name of the Python executable used to execute subprocesses.This is only defined on Windows.\n\nGeneral Advice on Multiprocessing The multiprocessing module is one of the most advanced and powerful modules in the Python library. Here are some general tips for keeping your head from exploding: n Carefully read the online documentation before building a large application.\n\nAlthough this section has covered the essential basics, the official documentation covers some of the more sneaky issues that can arise.\n\nn Make sure that all data passed between processes is compatible with pickle. n Avoid shared data and learn to love message passing and queues.With message passing, you don’t have to worry so much about synchronization, locking, and other issues. It also tends to provide better scaling as the number of processes increases.\n\nn Don’t use global variables inside functions that are meant to run in separate\n\nprocesses. It is better to explicitly pass parameters instead.\n\nn Try not to mix threads and multiprocessing together in the same program unless you’re vastly trying to improve your job security (or to have it reduced depend- ing on who is doing the code review).\n\nn Pay very careful attention to how processes get shut down.As a general rule, you\n\nwill want to explicitly close processes and have a well-defined termination scheme in place as opposed to just relying on garbage collection or having to forcefully terminate children using the terminate() operation.\n\nn The use of managers and proxies is closely related to a variety of concepts in dis-\n\ntributed computing (e.g., distributed objects).A good distributed computing book might be a useful reference.\n\nn The multiprocessing module originated from a third-party library known as\n\npyprocessing. Searching for usage tips and information on this library may be a useful resource.\n\nn Although this module works on Windows, you should carefully read the official documentation for a variety of subtle details. For example, to launch a new process on Windows, the multiprocessing module implements its own clone of the UNIX fork() operation, in which process state is copied to the child process over a pipe.As a general rule, this module is much more tuned to UNIX systems.\n\nn Above all else, try to keep things as simple as possible.\n\nF h Lib f L Bdff",
      "content_length": 2662,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 461,
      "content": "436\n\nChapter 20 Threads and Concurrency\n\nthreading The threading module provides a Thread class and a variety of synchronization prim- itives for writing multithreaded programs.\n\nThread Objects The Thread class is used to represent a separate thread of control.A new thread can be created as follows:\n\nThread(group=None, target=None, name=None, args=(), kwargs={})\n\nThis creates a new Thread instance. groupis None and is reserved for future exten- sions. targetis a callable object invoked by the run() method when the thread starts. By default, it’s None, meaning that nothing is called. nameis the thread name. By default, a unique name of the form \"Thread-N\" is created. argsis a tuple of arguments passed to the targetfunction. kwargsis a dictionary of keyword arguments passed to target.\n\nA Thread instance tsupports the following methods and attributes:\n\nt.start()\n\nStarts the thread by invoking the run() method in a separate thread of control.This method can be invoked only once.\n\nt.run()\n\nThis method is called when the thread starts. By default, it calls the target function passed in the constructor.This method can also be redefined in subclasses of Thread.\n\nt.join([timeout])\n\nWaits until the thread terminates or a timeout occurs. timeoutis a floating-point num- ber specifying a timeout in seconds.A thread cannot join itself, and it’s an error to join a thread before it has been started.\n\nt.is_alive()\n\nReturns True if the thread is alive and False otherwise.A thread is alive from the moment the start() method returns until its run() method terminates. t.isAlive() is an alias for this method in older code.\n\nt.name\n\nThe thread name.This is a string that is used for identification only and which can be changed to a more meaningful value if desired (which may simplify debugging). In older code, t.getName() and t.setName(name) are used to manipulate the thread name.\n\nt.ident\n\nAn integer thread identifier. If the thread has not yet started, the value is None.\n\nt.daemon\n\nThe thread’s Boolean daemonic flag.This must be set prior to calling start() and the initial value is inherited from daemonic status of the creating thread.The entire Python program exits when no active non-daemon threads are left.All programs have a main\n\nF h Lib f L Bdff",
      "content_length": 2268,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 462,
      "content": "threading\n\n437\n\nthread that represents the initial thread of control and which is not daemonic. In older code, t.setDaemon(flag) and t.isDaemon() are used to manipulate this value. Here is an example that shows how to create and launch a function (or other\n\ncallable) as a thread:\n\nimport threading import time\n\ndef clock(interval): while True:\n\nprint(\"The time is %s\" % time.ctime()) time.sleep(interval)\n\nt = threading.Thread(target=clock, args=(15,)) t.daemon = True t.start()\n\nHere is an example that shows how to define the same thread as a class:\n\nimport threading import time\n\nclass ClockThread(threading.Thread): def __init__(self,interval):\n\nthreading.Thread.__init__(self) self.daemon = True self.interval = interval\n\ndef run(self):\n\nwhile True:\n\nprint(\"The time is %s\" % time.ctime()) time.sleep(self.interval)\n\nt = ClockProcess(15) t.start()\n\nIf you define a thread as a class and define your own __init__() method, it is criti- cally important to call the base class constructor Thread.__init__() as shown. If you forget this, you will get a nasty error. Other than run(), it is an error to override any of the other methods already defined for a thread.\n\nThe setting of the daemon attribute in these examples is a common feature of threads that will run forever in the background. Normally, Python waits for all threads to terminate before the interpreter exits. However, for nonterminating background tasks, this behavior is often undesirable. Setting the daemon flag makes the interpreter quit immediately after the main program exits. In this case, the daemonic threads are simply destroyed.\n\nTimer Objects A Timer object is used to execute a function at some later time.\n\nTimer(interval, func [, args [, kwargs]])\n\nCreates a timer object that runs the function funcafter intervalseconds have elapsed. argsand kwargsprovide the arguments and keyword arguments passed to func.The timer does not start until the start() method is called.\n\nF h Lib f L Bdff",
      "content_length": 1970,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 463,
      "content": "438\n\nChapter 20 Threads and Concurrency\n\nA Timer object, t, has the following methods:\n\nt.start()\n\nStarts the timer.The function funcsupplied to Timer() will be executed after the specified timer interval.\n\nt.cancel()\n\nCancels the timer if the function has not executed yet.\n\nLock Objects A primitive lock (or mutual exclusion lock) is a synchronization primitive that’s in either a “locked” or “unlocked” state.Two methods, acquire() and release(), are used to change the state of the lock. If the state is locked, attempts to acquire the lock are blocked until the lock is released. If more than one thread is waiting to acquire the lock, only one is allowed to proceed when the lock is released.The order in which waiting threads proceed is undefined.\n\nA new Lock instance is created using the following constructor:\n\nLock()\n\nCreates a new Lock object that’s initially unlocked.\n\nA Lock instance, lock, supports the following methods:\n\nlock.acquire([blocking ])\n\nAcquires the lock, blocking until the lock is released if necessary. If blocking is supplied and set to False, the function returns immediately with a value of False if the lock could not be acquired or True if locking was successful.\n\nlock.release()\n\nReleases a lock. It’s an error to call this method when the lock is in an unlocked state or from a different thread than the one that originally called acquire().\n\nRLock A reentrant lock is a synchronization primitive that’s similar to a Lock object, but it can be acquired multiple times by the same thread.This allows the thread owning the lock to perform nested acquire() and release() operations. In this case, only the outer- most release() operation resets the lock to its unlocked state.\n\nA new RLock object is created using the following constructor:\n\nRLock()\n\nCreates a new reentrant lock object.An RLock object, rlock, supports the following methods:\n\nrlock.acquire([blocking ])\n\nAcquires the lock, blocking until the lock is released if necessary. If no thread owns the lock, it’s locked and the recursion level is set to 1. If this thread already owns the lock, the recursion level of the lock is increased by one and the function returns immediately.\n\nF h Lib f L Bdff",
      "content_length": 2199,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 464,
      "content": "threading\n\n439\n\nrlock.release()\n\nReleases a lock by decrementing its recursion level. If the recursion level is zero after the decrement, the lock is reset to the unlocked state. Otherwise, the lock remains locked.This function should only be called by the thread that currently owns the lock.\n\nSemaphore and Bounded Semaphore A semaphore is a synchronization primitive based on a counter that’s decremented by each acquire() call and incremented by each release() call. If the counter ever reaches zero, the acquire() method blocks until some other thread calls release().\n\nSemaphore([value])\n\nCreates a new semaphore. valueis the initial value for the counter. If omitted, the counter is set to a value of 1.\n\nA Semaphore instance, s, supports the following methods:\n\ns.acquire([blocking])\n\nAcquires the semaphore. If the internal counter is larger than zero on entry, this method decrements it by 1 and returns immediately. If it’s zero, this method blocks until another thread calls release().The blocking argument has the same behavior as described for Lock and RLock objects.\n\ns.release()\n\nReleases a semaphore by incrementing the internal counter by 1. If the counter is zero and another thread is waiting, that thread is awakened. If multiple threads are waiting, only one will be returned from its acquire() call.The order in which threads are released is not deterministic.\n\nBoundedSemaphore([value])\n\nCreates a new semaphore. valueis the initial value for the counter. If valueis omitted, the counter is set to a value of 1.A BoundedSemaphore works exactly like a Semaphore except the number of release() operations cannot exceed the number of acquire() operations.\n\nA subtle difference between a semaphore and a mutex lock is that a semaphore can\n\nbe used for signaling. For example, the acquire() and release() methods can be called from different threads to communicate between producer and consumer threads.\n\nproduced = threading.Semaphore(0) consumed = threading.Semaphore(1)\n\ndef producer(): while True:\n\nconsumed.acquire() produce_item() produced.release()\n\ndef consumer(): while True:\n\nproduced.acquire() item = get_item() consumed.release()\n\nF h Lib f L Bdff",
      "content_length": 2178,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 465,
      "content": "440\n\nChapter 20 Threads and Concurrency\n\nThe kind of signaling shown in this example is often instead carried out using condi- tion variables, which will be described shortly.\n\nEvents Events are used to communicate between threads. One thread signals an “event,” and one or more other threads wait for it.An Event instance manages an internal flag that can be set to true with the set() method and reset to false with the clear() method. The wait() method blocks until the flag is true.\n\nEvent()\n\nCreates a new Event instance with the internal flag set to false.An Event instance, e, supports the following methods:\n\ne.is_set()\n\nReturns true only if the internal flag is true.This method is called isSet() in older code.\n\ne.set()\n\nSets the internal flag to true.All threads waiting for it to become true are awakened.\n\ne.clear()\n\nResets the internal flag to false.\n\ne.wait([timeout])\n\nBlocks until the internal flag is true. If the internal flag is true on entry, this method returns immediately. Otherwise, it blocks until another thread calls set() to set the flag to true or until the optional timeout occurs. timeoutis a floating-point number speci- fying a timeout period in seconds.\n\nAlthough Event objects can be used to signal other threads, they should not be used\n\nto implement the kind of notification that is typical in producer/consumer problems. For example, you should avoid code like this:\n\nevt = Event()\n\ndef producer(): while True:\n\n# produce item ... evt.signal()\n\ndef consumer(): while True:\n\n# Wait for an item evt.wait() # Consume the item ... # Clear the event and wait again evt.clear()\n\nThis code does not work reliably because the producer might produce a new item in between the evt.wait() and evt.clear() operations. However, by clearing the event, this new item won’t be seen by the consumer until the producer creates a new item. In the best case, the program will experience a minor hiccup where the processing\n\nF h Lib f L Bdff",
      "content_length": 1959,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 466,
      "content": "threading\n\n441\n\nof an item is inexplicably delayed. In the worst case, the whole program will hang due to the loss of an event signal. For these types of problems, you are better off using con- dition variables.\n\nCondition Variables A condition variable is a synchronization primitive, built on top of another lock that’s used when a thread is interested in a particular change of state or event occurring.A typical use is a producer-consumer problem where one thread is producing data to be con- sumed by another thread.A new Condition instance is created using the following constructor:\n\nCondition([lock])\n\nCreates a new condition variable. lockis an optional Lock or RLock instance. If not supplied, a new RLock instance is created for use with the condition variable.\n\nA condition variable, cv, supports the following methods:\n\ncv.acquire(*args)\n\nAcquires the underlying lock.This method calls the corresponding acquire(*args) method on the underlying lock and returns the result.\n\ncv.release()\n\nReleases the underlying lock.This method calls the corresponding release() method on the underlying lock.\n\ncv.wait([timeout])\n\nWaits until notified or until a timeout occurs.This method is called after the calling thread has already acquired the lock.When called, the underlying lock is released, and the thread goes to sleep until it’s awakened by a notify() or notifyAll() call per- formed on the condition variable by another thread. Once awakened, the thread reac- quires the lock and the method returns. timeout is a floating-point number in seconds. If this time expires, the thread is awakened, the lock reacquired, and control returned.\n\ncv.notify([n])\n\nWakes up one or more threads waiting on this condition variable.This method is called only after the calling thread has acquired the lock, and it does nothing if no threads are waiting. nspecifies the number of threads to awaken and defaults to 1.Awakened threads don’t return from the wait() call until they can reacquire the lock.\n\ncv.notify_all()\n\nWakes up all threads waiting on this condition.This method is called notifyAll() in older code.\n\nHere is an example that provides a template of using condition variables:\n\ncv = threading.Condition() def producer(): while True:\n\ncv.acquire() produce_item() cv.notify() cv.release()\n\nF h Lib f L Bdff",
      "content_length": 2312,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 467,
      "content": "442\n\nChapter 20 Threads and Concurrency\n\ndef consumer(): while True:\n\ncv.acquire() while not item_is_available():\n\ncv.wait() # Wait for an item to show up\n\ncv.release() consume_item()\n\nA subtle aspect of using condition variables is that if there are multiple threads waiting on the same condition, the notify() operation may awaken one or more of them (this behavior often depends on the underlying operating system). Because of this, there is always a possibility that a thread will awaken only to find that the condition of interest no longer holds.This explains, for instance, why a while loop is used in the consumer() function. If the thread awakens, but the produced item is already gone, it just goes back to waiting for the next signal.\n\nWorking with Locks Great care must be taken when working with any of the locking primitives such as Lock, RLock, or Semaphore. Mismanagement of locks is a frequent source of deadlock or race conditions. Code that relies on a lock should always make sure locks get proper- ly released even when exceptions occur.Typical code looks like this:\n\ntry:\n\nlock.acquire() # critical section statements ... finally:\n\nlock.release()\n\nAlternatively, all of the locks also support the context management protocol which is a little cleaner:\n\nwith lock:\n\n# critical section statements ...\n\nIn this last example, the lock is automatically acquired by the with statement and released when control flow leaves the context.\n\nAlso, as a general rule you should avoid writing code where more than one lock is\n\nacquired at any given time. For example:\n\nwith lock_A:\n\n# critical section statements ... with lock_B:\n\n# critical section on B statements\n\n...\n\nThis is usually a good way to have your application mysteriously deadlock.Although there are strategies for avoiding this (for example, hierarchical locking), you’re often bet- ter off writing code that avoids this altogether.\n\nF h Lib f L Bdff",
      "content_length": 1925,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 468,
      "content": "threading\n\n443\n\nThread Termination and Suspension Threads do not have any methods for forceful termination or suspension.This omission is by design and due to the intrinsic complexity of writing threaded programs. For example, if a thread has acquired a lock, forcefully terminating or suspending it before it is able to release the lock may cause the entire application to deadlock. Moreover, it is generally not possible to simply “release all locks” on termination either because com- plicated thread synchronization often involves locking and unlocking operations that must be carried out in a very precise sequence to work.\n\nIf you want to support termination or suspension, you need to build these features yourself.Typically, it’s done by making a thread run in a loop that periodically checks its status to see if it should terminate. For example:\n\nclass StoppableThread(threading.Thread):\n\ndef __init__(self):\n\nthreading.Thread.__init__() self._terminate = False self._suspend_lock = threading.Lock()\n\ndef terminate(self):\n\nself._terminate = True\n\ndef suspend(self):\n\nself._suspend_lock.acquire()\n\ndef resume(self):\n\nself._suspend_lock.release()\n\ndef run(self):\n\nwhile True:\n\nif self._terminate:\n\nbreak\n\nself._suspend_lock.acquire() self._suspend_lock.release() statements ...\n\nKeep in mind that to make this approach work reliability, the thread should take great care not to perform any kind of blocking I/O operation. For example, if the thread blocks waiting for data to arrive, it won’t terminate until it wakes up from that opera- tion. Because of this, you would probably want to make the implementation use timeouts, non-blocking I/O, and other advanced features to make sure that that the termination check executes every so often.\n\nUtility Functions The following utility functions are available:\n\nactive_count()\n\nReturns the number of currently active Thread objects.\n\ncurrent_thread()\n\nReturns the Thread object corresponding to the caller’s thread of control.\n\nenumerate()\n\nReturns a list of all currently active Thread objects.\n\nlocal()\n\nReturns a local object that allows for the storage of thread-local data.This object is guaranteed to be unique in each thread.\n\nF h Lib f L Bdff",
      "content_length": 2205,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 469,
      "content": "444\n\nChapter 20 Threads and Concurrency\n\nsetprofile(func)\n\nSets a profile function that will be used for all threads created. funcis passed to sys.setprofile() before each thread starts running.\n\nsettrace(func)\n\nSets a tracing function that will be used for all threads created. funcis passed to sys.settrace() before each thread starts running.\n\nstack_size([size])\n\nReturns the stack size used when creating new threads. If an optional integer sizeis given, it sets the stack size to be used for creating new threads. sizecan be a value that is 32768 (32KB) or greater and a multiple of 4096 (4KB) for maximum portability.A ThreadError exception is raised if this operation isn’t supported on the system.\n\nThe Global Interpreter Lock The Python interpreter is protected by a lock that only allows one thread to execute at a time even if there are multiple processors available.This severely limits the usefulness of threads in compute-intensive programs—in fact, the use of threads will often make CPU-bound programs run significantly worse than would be the case if they just sequentially carried out the same work.Thus, threads should really only be reserved for programs that are primarily concerned with I/O such as network servers. For more compute-intensive tasks, consider using C extension modules or the multiprocessing module instead. C extensions have the option of releasing the interpreter lock and run- ning in parallel, provided that they don’t interact with the interpreter when the lock is released.The multiprocessing module farms work out to independent subprocesses that aren’t restricted by the lock.\n\nProgramming with Threads Although it is possible to write very traditional multithreaded programs in Python using various combinations of locks and synchronization primitives, there is one style of pro- gramming that is recommended over all others—and that’s to try and organize multi- threaded programs as a collection of independent tasks that communicate through message queues.This is described in the next section (the queue module) along with an example.\n\nqueue, Queue The queue module (named Queue in Python 2) implements various multiproducer, multiconsumer queues that can be used to safely exchange information between multi- ple threads of execution.\n\nThe queue module defines three different queue classes:\n\nQueue([maxsize])\n\nCreates a FIFO (first-in first-out) queue. maxsizeis the maximum number of items that can be placed in the queue. If maxsizeomitted or 0, the queue size is infinite.\n\nLifoQueue([maxsize])\n\nCreates a LIFO (last-in, first-out) queue (also known as a stack).\n\nF h Lib f L Bdff",
      "content_length": 2635,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 470,
      "content": "Queue, queue\n\n445\n\nPriorityQueue([maxsize])\n\nCreates a priority queue in which items are ordered from lowest to highest priority. When working with this queue, items should be tuples of the form (priority, data) where priorityis a number.\n\nAn instance qof any of the queue classes has the following methods:\n\nq.qsize()\n\nReturns the approximate size of the queue. Because other threads may be updating the queue, this number is not entirely reliable.\n\nq.empty()\n\nReturns True if the queue is empty and returns False otherwise.\n\nq.full()\n\nReturns True if the queue is full and returns False otherwise.\n\nq.put(item [, block [, timeout]])\n\nPuts iteminto the queue. If optional argument blockis True (the default), the caller blocks until a free slot is available. Otherwise (blockis False), the Full exception is raised if the queue is full. timeoutsupplies an optional timeout value in seconds. If a timeout occurs, the Full exception is raised.\n\nq.put_nowait(item)\n\nEquivalent to q.put(item, False).\n\nq.get([block [, timeout]])\n\nRemoves and returns an item from the queue. If optional argument blockis True (the default), the caller blocks until an item is available. Otherwise (blockis False), the Empty exception is raised if the queue is empty. timeoutsupplies an optional timeout value in seconds. If a timeout occurs, the Empty exception is raised.\n\nq.get_nowait()\n\nEquivalent to get(0).\n\nq.task_done()\n\nUsed by consumers of queued data to indicate that processing of an item has been fin- ished. If this is used, it should be called once for every item removed from the queue.\n\nq.join()\n\nBlocks until all items on the queue have been removed and processed.This will only return once q.task_done() has been called for every item placed on the queue.\n\nQueue Example with Threads Multithreaded programs are often simplified with the use of queues. For example, instead of relying upon shared state that must be protected by locks, threads can be linked together using shared queues. In this model, worker threads typically operate as consumers of data. Here is an example that illustrates the concept:\n\nF h Lib f L Bdff",
      "content_length": 2120,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 471,
      "content": "446\n\nChapter 20 Threads and Concurrency\n\nimport threading from queue import Queue # Use from Queue on Python 2\n\nclass WorkerThread(threading.Thread):\n\ndef __init__(self,*args,**kwargs):\n\nthreading.Thread.__init__(self,*args,**kwargs) self.input_queue = Queue()\n\ndef send(self,item):\n\nself.input_queue.put(item)\n\ndef close(self):\n\nself.input_queue.put(None) self.input_queue.join()\n\ndef run(self):\n\nwhile True:\n\nitem = self.input_queue.get() if item is None:\n\nbreak\n\n# Process the item (replace with useful work) print(item) self.input_queue.task_done()\n\n# Done. Indicate that sentinel was received and return self.input_queue.task_done() return\n\n# Example use w = WorkerThread() w.start() w.send(\"hello\") # Send items to the worker (via queue) w.send(\"world\") w.close()\n\nThe design of this class has been chosen very carefully. First, you will notice that the programming API is a subset of the Connection objects that get created by pipes in the multiprocessing module.This allows for future expansion. For example, workers could later be migrated into a separate process without breaking the code that sends them data.\n\nSecond, the programming interface allows for thread termination.The close() method places a sentinel onto the queue which, in turn, causes the thread to shut down when processed.\n\nFinally, the programming API is also almost identical to a coroutine. If the work to\n\nbe performed doesn’t involve any blocking operations, you could reimplement the run() method as a coroutine and dispense with threads altogether.This latter approach might run faster because there would no longer be any overhead due to thread context switching.\n\nCoroutines and Microthreading In certain kinds of applications, it is possible to implement cooperative user-space mul- tithreading using a task scheduler and a collection of generators or coroutines.This is sometimes called microthreading, although the terminology varies—sometimes this is described in the context of tasklets, green threads, greenlets, etc.A common use of this technique is in programs that need to manage a large collection of open files or sockets. For example, a network server that wants to simultaneously manage 1,000 client con- nections. Instead of creating 1,000 threads to do that, asynchronous I/O or polling (using the select module) is used in conjunction with a task scheduler that processes I/O events.\n\nF h Lib f L Bdff",
      "content_length": 2404,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 472,
      "content": "Coroutines and Microthreading\n\n447\n\nThe underlying concept that drives this programming technique is the fact that the\n\nyield statement in a generator or coroutine function suspends the execution of the function until it is later resumed with a next() or send() operation.This makes it possible to cooperatively multitask between a set of generator functions using a sched- uler loop. Here is an example that illustrates the idea:\n\ndef foo():\n\nfor n in xrange(5):\n\nprint(\"I'm foo %d\" % n) yield\n\ndef bar():\n\nfor n in xrange(10):\n\nprint(\"I'm bar %d\" % n) yield\n\ndef spam():\n\nfor n in xrange(7):\n\nprint(\"I'm spam %d\" % n) yield\n\n# Create and populate a task queue from collections import deque taskqueue = deque() taskqueue.append(foo()) # Add some tasks (generators) taskqueue.append(bar()) taskqueue.append(spam())\n\n# Run all of the tasks while taskqueue:\n\n# Get the next task task = taskqueue.pop() try:\n\n# Run it to the next yield and enqueue next(task) taskqueue.appendleft(task)\n\nexcept StopIteration: # Task is done pass\n\nIt is uncommon for a program to define a series of CPU-bound coroutines and sched- ule them as shown. Instead, you are more likely to see this technique used with I/O bound tasks, polling, or event handling.An advanced example showing this technique is found in the select module section of Chapter 21,“Network Programming and Sockets.”\n\nF h Lib f L Bdff",
      "content_length": 1381,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 473,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 474,
      "content": "21\n\nNetwork Programming and Sockets\n\nThis chapter describes the modules used to implement low-level network servers and\n\nclients. Python provides extensive network support, ranging from programming directly with sockets to working with high-level application protocols such as HTTP.To begin, a very brief (and admittedly terse) introduction to network programming is presented. Readers are advised to consult a book such as UNIX Network Programming,Volume 1: Networking APIs: Sockets and XTI by W. Richard Stevens (Prentice Hall, 1997, ISBN 0-13-490012-X) for many of the advanced details. Chapter 22,“Internet Application Programming,” describes modules related to application-level protocols.\n\nNetwork Programming Basics Python’s network programming modules primarily support two Internet protocols:TCP and UDP.The TCP protocol is a reliable connection-oriented protocol used to establish a two-way communications stream between machines. UDP is a lower-level packet-based protocol (connectionless) in which machines send and receive discrete packets of infor- mation without formally establishing a connection. Unlike TCP, UDP communication is unreliable and thus inherently more complicated to manage in applications that require reliable communications. Consequently, most Internet applications utilize TCP connections.\n\nBoth network protocols are handled through a programming abstraction known as a\n\nsocket.A socket is an object similar to a file that allows a program to accept incoming connections, make outgoing connections, and send and receive data. Before two machines can communicate, both must create a socket object.\n\nThe machine receiving the connection (the server) must bind its socket object to a known port number.A port is a 16-bit number in the range 0–65535 that’s managed by the operating system and used by clients to uniquely identify servers. Ports 0–1023 are reserved by the system and used by common network protocols.The following table shows the port assignments for a couple of common protocols (a more complete list can be found at http://www.iana.org/assignments/port-numbers):\n\nF h Lib f L Bdff",
      "content_length": 2130,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 475,
      "content": "450\n\nChapter 21 Network Programming and Sockets\n\nService FTP-Data FTP-Control SSH Telnet SMTP (Mail) HTTP (WWW) POP3 IMAP HTTPS (Secure WWW)\n\nPort Number 20 21 22 23 25 80 110 143 443\n\nThe process of establishing a TCP connection involves a precise sequence of steps on both the server and client, as shown in Figure 21.1.\n\nServer\n\nClient\n\nsocket()\n\nsocket()\n\nbind()\n\nlisten()\n\naccept()\n\nwait for connection\n\nestablish connection\n\nconnect()\n\nread()\n\nrequest\n\nwrite()\n\nprocess request\n\nwrite()\n\nresponse\n\nread()\n\nFigure 21.1 TCP connection protocol.\n\nFor TCP servers, the socket object used to receive connections is not the same socket used to perform subsequent communication with the client. In particular, the accept() system call returns a new socket object that’s actually used for the connection.This allows a server to manage connections from a large number of clients simultaneously.\n\nF h Lib f L Bdff",
      "content_length": 909,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 476,
      "content": "Network Programming Basics\n\n451\n\nUDP communication is performed in a similar manner, except that clients and\n\nservers don’t establish a “connection” with each other, as shown in Figure 21.2.\n\nServer\n\nClient\n\nsocket()\n\nsocket()\n\nbind()\n\nbind()\n\nrecvfrom()\n\nwait for data\n\nrequest\n\nsendto()\n\nprocess request\n\nsendto()\n\nresponse\n\nrecvfrom()\n\nFigure 21.2 UDP connection protocol.\n\nThe following example illustrates the TCP protocol with a client and server written using the socket module. In this case, the server simply returns the current time to the client as a string.\n\n# Time server program from socket import * import time\n\ns = socket(AF_INET, SOCK_STREAM) # Create a TCP socket s.bind(('',8888)) # Bind to port 8888 s.listen(5) # Listen, but allow no more than\n\n# 5 pending connections.\n\nwhile True:\n\nclient,addr = s.accept() # Get a connection print(\"Got a connection from %s\" % str(addr)) timestr = time.ctime(time.time()) + \"\\r\\n\" client.send(timestr.encode('ascii')) client.close()\n\nHere’s the client program:\n\n# Time client program from socket import * s = socket(AF_INET,SOCK_STREAM) # Create a TCP socket s.connect(('localhost', 8888)) # Connect to the server tm = s.recv(1024) # Receive no more than 1024 bytes s.close() print(\"The time is %s\" % tm.decode('ascii'))\n\nF h Lib f L Bdff",
      "content_length": 1295,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 477,
      "content": "452\n\nChapter 21 Network Programming and Sockets\n\nAn example of establishing a UDP connection appears in the socket module section later in this chapter.\n\nIt is common for network protocols to exchange data in the form of text. However, great attention needs to be given to text encoding. In Python 3, all strings are Unicode. Therefore, if any kind of text string is to be sent across the network, it needs to be encoded.This is why the server is using the encode('ascii') method on the data it transmits. Likewise, when a client receives network data, that data is first received as raw unencoded bytes. If you print it out or try to process it as text, you’re unlikely to get what you expected. Instead, you need to decode it first.This is why the client code is using decode('ascii') on the result.\n\nThe remainder of this chapter describes modules that are related to socket program-\n\nming. Chapter 22 describes higher-level modules that provide support for various Internet applications such as email and the Web.\n\nasynchat The asynchat module simplifies the implementation of applications that implement asynchronous networking using the asyncore module. It does this by wrapping the low-level I/O functionality of asyncore with a higher-level programming interface that is designed for network protocols based on simple request/response mechanisms (for example, HTTP).\n\nTo use this module, you must define a class that inherits from async_chat.Within\n\nthis class, you must define two methods: collect_incoming_data() and found_terminator().The first method is invoked whenever data is received on the network connection.Typically, it would simply take the data and store it someplace.The found_terminator() method is called when the end of a request has been detected. For example, in HTTP, requests are terminated by a blank line.\n\nFor data output, async_chat maintains a producer FIFO queue. If you need to out-\n\nput data, it is simply added to this queue.Then, whenever writes are possible on the network connection, data is transparently taken from this queue.\n\nasync_chat([sock])\n\nBase class used to define new handlers. async_chat inherits from asyncore.dispatcher and provides the same methods. sockis a socket object that’s used for communication.\n\nAn instance, a, of async_chat has the following methods in addition to those\n\nalready provided by the asyncore.dispatcher base class:\n\na.close_when_done()\n\nSignals an end-of-file on the outgoing data stream by pushing None onto the producer FIFO queue.When this is reached by the writer, the channel will be closed.\n\na.collect_incoming_data(data)\n\nCalled whenever data is received on the channel. datais the received data and is typi- cally stored for later processing.This method must be implemented by the user.\n\na.discard_buffers()\n\nDiscards all data held in input/output buffers and the producer FIFO queue.\n\nF h Lib f L Bdff",
      "content_length": 2892,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 478,
      "content": "asynchat\n\n453\n\na.found_terminator()\n\nCalled when the termination condition set by set_terminator() holds.This method must be implemented by the user.Typically, it would process data previously collected by the collect_incoming_data() method.\n\na.get_terminator()\n\nReturns the terminator for the channel.\n\na.push(data)\n\nPushes data onto the channel’s outgoing producer FIFO queue. datais a string con- taining the data to be sent.\n\na.push_with_producer(producer)\n\nPushes a producer object, producer, onto the producer FIFO queue. producermay be any object that has a simple method, more().The more() method should produce a string each time it is invoked.An empty string is returned to signal the end of data. Internally, the async_chat class repeatedly calls more() to obtain data to write on the outgoing channel. More than one producer object can be pushed onto the FIFO by calling push_with_producer() repeatedly.\n\ns.set_terminator(term)\n\nSets the termination condition on the channel. termmay either be a string, an integer, or None. If termis a string, the method found_terminator() is called whenever that string appears in the input stream. If termis an integer, it specifies a byte count.After many bytes have been read, found_terminator() will be called. If termis None, data is collected forever.\n\nThe module defines one class that can produce data for the\n\na.push_with_producer() method.\n\nsimple_producer(data [, buffer_size])\n\nCreates a simple producer object that produces chunks from a byte string data. buffer_sizespecifies the chunk size and is 512 by default.\n\nThe asynchat module is always used in conjunction with the asyncore module. For instance, asyncore is used to set up the high-level server, which accepts incoming connections. asynchat is then used to implement handlers for each connection.The following example shows how this works by implementing a minimalistic web server that handles GET requests.The example omits a lot of error checking and details but should be enough to get you started. Readers should compare this example to the example in the asyncore module, which is covered next.\n\n# An asynchronous HTTP server using asynchat import asynchat, asyncore, socket import os import mimetypes try:\n\nfrom http.client import responses # Python 3\n\nexcept ImportError:\n\nfrom httplib import responses # Python 2\n\nF h Lib f L Bdff",
      "content_length": 2359,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 479,
      "content": "454\n\nChapter 21 Network Programming and Sockets\n\n# This class plugs into the asyncore module and merely handles accept events class async_http(asyncore.dispatcher):\n\ndef __init__(self,port):\n\nasyncore.dispatcher.__init__(self) self.create_socket(socket.AF_INET,socket.SOCK_STREAM) self.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) self.bind(('',port)) self.listen(5)\n\ndef handle_accept(self):\n\nclient,addr = self.accept() return async_http_handler(client)\n\n# Class that handles asynchronous HTTP requests. class async_http_handler(asynchat.async_chat):\n\ndef __init__(self,conn=None):\n\nasynchat.async_chat.__init__(self,conn) self.data = [] self.got_header = False self.set_terminator(b\"\\r\\n\\r\\n\")\n\n# Get incoming data and append to data buffer def collect_incoming_data(self,data):\n\nif not self.got_header:\n\nself.data.append(data)\n\n# Got a terminator (the blank line) def found_terminator(self):\n\nself.got_header = True header_data = b\"\".join(self.data) # Decode header data (binary) into text for further processing header_text = header_data.decode('latin-1') header_lines = header_text.splitlines() request = header_lines[0].split() op = request[0] url = request[1][1:] self.process_request(op,url)\n\n# Push text onto the outgoing stream, but encode it first def push_text(self,text):\n\nself.push(text.encode('latin-1'))\n\n# Process the request def process_request(self, op, url):\n\nif op == \"GET\":\n\nif not os.path.exists(url):\n\nself.send_error(404,\"File %s not found\\r\\n\")\n\nelse:\n\ntype, encoding = mimetypes.guess_type(url) size = os.path.getsize(url) self.push_text(\"HTTP/1.0 200 OK\\r\\n\") self.push_text(\"Content-length: %s\\r\\n\" % size) self.push_text(\"Content-type: %s\\r\\n\" % type) self.push_text(\"\\r\\n\") self.push_with_producer(file_producer(url))\n\nelse:\n\nself.send_error(501,\"%s method not implemented\" % op)\n\nself.close_when_done()\n\nF h Lib f L Bdff",
      "content_length": 1862,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 480,
      "content": "asyncore\n\n455\n\n# Error handling def send_error(self,code,message):\n\nself.push_text(\"HTTP/1.0 %s %s\\r\\n\" % (code, responses[code])) self.push_text(\"Content-type: text/plain\\r\\n\") self.push_text(\"\\r\\n\") self.push_text(message)\n\nclass file_producer(object):\n\ndef __init__(self,filename,buffer_size=512):\n\nself.f = open(filename,\"rb\") self.buffer_size = buffer_size\n\ndef more(self):\n\ndata = self.f.read(self.buffer_size) if not data:\n\nself.f.close()\n\nreturn data\n\na = async_http(8080) asyncore.loop()\n\nTo test this example, you will need to supply a URL corresponding to a file in the same directory as where you are running the server.\n\nasyncore The asyncore module is used to build network applications in which network activity is handled asynchronously as a series of events dispatched by an event loop, built using the select() system call. Such an approach is useful in network programs that want to provide concurrency, but without the use of threads or processes.This method can also provide high performance for short transactions.All the functionality of this module is provided by the dispatcher class, which is a thin wrapper around an ordinary socket object.\n\ndispatcher([sock])\n\nBase class defining an event-driven nonblocking socket object. sockis an existing sock- et object. If omitted, a socket must be created using the create_socket() method (described shortly). Once it’s created, network events are handled by special handler methods. In addition, all open dispatcher objects are saved in an internal list that’s used by a number of polling functions.\n\nThe following methods of the dispatcher class are called to handle network\n\nevents.They should be defined in classes derived from dispatcher.\n\nd.handle_accept()\n\nCalled on listening sockets when a new connection arrives.\n\nd.handle_close()\n\nCalled when the socket is closed.\n\nd.handle_connect()\n\nCalled when a connection is made.\n\nd.handle_error()\n\nCalled when an uncaught Python exception occurs.\n\nF h Lib f L Bdff",
      "content_length": 1985,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 481,
      "content": "456\n\nChapter 21 Network Programming and Sockets\n\nd.handle_expt()\n\nCalled when out-of-band data for a socket is received.\n\nd.handle_read()\n\nCalled when new data is available to be read from a socket.\n\nd.handle_write()\n\nCalled when an attempt to write data is made.\n\nd.readable()\n\nThis function is used by the select() loop to see whether the object is willing to read data. Returns True if so, False if not.This method is called to see if the handle_read() method should be called with new data.\n\nd.writable()\n\nCalled by the select() loop to see if the object wants to write data. Returns True if so, False otherwise.This method is always called to see whether the handle_write() method should be called to produce output.\n\nIn addition to the preceding methods, the following methods are used to perform\n\nlow-level socket operations.They’re similar to those available on a socket object.\n\nd.accept()\n\nAccepts a connection. Returns a pair (client, addr) where clientis a socket object used to send and receive data on the connection and addris the address of the client.\n\nd.bind(address)\n\nBinds the socket to address. addressis typically a tuple (host, port), but this depends the address family being used.\n\nd.close()\n\nCloses the socket.\n\nd.connect(address)\n\nMakes a connection. addressis a tuple (host, port).\n\nd.create_socket(family, type)\n\nCreates a new socket.Arguments are the same as for socket.socket().\n\nd.listen([backlog])\n\nListens for incoming connections. backlogis an integer that is passed to the underlying socket.listen() function.\n\nd.recv(size)\n\nReceives at most sizebytes.An empty string indicates the client has closed the chan- nel.\n\nd.send(data)\n\nSends data. datais a byte string.\n\nF h Lib f L Bdff",
      "content_length": 1717,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 482,
      "content": "asyncore\n\n457\n\nThe following function is used to start the event loop and process events:\n\nloop([timeout [, use_poll [, map [, count]]]])\n\nPolls for events indefinitely.The select() function is used for polling unless the use_pollparameter is True, in which case poll() is used instead. timeoutis the timeout period and is set to 30 seconds by default. mapis a dictionary containing all the channels to monitor. countspecifies how many polling operations to perform before returning. If countis None (the default), loop() polls forever until all channels are closed. If count is 1, the function will execute a single poll for events and return.\n\nExample The following example implements a minimalistic web server using asyncore. It implements two classes—asynhttp for accepting connections and asynclient for processing client requests.This should be compared with the example in the asynchat module.The main difference is that this example is somewhat lower-level—requiring us to worry about breaking the input stream into lines, buffering excess data, and identify- ing the blank line that terminates the request header.\n\n# An asynchronous HTTP server import asyncore, socket import os import mimetypes import collections try:\n\nfrom http.client import responses # Python 3\n\nexcept ImportError:\n\nfrom httplib import responses # Python 2\n\n# This class merely handles accept events class async_http(asyncore.dispatcher):\n\ndef __init__(self,port):\n\nasyncore.dispatcher.__init__(self) self.create_socket(socket.AF_INET,socket.SOCK_STREAM) self.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) self.bind(('',port)) self.listen(5)\n\ndef handle_accept(self):\n\nclient,addr = self.accept() return async_http_handler(client)\n\n# Handle clients class async_http_handler(asyncore.dispatcher):\n\ndef __init__(self, sock = None):\n\nasyncore.dispatcher.__init__(self,sock) self.got_request = False # Read HTTP request? self.request_data = b\"\" self.write_queue = collections.deque() self.responding = False\n\n# Only readable if request header not read def readable(self):\n\nreturn not self.got_request\n\nF h Lib f L Bdff",
      "content_length": 2103,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 483,
      "content": "458\n\nChapter 21 Network Programming and Sockets\n\n# Read incoming request data def handle_read(self):\n\nchunk = self.recv(8192) self.request_data += chunk if b'\\r\\n\\r\\n' in self.request_data:\n\nself.handle_request()\n\n# Handle an incoming request def handle_request(self):\n\nself.got_request = True header_data = self.request_data[:self.request_data.find(b'\\r\\n\\r\\n')] header_text = header_data.decode('latin-1') header_lines = header_text.splitlines() request = header_lines[0].split() op = request[0] url = request[1][1:] self.process_request(op,url)\n\n# Process the request def process_request(self,op,url):\n\nself.responding = True if op == \"GET\":\n\nif not os.path.exists(url):\n\nself.send_error(404,\"File %s not found\\r\\n\" % url)\n\nelse:\n\ntype, encoding = mimetypes.guess_type(url) size = os.path.getsize(url) self.push_text('HTTP/1.0 200 OK\\r\\n') self.push_text('Content-length: %d\\r\\n' % size) self.push_text('Content-type: %s\\r\\n' % type) self.push_text('\\r\\n') self.push(open(url,\"rb\").read())\n\nelse:\n\nself.send_error(501,\"%s method not implemented\" % self.op)\n\n# Error handling def send_error(self,code,message):\n\nself.push_text('HTTP/1.0 %s %s\\r\\n' % (code, responses[code])) self.push_text('Content-type: text/plain\\r\\n') self.push_text('\\r\\n') self.push_text(message)\n\n# Add binary data to the output queue def push(self,data):\n\nself.write_queue.append(data)\n\n# Add text data to the output queue def push_text(self,text):\n\nself.push(text.encode('latin-1'))\n\n# Only writable if a response is ready def writable(self):\n\nreturn self.responding and self.write_queue\n\n# Write response data def handle_write(self):\n\nchunk = self.write_queue.popleft() bytes_sent = self.send(chunk) if bytes_sent != len(chunk):\n\nself.write_queue.appendleft(chunk[bytes_sent:])\n\nif not self.write_queue:\n\nself.close()\n\nF h Lib f L Bdff",
      "content_length": 1813,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 484,
      "content": "select\n\n459\n\n# Create the server a = async_http(8080) # Poll forever asyncore.loop()\n\nSee Also:\n\nsocket (p. 469), select (p. 459), http (p. 500), SocketServer (p. 489)\n\nselect The select module provides access to the select() and poll() system calls. select() is typically used to implement polling or to multiplex processing across mul- tiple input/output streams without using threads or subprocesses. On UNIX, it works for files, sockets, pipes, and most other file types. On Windows, it only works for sock- ets.\n\nselect(iwtd, owtd, ewtd [, timeout])\n\nQueries the input, output, and exceptional status of a group of file descriptors.The first three arguments are lists containing either integer file descriptors or objects with a method, fileno(), that can be used to return a file descriptor.The iwtdparameter specifies objects waiting for input, owtdspecifies objects waiting for output, and ewtd specifies objects waiting for an exceptional condition. Each list may be empty. timeout is a floating-point number specifying a timeout period in seconds. If timeoutis omit- ted, the function waits until at least one file descriptor is ready. If it’s 0, the function merely performs a poll and returns immediately.The return value is a tuple of lists con- taining the objects that are ready.These are subsets of the first three arguments. If none of the objects is ready before the timeout occurs, three empty lists are returned. If an error occurs, a select.error exception raised. Its value is the same as that returned by IOError and OSError.\n\npoll()\n\nCreates a polling object that utilizes the poll() system call.This is only available on systems that support poll().\n\nA polling object, p, returned by poll() supports the following methods:\n\np.register(fd [, eventmask])\n\nRegisters a new file descriptor, fd. fdis either an integer file descriptor or an object that provides the fileno() method from which the descriptor can be obtained. eventmaskis the bitwise OR of the following flags, which indicate events of interest:\n\nConstant POLLIN\n\nPOLLPRI\n\nPOLLOUT\n\nPOLLERR\n\nDescription Data is available for reading. Urgent data is available for reading. Ready for writing. Error condition.\n\nF h Lib f L Bdff",
      "content_length": 2210,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 485,
      "content": "460\n\nChapter 21 Network Programming and Sockets\n\nConstant POLLHUP\n\nPOLLNVAL\n\nDescription Hang up. Invalid request.\n\nIf eventmaskis omitted, the POLLIN, POLLPRI, and POLLOUT events are checked.\n\np.unregister(fd)\n\nRemoves the file descriptor fdfrom the polling object. Raises KeyError if the file is not registered.\n\np.poll([timeout])\n\nPolls for events on all the registered file descriptors. timeoutis an optional timeout specified in milliseconds. Returns a list of tuples (fd, event), where fdis a file descriptor and eventis a bitmask indicating events.The fields of this bitmask corre- spond to the constants POLLIN, POLLOUT, and so on. For example, to check for the POLLIN event, simply test the value using event & POLLIN. If an empty list is returned, it means a timeout occurred and no events occurred.\n\nAdvanced Module Features The select() and poll() functions are the most generally portable functions defined by this module. On Linux systems, the select module also provides an interface to the edge and level trigger polling (epoll) interface which can offer significantly better per- formance. On BSD systems, access to kernel queue and event objects is provided.These programming interfaces are described in the online documentation for select at http://docs.python.org/library/select.\n\nAdvanced Asynchronous I/O Example The select module is sometimes used to implement servers based on tasklets or coroutines—a technique that can be used to provide concurrent execution without threads or processes.The following advanced example illustrates this concept by imple- menting an I/O-based task scheduler for coroutines. Be forewarned—this is the most advanced example in the book and it will require some study for it to make sense.You might also want to consult my PyCON’09 tutorial “A Curious Course on Coroutines and Concurrency” (http://www.dabeaz.com/coroutines) for additional reference material.\n\nimport select import types import collections\n\nF h Lib f L Bdff",
      "content_length": 1979,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 486,
      "content": "# Object that represents a running task class Task(object):\n\ndef __init__(self,target):\n\nself.target = target # A coroutine self.sendval = None # Value to send when resuming self.stack = [] # Call stack\n\ndef run(self):\n\ntry:\n\nresult = self.target.send(self.sendval) if isinstance(result,SystemCall):\n\nreturn result\n\nif isinstance(result,types.GeneratorType):\n\nself.stack.append(self.target) self.sendval = None self.target = result\n\nelse:\n\nif not self.stack: return self.sendval = result self.target = self.stack.pop()\n\nexcept StopIteration:\n\nif not self.stack: raise self.sendval = None self.target = self.stack.pop()\n\n# Object that represents a \"system call\" class SystemCall(object):\n\ndef handle(self,sched,task):\n\npass\n\n# Scheduler object class Scheduler(object): def __init__(self):\n\nself.task_queue = collections.deque() self.read_waiting = {} self.write_waiting = {} self.numtasks = 0\n\n# Create a new task out of a coroutine def new(self,target):\n\nnewtask = Task(target) self.schedule(newtask) self.numtasks += 1\n\n# Put a task on the task queue def schedule(self,task):\n\nself.task_queue.append(task)\n\n# Have a task wait for data on a file descriptor def readwait(self,task,fd):\n\nself.read_waiting[fd] = task\n\nselect\n\n461\n\nF h Lib f L Bdff",
      "content_length": 1245,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 487,
      "content": "462\n\nChapter 21 Network Programming and Sockets\n\n# Have a task wait for writing on a file descriptor def writewait(self,task,fd):\n\nself.write_waiting[fd] = task\n\n# Main scheduler loop def mainloop(self,count=-1,timeout=None):\n\nwhile self.numtasks:\n\n# Check for I/O events to handle if self.read_waiting or self.write_waiting:\n\nwait = 0 if self.task_queue else timeout r,w,e = select.select(self.read_waiting, self.write_waiting, [],\n\nwait)\n\nfor fileno in r:\n\nself.schedule(self.read_waiting.pop(fileno))\n\nfor fileno in w:\n\nself.schedule(self.write_waiting.pop(fileno))\n\n# Run all of the tasks on the queue that are ready to run while self.task_queue:\n\ntask = self.task_queue.popleft() try:\n\nresult = task.run() if isinstance(result,SystemCall): result.handle(self,task)\n\nelse:\n\nself.schedule(task)\n\nexcept StopIteration:\n\nself.numtasks -= 1\n\n# If no tasks can run, we decide if we wait or return else:\n\nif count > 0: count -= 1 if count == 0: return\n\n# Implementation of different system calls class ReadWait(SystemCall):\n\ndef __init__(self,f):\n\nself.f = f\n\ndef handle(self,sched,task): fileno = self.f.fileno() sched.readwait(task,fileno)\n\nclass WriteWait(SystemCall): def __init__(self,f):\n\nself.f = f\n\ndef handle(self,sched,task): fileno = self.f.fileno() sched.writewait(task,fileno)\n\nclass NewTask(SystemCall):\n\ndef __init__(self,target): self.target = target def handle(self,sched,task):\n\nsched.new(self.target) sched.schedule(task)\n\nThe code in this example implements a very tiny “operating system.” Here are some details concerning its operation:\n\nn All work is carried out by coroutine functions. Recall that a coroutine uses the\n\nyield statement like a generator except that instead of iterating on it, you send it values using a send(value) method.\n\nF h Lib f L Bdff",
      "content_length": 1778,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 488,
      "content": "select\n\n463\n\nn The Task class represents a running task and is just a thin layer on top of a coroutine.A Task object taskhas only one operation, task.run().This resumes the task and runs it until it hits the next yield statement, at which point the task suspends.When running a task, the task.sendval attribute contains the value that is to be sent into the task’s corresponding yield expression.Tasks run until they encounter the next yield statement.The value produced by this yield controls what happens next in the task:\n\nn If the value is another coroutine (type.GeneratorType), it means that the\n\ntask wants to temporarily transfer control to that coroutine.The stack attribute of Task objects represents a call-stack of coroutines that is built up when this happens.The next time the task runs, control will be transferred into this new coroutine.\n\nn If the value is a SystemCall instance, it means that the task wants the\n\nscheduler to do something on its behalf (such as launch a new task, wait for I/O, and so on).The purpose of this object is described shortly.\n\nn If the value is any other value, one of two things happens. If the currently\n\nexecuting coroutine was running as a subroutine, it is popped from the task call stack and the value saved so that it can be sent to the caller.The caller will receive this value the next time the task executes. If the coroutine is the only executing coroutine, the return value is simply discarded.\n\nn The handling of StopIteration is to deal with coroutines that have termi- nated.When this happens, control is returned to the previous coroutine (if there was one) or the exception is propagated to the scheduler so that it knows that the task terminated.\n\nn The SystemCall class represents a system call in the scheduler.When a running\n\ntask wants the scheduler to carry out an operation on its behalf, it yields a SystemCall instance.This object is called a “system call” because it mimics the behavior of how programs request the services of a real multitasking operating system such as UNIX or Windows. In particular, if a program wants the services of the operating system, it yields control and provides some information back to the system so that it knows what to do. In this respect, yielding a SystemCall is similar to executing a kind of system “trap.”\n\nn The Scheduler class represents a collection of Task objects that are being man- aged.At its core, the scheduler is built around a task queue (the task_queue attribute) that keeps track of tasks that are ready to run.There are four basic operations concerning the task queue. new() takes a new coroutine, wraps it with a Task object, and places it on the work queue. schedule() takes an existing Task and puts it back on the work queue. mainloop() runs the scheduler in a loop, processing tasks one by one until there are no more tasks.The readwait() and writewait() methods put a Task object into temporary staging areas where it will wait for I/O events. In this case, the Task isn’t running, but it’s not dead either—it’s just sitting around biding its time.\n\nn The mainloop() method is the heart of the scheduler.This method first checks to see if any tasks are waiting for I/O events. If so, it arranges a call to select() in order to poll for I/O activity. If there are any events of interest, the associated tasks are placed back onto the task queue so that they can run. Next, the mainloop() method pops tasks off of the task queue and calls their run()\n\nF h Lib f L Bdff",
      "content_length": 3500,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 489,
      "content": "464\n\nChapter 21 Network Programming and Sockets\n\nmethod. If any task exits (StopIteration), it is discarded. If a task merely yields, it is just placed back onto the task queue so that it can run again.This continues until there are either no more tasks or all tasks are blocked, waiting for more I/O events.As an option, the mainloop() function accepts a count parameter that can be used to make it return after a specified number of I/O polling operations. This might be useful if the scheduler is to be integrated into another event loop.\n\nn Perhaps the most subtle aspect of the scheduler is the handling of SystemCall\n\ninstances in the mainloop() method. If a task yields a SystemCall instance, the scheduler invokes its handle() method, passing in the associated Scheduler and Task objects as parameters.The purpose of a system call is to carry out some kind of internal operation concerning tasks or the scheduler itself.The ReadWait(), WriteWait(), and NewTask() classes are examples of system calls that suspend a task for I/O or create a new task. For example, ReadWait() takes a task and invokes the readwait() method on the scheduler.The scheduler then takes the task and places it into an appropriate holding area.Again, there is a criti- cal decoupling of objects going on here.Tasks yield SystemCall objects to request service, but do not directly interact with the scheduler. SystemCall objects, in turn, can perform operations on tasks and schedulers but are not tied to any specific scheduler or task implementation. So, in theory, you could write a completely different scheduler implementation (maybe using threads) that could just be plugged into this whole framework and it would still work.\n\nHere is an example of a simple network time server implemented using this I/O task scheduler. It will illuminate many of the concepts described in the previous list:\n\nfrom socket import socket, AF_INET, SOCK_STREAM def time_server(address):\n\nimport time s = socket(AF_INET,SOCK_STREAM) s.bind(address) s.listen(5) while True:\n\nyield ReadWait(s) conn,addr = s.accept() print(\"Connection from %s\" % str(addr)) yield WriteWait(conn) resp = time.ctime() + \"\\r\\n\" conn.send(resp.encode('latin-1')) conn.close()\n\nsched = Scheduler() sched.new(time_server(('',10000))) # Server on port 10000 sched.new(time_server(('',11000))) # Server on port 11000 sched.run()\n\nIn this example, two different servers are running concurrently—each listening on a dif- ferent port number (use telnet to connect and test).The yield ReadWait() and yield WriteWait() statements cause the coroutine running each server to suspend until I/O is possible on the associated socket.When these statements return, the code immediately proceeds with an I/O operation such as accept() or send().\n\nF h Lib f L Bdff",
      "content_length": 2791,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 490,
      "content": "select\n\n465\n\nThe use of ReadWait and WriteWait might look rather low-level. Fortunately, our\n\ndesign allows these operations to be hidden behind library functions and methods— provided that they are also coroutines. Consider the following object that wraps a socket object and mimics its interface:\n\nclass CoSocket(object):\n\ndef __init__(self,sock): self.sock = sock\n\ndef close(self):\n\nyield self.sock.close()\n\ndef bind(self,addr):\n\nyield self.sock.bind(addr)\n\ndef listen(self,backlog):\n\nyield self.sock.listen(backlog)\n\ndef connect(self,addr):\n\nyield WriteWait(self.sock) yield self.sock.connect(addr)\n\ndef accept(self):\n\nyield ReadWait(self.sock) conn, addr = self.sock.accept() yield CoSocket(conn), addr\n\ndef send(self,bytes): while bytes:\n\nevt = yield WriteWait(self.sock) nsent = self.sock.send(bytes) bytes = bytes[nsent:]\n\ndef recv(self,maxsize):\n\nyield ReadWait(self.sock) yield self.sock.recv(maxsize)\n\nHere is a reimplementation of the time server using the CoSocket class:\n\nfrom socket import socket, AF_INET, SOCK_STREAM def time_server(address):\n\nimport time s = CoSocket(socket(AF_INET,SOCK_STREAM)) yield s.bind(address) yield s.listen(5) while True:\n\nconn,addr = yield s.accept() print(conn) print(\"Connection from %s\" % str(addr)) resp = time.ctime()+\"\\r\\n\" yield conn.send(resp.encode('latin-1')) yield conn.close()\n\nsched = Scheduler() sched.new(time_server(('',10000))) # Server on port 10000 sched.new(time_server(('',11000))) # Server on port 11000 sched.run()\n\nIn this example, the programming interface of a CoSocket object looks a lot like a nor- mal socket.The only difference is that every operation must be prefaced with yield (since every method is defined as a coroutine).At first, it looks crazy so you might ask what does all of this madness buy you? If you run the above server, you will find that it is able to run concurrently without using threads or subprocesses. Not only that, it has “normal” looking control flow as long as you ignore all of the yield keywords.\n\nF h Lib f L Bdff",
      "content_length": 2020,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 491,
      "content": "466\n\nChapter 21 Network Programming and Sockets\n\nHere is an asynchronous web server that concurrently handles multiple client con- nections, but which does not use callback functions, threads, or processes.This should be compared to examples in the asynchat and asyncore modules.\n\nimport os import mimetypes try:\n\nfrom http.client import responses # Python 3\n\nexcept ImportError:\n\nfrom httplib import responses # Python 2\n\nfrom socket import *\n\ndef http_server(address):\n\ns = CoSocket(socket(AF_INET,SOCK_STREAM)) yield s.bind(address) yield s.listen(50)\n\nwhile True:\n\nconn,addr = yield s.accept() yield NewTask(http_request(conn,addr)) del conn, addr\n\ndef http_request(conn,addr):\n\nrequest = b\"\" while True:\n\ndata = yield conn.recv(8192) request += data if b'\\r\\n\\r\\n' in request: break\n\nheader_data = request[:request.find(b'\\r\\n\\r\\n')] header_text = header_data.decode('latin-1') header_lines = header_text.splitlines() method, url, proto = header_lines[0].split() if method == 'GET':\n\nif os.path.exists(url[1:]):\n\nyield serve_file(conn,url[1:])\n\nelse:\n\nyield error_response(conn,404,\"File %s not found\" % url)\n\nelse:\n\nyield error_response(conn,501,\"%s method not implemented\" % method)\n\nyield conn.close()\n\ndef serve_file(conn,filename):\n\ncontent,encoding = mimetypes.guess_type(filename) yield conn.send(b\"HTTP/1.0 200 OK\\r\\n\") yield conn.send((\"Content-type: %s\\r\\n\" % content).encode('latin-1')) yield conn.send((\"Content-length: %d\\r\\n\" %\n\nos.path.getsize(filename)).encode('latin-1'))\n\nyield conn.send(b\"\\r\\n\") f = open(filename,\"rb\") while True:\n\ndata = f.read(8192) if not data: break yield conn.send(data)\n\ndef error_response(conn,code,message):\n\nyield conn.send((\"HTTP/1.0 %d %s\\r\\n\" %\n\n(code, responses[code])).encode('latin-1'))\n\nyield conn.send(b\"Content-type: text/plain\\r\\n\") yield conn.send(b\"\\r\\n\") yield conn.send(message.encode('latin-1'))\n\nF h Lib f L Bdff",
      "content_length": 1879,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 492,
      "content": "select\n\n467\n\nsched = Scheduler() sched.new(http_server(('',8080))) sched.mainloop()\n\nCareful study of this example will yield tremendous insight into coroutines and concur- rent programming techniques used by some very advanced third-party modules. However, excessive usage of these techniques might get you fired after your next code review.\n\nWhen to Consider Asynchronous Networking Use of asynchronous I/O (asyncore and asynchat), polling, and coroutines as shown in previous examples remains one of the most mysterious aspects of Python develop- ment.Yet, these techniques are used more often than you might think.An often-cited reason for using asynchronous I/O is to minimize the perceived overhead of program- ming with a large number of threads, especially when managing a large number of clients and in light of restrictions related to the global interpreter lock (refer to Chapter 20,“Threads and Concurrency”).\n\nHistorically, the asyncore module was one of the first library modules to support asynchronous I/O.The asynchat module followed some time later with the aim of simplifying much of the coding. However, both of these modules take the approach of processing I/O as events. For example, when an I/O event occurs, a callback function is triggered.The callback then reacts in response to the I/O event and carries out some processing. If you build a large application in this style, you will find that event handling infects almost every part of the application (e.g., I/O events trigger callbacks, which trigger more callbacks, which trigger other callbacks, ad nauseum). One of the more popular networking packages,Twisted (http://twistedmatrix.com), takes this approach and significantly builds upon it.\n\nCoroutines are more modern but less commonly understood and used since they were only first introduced in Python 2.5.An important feature of coroutines is that you can write programs that look more like threaded programs in their overall control flow. For instance, the web server in the example does not use any callback functions and looks almost identical to what you would write if you were using threads—you just have to become comfortable with the use of the yield statement. Stackless Python (http://www.stackless.com) takes this idea even further.\n\nAs a general rule, you probably should resist the urge to use asynchronous I/O tech-\n\nniques for most network applications. For instance, if you need to write a server that constantly transmits data over hundreds or even thousands of simultaneous network connections, threads will tend to have superior performance.This is because the per- formance of select() degrades significantly as the number of connections it must monitor increases. On Linux, this penalty can be reduced using special functions such as epoll(), but this limits the portability of your code. Perhaps the main benefit of asyn- chronous I/O is in applications where networking needs to be integrated with other event loops (e.g., GUIs) or in applications where networking is added into code that also performs a significant amount of CPU processing. In these cases, the use of asyn- chronous networking may result in quicker response time.\n\nF h Lib f L Bdff",
      "content_length": 3210,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 493,
      "content": "468\n\nChapter 21 Network Programming and Sockets\n\nJust to illustrate, consider the following program that carries out the task described\n\nin the song “10 million bottles of beer on the wall”:\n\nbottles = 10000000\n\ndef drink_beer():\n\nremaining = 12.0 while remaining > 0.0: remaining -= 0.1\n\ndef drink_bottles():\n\nglobal bottles while bottles > 0: drink_beer() bottles -= 1\n\nNow, suppose you wanted to add a remote monitoring capability to this code that allows clients to connect and see how many bottles are remaining. One approach is to launch a server in its own thread and have it run alongside the main application like this:\n\ndef server(port):\n\ns = socket.socket(socket.AF_INET,socket.SOCK_STREAM) s.bind(('',port)) s.listen(5) while True:\n\nclient,addr = s.accept() client.send((\"%d bottles\\r\\n\" % bottles).encode('latin-1') client.close()\n\n# Launch the monitor server thr = threading.Thread(target=server,args=(10000,)) thr.daemon=True thr.start() drink_bottles()\n\nThe other approach is to write a server based on I/O polling and embed a polling operation directly into the main computation loop. Here is an example that uses the coroutine scheduler developed earlier:\n\ndef drink_bottles():\n\nglobal bottles while bottles > 0: drink_beer() bottles -= 1 scheduler.mainloop(count=1,timeout=0) # Poll for connections\n\n# An asynchronous server based on coroutines. def server(port):\n\ns = CoSocket(socket.socket(socket.AF_INET,socket.SOCK_STREAM)) yield s.bind(('',port)) yield s.listen(5) while True:\n\nclient,addr = yield s.accept() yield client.send((\"%d bottles\\r\\n\" % bottles).encode('latin-1') yield client.close()\n\nscheduler = Scheduler() scheduler.new(server(10000)) drink_bottles()\n\nIf you write a separate program that periodically connects to the bottles of beer pro- gram and measures the response time required to receive a status message, the results are\n\nF h Lib f L Bdff",
      "content_length": 1884,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 494,
      "content": "socket\n\n469\n\nsurprising. On the author’s machine (a dual-core 2 GHZ MacBook), the average response time (measured over 1,000 requests) for the coroutine-based server is about 1ms versus 5ms for threads.This difference is explained by the fact that the coroutine- based code is able to respond as soon as it detects a connection whereas the threaded server doesn’t get to run until it is scheduled by the operating system. In the presence of a CPU-bound thread and the Python global interpreter lock, the server may be delayed until the CPU-bound thread exceeds its allotted time slice. On many systems, the time slice is about 10ms so the above rough measurement of thread response time is exactly the average time you might expect to wait for a CPU-bound task to be preempted by the operating system.\n\nThe downside to polling is that it introduces significant overhead if it occurs too often. For instance, even though the response time is lower in this example, the program instrumented with polling takes more than 50% longer to run to completion. If you change the code to only poll after every six-pack of beer, the response time increases slightly to 1.2ms whereas the run time of the program is only 3% greater than the pro- gram without any polling. Unfortunately, there is often no clear-cut way to know how often to poll other than to make measurements of your application.\n\nEven though this improved response time might look like a win, there are still horri- ble problems associated with trying to implement your own concurrency. For example, tasks need to be especially careful when performing any kind of blocking operation. In the web server example, there is a fragment of code that opens and reads data from a file.When this operation occurs, the entire program will be frozen—potentially for a long period of time if the file access involves a disk seek.The only way to fix this would be to additionally implement asynchronous file access and add it as a feature to the scheduler. For more complicated operations such as performing a database query, figur- ing out how to carry out the work in an asynchronous manner becomes rather com- plex. One way to do it would be to carry out the work in a separate thread and to communicate the results back to the task scheduler when available—something that could be carried out with careful use of message queues. On some systems, there are low-level system calls for asynchronous I/O (such as the aio_* family of functions on UNIX).As of this writing, the Python library provides no access to those functions, although you can probably find bindings through third-party modules. In the author’s experience, using such functionality is a lot trickier than it looks and is not really worth the added complexity that gets introduced into your program—you’re often better off letting the thread library deal with such matters.\n\nsocket The socket module provides access to the standard BSD socket interface.Although it’s based on UNIX, this module is available on all platforms.The socket interface is designed to be generic and is capable of supporting a wide variety of networking pro- tocols (Internet,TIPC, Bluetooth, and so on). However, the most common protocol is the Internet Protocol (IP), which includes both TCP and UDP. Python supports both IPv4 and IPv6, although IPv4 is far more common.\n\nIt should be noted that this module is relatively low-level, providing direct access to the network functions provided by the operating system. If you are writing a network application, it may be easier to use the modules described in Chapter 22 or the SocketServer module described at the end of this chapter.\n\nF h Lib f L Bdff",
      "content_length": 3688,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 495,
      "content": "470\n\nChapter 21 Network Programming and Sockets\n\nAddress Families Some of the socket functions require the specification of an address family.The family specifies the network protocol being used.The following constants are defined for this purpose:\n\nConstant AF_BLUETOOTH\n\nAF_INET\n\nAF_INET6\n\nAF_NETLINK AF_PACKET\n\nAF_TIPC\n\nDescription Bluetooth protocol IPv4 protocols (TCP, UDP) IPv6 protocols (TCP, UDP) Netlink Interprocess Communication Link-level packets Transparent Inter-Process Communication protocol UNIX domain protocols\n\nAF_UNIX\n\nOf these, AF_INET and AF_INET6 are the most commonly used because they represent standard Internet connections. AF_BLUETOOTH is only available on systems that support it (typically embedded systems). AF_NETLINK, AF_PACKET, and AF_TIPC are only sup- ported on Linux. AF_NETLINK is used for fast interprocess communication between user applications and the Linux kernel. AF_PACKET is used for working directly at the data- link layer (e.g., raw ethernet packets). AF_TIPC is a protocol used for high-performance IPC on Linux clusters (http://tipc.sourceforge.net/).\n\nSocket Types Some socket functions also require the specification of a socket type.The socket type specifies the type of communications (streams or packets) to be used within a given protocol family.The following constants are used for this purpose:\n\nConstant SOCK_STREAM\n\nSOCK_DGRAM\n\nSOCK_RAW\n\nSOCK_RDM\n\nSOCK_SEQPACKET\n\nDescription A reliable connection-oriented byte stream (TCP) Datagrams (UDP) Raw socket Reliable datagrams Sequenced connection-mode transfer of records\n\nThe most common socket types are SOCK_STREAM and SOCK_DGRAM because they cor- respond to TCP and UDP in the Internet Protocol suite. SOCK_RDM is a reliable form of UDP that guarantees the delivery of a datagram but doesn’t preserve ordering (data- grams might be received in a different order than sent). SOCK_SEQPACKET is used to send packets through a stream-oriented connection in a manner that preserves their order and packet boundaries. Neither SOCK_RDM or SOCK_SEQPACKET are widely sup- ported, so it’s best not to use them if you care about portability. SOCK_RAW is used to provide low-level access to the raw protocol and is used if you want to carry out special-purpose operations such as sending control messages (e.g., ICMP messages). Use of SOCK_RAW is usually restricted to programs running with superuser or administrator access.\n\nF h Lib f L Bdff",
      "content_length": 2443,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 496,
      "content": "socket\n\n471\n\nNot every socket type is supported by every protocol family. For example, if you’re\n\nusing AF_PACKET to sniff ethernet packets on Linux, you can’t establish a stream- oriented connection using SOCK_STREAM. Instead, you have to use SOCK_DGRAM or SOCK_RAW. For AF_NETLINK sockets, SOCK_RAW is the only supported type.\n\nAddressing In order to perform any communication on a socket, you have to specify a destination address.The form of the address depends on the address family of the socket.\n\nAF_INET (IPv4) For Internet applications using IPv4, addresses are specified as a tuple (host, port). Here are two examples:\n\n('www.python.org', 80) ('66.113.130.182', 25)\n\nIf hostis the empty string, it has the same meaning as INADDR_ANY, which means any address.This is typically used by servers when creating sockets that any client can con- nect to. If hostis set to '<broadcast>', it has the same meaning as the INADDR_BROADCAST constant in the socket API.\n\nBe aware that when host names such as 'www.python.org' are used, Python uses DNS to resolve the host name into an IP address. Depending on how DNS has been configured, you may get a different IP address each time. Use a raw IP address such as '66.113.130.182' to avoid this behavior, if needed.\n\nAF_INET6 (IPv6) For IPv6, addresses are specified as a 4-tuple (host, port, flowinfo, scopeid). With IPv6, the hostand portcomponents work in the same way as IPv4, except that the numerical form of an IPv6 host address is typically specified by a string of eight colon-separated hexadecimal numbers, such as 'FEDC:BA98:7654:3210:FEDC:BA98:7654:3210' or '080A::4:1' (in this case, the double colon fills in a range of address components with 0s).\n\nThe flowinfoparameter is a 32-bit number consisting of a 24-bit flow label (the low 24 bits), a 4-bit priority (the next 4 bits), and four reserved bits (the high 4 bits).A flow label is typically only used when a sender wants to enable special handling by routers. Otherwise, flowinfois set to 0.\n\nThe scopeidparameter is a 32-bit number that’s only needed when working with\n\nlink-local and site-local addresses.A link-local address always starts with the prefix 'FE80:...' and is used between machines on the same LAN (routers will not forward link-local packets). In this case, scopeidan interface index that identifies a specific net- work interface on the host.This information can be viewed using a command such as 'ifconfig' on UNIX or 'ipv6 if' on Windows.A site-local address always starts with the prefix 'FEC0:...' and is used between machines within the same site (for example, all machines on a given subnet). In this case, scopeidis a site-identifier num- ber.\n\nIf no data is given for flowinfoor scopeid, an IPv6 address can be given as the\n\ntuple (host, port), as with IPv4.\n\nF h Lib f L Bdff",
      "content_length": 2818,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 497,
      "content": "472\n\nChapter 21 Network Programming and Sockets\n\nAF_UNIX For UNIX domain sockets, the address is a string containing a path name—for example, '/tmp/myserver'.\n\nAF_PACKET For the Linux packet protocol, the address is a tuple (device, protonum [, pkttype [, hatype [, addr]]]) where deviceis a string specifying the device name such as \"eth0\" and protonumis an integer specifying the ethernet protocol number as defined in the <linux/if_ether.h> header file (e.g., 0x0800 for an IP packet). packet_typeis an integer specifying the packet type and is one of the following constants:\n\nConstant PACKET_HOST\n\nPACKET_BROADCAST\n\nPACKET_MULTICAST\n\nPACKET_OTHERHOST\n\nPACKET_OUTGOING\n\nDescription Packet address to the local host. Physical layer broadcast packet. Physical layer multicast. Packet destined for a different host, but caught by a device driver in promiscuous mode. Packet originating on the machine, but which has looped back to a packet socket.\n\nhatypeis an integer specifying the hardware address type as used in the ARP protocol and defined in the <linux/if_arp.h> header file. addris a byte string containing a hardware address, the structure of which depends on the value of hatype. For ethernet, addrwill be a 6-byte string holding the hardware address.\n\nAF_NETLINK For the Linux Netlink protocol, the address is a tuple (pid, groups) where pidand groupsare both unsigned integers. pidis the unicast address of the socket and is usually the same as the process ID of the process that created the socket or 0 for the kernel. groupsis a bit mask used to specify multicast groups to join. Refer to the Netlink doc- umentation for more information.\n\nAF_BLUETOOTH Bluetooth addresses depend on the protocol being used. For L2CAP, the address is a tuple (addr, psm) where addris a string such as '01:23:45:67:89:ab' and psmis an unsigned integer. For RFCOMM, the address is a tuple (addr, channel) where addris an address string and channelis an integer. For HCI, the address is a 1-tuple (deviceno,) where devicenois an integer device number. For SCO, the address is a string host.\n\nThe constant BDADDR_ANY represents any address and is a string '00:00:00:00:00:00'.\n\nThe constant BDADDR_LOCAL is a string '00:00:00:ff:ff:ff'.\n\nAF_TIPC For TIPC sockets, the address is a tuple (addr_type, v1, v2, v3 [, scope]) where all fields are unsigned integers. addr_typeis one of the following values, which also determines the values of v1, v2, and v3:\n\nF h Lib f L Bdff",
      "content_length": 2465,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 498,
      "content": "socket\n\n473\n\nAddress Type TIPC_ADDR_NAMESEQ\n\nTIPC_ADDR_NAME\n\nTIPC_ADDR_ID\n\nDescription v1is the server type, v2is the port identifier, and v3is 0. v1is the server type, v2is the lower port number, and v3is the upper port number. v1is the node, v2is the reference, and v3is 0.\n\nThe optional scopefield is one of TIPC_ZONE_SCOPE, TIPC_CLUSTER_SCOPE, or TIPC_NODE_SCOPE.\n\nFunctions The socket module defines the following functions:\n\ncreate_connection(address [, timeout])\n\nEstablishes a SOCK_STREAM connection to addressand returns an already connected socket object. addressis tuple of the form (host, port), and timeoutspecifies an optional timeout.This function works by first calling getaddrinfo() and then trying to connect to each of the tuples that gets returned.\n\nfromfd(fd, family, socktype [, proto])\n\nCreates a socket object from an integer file descriptor, fd.The address family, socket type, and protocol number are the same as for socket().The file descriptor must refer to a previously created socket. It returns an instance of SocketType.\n\ngetaddrinfo(host, port [,family [, socktype [, proto [, flags]]]])\n\nGiven hostand portinformation about a host, this function returns a list of tuples containing information needed to open up a socket connection. hostis a string con- taining a host name or numerical IP address. portis a number or a string representing a service name (for example, \"http\", \"ftp\", \"smtp\"). Each returned tuple consists of five elements (family, socktype, proto, canonname, sockaddr).The family, socktype, and protoitems have the same values as would be passed to the socket() function. canonnameis a string representing the canonical name of the host. sockaddr is a tuple containing a socket address as described in the earlier section on Internet addresses. Here’s an example:\n\n>>> getaddrinfo(\"www.python.org\",80) [(2,2,17,'',('194.109.137.226',80)), (2,1,6,'',('194.109.137.226'),80))]\n\nIn this example, getaddrinfo() has returned information about two possible socket connections.The first one (proto=17) is a UDP connection, and the second one (proto=6) is a TCP connection.The additional parameters to getaddrinfo() can be used to narrow the selection. For instance, this example returns information about establishing an IPv4 TCP connection:\n\n>>> getaddrinfo(\"www.python.org\",80,AF_INET,SOCK_STREAM) [(2,1,6,'',('194.109.137.226',80))]\n\nF h Lib f L Bdff",
      "content_length": 2397,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 499,
      "content": "474\n\nChapter 21 Network Programming and Sockets\n\nThe special constant AF_UNSPEC can be used for the address family to look for any kind of connection. For example, this code gets information about any TCP-like connection and may return information for either IPv4 or IPv6:\n\n>>> getaddrinfo(\"www.python.org\",\"http\", AF_UNSPEC, SOCK_STREAM) [(2,1,6,'',('194.109.137.226',80))]\n\ngetaddrinfo() is intended for a very generic purpose and is applicable to all support- ed network protocols (IPv4, IPv6, and so on). Use it if you are concerned about com- patibility and supporting future protocols, especially if you intend to support IPv6.\n\ngetdefaulttimeout()\n\nReturns the default socket timeout in seconds.A value of None indicates that no time- out has been set.\n\ngetfqdn([name])\n\nReturns the fully qualified domain name of name. If nameis omitted, the local machine is assumed. For example, getfqdn(\"foo\") might return \"foo.quasievil.org\".\n\ngethostbyname(hostname)\n\nTranslates a host name such as 'www.python.org' to an IPv4 address.The IP address is returned as a string, such as '132.151.1.90'. It does not support IPv6.\n\ngethostbyname_ex(hostname)\n\nTranslates a host name to an IPv4 address but returns a tuple (hostname, aliaslist, ipaddrlist) in which hostnameis the primary host name, aliaslistis a list of alternative host names for the same address, and ipaddrlistis a list of IPv4 address- es for the same interface on the same host. For example, gethostbyname_ex('www.python.org') returns something like ('fang.python.org', ['www.python.org'], ['194.109.137.226']).This func- tion does not support IPv6.\n\ngethostname()\n\nReturns the host name of the local machine.\n\ngethostbyaddr(ip_address)\n\nReturns the same information as gethostbyname_ex(), given an IP address such as '132.151.1.90'. If ip_addressis an IPv6 address such as 'FEDC:BA98:7654:3210:FEDC:BA98:7654:3210', information regarding IPv6 will be returned.\n\ngetnameinfo(address, flags)\n\nGiven a socket address, address, this function translates the address into a 2-tuple (host, port), depending on the value of flags.The addressparameter is a tuple specifying an address—for example, ('www.python.org',80). flagsis the bitwise OR of the following constants:\n\nF h Lib f L Bdff",
      "content_length": 2243,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 500,
      "content": "socket\n\n475\n\nConstant NI_NOFQDN\n\nNI_NUMERICHOST\n\nNI_NAMEREQD\n\nNI_NUMERICSERV\n\nNI_DGRAM\n\nDescription Don’t use fully qualified name for local hosts. Returns the address in numeric form. Requires a host name. Returns an error if addresshas no DNS entry. The returned portis returned as a string containing a port num- ber. Specifies that the service being looked up is a datagram service (UDP) instead of TCP (the default).\n\nThe main purpose of this function is to get additional information about an address. Here’s an example:\n\n>>> getnameinfo(('194.109.137.226',80),0) ('fang.python.org', 'http') >>> getnameinfo(('194.109.137.226',80),NI_NUMERICSERV) ('fang.python.org','80')\n\ngetprotobyname(protocolname)\n\nTranslates an Internet protocol name (such as 'icmp') to a protocol number (such as the value of IPPROTO_ICMP) that can be passed to the third argument of the socket() function. Raises socket.error if the protocol name isn’t recognized. Normally, this is only used with raw sockets.\n\ngetservbyname(servicename [, protocolname])\n\nTranslates an Internet service name and protocol name to a port number for that serv- ice. For example, getservbyname('ftp', 'tcp') returns 21.The protocol name, if supplied, should be 'tcp' or 'udp’. Raises socket.error if servicenamedoesn’t match any known service.\n\ngetservbyport(port [, protocolname])\n\nThis is the opposite of getservbyname(). Given a numeric port number, port, this function returns a string giving the service name, if any. For example, getservbyport(21, 'tcp') returns 'ftp'.The protocol name, if supplied, should be 'tcp' or 'udp'. Raises socket.error if no service name is available for port.\n\nhas_ipv6\n\nBoolean constant that is True if IPv6 support is available.\n\nhtonl(x)\n\nConverts 32-bit integers from host to network byte order (big-endian).\n\nhtons(x)\n\nConverts 16-bit integers from host to network byte order (big-endian).\n\ninet_aton(ip_string)\n\nConverts an IPv4 address provided as a string (for example, '135.128.11.209') to a 32-bit packed binary format for use as the raw-encoding of the address.The returned\n\nF h Lib f L Bdff",
      "content_length": 2099,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 501,
      "content": "476\n\nChapter 21 Network Programming and Sockets\n\nvalue is a four-character string containing the binary encoding.This may be useful if passing the address to C or if the address must be packed into a data structure passed to other programs. Does not support IPv6.\n\ninet_ntoa(packedip)\n\nConverts a binary-packaged IPv4 address into a string that uses the standard dotted rep- resentation (for example, '135.128.11.209'). packedipis a four-character string con- taining the raw 32-bit encoding of an IP address.The function may be useful if an address has been received from C or is being unpacked from a data structure. It does not support IPv6.\n\ninet_ntop(address_family, packed_ip)\n\nConverts a packed binary string packed_iprepresenting an IP network address into a string such as '123.45.67.89'. address_familyis the address family and is usually AF_INET or AF_INET6.This can be used to obtain a network address string from a buffer of raw bytes (for instance, from the contents of a low-level network packet).\n\ninet_pton(address_family, ip_string)\n\nConverts an IP address such as '123.45.67.89' into a packed byte string. address_familyis the address family and is usually AF_INET or AF_INET6.This can be used if you’re trying to encode a network address into a raw binary data packet.\n\nntohl(x)\n\nConverts 32-bit integers from network (big-endian) to host byte order.\n\nntohs(x)\n\nConverts 16-bit integers from network (big-endian) to host byte order.\n\nsetdefaulttimeout(timeout)\n\nSets the default timeout for newly created socket objects. timeoutis a floating-point number specified in seconds.A value of None may be supplied to indicate no timeout (this is the default).\n\nsocket(family, type [, proto])\n\nCreates a new socket using the given address family, socket type, and protocol number. familyis the address family and typeis the socket type as discussed in the first part of this section.To open a TCP connection, use socket(AF_INET, SOCK_STREAM).To open a UDP connection, use socket(AF_INET, SOCK_DGRAM).The function returns an instance of SocketType (described shortly).\n\nThe protocol number is usually omitted (and defaults to 0).This is typically only used with raw sockets (SOCK_RAW) and is set to a constant that depends on the address family being used.The following list shows all of the protocol numbers that Python may define for AF_INET and AF_INET6, depending on their availability on the host system:\n\nConstant IPPROTO_AH\n\nIPPROTO_BIP\n\nIPPROTO_DSTOPTS\n\nIPPROTO_EGP\n\nDescription IPv6 authentication header Banyan VINES IPv6 destination options Exterior gateway protocol\n\nF h Lib f L Bdff",
      "content_length": 2607,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 502,
      "content": "socket\n\n477\n\nConstant IPPROTO_EON\n\nIPPROTO_ESP\n\nIPPROTO_FRAGMENT\n\nIPPROTO_GGP\n\nIPPROTO_GRE\n\nIPPROTO_HELLO\n\nIPPROTO_HOPOPTS\n\nIPPROTO_ICMP\n\nIPPROTO_ICMPV6\n\nIPPROTO_IDP\n\nIPPROTO_IGMP\n\nIPPROTO_IP\n\nIPPROTO_IPCOMP\n\nIPPROTO_IPIP\n\nIPPROTO_IPV4\n\nIPPROTO_IPV6\n\nIPPROTO_MOBILE\n\nIPPROTO_ND\n\nIPPROTO_NONE\n\nIPPROTO_PIM\n\nIPPROTO_PUP\n\nIPPROTO_RAW\n\nIPPROTO_ROUTING\n\nIPPROTO_RSVP\n\nIPPROTO_TCP\n\nIPPROTO_TP\n\nDescription ISO CNLP (Connectionless Network Protocol) IPv6 encapsulating security payload IPv6 fragmentation header Gateway to Gateway Protocol (RFC823) Generic Routing Encapsulation (RFC1701) Fuzzball HELLO protocol IPv6 hop-by-hop options IPv4 ICMP IPv6 ICMP XNS IDP Group management protocol IPv4 IP Payload compression protocol IP inside IP IPv4 header IPv6 header IP Mobility Netdisk protocol IPv6 no next header Protocol Independent Multicast Xerox PARC Universal Packet (PUP) Raw IP packet IPv6 routing header Resource reservation TCP OSI Transport Protocol (TP-4) UDP Virtual Router Redundancy Protocol eXpress Transfer Protocol\n\nIPPROTO_UDP\n\nIPPROTO_VRRP\n\nIPPROTO_XTP\n\nThe following protocol numbers are used with AF_BLUETOOTH:\n\nConstant BTPROTO_L2CAP\n\nBTPROTO_HCI\n\nBTPROTO_RFCOMM\n\nBTPROTO_SCO\n\nDescription Logical Link Control and Adaption Protocol Host/Controller Interface Cable replacement protocol Synchronous Connection Oriented Link\n\nsocketpair([family [, type [, proto ]]])\n\nCreates a pair of connected socket objects using the given family, type, and proto options, which have the same meaning as for the socket() function.This function only applies to UNIX domain sockets (family=AF_UNIX). typemay be either SOCK_DGRAM or SOCK_STREAM. If typeis SOCK_STREAM, an object known as a stream pipe is created. protois usually 0 (the default).The primary use of this function would\n\nF h Lib f L Bdff",
      "content_length": 1799,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 503,
      "content": "478\n\nChapter 21 Network Programming and Sockets\n\nbe to set up interprocess communication between processes created by os.fork(). For example, the parent process would call socketpair() to create a pair of sockets and call os.fork().The parent and child processes would then communicate with each other using these sockets.\n\nSockets are represented by an instance of type SocketType.The following methods\n\nare available on a socket, s:\n\ns.accept()\n\nAccepts a connection and returns a pair (conn, address), where connis a new socket object that can be used to send and receive data on the connection and addressis the address of the socket on the other end of the connection.\n\ns.bind(address)\n\nBinds the socket to an address.The format of addressdepends on the address family. In most cases, it’s a tuple of the form (hostname, port). For IP addresses, the empty string represents INADDR_ANY and the string '<broadcast>' represents INADDR_BROADCAST.The INADDR_ANY host name (the empty string) is used to indicate that the server allows connections on any Internet interface on the system.This is often used when a server is multihomed.The INADDR_BROADCAST host name ('<broadcast>') is used when a socket is being used to send a broadcast message.\n\ns.close()\n\nCloses the socket. Sockets are also closed when they’re garbage-collected.\n\ns.connect(address)\n\nConnects to a remote socket at address.The format of addressdepends on the address family, but it’s normally a tuple (hostname, port). It raises socket.error if an error occurs. If you’re connecting to a server on the same computer, you can use the name 'localhost' as hostname.\n\ns.connect_ex(address)\n\nLike connect(address), but returns 0 on success or the value of errno on failure.\n\ns.fileno()\n\nReturns the socket’s file descriptor.\n\ns.getpeername()\n\nReturns the remote address to which the socket is connected. Usually the return value is a tuple (ipaddr, port), but this depends on the address family being used.This is not supported on all systems.\n\ns.getsockname()\n\nReturns the socket’s own address. Usually this is a tuple (ipaddr, port).\n\ns.getsockopt(level, optname [, buflen])\n\nReturns the value of a socket option. leveldefines the level of the option and is SOL_SOCKET for socket-level options or a protocol number such as IPPROTO_IP for protocol-related options. optnameselects a specific option. If buflenis omitted, an integer option is assumed and its integer value is returned. If buflenis given, it speci- fies the maximum length of the buffer used to receive the option.This buffer is\n\nF h Lib f L Bdff",
      "content_length": 2575,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 504,
      "content": "socket\n\n479\n\nreturned as a byte string, where it’s up to the caller to decode its contents using the struct module or other means.\n\nThe following tables list the socket options defined by Python. Most of these options\n\nare considered part of the Advanced Sockets API and control low-level details of the network.You will need to consult other documentation to find more detailed descrip- tions.When type names are listed in the value column, that name is same as the standard C data structure associated with the value and used in the standard socket programming interface. Not all options are available on all machines.\n\nThe following are commonly used option names for level SOL_SOCKET:\n\nOption Name SO_ACCEPTCONN\n\nSO_BROADCAST\n\nSO_DEBUG\n\nSO_DONTROUTE\n\nSO_ERROR\n\nSO_EXCLUSIVEADDRUSE\n\nSO_KEEPALIVE\n\nSO_LINGER\n\nSO_OOBINLINE\n\nSO_RCVBUF\n\nValue 0, 1\n\n0, 1\n\n0, 1\n\n0, 1\n\nint\n\n0,1\n\n0, 1\n\nlinger\n\n0, 1\n\nint\n\nDescription Determines whether or not the socket is accept- ing connections. Allows sending of broadcast datagrams. Determines whether or not debugging informa- tion is being recorded. Bypasses routing table lookups. Gets error status. Prevents other sockets from being forcibly bound to the same address and port. This disables the SO_REUSEADDR option. Periodically probes the other end of the connec- tion and terminates if it’s half-open. Lingers on close() if the send buffer contains data. linger is a packed binary string contain- ing two 32-bit integers (onoff, seconds). Places out-of-band data into the input queue. Size of receive buffer (in bytes). Number of bytes read before select() returns the socket as readable.\n\nSO_RCVLOWAT\n\nint\n\nSO_RCVTIMEO\n\ntimeval Timeout on receive calls in seconds. timeval is\n\nSO_REUSEADDR\n\nSO_REUSEPORT\n\nSO_SNDBUF\n\nSO_SNDLOWAT\n\n0, 1\n\n0, 1\n\nint\n\nint\n\na packed binary string containing two 32-bit unsigned integers (seconds, microseconds). Allows local address reuse. Allows multiple processes to bind to the same address as long as this socket option is set in all processes. Size of send buffer (in bytes). Number of bytes available in send buffer before select() returns the socket as writable.\n\nSO_SNDTIMEO\n\ntimeval Timeout on send calls in seconds. See\n\nSO_TYPE\n\nSO_USELOOPBACK\n\nint\n\n0, 1\n\nSO_RCVTIMEO for a description of timeval. Gets socket type. Routing socket gets copy of what it sends.\n\nF h Lib f L Bdff",
      "content_length": 2356,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 505,
      "content": "480\n\nChapter 21 Network Programming and Sockets\n\nThe following options are available for level IPPROTO_IP:\n\nOption Name IP_ADD_MEMBERSHIP\n\nIP_DROP_MEMBERSHIP\n\nIP_HDRINCL\n\nIP_MAX_MEMBERSHIPS IP_MULTICAST_IF\n\nIP_MULTICAST_LOOP\n\nIP_MULTICAST_TTL\n\nIP_OPTIONS\n\nIP_RECVDSTADDR\n\nIP_RECVOPTS\n\nIP_RECVRETOPTS\n\nIP_RETOPTS\n\nValue ip_mreg\n\nip_mreg\n\nint\n\nint in_addr\n\n0,1\n\nuint8\n\nipopts\n\n0,1\n\n0,1\n\n0,1\n\n0,1\n\nDescription Join a multicast group (set only). ip_mreg is a packed binary string containing two 32- bit IP addresses (multiaddr, localaddr), where multiaddris the multicast address and localaddris the IP of the local interface being used. Leave a multicast group (set only). ip_mreg is described above. IP header included with data. Maximum number of multicast groups. Outgoing interface. in_addr is a packed binary string containing a 32-bit IP address. Loopback. Time to live. uint8 is a packed binary string containing a 1-byte unsigned char. IP header options. ipoptsis a packed binary string of no more than 44 bytes. The contents of this string are described in RFC 791. Receive IP destination address with data- gram. Receive all IP options with datagram. Receive IP options with response. Same as IP_RECVOPTS, leaves the options unprocessed with no timestamp or route record options filled in. Type of service. Time to live.\n\nIP_TOS\n\nint\n\nIP_TTL\n\nint\n\nThe following options are available for level IPPROTO_IPV6:\n\nOption Name IPV6_CHECKSUM\n\nIPV6_DONTFRAG\n\nIPV6_DSTOPTS\n\nIPV6_HOPLIMIT\n\nIPV6_HOPOPTS\n\nValue 0,1\n\n0,1\n\nip6_dest\n\nint\n\nip6_hbh\n\nDescription Have system compute checksum. Don’t fragment packets if they exceed the MTU size. Destination options. ip6_destis a packed binary string of the form (next, len, options) where nextis an 8-bit integer giving the option type of the next header; lenis an 8-bit integer specifying the length of the header in units of 8 bytes, not includ- ing the first 8 bytes; and optionsis the encoded options. Hop limit. Hop-by-hop options. ip6_hbhhas the same encoding as ip6_dest.\n\nF h Lib f L Bdff",
      "content_length": 2036,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 506,
      "content": "socket\n\n481\n\nOption Name IPV6_JOIN_GROUP\n\nValue ip6_mreq\n\nIPV6_LEAVE_GROUP\n\nip6_mreq\n\nIPV6_MULTICAST_HOPS int\n\nIPV6_MULTICAST_IF\n\nint\n\nIPV6_MULTICAST_LOOP 0,1\n\nDescription Join multicast group. ip6_mreqis a packed binary string containing (multiaddr, index) where multiaddr is a 128-bit IPv6 multicast address and indexis a 32-bit unsigned integer inter- face index for the local interface. Leave multicast group. Hop-limit for multicast packets. Interface index for outgoing multicast pack- ets. Deliver outgoing multicast packets back to local application.\n\nIPV6_NEXTHOP\n\nsockaddr_in6 Set the next hop address for outgoing pack-\n\nets. sockaddr_in6is a packed binary string containing the C sockaddr_in6 structure as typically defined in <netinet/in.h>.\n\nIPV6_PKTINFO\n\nip6_pktinfo Packet information structure.\n\nIPV6_RECVDSTOPTS\n\nIPV6_RECVHOPLIMIT\n\nIPV6_RECVHOPOPTS\n\nIPV6_RECVPKTINFO\n\nIPV6_RECVRTHDR\n\nIPV6_RECVTCLASS\n\nIPV6_RTHDR\n\nIPV6_RTHDRDSTOPTS\n\nIPV6_RECVPATHMTU\n\nIPV6_TCLASS\n\nIPV6_UNICAST_HOPS\n\nIPV6_USE_MIN_MTU\n\n0,1\n\n0,1\n\n0,1\n\n0,1\n\n0,1\n\n0,1\n\nip6_rthdr\n\nip6_dest\n\n0,1\n\nint int\n\n1,0,1\n\nip6_pktinfois a packed binary string containing (addr, index) where addris a 128-bit IPv6 address and indexis a 32- bit unsigned integer with the interface index. Receive destination options. Receive the hop limit. Receive hop-by-hop options. Receive packet information. Receive routing header. Receive the traffic class. Routing header. ip6_rthdris a packed binary string containing (next, len, type, segleft, data) where next, len, type, and segleftare all 8-bit unsigned integers and datais routing data. See RFC 2460. Destination options header before the rout- ing options header. Enable the receipt of IPV6_PATHMTU ancil- lary data items. Traffic class. Hop limit for unicast packets. Path MTU discovery. 1 disables it for all desinations. -1 disables it only for multicast destinations. Only connect to other IPV6 nodes.\n\nIPV6_V6ONLY\n\n0,1\n\nF h Lib f L Bdff",
      "content_length": 1953,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 507,
      "content": "482\n\nChapter 21 Network Programming and Sockets\n\nThe following options are available for level SOL_TCP:\n\nOption Name TCP_CORK\n\nTCP_DEFER_ACCEPT\n\nTCP_INFO\n\nTCP_KEEPCNT\n\nTCP_KEEPIDLE\n\nTCP_KEEPINTVL\n\nTCP_LINGER2\n\nTCP_MAXSEG\n\nTCP_NODELAY\n\nTCP_QUICKACK\n\nTCP_SYNCNT\n\nValue 0,1\n\n0,1\n\ntcp_info\n\nint\n\nint\n\nint\n\nint\n\nint\n\n0,1\n\n0,1\n\nint\n\nDescription Don’t send out partial frames if set. Awake listener only when data arrives on socket. Returns a structure containing information about the socket. tcp_infois implemen- tation specific. Maximum number of keepalive probes TCP should send before dropping a connection. Time in seconds the connection should be idle before TCP starts sending keepalive probes if the TCP_KEEPALIVE option has been set. Time in seconds between keepalive probes. Lifetime of orphaned FIN_WAIT2 state sockets. Maximum segment size for outgoing TCP packets. If set, disables the Nagle algorithm. If set, ACKs are sent immediately. Disables the TCP delayed ACK algorithm. Number of SYN retransmits before aborting a connection request. Sets an upper bound on the advertised TCP window size.\n\nTCP_WINDOW_CLAMP\n\nint\n\ns.gettimeout()\n\nReturns the current timeout value if any. Returns a floating-point number in seconds or None if no timeout is set.\n\ns.ioctl(control, option)\n\nProvides limited access to the WSAIoctl interface on Windows.The only supported value for controlis SIO_RCVALL which is used to capture all received IP packets on the network.This requires Administrator access.The following values can be used for options:\n\nOption RCVALL_OFF\n\nRCVALL_ON\n\nRCVALL_IPLEVEL\n\nDescription Prevent the socket from receiving all IPv4 or IPv6 packets. Enable promiscuous mode, allowing the socket to receive all IPv4 or IPv6 packets on the network. The type of packet received depends on the socket address family. This does not capture packets associated with other network protocols such as ARP. Receive all IP packets received on the network, but do not enable promiscuous mode. This will capture all IP packets directed at the host for any configured IP address.\n\nF h Lib f L Bdff",
      "content_length": 2093,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 508,
      "content": "socket\n\n483\n\ns.listen(backlog)\n\nStarts listening for incoming connections. backlogspecifies the maximum number of pending connections the operating system should queue before connections are refused. The value should be at least 1, with 5 being sufficient for most applications.\n\ns.makefile([mode [, bufsize]])\n\nCreates a file object associated with the socket. modeand bufsizehave the same meaning as with the built-in open() function.The file object uses a duplicated version of the socket file descriptor, created using os.dup(), so the file object and socket object can be closed or garbage-collected independently.The socket sshould not have a time- out and should not be configured in nonblocking mode.\n\ns.recv(bufsize [, flags])\n\nReceives data from the socket.The data is returned as a string.The maximum amount of data to be received is specified by bufsize. flagsprovides additional information about the message and is usually omitted (in which case it defaults to zero). If used, it’s usually set to one of the following constants (system-dependent):\n\nConstant MSG_DONTROUTE\n\nMSG_DONTWAIT\n\nMSG_EOR\n\nMSG_PEEK\n\nMSG_OOB\n\nMSG_WAITALL\n\nDescription Bypasses routing table lookup (sends only). Non-blocking operation. Indicates that the message is last in a record. Usually only used when sending data on SOCK_SEQPACKET sockets. Looks at data but doesn’t discard (receives only). Receives/sends out-of-band data. Doesn’t return until the requested number of bytes have been read (receives only).\n\ns.recv_into(buffer [, nbytes [, flags]])\n\nThe same as recv() except that data is written into a an object buffersupporting the buffer interface. nbytesis the maximum number of bytes to receive. If omitted, the maximum size is taken from the buffer size. flagshas the same meaning as for recv().\n\ns.recvfrom(bufsize [, flags])\n\nLike the recv() method except that the return value is a pair (data, address) in which datais a string containing the data received and addressis the address of the socket sending the data.The optional flagsargument has the same meaning as for recv().This function is primarily used in conjunction with the UDP protocol.\n\ns.recvfrom_info(buffer [, nbytes [, flags]])\n\nThe same as recvfrom() but the received data is stored in the buffer object buffer. nbytesspecifies the maximum number of bytes of receive. If omitted, the maximum size is taken from the size of buffer. flagshas the same meaning as for recv().\n\nF h Lib f L Bdff",
      "content_length": 2457,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 509,
      "content": "484\n\nChapter 21 Network Programming and Sockets\n\ns.send(string [, flags])\n\nSends data in stringto a connected socket.The optional flagsargument has the same meaning as for recv(), described earlier. Returns the number of bytes sent, which may be fewer than the number of bytes in string. Raises an exception if an error occurs.\n\ns.sendall(string [, flags])\n\nSends data in stringto a connected socket, except that an attempt is made to send all of the data before returning. Returns None on success; raises an exception on failure. flagshas the same meaning as for send().\n\ns.sendto(string [, flags], address)\n\nSends data to the socket. flagshas the same meaning as for recv(). addressis a tuple of the form (host, port), which specifies the remote address.The socket should not already be connected. Returns the number of bytes sent.This function is primarily used in conjunction with the UDP protocol.\n\ns.setblocking(flag)\n\nIf flagis zero, the socket is set to nonblocking mode. Otherwise, the socket is set to blocking mode (the default). In nonblocking mode, if a recv() call doesn’t find any data or if a send() call cannot immediately send the data, the socket.error excep- tion is raised. In blocking mode, these calls block until they can proceed.\n\ns.setsockopt(level, optname, value)\n\nSets the value of the given socket option. leveland optnamehave the same meaning as for getsockopt().The value can be an integer or a string representing the contents of a buffer. In the latter case, it’s up to the caller to ensure that the string contains the proper data. See getsockopt() for socket option names, values, and descriptions.\n\ns.settimeout(timeout)\n\nSets a timeout on socket operations. timeoutis a floating-point number in seconds.A value of None means no timeout. If a timeout occurs, a socket.timeout exception is raised.As a general rule, timeouts should be set as soon as a socket is created because they can be applied to operations involved in establishing a connection (such as connect()).\n\ns.shutdown(how)\n\nShuts down one or both halves of the connection. If howis 0, further receives are dis- allowed. If howis 1, further sends are disallowed. If howis 2, further sends and receives are disallowed.\n\nIn addition to these methods, a socket instance salso has the following read-only\n\nproperties which correspond to the arguments passed to the socket() function.\n\nProperty s.family\n\ns.proto\n\ns.type\n\nDescription The socket address family (e.g., AF_INET) The socket protocol The socket type (e.g., SOCK_STREAM)\n\nF h Lib f L Bdff",
      "content_length": 2544,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 510,
      "content": "socket\n\n485\n\nExceptions The following exceptions are defined by the socket module.\n\nerror\n\nThis exception is raised for socket- or address-related errors. It returns a pair (errno, mesg) with the error returned by the underlying system call. Inherits from IOError.\n\nherror\n\nError raised for address-related errors. Returns a tuple (herrno, hmesg) containing an error number and error message. Inherits from error.\n\ngaierror\n\nError raised for address-related errors in the getaddrinfo() and getnameinfo() func- tions.The error value is a tuple (errno, mesg), where errnois an error number and mesgis a string containing a message. errnois set to one of the following constants defined in the socket module:\n\nConstant EAI_ADDRFAMILY\n\nEAI_AGAIN\n\nEAI_BADFLAGS\n\nEAI_BADHINTS\n\nEAI_FAIL\n\nEAI_FAMILY\n\nEAI_MEMORY\n\nEAI_NODATA\n\nEAI_NONAME\n\nEAI_PROTOCOL\n\nEAI_SERVICE\n\nEAI_SOCKTYPE\n\nDescription Address family not supported. Temporary failure in name resolution. Invalid flags. Bad hints. Nonrecoverable failure in name resolution. Address family not supported by host. Memory allocation failure. No address associated with node name. No node name or service name provided. Protocol not supported. Service name not supported for socket type. Socket type not supported. System error.\n\nEAI_SYSTEM\n\ntimeout\n\nException raised when a socket operation times out.This only occurs if a timeout has been set using the setdefaulttimeout() function or settimeout() method of a socket object. Exception value is a string, 'timeout'. Inherits from error.\n\nExample A simple example of a TCP connection is shown in the introduction to this chapter. The following example illustrates a simple UDP echo server:\n\n# UDP message server # Receive small packets from anywhere and print them out import socket s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) s.bind((\"\",10000)) while True:\n\ndata, address = s.recvfrom(256) print(\"Received a connection from %s\" % str(address)) s.sendto(b\"echo:\" + data, address)\n\nF h Lib f L Bdff",
      "content_length": 1997,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 511,
      "content": "486\n\nChapter 21 Network Programming and Sockets\n\nHere a client that sends messages to the previous server:\n\n# UDP message client import socket s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) s.sendto(b\"Hello World\", (\"\", 10000)) resp, addr = s.recvfrom(256) print(resp) s.sendto(b\"Spam\", (\"\", 10000)) resp, addr = s.recvfrom(256) print(resp) s.close()\n\nNotes\n\nn Not all constants and socket options are available on all platforms. If portability is\n\nyour goal, you should only rely upon options that are documented in major sources such as the W. Richard Stevens UNIX Network Programming book cited at the beginning of this section.\n\nn Notable omissions from the socket module are recvmsg() and sendmsg()\n\nsystem calls, commonly used to work with ancillary data and advanced network options related to packet headers, routing, and other details. For this functionality, you must install a third-party module such as PyXAPI (http://pypi.python.org/pypi/PyXAPI).\n\nn There is a subtle difference between nonblocking socket operations and opera-\n\ntions involving a timeout.When a socket function is used in nonblocking mode, it will return immediately with an error if the operation would have blocked. When a timeout is set, a function returns an error only if the operation doesn’t complete within a specified timeout.\n\nssl The ssl module is used to wrap socket objects with the Secure Sockets Layer (SSL), which provides data encryption and peer authentication. Python uses the OpenSSL library (http://www.openssl.org) to implement this module.A full discussion concern- ing the theory and operation of SSL is beyond the scope of what can be covered here. So, just the essential elements of using this module are covered here with the assump- tion that you know what you’re doing when it comes to SSL configuration, keys, cer- tificates, and other related matters:\n\nwrap_socket(sock [, **opts])\n\nWraps an existing socket sock(created by the socket module) with SSL support and returns an instance of SSLSocket.This function should be used before subsequent connect() or accept() operations are made. optsrepresents a number of keyword arguments that are used to specify additional configuration data.\n\nF h Lib f L Bdff",
      "content_length": 2222,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 512,
      "content": "ssl\n\n487\n\nKeyword Argument server_side\n\nkeyfile\n\ncertfile\n\ncert_reqs\n\nca_certs\n\nssl_version\n\nDescription A Boolean flag that indicates whether or not the socket is operating as a server (True) or a client (False). By default, this is False. The key file used to identify the local side of the con- nection. This should be a PEM-format file and usually only included if the file specified with the certfile doesn’t include the key. The certificate file used to identify the local side of the connection. This should be a PEM-format file. Specifies whether a certificate is required from the other side of the connection and whether or not it will be validated. A value of CERT_NONE means that certifi- cates are ignored, CERT_OPTIONAL means that certifi- cates are not required but will be validated if given, and CERT_REQUIRED means that certificates are required and will be validated. If certificates are going to be vali- dated, the ca_certs parameter must also be given. Filename of the file holding certificate authority certifi- cates used for validation. SSL protocol version to use. Possible values are PROTOCOL_TLSv1, PROTOCOL_SSLv2, PROTOCOL_SSLv23, or PROTOCOL_SSLv3. The default protocol is PROTOCOL_SSLv3.\n\ndo_handshake_on_connect Boolean flag that specifies whether or not the SSL\n\nsuppress_ragged_eofs\n\nhandshake is performed automatically on connect. By default, this is True. Specifies how read() handles an unexpected EOF on the connection. If True (the default), a normal EOF is signaled. If False, an exception is raised.\n\nAn instance sof SSLSocket inherits from socket.socket and additionally supports the following operations:\n\ns.cipher()\n\nReturns a tuple (name, version, secretbits) where nameis the cipher name being used, versionis the SSL protocol, and secretbitsis the number of secret bits being used.\n\ns.do_handshake()\n\nPerforms the SSL handshake. Normally this is done automatically unless the do_handshake_on_connect option was set to False in the wrap_socket() function. If the underlying socket sis nonblocking, an SSLError exception will be raised if the operation couldn’t be completed.The e.args[0] attribute of an SSLError exception e will have the value SSL_ERROR_WANT_READ or SSL_ERROR_WANT_WRITE depending on the operation that needs to be performed.To continue the handshake process once reading or writing can continue, simply call s.do_handshake() again.\n\nF h Lib f L Bdff",
      "content_length": 2415,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 513,
      "content": "488\n\nChapter 21 Network Programming and Sockets\n\ns.getpeercert([binary_form])\n\nReturns the certificate from the other end of the connection, if any. If there is no cer- tificate None is returned. If there was a certificate but it wasn’t validated, an empty dic- tionary is returned. If a validated certificate is received, a dictionary with the keys 'subject' and 'notAfter' is returned. If binary_formis set True, the certificate is returned as a DER-encoded byte sequence.\n\ns.read([nbytes])\n\nReads up to nbytesof data and returns it. If nbytesis omitted, up to 1,024 bytes are returned.\n\ns.write(data)\n\nWrites the byte string data. Returns the number of bytes written.\n\ns.unwrap()\n\nShuts down the SSL connection and returns the underlying socket object on which further unencrypted communication can be carried out.\n\nThe following utility functions are also defined by the module:\n\ncert_time_to_seconds(timestring)\n\nConverts a string timestringfrom the format used in certificates to a floating-point number as compatible with the time.time() function.\n\nDER_cert_to_PEM_cert(derbytes)\n\nGiven a byte string derbytescontaining a DER-encoded certificate, returns a PEM- encoded string version of the certificate.\n\nPEM_cert_to_DER_cert(pemstring)\n\nGiven a string pemstringcontaining a PEM-encoded string version of a certificate, returns a DER-encoded byte string version of the certificate.\n\nget_server_certificate(addr [, ssl_version [, ca_certs]])\n\nRetrieves the certificate of an SSL server and returns it as a PEM-encoded string. addr is an address of the form (hostname, port). ssl_versionis the SSL version num- ber, and ca_certsis the name of a file containing certificate authority certificates as described for the wrap_socket() function.\n\nRAND_status()\n\nReturns True or False if the SSL layer thinks that the pseudorandom number genera- tor has been seeded with enough randomness.\n\nRAND_egd(path)\n\nReads 256 bytes of randomness from an entropy-gathering daemon and adds it to the pseudorandom number generator. pathis the name of a UNIX-domain socket for the daemon.\n\nRAND_add(bytes, entropy)\n\nAdds the bytes in byte string bytesinto the pseudorandom number generator. entropyis a nonnegative floating-point number giving the lower bound on the entropy.\n\nF h Lib f L Bdff",
      "content_length": 2280,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 514,
      "content": "SocketServer\n\n489\n\nExamples The following example shows how to use this module to open an SSL-client connection:\n\nimport socket, ssl\n\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM) ssl_s = ssl.wrap_socket(s) ssl_s.connect(('gmail.google.com',443)) print(ssl_s.cipher()) # Send a request ssl_s.write(b\"GET / HTTP/1.0\\r\\n\\r\\n\") # Get the response while True:\n\ndata = ssl_s.read() if not data: break print(data)\n\nssl_s.close()\n\nHere is an example of an SSL-secured time server:\n\nimport socket, ssl, time\n\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR,1) s.bind(('',12345)) s.listen(5)\n\nwhile True:\n\nclient, addr = s.accept() # Get a connection print \"Connection from\", addr client_ssl = ssl.wrap_socket(client,\n\nserver_side=True, certfile=\"timecert.pem\")\n\nclient_ssl.sendall(b\"HTTP/1.0 200 OK\\r\\n\") client_ssl.sendall(b\"Connection: Close\\r\\n\") client_ssl.sendall(b\"Content-type: text/plain\\r\\n\\r\\n\") resp = time.ctime() + \"\\r\\n\" client_ssl.sendall(resp.encode('latin-1')) client_ssl.close() client.close()\n\nIn order to run this server, you will need to have a signed server certificate in the file timecert.pem. For the purposes of testing, you can create one using this UNIX command:\n\n% openssl req –new –x509 –days 30 –nodes –out timecert.pem –keyout timecert.pem\n\nTo test this server, try connecting with a browser using a URL such as 'https://localhost:1234'. If it works, the browser will issue a warning message about you using a self-signed certificate. If you agree, you should see the output of the server.\n\nSocketServer This module is called socketserver in Python 3.The SocketServer module pro- vides classes that simplify the implementation of TCP, UDP, and UNIX domain socket servers.\n\nF h Lib f L Bdff",
      "content_length": 1779,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 515,
      "content": "490\n\nChapter 21 Network Programming and Sockets\n\nHandlers To use the module, you define a handler class that inherits from the base class BaseRequestHandler.An instance hof BaseRequestHandler implements one or more of the following methods:\n\nh.finish()\n\nCalled to perform cleanup actions after the handle() method has completed. By default, it does nothing. It’s not called if either the setup() or handle() method gen- erates an exception.\n\nh.handle()\n\nThis method is called to perform the actual work of a request. It’s called with no argu- ments, but several instance variables contain useful values. h.request contains the request, h.client_address contains the client address, and h.server contains an instance of the server that called the handler. For stream services such as TCP, the h.request attribute is a socket object. For datagram services, it’s a byte string contain- ing the received data.\n\nh.setup()\n\nThis method is called before the handle() method to perform initialization actions. By default, it does nothing. If you wanted a server to implement further connection setup such as establishing a SSL connection, you could implement it here.\n\nHere is an example of a handler class that implements a simple time server that\n\noperates with streams or datagrams:\n\ntry:\n\nfrom socketserver import BaseRequestHandler # Python 3\n\nexcept ImportError:\n\nfrom SocketServer import BaseRequestHandler # Python 2\n\nimport socket import time\n\nclass TimeServer(BaseRequestHandler):\n\ndef handle(self):\n\nresp = time.ctime() + \"\\r\\n\" if isinstance(self.request,socket.socket):\n\n# A stream-oriented connection self.request.sendall(resp.encode('latin-1'))\n\nelse:\n\n# A datagram-oriented connection self.server.socket.sendto(resp.encode('latin-1'),self.client_address)\n\nIf you know that a handler is only going to operate on stream-oriented connections such as TCP, have it inherit from StreamRequestHandler instead of BaseRequestHandler.This class sets two attributes: h.wfile is a file-like object that writes data to the client, and h.rfile is a file-like object that reads data from the client. Here is an example:\n\ntry:\n\nfrom socketserver import StreamRequestHandler # Python 3\n\nexcept ImportError:\n\nfrom SocketServer import StreamRequestHandler # Python 2\n\nimport time\n\nF h Lib f L Bdff",
      "content_length": 2286,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 516,
      "content": "SocketServer\n\n491\n\nclass TimeServer(StreamRequestHandler):\n\ndef handle(self):\n\nresp = time.ctime() + \"\\r\\n\" self.wfile.write(resp.encode('latin-1'))\n\nIf you are writing a handler that only operates with packets and always sends a response back to the sender, have it inherit from DatagramRequestHandler instead of BaseRequestHandler. It provides the same file-like interface as StreamRequestHandler. For example:\n\ntry:\n\nfrom socketserver import DatagramRequestHandler # Python 3\n\nexcept ImportError:\n\nfrom SocketServer import DatagramRequestHandler # Python 2\n\nimport time\n\nclass TimeServer(DatagramRequestHandler):\n\ndef handle(self):\n\nresp = time.ctime() + \"\\r\\n\" self.wfile.write(resp.encode('latin-1')\n\nIn this case, all of the data written to self.wfile is collected into a single packet that is returned after the handle() method returns.\n\nServers To use a handler, it has to be plugged into a server object.There are four basic server classes defined:\n\nTCPServer(address, handler)\n\nA server supporting the TCP protocol using IPv4. addressis a tuple of the form (host, port). handleris an instance of a subclass of the BaseRequestHandler class described later.\n\nUDPServer(address, handler)\n\nA server supporting the Internet UDP protocol using IPv4. addressand handlerare the same as for TCPServer().\n\nUnixStreamServer(address, handler)\n\nA server implementing a stream-oriented protocol using UNIX domain sockets. Inherits from TCPServer.\n\nUnixDatagramServer(address, handler)\n\nA server implementing a datagram protocol using UNIX domain sockets.This inherits from UDPServer.\n\nInstances of all four server classes have the following basic methods:\n\ns.fileno()\n\nReturns the integer file descriptor for the server socket.The presence of this method makes it legal to use server instances with polling operations such as the select() function.\n\ns.serve_forever()\n\nHandles an infinite number of requests.\n\nF h Lib f L Bdff",
      "content_length": 1922,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 517,
      "content": "492\n\nChapter 21 Network Programming and Sockets\n\ns.shutdown()\n\nStops the serve_forever() loop.\n\nThe following attributes give some basic information about the configuration of a\n\nrunning server:\n\ns.RequestHandlerClass\n\nThe user-provided request handler class that was passed to the server constructor.\n\ns.server_address\n\nThe address on which the server is listening, such as the tuple ('127.0.0.1', 80).\n\ns.socket\n\nThe socket object being used for incoming requests.\n\nHere is an example of running the TimeHandler as a TCP server:\n\nfrom SocketServer import TCPServer\n\nserv = TCPServer(('',10000,TimeHandler) serv.serve_forever()\n\nHere is an example of running the handler as a UDP server:\n\nfrom SocketServer import UDPServer\n\nserv = UDPServer(('',10000,TimeHandler) serv.serve_forever()\n\nA key aspect of the SocketServer module is that handlers are decoupled from servers. That is, once you have written a handler, you can plug it into many different kinds of servers without having to change its implementation.\n\nDefining Customized Servers Servers often need special configuration to account for different network address fami- lies, timeouts, concurrency, and other features.This customization is carried out by inheriting from one of the four basic servers described in the previous section.The fol- lowing class attributes can be defined to customize basic settings of the underlying net- work socket:\n\nServer.address_family\n\nThe address family used by the server socket.The default value is socket.AF_INET. Use socket.AF_INET6 if you want to use IPv6.\n\nServer.allow_reuse_address\n\nA Boolean flag that indicates whether or not a socket should reuse an address.This is useful when you want to immediately restart a server on the same port after a program has terminated (otherwise, you have to wait a few minutes).The default value is False.\n\nServer.request_queue_size\n\nThe size of the request queue that’s passed to the socket’s listen() method.The default value is 5.\n\nF h Lib f L Bdff",
      "content_length": 1991,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 518,
      "content": "SocketServer\n\n493\n\nServer.socket_type\n\nThe socket type used by the server, such as socket.SOCK_STREAM or socket.SOCK_DGRAM.\n\nServer.timeout\n\nTimeout period in seconds that the server waits for a new request. On timeout, the server calls the handle_timeout() method (described below) and goes back to wait- ing.This timeout is not used to set a socket timeout. However, if a socket timeout has been set, its value is used instead of this value.\n\nHere is an example of how to create a server that allows the port number to be\n\nreused:\n\nfrom SocketServer import TCPServer\n\nclass TimeServer(TCPServer):\n\nallow_reuse_address = True\n\nserv = TimeServer(('',10000,TimeHandler) serv.serve_forever()\n\nIf desired, the following methods are most useful to extend in classes that inherit from one of the servers. If you define any of these methods in your own server, make sure you call the same method in the superclass.\n\nServer.activate()\n\nMethod that carries out the listen() operation on the server.The server socket is ref- erenced as self.socket.\n\nServer.bind()\n\nMethod that carries out the bind() operation on the server.\n\nServer.handle_error(request, client_address)\n\nMethod that handles uncaught exceptions that occur in handling.To get information about the last exception, use sys.exc_info() or functions in the traceback module.\n\nServer.handle_timeout()\n\nMethod that is called when the server timeout occurs. By redefining this method and adjusting the timeout setting, you can integrate other processing into the server event loop.\n\nServer.verify_request(request, client_address)\n\nRedefine this method if you want to verify the connection before any further process- ing.This is what you define if you wanted to implement a firewall or perform some other kind of a validation.\n\nFinally, addition server features are available through the use of mixin classes.This is\n\nhow concurrency via threads or processing forking is added.The following classes are defined for this purpose:\n\nForkingMixIn\n\nA mixin class that adds UNIX process forking to a server, allowing it to serve multiple clients.The class variable max_children controls the maximum number of child\n\nF h Lib f L Bdff",
      "content_length": 2176,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 519,
      "content": "494\n\nChapter 21 Network Programming and Sockets\n\nprocesses, and the timeout variable determines how much time elapses between attempts to collect zombie processes.An instance variable active_children keeps track of how many active processes are running.\n\nThreadingMixIn\n\nA mixin class that modifies a server so that it can serve multiple clients with threads. There is no limit placed on the number of threads that can be created. By default, threads are non-daemonic unless the class variable daemon_threads is set to True.\n\nTo add these features to a server, you use multiple inheritance where the mixin class\n\nis listed first. For example, here is a forking time server:\n\nfrom SocketServer import TCPServer, ForkingMixIn\n\nclass TimeServer(ForkingMixIn, TCPServer):\n\nallow_reuse_address = True max_children = 10\n\nserv = TimeServer(('',10000,TimeHandler) serv.serve_forever()\n\nSince concurrent servers are relatively common, the SocketServer predefines the fol- lowing server classes for this purpose.\n\nn ForkingUDPServer(address, handler)\n\nn ForkingTCPServer(address, handler)\n\nn ThreadingUDPServer(address, handler)\n\nn ThreadingTCPServer(address, handler)\n\nThese classes are actually just defined in terms of the mixins and server classes. For example, here is the definition of ForkingTCPServer:\n\nclass ForkingTCPServer(ForkingMixIn, TCPServer): pass\n\nCustomization of Application Servers Other library modules often use the SocketServer class to implement servers for application-level protocols such as HTTP and XML-RPC.Those servers can also be customized via inheritance and extending the methods defined for basic server opera- tion. For example, here is a forking XML-RPC server that only accepts connections originating on the loopback interface:\n\ntry:\n\nfrom xmlrpc.server import SimpleXMLRPCServer # Python 3 from socketserver import ForkingMixIn\n\nexcept ImportError: # Python 2\n\nfrom SimpleXMLRPCServer import SimpleXMLRPCServer from SocketServer import ForkingMixIn\n\nclass MyXMLRPCServer(ForkingMixIn,SimpleXMLRPCServer): def verify_request(self, request, client_address):\n\nhost, port = client_address if host != '127.0.0.1':\n\nreturn False\n\nreturn SimpleXMLRPCServer.verify_request(self,request,client_address)\n\nF h Lib f L Bdff",
      "content_length": 2242,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 520,
      "content": "SocketServer\n\n495\n\n# Sample use def add(x,y):\n\nreturn x+y\n\nserver = MyXMLRPCServer((\"\",45000)) server.register_function(add) server.serve_forever()\n\nTo test this, you will need to use the xmlrpclib module. Run the previous server and then start a separate Python process:\n\n>>> import xmlrpclib >>> s = xmlrpclib.ServerProxy(\"http://localhost:45000\") >>> s.add(3,4) 7 >>>\n\nTo test the rejection of connections, try the same code, but from a different machine on the network. For this, you will need to replace “localhost” with the hostname of the machine that’s running the server.\n\nF h Lib f L Bdff",
      "content_length": 598,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 521,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 522,
      "content": "22\n\nInternet Application Programming\n\nThis chapter describes modules related to Internet application protocols including\n\nHTTP, XML-RPC, FTP, and SMTP.Web programming topics such as CGI scripting are covered in Chapter 23,“Web Programming.” Modules related to dealing with com- mon Internet-related data formats are covered in Chapter 24,“Internet Data Handling and Encoding.”\n\nThe organization of network-related library modules is one area where there are sig-\n\nnificant differences between Python 2 and 3. In the interest of looking forward, this chapter assumes the Python 3 library organization because it is more logical. However, the functionality provided by the library modules is virtually identical between Python versions as of this writing.When applicable, Python 2 module names are noted in each section.\n\nftplib The ftplib module implements the client side of the FTP protocol. It’s rarely neces- sary to use this module directly because the urllib package provides a higher-level interface. However, this module may still be useful if you want to have more control over the low-level details of an FTP connection. In order to use this module, it may be helpful to know some of the details of the FTP protocol which is described in Internet RFC 959.\n\nA single class is defined for establishing an FTP connection:\n\nFTP([host [, user [, passwd [, acct [, timeout]]]]])\n\nCreates an object representing an FTP connection. hostis a string specifying a host name. user, passwd, and acctoptionally specify a username, password, and account. If no arguments are given, the connect() and login() methods must be called explicitly to initiate the actual connection. If hostis given, connect()is automatically invoked. If user, passwd, and acctare given, login() is invoked. timeoutis a timeout period in seconds.\n\nAn instance fof FTP has the following methods:\n\nf.abort()\n\nAttempts to abort a file transfer that is in progress.This may or may not work depend- ing the remote server.\n\nF h Lib f L Bdff",
      "content_length": 2005,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 523,
      "content": "498\n\nChapter 22 Internet Application Programming\n\nf.close()\n\nCloses the FTP connection.After this has been invoked, no further operations can be performed on the FTP object f.\n\nf.connect(host [, port [, timeout]])\n\nOpens an FTP connection to a given host and port. hostis a string specifying the host name. portis the integer port number of the FTP server and defaults to port 21. timeoutis the timeout period in seconds. It is not necessary to call this if a host name was already given to FTP().\n\nf.cwd(pathname)\n\nChanges the current working directory on the server to pathname.\n\nf.delete(filename)\n\nRemoves the file filenamefrom the server.\n\nf.dir([dirname [, ... [, callback]]])\n\nGenerates a directory listing as produced by the 'LIST' command. dirnameoptionally supplies the name of a directory to list. In addition, if any additional arguments are sup- plied, they are simply passed as additional arguments to 'LIST’. If the last argument callbackis a function, it is used as a callback function to process the returned directo- ry listing data.This callback function works in the same way as the callback used by the retrlines() method. By default, this method prints the directory list to sys.stdout.\n\nf.login([user, [passwd [, acct]]])\n\nLogs in to the server using the specified username, password, and account. useris a string giving the username and defaults to 'anonymous'. passwdis a string containing the password and defaults to the empty string ''. acctis a string and defaults to the empty string. It is not necessary to call this method if this information was already given to FTP().\n\nf.mkd(pathname)\n\nCreates a new directory on the server.\n\nf.ntransfercmd(command [, rest])\n\nThe same as transfercmd() except that a tuple (sock, size) is returned where sockis a socket object corresponding to the data connection and sizeis the expected size of the data in bytes, or None if the size could not be determined.\n\nf.pwd()\n\nReturns a string containing the current working directory on the server.\n\nf.quit()\n\nCloses the FTP connection by sending the 'QUIT' command to the server.\n\nf.rename(oldname,newname)\n\nRenames a file on the server.\n\nF h Lib f L Bdff",
      "content_length": 2168,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 524,
      "content": "ftplib\n\n499\n\nf.retrbinary(command, callback [, blocksize [, rest]])\n\nReturns the results of executing a command on the server using binary transfer mode. commandis a string that specifies the appropriate file retrieval command and is almost always 'RETR filename'. callbackis a callback function that is invoked each time a block of data is received.This callback function is invoked with a single argument which is the received data in the form of a string. blocksizeis the maximum block size to use and defaults to 8192 bytes. restis an optional offset into the file. If supplied, this specifies the position in the file where you want to start the transfer. However, this is not supported by all FTP servers so this may result in an error_reply exception.\n\nf.retrlines(command [, callback])\n\nReturns the results of executing a command on the server using text transfer mode. commandis a string that specifies the command and is usually something like 'RETR filename’. callbackis a callback function that is invoked each time a line of data is received.This callback function is called with a single argument which is a string con- taining the received data. If callbackis omitted, the returned data is printed to sys.stdout.\n\nf.rmd(pathname)\n\nRemoves a directory from the server.\n\nf.sendcmd(command)\n\nSends a simple command to the server and returns the server response. commandis a string containing the command.This method should only be used for commands that don’t involve the transfer of data.\n\nf.set_pasv(pasv)\n\nSets passive mode. pasvis a Boolean flag that turns passive mode on if True or off if False. By default, passive mode is on.\n\nf.size(filename)\n\nReturns the size of filenamein bytes. Returns None if the size can’t be determined for some reason.\n\nf.storbinary(command, file [, blocksize])\n\nExecutes a command on the server and transmits data using binary transfer mode. commandis a string that specifies the low-level command. It is almost always set to 'STOR filename', where filenameis the name of a file you want to place on the server. fileis an open file-object from which data will be read using file.read(blocksize) and transferred to the server. blocksizeis the blocksize to use in the transfer. By default, it is 8192 bytes.\n\nf.storlines(command, file)\n\nExecutes a command on the server and transfers data using text transfer mode. command is a string which specifies the low-level command. It is usually 'STOR filename'. fileis an open file-object from which data will be read using file.readline() and sent to the server.\n\nF h Lib f L Bdff",
      "content_length": 2569,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 525,
      "content": "500\n\nChapter 22 Internet Application Programming\n\nf.transfercmd(command [, rest])\n\nInitiates a transfer over the FTP data connection. If active mode is being used, this sends a 'PORT' or 'EPRT' command and accepts the resulting connection from the server. If passive mode is being used, this sends a 'EPSV' or 'PASV' command followed by a connection to the server. In either case, once the data connection has been established, the FTP command in commandis then issued.This function returns a socket object cor- responding to the open data connection.The optional restparameter specifies a start- ing byte offset into files requested on the server. However, this is not supported on all servers and could result in an error_reply exception.\n\nExample The following example shows how to use this module to upload a file to a FTP server:\n\nhost = \"ftp.foo.com\" username = \"dave\" password = \"1235\" filename = \"somefile.dat\"\n\nimport ftplib ftp_serv = ftplib.FTP(host,username,password) # Open the file you want to send f = open(filename,\"rb\") # Send it to the FTP server resp = ftp_serv.storbinary(\"STOR \"+filename, f) # Close the connection ftp_serv.close\n\nTo fetch documents from an FTP server, use the urllib package. For example:\n\ntry:\n\nfrom urllib.request import urlopen # Python 3\n\nexcept ImportError:\n\nfrom urllib2 import urlopen # Python 2\n\nu = urlopen(\"ftp://username:password@somehostname/somefile\") contents = u.read()\n\nhttp Package The http package consists of modules for writing HTTP clients and servers as well as support for state management (cookies).The Hypertext Transfer Protocol (HTTP) is a simple text-based protocol that works as follows:\n\n1. A client makes a connection to an HTTP server and sends a request header of the following form:\n\nGET /document.html HTTP/1.0 Connection: Keep-Alive User-Agent: Mozilla/4.61 [en] (X11; U; SunOS 5.6 sun4u) Host: rustler.cs.uchicago.edu:8000 Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, image/png, */* Accept-Encoding: gzip Accept-Language: en Accept-Charset: iso-8859-1,*,utf-8\n\nOptional data ...\n\nF h Lib f L Bdff",
      "content_length": 2088,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 526,
      "content": "http package\n\n501\n\nThe first line defines the request type, document (the selector), and protocol ver- sion. Following the request line is a series of header lines containing various information about the client, such as passwords, cookies, cache preferences, and client software. Following the header lines, a single blank line indicates the end of the header lines.After the header, data may appear in the event that the request is sending information from a form or uploading a file. Each of the lines in the header should be terminated by a carriage return and a newline ('\\r\\n').\n\n2. The server sends a response of the following form:\n\nHTTP/1.0 200 OK Content-type: text/html Content-length: 72883 bytes ... Header: data\n\nData ...\n\nThe first line of the server response indicates the HTTP protocol version, a suc- cess code, and a return message. Following the response line is a series of header fields that contain information about the type of the returned document, the document size, web server software, cookies, and so forth.The header is terminat- ed by a single blank line followed by the raw data of the requested document.\n\nThe following request methods are the most common:\n\nMethod GET\n\nPOST\n\nHEAD\n\nPUT\n\nDescription Get a document. Post data to a form. Return header information only. Upload data to the server.\n\nThe response codes detailed in Table 22.1 are most commonly returned by servers.The Symbolic Constant column is the name of a predefined variable in http.client that holds the integer response code value and which can be used in code to improve read- ability.\n\nTable 22.1 Response Codes Commonly Returned by Servers\n\nCode\n\nDescription\n\nSymbolic Constant\n\nSuccess Codes (2xx)\n\n200\n\n201\n\n202\n\n204\n\nOK Created Accepted No content\n\nOK\n\nCREATED\n\nACCEPTED\n\nNO_CONTENT\n\nRedirection (3xx)\n\n300\n\n301\n\n302\n\n303\n\nMultiple choices Moved permanently Moved temporarily Not modified\n\nMULTIPLE_CHOICES\n\nMOVED_PERMANENTLY\n\nMOVED_TEMPORARILY\n\nNOT_MODIFIED\n\nF h Lib f L Bdff",
      "content_length": 1985,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 527,
      "content": "502\n\nChapter 22 Internet Application Programming\n\nTable 22.1\n\nContinued\n\nCode\n\nDescription\n\nSymbolic Constant\n\nClient Error (4xx)\n\n400\n\n401\n\n403\n\n404\n\nBad request Unauthorized Forbidden Not found\n\nBAD_REQUEST\n\nUNAUTHORIZED\n\nFORBIDDEN\n\nNOT_FOUND\n\nServer Error (5xx)\n\n500\n\n501\n\n502\n\n503\n\nInternal server error Not implemented Bad gateway Service unavailable\n\nINTERNAL_SERVER_ERROR\n\nNOT_IMPLEMENTED\n\nBAD_GATEWAY\n\nSERVICE_UNAVAILABLE\n\nThe headers that appear in both requests and responses are encoded in a format widely known as RFC-822.Then general form of each header is Headername: data, although further details can be found in the RFC. It is almost never necessary to parse these headers as Python usually does it for you when applicable.\n\nhttp.client (httplib) The http.client module provides low-level support for the client side of HTTP. In Python 2, this module is called httplib. Use functions in the urllib package instead. The module supports both HTTP/1.0 and HTTP/1.1 and additionally allows connec- tions via SSL if Python is built with OpenSSL support. Normally, you do not use this package directly; instead, you should consider using the urllib package. However, because HTTP is such an important protocol, you may encounter situations where you need to work with the low-level details in a way that urllib cannot easily address—for example, if you wanted to send requests with commands other than GET or POST. For more details about HTTP, consult RFC 2616 (HTTP/1.1) and RFC 1945 (HTTP/1.0).\n\nThe following classes can be used to establish an HTTP connection with a server:\n\nHTTPConnection(host [,port])\n\nCreates an HTTP connection. hostis the host name, and portis the remote port number.The default port is 80. Returns an HTTPConnection instance.\n\nHTTPSConnection(host [, port [, key_file=kfile [, cert_file=cfile ]]])\n\nCreates an HTTP connection but uses a secure socket.The default port is 443. key_file and cert_file are optional keyword arguments that specify client PEM- formatted private-key and certificate chain files, should they be needed for client authentication. However, no validation of server certificates is performed. Returns an HTTPSConnection instance.\n\nF h Lib f L Bdff",
      "content_length": 2208,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 528,
      "content": "http package\n\n503\n\nAn instance, h, of HTTPConnection or HTTPSConnection supports the following\n\nmethods:\n\nh.connect()\n\nInitializes the connection to the host and port given to HTTPConnection() or HTTPSConnection(). Other methods call this automatically if a connection hasn’t been made yet.\n\nh.close()\n\nCloses the connection.\n\nh.send(bytes)\n\nSends a byte string, bytes, to the server. Direct use of this function is discouraged because it may break the underlying response/request protocol. It’s most commonly used to send data to the server after h.endheaders() has been called.\n\nh.putrequest(method, selector [, skip_host [, skip_accept_encoding]])\n\nSends a request to the server. methodis the HTTP method, such as 'GET' or 'POST'. selectorspecifies the object to be returned, such as '/index.html'.The skip_host and skip_accept_encodingparameters are flags that disable the sending of Host: and Accept-Encoding: headers in the HTTP request. By default, both of these arguments are False. Because the HTTP/1.1 protocol allows multiple requests to be sent over a single connection, a CannotSendRequest exception may be raised if the connection is in a state that prohibits new requests from being issued.\n\nh.putheader(header, value, ...)\n\nSends an RFC-822–style header to the server. It sends a line to the server, consisting of the header, a colon and a space, and the value.Additional arguments are encoded as continuation lines in the header. Raises a CannotSendHeader exception if his not in a state that allows headers to be sent.\n\nh.endheaders()\n\nSends a blank line to the server, indicating the end of the header lines.\n\nh.request(method, url [, body [, headers]])\n\nSends a complete HTTP request to the server. methodand urlhave the same meaning as for h.putrequest(). bodyis an optional string containing data to upload to the server after the request has been sent. If bodyis supplied, the Context-length: header will automatically be set to an appropriate value. headersis a dictionary containing header:valuepairs to be given to the h.putheader() method.\n\nh.getresponse()\n\nGets a response from the server and returns an HTTPResponse instance that can be used to read data. Raises a ResponseNotReady exception if his not in a state where a response would be received.\n\nAn HTTPResponse instance, r, as returned by the getresponse() method, supports\n\nthe following methods:\n\nF h Lib f L Bdff",
      "content_length": 2400,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 529,
      "content": "504\n\nChapter 22 Internet Application Programming\n\nr.read([size])\n\nReads up to sizebytes from the server. If sizeis omitted, all the data for this request is returned.\n\nr.getheader(name [,default])\n\nGets a response header. nameis the name of the header. defaultis the default value to return if the header is not found.\n\nr.getheaders()\n\nReturns a list of (header, value) tuples.\n\nAn HTTPResponse instance ralso has the following attributes:\n\nr.version\n\nHTTP version used by the server.\n\nr.status\n\nHTTP status code returned by the server.\n\nr.reason\n\nHTTP error message returned by the server.\n\nr.length\n\nNumber of bytes left in the response.\n\nExceptions The following exceptions may be raised in the course of handling HTTP connections:\n\nException HTTPException\n\nNotConnected\n\nInvalidURL\n\nUnknownProtocol\n\nUnknownTransferEncoding\n\nUnimplementedFileMode\n\nIncompleteRead\n\nDescription Base class of all HTTP-related errors. Request was made but not connected. Bad URL or port number given. Unknown HTTP protocol number. Unknown transfer encoding. Unimplemented file mode. Incomplete data received. Unknown status code received.\n\nBadStatusLine\n\nThe following exceptions are related to the state of HTTP/1.1 connections. Because HTTP/1.1 allows multiple requests/responses to be sent over a single connection, extra rules are imposed as to when requests can be sent and responses received. Performing operations in the wrong order will generate an exception.\n\nException ImproperConnectionState\n\nCannotSendRequest\n\nCannotSendHeader\n\nResponseNotReady\n\nDescription Base class of all HTTP-connection state errors. Can’t send a request. Can’t send headers. Can’t read a response.\n\nF h Lib f L Bdff",
      "content_length": 1685,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 530,
      "content": "http package\n\n505\n\nExample The following example shows how the HTTPConnection class can be used to perform a memory-efficient file upload to a server using a POST request—something that is not easily accomplished within the urllib framework.\n\nimport os try:\n\nfrom httplib import HTTPConnection # Python 2\n\nexcept ImportError:\n\nfrom http.client import HTTPConnection # Python 3\n\nBOUNDARY = \"$Python-Essential-Reference$\" CRLF = '\\r\\n'\n\ndef upload(addr, url, formfields, filefields): # Create the sections for form fields formsections = [] for name in formfields:\n\nsection = [\n\n'--'+BOUNDARY, 'Content-disposition: form-data; name=\"%s\"' % name, '', formfields[name] ]\n\nformsections.append(CRLF.join(section)+CRLF)\n\n# Collect information about all of the files to be uploaded fileinfo = [(os.path.getsize(filename), formname, filename)\n\nfor formname, filename in filefields.items()]\n\n# Create the HTTP headers for each file filebytes = 0 fileheaders = [] for filesize, formname,filename in fileinfo:\n\nheaders = [\n\n'--'+BOUNDARY, 'Content-Disposition: form-data; name=\"%s\"; filename=\"%s\"' % \\\n\n(formname, filename),\n\n'Content-length: %d' % filesize, '' ]\n\nfileheaders.append(CRLF.join(headers)+CRLF) filebytes += filesize\n\n# Closing marker closing = \"--\"+BOUNDARY+\"--\\r\\n\"\n\n# Determine the entire length of the request content_size = (sum(len(f) for f in formsections) +\n\nsum(len(f) for f in fileheaders) + filebytes+len(closing))\n\n# Upload it conn = HTTPConnection(*addr) conn.putrequest(\"POST\",url) conn.putheader(\"Content-type\", 'multipart/form-data; boundary=%s' % BOUNDARY) conn.putheader(\"Content-length\", str(content_size)) conn.endheaders()\n\nF h Lib f L Bdff",
      "content_length": 1662,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 531,
      "content": "506\n\nChapter 22 Internet Application Programming\n\n# Send all form sections for s in formsections:\n\nconn.send(s.encode('latin-1'))\n\n# Send all files for head,filename in zip(fileheaders,filefields.values()):\n\nconn.send(head.encode('latin-1')) f = open(filename,\"rb\") while True:\n\nchunk = f.read(16384) if not chunk: break conn.send(chunk)\n\nf.close()\n\nconn.send(closing.encode('latin-1')) r = conn.getresponse() responsedata = r.read() conn.close() return responsedata\n\n# Sample: Upload some files. The form fields 'name', 'email' # 'file_1','file_2', and so forth are what the remote server # is expecting (obviously this will vary). server = ('localhost', 8080) url = '/cgi-bin/upload.py' formfields = {\n\n'name' : 'Dave', 'email' : 'dave@dabeaz.com'\n\n} filefields = {\n\n'file_1' : 'IMG_1008.JPG', 'file_2' : 'IMG_1757.JPG'\n\n} resp = upload(server, url,formfields,filefields) print(resp)\n\nhttp.server (BaseHTTPServer, CGIHTTPServer, SimpleHTTPServer) The http.server module provides various classes for implementing HTTP servers. In Python 2, the contents of this module are split across three library modules: BaseHTTPServer, CGIHTTPServer, and SimpleHTTPServer.\n\nHTTPServer The following class implements a basic HTTP server. In Python 2, it is located in the BaseHTTPServer module.\n\nHTTPServer(server_address, request_handler)\n\nCreates a new HTTPServer object. server_addressis a tuple of the form (host, port) on which the server will listen. request_handleris a handler class derived from BaseHTTPRequestHandler, which is described later.\n\nHTTPServer inherits directly from TCPServer defined in the socketserver mod- ule.Thus, if you want to customize the operation of the HTTP server in any way, you\n\nF h Lib f L Bdff",
      "content_length": 1721,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 532,
      "content": "http package\n\n507\n\ninherit from HTTPServer and extend it. Here is how you would define a multithreaded HTTP server that only accepts connections from a specific subnet:\n\ntry:\n\nfrom http.server import HTTPServer # Python 3 from socketserver import ThreadingMixIn\n\nexcept ImportError:\n\nfrom BaseHTTPServer import HTTPServer # Python 2 from SocketServer import ThreadingMixIn\n\nclass MyHTTPServer(ThreadingMixIn,HTTPServer):\n\ndef __init__(self,addr,handler,subnet):\n\nHTTPServer.__init__(self,addr,handler) self.subnet = subnet\n\ndef verify_request(self, request, client_address):\n\nhost, port = client_address if not host.startswith(subnet):\n\nreturn False\n\nreturn HTTPServer.verify_request(self,request,client_address)\n\n# Example of how the server runs serv = MyHTTPServer(('',8080), SomeHandler, '192.168.69.') serv.serve_forever()\n\nThe HTTPServer class only deals with the low-level HTTP protocol.To get the server to actually do anything, you have to supply a handler class.There are two built-in han- dlers and a base class that can be used for defining your own custom handling.These are described next.\n\nSimpleHTTPRequestHandler and CGIHTTPRequestHandler Two prebuilt web server handler classes can be used if you want to quickly set up a simple stand-alone web server.These classes operate independently of any third-party web server such as Apache.\n\nCGIHTTPRequestHandler(request, client_address, server)\n\nServes files from the current directory and all its subdirectories. In addition, the handler will run a file as a CGI script if it’s located in a special CGI directory (defined by the cgi_directories class variable which is set to ['/cgi-bin', '/htbin'] by default).The handler supports GET, HEAD, and POST methods. However, it does not sup- port HTTP redirects (HTTP code 302), which limits its use to only more simple CGI applications. For security purposes, CGI scripts are executed with a UID of nobody. In Python 2, this class is defined in the CGIHTTPServer module.\n\nSimpleHTTPRequestHandler(request, client_address, server)\n\nServes files from the current directory and all its subdirectories.The class provides sup- port for HEAD and GET requests, respectively.All IOError exceptions result in a \"404 File not found\" error.Attempts to access a directory result in a \"403 Directory listing not supported\" error. In Python 2, this class is defined in the SimpleHTTPServer module.\n\nBoth of these handlers define the following class variables that can be changed via\n\ninheritance if desired:\n\nhandler.server_version\n\nServer version string returned to clients. By default, this is set to a string such as 'SimpleHTTP/0.6'.\n\nF h Lib f L Bdff",
      "content_length": 2650,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 533,
      "content": "508\n\nChapter 22 Internet Application Programming\n\nhandler.extensions_map\n\nA dictionary mapping suffixes to MIME types. Unrecognized file types are considered to be of type 'application/octet-stream'.\n\nHere is an example of using these handler classes to run a stand-alone web server\n\ncapable of running CGI scripts:\n\ntry:\n\nfrom http.server import HTTPServer, CGIHTTPRequestHandler # Python 3\n\nexcept ImportError:\n\nfrom BaseHTTPServer import HTTPServer # Python 2 from CGIHTTPServer import CGIHTTPRequestHandler\n\nimport os\n\n# Change to the document root os.chdir(\"/home/httpd/html\") # Start the CGIHTTP server on port 8080 serv = HTTPServer((\"\",8080),CGIHTTPRequestHandler) serv.serve_forever()\n\nBaseHTTPRequestHandler The BaseHTTPRequestHandler class is a base class that’s used if you want to define your own custom HTTP server handling.The prebuilt handlers such as SimpleHTTPRequestHandler and CGIHTTPRequestHandler inherit from this. In Python 2, this class is defined in the BaseHTTPServer module.\n\nBaseHTTPRequestHandler(request, client_address, server)\n\nBase handler class used to handle HTTP requests.When a connection is received, the request and HTTP headers are parsed.An attempt is then made to execute a method of the form do_REQUESTbased on the request type. For example, a 'GET' method invokes do_GET() and a 'POST' method invokes do_POST. By default, this class does nothing, so these methods are expected to be defined in subclasses.\n\nThe following class variables are defined for BaseHTTPRequestHandler and can be\n\nredefined in subclasses.\n\nBaseHTTPRequestHandler.server_version\n\nSpecifies the server software version string that the server reports to clients—for exam- ple, 'ServerName/1.2'.\n\nBaseHTTPRequestHandler.sys_version\n\nPython system version, such as 'Python/2.6'.\n\nBaseHTTPRequestHandler.error_message_format\n\nFormat string used to build error messages sent to the client.The format string is applied to a dictionary containing the attributes code, message, and explain. For example:\n\n'''<head>\n\n<title>Error response</title> </head> <body> <h1>Error response</h1> <p>Error code %(code)d. <p>Message: %(message)s. <p>Error code explanation: %(code)s = %(explain)s. </body>'''\n\nF h Lib f L Bdff",
      "content_length": 2222,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 534,
      "content": "http package\n\n509\n\nBaseHTTPRequestHandler.protocol_version\n\nHTTP protocol version used in responses.The default is 'HTTP/1.0'.\n\nBaseHTTPRequestHandler.responses\n\nMapping of integer HTTP error codes to two-element tuples (message, explain) that describe the problem. For example, the integer code 404 is mapped to (\"Not Found\", \"Nothing matches the given URI\").The integer code and strings in this mapping are use when creating error messages as defined in the error_message_format attribute shown previously.\n\nWhen created to handle a connection, an instance, b, of BaseHTTPRequestHandler\n\nhas the following attributes:\n\nAttribute b.client_address\n\nb.command\n\nb.path\n\nb.request_version\n\nb.headers\n\nb.rfile\n\nDescription Client address as a tuple (host, port). Request type, such as 'GET', 'POST', 'HEAD', and so on. The request path such as '/index.html'. HTTP version string from the request, such as 'HTTP/1.0'. HTTP headers stored in a mapping object. To test for or extract the contents of a header, use dictionary operations such as headername in b.headers or headerval = b.headers[headername]. Input stream for reading optional input data. This is used when a client is uploading data (for example, during a POST request). Output stream for writing a response back to the client.\n\nb.wfile\n\nThe following methods are commonly used or redefined in subclasses:\n\nb.send_error(code [, message])\n\nSends a response for an unsuccessful request. codeis the numeric HTTP response code. messageis an optional error message. log_error() is called to record the error.This method creates a complete error response using the error_message_format class vari- able, sends it to the client, and closes the connection. No further operations should be performed after calling this.\n\nb.send_response(code [, message])\n\nSends a response for a successful request.The HTTP response line is sent, followed by Server and Date headers. codeis an HTTP response code, and messageis an optional message. log_request() is called to record the request.\n\nb.send_header(keyword, value)\n\nWrites a MIME header entry to the output stream. keywordis the header keyword, and valueis its value.This should only be called after send_response().\n\nb.end_headers()\n\nSends a blank line to signal the end of the MIME headers.\n\nF h Lib f L Bdff",
      "content_length": 2303,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 535,
      "content": "510\n\nChapter 22 Internet Application Programming\n\nb.log_request([code [, size]])\n\nLogs a successful request. codeis the HTTP code, and sizeis the size of the response in bytes (if available). By default, log_message() is called for logging.\n\nb.log_error(format, ...)\n\nLogs an error message. By default, log_message() is called for logging.\n\nb.log_message(format, ...)\n\nLogs an arbitrary message to sys.stderr. formatis a format string applied to any additional arguments passed.The client address and current time are prefixed to every message.\n\nHere is an example of creating a custom HTTP server that runs in a separate thread and lets you monitor the contents of a dictionary, interpreting the request path as a key.\n\ntry:\n\nfrom http.server import BaseHTTPRequestHandler, HTTPServer # Py 3\n\nexcept ImportError:\n\nfrom BaseHTTPServer import BaseHTTPRequestHandler, HTTPServer # Py 2\n\nclass DictRequestHandler(BaseHTTPRequestHandler):\n\ndef __init__(self,thedict,*args,**kwargs):\n\nself.thedict = thedict BaseHTTPRequestHandler.__init__(self,*args,**kwargs)\n\ndef do_GET(self):\n\nkey = self.path[1:] # Strip the leading '/' if not key in self.thedict:\n\nself.send_error(404, \"No such key\")\n\nelse:\n\nself.send_response(200) self.send_header('content-type','text/plain') self.end_headers() resp = \"Key : %s\\n\" % key resp += \"Value: %s\\n\" % self.thedict[key] self.wfile.write(resp.encode('latin-1'))\n\n# Example use d = {\n\n'name' : 'Dave', 'values' : [1,2,3,4,5], 'email' : 'dave@dabeaz.com'\n\n} from functools import partial serv = HTTPServer((\"\",9000), partial(DictRequestHandler,d))\n\nimport threading d_mon = threading.Thread(target=serv.serve_forever) d_mon.start()\n\nTo test this example, run the server and then enter a URL such as http://localhost: 9000/name or http://localhost:9000/values into a browser. If it works, you’ll see the contents of the dictionary being displayed.\n\nThis example also shows a technique for how to get servers to instantiate handler classes with extra parameters. Normally, servers create handlers using a predefined set of arguments that are passed to __init__(). If you want to add additional parameters, use the functools.partial() function as shown.This creates a callable object that includes your extra parameter but preserves the calling signature expected by the server.\n\nF h Lib f L Bdff",
      "content_length": 2320,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 536,
      "content": "http package\n\n511\n\nhttp.cookies (Cookie) The http.cookies module provides server-side support for working with HTTP cookies. In Python 2, the module is called Cookie.\n\nCookies are used to provide state management in servers that implement sessions, user logins, and related features.To drop a cookie on a user’s browser, an HTTP server typically adds an HTTP header similar to the following to an HTTP response:\n\nSet-Cookie: session=8273612; expires=Sun, 18-Feb-2001 15:00:00 GMT; \\\n\npath=/; domain=foo.bar.com\n\nAlternatively, a cookie can be set by embedding JavaScript in the <head> section of an HTML document:\n\n<SCRIPT LANGUAGE=\"JavaScript\"> document.cookie = \"session=8273612; expires=Sun, 18-Feb-2001 15:00:00 GMT; \\\n\nFeb 17; Path=/; Domain=foo.bar.com;\"\n\n</SCRIPT>\n\nThe http.cookies module simplifies the task of generating cookie values by providing a special dictionary-like object which stores and manages collections of cookie values known as morsels. Each morsel has a name, a value, and a set of optional attributes con- taining metadata to be supplied to the browser {expires, path, comment, domain, max-age, secure, version, httponly}.The name is usually a simple identifier such as \"name\" and must not be the same as one of the metadata names such as \"expires\" or \"path\".The value is usually a short string.To create a cookie, simply create a cookie object like this:\n\nc = SimpleCookie()\n\nNext, cookie values (morsels) can be set using ordinary dictionary assignment:\n\nc[\"session\"] = 8273612 c[\"user\"] = \"beazley\"\n\nAdditional attributes of a specific morsel are set as follows:\n\nc[\"session\"][\"path\"] = \"/\" c[\"session\"][\"domain\"] = \"foo.bar.com\" c[\"session\"][\"expires\"] = \"18-Feb-2001 15:00:00 GMT\"\n\nTo create output representing the cookie data as a set of HTTP headers, use the c.output() method. For example:\n\nprint(c.output()) # Produces two lines of output # Set-Cookie: session=8273612; expires=...; path=/; domain=... # Set-Cookie: user=beazley\n\nWhen a browser sends a cookie back to an HTTP server, it is encoded as a string of key=valuepairs, such as \"session=8273612; user=beazley\". Optional attributes such as expires, path, and domain are not returned.The cookie string can usually be found in the HTTP_COOKIE environment variable, which can be read by CGI applica- tions.To recover cookie values, use code similar to the following:\n\nc = SimpleCookie(os.environ[\"HTTP_COOKIE\"]) session = c[\"session\"].value user = c[\"user\"].value\n\nThe following documentation describes the SimpleCookie object in more detail.\n\nF h Lib f L Bdff",
      "content_length": 2553,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 537,
      "content": "512\n\nChapter 22 Internet Application Programming\n\nSimpleCookie([input])\n\nDefines a cookie object in which cookie values are stored as simple strings.\n\nA cookie instance, c, provides the following methods:\n\nc.output([attrs [,header [,sep]]])\n\nGenerates a string suitable for use in setting cookie values in HTTP headers. attrsis an optional list of the optional attributes to include (\"expires\", \"path\", \"domain\", and so on). By default, all cookie attributes are included. headeris the HTTP header to use ('Set-Cookie:' by default). sepis the character used to join the headers together and is a newline by default.\n\nc.js_output([attrs])\n\nGenerates a string containing JavaScript code that will set the cookie if executed on a browser supporting JavaScript. attrsis an optional list of the attributes to include.\n\nc.load(rawdata)\n\nLoads the cookie cwith data found in rawdata. If rawdatais a string, it’s assumed to be in the same format as the HTTP_COOKIE environment variable in a CGI program. If rawdatais a dictionary, each key-valuepair is interpreted by setting c[key]=value.\n\nInternally, the key/valuepairs used to store a cookie value are instances of a\n\nMorsel class.An instance, m, of Morsel behaves like a dictionary and allows the option- al \"expires\", \"path\", \"comment\", \"domain\", \"max-age\", \"secure\", \"version\", and \"httponly\" keys to be set. In addition, the morsel mhas the following methods and attributes:\n\nm.value\n\nA string containing the raw value of the cookie.\n\nm.coded_value\n\nA string containing the encoded value of the cookie that would be sent to or received from the browser.\n\nm.key\n\nThe cookie name.\n\nm.set(key,value,coded_value)\n\nSets the values of m.key, m.value, and m.coded_value shown previously.\n\nm.isReservedKey(k)\n\nTests whether kis a reserved keyword, such as \"expires\", \"path\", \"domain\", and so on.\n\nm.output([attrs [,header]])\n\nProduces the HTTP header string for this morsel. attrsis an optional list of the addi- tional attributes to include (\"expires\", \"path\", and so on). headeris the header string to use ('Set-Cookie:' by default).\n\nm.js_output([attrs])\n\nOutputs JavaScript code that sets the cookie when executed.\n\nF h Lib f L Bdff",
      "content_length": 2177,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 538,
      "content": "smtplib\n\n513\n\nm.OutputString([attrs])\n\nReturns the cookie string without any HTTP headers or JavaScript code.\n\nExceptions If an error occurs during the parsing or generation of cookie values, a CookieError exception is raised.\n\nhttp.cookiejar (cookielib) The http.cookiejar module provides client-side support for storing and managing HTTP cookies. In Python 2, the module is called cookielib.\n\nThe primary role of this module is to provide objects in which HTTP cookies can be stored so that they can be used in conjunction with the urllib package, which is used to access documents on the Internet. For instance, the http.cookiejar module can be used to capture cookies and to retransmit them on subsequent connection requests. It can also be used to work with files containing cookie data such as files creat- ed by various browsers.\n\nThe following objects are defined by the module:\n\nCookieJar()\n\nAn object that manages HTTP cookie values, storing cookies received as a result of HTTP requests, and adding cookies to outgoing HTTP requests. Cookies are stored entirely in memory and lost when the CookieJar instance is garbage-collected.\n\nFileCookieJar(filename [, delayload ])\n\nCreates a FileCookieJar instance that retrieves and stores cookie information to a file. filenameis the name of the file. delayload, if True, enables lazy access to the file. That is, the file won’t be read or stored except by demand.\n\nMozillaCookieJar(filename [, delayload ])\n\nCreates a FileCookieJar instance that is compatible with the Mozilla cookies.txt file.\n\nLWPCookieJar(filename [, delayload ])\n\nCreates a FileCookieJar instance that is compatible with the libwww-perl Set-Cookie3 file format.\n\nIt is somewhat rare to work with the methods and attributes of these objects directly.\n\nIf you need to know their low-level programming interface, consult the online docu- mentation. Instead, it is more common to simply instantiate one of the cookie jar objects and plug it into something else that wants to work with cookies.An example of this is shown in the urllib.request section of this chapter.\n\nsmtplib The smtplib module provides a low-level SMTP client interface that can be used to send mail using the SMTP protocol described in RFC 821 and RFC 1869.This mod- ule contains a number of low-level functions and methods that are described in detail in the online documentation. However, the following covers the most useful parts of this module:\n\nF h Lib f L Bdff",
      "content_length": 2458,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 539,
      "content": "514\n\nChapter 22 Internet Application Programming\n\nSMTP([host [, port]])\n\nCreates an object representing a connection to an SMTP server. If hostis given, it specifies the name of the SMTP server. portis an optional port number.The default port is 25. If hostis supplied, the connect() method is called automatically. Otherwise, you will need to manually call connect() on the returned object to estab- lish the connection.\n\nAn instance sof SMTP has the following methods:\n\ns.connect([host [, port]])\n\nConnects to the SMTP server on host. If hostis omitted, a connection is made to the local host ('127.0.0.1'). portis an optional port number that defaults to 25 if omit- ted. It is not necessary to call connect() if a host name was given to SMTP().\n\ns.login(user, password)\n\nLogs into the server if authentication is required. useris a username, and passwordis a password.\n\ns.quit()\n\nTerminates the session by sending a 'QUIT' command to the server.\n\ns.sendmail(fromaddr, toaddrs, message)\n\nSends a mail message to the server. fromaddris a string containing the email address of the sender. toaddrsis a list of strings containing the email addresses of recipients. messageis a string containing a completely formatted RFC-822 compliant message. The email package is commonly used to create such messages. It is important to note that although messagecan be given as a text string, it should only contain valid ASCII characters with values in the range 0 to 127. Otherwise, you will get an encoding error. If you need to send a message in a different encoding such as UTF-8, encode it into a byte string first and supply the byte string as message.\n\nExample The following example shows how the module can be used to send a message:\n\nimport smtplib fromaddr = \"someone@some.com\" toaddrs = [\"recipient@other.com\"] msg = \"From: %s\\r\\nTo: %s\\r\\n\\r\\n\" % (fromaddr, \",\".join(toaddrs)) msg += \"\"\" Refinance your mortgage to buy stocks and Viagra! \"\"\"\n\nserver = smtplib.SMTP('localhost') server.sendmail(fromaddr, toaddrs, msg) server.quit()\n\nurllib Package The urllib package provides a high-level interface for writing clients that need to interact with HTTP servers, FTP servers, and local files.Typical applications include scraping data from web pages, automation, proxies, web crawlers, and so forth.This is one of the most highly configurable library modules, so every last detail is not presented here. Instead, the most common uses of the package are described.\n\nF h Lib f L Bdff",
      "content_length": 2479,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 540,
      "content": "urllib Package\n\n515\n\nIn Python 2, the urllib functionality is spread across several different library mod- ules including urllib, urllib2, urlparse, and robotparser. In Python 3, all of this functionality has been consolidated and reorganized under the urllib package.\n\nurllib.request (urllib2) The urllib.request module provides functions and classes to open and fetch data from URLs. In Python 2, this functionality is found in a module urllib2.\n\nThe most common use of this module is to fetch data from web servers using HTTP. For example, this code shows the easiest way to simply fetch a web page:\n\ntry:\n\nfrom urllib.request import urlopen # Python 3\n\nexcept ImportError:\n\nfrom urllib2 import urlopen # Python 2\n\nu = urlopen(\"http://docs.python.org/3.0/library/urllib.request.html\") data = u.read()\n\nOf course, many complexities arise when interacting with servers in the real world. For example, you might have to worry about proxy servers, authentication, cookies, user agents, and other matters.All of these are supported, but the code is more complicated (keep reading).\n\nurlopen() and Requests The most straightforward way to make a request is to use the urlopen() function.\n\nurlopen(url [, data [, timeout]])\n\nOpens the URL urland returns a file-like object that can be used to read the returned data. urlmay either be a string containing a URL or an instance of the Request class, described shortly. datais a URL-encoded string containing form data to be uploaded to the server.When supplied, the HTTP 'POST' method is used instead of 'GET' (the default). Data is generally created using a function such as urllib.parse.urlencode(). timeoutis an optional timeout in seconds for all blocking operations used internally.\n\nThe file-like object ureturned by urlopen() supports the following methods:\n\nMethod u.read([nbytes])\n\nu.readline()\n\nu.readlines()\n\nu.fileno()\n\nu.close()\n\nu.info()\n\nu.getcode()\n\nu.geturl()\n\nDescription Reads nbytesof data as a byte string. Reads a single line of text as a byte string. Reads all input lines and returns a list. Returns the integer file descriptor. Closes the connection. Returns a mapping object with meta-information associated with the URL. For HTTP, the HTTP headers included with the server response are returned. For FTP, the headers include 'content-length'. For local files, the headers include a date, 'content-length', and 'content-type' field. Returns the HTTP response code as an integer—for example, 200 for success or 404 for file not found. Returns the real URL of the returned data, taking into account any redirection that may have occurred.\n\nF h Lib f L Bdff",
      "content_length": 2623,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 541,
      "content": "516\n\nChapter 22 Internet Application Programming\n\nIt is important to emphasize that the file-like object uoperates in binary mode. If you need to process the response data as text, you will need to decode it using the codecs module or some other means.\n\nIf an error occurs during download, an URLError exception is raised.This includes\n\nerrors related to the HTTP protocol itself such as forbidden access or requests for authentication. For these kinds of errors, a server typically returns content that gives more descriptive information.To get this content, the exception instance itself operates as a file-like object that can be read. For example:\n\ntry:\n\nu = urlopen(\"http://www.python.org/perl.html\") resp = u.read() except HTTPError as e: resp = e.read()\n\nA very common error that arises with urlopen() is accessing web pages through a proxy server. For example, if your organization routes all web traffic through a proxy, requests may fail. If the proxy server doesn’t require any kind of authentication, you may be able to fix this by merely setting the HTTP_PROXY environment variable in the os.environ dictionary. For example, os.environ['HTTP_PROXY'] = 'http://example.com:12345'.\n\nFor simple requests, the urlparameter to urlopen() is a string such as\n\n'http://www.python.org'. If you need to do anything more complicated such as make modifications to HTTP request headers, create a Request instance and use that as the urlparameter.\n\nRequest(url [, data [, headers [, origin_req_host [, unverifiable]]]])\n\nCreates a new Request instance. urlspecifies the URL (for example, 'http://www.foo.bar/spam.html'). datais URL-encoded data to be uploaded to the server in HTTP requests.When this is supplied, it changes the HTTP request type from 'GET' to 'POST'. headersis a dictionary containing key-value mappings repre- senting the contents of the HTTP headers. origin_req_hostis set to the request-host of the transaction—typically it’s the host name from which the request is originating. unverifiableis set to True if the request is for an unverifiable URL.An unverifiable URL is informally defined as a URL not directly entered by the user—for instance, a URL embedded within a page that loads an image.The default value of unverifiable is False.\n\nAn instance rof Request has the following methods:\n\nr.add_data(data)\n\nAdds data to a request. If the request is an HTTP request, the method is changed to 'POST'. datais URL-encoded data as described for Request().This does not append datato any previously set data; it simply replaces the old data with data.\n\nr.add_header(key, val)\n\nAdds header information to the request. keyis the header name, and valis the header value. Both arguments are strings.\n\nF h Lib f L Bdff",
      "content_length": 2730,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 542,
      "content": "urllib Package\n\n517\n\nr.add_unredirected_header(key, val)\n\nAdds header information to a request that will not be added to redirected requests. key and valhave the same meaning as for add_header().\n\nr.get_data()\n\nReturns the request data (if any).\n\nr.get_full_url()\n\nReturns the full URL of a request.\n\nr.get_host()\n\nReturns the host to which the request will be sent.\n\nr.get_method()\n\nReturns the HTTP method, which is either 'GET' or 'POST'.\n\nr.get_origin_req_host()\n\nReturns the request-host of the originating transaction.\n\nr.get_selector()\n\nReturns the selector part of the URL (for example, '/index.html').\n\nr.get_type()\n\nReturns the URL type (for example, 'http').\n\nr.has_data()\n\nReturns True if data is part of the request.\n\nr.is_unverifiable()\n\nReturns True if the request is unverifiable.\n\nr.has_header(header)\n\nReturns True if the request has header header.\n\nr.set_proxy(host, type)\n\nPrepares the request for connecting to a proxy server.This replaces the original host with hostand the original type of the request with type.The selector part of the URL is set to the original URL.\n\nHere is an example that uses a Request object to change the 'User-Agent' header used by urlopen().You might use this if you wanted a server to think you were mak- ing a connection from Internet Explorer, Firefox, or some other browser.\n\nheaders = {\n\n'User-Agent':\n\n'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR 2.0.50727)'\n\n}\n\nr = Request(\"http://somedomain.com/\",headers=headers) u = urlopen(r)\n\nF h Lib f L Bdff",
      "content_length": 1521,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 543,
      "content": "518\n\nChapter 22 Internet Application Programming\n\nCustom Openers The basic urlopen() function does not provide support for authentication, cookies, or other advanced features of HTTP. To add support, you must create your own custom opener object using the build_opener() function:\n\nbuild_opener([handler1 [, handler2, ... ]])\n\nBuilds a custom opener object for opening URLs.The arguments handler1, handler2, and so on are all instances of special handler objects.The purpose of these handlers is to add various capabilities to the resulting opener object.The following lists all the available handler objects:\n\nHandler CacheFTPHandler\n\nFileHandler\n\nFTPHandler\n\nHTTPBasicAuthHandler\n\nHTTPCookieProcessor\n\nHTTPDefaultErrorHandler\n\nHTTPDigestAuthHandler\n\nHTTPHandler\n\nHTTPRedirectHandler\n\nHTTPSHandler\n\nProxyHandler\n\nProxyBasicAuthHandler\n\nProxyDigestAuthHandler\n\nDescription FTP handler with persistent FTP connections Opens local files Opens URLs via FTP Basic HTTP authentication handling Processing of HTTP cookies Handles HTTP errors by raising an HTTPError excep- tion HTTP digest authentication handling Opens URLs via HTTP Handles HTTP redirects Opens URLs via secure HTTP Redirects requests through a proxy Basic proxy authentication Digest proxy authentication Handler that deals with all unknown URLs\n\nUnknownHandler\n\nBy default, an opener is always created with the handlers ProxyHandler, UnknownHandler, HTTPHandler, HTTPSHandler, HTTPDefaultErrorHandler, HTTPRedirectHandler, FTPHandler, FileHandler, and HTTPErrorProcessor.These handlers provide a basic level of functionality. Extra handlers supplied as arguments are added to this list. However, if any of the extra handlers are of the same type as the defaults, they take precedence. For example, if you added an instance of HTTPHandler or some class that derived from HTTPHandler, it would be used instead of the default. The object returned by build_opener() has a method, open(url [, data [, timeout]]), that is used to open URLs according to all the rules provided by the vari- ous handlers.The arguments to open() are the same as what are passed to the urlopen() function.\n\ninstall_opener(opener)\n\nInstalls a different opener object for use as the global URL opener used by urlopen(). openeris usually of an opener object created by build_opener().\n\nThe next few sections show how to create custom openers for some of the more\n\ncommon scenarios that arise when using urlib.request module.\n\nF h Lib f L Bdff",
      "content_length": 2476,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 544,
      "content": "urllib Package\n\n519\n\nPassword Authentication To handle requests involving password authentication, you create an opener with some combination of HTTPBasicAuthHandler, HTTPDigestAuthHandler, ProxyBasicAuthHandler, or ProxyDigestAuthHandler handlers added to it. Each of these handlers has the following method which can be used to set password:\n\nh.add_password(realm, uri, user, passwd)\n\nAdds user and password information for a given realm and URI.All parameters are strings. urican optionally be a sequence of URIs, in which case the user and password information is applied to all the URIs in the sequence.The realmis a name or descrip- tion associated with the authentication. Its value depends on the remote server. However, it’s usually a common name associated with a collection of related web pages. uriis a base URL associated with the authentication. Typical values for realmand uri might be something like ('Administrator', 'http://www.somesite.com'). user and passwordspecify a username and password, respectively.\n\nHere is an example of how to set up an opener with basic authentication:\n\nauth = HTTPBasicAuthHandler() auth.add_password(\"Administrator\",\"http://www.secretlair.com\",\"drevil\",\"12345\")\n\n# Create opener with authentication added opener = build_opener(auth)\n\n# Open URL u = opener.open(\"http://www.secretlair.com/evilplan.html\")\n\nHTTP Cookies To manage HTTP cookies, create an opener object with an HTTPCookieProcessor handler added to it. For example:\n\ncookiehand = HTTPCookieProcessor() opener = build_opener(cookiehand) u = opener.open(\"http://www.example.com/\")\n\nBy default, the HTTPCookieProcessor uses the CookieJar object found in the http.cookiejar module. Different types of cookie processing can be supported by supplying a different CookieJar object as an argument to HTTPCookieProcessor. For example:\n\ncookiehand = HTTPCookieProcessor(\n\nhttp.cookiejar.MozillaCookieJar(\"cookies.txt\")\n\n)\n\nopener = build_opener(cookiehand) u = opener.open(\"http://www.example.com/\")\n\nProxies If requests need to be redirected through a proxy, create an instance of ProxyHandler.\n\nProxyHandler([proxies])\n\nCreates a proxy handler that routes requests through a proxy.The argument proxiesis a dictionary that maps protocol names (for example, 'http', 'ftp', and so on) to the URLs of the corresponding proxy server.\n\nF h Lib f L Bdff",
      "content_length": 2349,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 545,
      "content": "520\n\nChapter 22 Internet Application Programming\n\nThe following example shows how to use this:\n\nproxy = ProxyHandler({'http': 'http://someproxy.com:8080/'} auth = HTTPBasicAuthHandler() auth.add_password(\"realm\",\"host\", \"username\", \"password\") opener = build_opener(proxy, auth)\n\nu = opener.open(\"http://www.example.com/doc.html\")\n\nurllib.response This is an internal module that implements the file-like objects returned by functions in the urllib.request module.There is no public API.\n\nurllib.parse The urllib.parse module is used to manipulate URL strings such as \"http://www.python.org\".\n\nURL Parsing (urlparse Module in Python 2) The general form of a URL is \"scheme://netloc/ path;parameters?query#fragment\". In addition, the netlocpart of a URL may include a port number such as \"hostname:port\" or user authentication information such as \"user:pass@hostname\".The following function is used to parse a URL:\n\nurlparse(urlstring [, default_scheme [, allow_fragments]])\n\nParses the URL in urlstring and returns a ParseResult instance. default_scheme specifies the scheme (\"http\", \"ftp\", and so on) to be used if none is present in the URL. If allow_fragmentsis zero, fragment identifiers are not allowed.A ParseResult instance ris a named tuple the form (scheme, netloc, path, parameters, query, fragment). However, the following read-only attributes are also defined:\n\nDescription URL scheme specifier (for example, 'http') Netloc specifier (for example, 'www.python.org') Hierarchical path (for example, '/index.html') Parameters for the last path element Query string (for example, 'name=Dave&id=42') Fragment identifier without the leading '#' r.fragment r.username Username component if the netloc specifier is of the form\n\nAttribute r.scheme\n\nr.netloc\n\nr.path\n\nr.params\n\nr.query\n\n'username:password@hostname' Password component from the netloc specifier\n\nr.password r.hostname Host name component from the netloc specifier r.port\n\nPort number from the netloc specifier if it is of the form 'hostname:port'\n\nA ParseResult instance can be turned back into a URL string using r.geturl().\n\nF h Lib f L Bdff",
      "content_length": 2112,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 546,
      "content": "urllib Package\n\n521\n\nurlunparse(parts)\n\nConstructs a URL string from a tuple-representation of a URL as returned by urlparse(). partsmust be a tuple or iterable with six components.\n\nurlsplit(url [, default_scheme [, allow_fragments]])\n\nThe same as urlparse() except that the parametersportion of a URL is left unmodified in the path.This allows for parsing of URLs where parameters might be attached to individual path components such as 'scheme://netloc/path1;param1/path2;param2/path3?query#fragment'.The result is an instance of SplitResult, which is a named tuple containing (scheme, netloc, path, query, fragment).The following read-only attributes are also defined:\n\nAttribute r.scheme\n\nr.netloc\n\nr.path\n\nr.query\n\nr.fragment\n\nr.username\n\nr.password\n\nr.hostname\n\nr.port\n\nDescription URL scheme specifier (for example, 'http') Netloc specifier (for example, 'www.python.org') Hierarchical path (for example, '/index.html') Query string (for example, 'name=Dave&id=42') Fragment identifier without the leading '#' Username component if the netloc specifier is of the form 'username:password@hostname' Password component from the netloc specifier Host name component from the netloc specifier Port number from the netloc specifier if it is of the form 'hostname:port'\n\nA SplitResult instance can be turned back into a URL string using r.geturl().\n\nurlunsplit(parts)\n\nConstructs a URL from the tuple-representation created by urlsplit(). partsis a tuple or iterable with the five URL components.\n\nurldefrag(url)\n\nReturns a tuple (newurl, fragment) where newurlis urlstripped of fragments and fragmentis a string containing the fragment part (if any). If there are no fragments in url, then newurlis the same as urland fragmentis an empty string.\n\nurljoin(base, url [, allow_fragments])\n\nConstructs an absolute URL by combining a base URL, base, with a relative URL. url. allow_fragmentshas the same meaning as for urlparse(). If the last compo- nent of the base URL is not a directory, it’s stripped.\n\nparse_qs(qs [, keep_blank_values [, strict_parsing]])\n\nParses a URL-encoded (MIME type application/x-www-form-urlencoded) query string qsand returns a dictionary where the keys are the query variable names and the values are lists of values defined for each name. keep_blank_valuesis a Boolean flag\n\nF h Lib f L Bdff",
      "content_length": 2320,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 547,
      "content": "522\n\nChapter 22 Internet Application Programming\n\nthat controls how blank values are handled. If True, they are included in the dictionary with a value set to the empty string. If False (the default), they are discarded. strict_parsingis a Boolean flag that if True, turns parsing errors into a ValueError exception. By default, errors are silently ignored.\n\nparse_qsl(qs [, keep_blank_values [, strict_parsing]])\n\nThe same as parse_qs() except that the result is a list of pairs (name, value) where nameis the name of a query variable and valueis the value.\n\nURL Encoding (urllib Module in Python 2) The following functions are used to encode and decode data that make up URLs.\n\nquote(string [, safe [, encoding [, errors]]])\n\nReplaces special characters in stringwith escape sequences suitable for including in a URL. Letters, digits, and the underscore ( _ ), comma (,), period (.), and hyphen ( - ) characters are unchanged.All other characters are converted into escape sequences of the form '%xx'. safeprovides a string of additional characters that should not be quoted and is '/' by default. encodingspecifies the encoding to use for non-ASCII characters. By default, it is 'utf-8'. errorsspecifies what to do when encoding errors are encountered and is 'strict' by default.The encodingand errorsparameters are only available in Python 3.\n\nquote_plus(string [, safe [, encoding [, errors]]])\n\nCalls quote() and additionally replaces all spaces with plus signs. stringand safeare the same as in quote(). encodingand errorsare the same as with quote().\n\nquote_from_bytes(bytes [, safe])\n\nThe same as quote() but accepts a byte-string and performs no encoding.The return result is a text string. Python 3 only.\n\nunquote(string [, encoding [, errors]])\n\nReplaces escape sequences of the form '%xx' with their single-character equivalent. encodingand errorsspecify the encoding and error handling for decoding data in '%xx' escapes.The default encoding is 'utf-8', and the default errorspolicy is 'replace'. encodingand errorsare Python 3 only.\n\nunquote_plus(string [, encoding [, errors]])\n\nLike unquote() but also replaces plus signs with spaces.\n\nunquote_to_bytes(string)\n\nThe same as unquote() but performs no decoding and returns a byte string.\n\nurlencode(query [, doseq])\n\nConverts query values in queryto a URL-encoded string suitable for inclusion as the queryparameter of a URL or for uploading as part of a POST request. queryis either a dictionary or a sequence of (key, value) pairs.The resulting string is a series of 'key=value' pairs separated by '&' characters, where both keyand valueare quoted using quote_plus().The doseqparameter is a Boolean flag that should be set to True if any valuein queryis a sequence, representing multiple values for the same key. In this case, a separate 'key=v' string is created for each vin value.\n\nF h Lib f L Bdff",
      "content_length": 2868,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 548,
      "content": "urllib Package\n\n523\n\nExamples The following examples show how to turn a dictionary of query variables into a URL suitable for use in an HTTP GET request and how you can parse a URL:\n\ntry:\n\nfrom urllib.parse import urlparse, urlencode, parse_qsl # Python 3\n\nexcept ImportError:\n\nfrom urlparse import urlparse, parse_qsl # Python 2 from urllib import urlencode\n\n# Example of creating a URL with properly encoded query varibles form_fields = {\n\n'name' : 'Dave', 'email' : 'dave@dabeaz.com', 'uid' : '12345'\n\n} form_data = urlencode(form_fields) url = \"http://www.somehost.com/cgi-bin/view.py?\"+form_data\n\n# Example of parsing a URL into components r = urlparse(url) print(r.scheme) # 'http' print(r.netloc) # 'www.somehost.com' print(r.path) # '/cgi-bin/view.py' print(r.params) # '' print(r.query) # 'uid=12345&name=Dave&email=dave%40dabeaz.com' print(r.fragment) # ''\n\n# Extract query data parsed_fields = dict(parse_qsl(r.query)) assert form_fields == parsed_fields\n\nurllib.error The urllib.error module defines exceptions used by the urllib package.\n\nContentTooShort\n\nRaised when the amount of downloaded data is less than the expected amount (as defined by the 'Content-Length' header). Defined in the urllib module in Python 2.\n\nHTTPError\n\nRaised to indicate problems with the HTTP protocol.This error may be used to signal events such as authentication required.This exception can also be used as a file object to read the data returned by the server that’s associated with the error.This is a subclass of URLError. It is defined in the urllib2 module in Python 2.\n\nURLError\n\nError raised by handlers when a problem is detected.This is a subclass of IOError.The reason attribute of the exception instance has more information about the problem. This is defined in the urllib2 module in Python 2.\n\nurllib.robotparser (robotparser) The urllib.robotparser module (robotparser in Python 2) is used to fetch and parse the contents of 'robots.txt' files used to instruct web crawlers. Consult the online documentation for further usage information.\n\nF h Lib f L Bdff",
      "content_length": 2064,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 549,
      "content": "524\n\nChapter 22 Internet Application Programming\n\nNotes\n\nn Advanced users of the urllib package can customize its behavior in almost every way imaginable.This includes creating new kinds of openers, handlers, requests, protocols, etc.This topic is beyond the scope of what can be covered here, but the online documentation has some further details.\n\nn Users of Python 2 should take note that the urllib.urlopen() function, which is in widespread use, is officially deprecated in Python 2.6 and eliminated in Python 3. Instead of using urllib.urlopen(), you should use urllib2.urlopen(), which provides the same functionality as urllib.request.urlopen() described here.\n\nxmlrpc Package The xmlrpc package contains modules for implement XML-RPC servers and clients. XML-RPC is a remote procedure call mechanism that uses XML for data encoding and HTTP as a transport mechanism.The underlying protocol is not specific to Python so programs using these modules can potentially interact with programs written in other languages. More information about XML-RPC can be obtained at http://www. xmlrpc.com.\n\nxmlrpc.client (xmlrpclib) The xmlrpc.client module is used to write XML-RPC clients. In Python 2, this module is called xmlrpclib.To operate as a client, you create an instance of ServerProxy:\n\nServerProxy(uri [, transport [, encoding [, verbose [, allow_none [, use_datetime]]]])\n\nuriis the location of the remote XML-RPC server—for example, \"http://www. foo.com/RPC2\". If necessary, basic authentication information can be added to the URI using the format \"http://user:pass@host:port/path\", where user:passis the username and password.This information is base-64 encoded and put in an 'Authorization:' header on transport. If Python is configured with OpenSSL sup- port, HTTPS can also be used. transportspecifies a factory function for creating an internal transport object used for low-level communication.This argument is only used if XML-RPC is being used over some kind of connection other than HTTP or HTTPS. It is almost never necessary to supply this argument in normal use (consult the online documentation for details). encodingspecifies the encoding, which is UTF-8 by default. verbosedisplays some debugging information if True. allow_none, if True, allows the value None to be sent to remote servers. By default, this is disabled because it’s not universally supported. use_datetimeis a Boolean flag that if set to True, uses the datetime module to represent dates and times. By default, this is False.\n\nAn instance, s, of ServerProxy transparently exposes all the methods on the remote server.The methods are accessed as attributes of s. For example, this code gets the cur- rent time from a remote server providing that service:\n\n>>> s = ServerProxy(\"http://www.xmlrpc.com/RPC2\") >>> s.currentTime.getCurrentTime() <DateTime u'20051102T20:08:24' at 2c77d8> >>>\n\nF h Lib f L Bdff",
      "content_length": 2895,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 550,
      "content": "xmlrpc Package\n\n525\n\nFor the most part, RPC calls work just like ordinary Python functions. However, only a limited number of argument types and return values are supported by the XML-RPC protocol:\n\nXML-RPC Type boolean integer float string array structure dates binary\n\nPython Equivalent True and False int float string or unicode (must only contain characters valid in XML) Any sequence containing valid XML-RPC types Dictionary containing string keys and values of valid types Date and time (xmlrpc.client.DateTime) Binary data (xmlrpc.client.Binary)\n\nWhen dates are received, they are stored in an xmlrpc.client.DateTime instance d. The d.value attribute contains the date as an ISO 8601 time/date string.To convert it into a time tuple compatible with the time module, use d.timetuple().When binary data is received, it is stored in an xmlrpc.client.Binary instance b.The b.data attribute contains the data as a byte string. Be aware that strings are assumed to be Unicode and that you will have to worry about using proper encodings. Sending raw Python 2 byte strings will work if they contain ASCII but will break otherwise.To deal with this, convert to a Unicode string first.\n\nIf you make an RPC call with arguments involving invalid types, you may get a\n\nTypeError or an xmlrpclib.Fault exception.\n\nIf the remote XML-RPC server supports introspection, the following methods may\n\nbe available:\n\ns.system.listMethods()\n\nReturns a list of strings listing all the methods provided by the XML-RPC server.\n\ns.methodSignatures(name)\n\nGiven the name of a method, name, returns a list of possible calling signatures for the method. Each signature is a list of types in the form of a comma-separated string (for example, 'string, int, int'), where the first item is the return type and the remaining items are argument types. Multiple signatures may be returned due to over- loading. In XML-RPC servers implemented in Python, signatures are typically empty because functions and methods are dynamically typed.\n\ns.methodHelp(name)\n\nGiven the name of a method, name, returns a documentation string describing the use of that method. Documentation strings may contain HTML markup.An empty string is returned if no documentation is available.\n\nThe following utility functions are available in the xmlrpclib module:\n\nboolean(value)\n\nCreates an XML-RPC Boolean object from value.This function predates the exis- tence of the Python Boolean type, so you may see it used in older code.\n\nF h Lib f L Bdff",
      "content_length": 2495,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 551,
      "content": "526\n\nChapter 22 Internet Application Programming\n\nBinary(data)\n\nCreates an XML-RPC object containing binary data. datais a string containing the raw data. Returns a Binary instance.The returned Binary instance is transparently encoded/decoded using base 64 during transmission.To extract binary from Binary instance b, use b.data.\n\nDateTime(daytime)\n\nCreates an XML-RPC object containing a date. daytimeis either an ISO 8601 format date string, a time tuple or struct as returned by time.localtime(), or a datetime instance from the datetime module.\n\ndumps(params [, methodname [, methodresponse [, encoding [, allow_none]]]])\n\nConverts paramsinto an XML-RPC request or response, where paramsis either a tuple of arguments or an instance of the Fault exception. methodnameis the name of the method as a string. methodresponseis a Boolean flag. If True, then the result is an XML-RPC response. In this case, only one value can be supplied in params. encoding specifies the text encoding in the generated XML and defaults to UTF-8. allow_none is a flag that specifies whether or not None is supported as a parameter type. None is not explicitly mentioned by the XML-RPC specification, but many servers support it. By default, allow_noneis False.\n\nloads(data)\n\nConverts datacontaining an XML-RPC request or response into a tuple (params, methodname) where paramsis a tuple of parameters and methodnameis a string con- taining the method name. If the request represents a fault condition instead of an actual value, then the Fault exception is raised.\n\nMultiCall(server)\n\nCreates a MultiCall object that allows multiple XML-RPC requests to be packaged together and sent as a single request.This can be a useful performance optimization if many different RPC requests need to be made on the same server. serveris an instance of ServerProxy, representing a connection to a remote server.The returned MultiCall object is used in exactly the same way as ServerProxy. However, instead of immediately executing the remote methods, the method calls as queued until the MultiCall object is called as a function. Once this occurs, the RPC requests are trans- mitted.The return value of this operation is a generator that yields the return result of each RPC operation in sequence. Note that MultiCall() only works if the remote server provides a system.multicall() method.\n\nHere is an example that illustrates the use of MultiCall:\n\nmulti = MultiCall(server) multi.foo(4,6,7) # Remote method foo multi.bar(\"hello world\") # Remote method bar multi.spam() # Remote method spam # Now, actually send the XML-RPC request and get return results foo_result, bar_result, spam_result = multi()\n\nF h Lib f L Bdff",
      "content_length": 2689,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 552,
      "content": "xmlrpc Package\n\n527\n\nExceptions The following exceptions are defined in xmlrpc.client:\n\nFault\n\nIndicates an XML-RPC fault.The faultCode attribute contains a string with the fault type.The faultString attribute contains a descriptive message related to the fault.\n\nProtocolError\n\nIndicates a problem with the underlying networking—for example, a bad URL or a connection problem of some kind.The url attribute contains the URI that triggered the error.The errcode attribute contains an error code.The errmsg attribute contains a descriptive string.The headers attribute contains all the HTTP headers of the request that triggered the error.\n\nxmlrpc.server (SimpleXMLRPCServer, DocXMLRPCServer) The xmlrpc.server module contains classes for implementing different variants of XML-RPC servers. In Python 2, this functionality is found in two separate modules: SimpleXMLRPCServer and DocXMLRPCServer.\n\nSimpleXMLRPCServer(addr [, requestHandler [, logRequests]])\n\nCreates an XML-RPC server listening on the socket address addr(for example, ('localhost',8080)). requestHandleris factory function that creates handler request objects when connections are received. By default, it is set to SimpleXMLRPCRequestHandler, which is currently the only available handler. logRequestsis a Boolean flag that indicates whether or not to log incoming requests. The default value is True.\n\nDocXMLRPCServer(addr [, requestHandler [, logRequest])\n\nCreates a documenting XML-RPC that additionally responds to HTTP GET requests (normally sent by a browser). If received, the server generates documentation from the documentation strings found in all of the registered methods and objects.The arguments have the same meaning as for SimpleXMLRPCServer.\n\nAn instance, s, of SimpleXMLRPCServer or DocXMLRPCServer has the following\n\nmethods:\n\ns.register_function(func [, name])\n\nRegisters a new function, func, with the XML-RPC server. nameis an optional name to use for the function. If nameis supplied, it’s the name clients will use to access the function.This name may contain characters that are not part of valid Python identifiers, including periods (.). If nameis not supplied, then the actual function name of funcis used instead.\n\ns.register_instance(instance [, allow_dotted_names])\n\nRegisters an object that’s used to resolve method names not registered with the register_function() method.If the instance instancedefines the method _dispatch(self, methodname, params),it is called to process requests.methodnameis the name of the method,and paramsis a tuple containing arguments.The return value of _dispatch() is returned to clients.If no _dispatch() method is defined,the instance is\n\nF h Lib f L Bdff",
      "content_length": 2687,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 553,
      "content": "528\n\nChapter 22 Internet Application Programming\n\nchecked to see if the method name matches the names of any methods defined for instance.If so,the method is called directly.The allow_dotted_namesparameter is a flag that indicates whether a hierarchical search should be performed when checking for method names.For example,if a request for method 'foo.bar.spam' is received,this determines whether or not a search for instance.foo.bar.spam is made.By default,this is False.It should not be set to True unless the client has been verified.Otherwise,it opens up a security hole that can allow intruders to execute arbitrary Python code.Note that,at most,only one instance can be registered at a time.\n\ns.register_introspection_functions()\n\nAdds XML-RPC introspection functions system.listMethods(), system.methodHelp(), and system.methodSignature() to the XML-RPC server. system.methodHelp() returns the documentation string for a method (if any).The system.methodSignature() function simply returns a message indicating that the operation is unsupported (because Python is dynamically typed, type information is available).\n\ns.register_multicall_functions()\n\nAdds XML-RPC multicall function support by adding the system.multicall() function to the server.\n\nAn instance of DocXMLRPCServer additionally provides these methods:\n\ns.set_server_title(server_title)\n\nSets the title of the server in HTML documentation.The string is placed in the HTML <title> tag.\n\ns.set_server_name(server_name)\n\nSets the name of the server in HTML documentation.The string appears at the top of the page in an <h1> tag.\n\ns.set_server_documentation(server_documentation)\n\nAdds a descriptive paragraph to the generated HTML output.This string is added right after the server name, but before a description of the XML-RPC functions.\n\nAlthough it is common for an XML-RPC server to operate as a stand-alone process,\n\nit can also run inside a CGI script.The following classes are used for this:\n\nCGIXMLRPCRequestHandler([allow_none [, encoding]])\n\nA CGI Request handler that operates in the same manner as SimpleXMLRPCServer. The arguments have the same meaning as described for SimpleXMLRPCServer.\n\nDocCGIXMLRPCRequestHandler()\n\nA CGI Request handler that operates in the same manner as DocXMLRPCServer. Please note that as of this writing, the calling arguments are different than CGIXMLRPCRequestHandler().This might be a Python bug so you should consult the online documentation in future releases.\n\nAn instance, c, of either CGI handler has the same methods as a normal XML-RPC server for registering functions and instances. However, they additionally define the fol- lowing method:\n\nF h Lib f L Bdff",
      "content_length": 2679,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 554,
      "content": "xmlrpc Package\n\n529\n\nc.handle_request([request_text])\n\nProcesses an XML-RPC request. By default, the request is read from standard input. If request_textis supplied, it contains the request data in the form received by an HTTP POST request.\n\nExamples Here is a very simple example of writing a standalone server. It adds a single function, add. In addition, it adds the entire contents of the math module as an instance, exposing all the functions it contains.\n\ntry:\n\nfrom xmlrpc.server import SimpleXMLRPCServer # Python 3\n\nexcept ImportError:\n\nfrom SimpleXMLRPCServer import SimpleXMLRPCServer # Python 2\n\nimport math\n\ndef add(x,y):\n\n\"Adds two numbers\" return x+y\n\ns = SimpleXMLRPCServer(('',8080)) s.register_function(add) s.register_instance(math) s.register_introspection_functions() s.serve_forever()\n\nHere is the same functionality implemented as CGI-script:\n\ntry:\n\nfrom xmlrpc.server import CGIXMLRPCRequestHandler # Python 3\n\nexcept ImportError:\n\nfrom SimpleXMLRPCServer import CGIXMLRPCRequestHandler # Python 2\n\nimport math\n\ndef add(x,y):\n\n\"Adds two numbers\" return x+y\n\ns = CGIXMLRPCRequestHandler() s.register_function(add) s.register_instance(math) s.register_introspection_functions() s.handle_request()\n\nTo access XML-RPC functions from other Python programs, use the xmlrpc.client or xmlrpclib module. Here is a short interactive session that shows how it works:\n\n>>> from xmlrpc.client import ServerProxy >>> s = ServerProxy(\"http://localhost:8080\") >>> s.add(3,5) 8 >>> s.system.listMethods() ['acos', 'add', 'asin', 'atan', 'atan2', 'ceil', 'cos', 'cosh', 'degrees', 'exp', 'fabs', 'floor', 'fmod', 'frexp', 'hypot', 'ldexp', 'log', 'log10', 'modf', 'pow', 'radians', 'sin', 'sinh', 'sqrt', 'system.listMethods', 'system.methodHelp', 'system.methodSignature', 'tan', 'tanh'] >>> s.tan(4.5) 4.6373320545511847 >>>\n\nF h Lib f L Bdff",
      "content_length": 1850,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 555,
      "content": "530\n\nChapter 22 Internet Application Programming\n\nAdvanced Server Customization The XML-RPC server modules are easy to use for basic kinds of distributed comput- ing. For example, XML-RPC could be used as a protocol for high-level control of other systems on the network, provided they were all running a suitable XML-RPC server. More interesting objects can also be passed between systems if you additionally use the pickle module.\n\nOne concern with XML-RPC is that of security. By default, an XML-RPC server runs as an open service on the network, so anyone who knows the address and port of the server can connect to it (unless it’s shielded by a firewall). In addition, XML-RPC servers place no limit on the amount of data that can be sent in a request.An attacker could potentially crash the server by sending an HTTP POST request with a payload so large as to exhaust memory.\n\nIf you want to address any of these issues, you will need to customize the XML- RPC server classes or request handlers.All of the server classes inherit from TCPServer in the socketserver module.Thus, the servers can be customized in the same manner as other socket server classes (for example, adding threading, forking, or validating client addresses).A validation wrapper can be placed around the request handlers by inheriting from SimpleXMLRPCRequestHandler or DocXMLRPCRequestHandler and extending the do_POST() method. Here is an example that limits the size of incoming requests:\n\ntry:\n\nfrom xmlrpc.server import (SimpleXMLRPCServer,\n\nSimpleXMLRPCRequestHandler)\n\nexcept ImportError:\n\nfrom SimpleXMLRPCServer import (SimpleXMLRPCServer,\n\nSimpleXMLRPCRequestHandler)\n\nclass MaxSizeXMLRPCHandler(SimpleXMLRPCRequestHandler):\n\nMAXSIZE = 1024*1024 # 1MB def do_POST(self):\n\nsize = int(self.headers.get('content-length',0)) if size >= self.MAXSIZE:\n\nself.send_error(400,\"Bad request\")\n\nelse:\n\nSimpleXMLRPCRequestHandler.do_POST(self)\n\ns = SimpleXMLRPCServer(('',8080),MaxSizeXMLRPCHandler)\n\nIf you wanted to add any kind of HTTP-based authentication, it could also be imple- mented in a similar manner.\n\nF h Lib f L Bdff",
      "content_length": 2106,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 556,
      "content": "23\n\nWeb Programming\n\nPython is widely used when building websites and serves several different roles in this\n\ncapacity. First, Python scripts are often a useful way to simply generate a set of static HTML pages to be delivered by a web server. For example, a script can be used to take raw content and decorate it with additional features that you typically see on a website (navigation bars, sidebars, advertisements, stylesheets, etc.).This is mainly just a matter of file handling and text processing—topics that have been covered in other sections of the book.\n\nSecond, Python scripts are used to generate dynamic content. For example, a website might operate using a standard webserver such as Apache but would use Python scripts to dynamically handle certain kinds of requests.This use of Python is primarily associat- ed with form processing. For example, an HTML page might include a form like this:\n\n<FORM ACTION='/cgi-bin/subscribe.py' METHOD='GET'> Your name : <INPUT type='Text' name='name' size='30'> Your email address: <INPUT type='Text' name='email' size='30'> <INPUT type='Submit' name='submit-button' value='Subscribe'> </FORM>\n\nWithin the form, the ACTION attribute names a Python script 'subscribe.py' that will execute on the server when the form is submitted.\n\nAnother common scenario involving dynamic content generation is with AJAX (Asynchronous Javascript and XML).With AJAX, JavaScript event handlers are associat- ed with certain HTML elements on a page. For example, when the mouse hovers over a specific document element, a JavaScript function might execute and send an HTTP request to the webserver that gets processed (possibly by a Python script).When the associated response is received, another JavaScript function executes to process the response data and displays the result.There are many ways in which results might be returned. For example, a server might return data as plaintext, XML, JSON, or any number of other formats. Here is an example HTML document that illustrates one way to implement a hover popup where moving the mouse over selected elements causes a popup window to appear.\n\n<html>\n\n<head>\n\n<title>ACME Officials Quiet After Corruption Probe</title> <style type=\"text/css\">\n\n.popup { border-bottom:1px dashed green; } .popup:hover { background-color: #c0c0ff; }\n\n</style>\n\n</head> <body>\n\nF h Lib f L Bdff",
      "content_length": 2360,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 557,
      "content": "532\n\nChapter 23 Web Programming\n\n<span id=\"popupbox\"\n\nstyle=\"visibility:hidden; position:absolute; background-color:\n\n#ffffff;\">\n\n<span id=\"popupcontent\"></span>\n\n</span> <script>\n\n/* Get a reference to the popup box element */ var popup = document.getElementById(\"popupbox\"); var popupcontent = document.getElementById(\"popupcontent\");\n\n/* Get pop-up data from the server and display when received */ function ShowPopup(hoveritem,name) {\n\nvar request = new XMLHttpRequest(); request.open(\"GET\",\"cgi-bin/popupdata.py?name=\"+name, true); request.onreadystatechange = function() {\n\nvar done = 4, ok = 200; if (request.readyState == done && request.status == ok) {\n\nif (request.responseText) {\n\npopupcontent.innerHTML = request.responseText; popup.style.left = hoveritem.offsetLeft+10; popup.style.top = hoveritem.offsetTop+20; popup.style.visibility = \"Visible\";\n\n}\n\n}\n\n}; request.send();\n\n}\n\n/* Hide the popup box */ function HidePopup() {\n\npopup.style.visibility = \"Hidden\";\n\n}\n\n</script>\n\n<h3>ACME Officials Quiet After Corruption Probe</h3> <p> Today, shares of ACME corporation (<span class=\"popup\" onMouseOver=\"ShowPopup(this,'ACME');\"\n\nonMouseOut=\"HidePopup();\">ACME</span>)\n\nplummetted by more than 75% after federal investigators revealed that the board of directors is the target of a corruption probe involving the Governor, state lottery officials, and the archbishop.\n\n</p>\n\n</body>\n\n</html>\n\nIn this example, the JavaScript function ShowPopup() initiates a request to a Python script popupdata.py on the server.The result of this script is just a fragment of HTML, which is then displayed in a popup window. Figure 23.1 shows what this might look like in the browser.\n\nFinally, the entire website might run under the control of Python within the context\n\nof a framework written in Python. It has been humorously noted that Python has “more web programming frameworks than language keywords.”The topics of web frameworks is far beyond the scope of this book, but http://wiki.python.org/ moin/WebFrameworks is a good starting point for finding more information.\n\nF h Lib f L Bdff",
      "content_length": 2089,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 558,
      "content": "cgi\n\n533\n\nFigure 23.1 Possible browser display where the background text is just an ordinary HTML document and the pop-up window is dynamically generated by the popupdata.py script.\n\nThe rest of this chapter describes built-in modules related to the low-level interface\n\nby which Python interfaces with webservers and frameworks.Topics include CGI scripting, a technique used to access Python from third-party web servers and WSGI, a middleware layer used for writing components that integrate with Python’s various web frameworks.\n\ncgi The cgi module is used to implement CGI scripts, which are programs typically execut- ed by a webserver when it wants to process user input from a form or generate dynam- ic content of some kind.\n\nWhen a request corresponding to a CGI script is submitted, the webserver executes\n\nthe CGI program as a subprocess. CGI programs receive input from two sources: sys.stdin and environment variables set by the server.The following list details com- mon environment variables set by webservers:\n\nVariable AUTH_TYPE\n\nCONTENT_LENGTH\n\nCONTENT_TYPE\n\nDOCUMENT_ROOT\n\nGATEWAY_INTERFACE\n\nHTTP_ACCEPT\n\nHTTP_COOKIE\n\nHTTP_FROM\n\nHTTP_REFERER\n\nHTTP_USER_AGENT\n\nPATH_INFO\n\nPATH_TRANSLATED\n\nQUERY_STRING\n\nREMOTE_ADDR\n\nDescription Authentication method Length of data passed in sys.stdin Type of query data Document root directory CGI revision string MIME types accepted by the client Netscape persistent cookie value Email address of client (often disabled) Referring URL Client browser Extra path information passed Translated version of PATH_INFO Query string Remote IP address of the client Remote host name of the client\n\nREMOTE_HOST\n\nF h Lib f L Bdff",
      "content_length": 1671,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 559,
      "content": "534\n\nChapter 23 Web Programming\n\nVariable REMOTE_IDENT\n\nREMOTE_USER\n\nREQUEST_METHOD\n\nSCRIPT_NAME\n\nSERVER_NAME\n\nSERVER_PORT\n\nSERVER_PROTOCOL\n\nDescription User making the request Authenticated username Method ('GET' or 'POST') Name of the program Server host name Server port number Server protocol Name and version of the server software\n\nSERVER_SOFTWARE\n\nAs output, a CGI program writes to standard output sys.stdout.The gory details of CGI programming can be found in a book such as CGI Programming with Perl, 2nd Edition, by Shishir Gundavaram (O’Reilly & Associates, 2000). For our purposes, there are really only two things to know. First, the contents of an HTML form are passed to a CGI program in a sequence of text known as a query string. In Python, the contents of the query string are accessed using the FieldStorage class. For example:\n\nimport cgi form = cgi.FieldStorage() name = form.getvalue('name') # Get 'name' field from a form email = form.getvalue('email') # Get 'email' field from a form\n\nSecond, the output of a CGI program consists of two parts: an HTTP header and the raw data (which is typically HTML).A blank line always separates these two compo- nents.A simple HTTP header looks like this:\n\nprint 'Content-type: text/html\\r' # HTML Output print '\\r' # Blank line (required!)\n\nThe rest of the output is the raw output. For example:\n\nprint '<TITLE>My CGI Script</TITLE>' print '<H1>Hello World!</H1>' print 'You are %s (%s)' % (name, email)\n\nIt is standard practice that HTTP headers are terminated using the Windows line- ending convention of '\\r\\n'.That is why the '\\r' appears in the example. If you need to signal an error, include a special 'Status:' header in the output. For example:\n\nprint 'Status: 401 Forbidden\\r' # HTTP Error code print 'Content-type: text/plain\\r' print '\\r' # Blank line (required) print 'You're not worthy of accessing this page!'\n\nIf you need to redirect the client to a different page, create output like this:\n\nprint 'Status: 302 Moved\\r' print 'Location: http://www.foo.com/orderconfirm.html\\r' print '\\r'\n\nMost of the work in the cgi module is performed by creating an instance of the FieldStorage class.\n\nFieldStorage([input [, headers [, outerboundary [, environ [, keep_blank_values [, strict_parsing]]]]]])\n\nRead the contents of a form by reading and parsing the query string passed in an envi- ronment variable or standard input. inputspecifies a file-like object from which form\n\nF h Lib f L Bdff",
      "content_length": 2464,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 560,
      "content": "cgi\n\n535\n\ndata will be read in a POST request. By default, sys.stdin is used. headersand outerboundaryare used internally and should not be given. environis a dictionary from which CGI environment variables are read. keep_blank_valuesis a Boolean flag that controls whether blank values are retained or not. By default, it is False. strict_parsingis a Boolean flag that causes an exception to be raised if there is any kind of parsing problem. By default, it is False.\n\nA FieldStorage instance formworks similarly to a dictionary. For example, f = form[key] will extract an entry for a given parameter key.An instance fextracted in this manner is either another instance of FieldStorage or an instance of MiniFieldStorage.The following attributes are defined on f:\n\nAttribute f.name f.filename\n\nf.value\n\nf.file\n\nf.type\n\nf.type_options\n\nf.disposition\n\nf.disposition_options\n\nf.headers\n\nDescription The field name, if specified Client-side filename used in uploads Value as a string File-like object from which data can be read Content type Dictionary of options specified on the content-type line of the HTTP request The 'content-disposition' field; None if not speci- fied Dictionary of disposition options A dictionary-like object containing all the HTTP header contents\n\nValues from a form can be extracted using the following methods:\n\nform.getvalue(fieldname [, default])\n\nReturns the value of a given field with the name fieldname. If a field is defined twice, this function will return a list of all values defined. If defaultis supplied, it specifies the value to return if the field is not present. One caution with this method is that if the same form field name is included twice in the request, the returned value will be a list containing both values.To simplify programming, you can use form.getfirst(), which simply returns the first value found.\n\nform.getfirst(fieldname [, default])\n\nReturns the first value defined for a field with the name fieldname. If defaultis sup- plied, it specifies the value to return if the field is not present.\n\nform.getlist(fieldname)\n\nReturns a list of all values defined for fieldname. It always returns a list, even if only one value is defined, and returns an empty list if no values exist.\n\nIn addition, the cgi module defines a class, MiniFieldStorage, that contains only the attribute’s name and value.This class is used to represent individual fields of a form passed in the query string, whereas FieldStorage is used to contain multiple fields and multipart data.\n\nF h Lib f L Bdff",
      "content_length": 2536,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 561,
      "content": "536\n\nChapter 23 Web Programming\n\nInstances of FieldStorage are accessed like a Python dictionary, where the keys are\n\nthe field names on the form.When accessed in this manner, the objects returned are themselves an instance of FieldStorage for multipart data (content type is 'multipart/form-data') or file uploads, an instance of MiniFieldStorage for sim- ple fields (content type is 'application/x-www-form-urlencoded'), or a list of such instances in cases where a form contains multiple fields with the same name. For example:\n\nform = cgi.FieldStorage() if \"name\" not in form:\n\nerror(\"Name is missing\") return\n\nname = form['name'].value # Get 'name' field from a form email = form['email'].value # Get 'email' field from a form\n\nIf a field represents an uploaded file, accessing the value attribute reads the entire file into memory as a byte string. Because this may consume a large amount of memory on the server, it may be preferable to read uploaded data in smaller pieces by reading from the file attribute directly. For instance, the following example reads uploaded data line by line:\n\nfileitem = form['userfile'] if fileitem.file:\n\n# It's an uploaded file; count lines linecount = 0 while True:\n\nline = fileitem.file.readline() if not line: break linecount = linecount + 1\n\nThe following utility functions are often used in CGI scripts:\n\nescape(s [, quote])\n\nConverts the characters '&', '<', and '>' in string sto HTML-safe sequences such as '&amp;', '&lt;', and '&gt;'. If the optional flag quoteis true, the double-quote character (\") is also translated to '&quot;'.\n\nparse_header(string)\n\nParses the data supplied after an HTTP header field such as 'content-type'.The data is split into a primary value and a dictionary of secondary parameters that are returned in a tuple. For example, the command\n\nparse_header('text/html; a=hello; b=\"world\"')\n\nreturns this result:\n\n('text/html', {'a':'hello', 'b':'world'}). parse_multipart(fp, pdict)\n\nparse_multipart(fp,pdict)\n\nParses input of type 'multipart/form-data' as is commonly used with file uploads. fpis the input file, and pdictis a dictionary containing parameters of the content-type header. It returns a dictionary mapping field names to lists of values.This function doesn’t work with nested multipart data.The FieldStorage class should be used instead.\n\nF h Lib f L Bdff",
      "content_length": 2342,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 562,
      "content": "cgi\n\n537\n\nprint_directory()\n\nFormats the name of the current working directory in HTML and prints it out.The resulting output will be sent back to the browser, which can be useful for debugging.\n\nprint_environ()\n\nCreates a list of all environment variables formatted in HTML and is used for debug- ging.\n\nprint_environ_usage()\n\nPrints a more selected list of useful environment variables in HTML and is used for debugging.\n\nprint_form(form)\n\nFormats the data supplied on a form in HTML. formmust be an instance of FieldStorage. Used for debugging.\n\ntest()\n\nWrites a minimal HTTP header and prints all the information provided to the script in HTML format. Primarily used for debugging to make sure your CGI environment is set up correctly.\n\nCGI Programming Advice In the current age of web frameworks, CGI scripting seems to have fallen out of fash- ion. However, if you are going to use it, there are a couple of programming tips that can simplify your life.\n\nFirst, don’t write CGI scripts where you are using a huge number of print state- ments to produce hard-coded HTML output.The resulting program will be a horrible tangled mess of Python and HTML that is not only impossible to read, but also impos- sible to maintain.A better approach is to rely on templates. Minimally, the string.Template object can be used for this. Here is an example that outlines the concept:\n\nimport cgi from string import Template\n\ndef error(message):\n\ntemp = Template(open(\"errormsg.html\").read()) print 'Content-type: text/html\\r' print '\\r' print temp.substitute({'message' : message})\n\nform = cgi.FieldStorage() name = form.getfirst('name') email = form.getfirst('email') if not name:\n\nerror(\"name not specified\") raise SystemExit\n\nelif not email:\n\nerror(\"email not specified\") raise SystemExit\n\n# Do various processing confirmation = subscribe(name, email)\n\nF h Lib f L Bdff",
      "content_length": 1863,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 563,
      "content": "538\n\nChapter 23 Web Programming\n\n# Print the output page values = {\n\n'name' : name, 'email' : email, 'confirmation: ': confirmation, # Add other values here...\n\n} temp = Template(open(\"success.html\").read() print temp.substitute(values)\n\nIn this example, the files 'error.html' and 'success.html' are HTML pages that have all of the output but include $variablesubstitutions corresponding to dynami- cally generated values used in the CGI script. For example, the 'success.html' file might look like this:\n\n<HTML>\n\n<HEAD>\n\n<TITLE>Success</TITLE>\n\n</HEAD> <BODY> Welcome $name. You have successfully subscribed to our newsletter. Your confirmation code is $confirmation. </BODY>\n\n</HTML>\n\nThe temp.substitute() operation in the script is simply filling in the variables in this file.An obvious benefit of this approach is that if you want to change the appearance of the output, you just modify the template files, not the CGI script.There are many third- party template engines available for Python—maybe in even greater numbers than web frameworks.These take the templating concept and build upon it in substantial ways. See http://wiki.python.org/moin/Templating more details.\n\nSecond, if you need to save data from a CGI script, try to use a database.Although it is easy enough to write data directly to files, webservers operate concurrently, and unless you’ve taken steps to properly lock and synchronize resources, it is possible that files will get corrupted. Database servers and their associated Python interface usually don’t have this problem. So if you need to save data, try to use a module such as sqlite3 or a third-party module for something like MySQL.\n\nFinally, if you find yourself writing dozens of CGI scripts and code that has to deal with low-level details of HTTP such as cookies, authentication, encoding, and so forth, you may want to consider a web framework instead.The whole point of using a frame- work is so that you don’t have to worry about those details—well, at least not as much. So, don’t reinvent the wheel.\n\nNotes\n\nn The process of installing a CGI program varies widely according to the type of\n\nwebserver being used.Typically programs are placed in a special cgi-bin directo- ry.A server may also require additional configuration.You should consult the doc- umentation for the server or the server’s administrator for more details.\n\nF h Lib f L Bdff",
      "content_length": 2390,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 564,
      "content": "cgitb\n\n539\n\nn On UNIX, Python CGI programs may require appropriate execute permissions\n\nto be set and a line such as the following to appear as the first line of the program:\n\n#!/usr/bin/env python import cgi ...\n\nn To simplify debugging, import the cgitb module—for example, import cgitb; cgitb.enable().This modifies exception handling so that errors are displayed in the web browser.\n\nn If you invoke an external program—for example, via the os.system() or\n\nos.popen() function—be careful not to pass arbitrary strings received from the client to the shell.This is a well-known security hole that hackers can use to exe- cute arbitrary shell commands on the server (because the command passed to these functions is first interpreted by the UNIX shell as opposed to being execut- ed directly). In particular, never pass any part of a URL or form data to a shell command unless it has first been thoroughly checked by making sure that the string contains only alphanumeric characters, dashes, underscores, and periods. n On UNIX, don’t give a CGI program setuid mode.This is a security liability\n\nand not supported on all machines.\n\nn Don’t use 'from cgi import *' with this module.The cgi module defines a wide variety of names and symbols that you probably don’t want in your name- space.\n\ncgitb This module provides an alternative exception handler that displays a detailed report whenever an uncaught exception occurs.The report contains source code, values of parameters, and local variables. Originally, this module was developed to help debug CGI scripts, but it can be used in any application.\n\nenable([display [, logdir [, context [, format]]]])\n\nEnables special exception handling. displayis a flag that determines whether any information is displayed when an error occurs.The default value is 1. logdirspecifies a directory in which error reports will be written to files instead of printed to standard output.When logdiris given, each error report is written to a unique file created by the tempfile.mkstemp() function. contextis an integer specifying the number of lines of source code to display around lines upon which the exception occurred. formatis a string that specifies the output format.A format of 'html' specifies HTML (the default).Any other value results in plain-text format.\n\nhandle([info])\n\nHandles an exception using the default settings of the enable() function. infois a tuple (exctype, excvalue, tb)where exctypeis an exception type, excvalueis an exception value, and tbis a traceback object.This tuple is normally obtained using sys.exc_info(). If infois omitted, the current exception is used.\n\nF h Lib f L Bdff",
      "content_length": 2648,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 565,
      "content": "540\n\nChapter 23 Web Programming\n\nNote\n\nTo enable special exception handling in CGI scripts, include the line import cgitb; enable() at the beginning of the script.\n\nwsgiref WSGI (Python Web Server Gateway Interface) is a standardized interface between web- servers and web applications that is designed to promote portability of applications across different webservers and frameworks.An official description of the standard is found in PEP 333 (http://www.python.org/dev/peps/pep-0333). More information about the standard and its use can also be found at http://www.wsgi.org.The wsgiref package is a reference implementation that can be used for testing, validation, and simple deployments.\n\nThe WSGI Specification With WSGI, a web application is implemented as a function or callable object webapp(environ, start_response) that accepts two arguments. environis a dic- tionary of environment settings that is minimally required to have the following values which have the same meaning and names as is used in CGI scripting:\n\nenvironVariables CONTENT_LENGTH\n\nCONTENT_TYPE\n\nHTTP_ACCEPT\n\nHTTP_COOKIE\n\nHTTP_REFERER\n\nHTTP_USER_AGENT\n\nPATH_INFO\n\nQUERY_STRING\n\nREQUEST_METHOD\n\nSCRIPT_NAME\n\nSERVER_NAME\n\nSERVER_PORT\n\nDescription Length of data passed Type of query data MIME types accepted by the client Netscape persistent cookie value Referring URL Client browser Extra path information passed Query string Method ('GET' or 'POST') Name of the program Server host name Server port number Server protocol\n\nSERVER_PROTOCOL\n\nIn addition, the environdictionary is required to contain the following WSGI-specific values:\n\nenviron Variables wsgi.version\n\nwsgi.url_scheme\n\nwsgi.input\n\nwsgi.errors\n\nDescription Tuple representing the WSGI version (e.g., (1,0) for WSGI 1.0). String representing the scheme component of the URL. For example, 'http' or 'https'. A file-like object representing the input stream. Additional data such as form data or uploads are read from this. A file-like object opened in text mode for writing error output.\n\nF h Lib f L Bdff",
      "content_length": 2045,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 566,
      "content": "wsgiref\n\n541\n\nenviron Variables wsgi.multithread\n\nDescription A Boolean flag that’s True if the application can be executed concurrently by another thread in the same process.\n\nwsgi.multiprocess A Boolean flag that’s True if the application can be executed\n\nwsgi.run_once\n\nconcurrently by another process. A Boolean flag that’s True if the application will only be exe- cuted once during the lifetime of the executing process.\n\nThe start_responseparameter is a callable object of the form start_response(status, headers) that is used by the application to start a response. statusis a string such as '200 OK' or '404 Not Found'. headersis a list of tuples, each of the form (name, value) corresponding to a HTTP header to be included in the response—for example, ('Content-type','text/html').\n\nThe data or body of a response is returned by the web application function as an iterable object that produces a sequence of byte strings or text strings that only contain characters which can be encoded as a single byte (e.g., compatible with the ISO-8859-1 or Latin-1 character set). Examples include a list of byte strings or a generator function producing byte strings. If an application needs to do any kind of character encoding such as UTF-8, it must do this itself.\n\nHere is an example of a simple WSGI application that reads form fields and produces\n\nsome output, similar to what was shown in the cgi module section:\n\nimport cgi def subscribe_app(environ, start_response):\n\nfields = cgi.FieldStorage(environ['wsgi.input'],\n\nenviron=environ)\n\nname = fields.getvalue(\"name\") email = fields.getvalue(\"email\")\n\n# Various processing\n\nstatus = \"200 OK\" headers = [('Content-type','text/plain')] start_response(status, headers)\n\nresponse = [\n\n'Hi %s. Thank you for subscribing.' % name, 'You should expect a response soon.' ]\n\nreturn (line.encode('utf-8') for line in response)\n\nThere are a few critical details in this example. First,WSGI application components are not tied to specific framework, webserver, or set of library modules. In the example, we’re only using one library module, cgi, simply because it has some convenience functions for parsing query variables.The example shows how the start_response() function is used to initiate a response and supply headers.The response itself is con- structed as a list of strings.The final statement in this application is a generator expres- sion that turns all strings into byte strings. If you’re using Python 3, this is a critical step—all WSGI applications are expected to return encoded bytes, not unencoded Unicode data.\n\nTo deploy a WSGI application, it has to be registered with the web programming\n\nframework you happen to be using. For this, you’ll have to read the manual.\n\nF h Lib f L Bdff",
      "content_length": 2750,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 567,
      "content": "542\n\nChapter 23 Web Programming\n\nwsgiref Package The wsgiref package provides a reference implementation of the WSGI standard that allows applications to be tested in stand-alone servers or executed as normal CGI scripts.\n\nwsgiref.simple_server The wsgiref.simple_server module implements a simple stand-alone HTTP server that runs a single WSGI application.There are just two functions of interest:\n\nmake_server(host, port, app)\n\nCreates an HTTP server that accepts connections on the given host name hostand port number port. appis a function or callable object that implements a WSGI appli- cation.To run the server, use s.serve_forever() where sis an instance of the server that is returned.\n\ndemo_app(environ, start_response)\n\nA complete WSGI application that returns a page with a “Hello World” message on it. This can be used as the appargument to make_server() to verify that the server is working correctly.\n\nHere is an example of running a simple WSGI server:\n\ndef my_app(environ, start_response):\n\n# Some application start_response(\"200 OK\",[('Content-type','text/plain')]) return ['Hello World']\n\nif __name__ == '__main__':\n\nfrom wsgiref.simple_server import make_server serv = make_server('',8080, my_app) serv.serve_forever()\n\nwsgiref.handlers The wsgiref.handlers module contains handler objects for setting up a WSGI exe- cution environment so that applications can run within another webserver (e.g., CGI scripting under Apache).There are few different objects.\n\nCGIHandler()\n\nCreates a WSGI handler object that runs inside a standard CGI environment.This han- dler collects information from the standard environment variables and I/O streams as described in the cgi library module.\n\nBaseCGIHandler(stdin, stdout, stderr, environ [, multithread [, multiprocess]])\n\nCreates a WSGI handler that operates within a CGI environment, but where the stan- dard I/O streams and environment variables might be set up in a different way. stdin, stdout, and stderrspecify file-like objects for the standard I/O streams. environis a dictionary of environment variables that is expected to already contain the standard CGI environment variables. multithreadand multiprocessare Boolean flags that are used to set the wsgi.multithread and wsgi.multiprocess environment vari- ables. By default, multithreadis True and multiprocessis False.\n\nF h Lib f L Bdff",
      "content_length": 2357,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 568,
      "content": "wsgiref\n\n543\n\nSimpleHandler(stdin, stdout, stderr, environ [, multithread [, multiprocess]])\n\nCreates a WSGI handler that is similar to BaseCGIHandler, but which gives the under- lying application direct access to stdin, stdout, stderr, and environ.This is slightly different than BaseCGIHandler that provides extra logic to process certain features cor- rectly (e.g., in BaseCGIHandler, response codes are translated into Status: headers). All of these handlers have a method run(app) that is used to run a WSGI applica- tion within the handler. Here is an example of a WSGI application running as a tradi- tional CGI script:\n\n#!/usr/bin/env python def my_app(environ, start_response):\n\n# Some application start_response(\"200 OK\",[('Content-type','text/plain')]) return ['Hello World']\n\nfrom wgiref.handlers import CGIHandler hand = CGIHandler() hand.run(my_app)\n\nwsgiref.validate The wsgiref.validate module has a function that wraps a WSGI application with a validation wrapper to ensure that both it and the server are operating according to the standard.\n\nvalidator(app)\n\nCreates a new WSGI application that wraps the WSGI application app.The new appli- cation transparently works in the same way as appexcept that extensive error-checking is added to make sure the application and the server are following the WSGI standard. Any violation results in an AssertionError exception.\n\nHere is an example of using the validator:\n\ndef my_app(environ, start_response):\n\n# Some application start_response(\"200 OK\",[('Content-type','text/plain')]) return ['Hello World']\n\nif __name__ == '__main__':\n\nfrom wsgiref.simple_server import make_server from wsgiref.validate import validator serv = make_server('',8080, validator(my_app)) serv.serve_forever()\n\nNote\n\nThe material in this section is primarily aimed at users of WSGI who want to create application objects. If, on the other hand, you are implementing yet another web frame- work for Python, you should consult PEP 333 for official details on precisely what is needed to make your framework support WSGI. If you are using a third-party web frame- work, you will need to consult the framework documentation for details concerning its support for WSGI objects. Given that WSGI is an officially blessed specification with a reference implementation in the standard library, it is increasingly common for frame- works to provide some level of support for it.\n\nF h Lib f L Bdff",
      "content_length": 2425,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 569,
      "content": "544\n\nChapter 23 Web Programming\n\nwebbrowser The webbrowser module provides utility functions for opening documents in a web browser in a platform-independent manner.The main use of this module is in develop- ment and testing situations. For example, if you wrote a script that generated HTML output, you could use the functions in this module to automatically direct your system’s browser to view the results.\n\nopen(url [, new [, autoraise]])\n\nDisplays urlwith the default browser on the system. If newis 0, the URL is opened in the same window as a running browser, if possible. If newis 1, a new browser window is created. If new is 2, the URL is opened within a new tab within the browser. If autoraiseis True, the browser window is raised.\n\nopen_new(url)\n\nDisplays urlin a new window of the default browser.The same as open(url, 1).\n\nopen_new_tab(url)\n\nDisplays urlin a new tab of the default browser.The same as open(url, 2).\n\nget([name])\n\nReturns a controller object for manipulating a browser. nameis the name of the brows- er type and is typically a string such as 'netscape', 'mozilla', 'kfm', 'grail', 'windows-default', 'internet-config', or 'command-line'.The returned con- troller object has methods open() and open_new() that accept the same arguments and perform the same operation as the two previous functions. If nameis omitted, a controller object for the default browser is returned.\n\nregister(name, constructor[, controller])\n\nRegisters a new browser type for use with the get() function. nameis the name of the browser. constructoris called without arguments to create a controller object for opening pages in the browser. controlleris a controller instance to use instead. If sup- plied, constructoris ignored and may be None.\n\nA controller instance, c, returned by the get() function has the following methods:\n\nc.open(url[, new])\n\nSame as the open() function.\n\nc.open_new(url)\n\nSame as the open_new() function.\n\nF h Lib f L Bdff",
      "content_length": 1953,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 570,
      "content": "24\n\nInternet Data Handling and Encoding\n\nThis chapter describes modules related to processing common Internet data formats\n\nand encodings such as base 64, HTML, XML, and JSON.\n\nbase64 The base64 module is used to encode and decode binary data into text using base 64, base 32, or base 16 encoding. Base 64 is commonly used to embed binary data in mail attachments and with parts of the HTTP protocol. Official details can be found in RFC-3548 and RFC-1421.\n\nBase 64 encoding works by grouping the data to be encoded into groups of 24 bits (3 bytes). Each 24-bit group is then subdivided into four 6-bit components. Each 6-bit value is then represented by a printable ASCII character from the following alphabet:\n\nValue 0–25 26–51 52–61 62 63 pad\n\nEncoding ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz 0123456789 + / =\n\nIf the number of bytes in the input stream is not a multiple of 3 (24 bits), the data is padded to form a complete 24-bit group.The extra padding is then indicated by special '=' characters that appear at the end of the encoding. For example, if you encode a 16- byte character sequence, there are five 3-byte groups with 1 byte left over.The remain- ing byte is padded to form a 3-byte group.This group then produces two characters from the base 64 alphabet (the first 12 bits, which include 8 bits of real data), followed by the sequence '==', representing the bits of extra padding.A valid base 64 encoding will only have zero, one (=), or two (==) padding characters at the end of the encod- ing.\n\nF h Lib f L Bdff",
      "content_length": 1546,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 571,
      "content": "546\n\nChapter 24 Internet Data Handling and Encoding\n\nBase 32 encoding works by grouping binary data into groups of 40 bits (5 bytes). Each 40-bit group is subdivided into eight 5-bit components. Each 5-bit value is then encoded using the following alphabet:\n\nValue 0–25 26–31\n\nEncoding ABCDEFGHIJKLMNOPQRSTUVWXYZ 2–7\n\nAs with base 64, if the end of the input stream does not form a 40-bit group, it is padded to 40 bits and the '=' character is used to represent the extra padding in the output.At most, there will be six padding characters ('======'), which occurs if the final group only includes 1 byte of data.\n\nBase 16 encoding is the standard hexadecimal encoding of data. Each 4-bit group is represented by the digits '0'–'9' and the letters 'A'–'F'.There is no extra padding or pad characters for base 16 encoding.\n\nb64encode(s [, altchars])\n\nEncodes a byte string susing base 64 encoding. altchars, if given, is a two-character string that specifies alternative characters to use for '+' and '/' characters that normal- ly appear in base 64 output.This is useful if base 64 encoding is being used with file- names or URLs.\n\nb64decode(s [, altchars])\n\nDecodes string s, which is encoded as base 64 and returns a byte string with the decoded data. altchars, if given, is a two-character string that specifies the alternative characters for '+' and '/' that normally appear in base 64–encoded data. TypeError is raised if the input scontains extraneous characters or is incorrectly padded.\n\nstandard_b64encode(s)\n\nEncodes a byte string susing the standard base 64 encoding.\n\nstandard_b64decode(s)\n\nDecodes string susing standard base 64 encoding.\n\nurlsafe_b64encode(s)\n\nEncodes a byte string susing base 64 but uses the characters '-' and '_' instead of '+' and '/', respectively.The same as b64encode(s, '-_').\n\nurlsafe_b64decode(s)\n\nDecodes string sencoded with a URL-safe base 64 encoding.\n\nb32encode(s)\n\nEncodes a byte string susing base 32 encoding.\n\nb32decode(s [, casefold [, map01]])\n\nDecodes string susing base 32 encoding. If casefoldis True, both uppercase and lowercase letters are accepted. Otherwise, only uppercase letters may appear (the default). map01, if present, specifies which letter the digit 1 maps to (for example, the letter 'I' or the letter 'L'). If this argument is given, the digit '0' is also mapped to\n\nF h Lib f L Bdff",
      "content_length": 2357,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 572,
      "content": "binascii\n\n547\n\nthe letter 'O'.A TypeError is raised if the input string contains extraneous characters or is incorrectly padded.\n\nb16encode(s)\n\nEncodes a byte string susing base 16 (hex) encoding.\n\nb16decode(s [,casefold])\n\nDecodes string susing base 16 (hex) encoding. If casefoldis True, letters may be uppercase or lowercase. Otherwise, hexadecimal letters 'A'–'F' must be uppercase (the default). Raises TypeError if the input string contains extraneous characters or is mal- formed in any way.\n\nThe following functions are part of an older base 64 module interface that you may\n\nsee used in existing Python code:\n\ndecode(input, output)\n\nDecodes base 64–encoded data. inputis a filename or a file object open for reading. outputis a filename or a file object open for writing in binary mode.\n\ndecodestring(s)\n\nDecodes a base 64–encoded string, s. Returns a string containing the decoded binary data.\n\nencode(input, output)\n\nEncodes data using base 64. inputis a filename or a file object open for reading in binary mode. outputis a filename or a file object open for writing.\n\nencodestring(s)\n\nEncodes a byte string, s, using base 64.\n\nbinascii The binascii module contains low-level functions for converting data between binary and a variety of ASCII encodings, such as base 64, BinHex, and UUencoding.\n\na2b_uu(s)\n\nConverts a line of uuencoded text sto binary and returns a byte string. Lines normally contain 45 (binary) bytes, except for the last line that may be less. Line data may be fol- lowed by whitespace.\n\nb2a_uu(data)\n\nConverts a string of binary data to a line of uuencoded ASCII characters.The length of datashould not be more than 45 bytes. Otherwise, the Error exception is raised.\n\na2b_base64(string)\n\nConverts a string of base 64–encoded text to binary and returns a byte string.\n\nb2a_base64(data)\n\nConverts a string of binary data to a line of base 64–encoded ASCII characters.The length of datashould not be more than 57 bytes if the resulting output is to be trans- mitted through email (otherwise it might get truncated).\n\nF h Lib f L Bdff",
      "content_length": 2065,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 573,
      "content": "548\n\nChapter 24 Internet Data Handling and Encoding\n\na2b_hex(string)\n\nConverts a string of hexadecimal digits to binary data.This function is also called as unhexlify(string).\n\nb2a_hex(data)\n\nConverts a string of binary data to a hexadecimal encoding.This function is also called as hexlify(data).\n\na2b_hqx(string)\n\nConverts a string of BinHex 4–encoded data to binary without performing RLE (Run- Length Encoding) decompression.\n\nrledecode_hqx(data)\n\nPerforms an RLE decompression of the binary data in data. Returns the decompressed data unless the data input is incomplete, in which case the Incomplete exception is raised.\n\nrlecode_hqx(data)\n\nPerforms a BinHex 4 RLE compression of data.\n\nb2a_hqx(data)\n\nConverts the binary data to a string of BinHex 4–encoded ASCII characters. data should already be RLE-coded.Also, unless datais the last data fragment, the length of datashould be divisible by 3.\n\ncrc_hqx(data, crc)\n\nComputes the BinHex 4 CRC checksum of the byte string data. crcis a starting value of the checksum.\n\ncrc32(data [, crc])\n\nComputes the CRC-32 checksum of the byte string data. crcis an optional initial CRC value. If omitted, crcdefaults to 0.\n\ncsv The csv module is used to read and write files consisting of comma-separated values (CSV).A CSV file consists of rows of text, each row consisting of values separated by a delimiter character, typically a comma (,) or a tab. Here’s an example:\n\nBlues,Elwood,\"1060 W Addison\",\"Chicago, IL 60613\",\"B263-1655-2187\",116,56\n\nVariants of this format commonly occur when working with databases and spreadsheets. For instance, a database might export tables in CSV format, allowing the tables to be read by other programs. Subtle complexities arise when fields contain the delimiter character. For instance, in the preceding example, one of the fields contains a comma and must be placed in quotes.This is why using basic string operations such as split(',') are often not enough to work with such files.\n\nF h Lib f L Bdff",
      "content_length": 1987,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 574,
      "content": "csv\n\n549\n\nreader(csvfile [, dialect [, **fmtparams])\n\nReturns a reader object that produces the values for each line of input of the input file csvfile. csvfileis any iterable object that produces a complete line of text on each iteration.The returned reader object is an iterator that produces a list of strings on each iteration.The dialectparameter is either a string containing the name of a dialect or a Dialect object.The purpose of the dialectparameter is to account for differences between different CSV encodings.The only built-in dialects supported by this module are 'excel' (which is the default value) and 'excel-tab', but others can be defined by the user as described later in this section. fmtparamsis a set of keyword arguments that customize various aspects of the dialect.The following keyword arguments can be given:\n\nKeyword Argument delimiter\n\ndoublequote\n\nescapechar\n\nlineterminator\n\nquotechar\n\nskipinitialspace\n\nDescription Character used to separate fields (the default is ','). Boolean flag that determines how the quote character (quotechar) is handled when it appears in a field. If True, the character is simply doubled. If False, an escape character (escapechar) is used as a prefix. The default is True. Character used as an escape character when the delimiter appears in a field and quoting is QUOTE_NONE. The default value is None. Line termination sequence ('\\r\\n' is the default). Character used to quote fields that contain the delimiter ('\"' is the default). If True, whitespace immediately following the delimiter is ignored (False is the default).\n\nwriter(csvfile [, dialect [, **fmtparam]])\n\nReturns a writer object that can be used to create a CSV file. csvfileis any file-like object that supports a write() method. dialecthas the same meaning as for reader() and is used to handle differences between various CSV encodings. fmt- paramshas the same meaning as for readers. However, one additional keyword argu- ment is available:\n\nKeyword Argument quoting\n\nDescription Controls the quoting behavior of output data. It’s set to one of QUOTE_ALL (quotes all fields), QUOTE_MINIMAL (only quote fields that contain the delimiter or start with the quote charac- ter), QUOTE_NONNUMERIC (quote all nonnumeric fields), or QUOTE_NONE (never quote fields). The default value is QUOTE_MINIMAL.\n\nA writer instance, w, supports the following methods:\n\nw.writerow(row)\n\nWrites a single row of data to the file. rowmust be a sequence of strings or numbers.\n\nF h Lib f L Bdff",
      "content_length": 2501,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 575,
      "content": "550\n\nChapter 24 Internet Data Handling and Encoding\n\nw.writerows(rows)\n\nWrites multiple rows of data. rowsmust be a sequence of rows as passed to the writerow() method.\n\nDictReader(csvfile [, fieldnames [, restkey [, restval [, dialect [, ➥**fmtparams]]]]])\n\nReturns a reader object that operates like the ordinary reader but returns dictionary objects instead of lists of strings when reading the file. fieldnamesprovides a list of field names used as keys in the returned dictionary. If omitted, the dictionary key names are taken from the first row of the input file. restkeyprovides the name of a diction- ary key that’s used to store excess data—for instance, if a row has more data fields than field names. restvalis a default value that’s used as the value for fields that are missing from the input—for instance, if a row does not have enough fields.The default value of restkeyand restvalis None. dialectand fmtparamshave the same meaning as for reader().\n\nDictWriter(csvfile, fieldnames [, restval [, extrasaction [, dialect [, ➥**fmtparams]]]])\n\nReturns a writer object that operates like the ordinary writer but writes dictionaries into output rows. fieldnamesspecifies the order and names of attributes that will be written to the file. restvalis the value that’s written if the dictionary being written is missing one of the field names in fieldnames. extrasactionis a string that specifies what to do if a dictionary being written has keys not listed in fieldnames.The default value of extrasactionis 'raise', which raises a ValueError exception.A value of 'ignore' may be used, in which case extra values in the dictionary are ignored. dialectand fmtparamshave the same meaning as with writer().\n\nA DictWriter instance, w, supports the following methods:\n\nw.writerow(row)\n\nWrites a single row of data to the file. rowmust be a dictionary that maps field names to values.\n\nw.writerows(rows)\n\nWrites multiple rows of data. rowsmust be a sequence of rows as passed to the writerow() method.\n\nSniffer()\n\nCreates a Sniffer object that is used to try and automatically detect the format of a CSV file.\n\nA Sniffer instance, s, has the following methods:\n\ns.sniff(sample [, delimiters])\n\nLooks at data in sampleand returns an appropriate Dialect object representing the data format. sampleis a portion of a CSV file containing at least one row of data. delimiters, if supplied, is a string containing possible field delimiter characters.\n\ns.has_header(sample)\n\nLooks at the CSV data in sampleand returns True if the first row looks like a collec- tion of column headers.\n\nF h Lib f L Bdff",
      "content_length": 2596,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 576,
      "content": "csv\n\n551\n\nDialects Many of the functions and methods in the csv module involve a special dialect param- eter.The purpose of this parameter is to accommodate different formatting conventions of CSV files (for which there is no official “standard” format)—for example, differences between comma-separated values and tab-delimited values, quoting conventions, and so forth.\n\nDialects are defined by inheriting from the class Dialect and defining the same set of attributes as the formatting parameters given to the reader() and writer() func- tions (delimiter, doublequote, escapechar, lineterminator, quotechar, quoting, skipinitialspace).\n\nThe following utility functions are used to manage dialects:\n\nregister_dialect(name, dialect)\n\nRegisters a new Dialect object, dialect, under the name name.\n\nunregister_dislect(name)\n\nRemoves the Dialect object with name name.\n\nget_dialect(name)\n\nReturns the Dialect object with name name.\n\nlist_dialects()\n\nReturns a list of all registered dialect names. Currently, there are only two built-in dialects: 'excel' and 'excel-tab'.\n\nExample\n\nimport csv # Read a basic CSV file f = open(\"scmods.csv\",\"r\") for r in csv.reader(f):\n\nlastname, firstname, street, city, zip = r print(\"{0} {1} {2} {3} {4}\".format(*r))\n\n# Using a DictReader instead f = open(\"address.csv\") r = csv.DictReader(f,['lastname','firstname','street','city','zip']) for a in r:\n\nprint(\"{firstname} {lastname} {street} {city} {zip}\".format(**a))\n\n# Write a basic CSV file data = [\n\n['Blues','Elwood','1060 W Addison','Chicago','IL','60613' ], ['McGurn','Jack','4802 N Broadway','Chicago','IL','60640' ],\n\n] f = open(\"address.csv\",\"w\") w = csv.writer(f) w.writerows(data) f.close()\n\nF h Lib f L Bdff",
      "content_length": 1703,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 577,
      "content": "552\n\nChapter 24 Internet Data Handling and Encoding\n\nemail Package The email package provides a wide variety of functions and objects for representing, parsing and manipulating email messages encoded according to the MIME standard.\n\nCovering every detail of the email package is not practical here, nor would it be of interest to most readers.Thus, the rest of this section focuses on two common practical problems—parsing email messages in order to extract useful information and creating email messages so that they can be sent using the smtplib module.\n\nParsing Email At the top level, the email module provides two functions for parsing messages:\n\nmessage_from_file(f)\n\nParses an email message read from the file-like object fwhich must be opened in text mode.The input message should be a complete MIME-encoded email message includ- ing all headers, text, and attachments. Returns a Message instance.\n\nmessage_from_string(str)\n\nParses an email message by reading an email message from the text string str. Returns a Message instance.\n\nA Message instance mreturned by the previous functions emulates a dictionary and\n\nsupports the following operations for looking up message data:\n\nOperation m[name]\n\nm.keys()\n\nm.values()\n\nm.items()\n\nDescription Returns the value of header name. Returns a list of all message header names. Returns a list of message header values. Returns a list of tuples containing message header names and values.\n\nm.get(name [,def]) Returns a header value for header name. defspecifies a\n\nlen(m)\n\nstr(m)\n\nname in m\n\ndefault value to return if not found. Returns the number of message headers. Turns the message into a string. The same as the as_string() method. Returns True if nameis the name of a header in the mes- sage.\n\nIn addition to these operators, mhas the following methods that can be used to extract information:\n\nm.get_all(name [, default])\n\nReturns a list of all values for a header with name name. Returns defaultif no such header exists.\n\nm.get_boundary([default])\n\nReturns the boundary parameter found within the 'Content-type' header of a mes- sage.Typically the boundary is a string such as '===============0995017162==' that’s used to separate the different subparts of a message. Returns defaultif no boundary parameter could be found.\n\nF h Lib f L Bdff",
      "content_length": 2299,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 578,
      "content": "email Package\n\n553\n\nm.get_charset()\n\nReturns the character set associated with the message payload (for instance, 'iso-8859-1').\n\nm.get_charsets([default])\n\nReturns a list of all character sets that appear in the message. For multipart messages, the list will represent the character set of each subpart.The character set of each part is taken from 'Content-type' headers that appear in the message. If no character set is specified or the content-type header is missing, the character set for that part is set to the value of default(which is None by default).\n\nm.get_content_charset([default])\n\nReturns the character set from the first 'Content-type' header in the message. If the header is not found or no character set is specified, defaultis returned.\n\nm.get_content_maintype()\n\nReturns the main content type (for example, 'text' or 'multipart').\n\nm.get_content_subtype()\n\nReturns the subcontent type (for example, 'plain' or 'mixed').\n\nm.get_content_type()\n\nReturns a string containing the message content type (for example, 'multipart/mixed' or 'text/plain').\n\nm.get_default_type()\n\nReturns the default content type (for example, 'text/plain' for simple messages).\n\nm.get_filename([default])\n\nReturns the filename parameter from a 'Content-Disposition' header, if any. Returns defaultif the header is missing or does not have a filename parameter.\n\nm.get_param(param [, default [, header [, unquote]]])\n\nEmail headers often have parameters attached to them such as the 'charset' and 'format' parts of the header 'Content-Type: text/plain; charset=\"utf-8\"; format=flowed'.This method returns the value of a specific header parameter. param is a parameter name, defaultis a default value to return if the parameter is not found, headeris the name of the header, and unquotespecifies whether or not to unquote the parameter. If no value is given for header, parameters are taken from the 'Content-type' header.The default value of unquoteis True.The return value is either a string or a 3-tuple (charset, language, value) in the event the parameter was encoded according to RFC-2231 conventions. In this case, charsetis a string such as 'iso-8859-1', languageis a string containing a language code such as 'en', and valueis the parameter value.\n\nm.get_params([default [, header [, unquote]]])\n\nReturns all parameters for headeras a list. defaultspecifies the value to return if the header isn’t found. If headeris omitted, the 'Content-type' header is used. unquote is a flag that specifies whether or not to unquote values (True by default).The contents\n\nF h Lib f L Bdff",
      "content_length": 2576,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 579,
      "content": "554\n\nChapter 24 Internet Data Handling and Encoding\n\nof the returned list are tuples (name, value) where nameis the parameter name and valueis the value as returned by the get_param() method.\n\nm.get_payload([i [, decode]])\n\nReturns the payload of a message. If the message is a simple message, a byte string con- taining the message body is returned. If the message is a multipart message, a list con- taining all the subparts is returned. For multipart messages, ispecifies an optional index in this list. If supplied, only that message component will be returned. If decodeis True, the payload is decoded according to the setting of any 'Content-Transfer-Encoding' header that might be present (for example, 'quoted-printable', 'base64', and so on).To decode the payload of a simple non- multipart message, set ito None and decodeto True or specify decodeusing a key- word argument. It should be emphasized that the payload is returned as a byte string containing the raw content. If the payload represents text encoded in UTF-8 or some other encoding, you will need to use the decode() method on the result to convert it.\n\nm.get_unixfrom()\n\nReturns the UNIX-style 'From ...' line, if any.\n\nm.is_multipart()\n\nReturns True if mis a multipart message.\n\nm.walk()\n\nCreates a generator that iterates over all the subparts of a message, each of which is also represented by a Message instance.The iteration is a depth-first traversal of the message. Typically, this function could be used to process all the components of a multipart mes- sage.\n\nFinally, Message instances have a few attributes that are related to low-level parsing\n\nprocess.\n\nm.preamble\n\nAny text that appears in a multipart message between the blank line that signals the end of the headers and the first occurrence of the multipart boundary string that marks the first subpart of the message.\n\nm.epilogue\n\nAny text in the message that appears after the last multipart boundary string and the end of the message.\n\nm.defects\n\nA list of all message defects found when parsing the message. Consult the online docu- mentation for the email.errors module for further details.\n\nThe following example illustrates how the Message class is used while parsing an email message.The following code reads an email message, prints a short summary of useful headers, prints the plain text portions of the message, and saves any attachments.\n\nimport email import sys\n\nf = open(sys.argv[1],\"r\") # Open message file m = email.message_from_file(f) # Parse message\n\nF h Lib f L Bdff",
      "content_length": 2527,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 580,
      "content": "email Package\n\n555\n\n# Print short summary of sender/recipient print(\"From : %s\" % m[\"from\"]) print(\"To : %s\" % m[\"to\"]) print(\"Subject : %s\" % m[\"subject\"]) print(\"\")\n\nif not m.is_multipart():\n\n# Simple message. Just print the payload payload = m.get_payload(decode=True) charset = m.get_content_charset('iso-8859-1') print(payload.decode(charset))\n\nelse:\n\n# Multipart message. Walk over all subparts and # 1. Print text/plain fragments # 2. Save any attachments for s in m.walk():\n\nfilename = s.get_filename() if filename:\n\nprint(\"Saving attachment: %s\" % filename) data = s.get_payload(decode=True) open(filename,\"wb\").write(data)\n\nelse:\n\nif s.get_content_type() == 'text/plain': payload = s.get_payload(decode=True) charset = s.get_content_charset('iso-8859-1') print(payload.decode(charset))\n\nIn this example, it is important to emphasize that operations that extract the payload of a message always return byte strings. If the payload represents text, you also need to decode it according to some character set.The m.get_content_charset() and payload.decode() operations in the example are carrying out this conversion.\n\nComposing Email To compose an email message, you can either create an empty instance of a Message object, which is defined in the email.message module, or you can use a Message object that was created by parsing an email message (see the previous section).\n\nMessage()\n\nCreates a new message that is initially empty.\n\nAn instance mof Message supports the following methods for populating a message\n\nwith content, headers, and other information.\n\nm.add_header(name, value, **params)\n\nAdds a new message header. nameis the name of the header, valueis the value of the header, and paramsis a set of keyword arguments that supply additional optional parameters. For example, add_header('Foo','Bar',spam='major') adds the header line 'Foo: Bar; spam=\"major\"' to the message.\n\nm.as_string([unixfrom])\n\nConverts the entire message to a string. unixfromis a Boolean flag. If this is set to True, a UNIX-style 'From ...’ line appears as the first line. By default, unixfromis False.\n\nF h Lib f L Bdff",
      "content_length": 2116,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 581,
      "content": "556\n\nChapter 24 Internet Data Handling and Encoding\n\nm.attach(payload)\n\nAdds an attachment to a multipart message. payloadmust be another Message object (for example, email.mime.text.MIMEText). Internally, payloadis appended to a list that keeps track of the different parts of the message. If the message is not a multipart message, use set_payload() to set the body of a message to a simple string.\n\nm.del_param(param [, header [, requote]])\n\nDeletes the parameter paramfrom header header. For example, if a message has the header 'Foo: Bar; spam=\"major\"', del_param('spam','Foo') would delete the 'spam=\"major\"' portion of the header. If requoteis True (the default), all remaining values are quoted when the header is rewritten. If headeris omitted, the operation is applied to the 'Content-type' header.\n\nm.replace_header(name, value)\n\nReplaces the value of the first occurrence of the header namewith value value. Raises KeyError if the header is not found.\n\nm.set_boundary(boundary)\n\nSets the boundary parameter of a message to the string boundary.This string gets added as the boundary parameter to the 'Content-type' header in the message. Raises HeaderParseError if the message has no content-type header.\n\nm.set_charset(charset)\n\nSets the default character set used by a message. charsetmay be a string such as 'iso-8859-1' or 'euc-jp'. Setting a character set normally adds a parameter to the 'Content-type' header of a message (for example, 'Content-type: text/html; charset=\"iso-8859-1\"').\n\nm.set_default_type(ctype)\n\nSets the default message content type to ctype. ctypeis a string containing a MIME type such as 'text/plain’ or 'message/rfc822'.This type is not stored in the 'Content-type' header of the message.\n\nm.set_param(param, value [, header [, requote [, charset [, language]]]])\n\nSets the value of a header parameter. paramis the parameter name, and valueis the parameter value. headerspecifies the name of the header and defaults to 'Content-type'. requotespecifies whether or not to requote all the values in the header after adding the parameter. By default, this is True. charsetand language specify optional character set and language information. If these are supplied, the parameter is encoded according to RFC-2231.This produces parameter text such as param*=\"'iso-8859-1'en-us'some%20value\".\n\nm.set_payload(payload [, charset])\n\nSets the entire message payload to payload. For simple messages, payloadcan be a byte string containing the message body. For multipart messages, payloadis a list of Message objects. charsetoptionally specifies the character set that was used to encode the text (see set_charset).\n\nF h Lib f L Bdff",
      "content_length": 2662,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 582,
      "content": "email Package\n\n557\n\nm.set_type(type [, header [, requote]])\n\nSets the type used in the 'Content-type' header. typeis a string specifying the type, such as 'text/plain' or 'multipart/mixed'. headerspecifies an alternative header other than the default 'Content-type' header. requotequotes the value of any parameters already attached to the header. By default, this is True.\n\nm.set_unixfrom(unixfrom)\n\nSets the text of the UNIX-style 'From ...' line. unixfromis a string containing the complete text including the 'From' text.This text is only output if the unixfrom parameter of m.as_string() is set to True.\n\nRather than creating raw Message objects and building them up from scratch each time, there are a collection of prebuilt message objects corresponding to different types of content.These message objects are especially useful for creating multipart MIME messages. For instance, you would create a new message and attach different parts using the attach() method of Message. Each of these objects is defined in a different sub- module, which is noted in each description.\n\nMIMEApplication(data [, subtype [, encoder [, **params]]])\n\nDefined in email.mime.application. Creates a message containing application data. datais a byte string containing the raw data. subtypespecifies the data subtype and is 'octet-stream' by default. encoderis an optional encoding function from the email.encoders subpackage. By default, data is encoded as base 64. paramsrepresents optional keyword arguments and values that will be added to the 'Content-type' header of the message.\n\nMIMEAudio(data [, subtype [, encoder [, **params]]])\n\nDefined in email.mime.audio. Creates a message containing audio data. datais a byte string containing the raw binary audio data. subtypespecifies the type of the data and is a string such as 'mpeg' or 'wav'. If no subtype is provided, the audio type will be guessed by looking at the data using the sndhdr module. encoderand paramshave the same meaning as for MIMEApplication.\n\nMIMEImage(data [, subtype [, encoder [, **params]]])\n\nDefined in email.mime.image. Creates a message containing image data. datais a byte string containing the raw image data. subtypespecifies the image type and is a string such as 'jpg' or 'png'. If no subtypeis provided, the type will be guessed using a function in the imghdr module. encoderand paramshave the same meaning as for MIMEApplication.\n\nMIMEMessage(msg [, subtype])\n\nDefined in email.mime.message. Creates a new non-multipart MIME message. msgis a message object containing the initial payload of the message. subtypeis the type of the message and defaults to 'rfc822'.\n\nMIMEMultipart([subtype [, boundary [, subparts [, **params]]]])\n\nDefined in email.mime.multipart. Creates a new MIME multipart message. subtypespecifies the optional subtype to be added to the ‘Content-type: multipart/subtype' header. By default, subtypeis 'mixed'. boundaryis a string that specifies the boundary separator used to make each message subpart. If set to None\n\nF h Lib f L Bdff",
      "content_length": 3032,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 583,
      "content": "558\n\nChapter 24 Internet Data Handling and Encoding\n\nor omitted, a suitable boundary is determined automatically. subpartsis a sequence of Message objects that make up the contents of the message. paramsrepresents optional keyword arguments and values that are added to the 'Content-type' header of the message. Once a multipart message has been created, additional subparts can be added using the Message.attach() method.\n\nMIMEText(data [, subtype [, charset]])\n\nDefined in email.mime.text. Creates a message containing textual data. datais a string containing the message payload. subtypespecifies the text type and is a string such as 'plain' (the default) or 'html'. charsetis the character set, which defaults to 'us-ascii'.The message may be encoded depending on the contents of the mes- sage.\n\nThe following example shows how to compose and send an email message using the\n\nclasses in this section:\n\nimport smtplib from email.mime.text import MIMEText from email.mime.multipart import MIMEMultipart from email.mime.audio import MIMEAudio\n\nsender = \"jon@nogodiggydie.net\" receiver= \"dave@dabeaz.com\" subject = \"Faders up!\" body = \"I never should have moved out of Texas. -J.\\n\" audio = \"TexasFuneral.mp3\"\n\nm = MIMEMultipart() m[\"to\"] = receiver m[\"from\"] = sender m[\"subject\"] = subject\n\nm.attach(MIMEText(body)) apart = MIMEAudio(open(audio,\"rb\").read(),\"mpeg\") apart.add_header(\"Content-Disposition\",\"attachment\",filename=audio) m.attach(apart)\n\n# Send the email message s = smtplib.SMTP() s.connect() s.sendmail(sender, [receiver],m.as_string()) s.close()\n\nNotes\n\nn A number of advanced customization and configuration options have not been\n\ndiscussed. Readers should consult the online documentation for advanced uses of this module.\n\nn The email package has gone through at least four different versions, where the\n\nunderlying programming interface has been changed (i.e., submodules renamed, classes moved to different locations, etc.).This section has documented version 4.0 of the interface that is used in both Python 2.6 and Python 3.0. If you are working with legacy code, the basic concepts still apply, but you may have to adjust the locations of classes and submodules.\n\nF h Lib f L Bdff",
      "content_length": 2207,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 584,
      "content": "hmac\n\n559\n\nhashlib The hashlib module implements a variety of secure hash and message digest algo- rithms such as MD5 and SHA1.To compute a hash value, you start by calling one of the following functions, the name of which is the same as represented algorithm:\n\nFunction md5()\n\nsha1()\n\nsha224()\n\nsha256()\n\nsha384() sha512()\n\nDescription MD5 hash (128 bits) SHA1 hash (160 bits) SHA224 hash (224 bits) SHA256 hash (256 bits) SHA384 hash (384 bits) SHA512 hash (512 bits)\n\nAn instance dof the digest object returned by any of these functions has the following interface:\n\nMethod or Attribute Description d.update(data)\n\nUpdates the hash with new data. datamust be a byte string. Repeated calls are the same as a single call with concatenated data. Returns the value of the digest as a raw byte string. Returns a text string with the value of the digest encoded as a series of hex digits. Returns a copy of the digest. The copy preserves the internal state of the original digest. Size of the resulting hash in bytes. Internal block size of the hash algorithm in bytes.\n\nd.digest()\n\nd.hexdigest()\n\nd.copy()\n\nd.digest_size\n\nd.block_size\n\nAn alternative construction interface is also provided by the module:\n\nnew(hashname)\n\nCreates a new digest object. hashnameis a string such as 'md5' or 'sha256' specifying the name of the hashing algorithm to use.The name of the hash can minimally be any of the previous hashing algorithms or a hashing algorithm exposed by the OpenSSL library (which depends on the installation).\n\nhmac The hmac module provides support for HMAC (Keyed-Hashing for Message Authentication), which is described in RFC-2104. HMAC is a mechanism used for message authentication that is built upon cryptographic hashing functions such as MD5 and SHA-1.\n\nnew(key [, msg [, digest]])\n\nCreates a new HMAC object. Here, keyis a byte string containing the starting key for the hash, msgcontains initial data to process, and digestis the digest constructor that should be used for cryptographic hashing. By default, digestis hashlib.md5.\n\nF h Lib f L Bdff",
      "content_length": 2061,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 585,
      "content": "560\n\nChapter 24 Internet Data Handling and Encoding\n\nNormally, the initial key value is determined at random using a cryptographically strong random number generator.\n\nAn HMAC object, h, has the following methods:\n\nh.update(msg)\n\nAdds the string msgto the HMAC object.\n\nh.digest()\n\nReturns the digest of all data processed so far and returns a byte string containing the digest value.The length of the string depends on the underlying hashing function. For MD5, it is 16 characters; for SHA-1, it is 20 characters.\n\nh.hexdigest()\n\nReturns the digest as a string of hexadecimal digits.\n\nh.copy()\n\nMakes a copy of the HMAC object.\n\nExample The primary use of the hmac module is in applications that need to authenticate the sender of a message.To do this, the keyparameter to new() is a byte string representing a secret key known by both the sender and receiver of a message.When sending a mes- sage, the sender will create a new HMAC object with the given key, update the object with message data to be sent, and then send the message data along with the resulting HMAC digest value to the receiver.The receiver can verify the message by computing its own HMAC digest value (using the same key and message data) and comparing the result to the digest value received. Here is an example:\n\nimport hmac secret_key = b\"peekaboo\" # Byte string only known to me. Typically\n\n# you would want to use a string of random bytes # computed using os.urandom() or similar.\n\ndata = b\"Hello World\" # The message to send\n\n# Send the message somewhere. out represents a socket or some # other I/O channel on which we are sending data. h = hmac.new(secret_key) h.update(data) out.send(data) # Send the data out.send(h.digest()) # Send the digest\n\n# Receive the message # in represents a socket or some other I/O channel # out which we are receiving data. h = hmac.new(secret_key) data = in.receive() # Get the message data h.update(data) digest = in.receive() # Get the digest sent by the sender if digest != h.digest():\n\nraise AuthenticationError('Message not authenticated')\n\nF h Lib f L Bdff",
      "content_length": 2075,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 586,
      "content": "HTMLParser\n\n561\n\nHTMLParser In Python 3, this module is called html.parser.The HTMLParser module defines a class HTMLParser that can be used to parse HTML and XHTML documents.To use this module, you define your own class that inherits from HTMLParser and redefines methods as appropriate.\n\nHTMLParser()\n\nThis is a base class that is used to create HTML parsers. It is initialized without any arguments.\n\nAn instance hof HTMLParser has the following methods:\n\nh.close()\n\nCloses the parser and forces the processing of any remaining unparsed data.This method is called after all HTML data has been fed to the parser.\n\nh.feed(data)\n\nSupplies new data to the parser.This data will be immediately parsed. However, if the data is incomplete (for example, it ends with an incomplete HTML element), the incomplete portion will be buffered and parsed the next time feed() is called with more data.\n\nh.getpos()\n\nReturns the current line number and character offset into that line as a tuple (line, offset).\n\nh.get_starttag_text()\n\nReturns the text corresponding to the most recently opened start tag.\n\nh.handle_charref(name)\n\nThis handler method is called whenever a character reference such as '&#ref;' is encountered. nameis a string containing the name of the reference. For example, when parsing '&#229;', namewill be set to '229'.\n\nh.handle_comment(data)\n\nThis handler method is called whenever a comment is encountered. datais a string containing the text of the comment. For example, when parsing the comment '<!--comment-->', datawill contain the text 'comment'.\n\nh.handle_data(data)\n\nThis handler is called to process data that appears between tags. datais a string contain- ing text.\n\nh.handle_decl(decl)\n\nThis handler is called to process declarations such as '<!DOCTYPE HTML ...>'. decl is a string containing the text of the declaration not including the leading '<!' and trailing '>'.\n\nF h Lib f L Bdff",
      "content_length": 1906,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 587,
      "content": "562\n\nChapter 24 Internet Data Handling and Encoding\n\nh.handle_endtag(tag)\n\nThis handler is called whenever end tags are encountered. tagis the name of the tag converted to lowercase. For example, if the end tag is '</BODY>', tagis the string 'body'.\n\nh.handle_entityref(name)\n\nThis handler is called to handle entity references such as '&name;'. nameis a string containing the name of the reference. For example, if parsing '&lt;', namewill be set to 'lt'.\n\nh.handle_pi(data)\n\nThis handler is called to handle processing instructions such as '<?processing instruction>'. datais a string containing the text of the processing instruction not including the leading '<?' or trailing '>'.When called on XHTML-style instructions of the form '<?...?>', the last '?' will be included in data.\n\nh.handle_startendtag(tag, attrs)\n\nThis handler processes XHTML-style empty tags such as '<tag name=\"value\"... />'. tagis a string containing the name of the tag. attrscontains attribute informa- tion and is a list of tuples of the form (name, value) where nameis the attribute name converted to lowercase and valueis the attribute value.When extracting values, quotes and character entities are replaced. For example, if parsing '<a href=\"http://www.foo.com\"/>', tagis 'a' and attrsis [('href','http://www.foo.com')]. If not defined in derived classes, the default implementation of this method simply calls handle_starttag() and handle_endtag().\n\nh.handle_starttag(tag, attrs)\n\nThis handler processes start tags such as '<tag name=\"value\" ...>'. tagand attrs have the same meaning as described for handle_startendtag().\n\nh.reset()\n\nResets the parser, discarding any unprocessed data.\n\nThe following exception is provided:\n\nHTMLParserError\n\nException raised as a result of parsing errors.The exception has three attributes.The msg attribute contains a message describing the error, the lineno attribute is the line number where the parsing error occurred, and the offset attribute is the character off- set into the line.\n\nExample The following example fetches an HTML document using the urllib package and prints all links that have been specified with '<a href=\"...\">' declarations:\n\n# printlinks.py try:\n\nfrom HTMLParser import HTMLParser from urllib2 import urlopen\n\nexcept ImportError:\n\nfrom html.parser import HTMLParser\n\nF h Lib f L Bdff",
      "content_length": 2331,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 588,
      "content": "json\n\n563\n\nfrom urllib.request import urlopen\n\nimport sys\n\nclass PrintLinks(HTMLParser):\n\ndef handle_starttag(self,tag,attrs):\n\nif tag == 'a':\n\nfor name,value in attrs:\n\nif name == 'href': print(value)\n\np = PrintLinks() u = urlopen(sys.argv[1]) data = u.read() charset = u.info().getparam('charset') # Python 2 #charset = u.info().get_content_charset() # Python 3 p.feed(data.decode(charset)) p.close()\n\nIn the example, it must be noted that any HTML fetched using urllib is returned as a byte string.To properly parse it, it must be decoded into text according to the docu- ment character set encoding.The example shows how to obtain this in Python 2 and Python 3.\n\nNote\n\nThe parsing capabilities of HTMLParser tend to be rather limited. In fact, with very com- plicated and/or malformed HTML, the parser can break. Users also find this module to be lower-level than is useful. If you are writing programs that must scrape data from HTML pages, consider the Beautiful Soup package (http://pypi.python.org/ pypi/BeautifulSoup).\n\njson The json module is used to serialize and unserialize objects represented using JavaScript Object Notation (JSON). More information about JSON is available at http://json.org, but the format is really just a subset of JavaScript syntax. Incidentally, it’s almost the same as Python syntax for representing lists and dictionaries. For example, a JSON array is written as [value1, value2, ... ], and a JSON object is written as {name:value, name:value, .... }.\n\nThe following list shows how JSON values and Python values are mapped.The Python types listed in parentheses are accepted when encoding but are not returned when decoding (instead, the first listed type is returned).\n\nJSON Type object\n\narray\n\nstring\n\nnumber\n\ntrue\n\nPython Type dict list (tuple) unicode (str, bytes) int, float True\n\nfalse\n\nFalse\n\nnull\n\nNone\n\nF h Lib f L Bdff",
      "content_length": 1868,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 589,
      "content": "564\n\nChapter 24 Internet Data Handling and Encoding\n\nFor string data, you should assume the use of Unicode. If byte strings are encountered during encoding, they will be decoded into a Unicode string using 'utf-8' by default (although this can be controlled). JSON strings are always returned as Unicode when decoding.\n\nThe following functions are used to encode/decode JSON documents:\n\ndump(obj, f, **opts)\n\nSerializes objto a file-like object f. optsrepresents a collection of keyword arguments that can be specified to control the serialization process:\n\nKeyword Argument skipkeys\n\nensure_ascii\n\ncheck_circular\n\nallow_nan\n\ncls\n\nindent\n\nseparators\n\nencoding\n\ndefault\n\nDescription Boolean flag that controls what to do when dictionary keys (not the values) are not a basic type such as a string or number. If True, the keys are skipped. If False (the default), a TypeError is raised. Boolean flag that determines whether or not Unicode strings can be written to the file f. By default, this is False. Only set this to True if fis a file that correctly handles Unicode, such as a file created by the codecs module or opened with a specific encod- ing set. Boolean flag that determines whether circular references are checked for containers. By default, this is True. If set to False and a circular reference is encountered, an OverflowError exception is raised. Boolean flag that determines whether out-of-range floating-point values are serialized (e.g., NaN, inf, -inf). By default this is True. A subclass of JSONEncoder to use. You would specify this if you created your own custom encoder by inheriting from JSONEncoder. If there are any additional keyword arguments given to dump(), they are passed as arguments to the construc- tor of this class. A non-negative integer that sets the amount indentation to use when printing array and object members. Setting this results in a kind of pretty-printing. By default, it is None, which causes the result to be in the most compact representation. A tuple of the form (item_separator, dict_separator) where item_separatoris a string containing the separator used between array items and dict_separatoris a string con- taining the separator used between dictionary keys and values. By default, the value is (', ', ': '). Encoding to use for Unicode strings—'utf-8' by default. A function used to serialize objects that are not any of the basic supported types. It should either return a value that can be seri- alized (i.e., a string) or raise TypeError. By default, a TypeError is raised for unsupported types.\n\ndumps(obj, **opts)\n\nThe same as dump() except that a string containing the result is returned.\n\nF h Lib f L Bdff",
      "content_length": 2674,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 590,
      "content": "json\n\n565\n\nload(f, **opts)\n\nDeserializes a JSON object on the file-like object fand returns it. optsrepresents a set of keyword arguments that can be specified to control the decoding process and are described next. Be aware that this function calls f.read() to consume the entire con- tents of f. Because of this, it should not be used on any kind of streaming file such as a socket where JSON data might be received as part of a larger or ongoing data stream.\n\nKeyword Argument encoding\n\nstrict\n\ncls\n\nobject_hook\n\nparse_float\n\nparse_int\n\nDescription Encoding used to interpret any of the string values that are decoded. By default, this is 'utf-8'. Boolean flag that determines whether or not literal (unescaped) newlines are allowed to appear in JSON strings. By default, this is True, which means that an exception is generated for such strings. A subclass of JSONDecoder to use for decoding. Only speci- fied if you’ve created a custom decoder by inheriting from JSONDecoder. Any extra keyword arguments to load() are supplied to the class constructor. A function that’s called with the result of every JSON object that is decoded. By default, this is the built-in dict() function. A function that’s called to decode JSON floating-point values. By default, this is the built-in float() function. A function that’s called to decode JSON integer values. By default, this is the built-in int() function. A function that’s called to decode JSON constants such as 'NaN', 'true', 'false', etc.\n\nparse_constant\n\nloads(s, **opts)\n\nThe same as load() except that an object is deserialized from the string s.\n\nAlthough these functions share the same names as functions from the pickle and marshal modules and they serialize data, they are not used in the same way. Specifically, you should not use dump() to write more than one JSON-encoded object to the same file. Similarly, load() cannot be used to read more than one JSON-encoded object from the same file (if the input file has more than one object in it, you’ll get an error). JSON-encoded objects should be treated in the same manner as HTML or XML. For example, you usually don’t take two completely separate XML documents and just con- catenate them together in the same file.\n\nIf you want to customize the encoding or decoding process, inherit from these base\n\nclasses:\n\nJSONDecoder(**opts)\n\nA class that decodes JSON data. optsrepresents a set of keyword arguments that are identical to those used by the load() function.An instance dof JSONDecoder has the following two methods:\n\nd.decode(s)\n\nReturns the Python representation of the JSON object in s. sis a string.\n\nF h Lib f L Bdff",
      "content_length": 2640,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 591,
      "content": "566\n\nChapter 24 Internet Data Handling and Encoding\n\nd.raw_decode(s)\n\nReturns a tuple (pyobj, index) where pyobjis the Python representation of a JSON object in sand indexis the position in swhere the JSON object ended.This can be used if you are trying to parse an object out of an input stream where there is extra data at the end.\n\nJSONEncoder(**opts)\n\nA class that encodes a Python object into JSON. optsrepresents a set of keyword argu- ments that are identical to those used by the dump() function.An instance eof JSONEncoder has the following methods:\n\ne.default(obj)\n\nMethod called when a Python object objcan’t be encoded according to any of the normal encoding rules.The method should return a result which is one of the types that can be encoded (for example, a string, list, or dictionary).\n\ne.encode(obj)\n\nMethod that’s called to create a JSON representation of Python object obj.\n\ne.iterencode(obj)\n\nCreates an iterator that produces the strings making up the JSON representation of Python object objas they are computed.The process of creating a JSON string is high- ly recursive in nature. For instance, it involves iterating over the keys of a dictionary and traversing down into other dictionaries and lists found along the way. If you use this method, you can process the output in a piecemeal manner as opposed to having every- thing collected into a huge in-memory string.\n\nIf you define subclasses that inherit from JSONDecoder or JSONEncoder, you need to exercise caution if your class also defines __init__().To deal with all of the key- word arguments, here is how you should define it:\n\nclass MyJSONDecoder(JSONDecoder):\n\ndef __init__(self, **kwargs): # Get my own arguments foo = kwargs.pop('foo',None) bar = kwargs.pop('bar',None) # Initialize the parent with everything left over JSONDecoder.__init__(self,**kwargs)\n\nmimetypes The mimetypes module is used to guess the MIME type associated with a file, based on its filename extension. It also converts MIME types to their standard filename exten- sions. MIME types consist of a type/subtype pair—for example 'text/html', 'image/png', or 'audio/mpeg'.\n\nguess_type(filename [, strict])\n\nGuesses the MIME type of a file based on its filename or URL. Returns a tuple (type, encoding) in which typeis a string of the form \"type/subtype\" and encodingis the program used to encode the data for transfer (for example, compress or gzip). Returns (None, None) if the type cannot be guessed. If strictis True (the\n\nF h Lib f L Bdff",
      "content_length": 2500,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 592,
      "content": "quopri\n\n567\n\ndefault), then only official MIME types registered with IANA are recognized (see http://www.iana.org/assignments/media-types). Otherwise, some common, but unoffi- cial MIME types are also recognized.\n\nguess_extension(type [, strict])\n\nGuesses the standard file extension for a file based on its MIME type. Returns a string with the filename extension including the leading dot (.). Returns None for unknown types. If strictis True (the default), then only official MIME types are recognized.\n\nguess_all_extensions(type [, strict])\n\nThe same as guess_extension() but returns a list of all possible filename extensions.\n\ninit([files])\n\nInitializes the module. filesis a sequence of filenames that are read to extract type information.These files contain lines that map a MIME type to a list of acceptable file suffixes such as the following:\n\nimage/jpeg: jpe jpeg jpg text/html: htm html ...\n\nread_mime_types(filename)\n\nLoads type mapping from a given filename. Returns a dictionary mapping filename extensions to MIME type strings. Returns None if filenamedoesn’t exist or cannot be read.\n\nadd_type(type, ext [, strict])\n\nAdds a new MIME type to the mapping. typeis a MIME type such as 'text/plain', extis a filename extension such as '.txt', and strictis a Boolean indicating whether the type is an officially registered MIME type. By default, strictis True.\n\nquopri The quopri module performs quoted-printable transport encoding and decoding of byte strings.This format is used primarily to encode 8-bit text files that are mostly read- able as ASCII but which may contain a small number of non-printing or special charac- ters (for example, control characters or non-ASCII characters in the range 128-255). The following rules describe how the quoted-printable encoding works:\n\nn Any printable non-whitespace ASCII character, with the exception of '=', is rep-\n\nresented as is.\n\nn The '=' character is used as an escape character.When followed by two hexadec- imal digits, it represents a character with that value (for example, '=0C').The equals sign is represented by '=3D'. If '=' appears at the end of a line, it denotes a soft line break.This only occurs if a long line of input text must be split into multiple output lines.\n\nn Spaces and tabs are left as is but may not appear at the end of line.\n\nF h Lib f L Bdff",
      "content_length": 2336,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 593,
      "content": "568\n\nChapter 24 Internet Data Handling and Encoding\n\nIt is fairly common to see this format used when documents make use of special char- acters in the extended ASCII character set. For example, if a document contained the text “Copyright © 2009”, this might be represented by the Python byte string b'Copyright \\xa9 2009'.The quoted-printed version of the string is b'Copyright =A9 2009' where the special character '\\xa9' has been replaced by the escape sequence '=A9'.\n\ndecode(input, output [, header])\n\nDecodes bytes into quopri format. inputand outputare file objects opened in binary mode. If header is True, then the underscore (_) will be interpreted as a space. Otherwise, it is left alone.This is used when decoding MIME headers that have been encoded. By default, headeris False.\n\ndecodestring(s [, header])\n\nDecodes a string s. smay be a Unicode or byte string, but the result is always a byte string. headerhas the same meaning as with decode().\n\nencode(input, output, quotetabs [, header])\n\nEncodes bytes into quopri format. inputand outputare file objects opened in binary mode. quotetabs, if set to True, forces tab characters to be quoted in addition to the normal quoting rules. Otherwise, tabs are left as is. By default, quotetabsis False. headerhas the same meaning as for decode().\n\nencodestring(s [, quotetabs [, header]])\n\nEncodes byte string s.The result is also a byte string. quotetabsand headerhave the same meaning as with encode().\n\nNotes\n\nThe quoted-printable data encoding predates Unicode and is only applicable to 8-bit data. Even though it is most commonly applied to text, it really only applies to ASCII and extended ASCII characters represented as single bytes. When you use this module, make sure all files are in binary mode and that you are working with byte strings.\n\nxml Package Python includes a variety of modules for processing XML data.The topic of XML pro- cessing is large, and covering every detail is beyond the scope of this book.This section assumes the reader is already familiar with some basic XML concepts.A book such as Inside XML by Steve Holzner (New Riders) or XML in a Nutshell by Elliotte Harold and W. Scott Means (O’Reilly and Associates) will be useful in explaining basic XML concepts. Several books discuss XML processing with Python including Python & XML by Christopher Jones (O’Reilly and Associates) and XML Processing with Python by Sean McGrath (Prentice Hall).\n\nPython provides two kinds of XML support. First, there is basic support for two industry-standard approaches to XML parsing—SAX and DOM. SAX (Simple API for XML) is based on event handling where an XML document is read sequentially and as XML elements are encountered, handler functions get triggered to perform processing. DOM (Document Object Model) builds a tree structure representing an entire XML\n\nF h Lib f L Bdff",
      "content_length": 2857,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 594,
      "content": "xml Package\n\n569\n\ndocument. Once the tree has been built, DOM provides an interface for traversing the tree and extracting data. Neither the SAX nor DOM APIs originate with Python. Instead, Python simply copies the standard programming interface that was developed for Java and JavaScript.\n\nAlthough you can certainly process XML using the SAX and DOM interfaces, the\n\nmost convenient programming interface in the standard library is the ElementTree interface.This is a Python-specific approach to XML parsing that takes full advantage of Python language features and which most users find to be significantly easier and faster than SAX or DOM.The rest of this section covers all three XML parsing approaches, but the ElementTree approach is given the most detail.\n\nReaders are advised that the coverage here is really only focused on basic parsing of XML data. Python also includes XML modules related to implementing new kinds of parsers, building XML documents from scratch, and so forth. In addition, a variety of third-party extensions extend Python’s capabilities with additional XML features such as support for XSLT and XPATH. Links to further information can be found at http:// wiki.python.org/moin/PythonXml.\n\nXML Example Document The following example illustrates a typical XML document, in this case a description of a recipe.\n\n<?xml version=\"1.0\" encoding=\"iso-8859-1\"?> <recipe>\n\n<title> Famous Guacamole </title> <description> A southwest favorite! </description> <ingredients>\n\n<item num=\"4\"> Large avocados, chopped </item> <item num=\"1\"> Tomato, chopped </item> <item num=\"1/2\" units=\"C\"> White onion, chopped </item> <item num=\"2\" units=\"tbl\"> Fresh squeezed lemon juice </item> <item num=\"1\"> Jalapeno pepper, diced </item> <item num=\"1\" units=\"tbl\"> Fresh cilantro, minced </item> <item num=\"1\" units=\"tbl\"> Garlic, minced </item> <item num=\"3\" units=\"tsp\"> Salt </item> <item num=\"12\" units=\"bottles\"> Ice-cold beer </item>\n\n</ingredients> <directions> Combine all ingredients and hand whisk to desired consistency. Serve and enjoy with ice-cold beers. </directions>\n\n</recipe>\n\nThe document consists of elementsthat start and end with tags such as <title>...</title>. Elements are typically nested and organized into a hierarchy— for example, the <item> elements that appear under <ingredients>.Within each doc- ument, a single element is the document root. In the example, this is the <receipe> element. Elements optionally have attributes as shown for the item elements <item num=\"4\">Large avocados, chopped</item>.\n\nWorking with XML documents typically involves all of these basic features. For example, you may want to extract text and attributes from specific element types.To\n\nF h Lib f L Bdff",
      "content_length": 2723,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 595,
      "content": "570\n\nChapter 24 Internet Data Handling and Encoding\n\nlocate elements, you have to navigate through the document hierarchy starting at the root element.\n\nxml.dom.minidom The xml.dom.minicom module provides basic support for parsing an XML document and storing it in memory as a tree structure according to the conventions of DOM. There are two parsing functions:\n\nparse(file [, parser])\n\nParses the contents of fileand returns a node representing the top of the document tree. ileis a filename or an already-open file object. parseris an optional SAX2-com- patible parser object that will be used to construct the tree. If omitted, a default parser will be used.\n\nparseString(string [, parser])\n\nThe same as parse(), except that the input data is supplied in a string instead of a file.\n\nNodes The document tree returned by the parsing functions consists of a collection of nodes linked together. Each node nhas the following attributes which can be used to extract information and navigate through the tree structure:\n\nNode Attribute n.attributes\n\nn.childNodes\n\nn.firstChild\n\nn.lastChild\n\nn.localName\n\nn.namespaceURI\n\nn.nextSibling\n\nn.nodeName\n\nn.nodeType\n\nn.nodeValue\n\nn.parentNode\n\nDescription Mapping object that holds attribute values (if any). A list of all child nodes of n. The first child of node n. The last child of node n. Local tag name of an element. If a colon appears in the tag (for example, '<foo:bar ...>'), then this only contains the part after the colon. Namespace associated with n, if any. The node that appears after nin the tree and has the same parent. Is None if nis the last sibling. The name of the node. The meaning depends on the node type. Integer describing the node type. It is set to one of the follow- ing values which are class variables of the Node class: ATTRIBUTE_NODE, CDATA_SECTION_NODE, COMMENT_NODE, DOCUMENT_FRAGMENT_NODE, DOCUMENT_NODE, DOCUMENT_TYPE_NODE, ELEMENT_NODE, ENTITY_NODE, ENTITY_REFERENCE_NODE, NOTATION_NODE, PROCESSING_INSTRUCTION_NODE, or TEXT_NODE. The value of the node. The meaning depends on the node type. A reference to the parent node. Part of a tag name that appears before a colon. For example, the element '<foo:bar ...>' would have a prefix of 'foo'.\n\nn.prefix\n\nn.previousSibling The node that appears before nin the tree and has the same\n\nparent.\n\nF h Lib f L Bdff",
      "content_length": 2337,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 596,
      "content": "xml Package\n\n571\n\nIn addition to these attributes, all nodes have the following methods.Typically, these are used to manipulate the tree structure.\n\nn.appendChild(child)\n\nAdds a new child node, child, to n.The new child is added at the end of any other children.\n\nn.cloneNode(deep)\n\nMakes a copy of the node n. If deepis True, all child nodes are also cloned.\n\nn.hasAttributes()\n\nReturns True if the node has any attributes.\n\nn.hasChildNodes()\n\nReturns True if the node has any children.\n\nn.insertBefore(newchild, ichild)\n\nInserts a new child, newchild, before another child, ichild. ichildmust already be a child of n.\n\nn.isSameNode(other)\n\nReturns True if the node otherrefers to the same DOM node as n.\n\nn.normalize()\n\nJoins adjacent text nodes into a single text node.\n\nn.removeChild(child)\n\nRemoves child childfrom n.\n\nn.replaceChild(newchild,oldchild)\n\nReplaces the child oldchildwith newchild. oldchildmust already be a child of n. Although there are many different types of nodes that might appear in a tree, it is\n\nmost common to work with Document, Element, and Text nodes. Each is briefly described next.\n\nDocument Nodes A Document node dappears at the top of the entire document tree and represents the entire document as a whole. It has the following methods and attributes:\n\nd.documentElement\n\nContains the root element of the entire document.\n\nd.getElementsByTagName(tagname)\n\nSearches all child nodes and returns a list of elements with a given tag name tagname.\n\nd.getElementsByTagNameNS(namespaceuri, localname)\n\nSearches all child nodes and returns a list of elements with a given namespace URI and local name.The returned list is an object of type NodeList.\n\nF h Lib f L Bdff",
      "content_length": 1695,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 597,
      "content": "572\n\nChapter 24 Internet Data Handling and Encoding\n\nElement Nodes An Element node erepresents a single XML element such as '<foo>...</foo>'.To get the text from an element, you need to look for Text nodes as children.The follow- ing attributes and methods are defined to get other information:\n\ne.tagName\n\nThe tag name of the element. For example, if the element is defined by '<foo ...>', the tag name is 'foo'.\n\ne.getElementsByTagName(tagname)\n\nReturns a list of all children with a given tag name.\n\ne.getElementsByTagNameNS(namespaceuri, localname)\n\nReturns a list of all children with a given tag name in a namespace. namespaceuriand localnameare strings that specify the namespace and tag name. If a namespace has been declared using a declaration such as '<foo xmlns:foo=\"http://www.spam.com/foo\">', namespaceuriis set to 'http://www.spam.com/foo'. If searching for a subsequent element '<foo:bar>', localnameis set to 'bar'.The returned object is of type NodeList.\n\ne.hasAttribute(name)\n\nReturns True if an element has an attribute with name name.\n\ne.hasAttributeNS(namespaceuri, localname)\n\nReturns True if an element has an attribute named by namespaceuriand localname. The arguments have the same meaning as described for getElementsByTagNameNS().\n\ne.getAttribute(name)\n\nReturns the value of attribute name.The return value is a string. If the attribute doesn’t exist, an empty string is returned.\n\ne.getAttributeNS(namespaceuri, localname)\n\nReturns the value of the attributed named by namespaceuriand localname.The return value is a string.An empty string is returned if the attribute does not exist.The arguments are the same as described for getElementsByTagNameNS().\n\nText Nodes Text nodes are used to represent text data.Text data is stored in the t.data attribute of a Text object t.The text associated with a given document element is always stored in Text nodes that are children of the element.\n\nUtility Functions The following utility methods are defined on nodes.These are not part of the DOM standard, but are provided by Python for general convenience and for debugging.\n\nn.toprettyxml([indent [, newl]])\n\nCreates a nicely formatted string containing the XML represented by node nand its children. indentspecifies an indentation string and defaults to a tab ('\\t'). newlspec- ifies the newline character and defaults to '\\n'.\n\nF h Lib f L Bdff",
      "content_length": 2368,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 598,
      "content": "xml Package\n\n573\n\nn.toxml([encoding])\n\nCreates a string containing the XML represented by node nand its children. encoding specifies the encoding (for example, 'utf-8'). If no encoding is given, none is specified in the output text.\n\nn.writexml(writer [, indent [, addindent [, newl]]])\n\nWrites XML to writer. writercan be any object that provides a write() method that is compatible with the file interface. indentspecifies the indentation of n. It is a string that is prepended to the start of node nin the output. addindentis a string that specifies the incremental indentation to apply to child nodes of n. newlspecifies the newline character.\n\nDOM Example The following example shows how to use the xml.dom.minidom module to parse and extract information from an XML file:\n\nfrom xml.dom import minidom doc = minidom.parse(\"recipe.xml\")\n\ningredients = doc.getElementsByTagName(\"ingredients\")[0] items = ingredients.getElementsByTagName(\"item\")\n\nfor item in items:\n\nnum = item.getAttribute(\"num\") units = item.getAttribute(\"units\") text = item.firstChild.data.strip() quantity = \"%s %s\" % (num,units) print(\"%-10s %s\" % (quantity,text))\n\nNote\n\nThe xml.dom.minidom module has many more features for changing the parse tree and working with different kinds of XML node types. More information can be found in the online documentation.\n\nxml.etree.ElementTree The xml.etree.ElementTree module defines a flexible container object ElementTree for storing and manipulating hierarchical data.Although this object is commonly used in conjunction with XML processing, it is actually quite general-purpose—serving a role that’s a cross between a list and dictionary.\n\nElementTree objects The following class is used to define a new ElementTree object and represents the top level of a hierarchy.\n\nElementTree([element [, file]])\n\nCreates a new ElementTree object. elementis an instance representing the root node of the tree.This instance supports the element interface described next. fileis either a filename or a file-like object from which XML data will be read to populate the tree.\n\nF h Lib f L Bdff",
      "content_length": 2097,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 599,
      "content": "574\n\nChapter 24 Internet Data Handling and Encoding\n\nAn instance treeof ElementTree has the following methods:\n\ntree._setroot(element)\n\nSets the root element to element.\n\ntree.find(path)\n\nFinds and returns the first top-level element in the tree whose type matches the given path. pathis a string that describes the element type and its location relative to other elements.The following list describes the path syntax:\n\nPath 'tag'\n\nDescription Matches only top-level elements with the given tag—for example, <tag>...</tag>. Does not match elements defined at lower levels. A element of type tagembedded inside another element such as <foo><tag>...</tag></foo> is not matched. 'parent/tag' Matches an element with tag 'tag' if it’s a child of an element with tag 'parent'. As many path name components can be specified as desired. Selects all child elements. For example, '*/tag' would match all grandchild elements with a tag name of 'tag'. Starts the search with the current node. Selects all subelements on all levels beneath an element. For exam- ple, './/tag' matches all elements with tag 'tag' at all sublevels.\n\n'*'\n\n'.'\n\n'//'\n\nIf you are working with a document involving XML namespaces, the tagstrings in a path should have the form '{uri}tag' where uriis a string such as 'http://www.w3.org/TR/html4/'.\n\ntree.findall(path)\n\nFinds all top-level elements in the tree that match the given path and returns them in document order as a list or an iterator.\n\ntree.findtext(path [, default])\n\nReturns the element text for the first top-level element in the tree matching the given path. defaultis a string to return if no matching element can be found.\n\ntree.getiterator([tag])\n\nCreates an iterator that produces all elements in the tree, in section order, whose tag matches tag. If tagis omitted, then every element in the tree is returned in order.\n\ntree.getroot()\n\nReturns the root element for the tree.\n\ntree.parse(source [, parser])\n\nParses external XML data and replaces the root element with the result. sourceis either a filename or file-like object representing XML data. parseris an optional instance of TreeBuilder, which is described later.\n\nF h Lib f L Bdff",
      "content_length": 2173,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 600,
      "content": "xml Package\n\n575\n\ntree.write(file [, encoding])\n\nWrites the entire contents of the tree to a file. fileis either a filename or a file-like object opened for writing. encodingis the output encoding to use and defaults to the interpreter default encoding if not specified ('utf-8' or 'ascii' in most cases).\n\nCreating Elements The types of elements held in an ElementTree are represented by instances of varying types that are either created internally by parsing a file or with the following construc- tion functions:\n\nComment([text])\n\nCreates a new comment element. textis a string or byte string containing the element text.This element is mapped to XML comments when parsing or writing output.\n\nElement(tag [, attrib [, **extra]])\n\nCreates a new element. tagis the name of the element name. For example, if you were creating an element '<foo>....</foo>', tagwould be 'foo'. attribis a dictionary of element attributes specified as strings or byte strings.Any extra keyword arguments supplied in extraare also used to set element attributes.\n\nfromstring(text)\n\nCreates an element from a fragment of XML text in text—the same as XML() described next.\n\nProcessingInstruction(target [, text])\n\nCreates a new element corresponding to a processing instruction. targetand textare both strings or byte strings.When mapped to XML, this element corresponds to '<?target text?>'.\n\nSubElement(parent, tag [, attrib [, **extra]])\n\nThe same as Element(), but it automatically adds the new element as a child of the element in parent.\n\nXML(text)\n\nCreates an element by parsing a fragment of XML code in text. For example, if you set textto '<foo>....</foo>', this will create a standard element with a tag of 'foo'.\n\nXMLID(text)\n\nThe same as XML(text) except that 'id' attributes are collected and used to build a dictionary mapping ID values to elements. Returns a tuple (elem, idmap) where elemis the new element and idmapis the ID mapping dictionary. For example, XMLID('<foo id=\"123\"><bar id=\"456\">Hello</bar></foo>') returns (<Element foo>, {'123': <Element foo>, '456': <Element bar>}).\n\nF h Lib f L Bdff",
      "content_length": 2097,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 601,
      "content": "576\n\nChapter 24 Internet Data Handling and Encoding\n\nThe Element Interface Although the elements stored in an ElementTree may have varying types, they all sup- port a common interface. If elemis any element, then the following Python operators are defined:\n\nOperator elem[n] elem[n] = newelem Changes the nth child element of elemto a different element\n\nDescription Returns the nth child element of elem.\n\ndel elem[n]\n\nlen(elem)\n\nnewelem. Deletes the nth child element of elem. Number of child elements of elem.\n\nAll elements have the following basic data attributes:\n\nAttribute elem.tag\n\nelem.text\n\nelem.tail\n\nDescription String identifying the element type. For example, <foo>...</foo> has a tag of 'foo'. Data associated with the element. Usually a string containing text between the start and ending tags of an XML element. Additional data stored with the attribute. For XML, this is usu- ally a string containing whitespace found after the element’s end tag but before the next tag starts. Dictionary containing the element attributes.\n\nelem.attrib\n\nElements support the following methods, some of which emulate methods on dictionaries:\n\nelem.append(subelement)\n\nAppends the element subelementto the list of children.\n\nelem.clear()\n\nClears all of the data in an element including attributes, text, and children.\n\nelem.find(path)\n\nFinds the first subelement whose type matches path.\n\nelem.findall(path)\n\nFinds all subelements whose type matches path. Returns a list or an iterable with the matching elements in document order.\n\nelem.findtext(path [, default])\n\nFinds the text for the first element whose type patches path. defaultis a string giving the value to return if there is no match.\n\nelem.get(key [, default])\n\nGets the value of attribute key. defaultis a default value to return if the attribute doesn’t exist. If XML namespaces are involved, then keywill be a string of the form '{uri}key}' where uriis a string such as 'http://www.w3.org/TR/html4/'.\n\nF h Lib f L Bdff",
      "content_length": 1982,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 602,
      "content": "xml Package\n\n577\n\nelem.getchildren()\n\nReturns all subelements in document order.\n\nelem.getiterator([tag])\n\nReturns an iterator that produces all subelements whose type matches tag.\n\nelem.insert(index, subelement)\n\nInserts a subelement at position indexin the list of children.\n\nelem.items()\n\nReturns all element attributes as a list of (name, value) pairs.\n\nelem.keys()\n\nReturns a list of all of the attribute names.\n\nelem.remove(subelement)\n\nRemoves element subelementfrom the list of children.\n\nelem.set(key, value)\n\nSets attribute keyto value value.\n\nTree Building An ElementTree object is easy to create from other tree-like structures.The following object is used for this purpose.\n\nTreeBuilder([element_factory])\n\nA class that builds an ElementTree structure using a series of start(), end(), and data() calls as would be triggered while parsing a file or traversing another tree struc- ture. element_factoryis an operation function that is called to create new element instances.\n\nAn instance tof TreeBuilder has these methods:\n\nt.close()\n\nCloses the tree builder and returns the top-level ElementTree object that has been cre- ated.\n\nt.data(data)\n\nAdds text data to the current element being processed.\n\nt.end(tag)\n\nCloses the current element being processed and returns the final element object.\n\nt.start(tag, attrs)\n\nCreates a new element. tagis the element name, and attrsis a dictionary with the attribute values.\n\nF h Lib f L Bdff",
      "content_length": 1443,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 603,
      "content": "578\n\nChapter 24 Internet Data Handling and Encoding\n\nUtility Functions The following utility functions are defined:\n\ndump(elem)\n\nDumps the element structure of elemto sys.stdout for debugging.The output is usually XML.\n\niselement(elem)\n\nChecks if elemis a valid element object.\n\niterparse(source [, events])\n\nIncrementally parses XML from source. sourceis a filename or a file-like object referring to XML data. eventsis a list of event types to produce. Possible event types are 'start', 'end', 'start-ns', and 'end-ns'. If omitted, only 'end' events are produced.The value returned by this function is an iterator that produces tuples (event, elem) where eventis a string such as 'start' or 'end' and elemis the element being processed. For 'start' events, the element is newly created and initially empty except for attributes. For 'end' events, the element is fully populated and includes all subelements.\n\nparse(source)\n\nFully parses an XML source into an ElementTree object. sourceis a filename or file- like object with XML data.\n\ntostring(elem)\n\nCreates an XML string representing elemand all of its subelements.\n\nXML Examples Here is an example of using ElementTree to parse the sample recipe file and print an ingredient list. It is similar to the example shown for DOM.\n\nfrom xml.etree.ElementTree import ElementTree\n\ndoc = ElementTree(file=\"recipe.xml\") ingredients = doc.find('ingredients')\n\nfor item in ingredients.findall('item'):\n\nnum = item.get('num') units = item.get('units','') text = item.text.strip() quantity = \"%s %s\" % (num, units) print(\"%-10s %s\" % (quantity, text))\n\nThe path syntax of ElementTree makes it easier to simplify certain tasks and to take shortcuts as necessary. For example, here is a different version of the previous code that uses the path syntax to simply extract all <item>...</item> elements.\n\nfrom xml.etree.ElementTree import ElementTree\n\ndoc = ElementTree(file=\"recipe.xml\") for item in doc.findall(\".//item\"):\n\nnum = item.get('num') units = item.get('units','') text = item.text.strip() quantity = \"%s %s\" % (num, units) print(\"%-10s %s\" % (quantity, text))\n\nF h Lib f L Bdff",
      "content_length": 2127,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 604,
      "content": "xml Package\n\n579\n\nConsider an XML file 'recipens.xml' that makes use of namespaces:\n\n<?xml version=\"1.0\" encoding=\"iso-8859-1\"?> <recipe xmlns:r=\"http://www.dabeaz.com/namespaces/recipe\">\n\n<r:title> Famous Guacamole </r:title> <r:description> A southwest favorite! </r:description> <r:ingredients>\n\n<r:item num=\"4\"> Large avocados, chopped </r:item> ...\n\n</r:ingredients> <r:directions> Combine all ingredients and hand whisk to desired consistency. Serve and enjoy with ice-cold beers. </r:directions>\n\n</recipe>\n\nTo work with the namespaces, it is usually easiest to use a dictionary that maps the namespace prefix to the associated namespace URI.You then use string formatting operators to fill in the URI as shown here:\n\nfrom xml.etree.ElementTree import ElementTree doc = ElementTree(file=\"recipens.xml\") ns = {\n\n'r' : 'http://www.dabeaz.com/namespaces/recipe'\n\n} ingredients = doc.find('{%(r)s}ingredients' % ns) for item in ingredients.findall('{%(r)s}item' % ns):\n\nnum = item.get('num') units = item.get('units','') text = item.text.strip() quantity = \"%s %s\" % (num, units) print(\"%-10s %s\" % (quantity, text))\n\nFor small XML files, it is fine to use the ElementTree module to quickly load them into memory so that you can work with them. However, suppose you are working with a huge XML file with a structure such as this:\n\n<?xml version=\"1.0\" encoding=\"utf-8\"?> <music>\n\n<album>\n\n<title>A Texas Funeral</title> <artist>Jon Wayne</artist> ... </album> <album>\n\n<title>Metaphysical Graffiti</title> <artist>The Dead Milkmen</artist> ...\n\n</album> ... continues for 100000 more albums ...\n\n</music>\n\nReading a large XML file into memory tends to consume vast amounts of memory. For example, reading a 10MB XML file may result in an in-memory data structure of more than 100MB. If you’re trying to extract information from such files, the easiest way to\n\nF h Lib f L Bdff",
      "content_length": 1878,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 605,
      "content": "580\n\nChapter 24 Internet Data Handling and Encoding\n\ndo it is to use the ElementTree.iterparse() function. Here is an example of itera- tively processing <album> nodes in the previous file:\n\nfrom xml.etree.ElementTree import iterparse\n\niparse = iterparse(\"music.xml\", ['start','end']) # Find the top-level music element for event, elem in iparse:\n\nif event == 'start' and elem.tag == 'music':\n\nmusicNode = elem break\n\n# Get all albums albums = (elem for event, elem in iparse\n\nif event == 'end' and elem.tag == 'album')\n\nfor album in albums:\n\n# Do some kind of processing ... musicNode.remove(album) # Throw away the album when done\n\nThe key to using iterparse() effectively is to get rid of data that you’re no longer using.The last statement musicNode.remove(album) is throwing away each <album> element after we are done processing it (by removing it from its parent). If you monitor the memory footprint of the previous program, you will find that it stays low even if the input file is massive.\n\nNotes\n\nn The ElementTree module is by far the easiest and most flexible way of handling simple XML documents in Python. However, it does not provide a lot of bells and whistles. For example, there is no support for validation, nor does it provide any apparent way to handle complex aspects of XML documents such as DTDs. For these things, you’ll need to install third-party packages. One such package, lxml.etree (at http://codespeak.net/lxml/), provides an ElementTree API to the popular libxml2 and libxslt libraries and provides full support for XPATH, XSLT, and other features.\n\nn The ElementTree module itself is a third-party package maintained by Fredrik Lundh at http://effbot.org/zone/element-index.htm.At this site you can find versions that are more modern than what is included in the standard library and which offer additional features.\n\nxml.sax The xml.sax module provides support for parsing XML documents using the SAX2 API.\n\nparse(file, handler [, error_handler])\n\nParses an XML document, file. fileis either the name of a file or an open file object. handleris a content handler object. error_handleris an optional SAX error- handler object that is described further in the online documentation.\n\nparseString(string, handler [, error_handler])\n\nThe same as parse() but parses XML data contained in a string instead.\n\nF h Lib f L Bdff",
      "content_length": 2353,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 606,
      "content": "xml Package\n\n581\n\nHandler Objects To perform any processing, you have to supply a content handler object to the parse() or parseString() functions.To define a handler, you define a class that inherits from ContentHandler.An instance cof ContentHandler has the following methods, all of which can be overridden in your handler class as needed:\n\nc.characters(content)\n\nCalled by the parser to supply raw character data. contentis a string containing the characters.\n\nc.endDocument()\n\nCalled by the parser when the end of the document is reached.\n\nc.endElement(name)\n\nCalled when the end of element nameis reached. For example, if '</foo>’ is parsed, this method is called with nameset to 'foo'.\n\nc.endElementNS(name, qname)\n\nCalled when the end of an element involving an XML namespace is reached. nameis a tuple of strings (uri, localname) and qnameis the fully qualified name. Usually qnameis None unless the SAX namespace-prefixes feature has been enabled. For example, if the element is defined as '<foo:bar xmlns:foo=\"http://spam.com\">', then the nametuple is (u'http://spam.com', u'bar').\n\nc.endPrefixMapping(prefix)\n\nCalled when the end of an XML namespace is reached. prefixis the name of the namespace.\n\nc.ignorableWhitespace(whitespace)\n\nCalled when ignorable whitespace is encountered in a document. whitespaceis a string containing the whitespace.\n\nc.processingInstruction(target, data)\n\nCalled when an XML processing instruction enclosed in <? ... ?> is encountered. targetis the type of instruction, and datais the instruction data. For example, if the instruction is '<?xml-stylesheet href=\"mystyle.css\" type=\"text/css\"?>, targetis set to 'xml-stylesheet' and datais the remainder of the instruction text 'href=\"mystyle.css\" type=\"text/css\"'.\n\nc.setDocumentLocator(locator)\n\nCalled by the parser to supply a locator object that can be used for tracking line num- bers, columns, and other information.The primary purpose of this method is simply to store the locator someplace so that you can use it later—for instance, if you needed to print an error message.The locator object supplied in locatorprovides four methods—getColumnNumber(), getLineNumber(), getPublicId(), and getSystemId()—that can be used to get location information.\n\nc.skippedEntity(name)\n\nCalled whenever the parser skips an entity. nameis the name of the entity that was skipped.\n\nF h Lib f L Bdff",
      "content_length": 2380,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 607,
      "content": "582\n\nChapter 24 Internet Data Handling and Encoding\n\nc.startDocument()\n\nCalled at the start of a document.\n\nc.startElement(name, attrs)\n\nCalled whenever a new XML element is encountered. nameis the name of the ele- ment, and attrsis an object containing attribute information. For example, if the XML element is '<foo bar=\"whatever\" spam=\"yes\">', nameis set to 'foo' and attrscontains information about the bar and spam attributes.The attrsobject pro- vides a number of methods for obtaining attribute information:\n\nMethod attrs.getLength() attrs.getNames()\n\nattrs.getType(name)\n\nattrs.getValue(name)\n\nDescription Returns the number of attributes Returns a list of attribute names Gets the type of attribute name Gets the value of attribute name\n\nc.startElementNS(name, qname, attrs)\n\nCalled when a new XML element is encountered and XML namespaces are being used. nameis a tuple (uri, localname) and qnameis a fully qualified element name (normally set to None unless the SAX2 namespace-prefixes feature has been enabled). attrsis an object containing attribute information. For example, if the XML element is '<foo:bar xmlns:foo=\"http://spam.com\" blah=\"whatever\">', then nameis (u'http://spam.com', u'bar'), qnameis None, and attrscontains infor- mation about the attribute blah.The attrsobject has the same methods as used in when accessing attributes in the startElement() method shown earlier. In addition, the following additional methods are added to deal with namespaces:\n\nMethod attrs.getValueByQName(qname) attrs.getNameByQName(qname)\n\nattrs.getQNameByName(name)\n\nattrs.getQNames()\n\nDescription Returns value for qualified name. Returns (namespace, localname) tuple for a name. Returns qualified name for namespecified as a tuple (namespace, localname). Returns qualified names of all attributes.\n\nc.startPrefixMapping(prefix, uri)\n\nCalled at the start of an XML namespace declaration. For example, if an element is defined as '<foo:bar xmlns:foo=\"http://spam.com\">', then prefixis set to 'foo' and uriis set to 'http://spam.com'.\n\nExample The following example illustrates a SAX-based parser, by printing out the ingredient list from the recipe file shown earlier.This should be compared with the example in the xml.dom.minidom section.\n\nF h Lib f L Bdff",
      "content_length": 2265,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 608,
      "content": "xml Package\n\n583\n\nfrom xml.sax import ContentHandler, parse\n\nclass RecipeHandler(ContentHandler):\n\ndef startDocument(self):\n\nself.initem = False\n\ndef startElement(self,name,attrs):\n\nif name == 'item':\n\nself.num = attrs.get('num','1') self.units = attrs.get('units','none') self.text = [] self.initem = True def endElement(self,name): if name == 'item':\n\ntext = \"\".join(self.text) if self.units == 'none': self.units = \"\" unitstr = \"%s %s\" % (self.num, self.units) print(\"%-10s %s\" % (unitstr,text.strip())) self.initem = False\n\ndef characters(self,data):\n\nif self.initem:\n\nself.text.append(data)\n\nparse(\"recipe.xml\",RecipeHandler())\n\nNotes The xml.sax module has many more features for working with different kinds of XML data and creating custom parsers. For example, there are handler objects that can be defined to parse DTD data and other parts of the document. More information can be found in the online documentation.\n\nxml.sax.saxutils The xml.sax.saxutils module defines some utility functions and objects that are often used with SAX parsers, but are often generally useful elsewhere.\n\nescape(data [, entities])\n\nGiven a string, data, this function replaces certain characters with escape sequences. For example, '<' gets replaced by '&lt;'. entitiesis an optional dictionary that maps characters to the escape sequences. For example, setting entitiesto { u'\\xf1' : '&ntilde;' } would replace occurences of ñ with '&ntilde;'.\n\nunescape(data [, entities])\n\nUnescapes special escape sequences that appear in data. For instance, '&lt;' is replaced by '<'. entitiesis an optional dictionary mapping entities to unescaped character values. entitiesis the inverse of the dictionary used with escape()—for example, { '&ntilde;' : u'\\xf1' }.\n\nquoteattr(data [, entities])\n\nEscapes the string data, but performs additional processing that allows the result value to be used as an XML attribute value.The return value can be printed directly as an attribute value—for example, print \"<element attr=%s>\" % quoteattr(somevalue). entitiesis a dictionary compatible for use with the escape() function.\n\nF h Lib f L Bdff",
      "content_length": 2114,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 609,
      "content": "584\n\nChapter 24 Internet Data Handling and Encoding\n\nXMLGenerator([out [, encoding]])\n\nA ContentHandler object that merely echoes parsed XML data back to the output stream as an XML document.This re-creates the original XML document. outis the output document and defaults to sys.stdout. encodingis the character encoding to use and defaults to 'iso-8859-1'.This can be useful if you’re trying to debug your parsing code and use a handler that is known to work.\n\nF h Lib f L Bdff",
      "content_length": 479,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 610,
      "content": "25\n\nMiscellaneous Library Modules\n\nThe modules listed in this section are not covered in detail in this book but are still\n\nconsidered to be part of the standard library.These modules have mostly been omitted from previous chapters because they are either extremely low-level and of limited use, restricted to very specific platforms, obsolete, or so complicated that coverage would require a complete book on the topic.Although these modules are have been omitted from this book, online documentation is available for each module at http:// docs.python.org/library/modname.An index of all modules is also available at http://docs.python.org/library/modindex.html.\n\nThe modules listed here represent a common subset of functionality between Python 2 and Python 3. If you are using a module that is not listed here, chances are it has been officially deprecated. Some modules have changed names in Python 3.The new name is shown in parentheses, if applicable.\n\nPython Services The following modules provide additional services related to the Python language and execution of the Python interpreter. Many of these modules are related to parsing and compilation of Python source code.\n\nModule bdb\n\ncode\n\ncodeop\n\ncompileall copy_reg (copyreg) dis\n\ndistutils\n\nfpectl\n\nimp\n\nkeyword\n\nlinecache\n\nDescription Access to the debugger framework Interpreter base classes Compiles Python code Byte-compiles Python files in a directory Register built-in types for use with the pickle module Disassembler Distribution of Python modules Floating-point exception control Provides access to the implementation of the import statement Tests whether a string is a Python keyword Retrieves lines from source files Finds modules used by a script\n\nmodulefinder\n\nF h Lib f L Bdff",
      "content_length": 1754,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 611,
      "content": "586\n\nChapter 25 Miscellaneous Library Modules\n\nModule parser\n\npickletools\n\npkgutil\n\npprint\n\npyclbr\n\npy_compile repr (reprlib) symbol\n\ntabnanny\n\ntest\n\ntoken\n\ntokenize\n\nuser\n\nDescription Accesses parse trees of Python source code Tools for pickle developers Package extension utility Prettyprinter for objects Extracts information for class browsers Compiles Python source to bytecode files Alternate implementation of the repr() function Constants used to represent internal nodes of parse trees Detection of ambiguous indentation Regression testing package Terminal nodes of the parse tree Scanner for Python source code User configuration file parsing Import modules from zip archives\n\nzipimport\n\nString Processing The following modules are some older, now obsolete, modules used for string processing.\n\nModule difflib\n\nfpformat\n\nstringprep\n\ntextwrap\n\nDescription Compute deltas between strings Floating-point number formatting Internet string preparation Text wrapping\n\nOperating System Modules These modules provide additional operating system services. In some cases, the func- tionality of a module listed here is already incorporated into the functionality of other modules covered in Chapter 19,“Operating System Services.”\n\nModule crypt\n\ncurses\n\ngrp\n\npty\n\npipes\n\nnis\n\nplatform\n\npwd\n\nreadline\n\nDescription Access to the UNIX crypt function Curses library interface Access to the group database Pseudo terminal handling Interface to shell pipelines Interface to Sun’s NIS Access to platform-specific information Access to the password database Access to GNU readline library Completion function for GNU readline\n\nrlcompleter\n\nF h Lib f L Bdff",
      "content_length": 1648,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 612,
      "content": "Internationalization\n\n587\n\nModule resource\n\nsched\n\nspwd\n\nstat\n\nsyslog\n\ntermios\n\nDescription Resource usage information Event scheduler Access to the shadow password database Support for interpreting results of os.stat() Interface to UNIX syslog daemon UNIX TTY control Terminal control functions\n\ntty\n\nNetwork The following modules provide support for lesser-used network protocols:\n\nModule imaplib\n\nnntplib\n\npoplib\n\nsmtpd\n\ntelnetlib\n\nDescription IMAP protocol NNTP protocol POP3 protocol SMTP server Telnet protocol\n\nInternet Data Handling The following modules provide additional support for Internet data processing not cov- ered in Chapter 24,“Internet Data Handling and Encoding.”\n\nModule binhex\n\nformatter\n\nmailcap\n\nmailbox\n\nnetrc\n\nplistlib\n\nuu\n\nDescription BinHex4 file format support Generic output formatting Mailcap file handling Reading various mailbox formats Netrc file processing Macintosh plist file processing UUencode file support Encode and decode Sun XDR data\n\nxdrlib\n\nInternationalization The following modules are used for writing internationalized applications:\n\nModule gettext\n\nlocale\n\nDescription Multilingual text handling services Internationalization functions provided by the system\n\nF h Lib f L Bdff",
      "content_length": 1228,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 613,
      "content": "588\n\nChapter 25 Miscellaneous Library Modules\n\nMultimedia Services The following modules provide support for handling various kinds of multimedia files:\n\nModule audioop\n\naifc\n\nsunau\n\nwave\n\nchunk\n\ncolorsys\n\nimghdr\n\nsndhdr\n\nDescription Manipulates raw audio data Reads and writes AIFF and AIFC files Reads and writes Sun AU files Reads and writes WAV files Reads IFF chunked data Conversions between color systems Determines the type of an image Determines the type of a sound file Access to OSS-compatible audio devices\n\nossaudiodev\n\nMiscellaneous The following modules round out the list and don’t really neatly fall into any of the other categories:\n\nModule cmd\n\ncalendar\n\nshlex\n\nsched Tkinter (tkinter) winsound\n\nDescription Line-oriented command interpreters Calendar-generation functions Simple lexical analysis module Event scheduler Python interface to Tcl/Tk Playing sounds on Windows\n\nF h Lib f L Bdff",
      "content_length": 909,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 614,
      "content": "III\n\nExtending and Embedding\n\n26\n\nExtending and Embedding Python\n\nAppendix: Python 3\n\nF h Lib f L Bdff",
      "content_length": 102,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 615,
      "content": "This page intentionally left blank\n\nF h Lib f L Bdff",
      "content_length": 52,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 616,
      "content": "26\n\nExtending and Embedding Python\n\nOne of the most powerful features of Python is its ability to interface with software\n\nwritten in C.There are two common strategies for integrating Python with foreign code. First, foreign functions can be packaged into a Python library module for use with the import statement. Such modules are known as extension modules because they extend the interpreter with additional functionality not written in Python.This is, by far, the most common form of Python-C integration because it gives Python applica- tions access to high-performance programming libraries.The other form of Python-C integration is embedding.This is a process by which Python programs and the interpreter are accessed as a library from C.This latter approach is sometimes used by programmers who want to embed the Python interpreter into an existing C application framework for some reason—usually as some kind of scripting engine.\n\nThis chapter covers the absolute basics of the Python-C programming interface. First, the essential parts of the C API used to build extension modules and embed the Python interpreter are covered.This section is not intended to be a tutorial, so readers new to this topic should consult the “Embedding and Extending the Python Interpreter” document available at http://docs.python.org/extending, as well as the “Python/C API Reference Manual” available at http://docs.python.org/c-api. Next, the ctypes library module is covered.This is an extremely useful module that allows you to access functions in C libraries without writing any additional C code or using a C compiler.\n\nIt should be noted that for advanced extension and embedding applications, most programmers tend to turn to advanced code generators and programming libraries. For example, the SWIG project (http://www.swig.org) is a compiler that creates Python extension modules by parsing the contents of C header files. References to this and other extension building tools can be found at http://wiki.python.org/moin/ IntegratingPythonWithOtherLanguages.\n\nExtension Modules This section outlines the basic process of creating a handwritten C extension module for Python.When you create an extension module, you are building an interface\n\nF h Lib f L Bdff",
      "content_length": 2259,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 617,
      "content": "592\n\nChapter 26 Extending and Embedding Python\n\nbetween Python and existing functionality written in C. For C libraries, you usually start from a header file such as the following:\n\n/* file : example.h */ #include <stdio.h> #include <string.h> #include <math.h>\n\ntypedef struct Point {\n\ndouble x; double y;\n\n} Point;\n\n/* Compute the GCD of two integers x and y */ extern int gcd(int x, int y);\n\n/* Replace och with nch in s and return the number of replacements */ extern int replace(char *s, char och, char nch);\n\n/* Compute the distance between two points */ extern double distance(Point *a, Point *b);\n\n/* A preprocessor constant */ #define MAGIC 0x31337\n\nThese function prototypes have some kind of implementation in a separate file. For example:\n\n/* example.c */ #include \"example.h\" /* Compute GCD of two positive integers x and y */ int gcd(int x, int y) {\n\nint g; g = y; while (x > 0) { g = x; x = y % x; y = g;\n\n} return g;\n\n}\n\n/* Replace a character in a string */ int replace(char *s, char oldch, char newch) {\n\nint nrep = 0; while (s = strchr(s,oldch)) {\n\n(s++) = newch; nrep++;\n\n} return nrep;\n\n}\n\n/* Distance between two points */ double distance(Point *a, Point *b) {\n\ndouble dx,dy; dx = a->x - b->x; dy = a->y - b->y; return sqrt(dx*dx + dy*dy);\n\n}\n\nF h Lib f L Bdff",
      "content_length": 1282,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 618,
      "content": "Extension Modules\n\n593\n\nHere is a C main() program that illustrates the use of these functions:\n\n/* main.c */ #include \"example.h\" int main() {\n\n/* Test the gcd() function */ {\n\nprintf(\"%d\\n\", gcd(128,72)); printf(\"%d\\n\", gcd(37,42));\n\n} /* Test the replace() function */ {\n\nchar s[] = \"Skipping along unaware of the unspeakable peril.\"; int nrep; nrep = replace(s,' ','-'); printf(\"%d\\n\", nrep); printf(\"%s\\n\",s);\n\n} /* Test the distance() function */ {\n\nPoint a = { 10.0, 15.0 }; Point b = { 13.0, 11.0 }; printf(\"%0.2f\\n\", distance(&a,&b));\n\n}\n\n}\n\nHere is the output of the previous program:\n\n% a.out 8 1 6 Skipping-along-unaware-of-the-unspeakable-peril. 5.00\n\nAn Extension Module Prototype Extension modules are built by writing a separate C source file that contains a set of wrapper functions which provide the glue between the Python interpreter and the underlying C code. Here is an example of a basic extension module called _example:\n\n/* pyexample.c */\n\n#include \"Python.h\" #include \"example.h\"\n\nstatic char py_gcd_doc[] = \"Computes the GCD of two integers\"; static PyObject * py_gcd(PyObject *self, PyObject *args) {\n\nint x,y,r; if (!PyArg_ParseTuple(args,\"ii:gcd\",&x,&y)) {\n\nreturn NULL;\n\n} r = gcd(x,y); return Py_BuildValue(\"i\",r);\n\n}\n\nstatic char py_replace_doc[] = \"Replaces all characters in a string\"; static PyObject *\n\nF h Lib f L Bdff",
      "content_length": 1356,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 619,
      "content": "594\n\nChapter 26 Extending and Embedding Python\n\npy_replace(PyObject *self, PyObject *args, PyObject *kwargs) {\n\nstatic char *argnames[] = {\"s\",\"och\",\"nch\",NULL}; char *s,*sdup; char och, nch; int nrep; PyObject *result; if (!PyArg_ParseTupleAndKeywords(args,kwargs, \"scc:replace\", argnames, &s, &och, &nch)) {\n\nreturn NULL;\n\n} sdup = (char *) malloc(strlen(s)+1); strcpy(sdup,s); nrep = replace(sdup,och,nch); result = Py_BuildValue(\"(is)\",nrep,sdup); free(sdup); return result;\n\n}\n\nstatic char py_distance_doc[] = \"Computes the distance between two points\"; static PyObject * py_distance(PyObject *self, PyObject *args) {\n\nPyErr_SetString(PyExc_NotImplementedError,\"distance() not implemented.\"); return NULL;\n\n}\n\nstatic PyMethodDef _examplemethods[] = {\n\n{\"gcd\", py_gcd, METH_VARARGS, py_gcd_doc}, {\"replace\", py_replace, METH_VARARGS | METH_KEYWORDS, py_replace_doc}, {\"distance\",py_distance,METH_VARARGS, py_distance_doc}, {NULL, NULL, 0, NULL}\n\n};\n\n#if PY_MAJOR_VERSION < 3 /* Python 2 module initialization */ void init_example(void) {\n\nPyObject *mod; mod = Py_InitModule(\"_example\", _examplemethods); PyModule_AddIntMacro(mod,MAGIC);\n\n} #else /* Python 3 module initialization */ static struct PyModuleDef _examplemodule = {\n\nPyModuleDef_HEAD_INIT, \"_example\", /* name of module */ NULL, /* module documentation, may be NULL */ -1, _examplemethods\n\n}; PyMODINIT_FUNC PyInit__example(void) {\n\nPyObject *mod; mod = PyModule_Create(&_examplemodule); PyModule_AddIntMacro(mod, MAGIC); return mod;\n\n} #endif\n\nExtension modules always need to include \"Python.h\". For each C function to be accessed, a wrapper function is written.These wrapper functions accept either two arguments (self and args, both of type PyObject *) or three arguments (self, args,\n\nF h Lib f L Bdff",
      "content_length": 1772,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 620,
      "content": "Extension Modules\n\n595\n\nand kwargs, all of type PyObject *).The self parameter is used when the wrapper function is implementing a built-in method to be applied to an instance of some object. In this case, the instance is placed in the self parameter. Otherwise, self is set to NULL. args is a tuple containing the function arguments passed by the interpreter. kwargs is a dictionary containing keyword arguments.\n\nArguments are converted from Python to C using the PyArg_ParseTuple() or PyArg_ParseTupleAndKeywords() function. Similarly, the Py_BuildValue() func- tion is used to construct an acceptable return value.These functions are described in later sections.\n\nDocumentation strings for extension functions should be placed in separate string variables such as py_gcd_doc and py_replace_doc as shown.These variables are refer- enced during module initialization (described shortly).\n\nWrapper functions should never, under penalty of certain flaming death, mutate data\n\nreceived by reference from the interpreter.This is why the py_replace() wrapper is making a copy of the received string before passing it to the C function (which modi- fies it in place). If this step is omitted, the wrapper function may violate Python’s string immutability.\n\nIf you want to raise an exception, you use the PyExc_SetString() function as shown in the py_distance() wrapper. NULL is returned to signal that an error has occurred.\n\nThe method table _examplemethods is used to associate Python names with the C\n\nwrapper functions.These are the names used to call the function from the interpreter. The METH_VARARGS flag indicates the calling conventions for a wrapper. In this case, only positional arguments in the form of a tuple are accepted. It can also be set to METH_VARARGS | METH_KEYWORDS to indicate a wrapper function accepting keyword arguments.The method table additionally sets the documentation strings for each wrap- per function.\n\nThe final part of an extension module performs an initialization procedure that varies between Python 2 and Python 3. In Python 2, the module initialization function init_example is used to initialize the contents of the module. In this case, the Py_InitModule(\"_example\",_examplemethods) function creates a module, _example, and populates it with built-in function objects corresponding to the func- tions listed in the method table. For Python 3, you have to create an PyModuleDef object _examplemodule that describes the module.You then write a function PyInit__example() that initializes the module as shown.The module initialization function is also the place where you install constants and other parts of a module, if necessary. For example, the PyModule_AddIntMacro() is adding the value of a pre- processor to the module.\n\nIt is important to note that naming is critically important for module initialization. If\n\nyou are creating a module called modname, the module initialization function must be called initmodname() in Python 2 and PyInit_modname() in Python 3. If you don’t do this, the interpreter won’t be able to correctly load your module.\n\nNaming Extension Modules It is standard practice to name C extension modules with a leading underscore such as '_example'.This convention is followed by the Python standard library itself. For\n\nF h Lib f L Bdff",
      "content_length": 3305,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 621,
      "content": "596\n\nChapter 26 Extending and Embedding Python\n\ninstance, there are modules named _socket, _thread, _sre, and _fileio correspon- ding to the C programming components of the socket, threading, re, and io mod- ules. Generally, you do not use these C extension modules directly. Instead, you create a high-level Python module such as the following:\n\n# example.py from _example import * # Add additional support code below ...\n\nThe purpose of this Python wrapper is to supply additional support code for your module or to provide a higher-level interface. In many cases, it is easier to implement parts of an extension module in Python instead of C.This design makes it easy to do this. If you look at many standard library modules, you will find that they have been implemented as a mix of C and Python in this manner.\n\nCompiling and Packaging Extensions The preferred mechanism for compiling and packaging an extension module is to use distutils.To do this, you create a setup.py file that looks like this:\n\n# setup.py from distutils.core import setup, Extension\n\nsetup(name=\"example\",\n\nversion=\"1.0\", py_modules = ['example.py'], ext_modules = [\n\nExtension(\"_example\",\n\n[\"pyexample.c\",\"example.c\"])\n\n]\n\n)\n\nIn this file, you need to include the high-level Python file (example.py) and the source files making up the extension module (pyexample.c, example.c).To build the module for testing, type the following:\n\n% python setup.py build_ext --inplace\n\nThis will compile the extension code into a shared library and leave it in the current working directory.The name of this library will be _examplemodule.so, _examplemodule.pyd, or some similar variant.\n\nIf the compilation was successful, using your module is straightforward. For example:\n\n% python3.0 Python 3.0 (r30:67503, Dec 4 2008, 09:40:15) [GCC 4.0.1 (Apple Inc. build 5465)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> import example >>> example.gcd(78,120) 6 >>> example.replace(\"Hello World\",' ','-') (1, 'Hello-World') >>> example.distance() Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nNotImplementedError: distance() not implemented. >>>\n\nF h Lib f L Bdff",
      "content_length": 2186,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 622,
      "content": "Extension Modules\n\n597\n\nMore complicated extension modules may need to supply additional build information, such as include directories, libraries, and preprocessor macros.They can also be included in setup.py, as follows:\n\n# setup.py from distutils.core import setup, Extension\n\nsetup(name=\"example\",\n\nversion=\"1.0\", py_modules = ['example.py'], ext_modules = [\n\nExtension(\"_example\",\n\n[\"pyexample.c\",\"example.c\"], include_dirs = [\"/usr/include/X11\",\"/opt/include\"], define_macros = [('DEBUG',1'),\n\n('MONDO_FLAG',1)],\n\nundef_macros = ['HAVE_FOO','HAVE_NOT'], library_dirs= [\"/usr/lib/X11\", \"/opt/lib\"], libraries = [ \"X11\", \"Xt\", \"blah\" ])\n\n]\n\n)\n\nIf you want to install an extension module for general use, you simply type python setup.py install. Further details about this are found in Chapter 8,“Modules, Packages, and Distribution.”\n\nIn some situations, you may want to build an extension module manually.This\n\nalmost always requires advanced knowledge of various compiler and linker options.The following is an example on Linux:\n\nlinux % gcc -c -fpic -I/usr/local/include/python2.6 example.c pyexample.c linux % gcc -shared example.o pyexample.o -o _examplemodule.so\n\nType Conversion from Python to C The following functions are used by extension modules to convert arguments passed from Python to C.Their prototypes are defined by including the Python.h header file.\n\nint PyArg_ParseTuple(PyObject *args, char *format, ...);\n\nParses a tuple of positional arguments in argsinto a series of C variables. formatis a format string containing zero or more of the specifier strings from Tables 26.1–26.3, which describe the expected contents of args.All the remaining arguments contain the addresses of C variables into which the results will be placed.The order and types of these arguments must match the specifiers used in format. Zero is returned if the argu- ments could not be parsed.\n\nint PyArg_ParseTupleAndKeywords(PyObject *args, PyObject *kwargs,\n\nchar *format, char **kwlist, ...);\n\nParses both a tuple of positional arguments and a dictionary of keyword arguments con- tained in kwargs. formathas the same meaning as for PyArg_ParseTuple().The only difference is that kwlistis a null-terminated list of strings containing the names of all the arguments. Returns 1 on success, 0 on error.\n\nTable 26.1 lists the format codes that are placed in the formatargument to convert\n\nnumbers.The C argument type column lists the C data type that should be passed to the PyArg_Parse*() functions. For numbers, it is always a pointer to a location where the result should be stored.\n\nF h Lib f L Bdff",
      "content_length": 2601,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 623,
      "content": "598\n\nChapter 26 Extending and Embedding Python\n\nTable 26.1 Numeric Conversions and Associated C Data Types for PyArg_Parse*\n\nFormat\n\nPython Type\n\nC Argument Type\n\n\"b\"\n\n\"B\"\n\n\"h\"\n\n\"H\"\n\n\"i\"\n\n\"I\"\n\n\"l\"\n\n\"k\"\n\n\"L\"\n\n\"K\"\n\n\"n\"\n\n\"f\"\n\n\"d\"\n\nInteger Integer Integer Integer Integer Integer Integer Integer Integer Integer Integer Float Float Complex\n\nsigned char *r\n\nunsigned char *r\n\nshort *r\n\nunsigned short *r\n\nint *r\n\nunsigned int *r\n\nlong int *r\n\nunsigned long *r\n\nlong long *r\n\nunsigned long long *r\n\nPy_ssize_t *r\n\nfloat *r\n\ndouble *r\n\n\"D\"\n\nPy_complex *r\n\nWhen signed integer values are converted, an OverflowError exception is raised if the Python integer is too large to fit into the requested C data type. However, conversions that accept unsigned values (e.g., 'I', 'H', 'K', and so on) do not check for overflow and will silently truncate the value if it exceeds the supported range. For floating-point conversions, a Python int or float may be supplied as input. In this case, integers will be promoted to a float. User-defined classes are accepted as numbers as long as they provide appropriate conversion methods such as __int__() or __float__(). For example, a user-defined class that implements __int__() will be accepted as input for any of the previously shown integer conversions (and __int__() invoked automatical- ly to do the conversion).\n\nTable 26.2 shows the conversions that apply to strings and bytes. Many of the string\n\nconversions return both a pointer and length as a result.\n\nTable 26.2\n\nString Conversions and Associated C Data Types for PyArg_Parse*\n\nFormat\n\nPython Type\n\nC Argument Type\n\n\"c\"\n\n\"s\"\n\n\"s#\"\n\n\"s*\"\n\n\"z\"\n\n\"z#\"\n\n\"z*\"\n\n\"y\"\n\n\"y#\"\n\n\"y*\"\n\n\"u\"\n\n\"u#\"\n\nString or byte string of length 1 String String, bytes, or buffer String, bytes, or buffer String or None String, bytes, or None String, bytes, buffer, or None Bytes (null-terminated) Bytes Bytes or buffer String (Unicode) String (Unicode) String\n\nchar *r\n\nchar **r\n\nchar **r, int *len\n\nPy_buffer *r\n\nchar **r\n\nchar **r, int *len\n\nPy_buffer *r\n\nchar **r\n\nchar **r, int *len\n\nPy_buffer *r\n\nPy_UNICODE **r\n\nPy_UNICODE **r, int *len\n\n\"es\"\n\nconst char *enc, char **r\n\nF h Lib f L Bdff",
      "content_length": 2156,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 624,
      "content": "Extension Modules\n\n599\n\nTable 26.2\n\nContinued\n\nFormat\n\nPython Type\n\nC Argument Type\n\n\"es#\"\n\nString or bytes\n\nconst char *enc, char **r, int *len\n\n\"et\"\n\nString or null-terminated bytes\n\nconst char *enc, char **r, int *len\n\n\"et#\"\n\nString or bytes\n\nconst char *enc, char **r, int *len\n\n\"t#\"\n\n\"w\"\n\n\"w#\"\n\n\"w*\"\n\nRead-only buffer Read-write buffer Read-write buffer Read-write buffer\n\nchar **r, int *len\n\nchar **r\n\nchar **r, int *len\n\nPy_buffer *r\n\nString handling presents a special problem for C extensions because the char * datatype is used for many different purposes. For instance, it might refer to text, a single character, or a buffer of raw binary data.There is also the issue of what to do with embedded NULL characters ('\\x00') that C uses to signal the end of text strings.\n\nIn Table 26.2, the conversion codes of \"s\", \"z\", \"u\", \"es\", and \"et\" should be used\n\nif you are passing text. For these codes, Python assumes that the input text does not contain any embedded NULLs—if so, a TypeError exception is raised. However, the resulting string in C can be safely assumed to be NULL-terminated. In Python 2, both 8-bit and Unicode strings can be passed, but in Python 3, all conversions except for \"et\" require the Python str type and do not work with bytes.When Unicode strings are passed to C, they are always encoded using the default Unicode encoding used by the interpreter (usually UTF-8).The one exception is the \"u\" conversion code that returns a string using Python’s internal Unicode representation.This is an array of Py_UNICODE values where Unicode characters are typically represented by the wchar_t type in C.\n\nThe \"es\" and \"et\" codes allow you to specify an alternative encoding for the text.\n\nFor these, you supply an encoding name such as 'utf-8' or 'iso-8859-1', and the text will be encoded into a buffer and returned in that format.The \"et\" code differs from \"es\" in that if a Python byte-string is given, it is assumed to have already been encoded and is passed through unmodified. One caution with \"es\" and \"et\" conver- sions is that they dynamically allocate memory for the result and require the user to explicitly release it using PyMem_Free().Thus, code that uses these conversions should look similar to this:\n\nPyObject *py_wrapper(PyObject *self, PyObject *args) {\n\nchar *buffer; if (!PyArg_ParseTuple(args,\"es\",\"utf-8\",&buffer)) {\n\nreturn NULL;\n\n} /* Do something. */ ... /* Cleanup and return the result */ PyMem_Free(buffer); return result;\n\n}\n\nF h Lib f L Bdff",
      "content_length": 2496,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 625,
      "content": "600\n\nChapter 26 Extending and Embedding Python\n\nFor handling text or binary data, use the \"s#\", \"z#\", \"u#\", \"es#\", or \"et#\" codes. These conversions work exactly the same as before except that they additionally return a length. Because of this, the restriction on embedded NULL characters is lifted. In addition, these conversions add support for byte strings and any other objects that sup- port something known as the buffer interface.The buffer interface is a means by which a Python object can expose a raw binary buffer representing its contents.Typically, you find it on strings, bytes, and arrays (e.g., the arrays created in the array module support it). In this case, if an object provides a readable buffer interface, a pointer to the buffer and its size is returned. Finally, if a non-NULL pointer and length are given to the \"es#\" and \"et#\" conversions, it is assumed that these represent a pre-allocated buffer into which the result of the encoding can be placed. In this case, the interpreter does not allocate new memory for the result and you don’t have to call PyMem_Free().\n\nThe conversion codes of \"s*\" and \"z*\" are similar to \"s#\" and \"z#\" except that they populate a Py_buffer structure with information about the received data. More information about this can be found in PEP-3118, but this structure minimally has attributes char *buf, int len, and int itemsize that point to the buffer, the buffer length (in bytes), and the size of items held in the buffer. In addition, the interpreter places a lock on the buffer that prevents it from being changed by other threads as long as it is held by extension code.This allows the extension to work with the buffer con- tents independently, possibly in a different thread than the interpreter. It is up to the user to call PyBuffer_Release() on the buffer after all processing is complete.\n\nThe conversion codes of \"t#\", \"w\", \"w#\", and \"w*\" are just like the \"s\" family of\n\ncodes except that they only accept objects implementing the buffer interface. \"t#\" requires the buffer to be readable.The \"w\" code requires the buffer to be both readable and writable.A Python object supporting a writable buffer is assumed to be mutable. Thus, it is legal for a C extension to overwrite or modify the buffer contents.\n\nThe conversion codes of \"y\", \"y#\", and \"y*\" are just like the \"s\" family of codes except that they only accept byte strings. Use these to write functions that must only take bytes, not Unicode strings.The \"y\" code only accepts byte strings that do not con- tain embedded NULL characters.\n\nTable 26.3 lists conversion codes that are used to accept arbitrary Python objects as\n\ninput and to leave the result as type PyObject *.These are sometimes used for C extensions that need to work with Python objects that are more complicated than sim- ple numbers or strings—for example, if you needed a C extension function to accept an instance of a Python class or dictionary.\n\nTable 26.3 Python Object Conversions and Associated C Data Types for PyArg_Parse*\n\nFormat Python Type C Type\n\n\"O\"\n\n\"O!\"\n\n\"O&\"\n\n\"S\"\n\n\"U\"\n\nAny Any Any String Unicode\n\nPyObject **r\n\nPyTypeObject *type, PyObject **r\n\nint (*converter)(PyObject *, void *), void *r\n\nPyObject **r\n\nPyObject **r\n\nF h Lib f L Bdff",
      "content_length": 3252,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 626,
      "content": "Extension Modules\n\n601\n\nThe \"O\", \"S\", and \"U\" specifiers return raw Python objects of type PyObject *. \"S\" and \"U\" restrict this object to be a string or Unicode string, respectively.\n\nThe \"O!\" conversion requires two C arguments: a pointer to a Python type object\n\nand a pointer to a PyObject * into which a pointer to the object is placed.A TypeError is raised if the type of the object doesn’t match the type object. For example:\n\n/* Parse a List Argument */ PyObject *listobj; PyArg_ParseTuple(args,\"O!\", &PyList_Type, &listobj);\n\nThe following list shows the C type names corresponding to some Python container types that might be commonly used with this conversion.\n\nC Name PyList_Type\n\nPython Type list\n\nPyDict_Type\n\ndict\n\nPySet_Type\n\nset\n\nPyFrozenSet_Type\n\nfrozen_set\n\nPyTuple_Type\n\ntuple\n\nPySlice_Type\n\nslice\n\nPyByteArray_Type\n\nbytearray\n\nThe \"O&\" conversion takes two arguments (converter, addr) and uses a function to convert a PyObject * to a C data type. converteris a pointer to a function with the prototype int converter(PyObject *obj, void *addr), where objis the passed Python object and addris the address supplied as the second argument in PyArg_ParseTuple(). converter() should return 1 on success, 0 on failure. On error, the converter should also raise an exception.This kind of conversion can be used to map Python objects such as lists or tuples into C data structures. For example, here is a possible implementation of the distance() wrapper from our earlier code:\n\n/* Convert a tuple into a Point structure. */ int convert_point(PyObject *obj, void *addr) {\n\nPoint *p = (Point *) addr; return PyArg_ParseTuple(obj,\"ii\", &p->x, &p->y);\n\n} PyObject *py_distance(PyObject *self, PyObject *args) {\n\nPoint p1, p2; double result; if (!PyArg_ParseTuple(args,\"O&O&\",\n\nconvert_point, &p1, convert_point, &p2)) {\n\nreturn NULL;\n\n} result = distance(&p1,&p2); return Py_BuildValue(\"d\",result);\n\n}\n\nF h Lib f L Bdff",
      "content_length": 1929,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 627,
      "content": "602\n\nChapter 26 Extending and Embedding Python\n\nFinally, argument format strings can contain a few additional modifiers related to tuple unpacking, documentation, error messages, and default arguments.The following is a list of these modifiers:\n\nFormat String \"(items)\"\n\n\"|\"\n\n\":\"\n\n\";\"\n\nDescription Unpack a tuple of objects. Items consist of format conversions. Start of optional arguments. End of arguments. The remaining text is the function name. End of arguments. The remaining text is the error message.\n\nThe \"(items)\" unpacks values from a Python tuple.This can be a useful way to map tuples into simple C structures. For example, here is another possible implementation of the py_distance() wrapper function:\n\nPyObject *py_distance(PyObject *self, PyObject *args) {\n\nPoint p1, p2; double result; if (!PyArg_ParseTuple(args,\"(dd)(dd)\",\n\n&p1.x, &p1.y, &p2.x, &p2.y)) {\n\nreturn NULL;\n\n} result = distance(&p1,&p2); return Py_BuildValue(\"d\",result);\n\n}\n\nThe modifier \"|\" specifies that all remaining arguments are optional.This can appear only once in a format specifier and cannot be nested.The modifier \":\" indicates the end of the arguments.Any text that follows is used as the function name in any error messages.The modifier \";\" signals the end of the arguments.Any following text is used as the error message. Note that only one of : and ; should be used. Here are some examples:\n\nPyArg_ParseTuple(args,\"ii:gcd\", &x, &y); PyArg_ParseTuple(args,\"ii; gcd requires 2 integers\", &x, &y);\n\n/* Parse with optional arguments */ PyArg_ParseTuple(args,\"s|s\", &buffer, &delimiter);\n\nType Conversion from C to Python The following C function is used to convert the values contained in C variables to a Python object:\n\nPyObject *Py_BuildValue(char *format, ...)\n\nThis constructs a Python object from a series of C variables. formatis a string describ- ing the desired conversion.The remaining arguments are the values of C variables to be converted.\n\nThe formatspecifier is similar to that used with the PyArg_ParseTuple* func-\n\ntions, as shown in Table 26.4.\n\nF h Lib f L Bdff",
      "content_length": 2074,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 628,
      "content": "Table 26.4\n\nFormat\n\n\"\"\n\n\"s\"\n\n\"s#\"\n\n\"y\"\n\n\"y#\"\n\n\"z\"\n\n\"z#\"\n\n\"u\"\n\n\"u#\"\n\n\"U\"\n\n\"U#\"\n\n\"b\"\n\n\"B\"\n\n\"h\"\n\n\"H\"\n\n\"i\"\n\n\"I\"\n\n\"l\"\n\n\"L\"\n\n\"k\"\n\n\"K\"\n\n\"n\"\n\n\"c\"\n\n\"f\"\n\n\"d\"\n\n\"D\"\n\n\"O\"\n\nExtension Modules\n\n603\n\nFormat Specifiers for Py_BuildValue()\n\nPython Type\n\nC Type\n\nDescription\n\nNone String\n\nNothing. Null-terminated string. If the C string pointer is NULL, None is returned. String and length. May contain null bytes. If the C string point- er is NULL, None is returned. Same as \"s\" except a byte string is returned. Same as \"s# except a byte string is returned. Same as \"s\". Same as \"s#\". Null-terminated Unicode string. If the string pointer is NULL, None is returned. Unicode string and length. Converts a null-terminated C string into a Unicode string. Converts a C string into Unicode. 8-bit integer. 8-bit unsigned integer. Short 16-bit integer. Unsigned short 16-bit integer. Integer. Unsigned integer Long integer. Unsigned long integer. Long long.\n\nvoid\n\nchar *\n\nString\n\nchar *, int\n\nBytes\n\nchar *\n\nchar *, int\n\nBytes\n\nString or None char * String or None char *, int Unicode\n\nPy_UNICODE *\n\nPy_UNICODE *\n\nUnicode Unicode\n\nchar *\n\nUnicode\n\nchar *, int\n\nchar\n\nInteger Integer Integer Integer Integer Integer Integer Integer Integer Integer Integer String\n\nunsigned char\n\nshort\n\nunsigned short\n\nint\n\nunsigned int\n\nlong\n\nunsigned long\n\nlong long unsigned long long Unsigned long long. Py_ssize_t\n\nPython size type. Single character. Creates a Python string of length 1. Single-precision floating point. Double-precision floating point. Complex number. Any Python object. The object is unchanged except for its ref- erence count, which is incre- mented by 1. If a NULL pointer is given, a NULL pointer is returned. This is useful if an error has been signaled else- where and you want it to propa- gate.\n\nchar\n\nfloat\n\nFloat Float Complex Any\n\ndouble\n\nPy_complex\n\nPyObject *\n\nF h Lib f L Bdff",
      "content_length": 1873,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 629,
      "content": "604\n\nChapter 26 Extending and Embedding Python\n\nTable 26.4\n\nContinued\n\nFormat\n\nPython Type\n\nC Type\n\nDescription\n\n\"O&\"\n\nAny\n\n\"S\"\n\n\"N\"\n\nString Any\n\n\"(items)\" Tuple\n\n\"[items]\" List\n\nconverter, any\n\nPyObject *\n\nPyObject *\n\nvars\n\nvars\n\nC data processed through a converter function. Same as \"O\". Same as \"O\" except that the reference count is not incre- mented. Creates a tuple of items. itemsis a string of format specifiers from this table. varsis a list of C variables corresponding to the items in items. Creates a list of items. items is a string of format specifiers. varsis a list of C variables corresponding to the items in items. Creates a dictionary of items.\n\n\"{items}\" Dictionary\n\nvars\n\nHere are some examples of building different kinds of values:\n\nPy_BuildValue(\"\") None Py_BuildValue(\"i\",37) 37 Py_BuildValue(\"ids\",37,3.4,\"hello\") (37, 3.5, \"hello\") Py_BuildValue(\"s#\",\"hello\",4) \"hell\" Py_BuildValue(\"()\") () Py_BuildValue(\"(i)\",37) (37,) Py_BuildValue(\"[ii]\",1,2) [1,2] Py_BuildValue(\"[i,i]\",1,2) [1,2] Py_BuildValue(\"{s:i,s:i}\",\"x\",1,\"y\",2) {'x':1, 'y':2}\n\nFor Unicode string conversions involving char *, it is assumed that the data consists of a series of bytes encoded using the default Unicode encoding (usually UTF-8).The data will be automatically decoded into a Unicode string when passed to Python.The only exceptions are the \"y\" and \"y#\" conversions that return a raw byte string.\n\nAdding Values to a Module In the module initialization function of an extension module, it is common to add con- stants and other support values.The following functions can be used to do this:\n\nint PyModule_AddObject(PyObject *module, const char *name, PyObject *value)\n\nAdds a new value to a module. nameis the name of the value, and valueis a Python object containing the value.You can build this value using Py_BuildValue().\n\nint PyModule_AddIntConstant(PyObject *module, const char *name, long value)\n\nAdds an integer value to a module.\n\nvoid PyModule_AddStringConstant(PyObject *module, const char *name, const char *value)\n\nAdds a string value to a module. valuemust be a null-terminated string.\n\nF h Lib f L Bdff",
      "content_length": 2124,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 630,
      "content": "Extension Modules\n\n605\n\nvoid PyModule_AddIntMacro(PyObject *module, macro)\n\nAdds a macro value to a module as an integer. macromust be the name of preprocessor macro.\n\nvoid PyModule_AddStringMacro(PyObject *module, macro)\n\nAdds a macro value to a module as a string.\n\nError Handling Extension modules indicate errors by returning NULL to the interpreter. Prior to return- ing NULL, an exception should be set using one of the following functions:\n\nvoid PyErr_NoMemory()\n\nRaises a MemoryError exception.\n\nvoid PyErr_SetFromErrno(PyObject *exc)\n\nRaises an exception. excis an exception object.The value of the exception is taken from the errno variable in the C library.\n\nvoid PyErr_SetFromErrnoWithFilename(PyObject *exc, char *filename)\n\nLike PyErr_SetFromErrno(), but includes the file name in the exception value as well.\n\nvoid PyErr_SetObject(PyObject *exc, PyObject *val)\n\nRaises an exception. excis an exception object, and valis an object containing the value of the exception.\n\nvoid PyErr_SetString(PyObject *exc, char *msg)\n\nRaises an exception. excis an exception object, and msgis a message describing what went wrong.\n\nThe excargument in these functions can be set to one of the following:\n\nC Name PyExc_ArithmeticError\n\nPython Exception ArithmeticError\n\nPyExc_AssertionError\n\nAssertionError\n\nPyExc_AttributeError\n\nAttributeError\n\nPyExc_EnvironmentError\n\nEnvironmentError\n\nPyExc_EOFError\n\nEOFError\n\nPyExc_Exception\n\nException\n\nPyExc_FloatingPointError\n\nFloatingPointError\n\nPyExc_ImportError\n\nImportError\n\nPyExc_IndexError\n\nIndexError\n\nPyExc_IOError\n\nIOError\n\nPyExc_KeyError\n\nKeyError\n\nPyExc_KeyboardInterrupt\n\nKeyboardInterrupt\n\nPyExc_LookupError\n\nLookupError\n\nPyExc_MemoryError\n\nMemoryError\n\nPyExc_NameError\n\nNameError\n\nPyExc_NotImplementedError\n\nNotImplementedError\n\nF h Lib f L Bdff",
      "content_length": 1796,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 631,
      "content": "606\n\nChapter 26 Extending and Embedding Python\n\nC Name PyExc_OSError\n\nPython Exception OSError\n\nPyExc_OverflowError\n\nOverflowError\n\nPyExc_ReferenceError\n\nReferenceError\n\nPyExc_RuntimeError\n\nRuntimeError\n\nPyExc_StandardError\n\nStandardError\n\nPyExc_StopIteration\n\nStopIteration\n\nPyExc_SyntaxError\n\nSyntaxError\n\nPyExc_SystemError\n\nSystemError\n\nPyExc_SystemExit\n\nSystemExit\n\nPyExc_TypeError\n\nTypeError\n\nPyExc_UnicodeError\n\nUnicodeError\n\nPyExc_UnicodeEncodeError\n\nUnicodeEncodeError\n\nPyExc_UnicodeDecodeError\n\nUnicodeDecodeError\n\nPyExc_UnicodeTranslateError\n\nUnicodeTranslateError\n\nPyExc_ValueError\n\nValueError\n\nPyExc_WindowsError\n\nWindowsError\n\nPyExc_ZeroDivisionError\n\nZeroDivisionError\n\nThe following functions are used to query or clear the exception status of the interpreter:\n\nvoid PyErr_Clear()\n\nClears any previously raised exceptions.\n\nPyObject *PyErr_Occurred()\n\nChecks to see whether or not an exception has been raised. If so, the current exception value is returned. Otherwise, NULL is returned.\n\nint PyErr_ExceptionMatches(PyObject *exc)\n\nChecks to see if the current exception matches the exception exc. Returns 1 if true, 0 otherwise.This function follows the same exception matching rules as in Python code. Therefore, exccould be a superclass of the current exception or a tuple of exception classes.\n\nThe following prototype shows how to implement a try-except block in C:\n\n/* Carry out some operation involving Python objects */ if (PyErr_Occurred()) {\n\nif (PyErr_ExceptionMatches(PyExc_ValueError)) { /* Take some kind of recovery action */ ... PyErr_Clear(); return result; /* A valid PyObject * */\n\n} else {\n\nreturn NULL; /* Propagate the exception to the interpreter */\n\n}\n\n}\n\nF h Lib f L Bdff",
      "content_length": 1711,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 632,
      "content": "Extension Modules\n\n607\n\nReference Counting Unlike programs written in Python, C extensions may have to manipulate the reference count of Python objects.This is done using the following macros, all of which are applied to objects of type PyObject *.\n\nMacro Py_INCREF(obj) Increments the reference count of obj, which must be non-null. Py_DECREF(obj) Decrements the reference count of obj, which must be non-null. Py_XINCREF(obj) Increments the reference count of obj, which may be null. Py_XDECREF(obj) Decrements the reference count of obj, which may be null.\n\nDescription\n\nManipulating the reference count of Python objects in C is a delicate topic, and readers are strongly advised to consult the “Extending and Embedding the Python Interpreter” document available at http://docs.python.org/extending before proceeding any further. As a general rule, it is not necessary to worry about reference counting in C extension functions except in the following cases:\n\nn If you save a reference to a Python object for later use or in a C structure, you\n\nmust increase the reference count.\n\nn Similarly, to dispose of an object that was previously saved, decrease its reference\n\ncount.\n\nn If you are manipulating Python containers (lists, dicts, and so on) from C, you may have to manually manipulate reference counts of the individual items. For example, high-level operations that get or set items in a container typically increase the reference count.\n\nYou will know that you have a reference counting problem if your extension code crashes the interpreter (you forgot to increase the reference count) or the interpreter leaks memory as your extension functions are used (you forgot to decrease a reference count).\n\nThreads A global interpreter lock is used to prevent more than one thread from executing in the interpreter at once. If a function written in an extension module executes for a long time, it will block the execution of other threads until it completes.This is because the lock is held whenever an extension function is invoked. If the extension module is thread-safe, the following macros can be used to release and reacquire the global inter- preter lock:\n\nPy_BEGIN_ALLOW_THREADS\n\nReleases the global interpreter lock and allows other threads to run in the interpreter. The C extension must not invoke any functions in the Python C API while the lock is released.\n\nPy_END_ALLOW_THREADS\n\nReacquires the global interpreter lock.The extension will block until the lock can be acquired successfully in this case.\n\nF h Lib f L Bdff",
      "content_length": 2540,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 633,
      "content": "608\n\nChapter 26 Extending and Embedding Python\n\nThe following example illustrates the use of these macros:\n\nPyObject *py_wrapper(PyObject *self, PyObject *args) {\n\n... PyArg_ParseTuple(args, ...) Py_BEGIN_ALLOW_THREADS result = run_long_calculation(args); Py_END_ALLOW_THREADS ... return Py_BuildValue(fmt,result);\n\n}\n\nEmbedding the Python Interpreter The Python interpreter can also be embedded into C applications.With embedding, the Python interpreter operates as a programming library where C programs can initialize the interpreter, have the interpreter run scripts and code fragments, load library mod- ules, and manipulate functions and objects implemented in Python.\n\nAn Embedding Template With embedding, your C program is in charge of the interpreter. Here is a simple C program that illustrates the most minimal embedding possible:\n\n#include <Python.h>\n\nint main(int argc, char **argv) {\n\nPy_Initialize(); PyRun_SimpleString(\"print('Hello World')\"); Py_Finalize(); return 0;\n\n}\n\nIn this example, the interpreter is initialized, a short script is executed as a string, and the interpreter is shut down. Before proceeding any further, it is usually a good idea to get the prior example working first.\n\nCompilation and Linking To compile an embedded interpreter on UNIX, your code must include the \"Python.h\" header file and link against the interpreter library such as libpython2.6.a.The header file is typically found in /usr/local/include/python2.6, and the library is typically found in /usr/local/lib/python2.6/config. For Windows, you will need to locate these files in the Python installation directory. Be aware that the interpreter may depend on other libraries you need to include when linking. Unfortunately, this tends to be platform-specific and related to how Python was configured on your machine—you may have to fiddle around for a bit.\n\nBasic Interpreter Operation and Setup The following functions are used to set up the interpreter and to run scripts:\n\nint PyRun_AnyFile(FILE *fp, char *filename)\n\nIf fpis an interactive device such as tty in UNIX, this function calls PyRun_InteractiveLoop(). Otherwise, PyRun_SimpleFile() is called. filenameis\n\nF h Lib f L Bdff",
      "content_length": 2190,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 634,
      "content": "Embedding the Python Interpreter\n\n609\n\na string that gives a name for the input stream.This name will appear when the inter- preter reports errors. If filenameis NULL, a default string of \"???\" is used as the file name.\n\nint PyRun_SimpleFile(FILE *fp, char *filename)\n\nSimilar to PyRun_SimpleString(), except that the program is read from the file fp.\n\nint PyRun_SimpleString(char *command)\n\nExecutes commandin the __main__ module of the interpreter. Returns 0 on success, -1 if an exception occurred.\n\nint PyRun_InteractiveOne(FILE *fp, char *filename)\n\nExecutes a single interactive command.\n\nint PyRun_InterativeLoop(FILE *fp, char *filename)\n\nRuns the interpreter in interactive mode.\n\nvoid Py_Initialize()\n\nInitializes the Python interpreter.This function should be called before using any other functions in the C API, with the exception of Py_SetProgramName(), PyEval_InitThreads(), PyEval_ReleaseLock(), and PyEval_AcquireLock().\n\nint Py_IsInitialized()\n\nReturns 1 if the interpreter has been initialized, 0 if not.\n\nvoid Py_Finalize()\n\nCleans up the interpreter by destroying all the sub-interpreters and objects that were created since calling Py_Initialize(). Normally, this function frees all the memory allocated by the interpreter. However, circular references and extension modules may introduce memory leaks that cannot be recovered by this function.\n\nvoid Py_SetProgramName(char *name)\n\nSets the program name that’s normally found in the argv[0] argument of the sys module.This function should only be called before Py_Initialize().\n\nchar *Py_GetPrefix()\n\nReturns the prefix for installed platform-independent files.This is the same value as found in sys.prefix.\n\nchar *Py_GetExecPrefix()\n\nReturns the exec-prefix for installed platform-dependent files.This is the same value as found in sys.exec_prefix.\n\nchar *Py_GetProgramFullPath()\n\nReturns the full path name of the Python executable.\n\nchar *Py_GetPath()\n\nReturns the default module search path.The path is returned as a string consisting of directory names separated by a platform-dependent delimiters (: on UNIX, ; on DOS/Windows).\n\nF h Lib f L Bdff",
      "content_length": 2123,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 635,
      "content": "610\n\nChapter 26 Extending and Embedding Python\n\nint PySys_SetArgv(int argc, char **argv)\n\nSets command-line options used to populate the value of sys.argv.This should only be called before Py_Initialize().\n\nAccessing Python from C Although there are many ways that the interpreter can be accessed from C, four essen- tial tasks are the most common with embedding:\n\nn Importing Python library modules (emulating the import statement) n Getting references to objects defined in modules n Calling Python functions, classes, and methods n Accessing the attributes of objects (data, methods, and so on)\n\nAll of these operations can be carried out using these basic operations defined in the Python C API:\n\nPyObject *PyImport_ImportModule(const char *modname)\n\nImports a module modnameand returns a reference to the associated module object.\n\nPyObject *PyObject_GetAttrString(PyObject *obj, const char *name)\n\nGets an attribute from an object.This is the same as obj.name.\n\nint PyObject_SetAttrString(PyObject *obj, const char *name, PyObject *value)\n\nSets an attribute on an object.This is the same as obj.name = value.\n\nPyObject *PyEval_CallObject(PyObject *func, PyObject *args)\n\nCalls funcwith arguments args. funcis a Python callable object (function, method, class, and so on). argsis a tuple of arguments.\n\nPyObject * PyEval_CallObjectWithKeywords(PyObject *func, PyObject *args, PyObject *kwargs)\n\nCalls funcwith positional arguments argsand keyword arguments kwargs. funcis a callable object, argsis a tuple, and kwargsis a dictionary.\n\nThe following example illustrates the use of these functions by calling and using var-\n\nious parts of the re module from C.This program prints out all of the lines read from stdin that contain a Python regular expression supplied by the user.\n\n#include \"Python.h\"\n\nint main(int argc, char **argv) {\n\nPyObject *re; PyObject *re_compile; PyObject *pat; PyObject *pat_search; PyObject *args; char buffer[256];\n\nif (argc != 2) {\n\nfprintf(stderr,\"Usage: %s pattern\\n\",argv[0]); exit(1);\n\n}\n\nPy_Initialize();\n\nF h Lib f L Bdff",
      "content_length": 2060,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 636,
      "content": "Embedding the Python Interpreter\n\n611\n\n/* import re */ re = PyImport_ImportModule(\"re\");\n\n/* pat = re.compile(pat,flags) */ re_compile = PyObject_GetAttrString(re,\"compile\"); args = Py_BuildValue(\"(s)\", argv[1]); pat = PyEval_CallObject(re_compile, args); Py_DECREF(args);\n\n/* pat_search = pat.search - bound method*/ pat_search = PyObject_GetAttrString(pat,\"search\");\n\n/* Read lines and perform matches */ while (fgets(buffer,255,stdin)) {\n\nPyObject *match; args = Py_BuildValue(\"(s)\", buffer);\n\n/* match = pat.search(buffer) */ match = PyEval_CallObject(pat_search,args); Py_DECREF(args); if (match != Py_None) {\n\nprintf(\"%s\",buffer);\n\n} Py_XDECREF(match);\n\n} Py_DECREF(pat); Py_DECREF(re_compile); Py_DECREF(re); Py_Finalize(); return 0;\n\n}\n\nIn any embedding code, it is critically important to properly manage reference counts. In particular, you will need to decrease the reference count on any objects created from C or returned to C as a result of evaluating functions.\n\nConverting Python Objects to C A major problem with embedded use of the interpreter is converting the result of a Python function or method call into a suitable C representation.As a general rule, you need to know in advance exactly what kind of data an operation is going to return. Sadly, there is no high-level convenience function like PyArg_ParseTuple() for con- verting a single object value. However, the following lists some low-level conversion functions that will convert a few primitive Python data types into an appropriate C rep- resentation as long as you know exactly what kind of Python object you are working with:\n\nPython-to-C Conversion Functions long PyInt_AsLong(PyObject *)\n\nlong PyLong_AsLong(PyObject *)\n\ndouble PyFloat_AsDouble(PyObject *) char *PyString_AsString(PyObject *) (Python 2 only) char *PyBytes_AsString(PyObject *) (Python 3 only)\n\nFor any types more complicated than this, you will need to consult the C API docu- mentation (http://docs.python.org/c-api).\n\nF h Lib f L Bdff",
      "content_length": 1989,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 637,
      "content": "612\n\nChapter 26 Extending and Embedding Python\n\nctypes The ctypes module provides Python with access to C functions defined in DLLs and shared libraries.Although you need to know some details about the underlying C library (names, calling arguments, types, and so on), you can use ctypes to access C code without having to write C extension wrapper code or compile anything with a C compiler. ctypes is a sizable library module with a lot of advanced functionality. Here, we cover the essential parts of it that are needed to get going.\n\nLoading Shared Libraries The following classes are used to load a C shared library and return an instance repre- senting its contents:\n\nCDLL(name [, mode [, handle [, use_errno [, use_last_error]]]])\n\nA class representing a standard C shared library. nameis the name of the library such as 'libc.so.6' or 'msvcrt.dll'. modeprovides flags that determine how the library is loaded and are passed to the underlying dlopen() function on UNIX. It can be set to the bitwise-or of RTLD_LOCAL, RTLD_GLOBAL, or RTLD_DEFAULT (the default). On Windows, modeis ignored. handlespecifies a handle to an already loaded library (if available). By default, it is None. use_errnois a Boolean flag that adds an extra layer of safety around the handling of the C errno variable in the loaded library.This layer saves a thread-local copy of errno prior to calling any foreign function and restores the value afterwards. By default, use_errnois False. use_last_erroris a Boolean flag that enables a pair of functions get_last_error() and set_last_error() that can be used to manipulate the system error code.These are more commonly used on Windows. By default, use_last_erroris False.\n\nWinDLL(name [, mode [, handle [, use_errno [, use_last_error]]]])\n\nThe same as CDLL() except that the functions in the library are assumed to follow the Windows stdcall calling conventions (Windows).\n\nThe following utility function can be used to locate shared libraries on the system and construct a name suitable for use as the nameparameter in the previous classes. It is defined in the ctypes.util submodule:\n\nfind_library(name)\n\nDefined in ctypes.util. Returns a path name corresponding to the library name. nameis a library name without any file suffix such as 'libc', 'libm', and so on The string returned by the function is a full path name such as '/usr/lib/libc.so.6'. The behavior of this function is highly system-dependent and depends on the under- lying configuration of shared libraries and environment (for example, the setting of LD_LIBRARY_PATH and other parameters). Returns None if the library can’t be located.\n\nForeign Functions The shared library instances created by the CDLL() class operates as a proxy to the underlying C library.To access library contents, you just use attribute lookup (the oper- ator). For example:\n\nF h Lib f L Bdff",
      "content_length": 2864,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 638,
      "content": "Embedding the Python Interpreter\n\n613\n\n>>> import ctypes >>> libc = ctypes.CDLL(\"/usr/lib/libc.dylib\") >>> libc.rand() 16807 >>> libc.atoi(\"12345\") 12345 >>>\n\nIn this example, operations such as libc.rand() and libc.atoi() are directly calling functions in the loaded C library.\n\nctypes assumes that all functions accept parameters of type int or char * and return results of type int.Thus, even though the previous function calls “worked,” calls to other C library functions do not work as expected. For example:\n\n>>> libc.atof(\"34.5\") -1073746168 >>>\n\nTo address this problem, the type signature and handling of any foreign function func can be set by changing the following attributes:\n\nfunc.argtypes\n\nA tuple of ctypes datatypes (described here) describing the input arguments to func.\n\nfunc.restype\n\nA ctypes datatype describing the return value of func. None is used for functions returning void.\n\nfunc.errcheck\n\nA Python callable object taking three parameters (result, func, args) where resultis the value returned by a foreign function, funcis a reference to the foreign function itself, and argsis a tuple of the input arguments.This function is called after a foreign function call and can be used to perform error checking and other actions.\n\nHere is an example of fixing the atof() function interface, as shown in the previous\n\nexample:\n\n>>> libc.atof.restype=ctypes.c_double >>> libc.atof(\"34.5\") 34.5 >>>\n\nThe ctypes.d_double is a reference to a predefined datatype.The next section describes these datatypes.\n\nDatatypes Table 26.5 shows the ctypes datatypes that can be used in the argtypes and restype attributes of foreign functions.The “Python Value” column describes the type of Python data that is accepted for the given data type.\n\nF h Lib f L Bdff",
      "content_length": 1770,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 639,
      "content": "614\n\nChapter 26 Extending and Embedding Python\n\nTable 26.5\n\nctypes Datatypes\n\nctypes Type Name\n\nC Datatype\n\nPython Value\n\nc_bool\n\nc_bytes\n\nc_char\n\nc_char_p\n\nc_double\n\nc_longdouble\n\nc_float\n\nc_int\n\nc_int8\n\nc_int16\n\nc_int32\n\nc_int64\n\nc_long\n\nc_longlong\n\nc_short\n\nc_size_t\n\nc_ubyte\n\nc_uint\n\nc_uint8\n\nc_uint16\n\nc_uint32\n\nc_uint64\n\nc_ulong\n\nc_ulonglong\n\nc_ushort\n\nbool\n\nsigned char\n\nchar\n\nchar *\n\ndouble\n\nlong double\n\nfloat\n\nint\n\nsigned char\n\nshort\n\nint\n\nlong long\n\nlong\n\nlong long\n\nshort\n\nsize_t\n\nunsigned char\n\nunsigned int\n\nunsigned char\n\nunsigned short\n\nunsigned int\n\nunsigned long long\n\nunsigned long\n\nunsigned long long\n\nunsigned short\n\nTrue or False Small integer Single character Null-terminated string or bytes Floating point Floating point Floating point Integer 8-bit integer 16-bit integer 32-bit integer 64-bit integer Integer Integer Integer Integer Unsigned integer Unsigned integer 8-bit unsigned integer 16-bit unsigned integer 32-bit unsigned integer 64-bit unsigned integer Unsigned integer Unsigned integer Unsigned integer Integer Single Unicode character Null-terminated Unicode\n\nc_void_p\n\nvoid *\n\nc_wchar\n\nwchar_t\n\nc_wchar_p\n\nwchar_t *\n\nTo create a type representing a C pointer, apply the following function to one of the other types:\n\nPOINTER(type)\n\nDefines a type that is a pointer to type type. For example, POINTER(c_int) represents the C type int *.\n\nTo define a type representing a fixed-size C array, multiply an existing type by the number of array dimensions. For example, c_int*4 represents the C datatype int[4]. To define a type representing a C structure or union, you inherit from one of the base classes Structure or Union.Within each derived class, you define a class variable _fields_ that describes the contents. _fields_ is a list of 2 or 3 tuples of the form (name, ctype) or (name, ctype, width), where nameis an identifier for the\n\nF h Lib f L Bdff",
      "content_length": 1889,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 640,
      "content": "Embedding the Python Interpreter\n\n615\n\nstructure field, ctypeis a ctype class describing the type, and widthis an integer bit- field width. For example, consider the following C structure:\n\nstruct Point {\n\ndouble x, y;\n\n};\n\nThe ctypes description of this structure is\n\nclass Point(Structure):\n\n_fields_ = [ (\"x\", c_double),\n\n(\"y\", c_double) ]\n\nCalling Foreign Functions To call functions in a library, you simply call the appropriate function with a set of arguments that are compatible with its type signature. For simple datatypes such as c_int, c_double, and so forth, you can just pass compatible Python types as input (integers, floats, and so on). It is also possible to pass instances of c_int, c_double and similar types as input. For arrays, you can just pass a Python sequence of compatible types.\n\nTo pass a pointer to a foreign function, you must first create a ctypes instance that represents the value that will be pointed at and then create a pointer object using one of the following functions:\n\nbyref(cvalue [, offset])\n\nRepresents a lightweight pointer to cvalue. cvaluemust be an instance of a ctypes datatype. offsetis a byte offset to add to the pointer value.The value returned by the function can only be used in function calls.\n\npointer(cvalue)\n\nCreates a pointer instance pointing to cvalue. cvaluemust be an instance of a ctypes datatype.This creates an instance of the POINTER type described earlier.\n\nHere is an example showing how you would pass a parameter of type double *\n\ninto a C function:\n\ndval = c_double(0.0) # Create a double instance r = foo(byref(dval)) # Calls foo(&dval)\n\np_dval = pointer(dval) # Creates a pointer variable r = foo(p_dval) # Calls foo(p_dval)\n\n# Inspect the value of dval afterwards print (dval.value)\n\nIt should be noted that you cannot create pointers to built-in types such as int or float. Passing pointers to such types would violate mutability if the underlying C function changed the value.\n\nThe cobj.value attribute of a ctypes instance cobjcontains the internal data. For example, the reference to dval.value in the previous code returns the floating-point value stored inside the ctypes c_double instance dval.\n\nF h Lib f L Bdff",
      "content_length": 2197,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 641,
      "content": "616\n\nChapter 26 Extending and Embedding Python\n\nTo pass a structure to a C function, you must create an instance of the structure or union.To do this, you call a previous defined structure or union type StructureType as follows:\n\nStructureType(*args, **kwargs)\n\nCreates an instance of StructureTypewhere StructureTypeis a class derived from Structure or Union. Positional arguments in *argsare used to initialize the structure members in the same order as they are listed in _fields_. Keyword arguments in **kwargsinitialize just the named structure members.\n\nAlternative Type Construction Methods All instances of ctypes types such as c_int, POINTER, and so forth have some class methods that are used to create instances of ctypes types from memory locations and other objects.\n\nty.from_buffer(source [,offset])\n\nCreates an instance of ctypes type tythat shares the same memory buffer as source. sourcemust be any other object that supports the writable buffer interface (e.g., bytearray, array objects in the array module, mmap, and so on). offsetis the num- ber of bytes from the start of the buffer to use.\n\nty.from_buffer_copy(source [, offset])\n\nThe same as ty.from_buffer() except that a copy of the memory is made and that sourcecan be read-only.\n\nty.from_address(address)\n\nCreates an instance of ctypes type tyfrom a raw memory address addressspecified as an integer.\n\nty.from_param(obj)\n\nCreates an instance of ctypes type tyfrom a Python object obj.This only works if the passed object objcan be adapted into the appropriate type. For example, a Python inte- ger can be adapted into a c_int instance.\n\nty.in_dll(library, name)\n\nCreates an instance of ctypes type tyfrom a symbol in a shared library. libraryis an instance of the loaded library such as the object created by the CDLL class. nameis the name of a symbol.This method can be used to put a ctypes wrapper around global vari- ables defined in a library.\n\nThe following example shows how you might create a reference to a global variable\n\nint status defined in a library libexample.so.\n\nlibexample = ctypes.CDLL(\"libexample.so\") status = ctypes.c_int.in_dll(libexample,\"status\")\n\nF h Lib f L Bdff",
      "content_length": 2167,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 642,
      "content": "Embedding the Python Interpreter\n\n617\n\nUtility Functions The following utility functions are defined by ctypes:\n\naddressof(cobj)\n\nReturns the memory address of cobjas an integer. cobjmust be an instance of a ctypes type.\n\nalignment(ctype_or_obj)\n\nReturns the integer alignment requirements of a ctypes type or object. ctype_or_obj must be a ctypes type or an instance of a type.\n\ncast(cobj, ctype)\n\nCasts a ctypes object cobjto a new type given in ctype.This only works for pointers, so cobjmust be a pointer or array and ctypemust be a pointer type.\n\ncreate_string_buffer(init [, size])\n\nCreates a mutable character buffer as a ctypes array of type c_char. initis either an integer size or a string representing the initial contents. sizeis an optional parameter that specifies the size to use if initis a string. By default, the size is set to be one greater than the number of characters in init. Unicode strings are encoded into bytes using the default encoding.\n\ncreate_unicode_buffer(init [, size])\n\nThe same as create_string_buffer(), except that a ctypes array of type c_wchar is created.\n\nget_errno()\n\nReturns the current value of the ctypes private copy of errno.\n\nget_last_error()\n\nReturns the current value of the ctypes private copy of LastError on Windows.\n\nmemmove(dst, src, count)\n\nCopies countbytes from srcto dst. srcand dstare either integers representing memory addresses or instances of ctypes types that can be converted to pointers.The same as the C memmove() library function.\n\nmemset(dst, c, count)\n\nSets countbytes of memory starting at dstto the byte value c. dstis either an integer or a ctypes instance. cis an integer representing a byte in the range 0-255.\n\nresize(cobj, size)\n\nResizes the internal memory used to represent ctypes object cobj. sizeis the new size in bytes.\n\nset_conversion_mode(encoding, errors)\n\nSets the Unicode encoding used when converting from Unicode strings to 8-bit strings. encodingis the encoding name such as 'utf-8', and errorsis the error-handling policy such as 'strict' or 'ignore'. Returns a tuple (encoding, errors) with the previous setting.\n\nF h Lib f L Bdff",
      "content_length": 2125,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 643,
      "content": "618\n\nChapter 26 Extending and Embedding Python\n\nset_errno(value)\n\nSets the ctypes-private copy of the system errnovariable. Returns the previous value.\n\nset_last_error(value)\n\nSets the Windows LastError variable and returns the previous value.\n\nsizeof(type_or_cobj)\n\nReturns the size of a ctypes type or object in bytes.\n\nstring_at(address [, size])\n\nReturns a byte string representing sizebytes of memory starting at address address. If sizeis omitted, it is assumed that the byte string is NULL-terminated.\n\nwstring_at(address [, size])\n\nReturns a Unicode string representing sizewide characters starting at address address. If sizeis omitted, the character string is assumed to be NULL-terminated.\n\nExample The following example illustrates the use of the ctypes module by building an inter- face to the set of C functions used in the very first part of this chapter that covered the details of creating Python extension modules by hand.\n\n# example.py\n\nimport ctypes _example = ctypes.CDLL(\"./libexample.so\")\n\n# int gcd(int, int) gcd = _example.gcd gcd.argtypes = (ctypes.c_int,\n\nctypes.c_int)\n\ngcd.restype = ctypes.c_int\n\n# int replace(char *s, char olcdh, char newch) _example.replace.argtypes = (ctypes.c_char_p,\n\nctypes.c_char, ctypes.c_char)\n\n_example.replace.restype = ctypes.c_int\n\ndef replace(s, oldch, newch):\n\nsbuffer = ctypes.create_string_buffer(s) nrep = _example.replace(sbuffer,oldch,newch) return (nrep,sbuffer.value)\n\n# double distance(Point *p1, Point *p2) class Point(ctypes.Structure):\n\n_fields_ = [ (\"x\", ctypes.c_double),\n\n(\"y\", ctypes.c_double) ]\n\n_example.distance.argtypes = (ctypes.POINTER(Point),\n\nctypes.POINTER(Point))\n\n_example.distance.restype = ctypes.c_double\n\ndef distance(a,b): p1 = Point(*a) p2 = Point(*b) return _example.distance(byref(p1),byref(p2))\n\nF h Lib f L Bdff",
      "content_length": 1809,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 644,
      "content": "Advanced Extending and Embedding\n\n619\n\nAs a general note, usage of ctypes is always going to involve a Python wrapper layer of varying complexity. For example, it may be the case that you can call a C function directly. However, you may also have to implement a small wrapping layer to account for certain aspects of the underlying C code. In this example, the replace() function is taking extra steps to account for the fact that the C library mutates the input buffer.The distance() function is performing extra steps to create Point instances from tuples and to pass pointers.\n\nNote\n\nThe ctypes module has a large number of advanced features not covered here. For example, the library can access many different kinds of libraries on Windows, and there is support for callback functions, incomplete types, and other details. The online docu- mentation is filled with many examples so that should be a starting point for further use.\n\nAdvanced Extending and Embedding Creating handwritten extension modules or using ctypes is usually straightforward if you are extending Python with simple C code. However, for anything more complex, it can quickly become tedious. For this, you will want to look for a suitable extension building tool.These tools either automate much of the extension building process or provide a pro- gramming interface that operates at a much higher level. Links to a variety of such tools can be found at http://wiki.python.org/moin/IntegratingPythonWithOtherLanguages. However, a short example with SWIG (http://www.swig.org) will be shown just to illus- trate. In the interest of full disclosure, it should be noted that SWIG was originally created by the author.\n\nWith automated tools, you usually just describe the contents of an extension module\n\nat a high level. For example, with SWIG, you write a short interface specification that looks like this:\n\n/* example.i : Sample Swig specification */ %module example %{ /* Preamble. Include all required header files here */ #include \"example.h\" %}\n\n/* Module contents. List all C declarations here */ typedef struct Point {\n\ndouble x; double y;\n\n} Point; extern int gcd(int, int); extern int replace(char *s, char oldch, char newch); extern double distance(Point *a, Point *b);\n\nUsing this specification, SWIG automatically generates everything needed to make a Python extension module.To run SWIG, you just invoke it like a compiler:\n\n% swig –python example.i %\n\nF h Lib f L Bdff",
      "content_length": 2455,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 645,
      "content": "620\n\nChapter 26 Extending and Embedding Python\n\nAs output, it generates a set of .c and .py files. However, you often don’t have to worry much about this. If you are using distutils and include a .i file in the setup specification, it will run SWIG automatically for you when building an extension. For example, this setup.py file automatically runs SWIG on the listed example.i file.\n\n# setup.py from distutils.core import setup, Extension setup(name=\"example\",\n\nversion=\"1.0\", py_modules = ['example.py'], ext_modules = [\n\nExtension(\"_example\",\n\n[\"example.i\",\"example.c\"])\n\n]\n\n)\n\nIt turns out that this example.i file and the setup.py file are all that are needed to have a working extension module in this example. If you type python setup.py build_ext --inplace, you will find that you have a fully working extension in your directory.\n\nJython and IronPython Extending and embedding is not restricted to C programs. If you are working with Java, consider the use of Jython (http://www.jython.org), a complete reimplementation of the Python interpreter in Java.With jython, you can simply import Java libraries using the import statement. For example:\n\nbash-3.2$ jython Jython 2.2.1 on java1.5.0_16 Type \"copyright\", \"credits\" or \"license\" for more information. >>> from java.lang import System >>> System.out.println(\"Hello World\") Hello World >>>\n\nIf you are working with the .NET framework on Windows, consider the use of IronPython (http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython), a complete reimplementation of the Python interpreter in C#.With IronPython, you can easily access all of the .NET libraries from Python in a similar manner. For example:\n\n% ipy IronPython 1.1.2 (1.1.2) on .NET 2.0.50727.42 Copyright (c) Microsoft Corporation. All rights reserved. >>> import System.Math >>> dir(System.Math) ['Abs', 'Acos', 'Asin', 'Atan', 'Atan2', 'BigMul', 'Ceiling', 'Cos', 'Cosh', ...] >>> System.Math.Cos(3) -0.9899924966 >>>\n\nCovering jython and IronPython in more detail is beyond the scope of this book. However, just keep in mind that they’re both Python—the most major differences are in their libraries.\n\nF h Lib f L Bdff",
      "content_length": 2154,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 646,
      "content": "Appendix\n\nPython 3\n\nIn December 2008, Python 3.0 was released—a major update to the Python language\n\nthat breaks backwards compatibility with Python 2 in a number of critical areas.A fairly complete survey of the changes made to Python 3 can be found in the “What’s New in Python 3.0” document available at http://docs.python.org/3.0/whatsnew/3.0.html. In some sense, the first 26 chapters of this book can be viewed as the polar opposite of the “What’s New” document.That is, all of the material covered so far has focused on fea- tures that are shared by both Python 2 and Python 3.This includes all of the standard library modules, major language features, and examples.Aside from a few minor naming differences and the fact that print() is a function, no unique Python 3 features have been described.\n\nThe main focus of this appendix is to describe new features to the Python language\n\nthat are only available in version 3 as well as some important differences to keep in mind if you are going to migrate existing code.At the end of this appendix, some port- ing strategies and use of the 2to3 code conversion tool is described.\n\nWho Should Be Using Python 3? Before going any further, it is important to address the question of who should be using the Python 3.0 release.Within the Python community, it has always been known that the transition to Python 3 would not happen overnight and that the Python 2 branch would continue to be maintained for some time (years) into the future. So, as of this writing, there is no urgent need to drop Python 2 code. I suspect that huge amounts of Python 2 code will continue to be in development when the 5th edition of this book is written years from now.\n\nA major problem facing Python 3.0 concerns the compatibility of third-party libraries. Much of Python’s power comes from its large variety of frameworks and libraries. However, unless these libraries are explicitly ported to Python 3, they are almost certain not to work.This problem is amplified by the fact that many libraries depend upon other libraries that depend on yet more libraries.As of this writing (2009), there are major libraries and frameworks for Python that haven’t even been ported to Python 2.4, let alone 2.6 or 3.0. So, if you are using Python with the inten- tion of running third-party code, you are better off sticking with Python 2 for now. If you’ve picked up this book and it’s the year 2012, then hopefully the situation will have improved.\n\nAlthough Python 3 cleans up a lot of minor warts in the language, it is unclear if Python 3 is currently a wise choice for new users just trying to learn the basics.Almost all existing documentation, tutorials, cookbooks, and examples assume Python 2 and use\n\nF h Lib f L Bdff",
      "content_length": 2748,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 647,
      "content": "622\n\nAppendix Python 3\n\ncoding conventions that are incompatible. Needless to say, someone is not going to have a positive learning experience if everything appears to be broken. Even the official doc- umentation is not entirely up-to-date with Python 3 coding requirements; while writ- ing this book, the author submitted numerous bug reports concerning documentation errors and omissions.\n\nFinally, even though Python 3.0 is described as the latest and greatest, it suffers from\n\nnumerous performance and behavioral problems. For example, the I/O system in the initial release exhibits truly horrific and unacceptable runtime performance.The separa- tion of bytes and Unicode is also not without problem. Even some of the built-in library modules are broken due to changes related to I/O and string handling. Obviously these issues will improve with time as more programmers stress-test the release. However, in the opinion of this author, Python 3.0 is really only suitable for experimental use by seasoned Python veterans. If you’re looking for stability and pro- duction quality code, stick with Python 2 until some of the kinks have had time to be worked out of the Python 3 series.\n\nNew Language Features This section outlines some features of Python 3 that are not supported in Python 2.\n\nSource Code Encoding and Identifiers Python 3 assumes that source code is encoded as UTF-8. In addition, the rules on what characters are legal in an identifier have been relaxed. Specifically, identifiers can contain any valid Unicode character with a code point of U+0080 or greater. For example:\n\np = 3.141592654 r = 4.0 print(2*p*r)\n\nJust because you can use such characters in your source code doesn’t mean that it’s a good idea. Not all editors, terminals, or development tools are equally adept at Unicode handling. Plus, it is extremely annoying to force programmers to type awkward key sequences for characters not visibly present on a standard keyboard (not to mention the fact that it might make some of the gray-bearded hackers in the office tell everyone another amusing APL story). So, it’s probably better to reserve the use of Unicode char- acters for comments and string literals.\n\nSet Literals A set of items can now be defined by enclosing a collection of values in braces { items }. For example:\n\ndays = { 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun' }\n\nThis syntax is the same as using the set() function:\n\ndays = set(['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'])\n\nF h Lib f L Bdff",
      "content_length": 2507,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 648,
      "content": "New Language Features\n\n623\n\nSet and Dictionary Comprehensions The syntax { expr for x in s if conditional} is a set comprehension. It applies an operation to all of the elements of a set sand can be used in a similar manner as list comprehensions. For example:\n\n>>> values = { 1, 2, 3, 4 } >>> squares = {x*x for x in values} >>> squares {16, 1, 4, 9} >>>\n\nThe syntax { kexpr:vexpr for k,v in s if condition } is a dictionary com- prehension. It applies an operation to all of the keys and values in sequence sof (key, value) tuples and returns a dictionary.The keys of the new dictionary are described by an expression kexpr, and the values are described by the expression vexpr.This can be viewed as a more powerful version of the dict() function.\n\nTo illustrate, suppose you had a file of stock prices 'prices.dat' like this:\n\nGOOG 509.71 YHOO 28.34 IBM 106.11 MSFT 30.47 AAPL 122.13\n\nHere is a program that reads this file into a dictionary mapping stock names to price using a dictionary comprehension:\n\nfields = (line.split() for line in open(\"prices.dat\")) prices = {sym:float(val) for sym,val in fields}\n\nHere is an example that converts all of the keys of the prices dictionary to lowercase:\n\nd = {sym.lower():price for sym,price in prices.items()}\n\nHere is an example that creates a dictionary of prices for stocks over $100.00:\n\nd = {sym:price for sym,price in prices.items() if price >= 100.0}\n\nExtended Iterable Unpacking In Python 2, items in an iterable can be unpacked into variables using syntax such as the following:\n\nitems = [1,2,3,4] a,b,c,d = items # Unpack items into variables\n\nIn order for this unpacking to work, the number of variables and items to be unpacked must exactly match.\n\nIn Python 3, you can use a wildcard variable to only unpack some of the items in a\n\nsequence, placing any remaining values in a list. For example:\n\na,*rest = items # a = 1, rest = [2,3,4] a,*rest,d = items # a = 1, rest = [2,3], d = 4 *rest, d = items # rest = [1,2,3], d = 4\n\nF h Lib f L Bdff",
      "content_length": 2002,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 649,
      "content": "624\n\nAppendix Python 3\n\nIn these examples, the variable prefixed by a * receives all of the extra values and places them in a list.The list may be empty if there are no extra items. One use of this feature is in looping over lists of tuples (or sequences) where the tuples may have differing sizes. For example:\n\npoints = [ (1,2), (3,4,\"red\"), (4,5,\"blue\"), (6,7) ] for x,y, *opt in points:\n\nif opt:\n\n# Additional fields were found\n\nstatements\n\nNo more than one starred variable can appear in any expansion.\n\nNonlocal Variables Inner functions can modify variables in outer functions by using the nonlocal declara- tion. For example:\n\ndef countdown(n):\n\ndef decrement():\n\nnonlocal n n -= 1\n\nwhile n > 0:\n\nprint(\"T-minus\", n) decrement()\n\nIn Python 2, inner functions can read variables in outer functions but cannot modify them.The nonlocal declaration enables this.\n\nFunction Annotations The arguments and return value of functions can be annotated with arbitrary values. For example:\n\ndef foo(x:1,y:2) -> 3:\n\npass\n\nThe function attribute __annotations__ is a dictionary mapping argument names to the annotation values.The special 'return' key is mapped to the return value annota- tion. For example:\n\n>>> foo.__annotations__ {'y': 4, 'x': 3, 'return': 5} >>>\n\nThe interpreter does not attach any significance to these annotations. In fact, they can be any values whatsoever. However, it is expected that type information will be most useful in the future. For example, you could write this:\n\ndef foo(x:int, y:int) -> str:\n\nstatements\n\nAnnotations are not limited to single values.An annotation can be any valid Python expression. For variable positional and keyword arguments, the same syntax applies. For example:\n\ndef bar(x, *args:\"additional\", **kwargs:\"options\"):\n\nstatements\n\nF h Lib f L Bdff",
      "content_length": 1799,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 650,
      "content": "New Language Features\n\n625\n\nAgain, it is important to emphasize that Python does not attach any significance to annotations.The intended use is in third-party libraries and frameworks that may want to use them for various applications involving metaprogramming. Examples include, but are not limited to, static analysis tools, documentation, testing, function overloading, marshalling, remote procedure call, IDEs, contracts, etc. Here is an example of a decora- tor function that enforces assertions on function arguments and return values:\n\ndef ensure(func):\n\n# Extract annotation data return_check = func.__annotations__.get('return',None) arg_checks = [(name,func.__annotations__.get(name))\n\nfor name in func.__code__.co_varnames]\n\n# Create a wrapper that checks argument values and the return # result using the functions specified in annotations\n\ndef assert_call(*args,**kwargs):\n\nfor (name,check),value in zip(arg_checks,args):\n\nif check: assert check(value), \"%s %s\" % (name, check.__doc__)\n\nfor name,check in arg_checks[len(args):]:\n\nif check: assert check(kwargs[name]), \"%s %s\" % (name, check.__doc__)\n\nresult = func(*args,**kwargs) assert return_check(result), \"return %s\" % return_check.__doc__ return result\n\nreturn assert_call\n\nHere is an example of code that uses the previous decorator:\n\ndef positive(x):\n\n\"must be positive\" return x > 0\n\ndef negative(x):\n\n\"must be negative\" return x < 0\n\n@ensure def foo(a:positive, b:negative) -> positive:\n\nreturn a – b\n\nFollowing is some sample output of using the function:\n\n>>> foo(3,-2) 5 >>> foo(-5,2) Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module> File \"meta.py\", line 19, in call\n\ndef assert_call(*args,**kwargs):\n\nAssertionError: a must be positive >>>\n\nKeyword-Only Arguments Functions can specify keyword-only arguments.This is indicated by defining extra parameters after the first starred parameter. For example:\n\ndef foo(x, *args, strict=False):\n\nstatements\n\nF h Lib f L Bdff",
      "content_length": 1967,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 651,
      "content": "626\n\nAppendix Python 3\n\nWhen calling this function, the strict parameter can only be specified as a keyword. For example:\n\na = foo(1, strict=True)\n\nAny additional positional arguments would just be placed in args and not used to set the value of strict. If you don’t want to accept a variable number of arguments but want keyword-only arguments, use a bare * in the parameter list. For example:\n\ndef foo(x, *, strict=False):\n\nstatements\n\nHere is an example of usage:\n\nfoo(1,True) # Fails. TypeError: foo() takes 1 positional argument foo(1,strict=True) # Ok.\n\nEllipsis as an Expression The Ellipsis object (...) can now appear as an expression.This allows it to be placed in containers and assigned to variables. For example:\n\n>>> x = ... >>> x Ellipsis >>> a = [1,2,...] >>> a [1, 2, Ellipsis] >>> ... in a True >>> x is ... True >>>\n\n# Assignment of Ellipsis\n\nThe interpretation of the ellipsis is still left up to the application that uses it.This feature allows the ... to be used as an interesting piece of syntax in libraries and frameworks (for example, to indicate a wild-card, continuation, or some similar concept).\n\nChained Exceptions Exceptions can now be chained together. Essentially this is a way for the current excep- tion to carry information about the previous exception.The from qualifier is used with the raise statement to explicitly chain exceptions. For example:\n\ntry:\n\nstatements\n\nexcept ValueError as e:\n\nraise SyntaxError(\"Couldn't parse configuration\") from e\n\nWhen the SyntaxError exception is raised, a traceback message such as the following will be generated—showing both exceptions:\n\nTraceback (most recent call last):\n\nFile \"<stdin>\", line 2, in <module>\n\nValueError: invalid literal for int() with base 10: 'nine'\n\nThe above exception was the direct cause of the following exception:\n\nF h Lib f L Bdff",
      "content_length": 1836,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 652,
      "content": "New Language Features\n\n627\n\nTraceback (most recent call last):\n\nFile \"<stdin>\", line 4, in <module>\n\nSyntaxError: Couldn't parse configuration\n\nException objects have a __cause__ attribute, which is set to the previous exception. Use of the from qualifier with raise sets this attribute.\n\nA more subtle example of exception chaining involves exceptions raised within\n\nanother exception handler. For example:\n\ndef error(msg):\n\nprint(m) # Note: typo is intentional (m undefined)\n\ntry:\n\nstatements\n\nexcept ValueError as e:\n\nerror(\"Couldn't parse configuration\")\n\nIf you try this in Python 2, you only get an exception related to the NameError in error(). In Python 3, the previous exception being handled is chained with the result. For example, you get this message:\n\nTraceback (most recent call last):\n\nFile \"<stdin>\", line 2, in <module>\n\nValueError: invalid literal for int() with base 10: 'nine'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n\nFile \"<stdin>\", line 4, in <module> File \"<stdin>\", line 2, in error\n\nNameError: global name 'm' is not defined\n\nFor implicit chaining, the __context__ attribute of an exception instance econtains a reference to previous exception.\n\nImproved super() The super() function, used to look up methods in base classes, can be used without any arguments in Python 3. For example:\n\nclass C(A,B):\n\ndef bar(self):\n\nreturn super().bar() # Call bar() in bases\n\nIn Python 2, you had to use super(C,self).bar().The old syntax is still supported but is significantly more clunky.\n\nAdvanced Metaclasses In Python 2, you can define metaclasses that alter the behavior of classes.A subtle facet of the implementation is that the processing carried out by a metaclass only occurs after the body of a class has executed.That is, the interpreter executes the entire body of a class and populates a dictionary. Once the dictionary has been populated, the dictionary is passed to the metaclass constructor (after the body of the class has executed).\n\nIn Python 3, metaclasses can additionally carry out extra work before the class body\n\nexecutes.This is done by defining a special class method called __prepare__(cls, name, bases, **kwargs) in the metaclass.This method must return a dictionary as a\n\nF h Lib f L Bdff",
      "content_length": 2298,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 653,
      "content": "628\n\nAppendix Python 3\n\nresult.This dictionary is what gets populated as the body of the class definition exe- cutes. Here is an example that outlines the basic procedure:\n\nclass MyMeta(type): @classmethod def __prepare__(cls,name,bases,**kwargs): print(\"preparing\",name,bases,kwargs) return {}\n\ndef __new__(cls,name,bases,classdict):\n\nprint(\"creating\",name,bases,classdict) return type.__new__(cls,name,bases,classdict)\n\nPython 3 uses an alternative syntax for specifying a metaclass. For example, to define a class that uses MyMeta, you use this:\n\nclass Foo(metaclass=MyMeta):\n\nprint(\"About to define methods\") def __init__(self):\n\npass\n\ndef bar(self):\n\npass\n\nprint(\"Done defining methods\")\n\nIf you run the following code, you will see the following output that illustrates the con- trol flow:\n\npreparing Foo () {} About to define methods Done defining methods creating Foo () {'__module__': '__main__',\n\n'bar': <function bar at 0x3845d0>, '__init__': <function __init__ at 0x384588>}\n\nThe additional keyword arguments on the __prepare__() method of the metaclass are passed from keyword arguments used in the bases list of a class statement. For example, the statement class Foo(metaclass=MyMeta,spam=42,blah=\"Hello\") passes the keyword arguments spam and blah to MyMeta.__prepare__().This con- vention can be used to pass arbitrary configuration information to a metaclass.\n\nTo perform any kind of useful processing with the new __prepare__() method of\n\nmetaclasses, you generally have the method return a customized dictionary object. For example, if you wanted to perform special processing as a class is defined, you define a class that inherits from dict and reimplements the __setitem__() method to capture assignments to the class dictionary.The following example illustrates this by defining a metaclass that reports errors if any method or class variable is multiply defined.\n\nclass MultipleDef(dict): def __init__(self):\n\nself.multiple= set()\n\ndef __setitem__(self,name,value):\n\nif name in self:\n\nself.multiple.add(name)\n\ndict.__setitem__(self,name,value)\n\nclass MultiMeta(type):\n\n@classmethod def __prepare__(cls,name,bases,**kwargs):\n\nreturn MultipleDef()\n\ndef __new__(cls,name,bases,classdict): for name in classdict.multiple:\n\nprint(name,\"multiply defined\")\n\nF h Lib f L Bdff",
      "content_length": 2292,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 654,
      "content": "Common Pitfalls\n\n629\n\nif classdict.multiple:\n\nraise TypeError(\"Multiple definitions exist\")\n\nreturn type.__new__(cls,name,bases,classdict)\n\nIf you apply this metaclass to another class definition, it will report an error if any method is redefined. For example:\n\nclass Foo(metaclass=MultiMeta):\n\ndef __init__(self):\n\npass\n\ndef __init__(self,x): # Error. __init__ multiply defined.\n\npass\n\nCommon Pitfalls If you are migrating from Python 2 to 3, be aware that Python 3 is more than just new syntax and language features. Major parts of the core language and library have been reworked in ways that are sometimes subtle.There are aspects of Python 3 that may seem like bugs to a Python 2 programmer. In other cases, things that used to be “easy” in Python 2 are now forbidden.\n\nThis section outlines some of the most major pitfalls that are likely to be encoun-\n\ntered by Python 2 programmers making the switch.\n\nText Versus Bytes Python 3 makes a very strict distinction between text strings (characters) and binary data (bytes).A literal such as \"hello\" represents a text string stored as Unicode, where- as b\"hello\" represents a string of bytes (containing ASCII letters in this case).\n\nUnder no circumstances can the str and bytes type be mixed in Python 3. For example, if you try to concatenate strings and bytes together, you will get a TypeError exception.This differs from Python 2 where byte strings would be automatically coerced into Unicode as needed.\n\nTo convert a text string sinto bytes, you must use s.encode(encoding). For example, s.encode('utf-8') converts sinto a UTF-8 encoded byte string.To con- vert a byte string tback into text, you must use t.decode(encoding).You can view the encode() and decode() methods as a kind of “type cast” between strings and bytes.\n\nKeeping a clean separation between text and bytes is ultimately a good thing—the rules for mixing string types in Python 2 were obscure and difficult to understand at best. However, one consequence of the Python 3 approach is that byte strings are much more restricted in their ability to actually behave like “text.”Although there are the standard string methods like split() and replace(), other aspects of byte strings are not the same as in Python 2. For instance, if you print a byte string, you simply get its repr() output with quotes such as b'contents'. Similarly, none of the string format- ting operations (%, .format()) work. For example:\n\nx = b'Hello World' print(x) # Produces b'Hello World' print(b\"You said '%s'\" % x) # TypeError: % operator not supported\n\nThe loss of text-like behavior with bytes is a potential pitfall for system programmers. Despite the invasion of Unicode, there are many cases where one actually does want to\n\nF h Lib f L Bdff",
      "content_length": 2750,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 655,
      "content": "630\n\nAppendix Python 3\n\nwork with and manipulate byte-oriented data such as ASCII.You might be inclined to use the bytes type to avoid all of the overhead and complexity of Unicode. However, this will actually make everything related to byte-oriented text handling more difficult. Here is an example that illustrates the potential problems:\n\n>>> # Create a response message using strings (Unicode) >>> status = 200 >>> msg = \"OK\" >>> proto = \"HTTP/1.0\" >>> response = \"%s %d %s\" % (proto, status, msg) >>> print(response) HTTP/1.0 200 OK\n\n>>> # Create a response message using only bytes (ASCII) >>> status = 200 >>> msg = b\"OK\" >>> proto = b\"HTTP/1.0\" >>> response = b\"%s %d %s\" % (proto, status, msg) Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: unsupported operand type(s) for %: 'bytes' and 'tuple'\n\n>>> response = proto + b\" \" + str(status) + b\" \" + msg Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: can't concat bytes to str\n\n>>> bytes(status) b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00....'\n\n>>> bytes(str(status)) Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: string argument without an encoding\n\n>>> bytes(str(status),'ascii') b'200'\n\n>>> response = proto + b\" \" + bytes(str(status),'ascii') + b\" \" + msg >>> print(response) b'HTTP/1.0 200 OK'\n\n>>> print(response.decode('ascii')) HTTP/1.0 200 OK >>>\n\nIn the example, you can see how Python 3 is strictly enforcing the text/bytes separa- tion. Even operations that seem like they should be simple, such as converting an inte- ger into ASCII characters, are much more complicated with bytes.\n\nThe bottom line is that if you’re performing any kind of text-based processing or formatting, you are probably always better off using standard text strings. If you need to obtain a byte-string after the completion of such processing, you can use s.encode('latin-1') to convert from Unicode.\n\nThe text/bytes distinction is somewhat more subtle when working with various library modules. Some libraries work equally well with text or bytes, while some forbid bytes altogether. In other cases, the behavior is different depending on what kind of input is received. For example, the os.listdir(dirname) function only returns file-\n\nF h Lib f L Bdff",
      "content_length": 2311,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 656,
      "content": "Common Pitfalls\n\n631\n\nnames that can be successfully decoded as Unicode if dirnameis a string. If dirnameis a byte string, then all filenames are returned as byte strings.\n\nNew I/O System Python 3 implements an entirely new I/O system, the details of which are described in the io module section of Chapter 19,“Operating System Services.”The new I/O sys- tem also reflects the strong distinction between text and binary data present with strings.\n\nIf you are performing any kind of I/O with text, Python 3 forces you to open files in “text mode” and to supply an optional encoding if you want anything other than the default (usually UTF-8). If you are performing I/O with binary data, you must open files in “binary mode” and use byte strings.A common source of errors is passing out- put data to a file or I/O stream opened in the wrong mode. For example:\n\n>>> f = open(\"foo.txt\",\"wb\") >>> f.write(\"Hello World\\n\") Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module> File \"/tmp/lib/python3.0/io.py\", line 1035, in write\n\nraise TypeError(\"can't write str to binary stream\")\n\nTypeError: can't write str to binary stream >>>\n\nSockets, pipes, and other kinds of I/O channels should always be assumed to be in bina- ry mode. One potential problem with network code in particular is that many network protocols involve text-based request/response processing (e.g., HTTP, SMTP, FTP, etc.). Given that sockets are binary, this mix of binary I/O and text processing can lead to some of the problems related to mixing text and bytes that were described in the previ- ous section.You’ll need to be careful.\n\nprint() and exec() Functions The print and exec statements from Python 2 are now functions. Use of the print() function compared to its Python 2 counterpart is as follows:\n\nprint(x,y,z) # Same as : print x, y, z print(x,y,z,end=' ') # Same as : print x, y, z, print(a,file=f) # Same as : print >>f, a\n\nThe fact that print() is a function that means you can replace it with an alternative definition if you want.\n\nexec() is also now a function, but its behavior in Python 3 is subtly different than\n\nin Python 2. For example, consider this code:\n\ndef foo():\n\nexec(\"a = 42\") print(a)\n\nIn Python 2, calling foo() will print the number '42'. In Python 3, you get a NameError exception with the variable a being undefined.What has happened here is that exec(), as a function, only operates on the dictionaries returned by the globals() and locals() functions. However, the dictionary returned by locals() is actually a copy of the local variables.The assignment made in the exec() function is\n\nF h Lib f L Bdff",
      "content_length": 2624,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 657,
      "content": "632\n\nAppendix Python 3\n\nmerely modifying this copy of the locals, not the local variables themselves. Here is one workaround:\n\ndef foo():\n\n_locals = locals() exec(\"a = 42\",globals(),_locals) a = _locals['a'] # Extract the set variable print(a)\n\nAs a general rule, don’t expect Python 3 to support the same degree of “magic” that was possible using exec(), eval(), and execfile() in Python 2. In fact, execfile() is gone entirely (you can emulate its functionality by passing an open file-like object to exec()).\n\nUse of Iterators and Views Python 3 makes much greater use of iterators and generators than Python 2. Built-in functions such as zip(), map(), and range() that used to return lists now return iter- ables. If you need to make a list from the result, use the list() function.\n\nPython 3 takes a slightly different approach to extracting key and value information from a dictionary. In Python 2, you could use methods such as d.keys(), d.values(), or d.items() to obtain lists of keys, values, or key/value pairs, respectively. In Python 3, these methods return so-called view objects. For example:\n\n>>> s = { 'GOOG': 490.10, 'AAPL': 123.45, 'IBM': 91.10 } >>> k = s.keys() >>> k <dict_keys object at 0x33d950> >>> v = s.values() >>> v <dict_values object at 0x33d960> >>>\n\nThese objects support iteration so if you want to view the contents, you can use a for loop. For example:\n\n>>> for x in k: ... ... GOOG AAPL IBM >>>\n\nprint(x)\n\nView objects are always tied back to the dictionary from which they were created.A subtle aspect of this is that if the underlying dictionary changes, the items produced by the view change as well. For example:\n\n>>> s['ACME'] = 5612.25 >>> for x in k: ... ... GOOG AAPL IBM ACME >>>\n\nprint(x)\n\nShould it be necessary to build a list of dictionary keys or values, simply use the list() function—for example, list(s.keys()).\n\nF h Lib f L Bdff",
      "content_length": 1883,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 658,
      "content": "Common Pitfalls\n\n633\n\nIntegers and Integer Division Python 3 no longer has an int type for 32-bit integers and a separate long type for long integers.The int type now represents an integer of arbitrary precision (the inter- nal details of which are not exposed to the user).\n\nIn addition, integer division now always produces a floating-point result. For exam-\n\nple, 3/5 is 0.6, not 0.The conversion to a float applies even if the result would have been an integer. For example, 8/2 is 4.0, not 4.\n\nComparisons Python 3 is much more strict about how values are compared. In Python 2, it is the case that any two objects can be compared even if it doesn’t make sense. For example:\n\n>>> 3 < \"Hello\" True >>>\n\nIn Python 3, this results in a TypeError. For example:\n\n>>> 3 < \"Hello\" Traceback (most recent call last):\n\nFile \"<stdin>\", line 1, in <module>\n\nTypeError: unorderable types: int() < str() >>>\n\nThis change is minor, but it means that in Python 3, you have to be much more careful about making sure data is of appropriate types. For example, if you use the sort() method of a list, all of the items in the list must be compatible with the < operator, or you get an error. In Python 2, the operation would be silently carried out anyways with a usually meaningless result.\n\nIterators and Generators Python 3 has made a slight change to the iterator protocol. Instead of calling __iter__() and the next() method to perform iteration, the next() method has been renamed to __next__(). Most users will be unaffected by this change except if you have written code that manually iterates over an iterable or if you have defined your own custom iterator objects.You will need to make sure you change the name of the next() method in your classes. Use the built-in next() function to invoke the next() or __next__() method of an iterator in a portable manner.\n\nFile Names, Arguments, and Environment Variables In Python 3, filenames, command-line arguments in sys.argv, and environment vari- ables in os.environ may or may not be treated as Unicode depending on local set- tings.The only problem is that the usage of Unicode within the operating system envi- ronment is not entirely universal. For example, on many systems it may be technically possible to specify filenames, command-line options, and environment variables that are just a raw sequence of bytes that don’t correspond to a valid Unicode encoding. Although these situations might be rare in practice, it may be of some concern for programming using Python to perform tasks related to systems administration.As previ- ously noted, supplying file and directory names as byte strings will fix many of the problems. For example, os.listdir(b'/foo').\n\nF h Lib f L Bdff",
      "content_length": 2726,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 659,
      "content": "634\n\nAppendix Python 3\n\nLibrary Reorganization Python 3 reorganizes and changes the names of several parts of the standard library, most notably modules related to networking and Internet data formats. In addition, a wide variety of legacy modules have been dropped from the library (e.g., gopherlib, rfc822, and so on).\n\nIt is now standard practice to use lowercase names for modules. Several modules such\n\nas ConfigParser, Queue, and SocketServer have been renamed to configparser, queue, and socketserver, respectively.You should try to follow similar conventions in your own code.\n\nPackages have been created to reorganize code that was formerly contained in dis-\n\nparate modules—for example, the http package containing all the module used to write HTTP servers, the html package has modules for parsing HTML, the xmlrpc package has modules for XML-RPC, and so forth.\n\nAs for deprecated modules, this book has been careful to only document modules that are in current use with Python 2.6 and Python 3.0. If you are working with exist- ing Python 2 code and see it using a module not documented here, there is a good chance that the module has been deprecated in favor of something more modern. Just as an example, Python 3 doesn’t have the popen2 module commonly used in Python 2 to launch subprocesses. Instead, you should use the subprocess module.\n\nAbsolute Imports Related to library reorganization, all import statements appearing in submodules of a package use absolute names.This is covered in more detailed in Chapter 8,“Modules, Packages, and Distribution,” but suppose you have a package organized like this:\n\nfoo/\n\n__init__.py spam.py bar.py\n\nIf the file spam.py uses the statement import bar, you get an ImportError exception even though bar.py is located in the same directory.To load this submodule, spam.py either needs to use import foo.bar or a package relative import such as from . import bar.\n\nThis differs from Python 2 where import always checks the current directory for a\n\nmatch before moving onto checking other directories in sys.path.\n\nCode Migration and 2to3 Converting code from Python 2 to Python 3 is a delicate topic. Just to be absolutely clear, there are no magic imports, flags, environment variables, or tools that will enable Python 3 to run an arbitrary Python 2 program. However, there are some very specific steps that can be taken to migrate code, each of which is now described.\n\nPorting Code to Python 2.6 It is recommended that anyone porting code to Python 3 first port to Python 2.6. Python 2.6 is not only backwards-compatible with Python 2.5, but it also supports a subset of new features found in Python 3. Examples include advanced string formatting, the new exception syntax, byte literals, I/O library, and abstract base classes.Thus, a\n\nF h Lib f L Bdff",
      "content_length": 2811,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 660,
      "content": "Code Migration and 2to3\n\n635\n\nPython 2 program can start to take advantage of useful Python 3 features now even if it is not yet ready to make the full migration.\n\nThe other reason to port to Python 2.6 is that Python 2.6 issues warning messages for deprecated features if you run it with the -3 command-line option. For example:\n\nbash-3.2$ python -3 Python 2.6 (trunk:66714:66715M, Oct 1 2008, 18:36:04) [GCC 4.0.1 (Apple Computer, Inc. build 5370)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> a = { } >>> a.has_key('foo') __main__:1: DeprecationWarning: dict.has_key() not supported in 3.x; use the in operator False >>\n\nUsing these warning messages as a guide, you should take great care to make sure that your program runs warning-free on Python 2.6 before moving forward with a Python 3 port.\n\nProviding Test Coverage Python has useful testing modules including doctest and unittest. Make sure your application has thorough test coverage before attempting a Python 3 port. If your pro- gram has not had any tests to this point, now would be a good time to start.You will want to make sure your tests cover as much as possible and that all tests pass without any warning messages when run on Python 2.6.\n\nUsing the 2to3 Tool Python 3 includes a tool called 2to3 that can assist with code migration from Python 2.6 to Python 3.This tool is normally found in the Tools/scripts directory of the Python source distribution and is also installed in the same directory as the python3.0 binary on most systems. It is a command-line tool that would normally run from a UNIX or Windows command shell.\n\nAs an example, consider the following program that contains a number of deprecated\n\nfeatures.\n\n# example.py import ConfigParser\n\nfor i in xrange(10): print i, 2*i\n\ndef spam(d):\n\nif not d.has_key(\"spam\"):\n\nd[\"spam\"] = load_spam()\n\nreturn d[\"spam\"]\n\nTo run 2to3 on this program, type “2to3 example.py”. For example:\n\n% 2to3 example.py RefactoringTool: Skipping implicit fixer: buffer RefactoringTool: Skipping implicit fixer: idioms RefactoringTool: Skipping implicit fixer: set_literal RefactoringTool: Skipping implicit fixer: ws_comma --- example.py (original) +++ example.py (refactored) @@ -1,10 +1,10 @@\n\nF h Lib f L Bdff",
      "content_length": 2263,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 661,
      "content": "636\n\nAppendix Python 3\n\n# example.py\n\nimport ConfigParser +import configparser\n\nfor i in xrange(10): - print i, 2*i +for i in range(10): + print(i, 2*i) def spam(d):\n\nif not d.has_key(\"spam\"): + if \"spam\" not in d: d[\"spam\"] = load_spam()\n\nreturn d[\"spam\"]\n\nRefactoringTool: Files that need to be modified: RefactoringTool: example.py\n\nAs output, 2to3 will identify parts of the program that it considers to be problematic and that might need to be changed.These are shown as context-diffs in the output. Although we have used 2to3 on a single file, if you give it the name of a directory, it recursively looks for all Python files contained in the directory structure and generates a report for everything.\n\nBy default, 2to3 does not actually fix any of the source code it scans—it merely reports parts of the code that might need to be changed.A challenge faced by 2to3 is that it often only has incomplete information. For example, consider the spam() func- tion in the example code.This function calls a method d.has_key(). For dictionaries, has_key() has been removed in favor of the in operator. 2to3 reports this change, but without more information, it is not clear if spam() is actually manipulating a dictionary or not. It might be the case that d is some other kind of object (a database perhaps) that happens to provide a has_key() method, but where using the in operator would fail. Another problematic area for 2to3 is in the handling of byte strings and Unicode. Given that Python 2 would automatically promote byte strings to Unicode, it is some- what common to see code that carelessly mixes the two string types together. Unfortunately, 2to3 is unable to sort all of this out.This is one reason why it’s impor- tant to have good unit test coverage. Of course, all of this depends on the application. As an option, 2to3 can be instructed to fix selected incompatibilities. First, a list of\n\n“fixers” can be obtained by typing 2to3 -l. For example:\n\n% 2to3 -l Available transformations for the -f/--fix option: apply basestring buffer callable ... ... xrange xreadlines zip\n\nUsing names from this list, you can see what a selected fix would actually change by simply typing “2to3 -f fixname filename”. If you want to apply multiple fixes, just specify each one with a separate -f option. If you actually want to apply the fix to a source file, add the -w option as in 2to3 -f fixname -w filename. Here is an example:\n\nF h Lib f L Bdff",
      "content_length": 2450,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 662,
      "content": "Code Migration and 2to3\n\n637\n\n% 2to3 -f xrange -w example.py --- example.py (original) +++ example.py (refactored) @@ -1,7 +1,7 @@ # example.py import ConfigParser\n\nfor i in xrange(10): +for i in range(10): print i, 2*i\n\ndef spam(d):\n\nRefactoringTool: Files that were modified: RefactoringTool: example.py\n\nIf you look at example.py after this operation, you will find that xrange() has been changed to range() and that no other changes have been made.A backup of the origi- nal example.py file is found in example.py.bak.\n\nA counterpart to the -f option is the -x option. If you use 2to3 -x fixname filename, it will run all of the fixers except for the ones you listed with the -x option. Although it is possible to instruct 2to3 to fix everything and to overwrite all of your files, this is probably something best avoided in practice. Keep in mind that code transla- tion is an inexact science and that 2to3 is not always going to do the “right thing.” It is always better to approach code migration in a methodical calculated manner as opposed to crossing your fingers and hoping that it all just magically “works.”\n\n2to3 has a couple of additional options that may be useful.The -v option enables a\n\nverbose mode that prints additional information that might be useful for debugging. The -p option tells 2to3 that you are already using the print statement as a function in your code and that it shouldn’t be converted (enabled by the from __future__ import print_statement statement).\n\nA Practical Porting Strategy Here is a practical strategy for porting Python 2 code to Python 3.Again, it is better to approach migration in a methodical manner as opposed to doing everything at once. 1. Make sure your code has an adequate unit testing suite and that all tests pass\n\nunder Python 2.\n\n2. Port your code and testing suite to Python 2.6 and make sure that all tests still pass.\n\n3. Turn on the -3 option to Python 2.6.Address all warning messages and make sure your program runs and passes all tests without any warning messages. If you’ve done this correctly, chances are that your code will still work with Python 2.5 and maybe even earlier releases.You’re really just cleaning out some of the cruft that’s accumulated in your program.\n\n4. Make a backup of your code (this goes without saying). 5. Port the unit testing suite to Python 3 and make sure that the testing environ- ment itself is working.The individual unit tests themselves will fail (because you haven’t yet ported any code). However, a properly written test suite should be able to deal with test failures without having an internal crash of the test software itself.\n\nF h Lib f L Bdff",
      "content_length": 2659,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 663,
      "content": "638\n\nAppendix Python 3\n\n6. Convert the program itself to Python 3 using 2to3. Run the unit testing suite on the resulting code and fix all of the issues that arise.There are varying strategies for doing this. If you’re feeling lucky, you can always tell 2to3 to just fix every- thing and see what happens. If you’re more cautious, you might start by having 2to3 fix the really obvious things (print, except statements, xrange(), library module names, etc.) and then proceed in a more piecemeal manner with the remaining issues.\n\nBy the end of this process, your code should pass all unit tests and operate in the same manner as before.\n\nIn theory, it is possible to structure code in a way so that it both runs in Python 2.6\n\nand automatically translates to Python 3 without any user intervention. However, this will require very careful adherence to modern Python coding conventions—at the very least you will absolutely need to make sure there are no warnings in Python 2.6. If the automatic translation process requires very specific use of 2to3 (such as running only a selected set of fixers), you should probably write a shell script that automatically carries out the required operations as opposed to requiring users to run 2to3 on their own.\n\nSimultaneous Python 2 and Python 3 Support A final question concerning Python 3 migration is whether or not it’s possible to have a single code base that works unmodified on Python 2 and Python 3.Although this is possible in certain cases, the resulting code runs the risk of becoming a contorted mess. For instance, you will have to avoid all print statements and make sure all except clauses never take any exception values (extracting them from sys.exc_info() instead). Other Python features can’t be made to work at all. For example, due to syntax differences, there is no possible way to use metaclasses in a way that would be portable between Python 2 and Python 3.\n\nThus, if you’re maintaining code that must work on Python 2 and 3, your best bet is\n\nto make sure your code is as clean as possible and runs under Python 2.6, make sure you have a unit testing suite, and try to develop a set of 2to3 fixes to make automatic translation possible.\n\nOne case where it might make sense to have a single code base is with unit testing. A test suite that operates without modification on Python 2.6 and Python 3 could be useful in verifying the correct behavior of the application after being translated by 2to3.\n\nParticipate As an open-source project, Python continues to be developed with the contributions of its users. For Python 3, especially, it is critically to report bugs, performance problems, and other issues.To report a bug, go to http://bugs.python.org. Don’t be shy—your feedback makes Python better for everyone.\n\nF h Lib f L Bdff",
      "content_length": 2797,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 664,
      "content": "Symbols & Numbers\n\n! debugger command, pdb module, 187\n\n!= not equal to operator, 66\n\n‘ single quotes, 11, 27\n\n‘’’ triple quotes, 11, 27\n\n“ double quotes, 11, 27\n\n“”” triple quotes, 11, 27\n\n# comment, 6, 26\n\n#! in Unix shell scripts, 6, 176\n\nrewriting on package installation, 153\n\n% modulo operator, 65\n\n% string formatting operator, 8, 70, 162\n\n%= operator, 75\n\n& bitwise-and operator, 65\n\n& set intersection operator, 15, 75\n\n&= operator, 75\n\n() function call operator, 76\n\n() tuple, 14, 29\n\nkeyword only arguments, Python 3, 625\n\nmultiplication operator, 65\n\npassing sequences as function argu- ments, 94\n\nsequence replication operator, 67\n\nvariable arguments in function definition, 94\n\nwildcard\n\nfrom module import, 24, 145 iterable unpacking in Python 3, 623 ** passing dictionaries as keyword argu-\n\nments, 95\n\n** power operator, 65\n\n** variable keyword arguments in function\n\ndefinition, 95\n\n**= operator, 75\n\n*= operator, 75\n\nIndex\n\n+ addition operator, 65\n\n+ list concatenation operator, 12\n\n+ sequence concatenation operator, 67\n\n+ string concatenation operator, 11\n\n+ unary plus operator, 65\n\n+= operator, 75\n\nhyphen character, used as filename, 174\n\nset difference operator, 15, 75\n\nsubtraction operator, 65\n\nunary minus operator, 65\n\n-*- coding: comment, in source code, 31\n\n= operator, 75\n\n. attribute binding operator, 33, 48, 76, 118\n\nand modules, 51 special methods for, 57\n\n. directory reference in relative import\n\nstatements, 150\n\n... Ellipsis, 30, 54, 59\n\n... interpreter prompt, 175\n\n/ division operator, 65\n\n// truncating division operator, 65\n\n//= operator, 75\n\n/= operator, 75\n\n: colon in string formatting specifiers, 72\n\n; semicolon, 7, 26\n\n< left alignment in string format specifiers,\n\n73\n\n< less than operator, 66\n\n<< left shift operator, 65\n\n<<= operator, 75\n\n<= less than or equal to operator, 66\n\n== equal to operator, 66, 78\n\n> greater than operator, 66\n\n> right alignment in string format speci-\n\nfiers, 73\n\nF h Lib f L Bdff",
      "content_length": 1961,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 665,
      "content": "640\n\n>= greater than or equal to operator\n\n>= greater than or equal to operator, 66\n\n>> file redirection modifier to print, 10,\n\n163\n\n>> right shift operator, 65\n\n>>= operator, 75\n\n>>> interpreter prompt, 5, 175\n\n@ decorator, 30, 101\n\n[::] extended slicing operator, 39-40, 67-68\n\n[:] slicing operator, 39-40, 67-68\n\n[] indexing operator, 39-40, 67 and special methods, 58 on mappings, 45 on sequences, 68\n\n[] list, 12, 29\n\n\\ line continuation character, 9, 25, 29\n\n\\ string escape codes, 27\n\n^ bitwise-xor operator, 65\n\n^ centered alignment in string format spec-\n\nifiers, 73\n\n^ set symmetric difference operator, 15, 75\n\n^= operator, 75\n\n_ variable, interactive mode, 6, 176\n\n{} dict, 16, 29\n\n{} placeholder in format strings, 72\n\n{} set literal, Python 3, 622\n\n| bitwise-or operator, 65\n\n| set union operator, 15, 75\n\n|= operator, 75\n\n~ bitwise-negation operator, 65\n\n~ expanding user home directory in file-\n\nnames, 397\n\n$variables in strings, 72\n\n0b binary integer literal, 27\n\n0o octal integer literal, 27\n\n0x hexadecimal integer literal, 27\n\n2’s complement and integers, 66\n\n2to3 tool, 635-637\n\nlimitations of, 636\n\n3 command line option, 173, 635\n\nA\n\n‘a’ mode, to open() function, 159\n\na(args) debugger command, pdb module,\n\n187\n\na2b_base64() function, binascii module,\n\n547\n\na2b_hex() function, binascii module, 548\n\na2b_hqx() function, binascii module, 548\n\na2b_uu() function, binascii module, 547\n\nabc module, 136, 257\n\nABCMeta metaclass, 136, 257\n\nabort() function, os module, 390\n\nabort() method, of FTP objects, 497\n\nabs() function, 66, 201\n\noperator module, 273\n\n__abs__() method, 61\n\nabsolute imports, 151 Python 3, 634 compared to relative imports, 151\n\nabsolute value, 66\n\nabspath() function, os.path module, 396\n\nabstract base class, 34, 136, 257\n\ncalling methods in subclasses, 137 checking performed, 137 container objects, 265 error if instantiated, 137 example, 258 files and I/O, 354 numeric types, 253 registering pre-existing classes, 137 special methods for, 57\n\n@abstractmethod decorator, 136-137,\n\n257-258\n\n__abstractmethods__ attribute, of types,\n\n50\n\n@abstractproperty decorator, 136-137,\n\n257-258\n\naccept() method\n\nof Listener objects, 433 of dispatcher objects, 456 of socket objects, 478\n\naccept2dyear variable, time module, 405\n\naccess control specifiers, lack of, 127\n\nF h Lib f L Bdff",
      "content_length": 2321,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 666,
      "content": "%APPDATA% environment variable, Windows\n\n641\n\naccess() function, os module, 386\n\naddLevelName() function, logging module,\n\nacos() function, math module, 251\n\n366\n\nacosh() function, math module, 251\n\naddress attribute\n\nacquire() method\n\nof Condition objects, 441 of Lock objects, 438 of RLock objects, 438 of Semaphore objects, 439\n\nof BaseManager objects, 431 of Listener objects, 433 address families, of sockets, 470\n\naddress_family attribute, of SocketServer\n\nclass, 492\n\nactivate() method, of SocketServer class,\n\naddresses, network, 471\n\n493\n\naddressof() function, ctypes module, 617\n\nactive_children() function, multiprocessing\n\nadjacent string literals, concatenation of, 27\n\nmodule, 434\n\nadler32() function, zlib module, 328\n\nactive_count() function, threading module,\n\nadvanced string formatting, 8, 42, 72\n\n443\n\nAF_* constants, socket module, 470\n\nActivePython, 5\n\naifc module, 588\n\nadd() function, operator module, 273\n\naio_* family of system calls, lack of, 469\n\nadd() method\n\nof TarFile objects, 320 of sets, 15, 46 __add__() method, 60\n\nAJAX, example of, 531\n\nalarm() function, signal module, 399\n\nalarms, 399\n\nadd_data() method, of Request objects,\n\n516\n\nalias debugger command, pdb module, 187\n\nalignment() function, ctypes module, 617\n\nadd_header() method\n\n__all__ variable\n\nof Message objects, 555 of Request objects, 516\n\nadd_option() method, of OptionParser\n\nand import statements, 145 in packages, 150 all() function, 40, 67, 201\n\nobjects, 158, 375\n\nallow_reuse_address attribute, of\n\nadd_password() method, of AuthHandler\n\nSocketServer class, 492\n\nobjects, 519\n\naltsep variable, os module, 386\n\nadd_section() method, of ConfigParser\n\naltzone variable, time module, 405\n\nobjects, 332\n\nand operator, boolean expressions, 9, 77\n\nadd_type() function, mimetypes module,\n\n567\n\nadd_unredirected_header() method, of\n\nRequest objects, 517\n\naddfile() method, of TarFile objects, 320\n\naddFilter() method\n\nof Handler objects, 364 of Logger objects, 359\n\nand_() function, operator module, 274\n\n__and__() method, 60\n\n__annotations__ attribute, of functions,\n\n624\n\nanonymous functions, 112\n\nany() function, 40, 67, 201\n\nanydbm module, 310\n\naddHandler() method, of Logger objects,\n\napi_version variable, sys module, 229\n\n361\n\n%APPDATA% environment variable,\n\naddition operator +, 65\n\nWindows, 177\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2400,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 667,
      "content": "642\n\nappend() method\n\nappend() method\n\nof Element objects, 576 of array objects, 259 of deque objects, 262 of lists, 12, 40\n\nappendChild() method, of DOM Node\n\nobjects, 571\n\nappendleft() method, of deque objects, 262\n\napplication logging, 355\n\napplications, WSGI, 540\n\napplicative order evaluation, 76\n\napply() method, of Pool objects, 424\n\napply_async() method, of Pool objects, 424\n\nargs attribute\n\nof Exception objects, 213 of exceptions, 88 of partial objects, 268\n\nargtypes attribute, of ctypes function\n\nobjects, 613\n\nargv variable, sys module, 13, 157, 174,\n\n229\n\nArithmeticError exception, 87, 212\n\narray module, 259\n\nArray() function, multiprocessing module,\n\n426\n\nArray() method, of Manager objects, 428\n\narray() function, array module, 259\n\narrays, creating from uniform type, 259\n\narraysize attribute, of Cursor objects, 299\n\nas qualifier\n\nof except statement, 22, 85 of from-import statement, 145 of import statement, 24, 144 of with statement, 62, 90\n\nas_integer_ratio() method, of floating point,\n\n39\n\nas_string() method, of Message objects,\n\n555\n\nascii encoding, description of, 169\n\nascii() function, 201\n\nand Python 3, 201 future_builtins module, 217\n\nASCII, and compatibility with UTF-8, 170\n\nascii_letters variable, string module, 287\n\nascii_lowercase variable, string module,\n\n287\n\nascii_uppercase variable, string module,\n\n287\n\nasctime() function, time module, 405\n\nasin() function, math module, 251\n\nasinh() function, math module, 251\n\nassert statement, 91\n\nassert_() method, of TestCase objects, 185\n\nassertAlmostEqual() method, of TestCase\n\nobjects, 185\n\nassertEqual() method, of TestCase objects,\n\n185\n\nAssertionError exception, 87, 91, 213\n\nassertions, 91\n\nstripping with -O option, 148 assertNotAlmostEqual() method, of\n\nTestCase objects, 185\n\nassertNotEqual() method, of TestCase\n\nobjects, 185\n\nassertRaises() method, of TestCase objects,\n\n185\n\nassignment\n\nand reference counting, 34 augmented, 61 in-place operators, 61 of instance attributes, 131 of variables, 7 to variables in nested functions, 97\n\nassociative array, 16, 44\n\nassociativity of operators, 78\n\nastimezone() method, of datetime objects,\n\n340\n\nasynchat class, asynchat module, 452\n\nasynchat module, 452\n\nuse of, 467\n\nasynchronous I/O, 415\n\nasynchronous networking\n\nand blocking operations, 469 when to consider, 467 asyncore module, 415, 455\n\nuse of, 467\n\nAsyncResult objects, multiprocessing mod-\n\nule, 425\n\nF h Lib f L Bdff",
      "content_length": 2420,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 668,
      "content": "BaseProxy class, multiprocessing module\n\n643\n\natan() function, math module, 251\n\nB\n\natan2() function, math module, 251\n\natanh() function, math module, 251\n\natexit module, 179, 219\n\natomic operations, disassembly, 193\n\nB command line option, 173\n\nb character, before a string literal, 29\n\nb(reak) debugger command, pdb module,\n\n187\n\nattach() method, of Message objects, 556\n\nb16decode() function, base64 module, 547\n\nattrgetter() function, operator module, 275\n\nb16encode() function, base64 module, 547\n\nattrib attribute, of Element objects, 576\n\nb2a_base64() function, binascii module,\n\nattribute assignment, on instances, 131\n\n547\n\nattribute binding operator ., 33, 76\n\nb2a_hex() function, binascii module, 548\n\noptimization of, 196\n\nb2a_hqx() function, binascii module, 548\n\nattribute binding\n\nb2a_uu() function, binascii module, 547\n\nand inheritance, 119 and methods, 48 instances and classes, 118 of user-defined objects, 131 process of, 57 redefining in classes, 132 special methods for, 57\n\nb32decode() function, base64 module, 546\n\nb32encode() function, base64 module, 546\n\nb64decode() function, base64 module, 546\n\nb64encode() function, base64 module, 546\n\nbackslash rules, and raw strings, 29\n\n‘backslashreplace’ error handling, Unicode\n\nattribute deletion, on instances, 131\n\nattribute lookup in string formatting, 72\n\nencoding, 166\n\nBadStatusLine exception, http.client mod-\n\nule, 504\n\nAttributeError exception, 87, 213 and attribute binding, 132\n\nbase class, 21\n\nbase-10 decimals, 243\n\nattributes attribute, of DOM Node objects,\n\n570\n\nattributes\n\ncomputed as properties, 117, 124 creation in __init__() method, 118 descriptors, 58, 126 encapsulation of, 127 lookup in composite string formatting,\n\nand floating point, 12\n\nbase64 encoding, description of, 545\n\nbase64 module, 545\n\nBaseCGIHandler() function, wsgiref.handlers\n\nmodule, 542\n\nBaseException class, 212\n\nBaseException exception, 87\n\n42\n\nof objects, 33 private, 127 restricting names with __slots__, 132 user defined on functions, 114\n\nBaseHTTPRequestHandler class, http.server\n\nmodule, 508\n\nBaseHTTPserver module, see http.server,\n\n506\n\nBaseManager() function, multiprocessing\n\naudioop module, 588\n\naugmented assignment operators, 61, 75\n\nmodule, 430\n\nbasename() function, os.path module, 396,\n\n398\n\nauthentication, fetching URLs, 519\n\nBaseProxy class, multiprocessing module,\n\nauthkey attribute, of Process objects, 416\n\n432\n\nawk UNIX command, similarity to list com-\n\nprehensions, 111\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2556,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 669,
      "content": "644\n\nBaseRequestHandler class, SocketServer module\n\nBaseRequestHandler class, SocketServer\n\nbitwise-negation operator ~, 65\n\nmodule, 490\n\nbitwise-or operator |, 65\n\n__bases__ attribute of classes, 131 of types, 50\n\nbitwise-xor operator ^, 65\n\nblank lines, 26\n\nblock_size attribute, of digest objects, 559\n\nbasestring variable, 202\n\nblocking operations, and asynchronous net-\n\nbasicConfig() function, logging module, 355\n\nworking, 469\n\nBasicContext variable, decimal module,\n\n248\n\nBluetooth protocol, 470 address format, 472\n\n.bat files, Windows, 176\n\nBOM (byte order marker), 280\n\nbdb module, 585\n\nand Unicode, 168\n\nBeautiful Soup package, 563\n\nBOM_* constants, codecs module, 280\n\nbetavariate() function, random module, 255\n\nbool type, 38\n\nbidirectional() function, unicodedata mod-\n\nule, 293\n\nbig endian format, 167\n\nbig endian, packing and unpacking, 292\n\nbin() function, 77, 202\n\nbool() function, 202\n\n__bool__() method, 56, 58\n\nboolean expressions, 9, 77 evaluation rules, 78 boolean operators, 66\n\nbinary data structures, packing and\n\nunpacking, 290\n\nboolean values, 27, 38\n\nbinary distribution, creating with distutils,\n\n153\n\nboolean() function, xmlrpc.client module,\n\n525\n\nbinary file mode, 159\n\nbound method, 49, 125\n\nbinary files, 350\n\nbuffered I/O, 351 caution on using line-oriented func-\n\nBoundedSemaphore object\n\nmultiprocessing module, 427 threading module, 439\n\ntions, 351-352\n\nBoundedSemaphore() method, of Manager\n\nbinary integer literals, 27\n\nobjects, 428\n\nBinary() function\n\ndatabase API, 301 xmlrpc.client module, 526\n\nbreak statement, 83-84 and generators, 103\n\nbreaking long statements on multiple lines,\n\nbinascii module, 547\n\nbind() method\n\nof SocketServer class, 493 of dispatcher objects, 456 of socket objects, 478\n\n9\n\nbreakpoint\n\nsetting in debugger, 187 setting manually, 186\n\nbrowser, launching from Python, 544\n\nbinhex module, 587\n\nBSD, kqueue interface, 460\n\nbisect module, 261\n\nBTPROTO_* constants, socket module, 477\n\nbisect() function, bisect module, 261\n\nbuffer, circular, 262\n\nbisect_left() function, bisect module, 261\n\nbuffer_info() method, of array objects, 259\n\nbisect_right() function, bisect module, 261\n\nbuffered binary I/O, 351\n\nbitwise operations and native integers, 66\n\nBufferedIOBase abstract base class, 354\n\nbitwise-and operator &, 65\n\nBufferedRandom class, io module, 352\n\nBufferedReader class, io module, 351\n\nF h Lib f L Bdff",
      "content_length": 2380,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 670,
      "content": "cancel() method, of Timer objects\n\n645\n\nBufferedRWPair class, io module, 352\n\nC\n\nBufferedWriter class, io module, 352\n\nbuffering, and generators, 165\n\nbuild_opener() function, urllib.request mod-\n\nule, 518\n\nbuilt-in exceptions, 23, 87\n\nbuilt-in functions and types, 201\n\nbuilt-in functions, using Python 3 functions\n\nC extensions, 591\n\nand .egg files, 147 and module reloading, 149 compiling with distutils, 596 creating with SWIG, 619 example with ctypes, 618 releasing global interpreter lock, 444\n\nin Python 2, 217\n\nbuilt-in types, 37\n\n__builtin__ module, 201\n\nbuiltin_module_names variable, sys mod-\n\nule, 229\n\nBuiltinFunctionType, 49\n\nBuiltinFunctionType type, 47, 237\n\nbuiltins module, Python 3, 201\n\nbyref() function, ctypes module, 615\n\nc command line option, 173-174\n\nC#, 620\n\nc(ont(inue)) debugger command, pdb mod-\n\nule, 188\n\nC++, difference in class system, 119\n\nC\n\nPython variables compared to, 7 implementation of functions, 49 C/C++ code, in third-party packages, 154\n\nbyte literals, 29\n\nC3 linearization algorithm, and inheritance,\n\nbyte strings, 41\n\n121\n\nand WSGI, 541 and files, 160 and system interfaces in Python 3, 630 as in-memory binary files, 352 decoding as Unicode, 165 different behavior in Python 3, 629 lack of formatting in Python 3, 629 mixing with Unicode strings, 70, 167 mutable byte arrays, 202 use in system interfaces, 633\n\nc_* datatypes, ctypes module, 614\n\nCacheFTPHandler class, urllib.request mod-\n\nule, 518\n\ncaching results of a function, 242\n\ncalcsize() function, struct module, 291\n\ncalendar module, 588\n\ncall() function, subprocess module, 403\n\n__call__() method, 50, 62\n\nCallable abstract base class, 265\n\nbytearray() function, 202\n\nbyteorder variable, sys module, 229\n\nbytes datatype, Python 3, 29\n\nbytes() function, 202-203\n\nbytes, escape code in strings, 28\n\ncallable objects\n\nand __call__() method, 62 classes, 50 instances, 50 types of, 47 callback functions, 98\n\nBytesIO class, io module, 352\n\nand lambda, 112\n\nbyteswap() method, of array objects, 259\n\ncalling Python functions from C, 610\n\nbz2 module, 313\n\ncalling a function, 18, 93\n\nBZ2Compressor() function, bz2 module,\n\n313\n\n_callmethod() method, of BaseProxy\n\nobjects, 433\n\nBZ2Decompressor() function, bz2 module,\n\n314\n\nBZ2File() function, bz2 module, 313\n\ncallproc() method, of Cursor objects, 298\n\ncancel() method, of Timer objects, 438\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2444,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 671,
      "content": "646\n\ncancel_join_thread() method, of Queue objects\n\ncancel_join_thread() method, of Queue\n\nchained comparisons, 66\n\nobjects, 418\n\nchained exceptions, Python 3, 627\n\nCannotSendHeader exception, http.client\n\nmodule, 504\n\nchanging display of results, interactive\n\nmode, 176\n\nCannotSendRequest exception, http.client\n\nmodule, 504\n\ncapitalize() method, of strings, 41-42\n\ncapitals attribute, of Context objects, 247\n\nchanging module name on import, 144\n\nchanging the working directory, 379\n\nchanging user-agent header in HTTP\n\nrequests, 517\n\ncapwords() function, string module, 290\n\ncharacter substitution, 42\n\ncase conversion, of strings, 43-44\n\ncharacters() method, of ContentHandler\n\ncase sensitivity, of identifiers, 26\n\nobjects, 581\n\ncase statement, lack of, 9\n\ncharacters\n\ncast() function, ctypes module, 617\n\ncatching all exceptions, 85\n\ncatching multiple exceptions, 85\n\nescape codes, 28 specifying Unicode, 28 chdir() function, os module, 379\n\ncategory() function, unicodedata module,\n\ncheck_call() function, subprocess module,\n\n170, 293\n\n403\n\n__cause__ attribute, of Exception objects,\n\ncheck_unused_args() method, of Formatter\n\n213, 627\n\nobjects, 289\n\ncaution with range() function, 17\n\nchecking if running as main program, 146\n\nCDLL() function, ctypes module, 612\n\nchecking multiple cases with a conditional,\n\nceil() function, math module, 251\n\ncenter() method, of strings, 41-42\n\ncert_time_to_seconds() function, ssl mod-\n\nule, 488\n\nCGI script, 533\n\nadvice for writing, 537 environment variables, 533 executing XML-RPC server within,\n\n9\n\nchflags() function, os module, 386\n\nchicken, multithreaded, 414\n\nchildNodes attribute, of DOM Node objects,\n\n570\n\nchmod() function, os module, 387\n\nchoice() function, random module, 254\n\nchown() function, os module, 387\n\n529\n\nchr() function, 77, 203\n\nrunning WSGI application, 542 use of databases, 538 web frameworks, 538\n\nchroot() function, os module, 379\n\nchunk module, 588\n\ncipher() method, of ssl objects, 487\n\ncgi module, 533\n\ncircular buffer or queue with deque objects,\n\nCGIHandler() function, wsgiref.handlers\n\n262\n\nmodule, 542\n\nCGIHTTPRequestHandler class, http.server\n\ncl(ear) debugger command, pdb module,\n\n188\n\nmodule, 507\n\nCGIHTTPServer module, see http.server,\n\n506\n\ncgitb module, 539\n\nCGIXMLRPCRequestHandler class,\n\nxmlrpc.server module, 528\n\nclass decorators, 102, 141\n\nclass method, 48, 123\n\nattribute binding of, 124 practical use of, 124 class statement, 21, 117\n\nchain() function, itertools module, 270\n\nand inheritance, 21, 119 execution of class body, 138\n\nF h Lib f L Bdff",
      "content_length": 2543,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 672,
      "content": "close() method\n\n647\n\nclass variables, 117\n\nsharing by all instances, 118\n\n__class__ attribute\n\nof instances, 50, 131 of methods, 49\n\nclasses, 21\n\nstatic methods, 22 super() function in methods, 120 supporting pickle module, 228 type of, 47 uniform access principle, 125 versus dicts for storing data, 195\n\n__del__() method and garbage collec-\n\n@classmethod decorator, 48, 123, 125, 203\n\ntion, 221-222\n\nClassType type, old-style classes, 139\n\n__init__() method, 118 __init__() method and inheritance,\n\n120\n\ncleandoc() function, inspect module, 222\n\nclear() method\n\n__slots__ attribute, 132 abstract base class, 136, 257 access control specifiers, lack of, 127 accessing in modules, 144 and metaclasses, 138 as callable, 50 as namespaces, 117 attribute binding rules, 118 class method, 203 creation of instances, 22, 55, 118 customizing attribute access, 57-58 decorators applied to, 102, 141 defining methods, 21 descriptor attributes, 58, 126 difference from C++ or Java, 119 inheritance, 21, 119 inheriting from built-in types, 22 memory management, 128 mixin, 122 multiple inheritance, 120-121 object base class, 119 old-style, 139 operating overloading, 54 optimization of, 195 optimization of inheritance, 233 performance of __slots__, 196 pickling of, 228 private members, 26 redefining attribute binding, 132 scoping rules within, 118 self parameter of methods, 119 special methods, 54\n\nof Element objects, 576 of Event objects, 440 of deque objects, 262 of dicts, 45 of sets, 46\n\nclear_flags() method, of Context objects,\n\n247\n\nclear_memo() method, of Pickler objects,\n\n228\n\n_clear_type_cache() function, sys module,\n\n233\n\nclearing a dictionary, 45\n\nclearing last exception, 233\n\nClient class, multiprocessing module, 433\n\nclient program, 449\n\nTCP example, 451 UDP example, 486 client_address attribute\n\nof BaseHTTPRequestHandler objects,\n\n509\n\nof BaseRequestHandler objects, 490 clock() function, time module, 191, 405\n\ncloneNode() method, of DOM Node objects,\n\n571\n\nclose() function, os module, 381\n\nclose() method\n\nof Connection objects, 297, 421 of Cursor objects, 298 of FTP objects, 498 of HTMLParser objects, 561 of HTTPConnection objects, 503 of Handler objects, 364\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2279,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 673,
      "content": "648\n\nclose() method\n\nof IOBase objects, 349 of Listener objects, 434 of Pool objects, 424 of Queue objects, 418 of TarFile objects, 320 of TreeBuilder objects, 577 of ZipFile objects, 325 of dbm-style database objects, 310 of dispatcher objects, 456 of files, 159 of generators, 20, 53, 103, 105 of generators and synchronization, 104 of mmap objects, 371 of shelve objects, 311 of socket objects, 478 of urlopen objects, 515\n\nclose_when_done() method, of asynchat\n\nobjects, 452\n\nclosed attribute\n\nof IOBase objects, 349 of files, 161\n\nclosefd attribute, of FileIO objects, 350\n\nclosefd parameter, to open() function, 159\n\nCloseKey() function, winreg module, 408\n\ncloserange() function, os module, 382\n\nclosing() function, contextlib module, 268\n\n__closure__ attribute, of functions, 48, 100\n\nclosures, 98-99\n\nand decorators, 101 and nested functions, 99 and wrappers, 100 speedup over classes, 100\n\ncmath module, 251\n\ncmd module, 588\n\ncmp() function, 203\n\nfilecmp module, 314\n\ncmpfiles() function, filecmp module, 314\n\nco_* attributes, of code objects, 51-52\n\ncode execution, in modules, 143-144\n\ncode migration\n\nPython 2 to 3, 634 practical strategy for, 637\n\ncode module, 585\n\ncode objects, 51\n\nattributes of, 51 creating with compile() function, 115\n\ncode point, Unicode, 28\n\n__code__ attribute, of functions, 48\n\ncode, executing strings, 115\n\nCodecInfo class, codecs module, 277\n\ncodecs module, 167, 277\n\nremoval of compression codecs, 280 use of byte strings, 280\n\ncoded_value attribute, of Morsel objects,\n\n512\n\ncodeop module, 585\n\nCodeType type, 51, 237\n\n__coerce__() method, deprecation of, 134\n\ncoercion of numeric types, 66-67\n\ncollect function, gc module, 179\n\ncollect() function, gc module, 220\n\ncollect_incoming_data() method, of asyn-\n\nchat objects, 452\n\ncollection, definition of, 33\n\ncollections module, 138, 262\n\ncolorsys module, 588\n\ncombinations() function, itertools module,\n\n271\n\ncombine() method, of datetime class, 339\n\ncombining() function, unicodedata module,\n\n294\n\ncommand attribute, of\n\nBaseHTTPRequestHandler objects, 509\n\ncommand line options, 13, 157\n\nPython 3, 633 detecting settings in a program, 230 for interpreter, 173 parsing with optparse, 374\n\ncommands debugger command, pdb mod-\n\nule, 188\n\ncommands module, 331\n\ncomment attribute, of ZipInfo objects, 327\n\nComment() function, xml.etree.ElementTree\n\nmodule, 575\n\ncomments, 6, 26\n\ncommit() method, of Connection objects,\n\n298\n\nF h Lib f L Bdff",
      "content_length": 2431,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 674,
      "content": "ConfigParser class, configparser module\n\n649\n\ncommon attribute, of dircmp objects, 315\n\ncompress() method\n\ncommon_dirs attribute, of dircmp objects,\n\n315\n\nof BZ2Compressor objects, 313 of compressobj objects, 328\n\ncommon_files attribute, of dircmp objects,\n\ncompress_size attribute, of ZipInfo objects,\n\n315\n\n327\n\ncommon_funny attribute, of dircmp objects,\n\ncompress_type attribute, of ZipInfo objects,\n\n315\n\n327\n\ncommonprefix() function, os.path module,\n\ncompression\n\n396\n\ncommunicate() method, of Popen objects,\n\nof files, 313, 317 zlib compression, 328\n\n403\n\nCompressionError exception, tarfile module,\n\ncomparison operators, 56\n\n322\n\ncomparison, 66\n\ncompressobj() function, zlib module, 328\n\nPython 3, 633 chained, 66 of incompatible objects, 78 of objects, 34 of sequences, 70 of weak references, 242 compilation into bytecode, 148\n\ncomputed attributes and properties, 124\n\nconcat() function, operator module, 274\n\nconcatenation\n\nof adjacent string literals, 27 of lists, 12 of strings, 11 concurrency, 413\n\ncompile() function, 115, 203 re module, 283-284 compileall module, 585\n\ncompiler, lack of, 181\n\ncomplete_statement() function, sqlite3\n\nmodule, 305\n\nComplex abstract base class, 253\n\ncomplex numbers, 27, 39\n\ncmath library module, 251 comparison of, 66\n\nadvice on multiprocessing, 435 and Python programs, 414 and side effects, 96 coroutines, 446 global interpreter lock, 414 limitations on multicore, 414 message passing, 413-415 multitasking with generators, 447 scaling issues, 415 synchronization problems, 414\n\ncomplex type, 38\n\nconcurrent programming, 413\n\ncomplex() function, 76, 203\n\nCondition object\n\n__complex__() method, 61-62 and type coercion, 134 composing email messages, 555\n\nmultiprocessing module, 427 threading module, 441\n\ncondition debugger command, pdb module,\n\ncomposite string formatting, 8, 42, 72\n\n188\n\nand __format__(), 56 and lookups, 42 compress() function bz2 module, 314 zlib module, 328\n\ncondition variable, 441\n\nCondition() method, of Manager objects,\n\n429\n\nconditional expressions, 79\n\nconditionals, 9, 81\n\nConfigParser class, configparser module,\n\n332\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2196,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 675,
      "content": "650\n\nconfigparser module\n\nconfigparser module, 332\n\nconfiguration files, 332\n\ndifference from Python script, 334-335 for logging module, 368 variable substitution, 335 confstr() function, os module, 395\n\nconjugate() method\n\nof complex numbers, 39 of floating point, 39\n\nconnect() function\n\ndatabase API, 297 sqlite3 module, 304\n\nconnect() method\n\nof BaseManager objects, 431 of FTP objects, 498 of HTTPConnection objects, 503 of SMTP objects, 514 of dispatcher objects, 456 of socket objects, 478\n\nconnect_ex() method, of socket objects,\n\n478\n\nconnecting processes, multiprocessing\n\nmodule, 433\n\nConnection class\n\ndatabase API, 297 sqlite3 module, 305\n\nConnectRegistry() function, winreg module,\n\n408\n\nconsole window, Windows, 176\n\nContainer abstract base class, 265\n\ncontainer objects, 29\n\nand reference counting, 34 definition of, 33\n\ncontainment test, in operator, 9\n\ncontains() function, operator module, 274\n\n__contains__() method, 58\n\nContentHandler class, xml.sax module, 581\n\nContentTooShort exception, urllib.error\n\nmodule, 523\n\nContext class, decimal module, 244\n\ncontext management protocol, 62\n\ncontext managers, 62, 89 decimal module, 248 defining with generator, 267\n\nlocking, 442 nested, 267\n\n__context__ attribute, of Exception objects,\n\n213, 627\n\ncontextlib module, 90, 267\n\n@contextmanager decorator, 90\n\ncontinue statement, 83-84\n\ncontrol characters, stripping from a string,\n\n42\n\nconversion of strings to numbers, 11\n\nconversion operations, 76\n\nconvert_field() method, of Formatter\n\nobjects, 289\n\nconverting Python types to C, 611\n\nconverting dictionaries to a list, 16\n\nconverting sequences to a list, 77\n\nconverting sequences to a set, 15\n\nconverting sequences to a tuple, 77\n\nconverting types from C to Python, 602\n\nconverting types from Python to C, 597\n\nCookie module, see http.cookies, 511\n\nCookieError exception, http.cookies mod-\n\nule, 513\n\nCookieJar class, http.cookiejar module, 513\n\ncookielib module, see http.cookiejar, 513\n\ncookies\n\nHTTP, 511 fetching URLs with cookie support,\n\n519\n\ncopy module, 36, 67, 219 limitations of, 220\n\ncopy() function\n\ncopy module, 219 shutil module, 318\n\ncopy() method\n\nof Context objects, 247 of dicts, 45 of digest objects, 559 of hmac objects, 560 of sets, 46\n\ncopy2() function, shutil module, 318\n\n__copy__() method, 220\n\ncopy_reg module, 585\n\nF h Lib f L Bdff",
      "content_length": 2326,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 676,
      "content": "creating custom string formatters\n\n651\n\ncopyfile() function, shutil module, 318\n\ncounting, in loops, 83\n\ncopyfileobj() function, shutil module, 318\n\ncountOf() function, operator module, 274\n\ncopying directories, 318\n\ncp1252 encoding, description of, 169\n\ncopying files, 318\n\ncp437 encoding, description of, 169\n\ncopying\n\ncPickle module, 229\n\nand reference counting, 35 deep copy, 36 dictionary, 45 of mutable objects, 35 shallow copy, 36\n\ncProfile module, 190\n\nCPU time, obtaining, 191, 405\n\nCPU, obtaining number on system, 434\n\nCPU-bound tasks and threads, 444\n\ncpu_count() function, multiprocessing mod-\n\ncopymode() function, shutil module, 318\n\nule, 434\n\ncopyright variable, sys module, 230\n\nCRC attribute, of ZipInfo objects, 327\n\ncopysign() function, math module, 251\n\ncrc32() function\n\ncopystat() function, shutil module, 318\n\ncopytree() function, shutil module, 318\n\nbinascii module, 548 zlib module, 328\n\n@coroutine decorator example, 105\n\ncrc_hqx() function, binascii module, 548\n\ncoroutines, 20, 104\n\ncreate_aggregate() method, of Connection\n\nadvanced example, 460 asynchronous I/O handling, 460 building a call stack of, 463 concurrency, 108 concurrent programming, 446 example of, 20 execution behavior, 105 message passing, 108, 415 multitasking example, 447 practical use of, 107 recursion, 112 sending and returning values, 106 task scheduler with select(), 460 transferring control to another corou-\n\nobjects, 305\n\ncreate_collation() method, of Connection\n\nobjects, 306\n\ncreate_connection() function, socket mod-\n\nule, 473\n\ncreate_decimal() method, of Context\n\nobjects, 247\n\ncreate_function() method, of Connection\n\nobjects, 305\n\ncreate_socket() method, of dispatcher\n\nobjects, 456\n\ncreate_string_buffer() function, ctypes mod-\n\nule, 617\n\ncreate_system attribute, of ZipInfo objects,\n\ntine, 463\n\nuse of next() method, 104 use with network programming, 467\n\ncos() function, math module, 251\n\n327\n\ncreate_unicode_buffer() function, ctypes\n\nmodule, 617\n\ncreate_version attribute, of ZipInfo objects,\n\n327\n\ncosh() function, math module, 251\n\ncreated attribute, of Record objects, 359\n\ncount() function, itertools module, 271\n\nCreateKey() function, winreg module, 408\n\ncount() method\n\ncreating a Windows installer, 153\n\nof array objects, 260 of lists, 40 of strings, 42\n\ncreating a binary distribution, 153\n\ncreating a source distribution, 153\n\ncreating custom string formatters, 288\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2493,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 677,
      "content": "652\n\ncreating programs\n\ncreating programs, 6\n\ncreating random numbers, 254\n\ncreating user-defined instances, 22\n\ncreation of instances, 118 steps involved, 129\n\ncreation of .pyc and .pyo files, 148\n\ncritical sections, locking of, 414\n\ncritical() method, of Logger objects, 357\n\ncrypt module, 586\n\ncrytographic hashing functions, 559\n\nCSV data, example of reading, 14\n\nCSV files\n\nparsing, 548 type conversion of columns, 37\n\ncsv module, 548\n\nctermid() function, os module, 379\n\nctime() function, time module, 405\n\nctime() method, of date objects, 337\n\nCtrl-C, keyboard interrupt, 162\n\nctypes module, 612 array types, 614 available datatypes, 614 casting datatypes, 617 creating byte strings, 617 creating objects from buffers, 616 example of, 618 finding library modules, 612 loading shared libraries, 612 memory copying, 617 passing pointers and references, 615 pointer types, 614 setting function prototypes, 613 shared data with multiprocessing, 426 structure types, 615\n\ncunifvariate() function, random module,\n\n255\n\ncurdir variable, os module, 386\n\ncurly braces, and dictionary, 16\n\ncurrent time, obtaining, 405\n\n_current_frames() function, sys module,\n\n233\n\ncurrent_process() function, multiprocessing\n\nmodule, 434\n\ncurrent_thread() function, threading mod-\n\nule, 443\n\ncurrentframe() function, inspect module,\n\n222\n\ncurrying, and partial function evaluation,\n\n76\n\ncurses module, 586\n\nCursor class, database API, 298\n\ncursor() method, of Connection objects,\n\n298\n\ncwd() method, of FTP objects, 498\n\ncycle() function, itertools module, 271\n\ncycles, and garbage collection, 35\n\ncyclic data structures, and __del__()\n\nmethod, 129\n\nD\n\nd(own) debugger command, pdb module,\n\n188\n\ndaemon attribute\n\nof Process objects, 416 of Thread objects, 436\n\ndaemonic process, 415\n\ndaemonic thread, 436\n\ndangling comma\n\nand print statement, 10 and tuples, 14 print statement, 162\n\ndata attribute, of DOM Text objects, 572\n\ndata encapsulation, 127\n\ndata structures\n\nand dictionaries, 16 lists and tuples, 14 named tuples, 264\n\ndata() method, of TreeBuilder objects, 577\n\ndata-flow processing, and coroutines, 107\n\ndatabase API, 297\n\ndatabase interface, 297 and threads, 302\n\ndatabase results, converting into dictionar-\n\nies, 303\n\nF h Lib f L Bdff",
      "content_length": 2231,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 678,
      "content": "decorators\n\n653\n\ndatabase\n\nentire programs from command shell,\n\nand CGI script, 538 persistent dictionary, 171\n\nDatabaseError exception, database API,\n\n302\n\ndatabases, DBM-style, 310\n\nDataError exception, database API, 302\n\n189\n\nmanually setting a breakpoint, 186 pdb module, 186 running a function, 186 specifying a breakpoint, 187 use of logging module, 355 Decimal class, decimal module, 243\n\nDatagramHandler class, logging module,\n\n362\n\nDecimal object, converting to a fraction,\n\nDatagramRequestHandler class, SocketServer module, 491\n\n250\n\ndecimal module, 39, 243\n\ndatagrams, 470\n\ndate and time manipulation, 336\n\ndate class, datetime module, 336\n\nand sum() function, 69 and threads, 249 rounding behavior, 245\n\ndate parsing, 343, 407\n\nDate() function, database API, 301\n\ndate() method, of datetime objects, 340\n\ndate_time attribute, of ZipInfo objects, 327\n\nDateFromTicks() function, database API,\n\n301\n\ndecimal() function, unicodedata module,\n\n295\n\ndeclarative programming, 110\n\ndecode() function\n\nbase64 module, 547 quopri module, 568\n\ndatetime class, datetime module, 339\n\ndatetime module, 336\n\nDateTime() function, xmlrpc.client module,\n\n526\n\nday attribute, of date objects, 337\n\ndaylight variable, time module, 405\n\ndbhash module, 310\n\ndbm module, 310\n\nDBM-style databases, 310\n\ndecode() method\n\nin Python 3, 629 of CodecInfo objects, 277 of IncrementalDecoder objects, 279 of JSONDecoder objects, 565 of strings, 29, 42, 165-166 proper use of, 166 decodestring() function base64 module, 547 quopri module, 568\n\ndeadlock, source with locking, 442\n\ndecomposition() function, unicodedata\n\ndebug attribute\n\nmodule, 295\n\nof TarFile objects, 320 of ZipFile objects, 325 of sys.flags, 230\n\n__debug__ variable, 91, 369\n\ndecompress() function\n\nbz2 module, 314 zlib module, 328 decompress() method\n\ndebug() method, of Logger objects, 357\n\ndebugging\n\nof BZ2Decompressor objects, 314 of decompressobj objects, 328\n\nCGI scripts, 539 after an uncaught exception, 186 checking for memory leaks, 221 configuring the debugger, 190\n\ndecompressobj() function, zlib module, 328\n\ndecorators, 22, 101\n\napplied to class definitions, 102, 141 copying function attributes, 269\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2261,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 679,
      "content": "654\n\ndecorators\n\ndocumentation strings, 102, 113 example of, 101 multiple, 31 performance benefits, 197 placement of, 30, 101 recursive functions, 102, 113 user-defined function attributes, 102,\n\n114\n\nwith arguments, 102\n\ndeep copy, 36\n\ndeepcopy() function, copy module, 219\n\n__deepcopy__() method, 220\n\ndef statement, 18, 48, 93\n\ndefault Unicode encoding, 166, 177\n\ndefault Unicode error handling policy, 167\n\ndefault arguments, 18, 93 and mutable values, 94 binding of values, 93\n\ndefault() method, of JSONEncoder objects,\n\n566\n\ndefault_factory attribute, of defaultdict\n\nobjects, 263\n\nDefaultContext variable, decimal module,\n\n248\n\ndefaultdict() function, collections module,\n\n263\n\n__defaults__ attribute, of functions, 48\n\ndefaults() method, of ConfigParser objects,\n\n333\n\ndefects attribute, of Message objects, 554\n\ndefining functions, 18\n\ndefining multiple instance creation meth-\n\nods, 123\n\ndefining new exceptions, 88\n\ndegrees() function, math module, 251\n\ndel operator, on dictionaries, 16, 74\n\ndel statement, 35, 69\n\nand __del__() method, 129 and slices, 40 deleting mapping items, 45\n\n__del__() method, 55, 129\n\nand program termination, 179 danger of defining, 129\n\ngarbage collection, 129, 221-222 uses of, 55\n\ndel_param() method, of Message objects,\n\n556\n\ndelattr() function, 203\n\nand private attributes, 128 __delattr__() method, 57-58, 131\n\ndelayed evaluation, 99\n\ndelayed execution, using threads, 437\n\ndelete() method, of FTP objects, 498\n\n__delete__() method, of descriptors, 58,\n\n126\n\nDeleteKey() function, winreg module, 409\n\n@deleter decorator of properties, 126\n\nDeleteValue() function, winreg module, 409\n\ndeleting items from a dictionary, 16\n\ndeleting sequence items, 40\n\ndeleting slices, 40, 69\n\ndeletion of instance attributes, 131\n\ndelimiters, 30\n\ndelitem() function, operator module, 274\n\n__delitem__() method, 58-59\n\nand slices, 59\n\ndelslice() function, operator module, 274\n\ndemo_app() function, wsgiref.simple_server\n\nmodule, 542\n\ndenominator attribute\n\nof Fraction objects, 250 of integers, 39\n\nDeprecationWarning warning, 216, 238\n\ndeque object\n\ncollections module, 194 versus list, 194\n\ndeque() function, collections module, 262\n\nDER_cert_to_PEM_cert() function, ssl mod-\n\nule, 488\n\ndereference attribute, of TarFile objects,\n\n320\n\nderived class, 119\n\ndescription attribute, of Cursor objects, 299\n\ndescriptors, 58, 126\n\nand metaclasses, 140\n\ndetecting end of file (EOF), 160\n\nF h Lib f L Bdff",
      "content_length": 2427,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 680,
      "content": "directories\n\n655\n\ndetecting the settings of interpreter com-\n\nmand line options, 230\n\ndevnull variable, os module, 386\n\nDialect class, csv module, 551\n\ndict type, 38\n\n__dict__ attribute of classes, 131 of functions, 48, 114 of instances, 50, 131 of modules, 51, 144 of types, 50 of user-defined objects, 63\n\nobtaining keys, 45-46 obtaining values, 45 performance of, 16 performance of in operator, 197 persistent with shelve module, 171 removing items, 16 shared by multiple processes, 429 tuples as keys, 74 updating, 45 use as a data structure, 16 use as a lookup table, 16 using functions as values, 37 using to pass keyword function argu-\n\ndict() function, 16, 77, 204\n\nperformance properties, 195\n\ndict() method, of Manager objects, 429\n\nments, 95\n\nview objects in Python 3, 632 DictReader() function, csv module, 550\n\ndictionary comprehension, Python 3, 623\n\ndictionary, 16, 44\n\nacceptable key types, 16 accessing items, 16 and Python 3 caution, 45 and __hash__() method, 56 and string formatting, 70, 72 automatic creation of initial values, 263 clearing, 45 compared to defaultdict objects, 263 converting to a list, 16 copying, 45 creating from database results, 303 creation with dict() function, 204 defining empty, 16 deleting items, 16, 45 equality of, 78 indexing operator, 74 inserting items, 16 item assignment, 74 item deletion, 74 iterating over keys, 17 key values, 44, 74 list of items, 45 lookup in composite string formatting,\n\ndicts, versus classes for storing data, 195\n\nDictWriter() function, csv module, 550\n\ndiff_files attribute, of dircmp objects, 315\n\ndifference operator -, of sets, 15\n\ndifference() method, of sets, 46\n\ndifference_update() method, of sets, 46\n\ndifflib module, 586\n\ndig attribute, of sys.float_info, 231\n\ndigest() method\n\nof digest objects, 559 of hmac objects, 560\n\ndigest_size attribute, of digest objects, 559\n\ndigit() function, unicodedata module, 295\n\ndigits variable, string module, 287\n\ndir() function, 21, 24, 204\n\nhiding attribute names in classes, 128,\n\n204\n\ndir() method, of FTP objects, 498\n\n__dir__() method, 63, 128, 204\n\ndircmp() function, filecmp module, 314\n\ndirectories\n\n42, 72\n\nlookup with default value, 16\n\ncomparing, 314 copying, 318 reading files with shell wildcards, 317 recursive traversal, 390\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2365,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 681,
      "content": "656\n\ndirectories\n\nsystem functions for accessing, 386 temporary, 323 testing filenames for, 397\n\ndirname() function, os.path module, 396\n\ndis module, 585\n\ndis(), dis module, 193\n\ndisable debugger command, pdb module,\n\n188\n\ndisable() function\n\ngc module, 220 logging module, 366\n\ndisable_interspersed_args() method, of\n\nOptionParser objects, 376\n\ndisabling garbage collection, 220\n\ndisabling newline translation, 159\n\ndisassembly, 193\n\ndiscard() method, of sets, 47\n\ndiscard_buffers() method, of asynchat\n\nobjects, 452\n\ndispatcher class, asyncore module, 455\n\n__displayhook__ variable, sys module, 230\n\ndisplayhook() function, sys module, 176,\n\n233\n\ndisposition attribute, of FieldStorage\n\nobjects, 535\n\ndisposition_options attribute, of\n\nFieldStorage objects, 535\n\ndistributed computing, and multiprocessing\n\nmodule, 435\n\ndistributing programs, 152\n\ndistutils module, 152-153, 585, 596 and extension modules, 596 creating binary distributions, 153 creating extensions with SWIG, 620\n\ndiv() function, operator module, 273\n\n__div__() method, 60\n\ndivision of integers, Python 3, 633\n\ndivision operator /, 65\n\ndivision operator, Python 2 versus Python\n\n3, 61\n\ndivision, truncation of integers, 61-62, 65\n\ndivision_new attribute, of sys.flags, 230\n\ndivision_warning attribute, of sys.flags, 230\n\ndivmod() function, 66, 204\n\n__divmod__() method, 60\n\ndllhandle variable, sys module, 230\n\nDLLs\n\ncreating with distutils, 596 extension modules, 148 loading with ctypes, 612\n\ndo_handshake() method, of ssl objects,\n\n487\n\n__doc__ attribute\n\nof built-in functions, 49 of functions, 24, 48, 113 of methods, 49 of modules, 51 of objects, 30 of types, 50\n\nDocCGIXMLRPCRequestHandler class, xmlr-\n\npc.server module, 528\n\ndoctest module, 181-182\n\nverbose option, 182\n\nDocument class, xml.dom.minidom mod-\n\nule, 571\n\ndocumentation string, copying to decorator,\n\n269\n\ndocumentation strings, 24, 30, 48, 113\n\nand XML-RPC, 527 and decorators, 102, 113 and indentation, 30 doctest module, 181 in extension modules, 595 stripping with -OO option, 148 testing, 181\n\ndocumentElement attribute, of DOM\n\nDocument objects, 571\n\nDocXMLRPCServer class, xmlrpc.server\n\nmodule, 527\n\nDocXMLRPCServer module, 527\n\ndollar-variable substitution, 163\n\nDOM interface\n\nXML parsing, 568 example of, 573\n\ndont_write_bytecode attribute, of sys.flags,\n\n230\n\ndont_write_bytecode variable, sys module,\n\n230\n\nF h Lib f L Bdff",
      "content_length": 2378,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 682,
      "content": "enable() function\n\n657\n\ndouble precision floating point, 38\n\nElement() function, xml.etree.ElementTree\n\ndouble-clicking on .py files, 6\n\nmodule, 575\n\ndouble-underscores, use in identifiers, 26\n\ndropwhile() function, itertools module, 271\n\ndst() method\n\nof time objects, 338 of tzinfo objects, 342\n\nElementTree class, xml.etree.ElementTree\n\nmodule, 573\n\nElementTree interface, XML parsing, 569\n\nElementTree, examples of, 578\n\nelif statement, 9, 81\n\nduck typing, 122\n\nEllipsis, 30, 51, 54\n\ndumbdbm module, 310\n\ndump() function\n\njson module, 564 marshal module, 226 pickle module, 171, 227 xml.etree.ElementTree module, 578 dump() method, of Pickler objects, 228\n\nexpression in Python 3, 626 type of, 51 use in extended slicing, 59 use in indexing methods, 54\n\nelse clause\n\nof try statement, 86 of while and for loops, 84\n\ndumps() function\n\njson module, 564 marshal module, 226 pickle module, 227 xmlrpc.client module, 526 dup() function, os module, 382\n\ndup2() function, os module, 382\n\nelse statement, 9, 81\n\nemail messages\n\ncomposing, 555 example of composing and sending,\n\n558\n\nexample of sending, 514 parsing, 552 email package, 552\n\ndynamic binding, of object attributes, 122\n\nEmax attribute, of Context objects, 247\n\ndynamic loading, of modules, 144\n\nembedding Unicode characters in web\n\ndynamic scope, lack of, 97\n\npages, 167\n\ndynamic typing of variables, 7\n\nembedding the interpreter in C programs,\n\n591, 608\n\nE\n\nE command line option, 173\n\ne variable, math module, 252\n\nembedding\n\ncalling functions from C, 610 converting Python types to C, 611 Emin attribute, of Context objects, 247\n\nEAI_* constants, socket module, 485\n\nEmpty exception, Queue module, 418, 445\n\neast_asian_width() function, unicodedata\n\nmodule, 296\n\neasy_install command, setuptools package,\n\n155\n\n.egg files, 154\n\nand modules, 147 and site configuration, 177 structure of, 147\n\nElement class, xml.dom.minidom module,\n\n572\n\nempty dictionary, 16\n\nempty list, 12\n\nempty() method, of Queue objects, 418,\n\n445\n\nenable debugger command, pdb module,\n\n188\n\nenable() function\n\ncgitb module, 539 gc module, 220\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2175,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 683,
      "content": "658\n\nenable_callback_tracebacks() function, sqlite3 module\n\nenable_callback_tracebacks() function,\n\nendpos attribute, of MatchObject objects,\n\nsqlite3 module, 305\n\n286\n\nenable_interspersed_args() method, of\n\nOptionParser objects, 376\n\nendPrefixMapping() method, of ContentHandler objects, 581\n\nenabling the print() function in Python 2.6,\n\nendswith() method, of strings, 42\n\n163\n\n__enter__() method, of context managers,\n\nencapsulation, 127\n\n62, 89\n\nencode() function\n\nbase64 module, 547 quopri module, 568\n\nenumerate() function, 83, 204 threading module, 443\n\nEnumKey() function, winreg module, 409\n\nencode() method\n\nEnumValue() function, winreg module, 409\n\nin Python 3, 629 of CodecInfo objects, 277 of IncrementalEncoder objects, 278 of JSONEncoder objects, 566 of strings, 42, 165-166 proper use of, 166\n\nEncodedFile class, codecs module, 279\n\nEncodedFile object, codecs module, 167\n\nencodestring() function base64 module, 547 quopri module, 568\n\nenviron variable, os module, 158\n\nenviron variable, os module, 379\n\nenvironment variables, 158, 379\n\nPython 3, 633 WSGI, 540 expanding in filenames, 397 in CGI script, 533 unsetting, 381 used by interpreter, 174\n\nEnvironmentError exception, 87, 212\n\nEOF character, interactive mode, 7\n\nencoding argument to open() function, 159\n\nEOF indication, file I/O, 160\n\nencoding attribute\n\nEOFError exception, 87, 213\n\nof TextIOWrapper objects, 353 of files, 161\n\nepilogue attribute, of Message objects, 554\n\nepoll interface, Linux, 460\n\nencoding issues with network program-\n\nming, 452\n\nepsilon attribute, of sys.float_info, 231\n\nencoding, of source code, 31\n\neq() function, operator module, 274\n\nend attribute, of slices, 54\n\n__eq__() method, 57\n\nend keyword argument, to print() function,\n\nequal to operator ==, 66, 78\n\n163\n\nequality comparison of objects, 34\n\nend() method\n\nerrcheck attribute, of ctypes function\n\nof MatchObject objects, 286 of TreeBuilder objects, 577\n\nobjects, 613\n\nerrno module, 343\n\nend_headers() method, of\n\nerror codes, list of system errors, 344\n\nBaseHTTPRequestHandler objects, 509\n\nerror exception, 396\n\nendDocument() method, of ContentHandler\n\nsocket module, 485\n\nobjects, 581\n\nerror messages, 157\n\nendElement() method, of ContentHandler\n\nerror() method, of Logger objects, 357\n\nobjects, 581\n\nerror_message_format attribute, of\n\nendElementNS() method, of\n\nBaseHTTPRequestHandler class, 508\n\nContentHandler objects, 581\n\nerrorcode variable, errno module, 344\n\nendheaders() method, of HTTPConnection\n\nobjects, 503\n\nerrorlevel attribute, of TarFile objects, 320\n\nF h Lib f L Bdff",
      "content_length": 2549,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 684,
      "content": "executemany() method\n\n659\n\nerrors attribute, of TextIOWrapper objects,\n\nException exception, 87\n\n353\n\nexception handling, in extension modules,\n\nerrors parameter\n\n605\n\nof encoding functions, 166 to open() function, 159\n\nescape codes\n\ndisabling in a string literal, 29 in string literals, 27 non-printing characters, 28\n\nescape() function\n\ncgi module, 536 re module, 283 xml.sax.saxutils module, 583\n\nescaping characters for use in HTML, 536\n\neval() function, 55, 77, 115, 204, 206\n\nand repr(), 55\n\nevaluation\n\nof function arguments, 76 operator precedence and associativity,\n\n78\n\norder of, 78\n\nEvent object\n\nmultiprocessing module, 427 threading module, 440\n\nexception() method, of Logger objects, 358\n\nexceptions, 22, 84-85 and locks, 23 attributes of, 212 catching all, 85 catching multiple types, 85 caution with catching all exceptions, 86 chained in Python 3, 626 clearing last exception, 233 defining new, 88 difference from warnings, 216 error codes for system errors, 344 finally statement, 86 handling of, 22-23 hierarchy of, 88 ignoring, 85 list of built-in, 87 matching rules, 85 optimization strategies, 196 performance of, 197 propagation of, 85 reraising the last exception, 84 value of, 23, 85\n\nevent loop\n\nand asyncore module, 455 coroutines, 108\n\n.exe file, creating with distutils, 153\n\nEvent() method, of Manager objects, 429\n\nexec statement, caution with legacy code,\n\nevent-driven I/O, 415\n\n115\n\npolling for signals, 399 when to consider, 467 EX_* exit code constants, 391\n\nexec() function, 115, 204\n\nPython 3, 631\n\nexec_prefix variable, sys module, 177, 230\n\nexc_clear() function, sys module, 233\n\nexecl() function, os module, 390\n\nexc_info attribute, of Record objects, 359\n\nexecle() function, os module, 390\n\nexc_info() function, sys module, 53, 89,\n\nexeclp() function, os module, 390\n\n233\n\nexecutable variable, sys module, 230\n\nexcept statement, 22, 84-85 change of syntax, 85\n\n__excepthook__ variable, sys module, 230\n\nexecute() method\n\nof Connection objects, 306 of Cursor objects, 298\n\nexcepthook() function, sys module, 85, 233\n\nexecutemany() method\n\nException class, 212\n\nof Connection objects, 306 of Cursor objects, 298\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2249,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 685,
      "content": "660\n\nexecutescript() method, of Connection objects\n\nexecutescript() method, of Connection\n\nextended slicing operator [::], 67\n\nobjects, 306\n\nextended unpacking of iterables, Python 3,\n\nexecuting programs, 6\n\n623\n\nexecuting strings as code, 115\n\nExtendedContext, decimal module, 248\n\nexecuting system commands, 331\n\nextending with C, 591\n\npopen() function, 392 subprocess module, 402 system() function, 393\n\nextendleft() method, of deque objects, 262\n\nextensible code, with modules, 144\n\nextension modules, 591\n\nexecution model, 81\n\nexecution of __init__.py files, 150\n\ncompilation with distutils, 596 converting types from C to Python,\n\nexecution of class bodies, 117, 138\n\n602\n\nexecv() function, os module, 390\n\nexecve() function, os module, 391\n\nexecvp() function, os module, 391\n\nexecvpe() function, os module, 391\n\nexists() function, os.path module, 396\n\n_exit() function, os module, 179, 391\n\nexit() function, sys module, 179, 233\n\n__exit__() method, 63\n\nof context managers, 62, 89\n\nexitcode attribute, of Process objects, 417\n\nexp() function, math module, 251\n\nconverting types from Python to C,\n\n597\n\nctypes module, 612 difference in Python 3, 595 documentation strings, 595 exception handling, 605 global interpreter lock, 607 hand-written, 593 manual compilation, 597 naming of, 595 reference counting, 607 threads, 607 wrapper functions, 594\n\nexp() method, of Decimal objects, 243\n\nexpand() method, of MatchObject objects,\n\nExtension() function, distutils module, 596\n\n285\n\nextensions_map attribute, of\n\nExpandEnvironmentStrings() function, win-\n\nHTTPRequestHandler class, 508\n\nreg module, 409\n\nexternal_attr attribute, of ZipInfo objects,\n\nexpandtabs() method, of strings, 41-42\n\n327\n\nexpanduser() function, os.path module, 397\n\nextra attribute, of ZipInfo objects, 327\n\nexpandvars() function, os.path module, 397\n\nexponents, range on floating point, 38\n\nextract() method\n\nof TarFile objects, 320 of ZipFile objects, 325\n\nexpovariate() function, random module,\n\n255\n\nexpressions, 7\n\nextend() method\n\nextract_stack() function, traceback module,\n\n236\n\nextract_tb() function, traceback module,\n\n236\n\nof array objects, 260 of deque objects, 262 of lists, 40\n\nextract_version attribute, of ZipInfo objects,\n\n327\n\nextractall() method, of ZipFile objects, 325\n\nextended slices, 39, 59\n\nExtractError exception, tarfile module, 322\n\nassignment to, 40, 69 deletion of, 40, 69 on sequences, 68\n\nextractfile() method, of TarFile objects, 320\n\nextsep variable, os module, 386\n\nF h Lib f L Bdff",
      "content_length": 2492,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 686,
      "content": "filenames\n\n661\n\nF\n\nFieldStorage() function, cgi module, 534\n\nF_* constants, fcntl() function, 347\n\nf_* attributes\n\nof frame objects, 52 of statvfs objects, 389\n\nfabs() function, math module, 251\n\nfile I/O, 10\n\nfile attribute, of FieldStorage objects, 535\n\nfile descriptors, 347\n\nfunctions for manipulation, 382 file keyword argument, to print() function,\n\n10, 163\n\nfactorial() function, math module, 251\n\nfile locking, 348\n\nfail() method, of TestCase objects, 185\n\nfailIf() method, of TestCase objects, 185\n\nWindows, 373 by sqlite3 module, 303\n\nfailIfAlmostEqual() method, of TestCase\n\nobjects, 185\n\nfailIfEqual() method, of TestCase objects,\n\n185\n\nfile modes, use with open() function, 159\n\nfile upload, in CGI scripts, 536\n\n__file__ attribute, of modules, 51\n\nfailUnless() method, of TestCase objects,\n\nfile-like objects, 122\n\n185\n\nfile_offset attribute, of ZipInfo objects, 327\n\nfailUnlessAlmostEqual() method, of\n\nfile_size attribute, of ZipInfo objects, 327\n\nTestCase objects, 185\n\nfilecmp module, 314\n\nfailUnlessEqual() method, of TestCase\n\nfileConfig() function, logging module, 367\n\nobjects, 185\n\nFileCookieJar class, http.cookiejar module,\n\nfailUnlessRaises() method, of TestCase\n\n513\n\nobjects, 185\n\nFileHandler class\n\nfailureException attribute, of TestCase\n\nobjects, 185\n\nlogging module, 362 urllib.request module, 518\n\nFalse value, 9, 27, 38\n\nfamily attribute, of socket objects, 484\n\nFault exception, xmlrpc.client module, 527\n\nfchdir() function, os module, 379\n\nfchmod() function, os module, 382\n\nFileIO class, io module, 350\n\nfilename attribute\n\nof FieldStorage objects, 535 of Record objects, 359 of ZipInfo objects, 327\n\nfchown() function, os module, 382\n\nfilenames\n\nfcntl module, 347\n\nfcntl() function, fcntl module, 347\n\nfdatasync() function, os module, 382\n\nfdopen() function, os module, 382\n\nfeed() method, of HTMLParser objects, 561\n\nWindows drive letters, 399 absolute path of, 396 in Python 3, 633 matching with shell wildcards, 316 portable manipulation of, 396 splitting into directory and base name,\n\nfetchall() method, of Cursor objects, 299\n\nfetching URLs\n\nexample of, 514 example with authentication, 519 example with cookies, 519\n\n398\n\ntesting for existence, 396 testing if directory, 397 testing if link, 397\n\nfetchmany() method, of Cursor objects, 299\n\nfetchone() method, of Cursor objects, 298\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2425,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 687,
      "content": "662\n\nfileno() method\n\nfileno() method\n\nof Connection objects, 421 of IOBase objects, 349 of SocketServer objects, 491 of files, 160-161 of files and sockets, 459 of socket objects, 478 of urlopen objects, 515\n\nfiles, 10\n\nabsolute path of, 396 and Python 3, 160 attributes of, 161 buffer size, 159 buffered binary I/O, 351 bz2 compression, 313 comparing, 314 copying, 318 creation time, 397 decoding as Unicode, 167 description of file modes, 159 detecting end of file (EOF), 160 file pointer, 161, 352 finding on the filesystem, 390 functions for manipulating metadata,\n\n386\n\ngzip compression, 317 iterating over lines, 17-18 last modification time, 397 locking on Windows, 373 low-level control, 347 low-level system calls, 382 memory mapped, 370 methods on, 159 opening, 10, 158-159 opening with Unicode decoding, 167 parsing CSV, 548 problems with io library module, 354 raw binary I/O, 350 reading line by line, 10 seeking, 161 size of, 397 softspace attribute and print statement,\n\n162\n\ntemporary, 323 testing for existence, 396\n\ntypes of, 159 writing to, 159\n\nfill characters in string format specifiers,\n\n73\n\nFilter class, logging module, 359\n\nfilter() function, 205\n\nand Python 3, 205 and optimization, 197 fnmatch module, 316 future_builtins module, 217\n\nfilterwarnings() function, warnings module,\n\n239\n\nfinally statement, 86 and locks, 442\n\nfind() method\n\nof Element objects, 576 of ElementTree objects, 574 of mmap objects, 371 of strings, 41-42\n\nfind_library() function, ctypes module, 612\n\nfindall() function, re module, 283\n\nfindall() method\n\nof Element objects, 576 of ElementTree objects, 574 of Regex objects, 285\n\nfindCaller() method, of Logger objects, 358\n\nfinding all loaded modules, 144\n\nfinding files, 390\n\nfinditer() function, re module, 284\n\nfinditer() method, of Regex objects, 285\n\nfindtext() method\n\nof Element objects, 576 of ElementTree objects, 574\n\nfinish() method, of BaseRequestHandler\n\nobjects, 490\n\nfirst-class objects, 36\n\nuse of, 37\n\nfirstChild attribute, of DOM Node objects,\n\n570\n\nflag_bits attribute, of ZipInfo objects, 327\n\nflags attribute\n\nof Context objects, 247 of Regex objects, 284 flags variable, sys module, 230\n\nF h Lib f L Bdff",
      "content_length": 2180,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 688,
      "content": "format_stack() function, traceback module\n\n663\n\nflaming death, in extension modules, 595\n\nfor statement, 10, 17, 59, 69, 82\n\nfloat type, 38\n\nfloat() function, 13, 62, 76, 205\n\n__float__() method, 61-62 and type coercion, 134\n\nand files, 10, 160 and generators, 19 and tuple unpacking, 15 forcing garbage collection, 220\n\nfloat_info variable, sys module, 231\n\nforeign function interface, ctypes module,\n\nfloating point, 27\n\n612\n\nas dictionary key, 16 binary representation, 39 compared to decimal numbers, 243 converting to a fraction, 39, 250 defining NaN and Inf, 213, 252 inexact representation, 12, 243 low-level properties of, 231 mixing with complex numbers, 39 precision of, 38 random number distributions, 255 representation of, 38\n\nFloatingPointError exception, 87, 213\n\nfork() function, os module, 391\n\nForkingMixIn class, SocketServer module,\n\n493\n\nForkingTCPServer class, SocketServer mod-\n\nule, 494\n\nForkingUDPServer class, SocketServer mod-\n\nule, 494\n\nforkpty() function, os module, 392\n\nformat attribute, of Struct objects, 291\n\nformat codes\n\nfor dates and times, 406 for string formatting operator %, 70-71\n\nflock() function, fcntl module, 348\n\nfloor division, 65\n\nfloor() function, math module, 251\n\nfloordiv() function, operator module, 273\n\n__floordiv__() method, 60\n\nformat specifiers\n\nalignment characters, 73 customized, 74 fill character, 73 format() method of strings, 72-74 nesting of fields, 74\n\nflush() method\n\nformat() function, 8, 11-12, 56, 77, 205\n\nof BZ2Compressor objects, 314 of BufferWriter objects, 352 of Handler objects, 364 of IOBase objects, 349 of compressobj objects, 328 of decompressobj objects, 329 of files, 160 of mmap objects, 371\n\nformat() method\n\nformat specifier codes, 72 of Formatter objects, 288 of strings, 8, 42-43, 56, 72-73, 162 of strings and variable interpolation,\n\n164\n\n__format__() method, 55-56, 74\n\nformat_exc() function, traceback module,\n\nFlushKey() function, winreg module, 409\n\n236\n\nfma() method, of Decimal objects, 243\n\nformat_exception() function, traceback\n\nfmod() function, math module, 251\n\nmodule, 236\n\nfnmatch module, 316\n\nfnmatch() function, fnmatch module, 316\n\nfnmatchcase() function, fnmatch module,\n\n316\n\nfoot, how to shoot, 36, 86, 442, 617\n\nformat_exception_only() function, traceback\n\nmodule, 236\n\nformat_list() function, traceback module,\n\n236\n\nformat_stack() function, traceback module,\n\n236\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2475,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 689,
      "content": "664\n\nformat_tb() function, traceback module\n\nformat_tb() function, traceback module,\n\n236\n\nformat_value() method, of Formatter\n\nobjects, 289\n\nformatargspec() function, inspect module,\n\n222\n\nformatargvalues() function, inspect module,\n\n222\n\nformatted printing, 8, 70-71, 162\n\nformatted strings, 42, 71-72\n\nFormatter class\n\nlogging module, 365 string module, 288 formatter module, 587\n\nformatting, of log messages, 358, 365\n\nformatwarning() function, warnings module,\n\n239\n\nFortran common blocks, lack of, 146\n\nfound_terminator() method, of asynchat\n\nobjects, 453\n\nfpathconf() function, os module, 382\n\nfpectl module, 585\n\nfpformat module, 586\n\nFraction class, fractions module, 250\n\nfractions module, 39, 250\n\nfragment attribute\n\nof urlparse objects, 520 of urlsplit objects, 521\n\nframe objects, 51-52 attributes of, 52 FrameType type, 51, 237\n\nfree variables, in functions, 98\n\nfreeze_support() function, multiprocessing\n\nmodule, 434\n\nfrexp() function, math module, 251\n\nfrom __future__ import, 178\n\nfrom module import *, 24, 145\n\nglobal variables, 146 identifiers with underscores, 26 __all__ variable, 145\n\nfrom statement\n\nand import statement, 24 module imports, 145\n\nfrom_address() method, of ctypes type\n\nobjects, 616\n\nfrom_buffer() method, of ctypes type\n\nobjects, 616\n\nfrom_buffer_copy() method, of ctypes type\n\nobjects, 616\n\nfrom_decimal() method, of Fraction class,\n\n250\n\nfrom_float() method, of Fraction class, 250\n\nfrom_iterable() method, of objects, 270\n\nfrom_param() method, of ctypes type\n\nobjects, 616\n\nfromfd() function, socket module, 473\n\nfromfile() method, of array objects, 260\n\nfromhex() method, of floating point, 39\n\nfromkeys() method, of dicts, 45\n\nfromlist() method, of array objects, 260\n\nfromordinal() method of date class, 336 of datetime class, 339\n\nfromstring() function,\n\nxml.etree.ElementTree module, 575\n\nfromstring() method, of array objects, 260\n\nfromtimestamp() method of date class, 336 of datetime class, 339\n\nfromutc() method, of tzinfo objects, 342\n\nfrozenset type, 38, 46, 75\n\nfrozenset() function, 77, 205\n\nfstat() function, os module, 383\n\nfstatvfs() function, os module, 383\n\nfsum() function, math module, 251\n\nfsync() function, os module, 383\n\nFTP server, uploading files to, 500\n\nFTP() function, ftplib module, 497\n\nFTPHandler class, urllib.request module,\n\n518\n\nftplib module, 497\n\nftruncate() function, os module, 383\n\nFull exception, Queue module, 418, 445\n\nfull() method, of Queue objects, 418, 445\n\nfunc attribute, of partial objects, 268\n\n__func__ attribute, of methods, 49\n\nF h Lib f L Bdff",
      "content_length": 2543,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 690,
      "content": "generator expressions\n\n665\n\nfuncName attribute, of Record objects, 359\n\nfunction call operator (), 47, 76\n\nfunctions, 18\n\n__doc__ attribute, 24 and coroutines, 20 and generators, 19 annotations in Python 3, 624 anonymous, 112 as closures, 98 as dictionary values, 37 as objects, 98 attributes and decorators, 102 attributes of, 48 binding of default values, 93 built-in, 201 callback, 98 calling, 18, 93 change in func_* attribute names, 48 changing recursion limit, 112, 235 copying attributes to decorator, 269 creating wrappers for, 100 decorators, 101 decorators and attributes, 114 default arguments, 18, 93 defining, 93 delayed execution with threads, 437 documentation strings, 48, 113 evaluation of arguments, 76 example of taking any number of argu-\n\nscoping rules, 18, 96 side effects, 95 termination functions, 219 type of built-in, 49 type of user-defined, 47 user-defined, 48 user-defined attributes, 114 variable arguments, 94 variable number of keyword arguments,\n\n95\n\nFunctionType type, 47, 237\n\nfunctools module, 76, 114, 268\n\nfunctor, 62\n\nfunny_files attribute, of dircmp objects, 315\n\nfuture features, enabling, 178\n\n__future__ module, 178 and division, 62 list of features, 178 future_builtins module, 217\n\nFutureWarning warning, 216, 238\n\nfuzzy date and time parsing, 343\n\nG\n\ngaierror exception, socket module, 485\n\ngammavariate() function, random module,\n\n255\n\ngarbage collection, 34-35, 220\n\nments, 95 free variables, 98 keyword arguments, 18, 94 lambda operator, 112 modifying global variables, 18 mutable parameters, 95 nested, 97, 99 optional arguments and None, 38 parameter passing, 95 partial evaluation, 76, 268 pickling of, 228 recursion, 112 returning multiple values from, 18, 96 running in the debugger, 186\n\nand __del__() method, 129 and cycles, 35 and program termination, 179 description of process, 221 observer pattern example, 130 problem with __del__() method, 221\n\ngarbage variable, gc module, 220\n\ngauss() function, random module, 255\n\ngc module, 35, 179, 220\n\ngcd() function, fractions module, 251\n\ngdbm module, 310\n\nge() function, operator module, 274\n\n__ge__() method, 56\n\ngenerator expressions, 109-110\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2247,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 691,
      "content": "666\n\ngenerator expressions\n\nconditional expressions, 79 converting into a list, 110 difference from list comprehension, 110 generator function, and context managers,\n\n90\n\ngenerator objects, 51, 53 attributes of, 53\n\nGeneratorExit exception, 87, 104, 213\n\ngenerators, 19, 102-103\n\nand break statement in iteration, 103 and memory efficiency, 107 and processing pipelines, 19 closing, 53 concurrent programming, 446 execution model, 19 handling of GeneratorExit exception,\n\n213\n\nmultitasking example, 447 practical use of, 106 recursion, 112 throwing exception in, 53 use with I/O, 164-165 use with WSGI, 165 GeneratorType type, 51, 237\n\nget() function, webbrowser module, 544\n\nget() method\n\nof AsyncResult objects, 425 of ConfigParser objects, 333 of Element objects, 576 of Message objects, 552 of Queue objects, 418, 445 of dicts, 16, 45\n\n__get__() method, of descriptors, 58, 126\n\nget_all() method, of Message objects, 552\n\nget_boundary() method, of Message\n\nobjects, 552\n\nget_charset() method, of Message objects,\n\n553\n\nget_charsets() method, of Message objects,\n\n553\n\nget_content_charset() method, of Message\n\nobjects, 553\n\nget_content_maintype() method, of\n\nMessage objects, 553\n\nget_content_subtype() method, of Message\n\nobjects, 553\n\nget_content_type() method, of Message\n\nobjects, 553\n\nget_count() function, gc module, 221\n\nget_data() method, of Request objects, 517\n\nget_debug() function, gc module, 221\n\nget_default_type() method, of Message\n\nobjects, 553\n\nget_dialect() function, csv module, 551\n\nget_errno() function, ctypes module, 617\n\nget_field() method, of Formatter objects,\n\n288\n\nget_filename() method, of Message\n\nobjects, 553\n\nget_full_url() method, of Request objects,\n\n517\n\nget_host() method, of Request objects, 517\n\nget_last_error() function, ctypes module,\n\n617\n\nget_logger() function, multiprocessing mod-\n\nule, 435\n\nget_method() method, of Request objects,\n\n517\n\nget_nowait() method, of Queue objects,\n\n418, 445\n\nget_objects() function, gc module, 221\n\nget_origin_req_host() method, of Request\n\nobjects, 517\n\nget_osfhandle() function, msvcrt module,\n\n372\n\nget_param() method, of Message objects,\n\n553\n\nget_params() method, of Message objects,\n\n553\n\nget_payload() method, of Message objects,\n\n554\n\nget_referents() function, gc module, 221\n\nget_referrers() function, gc module, 221\n\nget_selector() method, of Request objects,\n\n517\n\nget_server_certificate() function, ssl mod-\n\nule, 488\n\nget_starttag_text() method, of HTMLParser\n\nobjects, 561\n\nF h Lib f L Bdff",
      "content_length": 2485,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 692,
      "content": "getinnerframes() function, inspect module\n\n667\n\nget_terminator() method, of asynchat\n\ngetdefaulttimeout() function, socket mod-\n\nobjects, 453\n\nule, 474\n\nget_threshold() function, gc module, 221\n\ngetdlopenflags() function, sys module, 234\n\nget_type() method, of Request objects, 517\n\ngetdoc() function, inspect module, 223\n\nget_unixfrom() method, of Message\n\ngetEffectiveLevel() method, of Logger\n\nobjects, 554\n\nobjects, 360\n\nget_value() method, of Formatter objects,\n\ngetegid() function, os module, 379\n\n289\n\ngetElementsByTagName() method\n\ngetaddrinfo() function, socket module, 473\n\ngetargspec() function, inspect module, 222\n\ngetargvalues() function, inspect module,\n\n222\n\ngetatime() function, os.path module, 397\n\ngetattr() function, 205\n\nof DOM Document objects, 571 of DOM Element objects, 572 getElementsByTagNameNS() method of DOM Document objects, 571 of DOM Element objects, 572 geteuid() function, os module, 380\n\nand private attributes, 128\n\ngetfile() function, inspect module, 223\n\n__getattr__() method, 57 and __slots__, 133\n\ngetfilesystemencoding() function, sys mod-\n\nule, 234\n\ngetAttribute() method, of DOM Element\n\ngetfirst() method, of FieldStorage objects,\n\nobjects, 572\n\n535\n\n__getattribute__() method, 57-58, 132\n\ngetfloat() method, of ConfigParser objects,\n\nand __slots__, 133\n\n333\n\ngetAttributeNS() method, of DOM Element\n\ngetfqdn() function, socket module, 474\n\nobjects, 572\n\n_getframe() function, sys module, 234\n\ngetboolean() method, of ConfigParser\n\ngetframeinfo() function, inspect module,\n\nobjects, 333\n\n223\n\ngetch() function, msvcrt module, 372\n\ngetgid() function, os module, 380\n\ngetche() function, msvcrt module, 372\n\ngetgroups() function, os module, 380\n\ngetcheckinterval() function, sys module,\n\ngetheader() method, of HTTPResponse\n\n234\n\nobjects, 504\n\ngetchildren() method, of Element objects,\n\ngetheaders() method, of HTTPResponse\n\n577\n\nobjects, 504\n\ngetclasstree() function, inspect module,\n\ngethostbyaddr() function, socket module,\n\n222\n\n474\n\ngetcode() method, of urlopen objects, 515\n\ngethostbyname() function, socket module,\n\ngetcomments() function, inspect module,\n\n474\n\n223\n\ngethostbyname_ex() function, socket mod-\n\ngetcontext() function, decimal module, 247\n\nule, 474\n\ngetctime() function, os.path module, 397\n\ngethostname() function, socket module,\n\ngetcwd() function, os module, 379\n\n474\n\ngetcwdu() function, os module, 379\n\ngetinfo() method, of ZipFile objects, 326\n\ngetdefaultencoding() function, sys module,\n\n166, 234\n\ngetinnerframes() function, inspect module,\n\n223\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2612,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 693,
      "content": "668\n\ngetint() method, of ConfigParser objects\n\ngetint() method, of ConfigParser objects,\n\n333\n\ngetitem() function, operator module, 274\n\n__getitem__() method, 58-59\n\nand slices, 59 getiterator() method\n\nof Element objects, 577 of ElementTree objects, 574\n\ngetitimer() function, signal module, 399\n\ngetLength() method, of SAX attributes\n\nobjects, 582\n\ngetLevelName() function, logging module,\n\n366\n\ngetlist() method, of FieldStorage objects,\n\n535\n\ngetloadavg() function, os module, 395\n\ngetLogger() function, logging module, 356\n\ngetlogin() function, os module, 380\n\ngetmember() method, of TarFile objects,\n\n320\n\ngetmembers() function, inspect module,\n\n223\n\ngetmembers() method, of TarFile objects,\n\n321\n\ngetmodule() function, inspect module, 223\n\ngetmoduleinfo() function, inspect module,\n\n223\n\ngetmodulename() function, inspect module,\n\n224\n\ngetmro() function, inspect module, 224\n\ngetmtime() function, os.path module, 397\n\ngetName() method, of Thread objects, 436\n\ngetNameByQName() method, of SAX attrib-\n\nutes objects, 582\n\ngetnameinfo() function, socket module,\n\n474\n\ngetNames() method, of SAX attributes\n\nobjects, 582\n\ngetnames() method, of TarFile objects, 321\n\ngetopt module, 378\n\ngetouterframes() function, inspect module,\n\n224\n\ngetoutput() function, commands module,\n\n331\n\ngetpeercert() method, of ssl objects, 488\n\ngetpeername() method, of socket objects,\n\n478\n\ngetpgid() function, os module, 380\n\ngetpgrp() function, os module, 380\n\ngetpid() function, os module, 380\n\ngetpos() method, of HTMLParser objects,\n\n561\n\ngetppid() function, os module, 380\n\ngetprofile() function, sys module, 234\n\ngetprotobyname() function, socket module,\n\n475\n\ngetQNameByName() method, of SAX attrib-\n\nutes objects, 582\n\ngetQNames() method, of SAX attributes\n\nobjects, 582\n\ngetrandbits() function, random module, 254\n\ngetrecursionlimit() function, sys module,\n\n112, 234\n\ngetrefcount() function, sys module, 35, 234\n\ngetresponse() method, of HTTPConnection\n\nobjects, 503\n\ngetroot() method, of ElementTree objects,\n\n574\n\ngetservbyname() function, socket module,\n\n475\n\ngetservbyport() function, socket module,\n\n475\n\nGetSetDescriptorType type, 237\n\ngetsid() function, os module, 380\n\ngetsignal() function, signal module, 399\n\ngetsize() function, os.path module, 397\n\ngetsizeof() function, sys module, 192, 234\n\ngetslice() function, operator module, 274\n\ngetsockname() method, of socket objects,\n\n478\n\ngetsockopt() method, of socket objects,\n\n478\n\ngetsource() function, inspect module, 224\n\ngetsourcefile() function, inspect module,\n\n224\n\ngetsourcelines() function, inspect module,\n\n224\n\ngetstate() function, random module, 254\n\nF h Lib f L Bdff",
      "content_length": 2628,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 694,
      "content": "GUIs, and network programming\n\n669\n\n__getstate__() method, 228\n\nglobal interpreter lock, 414, 444\n\nand copying, 220 and pickle module, 172\n\nand multiprocessing module, 444 releasing in extensions, 607\n\ngetstatusoutput() function, commands\n\nmodule, 332\n\nglobal statement, 18, 96 and modules, 143\n\ngettarinfo() method, of TarFile objects, 321\n\ngettempdir() function, tempfile module,\n\n323\n\ngettempprefix() function, tempfile module,\n\n323\n\ngettext module, 587\n\nglobal variables, 96 and eval(), 115 and modules, 146 difference from C and Fortran, 146 modifying in a function, 18 storage of in stack frames, 52\n\ngettimeout() method, of socket objects,\n\n482\n\ngetting help, help() function, 24\n\ngetting the current working directory, 379\n\ngettrace() function, sys module, 234\n\ngetType() method, of SAX attributes\n\nobjects, 582\n\n__globals__ attribute, of functions, 48, 99\n\nglobals() function, 205\n\ngmtime() function, time module, 406\n\ngname attribute, of TarInfo objects, 321\n\ngoto statement, lack of, 84\n\ngray-bearded hacker, 622\n\ngetuid() function, os module, 380\n\ngreater than operator >, 66\n\ngeturl() method, of urlopen objects, 515\n\ngreater than or equal to operator >=, 66\n\n_getvalue() method, of BaseProxy objects,\n\ngreen threads, 446\n\n433\n\ngreenlets, 446\n\ngetValue() method, of SAX attributes\n\ngroup() method, of MatchObject objects,\n\nobjects, 582\n\n285\n\ngetvalue() method\n\ngroupby() function, itertools module, 271\n\nof BytesIO objects, 352 of FieldStorage objects, 535 of StringIO objects, 354\n\ngroupdict() method, of MatchObject objects,\n\n286\n\ngroupindex attribute, of Regex objects, 284\n\ngetValueByQName() method, of SAX attrib-\n\ngroups() method, of MatchObject objects,\n\nutes objects, 582\n\n285\n\ngetwch() function, msvcrt module, 372\n\ngrp module, 586\n\ngetwche() function, msvcrt module, 372\n\ngt() function, operator module, 274\n\ngetweakrefcount() function, weakref mod-\n\n__gt__() method, 56\n\nule, 241\n\nguess_all_extensions() function, mimetypes\n\ngetweakrefs() function, weakref module,\n\nmodule, 567\n\n241\n\nguess_extension() function, mimetypes\n\ngetwindowsversion() function, sys module,\n\nmodule, 567\n\n234\n\nguess_type() function, mimetypes module,\n\ngi_* attributes, of generator objects, 53\n\n566\n\ngid attribute, of TarInfo objects, 321\n\nGUI programming, use of partial function\n\nglob module, 317\n\nevaluation, 268\n\nglob() function, glob module, 317\n\nGUIs, and network programming, 467\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2482,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 695,
      "content": "670\n\ngzip module\n\ngzip module, 317\n\nGzipFile() function, gzip module, 317\n\nH\n\nh command line option, 173\n\nh(elp) debugger command, pdb module,\n\n188\n\nhandle() function, cgitb module, 539\n\nhandle() method, of BaseRequestHandler\n\nobjects, 490\n\nhandle_accept() method, of dispatcher\n\nobjects, 455\n\nhandle_charref() method, of HTMLParser\n\nobjects, 561\n\nhandle_close() method, of dispatcher\n\nobjects, 455\n\nhandle_comment() method, of HTMLParser\n\nobjects, 561\n\nhandle_connect() method, of dispatcher\n\nobjects, 455\n\nhandle_data() method, of HTMLParser\n\nobjects, 561\n\nhandle_decl() method, of HTMLParser\n\nobjects, 561\n\nhandle_endtag() method, of HTMLParser\n\nobjects, 562\n\nhandle_entityref() method, of HTMLParser\n\nobjects, 562\n\nhandle_error() method\n\nof SocketServer class, 493 of dispatcher objects, 455\n\nhandle_expt() method, of dispatcher\n\nobjects, 456\n\nhandle_pi() method, of HTMLParser objects,\n\n562\n\nhandle_read() method, of dispatcher\n\nobjects, 456\n\nhandle_startendtag() method, of\n\nHTMLParser objects, 562\n\nhandle_starttag() method, of HTMLParser\n\nobjects, 562\n\nhandle_timeout() method, of SocketServer\n\nclass, 493\n\nhandle_write() method, of dispatcher\n\nobjects, 456\n\nhas_data() method, of Request objects,\n\n517\n\nhas_header() method\n\nof Request objects, 517 of Sniffer objects, 550\n\nhas_ipv6 variable, socket module, 475\n\nhas_key() method, of dicts, 45\n\nhas_option() method, of ConfigParser\n\nobjects, 333\n\nhas_section() method, of ConfigParser\n\nobjects, 333\n\nhasattr() function, 205\n\nand private attributes, 128\n\nhasAttribute() method, of DOM Element\n\nobjects, 572\n\nhasAttributeNS() method, of DOM Element\n\nobjects, 572\n\nhasAttributes() method, of DOM Node\n\nobjects, 571\n\nhasChildNodes() method, of DOM Node\n\nobjects, 571\n\nhash table, 16, 44\n\nhash table based databases, 310\n\nhash() function, 205\n\n__hash__() method, 56\n\nHashable abstract base class, 265\n\nhashlib module, 559 example of, 425\n\nheader_offset attribute, of ZipInfo objects,\n\n327\n\nheaders attribute\n\nof BaseHTTPRequestHandler objects,\n\n509\n\nof FieldStorage objects, 535\n\nheap, 269\n\nheapify() function, heapq module, 269\n\nheapmin() function, msvcrt module, 372\n\nheappop() function, heapq module, 269\n\nheappush() function, heapq module, 269\n\nheappushpop() function, heapq module,\n\n270\n\nheapq module, 269\n\nheapreplace() function, heapq module, 270\n\nhello world program, 5\n\nF h Lib f L Bdff",
      "content_length": 2348,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 696,
      "content": "HTTPResponse objects, http.client module\n\n671\n\nhelp() function, 24, 206\n\nhtons() function, socket module, 475\n\nbizarre output with decorators, 113\n\nHTTP cookies, 511\n\nherror exception, socket module, 485\n\nHTTP protocol\n\nhex() function, 77, 206\n\nfuture_builtins module, 217 hex() method, of floating point, 39\n\ndescription of, 500 request methods, 501 response codes, 501\n\nhexadecimal\n\nHTTP server\n\ncreating strings from integers, 77 integer literals, 27\n\nhexdigest() method\n\nof digest objects, 559 of hmac objects, 560\n\nhexdigits variable, string module, 287\n\ncustom handling of requests, 510 example with asynchat module, 453 example with asyncore module, 457 example with coroutines, 466 example with firewall, 507 standalone example, 508 uploading files in POST request, 505\n\nhexversion variable, sys module, 231\n\nhiding attribute names from dir() function,\n\nhttp package, 500\n\n128\n\nhttp.client module, 502\n\nhierarchical locking, 442\n\nhttp.cookiejar module, 513\n\nhierarchical logging, logging module, 360\n\nhttp.cookies module, 511\n\nhierarchy of exceptions, 87-88\n\nhttp.server module, 506\n\nhierarchy of objects, 137\n\nHTTPBasicAuthHandler class, urllib.request\n\nHIGHEST_PROTOCOL constant, pickle mod-\n\nmodule, 518-519\n\nule, 172\n\nHTTPConnection() function, http.client mod-\n\nHKEY_* constants, winreg module, 408\n\nule, 502\n\nHMAC authentication, 559\n\nhmac module, 559\n\nhostname attribute\n\nHTTPCookieProcessor class, urllib.request\n\nmodule, 518-519\n\nHTTPDefaultErrorHandler class, urllib.request module, 518\n\nof urlparse objects, 520 of urlsplit objects, 521\n\nHTTPDigestAuthHandler class, urllib.request\n\nmodule, 518-519\n\nhostname, obtaining for host machine, 474\n\nHTTPError exception, urllib.error module,\n\nhour attribute, of time objects, 338\n\n523\n\nHTML forms\n\nHTTPException exception, http.client mod-\n\nexample of, 531 uploading with urllib package, 515\n\nule, 504\n\nHTTPHandler class\n\nHTML parsing, 561\n\nhtml.parser module, 561\n\nHTMLParser class, html.parser module,\n\nlogging module, 362 urllib.request module, 518 httplib module, see http.client, 502\n\n561\n\nHTTPRedirectHandler class, urllib.request\n\nHTMLParser module, see html.parser, 561\n\nmodule, 518\n\nHTMLParserError exception, html.parser\n\nmodule, 562\n\nHTTPResponse objects, http.client module,\n\n504\n\nhtonl() function, socket module, 475\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2389,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 697,
      "content": "672\n\nHTTPSConnection() function, http.client module\n\nHTTPSConnection() function, http.client\n\nignore_environment attribute, of sys.flags,\n\nmodule, 502\n\n230\n\nHTTPServer class, http.server module, 506\n\nignore_pattern() function, shutil module,\n\nHTTPSHandler class, urllib.request module,\n\n318\n\n518\n\nignore_zeros attribute, of TarFile objects,\n\nhypot() function, math module, 251\n\n321\n\nignored NameError exception in __del__,\n\nI\n\n179\n\nignoring exceptions, 85\n\ni command line option, 173-174\n\n__ilshift__() method, 61\n\nI/O buffering, and generators, 165\n\nimag attribute\n\nI/O multiplexing, 459\n\n__iadd__() method, 61\n\nof complex numbers, 39 of floating point, 39\n\n__iand__() method, 61\n\nimap() function, itertools module, 272\n\nIBM General Decimal Arithmetic Standard,\n\nimap() method, of Pool objects, 424\n\n243\n\nimap_unordered() method, of Pool objects,\n\nid() function, 33, 206\n\n424\n\nident attribute, of Thread objects, 436\n\nimaplib module, 587\n\nidentifiers, 26\n\nimghdr module, 588\n\nand first-class data, 36 case sensitivity, 26 reserved words, 26 usage of underscores, 26 use of Unicode in Python 3, 622\n\nimmutability, of tuples, 14\n\nimmutable types, inheriting from, 55\n\nimmutable, definition of, 33\n\n__imod__() method, 61\n\nimp module, 224, 585\n\nidentity comparison of objects, 34\n\nimplicit type conversion, lack of, 62\n\nidentity of objects, 33\n\nimport statement, 13, 23-24, 50, 143-144\n\nidentity operator is, 78\n\n__idiv__() method, 61\n\n__idivmod__() method, 61\n\nIDLE, 5-6\n\nand standard I/O streams, 162\n\nIEEE 754, 243\n\nif statement, 9, 81\n\nand __debug__ variable, 91 ifilter() function, itertools module, 271\n\nifilterfalse() function, itertools module, 271\n\n__ifloordiv__() method, 61\n\niglob() function, glob module, 317\n\nignorableWhitespace() method, of ContentHandler objects, 581\n\nignore debugger command, pdb module,\n\nPython 3, 151 absolute imports in packages, 151 and main program, 146 and sys.modules, 144 and sys.path variable, 147 as qualifier, 144 case sensitivity, 148 compilation of .pyc files, 148 execution of modules, 143 module search path, 147 multiple modules, 144 one-time execution of modules, 144 packages, 150 placement within a program, 144 relative package imports, 150-151 scoping rules of loaded code, 145 types of modules, 148\n\n188\n\n‘ignore’ error handling, Unicode encoding,\n\n166\n\nImportError exception, 87, 148, 214\n\nF h Lib f L Bdff",
      "content_length": 2359,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 698,
      "content": "init() function, mimetypes module\n\n673\n\nimporting selected symbols from a mod-\n\nule, 145\n\nImproperConnectionState exception,\n\non strings, 11 on tuples, 14 indexing, 0-based, 11\n\nhttp.client module, 504\n\n__imul__() method, 61\n\nin operator, 9\n\nand __contains__ method, 58 and checking for substrings, 69 on dicts, 16, 45, 74 on sequences, 67, 69\n\nindexOf() function, operator module, 274\n\nindices() method, of slices, 54\n\ninet_aton() function, socket module, 475\n\ninet_ntoa() function, socket module, 476\n\ninet_ntop() function, socket module, 476\n\ninet_pton() function, socket module, 476\n\nin-place assignment operators, 75\n\ninexact representation of floating point, 12\n\nin-place file updates, 159\n\nInf variable, decimal module, 248\n\nin-place mathematical operators, 61\n\nInf\n\nin-place modification\n\nof lists, 40 of sets, 47\n\ndecimal module, 244 infinity, 213\n\ninfo() method\n\nin_dll() method, of ctypes type objects, 616\n\nINADDR_* constants, socket module, 478\n\nof Logger objects, 357 of urlopen objects, 515\n\nIncompleteRead exception, http.client mod-\n\ninfolist() method, of ZipFile objects, 326\n\nule, 504\n\ninheritance, 21, 119\n\nIncrementalDecoder class, codecs module,\n\n279\n\nincrementaldecoder() method, of CodecInfo\n\nobjects, 279\n\nIncrementalEncoder class, codecs module,\n\n278\n\nincrementalencoder() method, of CodecInfo\n\nobjects, 278\n\nindentation, 8, 25\n\nand documentation strings, 30 and line continuation character \\, 9 and tabs, 26 preferred style, 8 putting statements on the same line, 25\n\nIndentationError exception, 87, 214\n\n__mro__ attribute of classes, 121 abstract base classes, 137 attribute binding, 119 calling methods in superclasses, 120 from built-in types, 22 from immutable types, 55 initialization of superclasses, 120 interaction with__slots__, 133 internal optimization of, 233 isinstance() function, 34 issubclass() function, 135 metaclasses, 139 method resolution order, 121 multiple inheritance, 121 preventing redefinition of methods, 128 private methods, 128 use with exceptions, 88\n\nindex() method\n\nof array objects, 260 of lists, 40-41 of strings, 41, 43\n\nIndexError exception, 69, 87, 214\n\n.ini files\n\nconfiguring logging with, 368 reading from Python, 332\n\nindexing operator [], 39, 67\n\ninit() function, mimetypes module, 567\n\non lists, 12 on sequences, 68\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2384,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 699,
      "content": "674\n\n__init__() method\n\n__init__() method, 50, 54-55 and exceptions, 88 and inheritance, 120 and instance creation, 129 and metaclasses, 139 and pickle, 228 defining multiple instance creation\n\nmethods, 123 of classes, 22, 118\n\n__init__.py files in packages, 149\n\ninput() function, 162, 206\n\nPython 3, 11\n\ninsert() method\n\nof Element objects, 577 of array objects, 260 of lists, 12, 41\n\ninsertBefore() method, of DOM Node\n\nobjects, 571\n\ninserting items into a dictionary, 16\n\ninserting items into a list, 41\n\ninsort() function, bisect module, 261\n\ninsort_left() function, bisect module, 261\n\ninsort_right() function, bisect module, 261\n\ninspect attribute, of sys.flags, 230\n\ninspect module, 222\n\ninspecting objects, with dir(), 63\n\ninstall command, of setup.py files, 154\n\ninstall_opener() function, urllib.request\n\nmodule, 518\n\ninstallation of third-party packages, 154\n\nin user directory, 154 installing a package, 153\n\ninstance methods, 48, 118\n\n__instancecheck__() method, 57, 136\n\ninstances, 117\n\nas callable, 50 attribute assignment, 131 attribute deletion, 131 creation of, 55, 118, 129 definition of, 33 pickling of, 228 type of, 50\n\ninstantiation of abstract base class, 137\n\nint type, 38\n\nint() function, 11, 62, 76, 206\n\n__int__() method, 61-62\n\nand type coercion, 134 integer division, Python 3, 633\n\nintegers, 27\n\n2’s complement representation, 66 as dictionary key, 16 automatic promotion to long, 27 conversion to longs, 38 creating hexadecimal strings, 77 creating random, 254 overflow behavior, 66 range of, 38 specifying as hex, octal, or binary, 27\n\nIntegral abstract base class, 253\n\nIntegrityError exception, database API, 302\n\ninteractive attribute, of sys.flags, 230\n\ninteractive mode, 6, 175 and blank lines, 26 display of results, 55, 176\n\ninteractive terminal, 174\n\nInterfaceError exception, database API, 302\n\ninternal_attr attribute, of ZipInfo objects,\n\n327\n\nInternalError exception, database API, 302\n\ninternational characters\n\nand string comparison, 70 in source code, 31\n\ninterpolation, of values in strings, 72\n\ninterpreter, 5\n\ninterpreter command line options, 173\n\ninterpreter environment variables, 174\n\ninterpreter prompts, 175\n\ninterpreter, -t and -tt options, 26\n\ninterprocess communication (IPC), 413\n\ninterrupt() method, of Connection objects,\n\n306\n\nintersection operator &, of sets, 15\n\nintersection() method, of sets, 46\n\nintersection_update() method, of sets, 47\n\ninterval timer, 399\n\nintrospection of objects, 222\n\ninv() function, operator module, 273\n\nF h Lib f L Bdff",
      "content_length": 2514,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 700,
      "content": "islower() method, of strings\n\n675\n\nInvalidURL exception, http.client module,\n\nisalnum() method, of strings, 41, 43\n\n504\n\nisalpha() method, of strings, 43\n\ninvert() function, operator module, 274\n\nisatty() function, os module, 383\n\n__invert__() method, 61\n\nisatty() method\n\nio module, 349\n\nPython 3, 631 problems associated with, 354\n\nof IOBase objects, 349 of files, 160\n\nisblk() method, of TarInfo objects, 321\n\nIOBase abstract base class, 354\n\nisbuiltin() function, inspect module, 224\n\nIOBase class, io module, 349\n\nischr() method, of TarInfo objects, 321\n\nioctl() function, fcntl module, 348\n\nisclass() function, inspect module, 224\n\nioctl() method, of socket objects, 482\n\niscode() function, inspect module, 225\n\nIOError exception, 87, 214\n\nisDaemon() method, of Thread objects, 437\n\n__ior__() method, 61\n\nisdatadescriptor() function, inspect module,\n\nIP_* socket options, socket module, 480\n\n225\n\n__ipow__() method, 61\n\nisdev() method, of TarInfo objects, 321\n\nIPPROTO_* constants, socket module, 476\n\nisdigit() method, of strings, 43\n\nIPv4 protocol, 470\n\nisdir() function, os.path module, 397\n\naddress format, 471\n\nisdir() method, of TarInfo objects, 321\n\nIPv6 protocol, 470\n\nisdisjoint() method, of sets, 46\n\naddress format, 471\n\niselement() function, xml.etree.ElementTree\n\nIPV6_* socket options, socket module,\n\nmodule, 578\n\n480-481\n\nisenabled() function, gc module, 221\n\nIronPython, 5\n\nisEnabledFor() method, of Logger objects,\n\nexample of, 620 __irshift__() method, 61\n\n359\n\nisfifo() method, of TarInfo objects, 321\n\nis operator, object identity, 34, 78\n\nisfile() function, os.path module, 397\n\nis_() function, operator module, 274\n\nisfile() method, of TarInfo objects, 321\n\nis_alive() method\n\nisframe() function, inspect module, 225\n\nof Process objects, 416 of Thread objects, 436\n\nisfunction() function, inspect module, 225\n\nisgenerator() function, inspect module, 225\n\nis_multipart() method, of Message objects,\n\n554\n\nisgeneratorfunction() function, inspect mod-\n\nule, 225\n\nis_not() function, operator module, 274\n\nisinf() function, math module, 252\n\nis_set() method, of Event objects, 440\n\nisinstance() function, 34, 37, 135, 206-207\n\nis_tarfile() function, tarfile module, 319\n\nis_unverifiable() method, of Request\n\nobjects, 517\n\nand inheritance, 134 and proxy objects, 135 redefining behavior of, 136\n\nis_zipfile() function, zipfile module, 325\n\nislice() function, itertools module, 272\n\nisabs() function, os.path module, 397\n\nislink() function, os.path module, 397\n\nisabstract() function, inspect module, 224\n\nislnk() method, of TarInfo objects, 321\n\nisAlive() method, of Thread objects, 436\n\nislower() method, of strings, 43\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2742,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 701,
      "content": "676\n\nismethod() function, inspect module\n\nismethod() function, inspect module, 225\n\nismethoddescriptor() function, inspect mod-\n\nule, 225\n\nismodule() function, inspect module, 225\n\nismount() function, os.path module, 397\n\nisnan() function, math module, 252\n\niso-8859-1 encoding, description of, 169\n\nisocalendar() method, of date objects, 337\n\nisoformat() method\n\nof date objects, 337 of time objects, 338\n\nisoweekday() method, of date objects, 337\n\nisreg() method, of TarInfo objects, 321\n\nisReservedKey() method, of Morsel objects,\n\n512\n\nisroutine() function, inspect module, 225\n\nisSameNode() method, of DOM Node\n\nobjects, 571\n\nisspace() method, of strings, 43\n\nissubclass() function, 135, 206 redefining behavior of, 136\n\nissubset() method, of sets, 46\n\nissuperset() method, of sets, 46\n\nissym() method, of TarInfo objects, 322\n\nistitle() method, of strings, 43\n\nistraceback() function, inspect module, 225\n\n__isub__() method, 61\n\nisupper() method, of strings, 41, 43\n\nitemgetter() function, operator module, 275\n\nitems() method\n\nof ConfigParser objects, 333 of Element objects, 577 of Message objects, 552 of dicts, 45 of dicts in Python 3, 632\n\nitemsize attribute, of array objects, 259\n\nItemsView abstract base class, 266\n\niter() function, 206\n\n__iter__() method, 59, 82\n\nIterable abstract base class, 265\n\niteration, 10, 17, 59, 82\n\nbreaking out of a loop, 83 iteration variable, 82\n\nover a sequence, 39, 69 over dictionary keys, 17 over dictionary values, 45 over multiple sequences, 83 portable function for next() operation,\n\n207\n\nprotocol change in Python 3, 633 protocol of, 60, 82 scope of iteration variable, 82 supported objects, 17 unpacking of tuples, 82 Iterator abstract base class, 265\n\niterators, use in Python 3, 632\n\niterdecode() function, codecs module, 279\n\niterdump() method, of Connection objects,\n\n306\n\niterencode() function, codecs module, 279\n\niterencode() method, of JSONEncoder\n\nobjects, 566\n\niterkeyrefs() method, of WeakKeyDictionary\n\nobjects, 241\n\niterparse() function, xml.etree.ElementTree\n\nmodule, 578\n\nitertools module, 83, 270\n\nitervaluerefs() method, of\n\nWeakValueDictionary objects, 241\n\n__itruediv__() method, 61\n\n__ixor__() method, 61\n\nizip() function, itertools module, 83, 212,\n\n272\n\nizip_longest() function, itertools module,\n\n272\n\nJ\n\nJ character, on complex number literals, 27\n\nj(ump) debugger command, pdb module,\n\n188\n\nJava, 620\n\ndifference in class system, 119 Javascript, pop-up window example, 531\n\njoin() function, os.path module, 397\n\njoin() method\n\nof JoinableQueue objects, 419 of Pool objects, 424\n\nF h Lib f L Bdff",
      "content_length": 2575,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 702,
      "content": "lchown() function, os module\n\n677\n\nof Process objects, 416 of Queue objects, 445 of Thread objects, 436 of strings, 43\n\nkeys\n\nacceptable types for dictionaries, 16 of dicts, 44\n\nKeysView abstract base class, 266\n\njoin_thread() method, of Queue objects,\n\nkeyword arguments, 18, 94\n\n418\n\nmixing with positional arguments, 94\n\nJoinableQueue() function, multiprocessing\n\nkeyword module, 585\n\nmodule, 419\n\nkeyword-only arguments, Python 3, 625\n\njs_output() method\n\nof Morsel objects, 512 of SimpleCookie objects, 512 JSON (JavaScript Object Notation), 563\n\nkeywords attribute, of partial objects, 268\n\nkill() function, os module, 392\n\nkill() method, of Popen objects, 403\n\njson module, 563\n\ndifference from pickle and marshal, 565\n\nkillpg() function, os module, 392\n\nkqueue, BSD, 460\n\nJSONDecoder class, json module, 565\n\nJSONEncoder class, json module, 566\n\nL\n\njumpahead() function, random module,\n\nL character, on long integers, 27\n\n254\n\nl(ist) debugger command, pdb module, 188\n\nJython, 5\n\nlambda operator, 48, 112\n\nexample of, 620\n\nalternatives to, 274-275\n\nLambdaType type, 237\n\nK\n\nlast_accepted attribute, of Listener objects,\n\nkbhit() function, msvcrt module, 373\n\n434\n\nkey attribute, of Morsel objects, 512\n\nlast_traceback variable, sys module, 231\n\nkey index operator [], 44\n\nlast_type variable, sys module, 231\n\nof dicts, 16\n\nlast_value variable, sys module, 231\n\nkey keyword argument, to sort(), 40\n\nKEY_* constants, winreg module, 410\n\nkeyboard interrupts, 162\n\nlastChild attribute, of DOM Node objects,\n\n570\n\nlastgroup attribute, of MatchObject objects,\n\n286\n\nKeyboardInterrupt class, 214\n\nlastindex attribute, of MatchObject objects,\n\nKeyboardInterrupt exception, 87-88, 162\n\n286\n\nKeyError exception, 44, 87, 214\n\nlatin-1 encoding, description of, 169\n\nkeyrefs() method, of WeakKeyDictionary\n\nlaunching a web browser, 544\n\nobjects, 241\n\nlaunching python applications, 176\n\nkeys() method\n\nlaunching subprocesses, 402\n\nof Element objects, 577 of Message objects, 552 of dicts, 45 of dicts in Python 3, 632\n\nexamples, 404 lazy evaluation, 99\n\nlchflags() function, os module, 387\n\nlchmod() function, os module, 387\n\nlchown() function, os module, 387\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2252,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 703,
      "content": "678\n\nldexp() function, math module\n\nldexp() function, math module, 252\n\nle() function, operator module, 274\n\n__le__() method, 56\n\nleading 0b on integers, binary, 27\n\nleading 0o on integers, octal, 27\n\nleading 0x on integers, hexadecimal, 27\n\nleading b character on string literals, byte\n\nstrings, 29\n\nleading r character on strings, raw strings,\n\n29\n\nleading u character on string literals,\n\nUnicode strings, 28\n\nleft shift operator <\n\nleft_list attribute, of dircmp objects, 315\n\nleft_only attribute, of dircmp objects, 315\n\nlegacy code, and exec statement, 115\n\nlen() function, 58, 206\n\non dicts, 74 on mappings, 44-45 on sequences, 39-40, 67, 69 on sets, 46, 75\n\n__len__() method, 56, 58\n\nand truth testing, 56\n\nlength attribute, of HTTPResponse objects,\n\n504\n\nless than operator\n\nless than or equal to operator <=, 66\n\nletters variable, string module, 287\n\nlevelname attribute, of Record objects, 359\n\nlevelno attribute, of Record objects, 359\n\nlexical scoping, 97\n\nlexicographical ordering of UTF-8, 170 of strings, 70\n\nlexists() function, os.path module, 397\n\nLifoQueue() function, queue module, 444\n\nlimit_denominator() method, of Fraction\n\nobjects, 250\n\nlimiting the output of error tracebacks, 232\n\nline continuation character \\, 9, 25, 29\n\nline continuation, and parentheses, braces,\n\nor brackets, 25\n\nline separator character for files, 379\n\nline structure of programs, 25\n\nline_buffering attribute, of TextIOWrapper\n\nobjects, 353\n\nlinecache module, 585\n\nlineno attribute, of Record objects, 359\n\nlinesep variable, os module, 379\n\nlink() function, os module, 387\n\nlinkname attribute, of TarInfo objects, 322\n\nLinux, 331\n\nLinux link-level packet protocol, 470\n\naddress format, 472 Linux, epoll interface, 460\n\nlist comprehensions, 13\n\nand declarative programming, 110 conditional expressions, 79 creation of tuples within, 109 difference from generator expression,\n\n110\n\ngeneral syntax of, 108 scope of iteration variable, 109 similiarity to SQL queries, 111 similiarity to awk command, 111\n\nlist of Unix signal names, 400\n\nlist type, 38\n\nlist() function, 12, 40, 77, 207 applied to dictionaries, 16\n\nlist() method\n\nof Manager objects, 429 of TarFile objects, 321\n\nlist_dialects() function, csv module, 551\n\nlistdir() function\n\nPython 3, 630, 633 os module, 387\n\nlisten() method\n\nof dispatcher objects, 456 of socket objects, 483\n\nListener class, multiprocessing module,\n\n433\n\nlists, 12, 40\n\nappending to, 12, 40 as sequence, 39 compared to array objects, 260 comparison of, 70 concatenation, 12\n\nF h Lib f L Bdff",
      "content_length": 2523,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 704,
      "content": "log_message() method, of BaseHTTPRequestHandler objects\n\n679\n\ncounting items, 40 deletion of items, 69 empty, 12 equality of, 78 indexing operator, 12 inefficiency of insert(), 194 inserting items, 12, 40, 69 item assignment, 12, 69 keeping in sorted order, 261 list comprehension, 108 making shallow copy of, 40 nested, 13 random shuffling, 254 reassigning a slice, 12 removing items, 40 reversing, 40 searching, 40 shared by multiple processes, 429 slice assignment, 69 slice deletion, 69 slices, 12 sorting, 40 versus deque, 194, 262 versus tuples, 14 little endian format, 167\n\nlittle endian, packing and unpacking, 292\n\nljust() method, of strings, 43\n\nlocal variables, 96 and eval(), 115 storage of in stack frames, 52 use before defined, 98\n\nlocal() function, threading module, 443\n\nlocalcontext() function, decimal module,\n\n248\n\nlocale module, 587\n\nlocale setting, and string comparison, 70\n\nlocalName attribute, of DOM Node objects,\n\n570\n\nlocals() function, 207\n\nlocaltime() function, time module, 406\n\nLock object\n\nmultiprocessing module, 427 threading module, 438\n\nLock() method, of Manager objects, 429\n\nLOCK_* constants, flock() function, 348\n\nlockf() function, fcntl module, 348\n\nlocking() function, msvcrt module, 373\n\nlocking\n\navoiding deadlock, 442 files on Windows, 373 multiprocessing module, 427 of critical sections, 414 of files, 348 threading module, 439\n\nln() method, of Decimal objects, 243\n\nlocks\n\nload() function\n\njson module, 565 marshal module, 226 pickle module, 171, 227\n\nand context managers, 89 and exceptions, 23 proper management of, 442\n\nlog files, real-time monitoring example, 19\n\nload() method\n\nof SimpleCookie objects, 512 of Unpickler objects, 228\n\nlog() function, math module, 252\n\nlog() method, of Logger objects, 358\n\nloads() function\n\njson module, 565 marshal module, 226 pickle module, 227 xmlrpc.client module, 526 local storage for threads, 443\n\nlog10() function, math module, 252\n\nlog10() method, of Decimal objects, 243\n\nlog1p() function, math module, 252\n\nlog_error() method, of\n\nBaseHTTPRequestHandler objects, 510\n\nlog_message() method, of\n\nBaseHTTPRequestHandler objects, 510\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2226,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 705,
      "content": "680\n\nlog_request() method, of BaseHTTPRequestHandler objects\n\nlog_request() method, of\n\nlowercase variable, string module, 287\n\nBaseHTTPRequestHandler objects, 510\n\nlseek() function, os module, 383\n\nLogAdapter() function, logging module, 366\n\nlshift() function, operator module, 274\n\nlogging module, 355\n\n__lshift__() method, 60\n\nadding extra fields to log messages, 365 and multiprocessing module, 435 basic configuration, 355 configuring with .ini files, 368 filtering messages, 359 formatting of messages, 365 handler objects, 362 how to configure, 367 including exceptions in log messages,\n\nlstat() function, os module, 387\n\nlstrip() method, of strings, 43\n\nlt() function, operator module, 274\n\n__lt__() method, 56\n\nLWPCookieJar class, http.cookiejar module,\n\n513\n\nM\n\n358\n\nissuing log messages, 356 logger hierarchy, 360 message handling, 361 message propagation, 360 picking logger names, 356 using a null logger, 369\n\nm command line option, 173-174\n\nm pdb option to interpreter, 189\n\nmailbox module, 587\n\nmailcap module, 587\n\nmain program execution, 146\n\nmain program, and pickle module, 228\n\nlogin() method\n\nmain thread, 413\n\nof FTP objects, 498 of SMTP objects, 514\n\n__main__ module, 146, 174\n\nmain() function, unittest module, 184\n\nlognormvariate() function, random module,\n\n__main__, check needed for multiprocess-\n\n255\n\ning module, 417\n\nlong integers, 27\n\nmajor() function, os module, 387\n\nand integers, 38 automatic promotion from integers, 27\n\nmake_server() function,\n\nwsgiref.simple_server module, 542\n\nlong type, 38\n\nmakedev() function, os module, 387\n\nlong() function, 207\n\nmakedirs() function, os module, 387\n\n__long__() method, 61-62\n\nmakefile() method, of socket objects, 483\n\nlookup table, and dictionaries, 16\n\nmaketrans() function, string module, 290\n\nlookup() function\n\nmaking timing measurements, 191\n\ncodecs module, 277 unicodedata module, 296 LookupError exception, 87, 212\n\nmanaged objects, multiprocessing module,\n\n428\n\nManager() function, multiprocessing mod-\n\nloop() function, asyncore module, 457\n\nule, 428\n\nlooping, 17, 82\n\nmant_dig attribute, of sys.float_info, 231\n\nbreaking out prematurely, 83 keeping a loop counter, 83 while statement, 8\n\nloose-coupling of objects, 122\n\nmap() function, 207\n\nand Python 3, 207 and optimization, 197 future_builtins module, 217 map() method, of Pool objects, 424\n\nlow-level file manipulation, 382\n\nlower() method, of strings, 43\n\nmap-reduce, multiprocessing module, 424\n\nF h Lib f L Bdff",
      "content_length": 2456,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 706,
      "content": "message_from_string() function, email package\n\n681\n\nmap_async() method, of Pool objects, 425\n\nmemory efficiency\n\nMapping abstract base class, 266\n\nmappings, 44\n\ndeletion of items, 45 key index operator, 44 special methods of, 58\n\nMappingView abstract base class, 266\n\nmarshal module, 226\n\nmatch() function, re module, 284\n\nand __slots__, 133 of generator expressions, 110 of generators, 107 memory management, 128 checking for leaks, 221 creation of instances, 129 garbage collection, 35, 220 reference counting, 129 memory mapped files, 370\n\nmatch() method, of Regex objects, 285\n\nMatchObject objects, re module, 285\n\nand IPC, 413\n\nmath module, 251\n\nmathematical operators\n\nin-place, 61 mixed types, 66-67\n\nmemory use\n\narray objects, 260 measuring, 192 obtaining size of objects, 234 tuples versus lists, 14\n\nmathematical special methods, 60\n\nmax attribute\n\nof date class, 337 of datetime class, 340 of sys.float_info, 231 of time class, 338 of timedelta class, 341\n\nmemory, location of objects, 33\n\nMemoryError exception, 87, 214\n\nMemoryHandler class, logging module, 362\n\nmemset() function, ctypes module, 617\n\nmerge() function, heapq module, 270\n\nMersenne Twister, 254\n\nmax() function, 13, 39-40, 67, 69, 207\n\nMessage class, email package, 552, 555\n\non sets, 75 required methods for user-defined\n\nmessage attribute, of Exception objects,\n\n213\n\nobjects, 57\n\nmessage digests, 559\n\nmax_10_exp attribute, of sys.float_info,\n\n231\n\nmax_exp attribute, of sys.float_info, 231\n\nmaxint variable, sys module, 231\n\nmaxsize variable, sys module, 231\n\nmaxunicode variable, sys module, 231\n\nmessage passing, 414-415 and coroutines, 415 and synchronization, 415 coroutines, 108 definition of, 413 sending byte buffers, 421 sending objects between processes, 421\n\nmd5() function, hashlib module, 559\n\nMemberDescriptorType type, 237\n\nmessage propagation, of log messages,\n\nmembership test\n\n360\n\nof dicts, 16, 74 of sequences, 67\n\nmemmove() function, ctypes module, 617\n\nmessage queues, 415 coroutines, 108 multiprocessing module, 418\n\nmemoization of results, 242\n\nmessage_from_file() function, email pack-\n\nage, 552\n\nmessage_from_string() function, email\n\npackage, 552\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2252,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 707,
      "content": "682\n\nmetaclass keyword argument, of class definitions\n\nmetaclass keyword argument, of class defi-\n\nmigrating code\n\nnitions, 139\n\n__metaclass__ attribute, of classes, 139\n\nPython 2 to 3, 634 practical strategy, 637\n\n__metaclass__ global variable, 139\n\nMIMEApplication class, email package, 557\n\nmetaclasses, 138\n\nMIMEAudio class, email package, 557\n\n__prepare__() method, 627-628 and descriptors, 140 and inheritance, 139 caution on use, 141 example of, 140 how to define, 139 performance benefits, 197 use of __new__() method, 55, 129 use of a custom dictionary object, 628\n\nmethod resolution order, and TypeError\n\nexception, 122\n\nMIMEImage class, email package, 557\n\nMIMEMessage class, email package, 557\n\nMIMEMultipart class, email package, 557\n\nMIMEText class, email package, 558\n\nmimetypes module, 566\n\nmin attribute\n\nof date class, 337 of datetime class, 340 of sys.float_info, 231 of time class, 338 of timedelta class, 341\n\nmethod resolution\n\n__mro__ attribute, 121 multiple inheritance, 121 single inheritance, 120\n\nmethodcaller() function, operator module,\n\n275\n\nmin() function, 13, 39-40, 67, 69, 207\n\non sets, 75 required methods for user-defined\n\nobjects, 57\n\nmin_10_exp attribute, of sys.float_info, 231\n\nmethodHelp() method, of ServerProxy\n\nmin_exp attribute, of sys.float_info, 231\n\nobjects, 525\n\nminimum requirements for supporting\n\nmethods, 48, 117 bound, 49, 125 calling process, 48 class, 125 @classmethod decorator, 48 defining in classes, 21 definition of, 118 handling as properties, 125 preventing redefinition in subclasses,\n\nequality, 57\n\nminor() function, os module, 387\n\nminute attribute, of time objects, 338\n\nmirrored() function, unicodedata module,\n\n296\n\nmissing parenthesese, and tuples, 14\n\nmixed-type mathematical operations, 66-67\n\nmixin classes, 122\n\nmixing byte strings and Unicode, 167\n\n128 static, 125 @staticmethod decorator, 48 type of, 47 type of built-in, 49 unbound, 49 use of super() function, 120\n\nmkd() method, of FTP objects, 498\n\nmkdir() function, os module, 388\n\nmkdtemp() function, tempfile module, 323\n\nmkfifo() function, os module, 388\n\nmknod() function, os module, 388\n\nmkstemp() function, tempfile module, 323\n\nmethodSignatures() method, of ServerProxy\n\nmktemp() function, tempfile module, 323\n\nobjects, 525\n\nmktime() function, time module, 406\n\nMethodType type, 47-48, 237\n\nmmap module, 369\n\nmicrosecond attribute, of time objects, 338\n\nmmap() function, mmap module, 370\n\nmicrothreading, 446\n\nmod() function, operator module, 273\n\nF h Lib f L Bdff",
      "content_length": 2502,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 708,
      "content": "mutability\n\n683\n\n__mod__() method, 60\n\nmove() function, shutil module, 319\n\nmode attribute\n\nmove() method, of mmap objects, 371\n\nof FileIO objects, 350 of TarInfo objects, 322 of files, 161\n\nmoving the file pointer, 161\n\nMozillaCookieJar class, http.cookiejar mod-\n\nule, 513\n\nmodf() function, math module, 252\n\n__mro__ attribute, of classes, 121\n\nmodifying global variables from a function,\n\nMSG_* constants, socket module, 483\n\n18\n\nmsvcrt module, 372\n\nmodifying the module search path, 147\n\nmtime attribute, of TarInfo objects, 322\n\nmodule attribute, of Record objects, 359\n\nmul() function, operator module, 273\n\nmodule loading, 147\n\n__mul__() method, 60\n\nmodule reloading, 149\n\nmulti-dimensional lists, 13\n\nmodule search path\n\nMultiCall() function, xmlrpc.client module,\n\nand site module, 177 and zip files, 147 modifying, 147 setting with environment variable, 174\n\n526\n\nmulticore, and program execution, 414\n\nmultiple inheritance, 120-121\n\nmultiple statements on the same line, 26\n\nmodule unloading, 149\n\nmultiplexing, of I/O, 459\n\n__module__ attribute, of types, 50\n\nmultiplication operator *, 65\n\nmodulefinder module, 585\n\nmultiprocessing module, 415\n\nmodules variable, sys module, 149, 231\n\nmodules, 23, 143\n\naccessing classes, 144 and .pyc files, 148 as objects, 144 attribute access, 51 attributes of, 51 dynamic loading, 144 global namespace for functions, 96 importing multiple, 144 one-time execution, 144 search path of, 147 self-testing with doctest, 182 type of, 50 type of module object, 47 types of recognized files, 148 using to write extensible programs, 144\n\nand global interpreter lock, 444 and pickle, 435 connecting separate processes, 433 distributed computing, 435 logging, 435 managed objects, 428 passing a list through shared memory,\n\n427 pipes, 421 process pools, 424 queues, 418 shared memory, 426 synchronization primitives, 427 use of __main__ check, 417\n\nmultithreaded chicken, 414\n\nmutability\n\nModuleType type, 47, 237\n\nmodulo operator %, 65\n\nmonth attribute, of date objects, 337\n\nMorsel class, http.cookies module, 512\n\ndefault function arguments, 94 dictionary keys, 44 function parameters, 95 in-place assignment operators, 75 reference counting, 35\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2285,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 709,
      "content": "684\n\nmutable, definition of\n\nmutable, definition of, 33\n\nMutableMapping abstract base class, 266\n\nMutableSequence abstract base class, 266\n\nMutableSet abstract base class, 266\n\nmutual exclusion lock, 438\n\nMySQL, accesing from Python, 297\n\nN\n\n\\N escape code, in strings, 28\n\nn(ext) debugger command, pdb module,\n\n189\n\nname attribute\n\nof FieldStorage objects, 535 of FileIO objects, 350 of Process objects, 417 of Record objects, 359 of TarInfo objects, 322 of Thread objects, 436 of files, 161\n\nname mangling, of private attributes, 127\n\nname variable, os module, 379\n\n__name__ attribute\n\nof built-in functions, 49 of functions, 48 of methods, 49 of modules, 51 of types, 50\n\n__name__ variable, of modules, 146\n\nname() function, unicodedata module, 296\n\nnamed tuples\n\nuse as tuples, 264 use by standard library, 265\n\nNamedTemporaryFile() function, tempfile\n\nmodule, 324\n\nnamedtuple() function, collections module,\n\n264\n\nNameError exception, 87, 214\n\nNameError exception in __del__ ignored,\n\n179\n\nNameError exception, and variable lookup,\n\n96\n\nnamelist() method, of ZipFile objects, 326\n\nNamespace() method, of Manager objects,\n\n429\n\nnamespace\n\nand classes, 117 and import statement, 24, 143 local variables of function, 96 namespaceURI attribute, of DOM Node\n\nobjects, 570\n\nNaN variable, decimal module, 248\n\nNaN\n\nnot a number, 213 not a number, decimal module, 244\n\nne() function, operator module, 274\n\n__ne__() method, 57\n\nneg() function, operator module, 273\n\n__neg__() method, 61\n\nnegative indices, 68-69\n\nnegInf variable, decimal module, 248\n\nnested classes, problem with pickle, 228\n\nnested functions, 97 and closures, 99\n\nnested lists, 13\n\nnested() function, contextlib module, 267\n\nNetlink protocol, 470\n\naddress format, 472\n\nnetloc attribute\n\nof urlparse objects, 520 of urlsplit objects, 521\n\nnetrc module, 587\n\nnetwork programming modules, Python 3\n\nreorganization, 497\n\nnetwork programming\n\nUnicode encoding, 452 asynchronous, 467 event-driven programming, 455 getting hostname, 474 introduction, 449 performance of polling, 468\n\nnew() function\n\nhashlib module, 559 hmac module, 559 __new__() method, 54-55\n\nand instance creation, 129 and metaclasses, 139\n\nF h Lib f L Bdff",
      "content_length": 2184,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 710,
      "content": "numerator attribute\n\n685\n\ncaution when reading code, 129 use by immutable types, 129 uses of, 55\n\nnewline character, difference on\n\nNone, 38\n\nand default arguments, 94 return statement in functions, 96 nonlocal statement, Python 3, 97, 624\n\nUnix/Windows, 159\n\nnormalization of Unicode strings, 171\n\nnewline escape code in strings, 28\n\nnormalize() function, unicodedata module,\n\nnewline parameter, to open() function, 159\n\n171, 296\n\nnewline suppression, print statement, 162\n\nnormalize() method, of DOM Node objects,\n\nnewline termination of statements, 7\n\n571\n\nnewlines attribute\n\nof TextIOWrapper objects, 353 of files, 161 next() function, 207\n\nnormalvariate() function, random module,\n\n255\n\nnormcase() function, os.path module, 398\n\nnormpath() function, os.path module, 398\n\nnext() method, 59\n\nnot equal to operator !=, 66\n\nof TarFile objects, 321 of files, 160 of generators, 19, 53, 103 of iterators, 82 use with coroutines, 104\n\nnot operator, boolean expressions, 9, 77\n\nnot_() function, operator module, 274\n\nNotConnected exception, http.client mod-\n\nule, 504\n\nnotify() method, of Condition objects, 441\n\n__next__() method, 59 Python 3, 633 of generators, 19, 103 of iterators, 82\n\nnotify_all() method, of Condition objects,\n\n441\n\nNotImplementedError exception, 87, 214\n\nNotSupportedError exception, database API,\n\nnextset() method, of Cursor objects, 299\n\nnextSibling attribute, of DOM Node objects,\n\n570\n\n302\n\nnow() method, of datetime class, 339\n\nnsmallest() function, heapq module, 270\n\nNI_* constants, socket module, 475\n\nnice() function, os module, 392\n\nnis module, 586\n\nnlargest() function, heapq module, 270\n\nnntplib module, 587\n\nno_site attribute, of sys.flags, 230\n\nnodeName attribute, of DOM Node objects,\n\n570\n\nNTEventLogHandler class, logging module,\n\n362\n\nntohl() function, socket module, 476\n\nntohs() function, socket module, 476\n\nntransfercmd() method, of FTP objects, 498\n\nnull object, 369\n\nnull values, 38\n\nNULL-terminated strings, and UTF-8, 170\n\nnodeType attribute, of DOM Node objects,\n\nNumber abstract base class, 253\n\n570\n\nnumber of CPUs on system, 434\n\nnodeValue attribute, of DOM Node objects,\n\nnumbers module, 138, 252\n\n570\n\nnumbers, example of defining new type,\n\nnon-printing characters, specifying in string\n\n133\n\nliterals, 28\n\nnumerator attribute\n\nof Fraction objects, 250 of integers, 39\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2422,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 711,
      "content": "686\n\nnumeric data, and strings\n\nnumeric data, and strings, 11\n\nnumeric literals, 26-27\n\nnumeric type coercision, 66-67\n\nnumeric type hierarchy, 137, 253\n\nnumeric types, 38\n\nnumeric() function, unicodedata module,\n\n296\n\nnumpy extension, 39, 261\n\nO\n\nO command line option, 91, 148, 173-174, 369\n\nobject, 47\n\nobject base class, 21, 119\n\nobject() function, 208\n\nobjects, 21\n\nattributes of, 33 class of, 34 comparison, 34 comparison in Python 3, 633 container or collection, 33 defining a null object, 369 definition of, 33 first-class status, 36 getting a list of referrers, 221 getting the size of, 192 hierarchy of, 137 how to copy, 36 identity of, 33 inspecting with dir(), 63 instance of, 33 introspection of, 222 methods for comparison, 56 name of, 35 obtaining size of, 234 persistence, 171 proxies in multiprocessing module, 431 reference counting of, 34 representation of, 131 requirements for ordering, 57 sending between processes with pipes,\n\n421\n\nsending between processes with\n\nqueues, 418\n\nserializing with marshal, 226 serializing with pickle, 227 sharing in the interpreter, 35 supporting iteration, 82 type of, 33 weak references to, 240 observer pattern, 130, 240\n\noct() function, 77, 208\n\nfuture_builtins module, 217\n\noctal integer literals, 27\n\noctdigits variable, string module, 287\n\nold-style classes, 139\n\nOO command line option, 148, 173-174\n\nopen() function, 10, 158, 208\n\nPython 3, 159 codecs module, 167, 279 codecs module and Python 3, 279 dbm module, 310 description of file modes, 159 difference between Python 2 and 3,\n\n208\n\ngzip module, 317 io module, 354 os module, 384 shelve module, 171, 311 tarfile module, 319 webbrowser module, 544\n\nopen() method\n\nof ZipFile objects, 326 of controller objects, 544\n\nopen_new() function, webbrowser module,\n\n544\n\nopen_new() method, of controller objects,\n\n544\n\nopen_new_tab() function, webbrowser mod-\n\nule, 544\n\nopen_osfhandle() function, msvcrt module,\n\n373\n\nOpenKey() function, winreg module, 410\n\nOpenKeyEx() function, winreg module, 410\n\nopenpty() function, os module, 385\n\nOpenSSL, 486\n\nexample of creating certificates, 489\n\noperating system, scheduling by, 414\n\nF h Lib f L Bdff",
      "content_length": 2153,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 712,
      "content": "OverflowError exception\n\n687\n\nOperationalError exception, database API,\n\n302\n\noperator module, 273\n\nalternative to lambda, 274 use in optimization, 274\n\ntuning strategies, 194 use of io module, 354 use of multiprocessing pools, 426 use of operator module, 274 user defined classes, 195\n\noperator overloading, 54 example of, 133 order of operands, 134 reversed operands, 60 type coercion, 134\n\noptimize attribute, of sys.flags, 230\n\noptimized mode, enabling with an environ-\n\nment variable, 174\n\noptional function arguments, 18, 93\n\nand None, 38\n\noperators, 30, 65\n\nOptionParser() function, optparse module,\n\nmathematical, 60 precedence of, 78\n\n374\n\noptions() method, of ConfigParser objects,\n\noptimization\n\n333\n\n__slots__ attribute of classes, 132, 196 array objects, 260 attribute binding, 195-196 built-in types, 194 creation of instances, 195 decorators and metaclasses, 197 definition of speedup, 192 deque objects, 263 dict() function, 195 dict lookups, 197 dicts versus classes, 195 disassembly, 193 effect of adding layers, 195 exceptions, 196-197 formatting of log messages, 358 functional programming, 197 impact of I/O polling, 469 internal type cache, 233 lists versus array objects, 260 logging module, 369 making timing measurements, 191 map() and filter() functions, 197 marshal versus pickle, 226 measuring memory use, 192 repeated timing measurements, 192 select() function, 467 sorting callback functions, 275 speedup, 194\n\noptionxform() method, of ConfigParser\n\nobjects, 333\n\noptparse module, 374 example, 157\n\nor operator, boolean expressions, 9, 77\n\nor_() function, operator module, 274\n\n__or__() method, 60\n\nord() function, 77, 208\n\norder of evaluation, 78\n\nattempts to modify, 79\n\norder of operands, operator overloading,\n\n134\n\norganizing code for distribution, 152\n\nOS X, 331\n\nos module, 158, 378\n\nos.environ variable, 158\n\nos.path module, 396\n\nOSError exception, 87, 214\n\nossaudiodev module, 588\n\noutput() method\n\nof Morsel objects, 512 of SimpleCookie objects, 512\n\nOutputString() method, of Morsel objects,\n\n513\n\noverflow, lack of with integers, 66\n\nOverflowError exception, 214\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2202,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 713,
      "content": "688\n\np debugger command, pdb module\n\nP\n\np debugger command, pdb module, 189\n\nP_* constants, spawnv() function, 392\n\npack() function, struct module, 290\n\npack() method, of Struct objects, 291\n\npack_into() function, struct module, 290\n\npack_into() method, of Struct objects, 291\n\npackages, 149\n\nrelative import, 150-151\n\nPACKET_* constants, socket module, 472\n\npacking\n\nbinary data structures, 290 of tuples, 14\n\npairs, creating a list of from dictionary, 45\n\nparallel iteration over sequences, 83\n\nparameter passing to functions, 95\n\nparams attribute, of urlparse objects, 520\n\nparamstyle variable, database API, 300\n\npardir variable, os module, 386\n\nparent class, 119\n\nparentNode attribute, of DOM Node objects,\n\n570\n\nparetovariate() function, random module,\n\n256\n\nparse() function\n\nxml.dom.minidom module, 570 xml.etree.ElementTree module, 578 xml.sax module, 580\n\nparse() method\n\nof ElementTree objects, 574 of Formatter objects, 288\n\nparse_args() method, of OptionParser\n\nobjects, 158, 376\n\nparse_header() function, cgi module, 536\n\nparse_multipart() function, cgi module, 536\n\nparse_qs() function, urllib.parse module,\n\n521\n\nparse_qsl() function, urllib.parse module,\n\n522\n\nparser module, 586\n\nparseString() function\n\nxml.dom.minidom module, 570 xml.sax module, 580\n\nparsing\n\nCSV files, 548 HTML, 561 URLs, 520 XML, 568 command line options, 157, 374 email messages, 552 form fields in CGI scripts, 534 large XML documents with\n\nElementTree, 579\n\nrobots.txt file, 523\n\npartial() function\n\nfunctools module, 76, 268 use with network handlers, 510 partition() method, of strings, 41, 43\n\npass statement, 9, 25, 82\n\npassword attribute\n\nof urlparse objects, 520 of urlsplit objects, 521\n\npath attribute\n\nof BaseHTTPRequestHandler objects,\n\n509\n\nof urlparse objects, 520 of urlsplit objects, 521\n\npath variable\n\nos module, 379 sys module, 147, 177, 232 __path__ attribute, of modules, 51\n\n__path__ variable, in packages, 151\n\npathconf() function, os module, 388\n\npathname attribute, of Record objects, 359\n\npathsep variable, os module, 386\n\npattern attribute, of Regex objects, 284\n\npattern syntax, regular expressions, 281\n\npause() function, signal module, 399\n\npdb module, 186\n\ndebugging programs from command\n\nshell, 189\n\n.pdbrc configuration file, 190\n\n.pdbrc configuration file, 190\n\npeek() method, of BufferReader objects,\n\n351\n\nPEM_cert_to_DER_cert() function, ssl mod-\n\nule, 488\n\nF h Lib f L Bdff",
      "content_length": 2403,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 714,
      "content": "portable manipulation of filenames\n\n689\n\nPEP 249, Python Database API\n\npipes, creating with subprocess module,\n\nSpecification, 297\n\n403\n\nPEP 333 (WSGI), 540\n\npkgutil module, 586\n\nper-user site directory, 154, 177 installing packages in, 178\n\nplacement of decorators, 101\n\nplatform module, 586\n\nperformance\n\nplatform variable, sys module, 232\n\nof binary file I/O, 351-352 of generator expressions, 110 of logging module, 369 of type checking, 34\n\nplistlib module, 587\n\nplock() function, os module, 392\n\npm() function, pdb module, 186\n\nPOINTER() function, ctypes module, 614\n\nPerl\n\nand dynamic scope, 97 interpretation of numeric strings vs.\n\npointer() function, ctypes module, 615\n\npoll() function, select module, 459\n\nPython, 11\n\npoll() method\n\npermutations() function, itertools module,\n\n272\n\npersistent dictionary, shelve module, 171\n\nof Connection objects, 421 of Poll objects, 460 of Popen objects, 403\n\nPHP, interpretation of numeric strings vs.\n\nPOLL* constants, select module, 459\n\nPython, 11\n\npolling, 459\n\npi variable, math module, 252\n\nperformance of, 468-469\n\npickle module, 171, 226\n\npolymorphism, 122\n\n__main__ module, 228 and multiprocessing module, 435 cPickle, 229 incompatible objects, 171 interaction with copy module, 220 protocol selection, 171-172 security concerns, 172 used by shelve, 311\n\nPool() function, multiprocessing module,\n\n424\n\npop() method\n\nof array objects, 260 of deque objects, 262 of dicts, 45, 95 of lists, 41 of sets, 47\n\npickle protocol, selecting in shelve module,\n\nPopen() function, subprocess module, 402\n\n172\n\npopen() function, os module, 392\n\nPickler class, pickle module, 228\n\npopitem() method, of dicts, 45\n\npickletools module, 586\n\npopleft() method, of deque objects, 262\n\npid attribute\n\npoplib module, 587\n\nof Popen objects, 404 of Process objects, 417\n\nPipe() function, multiprocessing module,\n\nport attribute\n\nof urlparse objects, 520 of urlsplit objects, 521\n\n421\n\npipe() function, os module, 385\n\npipelines and generators, 19\n\nport number\n\nin network programs, 449 list of well known, 450\n\npipelines, and generators, 106-107\n\nportability, of marshal module, 226\n\npipes module, 586\n\nportable manipulation of filenames, 396\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2272,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 715,
      "content": "690\n\npos attribute, of MatchObject objects\n\npos attribute, of MatchObject objects, 286\n\npos() function, operator module, 273\n\n__pos__() method, 61\n\nPOSIX interface, 331\n\nposix attribute, of TarFile objects, 321\n\npost_mortem() function, pdb module, 186\n\npow() function, 66, 208 math module, 252 __pow__() method, 60\n\npower operator **, 65\n\npp debugger command, pdb module, 189\n\npprint module, 586\n\npreamble attribute, of Message objects,\n\n554\n\nprec attribute, of Context objects, 247\n\nprecision, of floating point, 38\n\npredicate() function, itertools module, 271\n\nprefix attribute, of DOM Node objects, 570\n\n—prefix option to setup.py, 154\n\nprefix variable, sys module, 177, 232\n\n__prepare__() method, Python 3 meta-\n\nclasses, 627-628\n\npreventing the creation of .pyc files, 230\n\npreviousSibling attribute, of DOM Node\n\nobjects, 570\n\nprint statement, 6, 162\n\nand __str__(), 56 and sys.stdout, 161 file redirection, 10, 163 formatted output, 8, 162 newline suppression, 162 softspace attribute of files, 162 syntax error with Python 3, 6 trailing comma, 10 print() function, 163, 209\n\nPython 3, 631 enabling in Python 2.6, 163 file redirection, 163 newline suppression, 163 separator character, 163\n\nprint_directory() function, cgi module, 537\n\nprint_environ() function, cgi module, 537\n\nprint_environ_usage() function, cgi module,\n\n537\n\nprint_exc() function, traceback module, 236\n\nprint_exception() function, traceback mod-\n\nule, 236\n\nprint_form() function, cgi module, 537\n\nprint_last() function, traceback module,\n\n236\n\nprint_stack() function, traceback module,\n\n236\n\nprint_tb() function, traceback module,\n\n235-236\n\nprintable variable, string module, 287\n\nprintdir() method, of ZipFile objects, 326\n\nprintf() function equivalent, 8\n\nprinting to the screen, 10\n\nprinting\n\ncreating custom formatters, 288 dates and times, 406 formatted, 8 priority queue, 269\n\nPriorityQueue() function, queue module,\n\n445\n\nprivate attributes, 127 and properties, 128 name mangling of, 127 private class members, 26\n\nprivate methods, and inheritance, 128\n\nprivate specifier, lack of, 127\n\nprobability, random number distributions,\n\n255\n\nprocess attribute, of Record objects, 359\n\nprocess id, getting, 380\n\nProcess() function, multiprocessing module,\n\n416\n\nprocesses\n\nconnecting with pipes, 421 daemonic, 415 definition of, 413 joining, 415 scheduling of, 414 sending signals to, 392 terminating, 392, 403-404, 415 worker pools, 424\n\nF h Lib f L Bdff",
      "content_length": 2432,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 716,
      "content": "pwd() method, of FTP objects\n\n691\n\nProcessingInstruction() function,\n\nproto attribute, of socket objects, 484\n\nxml.etree.ElementTree module, 575\n\nprotocol parameter, to pickle functions, 171\n\nprocessingInstruction() method, of ContentHandler objects, 581\n\nprotocol_version attribute, of\n\nBaseHTTPRequestHandler class, 509\n\nproducer-consumer\n\nProtocolError exception, xmlrpc.client mod-\n\nwith coroutines, 20 with pipes, 422 with queues, 419 with threads and condition variables,\n\n441\n\nwith threads and semaphores, 439 product() function, itertools module, 272\n\nprofile module, 190\n\nule, 527\n\nproxies, and attribute binding methods, 132\n\nproxy, 62\n\nproxy functions, 95\n\nproxy objects\n\nand multiprocessing module, 428, 431 problem with type checking, 135 proxy() function, weakref module, 241\n\nprofiling, 190\n\ninterpreting output, 191\n\nProxyBasicAuthHandler class, urllib.request\n\nmodule, 518-519\n\nprogram execution model, 81\n\nProxyDigestAuthHandler class, urllib.request\n\nprogram execution, main program, 146\n\nmodule, 518-519\n\nprogram structure, 81\n\nProxyHandler class, urllib.request module,\n\nprogram termination, 7, 179, 233 and garbage collection, 179 brutal, 179 brute force, 391 ignored NameError exception, 179 registering cleanup functions, 219 programming errors, lack of compiler\n\n518-519\n\nProxyTypes class, weakref module, 241\n\nps1 variable, sys module, 232\n\nps2 variable, sys module, 232\n\n.pth files, site configuration, 177\n\npty module, 586\n\nchecking, 181\n\nProgrammingError exception, database API,\n\n302\n\nprompts\n\nchanging, 176 interactive mode, 175\n\npropagate attribute, of Logger objects, 360\n\nproperties, 117\n\nand __setattr_() method, 131 and private attributes, 128 definition of, 124 set and delete functions, 126 uniform access principle, 125 use by methods, 125 @property decorator, 124\n\npunctuation variable, string module, 287\n\npush() method, of asynchat objects, 453\n\npush_with_producer() method, of asynchat\n\nobjects, 453\n\nput() method, of Queue objects, 418, 445\n\nput_nowait() method, of Queue objects,\n\n419, 445\n\nputch() function, msvcrt module, 373\n\nputenv() function, os module, 380\n\nputheader() method, of HTTPConnection\n\nobjects, 503\n\nputrequest() method, of HTTPConnection\n\nobjects, 503\n\nputwch() function, msvcrt module, 373\n\npwd module, 586\n\nproperty() function, 126, 209\n\npwd() method, of FTP objects, 498\n\nprotected specifier, lack of, 127\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2469,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 717,
      "content": "692\n\n.py files\n\n.py files, 6, 147\n\nand library modules, 23\n\npy2app package, 154\n\npy2exe package, 154\n\npy3k_warning attribute, of sys.flags, 230\n\npy3kwarning variable, sys module, 232\n\nPy_BEGIN_ALLOW_THREADS macro, 607\n\nPy_BuildValue() function, 602\n\npy_compile module, 586\n\nPy_DECREF() macro, 607\n\nPy_END_ALLOW_THREADS macro, 607\n\nPy_Finalize() function, 609\n\nPy_GetExecPrefix() function, 609\n\nPy_GetPath() function, 609\n\nPy_GetPrefix() function, 609\n\nPy_GetProgramFullPath() function, 609\n\nPy_INCREF() macro, 607\n\nPy_Initialize() function, 609\n\nPy_IsInitialized() function, 609\n\nPy_SetProgramName() function, 609\n\nPy_XDECREF() macro, 607\n\nPy_XINCREF() macro, 607\n\nPyArg_ParseTuple() function, 597\n\nPyArg_ParseTupleAndKeywords() function,\n\n597\n\nPyBytes_AsString() function, 611\n\n.pyc files, 147\n\ncompilation on import, 148 preventing the creation of, 230 when created, 148\n\npyclbr module, 586\n\n.pyd files, compiled extensions, 148\n\npydev, 5\n\npydoc command, 24\n\nPyErr_Clear() function, 606\n\nPyErr_ExceptionMatches() function, 606\n\nPyErr_NoMemory() function, 605\n\nPyErr_Occurred() function, 606\n\nPyErr_SetFromErrno() function, 605\n\nPyErr_SetFromErrnoWithFilename() func-\n\ntion, 605\n\nPyErr_SetObject() function, 605\n\nPyErr_SetString() function, 605\n\nPyEval_CallObject() function, 610\n\nPyEval_CallObjectWithKeywords() function,\n\n610\n\nPyExc_* exceptions, in extension modules,\n\n605\n\nPyFloat_AsDouble() function, 611\n\nPyImport_ImportModule() function, 610\n\nPyInt_AsLong() function, 611\n\nPyLong_AsLong() function, 611\n\nPyModule_AddIntConstant() function, 604\n\nPyModule_AddIntMacro() function, 605\n\nPyModule_AddObject() function, 604\n\nPyModule_AddStringConstant() function,\n\n604\n\nPyModule_AddStringMacro() function, 605\n\n.pyo files, 147\n\nwhen created, 148\n\nPyObject_GetAttrString() function, 610\n\nPyObject_SetAttrString() function, 610\n\npypi (Python Package Index), 154\n\npyprocessing library, 435\n\nPyRun_AnyFile() function, 608\n\nPyRun_InteractiveLoop() function, 609\n\nPyRun_InteractiveOne() function, 609\n\nPyRun_SimpleFile() function, 609\n\nPyRun_SimpleString() function, 609\n\nPyString_AsString() function, 611\n\nPySys_SetArgv() function, 610\n\nPython 3\n\n2to3 tool, 635-637 Ellipsis as an expression, 626 I/O system, 349, 631 Unicode characters in identifiers, 622 __next__() method, 633 absolute imports, 634 abstract base class, 137 adoption of, 621 and WSGI, 541 byte strings and system interfaces, 630 chained exceptions, 626 command line options, 633 commands module, 332\n\nF h Lib f L Bdff",
      "content_length": 2483,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 718,
      "content": "queues\n\n693\n\ncomparison, 633 dictionary comprehension, 623 dictionary operations, 45 difference in extension modules, 595 different behavior of byte strings, 629 division operator, 65 encode() and encode() methods, 629 environment variables, 633 exception attributes, 213 exec() function, 631 extended iterable unpacking, 623 filenames, 633 files, 160 filter() function, 205 function annotations, 624 generator changes, 103 import statement, 151 incompatibility with Python 2, 621 integer division, 633 interactive mode encoding issues, 175 iterator protocol, 633 keyword-only arguments, 625 map() function, 207 metaclasses, 139, 627-628 migration pitfalls, 629 network programming, 452 next() method of generators, 53 nonlocal statement, 624 open() function, 159, 208, 279 practical porting strategy, 637 print() function, 209, 631 raw_input() function, 209 reorganization of network modules,\n\ntypes module, 237 unbound methods, 49 unicode() function removal, 211 using new built-in functions in Python\n\n2, 217\n\nview objects on dicts, 632 viewing objects in ASCII, 201 who should use, 621 xrange() and range() functions, 17 xrange() function removal, 44, 211 zip() function, 83, 211\n\npython interpreter, 6\n\nPYTHON* environment variables, 174\n\nPython.h header file, in extensions, 594\n\n.pyw files, 147, 176\n\nPyZipFile() function, zipfile module, 325\n\nQ\n\nQ command line option, 173\n\nq(uit) debugger command, pdb module,\n\n189\n\nqsize() method, of Queue objects, 419, 445\n\nqueries, how to safely form for databases,\n\n300\n\nquery attribute\n\nof urlparse objects, 520 of urlsplit objects, 521\n\nQueryInfoKey() function, winreg module,\n\n410\n\nQueryValue() function, winreg module, 410\n\nQueryValueEx() function, winreg module,\n\n410\n\n497\n\nqueue module, 444\n\nround() function, 209 set comprehension, 623 set literals, 622 socketserver module, 489 standard library reorganization, 634 super() function, 120, 210, 627 supporting both Python 2 and 3, 638 syntax error with print, 6 third party libraries, 621\n\nQueue() function\n\nmultiprocessing module, 418 queue module, 444\n\nQueue() method, of Manager objects, 429\n\nqueue, circular, 262\n\nqueues\n\ncoroutines, 108 example with threads, 446\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2268,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 719,
      "content": "694\n\nqueues\n\nmessage passing, 415 multiple consumers and producers, 420 priority, 269 shared by multiple processes, 429 thread programming, 444\n\nquit() method\n\nof FTP objects, 498 of SMTP objects, 514\n\nquitting the interactive interpreter, 7\n\nquopri module, 567\n\nquote() function, urllib.parse module, 522\n\nquote_from_bytes() function, urllib.parse\n\nmodule, 522\n\nquote_plus() function, urllib.parse module,\n\n522\n\nquoteattr() function, xml.sax.saxutils mod-\n\nule, 583\n\nquotes, difference between styles, 27\n\nquoting, characters in URLs, 522\n\nR\n\n!r specifier in string formatting, 74\n\nr character, before a string literal, 29\n\n‘r’ mode, to open() function, 159\n\nr(eturn) debugger command, pdb module,\n\n189\n\nrace condition, 193, 414\n\n__radd__() method, 60\n\nwhen invoked over __add__(), 134\n\nradians() function, math module, 251\n\nradix attribute, of sys.float_info, 231\n\nraise statement, 23, 84-85, 88\n\n__rand__() method, 61\n\nRAND_add() function, ssl module, 488\n\nRAND_egd() function, ssl module, 488\n\nRAND_status() function, ssl module, 488\n\nrandint() function, random module, 254\n\nrandom module, 254\n\nrandom numbers, and threads, 256\n\nrandom() function, random module, 255\n\nrandrange() function, random module, 254\n\nrange of integer values, 38\n\nrange() function, 17, 209\n\nremoval in Python 3, 17 Rational abstract base class, 253\n\nrational numbers, 250\n\nraw I/O on files, 350\n\nraw socket, 470\n\nraw strings, 29\n\nUnicode, 29 backslash rules, 29 use in regular expressions, 281\n\nraw-unicode-escape encoding, description\n\nof, 170\n\nraw_decode() method, of JSONDecoder\n\nobjects, 566\n\nraw_input() function, 10, 162, 209\n\nPython 3, 11, 209\n\nRawArray() function, multiprocessing mod-\n\nule, 427\n\nRawConfigParser class, configparser mod-\n\nule, 336\n\nRawIOBase abstract base class, 354\n\nRawValue() function, multiprocessing mod-\n\nule, 426\n\nRCVALL_* constants, socket module, 482\n\n__rdiv__() method, 60\n\n__rdivmod__() method, 60\n\nre attribute, of MatchObject objects, 286\n\nre module, 41, 69, 281\n\nread() function, os module, 385\n\nread() method\n\nof BufferReader objects, 351 of ConfigParser objects, 333 of FileIO objects, 350 of HTTPResponse objects, 504 of StreamReder objects, 278 of TextIOWrapper objects, 353 of ZipFile objects, 326 of files, 159-160 of mmap objects, 371 of ssl objects, 488 of urlopen objects, 515\n\nread-eval loop, 5\n\nread1() method, of BufferReader objects,\n\n351\n\nF h Lib f L Bdff",
      "content_length": 2387,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 720,
      "content": "register command of setup.py file\n\n695\n\nread_byte() method, of mmap objects, 371\n\nreassigning part of a list, 12\n\nread_mime_types() function, mimetypes\n\nRecord objects, logging module, 359\n\nmodule, 567\n\nrecursion limit, changing, 112, 235\n\nreadable() method\n\nrecursion, 112\n\nof IOBase objects, 349 of dispatcher objects, 456\n\nand decorators, 102, 113 and generator functions, 112\n\nreadall() method, of FileIO objects, 350\n\nrecursive traversal of directory trees, 390\n\nreader() function, csv module, 549\n\nrecv() method\n\nReadError exception, tarfile module, 322\n\nreadfp() method, of ConfigParser objects,\n\n334\n\nof Connection objects, 421 of dispatcher objects, 456 of socket objects, 483\n\nreading CSV data, example of, 14\n\nrecv_bytes() method, of Connection objects,\n\nreading configuration files, 332\n\n421\n\nreading lines, files, 10\n\nrecv_bytes_into() method, of Connection\n\nreading user input, 10, 162\n\nobjects, 422\n\nreadinto() method, of BufferReader objects,\n\nrecv_into() method, of socket objects, 483\n\n351\n\nrecvfrom() method, of socket objects, 483\n\nreadline library, 176\n\nrecvfrom_info() method, of socket objects,\n\nreadline module, 586\n\n483\n\nreadline() method\n\nrecvmsg() system call, lack of support, 486\n\nof IOBase objects, 349 of StreamReder objects, 278 of TextIOWrapper objects, 353 of files, 10, 159-160 of mmap objects, 371 of urlopen objects, 515\n\nreduce() function, functools module, 268\n\n__reduce__() method, 229\n\n__reduce_ex__() method, 229\n\nreentrant mutex lock, 438\n\nref() function, weakref module, 240\n\nreference counting, 34, 129\n\nreadlines() method\n\nof IOBase objects, 349 of StreamReder objects, 278 of files, 13, 159-160 of urlopen objects, 515\n\nreadlink() function, os module, 388\n\nready() method, of AsyncResult objects,\n\nand copying, 35 and del statement, 35 and memory use, 192 and mutable objects, 36 in extension modules, 607 obtaining, 35 reference cycles\n\n425\n\nReal abstract base class, 253\n\nand garbage collection, 221 avoiding with weak references, 130,\n\nreal attribute\n\n240\n\nof complex numbers, 39 of floating point, 39\n\nReferenceError exception, 87, 214\n\nREG_* constants, winreg module, 409\n\nrealpath() function, os.path module, 398\n\nRegex objects, re module, 284\n\nreason attribute, of HTTPResponse objects,\n\nregister command of setup.py file, 155\n\n504\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2383,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 721,
      "content": "696\n\nregister() function\n\nregister() function\n\natexit module, 179, 219 webbrowser module, 544\n\nregister() method\n\nof BaseManager class, 430 of Poll objects, 459 of abstract base classes, 137\n\nregister_adapter() function, sqlite3 module,\n\n305\n\nregister_converter() function, sqlite3 mod-\n\nule, 304\n\nregister_dialect() function, csv module, 551\n\nregister_function() method, of XMLRPCServer objects, 527\n\nregister_instance() method, of XMLRPCServer objects, 527\n\nregister_introspection_functions() method,\n\nof XMLRPCServer objects, 528\n\nregister_multicall_functions() method, of\n\nXMLRPCServer objects, 528\n\nRegLoadKey() function, winreg module, 409\n\nregular expressions\n\npattern syntax, 281 re module, 281 use of raw strings, 281\n\nrelational databases, accessing from\n\nPython, 297\n\nrelational operators, 9, 56\n\nrelative package imports, 150-151\n\nrelease() method\n\nof Condition objects, 441 of Lock objects, 438 of RLock objects, 439 of Semaphore objects, 439\n\nreliable datagrams, 470\n\nreload() function, 149\n\nreloading modules, 149\n\nrelpath() function, os.path module, 398\n\nremote procedure call\n\nXML-RPC, 524 multiprocessing module, 423-424\n\nremove() function, os module, 388\n\nremove() method\n\nof Element objects, 577 of array objects, 260\n\nof deque objects, 262 of lists, 40-41 of sets, 15, 47\n\nremove_option() method, of ConfigParser\n\nobjects, 334\n\nremove_section() method, of ConfigParser\n\nobjects, 334\n\nremoveChild() method, of DOM Node\n\nobjects, 571\n\nremovedirs() function, os module, 388\n\nremoveFilter() method\n\nof Handler objects, 364 of Logger objects, 359\n\nremoveHandler() method, of Logger\n\nobjects, 361\n\nremoving directories, 318\n\nremoving files, 388\n\nremoving sequence items, 40\n\nremoving slices, 40\n\nrename() function, os module, 388\n\nrename() method, of FTP objects, 498\n\nrenames() function, os module, 388\n\nrepeat() function\n\ncProfile module, 190 itertools module, 272 operator module, 274 timeit module, 192\n\n‘replace’ error handling, Unicode encoding,\n\n166\n\nreplace() method\n\nof date objects, 337 of datetime objects, 340 of strings, 41, 43 of time objects, 338\n\nreplace_header() method, of Message\n\nobjects, 556\n\nreplaceChild() method, of DOM Node\n\nobjects, 571\n\nreplacing substrings, 41\n\nreplication, of sequences and shallow\n\ncopies, 67\n\nreport() method, of dircmp objects, 315\n\nreport_full_closure() method, of dircmp\n\nobjects, 315\n\nF h Lib f L Bdff",
      "content_length": 2368,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 722,
      "content": "rledecode_hqx() function, binascii module\n\n697\n\nreport_partial_closure() method, of dircmp\n\nResponseNotReady exception, http.client\n\nobjects, 315\n\nmodule, 504\n\nrepr (reprlib) module, 586\n\nresponses attribute, of\n\nrepr() function, 11, 55, 77, 176, 209\n\nBaseHTTPRequestHandler class, 509\n\nand eval(), 55 difference from str(), 12\n\nrestricting attribute names, 132\n\nrestype attribute, of ctypes function objects,\n\n__repr__() method, 55-56\n\n613\n\nrepresenting dates and times, 336\n\nrequest attribute, of BaseRequestHandler\n\nobjects, 490\n\nresult of last operation in interactive mode,\n\n6, 176\n\nretrbinary() method, of FTP objects, 499\n\nRequest() function, urllib.request module,\n\nretrlines() method, of FTP objects, 499\n\n516\n\nreturn statement, 96\n\nrequest() method, of HTTPConnection\n\nreturncode attribute, of Popen objects, 404\n\nobjects, 503\n\nreturning multiple values from a function,\n\nrequest_queue_size attribute, of\n\n18, 96\n\nSocketServer class, 492\n\nreverse keyword argument, to sort(), 40\n\nrequest_version attribute, of\n\nreverse() method\n\nBaseHTTPRequestHandler objects, 509\n\nRequestHandlerClass attribute, of\n\nof array objects, 260 of lists, 40-41\n\nSocketServer objects, 492\n\nreraising the last exception, 84\n\nreversed operand methods, when invoked,\n\n134\n\nreserved attribute, of ZipInfo objects, 327\n\nreversed operands, operator overloading,\n\nreserved words, 26\n\n60\n\nreset() method\n\nreversed() function, 209\n\nof HTMLParser objects, 562 of IncrementalDecoder objects, 279 of IncrementalEncoder objects, 278 of StreamReder objects, 278 of StreamWriter objects, 278\n\nreversing a list, 40\n\nrfile attribute\n\nof BaseHTTPRequestHandler objects,\n\n509\n\nof StreamRequestHandler objects, 491\n\nresetwarnings() function, warnings module,\n\nrfind() method, of strings, 41, 43\n\n239\n\n__rfloordiv__() method, 60\n\nresize() function, ctypes module, 617\n\nright shift operator >>, 65\n\nresize() method, of mmap objects, 371\n\nright_list attribute, of dircmp objects, 315\n\nresolution attribute\n\nright_only attribute, of dircmp objects, 315\n\nof date class, 337 of datetime class, 340 of time class, 338 of timedelta class, 341\n\nrindex() method, of strings, 41, 43\n\nrjust() method, of strings, 43\n\nrlcompleter module, 586\n\nresource module, 587\n\nrlecode_hqx() function, binascii module,\n\n548\n\nresponse time, asynchronous networking,\n\n467\n\nrledecode_hqx() function, binascii module,\n\n548\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2457,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 723,
      "content": "698\n\nRLock object\n\nRLock object\n\nmultiprocessing module, 427 threading module, 438\n\nRLock() method, of Manager objects, 429\n\n__rlshift__() method, 61\n\nrmd() method, of FTP objects, 499\n\nrmdir() function, os module, 388\n\n__rmod__() method, 60\n\nrmtree() function, shutil module, 319\n\n__rmul__() method, 60\n\nrobotparser module, 523\n\nrobots.txt file, 523\n\nrollback() method, of Connection objects,\n\n298\n\nrollover() method, of SpoolTemporaryFile\n\nobjects, 324\n\nroot logger, logging module, 355\n\n__ror__() method, 61\n\nrotate() method, of deque objects, 263\n\nrotating log files, 363\n\nRotatingFileHandler class, logging module,\n\n363\n\nround() function, 66, 209 and Python 3, 209\n\nrounding attribute, of Context objects, 247\n\nrounding behavior, 66\n\nchange in Python 3, 66 rounding, decimal module, 245\n\nrounds attribute, of sys.float_info, 231\n\nrow_factory attribute, of Connection\n\nobjects, 308\n\nrowcount attribute, of Cursor objects, 299\n\nrpartition() method, of strings, 41\n\n__rpow__() method, 61\n\n__rrshift__() method, 61\n\nrshift() function, operator module, 274\n\n__rshift__() method, 60\n\nrsplit() method, of strings, 41, 43\n\nrstrip() method, of strings, 43\n\n__rsub__() method, 60\n\n__rtruediv__() method, 60\n\nRuby, differences in object system, 124\n\nrun debugger command, pdb module, 189\n\nrun() function\n\ncProfile module, 190 pdb module, 186 profile module, 190\n\nrun() method\n\nof Process objects, 416 of Thread objects, 436\n\nruncall() function, pdb module, 186\n\nruneval() function, pdb module, 186\n\nrunning programs, 6\n\nRuntimeError exception, 87, 214\n\nRuntimeWarning warning, 216, 238\n\n__rxor__() method, 61\n\nS\n\n!s specifier in string formatting, 74\n\nS command line option, 173-174\n\ns command line option, 173\n\ns(tep) debugger command, pdb module,\n\n189\n\nsafe_substitute() method, of Template\n\nobjects, 289\n\nSafeConfigParser class, configparser mod-\n\nule, 336\n\nsame_files attribute, of dircmp objects, 315\n\nsamefile() function, os.path module, 398\n\nsameopenfile() function, os.path module,\n\n398\n\nsamestat() function, os.path module, 398\n\nsample() function, random module, 255\n\nSaveKey() function, winreg module, 410\n\nSAX interface\n\nXML parsing, 568 example of, 583\n\nscaling, with concurrency, 415\n\nsched module, 587-588\n\nscheduler, for generators and coroutines,\n\n447\n\nscheme attribute\n\nof urlparse objects, 520 of urlsplit objects, 521\n\nscientific notation, floating point, 27\n\nF h Lib f L Bdff",
      "content_length": 2389,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 724,
      "content": "sequences\n\n699\n\nscoping rules\n\nSemaphore object\n\nand module imports, 145 and self parameter in methods, 118 lexical scoping of functions, 97 of classes, 118 of function variables, 18, 96 of iteration variable in list comprehen-\n\nmultiprocessing module, 427 threading module, 439\n\nSemaphore objects, use for signaling, 439\n\nSemaphore() method, of Manager objects,\n\n429\n\nsemicolon ;, 26\n\nsion, 109\n\nof iteration variables, 82\n\nscript name, 157\n\nsearch path, for modules, 147\n\nsearch() function, re module, 284\n\nsearch() method, of Regex objects, 285\n\nsend() method\n\nof Connection objects, 422 of HTTPConnection objects, 503 of dispatcher objects, 456 of generators, 20, 53, 104 of socket objects, 484\n\nsearching, strings with an offset, 41\n\nsend_bytes() method, of Connection\n\nsecond attribute, of time objects, 338\n\nobjects, 422\n\nsections() method, of ConfigParser objects,\n\nsend_error() method, of\n\n334\n\nBaseHTTPRequestHandler objects, 509\n\nsecure sockets layer (SSL), 486\n\nsend_header() method, of\n\nsecurity\n\nBaseHTTPRequestHandler objects, 509\n\nXML-RPC servers, 530 database queries, 300 marshal module, 226 pickle module, 172, 229\n\nsend_response() method, of\n\nBaseHTTPRequestHandler objects, 509\n\nsend_signal() method, of Popen objects,\n\n403\n\nseed() function, random module, 254\n\nseek() method\n\nof IOBase objects, 350 of files, 160-161, 352 of mmap objects, 371\n\nsendall() method, of socket objects, 484\n\nsendcmd() method, of FTP objects, 499\n\nsending email, example of, 514, 558\n\nsendmail() method, of SMTP objects, 514\n\nsendmsg() system call, lack of support, 486\n\nseekable() method, of IOBase objects, 350\n\nsendto() method, of socket objects, 484\n\nselect module, 415, 459 signal handling, 399\n\nsentinel, use with queuing, 420, 446\n\nsep keyword argument, to print() function,\n\nselect() function\n\nand asyncore module, 455 performance problems, 467 select module, 459\n\n163\n\nsep variable, os module, 386\n\nseparator character, print() function, 163\n\nSequence abstract base class, 266\n\nself parameter of methods, 22, 118\n\nsequences, 39\n\nwhy required, 119\n\n__self__ attribute\n\nof built-in functions, 49 of methods, 49\n\ncomparison of, 70 concatenation, 67 extended slicing of, 68 in operator, 67 indexing in string formatting, 72 item assignment, 40\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2345,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 725,
      "content": "700\n\nsequences\n\niteration over, 39, 69 lookup in composite string formatting,\n\n42\n\nnegative indices, 68 operators, 67 picking random elements, 254 random sampling, 254 replication, 67 shallow copies in replication, 67 slice assignment, 40 slicing operator, 68 special methods of, 58 unpacking, 67-68\n\nserve_forever() method\n\nof BaseManager objects, 431 of SocketServer objects, 491\n\nserver attribute, of BaseRequestHandler\n\nobjects, 490\n\nserver program, 449\n\nTCP example, 451 UDP example, 485 example of restricting access with\n\nHTTP, 507\n\nexample with SocketServer module,\n\n490\n\nexample with coroutines, 464\n\nserver_address attribute, of SocketServer\n\nobjects, 492\n\nserver_version attribute\n\nof BaseHTTPRequestHandler class,\n\n508\n\nof HTTPRequestHandler class, 507 ServerProxy() function, xmlrpc.client mod-\n\nule, 524\n\nSet abstract base class, 266\n\nset comprehension, Python 3, 623\n\nset difference operator -, 75\n\nset intersection operator &, 75\n\nset literals, Python 3, 622\n\nset symmetric difference operator ^, 75\n\nset theory, similarity to list comprehen-\n\nsions, 110\n\nset type, 38, 46, 75\n\nset union operator |, 75\n\nset() function, 15, 77, 210\n\nset() method\n\nof ConfigParser objects, 334 of Element objects, 577 of Event objects, 440 of Morsel objects, 512\n\n__set__() method, of descriptors, 58, 126\n\nset_authorizer() method, of Connection\n\nobjects, 306\n\nset_boundary() method, of Message\n\nobjects, 556\n\nset_charset() method, of Message objects,\n\n556\n\nset_conversion_mode() function, ctypes\n\nmodule, 617\n\nset_debug() function, gc module, 221\n\nset_default_type() method, of Message\n\nobjects, 556\n\nset_defaults() method, of OptionParser\n\nobjects, 158, 377\n\nset_errno() function, ctypes module, 618\n\nset_executable() function, multiprocessing\n\nmodule, 435\n\nset_last_error() function, ctypes module,\n\n618\n\nset_param() method, of Message objects,\n\n556\n\nset_pasv() method, of FTP objects, 499\n\nset_payload() method, of Message objects,\n\n556\n\nset_progress_handler() method, of\n\nConnection objects, 307\n\nset_proxy() method, of Request objects,\n\n517\n\nset_server_documentation() method, of\n\nXMLRPCServer objects, 528\n\nset_server_name() method, of XMLRPCServer objects, 528\n\nset_server_title() method, of XMLRPCServer\n\nobjects, 528\n\nset_terminator() method, of asynchat\n\nobjects, 453\n\nset_threshold() function, gc module, 221\n\nset_trace() function, pdb module, 186\n\nset_type() method, of Message objects,\n\n557\n\nF h Lib f L Bdff",
      "content_length": 2420,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 726,
      "content": "settimeout() method, of socket objects\n\n701\n\nset_unixfrom() method, of Message\n\nsetLevel() method\n\nobjects, 557\n\nset_usage() method, of OptionParser\n\nof Handler objects, 364 of Logger objects, 359\n\nobjects, 377\n\nsetmode() function, msvcrt module, 373\n\nset_wakeup_fd() function, signal module,\n\n399\n\nsetattr() function, 210\n\nsetName() method, of Thread objects, 436\n\nsetoutputsize() method, of Cursor objects,\n\n299\n\nand private attributes, 128 __setattr__() method, 57-58, 131\n\nsetpassword() method, of ZipFile objects,\n\n326\n\nand __slots__, 133\n\nsetpgid() function, os module, 381\n\nsetblocking() method, of socket objects,\n\n484\n\nsetcheckinterval() function, sys module,\n\n235\n\nsetpgrp() function, os module, 381\n\nsetprofile() function sys module, 235 threading module, 444\n\nsetcontext() function, decimal module, 248\n\nsetDaemon() method, of Thread objects,\n\n437\n\nsetdefault() method of dicts, 45 of dicts and defaultdict objects, 263 setdefaultencoding() function, sys module,\n\nsetrecursionlimit() function, sys module,\n\n235\n\nsetregid() function, os module, 381\n\nsetreuid() function, os module, 381\n\n_setroot() method, of ElementTree objects,\n\n574\n\n235\n\nsets, 15\n\nsetdefaultencoding() method, sys module,\n\n177\n\nsetdefaulttimeout() function, socket mod-\n\nule, 476\n\nsetdlopenflags() function, sys module, 235\n\nsetDocumentLocator() method, of ContentHandler objects, 581\n\nsetegid() function, os module, 380\n\nseteuid() function, os module, 380\n\nsetFormatter() method, of Handler objects,\n\nadding items, 15 creating from iterable objects, 46 difference operator, 15 equality of, 78 in-place modification of, 47 intersection operator, 15 length of, 75 removing items, 15 symmetric difference operator, 15 union operator, 15 updating, 15\n\n365\n\nsetgid() function, os module, 380\n\nsetsid() function, os module, 381\n\nsetgroups() function, os module, 380\n\nsetslice() function, operator module, 274\n\nsetinputsize() method, of Cursor objects,\n\nsetsockopt() method, of socket objects, 484\n\n299\n\nsetstate() function, random module, 254\n\nsetitem() function, operator module, 274\n\n__setstate__() method, 228\n\n__setitem__() method, 58-59\n\nand slices, 59\n\nand copying, 220 and pickle module, 172\n\nsetitimer() function, signal module, 399\n\n@setter decorator of properties, 126\n\nsettimeout() method, of socket objects, 484\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2397,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 727,
      "content": "702\n\nsetting default encoding of standard I/O\n\nsetting default encoding of standard I/O,\n\n175\n\nsettrace() function\n\nsys module, 235 threading module, 444 setuid() function, os module, 381\n\nsetUp() method\n\nTestCase objects, 184 of TestCase objects, 184\n\nsetup() function, distutils module, 152, 596\n\nsetup() method, of BaseRequestHandler\n\nobjects, 490\n\nsetup.py file\n\nC extensions, 596 SWIG extensions, 620 and setuptools, 154 creating, 152-153 install command, 153-154 installing in per-user site directory, 178\n\nsetuptools library, 147, 154\n\nSetValue() function, winreg module, 411\n\nSetValueEx() function, winreg module, 411\n\nsha1() function, hashlib module, 559\n\nsha224() function, hashlib module, 559\n\nsha256() function, hashlib module, 559\n\nsha384() function, hashlib module, 559\n\nsha512() function, hashlib module, 559\n\nshallow copy, 36\n\nof dicts, 45 of lists, 40 sequence replication, 67\n\nshared arrays, multiprocessing module,\n\n426\n\nshared libraries\n\nextension modules, 148 loading with ctypes, 612\n\nshared memory\n\nexample of passing a list, 427 multiprocessing module, 426\n\nsharing of objects, 35\n\nShelf class, shelve module, 311\n\nshell commands\n\ncollecting output from, 331 emulating in Python, 318\n\nshell pipes, similarity to generators, 106\n\nshelve module, 171, 311 dbhash module, 311 selecting the pickle protocol, 172\n\nshlex module, 588\n\nshort-circuit evaluations, of boolean expres-\n\nsions, 78\n\nshowwarning() function, warnings module,\n\n239\n\nshuffle() function, random module, 255\n\nshutdown() function, logging module, 366\n\nshutdown() method\n\nof BaseManager objects, 431 of SocketServer objects, 492 of socket objects, 484\n\nshutil module, 318\n\nside effects\n\nin functions, 95 reasons to avoid, 96 SIG* signal names, 400\n\nSIGHUP signal, 179\n\nsiginterrupt() function, signal module, 400\n\nsignal handling, 399\n\nsignal module, 399\n\nsignal() function, signal module, 400\n\nsignaling, with semaphores, 439\n\nsignals\n\nclose() method of generators, 104 list of, 400 mixing with threads, 402 throw() method of generators, 105\n\nSIGTERM signal, 179\n\nsimple_producer() function, asynchat mod-\n\nule, 453\n\nSimpleCookie() function, http.cookies mod-\n\nule, 512\n\nSimpleHandler() function, wsgiref.handlers\n\nmodule, 543\n\nSimpleHTTPRequestHandler class,\n\nhttp.server module, 507\n\nSimpleHTTPServer module, see http.server,\n\n506\n\nSimpleXMLRPCServer class, xmlrpc.server\n\nmodule, 527\n\nF h Lib f L Bdff",
      "content_length": 2390,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 728,
      "content": "sorting\n\n703\n\nSimpleXMLRPCServer module, 527\n\nsin() function, math module, 252\n\nof class definitions, 132 optimization, 196\n\nsingle precision floating point, 39\n\nSmalltalk, differences in object system, 124\n\nsingleton tuple, 14\n\nSMTP protocol, example of sending a mes-\n\nsinh() function, math module, 252\n\nsage, 514\n\nsite configuration files, 177\n\nSMTP() function, smtplib module, 514\n\nsite module, 166, 174, 177\n\nsmtpd module, 587\n\nsite-packages directory, 175\n\nSMTPHandler class, logging module, 363\n\nsitecustomize module, 177\n\nsmtplib module, 513\n\nsize attribute\n\nsndhdr module, 588\n\nof Struct objects, 291 of TarInfo objects, 322\n\nsniff() method, of Sniffer objects, 550\n\nSniffer() function, csv module, 550\n\nsize() method\n\nSO_* socket options, socket module, 479\n\nof FTP objects, 499 of mmap objects, 371 Sized abstract base class, 265\n\nSOCK_* constants, socket module, 470\n\nsocket attribute, of SocketServer objects,\n\n492\n\nsizeof() function, ctypes module, 618\n\nsocket module, 469\n\nskippedEntity() method, of ContentHandler\n\nsocket() function, socket module, 476\n\nobjects, 581\n\nsocket, definition of, 449\n\nsleep() function, time module, 406\n\nsocket_type attribute, of SocketServer\n\nsleeping, 406\n\nclass, 493\n\nuntil signal received, 399\n\nSocketHandler class, logging module, 363\n\nslice assignment, lists, 12\n\nsocketpair() function, socket module, 477\n\nslice objects, 51, 53\n\nsockets\n\nand indexing methods, 59 attributes of, 54\n\nslice type, 51\n\nslice() function, 53, 210\n\naddress families, 470 methods on, 478 polling with select(), 459 specifying network addresses, 471 types of, 470\n\nslices, 39\n\nand special methods, 59 and xrange objects, 44 assignment to, 40, 69 deletion of, 40, 69 multidimensional, 59 slicing operator [:], 67-68\n\nSocketServer module, 489 and Python 3, 489 changing server parameters, 492\n\nsoftspace attribute, of files, 161\n\nsort() method, of lists, 40-41\n\nsorted() function, 210\n\non lists, 12 on strings, 11\n\n__slots__ attribute\n\nand __dict__ attribute of instances, 50 compatibility with other code, 133 inheritance, 133\n\nsorting\n\nchanging behavior of, 40 in-place on lists, 40 requirements for objects, 57 reverse order, 40 use of operator module, 275\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2280,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 729,
      "content": "704\n\nsource code encoding\n\nsource code encoding, 31\n\nPython 3, 622\n\nspan() method, of MatchObject objects,\n\n286\n\nspawnl() function, os module, 393\n\nspawnle() function, os module, 393\n\nspawnlp() function, os module, 393\n\nspawnlpe() function, os module, 393\n\nspawnv() function, os module, 392\n\nspawnve() function, os module, 393\n\nspawnvp() function, os module, 393\n\nspawnvpe() function, os module, 393\n\nspecial methods, 21, 54\n\nspecial symbols, 30\n\nspeedup, definition of, 192\n\nsplit() function\n\nos.path module, 398 re module, 284\n\nsplit() method\n\nof Regex objects, 285 of strings, 14, 41, 43\n\nsplitdrive() function, os.path module, 398\n\nsplitext() function, os.path module, 398\n\nsplitlines() method, of strings, 44\n\nsplitting, strings, 14, 43\n\nsplitunc() function, os.path module, 398\n\nSpooledTemporaryFile() function, tempfile\n\nmodule, 324\n\nsprintf() function equivalent, 70\n\nspwd module, 587\n\nSQL queries\n\nSQL injection attack, 300 examples of, 309 executing on database, 297 how to form, 300 similarity to list comprehensions, 111\n\nSQLite database, 303\n\nsqlite3 module, 303\n\nsqrt() function, math module, 252\n\nsqrt() method, of Decimal objects, 243\n\nssl module, 486\n\nSSL, example of creating certificates, 489\n\nst_* attributes, of stat objects, 389\n\nstack frames, 52\n\nin tracebacks, 53 stack size, for threads, 444\n\nstack() function, inspect module, 225\n\nstack_size() function, threading module,\n\n444\n\nStackless Python, 467\n\nstandard I/O streams, 161\n\nand integrated development environ-\n\nments, 162\n\nsetting the default encoding, 175\n\nstandard error, 157\n\nstandard input and output, 10\n\nstandard library reorganization, Python 3,\n\n634\n\nstandard_b64decode() function, base64\n\nmodule, 546\n\nstandard_b64encode() function, base64\n\nmodule, 546\n\nStandardError exception, 87\n\nstarmap() function, itertools module, 272\n\nstart attribute, of slices, 54\n\nstart() method\n\nof BaseManager objects, 431 of MatchObject objects, 286 of Process objects, 416 of Thread objects, 436 of Timer objects, 438 of TreeBuilder objects, 577\n\nstartDocument() method, of\n\nContentHandler objects, 582\n\nstartElement() method, of ContentHandler\n\nobjects, 582\n\nstartElementNS() method, of\n\nContentHandler objects, 582\n\nstartfile() function, os module, 393\n\nstartPrefixMapping() method, of ContentHandler objects, 582\n\nstartswith() method, of strings, 44\n\nstartup script, in interactive mode, 174\n\nstat module, 387, 587\n\nstat() function\n\nos module, 388 os.path module, 398\n\nF h Lib f L Bdff",
      "content_length": 2458,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 730,
      "content": "strings\n\n705\n\nstat_float_times() function, os module, 389\n\nStreamRequestHandler class, SocketServer\n\nstatement termination, 7 and semicolons, 7\n\nmodule, 491\n\nstreams, 470\n\nstatements\n\nStreamWriter class, codecs module, 278\n\nbreaking across multiple lines, 9 putting on the same line, 25-26 running in the debugger, 186\n\nstreamwriter() method, of CodecInfo\n\nobjects, 278\n\nstrerror() function, os module, 381\n\nstatic method, 22, 48, 123, 125\n\nstrftime() function, time module, 406\n\npractical use of, 123\n\nstrftime() method\n\n@staticmethod decorator, 22, 48, 123, 125,\n\n210\n\nof date objects, 337 of time objects, 338\n\nstatistics, random number distributions,\n\n‘strict’ error handling, Unicode encoding,\n\n255\n\n166\n\nstatus attribute, of HTTPResponse objects,\n\nstring attribute, of MatchObject objects,\n\n504\n\n286\n\nstatvfs() function, os module, 389\n\nstderr attribute, of Popen objects, 404\n\nstderr variable, sys module, 161, 232\n\n__stderr__ variable, sys module, 162, 232\n\nstdin attribute, of Popen objects, 404\n\nstdin variable, sys module, 10, 161, 232\n\n__stdin__ variable, sys module, 162, 232\n\nstdout attribute, of Popen objects, 404\n\nstdout variable, sys module, 10, 161, 232\n\n__stdout__ variable, sys module, 162, 232\n\nstring formatting, 70 !r specifier, 74 !s specifier, 74 alignment, 73 attribute lookup, 72 codes for % operator, 70-71 customizing format() method, 74 dictionaries, 72 dictionary lookup, 72 fill characters, 73 format specifiers, 72 formatting operator %, 70\n\nstep attribute, of slices, 54\n\nStopIteration exception, 59, 87, 215\n\nstring interpolation, 72, 163\n\nand generators, 103\n\nstring literals, 27\n\nstorbinary() method, of FTP objects, 499\n\nstorlines() method, of FTP objects, 499\n\nstr type, 38\n\nstr() function, 11, 56, 76, 210\n\nand print, 162 difference from repr(), 12\n\nUnicode characters, 28 and Unicode encodings, 29 and documentation strings, 30 byte strings, 29 unicode characters in source code, 31\n\nstring module, 287\n\n__str__() method, 55-56\n\nTemplate strings, 164\n\nStreamError exception, tarfile module, 322\n\nstring_at() function, ctypes module, 618\n\nStreamHandler class, logging module, 363\n\nStringIO class, io module, 353\n\nStreamReader class, codecs module, 278\n\nstringprep module, 586\n\nstreamreader() method, of CodecInfo\n\nstrings, 11\n\nobjects, 278\n\nUnicode, 41, 165 and numeric calculations, 11\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2425,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 731,
      "content": "706\n\nstrings\n\nas a dictionary key, 16 as in-memory text files, 353 as sequences, 39 basestring object for type checking,\n\n202\n\nbyte literals, 29 byte strings, 41, 202 case conversion, 43-44 character substitution, 42 comparison of, 70 concatenation, 11 concatenation of adjacent literals, 27 creating custom formatters, 288 disabling escape codes in literals, 29 encoding for URLs, 522 escape codes in literals, 27 escaping characters for use in HTML,\n\n536\n\nescaping characters for use in XML,\n\n583\n\nexecuting Python code contained\n\nwithin, 115\n\nformat() method, 8, 72 formatting, 8, 42 formatting in log messages, 358 immutability of, 41, 69 indexing, 11 internal representation, 28 iterating over characters, 17 joining, 43 line structure, 11 mixing byte strings and Unicode, 70 mutable byte arrays, 202 partitioning, 41 regular expressions, 281 replacing substrings, 41 searching for substrings, 41 slices, 11 sorting and internationalization, 70 specifiers for format() method, 72-73 splitting, 43 splitting into fields, 14, 41 stripping, 43 unescaping XML character references,\n\n583\n\nstrip() method, of strings, 44\n\nstripping\n\ncontrol characters from a string, 42 strings, 44\n\nstrptime() function, time module, 343, 407\n\nstrptime() method, of datetime class, 339\n\nStruct class, struct module, 291\n\nstruct module, 290\n\nStructure class, ctypes module, 614\n\nstructures, and tuples, 14\n\nsub() function\n\noperator module, 273 re module, 284\n\nsub() method, of Regex objects, 285\n\n__sub__() method, 60\n\nsubclass, 119\n\n__subclasscheck__() method, 57, 136\n\nsubdirs attribute, of dircmp objects, 315\n\nSubElement() function,\n\nxml.etree.ElementTree module, 575\n\nsubn() function, re module, 284\n\nsubn() method, of Regex objects, 285\n\nsubprocess module, 402\n\nsubprocess, definition of, 413\n\nsubstitute() method\n\nof Template objects, 289 of Template strings, 164\n\nsubstrings\n\nchecking for existence using in, 69 searching for, 41 subtraction operator -, 65\n\nsucessful() method, of AsyncResult objects,\n\n425\n\nsum() function, 39-40, 67, 210\n\naccuracy of, 252 and decimal module, 69 restriction to numeric data, 39 versus math.fsum() function, 252\n\nsunau module, 588\n\nsuper() function, 120, 210 Python 3, 210, 627\n\nsuperclass, 119\n\ncalling methods in, 120 super() function, 120\n\nF h Lib f L Bdff",
      "content_length": 2281,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 732,
      "content": "TarInfo objects, tarfile module\n\n707\n\nsupporting both Python 2 and 3, 638\n\nsys.prefix variable, 177\n\nsupports_unicode_filenames variable,\n\nsys.ps1 variable, 176\n\nos.path module, 398\n\nsys.ps2 variable, 176\n\nsurrogate pair, 28, 41\n\nsys.stderr variable, 157, 161\n\nsuspension, of threads, 443\n\nsys.stdin variable, 161\n\nswapcase() method, of strings, 44\n\nsys.stdout variable, 161\n\nSWIG, 591\n\nsys_version attribute, of\n\nexample of, 619 interface file, 619 switch statement, lack of, 9\n\nBaseHTTPRequestHandler class, 508\n\nsysconf() function, os module, 395\n\nsyslog module, 587\n\nsymbol module, 586\n\nSysLogHandler class, logging module, 363\n\nsymbolic links, testing a filename for, 397\n\nsystem calls, os module, 378\n\nsymlink() function, os module, 389\n\nsystem error codes, 344\n\nsymmetric difference operator ^, of sets,\n\nsystem() function, os module, 393\n\n15\n\nsystem.listMethods() method, of\n\nsymmetric_difference() method, of sets, 46\n\nServerProxy objects, 525\n\nsymmetric_difference_update() method, of\n\nSystemError exception, 87, 215\n\nsets, 47\n\nsync() method\n\nSystemExit exception, 7, 87-88, 157, 179,\n\n215\n\nof dbm-style database objects, 310 of shelve objects, 311 synchronization primitives\n\nT\n\nmultiprocessing module, 427 threading module, 438\n\nt command line option, 26, 173-174\n\ntab escape code in strings, 28\n\nsynchronization\n\ntabcheck attribute, of sys.flags, 230\n\nof close() method of generators, 104 of concurrent programs, 414 of throw() method of generators, 105\n\nTabError exception, 26, 87, 215\n\ntabnanny module, 586\n\ntabs, and indentation, 26\n\nSyntaxError exception, 87, 215 Python 3 print statement, 6 and default arguments, 93 and except statements, 85 SyntaxWarning warning, 216, 238\n\ntag attribute, of Element objects, 576\n\ntagName attribute, of DOM Element\n\nobjects, 572\n\ntail attribute, of Element objects, 576\n\ntail command, example with generators, 19\n\nsys module, 13, 229\n\ntail-recursion optimization, lack of, 112\n\nsys.argv variable, 13, 157, 174\n\ntakewhile() function, itertools module, 272\n\nsys.displayhook variable, 176\n\ntan() function, math module, 252\n\nsys.exec_prefix variable, 177\n\ntanh() function, math module, 252\n\nsys.exit() function, 179\n\nTarError exception, tarfile module, 322\n\nsys.modules variable, 144, 149\n\nTarFile objects, tarfile module, 320\n\nsys.path variable, 147\n\ntarfile module, 319\n\nand site module, 177 third-party modules, 154\n\nTarInfo objects, tarfile module, 321\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2503,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 733,
      "content": "708\n\ntask scheduler, example with coroutines and select()\n\ntask scheduler, example with coroutines\n\nterminate() method\n\nand select(), 460\n\ntask_done() method\n\nof JoinableQueue objects, 419 of Queue objects, 445\n\nof Pool objects, 425 of Popen objects, 403-404 of Process objects, 416\n\nterminating statements with semicolons, 7\n\ntasklets, 446\n\ntermination\n\nasynchronous I/O, 460\n\nimmediate without garbage collection,\n\ntasks, and coroutines, 20\n\n391\n\ntb_* attributes, of traceback objects, 53\n\ntb_lineno() function, traceback module, 236\n\ntbreak debugger command, pdb module,\n\n189\n\nof programs, 179 of threads, 443 registering cleanup functions, 219 sys.exit() function, 233 without garbage collection, 179\n\ntcgetpgrp() function, os module, 385\n\nTCP connection, diagram of, 450\n\ntermios module, 587\n\nTCP protocol, 449\n\ntest module, 586\n\nexample code, 451\n\ntest() function, cgi module, 537\n\nTCP_* socket options, socket module, 482\n\nTestCase class, unittest module, 184\n\nTCPServer class, SocketServer module, 491\n\ntesting\n\ntcsetpgrp() function, os module, 385\n\ntearDown() method\n\nTestCase objects, 184 of TestCase objects, 184\n\ndoctest module, 181 documentation strings, 181 limitations of doctest, 183 unit testing, 183\n\ntee() function, itertools module, 273\n\ntell() method\n\nof IOBase objects, 350 of files, 160-161 of mmap objects, 371\n\ntestmod() function\n\ndoctest() module, 182 doctest module, 182\n\ntestzip() method, of ZipFile objects, 326\n\nText class, xml.dom.minidom module, 572\n\ntelnetlib module, 587\n\ntext I/O, 353\n\ntempdir variable, tempfile module, 324\n\ntext attribute, of Element objects, 576\n\ntempfile module, 323\n\ntext file mode, 159\n\nTemplate class, string module, 289\n\nTemplate strings\n\nstring module, 164 use in CGI script, 537\n\ntext replacement, replace() method of\n\nstrings, 41\n\ntext versus bytes in Python 3, 629\n\ntext_factory attribute, of Connection\n\nobjects, 308\n\ntemplate attribute, of Template objects,\n\n290\n\nTextIOBase abstract base class, 354\n\ntemplate variable, tempfile module, 324\n\nTextIOWrapper class, io module, 353\n\ntemporary files, 323\n\ntextwrap module, 586\n\nTemporaryFile() function, tempfile module,\n\nthird-party libraries, and Python 3, 621\n\n323\n\nthird-party packages\n\nand C/C++ code, 154 and sys.path variable, 154\n\nF h Lib f L Bdff",
      "content_length": 2266,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 734,
      "content": "timezone variable, time module\n\n709\n\ninstallation of, 154 installing in per-user site directory, 154,\n\n178\n\nthis pointer, self parameter of methods,\n\n119\n\nThread class, threading module, 436\n\nthread attribute, of Record objects, 359\n\nsignal handling, 402 signaling with semaphores, 439 suspending, 443 synchronization of, 414 termination of, 443 throw() method of generators, 105 use of queues, 444 worker thread example, 446\n\nthreading module, 436\n\nsynchronization primitives, 438 ThreadingMixIn class, SocketServer mod-\n\nthreadsafety variable, database API, 302\n\nthrow() method, of generators, 53, 105-106\n\nule, 494\n\ntime and date parsing, 407\n\nThreadingTCPServer class, SocketServer\n\nmodule, 494\n\ntime class, datetime module, 338\n\nThreadingUDPServer class, SocketServer\n\ntime manipulation, 336\n\nmodule, 494\n\ntime module, 191, 405\n\nthreadName attribute, of Record objects,\n\n359\n\naccuracy of time functions, 408 current time, 405\n\nthreads\n\ntime parsing, 343\n\nCPU-bound tasks, 444 adding to network servers, 494 atomic operations and disassembly, 193 check interval, 234 close() method of generators, 104 compared to coroutines, 467 condition variables, 441 daemonic, 436 database modules, 302 decimal module, 249 definition of, 413 events, 440 extension modules, 607 global interpreter lock, 414, 444 local storage, 443 main thread, 413 mutex lock, 438 obtaining number of active, 443 random number generation, 256 reentrant mutex lock, 438 scaling properties, 415 scheduling of, 414 semaphores, 439 setting stack size, 444 setting the name, 436\n\nTime() function, database API, 301\n\ntime() function, time module, 191, 407\n\ntime() method, of datetime objects, 340\n\ntimedelta class, datetime module, 340\n\nTimedRotatingFileHandler class, logging\n\nmodule, 363\n\nTimeFromTicks() function, database API,\n\n301\n\ntimeit module, 191\n\ntimeit() function\n\ncProfile module, 190 timeit module, 191\n\ntimeout attribute, of SocketServer class,\n\n493\n\ntimeout exception, socket module, 485\n\ntimeout, example with alarm signals, 401\n\nTimer() function, threading module, 437\n\ntimes() function, os module, 394\n\nTimestamp() function, database API, 301\n\nTimestampFromTicks() function, database\n\nAPI, 301\n\ntimetuple() method, of date objects, 337\n\ntimetz() method, of datetime objects, 340\n\ntimezone variable, time module, 405\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2398,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 735,
      "content": "710\n\ntiming measurements\n\ntiming measurements, 191\n\nTIPC protocol, 470\n\naddress format, 472\n\nTIPC_* constants, socket module, 473\n\ntitle() method, of strings, 44\n\nTkinter module, 588\n\ntoday() method, of date class, 336\n\ntofile() method, of array objects, 260\n\ntoken module, 586\n\ntokenize module, 586\n\ntolist() method, of array objects, 260\n\ntoordinal() method, of date objects, 337\n\ntoprettyxml() method, of DOM Node\n\nobjects, 572\n\ntostring() function, xml.etree.ElementTree\n\nmodule, 578\n\ntostring() method, of array objects, 260\n\ntotal_changes attribute, of Connection\n\nobjects, 308\n\ntounicode() method, of array objects, 260\n\ntoxml() method, of DOM Node objects, 573\n\ntrace() function, inspect module, 225\n\ntraceback messages, 22\n\ntraceback module, 235\n\ntraceback objects, 51-52 attributes of, 53 stack frames, 53\n\n__traceback__ attribute, of Exception\n\nobjects, 213\n\ntracebacklimit variable, sys module, 232\n\ntracebacks\n\ncreating with traceback module, 236 limiting the amount of output, 232\n\nTracebackType type, 51, 237\n\ntrailing J on complex number literals, 27\n\ntrailing L on long integers, 27\n\ntrailing comma\n\nand tuples, 14 print statement, 162\n\ntransfercmd() method, of FTP objects, 500\n\ntranslate() method, of strings, 42, 44\n\ntraps attribute, of Context objects, 247\n\nTreeBuilder() function,\n\nxml.etree.ElementTree module, 577\n\ntriangular() function, random module, 256\n\ntriple-quoted strings, 11\n\nand variable interpolation, 163\n\nTrue value, 9, 27, 38\n\ntruediv() function, operator module, 273\n\n__truediv__() method, 60\n\ntrunc() function, math module, 252\n\ntruncate() method\n\nof IOBase objects, 350 of files, 160\n\ntruncating division operator //, 65\n\ntruncation, of integer division, 61, 65\n\ntruth value testing, 78\n\ntruth values, 9\n\ntruth() function, operator module, 274\n\ntry statement, 22, 84-85\n\ntt command line option, 26, 173-174\n\ntty module, 587\n\nttyname() function, os module, 385\n\ntuning strategies, 194\n\ntuple type, 38\n\ntuple unpacking, and for-loops, 15\n\ntuple() function, 77, 211\n\ntuples, 14\n\nand string formatting, 70 as dictionary key, 16 as dictionary keys, 74 as sequence, 39 comparison on, 70 concatenation, 14 creating a list of from dictionary, 45 creating with named attributes, 264 immutability, 14 immutability of, 69 indexing, 14 memory savings of, 14 omission of parantheses, 14 problems with using as data structure,\n\n264\n\nrepresenting records, 14 singleton, 14\n\nF h Lib f L Bdff",
      "content_length": 2416,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 736,
      "content": "unary plus operator +\n\n711\n\nslicing, 14 unpacking in Python 3, 623 unpacking in iteration, 82 use by standard library, 265 use in list comprehensions, 109 versus lists, 14\n\nTwisted library, 415, 467\n\ntwo-dimensional lists, 13, 15\n\ntype, 47\n\ntype attribute\n\ntypes\n\nboolean, 38 built-in, 37, 201 callable, 47 dictionary, 44 floating point, 38 frozenset, 46 integers, 38 of sockets, 470 set, 46 type of, 47\n\nof FieldStorage objects, 535 of TarInfo objects, 322 of socket objects, 484\n\ntzinfo attribute, of time objects, 338\n\ntzname variable, time module, 405\n\ntype checking\n\ntzname() method\n\nexample with metaclass, 140 of objects, 34 performance impact of, 34 problem with proxy objects, 135 type coercion, and operator overloading,\n\nof time objects, 339 of tzinfo objects, 342\n\ntzset() function, time module, 407\n\nU\n\n134\n\ntype comparison of objects, 34\n\ntype conversion, 76\n\nlack of implicit conversion, 62 of columns in a datafile, 37 special methods for, 62\n\n\\U escape code, in strings, 28\n\n\\u escape code, in strings, 28\n\nU command line option, 28, 173\n\n‘U’ mode, to open() function, 159\n\nu character, before a string literal, 28\n\ntype hierarchies, 138\n\nu command line option, 173\n\ntype objects, 50\n\nu(p) debugger command, pdb module, 189\n\ntype of objects, 33\n\nUDP client example, 486\n\ntype() function, 34, 211 and exceptions, 89 type() metaclass, 138\n\nUDP communication, diagram of, 451\n\nUDP protocol, 449\n\nUDP server example, 485\n\ntype_options attribute, of FieldStorage\n\nUDPServer class, SocketServer module,\n\nobjects, 535\n\n491\n\ntypecode attribute, of array objects, 259\n\nuid attribute, of TarInfo objects, 322\n\nTypeError exception, 87, 215 and function calls, 94 and type coercion, 62 method resolution order, 122\n\numask() function, os module, 381\n\nunalias debugger command, pdb module,\n\n189\n\nuname attribute, of TarInfo objects, 322\n\ntypes module, 47, 237 and Python 3, 237\n\nuname() function, os module, 381\n\nunary minus operator -, 65\n\nunary plus operator +, 65\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2067,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 737,
      "content": "712\n\nunbound method\n\nunbound method, 49 and Python 3, 49\n\nUnboundLocalError exception, 87, 98, 215\n\nunbuffered file I/O, 159\n\nunconsumed_tail attribute, of decompres-\n\nsobj objects, 329\n\nunderscores, usage in identifiers, 26\n\nunescape() function, xml.sax.saxutils mod-\n\nule, 583\n\nungetch() function, msvcrt module, 373\n\nungetwch() function, msvcrt module, 373\n\nunhexlify() function, binascii module, 548\n\nunichr() function, 77, 211\n\nUnicode character database, 293\n\nUnicode characters, representation of, 41\n\nUnicode string literals, 28\n\nUnicode strings, 41 and WSGI, 541 common encodings, 166 decomposing, 295 encoding and decoing, 165 encoding in network programs, 452 error handling options, 166 handling of, 165 mixing with byte strings, 167 normalizing, 296 regular expressions, 281\n\nunicode attribute, of sys.flags, 230\n\nunicode type, 38\n\nunicode() function, 211 and Python 3, 211\n\nUnicode\n\nPython 2 vs. Python 3, 28 and BOM characters, 168 and XML, 168 byte order marker, 280 character encoding and decoding, 42 character properties database, 170 code points, 28 common encodings, 168-169 encoding in string literals, 29 encoding of source code, 31 file I/O, 167 mixing with byte strings, 70\n\nnormalization of strings, 171 specifying characters in string literals,\n\n28\n\nsurrogate pairs, 28, 41 using 32-bit character code points, 41\n\nunicode-escape encoding, description of,\n\n170\n\nunicodedata module, 170, 293\n\nUnicodeDecodeError exception, 87, 215\n\nUnicodeEncodeError exception, 87, 215 Python 3 interactive mode, 175 UnicodeError exception, 87, 166, 215\n\nUnicodeTranslateError exception, 87, 215\n\nunidata_version variable, unicodedata mod-\n\nule, 296\n\nunification of integer and long types, 38\n\nuniform access principle, 125\n\nuniform type arrays, 259\n\nuniform() function, random module, 255\n\nUnimplementedFileMode exception,\n\nhttp.client module, 504\n\nUnion class, ctypes module, 614\n\nunion operator |, of sets, 15\n\nunion() method, of sets, 46\n\nunit testing\n\nPython 3 migration, 635 example, 184 unittest module, 183\n\nunittest module, 183 example, 184\n\nuniversal newline mode, 159\n\nUNIX domain protocol, 470 address format, 472\n\nUnix systems log, issuing message to, 363\n\nUnix\n\n#! execution of programs, 6 per-user site directory, 177 time epoch definition, 405\n\nUnixDatagramServer class, SocketServer\n\nmodule, 491\n\nUnixStreamServer class, SocketServer mod-\n\nule, 491\n\nUnknownHandler class, urllib.request mod-\n\nule, 518\n\nF h Lib f L Bdff",
      "content_length": 2445,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 738,
      "content": "UserWarning warning\n\n713\n\nUnknownProtocol exception, http.client\n\nupper() method, of strings, 44\n\nmodule, 504\n\nuppercase variable, string module, 287\n\nUnknownTransferEncoding exception,\n\nhttp.client module, 504\n\nunlink() function, os module, 390\n\nurandom() function, os module, 396\n\nurldefrag() function, urllib.parse module,\n\n521\n\nunloading modules, 149\n\nurlencode() function, urllib.parse module,\n\nunpack() function, struct module, 290\n\n522\n\nunpack() method, of Struct objects, 291\n\nURLError exception, 516\n\nunpack_from() function, struct module, 291\n\nurllib.error module, 523\n\nunpack_from() method, of Struct objects,\n\nurljoin() function, urllib.parse module, 521\n\n291\n\nurllib module, 522\n\nunpacking\n\nsee urllib.request, 515\n\nbinary data structures, 290 of sequences, 67-68 of tuples, 14\n\nurllib package, 514\n\nurllib.error module, 523\n\nurllib.parse module, 520\n\nUnpickler class, pickle module, 228\n\nurllib.request module, 515\n\nunquote() function, urllib.parse module,\n\n522\n\nunquote_plus() function, urllib.parse mod-\n\nule, 522\n\nurllib.response module, 520\n\nurllib.robotparser module, 523\n\nurllib2 module, see urllib.request, 515\n\nunquote_to_bytes() function, urllib.parse\n\nmodule, 522\n\nurlopen() function, urllib.request module,\n\n515\n\nunregister() method, of Poll objects, 460\n\nurlparse module, 520\n\nunregister_dislect() function, csv module,\n\n551\n\nurlparse() function, urllib.parse module,\n\n520\n\nunsetenv() function, os module, 381\n\nuntil debugger command, pdb module, 189\n\nunused_data attribute, of decompressobj\n\nobjects, 329\n\nunwrap() method, of ssl objects, 488\n\nupdate() method of dicts, 45 of digest objects, 559 of hmac objects, 560 of sets, 15, 47\n\nurlsafe_b64decode() function, base64 mod-\n\nule, 546\n\nurlsafe_b64encode() function, base64 mod-\n\nule, 546\n\nurlsplit() function, urllib.parse module, 521\n\nurlunparse() function, urllib.parse module,\n\n521\n\nurlunsplit() function, urllib.parse module,\n\n521\n\nuser directory, installation of packages, 154\n\nuser module, 586\n\nupdate_wrapper() function, functools mod-\n\nule, 269\n\n—user option to setup.py, 154\n\nupdating a dictionary, 45\n\nuploading\n\nfiles in CGI scripts, 536 files to a HTTP server with POST, 505 files to an FTP server, 500 packages to pypi, 155\n\nuser-agent header in HTTP requests, chang-\n\ning, 517\n\nusername attribute\n\nof urlparse objects, 520 of urlsplit objects, 521 UserWarning warning, 216, 238\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2467,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 739,
      "content": "714\n\nusing Python as a calculator\n\nusing Python as a calculator, 6\n\nutcfromtimestamp() method, of datetime\n\nclass, 339\n\nutcnow() method, of datetime class, 339\n\nutcoffset() method\n\nof time objects, 339 of tzinfo objects, 342\n\nutctimetuple() method, of datetime objects,\n\n340\n\nUTF-16 encoding, description of, 170\n\nUTF-8\n\ncompatibility with ASCII, 170 description of, 169-170 encoding and decoding, 42 including in string literals, 29 lexicographic ordering, 170\n\nutime() function, os module, 390\n\nuu module, 587\n\nV\n\nV command line option, 173\n\nv command line option, 173-174\n\nvalidator() function, wsgiref.handlers mod-\n\nule, 543\n\nvalue attribute\n\nof FieldStorage objects, 535 of Morsel objects, 512\n\nValue() function, multiprocessing module,\n\n426\n\nValue() method, of Manager objects, 429\n\nValueError exception, 87, 215\n\nand lists, 40 and strings, 41\n\nvaluerefs() method, of WeakValueDictionary\n\nobjects, 241\n\nvalues() method\n\nof Message objects, 552 of dicts, 45 of dicts in Python 3, 632\n\nValuesView abstract base class, 266\n\nvariable interpolation in strings, 163\n\nvariable keyword arguments in function\n\ndefinition, 95\n\nvariable number of arguments in function\n\ndefinition, 94\n\nvariables, 7\n\nas names of objects, 35 binding and module imports, 145 binding of globals in functions, 98 class, 117-118 in nested functions, 97 iteration, 82 naming rules, 26 scope of, 96, 98 vars() function, 72, 211\n\nverbose attribute, of sys.flags, 230\n\nverify_request() method, of SocketServer\n\nclass, 493\n\nversion attribute, of HTTPResponse objects,\n\n504\n\nversion information, of interpreter, 231\n\nversion variable, sys module, 232\n\nversion_info variable, sys module, 232\n\nvformat() method, of Formatter objects,\n\n288\n\nview objects, Python 3, 632\n\nvolume attribute, of ZipInfo objects, 327\n\nvonmisesvariate() function, random mod-\n\nule, 256\n\nW\n\nW command line option, 216, 239-240\n\n‘w’ mode, to open() function, 159\n\nw(here) debugger command, pdb module,\n\n189\n\nwait() function, os module, 394\n\nwait() method\n\nof AsyncResult objects, 425 of Condition objects, 441 of Event objects, 440 of Popen objects, 404\n\nwait3() function, os module, 394\n\nwait4() function, os module, 394\n\nwaitpid() function, os module, 394\n\nwalk() function, os module, 390\n\nwalk() method, of Message objects, 554\n\nF h Lib f L Bdff",
      "content_length": 2288,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 740,
      "content": "wrappers, and attribute binding methods\n\n715\n\nwall-clock time, obtaining, 191\n\nwhile statement, 8, 82\n\nwarn() function, warnings module, 216,\n\nwhitespace variable, string module, 287\n\n239\n\nWIFCONTINUED() function, os module, 395\n\nwarn_explicit() function, warnings module,\n\n239\n\nWarning warning, 216, 238\n\nwarning() method, of Logger objects, 357\n\nwarnings module, 238\n\nwarnings\n\nconverting into exceptions, 239 difference from exceptions, 216 suppression of, 238\n\nWIFEXITED() function, os module, 394\n\nWIFSIGNALED() function, os module, 395\n\nWIFSTOPPED() function, os module, 395\n\nWinDLL() function, ctypes module, 612\n\nWindows, 331\n\naccesing registry, 408 accessing registry, 175 creating a binary distribution with dis-\n\ntutils, 153\n\nwarnoptions variable, sys module, 232\n\ndouble-clicking on Python programs,\n\nWatchedFileHandler class, logging module,\n\n176\n\n363\n\nwave module, 588\n\nWCOREDUMP() function, os module, 394\n\nweak reference, 130\n\ndrive letters in filenames, 399 file locking, 373 issuing message to event log, 362 list of error codes, 346 main program with multiprocessing\n\nweak references, 240\n\nmodule, 417\n\nWeakKeyDictionary class, weakref module,\n\n241\n\nweakref module, 130, 240\n\nWeakValueDictionary class, weakref mod-\n\nper-user site directory, 177 process fork with multiprocessing, 435 running programs, 6 WindowsError exception, 215\n\nule, 241\n\nweb frameworks, 538\n\nand template strings, 164\n\nweb programming, 531\n\nWing IDE, 5\n\nwinreg module, 408\n\nwinsound module, 588\n\nweb server\n\nwinver variable, sys module, 232\n\ncustom handling of requests, 510 running standalone in Python, 508\n\nwebbrowser module, 544\n\nweekday() method, of date objects, 338\n\nweibullvariate() function, random module,\n\nwith statement, 62, 89 and exceptions, 23 and locking, 89 decimal module, 248 locking primitives, 442 work pools, of processes, 424\n\n256\n\nwell known port numbers, 450\n\nwrap_socket() function, ssl module, 486\n\nWEXITSTATUS() function, os module, 394\n\nwfile attribute\n\nof BaseHTTPRequestHandler objects,\n\n509\n\nwrapper functions, 95 and closures, 100 example of, 101 in extension modules, 594\n\nof StreamRequestHandler objects, 491\n\nwrappers, and attribute binding methods,\n\nwhichdb module, 310\n\n132\n\nwhichdb() function, dbm module, 310\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 2338,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 741,
      "content": "716\n\nwraps decorator, functools module\n\n@wraps decorator, functools module, 114,\n\n269\n\nwritable() method\n\nof IOBase objects, 350 of dispatcher objects, 456 write() function, os module, 385\n\nwrite() method\n\nof BufferWriter objects, 352 of ConfigParser objects, 334 of ElementTree objects, 575 of FileIO objects, 350 of StreamWriter objects, 278 of TextIOWrapper objects, 353 of ZipFile objects, 326 of files, 10, 159-160 of mmap objects, 372 of ssl objects, 488\n\nwrite_byte() method, of mmap objects, 372\n\nwritelines() method\n\nof IOBase objects, 350 of StreamWriter objects, 278 of files, 159-160\n\nwritepy() method, of ZipFile objects, 326\n\nwriter() function, csv module, 549\n\nwriterow() method\n\nof csv DictWriter objects, 550 of csv writer objects, 549\n\nwriterows() method\n\nof csv DictWriter objects, 550 of csv writer objects, 550\n\nwritestr() method, of ZipFile objects, 327\n\nwritexml() method, of DOM Node objects,\n\n573\n\nwriting to a file, 159\n\nWSGI (Web Server Gateway Interface), 540\n\nWSGI\n\napplication specification, 540 example of, 541 integration with web frameworks, 543 processing form fields, 541 running a stand-alone server, 542 running in CGI scripts, 542 use of generators for I/O, 165 validation of applications, 543\n\nwsgi.* environment variables, 540\n\nwsgiref package, 542\n\nwsgiref.handlers module, 542\n\nwsgiref.simple_server module, 542\n\nWSTOPSIG() function, os module, 395\n\nwstring_at() function, ctypes module, 618\n\nWTERMSIG() function, os module, 395\n\nX\n\n\\x escape code, in strings, 28\n\nx command line option, 173-174\n\nxdrlib module, 587\n\nxml package, 568\n\nXML() function, xml.etree.ElementTree mod-\n\nule, 575\n\nXML\n\nescaping and unescaping characters,\n\n583\n\nexample document, 569 incremental parsing of large files, 579 namespaces in ElementTree module,\n\n578\n\nparsing, 568\n\nXML-RPC, 524\n\nXML-RPC server, multithreaded example,\n\n494\n\nXML-RPC\n\nexample of, 529 server customization, 530 xml.dom.minidom module, 570\n\nxml.etree.ElementTree module, 573\n\nxml.sax module, 580\n\nxml.sax.saxutils module, 583\n\n‘xmlcharrefreplace’ error handling, 166-167\n\nXMLGenerator() function, xml.sax.saxutils\n\nmodule, 584\n\nXMLID() function, xml.etree.ElementTree\n\nmodule, 575\n\nxmlrpc package, 524\n\nxmlrpc.client module, 524\n\nxmlrpc.server module, 527\n\nxmlrpclib module, 524\n\nF h Lib f L Bdff",
      "content_length": 2288,
      "extraction_method": "Unstructured"
    },
    {
      "page_number": 742,
      "content": "ZipInfo() function, zipfile module\n\n717\n\nXMLRPCServer class, xmlrpc.server mod-\n\nule, 527\n\nxor() function, operator module, 274\n\n__xor__() method, 60\n\nXPATH, 569\n\nxrange type, 38\n\nxrange() compared to a list, 44\n\nxrange() function, 17, 44, 211 and Python 3, 17, 44, 211\n\nXSLT, 569\n\nY\n\nY2K handling, 407\n\nyear attribute, of date objects, 337\n\nyield expressions, 20, 104\n\nyield statement, 19, 53, 102 and context managers, 90 use with I/O, 164-165\n\nZ\n\nZeroDivisionError exception, 87, 215\n\nzfill() method, of strings, 44\n\n.zip files\n\nand modules, 147 decoding and encoding, 324 use as a code archive, 147\n\nzip() function, 83, 211 and Python 3, 211 future_builtins module, 217 type-conversion example, 37\n\nzipfile module, 324\n\nZipFile() function, zipfile module, 325\n\nzipimport module, 586\n\nZipInfo() function, zipfile module, 325\n\nHow can we make this index more useful? Email us at indexes@samspublishing.com\n\nF h Lib f L Bdff",
      "content_length": 925,
      "extraction_method": "Unstructured"
    }
  ]
}